{"version":3,"sources":["resources/engine/gulp/browserify_prelude.js","resources/engine/cocos2d/actions/CCAction.js","resources/engine/cocos2d/actions/CCActionCatmullRom.js","resources/engine/cocos2d/actions/CCActionEase.js","resources/engine/cocos2d/actions/CCActionInstant.js","resources/engine/cocos2d/actions/CCActionInterval.js","resources/engine/cocos2d/actions/CCActionManager.js","resources/engine/cocos2d/actions/index.js","resources/engine/cocos2d/animation/animation-animator.js","resources/engine/cocos2d/animation/animation-clip.js","resources/engine/cocos2d/animation/animation-curves.js","resources/engine/cocos2d/animation/animation-manager.js","resources/engine/cocos2d/animation/animation-state.js","resources/engine/cocos2d/animation/bezier.js","resources/engine/cocos2d/animation/easing.js","resources/engine/cocos2d/animation/index.js","resources/engine/cocos2d/animation/motion-path-helper.js","resources/engine/cocos2d/animation/playable.js","resources/engine/cocos2d/animation/types.js","resources/engine/cocos2d/audio/CCAudio.js","resources/engine/cocos2d/audio/CCAudioEngine.js","resources/engine/cocos2d/core/3d/CCModel.js","resources/engine/cocos2d/core/3d/CCModelMeshResource.js","resources/engine/cocos2d/core/3d/CCSkeleton.js","resources/engine/cocos2d/core/3d/CCSkeletonAnimation.js","resources/engine/cocos2d/core/3d/CCSkeletonAnimationClip.js","resources/engine/cocos2d/core/3d/CCSkinnedMeshRenderer.js","resources/engine/cocos2d/core/3d/actions.js","resources/engine/cocos2d/core/3d/geom-utils/aabb.js","resources/engine/cocos2d/core/3d/geom-utils/index.js","resources/engine/cocos2d/core/3d/geom-utils/intersect.js","resources/engine/cocos2d/core/3d/geom-utils/ray.js","resources/engine/cocos2d/core/3d/geom-utils/triangle.js","resources/engine/cocos2d/core/3d/index.js","resources/engine/cocos2d/core/3d/polyfill-3d.js","resources/engine/cocos2d/core/CCDebug.js","resources/engine/cocos2d/core/CCDirector.js","resources/engine/cocos2d/core/CCGame.js","resources/engine/cocos2d/core/CCNode.js","resources/engine/cocos2d/core/CCPrivateNode.js","resources/engine/cocos2d/core/CCScene.js","resources/engine/cocos2d/core/CCScheduler.js","resources/engine/cocos2d/core/assets/CCAsset.js","resources/engine/cocos2d/core/assets/CCAudioClip.js","resources/engine/cocos2d/core/assets/CCBitmapFont.js","resources/engine/cocos2d/core/assets/CCBufferAsset.js","resources/engine/cocos2d/core/assets/CCFont.js","resources/engine/cocos2d/core/assets/CCJsonAsset.js","resources/engine/cocos2d/core/assets/CCLabelAtlas.js","resources/engine/cocos2d/core/assets/CCPrefab.js","resources/engine/cocos2d/core/assets/CCRawAsset.js","resources/engine/cocos2d/core/assets/CCRenderTexture.js","resources/engine/cocos2d/core/assets/CCSceneAsset.js","resources/engine/cocos2d/core/assets/CCScripts.js","resources/engine/cocos2d/core/assets/CCSpriteAtlas.js","resources/engine/cocos2d/core/assets/CCSpriteFrame.js","resources/engine/cocos2d/core/assets/CCTTFFont.js","resources/engine/cocos2d/core/assets/CCTextAsset.js","resources/engine/cocos2d/core/assets/CCTexture2D.js","resources/engine/cocos2d/core/assets/index.js","resources/engine/cocos2d/core/base-ui/CCWidgetManager.js","resources/engine/cocos2d/core/camera/CCCamera.js","resources/engine/cocos2d/core/component-scheduler.js","resources/engine/cocos2d/core/components/CCAnimation.js","resources/engine/cocos2d/core/components/CCAudioSource.js","resources/engine/cocos2d/core/components/CCBlockInputEvents.js","resources/engine/cocos2d/core/components/CCButton.js","resources/engine/cocos2d/core/components/CCCanvas.js","resources/engine/cocos2d/core/components/CCComponent.js","resources/engine/cocos2d/core/components/CCComponentEventHandler.js","resources/engine/cocos2d/core/components/CCLabel.js","resources/engine/cocos2d/core/components/CCLabelOutline.js","resources/engine/cocos2d/core/components/CCMask.js","resources/engine/cocos2d/core/components/CCProgressBar.js","resources/engine/cocos2d/core/components/CCRenderComponent.js","resources/engine/cocos2d/core/components/CCRichText.js","resources/engine/cocos2d/core/components/CCSprite.js","resources/engine/cocos2d/core/components/CCWidget.js","resources/engine/cocos2d/core/components/WXSubContextView.js","resources/engine/cocos2d/core/components/editbox/CCEditBox.js","resources/engine/cocos2d/core/components/editbox/CCEditBoxImpl.js","resources/engine/cocos2d/core/components/editbox/types.js","resources/engine/cocos2d/core/components/index.js","resources/engine/cocos2d/core/components/missing-script.js","resources/engine/cocos2d/core/event-manager/CCEvent.js","resources/engine/cocos2d/core/event-manager/CCEventListener.js","resources/engine/cocos2d/core/event-manager/CCEventManager.js","resources/engine/cocos2d/core/event-manager/CCTouch.js","resources/engine/cocos2d/core/event-manager/index.js","resources/engine/cocos2d/core/event/event-listeners.js","resources/engine/cocos2d/core/event/event-target.js","resources/engine/cocos2d/core/event/event.js","resources/engine/cocos2d/core/event/index.js","resources/engine/cocos2d/core/event/system-event.js","resources/engine/cocos2d/core/graphics/index.js","resources/engine/cocos2d/core/index.js","resources/engine/cocos2d/core/load-pipeline/CCLoader.js","resources/engine/cocos2d/core/load-pipeline/asset-loader.js","resources/engine/cocos2d/core/load-pipeline/asset-table.js","resources/engine/cocos2d/core/load-pipeline/audio-downloader.js","resources/engine/cocos2d/core/load-pipeline/auto-release-utils.js","resources/engine/cocos2d/core/load-pipeline/binary-downloader.js","resources/engine/cocos2d/core/load-pipeline/downloader.js","resources/engine/cocos2d/core/load-pipeline/font-loader.js","resources/engine/cocos2d/core/load-pipeline/index.js","resources/engine/cocos2d/core/load-pipeline/loader.js","resources/engine/cocos2d/core/load-pipeline/loading-items.js","resources/engine/cocos2d/core/load-pipeline/md5-pipe.js","resources/engine/cocos2d/core/load-pipeline/pack-downloader.js","resources/engine/cocos2d/core/load-pipeline/pipeline.js","resources/engine/cocos2d/core/load-pipeline/text-downloader.js","resources/engine/cocos2d/core/load-pipeline/unpackers.js","resources/engine/cocos2d/core/load-pipeline/utils.js","resources/engine/cocos2d/core/load-pipeline/uuid-loader.js","resources/engine/cocos2d/core/mesh/CCMesh.js","resources/engine/cocos2d/core/mesh/CCMeshRenderer.js","resources/engine/cocos2d/core/mesh/CCMeshResource.js","resources/engine/cocos2d/core/mesh/index.js","resources/engine/cocos2d/core/mesh/mesh-renderer.js","resources/engine/cocos2d/core/node-activator.js","resources/engine/cocos2d/core/platform/CCAssetLibrary.js","resources/engine/cocos2d/core/platform/CCClass.js","resources/engine/cocos2d/core/platform/CCClassDecorator.js","resources/engine/cocos2d/core/platform/CCEnum.js","resources/engine/cocos2d/core/platform/CCInputExtension.js","resources/engine/cocos2d/core/platform/CCInputManager.js","resources/engine/cocos2d/core/platform/CCMacro.js","resources/engine/cocos2d/core/platform/CCObject.js","resources/engine/cocos2d/core/platform/CCSAXParser.js","resources/engine/cocos2d/core/platform/CCScreen.js","resources/engine/cocos2d/core/platform/CCSys.js","resources/engine/cocos2d/core/platform/CCView.js","resources/engine/cocos2d/core/platform/CCVisibleRect.js","resources/engine/cocos2d/core/platform/attribute.js","resources/engine/cocos2d/core/platform/callbacks-invoker.js","resources/engine/cocos2d/core/platform/compiler.js","resources/engine/cocos2d/core/platform/deserialize.js","resources/engine/cocos2d/core/platform/id-generater.js","resources/engine/cocos2d/core/platform/index.js","resources/engine/cocos2d/core/platform/instantiate-jit.js","resources/engine/cocos2d/core/platform/instantiate.js","resources/engine/cocos2d/core/platform/js.js","resources/engine/cocos2d/core/platform/preprocess-class.js","resources/engine/cocos2d/core/platform/requiring-frame.js","resources/engine/cocos2d/core/platform/url.js","resources/engine/cocos2d/core/platform/utils.js","resources/engine/cocos2d/core/predefine.js","resources/engine/cocos2d/core/renderer/canvas/canvas-render-walker.js","resources/engine/cocos2d/core/renderer/canvas/forward-renderer.js","resources/engine/cocos2d/core/renderer/canvas/index.js","resources/engine/cocos2d/core/renderer/canvas/renderers/index.js","resources/engine/cocos2d/core/renderer/canvas/renderers/label/bmfont.js","resources/engine/cocos2d/core/renderer/canvas/renderers/label/index.js","resources/engine/cocos2d/core/renderer/canvas/renderers/label/ttf.js","resources/engine/cocos2d/core/renderer/canvas/renderers/mask.js","resources/engine/cocos2d/core/renderer/canvas/renderers/sprite/index.js","resources/engine/cocos2d/core/renderer/canvas/renderers/sprite/simple.js","resources/engine/cocos2d/core/renderer/canvas/renderers/sprite/sliced.js","resources/engine/cocos2d/core/renderer/canvas/renderers/sprite/tiled.js","resources/engine/cocos2d/core/renderer/canvas/renderers/utils.js","resources/engine/cocos2d/core/renderer/index.js","resources/engine/cocos2d/core/renderer/render-engine.js","resources/engine/cocos2d/core/renderer/render-flow.js","resources/engine/cocos2d/core/renderer/utils/dynamic-atlas/atlas.js","resources/engine/cocos2d/core/renderer/utils/dynamic-atlas/manager.js","resources/engine/cocos2d/core/renderer/utils/label/bmfont.js","resources/engine/cocos2d/core/renderer/utils/label/ttf.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/index.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/label/2d/bmfont.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/label/2d/ttf.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/label/3d/bmfont.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/label/3d/ttf.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/label/index.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/mask-assembler.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/2d/bar-filled.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/2d/mesh.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/2d/radial-filled.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/2d/simple.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/2d/sliced.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/2d/tiled.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/3d/bar-filled.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/3d/mesh.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/3d/radial-filled.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/3d/simple.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/3d/sliced.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/3d/tiled.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/sprite/index.js","resources/engine/cocos2d/core/renderer/webgl/assemblers/utils.js","resources/engine/cocos2d/core/renderer/webgl/mesh-buffer.js","resources/engine/cocos2d/core/renderer/webgl/quad-buffer.js","resources/engine/cocos2d/core/renderer/webgl/render-component-walker.js","resources/engine/cocos2d/core/renderer/webgl/stencil-manager.js","resources/engine/cocos2d/core/renderer/webgl/vertex-format.js","resources/engine/cocos2d/core/utils/CCPath.js","resources/engine/cocos2d/core/utils/affine-transform.js","resources/engine/cocos2d/core/utils/base-node.js","resources/engine/cocos2d/core/utils/binary-search.js","resources/engine/cocos2d/core/utils/decode-uuid.js","resources/engine/cocos2d/core/utils/find.js","resources/engine/cocos2d/core/utils/html-text-parser.js","resources/engine/cocos2d/core/utils/index.js","resources/engine/cocos2d/core/utils/math-pools.js","resources/engine/cocos2d/core/utils/misc.js","resources/engine/cocos2d/core/utils/mutable-forward-iterator.js","resources/engine/cocos2d/core/utils/prefab-helper.js","resources/engine/cocos2d/core/utils/profiler/CCProfiler.js","resources/engine/cocos2d/core/utils/profiler/counter.js","resources/engine/cocos2d/core/utils/profiler/perf-counter.js","resources/engine/cocos2d/core/utils/text-utils.js","resources/engine/cocos2d/core/utils/texture-util.js","resources/engine/cocos2d/core/value-types/color.js","resources/engine/cocos2d/core/value-types/index.js","resources/engine/cocos2d/core/value-types/mat4.js","resources/engine/cocos2d/core/value-types/quat.js","resources/engine/cocos2d/core/value-types/rect.js","resources/engine/cocos2d/core/value-types/size.js","resources/engine/cocos2d/core/value-types/value-type.js","resources/engine/cocos2d/core/value-types/vec2.js","resources/engine/cocos2d/core/value-types/vec3.js","resources/engine/cocos2d/deprecated.js","resources/engine/cocos2d/index.js","resources/engine/cocos2d/particle/CCParticleAsset.js","resources/engine/cocos2d/tilemap/CCTiledMapAsset.js","resources/engine/extends.js","resources/engine/extensions/ccpool/CCNodePool.js","resources/engine/index.js","resources/engine/polyfill/array.js","resources/engine/polyfill/misc.js","resources/engine/polyfill/object.js","resources/engine/polyfill/string.js","resources/engine/polyfill/typescript.js","resources/engine/predefine.js"],"names":["modules","cache","entry","newRequire","name","jumped","module","moduleData","exports","x","i","length","1","require","misc","cc","Action","Class","ctor","this","originalTarget","target","tag","TAG_INVALID","clone","action","isDone","startWithTarget","stop","step","dt","logID","update","getTarget","setTarget","getOriginalTarget","setOriginalTarget","getTag","setTag","retain","release","FiniteTimeAction","extends","_duration","getDuration","_timesForRepeat","setDuration","duration","reverse","Speed","speed","_speed","_innerAction","initWithAction","getSpeed","setSpeed","errorID","prototype","call","setInnerAction","getInnerAction","Follow","followedNode","rect","_followedNode","_boundarySet","_boundaryFullyCovered","_halfScreenSize","_fullScreenSize","leftBoundary","rightBoundary","topBoundary","bottomBoundary","_worldRect","initWithTarget","locRect","Rect","y","width","height","isBoundarySet","setBoudarySet","value","winSize","v2","mul","targetWorldPos","convertToWorldSpaceAR","Vec2","ZERO","followedWorldPos","delta","sub","tempPos","parent","convertToNodeSpaceAR","add","setPosition","clampf","activeInHierarchy","follow","getControlPointAt","controlPoints","pos","Math","min","max","reverseControlPoints","newArray","push","cloneControlPoints","CardinalSplineTo","ActionInterval","points","tension","_points","_deltaT","_tension","_previousPosition","_accumulatedDiff","undefined","initWithDuration","setPoints","p","lt","_computeEaseTime","ps","locDT","tempX","tempY","newPos","p0","p1","p2","p3","t","t2","t3","s","b1","b2","b3","b4","cardinalSplineAt","macro","ENABLE_STACKABLE_ACTIONS","locAccDiff","updatePosition","reversePoints","cardinalSplineTo","getPoints","CardinalSplineBy","_startPosition","current","copyConfig","slice","reverseArray","pop","unshift","cardinalSplineBy","posX","posY","a","CatmullRomTo","catmullRomTo","CatmullRomBy","catmullRomBy","easeIn","rate","_rate","easing","pow","easeOut","easeInOut","_easeExponentialInObj","_easeExponentialOutObj","easeExponentialIn","easeExponentialOut","_easeExponentialInOutObj","easeExponentialInOut","_easeSineInObj","cos","PI","_easeSineOutObj","easeSineIn","sin","easeSineOut","_easeSineInOutObj","easeSineInOut","_easeElasticInObj","_easeElasticOutObj","easeElasticIn","period","_period","easeElasticOut","_bounceTime","time1","easeElasticInOut","newT","locPeriod","_easeBounceInObj","_easeBounceOutObj","easeBounceIn","easeBounceOut","_easeBounceInOutObj","easeBounceInOut","_easeBackInObj","_easeBackOutObj","easeBackIn","easeBackOut","_easeBackInOutObj","easeBackInOut","easeBezierAction","b","c","d","_easeQuadraticActionIn","time","easeQuadraticActionIn","_easeQuadraticActionOut","easeQuadraticActionOut","_easeQuadraticActionInOut","easeQuadraticActionInOut","_easeQuarticActionIn","easeQuarticActionIn","_easeQuarticActionOut","easeQuarticActionOut","_easeQuarticActionInOut","easeQuarticActionInOut","_easeQuinticActionIn","easeQuinticActionIn","_easeQuinticActionOut","easeQuinticActionOut","_easeQuinticActionInOut","easeQuinticActionInOut","_easeCircleActionIn","sqrt","easeCircleActionIn","_easeCircleActionOut","easeCircleActionOut","_easeCircleActionInOut","easeCircleActionInOut","_easeCubicActionIn","easeCubicActionIn","_easeCubicActionOut","easeCubicActionOut","_easeCubicActionInOut","easeCubicActionInOut","ActionInstant","Show","_renderComps","getComponentsInChildren","RenderComponent","enabled","Hide","show","hide","ToggleVisibility","render","toggleVisibility","RemoveSelf","isNeedCleanUp","_isNeedCleanUp","init","removeFromParent","removeSelf","FlipX","flip","_flippedX","initWithFlipX","scaleX","abs","flipX","FlipY","_flippedY","initWithFlipY","scaleY","flipY","Place","_x","_y","initWithPosition","place","CallFunc","selector","selectorTarget","data","_selectorTarget","_function","_data","initWithFunction","execute","getTargetCallback","setTargetCallback","sel","callFunc","bezierAt","MAX_VALUE","_elapsed","_firstTick","_easeList","_repeatForever","_repeatMethod","_speedMethod","getElapsed","FLT_EPSILON","_cloneDecoration","_reverseEaseList","easeObj","arguments","locList","n","setAmplitudeRate","amp","getAmplitudeRate","repeat","times","round","isNaN","repeatForever","actionInterval","Sequence","tempArray","_actions","_split","_last","_reversed","paramArray","Array","last","action1","prev","_actionOneTwo","initWithTwoActions","actionOne","actionTwo","durationOne","durationTwo","new_t","actionFound","found","locSplit","locActions","locLast","sequence","result","Repeat","_times","_total","_nextDt","_actionInstant","locInnerAction","locDuration","locTimes","locNextDt","RepeatForever","Spawn","_one","_two","action2","ret","d1","d2","delayTime","spawn","pSpawn","RotateTo","dstAngle","_startAngle","_dstAngle","_angle","angle","rotateTo","RotateBy","deltaAngle","_deltaAngle","v3","rotateBy","MoveBy","deltaPos","deltaY","_positionDelta","position","locPosX","locPosY","locStartPosition","targetX","targetY","locPreviousPosition","moveBy","MoveTo","_endPosition","moveTo","SkewTo","sx","sy","_skewX","_skewY","_startSkewX","_startSkewY","_endSkewX","_endSkewY","_deltaX","_deltaY","skewX","skewY","skewTo","SkewBy","deltaSkewX","deltaSkewY","skewBy","JumpBy","jumps","_delta","_height","_jumps","frac","jumpBy","JumpTo","jumpTo","BezierBy","_config","newConfigs","selConf","locConfig","xb","xc","xd","yb","yc","yd","x0","y0","x1","y1","x2","y2","r","bezierBy","BezierTo","_toConfig","locStartPos","locToConfig","bezierTo","ScaleTo","_scaleX","_scaleY","_startScaleX","_startScaleY","_endScaleX","_endScaleY","scaleTo","ScaleBy","scaleBy","Blink","blinks","_originalState","m","opacity","blink","FadeTo","_toOpacity","_fromOpacity","fromOpacity","fadeTo","FadeIn","_reverseAction","FadeOut","fadeIn","fadeOut","TintTo","red","green","blue","_to","color","_from","Color","g","locTo","locFrom","tintTo","TintBy","deltaRed","deltaGreen","deltaBlue","_deltaR","_deltaG","_deltaB","_fromR","_fromG","_fromB","tintBy","DelayTime","ReverseTime","_other","reverseTime","TargetedAction","_action","_forcedTarget","getForcedTarget","setForcedTarget","forcedTarget","targetedAction","js","ActionManager","_hashTargets","createMap","_arrayTargets","_currentTarget","director","_scheduler","enableForTarget","constructor","_elementPool","_searchElementByTarget","arr","k","_getElement","paused","element","actions","actionIndex","currentAction","lock","_putElement","addAction","_id","removeAllActions","locTargets","removeAllActionsFromTarget","forceDelete","_deleteHashElement","removeAction","splice","removeActionByTag","assertID","limit","_removeActionAtIndex","getActionByTag","getNumberOfRunningActionsInTarget","pauseTarget","resumeTarget","pauseAllRunningActions","idsWithActions","resumeTargets","targetsToResume","pauseTargets","targetsToPause","purgeSharedManager","getScheduler","unscheduleUpdate","index","targets","l","locCurrTarget","elt","Playable","DynamicAnimCurve","quickFindIndex","sampleMotionPaths","EventAnimCurve","EventInfo","WrapModeMask","binarySearch","binarySearchEpsilon","AnimationAnimator","animation","_anims","array","MutableForwardIterator","extend","initClipData","root","state","clip","curves","checkMotionPath","motionPath","isArray","controls","createPropCurve","propPath","keyframes","propName","isMotionPathProp","Node","motionPaths","curve","dotIndex","indexOf","prop","subProps","split","shift","splitPropPath","keyframe","ratio","frame","ratios","curveValue","values","curveTypes","types","Linear","Bezier","sample","currRatioDif","lastRatioDif","canOptimize","_i","_l","_findFrameIndex","createTargetCurves","curveData","propsData","props","compsData","comps","compName","comp","getComponent","compData","Number","parseFloat","wrapMode","parseInt","frameRate","Loop","repeatCount","Infinity","childrenCurveDatas","paths","namePath","find","events","eventInfo","eventData","func","params","playState","startTime","curveLoaded","animator","play","setTime","stopStatesExcept","iterator","anim","stopState","addAnimation","_setEventTarget","removeAnimation","fastRemoveAt","pauseState","pause","resumeState","resume","isPaused","setStateTime","onStop","onPause","onResume","_reloadClip","WrapMode","AnimationClip","Asset","properties","default","type","get","Normal","visible","statics","createWithSpriteFrames","spriteFrames","frames","cc.Sprite","spriteFrame","bezierByTime","WrappedInfo","computeRatioByType","Easing","AnimCurve","onTimeChangedManually","start","end","floorIndex","frameCount","fromVal","isNumber","canLerp","lerp","fromRatio","toRatio","ratioBetweenFrames","toVal","mainProp","subProp","subPropName","_wrappedInfo","_lastWrappedInfo","_ignoreIndex","NaN","_wrapIterations","iterations","currentWrappedInfo","getWrappedInfo","direction","currentIndex","frameIndex","_fireEvent","currentIterations","lastWrappedInfo","lastIterations","lastIndex","lastDirection","interationsChanged","PingPong","getAnimationManager","pushDelayEvent","set","isValid","components","_components","event","funcName","j","component","apply","info","AnimationManager","_delayEvents","_isPlaying","_isPaused","args","destruct","Types","AnimationState","_currentFramePlayed","_delay","_delayTime","_process","process","_clip","_name","delay","_target","_lastframeEventOn","emit","proto","lastInfo","stopped","simpleProcess","len","_lastIterations","_emit","on","callback","once","_this","_ret","self","v","off","hasEventListener","onPlay","_needRevers","needRevers","Reverse","tempRatio","tempTime","shouldWrap","_wrapMode","ShouldWrap","obsolete","getset","_repeatCount","bezier","C1","C2","C3","C4","t1","acos","tau","crt","percent","u1","x3","pa","pb","pa3","pb3","pc3","rd","a3","q","q2","discriminant","mp3","phi","sd","cardano","constant","linear","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","expoIn","expoOut","expoInOut","circIn","circOut","circInOut","elasticIn","asin","elasticOut","elasticInOut","backIn","backOut","backInOut","bounceOut","smooth","fade","_makeOutIn","fnIn","fnOut","quadOutIn","cubicOutIn","quartOutIn","quintOutIn","sineOutIn","expoOutIn","circOutIn","backOutIn","bounceIn","bounceInOut","bounceOutIn","Curve","beziers","progresses","computeBeziers","startCtrlPoint","endCtrlPoint","fps","createControlPoints","in","out","map","newValues","newTypes","newRatios","startRatioOffset","newType","finalProgress","betweenRatio","nextValue","results","progress","l2","normal","getLength","normalize","bezierIndex","getPointAt","newRatio","addNewDatas","startPoint","endPoint","u","getUtoTmapping","getPoint","lengths","getLengths","divisions","__arcLengthDivisions","cacheArcLengths","vector","sum","mag","distance","targetArcLength","arcLengths","il","comparison","low","high","floor","lengthBefore","debug","_stepOnce","virtual","onError","getError","Enum","Default","LoopReverse","PingPongReverse","EventTarget","sys","LoadMode","touchBinded","touchPlayList","Audio","src","_src","_element","id","_volume","_loop","_nextTime","_state","State","INITIALZING","_onended","bind","ERROR","PLAYING","PAUSED","STOPPED","_bindEnded","elem","HTMLAudioElement","addEventListener","onended","_unbindEnded","removeEventListener","_onLoaded","_nativeAsset","document","createElement","WebAudioElement","setVolume","setLoop","setCurrentTime","loadMode","DOM_AUDIO","instance","offset","audio","game","canvas","item","destroy","currentTime","error","loop","getLoop","num","volume","getVolume","err","getCurrentTime","getState","__defineGetter__","__defineSetter__","_this2","loaded","loader","load","url","nativeUrl","skips","audioNativeAsset","buffer","_audio","_context","__audioSupport","context","_buffer","_gainObj","setTargetAtTime","_startTime","_currentSource","playedLength","_currextTimer","_endCallback","_this3","endTime","clearTimeout","setTimeout","bool","os","OS_IOS","AudioClip","_instanceId","_id2audio","_url2id","_audioPool","getAudioFromPath","path","list","audioEngine","_maxAudioInstance","oldId","getAudioFromId","_finishCallback","recycleAudio","handleVolume","AudioState","_maxWebAudioSize","warnID","_loadByUrl","audioID","isLoop","sec","setFinishCallback","_pauseIDCache","pauseAll","resumeAll","stopAll","setMaxAudioInstance","getMaxAudioInstance","uncache","filePath","uncacheAll","getProfile","profileName","preload","setMaxWebAudioSize","kb","_breakCache","_break","_restore","_music","_effect","pauseCache","playMusic","music","stopMusic","pauseMusic","resumeMusic","getMusicVolume","setMusicVolume","isMusicPlaying","playEffect","setEffectsVolume","musicId","getEffectsVolume","pauseEffect","pauseAllEffects","effect","resumeEffect","resumeAllEffects","pauseIDCache","stopEffect","stopAllEffects","BufferAsset","renderEngine","renderer","gfx","vec3","vmath","_type2size","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","_compType2Array","5120","Int8Array","5121","Uint8Array","5122","Int16Array","5123","Uint16Array","5124","Int32Array","5125","Uint32Array","5126","Float32Array","_gltfAttribMap","POSITION","ATTR_POSITION","NORMAL","ATTR_NORMAL","TANGENT","ATTR_TANGENT","COLOR_0","ATTR_COLOR0","TEXCOORD_0","ATTR_UV0","TEXCOORD_1","ATTR_UV1","TEXCOORD_2","ATTR_UV2","TEXCOORD_3","ATTR_UV3","JOINTS_0","ATTR_JOINTS","WEIGHTS_0","ATTR_WEIGHTS","Model","_nodesInited","_buffers","_gltf","_initNodes","nodes","node","children","initSkeleton","skeleton","gltf","buffers","skinID","_skinID","skins","gltfSkin","accessor","accessors","inverseBindMatrices","bufView","bufferViews","bufferView","bin","byteOffset","count","bindposes","mat4","new","jointIndices","joints","jointPaths","_createVB","primitive","vfmt","vcount","maxByteOffset","bufferViewIndex","attributes","gltfAttribName","gfxAttribName","console","acc","vbView","componentType","byteLength","gfxVFmt","VertexFormat","els","_elements","el","stride","bytes","vbData","VertexBuffer","device","USAGE_STATIC","_createIB","ibAcc","indices","ibView","ibData","IndexBuffer","_createArray","accessorID","typedArray","initMesh","meshAsset","_meshID","gltfMesh","meshes","primitives","_ibs","_vbs","_subMeshes","_minPos","_maxPos","vb","ib","gltfAccessor","minPos","maxPos","z","InputAssembler","initAnimationClip","gltfAnimation","animations","_animationID","samplers","channels","gltfChannel","sampler","inputArray","input","outputArray","output","frameIdx","_frameIdx","_i2","_frameIdx2","_i3","quat","_frameIdx3","_i4","scale","_i5","_node","rotation","translation","ModelMeshResource","_inited","_model","meshID","val","model","flush","mesh","Skeleton","_modelSetter","_initWithModel","_serialize","CC_EDITOR","_deserialize","handle","_modelUuid","modelUuid","Animation","SkeletonAnimationClip","SkeletonAnimation","editor","_defaultClip","override","_clips","defaultClip","getAnimationState","_super","searchClips","animationID","MeshRenderer","_m4_tmp","create","SkinnedMeshRenderer","_jointsTextureData","_jointsTexture","_joints","_matrices","_assembler","_skeleton","_rootBone","_initJoints","_initJointsTexture","activeMaterials","rootBone","_createMaterial","material","MeshMaterial","WHITE","_mainTech","_passes","setDepth","useModel","useSkinning","useJointsTexture","jointsTexture","jointsTextureSize","jointMatrices","force","disableRender","__preload","matrices","bone","warn","updateMatrices","jointCount","ext","size","texture","Texture2D","initWithData","PixelFormat","RGBA32F","_setJointsTextureData","iMatrix","matrix","m00","m01","m02","m03","m04","m05","m06","m07","m08","m09","m10","m11","m12","m13","m14","m15","_commitJointsData","image","joint","getWorldMatrix","bindpose","worldMatrix","multiply","_quat_tmp","_vec3_tmp","Rotate3DTo","dstAngleX","dstAngleY","dstAngleZ","_startQuat","_dstQuat","dstQuat","Quat","Vec3","fromEuler","slerp","setRotation","rotate3DTo","Rotate3DBy","deltaAngleX","deltaAngleY","deltaAngleZ","_quat","_lastDt","RAD","angleX","angleY","angleZ","rotateX","rotateY","rotateZ","rotate3DBy","mat3","_v3_tmp","_v3_tmp2","_m3_tmp","aabb","px","py","pz","w","h","center","halfExtents","getBoundary","transform","rot","transformMat4","extent","m4","transformMat3","transform_extent_m4","copy","fromPoints","geomUtils","Triangle","Aabb","Ray","intersect","RecyclePool","ray","triangle","rayAabb","o","ix","iy","iz","t4","t5","t6","tmin","tmax","rayTriangle","ab","ac","pvec","tvec","qvec","cross","det","dot","rayMesh","tri","minDist","_compType2fn","littleEndian","ArrayBuffer","DataView","setInt16","subMeshes","_primitiveType","PT_TRIANGLES","dv","fmt","_format","fn","idx","dist","raycast","cmp","transformMat4Normal","rhw","resultsPool","nodeAabb","modelRay","m4_1","m4_2","distanceValid","worldRay","handler","filter","reset","traversal","cb","getScene","invert","_renderComponent","_boundingBox","anchorX","anchorY","res","sort","ox","oy","oz","dx","dy","dz","origin","lookAt","ax","ay","az","bx","by","bz","cx","cy","cz","EventType","DirtyFlag","_LocalDirtyFlag","math","RenderFlow","ONE_DEGREE","POSITION_ON","SCALE_ON","_updateLocalMatrix3d","_localMatDirty","_matrix","fromRTS","_position","_scale","skx","tan","sky","_worldMatDirty","_calculWorldMatrix3d","_updateLocalMatrix","_parent","parentMat","_worldMatrix","newPosOrX","setLocalDirty","_renderFlag","FLAG_WORLD_TRANSFORM","_eventMask","POSITION_CHANGED","_updateLocalMatrix2d","_calculWorldMatrix2d","_calculWorldMatrix","_upgrade_1x_to_2x_2d","_upgrade_1x_to_2x","_mulMat2d","_mulMat","setScale","SCALE","FLAG_TRANSFORM","SCALE_CHANGED","_is3DNode","_update3DFunction","_on3DNodeChanged","ALL","getPosition","localPosition","toEuler","ROTATION","ERROR_MAP_URL","logList","log","assert","getTypedFormatter","msg","argsArray","shiftArguments","join","_throw","stack","logFormatter","warnFormatter","errorFormatter","assertFormatter","cond","DebugMode","NONE","INFO","WARN","INFO_FOR_WEB_PAGE","WARN_FOR_WEB_PAGE","ERROR_FOR_WEB_PAGE","_resetDebugSetting","mode","logToWebPage","logDiv","setAttribute","logDivStyle","style","zIndex","top","left","logListStyle","backgroundColor","borderBottom","borderTopWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderLeftStyle","borderRightStyle","padding","margin","appendChild","parentNode","scrollTop","scrollHeight","formatStr","Error","isDisplayStats","profiler","isShowingStats","setDisplayStats","displayStats","showStats","hideStats","config","showFPS","AutoReleaseUtils","ComponentScheduler","NodeActivator","Obj","eventManager","Scheduler","Director","invalid","_paused","_purgeDirectorInNextLoop","_winSizeInPoints","_loadingScene","_scene","_totalFrames","_lastUpdate","_deltaTime","_compScheduler","_nodeActivator","_actionManager","EVENT_SHOW","performance","now","EVENT_ENGINE_INITED","scheduleUpdate","PRIORITY_SYSTEM","sharedInit","setEnabled","_animationManager","CollisionManager","_collisionManager","PhysicsManager","_physicsManager","_widgetManager","calculateDeltaTime","convertToGL","uiPoint","container","view","box","getBoundingClientRect","window","pageXOffset","clientLeft","pageYOffset","clientTop","_devicePixelRatio","_isRotated","_viewportRect","convertToUI","glPoint","getWinSize","getWinSizeInPixels","purgeCachedData","releaseAll","purgeDirector","unscheduleAll","clear","stopAnimation","startAnimation","runSceneImmediate","scene","onBeforeLoadScene","onLaunched","Scene","_load","persistNodeList","Object","keys","_persistRootNodes","existNode","getChildByUuid","uuid","getSiblingIndex","_destroyImmediate","insertChild","oldScene","autoReleaseAssets","dependAssets","autoRelease","_deferredDestroy","EVENT_BEFORE_SCENE_LAUNCH","_activate","EVENT_AFTER_SCENE_LAUNCH","runScene","EVENT_AFTER_UPDATE","_getSceneUuid","key","scenes","_sceneInfos","endsWith","startsWith","loadScene","sceneName","_onUnloaded","EVENT_BEFORE_SCENE_LOADING","_loadSceneByUuid","preloadScene","onProgress","onLoaded","asset","message","onUnloaded","dontRunScene","AssetLibrary","loadAsset","sceneAsset","timeEnd","SceneAsset","_uuid","setDepthTest","Camera","main","depth","setClearColor","clearColor","getRunningScene","getAnimationInterval","getFrameRate","setAnimationInterval","setFrameRate","getDeltaTime","getTotalFrames","setScheduler","scheduler","getActionManager","setActionManager","actionManager","getCollisionManager","getPhysicsManager","mainLoop","EVENT_BEFORE_UPDATE","startPhase","updatePhase","lateUpdatePhase","EVENT_BEFORE_DRAW","EVENT_AFTER_DRAW","frameUpdateListeners","__fastOn","__fastOff","remove","addon","EVENT_PROJECTION_CHANGED","EVENT_BEFORE_VISIT","EVENT_AFTER_VISIT","PROJECTION_2D","PROJECTION_3D","PROJECTION_CUSTOM","PROJECTION_DEFAULT","inputManager","dynamicAtlasManager","EVENT_HIDE","EVENT_GAME_INITED","EVENT_RENDERER_INITED","RENDER_TYPE_CANVAS","RENDER_TYPE_WEBGL","RENDER_TYPE_OPENGL","_configLoaded","_isCloning","_prepared","_rendererInitialized","_renderContext","_intervalId","_lastTime","_frameTime","renderType","onStart","cancelAnimFrame","_setAnimFrame","_runMainLoop","restart","removePersistRootNode","close","_initEngine","_initRenderer","_initEvents","_prepareFinished","ENGINE_VERSION","eventTargetOn","eventTargetOnce","prepare","jsList","JSON","stringify","run","_initConfig","addPersistRootNode","isNode","_persistNode","isPersistRootNode","Date","requestAnimFrame","_stTime","_ctTime","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","cancelAnimationFrame","cancelRequestAnimationFrame","msCancelRequestAnimationFrame","mozCancelRequestAnimationFrame","oCancelRequestAnimationFrame","webkitCancelRequestAnimationFrame","msCancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","oCancelAnimationFrame","currTime","getTime","timeToCall","skip","debugMode","exposeClassName","renderMode","registerSystemEvent","collisionMatrix","groupList","_determineRenderType","userRenderMode","supportRender","capabilities","localCanvas","localContainer","HTMLElement","querySelector","tagName","insertBefore","clientWidth","clientHeight","body","documentElement","className","addClass","opts","stencil","antialias","ENABLE_WEBGL_ANTIALIAS","alpha","ENABLE_TRANSPARENT_CANVAS","CC_QQPLAY","initWebGL","_gl","CLEANUP_IMAGE_CACHE","browserType","BROWSER_TYPE_CHROME","browserVersion","initCanvas","_ctx","oncontextmenu","_isContextMenuEnable","hiddenPropName","win","hidden","mozHidden","msHidden","webkitHidden","onHidden","onShown","arg0","arg1","arg2","arg3","arg4","changeList","navigator","userAgent","onfocus","BaseNode","PrefabHelper","mathPools","AffineTrans","Destroying","Flags","ActionManagerExist","emptyFunc","_vec2a","_vec2b","_mat4_temp","_vec3_temp","_quat_temp","_globalOrderOfArrival","_cachedArray","BuiltinGroupIndex","DEBUG","LocalDirtyFlag","SKEW","RT","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","MOUSE_DOWN","MOUSE_MOVE","MOUSE_ENTER","MOUSE_LEAVE","MOUSE_UP","MOUSE_WHEEL","ROTATION_CHANGED","SIZE_CHANGED","ANCHOR_CHANGED","COLOR_CHANGED","CHILD_ADDED","CHILD_REMOVED","CHILD_REORDER","GROUP_CHANGED","_touchEvents","_mouseEvents","_currentHovered","_touchStartHandler","touch","getLocation","owner","_hitTest","bubbles","dispatchEvent","_touchMoveHandler","_touchEndHandler","_touchCancelHandler","_mouseDownHandler","_mouseMoveHandler","_previousIn","_mouseListener","stopPropagation","_mouseUpHandler","_mouseWheelHandler","_searchMaskInParent","Mask","curr","_checkListeners","_objFlags","_bubblingListeners","_capturingListeners","NodeDefines","_opacity","_color","_contentSize","Size","_anchorPoint","_localZOrder","serializable","_zIndex","groupIndex","Integer","group","_eulerAngles","_fromEuler","rotationX","rotationY","FLAG_OPACITY","FLAG_COLOR","range","equals","anchorPoint","MAX_ZINDEX","MIN_ZINDEX","_delaySort","_reorderChildDirty","_widget","_touchListener","_cullingMask","obj","_onSiblingIndexChanged","sibling","siblings","_children","_updateOrderOfArrival","_setDirtyForNode","_onPreDestroy","_onPreDestroyBase","removeListeners","mask","put","sortAllChildren","_onPostActivated","active","_onHierarchyChanged","oldParent","_onHierarchyChangedBase","_nodesOrderDirty","_toEuler","is3DNode","_rotationX","_rotationY","_onBatchCreated","prefabInfo","_prefab","sync","syncWithPrefab","_activeInHierarchy","FLAG_CHILDREN","_onBatchRestored","manager","_checknSetupSysEvent","newAdded","forDispatch","EventListener","TOUCH_ONE_BY_ONE","swallowTouches","onTouchBegan","onTouchMoved","onTouchEnded","onTouchCancelled","addListener","MOUSE","onMouseDown","onMouseMove","onMouseUp","onMouseScroll","schedule","useCapture","_onDispatch","eventType_hasOnceListener","listeners","onceWrapper","arg5","__eventTargets","touchEvent","mouseEvent","_offDispatch","removeListener","fastRemove","removeAll","targetOff","has","_getCapturingTargets","eventPhase","currentTarget","_propagationStopped","_propagationImmediateStopped","_getBubblingTargets","_doDispatchEvent","pauseSystemEvents","recursive","resumeSystemEvents","point","listener","cameraPt","testPt","camera","findCamera","getCameraToWorldPoint","_updateWorldMatrix","vec2","enabledInHierarchy","runAction","pauseAllActions","resumeAllActions","stopAllActions","stopAction","stopActionByTag","getNumberOfRunningActions","locPosition","getScale","getRotation","old","getContentSize","setContentSize","locContentSize","getAnchorPoint","setAnchorPoint","locAnchorPoint","_invTransformPoint","conjugate","transformQuat","inverseSafe","getWorldPosition","setWorldPosition","getWorldRotation","setWorldRotation","getWorldScale","setWorldScale","div","getWorldRT","opos","orot","fromRT","up","fromViewUp","dirtyFlag","hasSkew","rotationRadians","_a","_b","_c","_d","aa","ad","atx","aty","ba","bb","bc","bd","btx","bty","flag","setWorldDirty","getLocalMatrix","convertToNodeSpace","worldPoint","convertToWorldSpace","nodePoint","getNodeToParentTransform","identity","contentSize","translate","fromMat4","getNodeToParentTransformAR","getNodeToWorldTransform","getNodeToWorldTransformAR","getParentToNodeTransform","getWorldToNodeTransform","convertTouchToNodeSpace","convertTouchToNodeSpaceAR","getBoundingBox","getBoundingBoxToWorld","_getBoundingBoxTo","locChildren","child","childRect","union","arrivalOrder","addChild","cleanup","_restoreProperties","onRestore","_p","PrivateNode","_originPos","_posDirty","sendEvent","setParent","getParent","Boolean","_active","_instantiate","activateNode","idGenerater","ListEntry","priority","markedForDeletion","_listEntries","HashUpdateEntry","_hashUpdateEntries","HashTimerEntry","timers","timerIndex","currentTimer","currentTimerSalvaged","_t","_hashTimerEntries","CallbackTimer","_lock","_runForever","_useDelay","_timesExecuted","_repeat","_interval","_callback","initWithCallback","seconds","REPEAT_FOREVER","getInterval","setInterval","interval","trigger","cancel","getCallback","unschedule","_timers","timer","_timeScale","_updatesNegList","_updates0List","_updatesPosList","_hashForUpdates","_hashForTimers","_currentTargetSalvaged","_updateHashLocked","_arrayForTimers","_removeHashElement","_removeUpdateFromHash","targetId","listEntry","_priorityIn","ppList","listElement","_appendIn","__instanceId","getNewId","setTimeScale","timeScale","getTimeScale","tmp","hashElement","li","unscheduleAllForTarget","unscheduleAllWithMinPriority","minPriority","temp_length","isScheduled","pauseAllTargets","pauseAllTargetsWithMinPriority","idsWithSelectors","locArrayForTimers","elementUpdate","isTargetPaused","PRIORITY_NON_SYSTEM","RawAsset","_native","charCodeAt","base","getLibUrlNoExt","deserialize","preventDeferredLoadDependents","preventPreloadNativeObject","toString","serialize","createNode","_setRawAsset","filename","inLibrary","WEB_AUDIO","mixins","getItem","complete","_owner","content","downloadUrl","BitmapFont","Font","fntDataStr","SpriteFrame","fontSize","_fntConfig","JsonAsset","json","LabelAtlas","OptimizationPolicy","AUTO","SINGLE_INSTANCE","MULTI_INSTANCE","Prefab","_createFunction","_instantiatedTimes","optimizationPolicy","asyncLoadAssets","readonly","editorOnly","OptimizationPolicyThreshold","compileCreateFunction","jit","compile","_doInstantiate","rootToRedirect","_synced","CCObject","defineProperty","writable","isChildClassOf","ParticleAsset","RenderTexture","_framebuffer","initWithSize","depthStencilFormat","visibleRect","format","images","wrapS","_wrapS","wrapT","_wrapT","premultiplyAlpha","_premultiplyAlpha","minFilter","_FilterIndex","_minFilter","magFilter","_magFilter","_texture","colors","depthStencilBuffer","RenderBuffer","RB_FMT_D24S8","RB_FMT_S8","gl","RB_FMT_D16","FrameBuffer","drawTextureAt","_image","updateSubImage","level","readPixels","_forward","_device","oldFBO","getParameter","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","_glID","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","RGBA","UNSIGNED_BYTE","Script","_Script","JavaScript","_JavaScript","CoffeeScript","_CoffeeScript","TypeScript","_TypeScript","SpriteAtlas","_spriteFrames","getTexture","getSpriteFrame","sf","getSpriteFrames","textureUtil","temp_uvs","_textureSetter","_refreshTexture","_textureFilename","insetTop","_capInsets","_calculateSlicedUV","insetBottom","insetLeft","insetRight","rotated","originalSize","_rect","_offset","_originalSize","_rotated","vertices","uv","uvSliced","_original","setTexture","textureLoaded","isRotated","setRotated","bRotated","_calculateUV","getRect","setRect","getOriginalSize","setOriginalSize","_textureLoadedCallback","_checkRect","setOffset","getOffset","offsets","textureOrTextureFile","_loadTexture","loadImage","ensureLoadTexture","postLoadTexture","clearTexture","maxX","maxY","atlasWidth","atlasHeight","leftWidth","rightWidth","centerWidth","topHeight","bottomHeight","centerHeight","row","rowD","col","colD","_row","_rowD","_col","_colD","texw","texh","_r","nu","nv","capInsets","textureUuid","copyWithZone","initWithTexture","TTFFont","_fontFamily","String","TextAsset","text","RGB565","TEXTURE_FMT_R5_G6_B5","RGB5A1","TEXTURE_FMT_R5_G5_B5_A1","RGBA4444","TEXTURE_FMT_R4_G4_B4_A4","RGB888","TEXTURE_FMT_RGB8","RGBA8888","TEXTURE_FMT_RGBA8","TEXTURE_FMT_RGBA32F","A8","TEXTURE_FMT_A8","I8","TEXTURE_FMT_L8","AI8","TEXTURE_FMT_L8_A8","RGB_PVRTC_2BPPV1","TEXTURE_FMT_RGB_PVRTC_2BPPV1","RGBA_PVRTC_2BPPV1","TEXTURE_FMT_RGBA_PVRTC_2BPPV1","RGB_PVRTC_4BPPV1","TEXTURE_FMT_RGB_PVRTC_4BPPV1","RGBA_PVRTC_4BPPV1","TEXTURE_FMT_RGBA_PVRTC_4BPPV1","REPEAT","CLAMP_TO_EDGE","MIRRORED_REPEAT","Filter","LINEAR","NEAREST","FilterIndex","9728","9729","_images","_sharedOpts","mipmap","_getSharedOptions","_compressed","initWithElement","_hasMipmap","_flipY","extnames","_isCompressed","getImpl","getId","options","updateImg","HTMLCanvasElement","handleLoadedTexture","pixelFormat","pixelsWidth","pixelsHeight","hasMipmap","getHtmlElementObj","getPixelFormat","hasPremultipliedAlpha","HTMLImageElement","removeItem","description","releaseTexture","setWrapMode","setFilters","setFlipY","setPremultiplyAlpha","premultiply","setMipmap","CC_TEST","fields","extIdStr","extIds","extId","SupportTextureFormats","SUPPORT_TEXTURE_FORMATS","extFormat","tmpExt","loadingItem","customEnv","HORIZONTAL","LEFT","VERTICAL","TOP","AlignMode","ONCE","ON_WINDOW_RESIZE","ALWAYS","getReadonlyNodeSize","computeInverseTransForTarget","widgetNode","out_inverseTranslate","out_inverseScale","translateX","translateY","tInverseTranslate","tInverseScale","ONE","align","widget","inverseTranslate","inverseScale","hasTarget","targetSize","targetAnchor","isRoot","anchor","_alignFlags","localLeft","localRight","targetWidth","right","_isAbsLeft","_left","_isAbsRight","_right","isStretchWidth","isAlignHorizontalCenter","localHorizontalCenter","_isAbsHorizontalCenter","_horizontalCenter","targetCenter","isAlignLeft","localTop","localBottom","targetHeight","bottom","_isAbsBottom","_bottom","_isAbsTop","_top","isStretchHeight","isAlignVerticalCenter","localVerticalCenter","_isAbsVerticalCenter","_verticalCenter","targetMiddle","isAlignBottom","refreshScene","widgetManager","isAligning","activeWidgets","visitNode","alignMode","_activeWidgetsIterator","_AlignFlags","MID","BOT","CENTER","RIGHT","isMobile","onResized","refreshWidgetOnResized","Widget","updateAlignment","_mat4_temp_1","_mat4_temp_2","_v3_temp_1","_v3_temp_2","_v3_temp_3","_cameras","_debugCamera","repositionDebugCamera","ClearFlags","COLOR","DEPTH","STENCIL","Component","setStages","View","dirty","_camera","_clearFlags","_backgroundColor","_depth","_zoomRatio","_targetTexture","_fov","_orthoSize","_nearClip","_farClip","_ortho","zoomRatio","fov","orthoSize","nearClip","_updateClippingpPlanes","farClip","ortho","_updateProjection","_updateRect","cullingMask","_updateCameraMask","clearFlags","setClearFlags","_updateBackgroundColor","_sortDepth","targetTexture","_updateTargetTexture","_is3D","cameras","containsNode","_setupDebugCamera","setFov","setNear","setFar","setColor","setNode","addCamera","setType","_init","onLoad","onEnable","beforeDraw","onDisable","removeCamera","getNodeToCameraTransform","getWorldToCameraMatrix","getCameraToWorldMatrix","getWorldToCameraPoint","getRay","screenPos","screenToWorld","_walker","visit","renderCamera","_layout","atan","setOrthoHeight","jsArray","IsStartCalled","IsOnEnableCalled","callStart","IsEditorOnEnableCalled","callUpdate","callLateUpdate","sortedIndex","order","_executionOrder","test","testOrder","testId","stableRemoveInactive","flagToClear","next","_enabled","removeAt","LifeCycleInvoker","__ctor__","invokeFunc","Iterator","_zero","_neg","_pos","_invoke","invoke","compareOrder","OneOffInvoker","cancelInactive","compsNeg","compsPos","ReusableInvoker","createInvokeImpl","funcOrCode","useDt","Function","startInvoker","updateInvoker","lateUpdateInvoker","scheduleInNextFrame","_updating","invokeOnEnable","compScheduler","_onEnabled","_scheduleImmediate","_onDisabled","lateUpdate","enableComp","invoker","disableComp","_deferredSchedule","equalClips","clip1","clip2","PLAY","STOP","PAUSE","RESUME","LASTFRAME","FINISHED","_animator","_nameToState","_didInit","_currentClip","tooltip","CC_DEV","currentClip","playOnLoad","isPlaying","onDestroy","getClips","playAdditive","addClip","newName","contains","oldState","newState","removeClip","_EventTargetOn","nameToState","_EventTargetOff","_createStates","defaultClipState","AudioSource","_mute","_pausedFlag","animatable","clamp01","mute","_ensureDataLoaded","_pausedCallback","_restoreCallback","rewind","BlockEvents","BlockInputEvents","menu","inspector","help","Transition","SPRITE","HOVER","PRESSED","DISABLED","Button","_pressed","_hovered","_fromColor","_toColor","_time","_transitionFinished","_fromScale","_toScale","_originalScale","_sprite","interactable","notify","_updateState","_resetState","_resizeToTarget","_resizeNodeToTargetNode","enableAutoGrayEffect","_updateDisabledState","transition","oldValue","_updateTransition","formerlySerializedAs","normalColor","displayName","_getButtonState","_getTarget","pressedColor","hoverColor","disabledColor","zoomScale","normalSprite","pressedSprite","hoverSprite","disabledSprite","_applyTarget","clickEvents","EventHandler","_setTargetColor","_registerEvent","_getStateColor","_getStateSprite","_setCurrentStateColor","_setCurrentStateSprite","_onTouchBegan","_onTouchMove","_onTouchEnded","_onTouchCancel","_onMouseMoveIn","_onMouseMoveOut","_getTargetSprite","sprite","Sprite","hit","_applyTransition","emitEvents","_updateColorTransitionImmediately","_updateColorTransition","_updateSpriteTransition","_updateScaleTransition","_zoomUp","_zoomBack","oldTransition","setState","GRAY","Canvas","resetInEditor","_designResolution","designResolution","applySettings","alignWithScreen","_fitWidth","_fitHeight","fitHeight","fitWidth","_thisOnResized","cameraNode","setSiblingIndex","addComponent","designSize","nodeSize","canvasSize","getDesignResolutionSize","offsetX","offsetY","policy","ResolutionPolicy","SHOW_ALL","FIXED_WIDTH","FIXED_HEIGHT","NO_BORDER","designRes","setDesignResolutionSize","IsOnLoadCalled","getClassName","trimLeft","lastIndexOf","__scriptAsset","_isOnLoadCalled","onFocusInEditor","onLostFocusInEditor","typeOrClassName","getComponents","getComponentInChildren","_getLocalBounds","unscheduleAllCallbacks","eventTargets","destroyComp","_removeComponent","cloned","instantiate","_clone","scheduleOnce","callback_fn","_requireComponent","cls","reqComp","requireComponent","executionOrder","__scriptUuid","_componentId","_componentName","_genCompIdIfNeeded","_compId2Name","_compName2Id","customEventData","compType","_getClassById","getClassByName","_getClassId","compId","SpriteMaterial","HorizontalAlign","TextAlignment","VerticalAlign","VerticalTextAlignment","Overflow","CLAMP","SHRINK","RESIZE_HEIGHT","Label","_actualFontSize","_assemblerData","_ttfTexture","_useOriginalSize","_string","string","_updateRenderData","_checkStringEmpty","multiline","horizontalAlign","verticalAlign","actualFontSize","_fontSize","fontFamily","_lineHeight","lineHeight","overflow","_enableWrapText","enableWrapText","_N$file","font","_isSystemFontUsed","_renderData","destroyRenderData","_fontAtlas","_updateAssembler","_applyFontTexture","useSystemFont","_userDefinedFont","_bmFontOriginalSize","_spacingX","spacingX","_isBold","_isItalic","_isUnderline","_resetAssemblerData","_canRender","markForRender","assembler","getAssembler","createData","markForUpdateRenderData","onBMFontTextureLoaded","_activateMaterial","updateRenderData","_getAssemblerData","_material","_srcBlendFactor","BlendFactor","SRC_ALPHA","useColor","_updateMaterial","_updateColor","renderData","vertDirty","uvDirty","_enableBold","_enableItalics","_enableUnderline","LabelOutline","_width","label","StencilMaterial","Graphics","_vec2_temp","_circlepoints","MaskType","RECT","ELLIPSE","IMAGE_STENCIL","_graphics","_clearGraphics","_spriteFrame","_type","alphaThreshold","_updateGraphics","lastSprite","_applySpriteFrame","Float","slide","updateHash","inverted","_segments","segements","Type","_createGraphics","_onTextureLoaded","FLAG_POST_RENDER","_removeGraphics","oldFrame","useTexture","lineWidth","strokeColor","fill","graphics","radius","anglePerStep","_calculateCircle","lineTo","stroke","rx","ry","enable","FLAG_UPDATE_RENDER_DATA","FLAG_RENDER","Mode","FILLED","ProgressBar","_initBarSprite","barSprite","entity","nodeAnchor","entitySize","fillType","FillType","RADIAL","barSpriteSize","totalLength","fillRange","_updateBarStatus","finalContentSize","totalWidth","totalHeight","entityAnchorPoint","entityPosition","actualLenth","anchorOffsetX","anchorOffsetY","finalPosition","_N$totalLength","fillStart","RenderData","_dstBlendFactor","ONE_MINUS_SRC_ALPHA","srcBlendFactor","_updateBlendFunc","dstBlendFactor","__allocedDatas","_vertexFormat","_toPostHandle","_postAssembler","free","markForCustomIARender","FLAG_CUSTOM_IA_RENDER","requestRenderData","alloc","getMaterial","passes","setBlend","BLEND_FUNC_ADD","textUtils","_htmlTextParser","pool","Pool","fontAsset","labelNode","_get","labelComponent","RichText","_textArray","_labelSegments","_labelSegmentsCache","_linesWidth","_updateRichTextStatus","_updateRichText","_layoutDirty","_onTTFLoaded","maxWidth","imageAtlas","handleTouchEvent","_addEventListeners","_removeEventListeners","_activateChildren","_updateLabelSegmentTextAttributes","forEach","_applyTextAttribute","_createFontLabel","_measureText","styleIndex","_styleIndex","labelSegment","clickHandler","_clickHandler","clickParam","_clickParam","_containsTouchLocation","_lineOffsetX","_lineCount","_labelWidth","_labelHeight","_addLabelSegment","stringToken","_updateRichTextWithMaxWidth","labelString","labelWidth","fragmentWidth","checkStartIndex","checkEndIndex","_getFirstWordLen","checkString","substr","checkStringWidth","remainingString","_updateLineInfo","fragments","fragmentText","splitString","labelSize","_isLastComponentCR","_needsUpdateTextLayout","newTextArray","oldItem","newItem","outline","italic","isImage","_addRichTextImageElement","richTextElement","spriteFrameName","spriteNode","spriteComponent","SLICED","sizeMode","SizeMode","CUSTOM","spriteRect","scaleFactor","spriteWidth","spriteHeight","expectWidth","imageWidth","expectHeight","imageHeight","click","param","parse","lastEmptyLine","newline","multilineTexts","_updateRichTextPosition","startIndex","textLen","character","charAt","isUnicodeCJK","isUnicodeSpace","nextTokenX","nextLineIndex","totalLineCount","lineCount","lineOffsetX","_convertLiteralColorValue","colorValue","toUpperCase","fromHEX","textStyle","bold","underline","labelOutlineComponent","NodeEvent","GraySpriteMaterial","SpriteType","SIMPLE","TILED","MESH","TRIMMED","RAW","_graySpriteMaterial","_spriteMaterial","_sizeMode","_fillType","_fillCenter","_fillStart","_fillRange","_isTrimmedMode","_atlas","fillCenter","trim","_applySpriteSize","setVisible","_onNodeSizeDirty","_applyAtlas","_resized","WidgetManager","AlignFlags","TOP_BOT","LEFT_RIGHT","isAlignTop","_setAlign","isAlignRight","horizontalCenter","verticalCenter","isAbsoluteHorizontalCenter","isAbsoluteVerticalCenter","isAbsoluteTop","isAbsoluteBottom","isAbsoluteLeft","isAbsoluteRight","_wasAlignOnce","_originalWidth","_originalHeight","_validateTargetInDEV","isAlign","isHorizontal","WXSubContextView","EditBoxImpl","InputMode","InputFlag","KeyboardReturnType","EditBox","maxLength","_impl","_updateString","backgroundImage","_createBackgroundSprite","returnType","DEFAULT","inputFlag","setInputFlag","inputMode","ANY","setInputMode","_textLabel","setFontSize","fontColor","setFontColor","placeholder","_placeholderLabel","setPlaceholderText","placeholderFontSize","placeholderFontColor","setMaxLength","stayOnTop","_updateStayOnTop","_tabIndex","tabIndex","setTabIndex","editingDidBegan","textChanged","editingDidEnded","editingReturn","_EditBoxImpl","_createLabels","_resizeChildNodes","impl","setDelegate","setReturnType","_syncSize","_hideLabels","_showLabels","_background","_updateLabelPosition","setSize","offx","offy","placeholderLabel","textLabel","background","getChildByName","textLabelNode","placeholderLabelNode","backgroundNode","displayText","_updateLabelStringStyle","setString","_editing","ignorePassword","PASSWORD","INITIAL_CAPS_ALL_CHARACTERS","INITIAL_CAPS_WORD","replace","capitalize","INITIAL_CAPS_SENTENCE","capitalizeFirstLetter","passwordString","editBoxEditingDidBegan","editBoxEditingDidEnded","editBoxTextChanged","editBoxEditingReturn","setFocus","isFocused","utils","_matrix_temp","_vec3","_currentEditBoxImpl","polyfill","zoomInvalid","OS_ANDROID","BROWSER_TYPE_SOUGOU","BROWSER_TYPE_360","_delegate","_inputMode","_inputFlag","_returnType","_maxLength","_text","_placeholderText","_alwaysOnTop","_size","__eventListeners","__fullscreen","__autoResize","__rotateScreen","__orientationChanged","_edTxt","display","_beginEditing","activeElement","getString","getPlaceholderText","delegate","createInput","_updateDomInputType","_updateSize","textTransform","_edFontSize","_textColor","toCSS","_updateMatrix","removeDom","_beginEditingOnMobile","startFocus","focus","BROWSER_TYPE_UC","BROWSER_TYPE_FIREFOX","_endEditing","hideDomInputAndShowLabel","_endEditingOnMobile","edTxt","EMAIL_ADDR","NUMERIC","DECIMAL","PHONE_NUMBER","pattern","URL","SEARCH","newWidth","newHeight","viewport","dpr","paddingLeft","paddingBottom","tx","ty","_adjustEditBoxPosition","windowHeight","factor","scrollY","scrollOffset","scrollTo","_inputValueHandle","editBoxImpl","registerInputEventListener","tmpEdTxt","isTextarea","inputLock","blurWhenComposition","cbs","compositionstart","compositionend","keypress","e","keyCode","KEY","enter","blur","_addDomToGameContainer","_createDomTextArea","_createDomInput","isAutoFullScreenEnabled","enableAutoFullScreen","screen","exitFullScreen","_resizeWithBrowserSize","resizeWithBrowserSize","_originalDesignResolutionSize","_resolutionPolicy","border","LEFT_PADDING","resize","overflow_y","removeChild","DONE","SEND","GO","NEXT","SINGLE_LINE","SENSITIVE","BUILTIN_CLASSID_RE","MissingClass","_$erialized","MissingScript","compiled","safeFindClass","reportMissingClass","getMissingWrapper","_MissingScript","EventMouse","eventType","Event","_eventType","_button","_prevX","_prevY","_scrollX","_scrollY","setScrollData","scrollX","getScrollX","getScrollY","setLocation","getLocationInView","_designResolutionSize","_setPrevCursor","getPreviousLocation","getDelta","getDeltaX","getDeltaY","setButton","button","getButton","getLocationX","getLocationY","DOWN","UP","MOVE","SCROLL","BUTTON_LEFT","BUTTON_RIGHT","BUTTON_MIDDLE","BUTTON_4","BUTTON_5","BUTTON_6","BUTTON_7","BUTTON_8","EventTouch","touchArr","TOUCH","_eventCode","_touches","currentTouch","getEventCode","getTouches","_setEventCode","eventCode","_setTouches","touches","setTouchInfo","getID","getStartLocation","MAX_TOUCHES","BEGAN","MOVED","ENDED","CANCELED","EventAcceleration","ACCELERATION","EventKeyboard","isPressed","KEYBOARD","listenerID","_onEvent","_listenerID","_registered","_fixedPriority","_isEnabled","_setPaused","_setRegistered","registered","_isRegistered","_getType","_getListenerID","_setFixedPriority","fixedPriority","_getFixedPriority","_setSceneGraphPriority","_getSceneGraphPriority","checkAvailable","isEnabled","UNKNOWN","TOUCH_ALL_AT_ONCE","ListenerID","Custom","listenerId","_onCustomEvent","mixin","Mouse","eventListener","TouchOneByOne","_claimedTouches","setSwallowTouches","needSwallow","isSwallowTouches","TouchAllAtOnce","onTouchesBegan","onTouchesMoved","onTouchesEnded","onTouchesCancelled","Acceleration","_onAccelerationEvent","Keyboard","onKeyPressed","onKeyReleased","argObj","listenerType","eventName","_EventListenerVector","_fixedListeners","_sceneGraphListeners","gt0Index","empty","clearSceneGraphListeners","clearFixedListeners","getFixedPriorityListeners","getSceneGraphPriorityListeners","DIRTY_NONE","DIRTY_FIXED_PRIORITY","DIRTY_SCENE_GRAPH_PRIORITY","DIRTY_ALL","_listenersMap","_priorityDirtyFlagMap","_nodeListenersMap","_nodePriorityMap","_globalZOrderNodeMap","_toAddedListeners","_toRemovedListeners","_dirtyNodes","_inDispatch","_nodePriorityIndex","_internalCustomListenerIDs","getChildren","_BaseNode","_addListener","_forceAddEventListener","_setDirty","_associateNodeAndEventListener","_getListeners","_updateDirtyFlagForSceneGraph","selListeners","selListener","locDirtyNodes","locNodeListenersMap","listenersLen","_removeAllListenersInVector","listenerVector","_dissociateNodeAndEventListener","_removeListenersForListenerID","fixedPriorityListeners","sceneGraphPriorityListeners","locToAddedListeners","_sortEventListeners","locFlagMap","_sortListenersOfFixedPriority","rootEntity","_sortListenersOfSceneGraphPriority","rootNode","sceneGraphListener","_visitTarget","_sortEventListenersOfSceneGraphPriorityDes","l1","locNodePriorityMap","node1","node2","fixedListeners","_sortListenersOfFixedPriorityAsc","_onUpdateListeners","toRemovedListeners","locListenersMap","locPriorityDirtyFlagMap","selKey","_cleanToRemovedListeners","_updateTouchListeners","locInDispatch","_onTouchEventCallback","argsObj","selTouch","removedIdx","isClaimed","getCode","CANCELLED","isStopped","needsMutableSet","_dispatchTouchEvent","oneByOneListeners","allAtOnceListeners","originalTouches","mutableTouches","oneByOneArgsObj","_dispatchEventToListeners","_onTouchesEventCallback","callbackParams","onEvent","eventOrArgs","shouldStopPropagation","locDirtyFlagMap","isRootNode","childrenCount","locGlobalZOrderNodeMap","_sortNumberAsc","nodeOrPriority","addCustomListener","isFound","locListener","_removeListenerInVector","_removeListenerInCallback","listenersCopy","removeCustomListeners","customEventName","removeAllListeners","locListeners","locInternalCustomEventIDs","setPriority","getType","__getListenerID","_onListenerCallback","dispatchCustomEvent","optionalUserData","ev","EventCustom","setUserData","Touch","_lastModified","_point","_prevPoint","_startPoint","getPreviousLocationInView","getStartLocationInView","_startPointCaptured","_convertPointWithScale","_setPoint","_setPrevPoint","CallbacksHandler","EventListeners","captureListeners","_callbackTable","rootInvoker","isInvoking","callbacks","containCanceled","purgeCanceled","CallbacksInvoker","unuse","NO_TYPE","reuse","stopPropagationImmediate","getCurrentTarget","CAPTURING_PHASE","AT_TARGET","BUBBLING_PHASE","detail","getUserData","getEventName","_eventPool","inputManger","KEY_DOWN","KEY_UP","DEVICEMOTION","keyboardListener","accelerationListener","SystemEvent","setAccelerometerEnabled","isEnable","setAccelerometerInterval","systemEvent","hasKeyDownEventListener","hasKeyUpEventListener","Pipeline","LoadingItems","AssetLoader","Downloader","Loader","AssetTable","callInNextTick","resources","_info","raw","getResWithUrl","isUuid","_uuidInSettings","_getAssetInfoInRuntime","isRawAsset","_sharedResources","_sharedList","CCLoader","assetLoader","downloader","md5Pipe","_autoReleaseSetting","getXMLHttpRequest","XMLHttpRequest","ActiveXObject","addDownloadHandlers","extMap","addHandlers","addLoadHandlers","progressCallback","completeCallback","singleRes","resource","_cache","queue","errors","items","getContent","initQueueDeps","append","flowInDeps","urlList","completedCount","totalCount","_ownerQueue","_childOnProgress","deps","ownerQueue","getQueue","accepted","_resources","_getResUuid","quiet","getUuid","extname","_getReferenceKey","assetOrUrlOrUuid","_urlNotFound","_parseLoadResArgs","onComplete","isValidType","loadRes","setAutoReleaseRecursively","_loadResUuids","uuids","urls","assetRes","urlRes","loadResArray","isTypesArray","assetType","loadResDir","getUuidArray","assetResLength","getRes","ref","alias","getResCount","getDependsRecursively","assets","CC_DEBUG","releaseAsset","releaseRes","releaseResDir","removed","setAutoRelease","depends","depend","isAutoRelease","assetOrUrl","ID","async","pipeline","reusedArray","queryAssetInfo","rawUrl","toLowerCase","queueId","pushToMap","_pathToUuid","isMatchByWord","nextAscii","out_urls","path2uuid","isMainAsset","substring","newEntry","_getInfo_DEBUG","formatSupport","loadDomAudio","dom","clearEvent","success","failure","USE_LOADER_EVENT","readyState","loadWebAudio","request","open","responseType","onload","response","onerror","send","urlParam","parseDepends","parsed","dependKeys","visitAsset","excludeMap","visitComponent","getOwnPropertyNames","_j","_val","oldSceneAssets","nextSceneAssets","persistNodes","releaseSettings","_key","xhr","errInfo","arrayBuffer","status","errorMessage","ontimeout","downloadAudio","PackDownloader","downloadBinary","downloadText","urlAppendTimestamp","downloadScript","isAsync","loadHandler","errorHandler","location","protocol","crossOrigin","downloadImage","isCrossOrigin","img","Image","naturalWidth","loadCallback","errorCallback","defaultMap","png","jpg","bmp","jpeg","gif","ico","tiff","webp","pvr","etc","ogg","wav","m4a","txt","xml","vsh","fsh","atlas","tmx","tsx","ExportJson","plist","fnt","eot","ttf","woff","svg","ttc","binary","_curConcurrent","_loadQueue","_subpackages","_handleLoadQueue","DOWNLOAD_MAX_CONCURRENT","nextOne","syncRet","downloadFunc","ignoreMaxConcurrency","loadSubpackage","pac","_canvasContext","_testString","_fontFaces","_loadingFonts","_timeout","_checkFontLoaded","allFontsLoaded","fontLoadHandle","fontFamilyName","oldWidth","refWidth","safeMeasureText","clearInterval","fontLoader","loadFont","_getFontFamily","labelCanvas","getContext","fontDesc","fontStyle","fontStr","textContent","preloadDiv","divStyle","innerHTML","fontHandle","ttfIndex","slashPos","plistParser","loadUuid","loadJSON","platform","FB_PLAYABLE_ADS","tex","loadAudioAsAsset","audioClip","PVR_HEADER_LENGTH","PVR_MAGIC","PVR_HEADER_MAGIC","PVR_HEADER_HEIGHT","PVR_HEADER_WIDTH","PVR_HEADER_MIPMAPCOUNT","PVR_HEADER_METADATA","loadCompressedTex","header","dataOffset","prefab","fire","_qid","random","_queues","_pool","ItemState","WORKING","COMPLETE","_queueDeps","isIdValid","createItem","itemSplit","_parseUrlParam","states","checkedIds","checkCircleReference","recursiveCall","subDep","_pipeline","_errorUrls","_appending","completed","allComplete","itemComplete","dep","registerQueueDep","depId","queueDepList","finishDep","flowIn","isCompleted","isItemCompleted","exists","hasListener","errorListId","ExtnameRegex","UuidRegex","MD5Pipe","md5AssetsMap","md5NativeAssetsMap","libraryBase","hashPatchInFolder","transformURL","isNativeAsset","dirname","basename","matched","matches","match","getUuidFromURL","hashValue","Unpackers","PackState","Invalid","Removed","Downloading","Loaded","UnpackerData","unpacker","uuidToPack","packIndices","globalUnpackers","packUuid","initPacks","packs","pushFront","_loadNewPack","packUrl","packJson","_doLoadNewPack","_doPreload","unpackerData","JsonUnpacker","packedJson","TextureUnpacker","retrieve","_selectLoadedPack","packUuids","existsPackState","existsPackUuid","flow","pipe","pipeId","itemState","flowOut","pipes","_pipes","insertPipe","nextPipe","previousPipe","insertPipeAfter","refPipe","newPipe","appendPipe","copyItemStates","srcItem","dstItems","overrideMimeType","responseText","jsons","contents","datas","__type__","_noCacheRex","isSceneObj","classFinder","isScene","tdInfo","Details","existingAsset","deferredLoadRawAssetsInRuntime","dependUuid","uuidList","objList","uuidObjList","propList","uuidPropList","stillUseUrl","_stillUseUrl","deferredLoadRaw","_ownerProp","canDeferredLoad","itemsMap","dependSrc","dependUrl","loadCallbackCtx","wasRawAssetType","loadDepends","MeshResource","applyColor","applyVec2","applyVec3","Mesh","_resource","_resourceInited","_initResource","vertexFormat","vertexCount","dynamic","_bytes","USAGE_DYNAMIC","setVertices","_attr2el","isFlatMode","elNum","reader","ATTR_COLOR","sOffset","dOffset","applyFunc","setIndices","INDEX_FMT_UINT16","setPrimitiveType","ibs","vbs","_uploadData","_numVertices","_numIndices","_mesh","textures","_renderDatas","_materials","subMesh","_vertexBuffer","useAttributeColor","materials","_reset","IARenderData","BLACK_COLOR","BLACK","meshRendererAssembler","renderDatas","submeshes","ia","createWireFrameData","oldIbData","PT_LINES","fillBuffers","_flush","SHOW_MESH_WIREFRAME","tmpMaterial","tmpNode","_dummyNode","_flushIA","CompScheduler","IsPreloadStarted","IsOnLoadStarted","Deactivating","callOnLoad","UnsortedInvoker","invokePreload","invokeOnLoad","activateTasksPool","_componentCorrupted","_activatingStack","task","_activateNodeRecursively","preloadInvoker","onLoadInvoker","onEnableInvoker","originCount","activateComp","_deactivateNodeRecursively","lastTask","resetComp","decodeUuid","_libraryBase","_rawAssetsBase","_uuidToRawAsset","RawAssetEntry","inRawAssetsDir","_queryAssetInfoInEditor","parseUuidInEditor","loadJson","randomUuid","getAssetByUuid","_uuidToAsset","libraryPath","stripSep","rawAssetsBase","import","md5ImportMap","md5Entries","md5RawAssetsMap","rawAssets","mountPoint","typeId","isSubAsset","packedAssets","mountPaths","Attr","isPlainEmptyObj_DEV","cloneable_DEV","DELIMETER","getTypeChecker","preprocess","BUILTIN_ENTRIES","pushUnique","deferredInitializer","declareProperties","$super","appendProp","__props__","tmpArray","defineProp","es6","defaultValue","setClassAttr","attrs","parseAttributes","onAfterProp","attr","_onAfterProp","defineGetSet","getter","setter","getOwnPropertyDescriptor","setterUndefined","getDefault","defaultVal","mixinWithInherited","dest","hasOwnProperty","getPropertyDescriptor","doDefine","baseClass","ctors","fireClass","__es6__","__ES6__","getCtors","CCClass","_isCCClass","__ctors__","baseOrMixins","concat","baseOrMixin","baseCtors","_getAllCtors","_createCtor","getClassAttrs","__initProps__","compileProps","setClassName","getNewValueTypeCodeJit","clsName","propVal","escapeForJS","IDENTIFIER_RE","actualClass","initProps","F","attrKey","statement","expression","def","ValueType","getInitPropsJit","boundSuperCalls","ctorLen","SNIPPET","ctorName","SuperCallReg","xyz","hasSuperCall","pd","superFunc","preprocessAttrs","__values__","_RF","peek","script","_setClassId","define","_sealed","some","staticPropName","validateMethodWithProps","_registerEditorProps","_fastDefine","serializableFields","attrProtos","getClassAttrsProto","getInheritanceChain","klass","chain","getSuper","PrimitiveTypes","tmpAttrs","usedInGetter","attrsProto","attrsProtoKey","getAttrsProto","primitiveType","ScriptUuid","ObjectType","ScriptAsset","isEnum","enumList","getList","_short","parseSimpleAttr","attrName","expectType","fastDefine","getNewValueTypeCode","Preprocess","CACHE_KEY","fNOP","getSubDict","checkCtorArgument","decorate","_checkNormalArgument","validator_DEV","decoratorName","checkCompArgument","_argumentChecker","checkStringArgument","checkNumberArgument","getClassCache","ccclass","decoratedProto","createEditorDecorator","argCheckFunc","editorPropName","staticValue","decoratedValue","createDummyDecorator","executeInEditMode","disallowMultiple","playOnFocus","icon","_decorator","property","ctorProtoOrOptions","desc","normalized","ctorProto","fullOptions","getFullFormOfProperty","existsProperty","initializer","getDefaultFromInitializer","actualDefaultValues","dummyObj","extractActualDefaultValues","genProperty","isInteger","reverseKey","enumType","enumDef","__enums__","enums","_didAccelerateFun","timestamp","_accelEnabled","_registerAccelerometerEvent","_accelCurTime","_unregisterAccelerometerEvent","_accelInterval","_registerKeyboardEvent","preventDefault","_acceleration","_accelDeviceEvent","DeviceMotionEvent","DeviceOrientationEvent","BROWSER_TYPE_MOBILE_QQ","_deviceEventType","ua","_minus","didAccelerate","mAcceleration","eventAcceleration","_accelMinus","timeStamp","tmpX","orientation","TOUCH_TIMEOUT","_vec2","_mousePressed","_isRegisterEvent","_preTouchPoint","_prevMousePoint","_preTouchPool","_preTouchPoolPointer","_touchesIntegerDict","_indexBitsUsed","_maxTouches","_getUnUsedIndex","temp","_removeUsedIndexBit","_glView","handleTouchesBegin","curTouch","touchID","handleTouches","locTouchIntDict","unusedIndex","_convertTouchesWithScale","handleTouchesMove","locTouches","handleTouchesEnd","getSetOfTouchesEndOrCancel","handleTouchesCancel","locTouchesIntDict","getHTMLElementPosition","docElem","leftOffset","topOffset","getPreTouch","preTouch","locPreTouchPool","setPreTouch","getTouchByXY","locPreTouch","convertToLocationInView","getMouseEvent","locPreMouse","_convertMouseToLocationInView","getPointByEvent","pageX","pageY","scrollLeft","clientX","clientY","getTouchesByEvent","locView","touch_event","preLocation","changedTouches","identifier","selfPointer","prohibition","supportMouse","supportTouches","_mouseEventsOnElement","wheelDelta","msPointerEnabled","_pointerEventsMap","MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel","_touchEventsMap","touchstart","touchesToHandle","touchmove","touchend","touchcancel","registerTouchEvent","BROWSER_TYPE_WECHAT_GAME_SUB","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","wx","_cc","DEG","SRC_ALPHA_SATURATE","SRC_COLOR","DST_ALPHA","DST_COLOR","ONE_MINUS_SRC_COLOR","ONE_MINUS_DST_ALPHA","ONE_MINUS_DST_COLOR","ONE_MINUS_CONSTANT_ALPHA","ONE_MINUS_CONSTANT_COLOR","ORIENTATION_PORTRAIT","ORIENTATION_LANDSCAPE","ORIENTATION_AUTO","DENSITYDPI_DEVICE","DENSITYDPI_HIGH","DENSITYDPI_MEDIUM","DENSITYDPI_LOW","FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX","DIRECTOR_STATS_POSITION","BATCH_VERTEX_COUNT","ENABLE_TILEDMAP_CULLING","ENABLE_CULLING","none","back","backspace","tab","ctrl","alt","capslock","escape","space","pageup","pagedown","home","down","select","insert","Delete","0","2","3","4","5","6","7","8","9","f","num0","num1","num2","num3","num4","num5","num6","num7","num8","num9","*","+","-","numdel","/","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","numlock","scrolllock",";","semicolon","equal","=",",","comma","dash",".","forwardslash","grave","[","openbracket","backslash","]","closebracket","quote","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter","ImageFormat","JPG","PNG","TIFF","WEBP","PVR","ETC","S3TC","ATITC","TGA","RAWDATA","BOTTOM","Destroyed","DontSave","EditorOnly","Dirty","DontDestroy","PersistentMask","LockedInEditor","IsPositionLocked","IsRotationLocked","IsScaleLocked","IsAnchorLocked","IsSizeLocked","objectsToDestroy","deferredDestroy","deleteCount","_destruct","__destruct__","shouldSkipId","idToSkip","propsToReset","compileDestruct","strictMode","SAXParser","DOMParser","_isSupportDOMParser","_parser","xmlTxt","_parseXML","textxml","xmlDoc","parseFromString","loadXML","PlistParser","childNodes","nodeType","_parseNode","_parseDict","_parseArray","firstChild","nodeValue","saxParser","_supportsFullScreen","_preOnFullScreenChange","_touchEvent","_fn","_fnMap","valL","requestFullscreen","fullScreen","fullscreenElement","requestFullScreen","onFullScreenChange","isBrowser","webkitEnterFullscreen","fullscreenchange","webkitExitFullscreen","exitFullscreen","autoFullScreen","touchTarget","theScreen","LANGUAGE_ENGLISH","LANGUAGE_CHINESE","LANGUAGE_FRENCH","LANGUAGE_ITALIAN","LANGUAGE_GERMAN","LANGUAGE_SPANISH","LANGUAGE_DUTCH","LANGUAGE_RUSSIAN","LANGUAGE_KOREAN","LANGUAGE_JAPANESE","LANGUAGE_HUNGARIAN","LANGUAGE_PORTUGUESE","LANGUAGE_ARABIC","LANGUAGE_NORWEGIAN","LANGUAGE_POLISH","LANGUAGE_TURKISH","LANGUAGE_UKRAINIAN","LANGUAGE_ROMANIAN","LANGUAGE_BULGARIAN","LANGUAGE_UNKNOWN","OS_WINDOWS","OS_MARMALADE","OS_LINUX","OS_BADA","OS_BLACKBERRY","OS_OSX","OS_WP8","OS_WINRT","OS_UNKNOWN","WIN32","LINUX","MACOS","ANDROID","IPHONE","IPAD","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","MOBILE_BROWSER","DESKTOP_BROWSER","EDITOR_PAGE","EDITOR_CORE","WECHAT_GAME","QQ_PLAY","BROWSER_TYPE_WECHAT","BROWSER_TYPE_WECHAT_GAME","BROWSER_TYPE_QQ_PLAY","BROWSER_TYPE_ANDROID","BROWSER_TYPE_IE","BROWSER_TYPE_QQ","BROWSER_TYPE_UCBS","BROWSER_TYPE_BAIDU_APP","BROWSER_TYPE_BAIDU","BROWSER_TYPE_MAXTHON","BROWSER_TYPE_OPERA","BROWSER_TYPE_OUPENG","BROWSER_TYPE_MIUI","BROWSER_TYPE_SAFARI","BROWSER_TYPE_LIEBAO","BROWSER_TYPE_QZONE","BROWSER_TYPE_UNKNOWN","isNative","CC_JSB","nav","doc","docEle","FbPlayableAd","currLanguage","language","browserLanguage","isAndroid","iOS","osVersion","osMainVersion","uaResult","exec","osName","appVersion","OS_UNIX","browserTypes","innerWidth","innerHeight","devicePixelRatio","windowPixelResolution","_checkWebGLRenderMode","_tmpCanvas1","localStorage","setItem","_supportWebp","toDataURL","_supportCanvas","_supportWebGL","WebGLRenderingContext","opengl","supportWebAudio","AudioContext","webkitAudioContext","mozAudioContext","ONLY_ONE","DELAY_CREATE_CTX","ONE_SOURCE","canPlayType","NetworkType","LAN","WWAN","getNetworkType","getBatteryLevel","garbageCollect","restartVM","getSafeAreaRect","visibleSize","getVisibleSize","isObjectValid","dump","str","openURL","initSys","__BrowserGetter","html","getElementsByTagName","availWidth","availHeight","meta","adaptationType","sharedCanvas","getSharedCanvas","_scissorRect","_strategyer","ContainerStrategy","_strategy","ContentStrategy","_frameSize","_visibleRect","_autoFullScreen","_retinaEnabled","_resizeCallback","_resizing","_orientationChanging","_orientation","_isAdjustViewport","_antiAliasEnabled","_rpExactFit","EQUAL_TO_FRAME","EXACT_FIT","_rpShowAll","_rpNoBorder","_rpFixedHeight","_rpFixedWidth","_initFrameSize","enableAntiAlias","_resizeEvent","prevFrameW","prevFrameH","prevRotated","containerStyle","_orientationChange","setResizeCallback","setOrientation","designWidth","designHeight","locFrameSize","isLandscape","transformOrigin","_adjustSizeKeepCanvasSize","_setViewportMeta","metas","overwrite","vp","getElementById","head","elems","getElementsByName","currentVP","RegExp","_adjustViewportMeta","adjustViewportMeta","enableRetina","isRetinaEnabled","ctx","imageSmoothingEnabled","mozImageSmoothingEnabled","isAntiAliasEnabled","setCanvasSize","getCanvasSize","getFrameSize","setFrameSize","getVisibleSizeInPixel","getVisibleOrigin","getVisibleOriginInPixel","getResolutionPolicy","setResolutionPolicy","resolutionPolicy","_locPolicy","preApply","rv","postApply","updateCameraViewport","setRealPixelResolution","setViewportInPoints","locScaleX","locScaleY","setScissorInPoints","ceil","sw","sh","boxArr","SCISSOR_BOX","scissor","isScissorEnabled","SCISSOR_TEST","getScissorRect","scaleXFactor","scaleYFactor","getViewportRect","getScaleX","getScaleY","getDevicePixelRatio","relatedPos","in_out_point","selPoint","selPrePoint","designedResolution","_setupContainer","locCanvas","locContainer","_fixContainer","bs","contStyle","_result","_buildResult","containerW","containerH","contentW","contentH","EqualToFrame","frameH","ProportionalToFrame","frameW","designW","designH","paddingRight","paddingTop","OriginalContainer","PROPORTION_TO_FRAME","ORIGINAL_CONTAINER","ExactFit","ShowAll","NoBorder","FixedHeight","FixedWidth","containerStg","contentStg","_containerStrategy","_contentStrategy","setContainerStrategy","setContentStrategy","topLeft","topRight","bottomLeft","bottomRight","createAttrsSingle","ownerCtor","superAttrs","AttrsCtor","newAttrs","__attrs__","prefix","subclass","superClass","chains","createAttrs","typeCtor","CallbackList","removeBy","cancelAll","callbackListPool","keyOrTarget","_list","p4","p5","flattenCodeArray","strList","deepFlatten","_Deserializer","ignoreEditorOnly","deserializedList","deserializedData","_classFinder","_idList","_idObjList","_idPropList","compileObjectTypeJit","sources","accessorToSet","propNameLiteralToSet","assumeHavePropIfIsValue","ctorCode","jsonObj","jsonArray","refCount","_deserializeObject","idPropList","idList","idObjList","onDereferenced","_dereference","serialized","__deserialize__","compileDeserialize","_deserializeFireClass","_deserializeTypedObject","_deserializeObjField","_deserializePrimitiveObject","__id__","__uuid__","dObj","fastDefinedProps","TYPE","SAVE_URL_AS_ASSET","FORMERLY_SERIALIZED_AS","fastMode","accessorToGet","propNameToRead","isPrimitiveType","userType","defaultType","details","createAssetRefs","tempDetails","deserializer","assignAssetsBy","Editor","asAsset","NonUuidMark","IdGenerater","category","global","Compiler","VAR","LOCAL_OBJ","LOCAL_TEMP_OBJ","DEFAULT_MODULE_CACHE","cc.Node","cc.Label","cc.Button","cc.Widget","cc.Animation","cc.ClickEvent","cc.PrefabInfo","Declaration","varName","mergeDeclaration","writeAssignment","codeArray","Assignments","targetExpression","_exps","_targetExp","equalsToDefault","getPropAccessor","Parser","globalVariablesDeclaration","objsToClear_iN$t","objs","funcs","funcModuleCache","globalVariables","globalVariableId","localVariableId","getFuncModule","_iN$t","globalVar","enumerateObject","code","writeCode","targetVar","pair","usedInNew","clsNameIsModule","getObjRef","setValueType","srcValue","assignments","enumerateField","enumerateCCClass","setObjProp","instantiateArray","arrayVar","source","line","instantiateObj","createCode","isChildOf","CCValueType","_isDomNode","isDomNode","original","internal_force","doInstantiate","objsToClearTmpVar","initValue","tempCIDGenerater","_getPropertyDescriptor","getPrototypeOf","_copyprop","isString","configurable","dunderProto","superclass","tmpValueDesc","enumerable","tmpGetSetDesc","tmpGetDesc","tmpSetDesc","objOrCtor","__classname__","retval","_idToClass","_nameToClass","setup","publicName","table","assign","doSetClassName","unregisterClass","classId","__cid__","classname","allowTempId","obsoleted","newExpr","extractPropName","oldProp","newProp","obsoletes","objName","REGEXP_STR","argLen","REGEXP_NUM_OR_STR","arg","regExpToTest","forceDictMode","cleanupFunc","verifyType","removeArray","minusArr","appendObjectsAt","addObjs","arr_clone","_cleanup","SerializableAttrs","canUsedInGet","parseNotify","newKey","newValue","checkUrl","parseType","isRawAssetType","propname_dev","classname_dev","fullForm","requiringFrames","beh","frameInfo","anyKey","_rawAssets","refNode","otherNode","compareDocumentPosition","RenderComponentWalker","defaultCamera","parentOpacity","worldMatDirty","_commitComp","cam","setTransform","draw","_canvas","rgba","fillStyle","clearRect","_stats","drawcalls","ForwardRenderer","spriteRenderer","labelRenderer","maskRenderer","postMap","addRenderer","postHandler","beforeHandler","afterHandler","bmfontUtils","dataLength","rectHeight","rectWidth","globalAlpha","bmfont","ttfUtils","appy","appx","_updateTexture","dropColorizedImage","drawImage","graphicsHandler","save","restore","simple","tiled","sliced","updateVerts","updateUVs","cw","ch","ow","oh","rw","rh","trimBottom","getColorizedImage","sizableWidth","sizableHeight","xScale","yScale","drawCall","ld","td","getFrameCache","createPattern","fillRect","colorizedFrame","globalCompositeOperation","canvasMgr","canvasMap","canvasPool","checking","check","exist","canvasUsed","startCheck","getCanvas","cacheCanvas","dropImage","cval","generate","drawCalls","_cameraNode","builtins","defaultTexture","WRAP_REPEAT","programTemplates","shaders","templates","programChunks","chunks","_initBuiltins","canvasRenderer","Device","setViewport","ecScene","./canvas","./render-engine","./webgl/assemblers","./webgl/render-component-walker","163","_r2d","EPSILON","toRadian","toDegree","randomRange","INT_BITS","INT_MIN","countTrailingZeros","REVERSE_TABLE","bits_","freeze","INT_MAX","sign","isPow2","log2","log10","popCount","nextPow2","prevPow2","parity","interleave2","deinterleave2","interleave3","deinterleave3","_tmp","toJSON","subtract","divide","scaleAndAdd","squaredDistance","sqrDist","squaredLength","sqrLen","negate","inverse","transformMat2","transformMat23","vec","exactEquals","a0","a1","b0","_tmp$1","hermite","factorTimes2","factor1","factor2","factor4","factor3","inverseFactor","inverseFactorTimesTwo","zScale","qx","qy","qw","qz","iw","tempB","cosine","tempA","a2","_tmp$2","_vec4","vec4","aw","_tmp$3","_mat3","m20","m21","m22","transpose","a01","a02","a12","a00","a10","a11","a20","a22","b01","a21","b21","b11","adjoint","determinant","b00","b02","b10","b12","b20","b22","rotate","rad","fromTranslation","fromRotation","fromScaling","fromMat2d","fromQuat","z2","xx","yx","yy","zx","zy","zz","wz","wy","default_up","normalFromMat4","a03","a13","a23","a30","a31","a33","b03","b04","b05","b06","b07","a32","b08","b09","frob","multiplyScalar","multiplyScalarAndAdd","a4","a5","a6","a7","a8","b5","b6","b7","b8","_tmp$4","rotationTo","tmpvec3","yUnitVec3","xUnitVec3","fromAxisAngle","getAxisAngle","out_axis","bw","rotateAround","q_tmp","axis","v3_tmp","calculateW","omega","cosom","sinom","scale0","scale1","sqlerp","temp2","temp1","invDot","matr","xAxis","yAxis","zAxis","fromMat3","trace","s$1","s$2","s$3","halfToRad","sz","heading","attitude","bank","atan2","sqx","sqy","sqz","_tmp$5","_mat2","mat2","v0","v1","LDU","L","D","U","_tmp$6","_mat23","mat23","array4x4","_tmp$7","_mat4","m23","m30","m31","m32","m33","fromXRotation","fromYRotation","fromZRotation","xy","xz","yz","getTranslation","mat","getScaling","S","fromRTSOrigin","frustum","near","far","rl","nf","tb","perspective","fovy","aspect","perspectiveFromFieldOfView","upTan","upDegrees","downTan","downDegrees","leftTan","leftDegrees","rightTan","rightDegrees","lr","bt","eye","z0","z1","eyex","eyey","eyez","upx","upy","upz","centerx","centerz","centery","a9","a15","b9","b13","b15","_tmp$8","_color3","color3","fromHex","hex","ar","ag","_tmp$9","_color4","color4","bits","approx","maxDiff","clamp","from","to","randomRangeInt","PROJ_ORTHO","LIGHT_DIRECTIONAL","LIGHT_SPOT","SHADOW_NONE","SHADOW_SOFT","PARAM_INT","PARAM_INT2","PARAM_INT3","PARAM_INT4","PARAM_FLOAT","PARAM_FLOAT2","PARAM_FLOAT3","PARAM_FLOAT4","PARAM_COLOR3","PARAM_COLOR4","PARAM_MAT2","PARAM_MAT3","PARAM_MAT4","PARAM_TEXTURE_CUBE","CLEAR_COLOR","CLEAR_DEPTH","_filterGL","_textureFmtGL","internalFormat","pixelType","enums$1","USAGE_STREAM","INDEX_FMT_UINT8","INDEX_FMT_UINT32","ATTR_BITANGENT","ATTR_COLOR1","ATTR_UV","ATTR_UV4","ATTR_UV5","ATTR_UV7","ATTR_TYPE_INT8","ATTR_TYPE_UINT8","ATTR_TYPE_INT16","ATTR_TYPE_UINT16","ATTR_TYPE_INT32","ATTR_TYPE_FLOAT32","FILTER_LINEAR","WRAP_MIRROR","TEXTURE_FMT_RGB_DXT1","TEXTURE_FMT_RGBA_DXT1","TEXTURE_FMT_RGBA_DXT3","TEXTURE_FMT_RGBA_DXT5","TEXTURE_FMT_RGB_ETC1","TEXTURE_FMT_RGB16F","TEXTURE_FMT_RGBA16F","TEXTURE_FMT_RGB32F","TEXTURE_FMT_R32F","TEXTURE_FMT_111110F","TEXTURE_FMT_SRGBA","TEXTURE_FMT_D16","TEXTURE_FMT_D24S8","DS_FUNC_NEVER","DS_FUNC_LESS","DS_FUNC_EQUAL","DS_FUNC_LEQUAL","DS_FUNC_GREATER","DS_FUNC_NOTEQUAL","DS_FUNC_ALWAYS","RB_FMT_RGBA4","RB_FMT_RGB5_A1","RB_FMT_RGB565","BLEND_FUNC_REVERSE_SUBTRACT","BLEND_ZERO","BLEND_ONE","BLEND_SRC_COLOR","BLEND_ONE_MINUS_SRC_COLOR","BLEND_DST_COLOR","BLEND_ONE_MINUS_DST_COLOR","BLEND_SRC_ALPHA","BLEND_ONE_MINUS_SRC_ALPHA","BLEND_DST_ALPHA","BLEND_ONE_MINUS_DST_ALPHA","BLEND_CONSTANT_COLOR","BLEND_ONE_MINUS_CONSTANT_COLOR","BLEND_CONSTANT_ALPHA","BLEND_SRC_ALPHA_SATURATE","STENCIL_OP_KEEP","STENCIL_OP_ZERO","STENCIL_OP_REPLACE","STENCIL_OP_INCR","STENCIL_OP_INCR_WRAP","STENCIL_OP_DECR","STENCIL_OP_INVERT","CULL_NONE","CULL_FRONT","CULL_FRONT_AND_BACK","PT_POINTS","PT_LINE_LOOP","PT_LINE_STRIP","PT_TRIANGLE_STRIP","attrTypeBytes","attrType","ATTR_TYPE_UINT32","mipFilter","glTextureFmt","infos","stream","i$1","len$1","usage","numIndices","_usage","_bytesPerIndex","prototypeAccessors","glUsage","bindBuffer","ELEMENT_ARRAY_BUFFER","bufferSubData","bufferData","defineProperties","numVertices","prototypeAccessors$1","ARRAY_BUFFER","_genID","_parseError","errorLog","parts","fileID","_attributes","_uniforms","_samplers","_errors","_linked","_vertSource","vert","_fragSource","frag","prototypeAccessors$2","_createShader","shader","createShader","compileShader","fragShader","FRAGMENT_SHADER","program","createProgram","attachShader","vertShader","linkProgram","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","failed","getProgramParameter","LINK_STATUS","getProgramInfoLog","numAttributes","ACTIVE_ATTRIBUTES","getAttribLocation","numUniforms","ACTIVE_UNIFORMS","info$1","getActiveUniform","location$1","getUniformLocation","Program","deleteProgram","_anisotropy","_mipFilter","isPow2$1","Texture","deleteTexture","Texture$$1","createTexture","__proto__","genMipmap","anisotropy","activeTexture","TEXTURE0","bindTexture","_setTexInfo","hint","GENERATE_MIPMAP_HINT","NICEST","generateMipmap","glFmt","_setSubImage","updateImage","_setImage","HTMLVideoElement","pixelStorei","UNPACK_FLIP_Y_WEBGL","UNPACK_PREMULTIPLY_ALPHA_WEBGL","texSubImage2D","compressedTexSubImage2D","texImage2D","compressedTexImage2D","pot","WRAP_CLAMP","texParameteri","TEXTURE_MIN_FILTER","glFilter","TEXTURE_MAG_FILTER","TEXTURE_WRAP_T","TEXTURE_MAX_ANISOTROPY_EXT","TextureCube","TEXTURE_CUBE_MAP","TEXTURE_CUBE_MAP_POSITIVE_X","faceIndex","levelImages","face","TEXTURE_WRAP_S","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","deleteRenderbuffer","_colors","_depthStencil","depthStencil","deleteFramebuffer","_default","blend","blendSep","blendColor","blendEq","blendAlphaEq","blendSrc","blendDst","blendDstAlpha","depthTest","depthFunc","stencilTest","stencilSep","stencilFuncFront","stencilRefFront","stencilMaskFront","stencilFailOpFront","stencilZFailOpFront","stencilZPassOpFront","stencilWriteMaskFront","stencilFuncBack","stencilRefBack","stencilMaskBack","stencilFailOpBack","stencilZFailOpBack","stencilWriteMaskBack","cullMode","CULL_BACK","maxStream","vertexBuffers","vertexBufferOffsets","indexBuffer","maxTextureSlot","textureUnits","_caps","maxVertexStreams","maxTextureUnits","initDefault","cpy","i$2","_type2uniformCommit","uniform1i","uniform1f","35664","uniform2fv","35665","uniform3fv","35666","uniform4fv","35667","uniform2iv","35668","uniform3iv","35669","uniform4iv","35670","35671","35672","35673","35674","uniformMatrix2fv","35675","uniformMatrix3fv","35676","uniformMatrix4fv","35678","35680","_type2uniformArrayCommit","attachment","framebufferRenderbuffer","uniform1iv","uniform1fv","preserveDrawingBuffer","canvasEL","_extensions","_initExtensions","_initStates","_current","_next","_vx","_vy","_vw","_vh","_newAttributes","maxVertexAttribs","_enabledAttributes","extensions","vendorPrefixes","getExtension","_initCaps","extDrawBuffers","maxVertexTextures","MAX_VERTEX_TEXTURE_IMAGE_UNITS","maxFragUniforms","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_VERTEX_ATTRIBS","maxDrawBuffers","MAX_DRAW_BUFFERS_WEBGL","disable","BLEND","blendFunc","colorMask","cullFace","BACK","DEPTH_TEST","LESS","depthMask","depthRange","STENCIL_TEST","stencilFunc","stencilOp","KEEP","clearDepth","clearStencil","unit","fb","numColors","_attach","colorBuffer","maxColorAttachments","_stencil","DEPTH_STENCIL_ATTACHMENT","setScissor","_sx","_sy","_sw","_sh","flags","COLOR_BUFFER_BIT","STENCIL_BUFFER_BIT","depthWrite","enableBlend","enableDepthTest","enableDepthWrite","enableStencilTest","setStencilFunc","setStencilFuncFront","setStencilFuncBack","setStencilOp","failOp","zFailOp","zPassOp","writeMask","stencilZPassOpBack","setStencilOpFront","setStencilOpBack","setDepthFunc","setBlendColor32","setBlendColor","setBlendFunc","dst","setBlendFuncSep","srcAlpha","dstAlpha","blendSrcAlpha","setBlendEq","eq","setBlendEqSep","alphaEq","setCullMode","setIndexBuffer","setProgram","slot","setUniform","slots","uniform","cur","blendFuncSeparate","blendEquationSeparate","blendEquation","_commitBlendStates","_commitDepthStates","stencilFuncSeparate","FRONT","stencilMaskSeparate","stencilOpSeparate","stencilMask","_commitStencilStates","CULL_FACE","_commitCullMode","attrsDirty","vbOffset","enableVertexAttribArray","vertexAttribPointer","i$3","disableVertexAttribArray","_commitVertexBuffers","programDirty","useProgram","_commitTextures","uniformInfo","commitFunc","drawElements","pt","_indexBuffer","_count","getPrimitiveCount","_programName","_cullMode","_blend","_blendEq","_blendAlphaEq","_blendSrc","_blendDst","_blendSrcAlpha","_blendColor","_depthTest","_depthWrite","_depthFunc","_stencilTest","_stencilFuncFront","_stencilRefFront","_stencilMaskFront","_stencilFailOpFront","_stencilZFailOpFront","_stencilZPassOpFront","_stencilWriteMaskFront","_stencilFuncBack","_stencilRefBack","_stencilMaskBack","_stencilFailOpBack","_stencilZFailOpBack","_stencilZPassOpBack","Pass","pass","_blendDstAlpha","setStencilFront","stencilRef","stencilFailOp","stencilZFailOp","stencilZPassOp","stencilWriteMask","setStencilBack","disableStencilTest","_name2stageID","addStage","stageID","stageIDs","nameList","_genID$1","layer","_stageIDs","stages","_parameters","parameters","_layer","prototypeAccessors$3","Technique","technique","parameter","Effect","techniques","defines","_techniques","_defines","_properties","stage","tech","getProperty","setProperty","extractDefines","_genID$2","_matView","_matProj","_matInvViewProj","_stages","getForward","_m4_tmp$1","_transformedLightDirection","Light","_intensity","_range","_spotAngle","_spotExp","_directionUniform","_positionUniform","_spotUniform","_shadowType","_shadowFrameBuffer","_shadowMap","_shadowMapDirty","_shadowDepthBuffer","_shadowResolution","_shadowBias","_shadowDarkness","_shadowMinDepth","_shadowMaxDepth","_shadowDepthScale","_frustumEdgeFalloff","_viewProjMatrix","_spotAngleScale","prototypeAccessors$4","intensity","spotAngle","spotExp","shadowType","shadowMap","viewProjMatrix","shadowResolution","shadowBias","shadowDarkness","shadowMinDepth","shadowMaxDepth","shadowDepthScale","frustumEdgeFalloff","_colorUniform","setIntensity","tpe","setSpotAngle","setSpotExp","setRange","setShadowType","setShadowResolution","setShadowBias","setShadowDarkness","setShadowMinDepth","setShadowMaxDepth","setShadowDepthScale","setFrustumEdgeFalloff","extractView","_shadowLight","light","outView","outProj","halfSize","_shadowFustumSize","LIGHT_POINT","_matViewProj","_updateLightPositionAndDirection","_generateShadowMap","_destroyShadowMap","_tmp_v3","_projection","PROJ_PERSPECTIVE","_near","_far","prototypeAccessors$5","getNode","getOrthoHeight","_orthoHeight","getFov","getNear","getFar","getColor","getDepth","getStencil","setStencil","getClearFlags","getStages","getFramebuffer","setFramebuffer","framebuffer","worldToScreen","worldPos","_poolID","_inputAssemblers","_effects","prototypeAccessors$6","inputAssemblerCount","dynamicIA","drawItemCount","setDynamicIA","addInputAssembler","clearInputAssemblers","addEffect","defs","clearEffects","extractDrawItem","_dynamicIA","DEFAULT_MIN_MERGE","POWERS_OF_TEN","log10$1","alphabeticalCompare","bl","al","bStr","aStr","runHi","lo","hi","compare","reverseRun","binaryInsertionSort","pivot","mid","gallopLeft","lastOffset","maxOffset","gallopRight","TimSort","tmpStorageLength","stackLength","runStart","runLength","remaining","makeAscendingRun","ts","minRun","minRunLength","mergeRuns","pushRun","stackSize","mergeAt","start1","length1","length2","start2","mergeLow","mergeHigh","cursor1","cursor2","minGallop","count1","exit","count2","customDest","customCursor","FixedArray","prototypeAccessors$7","_frees","_idx","LinkedArray","_tail","prototypeAccessors$8","tail","_prev","_head","cursor","binder","prototypeAccessors$9","_bufferPools","_lights","_models","_add","_remove","setDebugCamera","getCameraCount","getCamera","getModelCount","getModel","addModel","removeModel","getLightCount","getLight","addLight","removeLight","addView","_views","removeView","_shdID","_replaceMacroNums","def$1","reg","_unrollLoops","begin","snippet","unroll","parsedBegin","parsedEnd","ProgramLib","_precision","_templates","tmpl","_chunks","cnt","_map","_min","getKey","tmplDefs","getProgram","customDef","_generateDefines","_m4_tmp$2","_stageInfos","_float2_pool","_float3_pool","_float4_pool","_float9_pool","_float16_pool","_float64_pool","_int2_pool","_int3_pool","_int4_pool","_int64_pool","_type2uniformValue","_type2uniformArrayValue","_programLib","_opts","_type2defaultValue","PARAM_TEXTURE_2D","defaultTextureCube","_usedTextureUnits","_viewPools","_drawItemsPools","_stageItemsPools","sortKey","Base","_resetTextuerUnit","_registerStage","_requestView","setFrameBuffer","clearOpts","CLEAR_STENCIL","drawItem","stageItems","drawItem$1","getTechnique","stageItem","stageInfo","_stage2fn","programLib","_m3_tmp$1","_allocTextuerUnit","setTextureArray","convertedValue","convertArray","convertFn","setVertexBuffer","_start","createIA","positions","verts","normals","uvs","_a16_view","_a16_viewProj","builtin","_draw","BaseRenderData","_dataPool","BaseRenderData$$1","_indices","_pivotX","_pivotY","updateSizeNPivot","pivotX","pivotY","indiceCount","persist","_loaded","unload","reload","Texture$2","Asset$$1","serializePass","_stencilWriteMaskBack","Material","_texIds","hash","techData","propKey","hashData","serializeDefines","seed","Material$$1","mainTech","_pass","valu","_jointsTextureSize","_jointMatrices","Device$2","_restoreTexture","Texture2D$2","Scene$2","Camera$2","View$2","Texture2D$4","Device$4","InputAssembler$2","Model$2","164","DONOTHING","LOCAL_TRANSFORM","WORLD_TRANSFORM","TRANSFORM","UPDATE_RENDER_DATA","OPACITY","RENDER","CUSTOM_IA_RENDER","CHILDREN","POST_UPDATE_RENDER_DATA","FINAL","_func","_proto","_doNothing","_localTransform","parentOpacityDirty","_render","_customIARender","_commitIA","worldOpacityFlag","worldTransformFlag","flows","_postUpdateRenderData","_postRender","EMPTY_FLOW","createFlow","_worldTransform","POST_RENDER","tFlag","getFlow","walker","FLAG_DONOTHING","FLAG_LOCAL_TRANSFORM","FLAG_POST_UPDATE_RENDER_DATA","FLAG_FINAL","Atlas","_nexty","_innerTextureInfos","insertSpriteFrame","_innerSpriteFrames","_dirty","oriInfo","_atlasIndex","_maxAtlasCount","_textureSize","_maxFrameSize","newAtlas","_atlases","beforeSceneLoad","maxAtlasCount","textureSize","maxFrameSize","showDebug","FontLetterDefinition","_u","_v","_offsetX","_offsetY","_textureID","_validDefinition","FontAtlas","fntConfig","addLetterDefinitions","letter","letterDefinition","_letterDefinitions","cloneLetterDefinition","copyLetterDefinitions","assignLetterDefinitions","scaleFontLetterDefinition","fontDefinition","letterDefinitions","_xAdvance","getLetterDefinitionForChar","char","LetterInfo","_char","_valid","_positionX","_positionY","_tmpRect","_comp","_horizontalKernings","_lettersInfo","_labelDimensions","_numberOfLines","_textDesiredHeight","_letterOffsetY","_tailoredTopY","_tailoredBottomY","_bmfontScale","_originFontSize","_hAlign","_vAlign","_overflow","_isWrapText","_maxLineWidth","_updateContent","_resetProperties","_updateFontScale","_updateProperties","fontDict","fontDefDictionary","fontDef","xOffset","yOffset","xAdvance","_setupBMFontOverflowMetrics","_computeHorizontalKerningForText","_alignText","stringLen","horizontalKernings","kerningAmount","kerningDict","lineIndex","nextTokenY","letterRight","highestY","lowestY","letterPosition","tokenLen","nextTokenFunc","tokenHighestY","tokenLowestY","tokenRight","newLine","letterIndex","letterDef","letterX","nextLetterX","_recordLetterInfo","_recordPlaceholderInfo","atlasName","longestLine","toFixed","_getFirstCharLen","_multilineTextWrapByWord","_multilineTextWrapByChar","tmpInfo","_lineIndex","_computeAlignmentOffset","_isVerticalClamp","_shrinkLabelToContentSize","_updateQuads","_isHorizontalClamp","_scaleFontSizeDown","shouldUpdateContent","lambda","fontAtlas","newFontSize","tempLetterDefinition","originalLineHeight","letterClamp","ctr","letterInfo","_isHorizontalClamped","letterOverClamp","wordWidth","clipTop","_linesOffsetX","trimmedTop","originalX","trimmedLeft","letterPositionX","appendQuad","OUTLINE_SUPPORTED","_fontDesc","_drawFontsize","_splitedStrings","_canvasSize","_isOutlined","_outlineColor","_margin","_sharedLabelData","_canvasPool","assemblerData","_updateFontFamily","_calculateLabelFont","_calculateSplitedStrings","_updateLabelDimensions","_updateVerts","_outlineWidth","_calculateFillTextStartPosition","_getLineHeight","firstLinelabelY","labelX","startPosition","lineJoin","underlineStartPosition","strokeStyle","strokeText","fillText","_calculateUnderlineStartPosition","beginPath","paragraphedStrings","canvasSizeX","canvasSizeY","paraLength","_calculateTextBaseline","vAlign","hAlign","textAlign","textBaseline","canvasWidthNoMargin","allWidth","textFragment","_getFontDesc","nodeSpacingY","paragraphLength","_calculateParagraphLength","canvasHeightNoMargin","startShrinkFontSize","tryDivideByTwo","fillVertices","_quadBuffer","fillVertices3D","_quadBuffer3D","bmfontAssembler","bmfontAssembler3D","labelAssembler","ttfAssembler3D","ttfAssembler","StencilManager","graphicsAssembler","_stencilMgr","sharedManager","maskFrontAssembler","spriteAssembler","enterLevel","maskEndAssembler","front","fillVerticesWithoutCalc","fillEnd","updateWorldVerts","textureRect","ul","quadUV0","quadUV1","quadUV2","quadUV3","quadUV4","quadUV5","quadUV6","quadUV7","progressEnd","local","world","_meshBuffer","vertexId","vertexOffset","ibuf","_iData","indiceOffset","triangles","vertice","contentWidth","contentHeight","originalWidth","originalHeight","trimY","_vertice","trimX","_meshBuffer3D","PI_2","_vertPos","_vertices","_uvs","_intersectPoint_1","_intersectPoint_2","_triangles","_calcInsectedPoints","intersectPoints","sinAngle","cosAngle","tanAngle","cotAngle","yleft","yright","xtop","xbottom","_getVertAngle","placementX","placementY","_generateTriangle","vert0","vert1","vert2","v0x","v0y","v1y","_generateUV","v1x","progressX","progressY","px1","px2","py1","py2","_center","_calculateVertices","u0","_calculateUVs","triangleIndex","startAngle","endAngle","testIndex","vbuf","_vData","data0","data3","vl","vr","vt","br","ct","db","uintbuf","trimRight","colorOffset","hRepeat","vRepeat","yindex","ylength","xindex","xlength","uvOffset","offset1","offset2","offset3","offset4","coefu","coefv","vertexOffsetU","vertexOffsetV","fillVerticesWithoutCalc3D","vec3_temp","vec3_temps","vertex","simpleRenderUtil","slicedRenderUtil","tiledRenderUtil","radialFilledRenderUtil","meshRenderUtil","simpleRenderUtil3D","slicedRenderUtil3D","tiledRenderUtil3D","radialFilledRenderUtil3D","meshRenderUtil3D","util","barFilledRenderUtil3D","barFilledRenderUtil","../../../../components/CCSprite","./2d/bar-filled","./2d/mesh","./2d/radial-filled","./2d/simple","./2d/sliced","./2d/tiled","./3d/bar-filled","./3d/mesh","./3d/radial-filled","./3d/simple","./3d/sliced","./3d/tiled","189","_uintVData","190","MeshBuffer","byteStart","indiceStart","_vertexBytes","_vb","_ib","_renderer","_initIDataCount","_reallocBuffer","uploadData","indicesData","vertexsData","requestStatic","indiceLength","_initVDataCount","_reallocVData","_reallocIData","copyOldData","oldVData","newData","oldIData","iData","vertexStart","QuadBuffer","_fillQuadBuffer","vertextID","defaultVertexFormat","vfmtPosUvColor","vfmt3D","empty_material","renderScene","_renderScene","walking","_iaPool","_modelPool","getBuffer","_batchedModels","_sortKey","models","handleEffect","iaRenderData","renderIA","vertextFormat","Stage","CLEAR","ENTER_LEVEL","ENABLED","_maxLevel","_maskStack","getStencilRef","getWriteMask","pushMask","enableMask","exitMask","getExitWriteMask","getInvertedRef","vfmtPosUv","vfmtPosColor","EXTNAME_RE","NORMALIZE_RE","pathStr","mainFileName","fileName","baseName","DIRNAME_RE","changeExtname","tempStr","changeBasename","isSameExt","oldUrl","sep","AffineTransform","transformVec2","transOrY","transformSize","transformRect","ol","ob","or","ot","lbx","lby","rbx","rby","ltx","lty","rty","minX","rtx","minY","transformObb","out_bl","out_tl","out_tr","out_br","anAffineTransform","xa","getConstructor","findComponent","findComponents","_comp2","_level","_onSetParent","siblingIndex","oldIndex","walk","prefunc","postfunc","afterChildren","_stacks","_stackId","removeAllChildren","findChildComponent","findChildComponents","_checkMultipleComp","_RFpeek","ReqComp","_addComponentAt","removeComponent","_getDependComponent","destroyAllChildren","newParent","shouldActiveNow","thisPrefabInfo","_registerIfAttached","destroyByParent","childIndex","propertyDefine","Base64Values","BASE64_VALUES","HexChars","UuidTemplate","Indices","isFinite","base64","lhs","rhs","referenceNode","subChild","eventRegx","HtmlTextParser","_parsedObject","_specialSymbolArray","htmlString","_stack","tagBeginIndex","_processResult","tagEndIndex","_addToStack","nextSpace","eventObj","eventHanlderString","attribute","_processEventHandler","isNewLine","_resultObjectArray","remainingArgument","imageAttrReg","isValidImageTag","tagValue","toLocaleLowerCase","defaultOutlineObject","outlineAttrReg","eventString","eventNames","isValidTag","eventValue","_attributeToObject","previousTagObj","_escapeSpecialSymbol","mat4Pool","quatPool","sameNameGetSets","diffNameGetSets","np","getterFunc","suffix","NextPOT","min_inclusive","max_inclusive","degreesToRadians","radiansToDegrees","_PrefabInfo","fileId","_globalZOrder","PerfCounter","_label","_rootNode","leftLabel","rightLabel","generateNode","_counter","afterUpdate","afterDraw","stat","_showFPS","beforeUpdate","commonHeight","dict","measureText","average","below","draws","logic","generateStats","../../platform/CCMacro","./perf-counter","208","Counter","_value","_averageValue","_accumValue","_accumSamples","_average","_accumStart","human","alarm","over","tick","label_wordRex","label_symbolRex","label_lastWordRex","label_lastEnglish","label_wrapinspection","metric","wrappedWords","fuzzyLen","tmpText","pushNum","checkWhile","sLine","sText","label_firstEnglish","cacheImage","DefaultColors","MAGENTA","colorName","other","getR","setR","getG","setG","getB","setB","getA","setA","opt","toHEX","hexString","toRGBValue","fromHSV","toHSV","hsv","Mat4","fuzzyEquals","mulScalar","number","euler","fromMinMax","min_x","min_y","intersects","maxax","maxay","maxbx","maxby","intersection","rectB","axMin","ayMin","axMax","ayMax","bxMin","byMin","bxMax","byMax","containsRect","ah","bh","variance","addSelf","subSelf","mulSelf","scaleSelf","divSelf","negSelf","neg","magSqr","normalizeSelf","invsqrt","magSqr2","magSqr1","theta","signAngle","radians","rotateSelf","project","CCSpriteFrame","TiledMapAsset","tmxXmlStr","textureNames","tsxFiles","poolHandlerComp","NodePool","_global","./cocos2d","./cocos2d/core/predefine","./extends","./package","./polyfill/array","./polyfill/misc","./polyfill/object","./polyfill/string","./polyfill/typescript","./predefine","228","229","Timer","_timerTable","230","getOwnPropertyDescriptors","descriptors","ownKeys","getOwnPropertySymbols","231","searchString","232","extendStatics","setPrototypeOf","__extends","__","__assign","__rest","__decorate","decorators","Reflect","__param","paramIndex","decorator","__metadata","metadataKey","metadataValue","metadata","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","rejected","done","then","__generator","_","sent","trys","ops","verb","throw","return","Symbol","op","TypeError","__exportStar","__values","__read","__spread","__await","__asyncGenerator","asyncIterator","fulfill","settle","__asyncDelegator","__asyncValues","defineMacro","CC_BUILD","CC_PREVIEW","CC_WECHATGAME_SUB","CC_WECHATGAMESUB","CC_WECHATGAME","CC_RUNTIME","CC_SUPPORT_JIT"],"mappings":"CAWA,SAAAA,EAAAC,EAAAC,GACA,SAAAC,EAAAC,EAAAC,GACA,IAAAC,EAAAL,EAAAG,GACA,IAAAE,EAAA,CACA,IAAAC,EAAAP,EAAAI,GACA,IAAAG,EAEA,OAEA,IAAAC,KACAF,EAAAL,EAAAG,IAAAI,QAAAA,GACAD,EAAA,GAAA,SAAAE,GACA,OAAAN,EAAAI,EAAA,GAAAE,IAAAA,IACAH,EAAAE,GAEA,OAAAF,EAAAE,QAEA,IAAA,IAAAE,EAAA,EAAAA,EAAAR,EAAAS,OAAAD,IAAAP,EAAAD,EAAAQ,KAjBA,EAsBAE,GAAA,SAAAC,EAAAP,EAAAE,GCNAK,EAAQ,4BACR,IAAMC,EAAOD,EAAQ,sBAWrBE,GAAGC,OAASD,GAAGE,OACXb,KAAM,YAINc,KAAK,WACDC,KAAKC,eAAiB,KACtBD,KAAKE,OAAS,KACdF,KAAKG,IAAMP,GAAGC,OAAOO,aAWzBC,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGC,OAIpB,OAHAS,EAAOL,eAAiB,KACxBK,EAAOJ,OAAS,KAChBI,EAAOH,IAAMH,KAAKG,IACXG,GAUXC,OAAO,WACH,OAAO,GAIXC,gBAAgB,SAAUN,GACtBF,KAAKC,eAAiBC,EACtBF,KAAKE,OAASA,GAIlBO,KAAK,WACDT,KAAKE,OAAS,MAIlBQ,KAAK,SAAUC,GACXf,GAAGgB,MAAM,OAIbC,OAAO,SAAUF,GACbf,GAAGgB,MAAM,OASbE,UAAU,WACN,OAAOd,KAAKE,QAShBa,UAAU,SAAUb,GAChBF,KAAKE,OAASA,GASlBc,kBAAkB,WACd,OAAOhB,KAAKC,gBAMhBgB,kBAAkB,SAAUhB,GACxBD,KAAKC,eAAiBA,GAS1BiB,OAAO,WACH,OAAOlB,KAAKG,KAShBgB,OAAO,SAAUhB,GACbH,KAAKG,IAAMA,GAMfiB,OAAO,aAMPC,QAAQ,eAaZzB,GAAGC,OAAOO,aAAe,EAezBR,GAAG0B,iBAAmB1B,GAAGE,OACrBb,KAAM,sBACNsC,QAAS3B,GAAGC,OAEZE,KAAK,WAEDC,KAAKwB,UAAY,GASrBC,YAAY,WACR,OAAOzB,KAAKwB,WAAaxB,KAAK0B,iBAAmB,IASrDC,YAAY,SAAUC,GAClB5B,KAAKwB,UAAYI,GAcrBC,QAAQ,WAEJ,OADAjC,GAAGgB,MAAM,MACF,MAWXP,MAAM,WACF,OAAO,IAAIT,GAAG0B,oBAoBtB1B,GAAGkC,MAAQlC,GAAGE,OACVb,KAAM,WACNsC,QAAS3B,GAAGC,OAEZE,KAAK,SAAUO,EAAQyB,GACnB/B,KAAKgC,OAAS,EACdhC,KAAKiC,aAAe,KAE1B3B,GAAUN,KAAKkC,eAAe5B,EAAQyB,IAUpCI,SAAS,WACL,OAAOnC,KAAKgC,QAQhBI,SAAS,SAAUL,GACf/B,KAAKgC,OAASD,GAUlBG,eAAe,SAAU5B,EAAQyB,GAC7B,OAAKzB,GAKLN,KAAKiC,aAAe3B,EACpBN,KAAKgC,OAASD,GACP,IANHnC,GAAGyC,QAAQ,OACJ,IAQfhC,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGkC,MAEpB,OADAxB,EAAO4B,eAAelC,KAAKiC,aAAa5B,QAASL,KAAKgC,QAC/C1B,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGC,OAAOyC,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAC/CF,KAAKiC,aAAazB,gBAAgBN,IAGtCO,KAAK,WACDT,KAAKiC,aAAaxB,OAClBb,GAAGC,OAAOyC,UAAU7B,KAAK8B,KAAKvC,OAGlCU,KAAK,SAAUC,GACXX,KAAKiC,aAAavB,KAAKC,EAAKX,KAAKgC,SAGrCzB,OAAO,WACH,OAAOP,KAAKiC,aAAa1B,UAG7BsB,QAAQ,WACJ,OAAO,IAAIjC,GAAGkC,MAAM9B,KAAKiC,aAAaJ,UAAW7B,KAAKgC,SAQ1DQ,eAAe,SAAUlC,GACjBN,KAAKiC,eAAiB3B,IACtBN,KAAKiC,aAAe3B,IAS5BmC,eAAe,WACX,OAAOzC,KAAKiC,gBAyBpBrC,GAAGmC,MAAQ,SAAUzB,EAAQyB,GACzB,OAAO,IAAInC,GAAGkC,MAAMxB,EAAQyB,IA8BhCnC,GAAG8C,OAAS9C,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAGC,OASZE,KAAK,SAAU4C,EAAcC,GAEzB5C,KAAK6C,cAAgB,KAErB7C,KAAK8C,cAAe,EAEpB9C,KAAK+C,uBAAwB,EAE7B/C,KAAKgD,gBAAkB,KACvBhD,KAAKiD,gBAAkB,KAEvBjD,KAAKkD,aAAe,EACpBlD,KAAKmD,cAAgB,EACrBnD,KAAKoD,YAAc,EACnBpD,KAAKqD,eAAiB,EACtBrD,KAAKsD,WAAa1D,GAAGgD,KAAK,EAAG,EAAG,EAAG,GAEtCD,IACFC,EAAO5C,KAAKuD,eAAeZ,EAAcC,GACrC5C,KAAKuD,eAAeZ,KAGvBtC,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG8C,OAChBc,EAAUxD,KAAKsD,WACfV,EAAO,IAAIhD,GAAG6D,KAAKD,EAAQlE,EAAGkE,EAAQE,EAAGF,EAAQG,MAAOH,EAAQI,QAEpE,OADAtD,EAAOiD,eAAevD,KAAK6C,cAAeD,GACnCtC,GAQXuD,cAAc,WACV,OAAO7D,KAAK8C,cAQhBgB,cAAc,SAAUC,GACpB/D,KAAK8C,aAAeiB,GAUxBR,eAAe,SAAUZ,EAAcC,GACnC,IAAKD,EAED,OADA/C,GAAGyC,QAAQ,OACJ,EAIXO,EAAOA,GAAQhD,GAAGgD,KAAK,EAAG,EAAG,EAAG,GADpB5C,KAEN6C,cAAgBF,EAFV3C,KAGNsD,WAAaV,EAHP5C,KAKN8C,eAAgC,IAAfF,EAAKe,OAA+B,IAAhBf,EAAKgB,QALpC5D,KAON+C,uBAAwB,EAE9B,IAAIiB,EAAUpE,GAAGoE,QAwBjB,OAjCYhE,KAUNiD,gBAAkBrD,GAAGqE,GAAGD,EAAQL,MAAOK,EAAQJ,QAVzC5D,KAWNgD,gBAXMhD,KAWkBiD,gBAAgBiB,IAAI,IAXtClE,KAaF8C,eAbE9C,KAcFkD,eAAkBN,EAAKtD,EAAIsD,EAAKe,MAd9B3D,KAc6CiD,gBAAgB3D,GAd7DU,KAeFmD,eAAiBP,EAAKtD,EAfpBU,KAgBFoD,aAAeR,EAAKc,EAhBlB1D,KAiBFqD,iBAAoBT,EAAKc,EAAId,EAAKgB,OAjBhC5D,KAiBgDiD,gBAAgBS,GAjBhE1D,KAmBEmD,cAnBFnD,KAmBwBkD,eAnBxBlD,KAsBEmD,cAtBFnD,KAsBwBkD,cAtBxBlD,KAsB8CkD,aAtB9ClD,KAsBmEmD,eAAiB,GAtBpFnD,KAwBEoD,YAxBFpD,KAwBsBqD,iBAxBtBrD,KA2BEoD,YA3BFpD,KA2BsBqD,gBA3BtBrD,KA2B8CoD,YA3B9CpD,KA2BkEqD,gBAAkB,GA3BpFrD,KA8BGoD,cA9BHpD,KA8ByBqD,gBA9BzBrD,KA8BmDkD,eA9BnDlD,KA8B0EmD,gBA9B1EnD,KA+BE+C,uBAAwB,KAE/B,GAGXrC,KAAK,SAAUC,GACX,IAAIwD,EAAiBnE,KAAKE,OAAOkE,sBAAsBxE,GAAGyE,KAAKC,MAC3DC,EAAmBvE,KAAK6C,cAAcuB,sBAAsBxE,GAAGyE,KAAKC,MAEpEE,EAAQL,EAAeM,IAAIF,GAC3BG,EAAU1E,KAAKE,OAAOyE,OAAOC,qBAAqBJ,EAAMK,IAAI7E,KAAKgD,kBAErE,GAAIhD,KAAK8C,aAAc,CAEnB,GAAI9C,KAAK+C,sBACL,OAEP/C,KAAKE,OAAO4E,YAAYnF,EAAKoF,OAAOL,EAAQpF,EAAGU,KAAKkD,aAAclD,KAAKmD,eAAgBxD,EAAKoF,OAAOL,EAAQhB,EAAG1D,KAAKqD,eAAgBrD,KAAKoD,mBAErIpD,KAAKE,OAAO4E,YAAYJ,EAAQpF,EAAGoF,EAAQhB,IAInDnD,OAAO,WACH,OAAUP,KAAK6C,cAAcmC,mBAGjCvE,KAAK,WACDT,KAAKE,OAAS,KACdN,GAAGC,OAAOyC,UAAU7B,KAAK8B,KAAKvC,SAqBtCJ,GAAGqF,OAAS,SAAUtC,EAAcC,GAChC,OAAO,IAAIhD,GAAG8C,OAAOC,EAAcC,mFC3evC,SAASsC,EAAmBC,EAAeC,GAEvC,OAAOD,EADCE,KAAKC,IAAIH,EAAc3F,OAAS,EAAG6F,KAAKE,IAAIH,EAAK,KAI7D,SAASI,EAAsBL,GAE3B,IADA,IAAIM,KACKlG,EAAI4F,EAAc3F,OAAS,EAAGD,GAAK,EAAGA,IAC3CkG,EAASC,KAAK9F,GAAGqE,GAAGkB,EAAc5F,GAAGD,EAAG6F,EAAc5F,GAAGmE,IAE7D,OAAO+B,EAGX,SAASE,EAAoBR,GAEzB,IADA,IAAIM,KACKlG,EAAI,EAAGA,EAAI4F,EAAc3F,OAAQD,IACtCkG,EAASC,KAAK9F,GAAGqE,GAAGkB,EAAc5F,GAAGD,EAAG6F,EAAc5F,GAAGmE,IAC7D,OAAO+B,EAmBX7F,GAAGgG,iBAAmBhG,GAAGE,OACrBb,KAAM,sBACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAM,SAAU6B,EAAUkE,EAAQC,GAE9B/F,KAAKgG,WACLhG,KAAKiG,QAAU,EACfjG,KAAKkG,SAAW,EAChBlG,KAAKmG,kBAAoB,KACzBnG,KAAKoG,iBAAmB,UACZC,IAAZN,GAAyBnG,GAAGgG,iBAAiBtD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,EAAUkE,EAAQC,IAGzGO,iBAAiB,SAAU1E,EAAUkE,EAAQC,GACzC,OAAKD,GAA4B,IAAlBA,EAAOtG,SAKlBI,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACxD5B,KAAKuG,UAAUT,GACf9F,KAAKkG,SAAWH,GACT,IAPPnG,GAAGyC,QAAQ,OACJ,IAWfhC,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGgG,iBAEpB,OADAtF,EAAOgG,iBAAiBtG,KAAKwB,UAAWmE,EAAmB3F,KAAKgG,SAAUhG,KAAKkG,UACxE5F,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAEvDF,KAAKiG,QAAU,GAAKjG,KAAKgG,QAAQxG,OAAS,GAC1CQ,KAAKmG,kBAAoBvG,GAAGqE,GAAGjE,KAAKE,OAAOZ,EAAGU,KAAKE,OAAOwD,GAC1D1D,KAAKoG,iBAAmBxG,GAAGqE,GAAG,EAAG,IAGrCpD,OAAO,SAAUF,GAEb,IAAI6F,EAAGC,EADP9F,EAAKX,KAAK0G,iBAAiB/F,GAE3B,IAAIgG,EAAK3G,KAAKgG,QAKd,GAAW,IAAPrF,EACA6F,EAAIG,EAAGnH,OAAS,EAChBiH,EAAK,MACF,CACH,IAAIG,EAAQ5G,KAAKiG,QAEjBQ,GAAM9F,EAAKiG,GADXJ,EAAI,EAAK7F,EAAKiG,IACUA,EAG5B,IAQQC,EAAOC,EARXC,EAzHZ,SAA2BC,EAAIC,EAAIC,EAAIC,EAAIpB,EAASqB,GAChD,IAAIC,EAAKD,EAAIA,EACTE,EAAKD,EAAKD,EAKVG,GAAK,EAAIxB,GAAW,EAEpByB,EAAKD,GAAa,EAAIF,EAAVC,EAAiBF,GAC7BK,EAAKF,IAAMD,EAAKD,IAAO,EAAIC,EAAK,EAAID,EAAK,GACzCK,EAAKH,GAAKD,EAAK,EAAID,EAAKD,KAAO,EAAIE,EAAK,EAAID,GAC5CM,EAAKJ,GAAKD,EAAKD,GAEf/H,EAAK0H,EAAG1H,EAAIkI,EAAKP,EAAG3H,EAAImI,EAAKP,EAAG5H,EAAIoI,EAAKP,EAAG7H,EAAIqI,EAChDjE,EAAKsD,EAAGtD,EAAI8D,EAAKP,EAAGvD,EAAI+D,EAAKP,EAAGxD,EAAIgE,EAAKP,EAAGzD,EAAIiE,EACpD,OAAO/H,GAAGqE,GAAG3E,EAAGoE,GAyGCkE,CACT1C,EAAkByB,EAAIH,EAAI,GAC1BtB,EAAkByB,EAAIH,EAAI,GAC1BtB,EAAkByB,EAAIH,EAAI,GAC1BtB,EAAkByB,EAAIH,EAAI,GAC1BxG,KAAKkG,SAAUO,GAEnB,GAAI7G,GAAGiI,MAAMC,2BAETjB,EAAQ7G,KAAKE,OAAOZ,EAAIU,KAAKmG,kBAAkB7G,EAC/CwH,EAAQ9G,KAAKE,OAAOwD,EAAI1D,KAAKmG,kBAAkBzC,EACjC,IAAVmD,GAAyB,IAAVC,GAAa,CAC5B,IAAIiB,EAAa/H,KAAKoG,iBACtBS,EAAQkB,EAAWzI,EAAIuH,EACvBC,EAAQiB,EAAWrE,EAAIoD,EACvBiB,EAAWzI,EAAIuH,EACfkB,EAAWrE,EAAIoD,EACfC,EAAOzH,GAAKuH,EACZE,EAAOrD,GAAKoD,EAGpB9G,KAAKgI,eAAejB,IAGxBlF,QAAQ,WACJ,IAAIoG,EAAgBzC,EAAqBxF,KAAKgG,SAC9C,OAAOpG,GAAGsI,iBAAiBlI,KAAKwB,UAAWyG,EAAejI,KAAKkG,WAQnE8B,eAAe,SAAUjB,GACrB/G,KAAKE,OAAO4E,YAAYiC,GACxB/G,KAAKmG,kBAAoBY,GAQ7BoB,UAAU,WACN,OAAOnI,KAAKgG,SAQhBO,UAAU,SAAUT,GAChB9F,KAAKgG,QAAUF,KAiBvBlG,GAAGsI,iBAAmB,SAAUtG,EAAUkE,EAAQC,GAC9C,OAAO,IAAInG,GAAGgG,iBAAiBhE,EAAUkE,EAAQC,IAkBrDnG,GAAGwI,iBAAmBxI,GAAGE,OACrBb,KAAM,sBACNsC,QAAS3B,GAAGgG,iBAEZ7F,KAAK,SAAU6B,EAAUkE,EAAQC,GAC7B/F,KAAKqI,eAAiBzI,GAAGqE,GAAG,EAAG,QACnBoC,IAAZN,GAAyB/F,KAAKsG,iBAAiB1E,EAAUkE,EAAQC,IAGrEvF,gBAAgB,SAAUN,GACtBN,GAAGgG,iBAAiBtD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACzDF,KAAKqI,eAAe/I,EAAIY,EAAOZ,EAC/BU,KAAKqI,eAAe3E,EAAIxD,EAAOwD,GAGnC7B,QAAQ,WAOJ,IANA,IACIyG,EADAC,EAAavI,KAAKgG,QAAQwC,QAK1BhC,EAAI+B,EAAW,GACVhJ,EAAI,EAAGA,EAAIgJ,EAAW/I,SAAUD,EACrC+I,EAAUC,EAAWhJ,GACrBgJ,EAAWhJ,GAAK+I,EAAQ7D,IAAI+B,GAC5BA,EAAI8B,EAIR,IAAIG,EAAejD,EAAqB+C,GAGxC/B,EAAIiC,EAAcA,EAAajJ,OAAS,GACxCiJ,EAAaC,MAEblC,EAAElH,GAAKkH,EAAElH,EACTkH,EAAE9C,GAAK8C,EAAE9C,EAET+E,EAAaE,QAAQnC,GACrB,IAASjH,EAAI,EAAGA,EAAIkJ,EAAajJ,SAAUD,GACvC+I,EAAUG,EAAalJ,IACfD,GAAKgJ,EAAQhJ,EACrBgJ,EAAQ5E,GAAK4E,EAAQ5E,EACrB4E,EAAQhJ,GAAKkH,EAAElH,EACfgJ,EAAQ5E,GAAK8C,EAAE9C,EACf+E,EAAalJ,GAAK+I,EAClB9B,EAAI8B,EAER,OAAO1I,GAAGgJ,iBAAiB5I,KAAKwB,UAAWiH,EAAczI,KAAKkG,WAQlE8B,eAAe,SAAUjB,GACrB,IAAI3B,EAAMpF,KAAKqI,eACXQ,EAAO9B,EAAOzH,EAAI8F,EAAI9F,EACtBwJ,EAAO/B,EAAOrD,EAAI0B,EAAI1B,EAC1B1D,KAAKmG,kBAAkB7G,EAAIuJ,EAC3B7I,KAAKmG,kBAAkBzC,EAAIoF,EAC3B9I,KAAKE,OAAO4E,YAAY+D,EAAMC,IAGlCzI,MAAM,WACF,IAAI0I,EAAI,IAAInJ,GAAGwI,iBAEf,OADAW,EAAEzC,iBAAiBtG,KAAKwB,UAAWmE,EAAmB3F,KAAKgG,SAAUhG,KAAKkG,UACnE6C,KAcfnJ,GAAGgJ,iBAAmB,SAAUhH,EAAUkE,EAAQC,GAC9C,OAAO,IAAInG,GAAGwI,iBAAiBxG,EAAUkE,EAAQC,IAkBrDnG,GAAGoJ,aAAepJ,GAAGE,OACjBb,KAAM,kBACNsC,QAAS3B,GAAGgG,iBAEZ7F,KAAM,SAASY,EAAImF,GACfA,GAAU9F,KAAKsG,iBAAiB3F,EAAImF,IAGxCQ,iBAAiB,SAAU3F,EAAImF,GAC3B,OAAOlG,GAAGgG,iBAAiBtD,UAAUgE,iBAAiB/D,KAAKvC,KAAMW,EAAImF,EAAQ,KAGjFzF,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGoJ,aAEpB,OADA1I,EAAOgG,iBAAiBtG,KAAKwB,UAAWmE,EAAmB3F,KAAKgG,UACzD1F,KAefV,GAAGqJ,aAAe,SAAUtI,EAAImF,GAC5B,OAAO,IAAIlG,GAAGoJ,aAAarI,EAAImF,IAkBnClG,GAAGsJ,aAAetJ,GAAGE,OACjBb,KAAM,kBACNsC,QAAS3B,GAAGwI,iBAEZrI,KAAM,SAASY,EAAImF,GACfA,GAAU9F,KAAKsG,iBAAiB3F,EAAImF,IAGxCQ,iBAAiB,SAAU3F,EAAImF,GAC3B,OAAOlG,GAAGgG,iBAAiBtD,UAAUgE,iBAAiB/D,KAAKvC,KAAMW,EAAImF,EAAQ,KAGjFzF,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGsJ,aAEpB,OADA5I,EAAOgG,iBAAiBtG,KAAKwB,UAAWmE,EAAmB3F,KAAKgG,UACzD1F,KAcfV,GAAGuJ,aAAe,SAAUxI,EAAImF,GAC5B,OAAO,IAAIlG,GAAGsJ,aAAavI,EAAImF,4BClZnClG,GAAGwJ,OAAS,SAAUC,GAClB,OACIC,MAAOD,EACPE,OAAQ,SAAU5I,GACd,OAAO0E,KAAKmE,IAAI7I,EAAIX,KAAKsJ,QAE7BzH,QAAS,WACL,OAAOjC,GAAGwJ,OAAO,EAAIpJ,KAAKsJ,UAgBtC1J,GAAG6J,QAAU,SAAUJ,GACnB,OACIC,MAAOD,EACPE,OAAQ,SAAU5I,GACd,OAAO0E,KAAKmE,IAAI7I,EAAI,EAAIX,KAAKsJ,QAEjCzH,QAAS,WACL,OAAOjC,GAAG6J,QAAQ,EAAIzJ,KAAKsJ,UAiBvC1J,GAAG8J,UAAY,SAAUL,GACrB,OACIC,MAAOD,EACPE,OAAQ,SAAU5I,GAEd,OADAA,GAAM,GACG,EACE,GAAM0E,KAAKmE,IAAI7I,EAAIX,KAAKsJ,OAExB,EAAM,GAAMjE,KAAKmE,IAAI,EAAI7I,EAAIX,KAAKsJ,QAEjDzH,QAAS,WACL,OAAOjC,GAAG8J,UAAU1J,KAAKsJ,UAmBrC,IAAIK,GACAJ,OAAQ,SAAS5I,GACb,OAAc,IAAPA,EAAW,EAAI0E,KAAKmE,IAAI,EAAG,IAAM7I,EAAK,KAEjDkB,QAAS,WACL,OAAO+H,IAGfhK,GAAGiK,kBAAoB,WACnB,OAAOF,GAiBX,IAAIC,GACAL,OAAQ,SAAS5I,GACb,OAAc,IAAPA,EAAW,EAAgC,EAAzB0E,KAAKmE,IAAI,GAAI,GAAK7I,IAE/CkB,QAAS,WACL,OAAO8H,IAGf/J,GAAGkK,mBAAqB,WACpB,OAAOF,GAiBX,IAAIG,GACAR,OAAQ,SAAS5I,GACb,OAAW,IAAPA,GAAmB,IAAPA,GACZA,GAAM,GACG,EACE,GAAM0E,KAAKmE,IAAI,EAAG,IAAM7I,EAAK,IAE7B,IAAsC,EAA9B0E,KAAKmE,IAAI,GAAI,IAAM7I,EAAK,KAExCA,GAEXkB,QAAS,WACL,OAAOkI,IAGfnK,GAAGoK,qBAAuB,WACtB,OAAOD,GAiBX,IAAIE,GACAV,OAAQ,SAAS5I,GACb,OAAa,IAALA,GAAe,IAALA,EAAUA,GAAM,EAAI0E,KAAK6E,IAAIvJ,EAAK0E,KAAK8E,GAAK,GAAK,GAEvEtI,QAAS,WACL,OAAOuI,IAGfxK,GAAGyK,WAAa,WACZ,OAAOJ,GAiBX,IAAIG,GACAb,OAAQ,SAAS5I,GACb,OAAa,IAALA,GAAe,IAALA,EAAUA,EAAK0E,KAAKiF,IAAI3J,EAAK0E,KAAK8E,GAAK,IAE7DtI,QAAS,WACL,OAAOoI,IAGfrK,GAAG2K,YAAc,WACb,OAAOH,GAiBX,IAAII,GACAjB,OAAQ,SAAS5I,GACb,OAAe,IAAPA,GAAmB,IAAPA,EAAYA,GAAM,IAAO0E,KAAK6E,IAAI7E,KAAK8E,GAAKxJ,GAAM,IAE1EkB,QAAS,WACL,OAAO2I,IAGf5K,GAAG6K,cAAgB,WACf,OAAOD,GAwBX,IAAIE,GACAnB,OAAO,SAAS5I,GACZ,OAAW,IAAPA,GAAmB,IAAPA,EACLA,GACXA,GAAU,GACF0E,KAAKmE,IAAI,EAAG,GAAK7I,GAAM0E,KAAKiF,KAAK3J,EAAM,MAAY0E,KAAK8E,GAAK,EAAI,MAE5EtI,QAAQ,WACJ,OAAO8I,IAGhB/K,GAAGgL,cAAgB,SAAUC,GACzB,OAAGA,GAAqB,KAAXA,GAELC,QAASD,EACTtB,OAAQ,SAAU5I,GACd,OAAW,IAAPA,GAAmB,IAAPA,EACLA,GACXA,GAAU,GACF0E,KAAKmE,IAAI,EAAG,GAAK7I,GAAM0E,KAAKiF,KAAK3J,EAAMX,KAAK8K,QAAU,GAAMzF,KAAK8E,GAAK,EAAInK,KAAK8K,WAE3FjJ,QAAQ,WACJ,OAAOjC,GAAGmL,eAAe/K,KAAK8K,WAInCJ,GAoBX,IAAIC,GACApB,OAAQ,SAAU5I,GACd,OAAe,IAAPA,GAAmB,IAAPA,EAAYA,EAAK0E,KAAKmE,IAAI,GAAI,GAAK7I,GAAM0E,KAAKiF,KAAK3J,EAAM,MAAY0E,KAAK8E,GAAK,EAAI,IAAO,GAElHtI,QAAQ,WACJ,OAAO6I,IAkEf,SAASM,EAAaC,GAClB,OAAIA,EAAQ,EAAI,KACL,OAASA,EAAQA,EACjBA,EAAQ,EAAI,KAEZ,QADPA,GAAS,IAAM,MACSA,EAAQ,IACzBA,EAAQ,IAAM,KAEd,QADPA,GAAS,KAAO,MACQA,EAAQ,MAI7B,QADPA,GAAS,MAAQ,MACOA,EAAQ,QA3EpCrL,GAAGmL,eAAiB,SAAUF,GAC1B,OAAGA,GAAqB,KAAXA,GAELC,QAASD,EACTtB,OAAQ,SAAU5I,GACd,OAAe,IAAPA,GAAmB,IAAPA,EAAYA,EAAK0E,KAAKmE,IAAI,GAAI,GAAK7I,GAAM0E,KAAKiF,KAAK3J,EAAMX,KAAK8K,QAAU,GAAMzF,KAAK8E,GAAK,EAAInK,KAAK8K,SAAW,GAEpIjJ,QAAQ,WACJ,OAAOjC,GAAGgL,cAAc5K,KAAK8K,WAIlCH,GAmBX/K,GAAGsL,iBAAmB,SAAUL,GAE5B,OACIC,QAFJD,EAASA,GAAU,GAGftB,OAAQ,SAAU5I,GACd,IAAIwK,EAAO,EACPC,EAAYpL,KAAK8K,QACrB,GAAW,IAAPnK,GAAmB,IAAPA,EACZwK,EAAOxK,MACJ,CACHA,GAAU,EACLyK,IACDA,EAAYpL,KAAK8K,QAAU,GAAM,KACrC,IAAIvD,EAAI6D,EAAY,EAGhBD,GAFJxK,GAAU,GACD,GACG,GAAM0E,KAAKmE,IAAI,EAAG,GAAK7I,GAAM0E,KAAKiF,KAAK3J,EAAK4G,GAAKlC,KAAK8E,GAAK,EAAIiB,GAEhE/F,KAAKmE,IAAI,GAAI,GAAK7I,GAAM0E,KAAKiF,KAAK3J,EAAK4G,GAAKlC,KAAK8E,GAAK,EAAIiB,GAAa,GAAM,EAE5F,OAAOD,GAEXtJ,QAAS,WACL,OAAOjC,GAAGsL,iBAAiBlL,KAAK8K,YAwB5C,IAAIO,GACA9B,OAAQ,SAAS5I,GACb,OAAO,EAAIqK,EAAY,EAAIrK,IAE/BkB,QAAS,WACL,OAAOyJ,IAiBf1L,GAAG2L,aAAe,WACd,OAAOF,GAgBX,IAAIC,GACA/B,OAAQ,SAAS5I,GACb,OAAOqK,EAAYrK,IAEvBkB,QAAQ,WACJ,OAAOwJ,IAGfzL,GAAG4L,cAAgB,WACf,OAAOF,GAgBX,IAAIG,GACAlC,OAAQ,SAAU0B,GAQd,OANIA,EAAQ,GAE8B,IAA9B,EAAID,EAAY,GADxBC,GAAgB,KAGoB,GAA7BD,EAAoB,EAARC,EAAY,GAAW,IAIlDpJ,QAAS,WACL,OAAO4J,IAGf7L,GAAG8L,gBAAkB,WACjB,OAAOD,GAgBX,IAAIE,GACApC,OAAQ,SAAU0B,GAEd,OAAgB,IAARA,GAAqB,IAARA,EAAaA,EAAQA,EAAQA,GAAS,QAAkBA,EAD7D,UAGpBpJ,QAAS,WACL,OAAO+J,IAGfhM,GAAGiM,WAAa,WACZ,OAAOF,GAgBX,IAAIC,GACArC,OAAQ,SAAU0B,GAGd,OADAA,GAAgB,GACDA,GAAS,QAAkBA,EAF1B,SAE+C,GAEnEpJ,QAAS,WACL,OAAO8J,IAGf/L,GAAGkM,YAAc,WACb,OAAOF,GAeX,IAAIG,GACAxC,OAAQ,SAAU0B,GAGd,OADAA,GAAgB,GACJ,EACAA,EAAQA,GAAS,UAAkBA,EAH/B,WAGqD,GAEjEA,GAAgB,GACAA,GAAS,UAAkBA,EAN/B,WAMqD,EAAI,GAG7EpJ,QAAS,WACL,OAAOkK,IAGfnM,GAAGoM,cAAgB,WACf,OAAOD,GAqBXnM,GAAGqM,iBAAmB,SAASlD,EAAGmD,EAAGC,EAAGC,GACpC,OACI7C,OAAQ,SAASnC,GACb,OAAQ/B,KAAKmE,IAAI,EAAEpC,EAAE,GAAK2B,EAAI,EAAE3B,EAAG/B,KAAKmE,IAAI,EAAEpC,EAAE,GAAI8E,EAAI,EAAE7G,KAAKmE,IAAIpC,EAAE,IAAI,EAAEA,GAAG+E,EAAI9G,KAAKmE,IAAIpC,EAAE,GAAGgF,GAEpGvK,QAAS,WACL,OAAOjC,GAAGqM,iBAAiBG,EAAGD,EAAGD,EAAGnD,MAoBhD,IAAIsD,GACA9C,OAAQ,SAAS+C,GACb,OAAOjH,KAAKmE,IAAI8C,EAAM,IAE1BzK,QAAS,WACL,OAAOwK,IAGfzM,GAAG2M,sBAAwB,WACvB,OAAOF,GAkBX,IAAIG,GACAjD,OAAQ,SAAS+C,GACb,OAAQA,GAAMA,EAAK,IAEvBzK,QAAS,WACL,OAAO2K,IAGf5M,GAAG6M,uBAAyB,WACxB,OAAOD,GAkBX,IAAIE,GACAnD,OAAQ,SAAS+C,GASb,OAPAA,GAAQ,GACE,EACOA,EAAOA,EAAO,IAGb,MADZA,GAC6BA,EAAO,GAAM,IAIpDzK,QAAS,WACL,OAAO6K,IAGf9M,GAAG+M,yBAA2B,WAC1B,OAAOD,GAkBX,IAAIE,GACArD,OAAQ,SAAS+C,GACb,OAAOA,EAAOA,EAAOA,EAAOA,GAEhCzK,QAAS,WACL,OAAO+K,IAGfhN,GAAGiN,oBAAsB,WACrB,OAAOD,GAkBX,IAAIE,GACAvD,OAAQ,SAAS+C,GAEb,SADAA,GAAQ,GACQA,EAAOA,EAAOA,EAAO,IAEzCzK,QAAS,WACL,OAAOiL,IAGflN,GAAGmN,qBAAuB,WACtB,OAAOD,GAeX,IAAIE,GACAzD,OAAQ,SAAS+C,GAEb,OADAA,GAAY,GACD,EACA,GAAMA,EAAOA,EAAOA,EAAOA,GAE9B,KADRA,GAAQ,GACcA,EAAOA,EAAOA,EAAO,IAE/CzK,QAAS,WACL,OAAOmL,IAGfpN,GAAGqN,uBAAyB,WACxB,OAAOD,GAkBX,IAAIE,GACA3D,OAAQ,SAAS+C,GACb,OAAOA,EAAOA,EAAOA,EAAOA,EAAOA,GAEvCzK,QAAS,WACL,OAAOqL,IAGftN,GAAGuN,oBAAsB,WACrB,OAAOD,GAkBX,IAAIE,GACA7D,OAAQ,SAAS+C,GAEb,OADAA,GAAO,GACQA,EAAOA,EAAOA,EAAOA,EAAO,GAE/CzK,QAAS,WACL,OAAOuL,IAGfxN,GAAGyN,qBAAuB,WACtB,OAAOD,GAkBX,IAAIE,GACA/D,OAAQ,SAAS+C,GAEb,OADAA,GAAY,GACD,EACA,GAAMA,EAAOA,EAAOA,EAAOA,EAAOA,EAEtC,KADPA,GAAQ,GACaA,EAAOA,EAAOA,EAAOA,EAAO,IAErDzK,QAAS,WACL,OAAOyL,IAGf1N,GAAG2N,uBAAyB,WACxB,OAAOD,GAkBX,IAAIE,GACAjE,OAAQ,SAAS+C,GACb,OAAQ,GAAKjH,KAAKoI,KAAK,EAAInB,EAAOA,GAAQ,IAE9CzK,QAAS,WACL,OAAO2L,IAGf5N,GAAG8N,mBAAqB,WACpB,OAAOF,GAkBX,IAAIG,GACApE,OAAQ,SAAS+C,GAEb,OADAA,GAAc,EACPjH,KAAKoI,KAAK,EAAInB,EAAOA,IAEhCzK,QAAS,WACL,OAAO8L,IAGf/N,GAAGgO,oBAAsB,WACrB,OAAOD,GAkBX,IAAIE,GACAtE,OAAQ,SAAS+C,GAEb,OADAA,GAAc,GACH,GACC,IAAOjH,KAAKoI,KAAK,EAAInB,EAAOA,GAAQ,IAChDA,GAAQ,EACD,IAAOjH,KAAKoI,KAAK,EAAInB,EAAOA,GAAQ,KAE/CzK,QAAS,WACL,OAAOgM,IAGfjO,GAAGkO,sBAAwB,WACvB,OAAOD,GAkBX,IAAIE,GACAxE,OAAQ,SAAS+C,GACb,OAAOA,EAAOA,EAAOA,GAEzBzK,QAAS,WACL,OAAOkM,IAGfnO,GAAGoO,kBAAoB,WACnB,OAAOD,GAkBX,IAAIE,GACA1E,OAAQ,SAAS+C,GAEb,OADAA,GAAQ,GACOA,EAAOA,EAAO,GAEjCzK,QAAS,WACL,OAAOoM,IAGfrO,GAAGsO,mBAAqB,WACpB,OAAOD,GAeX,IAAIE,GACA5E,OAAQ,SAAS+C,GAEb,OADAA,GAAY,GACD,EACA,GAAMA,EAAOA,EAAOA,EAExB,KADPA,GAAQ,GACaA,EAAOA,EAAO,IAEvCzK,QAAS,WACL,OAAOsM,IAGfvO,GAAGwO,qBAAuB,WACtB,OAAOD,2BC5+BXvO,GAAGyO,cAAgBzO,GAAGE,OAClBb,KAAM,mBACNsC,QAAS3B,GAAG0B,iBACZf,OAAO,WACH,OAAO,GAGXG,KAAK,SAAUC,GACXX,KAAKa,OAAO,IAGhBA,OAAO,SAAUF,KAWjBkB,QAAQ,WACJ,OAAO7B,KAAKK,SAGhBA,MAAM,WACF,OAAO,IAAIT,GAAGyO,iBAatBzO,GAAG0O,KAAO1O,GAAGE,OACTb,KAAM,UACNsC,QAAS3B,GAAGyO,cAEZxN,OAAO,SAAUF,GAEb,IADA,IAAI4N,EAAevO,KAAKE,OAAOsO,wBAAwB5O,GAAG6O,iBACjDlP,EAAI,EAAGA,EAAIgP,EAAa/O,SAAUD,EAAG,CAC7BgP,EAAahP,GACnBmP,SAAU,IAIzB7M,QAAQ,WACJ,OAAO,IAAIjC,GAAG+O,MAGlBtO,MAAM,WACF,OAAO,IAAIT,GAAG0O,QAatB1O,GAAGgP,KAAO,WACN,OAAO,IAAIhP,GAAG0O,MAQlB1O,GAAG+O,KAAO/O,GAAGE,OACTb,KAAM,UACNsC,QAAS3B,GAAGyO,cAEZxN,OAAO,SAAUF,GAEb,IADA,IAAI4N,EAAevO,KAAKE,OAAOsO,wBAAwB5O,GAAG6O,iBACjDlP,EAAI,EAAGA,EAAIgP,EAAa/O,SAAUD,EAAG,CAC7BgP,EAAahP,GACnBmP,SAAU,IAIzB7M,QAAQ,WACJ,OAAO,IAAIjC,GAAG0O,MAGlBjO,MAAM,WACF,OAAO,IAAIT,GAAG+O,QAatB/O,GAAGiP,KAAO,WACN,OAAO,IAAIjP,GAAG+O,MAQlB/O,GAAGkP,iBAAmBlP,GAAGE,OACrBb,KAAM,sBACNsC,QAAS3B,GAAGyO,cAEZxN,OAAO,SAAUF,GAEb,IADA,IAAI4N,EAAevO,KAAKE,OAAOsO,wBAAwB5O,GAAG6O,iBACjDlP,EAAI,EAAGA,EAAIgP,EAAa/O,SAAUD,EAAG,CAC1C,IAAIwP,EAASR,EAAahP,GAC1BwP,EAAOL,SAAWK,EAAOL,UAIjC7M,QAAQ,WACJ,OAAO,IAAIjC,GAAGkP,kBAGlBzO,MAAM,WACF,OAAO,IAAIT,GAAGkP,oBAatBlP,GAAGoP,iBAAmB,WAClB,OAAO,IAAIpP,GAAGkP,kBAalBlP,GAAGqP,WAAarP,GAAGE,OACfb,KAAM,gBACNsC,QAAS3B,GAAGyO,cAEZtO,KAAK,SAASmP,GACVlP,KAAKmP,gBAAiB,OACP9I,IAAlB6I,GAA+BlP,KAAKoP,KAAKF,IAG1CrO,OAAO,SAASF,GACZX,KAAKE,OAAOmP,iBAAiBrP,KAAKmP,iBAGtCC,KAAK,SAASF,GAEV,OADAlP,KAAKmP,eAAiBD,GACf,GAGXrN,QAAQ,WACJ,OAAO,IAAIjC,GAAGqP,WAAWjP,KAAKmP,iBAGlC9O,MAAM,WACF,OAAO,IAAIT,GAAGqP,WAAWjP,KAAKmP,mBAetCvP,GAAG0P,WAAa,SAASJ,GACrB,OAAO,IAAItP,GAAGqP,WAAWC,IAY7BtP,GAAG2P,MAAQ3P,GAAGE,OACVb,KAAM,WACNsC,QAAS3B,GAAGyO,cAEZtO,KAAK,SAASyP,GACVxP,KAAKyP,WAAY,OACdpJ,IAATmJ,GAAsBxP,KAAK0P,cAAcF,IAQvCE,cAAc,SAAUF,GAEpB,OADAxP,KAAKyP,UAAYD,GACV,GAGX3O,OAAO,SAAUF,GACbX,KAAKE,OAAOyP,OAAStK,KAAKuK,IAAI5P,KAAKE,OAAOyP,SAAW3P,KAAKyP,WAAa,EAAI,IAG/E5N,QAAQ,WACJ,OAAO,IAAIjC,GAAG2P,OAAOvP,KAAKyP,YAG9BpP,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG2P,MAEpB,OADAjP,EAAOoP,cAAc1P,KAAKyP,WACnBnP,KAafV,GAAGiQ,MAAQ,SAAUL,GACjB,OAAO,IAAI5P,GAAG2P,MAAMC,IAWxB5P,GAAGkQ,MAAQlQ,GAAGE,OACVb,KAAM,WACNsC,QAAS3B,GAAGyO,cAEZtO,KAAM,SAASyP,GACXxP,KAAK+P,WAAY,OACd1J,IAATmJ,GAAsBxP,KAAKgQ,cAAcR,IAQvCQ,cAAc,SAAUR,GAEpB,OADAxP,KAAK+P,UAAYP,GACV,GAGX3O,OAAO,SAAUF,GACbX,KAAKE,OAAO+P,OAAS5K,KAAKuK,IAAI5P,KAAKE,OAAO+P,SAAWjQ,KAAK+P,WAAa,EAAI,IAG/ElO,QAAQ,WACJ,OAAO,IAAIjC,GAAGkQ,OAAO9P,KAAK+P,YAG9B1P,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGkQ,MAEpB,OADAxP,EAAO0P,cAAchQ,KAAK+P,WACnBzP,KAafV,GAAGsQ,MAAQ,SAAUV,GACjB,OAAO,IAAI5P,GAAGkQ,MAAMN,IAaxB5P,GAAGuQ,MAAQvQ,GAAGE,OACVb,KAAM,WACNsC,QAAS3B,GAAGyO,cAEZtO,KAAK,SAASqF,EAAK1B,GACf1D,KAAKoQ,GAAK,EACbpQ,KAAKqQ,GAAK,OAEDhK,IAARjB,SACWiB,IAAVjB,EAAI9F,IACPoE,EAAI0B,EAAI1B,EACR0B,EAAMA,EAAI9F,GAEXU,KAAKsQ,iBAAiBlL,EAAK1B,KAU1B4M,iBAAkB,SAAUhR,EAAGoE,GAG3B,OAFA1D,KAAKoQ,GAAK9Q,EACVU,KAAKqQ,GAAK3M,GACH,GAGX7C,OAAO,SAAUF,GACbX,KAAKE,OAAO4E,YAAY9E,KAAKoQ,GAAIpQ,KAAKqQ,KAG1ChQ,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGuQ,MAEpB,OADA7P,EAAOgQ,iBAAiBtQ,KAAKoQ,GAAIpQ,KAAKqQ,IAC/B/P,KAgBfV,GAAG2Q,MAAQ,SAAUnL,EAAK1B,GACtB,OAAO,IAAI9D,GAAGuQ,MAAM/K,EAAK1B,IAmB7B9D,GAAG4Q,SAAW5Q,GAAGE,OACbb,KAAM,cACNsC,QAAS3B,GAAGyO,cASZtO,KAAK,SAAS0Q,EAAUC,EAAgBC,GACpC3Q,KAAK4Q,gBAAkB,KACvB5Q,KAAK6Q,UAAY,KACjB7Q,KAAK8Q,MAAQ,KACb9Q,KAAK+Q,iBAAiBN,EAAUC,EAAgBC,IAUpDI,iBAAiB,SAAUN,EAAUC,EAAgBC,GAUjD,OATIF,IACAzQ,KAAK6Q,UAAYJ,GAEjBC,IACA1Q,KAAK4Q,gBAAkBF,QAEdrK,IAATsK,IACA3Q,KAAK8Q,MAAQH,IAEV,GAMXK,QAAQ,WACAhR,KAAK6Q,WACL7Q,KAAK6Q,UAAUtO,KAAKvC,KAAK4Q,gBAAiB5Q,KAAKE,OAAQF,KAAK8Q,QAIpEjQ,OAAO,SAAUF,GACbX,KAAKgR,WAOTC,kBAAkB,WACd,OAAOjR,KAAK4Q,iBAOhBM,kBAAkB,SAAUC,GACpBA,IAAQnR,KAAK4Q,kBACT5Q,KAAK4Q,kBACL5Q,KAAK4Q,gBAAkB,MAC3B5Q,KAAK4Q,gBAAkBO,IAI/B9Q,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG4Q,SAEpB,OADAlQ,EAAOyQ,iBAAiB/Q,KAAK6Q,UAAW7Q,KAAK4Q,gBAAiB5Q,KAAK8Q,OAC5DxQ,KAoBfV,GAAGwR,SAAW,SAAUX,EAAUC,EAAgBC,GAC9C,OAAO,IAAI/Q,GAAG4Q,SAASC,EAAUC,EAAgBC,4BC2jCrD,SAASU,EAAUtI,EAAGmD,EAAGC,EAAGC,EAAGhF,GAC3B,OAAQ/B,KAAKmE,IAAI,EAAIpC,EAAG,GAAK2B,EACzB,EAAI3B,EAAK/B,KAAKmE,IAAI,EAAIpC,EAAG,GAAM8E,EAC/B,EAAI7G,KAAKmE,IAAIpC,EAAG,IAAM,EAAIA,GAAK+E,EAC/B9G,KAAKmE,IAAIpC,EAAG,GAAKgF,EA9hDzBxM,GAAGiG,eAAiBjG,GAAGE,OACnBb,KAAM,oBACNsC,QAAS3B,GAAG0B,iBAEZvB,KAAK,SAAUqM,GACXpM,KAAKsR,UAAY,EACjBtR,KAAKuR,SAAW,EAChBvR,KAAKwR,YAAa,EAClBxR,KAAKyR,UAAY,KACjBzR,KAAKgC,OAAS,EACdhC,KAAK0B,gBAAkB,EACvB1B,KAAK0R,gBAAiB,EACtB1R,KAAK2R,eAAgB,EACrB3R,KAAK4R,cAAe,OACdvL,IAAN+F,GAAmBxM,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAMoM,IAO/EyF,WAAW,WACP,OAAO7R,KAAKuR,UAQhBjL,iBAAiB,SAAU8F,GAOvB,OANApM,KAAKwB,UAAmB,IAAN4K,EAAWxM,GAAGiI,MAAMiK,YAAc1F,EAIpDpM,KAAKuR,SAAW,EAChBvR,KAAKwR,YAAa,GACX,GAGXjR,OAAO,WACH,OAAQP,KAAKuR,UAAYvR,KAAKwB,WAGlCuQ,iBAAkB,SAASzR,GACvBA,EAAOoR,eAAiB1R,KAAK0R,eAC7BpR,EAAO0B,OAAShC,KAAKgC,OACrB1B,EAAOoB,gBAAkB1B,KAAK0B,gBAC9BpB,EAAOmR,UAAYzR,KAAKyR,UACxBnR,EAAOsR,aAAe5R,KAAK4R,aAC3BtR,EAAOqR,cAAgB3R,KAAK2R,eAGhCK,iBAAkB,SAAS1R,GACvB,GAAGN,KAAKyR,UAAU,CACdnR,EAAOmR,aACP,IAAI,IAAIlS,EAAE,EAAGA,EAAES,KAAKyR,UAAUjS,OAAQD,IAClCe,EAAOmR,UAAU/L,KAAK1F,KAAKyR,UAAUlS,GAAGsC,aAKpDxB,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGiG,eAAe7F,KAAKwB,WAExC,OADAxB,KAAK+R,iBAAiBzR,GACfA,GAYXiJ,OAAQ,SAAU0I,GACVjS,KAAKyR,UACLzR,KAAKyR,UAAUjS,OAAS,EAExBQ,KAAKyR,aACT,IAAK,IAAIlS,EAAI,EAAGA,EAAI2S,UAAU1S,OAAQD,IAClCS,KAAKyR,UAAU/L,KAAKwM,UAAU3S,IAClC,OAAOS,MAGX0G,iBAAkB,SAAU/F,GACxB,IAAIwR,EAAUnS,KAAKyR,UACnB,IAAMU,GAAgC,IAAnBA,EAAQ3S,OACvB,OAAOmB,EACX,IAAK,IAAIpB,EAAI,EAAG6S,EAAID,EAAQ3S,OAAQD,EAAI6S,EAAG7S,IACvCoB,EAAKwR,EAAQ5S,GAAGgK,OAAO5I,GAC3B,OAAOA,GAGXD,KAAK,SAAUC,GACPX,KAAKwR,YACLxR,KAAKwR,YAAa,EAClBxR,KAAKuR,SAAW,GAEhBvR,KAAKuR,UAAY5Q,EAIrB,IAAIyG,EAAIpH,KAAKuR,UAAYvR,KAAKwB,UAAY,eAAqBxB,KAAKwB,UAAY,gBAChF4F,EAAK,EAAIA,EAAIA,EAAI,EACjBpH,KAAKa,OAAOuG,EAAI,EAAIA,EAAI,GAGrBpH,KAAK2R,eAAiB3R,KAAK0B,gBAAkB,GAAK1B,KAAKO,WAClDP,KAAK0R,gBACL1R,KAAK0B,kBAGT1B,KAAKQ,gBAAgBR,KAAKE,QAI1BF,KAAKU,KAAKV,KAAKuR,SAAWvR,KAAKwB,aAKvChB,gBAAgB,SAAUN,GACtBN,GAAGC,OAAOyC,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAC/CF,KAAKuR,SAAW,EAChBvR,KAAKwR,YAAa,GAGtB3P,QAAQ,WAEJ,OADAjC,GAAGgB,MAAM,MACF,MAQXyR,iBAAiB,SAAUC,GAEvB1S,GAAGgB,MAAM,OAQb2R,iBAAiB,WAGb,OADA3S,GAAGgB,MAAM,MACF,GAcXmB,MAAO,SAASA,GACZ,OAAGA,GAAS,GACRnC,GAAGgB,MAAM,MACFZ,OAGXA,KAAK4R,cAAe,EACpB5R,KAAKgC,QAAUD,EACR/B,OAOXmC,SAAU,WACN,OAAOnC,KAAKgC,QAQhBI,SAAU,SAASL,GAEf,OADA/B,KAAKgC,OAASD,EACP/B,MAYXwS,OAAQ,SAASC,GAEb,OADAA,EAAQpN,KAAKqN,MAAMD,GAChBE,MAAMF,IAAUA,EAAQ,GACvB7S,GAAGgB,MAAM,MACFZ,OAEXA,KAAK2R,eAAgB,EACrB3R,KAAK0B,iBAAmB+Q,EACjBzS,OAWX4S,cAAe,WAIX,OAHA5S,KAAK2R,eAAgB,EACrB3R,KAAK0B,gBAAkB1B,KAAKsR,UAC5BtR,KAAK0R,gBAAiB,EACf1R,QAIfJ,GAAGiT,eAAiB,SAAUzG,GAC1B,OAAO,IAAIxM,GAAGiG,eAAeuG,IAmBjCxM,GAAGkT,SAAWlT,GAAGE,OACbb,KAAM,cACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAUgT,GACX/S,KAAKgT,YACLhT,KAAKiT,OAAS,KACdjT,KAAKkT,MAAQ,EACblT,KAAKmT,WAAY,EAEjB,IAAIC,EAAcL,aAAqBM,MAASN,EAAYb,UAC5D,GAA0B,IAAtBkB,EAAW5T,OAAf,CAIA,IAAI8T,EAAOF,EAAW5T,OAAS,EAI/B,GAHK8T,GAAQ,GAA2B,MAApBF,EAAWE,IAC3B1T,GAAGgB,MAAM,MAET0S,GAAQ,EAAG,CAEX,IADA,IAA0BC,EAAtBC,EAAOJ,EAAW,GACb7T,EAAI,EAAGA,EAAI+T,EAAM/T,IAClB6T,EAAW7T,KACXgU,EAAUC,EACVA,EAAO5T,GAAGkT,SAASW,cAAcF,EAASH,EAAW7T,KAG7DS,KAAK0T,mBAAmBF,EAAMJ,EAAWE,UAfzC1T,GAAGyC,QAAQ,OAyBnBqR,mBAAmB,SAAUC,EAAWC,GACpC,IAAKD,IAAcC,EAEf,OADAhU,GAAGyC,QAAQ,OACJ,EAGX,IAAIwR,EAAcF,EAAUnS,UAAWsS,EAAcF,EAAUpS,UAG3D4K,GAFJyH,GAAeF,EAAUhC,cAAgBgC,EAAUjS,gBAAkB,IACrEoS,GAAeF,EAAUjC,cAAgBiC,EAAUlS,gBAAkB,GAMrE,OAJA1B,KAAKsG,iBAAiB8F,GAEtBpM,KAAKgT,SAAS,GAAKW,EACnB3T,KAAKgT,SAAS,GAAKY,GACZ,GAGXvT,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGkT,SAGpB,OAFA9S,KAAK+R,iBAAiBzR,GACtBA,EAAOoT,mBAAmB1T,KAAKgT,SAAS,GAAG3S,QAASL,KAAKgT,SAAS,GAAG3S,SAC9DC,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAKiT,OAASjT,KAAKgT,SAAS,GAAGxR,UAAYxB,KAAKwB,UAChDxB,KAAKiT,QAAUjT,KAAKgT,SAAS,GAAGrB,cAAgB3R,KAAKgT,SAAS,GAAGtR,gBAAkB,EACnF1B,KAAKkT,OAAS,GAGlBzS,KAAK,YAEmB,IAAhBT,KAAKkT,OACLlT,KAAKgT,SAAShT,KAAKkT,OAAOzS,OAC9Bb,GAAGC,OAAOyC,UAAU7B,KAAK8B,KAAKvC,OAGlCa,OAAO,SAAUF,GACb,IAAIoT,EAC0EC,EADnEC,EAAQ,EACfC,EAAWlU,KAAKiT,OAAQkB,EAAanU,KAAKgT,SAAUoB,EAAUpU,KAAKkT,OAEvEvS,EAAKX,KAAK0G,iBAAiB/F,IAClBuT,GAELH,EAAsB,IAAbG,EAAkBvT,EAAKuT,EAAW,EAE7B,IAAVD,GAA2B,IAAZG,GAAiBpU,KAAKmT,YAKrCgB,EAAW,GAAGtT,OAAO,GACrBsT,EAAW,GAAG1T,UAIlBwT,EAAQ,EACRF,EAAsB,IAAbG,EAAkB,GAAKvT,EAAKuT,IAAa,EAAIA,IAErC,IAAbE,IAEAD,EAAW,GAAG3T,gBAAgBR,KAAKE,QACnCiU,EAAW,GAAGtT,OAAO,GACrBsT,EAAW,GAAG1T,QAEF,IAAZ2T,IAEAD,EAAW,GAAGtT,OAAO,GACrBsT,EAAW,GAAG1T,SAItBuT,EAAcG,EAAWF,GAErBG,IAAYH,GAASD,EAAYzT,WAIjC6T,IAAYH,GACZD,EAAYxT,gBAAgBR,KAAKE,QAErC6T,GAAgBC,EAAYtS,gBAC5BsS,EAAYnT,OAAOkT,EAAQ,EAAIA,EAAQ,EAAIA,GAC3C/T,KAAKkT,MAAQe,IAGjBpS,QAAQ,WACJ,IAAIvB,EAASV,GAAGkT,SAASW,cAAczT,KAAKgT,SAAS,GAAGnR,UAAW7B,KAAKgT,SAAS,GAAGnR,WAIpF,OAHA7B,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACtBA,EAAO6S,WAAY,EACZ7S,KAsBfV,GAAGyU,SAAW,SAAgCtB,GAC1C,IAAIK,EAAcL,aAAqBM,MAASN,EAAYb,UAC5D,GAA0B,IAAtBkB,EAAW5T,OAEX,OADAI,GAAGyC,QAAQ,MACJ,KAEX,IAAIiR,EAAOF,EAAW5T,OAAS,EAC1B8T,GAAQ,GAA2B,MAApBF,EAAWE,IAC3B1T,GAAGgB,MAAM,MAEb,IAAI0T,EAAS,KACb,GAAIhB,GAAQ,EAAG,CACXgB,EAASlB,EAAW,GACpB,IAAK,IAAI7T,EAAI,EAAGA,GAAK+T,EAAM/T,IACnB6T,EAAW7T,KACX+U,EAAS1U,GAAGkT,SAASW,cAAca,EAAQlB,EAAW7T,KAKlE,OAAO+U,GAGX1U,GAAGkT,SAASW,cAAgB,SAAUE,EAAWC,GAC7C,IAAIS,EAAW,IAAIzU,GAAGkT,SAEtB,OADAuB,EAASX,mBAAmBC,EAAWC,GAChCS,GAaXzU,GAAG2U,OAAS3U,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAM,SAAUO,EAAQmS,GACpBzS,KAAKwU,OAAS,EACdxU,KAAKyU,OAAS,EACdzU,KAAK0U,QAAU,EACf1U,KAAK2U,gBAAiB,EACtB3U,KAAKiC,aAAe,UAChBoE,IAAVoM,GAAuBzS,KAAKkC,eAAe5B,EAAQmS,IAQjDvQ,eAAe,SAAU5B,EAAQmS,GAC7B,IAAI7Q,EAAWtB,EAAOkB,UAAYiR,EAElC,QAAIzS,KAAKsG,iBAAiB1E,KACtB5B,KAAKwU,OAAS/B,EACdzS,KAAKiC,aAAe3B,EAChBA,aAAkBV,GAAGyO,gBACrBrO,KAAK2U,gBAAiB,EACtB3U,KAAKwU,QAAU,GAEnBxU,KAAKyU,OAAS,GACP,IAKfpU,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG2U,OAGpB,OAFAvU,KAAK+R,iBAAiBzR,GACtBA,EAAO4B,eAAelC,KAAKiC,aAAa5B,QAASL,KAAKwU,QAC/ClU,GAGXE,gBAAgB,SAAUN,GACtBF,KAAKyU,OAAS,EACdzU,KAAK0U,QAAU1U,KAAKiC,aAAaT,UAAYxB,KAAKwB,UAClD5B,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAKiC,aAAazB,gBAAgBN,IAGtCO,KAAK,WACDT,KAAKiC,aAAaxB,OAClBb,GAAGC,OAAOyC,UAAU7B,KAAK8B,KAAKvC,OAGlCa,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GAC3B,IAAIiU,EAAiB5U,KAAKiC,aACtB4S,EAAc7U,KAAKwB,UACnBsT,EAAW9U,KAAKwU,OAChBO,EAAY/U,KAAK0U,QAErB,GAAI/T,GAAMoU,EAAW,CACjB,KAAOpU,EAAKoU,GAAa/U,KAAKyU,OAASK,GACnCF,EAAe/T,OAAO,GACtBb,KAAKyU,SACLG,EAAenU,OACfmU,EAAepU,gBAAgBR,KAAKE,QACpC6U,GAAaH,EAAepT,UAAYqT,EACxC7U,KAAK0U,QAAUK,EAAY,EAAI,EAAIA,EAInCpU,GAAM,GAAOX,KAAKyU,OAASK,IAE3BF,EAAe/T,OAAO,GACtBb,KAAKyU,UAIJzU,KAAK2U,iBACF3U,KAAKyU,SAAWK,EAChBF,EAAenU,OAGfmU,EAAe/T,OAAOF,GAAMoU,EAAYH,EAAepT,UAAYqT,UAI3ED,EAAe/T,OAAQF,EAAKmU,EAAY,IAIhDvU,OAAO,WACH,OAAOP,KAAKyU,SAAWzU,KAAKwU,QAGhC3S,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAG2U,OAAOvU,KAAKiC,aAAaJ,UAAW7B,KAAKwU,QAG7D,OAFAxU,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,GAOXkC,eAAe,SAAUlC,GACjBN,KAAKiC,eAAiB3B,IACtBN,KAAKiC,aAAe3B,IAQ5BmC,eAAe,WACX,OAAOzC,KAAKiC,gBAepBrC,GAAG4S,OAAS,SAAUlS,EAAQmS,GAC1B,OAAO,IAAI7S,GAAG2U,OAAOjU,EAAQmS,IAcjC7S,GAAGoV,cAAgBpV,GAAGE,OAClBb,KAAM,mBACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAUO,GACXN,KAAKiC,aAAe,KAC1B3B,GAAUN,KAAKkC,eAAe5B,IAO5B4B,eAAe,SAAU5B,GACrB,OAAKA,GAKLN,KAAKiC,aAAe3B,GACb,IALHV,GAAGyC,QAAQ,OACJ,IAOfhC,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGoV,cAGpB,OAFAhV,KAAK+R,iBAAiBzR,GACtBA,EAAO4B,eAAelC,KAAKiC,aAAa5B,SACjCC,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAKiC,aAAazB,gBAAgBN,IAGtCQ,KAAK,SAAUC,GACX,IAAIiU,EAAiB5U,KAAKiC,aAC1B2S,EAAelU,KAAKC,GAChBiU,EAAerU,WAEfqU,EAAepU,gBAAgBR,KAAKE,QAIpC0U,EAAelU,KAAKkU,EAAe/C,aAAe+C,EAAepT,aAIzEjB,OAAO,WACH,OAAO,GAGXsB,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAGoV,cAAchV,KAAKiC,aAAaJ,WAGpD,OAFA7B,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,GAOXkC,eAAe,SAAUlC,GACjBN,KAAKiC,eAAiB3B,IACtBN,KAAKiC,aAAe3B,IAQ5BmC,eAAe,WACX,OAAOzC,KAAKiC,gBAcpBrC,GAAGgT,cAAgB,SAAUtS,GACzB,OAAO,IAAIV,GAAGoV,cAAc1U,IAShCV,GAAGqV,MAAQrV,GAAGE,OACVb,KAAM,WACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAUgT,GACX/S,KAAKkV,KAAO,KACZlV,KAAKmV,KAAO,KAElB,IAAI/B,EAAcL,aAAqBM,MAASN,EAAYb,UACtD,GAA0B,IAAtBkB,EAAW5T,OAAf,CAIN,IAAI8T,EAAOF,EAAW5T,OAAS,EAIzB,GAHD8T,GAAQ,GAA2B,MAApBF,EAAWE,IAC9B1T,GAAGgB,MAAM,MAEA0S,GAAQ,EAAG,CAEX,IADA,IAA0BC,EAAtBC,EAAOJ,EAAW,GACb7T,EAAI,EAAGA,EAAI+T,EAAM/T,IAClB6T,EAAW7T,KACXgU,EAAUC,EACVA,EAAO5T,GAAGqV,MAAMxB,cAAcF,EAASH,EAAW7T,KAG1DS,KAAK0T,mBAAmBF,EAAMJ,EAAWE,UAfzC1T,GAAGyC,QAAQ,OAwBnBqR,mBAAmB,SAAUH,EAAS6B,GAClC,IAAK7B,IAAY6B,EAEb,OADAxV,GAAGyC,QAAQ,OACJ,EAGX,IAAIgT,GAAM,EAENC,EAAK/B,EAAQ/R,UACb+T,EAAKH,EAAQ5T,UAcjB,OAZIxB,KAAKsG,iBAAiBjB,KAAKE,IAAI+P,EAAIC,MACnCvV,KAAKkV,KAAO3B,EACZvT,KAAKmV,KAAOC,EAERE,EAAKC,EACLvV,KAAKmV,KAAOvV,GAAGkT,SAASW,cAAc2B,EAASxV,GAAG4V,UAAUF,EAAKC,IAC1DD,EAAKC,IACZvV,KAAKkV,KAAOtV,GAAGkT,SAASW,cAAcF,EAAS3T,GAAG4V,UAAUD,EAAKD,KAGrED,GAAM,GAEHA,GAGXhV,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGqV,MAGpB,OAFAjV,KAAK+R,iBAAiBzR,GACtBA,EAAOoT,mBAAmB1T,KAAKkV,KAAK7U,QAASL,KAAKmV,KAAK9U,SAChDC,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAKkV,KAAK1U,gBAAgBN,GAC1BF,KAAKmV,KAAK3U,gBAAgBN,IAG9BO,KAAK,WACDT,KAAKkV,KAAKzU,OACVT,KAAKmV,KAAK1U,OACVb,GAAGC,OAAOyC,UAAU7B,KAAK8B,KAAKvC,OAGlCa,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKkV,MACLlV,KAAKkV,KAAKrU,OAAOF,GACjBX,KAAKmV,MACLnV,KAAKmV,KAAKtU,OAAOF,IAGzBkB,QAAQ,WACJ,IAAIvB,EAASV,GAAGqV,MAAMxB,cAAczT,KAAKkV,KAAKrT,UAAW7B,KAAKmV,KAAKtT,WAGnE,OAFA7B,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAgBfV,GAAG6V,MAAQ,SAAgC1C,GACvC,IAAIK,EAAcL,aAAqBM,MAASN,EAAYb,UAC5D,GAA0B,IAAtBkB,EAAW5T,OAEX,OADAI,GAAGyC,QAAQ,MACJ,KAEN+Q,EAAW5T,OAAS,GAA4C,MAArC4T,EAAWA,EAAW5T,OAAS,IAC3DI,GAAGgB,MAAM,MAGb,IADA,IAAI4S,EAAOJ,EAAW,GACb7T,EAAI,EAAGA,EAAI6T,EAAW5T,OAAQD,IACd,MAAjB6T,EAAW7T,KACXiU,EAAO5T,GAAGqV,MAAMxB,cAAcD,EAAMJ,EAAW7T,KAEvD,OAAOiU,GAGX5T,GAAGqV,MAAMxB,cAAgB,SAAUF,EAAS6B,GACxC,IAAIM,EAAS,IAAI9V,GAAGqV,MAEpB,OADAS,EAAOhC,mBAAmBH,EAAS6B,GAC5BM,GAcX9V,GAAG+V,SAAW/V,GAAGE,OACbb,KAAM,cACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAUgU,GACrB5V,KAAK6V,YAAc,EACnB7V,KAAK8V,UAAY,EACjB9V,KAAK+V,OAAS,OACD1P,IAAbuP,GAA0B5V,KAAKsG,iBAAiB1E,EAAUgU,IAS9DtP,iBAAiB,SAAU1E,EAAUgU,GACjC,QAAIhW,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACxD5B,KAAK8V,UAAYF,GACV,IAKfvV,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG+V,SAGpB,OAFA3V,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK8V,WACtCxV,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAEvDF,KAAK6V,YAAc3V,EAAO8V,MAAQ,IAClC,IAAIA,EAAQhW,KAAK8V,UAAY9V,KAAK6V,YAC9BG,EAAQ,MAAKA,GAAS,KACtBA,GAAS,MAAKA,GAAS,KAC3BhW,KAAK+V,OAASC,GAGlBnU,QAAQ,WACJjC,GAAGgB,MAAM,OAGbC,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,SACLF,KAAKE,OAAO8V,MAAQhW,KAAK6V,YAAc7V,KAAK+V,OAASpV,MAkBjEf,GAAGqW,SAAW,SAAUrU,EAAUgU,GAC9B,OAAO,IAAIhW,GAAG+V,SAAS/T,EAAUgU,IAcrChW,GAAGsW,SAAWtW,GAAGE,OACbb,KAAM,cACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAM,SAAU6B,EAAUuU,GACtBnW,KAAKoW,YAAcxW,GAAGyW,KACtBrW,KAAK6V,YAAc,OACJxP,IAAf8P,GAA4BnW,KAAKsG,iBAAiB1E,EAAUuU,IAShE7P,iBAAiB,SAAU1E,EAAUuU,GACjC,QAAIvW,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACxD5B,KAAKoW,YAAcD,GACZ,IAKf9V,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGsW,SAGpB,OAFAlW,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAKoW,aACtC9V,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAK6V,YAAc3V,EAAO8V,OAG9BnV,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,SACLF,KAAKE,OAAO8V,MAAQhW,KAAK6V,YAAc7V,KAAKoW,YAAczV,IAIlEkB,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAGsW,SAASlW,KAAKwB,WAAYxB,KAAKoW,aAGnD,OAFApW,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAiBfV,GAAG0W,SAAW,SAAU1U,EAAUuU,GAC9B,OAAO,IAAIvW,GAAGsW,SAAStU,EAAUuU,IAmBrCvW,GAAG2W,OAAS3W,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAU4U,EAAUC,GAC/BzW,KAAK0W,eAAiB9W,GAAGqE,GAAG,EAAG,GAC/BjE,KAAKqI,eAAiBzI,GAAGqE,GAAG,EAAG,GAC/BjE,KAAKmG,kBAAoBvG,GAAGqE,GAAG,EAAG,QAErBoC,IAAbmQ,GAA0B5W,GAAG2W,OAAOjU,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,EAAU4U,EAAUC,IAUlGnQ,iBAAiB,SAAU1E,EAAU+U,EAAUjT,GAC3C,QAAI9D,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,UACzCyE,IAAfsQ,EAASrX,IACXoE,EAAIiT,EAASjT,EACbiT,EAAWA,EAASrX,GAGlBU,KAAK0W,eAAepX,EAAIqX,EACxB3W,KAAK0W,eAAehT,EAAIA,GACjB,IAKfrD,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG2W,OAGpB,OAFAvW,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK0W,gBACtCpW,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvD,IAAI0W,EAAU1W,EAAOZ,EACjBuX,EAAU3W,EAAOwD,EACrB1D,KAAKmG,kBAAkB7G,EAAIsX,EAC3B5W,KAAKmG,kBAAkBzC,EAAImT,EAC3B7W,KAAKqI,eAAe/I,EAAIsX,EACxB5W,KAAKqI,eAAe3E,EAAImT,GAG5BhW,OAAO,SAAUF,GAEb,GADAA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,OAAQ,CACb,IAAIZ,EAAIU,KAAK0W,eAAepX,EAAIqB,EAC5B+C,EAAI1D,KAAK0W,eAAehT,EAAI/C,EAC5BmW,EAAmB9W,KAAKqI,eAC5B,GAAIzI,GAAGiI,MAAMC,yBAA0B,CACnC,IAAIiP,EAAU/W,KAAKE,OAAOZ,EACtB0X,EAAUhX,KAAKE,OAAOwD,EACtBuT,EAAsBjX,KAAKmG,kBAE/B2Q,EAAiBxX,EAAIwX,EAAiBxX,EAAIyX,EAAUE,EAAoB3X,EACxEwX,EAAiBpT,EAAIoT,EAAiBpT,EAAIsT,EAAUC,EAAoBvT,EACxEpE,GAAQwX,EAAiBxX,EACzBoE,GAAQoT,EAAiBpT,EAC5BuT,EAAoB3X,EAAIA,EACxB2X,EAAoBvT,EAAIA,EACxB1D,KAAKE,OAAO4E,YAAYxF,EAAGoE,QAExB1D,KAAKE,OAAO4E,YAAYgS,EAAiBxX,EAAIA,EAAGwX,EAAiBpT,EAAIA,KAKjF7B,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAG2W,OAAOvW,KAAKwB,UAAW5B,GAAGqE,IAAIjE,KAAK0W,eAAepX,GAAIU,KAAK0W,eAAehT,IAG9F,OAFA1D,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAoBfV,GAAGsX,OAAS,SAAUtV,EAAU4U,EAAUC,GACtC,OAAO,IAAI7W,GAAG2W,OAAO3U,EAAU4U,EAAUC,IAgB7C7W,GAAGuX,OAASvX,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAG2W,OAEZxW,KAAK,SAAU6B,EAAU+U,EAAUjT,GAC/B1D,KAAKoX,aAAexX,GAAGqE,GAAG,EAAG,QACtBoC,IAAbsQ,GAA0B3W,KAAKsG,iBAAiB1E,EAAU+U,EAAUjT,IAUlE4C,iBAAiB,SAAU1E,EAAU+U,EAAUjT,GAC3C,QAAI9D,GAAG2W,OAAOjU,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,EAAU+U,EAAUjT,UACrD2C,IAAfsQ,EAASrX,IACXoE,EAAIiT,EAASjT,EACbiT,EAAWA,EAASrX,GAGlBU,KAAKoX,aAAa9X,EAAIqX,EACtB3W,KAAKoX,aAAa1T,EAAIA,GACf,IAKfrD,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGuX,OAGpB,OAFAnX,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAKoX,cACtC9W,GAGXE,gBAAgB,SAAUN,GACtBN,GAAG2W,OAAOjU,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAC/CF,KAAK0W,eAAepX,EAAIU,KAAKoX,aAAa9X,EAAIY,EAAOZ,EACrDU,KAAK0W,eAAehT,EAAI1D,KAAKoX,aAAa1T,EAAIxD,EAAOwD,KAmB7D9D,GAAGyX,OAAS,SAAUzV,EAAU+U,EAAUjT,GACtC,OAAO,IAAI9D,GAAGuX,OAAOvV,EAAU+U,EAAUjT,IAa7C9D,GAAG0X,OAAS1X,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAM,SAAUqH,EAAGmQ,EAAIC,GACnBxX,KAAKyX,OAAS,EACdzX,KAAK0X,OAAS,EACd1X,KAAK2X,YAAc,EACnB3X,KAAK4X,YAAc,EACnB5X,KAAK6X,UAAY,EACjB7X,KAAK8X,UAAY,EACjB9X,KAAK+X,QAAU,EACf/X,KAAKgY,QAAU,OACR3R,IAAPmR,GAAoB5X,GAAG0X,OAAOhV,UAAUgE,iBAAiB/D,KAAKvC,KAAMoH,EAAGmQ,EAAIC,IAU/ElR,iBAAiB,SAAUc,EAAGmQ,EAAIC,GAC9B,IAAInC,GAAM,EAMV,OALIzV,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAMoH,KACxDpH,KAAK6X,UAAYN,EACjBvX,KAAK8X,UAAYN,EACjBnC,GAAM,GAEHA,GAGXhV,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG0X,OAGpB,OAFAtX,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK6X,UAAW7X,KAAK8X,WACtDxX,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAEvDF,KAAK2X,YAAczX,EAAO+X,MAAQ,IAClCjY,KAAK+X,QAAU/X,KAAK6X,UAAY7X,KAAK2X,YACjC3X,KAAK+X,QAAU,MACf/X,KAAK+X,SAAW,KAChB/X,KAAK+X,SAAW,MAChB/X,KAAK+X,SAAW,KAEpB/X,KAAK4X,YAAc1X,EAAOgY,MAAQ,IAClClY,KAAKgY,QAAUhY,KAAK8X,UAAY9X,KAAK4X,YACjC5X,KAAKgY,QAAU,MACfhY,KAAKgY,SAAW,KAChBhY,KAAKgY,SAAW,MAChBhY,KAAKgY,SAAW,MAGxBnX,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GAC3BX,KAAKE,OAAO+X,MAAQjY,KAAK2X,YAAc3X,KAAK+X,QAAUpX,EACtDX,KAAKE,OAAOgY,MAAQlY,KAAK4X,YAAc5X,KAAKgY,QAAUrX,KAkB9Df,GAAGuY,OAAS,SAAU/Q,EAAGmQ,EAAIC,GACzB,OAAO,IAAI5X,GAAG0X,OAAOlQ,EAAGmQ,EAAIC,IAYhC5X,GAAGwY,OAASxY,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAG0X,OAEfvX,KAAM,SAASqH,EAAGmQ,EAAIC,QACdnR,IAAPmR,GAAoBxX,KAAKsG,iBAAiBc,EAAGmQ,EAAIC,IAU/ClR,iBAAiB,SAAUc,EAAGiR,EAAYC,GACtC,IAAIjD,GAAM,EAMV,OALIzV,GAAG0X,OAAOhV,UAAUgE,iBAAiB/D,KAAKvC,KAAMoH,EAAGiR,EAAYC,KAC/DtY,KAAKyX,OAASY,EACdrY,KAAK0X,OAASY,EACdjD,GAAM,GAEHA,GAGXhV,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGwY,OAGpB,OAFApY,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAKyX,OAAQzX,KAAK0X,QACnDpX,GAGXE,gBAAgB,SAAUN,GACtBN,GAAG0X,OAAOhV,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAC/CF,KAAK+X,QAAU/X,KAAKyX,OACpBzX,KAAKgY,QAAUhY,KAAK0X,OACpB1X,KAAK6X,UAAY7X,KAAK2X,YAAc3X,KAAK+X,QACzC/X,KAAK8X,UAAY9X,KAAK4X,YAAc5X,KAAKgY,SAG7CnW,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAGwY,OAAOpY,KAAKwB,WAAYxB,KAAKyX,QAASzX,KAAK0X,QAG/D,OAFA1X,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAkBfV,GAAG2Y,OAAS,SAAUnR,EAAGmQ,EAAIC,GACzB,OAAO,IAAI5X,GAAGwY,OAAOhR,EAAGmQ,EAAIC,IAkBhC5X,GAAG4Y,OAAS5Y,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAU+U,EAAUjT,EAAGE,EAAQ6U,GAC1CzY,KAAKqI,eAAiBzI,GAAGqE,GAAG,EAAG,GAC/BjE,KAAKmG,kBAAoBvG,GAAGqE,GAAG,EAAG,GAClCjE,KAAK0Y,OAAS9Y,GAAGqE,GAAG,EAAG,GACvBjE,KAAK2Y,QAAU,EACf3Y,KAAK4Y,OAAS,OAEHvS,IAAXzC,GAAwBhE,GAAG4Y,OAAOlW,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,EAAU+U,EAAUjT,EAAGE,EAAQ6U,IAc3GnS,iBAAiB,SAAU1E,EAAU+U,EAAUjT,EAAGE,EAAQ6U,GACtD,QAAI7Y,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,UAC7CyE,IAAVoS,IACHA,EAAQ7U,EACRA,EAASF,EACTA,EAAIiT,EAASjT,EACbiT,EAAWA,EAASrX,GAElBU,KAAK0Y,OAAOpZ,EAAIqX,EAChB3W,KAAK0Y,OAAOhV,EAAIA,EAChB1D,KAAK2Y,QAAU/U,EACf5D,KAAK4Y,OAASH,GACP,IAKfpY,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG4Y,OAGpB,OAFAxY,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK0Y,OAAQ1Y,KAAK2Y,QAAS3Y,KAAK4Y,QACjEtY,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvD,IAAI0W,EAAU1W,EAAOZ,EACjBuX,EAAU3W,EAAOwD,EACrB1D,KAAKmG,kBAAkB7G,EAAIsX,EAC3B5W,KAAKmG,kBAAkBzC,EAAImT,EAC3B7W,KAAKqI,eAAe/I,EAAIsX,EACxB5W,KAAKqI,eAAe3E,EAAImT,GAG5BhW,OAAO,SAAUF,GAEb,GADAA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,OAAQ,CACb,IAAI2Y,EAAOlY,EAAKX,KAAK4Y,OAAS,EAC1BlV,EAAmB,EAAf1D,KAAK2Y,QAAcE,GAAQ,EAAIA,GACvCnV,GAAK1D,KAAK0Y,OAAOhV,EAAI/C,EAErB,IAAIrB,EAAIU,KAAK0Y,OAAOpZ,EAAIqB,EACpBmW,EAAmB9W,KAAKqI,eAC5B,GAAIzI,GAAGiI,MAAMC,yBAA0B,CACnC,IAAIiP,EAAU/W,KAAKE,OAAOZ,EACtB0X,EAAUhX,KAAKE,OAAOwD,EACtBuT,EAAsBjX,KAAKmG,kBAE/B2Q,EAAiBxX,EAAIwX,EAAiBxX,EAAIyX,EAAUE,EAAoB3X,EACxEwX,EAAiBpT,EAAIoT,EAAiBpT,EAAIsT,EAAUC,EAAoBvT,EACxEpE,GAAQwX,EAAiBxX,EACzBoE,GAAQoT,EAAiBpT,EAC5BuT,EAAoB3X,EAAIA,EACxB2X,EAAoBvT,EAAIA,EACxB1D,KAAKE,OAAO4E,YAAYxF,EAAGoE,QAExB1D,KAAKE,OAAO4E,YAAYgS,EAAiBxX,EAAIA,EAAGwX,EAAiBpT,EAAIA,KAKjF7B,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAG4Y,OAAOxY,KAAKwB,UAAW5B,GAAGqE,IAAIjE,KAAK0Y,OAAOpZ,GAAIU,KAAK0Y,OAAOhV,GAAI1D,KAAK2Y,QAAS3Y,KAAK4Y,QAGrG,OAFA5Y,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAqBfV,GAAGkZ,OAAS,SAAUlX,EAAU+U,EAAUjT,EAAGE,EAAQ6U,GACjD,OAAO,IAAI7Y,GAAG4Y,OAAO5W,EAAU+U,EAAUjT,EAAGE,EAAQ6U,IAiBxD7Y,GAAGmZ,OAASnZ,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAG4Y,OAEZzY,KAAK,SAAU6B,EAAU+U,EAAUjT,EAAGE,EAAQ6U,GAC1CzY,KAAKoX,aAAexX,GAAGqE,GAAG,EAAG,QAClBoC,IAAXzC,GAAwB5D,KAAKsG,iBAAiB1E,EAAU+U,EAAUjT,EAAGE,EAAQ6U,IAcjFnS,iBAAiB,SAAU1E,EAAU+U,EAAUjT,EAAGE,EAAQ6U,GACtD,QAAI7Y,GAAG4Y,OAAOlW,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,EAAU+U,EAAUjT,EAAGE,EAAQ6U,UACjEpS,IAAVoS,IACA/U,EAAIiT,EAASjT,EACbiT,EAAWA,EAASrX,GAExBU,KAAKoX,aAAa9X,EAAIqX,EACtB3W,KAAKoX,aAAa1T,EAAIA,GACf,IAKflD,gBAAgB,SAAUN,GACtBN,GAAG4Y,OAAOlW,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAC/CF,KAAK0Y,OAAOpZ,EAAIU,KAAKoX,aAAa9X,EAAIU,KAAKqI,eAAe/I,EAC1DU,KAAK0Y,OAAOhV,EAAI1D,KAAKoX,aAAa1T,EAAI1D,KAAKqI,eAAe3E,GAG9DrD,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGmZ,OAGpB,OAFA/Y,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAKoX,aAAcpX,KAAK2Y,QAAS3Y,KAAK4Y,QACvEtY,KAqBfV,GAAGoZ,OAAS,SAAUpX,EAAU+U,EAAUjT,EAAGE,EAAQ6U,GACjD,OAAO,IAAI7Y,GAAGmZ,OAAOnX,EAAU+U,EAAUjT,EAAGE,EAAQ6U,IAmBxD7Y,GAAGqZ,SAAWrZ,GAAGE,OACbb,KAAM,cACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAUqH,EAAG+E,GACdnM,KAAKkZ,WACLlZ,KAAKqI,eAAiBzI,GAAGqE,GAAG,EAAG,GAC/BjE,KAAKmG,kBAAoBvG,GAAGqE,GAAG,EAAG,GAClCkI,GAAKvM,GAAGqZ,SAAS3W,UAAUgE,iBAAiB/D,KAAKvC,KAAMoH,EAAG+E,IAS9D7F,iBAAiB,SAAUc,EAAG+E,GAC1B,QAAIvM,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAMoH,KACxDpH,KAAKkZ,QAAU/M,GACR,IAKf9L,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGqZ,SACpBjZ,KAAK+R,iBAAiBzR,GAEtB,IADA,IAAI6Y,KACK5Z,EAAI,EAAGA,EAAIS,KAAKkZ,QAAQ1Z,OAAQD,IAAK,CAC1C,IAAI6Z,EAAUpZ,KAAKkZ,QAAQ3Z,GAC3B4Z,EAAWzT,KAAK9F,GAAGqE,GAAGmV,EAAQ9Z,EAAG8Z,EAAQ1V,IAG7C,OADApD,EAAOgG,iBAAiBtG,KAAKwB,UAAW2X,GACjC7Y,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvD,IAAI0W,EAAU1W,EAAOZ,EACjBuX,EAAU3W,EAAOwD,EACrB1D,KAAKmG,kBAAkB7G,EAAIsX,EAC3B5W,KAAKmG,kBAAkBzC,EAAImT,EAC3B7W,KAAKqI,eAAe/I,EAAIsX,EACxB5W,KAAKqI,eAAe3E,EAAImT,GAG5BhW,OAAO,SAAUF,GAEb,GADAA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,OAAQ,CACb,IAAImZ,EAAYrZ,KAAKkZ,QAEjBI,EAAKD,EAAU,GAAG/Z,EAClBia,EAAKF,EAAU,GAAG/Z,EAClBka,EAAKH,EAAU,GAAG/Z,EAGlBma,EAAKJ,EAAU,GAAG3V,EAClBgW,EAAKL,EAAU,GAAG3V,EAClBiW,EAAKN,EAAU,GAAG3V,EAElBpE,EAAI+R,EAVC,EAUYiI,EAAIC,EAAIC,EAAI7Y,GAC7B+C,EAAI2N,EANC,EAMYoI,EAAIC,EAAIC,EAAIhZ,GAE7BmW,EAAmB9W,KAAKqI,eAC5B,GAAIzI,GAAGiI,MAAMC,yBAA0B,CACnC,IAAIiP,EAAU/W,KAAKE,OAAOZ,EACtB0X,EAAUhX,KAAKE,OAAOwD,EACtBuT,EAAsBjX,KAAKmG,kBAE/B2Q,EAAiBxX,EAAIwX,EAAiBxX,EAAIyX,EAAUE,EAAoB3X,EACxEwX,EAAiBpT,EAAIoT,EAAiBpT,EAAIsT,EAAUC,EAAoBvT,EACxEpE,GAAQwX,EAAiBxX,EACzBoE,GAAQoT,EAAiBpT,EAC5BuT,EAAoB3X,EAAIA,EACxB2X,EAAoBvT,EAAIA,EACxB1D,KAAKE,OAAO4E,YAAYxF,EAAGoE,QAExB1D,KAAKE,OAAO4E,YAAYgS,EAAiBxX,EAAIA,EAAGwX,EAAiBpT,EAAIA,KAKjF7B,QAAQ,WACJ,IAAIwX,EAAYrZ,KAAKkZ,QACjBU,EAAKP,EAAU,GAAG/Z,EAAGua,EAAKR,EAAU,GAAG3V,EACvCoW,EAAKT,EAAU,GAAG/Z,EAAGya,EAAKV,EAAU,GAAG3V,EACvCsW,EAAKX,EAAU,GAAG/Z,EAAG2a,EAAKZ,EAAU,GAAG3V,EACvCwW,GACAta,GAAGqE,GAAG6V,EAAKE,EAAID,EAAKE,GACpBra,GAAGqE,GAAG2V,EAAKI,EAAIH,EAAKI,GACpBra,GAAGqE,IAAI+V,GAAKC,IACZ3Z,EAAS,IAAIV,GAAGqZ,SAASjZ,KAAKwB,UAAW0Y,GAG7C,OAFAla,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAkBfV,GAAGua,SAAW,SAAU/S,EAAG+E,GACvB,OAAO,IAAIvM,GAAGqZ,SAAS7R,EAAG+E,IAa9BvM,GAAGwa,SAAWxa,GAAGE,OACbb,KAAM,cACNsC,QAAS3B,GAAGqZ,SAEZlZ,KAAK,SAAUqH,EAAG+E,GACdnM,KAAKqa,aACXlO,GAAKnM,KAAKsG,iBAAiBc,EAAG+E,IAS5B7F,iBAAiB,SAAUc,EAAG+E,GAC1B,QAAIvM,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAMoH,KACxDpH,KAAKqa,UAAYlO,GACV,IAKf9L,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGwa,SAGpB,OAFApa,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAKqa,WACtC/Z,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGqZ,SAAS3W,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACjD,IAAIoa,EAActa,KAAKqI,eACnBkS,EAAcva,KAAKqa,UACnBhB,EAAYrZ,KAAKkZ,QAErBG,EAAU,GAAKkB,EAAY,GAAG9V,IAAI6V,GAClCjB,EAAU,GAAKkB,EAAY,GAAG9V,IAAI6V,GAClCjB,EAAU,GAAKkB,EAAY,GAAG9V,IAAI6V,MAe1C1a,GAAG4a,SAAW,SAAUpT,EAAG+E,GACvB,OAAO,IAAIvM,GAAGwa,SAAShT,EAAG+E,IAkB9BvM,GAAG6a,QAAU7a,GAAGE,OACZb,KAAM,aACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAU2V,EAAIC,GACzBxX,KAAK0a,QAAU,EACf1a,KAAK2a,QAAU,EACf3a,KAAK4a,aAAe,EACpB5a,KAAK6a,aAAe,EACpB7a,KAAK8a,WAAa,EAClB9a,KAAK+a,WAAa,EAClB/a,KAAK+X,QAAU,EACf/X,KAAKgY,QAAU,OACR3R,IAAPkR,GAAoB3X,GAAG6a,QAAQnY,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,EAAU2V,EAAIC,IAUvFlR,iBAAiB,SAAU1E,EAAU2V,EAAIC,GACrC,QAAI5X,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACxD5B,KAAK8a,WAAavD,EAClBvX,KAAK+a,WAAoB,MAANvD,EAAcA,EAAKD,GAC/B,IAKflX,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG6a,QAGpB,OAFAza,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK8a,WAAY9a,KAAK+a,YACvDza,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAK4a,aAAe1a,EAAOyP,OAC3B3P,KAAK6a,aAAe3a,EAAO+P,OAC3BjQ,KAAK+X,QAAU/X,KAAK8a,WAAa9a,KAAK4a,aACtC5a,KAAKgY,QAAUhY,KAAK+a,WAAa/a,KAAK6a,cAG1Cha,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,SACLF,KAAKE,OAAOyP,OAAS3P,KAAK4a,aAAe5a,KAAK+X,QAAUpX,EAC3DX,KAAKE,OAAO+P,OAASjQ,KAAK6a,aAAe7a,KAAKgY,QAAUrX,MAoBjEf,GAAGob,QAAU,SAAUpZ,EAAU2V,EAAIC,GACjC,OAAO,IAAI5X,GAAG6a,QAAQ7Y,EAAU2V,EAAIC,IASxC5X,GAAGqb,QAAUrb,GAAGE,OACZb,KAAM,aACNsC,QAAS3B,GAAG6a,QAEZja,gBAAgB,SAAUN,GACtBN,GAAG6a,QAAQnY,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAChDF,KAAK+X,QAAU/X,KAAK4a,aAAe5a,KAAK8a,WAAa9a,KAAK4a,aAC1D5a,KAAKgY,QAAUhY,KAAK6a,aAAe7a,KAAK+a,WAAa/a,KAAK6a,cAG9DhZ,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAGqb,QAAQjb,KAAKwB,UAAW,EAAIxB,KAAK8a,WAAY,EAAI9a,KAAK+a,YAG1E,OAFA/a,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,GAGXD,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGqb,QAGpB,OAFAjb,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK8a,WAAY9a,KAAK+a,YACvDza,KAoBfV,GAAGsb,QAAU,SAAUtZ,EAAU2V,EAAIC,GACjC,OAAO,IAAI5X,GAAGqb,QAAQrZ,EAAU2V,EAAIC,IAWxC5X,GAAGub,MAAQvb,GAAGE,OACVb,KAAM,WACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAUwZ,GACrBpb,KAAKwU,OAAS,EACdxU,KAAKqb,gBAAiB,OACjBhV,IAAX+U,GAAwBpb,KAAKsG,iBAAiB1E,EAAUwZ,IAStD9U,iBAAiB,SAAU1E,EAAUwZ,GACjC,QAAIxb,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACxD5B,KAAKwU,OAAS4G,GACP,IAKf/a,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGub,MAGpB,OAFAnb,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAKwU,QACtClU,GAGXO,OAAO,SAAUF,GAEb,GADAA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,SAAWF,KAAKO,SAAU,CAC/B,IAAIiI,EAAQ,EAAMxI,KAAKwU,OACnB8G,EAAI3a,EAAK6H,EACbxI,KAAKE,OAAOqb,QAAWD,EAAK9S,EAAQ,EAAM,IAAM,IAIxDhI,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAKqb,eAAiBnb,EAAOqb,SAGjC9a,KAAK,WACDT,KAAKE,OAAOqb,QAAUvb,KAAKqb,eAC3Bzb,GAAGiG,eAAevD,UAAU7B,KAAK8B,KAAKvC,OAG1C6B,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAGub,MAAMnb,KAAKwB,UAAWxB,KAAKwU,QAG/C,OAFAxU,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAcfV,GAAG4b,MAAQ,SAAU5Z,EAAUwZ,GAC3B,OAAO,IAAIxb,GAAGub,MAAMvZ,EAAUwZ,IAYlCxb,GAAG6b,OAAS7b,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAU2Z,GACrBvb,KAAK0b,WAAa,EAClB1b,KAAK2b,aAAe,OACRtV,IAAZkV,GAAyB3b,GAAG6b,OAAOnZ,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,EAAU2Z,IASvFjV,iBAAiB,SAAU1E,EAAU2Z,GACjC,QAAI3b,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACxD5B,KAAK0b,WAAaH,GACX,IAKflb,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG6b,OAGpB,OAFAzb,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK0b,YACtCpb,GAGXO,OAAO,SAAUyL,GACbA,EAAOtM,KAAK0G,iBAAiB4F,GAC7B,IAAIsP,OAAoCvV,IAAtBrG,KAAK2b,aAA6B3b,KAAK2b,aAAe,IACxE3b,KAAKE,OAAOqb,QAAUK,GAAe5b,KAAK0b,WAAaE,GAAetP,GAG1E9L,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAK2b,aAAezb,EAAOqb,WAiBnC3b,GAAGic,OAAS,SAAUja,EAAU2Z,GAC5B,OAAO,IAAI3b,GAAG6b,OAAO7Z,EAAU2Z,IASnC3b,GAAGkc,OAASlc,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAG6b,OAEZ1b,KAAK,SAAU6B,GACK,MAAZA,IACAA,EAAW,GACf5B,KAAK+b,eAAiB,KACtB/b,KAAKsG,iBAAiB1E,EAAU,MAGpCC,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAGoc,QAIpB,OAHA1b,EAAOgG,iBAAiBtG,KAAKwB,UAAW,GACxCxB,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,GAGXD,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGkc,OAGpB,OAFA9b,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK0b,YACtCpb,GAGXE,gBAAgB,SAAUN,GACnBF,KAAK+b,iBACJ/b,KAAK0b,WAAa1b,KAAK+b,eAAeJ,cAC1C/b,GAAG6b,OAAOnZ,UAAU9B,gBAAgB+B,KAAKvC,KAAME,MAcvDN,GAAGqc,OAAS,SAAUra,GAClB,OAAO,IAAIhC,GAAGkc,OAAOla,IAUzBhC,GAAGoc,QAAUpc,GAAGE,OACZb,KAAM,aACNsC,QAAS3B,GAAG6b,OAEZ1b,KAAK,SAAU6B,GACK,MAAZA,IACAA,EAAW,GACf5B,KAAK+b,eAAiB,KACtB/b,KAAKsG,iBAAiB1E,EAAU,IAGpCC,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAGkc,OAKpB,OAJAxb,EAAOyb,eAAiB/b,KACxBM,EAAOgG,iBAAiBtG,KAAKwB,UAAW,KACxCxB,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,GAGXD,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGoc,QAGpB,OAFAhc,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK0b,YACtCpb,KAcfV,GAAGsc,QAAU,SAAU9P,GACnB,OAAO,IAAIxM,GAAGoc,QAAQ5P,IAc1BxM,GAAGuc,OAASvc,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAUwa,EAAKC,EAAOC,GACjCtc,KAAKuc,IAAM3c,GAAG4c,MAAM,EAAG,EAAG,GAC1Bxc,KAAKyc,MAAQ7c,GAAG4c,MAAM,EAAG,EAAG,GAExBJ,aAAexc,GAAG8c,QAClBJ,EAAOF,EAAIlQ,EACXmQ,EAAQD,EAAIO,EACZP,EAAMA,EAAIlC,QAGL7T,IAATiW,GAAsBtc,KAAKsG,iBAAiB1E,EAAUwa,EAAKC,EAAOC,IAWtEhW,iBAAiB,SAAU1E,EAAUwa,EAAKC,EAAOC,GAC7C,QAAI1c,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACxD5B,KAAKuc,IAAM3c,GAAG4c,MAAMJ,EAAKC,EAAOC,IACzB,IAKfjc,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGuc,OACpBnc,KAAK+R,iBAAiBzR,GACtB,IAAIsc,EAAQ5c,KAAKuc,IAEjB,OADAjc,EAAOgG,iBAAiBtG,KAAKwB,UAAWob,EAAM1C,EAAG0C,EAAMD,EAAGC,EAAM1Q,GACzD5L,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAEvDF,KAAKyc,MAAQzc,KAAKE,OAAOsc,OAG7B3b,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GAC3B,IAAIkc,EAAU7c,KAAKyc,MAAOG,EAAQ5c,KAAKuc,IACnCM,IACA7c,KAAKE,OAAOsc,MAAQ5c,GAAG4c,MACfK,EAAQ3C,GAAK0C,EAAM1C,EAAI2C,EAAQ3C,GAAKvZ,EACpCkc,EAAQF,GAAKC,EAAMD,EAAIE,EAAQF,GAAKhc,EACpCkc,EAAQ3Q,GAAK0Q,EAAM1Q,EAAI2Q,EAAQ3Q,GAAKvL,OAkBxDf,GAAGkd,OAAS,SAAUlb,EAAUwa,EAAKC,EAAOC,GACxC,OAAO,IAAI1c,GAAGuc,OAAOva,EAAUwa,EAAKC,EAAOC,IAe/C1c,GAAGmd,OAASnd,GAAGE,OACXb,KAAM,YACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAUob,EAAUC,EAAYC,GAC3Cld,KAAKmd,QAAU,EACfnd,KAAKod,QAAU,EACfpd,KAAKqd,QAAU,EACfrd,KAAKsd,OAAS,EACdtd,KAAKud,OAAS,EACdvd,KAAKwd,OAAS,OACNnX,IAAd6W,GAA2Bld,KAAKsG,iBAAiB1E,EAAUob,EAAUC,EAAYC,IAW/E5W,iBAAiB,SAAU1E,EAAUob,EAAUC,EAAYC,GACvD,QAAItd,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACxD5B,KAAKmd,QAAUH,EACfhd,KAAKod,QAAUH,EACfjd,KAAKqd,QAAUH,GACR,IAKf7c,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGmd,OAGpB,OAFA/c,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAKmd,QAASnd,KAAKod,QAASpd,KAAKqd,SAClE/c,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GAEvD,IAAIsc,EAAQtc,EAAOsc,MACnBxc,KAAKsd,OAASd,EAAMtC,EACpBla,KAAKud,OAASf,EAAMG,EACpB3c,KAAKwd,OAAShB,EAAMtQ,GAGxBrL,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GAE3BX,KAAKE,OAAOsc,MAAQ5c,GAAG4c,MAAMxc,KAAKsd,OAAStd,KAAKmd,QAAUxc,EAC9BX,KAAKud,OAASvd,KAAKod,QAAUzc,EAC7BX,KAAKwd,OAASxd,KAAKqd,QAAU1c,IAG7DkB,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAGmd,OAAO/c,KAAKwB,WAAYxB,KAAKmd,SAAUnd,KAAKod,SAAUpd,KAAKqd,SAG/E,OAFArd,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAmBfV,GAAG6d,OAAS,SAAU7b,EAAUob,EAAUC,EAAYC,GAClD,OAAO,IAAItd,GAAGmd,OAAOnb,EAAUob,EAAUC,EAAYC,IAOzDtd,GAAG8d,UAAY9d,GAAGE,OACdb,KAAM,eACNsC,QAAS3B,GAAGiG,eAEZhF,OAAO,SAAUF,KAEjBkB,QAAQ,WACJ,IAAIvB,EAAS,IAAIV,GAAG8d,UAAU1d,KAAKwB,WAGnC,OAFAxB,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,GAGXD,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG8d,UAGpB,OAFA1d,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,WACtBlB,KAcfV,GAAG4V,UAAY,SAAUpJ,GACrB,OAAO,IAAIxM,GAAG8d,UAAUtR,IAgB5BxM,GAAG+d,YAAc/d,GAAGE,OAChBb,KAAM,iBACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAUO,GACXN,KAAK4d,OAAS,KACpBtd,GAAUN,KAAKkC,eAAe5B,IAO5B4B,eAAe,SAAU5B,GACrB,OAAKA,EAIDA,IAAWN,KAAK4d,QAChBhe,GAAGyC,QAAQ,OACJ,KAGPzC,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAMM,EAAOkB,aAE/DxB,KAAK4d,OAAStd,GACP,IAXPV,GAAGyC,QAAQ,OACJ,IAefhC,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAG+d,YAGpB,OAFA3d,KAAK+R,iBAAiBzR,GACtBA,EAAO4B,eAAelC,KAAK4d,OAAOvd,SAC3BC,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAK4d,OAAOpd,gBAAgBN,IAGhCW,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAK4d,QACL5d,KAAK4d,OAAO/c,OAAO,EAAIF,IAG/BkB,QAAQ,WACJ,OAAO7B,KAAK4d,OAAOvd,SAGvBI,KAAK,WACDT,KAAK4d,OAAOnd,OACZb,GAAGC,OAAOyC,UAAU7B,KAAK8B,KAAKvC,SActCJ,GAAGie,YAAc,SAAUvd,GACvB,OAAO,IAAIV,GAAG+d,YAAYrd,IAa9BV,GAAGke,eAAiBle,GAAGE,OACnBb,KAAM,oBACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAM,SAAUG,EAAQI,GACpBN,KAAK+d,QAAU,KACf/d,KAAKge,cAAgB,KAC3B1d,GAAUN,KAAKuD,eAAerD,EAAQI,IASpCiD,eAAe,SAAUrD,EAAQI,GAC7B,QAAIN,KAAKsG,iBAAiBhG,EAAOkB,aAC7BxB,KAAKge,cAAgB9d,EACrBF,KAAK+d,QAAUzd,GACR,IAKfD,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGke,eAGpB,OAFA9d,KAAK+R,iBAAiBzR,GACtBA,EAAOiD,eAAevD,KAAKge,cAAehe,KAAK+d,QAAQ1d,SAChDC,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAK+d,QAAQvd,gBAAgBR,KAAKge,gBAGtCvd,KAAK,WACDT,KAAK+d,QAAQtd,QAGjBI,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GAC3BX,KAAK+d,QAAQld,OAAOF,IAOxBsd,gBAAgB,WACZ,OAAOje,KAAKge,eAOhBE,gBAAgB,SAAUC,GAClBne,KAAKge,gBAAkBG,IACvBne,KAAKge,cAAgBG,MAYjCve,GAAGwe,eAAiB,SAAUle,EAAQI,GAClC,OAAO,IAAIV,GAAGke,eAAe5d,EAAQI,4BC7/EzCZ,EAAQ,4BACR,IAAI2e,EAAK3e,EAAQ,uBAmCjBE,GAAG0e,cAAgB,WACfte,KAAKue,aAAeF,EAAGG,WAAU,GACjCxe,KAAKye,iBACLze,KAAK0e,eAAiB,KACtB9e,GAAG+e,SAASC,YAAchf,GAAG+e,SAASC,WAAWC,gBAAgB7e,OAErEJ,GAAG0e,cAAchc,WACbwc,YAAalf,GAAG0e,cAChBS,gBAEAC,uBAAuB,SAAUC,EAAK/e,GAClC,IAAK,IAAIgf,EAAI,EAAGA,EAAID,EAAIzf,OAAQ0f,IAC5B,GAAIhf,IAAW+e,EAAIC,GAAGhf,OAClB,OAAO+e,EAAIC,GAEnB,OAAO,MAGXC,YAAa,SAAUjf,EAAQkf,GAC3B,IAAIC,EAAUrf,KAAK+e,aAAarW,MAMhC,OALK2W,IACDA,EAAU,IAjDJ,WACdrf,KAAKsf,WACLtf,KAAKE,OAAS,KACdF,KAAKuf,YAAc,EACnBvf,KAAKwf,cAAgB,KACrBxf,KAAKof,QAAS,EACdpf,KAAKyf,MAAO,IA6CRJ,EAAQnf,OAASA,EACjBmf,EAAQD,SAAWA,EACZC,GAGXK,YAAa,SAAUL,GACnBA,EAAQC,QAAQ9f,OAAS,EACzB6f,EAAQE,YAAc,EACtBF,EAAQG,cAAgB,KACxBH,EAAQD,QAAS,EACjBC,EAAQnf,OAAS,KACjBmf,EAAQI,MAAO,EACfzf,KAAK+e,aAAarZ,KAAK2Z,IAoB3BM,UAAU,SAAUrf,EAAQJ,EAAQkf,GAChC,GAAK9e,GAAWJ,EAAhB,CAMA,IAAImf,EAAUrf,KAAKue,aAAare,EAAO0f,KAElCP,EAKKA,EAAQC,UACdD,EAAQC,aALRD,EAAUrf,KAAKmf,YAAYjf,EAAQkf,GACnCpf,KAAKue,aAAare,EAAO0f,KAAOP,EAChCrf,KAAKye,cAAc/Y,KAAK2Z,IAM5BA,EAAQC,QAAQ5Z,KAAKpF,GACrBA,EAAOE,gBAAgBN,QAjBnBN,GAAGyC,QAAQ,MAyBnBwd,iBAAiB,WAEb,IADA,IAAIC,EAAa9f,KAAKye,cACblf,EAAI,EAAGA,EAAIugB,EAAWtgB,OAAQD,IAAK,CACxC,IAAI8f,EAAUS,EAAWvgB,GACrB8f,GACArf,KAAK0f,YAAYL,GAEzBrf,KAAKye,cAAcjf,OAAS,EAC5BQ,KAAKue,aAAeF,EAAGG,WAAU,IAarCuB,2BAA2B,SAAU7f,EAAQ8f,GAEzC,GAAc,MAAV9f,EAAJ,CAEA,IAAImf,EAAUrf,KAAKue,aAAare,EAAO0f,KACnCP,IACAA,EAAQC,QAAQ9f,OAAS,EACzBQ,KAAKigB,mBAAmBZ,MAShCa,aAAa,SAAU5f,GAEnB,GAAc,MAAVA,EAAJ,CAEA,IAAIJ,EAASI,EAAOU,oBAChBqe,EAAUrf,KAAKue,aAAare,EAAO0f,KAEvC,GAAIP,GACA,IAAK,IAAI9f,EAAI,EAAGA,EAAI8f,EAAQC,QAAQ9f,OAAQD,IACxC,GAAI8f,EAAQC,QAAQ/f,KAAOe,EAAQ,CAC/B+e,EAAQC,QAAQa,OAAO5gB,EAAG,GAEtB8f,EAAQE,aAAehgB,GACvB8f,EAAQE,cACZ,YAIR3f,GAAGgB,MAAM,QAWjBwf,kBAAkB,SAAUjgB,EAAKD,GAC1BC,IAAQP,GAAGC,OAAOO,aACjBR,GAAGgB,MAAM,MAEbhB,GAAGygB,SAASngB,EAAQ,MAEpB,IAAImf,EAAUrf,KAAKue,aAAare,EAAO0f,KAEvC,GAAIP,EAEA,IADA,IAAIiB,EAAQjB,EAAQC,QAAQ9f,OACnBD,EAAI,EAAGA,EAAI+gB,IAAS/gB,EAAG,CAC5B,IAAIe,EAAS+e,EAAQC,QAAQ/f,GAC7B,GAAIe,GAAUA,EAAOY,WAAaf,GAAOG,EAAOU,sBAAwBd,EAAQ,CAC5EF,KAAKugB,qBAAqBhhB,EAAG8f,GAC7B,SAchBmB,eAAe,SAAUrgB,EAAKD,GACvBC,IAAQP,GAAGC,OAAOO,aACjBR,GAAGgB,MAAM,MAEb,IAAIye,EAAUrf,KAAKue,aAAare,EAAO0f,KACvC,GAAIP,EAAS,CACT,GAAuB,MAAnBA,EAAQC,QACR,IAAK,IAAI/f,EAAI,EAAGA,EAAI8f,EAAQC,QAAQ9f,SAAUD,EAAG,CAC7C,IAAIe,EAAS+e,EAAQC,QAAQ/f,GAC7B,GAAIe,GAAUA,EAAOY,WAAaf,EAC9B,OAAOG,EAGnBV,GAAGgB,MAAM,KAAMT,GAEnB,OAAO,MAsBXsgB,kCAAkC,SAAUvgB,GACxC,IAAImf,EAAUrf,KAAKue,aAAare,EAAO0f,KACvC,OAAIP,GACQA,EAAQC,QAAWD,EAAQC,QAAQ9f,OAExC,GAQXkhB,YAAY,SAAUxgB,GAClB,IAAImf,EAAUrf,KAAKue,aAAare,EAAO0f,KACnCP,IACAA,EAAQD,QAAS,IAQzBuB,aAAa,SAAUzgB,GACnB,IAAImf,EAAUrf,KAAKue,aAAare,EAAO0f,KACnCP,IACAA,EAAQD,QAAS,IASzBwB,uBAAuB,WAGnB,IAFA,IAAIC,KACAf,EAAa9f,KAAKye,cACdlf,EAAI,EAAGA,EAAGugB,EAAWtgB,OAAQD,IAAI,CACrC,IAAI8f,EAAUS,EAAWvgB,GACtB8f,IAAYA,EAAQD,SACnBC,EAAQD,QAAS,EACjByB,EAAenb,KAAK2Z,EAAQnf,SAGpC,OAAO2gB,GASXC,cAAc,SAASC,GACnB,GAAKA,EAGL,IAAK,IAAIxhB,EAAI,EAAGA,EAAGwhB,EAAgBvhB,OAAQD,IACpCwhB,EAAgBxhB,IACfS,KAAK2gB,aAAaI,EAAgBxhB,KAU9CyhB,aAAa,SAASC,GAClB,GAAKA,EAGL,IAAK,IAAI1hB,EAAI,EAAGA,EAAG0hB,EAAezhB,OAAQD,IAClC0hB,EAAe1hB,IACfS,KAAK0gB,YAAYO,EAAe1hB,KAa5C2hB,mBAAmB,WACfthB,GAAG+e,SAASwC,eAAeC,iBAAiBphB,OAIhDugB,qBAAqB,SAAUc,EAAOhC,GACrBA,EAAQC,QAAQ+B,GAE7BhC,EAAQC,QAAQa,OAAOkB,EAAO,GAG1BhC,EAAQE,aAAe8B,GACvBhC,EAAQE,cAEmB,IAA3BF,EAAQC,QAAQ9f,QAChBQ,KAAKigB,mBAAmBZ,IAIhCY,mBAAmB,SAAUZ,GACzB,IAAIhK,GAAM,EACV,GAAIgK,IAAYA,EAAQI,MAChBzf,KAAKue,aAAac,EAAQnf,OAAO0f,KAAM,QAChC5f,KAAKue,aAAac,EAAQnf,OAAO0f,KAExC,IADA,IAAI0B,EAAUthB,KAAKye,cACVlf,EAAI,EAAGgiB,EAAID,EAAQ9hB,OAAQD,EAAIgiB,EAAGhiB,IACvC,GAAI+hB,EAAQ/hB,KAAO8f,EAAS,CACxBiC,EAAQnB,OAAO5gB,EAAG,GAClB,MAGRS,KAAK0f,YAAYL,GACjBhK,GAAM,EAGd,OAAOA,GASXxU,OAAO,SAAUF,GAEb,IADA,IAAsC6gB,EAAlC1B,EAAa9f,KAAKye,cACbgD,EAAM,EAAGA,EAAM3B,EAAWtgB,OAAQiiB,IAAO,CAG9C,GAFAzhB,KAAK0e,eAAiBoB,EAAW2B,KACjCD,EAAgBxhB,KAAK0e,gBACFU,QAAUoC,EAAclC,QAAS,CAGhD,IAFAkC,EAAc/B,MAAO,EAEhB+B,EAAcjC,YAAc,EAAGiC,EAAcjC,YAAciC,EAAclC,QAAQ9f,OAAQgiB,EAAcjC,cAExG,GADAiC,EAAchC,cAAgBgC,EAAclC,QAAQkC,EAAcjC,aAC7DiC,EAAchC,cAAnB,CAMA,GAFAgC,EAAchC,cAAc9e,KAAKC,GAAO6gB,EAAchC,cAAc5N,aAAe4P,EAAchC,cAAcxd,OAAS,IAEpHwf,EAAchC,eAAiBgC,EAAchC,cAAcjf,SAAU,CACrEihB,EAAchC,cAAc/e,OAC5B,IAAIH,EAASkhB,EAAchC,cAE3BgC,EAAchC,cAAgB,KAC9Bxf,KAAKkgB,aAAa5f,GAGtBkhB,EAAchC,cAAgB,KAElCgC,EAAc/B,MAAO,EAGY,IAAjC+B,EAAclC,QAAQ9f,QACtBQ,KAAKigB,mBAAmBuB,IAAkBC,uFC/Z1D/hB,EAAQ,qBACRA,EAAQ,cACRA,EAAQ,sBACRA,EAAQ,qBACRA,EAAQ,kBACRA,EAAQ,6KCLR,IAAI2e,EAAKze,GAAGye,GACRqD,EAAWhiB,EAAQ,cACnBiiB,EAAmBjiB,EAAQ,sBAAsBiiB,iBACjDC,EAAiBliB,EAAQ,sBAAsBkiB,eAC/CC,EAAoBniB,EAAQ,wBAAwBmiB,kBACpDC,EAAiBpiB,EAAQ,sBAAsBoiB,eAC/CC,EAAYriB,EAAQ,sBAAsBqiB,UAC1CC,EAAetiB,EAAQ,WAAWsiB,aAClCC,EAAeviB,EAAQ,+BAA+BwiB,oBAI1D,SAASC,EAAmBjiB,EAAQkiB,GAChCV,EAASnf,KAAKvC,MACdA,KAAKE,OAASA,EACdF,KAAKoiB,UAAYA,EAEjBpiB,KAAKqiB,OAAS,IAAIhE,EAAGiE,MAAMC,2BAE/BlE,EAAGmE,OAAOL,EAAmBT,GAC7B,IAAIlb,EAAI2b,EAAkB7f,UAiL1B,SAASmgB,EAAcC,EAAMC,GACzB,IAAIC,EAAOD,EAAMC,KAEbC,EAASF,EAAME,OAiBnB,SAASC,EAAgBC,GACrB,IAAK1P,MAAM2P,QAAQD,GAAa,OAAO,EAEvC,IAAK,IAAIxjB,EAAI,EAAGgiB,EAAIwB,EAAWvjB,OAAQD,EAAIgiB,EAAGhiB,IAAK,CAC/C,IAAI0jB,EAAWF,EAAWxjB,GAE1B,IAAK8T,MAAM2P,QAAQC,IAAiC,IAApBA,EAASzjB,OAAc,OAAO,EAGlE,OAAO,EAGX,SAAS0jB,EAAiBhjB,EAAQijB,EAAUC,GACxC,IAUIC,EAVAC,EAAoBpjB,aAAkBN,GAAG2jB,MACxB,aAAbJ,GACAC,EAAU,IAAM/P,MAAM2P,QAAQI,EAAU,GAAGrf,OAC/Cyf,KAEAC,EAAQ,IAAI9B,EAGhB8B,EAAMvjB,OAASA,EAGf,IAAIwjB,EAAWP,EAASQ,QAAQ,MACD,IAAdD,EAGDxjB,EADZmjB,EAAWF,EAAS3a,MAAM,EAAGkb,IAS7BL,EAAWF,EAGfM,EAAMG,KAAOP,EAEbI,EAAMI,SArEd,SAAwBV,GACpB,IAAIb,EAAQa,EAASW,MAAM,KAG3B,OAFAxB,EAAMyB,QAECzB,EAAM9iB,OAAS,EAAI8iB,EAAQ,KAiEb0B,CAAcb,GAG/B,IAAK,IAAI5jB,EAAI,EAAGgiB,EAAI6B,EAAU5jB,OAAQD,EAAIgiB,EAAGhiB,IAAK,CAC9C,IAAI0kB,EAAWb,EAAU7jB,GACrB2kB,EAAQD,EAASE,MAAQxB,EAAM/gB,SAGnC,GAFA6hB,EAAMW,OAAO1e,KAAKwe,GAEdZ,EAAkB,CAClB,IAAIP,EAAakB,EAASlB,WAEtBA,IAAeD,EAAgBC,KAC/BnjB,GAAGyC,QAAQ,KAAMnC,EAAOjB,KAAMkkB,EAAU5jB,GACxCwjB,EAAa,MAGjBS,EAAY9d,KAAKqd,GAGrB,IAAIsB,EAAaJ,EAASlgB,MAI1B0f,EAAMa,OAAO5e,KAAK2e,GAElB,IAAIE,EAAaN,EAASR,MAC1B,GAAIc,EAAY,CACZ,GAA0B,iBAAfA,EAAyB,CAChCd,EAAMe,MAAM9e,KAAK6e,GACjB,SAEC,GAAIlR,MAAM2P,QAAQuB,GAAa,CAC5BA,EAAW,KAAOA,EAAW,IAC7BA,EAAW,KAAOA,EAAW,GAC7Bd,EAAMe,MAAM9e,KAAKic,EAAiB8C,QAGlChB,EAAMe,MAAM9e,KAAKic,EAAiB+C,OAAOH,IAE7C,UAGRd,EAAMe,MAAM9e,KAAKic,EAAiB8C,QAGlCnB,GACAzB,EAAkB2B,EAAaC,EAAOb,EAAKhhB,SAAUghB,EAAK+B,QAQ9D,IAJA,IACIC,EAAcC,EADdT,EAASX,EAAMW,OAEfU,GAAc,EAETC,EAAI,EAAGC,EAAIZ,EAAO5kB,OAAQulB,EAAIC,EAAGD,IAEtC,GADAH,EAAeR,EAAOW,GAAKX,EAAOW,EAAE,GAC1B,IAANA,EACAF,EAAeD,OAEd,GAAIvf,KAAKuK,IAAIgV,EAAeC,GANvB,KAMgD,CACtDC,GAAc,EACd,MAMR,OAFArB,EAAMwB,gBAAkBH,EAAclD,EAAiBK,EAEhDwB,EAGX,SAASyB,EAAoBhlB,EAAQilB,GACjC,IAAIC,EAAYD,EAAUE,MACtBC,EAAYH,EAAUI,MAE1B,GAAIH,EACA,IAAK,IAAIjC,KAAYiC,EAAW,CAC5B,IACI3B,EAAQP,EAAgBhjB,EAAQijB,EADzBiC,EAAUjC,IAGrBN,EAAOnd,KAAK+d,GAIpB,GAAI6B,EACA,IAAK,IAAIE,KAAYF,EAAW,CAC5B,IAAIG,EAAOvlB,EAAOwlB,aAAaF,GAE/B,GAAKC,EAAL,CAIA,IAAIE,EAAWL,EAAUE,GACzB,IAAK,IAAIrC,KAAYwC,EAAU,CAEvBlC,EAAQP,EAAgBuC,EAAMtC,EADvBwC,EAASxC,IAGpBN,EAAOnd,KAAK+d,MAzJ5BZ,EAAOrjB,OAAS,EAEhBmjB,EAAM/gB,SAAWgkB,OAAOC,WAAWjD,EAAKhhB,UACxC+gB,EAAM5gB,MAAQ6jB,OAAOC,WAAWjD,EAAK7gB,OACrC4gB,EAAMmD,SAAWF,OAAOG,SAASnD,EAAKkD,UACtCnD,EAAMqD,UAAYJ,OAAOC,WAAWjD,EAAK+B,SAEpChC,EAAMmD,SAAW9D,EAAaiE,QAAUjE,EAAaiE,KACtDtD,EAAMuD,YAAcC,EAAAA,EAGpBxD,EAAMuD,YAAc,EAsJxB,IAAIf,EAAYvC,EAAKuC,UACjBiB,EAAqBjB,EAAUkB,MAInC,IAAK,IAAIC,KAFTpB,EAAmBxC,EAAMyC,GAEJiB,EAAoB,CACrC,IAAIlmB,EAASN,GAAG2mB,KAAKD,EAAU5D,GAE/B,GAAKxiB,EAKLglB,EAAmBhlB,EADGkmB,EAAmBE,IAM7C,IAAIE,EAAS5D,EAAK4D,OAElB,GAAkBA,EAGd,IAFA,IAAI/C,EAEKlkB,EAAI,EAAGgiB,EAAIiF,EAAOhnB,OAAQD,EAAIgiB,EAAGhiB,IAAK,CACtCkkB,KACDA,EAAQ,IAAI3B,GACN5hB,OAASwiB,EACfG,EAAOnd,KAAK+d,IAGhB,IAGIgD,EAHAC,EAAYF,EAAOjnB,GACnB2kB,EAAQwC,EAAUvC,MAAQxB,EAAM/gB,SAGhCyf,EAAQY,EAAawB,EAAMW,OAAQF,GACnC7C,GAAS,EACToF,EAAYhD,EAAM+C,OAAOnF,IAGzBoF,EAAY,IAAI1E,EAChB0B,EAAMW,OAAO1e,KAAKwe,GAClBT,EAAM+C,OAAO9gB,KAAK+gB,IAGtBA,EAAU5hB,IAAI6hB,EAAUC,KAAMD,EAAUE,SAhYpDpgB,EAAEqgB,UAAY,SAAUlE,EAAOmE,GACtBnE,EAAMC,OAIND,EAAMoE,aACPtE,EAAaziB,KAAKE,OAAQyiB,GAG9BA,EAAMqE,SAAWhnB,KACjB2iB,EAAMsE,OAEmB,iBAAdH,GACPnE,EAAMuE,QAAQJ,GAGlB9mB,KAAKinB,SAGTzgB,EAAE2gB,iBAAmB,SAAUxE,GAC3B,IAAIyE,EAAWpnB,KAAKqiB,OAChBC,EAAQ8E,EAAS9E,MACrB,IAAK8E,EAAS7nB,EAAI,EAAG6nB,EAAS7nB,EAAI+iB,EAAM9iB,SAAU4nB,EAAS7nB,EAAG,CAC1D,IAAI8nB,EAAO/E,EAAM8E,EAAS7nB,GACtB8nB,IAAS1E,GAIb3iB,KAAKsnB,UAAUD,KAIvB7gB,EAAE+gB,aAAe,SAAUF,IAER,IADHrnB,KAAKqiB,OAAOC,MAAMqB,QAAQ0D,IAElCrnB,KAAKqiB,OAAO3c,KAAK2hB,GAGrBA,EAAKG,gBAAgBxnB,KAAKoiB,YAG9B5b,EAAEihB,gBAAkB,SAAUJ,GAC1B,IAAIhG,EAAQrhB,KAAKqiB,OAAOC,MAAMqB,QAAQ0D,GAClChG,GAAS,GACTrhB,KAAKqiB,OAAOqF,aAAarG,GAEQ,IAA7BrhB,KAAKqiB,OAAOC,MAAM9iB,QAClBQ,KAAKS,QAITb,GAAGyC,QAAQ,MAGfglB,EAAKL,SAAW,MAGpBxgB,EAAEme,OAAS,WACP,IAAIyC,EAAWpnB,KAAKqiB,OAChBC,EAAQ8E,EAAS9E,MACrB,IAAK8E,EAAS7nB,EAAI,EAAG6nB,EAAS7nB,EAAI+iB,EAAM9iB,SAAU4nB,EAAS7nB,EAAG,CAC/C+iB,EAAM8E,EAAS7nB,GACrBolB,WAIbne,EAAE8gB,UAAY,SAAU3E,GAChBA,GACAA,EAAMliB,QAId+F,EAAEmhB,WAAa,SAAUhF,GACjBA,GACAA,EAAMiF,SAIdphB,EAAEqhB,YAAc,SAAUlF,GAClBA,GACAA,EAAMmF,SAGN9nB,KAAK+nB,UACL/nB,KAAK8nB,UAIbthB,EAAEwhB,aAAe,SAAUrF,EAAOrW,GAC9B,QAAajG,IAATiG,EACIqW,IACAA,EAAMuE,QAAQ5a,GACdqW,EAAMgC,cAGT,CACDrY,EAAOqW,EAGP,IADA,IAAIL,EAAQtiB,KAAKqiB,OAAOC,MACf/iB,EAAI,EAAGA,EAAI+iB,EAAM9iB,SAAUD,EAAG,CACnC,IAAI8nB,EAAO/E,EAAM/iB,GACjB8nB,EAAKH,QAAQ5a,GACb+a,EAAK1C,YAKjBne,EAAEyhB,OAAS,WACP,IAAIb,EAAWpnB,KAAKqiB,OAChBC,EAAQ8E,EAAS9E,MACrB,IAAK8E,EAAS7nB,EAAI,EAAG6nB,EAAS7nB,EAAI+iB,EAAM9iB,SAAU4nB,EAAS7nB,EAAG,CAC/C+iB,EAAM8E,EAAS7nB,GACrBkB,SAIb+F,EAAE0hB,QAAU,WAER,IADA,IAAI5F,EAAQtiB,KAAKqiB,OAAOC,MACf/iB,EAAI,EAAGA,EAAI+iB,EAAM9iB,SAAUD,EAAG,CACnC,IAAI8nB,EAAO/E,EAAM/iB,GACjB8nB,EAAKO,QAGLP,EAAKL,SAAW,OAIxBxgB,EAAE2hB,SAAW,WAET,IADA,IAAI7F,EAAQtiB,KAAKqiB,OAAOC,MACf/iB,EAAI,EAAGA,EAAI+iB,EAAM9iB,SAAUD,EAAG,CACnC,IAAI8nB,EAAO/E,EAAM/iB,GAGjB8nB,EAAKL,SAAWhnB,KAEhBqnB,EAAKS,WAIbthB,EAAE4hB,YAAc,SAAUzF,GACtBF,EAAaziB,KAAKE,OAAQyiB,IA8P9BxjB,EAAOE,QAAU8iB,0IChajB,IAAMkG,EAAW3oB,EAAQ,WAAW2oB,SAQhCC,EAAgB1oB,GAAGE,OACnBb,KAAM,mBACNsC,QAAS3B,GAAG2oB,MAEZC,YACIhnB,WACIinB,QAAS,EACTC,KAAM,SASV9mB,UACI+mB,IAAK,WAAc,OAAO3oB,KAAKwB,YASnCmjB,QACI8D,QAAS,IASb1mB,OACI0mB,QAAS,GASb3C,UACI2C,QAASJ,EAASO,QAUtBzD,WACIsD,WACAI,SAAS,GAWbrC,QACIiC,WACAI,SAAS,IAIjBC,SAcIC,uBAAwB,SAAUC,EAAcrE,GAC5C,IAAKtR,MAAM2P,QAAQgG,GAEf,OADAppB,GAAGyC,QAAQ,MACJ,KAGX,IAAIugB,EAAO,IAAI0F,EACf1F,EAAK+B,OAASA,GAAU/B,EAAK+B,OAE7B/B,EAAKphB,UAAYwnB,EAAaxpB,OAASojB,EAAK+B,OAK5C,IAHA,IAAIsE,KACAvoB,EAAO,EAAIkiB,EAAK+B,OAEXplB,EAAI,EAAGgiB,EAAIyH,EAAaxpB,OAAQD,EAAIgiB,EAAGhiB,IAC5C0pB,EAAO1pB,IAAO4kB,MAAQ5kB,EAAImB,EAAOqD,MAAOilB,EAAazpB,IAazD,OAVAqjB,EAAKuC,WACDI,OAEI2D,aAEIC,YAAeF,KAKpBrG,MAKnBhjB,GAAG0oB,cAAgBnpB,EAAOE,QAAUipB,uCClIpC,IAAIc,EAAe1pB,EAAQ,YAAY0pB,aAEnCnH,EAAeviB,EAAQ,+BAA+BwiB,oBACtDF,EAAetiB,EAAQ,WAAWsiB,aAClCqH,EAAc3pB,EAAQ,WAAW2pB,YAOrC,SAASC,EAAoBpF,EAAOwE,GAChC,GAAoB,iBAATA,EAAmB,CAC1B,IAAI/B,EAAO/mB,GAAG2pB,OAAOb,GACjB/B,EACAzC,EAAQyC,EAAKzC,GAGbtkB,GAAGyC,QAAQ,KAAMqmB,QAGhBrV,MAAM2P,QAAQ0F,KAEnBxE,EAAQkF,EAAaV,EAAMxE,IAG/B,OAAOA,EAUX,IAAIsF,EAAY5pB,GAAGE,OACfb,KAAM,eAQN0lB,OAAQ,SAAUrY,EAAM4X,EAAOvB,KAE/B8G,2BAAuBpjB,IAM3B,SAASub,EAAgBwC,EAAQF,GAC7B,IAAI1kB,EAAS4kB,EAAO5kB,OAAS,EAE7B,GAAe,IAAXA,EAAc,OAAO,EAEzB,IAAIkqB,EAAQtF,EAAO,GACnB,GAAIF,EAAQwF,EAAO,OAAO,EAE1B,IAAIC,EAAMvF,EAAO5kB,GACjB,GAAI0kB,EAAQyF,EAAK,OAAOnqB,EAIxB,IACI6hB,GAHJ6C,GAASA,EAAQwF,IAAUC,EAAMD,KAEhB,EAAIlqB,GAEjBoqB,EAAqB,EAARvI,EAGjB,OAAKA,EAAQuI,EAFC,KAGHA,EAEDA,EAAa,EAAIvI,EALb,KAMHuI,EAAa,IAGfA,EAAa,GAS1B,IAAIjI,EAAmB/hB,GAAGE,OACtBb,KAAM,sBACNsC,QAASioB,EAEThB,YAKItoB,OAAQ,KAKR0jB,KAAM,GAKNU,UAKAF,UAOAI,SAGAX,SAAU,MAGdoB,gBAAiBhD,EAEjB0C,OAAQ,SAAUrY,EAAM4X,EAAOvB,GAC3B,IAAI2B,EAAStkB,KAAKskB,OACdF,EAASpkB,KAAKokB,OACdyF,EAAazF,EAAO5kB,OAExB,GAAmB,IAAfqqB,EAAJ,CAKA,IAAI9lB,EACAsd,EAAQrhB,KAAKilB,gBAAgBb,EAAQF,GAEzC,GAAI7C,EAAQ,EAGR,IAFAA,GAASA,IAEI,EACTtd,EAAQugB,EAAO,QAEd,GAAIjD,GAASwI,EACd9lB,EAAQugB,EAAOuF,EAAa,OAE3B,CACD,IAAIC,EAAUxF,EAAOjD,EAAQ,GAEzB0I,EAA8B,iBAAZD,EAClBE,EAAUF,GAAWA,EAAQG,KAEjC,GAAKF,GAAaC,EAGb,CACD,IAAIE,EAAY9F,EAAO/C,EAAQ,GAC3B8I,EAAU/F,EAAO/C,GACjBqH,EAAO1oB,KAAKwkB,MAAMnD,EAAQ,GAC1B+I,GAAsBlG,EAAQgG,IAAcC,EAAUD,GAEtDxB,IACA0B,EAAqBd,EAAmBc,EAAoB1B,IAIhE,IAAI2B,EAAQ/F,EAAOjD,GAGf0I,EACAhmB,EAAQ+lB,GAAWO,EAAQP,GAAWM,EAEjCJ,IACLjmB,EAAQ+lB,EAAQG,KAAKI,EAAOD,SApBhCrmB,EAAQ+lB,OA0BhB/lB,EAAQugB,EAAOjD,GAGnB,IAAIwC,EAAW7jB,KAAK6jB,SACpB,GAAIA,EAAU,CAKV,IAHA,IAAIyG,EAAWtqB,KAAKE,OAAOF,KAAK4jB,MAC5B2G,EAAUD,EAEL/qB,EAAI,EAAGA,EAAIskB,EAASrkB,OAAS,EAAGD,IAAK,CAC1C,IAAIirB,EAAc3G,EAAStkB,GAC3B,IAAIgrB,EAIA,OAHAA,EAAUA,EAAQC,GAO1B,IAAInH,EAAWQ,EAASA,EAASrkB,OAAS,GAE1C,IAAI+qB,EAIA,OAHAA,EAAQlH,GAAYtf,EAMxBA,EAAQumB,EAIZtqB,KAAKE,OAAOF,KAAK4jB,MAAQ7f,MAIjC4d,EAAiB8C,OAAS,KAC1B9C,EAAiB+C,OAAS,SAAUvf,GAChC,OAAOA,GAUX,IAAI4c,EAAY,WACZ/hB,KAAKwmB,WAOTzE,EAAUzf,UAAUuC,IAAM,SAAU8hB,EAAMC,GACtC5mB,KAAKwmB,OAAO9gB,MACRihB,KAAMA,GAAQ,GACdC,OAAQA,SAWhB,IAAI9E,EAAiBliB,GAAGE,OACpBb,KAAM,oBACNsC,QAASioB,EAEThB,YAMItoB,OAAQ,KAMRkkB,UAMAoC,UAEAiE,cACIhC,QAAS,WACL,OAAO,IAAIY,IAInBqB,iBAAkB,KAElBC,aAAcC,KAGlBC,gBAAiB,SAAUC,GAEvB,OADIA,GAA2B,EAAbA,IAAoB,IAAGA,GAAc,GACnC,EAAbA,GAGXnG,OAAQ,SAAUrY,EAAM4X,EAAOvB,GAC3B,IAAInjB,EAASQ,KAAKokB,OAAO5kB,OAErBurB,EAAqBpI,EAAMqI,eAAerI,EAAMrW,KAAMtM,KAAKyqB,cAC3DQ,EAAYF,EAAmBE,UAC/BC,EAAejJ,EAAajiB,KAAKokB,OAAQ2G,EAAmB7G,OAchE,GAbIgH,EAAe,IACfA,GAAgBA,EAAe,EAG3BD,EAAY,IAAGC,GAAgB,IAGnClrB,KAAK2qB,eAAiBO,IACtBlrB,KAAK2qB,aAAeC,KAGxBG,EAAmBI,WAAaD,GAE3BlrB,KAAK0qB,iBAGN,OAFA1qB,KAAKorB,WAAWF,QAChBlrB,KAAK0qB,iBAAmB,IAAIrB,EAAY0B,IAI5C,IAAIjF,EAAWnD,EAAMmD,SACjBuF,EAAoBrrB,KAAK6qB,gBAAgBE,EAAmBD,YAE5DQ,EAAkBtrB,KAAK0qB,iBACvBa,EAAiBvrB,KAAK6qB,gBAAgBS,EAAgBR,YACtDU,EAAYF,EAAgBH,WAC5BM,EAAgBH,EAAgBL,UAEhCS,GAAyC,IAApBH,GAAyBF,IAAsBE,EAExE,GAAIC,IAAcN,GAAgBQ,GAAiC,IAAXlsB,EACpDQ,KAAKorB,WAAW,QAEf,GAAII,IAAcN,GAAgBQ,EAAoB,CACvDT,EAAYQ,EAEZ,EAAG,CACC,GAAID,IAAcN,EAAc,CAsB5B,IArBmB,IAAfD,GAAkC,IAAdO,GAAmBN,EAAe,IACjDpF,EAAW9D,EAAa2J,YAAc3J,EAAa2J,SACpDV,IAAc,EAGdO,EAAYhsB,EAGhB+rB,KAEmB,IAAdN,GAAmBO,IAAchsB,EAAS,GAAK0rB,EAAe1rB,EAAS,KACvEsmB,EAAW9D,EAAa2J,YAAc3J,EAAa2J,SACpDV,IAAc,EAGdO,GAAa,EAGjBD,KAGAC,IAAcN,EAAc,MAChC,GAAIK,EAAiBF,EAAmB,MAG5CG,GAAaP,EAEbrrB,GAAG+e,SAASiN,sBAAsBC,eAAe7rB,KAAM,cAAewrB,UACjEA,IAAcN,GAAgBM,GAAa,GAAKA,EAAYhsB,GAGzEQ,KAAK0qB,iBAAiBoB,IAAIf,IAG9BK,WAAY,SAAU/J,GAClB,KAAIA,EAAQ,GAAKA,GAASrhB,KAAKwmB,OAAOhnB,QAAUQ,KAAK2qB,eAAiBtJ,GAAtE,CAEA,IACImF,EADYxmB,KAAKwmB,OAAOnF,GACLmF,OAEvB,GAAMxmB,KAAKE,OAAO6rB,QAMlB,IAFA,IAAIC,EAAahsB,KAAKE,OAAO+rB,YAEpB1sB,EAAI,EAAIA,EAAIinB,EAAOhnB,OAAQD,IAIhC,IAHA,IAAI2sB,EAAQ1F,EAAOjnB,GACf4sB,EAAWD,EAAMvF,KAEZyF,EAAI,EAAGA,EAAIJ,EAAWxsB,OAAQ4sB,IAAK,CACxC,IAAIC,EAAYL,EAAWI,GACvBzF,EAAO0F,EAAUF,GAEjBxF,GAAMA,EAAK2F,MAAMD,EAAWH,EAAMtF,WAKlD6C,sBAAuB,SAAUnd,EAAMqW,GACnC3iB,KAAK0qB,iBAAmB,KACxB1qB,KAAK2qB,aAAeC,IAEpB,IAAI2B,EAAO5J,EAAMqI,eAAe1e,EAAMtM,KAAKyqB,cACvCQ,EAAYsB,EAAKtB,UACjBE,EAAalJ,EAAajiB,KAAKokB,OAAQmI,EAAKrI,OAG5CiH,EAAa,IACbA,GAAcA,EAAa,EAGvBF,EAAY,IAAGE,GAAc,GAEjCnrB,KAAK2qB,aAAeQ,MAYhChsB,EAAOE,SACHmqB,UAAWA,EACX7H,iBAAkBA,EAClBG,eAAgBA,EAChBC,UAAWA,EACXuH,mBAAoBA,EACpB1H,eAAgBA,wFC3apB,IAAIvD,EAAKze,GAAGye,GAERmO,EAAmB5sB,GAAGE,OACtBC,KAAM,WACFC,KAAKqiB,OAAS,IAAIhE,EAAGiE,MAAMC,2BAC3BviB,KAAKysB,gBAEL7sB,GAAG+e,SAASC,YAAchf,GAAG+e,SAASC,WAAWC,gBAAgB7e,OAKrEa,OAAQ,SAAUF,GACd,IAAIymB,EAAWpnB,KAAKqiB,OAChBC,EAAQ8E,EAAS9E,MACrB,IAAK8E,EAAS7nB,EAAI,EAAG6nB,EAAS7nB,EAAI+iB,EAAM9iB,SAAU4nB,EAAS7nB,EAAG,CAC1D,IAAI8nB,EAAO/E,EAAM8E,EAAS7nB,GACtB8nB,EAAKqF,aAAerF,EAAKsF,WACzBtF,EAAKxmB,OAAOF,GAKpB,IADA,IAAI6lB,EAASxmB,KAAKysB,aACTltB,EAAI,EAAGgiB,EAAIiF,EAAOhnB,OAAQD,EAAIgiB,EAAGhiB,IAAK,CAC3C,IAAI2sB,EAAQ1F,EAAOjnB,GACnB2sB,EAAMhsB,OAAOgsB,EAAMvF,MAAM2F,MAAMJ,EAAMhsB,OAAQgsB,EAAMU,MAEvDpG,EAAOhnB,OAAS,GAGpBqtB,SAAU,aAMVtF,aAAc,SAAUF,IAEL,IADHrnB,KAAKqiB,OAAOC,MAAMqB,QAAQ0D,IAElCrnB,KAAKqiB,OAAO3c,KAAK2hB,IAOzBI,gBAAiB,SAAUJ,GACvB,IAAIhG,EAAQrhB,KAAKqiB,OAAOC,MAAMqB,QAAQ0D,GAClChG,GAAS,EACTrhB,KAAKqiB,OAAOqF,aAAarG,GAGzBzhB,GAAGyC,QAAQ,OAInBwpB,eAAgB,SAAU3rB,EAAQymB,EAAMiG,GACpC5sB,KAAKysB,aAAa/mB,MACdxF,OAAQA,EACRymB,KAAMA,EACNiG,KAAMA,OAMlBhtB,GAAG4sB,iBAAmBrtB,EAAOE,QAAUmtB,2BCjEvC,IAAInO,EAAKze,GAAGye,GACRqD,EAAWhiB,EAAQ,cAEnBotB,EAAQptB,EAAQ,WAChB2pB,EAAcyD,EAAMzD,YACpBhB,EAAWyE,EAAMzE,SACjBrG,EAAe8K,EAAM9K,aAmBzB,SAAS+K,EAAgBnK,EAAM3jB,GAC3ByiB,EAASnf,KAAKvC,MAIdA,KAAKgtB,qBAAsB,EAE3BhtB,KAAKitB,OAAS,EACdjtB,KAAKktB,WAAa,EAElBltB,KAAKyqB,aAAe,IAAIpB,EACxBrpB,KAAK0qB,iBAAmB,KAExB1qB,KAAKmtB,SAAWC,EAEhBptB,KAAKqtB,MAAQzK,EACb5iB,KAAKstB,MAAQruB,GAAS2jB,GAAQA,EAAK3jB,KAMnCe,KAAKgnB,SAAW,KAQhBhnB,KAAK6iB,UAaL7iB,KAAKutB,MAAQ,EAiBbvtB,KAAKkmB,YAAc,EAUnBlmB,KAAK4B,SAAW,EAShB5B,KAAK+B,MAAQ,EAcb/B,KAAK8lB,SAAWuC,EAASO,OASzB5oB,KAAKsM,KAAO,EAGZtM,KAAKwtB,QAAU,KACfxtB,KAAKytB,mBAAoB,EACzBztB,KAAK0tB,KAAO,WAER,IADA,IAAId,EAAO,IAAIvZ,MAAMnB,UAAU1S,QACtBD,EAAI,EAAGgiB,EAAIqL,EAAKptB,OAAQD,EAAIgiB,EAAGhiB,IACpCqtB,EAAKrtB,GAAK2S,UAAU3S,GAExBK,GAAG+e,SAASiN,sBAAsBC,eAAe7rB,KAAM,QAAS4sB,IAGxEvO,EAAGmE,OAAOuK,EAAgBrL,GAE1B,IAAIiM,EAAQZ,EAAezqB,UAoG3B,SAAS8qB,IAEL,IAGQQ,EAHJrB,EAAOvsB,KAAK2kB,SAEZ3kB,KAAKytB,oBAKDG,EAHC5tB,KAAK0qB,iBAGK1qB,KAAK0qB,iBAFL1qB,KAAK0qB,iBAAmB,IAAIrB,EAAYkD,GAKnDvsB,KAAKkmB,YAAc,IAAyB,EAAlBqG,EAAKzB,aAAyC,EAAtB8C,EAAS9C,aAC3D9qB,KAAK0tB,KAAK,YAAa1tB,MAG3B4tB,EAAS9B,IAAIS,IAGbA,EAAKsB,UACL7tB,KAAKS,OACLT,KAAK0tB,KAAK,WAAY1tB,OAI9B,SAAS8tB,IACL,IAAIxhB,EAAOtM,KAAKsM,KACZ1K,EAAW5B,KAAK4B,SAEhB0K,EAAO1K,EAEM,KADb0K,GAAc1K,KACE0K,EAAO1K,GAElB0K,EAAO,GAEC,KADbA,GAAc1K,KACE0K,GAAQ1K,GAM5B,IAHA,IAAIsiB,EAAQ5X,EAAO1K,EAEfihB,EAAS7iB,KAAK6iB,OACTtjB,EAAI,EAAGwuB,EAAMlL,EAAOrjB,OAAQD,EAAIwuB,EAAKxuB,IAAK,CACnCsjB,EAAOtjB,GACbolB,OAAOrY,EAAM4X,EAAOlkB,MAG1BA,KAAKytB,yBACwBpnB,IAAzBrG,KAAKguB,kBACLhuB,KAAKguB,gBAAkB9J,IAGtBlkB,KAAKsM,KAAO,GAAKtM,KAAKguB,gBAAkB9J,GAAWlkB,KAAKsM,KAAO,GAAKtM,KAAKguB,gBAAkB9J,IAC5FlkB,KAAK0tB,KAAK,YAAa1tB,MAG3BA,KAAKguB,gBAAkB9J,GAzJ/ByJ,EAAMM,MAAQ,SAAUvF,EAAM/F,GACtB3iB,KAAKwtB,SAAWxtB,KAAKwtB,QAAQzB,SAC7B/rB,KAAKwtB,QAAQE,KAAKhF,EAAMA,EAAM/F,IAItCgL,EAAMO,GAAK,SAAUxF,EAAMyF,EAAUjuB,GACjC,OAAIF,KAAKwtB,SAAWxtB,KAAKwtB,QAAQzB,SAChB,cAATrD,IACA1oB,KAAKytB,mBAAoB,GAEtBztB,KAAKwtB,QAAQU,GAAGxF,EAAMyF,EAAUjuB,IAGhC,MAIfytB,EAAMS,KAAO,SAAU1F,EAAMyF,EAAUjuB,GAAQ,IAAAmuB,EAAAruB,KAC3C,IAAIA,KAAKwtB,UAAWxtB,KAAKwtB,QAAQzB,QAW7B,OAAO,KAX+B,IAAAuC,EAAA,WACzB,cAAT5F,IACA2F,EAAKZ,mBAAoB,GAE7B,IAAIc,EAAAF,EACJ,OAAAG,EAAOH,EAAKb,QAAQY,KAAK1F,EAAM,SAAUwD,GACrCiC,EAAS5rB,KAAKrC,EAAQgsB,GACtBqC,EAAKd,mBAAoB,KAPS,GAAA,MAAA,iBAAAa,EAAAA,EAAAE,OAAA,GAe9Cb,EAAMc,IAAM,SAAU/F,EAAMyF,EAAUjuB,GAC9BF,KAAKwtB,SAAWxtB,KAAKwtB,QAAQzB,UAChB,cAATrD,IACK1oB,KAAKwtB,QAAQkB,iBAAiBhG,KAC/B1oB,KAAKytB,mBAAoB,IAGjCztB,KAAKwtB,QAAQiB,IAAI/F,EAAMyF,EAAUjuB,KAIzCytB,EAAMnG,gBAAkB,SAAUtnB,GAC9BF,KAAKwtB,QAAUttB,GAGnBytB,EAAMgB,OAAS,WAEX3uB,KAAKknB,QAAQ,GACblnB,KAAKktB,WAAaltB,KAAKitB,OAEvBrtB,GAAG+e,SAASiN,sBAAsBrE,aAAavnB,MAE3CA,KAAKgnB,UACLhnB,KAAKgnB,SAASO,aAAavnB,MAG/BA,KAAK0tB,KAAK,OAAQ1tB,OAGtB2tB,EAAM1F,OAAS,WACNjoB,KAAK+nB,UACNnoB,GAAG+e,SAASiN,sBAAsBnE,gBAAgBznB,MAGlDA,KAAKgnB,UACLhnB,KAAKgnB,SAASS,gBAAgBznB,MAGlCA,KAAK0tB,KAAK,OAAQ1tB,OAGtB2tB,EAAMxF,SAAW,WACbvoB,GAAG+e,SAASiN,sBAAsBrE,aAAavnB,MAC/CA,KAAK0tB,KAAK,SAAU1tB,OAGxB2tB,EAAMzF,QAAU,WACZtoB,GAAG+e,SAASiN,sBAAsBnE,gBAAgBznB,MAClDA,KAAK0tB,KAAK,QAAS1tB,OAGvB2tB,EAAMzG,QAAU,SAAU5a,GACtBtM,KAAKgtB,qBAAsB,EAC3BhtB,KAAKsM,KAAOA,GAAQ,EAGpB,IADA,IAAIuW,EAAS7iB,KAAK6iB,OACTtjB,EAAI,EAAGgiB,EAAIsB,EAAOrjB,OAAQD,EAAIgiB,EAAGhiB,IAAK,CAC3C,IAAIkkB,EAAQZ,EAAOtjB,GACfkkB,EAAMgG,uBACNhG,EAAMgG,sBAAsBnd,EAAMtM,QAgE9C2tB,EAAM9sB,OAAS,SAAU2D,GAGjBxE,KAAKktB,WAAa,IAClBltB,KAAKktB,YAAc1oB,EACfxE,KAAKktB,WAAa,KAStBltB,KAAKgtB,oBACLhtB,KAAKsM,MAAS9H,EAAQxE,KAAK+B,MAG3B/B,KAAKgtB,qBAAsB,EAG/BhtB,KAAKmtB,aAGTQ,EAAMiB,YAAc,SAAUvD,GAC1B,IAAIvF,EAAW9lB,KAAK8lB,SAChB+I,GAAa,GAEZ/I,EAAW9D,EAAa2J,YAAc3J,EAAa2J,WACxCN,GAAyC,EAApBA,IAA2B,GAC9CA,EAAoB,IAC9BA,GAAqB,GAGgB,EAApBA,IAEjBwD,GAAcA,IAMtB,OAHK/I,EAAW9D,EAAa8M,WAAa9M,EAAa8M,UACnDD,GAAcA,GAEXA,GAGXlB,EAAM3C,eAAiB,SAAU1e,EAAMigB,GACnCA,EAAOA,GAAQ,IAAIlD,EAEnB,IAAIwE,GAAU,EACVjsB,EAAW5B,KAAK4B,SAChBskB,EAAclmB,KAAKkmB,YAEnBmF,EAAoB/e,EAAO,EAAKA,EAAO1K,GAAc0K,EAAO1K,EAChE,GAAIypB,GAAqBnF,EAAa,CAClCmF,EAAoBnF,EAEpB2H,GAAU,EACV,IAAIkB,EAAY7I,GAA6B,EAAdA,GACb,IAAd6I,IACAA,EAAY,GAEhBziB,EAAOyiB,EAAYntB,GAAY0K,EAAO,EAAI,GAAK,GAGnD,GAAIA,EAAO1K,EAAU,CACjB,IAAIotB,EAAW1iB,EAAO1K,EACtB0K,EAAoB,IAAb0iB,EAAiBptB,EAAWotB,OAE9B1iB,EAAO,GAEC,KADbA,GAAc1K,KACG0K,GAAQ1K,GAG7B,IAAIitB,GAAa,EACbI,EAAajvB,KAAKkvB,UAAYlN,EAAamN,WAC3CF,IACAJ,EAAa7uB,KAAK4uB,YAAYvD,IAGlC,IAAIJ,EAAY4D,GAAc,EAAI,EAgBlC,OAfI7uB,KAAK+B,MAAQ,IACbkpB,IAAc,GAIdgE,GAAcJ,IACdviB,EAAO1K,EAAW0K,GAGtBigB,EAAKrI,MAAQ5X,EAAO1K,EACpB2qB,EAAKjgB,KAAOA,EACZigB,EAAKtB,UAAYA,EACjBsB,EAAKsB,QAAUA,EACftB,EAAKzB,WAAaO,EAEXkB,GAGXoB,EAAMhJ,OAAS,WAGX,IAFA,IAAI4H,EAAOvsB,KAAKgrB,eAAehrB,KAAKsM,KAAMtM,KAAKyqB,cAC3C5H,EAAS7iB,KAAK6iB,OACTtjB,EAAI,EAAGwuB,EAAMlL,EAAOrjB,OAAQD,EAAIwuB,EAAKxuB,IAAK,CACnCsjB,EAAOtjB,GACbolB,OAAO4H,EAAKjgB,KAAMigB,EAAKrI,MAAOlkB,MAGxC,OAAOusB,GAWXlO,EAAGsK,IAAIgF,EAAO,OAAQ,WAClB,OAAO3tB,KAAKqtB,QAUhBhP,EAAGsK,IAAIgF,EAAO,OAAQ,WAClB,OAAO3tB,KAAKstB,QAGhBjP,EAAG+Q,SAASzB,EAAO,wBAAyB,YAE5CtP,EAAGgR,OAAO1B,EAAO,cACb,WACI,OAAO3tB,KAAK6iB,OAAOrjB,OAAS,GAEhC,WACIQ,KAAK6iB,OAAOrjB,OAAS,IAK7B6e,EAAGgR,OAAO1B,EAAO,WACb,WACI,OAAO3tB,KAAKkvB,WAEhB,SAAUnrB,GACN/D,KAAKkvB,UAAYnrB,EAKjB/D,KAAKsM,KAAO,EAERvI,EAAQie,EAAaiE,KACrBjmB,KAAKkmB,YAAcC,EAAAA,EAGnBnmB,KAAKkmB,YAAc,IAM/B7H,EAAGgR,OAAO1B,EAAO,cACb,WACI,OAAO3tB,KAAKsvB,cAEhB,SAAUvrB,GACN/D,KAAKsvB,aAAevrB,EAEpB,IAAIkrB,EAAajvB,KAAKkvB,UAAYlN,EAAamN,WAC3CttB,GAAW7B,KAAK8lB,SAAW9D,EAAa8M,WAAa9M,EAAa8M,QAKlE9uB,KAAKmtB,SAJLppB,IAAUoiB,EAAAA,GAAa8I,GAAeptB,EAItBurB,EAHAU,IAQ5BzP,EAAGgR,OAAO1B,EAAO,QACb,WACI,OAAO3tB,KAAKitB,QAEhB,SAAUlpB,GACN/D,KAAKktB,WAAaltB,KAAKitB,OAASlpB,IAKxCnE,GAAGmtB,eAAiB5tB,EAAOE,QAAU0tB,uDCherC,SAASwC,EAAQC,EAAIC,EAAIC,EAAIC,EAAIvoB,GAC9B,IAAIwoB,EAAK,EAAIxoB,EACb,OAAOooB,EAAKI,EAAKA,EAAKA,EACV,EAALH,EAASG,EAAKA,EAAKxoB,EACd,EAALsoB,EAASE,EAAKxoB,EAAIA,EAClBuoB,EAAKvoB,EAAIA,EAAIA,EAUvB,IAAI8C,EAAM7E,KAAK6E,IACX2lB,EAAOxqB,KAAKwqB,KACZtqB,EAAMF,KAAKE,IAGXuqB,EAAM,EADDzqB,KAAK8E,GAEVsD,EAAOpI,KAAKoI,KAEhB,SAASsiB,EAAKvB,GACV,OAAIA,EAAI,GACInpB,KAAKmE,KAAKglB,EAAG,EAAI,GAGlBnpB,KAAKmE,IAAIglB,EAAG,EAAI,GAkI/B,SAASpF,EAAcjkB,EAAe7F,GAClC,IAAI0wB,EAhHR,SAAkBvM,EAAOnkB,GAUrB,IAwBI2wB,EAAQnW,EAAIE,EAAIkW,EAxBhBC,EAAK7wB,EAAI,EACT8wB,EAAK9wB,EAAImkB,EAAM,GAKf4M,EAAW,EAALF,EACNG,EAAW,EAALF,EACNG,EAAW,GANNjxB,EAAImkB,EAAM,IAQf+M,EAAK,IADCL,EAAKG,EAAMC,GANZjxB,EAAI,IASTyJ,GAAKsnB,EAAM,EAAID,EAAKG,GAAOC,EAC3BC,EAAK1nB,GAFA,EAAI,GAGTmD,IAAMmkB,EAAMC,GAAOE,EAGnBhqB,EANK,EAAI,GAMJ,EAAI0F,EAAInD,EAAIA,GACjB5B,EAAKX,GAPA,EAAI,GAQTkqB,GAAK,EAAI3nB,EAAIA,EAAIA,EAAI,EAAIA,EAAImD,EAJzBikB,EAAKK,EAIwB,IAAU,GAC3CG,EAAKD,EAAI,EAETE,EAAeD,EAAKA,EAAKxpB,EAAKA,EAAKA,EAMvC,GAAIypB,EAAe,EAAG,CAClB,IAAIC,EAlBC,EAAI,GAkBErqB,EAEP0T,EAAIzM,EADGojB,EAAMA,EAAMA,GAGnBzpB,GAAKspB,GAAK,EAAIxW,GAEd4W,EAAMjB,EADGzoB,GAAK,GAAK,EAAIA,EAAI,EAAI,EAAIA,GAGnCwoB,EAAK,EADEG,EAAI7V,GAOf,OALAJ,EAAK8V,EAAK1lB,EAAI4mB,GA3BT,EAAI,IA2BiBL,EAC1BzW,EAAK4V,EAAK1lB,GAAK4mB,EAAMhB,IA5BhB,EAAI,IA4ByBW,EAClCP,EAAKN,EAAK1lB,GAAK4mB,EAAM,EAAIhB,IA7BpB,EAAI,IA6B6BW,EAGlC,GAAK3W,GAAMA,GAAM,EACb,GAAKE,GAAMA,GAAM,EACb,GAAKkW,GAAMA,GAAM,EACV3qB,EAAIuU,EAAIE,EAAIkW,GAGZ3qB,EAAIuU,EAAIE,GAGd,GAAKkW,GAAMA,GAAM,EACf3qB,EAAIuU,EAAIoW,GAGRpW,EAIP,GAAKE,GAAMA,GAAM,EACb,GAAKkW,GAAMA,GAAM,EACV3qB,EAAIyU,EAAIkW,GAGRlW,EAIJkW,EAId,GAAqB,IAAjBU,EAML,OAHA5W,IAFAiW,EAAKU,EAAK,EAAIZ,GAAKY,IAAOZ,EAAIY,IAEnBF,EAGP,IAJJ3W,EAAK,EAAImW,EAAKQ,IAIC3W,GAAM,EACb,GAAKE,GAAMA,GAAM,EACVzU,EAAIuU,EAAIE,GAGRF,EAIJE,EAKX,IAAI+W,EAAKtjB,EAAKmjB,GAId,OADA9W,GAFAmW,EAAKF,GAAKY,EAAKI,IACVhB,EAAIY,EAAKI,GACCN,EAMLO,CAAQ7rB,EAAe7F,GAKjCswB,EAAK,EAAII,EACb,OALU,EAKGJ,EAAKA,EAAKA,EACV,EALHzqB,EAAc,GAKP6qB,EAAUJ,EAAKA,EACnB,EALHzqB,EAAc,GAKP6qB,EAAUA,EAAUJ,EAJ3B,EAKGI,EAAUA,EAAUA,EAQrC7wB,EAAOE,SACHkwB,OAAQA,EACRnG,aAAcA,4BClMlB,IAAIG,GACA0H,SAAU,WAAc,OAAO,GAC/BC,OAAQ,SAAUhS,GAAK,OAAOA,GAO9BiS,OAAQ,SAAUjS,GAAK,OAAOA,EAAIA,GAClCkS,QAAS,SAAUlS,GAAK,OAAOA,GAAM,EAAIA,IACzCmS,UAAW,SAAUnS,GACjB,OAAMA,GAAK,GAAM,EACN,GAAMA,EAAIA,GAEb,MAAUA,GAAMA,EAAI,GAAM,IAQtCoS,QAAS,SAAUpS,GAAK,OAAOA,EAAIA,EAAIA,GACvCqS,SAAU,SAAUrS,GAAK,QAASA,EAAIA,EAAIA,EAAI,GAC9CsS,WAAY,SAAUtS,GAClB,OAAMA,GAAK,GAAM,EACN,GAAMA,EAAIA,EAAIA,EAElB,KAAUA,GAAK,GAAMA,EAAIA,EAAI,IAQxCuS,QAAS,SAAUvS,GAAK,OAAOA,EAAIA,EAAIA,EAAIA,GAC3CwS,SAAU,SAAUxS,GAAK,OAAO,KAAQA,EAAIA,EAAIA,EAAIA,GACpDyS,WAAY,SAAUzS,GAClB,OAAMA,GAAK,GAAM,EACN,GAAMA,EAAIA,EAAIA,EAAIA,GAErB,KAAUA,GAAK,GAAMA,EAAIA,EAAIA,EAAI,IAQ7C0S,QAAS,SAAU1S,GAAK,OAAOA,EAAIA,EAAIA,EAAIA,EAAIA,GAC/C2S,SAAU,SAAU3S,GAAK,QAASA,EAAIA,EAAIA,EAAIA,EAAIA,EAAI,GACtD4S,WAAY,SAAU5S,GAClB,OAAMA,GAAK,GAAM,EACN,GAAMA,EAAIA,EAAIA,EAAIA,EAAIA,EAE1B,KAAUA,GAAK,GAAMA,EAAIA,EAAIA,EAAIA,EAAI,IAQhD6S,OAAQ,SAAU7S,GAAK,OAAO,EAAI7Z,KAAK6E,IAAIgV,EAAI7Z,KAAK8E,GAAK,IACzD6nB,QAAS,SAAU9S,GAAK,OAAO7Z,KAAKiF,IAAI4U,EAAI7Z,KAAK8E,GAAK,IACtD8nB,UAAW,SAAU/S,GAAK,MAAO,IAAQ,EAAI7Z,KAAK6E,IAAI7E,KAAK8E,GAAK+U,KAOhEgT,OAAQ,SAAUhT,GAAK,OAAa,IAANA,EAAU,EAAI7Z,KAAKmE,IAAI,KAAM0V,EAAI,IAC/DiT,QAAS,SAAUjT,GAAK,OAAa,IAANA,EAAU,EAAI,EAAI7Z,KAAKmE,IAAI,GAAI,GAAK0V,IACnEkT,UAAW,SAAUlT,GACjB,OAAU,IAANA,EACO,EAED,IAANA,EACO,GAELA,GAAK,GAAM,EACN,GAAM7Z,KAAKmE,IAAI,KAAM0V,EAAI,GAE7B,IAAwC,EAA/B7Z,KAAKmE,IAAI,GAAI,IAAO0V,EAAI,MAQ5CmT,OAAQ,SAAUnT,GAAK,OAAO,EAAI7Z,KAAKoI,KAAK,EAAIyR,EAAIA,IACpDoT,QAAS,SAAUpT,GAAK,OAAO7Z,KAAKoI,KAAK,KAAQyR,EAAIA,IACrDqT,UAAW,SAAUrT,GACjB,OAAMA,GAAK,GAAM,GACL,IAAQ7Z,KAAKoI,KAAK,EAAIyR,EAAIA,GAAK,GAEpC,IAAQ7Z,KAAKoI,KAAK,GAAMyR,GAAK,GAAKA,GAAK,IASlDsT,UAAW,SAAUtT,GACjB,IAAI3X,EAAGwB,EAAI,GACX,OAAU,IAANmW,EACO,EAED,IAANA,EACO,IAENnW,GAAKA,EAAI,GACVA,EAAI,EACJxB,EAAIf,IAGJe,EAZgB,GAYRlC,KAAKotB,KAAK,EAAI1pB,IAAO,EAAI1D,KAAK8E,KAEhCpB,EAAI1D,KAAKmE,IAAI,EAAG,IAAO0V,GAAK,IAAO7Z,KAAKiF,KAAM4U,EAAI3X,IAAQ,EAAIlC,KAAK8E,IAdzD,MAgBxBuoB,WAAY,SAAUxT,GAClB,IAAI3X,EAAGwB,EAAI,GACX,OAAU,IAANmW,EACO,EAED,IAANA,EACO,IAENnW,GAAKA,EAAI,GACVA,EAAI,EACJxB,EAAIf,IAGJe,EAZgB,GAYRlC,KAAKotB,KAAK,EAAI1pB,IAAO,EAAI1D,KAAK8E,IAEjCpB,EAAI1D,KAAKmE,IAAI,GAAI,GAAK0V,GAAK7Z,KAAKiF,KAAM4U,EAAI3X,IAAQ,EAAIlC,KAAK8E,IAdhD,IAc4D,IAEpFwoB,aAAc,SAAUzT,GACpB,IAAI3X,EAAGwB,EAAI,GACX,OAAU,IAANmW,EACO,EAED,IAANA,EACO,IAENnW,GAAKA,EAAI,GACVA,EAAI,EACJxB,EAAIf,IAGJe,EAZgB,GAYRlC,KAAKotB,KAAK,EAAI1pB,IAAO,EAAI1D,KAAK8E,KAEpC+U,GAAK,GAAM,EAEJnW,EAAI1D,KAAKmE,IAAI,EAAG,IAAO0V,GAAK,IAAO7Z,KAAKiF,KAAM4U,EAAI3X,IAAQ,EAAIlC,KAAK8E,IAhB5D,KAeR,GAGLpB,EAAI1D,KAAKmE,IAAI,GAAI,IAAO0V,GAAK,IAAO7Z,KAAKiF,KAAM4U,EAAI3X,IAAQ,EAAIlC,KAAK8E,IAlBvD,IAkBmE,GAAM,IAQjGyoB,OAAQ,SAAU1T,GACd,IAAI3X,EAAI,QACR,OAAO2X,EAAIA,IAAQ3X,EAAI,GAAM2X,EAAI3X,IAErCsrB,QAAS,SAAU3T,GACf,IAAI3X,EAAI,QACR,QAAS2X,EAAIA,IAAQ3X,EAAI,GAAM2X,EAAI3X,GAAM,GAE7CurB,UAAW,SAAU5T,GACjB,IAAI3X,EAAI,UACR,OAAM2X,GAAK,GAAM,EACEA,EAAIA,IAAQ3X,EAAI,GAAM2X,EAAI3X,GAAlC,GAEJ,KAAU2X,GAAK,GAAMA,IAAQ3X,EAAI,GAAM2X,EAAI3X,GAAM,IAQ5DwrB,UAAW,SAAU7T,GACjB,OAAIA,EAAM,EAAI,KACH,OAASA,EAAIA,EAEfA,EAAM,EAAI,KACR,QAAWA,GAAO,IAAM,MAAWA,EAAI,IAEzCA,EAAM,IAAM,KACV,QAAWA,GAAO,KAAO,MAAWA,EAAI,MAGxC,QAAWA,GAAO,MAAQ,MAAWA,EAAI,SAMxD8T,OAAQ,SAAU5rB,GACd,OAAIA,GAAK,EACE,EAEPA,GAAK,EACE,EAEJA,EAAIA,GAAK,EAAI,EAAIA,IAK5B6rB,KAAM,SAAU7rB,GACZ,OAAIA,GAAK,EACE,EAEPA,GAAK,EACE,EAEJA,EAAIA,EAAIA,GAAKA,GAAS,EAAJA,EAAQ,IAAM,MAI/C,SAAS8rB,EAAYC,EAAMC,GACvB,OAAO,SAAUlU,GACb,OAAIA,EAAI,GACGkU,EAAU,EAAJlU,GAAS,EAEnBiU,EAAK,EAAIjU,EAAI,GAAK,EAAI,IAGrCqK,EAAO8J,UAAYH,EAAW3J,EAAO4H,OAAQ5H,EAAO6H,SACpD7H,EAAO+J,WAAaJ,EAAW3J,EAAO+H,QAAS/H,EAAOgI,UACtDhI,EAAOgK,WAAaL,EAAW3J,EAAOkI,QAASlI,EAAOmI,UACtDnI,EAAOiK,WAAaN,EAAW3J,EAAOqI,QAASrI,EAAOsI,UACtDtI,EAAOkK,UAAYP,EAAW3J,EAAOwI,OAAQxI,EAAOyI,SACpDzI,EAAOmK,UAAYR,EAAW3J,EAAO2I,OAAQ3I,EAAO4I,SACpD5I,EAAOoK,UAAYT,EAAW3J,EAAO8I,OAAQ9I,EAAO+I,SACpD/I,EAAOqK,UAAYV,EAAW3J,EAAOqJ,OAAQrJ,EAAOsJ,SACpDtJ,EAAOqK,UAAYV,EAAW3J,EAAOqJ,OAAQrJ,EAAOsJ,SACpDtJ,EAAOsK,SAAW,SAAU3U,GAAK,OAAO,EAAIqK,EAAOwJ,UAAU,EAAI7T,IACjEqK,EAAOuK,YAAc,SAAU5U,GAC3B,OAAIA,EAAI,GAC4B,GAAzBqK,EAAOsK,SAAa,EAAJ3U,GAEU,GAA9BqK,EAAOwJ,UAAc,EAAJ7T,EAAQ,GAAW,IAE/CqK,EAAOwK,YAAcb,EAAW3J,EAAOsK,SAAUtK,EAAOwJ,WAExDnzB,GAAG2pB,OAASpqB,EAAOE,QAAUkqB,2BCjQ7B7pB,EAAQ,YACRA,EAAQ,YACRA,EAAQ,WACRA,EAAQ,wBACRA,EAAQ,sBACRA,EAAQ,oBACRA,EAAQ,uBACRA,EAAQ,qBACRA,EAAQ,yOCRR,IAAIiiB,EAAmBjiB,EAAQ,sBAAsBiiB,iBACjD2H,EAAqB5pB,EAAQ,sBAAsB4pB,mBAEnDiG,EAAS7vB,EAAQ,YAAY6vB,OAC7BtN,EAAeviB,EAAQ,+BAA+BwiB,oBAEtDje,EAAKrE,GAAGqE,GAEZ,SAAS+vB,EAAOluB,GACZ9F,KAAK8F,OAASA,MACd9F,KAAKi0B,WACLj0B,KAAKokB,UACLpkB,KAAKk0B,cAELl0B,KAAKR,OAAS,EAEdQ,KAAKm0B,iBAiCT,SAASzP,IACL1kB,KAAK0pB,MAAQzlB,IACbjE,KAAK2pB,IAAM1lB,IACXjE,KAAKo0B,eAAiBnwB,IACtBjE,KAAKq0B,aAAepwB,IA4IxB,SAAS4d,EAAmB2B,EAAa7S,EAAM/O,EAAU0yB,GAErD,SAASC,EAAoBjS,GACzB,OAAIA,aAAiB1iB,GAAGyE,MAEhBmwB,GAAIlS,EACJld,IAAKkd,EACLmS,IAAKnS,GAGJjP,MAAM2P,QAAQV,IAA2B,IAAjBA,EAAM9iB,QAE/Bg1B,GAAIvwB,EAAGqe,EAAM,GAAIA,EAAM,IACvBld,IAAKnB,EAAGqe,EAAM,GAAIA,EAAM,IACxBmS,IAAKxwB,EAAGqe,EAAM,GAAIA,EAAM,MAK5BkS,GAAI50B,GAAGyE,KAAKC,KACZc,IAAKxF,GAAGyE,KAAKC,KACbmwB,IAAK70B,GAAGyE,KAAKC,MAIrB,IAAIggB,EAAS3T,EAAK2T,OAElB,GAA2B,IAAvBd,EAAYhkB,QAAkC,IAAlB8kB,EAAO9kB,OAQvC,GAAsB,KAJtB8kB,EAASA,EAAOoQ,IAAI,SAAU3wB,GAC1B,OAAOE,EAAGF,EAAM,GAAIA,EAAM,OAGnBvE,OAAX,CAyBA,IApBA,IAAIglB,EAAQ7T,EAAK6T,MACbJ,EAASzT,EAAKyT,OAEduQ,EAAYhkB,EAAK2T,UACjBsQ,EAAWjkB,EAAK6T,SAChBqQ,EAAYlkB,EAAKyT,UASjB0Q,EAAmB,EAGnBC,EAAUpT,EAAiB8C,OAGtBllB,EAAI,EAAGgiB,EAAIiC,EAAYhkB,OAAQD,EAAIgiB,EAAE,EAAGhiB,IAAK,CAClD,IAcIy1B,EAdAjS,EAAaS,EAAYjkB,GAEzB2kB,EAAQE,EAAO7kB,GAEf01B,EADY7Q,EAAO7kB,EAAI,GACI2kB,EAE3BngB,EAAQugB,EAAO/kB,GACf21B,EAAY5Q,EAAO/kB,EAAI,GAEvBmpB,EAAOlE,EAAMjlB,GAEb41B,KACAC,EAAWN,EAAmBG,EAC9BlzB,EAAQ,GAAKkzB,EAAerzB,EAAW0yB,GAG3C,GAAIvR,GAAcA,EAAWvjB,OAAS,EAAG,CACrC,IAAIsG,KACJA,EAAOJ,KAAK6uB,EAAoBxwB,IAEhC,IAAK,IAAIqoB,EAAI,EAAGiJ,EAAKtS,EAAWvjB,OAAQ4sB,EAAIiJ,EAAIjJ,IAAK,CACjD,IAAIjnB,EAAgBovB,EAAoBxR,EAAWqJ,IACnDtmB,EAAOJ,KAAKP,GAGhBW,EAAOJ,KAAK6uB,EAAoBW,IAGhC,IAAIzR,EAAQ,IAAIuQ,EAAMluB,GACtB2d,EAAM0Q,iBAKN,IAFA,IAAID,EAAazQ,EAAMyQ,WAEf,EAAIkB,EAvCN,MAuC0B,CAK5B,IAAIhwB,EAAKmqB,EAAQ+F,EAAQ91B,EAEzB,IAJAw1B,EAAgB1L,EAFhB0L,EAAgBI,EAEkC1M,IAI9B,EAEhBlpB,GAAW,EAAIw1B,IADfzF,EAAS9L,EAAMwQ,QAAQ,IACgBsB,YACvCD,EAAS/F,EAAO7F,MAAMjlB,IAAI8qB,EAAO8E,cAAcmB,YAC/CpwB,EAAMmqB,EAAO7F,MAAM7kB,IAAIywB,EAAOpxB,IAAI1E,SAEjC,GAAIw1B,EAAgB,EAErBx1B,GAAWw1B,EAAgB,IAD3BzF,EAAS9L,EAAMwQ,QAAQxQ,EAAMwQ,QAAQz0B,OAAS,IACP+1B,YACvCD,EAAS/F,EAAO5F,IAAIllB,IAAI8qB,EAAO6E,gBAAgBoB,YAC/CpwB,EAAMmqB,EAAO5F,IAAI9kB,IAAIywB,EAAOpxB,IAAI1E,QAE/B,CACD,IAAIi2B,EAAcxT,EAAaiS,EAAYc,GACvCS,EAAc,IAAGA,GAAeA,GAEpCT,GAAiBS,EAAc,EAAIvB,EAAWuB,EAAc,GAAK,EACjET,GAAgCvR,EAAMW,OAAOqR,GAE7CrwB,EAAMqe,EAAMwQ,QAAQwB,GAAaC,WAAWV,GAGhDG,EAAQzvB,KAAKN,GACbgwB,GAAYrzB,QAKhB,KAAQ,EAAIqzB,EA1EN,MA6EFJ,EAAgB1L,EAFhB0L,EAAgBI,EAEkC1M,GAElDyM,EAAQzvB,KAAK3B,EAAMkmB,KAAKiL,EAAWF,IAEnCI,GAAYrzB,EAIpBgzB,EAAmB,aAATrM,EAAsBA,EAAO/G,EAAiB8C,OAExD,IAAS2H,EAAI,EAAGiJ,EAAKF,EAAQ31B,OAAQ4sB,EAAIiJ,EAAIjJ,IAAK,CAC9C,IAAIuJ,EAAWzR,EAAQ4Q,EAAmB/yB,EAAQqqB,EAAI6I,EACtDW,EAAYT,EAAQ/I,GAAI2I,EAASY,GAIjCb,EADAzvB,KAAKuK,IAAIwlB,EAAW,GA5Fd,MA6FcA,EAAW,GAAKH,EAEjB,EAGvB7Q,EAAOA,EAAO5kB,OAAS,KAAOq1B,EAAUA,EAAUr1B,OAAQ,IAC1Do2B,EAAYtR,EAAOA,EAAO9kB,OAAS,GAAIu1B,EAAS3Q,EAAOA,EAAO5kB,OAAS,SAvHvEmR,EAAK2T,OAASA,EAWlB,SAASsR,EAAa7xB,EAAO2kB,EAAMxE,GAC/ByQ,EAAUjvB,KAAK3B,GACf6wB,EAASlvB,KAAKgjB,GACdmM,EAAUnvB,KAAKwe,IAjOvB8P,EAAM1xB,UAAU6xB,eAAiB,WAM7B,IAAI5E,EALJvvB,KAAKi0B,QAAQz0B,OAAS,EACtBQ,KAAKokB,OAAO5kB,OAAS,EACrBQ,KAAKk0B,WAAW10B,OAAS,EACzBQ,KAAKR,OAAS,EAId,IAAK,IAAID,EAAI,EAAGA,EAAIS,KAAK8F,OAAOtG,OAAQD,IAAK,CACzC,IAAIs2B,EAAa71B,KAAK8F,OAAOvG,EAAI,GAC7Bu2B,EAAW91B,KAAK8F,OAAOvG,IAC3BgwB,EAAS,IAAI7K,GACNgF,MAAQmM,EAAWzwB,IAC1BmqB,EAAO6E,eAAiByB,EAAWpB,IACnClF,EAAO5F,IAAMmM,EAAS1wB,IACtBmqB,EAAO8E,aAAeyB,EAAStB,GAC/Bx0B,KAAKi0B,QAAQvuB,KAAK6pB,GAElBvvB,KAAKR,QAAU+vB,EAAOgG,YAG1B,IAAIjtB,EAAU,EACd,IAAS/I,EAAI,EAAGA,EAAIS,KAAKi0B,QAAQz0B,OAAQD,IACrCgwB,EAASvvB,KAAKi0B,QAAQ10B,GACtBS,KAAKokB,OAAO7kB,GAAKgwB,EAAOgG,YAAcv1B,KAAKR,OAC3CQ,KAAKk0B,WAAW30B,GAAK+I,GAAoBtI,KAAKokB,OAAO7kB,GAGzD,OAAOS,KAAKi0B,SAYhBvP,EAAOpiB,UAAUozB,WAAa,SAAWK,GACrC,IAAI3uB,EAAIpH,KAAKg2B,eAAgBD,GAC7B,OAAO/1B,KAAKi2B,SAAU7uB,IAM1Bsd,EAAOpiB,UAAU2zB,SAAW,SAAW7uB,GACnC,IAAI9H,EAAIiwB,EAAOvvB,KAAK0pB,MAAMpqB,EAAGU,KAAKo0B,eAAe90B,EAAGU,KAAKq0B,aAAa/0B,EAAGU,KAAK2pB,IAAIrqB,EAAG8H,GACjF1D,EAAI6rB,EAAOvvB,KAAK0pB,MAAMhmB,EAAG1D,KAAKo0B,eAAe1wB,EAAG1D,KAAKq0B,aAAa3wB,EAAG1D,KAAK2pB,IAAIjmB,EAAG0D,GAErF,OAAO,IAAInD,EAAG3E,EAAGoE,IAIrBghB,EAAOpiB,UAAUizB,UAAY,WAEzB,IAAIW,EAAUl2B,KAAKm2B,aACnB,OAAOD,EAASA,EAAQ12B,OAAS,IAKrCklB,EAAOpiB,UAAU6zB,WAAa,SAAWC,GAIrC,GAFOA,IAAYA,EAAap2B,KAAKq2B,qBAAyBr2B,KAAKq2B,qBAAuB,KAErFr2B,KAAKs2B,iBACDt2B,KAAKs2B,gBAAgB92B,SAAW42B,EAAY,EAGjD,OAAOp2B,KAAKs2B,gBAIhB,IACIhuB,EACA9B,EAFA1H,KACSwU,EAAOtT,KAAKi2B,SAAU,GAAKM,EAAStyB,IAC1CuyB,EAAM,EAIb,IAFA13B,EAAM4G,KAAM,GAENc,EAAI,EAAGA,GAAK4vB,EAAW5vB,IAEzB8B,EAAUtI,KAAKi2B,SAAWzvB,EAAI4vB,GAC9BG,EAAOj3B,EAAIgU,EAAKhU,EAAIgJ,EAAQhJ,EAC5Bi3B,EAAO7yB,EAAI4P,EAAK5P,EAAI4E,EAAQ5E,EAC5B8yB,GAAOD,EAAOE,MACd33B,EAAM4G,KAAM8wB,GACZljB,EAAOhL,EAMX,OAFAtI,KAAKs2B,gBAAkBx3B,EAEhBA,GAGX4lB,EAAOpiB,UAAU0zB,eAAiB,SAAWD,EAAGW,GAE5C,IAIIC,EAJAC,EAAa52B,KAAKm2B,aAElB52B,EAAI,EAAGs3B,EAAKD,EAAWp3B,OAKvBm3B,EADCD,GAGiBX,EAAIa,EAAYC,EAAK,GAS3C,IAFA,IAA4BC,EAAxBC,EAAM,EAAGC,EAAOH,EAAK,EAEjBE,GAAOC,GAMX,IAFAF,EAAaF,EAFbr3B,EAAI8F,KAAK4xB,MAAOF,GAAQC,EAAOD,GAAQ,IAERJ,GAEb,EAEdI,EAAMx3B,EAAI,MAFd,CAKO,KAAKu3B,EAAa,GAAlB,CAOHE,EAAOz3B,EACP,MANAy3B,EAAOz3B,EAAI,EAkBnB,GAAKq3B,EAJLr3B,EAAIy3B,KAIqBL,EAGrB,OADQp3B,GAAMs3B,EAAK,GAOvB,IAAIK,EAAeN,EAAYr3B,GAa/B,OAFUA,GAJco3B,EAAkBO,IANxBN,EAAYr3B,EAAI,GAEA23B,KAQEL,EAAI,IAyK5C13B,EAAOE,SACHwiB,kBAAmBA,EACnBmS,MAAOA,EACPtP,OAAQA,mGCvWZ,IAAIrG,EAAKze,GAAGye,GACN8Y,EAAQz3B,EAAQ,mBAMtB,SAASgiB,IACL1hB,KAAK0sB,YAAa,EAClB1sB,KAAK2sB,WAAY,EACjB3sB,KAAKo3B,WAAY,EAGrB,IAAI90B,EAAYof,EAASpf,UAUzB+b,EAAGsK,IAAIrmB,EAAW,YAAa,WAC3B,OAAOtC,KAAK0sB,aACb,GAUHrO,EAAGsK,IAAIrmB,EAAW,WAAY,WAC1B,OAAOtC,KAAK2sB,YACb,GAIH,IAAI0K,EAAU,aAKd/0B,EAAUqsB,OAAS0I,EAKnB/0B,EAAU4lB,QAAUmP,EAKpB/0B,EAAU6lB,SAAWkP,EAKrB/0B,EAAU2lB,OAASoP,EAMnB/0B,EAAUg1B,QAAUD,EASpB/0B,EAAU2kB,KAAO,WACTjnB,KAAK0sB,WACD1sB,KAAK2sB,WACL3sB,KAAK2sB,WAAY,EACjB3sB,KAAKmoB,YAGLnoB,KAAKs3B,QAAQH,EAAMI,SAAS,QAIhCv3B,KAAK0sB,YAAa,EAClB1sB,KAAK2uB,WASbrsB,EAAU7B,KAAO,WACTT,KAAK0sB,aACL1sB,KAAK0sB,YAAa,EAClB1sB,KAAKioB,SAGLjoB,KAAK2sB,WAAY,IASzBrqB,EAAUslB,MAAQ,WACV5nB,KAAK0sB,aAAe1sB,KAAK2sB,YACzB3sB,KAAK2sB,WAAY,EACjB3sB,KAAKkoB,YASb5lB,EAAUwlB,OAAS,WACX9nB,KAAK0sB,YAAc1sB,KAAK2sB,YACxB3sB,KAAK2sB,WAAY,EACjB3sB,KAAKmoB,aASb7lB,EAAU5B,KAAO,WACbV,KAAK4nB,QACL5nB,KAAKo3B,WAAY,EACZp3B,KAAK0sB,YACN1sB,KAAKinB,QAIb9nB,EAAOE,QAAUqiB,+CChJjB,IAAIM,GACAiE,KAAM,EACNkJ,WAAY,EAEZxD,SAAU,GACVmD,QAAS,IASTzG,EAAWzoB,GAAG43B,MAOdC,QAAS,EAOT7O,OAAQ,EAORkG,QAAS9M,EAAa8M,QAOtB7I,KAAMjE,EAAaiE,KAQnByR,YAAa1V,EAAaiE,KAAOjE,EAAa8M,QAQ9CnD,SAAU3J,EAAa2J,SAQvBgM,gBAAiB3V,EAAa2J,SAAW3J,EAAa8M,UAM1D,SAASzF,EAAakD,GACdA,EACAvsB,KAAK8rB,IAAIS,IAIbvsB,KAAKkkB,MAAQ,EACblkB,KAAKsM,KAAO,EACZtM,KAAKirB,UAAY,EACjBjrB,KAAK6tB,SAAU,EACf7tB,KAAK8qB,WAAa,EAClB9qB,KAAKmrB,gBAAa9kB,GAdtBzG,GAAGyoB,SAAWA,EAiBdgB,EAAY/mB,UAAUwpB,IAAM,SAAUS,GAClCvsB,KAAKkkB,MAAQqI,EAAKrI,MAClBlkB,KAAKsM,KAAOigB,EAAKjgB,KACjBtM,KAAKirB,UAAYsB,EAAKtB,UACtBjrB,KAAK6tB,QAAUtB,EAAKsB,QACpB7tB,KAAK8qB,WAAayB,EAAKzB,WACvB9qB,KAAKmrB,WAAaoB,EAAKpB,YAG3BhsB,EAAOE,SACH2iB,aAAAA,EACAqG,SAAAA,EACAgB,YAAAA,4BChGJ,IAAMuO,EAAcl4B,EAAQ,8BACtBm4B,EAAMn4B,EAAQ,0BACdo4B,EAAWp4B,EAAQ,8BAA8Bo4B,SAEnDC,GAAc,EACdC,KAIAC,EAAQ,SAAUC,GAClBN,EAAYr1B,KAAKvC,MAEjBA,KAAKm4B,KAAOD,EACZl4B,KAAKo4B,SAAW,KAChBp4B,KAAKq4B,GAAK,EAEVr4B,KAAKs4B,QAAU,EACft4B,KAAKu4B,OAAQ,EACbv4B,KAAKw4B,UAAY,EAEjBx4B,KAAKy4B,OAASR,EAAMS,MAAMC,YAE1B34B,KAAK44B,SAAW,WACZ54B,KAAK0tB,KAAK,UACZmL,KAAK74B,OAGXJ,GAAGye,GAAGmE,OAAOyV,EAAOL,GASpBK,EAAMS,OAIFI,OAAS,EAITH,YAAa,EAIbI,QAAS,EAITC,OAAQ,EAIRC,QAAS,GAGb,SAAWtL,GAEPA,EAAMuL,WAAa,SAAU/K,GACzBA,EAAWA,GAAYnuB,KAAK44B,SAC5B,IAAIO,EAAOn5B,KAAKo4B,SACZp4B,KAAKm4B,MAASgB,aAAgBC,iBAC9BD,EAAKE,iBAAiB,QAASlL,GAE/BgL,EAAKG,QAAUnL,GAIvBR,EAAM4L,aAAe,WACjB,IAAIJ,EAAOn5B,KAAKo4B,SACZe,aAAgBC,iBAChBD,EAAKK,oBAAoB,QAASx5B,KAAK44B,UAChCO,IACPA,EAAKG,QAAU,OAUvB3L,EAAM8L,UAAY,WACd,IAAIN,EAAOn5B,KAAKm4B,KAAKuB,aACjBP,aAAgBC,kBAEXp5B,KAAKo4B,WACNp4B,KAAKo4B,SAAWuB,SAASC,cAAc,UAE3C55B,KAAKo4B,SAASF,IAAMiB,EAAKjB,KAGzBl4B,KAAKo4B,SAAW,IAAIyB,EAAgBV,EAAMn5B,MAG9CA,KAAK85B,UAAU95B,KAAKs4B,SACpBt4B,KAAK+5B,QAAQ/5B,KAAKu4B,OACK,IAAnBv4B,KAAKw4B,WACLx4B,KAAKg6B,eAAeh6B,KAAKw4B,WAEzBx4B,KAAKy4B,SAAWR,EAAMS,MAAMK,QAC5B/4B,KAAKinB,OAGLjnB,KAAKy4B,OAASR,EAAMS,MAAMC,aAIlChL,EAAM1G,KAAO,WAETjnB,KAAKy4B,OAASR,EAAMS,MAAMK,QAErB/4B,KAAKo4B,WAIVp4B,KAAKk5B,aACLl5B,KAAKo4B,SAASnR,OAGNjnB,KAAKm4B,MAAQn4B,KAAKm4B,KAAK8B,WAAanC,EAASoC,WAC7Cl6B,KAAKo4B,SAAShZ,QACd4Y,EAActyB,MAAOy0B,SAAUn6B,KAAMo6B,OAAQ,EAAGC,MAAOr6B,KAAKo4B,WAG5DL,IACJA,GAAc,EAGdn4B,GAAG06B,KAAKC,OAAOlB,iBAAiB,aAAc,WAE1C,IADA,IAAImB,OAAA,EACGA,EAAOxC,EAActvB,OACxB8xB,EAAKH,MAAMpT,KAAKuT,EAAKJ,aAMrCzM,EAAM8M,QAAU,WAIZz6B,KAAKo4B,SAAW,MAGpBzK,EAAM/F,MAAQ,WACL5nB,KAAKo4B,UAAYp4B,KAAKy4B,SAAWR,EAAMS,MAAMK,UAClD/4B,KAAKu5B,eACLv5B,KAAKo4B,SAASxQ,QACd5nB,KAAKy4B,OAASR,EAAMS,MAAMM,SAG9BrL,EAAM7F,OAAS,WACN9nB,KAAKo4B,UAAYp4B,KAAKy4B,SAAWR,EAAMS,MAAMM,SAClDh5B,KAAKk5B,aACLl5B,KAAKo4B,SAASnR,OACdjnB,KAAKy4B,OAASR,EAAMS,MAAMK,UAG9BpL,EAAMltB,KAAO,WACT,GAAKT,KAAKo4B,SAAV,CACAp4B,KAAKo4B,SAASxQ,QACd,IACI5nB,KAAKo4B,SAASsC,YAAc,EAC9B,MAAOC,IAET,IAAK,IAAIp7B,EAAI,EAAGA,EAAIy4B,EAAcx4B,OAAQD,IACtC,GAAIy4B,EAAcz4B,GAAG46B,WAAan6B,KAAM,CACpCg4B,EAAc7X,OAAO5gB,EAAG,GACxB,MAGRS,KAAKu5B,eACLv5B,KAAK0tB,KAAK,QACV1tB,KAAKy4B,OAASR,EAAMS,MAAMO,UAG9BtL,EAAMoM,QAAU,SAAUa,GACtB56B,KAAKu4B,MAAQqC,EACT56B,KAAKo4B,WACLp4B,KAAKo4B,SAASwC,KAAOA,IAG7BjN,EAAMkN,QAAU,WACZ,OAAO76B,KAAKu4B,OAGhB5K,EAAMmM,UAAY,SAAUgB,GACxB96B,KAAKs4B,QAAUwC,EACX96B,KAAKo4B,WACLp4B,KAAKo4B,SAAS2C,OAASD,IAG/BnN,EAAMqN,UAAY,WACd,OAAOh7B,KAAKs4B,SAGhB3K,EAAMqM,eAAiB,SAAUc,GAAK,IAAAzM,EAAAruB,KAClC,GAAIA,KAAKo4B,SAAT,CACIp4B,KAAKw4B,UAAY,EAQjBx4B,KAAKu5B,eACLv5B,KAAKk5B,WAAW,WACZl5B,KAAKk5B,cACPL,KAAK74B,OAEX,IACIA,KAAKo4B,SAASsC,YAAcI,EAEhC,MAAOG,IAAK,WACR,IAAI7C,EAAW/J,EAAK+J,SAChBA,EAASiB,kBAAkB,WAC3B,IAAI1S,EAAO,WACPyR,EAASoB,oBAAoB,iBAAkB7S,GAC/CyR,EAASsC,YAAcI,GAE3B1C,EAASiB,iBAAiB,iBAAkB1S,GALjB,IAFvB,SAbR3mB,KAAKw4B,UAAYsC,GAwBzBnN,EAAMuN,eAAiB,WACnB,OAAOl7B,KAAKo4B,SAAWp4B,KAAKo4B,SAASsC,YAAc,GAGvD/M,EAAMlsB,YAAc,WAChB,OAAOzB,KAAKo4B,SAAWp4B,KAAKo4B,SAASx2B,SAAW,GAGpD+rB,EAAMwN,SAAW,WAET,IAAIhC,EAAOn5B,KAAKo4B,SAKpB,OAJQe,GAAQlB,EAAMS,MAAMK,UAAY/4B,KAAKy4B,QAAUU,EAAK/Z,SACpDpf,KAAKy4B,OAASR,EAAMS,MAAMM,QAG3Bh5B,KAAKy4B,QAGhB9K,EAAMyN,iBAAiB,MAAO,WAC1B,OAAOp7B,KAAKm4B,OAEhBxK,EAAM0N,iBAAiB,MAAO,SAAUzY,GAAM,IAAA0Y,EAAAt7B,KAwC1C,OAvCAA,KAAKu5B,eACD3W,GACA5iB,KAAKm4B,KAAOvV,EACRA,EAAK2Y,OACLv7B,KAAKy5B,YAEJ,WACD,IAAIlL,EAAA+M,EACJ1Y,EAAKwL,KAAK,OAAQ,WACVxL,IAAS2L,EAAK4J,MACd5J,EAAKkL,cAGb75B,GAAG47B,OAAOC,MACNC,IAAK9Y,EAAK+Y,UAEVC,OAAQ,WAEZ,SAAUX,EAAKY,GACPZ,EACAr7B,GAAG+6B,MAAMM,GAGRrY,EAAK2Y,SACN3Y,EAAK8W,aAAemC,KAlB3B,KAwBL77B,KAAKm4B,KAAO,KACRn4B,KAAKo4B,oBAAoBgB,iBACzBp5B,KAAKo4B,SAASF,IAAM,GAGpBl4B,KAAKo4B,SAAW,KAEpBp4B,KAAKy4B,OAASR,EAAMS,MAAMC,aAEvB/V,IAGX+K,EAAMyN,iBAAiB,SAAU,WAC7B,OAAOp7B,KAAKo4B,UAAWp4B,KAAKo4B,SAAShZ,SA5O7C,CAiPG6Y,EAAM31B,WAGT,IAAIu3B,EAAkB,SAAUiC,EAAQzB,GACpCr6B,KAAK+7B,OAAS1B,EACdr6B,KAAKg8B,SAAWnE,EAAIoE,eAAeC,QACnCl8B,KAAKm8B,QAAUL,EAEf97B,KAAKo8B,SAAWp8B,KAAKg8B,SAAL,aAChBh8B,KAAKs4B,QAAU,EAEXt4B,KAAKo8B,SAAL,KAAsBC,gBACtBr8B,KAAKo8B,SAAL,KAAsBC,gBAAgBr8B,KAAKs4B,QAASt4B,KAAKg8B,SAAStB,YAAa,KAE/E16B,KAAKo8B,SAAL,KAAsBr4B,MAAQ,EAElC/D,KAAKo8B,SAAL,QAAyBp8B,KAAKg8B,SAAL,aAEzBh8B,KAAKu4B,OAAQ,EAEbv4B,KAAKs8B,YAAc,EAEnBt8B,KAAKu8B,eAAiB,KAEtBv8B,KAAKw8B,aAAe,EAEpBx8B,KAAKy8B,cAAgB,KAErBz8B,KAAK08B,aAAe,WACZ18B,KAAKs5B,SACLt5B,KAAKs5B,QAAQt5B,OAEnB64B,KAAK74B,QAGX,SAAW2tB,GACPA,EAAM1G,KAAO,SAAUmT,GAAQ,IAAAuC,EAAA38B,KAEvBA,KAAKu8B,iBAAmBv8B,KAAKof,SAC7Bpf,KAAKu8B,eAAejD,QAAU,KAC9Bt5B,KAAKu8B,eAAe97B,KAAK,GACzBT,KAAKw8B,aAAe,GAGxB,IAAInC,EAAQr6B,KAAKg8B,SAAL,qBACZ3B,EAAMyB,OAAS97B,KAAKm8B,QACpB9B,EAAA,QAAiBr6B,KAAKo8B,UACtB/B,EAAMO,KAAO56B,KAAKu4B,MAElBv4B,KAAKs8B,WAAat8B,KAAKg8B,SAAStB,aAChCN,EAASA,GAAUp6B,KAAKw8B,gBAEpBx8B,KAAKs8B,YAAclC,GAEvB,IAAIx4B,EAAW5B,KAAKm8B,QAAQv6B,SAExBklB,EAAYsT,EACZwC,OAAA,EACA58B,KAAKu4B,MACD8B,EAAM3Q,MACN2Q,EAAM3Q,MAAM,EAAG5C,GACVuT,EAAA,YACLA,EAAA,YAAqB,EAAGvT,GAExBuT,EAAA,OAAgB,EAAGvT,IAEvB8V,EAAUh7B,EAAWw4B,EACjBC,EAAM3Q,MACN2Q,EAAM3Q,MAAM,EAAG5C,EAAW8V,GACrBvC,EAAA,YACLA,EAAA,YAAqB,EAAGvT,EAAW8V,GAEnCvC,EAAA,OAAgB,EAAGvT,EAAW8V,IAGtC58B,KAAKu8B,eAAiBlC,EAEtBA,EAAMf,QAAUt5B,KAAK08B,aAIfrC,EAAM6B,QAAQvZ,OAAiC,cAAxB0X,EAAM6B,QAAQvZ,OAAwD,IAA9B3iB,KAAKg8B,SAAStB,aAAmB,WAClG,IAAInM,EAAAoO,EACJE,aAAaF,EAAKF,eAClBE,EAAKF,cAAgBK,WAAW,WACuC,IAA9BvO,EAAKyN,SAAStB,aAC/C1C,EAActyB,MACVy0B,SAAU5L,EAAKwN,OACf3B,OAAQA,EACRC,MAAO9L,KAGhB,IAX+F,IAe1GZ,EAAM/F,MAAQ,WAEV,GADAiV,aAAa78B,KAAKy8B,gBACdz8B,KAAKof,OAAT,CAEApf,KAAKw8B,aAAex8B,KAAKg8B,SAAStB,YAAc16B,KAAKs8B,WAErDt8B,KAAKw8B,cAAgBx8B,KAAKm8B,QAAQv6B,SAClC,IAAIy4B,EAAQr6B,KAAKu8B,eACjBv8B,KAAKu8B,eAAiB,KACtBv8B,KAAKs8B,YAAc,EACfjC,GACAA,EAAM55B,KAAK,KAGnBktB,EAAMyN,iBAAiB,SAAU,WAE7B,QAAIp7B,KAAKu8B,iBAAkBv8B,KAAKu8B,eAAe3B,SAItB,IAArB56B,KAAKs8B,YAIFt8B,KAAKg8B,SAAStB,YAAc16B,KAAKs8B,WAAat8B,KAAKm8B,QAAQv6B,YAGtE+rB,EAAMyN,iBAAiB,OAAQ,WAAc,OAAOp7B,KAAKu4B,QACzD5K,EAAM0N,iBAAiB,OAAQ,SAAU0B,GAIrC,OAHI/8B,KAAKu8B,iBACLv8B,KAAKu8B,eAAe3B,KAAOmC,GAExB/8B,KAAKu4B,MAAQwE,IAGxBpP,EAAMyN,iBAAiB,SAAU,WAC7B,OAAOp7B,KAAKs4B,UAEhB3K,EAAM0N,iBAAiB,SAAU,SAAUP,GAavC,OAZA96B,KAAKs4B,QAAUwC,EACX96B,KAAKo8B,SAAL,KAAsBC,gBACtBr8B,KAAKo8B,SAAL,KAAsBC,gBAAgBr8B,KAAKs4B,QAASt4B,KAAKg8B,SAAStB,YAAa,KAE/E16B,KAAKs4B,QAAL,KAAqBv0B,MAAQ+2B,EAE7BjD,EAAImF,KAAOnF,EAAIoF,SAAWj9B,KAAKof,QAAUpf,KAAKu8B,iBAE9Cv8B,KAAKu8B,eAAejD,QAAU,KAC9Bt5B,KAAK4nB,QACL5nB,KAAKinB,QAEF6T,IAGXnN,EAAMyN,iBAAiB,cAAe,WAClC,OAAIp7B,KAAKof,OACEpf,KAAKw8B,cAGhBx8B,KAAKw8B,aAAex8B,KAAKg8B,SAAStB,YAAc16B,KAAKs8B,WAErDt8B,KAAKw8B,cAAgBx8B,KAAKm8B,QAAQv6B,SAC3B5B,KAAKw8B,gBAEhB7O,EAAM0N,iBAAiB,cAAe,SAAUP,GAQ5C,OAPK96B,KAAKof,OAKNpf,KAAKw8B,aAAe1B,GAJpB96B,KAAK4nB,QACL5nB,KAAKw8B,aAAe1B,EACpB96B,KAAKinB,QAIF6T,IAGXnN,EAAMyN,iBAAiB,WAAY,WAC/B,OAAOp7B,KAAKm8B,QAAQv6B,YAzI5B,CA4IGi4B,EAAgBv3B,WAEnBnD,EAAOE,QAAUO,GAAGq4B,MAAQA,uHC7d5B,IAAMA,EAAQv4B,EAAQ,aAChBw9B,EAAYx9B,EAAQ,8BACpB2e,EAAKze,GAAGye,GAEV8e,EAAc,EACdC,EAAY/e,EAAGG,WAAU,GACzB6e,KACAC,KAeAC,EAAmB,SAAUC,GAC7B,IAAInF,EAAK8E,IACLM,EAAOJ,EAAQG,GAInB,GAHKC,IACDA,EAAOJ,EAAQG,OAEfE,EAAYC,mBAAqBF,EAAKj+B,OAAQ,CAC9C,IAAIo+B,EAAQH,EAAK1Z,QACF8Z,EAAeD,GAErBn9B,OAGb,IAAI45B,EAAQiD,EAAW50B,OAAS,IAAIuvB,EAChC9J,EAAW,WAEX,GADkB0P,EAAe79B,KAAKq4B,IACrB,QACN+E,EAAUp9B,KAAKq4B,IACtB,IAAIhX,EAAQoc,EAAK9Z,QAAQ3jB,KAAKq4B,IAC9Bz4B,GAAGye,GAAGiE,MAAMoF,aAAa+V,EAAMpc,IAhCxB,SAAUgZ,GACzBA,EAAMyD,gBAAkB,KACpBR,EAAW99B,OAAS,IACpB66B,EAAM5L,IAAI,SACV4L,EAAM5L,IAAI,QACV4L,EAAMnC,IAAM,KACZoF,EAAW53B,KAAK20B,IAGhBA,EAAMI,WAyBNsD,CAAa/9B,OAejB,OAZAq6B,EAAMnM,GAAG,QAAS,WACVluB,KAAK89B,iBACL99B,KAAK89B,kBAET3P,EAAS5rB,KAAKvC,OACfq6B,GAEHA,EAAMnM,GAAG,OAAQC,EAAUkM,GAC3BA,EAAMhC,GAAKA,EACX+E,EAAU/E,GAAMgC,EAChBoD,EAAK/3B,KAAK2yB,GAEHgC,GAGPwD,EAAiB,SAAUxF,GAC3B,OAAO+E,EAAU/E,IAGjB2F,EAAgB,SAAUjD,GAQ1B,OAPKA,EAIsB,iBAAXA,IACZA,EAASnV,OAAOC,WAAWkV,IAH3BA,EAAS,EAKNA,GAgBP2C,GAEAO,WAAYhG,EAAMS,MAElBwF,iBAAkB,QAClBP,kBAAmB,GAEnBP,UAAWA,EAeXnW,KAAM,SAAUrE,EAAMgY,EAAMG,GACxB,IACIV,EADAmD,EAAO5a,EAEX,GAAoB,iBAATA,EAEPhjB,GAAGu+B,OAAO,KAAM,iBAAkB,eAAgB,YAAa,eAAgB,SAG/E9D,EAAQkD,EAFRC,EAAO5a,GAGPsa,EAAUkB,WAAWZ,EAAM,SAAUvC,EAAKrY,GAClCA,IACAyX,EAAMnC,IAAMtV,SAInB,CACD,IAAKA,EACD,OAEJ4a,EAAO5a,EAAK+Y,WACZtB,EAAQkD,EAAiBC,IACnBtF,IAAMtV,EAQhB,OALAyX,EAAMN,QAAQa,IAAQ,GACtBG,EAASiD,EAAajD,GACtBV,EAAMP,UAAUiB,GAChBV,EAAMpT,OAECoT,EAAMhC,IAYjB0B,QAAS,SAAUsE,EAASzD,GACxB,IAAIP,EAAQwD,EAAeQ,GACtBhE,GAAUA,EAAMN,SAErBM,EAAMN,QAAQa,IAYlB0D,OAAQ,SAAUD,GACd,IAAIhE,EAAQwD,EAAeQ,GAC3B,SAAKhE,IAAUA,EAAMQ,UAEdR,EAAMQ,WAYjBf,UAAW,SAAUuE,EAAStD,GAC1B,IAAIV,EAAQwD,EAAeQ,GACvBhE,GACAA,EAAMP,UAAUiB,IAaxBC,UAAW,SAAUqD,GACjB,IAAIhE,EAAQwD,EAAeQ,GAC3B,OAAOhE,EAAQA,EAAMW,YAAc,GAavChB,eAAgB,SAAUqE,EAASE,GAC/B,IAAIlE,EAAQwD,EAAeQ,GAC3B,QAAIhE,IACAA,EAAML,eAAeuE,IACd,IAgBfrD,eAAgB,SAAUmD,GACtB,IAAIhE,EAAQwD,EAAeQ,GAC3B,OAAOhE,EAAQA,EAAMa,iBAAmB,GAY5Cz5B,YAAa,SAAU48B,GACnB,IAAIhE,EAAQwD,EAAeQ,GAC3B,OAAOhE,EAAQA,EAAM54B,cAAgB,GAYzC05B,SAAU,SAAUkD,GAChB,IAAIhE,EAAQwD,EAAeQ,GAC3B,OAAOhE,EAAQA,EAAMc,WAAan7B,KAAKi+B,WAAWnF,OAYtD0F,kBAAmB,SAAUH,EAASlQ,GAClC,IAAIkM,EAAQwD,EAAeQ,GACtBhE,IAELA,EAAMyD,gBAAkB3P,IAW5BvG,MAAO,SAAUyW,GACb,IAAIhE,EAAQwD,EAAeQ,GAC3B,QAAIhE,IACAA,EAAMzS,SACC,IAOf6W,iBAQAC,SAAU,WACN,IAAK,IAAIrG,KAAM+E,EAAW,CACtB,IAAI/C,EAAQ+C,EAAU/E,GACVgC,EAAMc,aACJlD,EAAMS,MAAMK,UACtB/4B,KAAKy+B,cAAc/4B,KAAK2yB,GACxBgC,EAAMzS,WAalBE,OAAQ,SAAUuW,GACd,IAAIhE,EAAQwD,EAAeQ,GACvBhE,GACAA,EAAMvS,UAWd6W,UAAW,WACP,IAAK,IAAIp/B,EAAI,EAAGA,EAAIS,KAAKy+B,cAAcj/B,SAAUD,EAAG,CAChD,IAAI84B,EAAKr4B,KAAKy+B,cAAcl/B,GACxB86B,EAAQwD,EAAexF,GACvBgC,GACAA,EAAMvS,SAEd9nB,KAAKy+B,cAAcj/B,OAAS,GAWhCiB,KAAM,SAAU49B,GACZ,IAAIhE,EAAQwD,EAAeQ,GAC3B,QAAIhE,IAEAA,EAAM55B,QACC,IAcfm+B,QAAS,WACL,IAAK,IAAIvG,KAAM+E,EAAW,CACtB,IAAI/C,EAAQ+C,EAAU/E,GAClBgC,GAEAA,EAAM55B,SAalBo+B,oBAAqB,SAAU/D,GAC3B96B,KAAK29B,kBAAoB7C,GAW7BgE,oBAAqB,WACjB,OAAO9+B,KAAK29B,mBAWhBoB,QAAS,SAAUnc,GACf,IAAIoc,EAAWpc,EACf,GAAoB,iBAATA,EAEPhjB,GAAGu+B,OAAO,KAAM,iBAAkB,eAAgB,YAAa,eAAgB,SAC/Ea,EAAWpc,MAEV,CACD,IAAKA,EACD,OAEJoc,EAAWpc,EAAK+Y,UAGpB,IAAI8B,EAAOJ,EAAQ2B,GACnB,GAAKvB,EACL,KAAOA,EAAKj+B,OAAS,GAAG,CACpB,IAAI64B,EAAKoF,EAAK/0B,MACV2xB,EAAQ+C,EAAU/E,GAClBgC,IAEAA,EAAM55B,cACC28B,EAAU/E,MAY7B4G,WAAY,WACRj/B,KAAK4+B,UACL,IAAIvE,OAAA,EACJ,IAAK,IAAIhC,KAAM+E,GACX/C,EAAQ+C,EAAU/E,KAEdgC,EAAMI,UAGd,KAAOJ,EAAQiD,EAAW50B,OACtB2xB,EAAMI,UAEV2C,EAAY/e,EAAGG,WAAU,GACzB6e,MASJ6B,WAAY,SAAUC,KAYtBC,QAAS,SAAUJ,EAAU7Q,GAKzBvuB,GAAG47B,OAAOC,KAAKuD,EAAU7Q,GAAY,SAAUwM,GACtCA,GACDxM,OAcZkR,mBAAoB,SAAUC,GAC1Bt/B,KAAKk+B,iBAAwB,KAALoB,GAG5BC,YAAa,KACbC,OAAQ,WAEJ,IAAK,IAAInH,KADTr4B,KAAKu/B,eACUnC,EAAW,CACtB,IAAI/C,EAAQ+C,EAAU/E,GACVgC,EAAMc,aACJlD,EAAMS,MAAMK,UACtB/4B,KAAKu/B,YAAY75B,KAAK2yB,GACtBgC,EAAMzS,WAKlB6X,SAAU,WACN,GAAKz/B,KAAKu/B,YAAV,CAEA,KAAOv/B,KAAKu/B,YAAY//B,OAAS,GAAG,CAChC,IAAI64B,EAAKr4B,KAAKu/B,YAAY72B,MACtB2xB,EAAQwD,EAAexF,GACvBgC,GAASA,EAAMvS,QACfuS,EAAMvS,SAEd9nB,KAAKu/B,YAAc,OAMvBG,QACIrH,IAAK,EACLuC,MAAM,EACNG,OAAQ,GAGZ4E,SACI5E,OAAQ,EACR6E,eAeJC,UAAW,SAAUjd,EAAMgY,GACvB,IAAIkF,EAAQ9/B,KAAK0/B,OAIjB,OAHA1/B,KAAKS,KAAKq/B,EAAMzH,IAChByH,EAAMzH,GAAKr4B,KAAKinB,KAAKrE,EAAMgY,EAAMkF,EAAM/E,QACvC+E,EAAMlF,KAAOA,EACNkF,EAAMzH,IAUjB0H,UAAW,WACP//B,KAAKS,KAAKT,KAAK0/B,OAAOrH,KAU1B2H,WAAY,WAER,OADAhgC,KAAK4nB,MAAM5nB,KAAK0/B,OAAOrH,IAChBr4B,KAAK0/B,OAAOrH,IAUvB4H,YAAa,WAET,OADAjgC,KAAK8nB,OAAO9nB,KAAK0/B,OAAOrH,IACjBr4B,KAAK0/B,OAAOrH,IAWvB6H,eAAgB,WACZ,OAAOlgC,KAAK0/B,OAAO3E,QAWvBoF,eAAgB,SAAUpF,GACtBA,EAASiD,EAAajD,GACtB,IAAI+E,EAAQ9/B,KAAK0/B,OAGjB,OAFAI,EAAM/E,OAASA,EACf/6B,KAAK85B,UAAUgG,EAAMzH,GAAIyH,EAAM/E,QACxB+E,EAAM/E,QAWjBqF,eAAgB,WACZ,OAAOpgC,KAAKm7B,SAASn7B,KAAK0/B,OAAOrH,MAAQr4B,KAAKi+B,WAAWlF,SAe7DsH,WAAY,SAAUzd,EAAMgY,GACxB,OAAO56B,KAAKinB,KAAKrE,EAAMgY,IAAQ,EAAO56B,KAAK2/B,QAAQ5E,SAWvDuF,iBAAkB,SAAUvF,GACxBA,EAASiD,EAAajD,GACtB,IAAIwF,EAAUvgC,KAAK0/B,OAAOrH,GAE1B,IAAK,IAAIA,KADTr4B,KAAK2/B,QAAQ5E,OAASA,EACPqC,EAAW,CACtB,IAAI/C,EAAQ+C,EAAU/E,GACjBgC,GAASA,EAAMhC,KAAOkI,GAC3B7C,EAAY5D,UAAUzB,EAAI0C,KAYlCyF,iBAAkB,WACd,OAAOxgC,KAAK2/B,QAAQ5E,QAWxB0F,YAAa,SAAUpC,GACnB,OAAOr+B,KAAK4nB,MAAMyW,IAUtBqC,gBAAiB,WACb,IAAIH,EAAUvgC,KAAK0/B,OAAOrH,GACtBsI,EAAS3gC,KAAK2/B,QAGlB,IAAK,IAAItH,KAFTsI,EAAOf,WAAWpgC,OAAS,EAEZ49B,EAAW,CACtB,IAAI/C,EAAQ+C,EAAU/E,GACtB,GAAKgC,GAASA,EAAMhC,KAAOkI,EACflG,EAAMc,aACJn7B,KAAKi+B,WAAWlF,UAC1B4H,EAAOf,WAAWl6B,KAAK2yB,GACvBgC,EAAMzS,WAalBgZ,aAAc,SAAUvI,GACpBr4B,KAAK8nB,OAAOuQ,IAUhBwI,iBAAkB,WAEd,IADA,IAAIC,EAAe9gC,KAAK2/B,QAAQC,WACvBrgC,EAAI,EAAGA,EAAIuhC,EAAathC,SAAUD,EAAG,CAC1C,IAAI84B,EAAKyI,EAAavhC,GAClB86B,EAAQ+C,EAAU/E,GAClBgC,GACAA,EAAMvS,WAYlBiZ,WAAY,SAAU1C,GAClB,OAAOr+B,KAAKS,KAAK49B,IAUrB2C,eAAgB,WACZ,IAAIT,EAAUvgC,KAAK0/B,OAAOrH,GAC1B,IAAK,IAAIA,KAAM+E,EAAW,CACtB,IAAI/C,EAAQ+C,EAAU/E,GACtB,GAAKgC,GAASA,EAAMhC,KAAOkI,EACflG,EAAMc,aACJuC,EAAYO,WAAWlF,SACjCsB,EAAM55B,UAMtBtB,EAAOE,QAAUO,GAAG89B,YAAcA,yEC3xBlC,IAAMuD,EAAcvhC,EAAQ,2BAEtBwhC,EAAexhC,EAAQ,6BACvByhC,EAAWzhC,EAAQ,eACnB0hC,EAAMF,EAAaE,IACnBC,EAAOzhC,GAAG0hC,MAAMD,KAEhBE,GACFC,OAAQ,EACRC,KAAM,EACNC,KAAM,EACNC,KAAM,EACNC,KAAM,EACNC,KAAM,EACNC,KAAM,IAGJC,GACFC,KAAMC,UACNC,KAAMC,WACNC,KAAMC,WACNC,KAAMC,YACNC,KAAMC,WACNC,KAAMC,YACNC,KAAMC,cAGJC,GACFC,SAAU3B,EAAI4B,cACdC,OAAQ7B,EAAI8B,YACZC,QAAS/B,EAAIgC,aACbC,QAASjC,EAAIkC,YACbC,WAAYnC,EAAIoC,SAChBC,WAAYrC,EAAIsC,SAChBC,WAAYvC,EAAIwC,SAChBC,WAAYzC,EAAI0C,SAChBC,SAAU3C,EAAI4C,YACdC,UAAW7C,EAAI8C,cAGfC,EAAQvkC,GAAGE,OACXb,KAAM,WACNsC,QAAS3B,GAAG2oB,MAEZxoB,KAJiB,WAKbC,KAAKokC,cAAe,GAGxB5b,YACI6b,UAAWpD,GAEXqD,OACI7b,aAIR8b,WAhBiB,WAiBb,IAAIvkC,KAAKokC,aAAT,CACApkC,KAAKokC,cAAe,EAGpB,IADA,IAAII,EAAQxkC,KAAKskC,MAAME,MACdjlC,EAAI,EAAGA,EAAIilC,EAAMhlC,OAAQD,IAAK,CACnC,IAAIklC,EAAOD,EAAMjlC,GAEjBklC,EAAKjH,KAAOiH,EAAK9/B,OAAS8/B,EAAK9/B,OAAO64B,KAAO,IAAMiH,EAAKxlC,KAAO,GAE/D,IAAIylC,EAAWD,EAAKC,SACpB,GAAIA,EACA,IAAK,IAAItY,EAAI,EAAGA,EAAIsY,EAASllC,OAAQ4sB,IAAK,CAC1BoY,EAAME,EAAStY,IACrBznB,OAAS8/B,MAM/BE,aApCiB,SAoCHC,GACV5kC,KAAKukC,aAEL,IAAIM,EAAO7kC,KAAKskC,MACZQ,EAAU9kC,KAAKqkC,SACfU,EAASH,EAASI,QACtB,GAAID,GAAUF,EAAKI,MAAMzlC,OACrB,OAAO,KAYX,IATA,IAAI0lC,EAAWL,EAAKI,MAAMF,GAGtBI,EAAWN,EAAKO,UAAUF,EAASG,qBACnCC,EAAUT,EAAKU,YAAYJ,EAASK,YACpCC,EAAMX,EAAQQ,EAAQxJ,QAAQK,QAC9BxrB,EAAO,IAAIkyB,aAAa4C,EAAKH,EAAQI,WAAaP,EAASO,WAA6B,GAAjBP,EAASQ,OAChFC,EAAY,IAAIvyB,MAAM8xB,EAASQ,OAE1BpmC,EAAI,EAAGA,EAAI4lC,EAASQ,QAASpmC,EAClCqmC,EAAUrmC,GAAKK,GAAG0hC,MAAMuE,KAAKC,IACzBn1B,EAAK,GAAKpR,EAAI,GAAIoR,EAAK,GAAKpR,EAAI,GAAIoR,EAAK,GAAKpR,EAAI,GAAIoR,EAAK,GAAKpR,EAAI,GACpEoR,EAAK,GAAKpR,EAAI,GAAIoR,EAAK,GAAKpR,EAAI,GAAIoR,EAAK,GAAKpR,EAAI,GAAIoR,EAAK,GAAKpR,EAAI,GACpEoR,EAAK,GAAKpR,EAAI,GAAIoR,EAAK,GAAKpR,EAAI,GAAIoR,EAAK,GAAKpR,EAAI,IAAKoR,EAAK,GAAKpR,EAAI,IACrEoR,EAAK,GAAKpR,EAAI,IAAKoR,EAAK,GAAKpR,EAAI,IAAKoR,EAAK,GAAKpR,EAAI,IAAKoR,EAAK,GAAKpR,EAAI,KAI/E,IAAIwmC,EAAeb,EAASc,OACxBC,EAAarB,EAASqB,WAC1BA,EAAWzmC,OAAS,EAEpB,IADA,IAAIglC,EAAQxkC,KAAKskC,MAAME,MACdzf,EAAI,EAAGA,EAAIghB,EAAavmC,OAAQulB,IAAK,CAC1C,IAAI0f,EAAOD,EAAMuB,EAAahhB,IAC9BkhB,EAAWvgC,KAAK++B,EAAKjH,MAEzBoH,EAASqB,WAAaA,EACtBrB,EAASgB,UAAYA,GAGzBM,UA5EiB,SA4ENrB,EAAMO,EAAWe,GAExB,IAAIC,KACAC,EAAS,EAETX,EAAa,IAAMY,EAAgB,EACnCC,GAAmB,EACnBC,EAAaL,EAAUK,WAC3B,IAAK,IAAIC,KAAkBD,EAAY,CACnC,IAAME,EAAgB5D,EAAe2D,GACrC,QAAsBpgC,IAAlBqgC,EAEA,YADAC,QAAQhM,MAAR,qCAAmD8L,EAAnD,KAGJ,IAAIG,EAAMxB,EAAUoB,EAAWC,IAC/BJ,EAAShhC,KAAKE,IAAIqhC,EAAIjB,MAAOU,GAE7B,IAAIQ,EAAShC,EAAKU,YAAYqB,EAAIpB,YAClCe,EAAkBM,EAAO/K,OACzBsK,EAAK1gC,MACDzG,KAAMynC,EAAehe,KAAMke,EAAIE,cAAehM,IAAKyG,EAAWqF,EAAIle,MAClEqe,WAAYF,EAAOE,WAAYrB,WAAYmB,EAAOnB,aAGtDA,EAAargC,KAAKC,IAAIogC,EAAYmB,EAAOnB,YACzCY,EAAgBjhC,KAAKE,IAAI+gC,EAAeO,EAAOnB,WAAamB,EAAOE,YAKvE,IAFA,IAAIC,EAAU,IAAI5F,EAAI6F,aAAab,GAC/Bc,EAAMF,EAAQG,UACT5nC,EAAI,EAAGA,EAAI2nC,EAAI1nC,OAAQD,IAAK,CACjC,IAAI6nC,EAAKF,EAAI3nC,GACb6nC,EAAGhN,OAASgM,EAAK7mC,GAAGmmC,WAAaA,EACjC0B,EAAGC,OAASD,EAAGE,MAGnB,IAAI7B,EAAMzlC,KAAKqkC,SAASkC,GAAiBpK,QAGrCoL,EAAS,IAAIpF,WAAWsD,EAAKC,EAAYY,EAAgBZ,GAS7D,OACI5J,OATK,IAAIsF,EAAIoG,aACbrG,EAASsG,OACTT,EACA5F,EAAIsG,aACJH,EACAlB,GAKA11B,KAAM42B,IAIdI,UAlIiB,SAkIN9C,EAAMO,EAAWe,GACxB,IAAIyB,EAAQxC,EAAUe,EAAU0B,SAC5BC,EAASjD,EAAKU,YAAYqC,EAAMpC,YAChCC,EAAMzlC,KAAKqkC,SAASyD,EAAOhM,QAAQK,QACnC4L,EAAS,IAAIxF,YAAYkD,EAAKqC,EAAOpC,WAAYoC,EAAOf,WAAa,GASzE,OACIjL,OATW,IAAIsF,EAAI4G,YACnB7G,EAASsG,OACTG,EAAMd,cACN1F,EAAIsG,aACJK,EACAH,EAAMjC,OAKNh1B,KAAMo3B,IAIdE,aArJiB,SAqJHpD,EAAMqD,GAChB,IAAItB,EAAM/B,EAAKO,UAAU8C,GACrB5C,EAAUT,EAAKU,YAAYqB,EAAIpB,YAC/BC,EAAMzlC,KAAKqkC,SAASiB,EAAQxJ,QAAQK,QAEpCrB,EAAMyG,EAAWqF,EAAIle,MAIzB,OAFa,IAAIyf,EADApG,EAAgB6E,EAAIE,gBACTrB,EAAKH,EAAQI,WAAakB,EAAIlB,WAAYkB,EAAIjB,MAAQ7K,IAKtFsN,SAjKiB,SAiKPC,GACN,IAAMhnB,EAAQgnB,EAAUC,QAElBzD,EAAO7kC,KAAKskC,MACZiE,EAAW1D,EAAK2D,OAAOnnB,GACvB+jB,EAAYP,EAAKO,UAGnB5lC,EAAS+oC,EAASE,WAAWjpC,OACjC6oC,EAAUK,KAAKlpC,OAASA,EACxB6oC,EAAUM,KAAKnpC,OAASA,EACxB6oC,EAAUO,WAAWppC,OAASA,EAC9B6hC,EAAKvV,IAAIuc,EAAUQ,QAAS1iB,EAAAA,EAAUA,EAAAA,EAAUA,EAAAA,GAChDkb,EAAKvV,IAAIuc,EAAUS,SAAU3iB,EAAAA,GAAWA,EAAAA,GAAWA,EAAAA,GACnD,IAAK,IAAI5mB,EAAI,EAAGA,EAAIC,IAAUD,EAAG,CAC7B,IAAI4mC,EAAYoC,EAASE,WAAWlpC,GAEpC,QAA0B8G,IAAtB8/B,EAAU0B,QAAd,CAEA,IAAIkB,EAAK/oC,KAAKkmC,UAAUrB,EAAMO,EAAWe,GACrC6C,EAAKhpC,KAAK2nC,UAAU9C,EAAMO,EAAWe,GAEzC,GAAIA,EAAUK,WAAWzD,SAAU,CAC/B,IAAIkG,EAAe7D,EAAUe,EAAUK,WAAWzD,UAC9CmG,EAASb,EAAUQ,QAASM,EAASd,EAAUS,QAC/CxjC,EAAM2jC,EAAa3jC,IAAKC,EAAM0jC,EAAa1jC,IAC/C2jC,EAAO5pC,EAAI+F,KAAKC,IAAI4jC,EAAO5pC,EAAGgG,EAAI,IAClC4jC,EAAOxlC,EAAI2B,KAAKC,IAAI4jC,EAAOxlC,EAAG4B,EAAI,IAClC4jC,EAAOE,EAAI/jC,KAAKC,IAAI4jC,EAAOE,EAAG9jC,EAAI,IAClC6jC,EAAO7pC,EAAI+F,KAAKE,IAAI4jC,EAAO7pC,EAAGiG,EAAI,IAClC4jC,EAAOzlC,EAAI2B,KAAKE,IAAI4jC,EAAOzlC,EAAG6B,EAAI,IAClC4jC,EAAOC,EAAI/jC,KAAKE,IAAI4jC,EAAOC,EAAG7jC,EAAI,IAGtC8iC,EAAUO,WAAWrpC,GAAK,IAAI2hC,EAAamI,eAAeN,EAAGjN,OAAQkN,EAAGlN,QACxEuM,EAAUM,KAAKppC,GAAKwpC,EACpBV,EAAUK,KAAKnpC,GAAKypC,KAI5BM,kBAzMiB,SAyME1mB,GACf5iB,KAAKukC,aAEL,IAAIM,EAAO7kC,KAAKskC,MACZiF,EAAgB1E,EAAK2E,WAAW5mB,EAAK6mB,cAEzC7mB,EAAKkD,SAAWlmB,GAAGyoB,SAASpC,KAU5B,IATA,IAAIrkB,EAAW,EAEXujB,EAAYvC,EAAKuC,UACjBkB,EAAQlB,EAAUkB,SAElBme,EAAQK,EAAKL,MAEbkF,EAAWH,EAAcG,SACzBC,EAAWJ,EAAcI,SACpBpqC,EAAI,EAAGA,EAAIoqC,EAASnqC,SAAUD,EAAG,CACtC,IAAIqqC,EAAcD,EAASpqC,GACvBsqC,EAAUH,EAASE,EAAYC,SAE/BC,EAAa9pC,KAAKioC,aAAapD,EAAMgF,EAAQE,OAC7CC,EAAchqC,KAAKioC,aAAapD,EAAMgF,EAAQI,QAE9C/pC,EAAS0pC,EAAY1pC,OAGrBs9B,EAFOgH,EAAMtkC,EAAOukC,MAERjH,KAEZ3a,OAAA,EACS,KAAT2a,EACA3a,EAASsC,GAGJkB,EAAMmX,KACPnX,EAAMmX,OAEV3a,EAASwD,EAAMmX,IAGd3a,EAAOwC,QACRxC,EAAOwC,UAIX,IADA,IAAI4D,KACKihB,EAAW,EAAGA,EAAWJ,EAAWtqC,OAAQ0qC,IAAY,CAC7D,IAAI/lB,EAAQ2lB,EAAWI,GACnB/lB,EAAQviB,IACRA,EAAWuiB,GAEf8E,EAAOvjB,MAAOye,MAAOA,IAEzB,GAAoB,gBAAhBjkB,EAAOs9B,KAAwB,CAC/B,IAAK,IAAI2M,EAAW,EAAGA,EAAWL,EAAWtqC,OAAQ2qC,IAAY,CAC7D,IAAIC,EAAe,EAAXD,EACRlhB,EAAOkhB,GAAUpmC,MAAQnE,GAAGyW,GAAG2zB,EAAYI,GAAIJ,EAAYI,EAAI,GAAIJ,EAAYI,EAAI,IAEvFvnB,EAAOwC,MAAM1O,SAAWsS,OAEvB,GAAoB,aAAhB/oB,EAAOs9B,KAAqB,CACjC,IAAK,IAAI6M,EAAW,EAAGA,EAAWP,EAAWtqC,OAAQ6qC,IAAY,CAC7D,IAAIC,EAAe,EAAXD,EACRphB,EAAOohB,GAAUtmC,MAAQnE,GAAG2qC,KAAKP,EAAYM,GAAIN,EAAYM,EAAI,GAAIN,EAAYM,EAAI,GAAIN,EAAYM,EAAI,IAE7GznB,EAAOwC,MAAMklB,KAAOthB,OAEnB,GAAoB,UAAhB/oB,EAAOs9B,KAAkB,CAC9B,IAAK,IAAIgN,EAAW,EAAGA,EAAWV,EAAWtqC,OAAQgrC,IAAY,CAC7D,IAAIC,EAAe,EAAXD,EACRvhB,EAAOuhB,GAAUzmC,MAAQnE,GAAGyW,GAAG2zB,EAAYS,GAAIT,EAAYS,EAAI,GAAIT,EAAYS,EAAI,IAEvF5nB,EAAOwC,MAAMqlB,MAAQzhB,GAI7B,IAAK,IAAI0hB,EAAI,EAAGA,EAAInG,EAAMhlC,OAAQmrC,IAAK,CACnC,IAAIC,EAAOpG,EAAMmG,GACjB,IAAItkB,EAAMukB,EAAKpN,MAAf,CAEA,IACInY,GADSgB,EAAMukB,EAAKpN,OAAUnY,WACfA,MAEfwlB,EAAWD,EAAKC,SAChBA,IACAxlB,EAAMklB,OACFpmB,MAAO,EACPpgB,MAAOnE,GAAG2qC,KAAKM,EAAS,GAAIA,EAAS,GAAIA,EAAS,GAAIA,EAAS,OAIvE,IAAIH,EAAQE,EAAKF,MACbA,IACArlB,EAAMqlB,QACFvmB,MAAO,EACPpgB,MAAOnE,GAAGyW,GAAGq0B,EAAM,GAAIA,EAAM,GAAIA,EAAM,OAI/C,IAAII,EAAcF,EAAKE,YACnBA,IACAzlB,EAAM1O,WACFwN,MAAO,EACPpgB,MAAOnE,GAAGyW,GAAGy0B,EAAY,GAAIA,EAAY,GAAIA,EAAY,QAKrEloB,EAAKphB,UAAYI,KAIzBhC,GAAGukC,MAAQhlC,EAAOE,QAAU8kC,yGC/V5B,IAAMA,EAAQzkC,EAAQ,aAElBqrC,EAAoBnrC,GAAGE,OACvBb,KAAM,oBAENc,KAH6B,WAIzBC,KAAK4oC,cACL5oC,KAAK0oC,QACL1oC,KAAK2oC,QACL3oC,KAAKgrC,SAAU,EACfhrC,KAAK6oC,QAAUjpC,GAAGyW,KAClBrW,KAAK8oC,QAAUlpC,GAAGyW,MAGtBmS,YACI8f,SAAU,EACV2C,QACIviB,KAAMyb,EACN1b,QAAS,MAGbyiB,QACIviB,IADI,WAEA,OAAO3oB,KAAKsoC,SAEhBxc,IAJI,SAICqf,GACDnrC,KAAKsoC,QAAU6C,IAIvBC,OACIziB,IADG,WAEC,OAAO3oB,KAAKirC,QAEhBnf,IAJG,SAIEqf,GACDnrC,KAAKirC,OAASE,KAK1BE,MAtC6B,SAsCtBC,GACEtrC,KAAKgrC,UACNhrC,KAAKgrC,SAAU,EACfhrC,KAAKorC,MAAMhD,SAASpoC,OAGxBsrC,EAAK3C,KAAO3oC,KAAK2oC,KACjB2C,EAAK5C,KAAO1oC,KAAK0oC,KACjB4C,EAAK1C,WAAa5oC,KAAK4oC,WACvB0C,EAAKzC,QAAU7oC,KAAK6oC,QACpByC,EAAKxC,QAAU9oC,KAAK8oC,WAI5B3pC,EAAOE,QAAU0rC,yCC9EjB,IAAIQ,EAAW3rC,GAAGE,OACdb,KAAM,cACNsC,QAAS3B,GAAG2oB,MAEZxoB,KAJoB,WAKhBC,KAAKimC,cACLjmC,KAAK4lC,cAGTpd,YACIgjB,cACI1f,IAAK,SAAUsf,GAKXprC,KAAKyrC,eAAeL,MAKhCK,eArBoB,SAqBJL,GACPA,IACLprC,KAAKirC,OAASG,EACdprC,KAAKirC,OAAOtG,aAAa3kC,QAG7B0rC,YAAYC,EAWZC,aAtCoB,SAsCNj7B,EAAMk7B,GAChB7rC,KAAK8rC,WAAan7B,EAAKo7B,UACvB/rC,KAAKglC,QAAUr0B,EAAKo0B,OAEhB/kC,KAAK8rC,YACLD,EAAOv3B,OAAO5O,KAAK1F,KAAM,eAAgBA,KAAK8rC,eAK1DlsC,GAAG2rC,SAAWpsC,EAAOE,QAAUksC,2BCxB/B,IAAMS,EAAYtsC,EAAQ,6BACpBykC,EAAQzkC,EAAQ,aAChBusC,EAAwBvsC,EAAQ,6BAYlCwsC,GAXkBxsC,EAAQ,kCAWNE,GAAGE,OACvBb,KAAM,uBACNsC,QAASyqC,EAETG,QAAQR,EAKRnjB,YACIyiB,OAAQ9G,EAERiI,cACIC,UAAU,EACV5jB,QAAS,KACTC,KAAMujB,GAGVK,QACID,UAAU,EACV5jB,WACAC,MAAOujB,GACPpjB,SAAS,GAGb0jB,aACIF,UAAU,EACV1jB,IAFS,WAGL,OAAO3oB,KAAKosC,cAEhBtgB,IALS,SAKJ0C,GACDxuB,KAAKosC,aAAe5d,GAExB9F,KAAMujB,GAGVb,OACIziB,IADG,WAEC,OAAO3oB,KAAKirC,QAEhBnf,IAJG,SAIEqf,GACDnrC,KAAKirC,OAASE,GAElBziB,KAAMyb,IAIdqI,kBA/C6B,SA+CVvtC,GACf,IAAI0jB,EAAQ3iB,KAAKysC,OAAOxtC,GAGxB,OAFW0jB,EAAMC,KACZxT,OACEuT,GAGX+pB,aAAaf,KAyBjB/rC,GAAGssC,kBAAoB/sC,EAAOE,QAAU6sC,6JC7FxC,IAAM/H,EAAQzkC,EAAQ,aAChB4oB,EAAgB5oB,EAAQ,kCAW1BusC,EAAwBrsC,GAAGE,OAC3Bb,KAAM,2BACNsC,QAAS+mB,EAETE,YACIgjB,cACI1f,IAAK,SAAUsf,GACXprC,KAAKirC,OAASG,IAItBA,OACIziB,IADG,WAEC,OAAO3oB,KAAKirC,QAGhBviB,KAAMyb,IAIdpkC,KApBiC,WAqB7BC,KAAK8rC,WAAa,GAClB9rC,KAAKypC,cAAgB,EACrBzpC,KAAKirC,OAAS,KACdjrC,KAAKgrC,SAAU,GAGnB57B,KA3BiC,WA4BzBpP,KAAKgrC,UACThrC,KAAKgrC,SAAU,EACfhrC,KAAKirC,OAAO3B,kBAAkBtpC,QAGlC0rC,YAAYC,EAYZC,aA7CiC,SA6CnBj7B,EAAMk7B,GAChB7rC,KAAK8rC,WAAan7B,EAAKo7B,UACvB/rC,KAAKypC,aAAe94B,EAAKg8B,YACzB3sC,KAAKstB,MAAQ3c,EAAK1R,KAEde,KAAK8rC,YACLD,EAAOv3B,OAAO5O,KAAK1F,KAAM,eAAgBA,KAAK8rC,eAK1DlsC,GAAGqsC,sBAAwB9sC,EAAOE,QAAU4sC,4ECpE5C,IAAMV,EAAW7rC,EAAQ,gBACnBktC,EAAeltC,EAAQ,0BACvBwhC,EAAexhC,EAAQ,6BACvBmmC,EAAOjmC,GAAG0hC,MAAMuE,KAElBgH,EAAUhH,EAAKiH,SAEfC,EAAsBntC,GAAGE,OACzBb,KAAM,yBACNsC,QAASqrC,EAETT,QAAQR,EAIR5rC,KAR+B,WAS3BC,KAAKgtC,mBAAqB,KAC1BhtC,KAAKitC,eAAiB,KACtBjtC,KAAKktC,WACLltC,KAAKmtC,aAELntC,KAAKotC,WAAaR,EAAaQ,YAGnC5kB,YACI6kB,UAAW9B,EACX+B,UAAW1tC,GAAG2jB,KAEdqhB,UACIjc,IADM,WAEF,OAAO3oB,KAAKqtC,WAEhBvhB,IAJM,SAIDqf,GACDnrC,KAAKqtC,UAAYlC,EACjBnrC,KAAKutC,cACLvtC,KAAKwtC,qBACLxtC,KAAKytC,iBAAgB,IAEzB/kB,KAAM6iB,GAGVmC,UACI/kB,IADM,WAEF,OAAO3oB,KAAKstC,WAEhBxhB,IAJM,SAIDqf,GACDnrC,KAAKstC,UAAYnC,EACjBnrC,KAAKutC,eAET7kB,KAAM9oB,GAAG2jB,OAIjBoqB,gBA9C+B,WA+C3B,IAAIC,EAAW,IAAI1M,EAAa2M,aAgBhC,OAfAD,EAASpxB,MAAQ5c,GAAG8c,MAAMoxB,MAC1BF,EAASG,UAAUC,QAAQ,GAAGC,UAAS,GAAM,GAC7CL,EAASM,UAAW,EACpBN,EAASO,aAAc,EAEnBnuC,KAAKitC,gBACLW,EAASQ,kBAAmB,EAC5BR,EAASS,cAAgBruC,KAAKitC,eAC9BW,EAASU,kBAAoBtuC,KAAKitC,eAAetpC,QAGjDiqC,EAASQ,kBAAmB,EAC5BR,EAASW,cAAgBvuC,KAAKgtC,oBAG3BY,GAGXH,gBAlE+B,SAkEde,GACRxuC,KAAKgtC,mBAKVhtC,KAAKysC,OAAO+B,GAJRxuC,KAAKyuC,iBAObC,UA3E+B,WA4E3B1uC,KAAKutC,cACLvtC,KAAKwtC,sBAGTD,YAhF+B,WAiF3B,IAAIvH,EAAShmC,KAAKktC,QAGlB,GAFAlH,EAAOxmC,OAAS,EAEXQ,KAAK4kC,UAAa5kC,KAAK0tC,SAA5B,CAEA,IAAIzH,EAAajmC,KAAK4kC,SAASqB,WAC3ByH,EAAW1tC,KAAK0tC,SAChBiB,EAAW3uC,KAAKmtC,UACpBwB,EAASnvC,OAAS,EAClB,IAAK,IAAID,EAAI,EAAGA,EAAI0mC,EAAWzmC,OAAQD,IAAK,CACxC,IAAIqvC,EAAOhvC,GAAG2mB,KAAK0f,EAAW1mC,GAAImuC,GAC7BkB,GACDhvC,GAAGivC,KAAK,sDAAuDnB,EAASzuC,KAAMgnC,EAAW1mC,IAE7FymC,EAAOtgC,KAAKkpC,GACZD,EAASjpC,KAAKmgC,EAAKiH,UAGvB9sC,KAAK8uC,mBAGTtB,mBAtG+B,WAuG3B,GAAKxtC,KAAKqtC,UAAV,CAEA,IAAI0B,EAAa/uC,KAAKktC,QAAQ1tC,OAG9B,KAD4BI,GAAGuhC,SAASsG,OAAOuH,IAAI,qBAC1B,CAErB,IAAIC,OAAA,EAEAA,EADAF,EAAa,IACN,GACAA,EAAa,GACb,GACAA,EAAa,GACb,GAEA,EAGX/uC,KAAKgtC,mBAAqB,IAAInK,aAAaoM,EAAOA,EAAO,GAEzD,IAAIC,EAAUlvC,KAAKitC,gBAAkB,IAAIrtC,GAAGuvC,UAC5CD,EAAQE,aAAapvC,KAAKgtC,mBAAoBptC,GAAGuvC,UAAUE,YAAYC,QAASL,EAAMA,GAEtFjvC,KAAKitC,eAAiBiC,OAGtBlvC,KAAKgtC,mBAAqB,IAAInK,aAA0B,GAAbkM,KAInDQ,sBArI+B,SAqIRC,EAASC,GAC5B,IAAIxwB,EAAMjf,KAAKgtC,mBACf/tB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOC,IAC/BzwB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOE,IAC/B1wB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOG,IAC/B3wB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOI,IAC/B5wB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOK,IAC/B7wB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOM,IAC/B9wB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOO,IAC/B/wB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOQ,IAC/BhxB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOS,IAC/BjxB,EAAI,GAAKuwB,EAAU,GAAKC,EAAOU,IAC/BlxB,EAAI,GAAKuwB,EAAU,IAAMC,EAAOW,IAChCnxB,EAAI,GAAKuwB,EAAU,IAAMC,EAAOY,IAChCpxB,EAAI,GAAKuwB,EAAU,IAAMC,EAAOa,IAChCrxB,EAAI,GAAKuwB,EAAU,IAAMC,EAAOc,IAChCtxB,EAAI,GAAKuwB,EAAU,IAAMC,EAAOe,IAChCvxB,EAAI,GAAKuwB,EAAU,IAAMC,EAAOgB,KAGpCC,kBAzJ+B,WA0JvB1wC,KAAKitC,gBACLjtC,KAAKitC,eAAepsC,QAAS8vC,MAAO3wC,KAAKgtC,sBAIjD8B,eA/J+B,WAgK3B,IAAK,IAAIvvC,EAAI,EAAGA,EAAIS,KAAKktC,QAAQ1tC,SAAUD,EAAG,CAC1C,IAAIqxC,EAAQ5wC,KAAKktC,QAAQ3tC,GACpBqxC,GAAUA,EAAM5rC,mBACrB4rC,EAAMC,eAAe7wC,KAAKmtC,UAAU5tC,MAI5CsB,OAvK+B,WAwK3B,GAAKb,KAAK4kC,UAAa5kC,KAAK0tC,SAA5B,CACA,IAAM9H,EAAY5lC,KAAK4kC,SAASgB,UAC1B+I,EAAW3uC,KAAKmtC,UAEtBntC,KAAK8uC,iBAEL,IAAK,IAAIvvC,EAAI,EAAGA,EAAIqmC,EAAUpmC,SAAUD,EAAG,CACvC,IAAIuxC,EAAWlL,EAAUrmC,GACrBwxC,EAAcpC,EAASpvC,GAE3BsmC,EAAKmL,SAASnE,EAASkE,EAAaD,GACpC9wC,KAAKuvC,sBAAsBhwC,EAAGstC,GAGlC7sC,KAAK0wC,wBAIb9wC,GAAGmtC,oBAAsB5tC,EAAOE,QAAU0tC,yGCzN1C,IAAMxC,EAAO3qC,GAAG0hC,MAAMiJ,KAClB0G,EAAYrxC,GAAG2qC,OACf2G,EAAYtxC,GAAGyW,KAcnBzW,GAAGuxC,WAAavxC,GAAGE,OACfb,KAAM,gBACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAK,SAAU6B,EAAUwvC,EAAWC,EAAWC,GAC3CtxC,KAAKuxC,WAAa3xC,GAAG2qC,OACrBvqC,KAAKwxC,SAAW5xC,GAAG2qC,YAEXlkC,IAAd+qC,GAA2BpxC,KAAKsG,iBAAiB1E,EAAUwvC,EAAWC,EAAWC,IAW/EhrC,iBAAiB,SAAU1E,EAAUwvC,EAAWC,EAAWC,GACvD,GAAI1xC,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,GAAW,CACnE,IAAI6vC,EAAUzxC,KAAKwxC,SAgBnB,OAfIJ,aAAqBxxC,GAAG8xC,KACxBD,EAAQ3lB,IAAIslB,IAGRA,aAAqBxxC,GAAG+xC,MACxBN,EAAYD,EAAU1tC,EACtB4tC,EAAYF,EAAUhI,EACtBgI,EAAYA,EAAU9xC,IAGtB+xC,EAAYA,GAAa,EACzBC,EAAYA,GAAa,GAE7B1xC,GAAG0hC,MAAMiJ,KAAKqH,UAAUH,EAASL,EAAWC,EAAWC,KAEpD,EAEX,OAAO,GAGXjxC,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGuxC,WAGpB,OAFAnxC,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAKwxC,UACtClxC,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAKuxC,WAAWzlB,IAAI5rB,EAAOqqC,OAG/B1oC,QAAQ,WACJjC,GAAGgB,MAAM,OAGbC,OAAO,SAAUF,GACbA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,SACLqqC,EAAKsH,MAAMZ,EAAWjxC,KAAKuxC,WAAYvxC,KAAKwxC,SAAU7wC,GACtDX,KAAKE,OAAO4xC,YAAYb,OAoBpCrxC,GAAGmyC,WAAa,SAAUnwC,EAAUwvC,EAAWC,EAAWC,GACtD,OAAO,IAAI1xC,GAAGuxC,WAAWvvC,EAAUwvC,EAAWC,EAAWC,IAgB7D1xC,GAAGoyC,WAAapyC,GAAGE,OACfb,KAAM,gBACNsC,QAAS3B,GAAGiG,eAEZ9F,KAAM,SAAU6B,EAAUqwC,EAAaC,EAAaC,GAChDnyC,KAAK+V,OAASnW,GAAGyW,KACjBrW,KAAKoyC,MAAQxyC,GAAG2qC,OAChBvqC,KAAKqyC,QAAU,OACLhsC,IAAhB4rC,GAA6BjyC,KAAKsG,iBAAiB1E,EAAUqwC,EAAaC,EAAaC,IAWrF7rC,iBAAiB,SAAU1E,EAAUqwC,EAAaC,EAAaC,GAC3D,QAAIvyC,GAAGiG,eAAevD,UAAUgE,iBAAiB/D,KAAKvC,KAAM4B,KACpDqwC,aAAuBryC,GAAG+xC,MAC1BO,EAAcD,EAAYvuC,EAC1ByuC,EAAcF,EAAY7I,EAC1B6I,EAAcA,EAAY3yC,IAG1B4yC,EAAcA,GAAe,EAC7BC,EAAcA,GAAe,GAEjCvyC,GAAG0hC,MAAMD,KAAKvV,IAAI9rB,KAAK+V,OAAQk8B,EAAaC,EAAaC,IAClD,IAKf9xC,MAAM,WACF,IAAIC,EAAS,IAAIV,GAAGoyC,WAGpB,OAFAhyC,KAAK+R,iBAAiBzR,GACtBA,EAAOgG,iBAAiBtG,KAAKwB,UAAWxB,KAAK+V,QACtCzV,GAGXE,gBAAgB,SAAUN,GACtBN,GAAGiG,eAAevD,UAAU9B,gBAAgB+B,KAAKvC,KAAME,GACvDF,KAAKoyC,MAAMtmB,IAAI5rB,EAAOqqC,MACtBvqC,KAAKqyC,QAAU,GAGnBxxC,OAAS,WACL,IAAIyxC,EAAMjtC,KAAK8E,GAAK,IACpB,OAAO,SAAUxJ,GAEb,GADAA,EAAKX,KAAK0G,iBAAiB/F,GACvBX,KAAKE,OAAQ,CACb,IAAI8V,EAAQhW,KAAK+V,OACb07B,EAAUzxC,KAAKoyC,MACf5tC,EAAQ7D,EAAKX,KAAKqyC,QAClBE,EAASv8B,EAAM1W,EAAGkzC,EAASx8B,EAAMtS,EAAG+uC,EAASz8B,EAAMozB,EACnDmJ,GAAQhI,EAAKmI,QAAQjB,EAASA,EAASc,EAASD,EAAM9tC,GACtDguC,GAAQjI,EAAKoI,QAAQlB,EAASA,EAASe,EAASF,EAAM9tC,GACtDiuC,GAAQlI,EAAKqI,QAAQnB,EAASA,EAASgB,EAASH,EAAM9tC,GAC1DxE,KAAKE,OAAO4xC,YAAYL,GAExBzxC,KAAKqyC,QAAU1xC,IAdlB,GAmBTkB,QAAQ,WACJ,IAAImU,EAAQhW,KAAK+V,OACjBm7B,EAAU5xC,GAAK0W,EAAM1W,EACrB4xC,EAAUxtC,GAAKsS,EAAMtS,EACrBwtC,EAAU9H,GAAKpzB,EAAMozB,EACrB,IAAI9oC,EAAS,IAAIV,GAAGoyC,WAAWhyC,KAAKwB,UAAW0vC,GAG/C,OAFAlxC,KAAK+R,iBAAiBzR,GACtBN,KAAKgS,iBAAiB1R,GACfA,KAmBfV,GAAGizC,WAAa,SAAUjxC,EAAUqwC,EAAaC,EAAaC,GAC1D,OAAO,IAAIvyC,GAAGoyC,WAAWpwC,EAAUqwC,EAAaC,EAAaC,6BCpNjE,IAAI9Q,EAAOzhC,GAAG0hC,MAAMD,KAChByR,EAAOlzC,GAAG0hC,MAAMwR,KAEhBC,EAAU1R,EAAKyL,SACfkG,EAAW3R,EAAKyL,SAChBmG,EAAUH,EAAKhG,SAmBnB,SAASoG,EAAKC,EAAIC,EAAIC,EAAIC,EAAGC,EAAGhyB,GAC5BvhB,KAAKwzC,OAASnS,EAAKyL,OAAOqG,EAAIC,EAAIC,GAClCrzC,KAAKyzC,YAAcpS,EAAKyL,OAAOwG,EAAGC,EAAGhyB,GAGzC,IAAIoM,EAAQulB,EAAK5wC,UAQjBqrB,EAAM+lB,YAAc,SAAUxK,EAAQC,GAClC9H,EAAK58B,IAAIykC,EAAQlpC,KAAKwzC,OAAQxzC,KAAKyzC,aACnCpS,EAAKx8B,IAAIskC,EAAQnpC,KAAKwzC,OAAQxzC,KAAKyzC,cAYvC9lB,EAAMgmB,UAAY,SAAUr4B,EAAGlW,EAAKwuC,EAAKlJ,EAAOjW,GACvCA,IAAKA,EAAMz0B,MAChBqhC,EAAKwS,cAAcpf,EAAI+e,OAAQxzC,KAAKwzC,OAAQl4B,GA7CtB,SAAUmZ,EAAKqf,EAAQC,GAC7Cd,EAAQvD,IAAMrqC,KAAKuK,IAAImkC,EAAGrE,KAAMuD,EAAQtD,IAAMtqC,KAAKuK,IAAImkC,EAAGpE,KAAMsD,EAAQrD,IAAMvqC,KAAKuK,IAAImkC,EAAGnE,KAC1FqD,EAAQpD,IAAMxqC,KAAKuK,IAAImkC,EAAGjE,KAAMmD,EAAQnD,IAAMzqC,KAAKuK,IAAImkC,EAAGhE,KAAMkD,EAAQlD,IAAM1qC,KAAKuK,IAAImkC,EAAG/D,KAC1FiD,EAAQjD,IAAM3qC,KAAKuK,IAAImkC,EAAG7D,KAAM+C,EAAQhD,IAAM5qC,KAAKuK,IAAImkC,EAAG5D,KAAM8C,EAAQ/C,IAAM7qC,KAAKuK,IAAImkC,EAAG3D,KAC1F/O,EAAK2S,cAAcvf,EAAKqf,EAAQb,GA0ChCgB,CAAoBxf,EAAIgf,YAAazzC,KAAKyzC,YAAan4B,IAe3D43B,EAAKpG,OAAS,SAAUqG,EAAIC,EAAIC,EAAIC,EAAGC,EAAGhyB,GACtC,OAAO,IAAI2xB,EAAKC,EAAIC,EAAIC,EAAIC,EAAGC,EAAGhyB,IAStC2xB,EAAK7yC,MAAQ,SAAU0I,GACnB,OAAO,IAAImqC,EAAKnqC,EAAEyqC,OAAOl0C,EAAGyJ,EAAEyqC,OAAO9vC,EAAGqF,EAAEyqC,OAAOpK,EAC7CrgC,EAAE0qC,YAAYn0C,EAAGyJ,EAAE0qC,YAAY/vC,EAAGqF,EAAE0qC,YAAYrK,IAUxD8J,EAAKgB,KAAO,SAAUzf,EAAK1rB,GAIvB,OAHAs4B,EAAK6S,KAAKzf,EAAI+e,OAAQzqC,EAAEyqC,QACxBnS,EAAK6S,KAAKzf,EAAIgf,YAAa1qC,EAAE0qC,aAEtBhf,GAWXye,EAAKiB,WAAa,SAAU1f,EAAKyU,EAAQC,GAGrC,OAFA9H,EAAKqJ,MAAMjW,EAAI+e,OAAQnS,EAAKx8B,IAAIkuC,EAAS7J,EAAQC,GAAS,IAC1D9H,EAAKqJ,MAAMjW,EAAIgf,YAAapS,EAAK58B,IAAIuuC,EAAU7J,EAAQD,GAAS,IACzDzU,GAeXye,EAAKpnB,IAAM,SAAU2I,EAAK0e,EAAIC,EAAIC,EAAIC,EAAGC,EAAGhyB,GAGxC,OAFA8f,EAAKvV,IAAI2I,EAAI+e,OAAQL,EAAIC,EAAIC,GAC7BhS,EAAKvV,IAAI2I,EAAIgf,YAAaH,EAAGC,EAAGhyB,GACzBkT,GAGXt1B,EAAOE,QAAU6zC,2BCjIjBtzC,GAAGw0C,WACCC,SAAU30C,EAAQ,cAClB40C,KAAM50C,EAAQ,UACd60C,IAAK70C,EAAQ,SACb80C,UAAW90C,EAAQ,gGCJvB,IAAMwhC,EAAexhC,EAAQ,gCACvB+0C,EAAcvT,EAAauT,YAC3BvB,EAAOxzC,EAAQ,UACfg1C,EAAMh1C,EAAQ,SACdi1C,EAAWj1C,EAAQ,cAEnBmmC,EAAOjmC,GAAG0hC,MAAMuE,KAChBxE,EAAOzhC,GAAG0hC,MAAMD,KAQlBmT,KAYJA,EAAUI,QAAW,WACjB,IAAItvC,EAAM+7B,EAAKyL,SACXvnC,EAAM87B,EAAKyL,SACf,OAAO,SAAU4H,EAAKxB,GAClB,IAAI2B,EAAIH,EAAIG,EAAGzoC,EAAIsoC,EAAItoC,EACnB0oC,EAAK,EAAI1oC,EAAE9M,EAAGy1C,EAAK,EAAI3oC,EAAE1I,EAAGsxC,EAAK,EAAI5oC,EAAEg9B,EAC3C/H,EAAK58B,IAAIa,EAAK4tC,EAAKM,OAAQN,EAAKO,aAChCpS,EAAKx8B,IAAIU,EAAK2tC,EAAKM,OAAQN,EAAKO,aAChC,IAAI7jB,GAAMtqB,EAAIhG,EAAIu1C,EAAEv1C,GAAKw1C,EACrBztC,GAAM9B,EAAIjG,EAAIu1C,EAAEv1C,GAAKw1C,EACrBxtC,GAAMhC,EAAI5B,EAAImxC,EAAEnxC,GAAKqxC,EACrBE,GAAM1vC,EAAI7B,EAAImxC,EAAEnxC,GAAKqxC,EACrBG,GAAM5vC,EAAI8jC,EAAIyL,EAAEzL,GAAK4L,EACrBG,GAAM5vC,EAAI6jC,EAAIyL,EAAEzL,GAAK4L,EACrBI,EAAO/vC,KAAKE,IAAIF,KAAKE,IAAIF,KAAKC,IAAIsqB,EAAIvoB,GAAKhC,KAAKC,IAAIgC,EAAI2tC,IAAM5vC,KAAKC,IAAI4vC,EAAIC,IAC3EE,EAAOhwC,KAAKC,IAAID,KAAKC,IAAID,KAAKE,IAAIqqB,EAAIvoB,GAAKhC,KAAKE,IAAI+B,EAAI2tC,IAAM5vC,KAAKE,IAAI2vC,EAAIC,IAC/E,OAAIE,EAAO,GAAKD,EAAOC,EAAa,EAC7BD,GAjBM,GA8BrBZ,EAAUc,YAAe,WACrB,IAAIC,EAAKlU,EAAKyL,OAAO,EAAG,EAAG,GACvB0I,EAAKnU,EAAKyL,OAAO,EAAG,EAAG,GACvB2I,EAAOpU,EAAKyL,OAAO,EAAG,EAAG,GACzB4I,EAAOrU,EAAKyL,OAAO,EAAG,EAAG,GACzB6I,EAAOtU,EAAKyL,OAAO,EAAG,EAAG,GAE7B,OAAO,SAAU4H,EAAKC,GAClBtT,EAAK58B,IAAI8wC,EAAIZ,EAASzoC,EAAGyoC,EAAS5rC,GAClCs4B,EAAK58B,IAAI+wC,EAAIb,EAASxoC,EAAGwoC,EAAS5rC,GAElCs4B,EAAKuU,MAAMH,EAAMf,EAAItoC,EAAGopC,GACxB,IAAIK,EAAMxU,EAAKyU,IAAIP,EAAIE,GAEvB,GAAII,GAAO,EACP,OAAO,EAGXxU,EAAK58B,IAAIixC,EAAMhB,EAAIG,EAAGF,EAAS5rC,GAC/B,IAAIgtB,EAAIsL,EAAKyU,IAAIJ,EAAMD,GACvB,GAAI1f,EAAI,GAAKA,EAAI8f,EACb,OAAO,EAGXxU,EAAKuU,MAAMD,EAAMD,EAAMH,GACvB,IAAI/mB,EAAI6S,EAAKyU,IAAIpB,EAAItoC,EAAGupC,GACxB,GAAInnB,EAAI,GAAKuH,EAAIvH,EAAIqnB,EACjB,OAAO,EAGX,IAAIzuC,EAAIi6B,EAAKyU,IAAIN,EAAIG,GAAQE,EAC7B,OAAIzuC,EAAI,EAAU,EACXA,GAhCU,GAqCzBotC,EAAUuB,QAAW,WACjB,IAAM3U,EAAMF,EAAaE,IAErB4U,EAAMrB,EAAS7H,SACfmJ,EAAU9vB,EAAAA,EAER+vB,GACFlU,KAAM,UACNE,KAAM,WACNE,KAAM,WACNE,KAAM,YACNE,KAAM,WACNE,KAAM,YACNE,KAAM,cAIJuT,EAAgB,WAClB,IAAIra,EAAS,IAAIsa,YAAY,GAG7B,OAFA,IAAIC,SAASva,GAAQwa,SAAS,EAAG,KAAK,GAED,MAA9B,IAAIjU,WAAWvG,GAAQ,GAJZ,GAOtB,OAAO,SAAU4Y,EAAKpJ,GAClB2K,EAAU9vB,EAAAA,EAEV,IADA,IAAIowB,EAAYjL,EAAK1C,WACZrpC,EAAI,EAAGA,EAAIg3C,EAAU/2C,OAAQD,IAClC,GAAIg3C,EAAUh3C,GAAGi3C,iBAAmBpV,EAAIqV,aAWxC,IATA,IAAI1N,EAAMuC,EAAK3C,KAAKppC,IAAM+rC,EAAK3C,KAAK,GAChCpB,EAASwB,EAAGp4B,KACZ+lC,EAAK,IAAIL,SAAS9O,EAAOzL,OAAQyL,EAAO7B,WAAY6B,EAAOR,YAC3DiC,EAAKsC,EAAK5C,KAAKnpC,GAAGoR,KAGlBgmC,EADS5N,EAAGjN,OAAO8a,QACNv3B,QAAQ+hB,EAAI4B,eACzB5I,EAASuc,EAAIvc,OAAQiN,EAASsP,EAAItP,OAClCwP,EAAKX,EAAaS,EAAIjuB,MACjB3D,EAAI,EAAGA,EAAIikB,EAAGxpC,OAAQulB,GAAK,EAAG,CACnC,IAAI+xB,EAAM9N,EAAGjkB,GAAKsiB,EAASjN,EAC3BiH,EAAKvV,IAAIkqB,EAAIjtC,EAAG2tC,EAAGG,IAAKC,GAAMX,GAAeO,EAAGG,IAAKC,EAAM,GAAIX,GAAeO,EAAGG,IAAKC,EAAM,GAAIX,IAChGW,EAAM9N,EAAGjkB,EAAI,GAAKsiB,EAASjN,EAC3BiH,EAAKvV,IAAIkqB,EAAI9pC,EAAGwqC,EAAGG,IAAKC,GAAMX,GAAeO,EAAGG,IAAKC,EAAM,GAAIX,GAAeO,EAAGG,IAAKC,EAAM,GAAIX,IAChGW,EAAM9N,EAAGjkB,EAAI,GAAKsiB,EAASjN,EAC3BiH,EAAKvV,IAAIkqB,EAAI7pC,EAAGuqC,EAAGG,IAAKC,GAAMX,GAAeO,EAAGG,IAAKC,EAAM,GAAIX,GAAeO,EAAGG,IAAKC,EAAM,GAAIX,IAEhG,IAAIY,EAAOvC,EAAUc,YAAYZ,EAAKsB,GAClCe,EAAO,GAAKA,EAAOd,IACnBA,EAAUc,GAItB,OAAOd,GArDM,GAsErBzB,EAAUwC,QAAW,WAYjB,SAASC,EAAKluC,EAAGmD,GACb,OAAOnD,EAAE2tB,SAAWxqB,EAAEwqB,SAG1B,SAASwgB,EAAqBziB,EAAK1rB,EAAGuS,GAClC,IAAIhc,EAAIyJ,EAAEzJ,EAAGoE,EAAIqF,EAAErF,EAAG0lC,EAAIrgC,EAAEqgC,EACxB+N,EAAM77B,EAAEu0B,IAAMvwC,EAAIgc,EAAE20B,IAAMvsC,EAAI4X,EAAE+0B,IAAMjH,EAK1C,OAJA+N,EAAMA,EAAM,EAAIA,EAAM,EACtB1iB,EAAIn1B,GAAKgc,EAAEo0B,IAAMpwC,EAAIgc,EAAEw0B,IAAMpsC,EAAI4X,EAAE40B,IAAM9G,GAAK+N,EAC9C1iB,EAAI/wB,GAAK4X,EAAEq0B,IAAMrwC,EAAIgc,EAAEy0B,IAAMrsC,EAAI4X,EAAE60B,IAAM/G,GAAK+N,EAC9C1iB,EAAI2U,GAAK9tB,EAAEs0B,IAAMtwC,EAAIgc,EAAE00B,IAAMtsC,EAAI4X,EAAE80B,IAAMhH,GAAK+N,EACvC1iB,EAGX,IAAI2iB,EAAc,IAAI3C,EAAY,WAC9B,OACI/d,SAAU,EACV+N,KAAM,OAEX,GAECtP,KAGAkiB,EAAWnE,EAAKpG,SAChB5D,EAAS7H,EAAKyL,SACd3D,EAAS9H,EAAKyL,SAEdwK,EAAW5C,EAAI5H,SACfyK,EAAO1R,EAAKiH,SACZ0K,EAAO3R,EAAKiH,SACZ1gC,EAAIi1B,EAAKyL,SAEb,SAAS2K,EAAe/gB,GACpB,OAAOA,EAAW,GAAKA,EAAWvQ,EAAAA,EAGtC,OAAO,SAAUzD,EAAMg1B,EAAUC,EAASC,GA2CtC,OA1CAR,EAAYS,QACZ1iB,EAAQ31B,OAAS,EAlDrB,SAASs4C,EAAWrT,EAAMsT,GAGtB,IAFA,IAAIrT,EAAWD,EAAKC,SAEXnlC,EAAImlC,EAASllC,OAAS,EAAGD,GAAK,EAAGA,IAEtCu4C,EADYpT,EAASnlC,GACJw4C,GAGrBA,EAAGtT,GA6CHqT,CADAp1B,EAAOA,GAAQ9iB,GAAG+e,SAASq5B,WACX,SAAUvT,GACtB,IAAImT,GAAWA,EAAOnT,GAAtB,CAGAoB,EAAKoS,OAAOT,EAAM/S,EAAKoM,eAAe0G,IACtClW,EAAKwS,cAAcyD,EAASzC,EAAG6C,EAAS7C,EAAG2C,GAC3CnW,EAAK7L,UAAU8hB,EAASlrC,EAAG8qC,EAAoBI,EAASlrC,EAAGsrC,EAAStrC,EAAGorC,IAGvE,IAAI9gB,EAAWvQ,EAAAA,EACXkG,EAAYoY,EAAKyT,iBAWrB,GAVI7rB,GAAaA,EAAU8rB,aACvBzhB,EAAW8d,EAAUI,QAAQ0C,EAAUjrB,EAAU8rB,cAE5C1T,EAAK9gC,OAAS8gC,EAAK7gC,SACxBy9B,EAAKvV,IAAIod,GAASzE,EAAK9gC,MAAQ8gC,EAAK2T,SAAU3T,EAAK7gC,OAAS6gC,EAAK4T,QAAS5T,EAAK2E,GAC/E/H,EAAKvV,IAAIqd,EAAQ1E,EAAK9gC,OAAS,EAAI8gC,EAAK2T,SAAU3T,EAAK7gC,QAAU,EAAI6gC,EAAK4T,SAAU5T,EAAK2E,GACzF8J,EAAKiB,WAAWkD,EAAUnO,EAAQC,GAClCzS,EAAW8d,EAAUI,QAAQ0C,EAAUD,IAGtCI,EAAc/gB,KAEfihB,IACAjhB,EAAWihB,EAAQL,EAAU7S,EAAM/N,IAGnC+gB,EAAc/gB,IAAW,CACzB2K,EAAKvV,IAAI1f,EAAGsqB,EAAU,EAAG,GACzBwgB,EAAoB9qC,EAAGA,EAAGmrC,GAC1B,IAAIe,EAAMlB,EAAYvyC,MACtByzC,EAAI7T,KAAOA,EACX6T,EAAI5hB,SAAW92B,GAAG0hC,MAAMD,KAAK7hC,OAAO4M,GACpC+oB,EAAQzvB,KAAK4yC,OAIrBnjB,EAAQojB,KAAKtB,GACN9hB,GA5FM,GAgGrBh2B,EAAOE,QAAUm1C,oGCrQjB,IAAMnT,EAAOzhC,GAAG0hC,MAAMD,KAWtB,SAASqT,EAAI8D,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GAC7B74C,KAAK60C,EAAIxT,EAAKyE,IAAI0S,EAAIC,EAAIC,GAC1B14C,KAAKoM,EAAIi1B,EAAKyE,IAAI6S,EAAIC,EAAIC,GAc9BnE,EAAI5H,OAAS,SAAU0L,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACvC,OAAO,IAAInE,EAAI8D,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,IASvCnE,EAAIr0C,MAAQ,SAAU0I,GAClB,OAAO,IAAI2rC,EACP3rC,EAAE8rC,EAAEv1C,EAAGyJ,EAAE8rC,EAAEnxC,EAAGqF,EAAE8rC,EAAEzL,EAClBrgC,EAAEqD,EAAE9M,EAAGyJ,EAAEqD,EAAE1I,EAAGqF,EAAEqD,EAAEg9B,IAW1BsL,EAAIR,KAAO,SAAUzf,EAAK1rB,GAQtB,OAPA0rB,EAAIogB,EAAEv1C,EAAIyJ,EAAE8rC,EAAEv1C,EACdm1B,EAAIogB,EAAEnxC,EAAIqF,EAAE8rC,EAAEnxC,EACd+wB,EAAIogB,EAAEzL,EAAIrgC,EAAE8rC,EAAEzL,EACd3U,EAAIroB,EAAE9M,EAAIyJ,EAAEqD,EAAE9M,EACdm1B,EAAIroB,EAAE1I,EAAIqF,EAAEqD,EAAE1I,EACd+wB,EAAIroB,EAAEg9B,EAAIrgC,EAAEqD,EAAEg9B,EAEP3U,GAeXigB,EAAI5oB,IAAM,SAAU2I,EAAK+jB,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GAQzC,OAPApkB,EAAIogB,EAAEv1C,EAAIk5C,EACV/jB,EAAIogB,EAAEnxC,EAAI+0C,EACVhkB,EAAIogB,EAAEzL,EAAIsP,EACVjkB,EAAIroB,EAAE9M,EAAIq5C,EACVlkB,EAAIroB,EAAE1I,EAAIk1C,EACVnkB,EAAIroB,EAAEg9B,EAAIyP,EAEHpkB,GAWXigB,EAAIP,WAAa,SAAU1f,EAAKqkB,EAAQC,GAIpC,OAHA1X,EAAK6S,KAAKzf,EAAIogB,EAAGiE,GACjBzX,EAAK7L,UAAUf,EAAIroB,EAAGi1B,EAAK58B,IAAIgwB,EAAIroB,EAAG2sC,EAAQD,IAEvCrkB,GAGXt1B,EAAOE,QAAUq1C,2BCpGjB,IAAMrT,EAAOzhC,GAAG0hC,MAAMD,KActB,SAASsT,EAASqE,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GAC9Cx5C,KAAK+I,EAAIs4B,EAAKyL,OAAOkM,EAAIC,EAAIC,GAC7Bl5C,KAAKkM,EAAIm1B,EAAKyL,OAAOqM,EAAIC,EAAIC,GAC7Br5C,KAAKmM,EAAIk1B,EAAKyL,OAAOwM,EAAIC,EAAIC,GAiBjC7E,EAAS7H,OAAS,SAAUkM,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACxD,OAAO,IAAI7E,EAASqE,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,IASxD7E,EAASt0C,MAAQ,SAAU+G,GACvB,OAAO,IAAIutC,EACPvtC,EAAE2B,EAAEzJ,EAAG8H,EAAE2B,EAAErF,EAAG0D,EAAE2B,EAAEqgC,EAClBhiC,EAAE8E,EAAE5M,EAAG8H,EAAE8E,EAAExI,EAAG0D,EAAE8E,EAAEk9B,EAClBhiC,EAAE+E,EAAE7M,EAAG8H,EAAE+E,EAAEzI,EAAG0D,EAAE+E,EAAEi9B,IAW1BuL,EAAST,KAAO,SAAUzf,EAAKrtB,GAK3B,OAJAi6B,EAAK6S,KAAKzf,EAAI1rB,EAAG3B,EAAE2B,GACnBs4B,EAAK6S,KAAKzf,EAAIvoB,EAAG9E,EAAE8E,GACnBm1B,EAAK6S,KAAKzf,EAAItoB,EAAG/E,EAAE+E,GAEZsoB,GAYXkgB,EAASR,WAAa,SAAU1f,EAAK1rB,EAAGmD,EAAGC,GAIvC,OAHAk1B,EAAK6S,KAAKzf,EAAI1rB,EAAGA,GACjBs4B,EAAK6S,KAAKzf,EAAIvoB,EAAGA,GACjBm1B,EAAK6S,KAAKzf,EAAItoB,EAAGA,GACVsoB,GAmBXkgB,EAAS7oB,IAAM,SAAU2I,EAAKukB,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GAa1D,OAZA/kB,EAAI1rB,EAAEzJ,EAAI05C,EACVvkB,EAAI1rB,EAAErF,EAAIu1C,EACVxkB,EAAI1rB,EAAEqgC,EAAI8P,EAEVzkB,EAAIvoB,EAAE5M,EAAI65C,EACV1kB,EAAIvoB,EAAExI,EAAI01C,EACV3kB,EAAIvoB,EAAEk9B,EAAIiQ,EAEV5kB,EAAItoB,EAAE7M,EAAIg6C,EACV7kB,EAAItoB,EAAEzI,EAAI61C,EACV9kB,EAAItoB,EAAEi9B,EAAIoQ,EAEH/kB,GAGXt1B,EAAOE,QAAUs1C,2BCjHbj1C,EAAQ,iBACRA,EAAQ,gBAGZA,EAAQ,aACRA,EAAQ,gBACRA,EAAQ,6BACRA,EAAQ,yBACRA,EAAQ,aAGJA,EAAQ,yBACRA,EAAQ,0PCYZ,IAAM6jB,EAAO7jB,EAAQ,aACf+5C,EAAYl2B,EAAKk2B,UACjBC,EAAYn2B,EAAKo2B,gBACjBC,EAAOl6C,EAAQ,6BAA6Bk6C,KAC5CC,EAAan6C,EAAQ,2BAGrBo6C,EAAaz0C,KAAK8E,GAAK,IAEvB4vC,EAAc,EACdC,EAAW,EAGjB,SAASC,IACL,GAAIj6C,KAAKk6C,eAAgB,CAErB,IAAI9yC,EAAIpH,KAAKm6C,QAIb,GAHAP,EAAK/T,KAAKuU,QAAQhzC,EAAGpH,KAAKoyC,MAAOpyC,KAAKq6C,UAAWr6C,KAAKs6C,QAGlDt6C,KAAKyX,QAAUzX,KAAK0X,OAAQ,CAC5B,IAAI3O,EAAI3B,EAAEsoC,IAAKxjC,EAAI9E,EAAEuoC,IAAKxjC,EAAI/E,EAAE0oC,IAAK1jC,EAAIhF,EAAE2oC,IACvCwK,EAAMl1C,KAAKm1C,IAAIx6C,KAAKyX,OAASqiC,GAC7BW,EAAMp1C,KAAKm1C,IAAIx6C,KAAK0X,OAASoiC,GAC7BS,IAAQp0B,EAAAA,IACRo0B,EAAM,UACNE,IAAQt0B,EAAAA,IACRs0B,EAAM,UACVrzC,EAAEsoC,IAAM3mC,EAAIoD,EAAIsuC,EAChBrzC,EAAEuoC,IAAMzjC,EAAIE,EAAIquC,EAChBrzC,EAAE0oC,IAAM3jC,EAAIpD,EAAIwxC,EAChBnzC,EAAE2oC,IAAM3jC,EAAIF,EAAIquC,EAEpBv6C,KAAKk6C,eAAiB,EAEtBl6C,KAAK06C,gBAAiB,GAI9B,SAASC,IAML,GAJI36C,KAAKk6C,gBACLl6C,KAAK46C,qBAGL56C,KAAK66C,QAAS,CACd,IAAIC,EAAY96C,KAAK66C,QAAQE,aAC7BnB,EAAK/T,KAAK3hC,IAAIlE,KAAK+6C,aAAcD,EAAW96C,KAAKm6C,cAGjDP,EAAK/T,KAAKqO,KAAKl0C,KAAK+6C,aAAc/6C,KAAKm6C,SAE3Cn6C,KAAK06C,gBAAiB,EAI1B,SAAS51C,EAAak2C,EAAWt3C,EAAG0lC,GAChC,IAAI9pC,OAAA,OACM+G,IAAN3C,GACApE,EAAI07C,EAAU17C,EACdoE,EAAIs3C,EAAUt3C,EACd0lC,EAAI4R,EAAU5R,GAAK,IAGnB9pC,EAAI07C,EACJ5R,EAAIA,GAAK,GAGb,IAAIhkC,EAAMpF,KAAKq6C,UACXj1C,EAAI9F,IAAMA,GAAK8F,EAAI1B,IAAMA,GAAK0B,EAAIgkC,IAAMA,IAQ5ChkC,EAAI9F,EAAIA,EACR8F,EAAI1B,EAAIA,EACR0B,EAAIgkC,EAAIA,EACRppC,KAAKi7C,cAAcvB,EAAU3W,UAC7B/iC,KAAKk7C,aAAerB,EAAWsB,qBAG3Bn7C,KAAKo7C,WAAarB,GAKd/5C,KAAK0tB,KAAK+rB,EAAU4B,mBA0DhC,IAAI1tB,EAAQ/tB,GAAG2jB,KAAKjhB,UACdg5C,EAAuB3tB,EAAMitB,mBAC7BW,EAAuB5tB,EAAM6tB,mBAC7BC,EAAuB9tB,EAAM+tB,kBAC7BC,EAAYhuB,EAAMiuB,QAExBjuB,EAAM7oB,YAAcA,EACpB6oB,EAAMkuB,SA5DN,SAAmBv8C,EAAGoE,EAAG0lC,GACjB9pC,GAAkB,iBAANA,GACZoE,EAAIpE,EAAEoE,EACN0lC,EAAI9pC,EAAE8pC,GAAK,EACX9pC,EAAIA,EAAEA,QAEK+G,IAAN/G,QAAyB+G,IAAN3C,GACxBA,EAAIpE,EACJ8pC,EAAI9pC,QAEO+G,IAAN+iC,IACLA,EAAI,GAEJppC,KAAKs6C,OAAOh7C,IAAMA,GAAKU,KAAKs6C,OAAO52C,IAAMA,GAAK1D,KAAKs6C,OAAOlR,IAAMA,IAChEppC,KAAKs6C,OAAOh7C,EAAIA,EAChBU,KAAKs6C,OAAO52C,EAAIA,EAChB1D,KAAKs6C,OAAOlR,EAAIA,EAChBppC,KAAKi7C,cAAcvB,EAAUoC,OAC7B97C,KAAKk7C,aAAerB,EAAWkC,eAE3B/7C,KAAKo7C,WAAapB,GAClBh6C,KAAK0tB,KAAK+rB,EAAUuC,iBAyChCruB,EAAM+tB,kBAlBN,WACQ17C,KAAKi8C,WACLj8C,KAAKk8C,oBAGTT,EAAqBl5C,KAAKvC,OAc9B2tB,EAAMuuB,kBArCN,WACQl8C,KAAKi8C,WACLj8C,KAAK46C,mBAAqBX,EAC1Bj6C,KAAKw7C,mBAAqBb,EAC1B36C,KAAK47C,QAAUh8C,GAAG0hC,MAAMuE,KAAK3hC,MAG7BlE,KAAK46C,mBAAqBU,EAC1Bt7C,KAAKw7C,mBAAqBD,EAC1Bv7C,KAAK47C,QAAUD,GAEf37C,KAAKk4C,kBAAoBl4C,KAAKk4C,iBAAiBiE,kBAC/Cn8C,KAAKk4C,iBAAiBiE,mBAE1Bn8C,KAAKk7C,aAAerB,EAAWkC,eAC/B/7C,KAAKk6C,eAAiBR,EAAU0C,KAwBpCx8C,GAAGye,GAAGgR,OAAO1B,EAAO,WAAYA,EAAM0uB,YAAav3C,GAAa,GAAO,GAEvElF,GAAGye,GAAGgR,OAAO1B,EAAO,WAAY,WAC5B,OAAO3tB,KAAKi8C,WACb,SAAUztB,GACLxuB,KAAKi8C,YAAcztB,IACvBxuB,KAAKi8C,UAAYztB,EACjBxuB,KAAKk8C,uBAGTt8C,GAAGye,GAAGgR,OAAO1B,EAAO,SAAU,WAC1B,OAAO3tB,KAAKs6C,OAAOlR,GACpB,SAAU5a,GACLxuB,KAAKs6C,OAAOlR,IAAM5a,IAClBxuB,KAAKs6C,OAAOlR,EAAI5a,EAChBxuB,KAAKi7C,cAAcvB,EAAUoC,OAC7B97C,KAAKk7C,aAAerB,EAAWkC,eAE3B/7C,KAAKo7C,WAAapB,GAClBh6C,KAAK0tB,KAAK+rB,EAAUuC,kBAKhCp8C,GAAGye,GAAGgR,OAAO1B,EAAO,IAAK,WACrB,OAAO3tB,KAAKq6C,UAAUjR,GACvB,SAAUrlC,GACT,IAAIu4C,EAAgBt8C,KAAKq6C,UACrBt2C,IAAUu4C,EAAclT,IAEpBkT,EAAclT,EAAIrlC,EAClB/D,KAAKi7C,cAAcvB,EAAU3W,UAC7B/iC,KAAKk7C,aAAerB,EAAWsB,qBAE3Bn7C,KAAKo7C,WAAarB,GAClB/5C,KAAK0tB,KAAK+rB,EAAU4B,qBASpCz7C,GAAGye,GAAGgR,OAAO1B,EAAO,cAAe,WAK3B,OAAO3tB,KAAKoyC,MAAMmK,QAAQ38C,GAAGyW,OAElC,SAAUmY,GAKTxuB,KAAKoyC,MAAMR,UAAUpjB,GACrBxuB,KAAKi7C,cAAcvB,EAAU8C,UAC7Bx8C,KAAKk7C,aAAerB,EAAWkC,iBAKnCn8C,GAAGye,GAAGgR,OAAO1B,EAAO,OAAQ,WACxB,OAAO3tB,KAAKoyC,OACbzkB,EAAMmkB,kHCjOUpyC,EAAQ,oBAA3B,IACM+8C,EAAgB,wEAGlBC,OAAA,EAMJ98C,GAAG+8C,IAAM/8C,GAAGivC,KAAOjvC,GAAG+6B,MAAQ/6B,GAAGg9C,OAASjW,QAAQgW,IA2LlD,SAASE,EAAmBn0B,GACxB,OAAO,WACH,IAAI2P,EAAKnmB,UAAU,GACf4qC,EAAuDp0B,EAAjD,IAAyD2P,EAAzD,kBAA6EokB,EAA7E,IAA8FpkB,EAA9F,mBACV,GAAyB,IAArBnmB,UAAU1S,OACV,OAAOs9C,EAEN,GAAyB,IAArB5qC,UAAU1S,OACf,OACIs9C,EAAM,eAAiB5qC,UAAU,GAGrC,IAAI6qC,EAAYn9C,GAAGye,GAAG2+B,eAAe1wB,MAAM,KAAMpa,WACjD,OACI4qC,EAAM,eAAiBC,EAAUE,KAAK,OAxBtDr9C,GAAGs9C,OAAoC,SAAUviB,GAC7C,IAAIwiB,EAAQxiB,EAAMwiB,MACdA,EACAv9C,GAAG+6B,MAAwCwiB,GAG3Cv9C,GAAG+6B,MAAMA,IAuBjB,IAAIyiB,EAAeP,EAAkB,OACrCj9C,GAAGgB,MAAQ,WACPhB,GAAG+8C,IAAIS,EAAa9wB,MAAM,KAAMpa,aAGpC,IAAImrC,EAAgBR,EAAkB,WACtCj9C,GAAGu+B,OAAS,WACRv+B,GAAGivC,KAAKwO,EAAc/wB,MAAM,KAAMpa,aAGtC,IAAIorC,EAAiBT,EAAkB,SACvCj9C,GAAGyC,QAAU,WACTzC,GAAG+6B,MAAM2iB,EAAehxB,MAAM,KAAMpa,aAGxC,IAAIqrC,EAAkBV,EAAkB,UACxCj9C,GAAGygB,SAAW,SAAUm9B,GACpB,aACIA,GAGJ59C,GAAGg9C,QAAO,EAAOW,EAAgBjxB,MAAM,KAAM1sB,GAAGye,GAAG2+B,eAAe1wB,MAAM,KAAMpa,cASlF,IAAIurC,EAAY79C,GAAG43B,MAQfkmB,KAAM,EAQNC,KAAM,EAQNC,KAAM,EAQN9kB,MAAO,EAQP+kB,kBAAmB,EAQnBC,kBAAmB,EAQnBC,mBAAoB,IASxB5+C,EAAOE,QAAUO,GAAGu3B,OAChBsmB,UAAWA,EAEXO,mBA9SoB,SAAUC,GAE9Br+C,GAAG+8C,IAAM/8C,GAAGivC,KAAOjvC,GAAG+6B,MAAQ/6B,GAAGg9C,OAAS,aAEtCqB,IAASR,EAAUC,OAGnBO,EAAOR,EAAU3kB,MAAO,WAGxB,SAASolB,EAAcpB,GACnB,GAAKl9C,GAAG06B,KAAKC,OAAb,CAGA,IAAKmiB,EAAS,CACV,IAAIyB,EAASxkB,SAASC,cAAc,OACpCukB,EAAOC,aAAa,KAAM,cAC1BD,EAAOC,aAAa,QAAS,OAC7BD,EAAOC,aAAa,SAAUx+C,GAAG06B,KAAKC,OAAO32B,QAC7C,IAAIy6C,EAAcF,EAAOG,MACzBD,EAAYE,OAAS,QACrBF,EAAY1nC,SAAW,WACvB0nC,EAAYG,IAAMH,EAAYI,KAAO,KAErC/B,EAAU/iB,SAASC,cAAc,aACzBwkB,aAAa,OAAQ,MAC7B1B,EAAQ0B,aAAa,OAAQ,MAC7B1B,EAAQ0B,aAAa,WAAY,QACjC,IAAIM,EAAehC,EAAQ4B,MAC3BI,EAAaC,gBAAkB,cAC/BD,EAAaE,aAAe,oBAC5BF,EAAaG,eAAiBH,EAAaI,gBAAkBJ,EAAaK,iBAAmB,MAC7FL,EAAaM,eAAiBN,EAAaO,gBAAkBP,EAAaQ,iBAAmB,OAC7FR,EAAaS,QAAU,MACvBT,EAAaU,OAAS,EAEtBjB,EAAOkB,YAAY3C,GACnB98C,GAAG06B,KAAKC,OAAO+kB,WAAWD,YAAYlB,GAG1CzB,EAAQ34C,MAAQ24C,EAAQ34C,MAAQ+4C,EAAM,OACtCJ,EAAQ6C,UAAY7C,EAAQ8C,cAGhC5/C,GAAG+6B,MAAQ,WACPujB,EAAa,YAAct+C,GAAGye,GAAGohC,UAAUnzB,MAAM,KAAMpa,aAE3DtS,GAAGg9C,OAAS,SAAUY,EAAMV,GACxB,cACKU,GAAQV,GAEToB,EAAa,YADbpB,EAAMl9C,GAAGye,GAAGohC,UAAUnzB,MAAM,KAAM1sB,GAAGye,GAAG2+B,eAAe1wB,MAAM,KAAMpa,eAIvE+rC,IAASR,EAAUM,qBACnBn+C,GAAGivC,KAAO,WACNqP,EAAa,WAAat+C,GAAGye,GAAGohC,UAAUnzB,MAAM,KAAMpa,cAG1D+rC,IAASR,EAAUI,oBACnBj+C,GAAG+8C,IAAM,WACLuB,EAAat+C,GAAGye,GAAGohC,UAAUnzB,MAAM,KAAMpa,cAtDzB,GA0DnBy0B,SAAWA,QAAQgW,IAAIrwB,QAIvBqa,QAAQhM,QAAOgM,QAAQhM,MAAQgM,QAAQgW,KACvChW,QAAQkI,OAAMlI,QAAQkI,KAAOlI,QAAQgW,KAmBjChW,QAAQhM,MAAM9B,KAEnBj5B,GAAG+6B,MAAQgM,QAAQhM,MAAM9B,KAAK8N,SAG9B/mC,GAAG+6B,MAAiC,WAChC,OAAOgM,QAAQhM,MAAMrO,MAAMqa,QAASz0B,YAG5CtS,GAAGg9C,OAAS,SAAUY,EAAMV,GACxB,IAAKU,EAWG,MAVAV,IACAA,EAAMl9C,GAAGye,GAAGohC,UAAUnzB,MAAM,KAAM1sB,GAAGye,GAAG2+B,eAAe1wB,MAAM,KAAMpa,aAS7D,IAAIwtC,MAAM5C,KAK5BmB,IAASR,EAAU3kB,QAiBV6N,QAAQkI,KAAKhW,KAElBj5B,GAAGivC,KAAOlI,QAAQkI,KAAKhW,KAAK8N,SAG5B/mC,GAAGivC,KAA+B,WAC9B,OAAOlI,QAAQkI,KAAKviB,MAAMqa,QAASz0B,aAOtC+rC,IAASR,EAAUE,OAkBfhX,QAAQgW,IAAI9jB,KAEjBj5B,GAAG+8C,IAAMhW,QAAQgW,IAAI9jB,KAAK8N,SAG1B/mC,GAAG+8C,IAAM,WACL,OAAOhW,QAAQgW,IAAIrwB,MAAMqa,QAASz0B,eA+I9CqlB,SAAUslB,EAAkB,SAQ5B8C,eAAgB,WACZ,QAAO//C,GAAGggD,UAAWhgD,GAAGggD,SAASC,kBASrCC,gBAAiB,SAAUC,GACnBngD,GAAGggD,WACHG,EAAengD,GAAGggD,SAASI,YAAcpgD,GAAGggD,SAASK,YACrDrgD,GAAG06B,KAAK4lB,OAAOC,UAAYJ,uDCvVvC,IAAMnoB,EAAcl4B,EAAQ,wBACtB0gD,EAAmB1gD,EAAQ,sCAC3B2gD,EAAqB3gD,EAAQ,yBAC7B4gD,EAAgB5gD,EAAQ,oBACxB6gD,EAAM7gD,EAAQ,uBACd46B,EAAO56B,EAAQ,YACfyhC,EAAWzhC,EAAQ,cACnB8gD,EAAe9gD,EAAQ,mBACvB+gD,EAAY/gD,EAAQ,iBAwE1BE,GAAG8gD,SAAW,WACV9oB,EAAYr1B,KAAKvC,MAEjBA,KAAK2gD,SAAU,EAEf3gD,KAAK4gD,SAAU,EAEf5gD,KAAK6gD,0BAA2B,EAEhC7gD,KAAK8gD,iBAAmB,KAGxB9gD,KAAK+gD,cAAgB,GACrB/gD,KAAKghD,OAAS,KAGdhhD,KAAKihD,aAAe,EACpBjhD,KAAKkhD,YAAc,EACnBlhD,KAAKmhD,WAAa,EAGlBnhD,KAAK4e,WAAa,KAElB5e,KAAKohD,eAAiB,KAEtBphD,KAAKqhD,eAAiB,KAEtBrhD,KAAKshD,eAAiB,KAEtB,IAAI/yB,EAAOvuB,KACXs6B,EAAKpM,GAAGoM,EAAKinB,WAAY,WACrBhzB,EAAK2yB,YAAcM,YAAYC,QAGnCnnB,EAAKlM,KAAKkM,EAAKonB,oBAAqB1hD,KAAKoP,KAAMpP,OAGnDJ,GAAG8gD,SAASp+C,WACRwc,YAAalf,GAAG8gD,SAChBtxC,KAAM,WAgBF,OAfApP,KAAKihD,aAAe,EACpBjhD,KAAKkhD,YAAcM,YAAYC,MAC/BzhD,KAAK4gD,SAAU,EACf5gD,KAAK6gD,0BAA2B,EAChC7gD,KAAK8gD,iBAAmBlhD,GAAGqvC,KAAK,EAAG,GACnCjvC,KAAK4e,WAAa,IAAI6hC,EAElB7gD,GAAG0e,eACHte,KAAKshD,eAAiB,IAAI1hD,GAAG0e,cAC7Bte,KAAK4e,WAAW+iC,eAAe3hD,KAAKshD,eAAgBb,EAAUmB,iBAAiB,IAE/E5hD,KAAKshD,eAAiB,KAG1BthD,KAAK6hD,cACE,GAOXA,WAAY,WACR7hD,KAAKohD,eAAiB,IAAIf,EAC1BrgD,KAAKqhD,eAAiB,IAAIf,EAGtBE,GACAA,EAAasB,YAAW,GAIxBliD,GAAG4sB,kBACHxsB,KAAK+hD,kBAAoB,IAAIniD,GAAG4sB,iBAChCxsB,KAAK4e,WAAW+iC,eAAe3hD,KAAK+hD,kBAAmBtB,EAAUmB,iBAAiB,IAGlF5hD,KAAK+hD,kBAAoB,KAIzBniD,GAAGoiD,kBACHhiD,KAAKiiD,kBAAoB,IAAIriD,GAAGoiD,iBAChChiD,KAAK4e,WAAW+iC,eAAe3hD,KAAKiiD,kBAAmBxB,EAAUmB,iBAAiB,IAGlF5hD,KAAKiiD,kBAAoB,KAIzBriD,GAAGsiD,gBACHliD,KAAKmiD,gBAAkB,IAAIviD,GAAGsiD,eAC9BliD,KAAK4e,WAAW+iC,eAAe3hD,KAAKmiD,gBAAiB1B,EAAUmB,iBAAiB,IAGhF5hD,KAAKmiD,gBAAkB,KAIvBviD,GAAGwiD,gBACHxiD,GAAGwiD,eAAehzC,KAAKpP,MAG3BJ,GAAG47B,OAAOpsB,KAAKpP,OAMnBqiD,mBAAoB,WAChB,IAAIZ,EAAMD,YAAYC,MAEtBzhD,KAAKmhD,YAAcM,EAAMzhD,KAAKkhD,aAAe,IAI7ClhD,KAAKkhD,YAAcO,GAcvBa,YAAa,SAAUC,GACnB,IAAIC,EAAYloB,EAAKkoB,UACjBC,EAAO7iD,GAAG6iD,KACVC,EAAMF,EAAUG,wBAChBlE,EAAOiE,EAAIjE,KAAOmE,OAAOC,YAAcL,EAAUM,WACjDtE,EAAMkE,EAAIlE,IAAMoE,OAAOG,YAAcP,EAAUQ,UAC/C1jD,EAAImjD,EAAKQ,mBAAqBV,EAAQjjD,EAAIm/C,GAC1C/6C,EAAI++C,EAAKQ,mBAAqBzE,EAAMkE,EAAI9+C,OAAS2+C,EAAQ7+C,GAC7D,OAAO++C,EAAKS,WAAatjD,GAAGqE,GAAGw+C,EAAKU,cAAcx/C,MAAQD,EAAGpE,GAAKM,GAAGqE,GAAG3E,EAAGoE,IAc/E0/C,YAAa,SAAUC,GACnB,IAAIb,EAAYloB,EAAKkoB,UACjBC,EAAO7iD,GAAG6iD,KACVC,EAAMF,EAAUG,wBAChBlE,EAAOiE,EAAIjE,KAAOmE,OAAOC,YAAcL,EAAUM,WACjDtE,EAAMkE,EAAIlE,IAAMoE,OAAOG,YAAcP,EAAUQ,UAC/CT,EAAU3iD,GAAGqE,GAAG,EAAG,GASvB,OARIw+C,EAAKS,YACLX,EAAQjjD,EAAIm/C,EAAO4E,EAAQ3/C,EAAI++C,EAAKQ,kBACpCV,EAAQ7+C,EAAI86C,EAAMkE,EAAI9+C,QAAU6+C,EAAKU,cAAcx/C,MAAQ0/C,EAAQ/jD,GAAKmjD,EAAKQ,oBAG7EV,EAAQjjD,EAAIm/C,EAAO4E,EAAQ/jD,EAAImjD,EAAKQ,kBACpCV,EAAQ7+C,EAAI86C,EAAMkE,EAAI9+C,OAASy/C,EAAQ3/C,EAAI++C,EAAKQ,mBAE7CV,GAOX54B,IAAK,WACD3pB,KAAK6gD,0BAA2B,GAYpCyC,WAAY,WACR,OAAO1jD,GAAGqvC,KAAKrvC,GAAGoE,UAgBtBu/C,mBAAoB,WAChB,OAAO3jD,GAAGqvC,KAAKrvC,GAAGoE,UAYtB4jB,MAAO,WACC5nB,KAAK4gD,UAET5gD,KAAK4gD,SAAU,IAOnB4C,gBAAiB,WACb5jD,GAAG47B,OAAOioB,cAMdC,cAAe,WAEX1jD,KAAK4e,WAAW+kC,gBAChB3jD,KAAKohD,eAAeuC,gBAEpB3jD,KAAKqhD,eAAexJ,QAGhB2I,GACAA,EAAasB,YAAW,GAE5BliD,GAAGuhC,SAASyiB,QAGJhkD,GAAGmsB,QAAQ/rB,KAAKghD,SAChBhhD,KAAKghD,OAAOvmB,UAEhBz6B,KAAKghD,OAAS,KAGlBhhD,KAAK6jD,gBAGLjkD,GAAG47B,OAAOioB,cAMd5L,MAAO,WACH73C,KAAK0jD,gBAEDlD,GACAA,EAAasB,YAAW,GAGxB9hD,KAAKshD,gBACLthD,KAAK4e,WAAW+iC,eAAe3hD,KAAKshD,eAAgB1hD,GAAG6gD,UAAUmB,iBAAiB,GAIlF5hD,KAAK+hD,mBACL/hD,KAAK4e,WAAW+iC,eAAe3hD,KAAK+hD,kBAAmBniD,GAAG6gD,UAAUmB,iBAAiB,GAIrF5hD,KAAKiiD,mBACLjiD,KAAK4e,WAAW+iC,eAAe3hD,KAAKiiD,kBAAmBriD,GAAG6gD,UAAUmB,iBAAiB,GAIrF5hD,KAAKmiD,iBACLniD,KAAK4e,WAAW+iC,eAAe3hD,KAAKmiD,gBAAiBviD,GAAG6gD,UAAUmB,iBAAiB,GAGvF5hD,KAAK8jD,kBAaTC,kBAAmB,SAAUC,EAAOC,EAAmBC,GACnDtkD,GAAGygB,SAAS2jC,aAAiBpkD,GAAGukD,MAAO,MAGvCH,EAAMI,QAQN,IAHA,IAAIC,EAAkBC,OAAOC,KAAKjqB,EAAKkqB,mBAAmB9vB,IAAI,SAAUp1B,GACpE,OAAOg7B,EAAKkqB,kBAAkBllD,KAEzBC,EAAI,EAAGA,EAAI8kD,EAAgB7kD,OAAQD,IAAK,CAC7C,IAAIklC,EAAO4f,EAAgB9kD,GACvBklD,EAAYT,EAAMU,eAAejgB,EAAKkgB,MAC1C,GAAIF,EAAW,CAEX,IAAIpjC,EAAQojC,EAAUG,kBACtBH,EAAUI,oBACVb,EAAMc,YAAYrgB,EAAMpjB,QAGxBojB,EAAK9/B,OAASq/C,EAKtB,IAAIe,EAAW/kD,KAAKghD,OAIZgE,EAAoBD,GAAYA,EAASC,mBAAqBD,EAASE,aAC3E7E,EAAiB8E,YAAYF,EAAmBhB,EAAMiB,aAAcZ,GAMpEzkD,GAAGmsB,QAAQg5B,IACXA,EAAStqB,UAGbz6B,KAAKghD,OAAS,KAGdT,EAAI4E,mBAGAlB,GACAA,IAEJjkD,KAAK0tB,KAAK9tB,GAAG8gD,SAAS0E,0BAA2BpB,GAGjDhkD,KAAKghD,OAASgD,EAGdA,EAAMqB,YAINrlD,KAAK8jD,iBAEDI,GACAA,EAAW,KAAMF,GAErBhkD,KAAK0tB,KAAK9tB,GAAG8gD,SAAS4E,yBAA0BtB,IAcpDuB,SAAU,SAAUvB,EAAOC,EAAmBC,GAC1CtkD,GAAGygB,SAAS2jC,EAAO,MACnBpkD,GAAGygB,SAAS2jC,aAAiBpkD,GAAGukD,MAAO,MAGvCH,EAAMI,QAGNpkD,KAAKouB,KAAKxuB,GAAG8gD,SAAS8E,mBAAoB,WACtCxlD,KAAK+jD,kBAAkBC,EAAOC,EAAmBC,IAClDlkD,OAKPylD,cAAe,SAAUC,GACrB,IAAIC,EAASrrB,EAAKsrB,YAClB,GAAmB,iBAARF,EAAkB,CACpBA,EAAIG,SAAS,WACdH,GAAO,SAEI,MAAXA,EAAI,IAAeA,EAAII,WAAW,WAClCJ,EAAM,IAAMA,GAGhB,IAAK,IAAInmD,EAAI,EAAGA,EAAIomD,EAAOnmD,OAAQD,IAAK,CACpC,IAAIgtB,EAAOo5B,EAAOpmD,GAClB,GAAIgtB,EAAKmP,IAAImqB,SAASH,GAClB,OAAOn5B,QAId,GAAmB,iBAARm5B,EAAkB,CAC9B,GAAI,GAAKA,GAAOA,EAAMC,EAAOnmD,OACzB,OAAOmmD,EAAOD,GAGd9lD,GAAGyC,QAAQ,KAAMqjD,QAIrB9lD,GAAGyC,QAAQ,KAAMqjD,GAErB,OAAO,MAYXK,UAAW,SAAUC,EAAW9B,EAAY+B,GACxC,GAAIjmD,KAAK+gD,cAEL,OADAnhD,GAAGyC,QAAQ,KAAM2jD,EAAWhmD,KAAK+gD,gBAC1B,EAEX,IAAIx0B,EAAOvsB,KAAKylD,cAAcO,GAC9B,GAAIz5B,EAAM,CACN,IAAIo4B,EAAOp4B,EAAKo4B,KAIhB,OAHA3kD,KAAK0tB,KAAK9tB,GAAG8gD,SAASwF,2BAA4BF,GAClDhmD,KAAK+gD,cAAgBiF,EACrBhmD,KAAKmmD,iBAAiBxB,EAAMT,EAAY+B,IACjC,EAIP,OADArmD,GAAGyC,QAAQ,KAAM2jD,IACV,GAuBfI,aAAc,SAAUJ,EAAWK,EAAYC,QAC1BjgD,IAAbigD,IACAA,EAAWD,EACXA,EAAa,MAGjB,IAAI95B,EAAOvsB,KAAKylD,cAAcO,GAC9B,GAAIz5B,EACAvsB,KAAK0tB,KAAK9tB,GAAG8gD,SAASwF,2BAA4BF,GAClDpmD,GAAG47B,OAAOC,MAAOkpB,KAAMp4B,EAAKo4B,KAAMj8B,KAAM,QACpC29B,EACA,SAAU1rB,EAAO4rB,GACT5rB,GACA/6B,GAAGyC,QAAQ,KAAM2jD,EAAWrrB,EAAM6rB,SAElCF,GACAA,EAAS3rB,EAAO4rB,SAI3B,CACD,IAAI5rB,EAAQ,8BAAgCqrB,EAAY,6CACxDM,EAAS,IAAI5G,MAAM/kB,IACnB/6B,GAAG+6B,MAAM,iBAAmBA,KAcpCwrB,iBAAkB,SAAUxB,EAAMT,EAAYuC,EAAYC,GAYtD/f,QAAQr6B,KAAK,aAAeq4C,GAC5B/kD,GAAG+mD,aAAaC,UAAUjC,EAAM,SAAUhqB,EAAOksB,GAC7ClgB,QAAQmgB,QAAQ,aAAenC,GAC/B,IAAIp2B,EAAO3uB,GAAG+e,SAEd,GADA4P,EAAKwyB,cAAgB,GACjBpmB,EACAA,EAAQ,yBAA2BA,EACnC/6B,GAAG+6B,MAAMA,OAER,CACD,GAAIksB,aAAsBjnD,GAAGmnD,WAAY,CACrC,IAAI/C,EAAQ6C,EAAW7C,MAiBvB,OAhBAA,EAAMpkC,IAAMinC,EAAWG,MACvBhD,EAAM12B,MAAQu5B,EAAWv5B,WAarBiB,EAAKw1B,kBAAkBC,EAAOyC,EAAYvC,GAK9CvpB,EAAQ,aAAegqB,EAAO,kBAC9B/kD,GAAG+6B,MAAMA,GAGbupB,GACAA,EAAWvpB,MAUvB7S,OAAQ,WACC9nB,KAAK4gD,UAIV5gD,KAAKkhD,YAAcM,YAAYC,MAC1BzhD,KAAKkhD,aACNthD,GAAGgB,MAAM,MAGbZ,KAAK4gD,SAAU,EACf5gD,KAAKmhD,WAAa,IAYtB8F,aAAc,SAAUljD,GACfnE,GAAGsnD,OAAOC,OAGfvnD,GAAGsnD,OAAOC,KAAKC,QAAUrjD,IAc7BsjD,cAAe,SAAUC,GAChB1nD,GAAGsnD,OAAOC,OAGfvnD,GAAGsnD,OAAOC,KAAKxI,gBAAkB2I,IAWrCC,gBAAiB,WACb,OAAOvnD,KAAKghD,QAYhBhJ,SAAU,WACN,OAAOh4C,KAAKghD,QAUhBwG,qBAAsB,WAClB,OAAO,IAAOltB,EAAKmtB,gBAUvBC,qBAAsB,SAAU3jD,GAC5Bu2B,EAAKqtB,aAAatiD,KAAKqN,MAAM,IAAO3O,KASxC6jD,aAAc,WACV,OAAO5nD,KAAKmhD,YAShB0G,eAAgB,WACZ,OAAO7nD,KAAKihD,cAShBl5B,SAAU,WACN,OAAO/nB,KAAK4gD,SAShBz/B,aAAc,WACV,OAAOnhB,KAAK4e,YAShBkpC,aAAc,SAAUC,GAChB/nD,KAAK4e,aAAempC,IACpB/nD,KAAK4e,WAAampC,IAU1BC,iBAAkB,WACd,OAAOhoD,KAAKshD,gBAQhB2G,iBAAkB,SAAUC,GACpBloD,KAAKshD,iBAAmB4G,IACpBloD,KAAKshD,gBACLthD,KAAK4e,WAAWwC,iBAAiBphB,KAAKshD,gBAE1CthD,KAAKshD,eAAiB4G,EACtBloD,KAAK4e,WAAW+iC,eAAe3hD,KAAKshD,eAAgB1hD,GAAG6gD,UAAUmB,iBAAiB,KAU1Fh2B,oBAAqB,WACjB,OAAO5rB,KAAK+hD,mBAShBoG,oBAAqB,WACjB,OAAOnoD,KAAKiiD,mBAShBmG,kBAAmB,WACf,OAAOpoD,KAAKmiD,iBAOhB2B,eAAgB,WACZ9jD,KAAK2gD,SAAU,EACf3gD,KAAKkhD,YAAcM,YAAYC,OAMnCoC,cAAe,WACX7jD,KAAK2gD,SAAU,GAMnB0H,SA4BI,WACIroD,KAAK6gD,0BACL7gD,KAAK6gD,0BAA2B,EAChC7gD,KAAK0jD,iBAEC1jD,KAAK2gD,UAEX3gD,KAAKqiD,qBAGAriD,KAAK4gD,UACN5gD,KAAK0tB,KAAK9tB,GAAG8gD,SAAS4H,qBAEtBtoD,KAAKohD,eAAemH,aAEpBvoD,KAAKohD,eAAeoH,YAAYxoD,KAAKmhD,YAErCnhD,KAAK4e,WAAW/d,OAAOb,KAAKmhD,YAE5BnhD,KAAKohD,eAAeqH,gBAAgBzoD,KAAKmhD,YAEzCnhD,KAAK0tB,KAAK9tB,GAAG8gD,SAAS8E,oBAEtBjF,EAAI4E,oBAIRnlD,KAAK0tB,KAAK9tB,GAAG8gD,SAASgI,mBACtBvnB,EAASpyB,OAAO/O,KAAKghD,QAGrBhhD,KAAK0tB,KAAK9tB,GAAG8gD,SAASiI,kBAEtBnI,EAAaoI,uBACb5oD,KAAKihD,iBAIb4H,SAAU,SAAUngC,EAAMyF,EAAUjuB,GAChCF,KAAK6E,IAAI6jB,EAAMyF,EAAUjuB,IAG7B4oD,UAAW,SAAUpgC,EAAMyF,EAAUjuB,GACjCF,KAAK+oD,OAAOrgC,EAAMyF,EAAUjuB,KAKpCN,GAAGye,GAAG2qC,MAAMppD,GAAG8gD,SAASp+C,UAAWs1B,EAAYt1B,WAU/C1C,GAAG8gD,SAASuI,yBAA2B,8BAevCrpD,GAAG8gD,SAASwF,2BAA6B,gCAezCtmD,GAAG8gD,SAAS0E,0BAA4B,+BAexCxlD,GAAG8gD,SAAS4E,yBAA2B,8BAcvC1lD,GAAG8gD,SAAS4H,oBAAsB,yBAclC1oD,GAAG8gD,SAAS8E,mBAAqB,wBAUjC5lD,GAAG8gD,SAASwI,mBAAqB,uBAUjCtpD,GAAG8gD,SAASyI,kBAAoB,uBAchCvpD,GAAG8gD,SAASgI,kBAAoB,uBAchC9oD,GAAG8gD,SAASiI,iBAAmB,sBAY/B/oD,GAAG8gD,SAAS0I,cAAgB,EAU5BxpD,GAAG8gD,SAAS2I,cAAgB,EAU5BzpD,GAAG8gD,SAAS4I,kBAAoB,EAUhC1pD,GAAG8gD,SAAS6I,mBAAqB3pD,GAAG8gD,SAAS0I,cAY7CxpD,GAAG+e,SAAW,IAAI/e,GAAG8gD,SAErBvhD,EAAOE,QAAUO,GAAG+e,uPC/mCpB,IAAIiZ,EAAcl4B,EAAQ,wBAC1BA,EAAQ,0BACR,IAAMy3B,EAAQz3B,EAAQ,aAChByhC,EAAWzhC,EAAQ,uBACnB8pD,EAAkE9pD,EAAQ,6BAC1E+pD,EAAsB/pD,EAAQ,gDAYhC46B,GAgBAovB,WAAY,eAaZnI,WAAY,eAQZoI,kBAAmB,cASnBjI,oBAAqB,gBAErBkI,sBAAuB,gBAQvBC,mBAAoB,EAOpBC,kBAAmB,EAOnBC,mBAAoB,EAEpBvF,qBAGA5D,SAAS,EACToJ,eAAe,EACfC,YAAY,EACZC,WAAW,EACXC,sBAAsB,EAEtBC,eAAgB,KAEhBC,YAAa,KAEbC,UAAW,KACXC,WAAY,KAGZ3E,eAQAzhC,MAAO,KAOPq+B,UAAW,KAOXjoB,OAAQ,KAQRiwB,YAAa,EA8DbtK,OAAQ,KAQRuK,QAAS,KAWT9C,aAAc,SAAU3hC,GACPhmB,KAAKkgD,OACXl6B,UAAYA,EACfhmB,KAAKqqD,aACLzH,OAAO8H,gBAAgB1qD,KAAKqqD,aAChCrqD,KAAKqqD,YAAc,EACnBrqD,KAAK4gD,SAAU,EACf5gD,KAAK2qD,gBACL3qD,KAAK4qD,gBASTnD,aAAc,WACV,OAAOznD,KAAKkgD,OAAOl6B,WAQvBtlB,KAAM,WACFd,GAAG+e,SAAS0pC,YAUhBzgC,MAAO,WACC5nB,KAAK4gD,UACT5gD,KAAK4gD,SAAU,EAEXhhD,GAAG89B,aACH99B,GAAG89B,YAAY8B,SAGfx/B,KAAKqqD,aACLzH,OAAO8H,gBAAgB1qD,KAAKqqD,aAChCrqD,KAAKqqD,YAAc,IASvBviC,OAAQ,WACC9nB,KAAK4gD,UACV5gD,KAAK4gD,SAAU,EAEXhhD,GAAG89B,aACH99B,GAAG89B,YAAY+B,WAGnBz/B,KAAK4qD,iBAST7iC,SAAU,WACN,OAAO/nB,KAAK4gD,SAQhBiK,QAAS,WACLjrD,GAAG+e,SAASyP,KAAKxuB,GAAG8gD,SAASiI,iBAAkB,WAC3C,IAAK,IAAItwB,KAAMiC,EAAKkqB,kBAChBlqB,EAAKwwB,sBAAsBxwB,EAAKkqB,kBAAkBnsB,IAItDz4B,GAAG+e,SAASq5B,WAAWvd,UACvB76B,GAAG0kD,OAAOa,mBAEVvlD,GAAG+e,SAAS+kC,gBAGR9jD,GAAG89B,aACH99B,GAAG89B,YAAYuB,aAGnBr/B,GAAG+e,SAASk5B,QACZvd,EAAKmwB,aASb9gC,IAAK,WACDohC,SAKJC,YA3TO,WA4TChrD,KAAKmqD,uBAITnqD,KAAKirD,gBAGDjrD,KAAKkrD,cAGTlrD,KAAK0tB,KAAK1tB,KAAK0hD,uBAGnByJ,iBAzUO,SAyUWpT,GACd/3C,KAAKkqD,WAAY,EAGjBlqD,KAAKgrD,cAELrkB,QAAQgW,IAAI,kBAAoB/8C,GAAGwrD,gBAEnCprD,KAAK2qD,gBACL3qD,KAAK4qD,eAEL5qD,KAAK0tB,KAAK1tB,KAAK2pD,mBAEX5R,GAAIA,KAGZsT,cAAezzB,EAAYt1B,UAAU4rB,GACrCo9B,gBAAiB1zB,EAAYt1B,UAAU8rB,KAuBvCF,GAjXO,SAiXHxF,EAAMyF,EAAUjuB,GAEZF,KAAKkqD,WAAaxhC,IAAS1oB,KAAK0hD,oBAChCvzB,EAAS5rB,KAAKrC,GAGdF,KAAKqrD,cAAc3iC,EAAMyF,EAAUjuB,IAqB3CkuB,KA5YO,SA4YD1F,EAAMyF,EAAUjuB,GAEdF,KAAKkqD,WAAaxhC,IAAS1oB,KAAK0hD,oBAChCvzB,EAAS5rB,KAAKrC,GAGdF,KAAKsrD,gBAAgB5iC,EAAMyF,EAAUjuB,IAU7CqrD,QA5ZO,SA4ZExT,GAEL,GAAI/3C,KAAKkqD,UACDnS,GAAIA,QADZ,CAMA,IAAIyT,EAASxrD,KAAKkgD,OAAOsL,OACzB,GAAIA,GAAUA,EAAOhsD,OAAS,EAAG,CAC7B,IAAI+uB,EAAOvuB,KACXJ,GAAG47B,OAAOC,KAAK+vB,EAAQ,SAAUvwB,GAC7B,GAAIA,EAAK,MAAM,IAAIykB,MAAM+L,KAAKC,UAAUzwB,IACxC1M,EAAK48B,iBAAiBpT,UAI1B/3C,KAAKmrD,iBAAiBpT,KAW9B4T,IAAK,SAAUzL,EAAQuK,GACnBzqD,KAAK4rD,YAAY1L,GACjBlgD,KAAKyqD,QAAUA,EACfzqD,KAAKurD,QAAQjxB,EAAKmwB,SAAWnwB,EAAKmwB,QAAQ5xB,KAAKyB,KAcnDuxB,mBAAoB,SAAUpnB,GAC1B,GAAK7kC,GAAG2jB,KAAKuoC,OAAOrnB,IAAUA,EAAKkgB,KAAnC,CAIA,IAAItsB,EAAKoM,EAAKkgB,KACd,IAAK3kD,KAAKwkD,kBAAkBnsB,GAAK,CAC7B,IAAI2rB,EAAQpkD,GAAG+e,SAASqiC,OACxB,GAAIphD,GAAGmsB,QAAQi4B,GACX,GAAKvf,EAAK9/B,OAGL,CAAA,KAAO8/B,EAAK9/B,kBAAkB/E,GAAGukD,OAElC,YADAvkD,GAAGu+B,OAAO,MAGT,GAAIsG,EAAK9/B,SAAWq/C,EAErB,YADApkD,GAAGu+B,OAAO,WAPVsG,EAAK9/B,OAASq/C,EAWtBhkD,KAAKwkD,kBAAkBnsB,GAAMoM,EAC7BA,EAAKsnB,cAAe,QApBpBnsD,GAAGu+B,OAAO,OA8BlB2sB,sBAAuB,SAAUrmB,GAC7B,IAAIpM,EAAKoM,EAAKkgB,MAAQ,GAClBlgB,IAASzkC,KAAKwkD,kBAAkBnsB,YACzBr4B,KAAKwkD,kBAAkBnsB,GAC9BoM,EAAKsnB,cAAe,IAW5BC,kBAAmB,SAAUvnB,GACzB,OAAOA,EAAKsnB,cAMhBpB,cAAe,WACX3qD,KAAKsqD,UAAY,IAAI2B,KACrB,IAAIjmC,EAAYsU,EAAK4lB,OAAOl6B,UAC5BhmB,KAAKuqD,WAAa,IAAOvkC,EAQH,KAAdA,GAAkC,KAAdA,GACpB48B,OAAOsJ,iBAAmBlsD,KAAKmsD,QAC/BvJ,OAAO8H,gBAAkB1qD,KAAKosD,UAG9BxJ,OAAOsJ,iBAAmBtJ,OAAOyJ,uBACjCzJ,OAAO0J,6BACP1J,OAAO2J,0BACP3J,OAAO4J,wBACP5J,OAAO6J,yBACPzsD,KAAKmsD,QACLvJ,OAAO8H,gBAAkB9H,OAAO8J,sBAChC9J,OAAO+J,6BACP/J,OAAOgK,+BACPhK,OAAOiK,gCACPjK,OAAOkK,8BACPlK,OAAOmK,mCACPnK,OAAOoK,wBACPpK,OAAOqK,yBACPrK,OAAOsK,4BACPtK,OAAOuK,uBACPntD,KAAKosD,UAIjBD,QAAS,SAASh+B,GACd,IAAIi/B,GAAW,IAAInB,MAAOoB,UACtBC,EAAajoD,KAAKE,IAAI,EAAG+0B,EAAKiwB,YAAc6C,EAAW9yB,EAAKgwB,YAC5DjyB,EAAKuqB,OAAO9lB,WAAW,WAAa3O,KACpCm/B,GAEJ,OADAhzB,EAAKgwB,UAAY8C,EAAWE,EACrBj1B,GAEX+zB,QAAS,SAAS/zB,GACduqB,OAAO/lB,aAAaxE,IAGxBuyB,aAAc,WACV,IAAiBz8B,EAAbI,EAAOvuB,KAAgBkgD,EAAS3xB,EAAK2xB,OACrCvhC,EAAW/e,GAAG+e,SACd4uC,GAAO,EAAMvnC,EAAYk6B,EAAOl6B,UAEpCmR,EAAM2oB,gBAAgBI,EAAOC,SAE7BhyB,EAAW,WACP,IAAKI,EAAKqyB,QAAS,CAEf,GADAryB,EAAK87B,YAAczH,OAAOsJ,iBAAiB/9B,GACd,KAAdnI,IACPunC,GAAQA,GACR,OAGR5uC,EAAS0pC,aAIjB95B,EAAK87B,YAAczH,OAAOsJ,iBAAiB/9B,GAC3CI,EAAKqyB,SAAU,GAInBgL,YAvkBO,SAukBM1L,GAEuB,iBAArBA,EAAOsN,YACdtN,EAAOsN,UAAY,GAEvBtN,EAAOuN,kBAAoBvN,EAAOuN,gBACF,iBAArBvN,EAAOl6B,YACdk6B,EAAOl6B,UAAY,IAEvB,IAAI0nC,EAAaxN,EAAOwN,YACE,iBAAfA,GAA2BA,EAAa,GAAKA,EAAa,KACjExN,EAAOwN,WAAa,GAEkB,kBAA/BxN,EAAOyN,sBACdzN,EAAOyN,qBAAsB,GAEjCzN,EAAOC,UAAYD,EAAOC,QAG1BngD,KAAK4lD,YAAc1F,EAAOyF,WAG1B3lD,KAAK4tD,gBAAkB1N,EAAO0N,oBAC9B5tD,KAAK6tD,UAAY3N,EAAO2N,cAExB12B,EAAM6mB,mBAAmBkC,EAAOsN,WAEhCxtD,KAAKkgD,OAASA,EACdlgD,KAAKgqD,eAAgB,GAGzB8D,qBAtmBO,WAumBH,IAAI5N,EAASlgD,KAAKkgD,OACd6N,EAAiBhoC,SAASm6B,EAAOwN,aAAe,EAGpD1tD,KAAKwqD,WAAaxqD,KAAK6pD,mBACvB,IAAImE,GAAgB,EAqBpB,GAnBuB,IAAnBD,EACInuD,GAAGi4B,IAAIo2B,aAAP,QACAjuD,KAAKwqD,WAAaxqD,KAAK8pD,kBACvBkE,GAAgB,GAEXpuD,GAAGi4B,IAAIo2B,aAAP,SACLjuD,KAAKwqD,WAAaxqD,KAAK6pD,mBACvBmE,GAAgB,GAGI,IAAnBD,GAAwBnuD,GAAGi4B,IAAIo2B,aAAP,QAC7BjuD,KAAKwqD,WAAaxqD,KAAK6pD,mBACvBmE,GAAgB,GAEQ,IAAnBD,GAAwBnuD,GAAGi4B,IAAIo2B,aAAP,SAC7BjuD,KAAKwqD,WAAaxqD,KAAK8pD,kBACvBkE,GAAgB,IAGfA,EACD,MAAM,IAAItO,MAAMvoB,EAAMI,SAAS,KAAMw2B,KAI7C9C,cAtoBO,WAwoBH,IAAIjrD,KAAKmqD,qBAAT,CAEA,IAAI/iB,EAAKpnC,KAAKkgD,OAAO7nB,GACjB10B,OAAA,EAAOC,OAAA,EACPsqD,OAAA,EAAaC,OAAA,EAsBb,IAAI9uC,EAAW+nB,aAAcgnB,YAAehnB,EAAMzN,SAAS00B,cAAcjnB,IAAOzN,SAAS00B,cAAc,IAAMjnB,GAErF,WAApB/nB,EAAQivC,SACR3qD,EAAQ0b,EAAQ1b,MAChBC,EAASyb,EAAQzb,OAGjB5D,KAAKu6B,OAAS2zB,EAAc7uC,EAC5Brf,KAAKwiD,UAAY2L,EAAiBx0B,SAASC,cAAc,OACrDs0B,EAAY5O,YACZ4O,EAAY5O,WAAWiP,aAAaJ,EAAgBD,KAGhC,QAApB7uC,EAAQivC,SACR1uD,GAAGu+B,OAAO,MAEdx6B,EAAQ0b,EAAQmvC,YAChB5qD,EAASyb,EAAQovC,aACjBzuD,KAAKu6B,OAAS2zB,EAAcv0B,SAASC,cAAc,UACnD55B,KAAKwiD,UAAY2L,EAAiBx0B,SAASC,cAAc,OACzDva,EAAQggC,YAAY8O,IAExBA,EAAe/P,aAAa,KAAM,wBAClC+P,EAAe9O,YAAY6O,GAC3BluD,KAAKmkB,MAASgqC,EAAe7O,aAAe3lB,SAAS+0B,KAAQ/0B,SAASg1B,gBAAkBR,EAAe7O,WAEvG,SAAmBjgC,EAASpgB,IACR,IAAMogB,EAAQuvC,UAAY,KAAKjrC,QAAQ,IAAM1kB,EAAO,MAAQ,IAEpEogB,EAAQuvC,YACRvvC,EAAQuvC,WAAa,KAEzBvvC,EAAQuvC,WAAa3vD,GAG7B4vD,CAASX,EAAa,cACtBA,EAAY9P,aAAa,QAASz6C,GAAS,KAC3CuqD,EAAY9P,aAAa,SAAUx6C,GAAU,KAC7CsqD,EAAY9P,aAAa,WAAY,IAKzC,GAFAp+C,KAAK8tD,uBAED9tD,KAAKwqD,aAAexqD,KAAK8pD,kBAAmB,CAC5C,IAAIgF,GACAC,SAAW,EAEXC,UAAapvD,GAAGiI,MAAMonD,uBACtBC,MAAStvD,GAAGiI,MAAMsnD,2BAEDC,EAGrBjuB,EAASkuB,UAAUnB,EAAaY,GAChC9uD,KAAKoqD,eAAiBjpB,EAASsG,OAAO6nB,KAGjC1vD,GAAGiI,MAAM0nD,qBAAuB9F,IACjCA,EAAoB/6C,SAAU,GAG9B9O,GAAGi4B,IAAI23B,aAAe5vD,GAAGi4B,IAAI43B,qBAAuB5pC,WAAWjmB,GAAGi4B,IAAI63B,iBAAmB,KACzFjG,EAAoB/6C,SAAU,GAGjC1O,KAAKoqD,iBACNpqD,KAAKwqD,WAAaxqD,KAAK6pD,mBAEvB1oB,EAASwuB,WAAWzB,GACpBluD,KAAKoqD,eAAiBjpB,EAASsG,OAAOmoB,MAG1C5vD,KAAKu6B,OAAOs1B,cAAgB,WACxB,IAAKjwD,GAAGkwD,qBAAsB,OAAO,GAGzC9vD,KAAKmqD,sBAAuB,IAGhCe,YAAa,WACT,IAAkB6E,EAAdC,EAAMpN,OAGN5iD,KAAKkgD,OAAOyN,qBACZnE,EAAamE,oBAAoB3tD,KAAKu6B,aAEX,IAApBZ,SAASs2B,OAChBF,EAAiB,cACoB,IAAvBp2B,SAASu2B,UACvBH,EAAiB,iBACmB,IAAtBp2B,SAASw2B,SACvBJ,EAAiB,gBACuB,IAA1Bp2B,SAASy2B,eACvBL,EAAiB,gBAGrB,IAAIE,GAAS,EAEb,SAASI,IACAJ,IACDA,GAAS,EACT31B,EAAK5M,KAAK4M,EAAKovB,aAIvB,SAAS4G,EAASC,EAAMC,EAAMC,EAAMC,EAAMC,GAClCV,IACAA,GAAS,EACT31B,EAAK5M,KAAK4M,EAAKinB,WAAYgP,EAAMC,EAAMC,EAAMC,EAAMC,IAI3D,GAAIZ,EAQA,IAPA,IAAIa,GACA,mBACA,sBACA,qBACA,yBACA,4BAEKrxD,EAAI,EAAGA,EAAIqxD,EAAWpxD,OAAQD,IACnCo6B,SAASN,iBAAiBu3B,EAAWrxD,GAAI,SAAU2sB,GAC/C,IAAIrD,EAAU8Q,SAASo2B,IAEvBlnC,EAAUA,GAAWqD,EAAA,QAEjBmkC,IAEAC,WAIZN,EAAI32B,iBAAiB,OAAQg3B,GAC7BL,EAAI32B,iBAAiB,QAASi3B,GAG9BO,UAAUC,UAAUntC,QAAQ,mBAAqB,IACjDqsC,EAAIe,QAAUT,GAQd,eAAgB1N,QAAU,eAAgBA,SAC1CoN,EAAI32B,iBAAiB,WAAYg3B,GACjCL,EAAI32B,iBAAiB,WAAYi3B,GAEjC32B,SAASN,iBAAiB,WAAYg3B,GACtC12B,SAASN,iBAAiB,WAAYi3B,IAG1CtwD,KAAKkuB,GAAGoM,EAAKovB,WAAY,WACrBpvB,EAAK1S,UAET5nB,KAAKkuB,GAAGoM,EAAKinB,WAAY,WACrBjnB,EAAKxS,aAKjB8P,EAAYr1B,KAAK+3B,GACjB16B,GAAGye,GAAG2qC,MAAM1uB,EAAM1C,EAAYt1B,WAY9B1C,GAAG06B,KAAOn7B,EAAOE,QAAUi7B,4OCn2B3B,aAEA,IAAM02B,EAAWtxD,EAAQ,qBACnBuxD,EAAevxD,EAAQ,yBACvBwxD,EAAYxxD,EAAQ,sBACpBk6C,EAAOl6C,EAAQ,4BAA4Bk6C,KAC3CuX,EAAczxD,EAAQ,4BACtB8gD,EAAe9gD,EAAQ,mBACvBmI,EAAQnI,EAAQ,sBAEhB2e,GADO3e,EAAQ,gBACVA,EAAQ,kBAEbk4B,GADQl4B,EAAQ,iBACFA,EAAQ,yBACtBm6C,EAAan6C,EAAQ,0BAGrB0xD,EADQxxD,GAAG0kD,OAAO+M,MACCD,WAGnBtX,EAAaz0C,KAAK8E,GAAK,IAEzBmnD,IAAuB1xD,GAAG0e,cAC1BizC,EAAY,aACZC,EAAS5xD,GAAGqE,KACZwtD,EAAS7xD,GAAGqE,KACZytD,EAAa9X,EAAK/T,KAAKiH,SACvB6kB,EAAa/X,EAAKvY,KAAKyL,SACvB8kB,EAAahY,EAAKrP,KAAKuC,SACvB+kB,EAAwB,EACxBC,EAAe,IAAIz+C,MAAM,IAC7By+C,EAAatyD,OAAS,EAEtB,IAQIuyD,EAAoBnyD,GAAG43B,MACvBw6B,MAAO,KAWPC,EAAiBryD,GAAG43B,MAOpBuL,SAAU,EAOV+Y,MAAO,EAOPU,SAAU,EAOV0V,KAAM,EAONC,GAAI,EAOJ/V,IAAK,QAUL3C,EAAY75C,GAAG43B,MAOf46B,YAAa,aAObC,WAAY,YAOZC,UAAW,WAOXC,aAAc,cAQdC,WAAY,YAOZC,WAAY,YAOZC,YAAa,aAObC,YAAa,aAObC,SAAU,UAOVC,YAAa,aAWbxX,iBAAkB,mBAUlByX,iBAAkB,mBAUlB9W,cAAe,gBAUf+W,aAAc,eAUdC,eAAgB,iBAUhBC,cAAe,gBAOfC,YAAa,cAObC,cAAe,gBAOfC,cAAe,gBAOfC,cAAe,kBAGfC,GACA7Z,EAAU2Y,YACV3Y,EAAU4Y,WACV5Y,EAAU6Y,UACV7Y,EAAU8Y,cAEVgB,GACA9Z,EAAU+Y,WACV/Y,EAAUiZ,YACVjZ,EAAUgZ,WACVhZ,EAAUkZ,YACVlZ,EAAUmZ,SACVnZ,EAAUoZ,aAGVW,EAAkB,KAElBC,EAAqB,SAAUC,EAAOxnC,GACtC,IAAI9mB,EAAMsuD,EAAMC,cACZlvB,EAAOzkC,KAAK4zD,MAEhB,QAAInvB,EAAKovB,SAASzuD,EAAKpF,QACnBksB,EAAMxD,KAAO+wB,EAAU2Y,YACvBlmC,EAAMwnC,MAAQA,EACdxnC,EAAM4nC,SAAU,EAChBrvB,EAAKsvB,cAAc7nC,IACZ,IAIX8nC,EAAoB,SAAUN,EAAOxnC,GACrC,IAAIuY,EAAOzkC,KAAK4zD,MAChB1nC,EAAMxD,KAAO+wB,EAAU4Y,WACvBnmC,EAAMwnC,MAAQA,EACdxnC,EAAM4nC,SAAU,EAChBrvB,EAAKsvB,cAAc7nC,IAEnB+nC,EAAmB,SAAUP,EAAOxnC,GACpC,IAAI9mB,EAAMsuD,EAAMC,cACZlvB,EAAOzkC,KAAK4zD,MAEZnvB,EAAKovB,SAASzuD,EAAKpF,MACnBksB,EAAMxD,KAAO+wB,EAAU6Y,UAGvBpmC,EAAMxD,KAAO+wB,EAAU8Y,aAE3BrmC,EAAMwnC,MAAQA,EACdxnC,EAAM4nC,SAAU,EAChBrvB,EAAKsvB,cAAc7nC,IAEnBgoC,EAAsB,SAAUR,EAAOxnC,GAC7BwnC,EAAMC,cAAhB,IACIlvB,EAAOzkC,KAAK4zD,MAEhB1nC,EAAMxD,KAAO+wB,EAAU8Y,aACvBrmC,EAAMwnC,MAAQA,EACdxnC,EAAM4nC,SAAU,EAChBrvB,EAAKsvB,cAAc7nC,IAGnBioC,EAAoB,SAAUjoC,GAC9B,IAAI9mB,EAAM8mB,EAAMynC,cACZlvB,EAAOzkC,KAAK4zD,MAEZnvB,EAAKovB,SAASzuD,EAAKpF,QACnBksB,EAAMxD,KAAO+wB,EAAU+Y,WACvBtmC,EAAM4nC,SAAU,EAChBrvB,EAAKsvB,cAAc7nC,KAGvBkoC,EAAoB,SAAUloC,GAC9B,IAAI9mB,EAAM8mB,EAAMynC,cACZlvB,EAAOzkC,KAAK4zD,MAEhB,GADUnvB,EAAKovB,SAASzuD,EAAKpF,MAEpBA,KAAKq0D,cAEFb,GAAmBA,EAAgBc,iBACnCpoC,EAAMxD,KAAO+wB,EAAUkZ,YACvBa,EAAgBO,cAAc7nC,GAC9BsnC,EAAgBc,eAAeD,aAAc,GAEjDb,EAAkBxzD,KAAK4zD,MACvB1nC,EAAMxD,KAAO+wB,EAAUiZ,YACvBjuB,EAAKsvB,cAAc7nC,GACnBlsB,KAAKq0D,aAAc,GAEvBnoC,EAAMxD,KAAO+wB,EAAUgZ,WACvBvmC,EAAM4nC,SAAU,EAChBrvB,EAAKsvB,cAAc7nC,OAElB,CAAA,IAAIlsB,KAAKq0D,YAQV,OAPAnoC,EAAMxD,KAAO+wB,EAAUkZ,YACvBluB,EAAKsvB,cAAc7nC,GACnBlsB,KAAKq0D,aAAc,EACnBb,EAAkB,KAQtBtnC,EAAMqoC,mBAENC,EAAkB,SAAUtoC,GAC5B,IAAI9mB,EAAM8mB,EAAMynC,cACZlvB,EAAOzkC,KAAK4zD,MAEZnvB,EAAKovB,SAASzuD,EAAKpF,QACnBksB,EAAMxD,KAAO+wB,EAAUmZ,SACvB1mC,EAAM4nC,SAAU,EAChBrvB,EAAKsvB,cAAc7nC,GACnBA,EAAMqoC,oBAGVE,EAAqB,SAAUvoC,GAC/B,IAAI9mB,EAAM8mB,EAAMynC,cACZlvB,EAAOzkC,KAAK4zD,MAEZnvB,EAAKovB,SAASzuD,EAAKpF,QACnBksB,EAAMxD,KAAO+wB,EAAUoZ,YACvB3mC,EAAM4nC,SAAU,EAChBrvB,EAAKsvB,cAAc7nC,GACnBA,EAAMqoC,oBAId,SAASG,EAAqBjwB,GAC1B,IAAIkwB,EAAO/0D,GAAG+0D,KACd,GAAIA,EAEA,IADA,IAAItzC,EAAQ,EACHuzC,EAAOnwB,EAAMmwB,GAAQh1D,GAAG2jB,KAAKuoC,OAAO8I,GAAOA,EAAOA,EAAK/Z,UAAWx5B,EACvE,GAAIuzC,EAAKlvC,aAAaivC,GAClB,OACItzC,MAAOA,EACPojB,KAAMmwB,GAKtB,OAAO,KAGX,SAASC,EAAiBpwB,EAAMje,GAC5B,KAAMie,EAAKqwB,UAAY1D,GAAa,CAChC,IAAI7xD,EAAI,EACR,GAAIklC,EAAKswB,mBACL,KAAOx1D,EAAIinB,EAAOhnB,SAAUD,EACxB,GAAIklC,EAAKswB,mBAAmBrmC,iBAAiBlI,EAAOjnB,IAChD,OAAO,EAInB,GAAIklC,EAAKuwB,oBACL,KAAOz1D,EAAIinB,EAAOhnB,SAAUD,EACxB,GAAIklC,EAAKuwB,oBAAoBtmC,iBAAiBlI,EAAOjnB,IACjD,OAAO,EAInB,OAAO,EAEX,OAAO,EAsEX,IAAI01D,GACAh2D,KAAM,UACNsC,QAASyvD,EAETxoC,YAEI0sC,SAAU,IACVC,OAAQv1D,GAAG8c,MAAMoxB,MACjBsnB,aAAcx1D,GAAGy1D,KACjBC,aAAc11D,GAAGqE,GAAG,GAAK,IACzBo2C,UAAWz6C,GAAG+xC,KACd2I,OAAQ16C,GAAG+xC,KACXS,MAAOxyC,GAAG8xC,KACVj6B,OAAQ,EACRC,OAAQ,EACR69C,cACI9sC,QAAS,EACT+sC,cAAc,GAElBC,QAAS,EAETxZ,WAAW,EAeXyZ,YACIjtC,QAAS,EACTC,KAAM9oB,GAAG+1D,SAabC,OACIjtC,IADG,WAEC,OAAO/oB,GAAG06B,KAAKuzB,UAAU7tD,KAAK01D,aAAe,IAGjD5pC,IALG,SAKE/nB,GACD/D,KAAK01D,WAAa91D,GAAG06B,KAAKuzB,UAAUlqC,QAAQ5f,GAC5C/D,KAAK0tB,KAAK+rB,EAAU4Z,cAAerzD,QAuB3CV,GACIqpB,IADD,WAEK,OAAO3oB,KAAKq6C,UAAU/6C,GAE1BwsB,IAJD,SAIM/nB,GACD,IAAIu4C,EAAgBt8C,KAAKq6C,UACrBt2C,IAAUu4C,EAAch9C,IAMpBg9C,EAAch9C,EAAIyE,EAClB/D,KAAKi7C,cAAcgX,EAAelvB,UAClC/iC,KAAKk7C,aAAerB,EAAWsB,qBApjBnC,EAujBQn7C,KAAKo7C,YAMDp7C,KAAK0tB,KAAK+rB,EAAU4B,qBAoB5C33C,GACIilB,IADD,WAEK,OAAO3oB,KAAKq6C,UAAU32C,GAE1BooB,IAJD,SAIM/nB,GACD,IAAIu4C,EAAgBt8C,KAAKq6C,UACrBt2C,IAAUu4C,EAAc54C,IAMpB44C,EAAc54C,EAAIK,EAClB/D,KAAKi7C,cAAcgX,EAAelvB,UAClC/iC,KAAKk7C,aAAerB,EAAWsB,qBA/lBnC,EAkmBQn7C,KAAKo7C,YAMDp7C,KAAK0tB,KAAK+rB,EAAU4B,qBA4B5CxQ,UACIliB,IADM,WAEF,OAAQ3oB,KAAKgW,OAEjB8V,IAJM,SAID/nB,GACD/D,KAAKgW,OAASjS,IAYtBiS,OACI2S,IADG,WAEC,OAAO3oB,KAAK61D,aAAazsB,GAE7Btd,IAJG,SAIE/nB,GACD61C,EAAKvY,KAAKvV,IAAI9rB,KAAK61D,aAAc,EAAG,EAAG9xD,GACvC/D,KAAK81D,aACL91D,KAAKi7C,cAAcgX,EAAezV,UAClCx8C,KAAKk7C,aAAerB,EAAWkC,eA3pB3B,EA6pBA/7C,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUqZ,oBAsBhCiD,WACIptC,IADO,WAEH,OAAO3oB,KAAK61D,aAAav2D,GAE7BwsB,IAJO,SAIF/nB,GACG/D,KAAK61D,aAAav2D,IAAMyE,IACxB/D,KAAK61D,aAAav2D,EAAIyE,EAElB/D,KAAK61D,aAAav2D,IAAMU,KAAK61D,aAAanyD,EAC1Ck2C,EAAKrP,KAAKqH,UAAU5xC,KAAKoyC,MAAO,EAAG,GAAIruC,GAGvC61C,EAAKrP,KAAKqH,UAAU5xC,KAAKoyC,MAAOruC,EAAO/D,KAAK61D,aAAanyD,EAAG,GAEhE1D,KAAKi7C,cAAcgX,EAAezV,UAClCx8C,KAAKk7C,aAAerB,EAAWkC,eAnsB/B,EAqsBI/7C,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUqZ,qBAgBpCkD,WACIrtC,IADO,WAEH,OAAO3oB,KAAK61D,aAAanyD,GAE7BooB,IAJO,SAIF/nB,GACG/D,KAAK61D,aAAanyD,IAAMK,IACxB/D,KAAK61D,aAAanyD,EAAIK,EAElB/D,KAAK61D,aAAav2D,IAAMU,KAAK61D,aAAanyD,EAC1Ck2C,EAAKrP,KAAKqH,UAAU5xC,KAAKoyC,MAAO,EAAG,GAAIruC,GAGvC61C,EAAKrP,KAAKqH,UAAU5xC,KAAKoyC,MAAOpyC,KAAK61D,aAAav2D,EAAGyE,EAAO,GAEhE/D,KAAKi7C,cAAcgX,EAAezV,UAClCx8C,KAAKk7C,aAAerB,EAAWkC,eAruB/B,EAuuBI/7C,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUqZ,qBAcpCpoB,OACI/hB,IADG,WAEC,OAAO3oB,KAAKs6C,OAAOh7C,GAEvBwsB,IAJG,SAIE0C,GACDxuB,KAAK67C,SAASrtB,KAatB7e,QACIgZ,IADI,WAEA,OAAO3oB,KAAKs6C,OAAOh7C,GAEvBwsB,IAJI,SAIC/nB,GACG/D,KAAKs6C,OAAOh7C,IAAMyE,IAClB/D,KAAKs6C,OAAOh7C,EAAIyE,EAChB/D,KAAKi7C,cAAcgX,EAAenW,OAClC97C,KAAKk7C,aAAerB,EAAWkC,eAjxBlC,EAmxBO/7C,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUuC,kBAepC/rC,QACI0Y,IADI,WAEA,OAAO3oB,KAAKs6C,OAAO52C,GAEvBooB,IAJI,SAIC/nB,GACG/D,KAAKs6C,OAAO52C,IAAMK,IAClB/D,KAAKs6C,OAAO52C,EAAIK,EAChB/D,KAAKi7C,cAAcgX,EAAenW,OAClC97C,KAAKk7C,aAAerB,EAAWkC,eA3yBlC,EA6yBO/7C,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUuC,kBAsBpC/jC,OACI0Q,IADG,WAEC,OAAO3oB,KAAKyX,QAEhBqU,IAJG,SAIE/nB,GACD/D,KAAKyX,OAAS1T,EACd/D,KAAKi7C,cAAcgX,EAAeC,MAClClyD,KAAKk7C,aAAerB,EAAWkC,iBAavC7jC,OACIyQ,IADG,WAEC,OAAO3oB,KAAK0X,QAEhBoU,IAJG,SAIE/nB,GACD/D,KAAK0X,OAAS3T,EACd/D,KAAKi7C,cAAcgX,EAAeC,MAClClyD,KAAKk7C,aAAerB,EAAWkC,iBAYvCxgC,SACIoN,IADK,WAED,OAAO3oB,KAAKk1D,UAEhBppC,IAJK,SAIA/nB,GACG/D,KAAKk1D,WAAanxD,IAClB/D,KAAKk1D,SAAWnxD,EAChB/D,KAAKk7C,aAAerB,EAAWoc,aAAepc,EAAWqc,aAGjEC,OAAQ,EAAG,MAWf35C,OACImM,IADG,WAEC,OAAO3oB,KAAKm1D,OAAO90D,SAEvByrB,IAJG,SAIE/nB,GACI/D,KAAKm1D,OAAOiB,OAAOryD,KACpB/D,KAAKm1D,OAAOrpC,IAAI/nB,GAKZ/D,KAAKk4C,mBACLl4C,KAAKk7C,aAAerB,EAAWqc,YAx4BtC,GA24BOl2D,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUwZ,cAAelvD,MAcnDq0C,SACIzvB,IADK,WAED,OAAO3oB,KAAKs1D,aAAah2D,GAE7BwsB,IAJK,SAIA/nB,GACD,IAAIsyD,EAAcr2D,KAAKs1D,aACnBe,EAAY/2D,IAAMyE,IAClBsyD,EAAY/2D,EAAIyE,EAl6BlB,GAm6BM/D,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUuZ,mBAcpC3a,SACI1vB,IADK,WAED,OAAO3oB,KAAKs1D,aAAa5xD,GAE7BooB,IAJK,SAIA/nB,GACD,IAAIsyD,EAAcr2D,KAAKs1D,aACnBe,EAAY3yD,IAAMK,IAClBsyD,EAAY3yD,EAAIK,EAz7BlB,GA07BM/D,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUuZ,mBAcpCrvD,OACIglB,IADG,WAEC,OAAO3oB,KAAKo1D,aAAazxD,OAE7BmoB,IAJG,SAIE/nB,GACGA,IAAU/D,KAAKo1D,aAAazxD,QAI5B3D,KAAKo1D,aAAazxD,MAAQI,EAn9B9B,EAo9BQ/D,KAAKo7C,YAKDp7C,KAAK0tB,KAAK+rB,EAAUsZ,iBAexCnvD,QACI+kB,IADI,WAEA,OAAO3oB,KAAKo1D,aAAaxxD,QAE7BkoB,IAJI,SAIC/nB,GACGA,IAAU/D,KAAKo1D,aAAaxxD,SAI5B5D,KAAKo1D,aAAaxxD,OAASG,EAj/B/B,EAk/BQ/D,KAAKo7C,YAKDp7C,KAAK0tB,KAAK+rB,EAAUsZ,iBAwBxCxU,QACI51B,IADI,WAEA,OAAO3oB,KAAKy1D,SAEhB3pC,IAJI,SAIC/nB,GACGA,EAAQ8D,EAAMyuD,YACd12D,GAAGu+B,OAAO,MACVp6B,EAAQ8D,EAAMyuD,YAETvyD,EAAQ8D,EAAM0uD,aACnB32D,GAAGu+B,OAAO,MACVp6B,EAAQ8D,EAAM0uD,YAGdv2D,KAAKy1D,UAAY1xD,IACjB/D,KAAKy1D,QAAU1xD,EACf/D,KAAKu1D,aAAoC,MAApBv1D,KAAKu1D,aAA8BxxD,GAAS,GAE7D/D,KAAK66C,SACL76C,KAAK66C,QAAQ2b,iBAWjCz2D,KA3lBc,WA4lBVC,KAAKy2D,oBAAqB,EAG1Bz2D,KAAK02D,QAAU,KAEf12D,KAAKk4C,iBAAmB,KAExBl4C,KAAKg1D,oBAAsB,KAC3Bh1D,KAAK+0D,mBAAqB,KAE1B/0D,KAAK22D,eAAiB,KAEtB32D,KAAKs0D,eAAiB,KAGtBt0D,KAAKs6C,OAAOh7C,EAAI,EAChBU,KAAKs6C,OAAO52C,EAAI,EAChB1D,KAAKs6C,OAAOlR,EAAI,EAEhBppC,KAAKm6C,QAAU+W,EAAUrrB,KAAKld,MAC9B3oB,KAAK+6C,aAAemW,EAAUrrB,KAAKld,MACnC3oB,KAAKk6C,eAAiB+X,EAAe7V,IACrCp8C,KAAK06C,gBAAiB,EAEtB16C,KAAKo7C,WAAa,EAClBp7C,KAAK42D,aAAe,GAAK52D,KAAK01D,WAE9B11D,KAAK61D,aAAej2D,GAAGyW,MAG3ByS,SACI2wB,UAAAA,EACAE,gBAAiBsY,EAEjBnG,OAJK,SAIG+K,GACJ,OAAOA,aAAetzC,IAASszC,EAAI/3C,cAAgByE,KAAUszC,aAAej3D,GAAGukD,SAGnF4N,kBAAAA,GAKJ+E,uBAvoBc,SAuoBUz1C,GAKpB,IAHA,IAEkC01C,EAF9BpyD,EAAS3E,KAAK66C,QACdmc,EAAWryD,EAAOsyD,UAClB13D,EAAI,EAAGwuB,EAAMipC,EAASx3D,OACnBD,EAAIwuB,EAAKxuB,KACZw3D,EAAUC,EAASz3D,IACX23D,wBACR1W,EAAa2W,iBAAiBJ,GAElCpyD,EAAO6xD,cAGXY,cAppBc,WAqpBYp3D,KAAKq3D,oBAGvB/F,GACA1xD,GAAG+e,SAASqpC,mBAAmBjoC,2BAA2B/f,MAI1DwzD,IAAoBxzD,OACpBwzD,EAAkB,OAIlBxzD,KAAK22D,gBAAkB32D,KAAKs0D,kBAC5B9T,EAAa8W,gBAAgBt3D,MACzBA,KAAK22D,iBACL32D,KAAK22D,eAAe/C,MAAQ,KAC5B5zD,KAAK22D,eAAeY,KAAO,KAC3Bv3D,KAAK22D,eAAiB,MAEtB32D,KAAKs0D,iBACLt0D,KAAKs0D,eAAeV,MAAQ,KAC5B5zD,KAAKs0D,eAAeiD,KAAO,KAC3Bv3D,KAAKs0D,eAAiB,OAK9BpD,EAAUrrB,KAAK2xB,IAAIx3D,KAAKm6C,SACxB+W,EAAUrrB,KAAK2xB,IAAIx3D,KAAK+6C,cACxB/6C,KAAKm6C,QAAUn6C,KAAK+6C,aAAe,KAE/B/6C,KAAKy2D,oBACL72D,GAAG+e,SAASmqC,UAAUlpD,GAAG8gD,SAAS8E,mBAAoBxlD,KAAKy3D,gBAAiBz3D,OAYpF03D,iBAlsBc,SAksBIC,GACd,IAAIzP,EAAgBoJ,EAAqB1xD,GAAG+e,SAASqpC,mBAAqB,KAC1E,GAAI2P,EAMA,GAJA33D,KAAKk7C,aAAerB,EAAWsB,qBAE/B+M,GAAiBA,EAAcvnC,aAAa3gB,MAC5CwgD,EAAa7/B,aAAa3gB,MACtBA,KAAK22D,eAAgB,CACrB,IAAIY,EAAOv3D,KAAK22D,eAAeY,KAAO7C,EAAoB10D,MACtDA,KAAKs0D,iBACLt0D,KAAKs0D,eAAeiD,KAAOA,QAG1Bv3D,KAAKs0D,iBACVt0D,KAAKs0D,eAAeiD,KAAO7C,EAAoB10D,YAKnDkoD,GAAiBA,EAAcxnC,YAAY1gB,MAC3CwgD,EAAa9/B,YAAY1gB,OAIjC43D,oBA3tBc,SA2tBOC,GACjB73D,KAAKk3D,wBACDl3D,KAAK66C,SACL76C,KAAK66C,QAAQ2b,aAEjBx2D,KAAKk7C,aAAerB,EAAWsB,qBAC/Bn7C,KAAK83D,wBAAwBD,GACzBj4D,GAAGwiD,iBACHxiD,GAAGwiD,eAAe2V,kBAAmB,IAM7CC,SAzuBc,WA0uBV,GAAIh4D,KAAKi4D,SACLj4D,KAAKoyC,MAAMmK,QAAQv8C,KAAK61D,kBAEvB,CACD,IAAIzsB,EAAI/jC,KAAKotB,KAAKzyB,KAAKoyC,MAAMhJ,GAAK0Q,EAAa,EAC/CF,EAAKvY,KAAKvV,IAAI9rB,KAAK61D,aAAc,EAAG,EAAGzsB,KAG/C0sB,WAlvBc,WAmvBN91D,KAAKi4D,SACLj4D,KAAKoyC,MAAMR,UAAU5xC,KAAK61D,cAG1Bjc,EAAKrP,KAAKqH,UAAU5xC,KAAKoyC,MAAO,EAAG,EAAGpyC,KAAK61D,aAAazsB,IAIhEsS,kBA3vBc,gBA8vBWr1C,IAAjBrG,KAAK0a,UACL1a,KAAKs6C,OAAOh7C,EAAIU,KAAK0a,QACrB1a,KAAK0a,aAAUrU,QAEEA,IAAjBrG,KAAK2a,UACL3a,KAAKs6C,OAAO52C,EAAI1D,KAAK2a,QACrB3a,KAAK2a,aAAUtU,GAGO,IAAtBrG,KAAKu1D,eACLv1D,KAAKy1D,SAA+B,WAApBz1D,KAAKu1D,eAA8B,IAMvD,IAAIhrB,EAAOvqC,KAAKoyC,OACXpyC,KAAKk4D,YAAcl4D,KAAKm4D,aACb,IAAX5tB,EAAKjrC,GAAsB,IAAXirC,EAAK7mC,GAAsB,IAAX6mC,EAAKnB,GAAsB,IAAXmB,EAAK+I,IAClDtzC,KAAKk4D,aAAel4D,KAAKm4D,WACzBve,EAAKrP,KAAKqH,UAAUrH,EAAM,EAAG,GAAIvqC,KAAKk4D,YAGtCte,EAAKrP,KAAKqH,UAAUrH,EAAMvqC,KAAKk4D,WAAYl4D,KAAKm4D,WAAY,GAEhEn4D,KAAKk4D,WAAal4D,KAAKm4D,gBAAa9xD,GAGxCrG,KAAKg4D,WAIDh4D,KAAKm1D,OAAOpsD,EAAI,KAAyB,MAAlB/I,KAAKk1D,WAC5Bl1D,KAAKk1D,SAAWl1D,KAAKm1D,OAAOpsD,EAC5B/I,KAAKm1D,OAAOpsD,EAAI,MAOxBqvD,gBAvyBc,WAwyBVp4D,KAAK07C,oBAEL17C,KAAKk3D,wBAEL,IAAImB,EAAar4D,KAAKs4D,QAClBD,GAAcA,EAAWE,MAAQF,EAAW31C,OAAS1iB,MAKrDixD,EAAauH,eAAex4D,MAG3BA,KAAKy4D,qBAEFnH,GACA1xD,GAAG+e,SAASqpC,mBAAmBtnC,YAAY1gB,MAE/CwgD,EAAa9/B,YAAY1gB,OAI7B,IADA,IAAI0kC,EAAW1kC,KAAKi3D,UACX13D,EAAI,EAAGwuB,EAAM2W,EAASllC,OAAQD,EAAIwuB,EAAKxuB,IAC5CmlC,EAASnlC,GAAG64D,kBAGZ1zB,EAASllC,OAAS,IAClBQ,KAAKk7C,aAAerB,EAAW6e,gBAKvCC,iBAx0Bc,WA20BV,GAFA34D,KAAK07C,qBAEA17C,KAAKy4D,mBAAoB,CAI1B,IAAIG,EAAUh5D,GAAG+e,SAASqpC,mBAC1B4Q,GAAWA,EAAQl4C,YAAY1gB,MAE/BwgD,EAAa9/B,YAAY1gB,MAI7B,IADA,IAAI0kC,EAAW1kC,KAAKi3D,UACX13D,EAAI,EAAGwuB,EAAM2W,EAASllC,OAAQD,EAAIwuB,EAAKxuB,IAC5CmlC,EAASnlC,GAAGo5D,mBAGZj0B,EAASllC,OAAS,IAClBQ,KAAKk7C,aAAerB,EAAW6e,gBAMvCG,qBAj2Bc,SAi2BQnwC,GAClB,IAAIowC,GAAW,EACXC,GAAc,EA0ClB,OAzCoC,IAAhCzF,EAAa3vC,QAAQ+E,IAChB1oB,KAAK22D,iBACN32D,KAAK22D,eAAiB/2D,GAAGo5D,cAAclsB,QACnC5gB,MAAOtsB,GAAGo5D,cAAcC,iBACxBC,gBAAgB,EAChBtF,MAAO5zD,KACPu3D,KAAM7C,EAAoB10D,MAC1Bm5D,aAAc1F,EACd2F,aAAcpF,EACdqF,aAAcpF,EACdqF,iBAAkBpF,IAEtB1T,EAAa+Y,YAAYv5D,KAAK22D,eAAgB32D,MAC9C84D,GAAW,GAEfC,GAAc,IAEuB,IAAhCxF,EAAa5vC,QAAQ+E,KACrB1oB,KAAKs0D,iBACNt0D,KAAKs0D,eAAiB10D,GAAGo5D,cAAclsB,QACnC5gB,MAAOtsB,GAAGo5D,cAAcQ,MACxBnF,aAAa,EACbT,MAAO5zD,KACPu3D,KAAM7C,EAAoB10D,MAC1By5D,YAAatF,EACbuF,YAAatF,EACbuF,UAAWnF,EACXoF,cAAenF,IAEnBjU,EAAa+Y,YAAYv5D,KAAKs0D,eAAgBt0D,MAC9C84D,GAAW,GAEfC,GAAc,GAEdD,IAAa94D,KAAKy4D,oBAClB74D,GAAG+e,SAASwC,eAAe04C,SAAS,WAC3B75D,KAAKy4D,oBACNjY,EAAa9/B,YAAY1gB,OAE9BA,KAAM,EAAG,EAAG,GAAG,GAEf+4D,GAiDX7qC,GA97Bc,SA87BVxF,EAAMyF,EAAUjuB,EAAQ45D,GAExB,GADkB95D,KAAK64D,qBAAqBnwC,GAExC,OAAO1oB,KAAK+5D,YAAYrxC,EAAMyF,EAAUjuB,EAAQ45D,GAGhD,OAAQpxC,GACJ,KAAK+wB,EAAU4B,iBACfr7C,KAAKo7C,YA35CD,EA45CJ,MACA,KAAK3B,EAAUuC,cACfh8C,KAAKo7C,YA75CJ,EA85CD,MACA,KAAK3B,EAAUqZ,iBACf9yD,KAAKo7C,YA/5CD,EAg6CJ,MACA,KAAK3B,EAAUsZ,aACf/yD,KAAKo7C,YAj6CL,EAk6CA,MACA,KAAK3B,EAAUuZ,eACfhzD,KAAKo7C,YAn6CH,GAo6CF,MACA,KAAK3B,EAAUwZ,cACfjzD,KAAKo7C,YAr6CJ,GA26CL,OAHKp7C,KAAK+0D,qBACN/0D,KAAK+0D,mBAAqB,IAAIn9B,GAE3B53B,KAAK+0D,mBAAmB7mC,GAAGxF,EAAMyF,EAAUjuB,IA0B1DkuB,KAr/Bc,SAq/BR1F,EAAMyF,EAAUjuB,EAAQ45D,GAAY,IAAAzrC,EAAAruB,KAClC+4D,EAAc/4D,KAAK64D,qBAAqBnwC,GACxCsxC,EAA4B,eAAiBtxC,EAE7CuxC,EAAY,MAEZA,EADAlB,GAAee,EACH95D,KAAKg1D,oBAAsBh1D,KAAKg1D,qBAAuB,IAAIp9B,EAG3D53B,KAAK+0D,mBAAqB/0D,KAAK+0D,oBAAsB,IAAIn9B,GAGzClJ,iBAAiBsrC,EAA2B7rC,EAAUjuB,IAChE,WAClB,IAAIquB,EAAAF,EACA6rC,EAAc,SAAU1J,EAAMC,EAAMC,EAAMC,EAAMwJ,GAChD5rC,EAAKE,IAAI/F,EAAMwxC,EAAah6D,GAC5B+5D,EAAUlR,OAAOiR,EAA2B7rC,EAAUjuB,GACtDiuB,EAAS5rB,KAAKvC,KAAMwwD,EAAMC,EAAMC,EAAMC,EAAMwJ,IAEhD9rC,EAAKH,GAAGxF,EAAMwxC,EAAah6D,GAC3B+5D,EAAUp1D,IAAIm1D,EAA2B7rC,EAAUjuB,GARjC,IAY1B65D,YA9gCc,SA8gCDrxC,EAAMyF,EAAUjuB,EAAQ45D,GAOjC,GALsB,kBAAX55D,GACP45D,EAAa55D,EACbA,OAASmG,GAERyzD,IAAeA,EACf3rC,EAAL,CAKA,IAAI8rC,EAAY,KAehB,OAbIA,EADAH,EACY95D,KAAKg1D,oBAAsBh1D,KAAKg1D,qBAAuB,IAAIp9B,EAG3D53B,KAAK+0D,mBAAqB/0D,KAAK+0D,oBAAsB,IAAIn9B,GAGzDlJ,iBAAiBhG,EAAMyF,EAAUjuB,KAC7C+5D,EAAUp1D,IAAI6jB,EAAMyF,EAAUjuB,GAE1BA,GAAUA,EAAOk6D,gBACjBl6D,EAAOk6D,eAAe10D,KAAK1F,OAG5BmuB,EAnBHvuB,GAAGyC,QAAQ,OAqCnBosB,IA3jCc,SA2jCT/F,EAAMyF,EAAUjuB,EAAQ45D,GACzB,IAAIO,GAA6C,IAAhC/G,EAAa3vC,QAAQ+E,GAClC4xC,GAAcD,IAA8C,IAAhC9G,EAAa5vC,QAAQ+E,GACrD,GAAI2xC,GAAcC,EACdt6D,KAAKu6D,aAAa7xC,EAAMyF,EAAUjuB,EAAQ45D,GAEtCO,EACIr6D,KAAK22D,iBAAmB9B,EAAgB70D,KAAMszD,KAC9C9S,EAAaga,eAAex6D,KAAK22D,gBACjC32D,KAAK22D,eAAiB,MAGrB2D,GACDt6D,KAAKs0D,iBAAmBO,EAAgB70D,KAAMuzD,KAC9C/S,EAAaga,eAAex6D,KAAKs0D,gBACjCt0D,KAAKs0D,eAAiB,WAI7B,GAAIt0D,KAAK+0D,mBAAoB,CAK9B,GAJA/0D,KAAK+0D,mBAAmBtmC,IAAI/F,EAAMyF,EAAUjuB,IAEzBF,KAAK+0D,mBAAmBrmC,iBAAiBhG,GAGxD,OAAQA,GACJ,KAAK+wB,EAAU4B,iBACfr7C,KAAKo7C,aAAc,EACnB,MACA,KAAK3B,EAAUuC,cACfh8C,KAAKo7C,aAAc,EACnB,MACA,KAAK3B,EAAUqZ,iBACf9yD,KAAKo7C,aAAc,EACnB,MACA,KAAK3B,EAAUsZ,aACf/yD,KAAKo7C,aAAc,EACnB,MACA,KAAK3B,EAAUuZ,eACfhzD,KAAKo7C,aAAc,GACnB,MACA,KAAK3B,EAAUwZ,cACfjzD,KAAKo7C,aAAc,MAOnCmf,aA5mCc,SA4mCA7xC,EAAMyF,EAAUjuB,EAAQ45D,GAOlC,GALsB,kBAAX55D,GACP45D,EAAa55D,EACbA,OAASmG,GAERyzD,IAAeA,EACf3rC,EAIA,CACD,IAAI8rC,EAAYH,EAAa95D,KAAKg1D,oBAAsBh1D,KAAK+0D,mBACzDkF,IACAA,EAAUlR,OAAOrgC,EAAMyF,EAAUjuB,GAE7BA,GAAUA,EAAOk6D,gBACjB/7C,EAAGiE,MAAMm4C,WAAWv6D,EAAOk6D,eAAgBp6D,YATnDA,KAAKg1D,qBAAuBh1D,KAAKg1D,oBAAoB0F,UAAUhyC,GAC/D1oB,KAAK+0D,oBAAsB/0D,KAAK+0D,mBAAmB2F,UAAUhyC,IAuBrEiyC,UA5oCc,SA4oCHz6D,GACP,IAAI+5D,EAAYj6D,KAAK+0D,mBACjBkF,IACAA,EAAUU,UAAUz6D,GApmDZ,EAumDHF,KAAKo7C,aAA8B6e,EAAUvrC,iBAAiB+qB,EAAU4B,oBACzEr7C,KAAKo7C,aAAc,GAvmDlB,EAymDAp7C,KAAKo7C,aAA2B6e,EAAUvrC,iBAAiB+qB,EAAUuC,iBACtEh8C,KAAKo7C,aAAc,GAzmDf,EA2mDHp7C,KAAKo7C,aAA8B6e,EAAUvrC,iBAAiB+qB,EAAUqZ,oBACzE9yD,KAAKo7C,aAAc,GA3mDnB,EA6mDCp7C,KAAKo7C,aAA0B6e,EAAUvrC,iBAAiB+qB,EAAUsZ,gBACrE/yD,KAAKo7C,aAAc,GA7mDjB,GA+mDDp7C,KAAKo7C,aAA4B6e,EAAUvrC,iBAAiB+qB,EAAUuZ,kBACvEhzD,KAAKo7C,aAAc,IA/mDlB,GAinDAp7C,KAAKo7C,aAA2B6e,EAAUvrC,iBAAiB+qB,EAAUwZ,iBACtEjzD,KAAKo7C,aAAc,KAGvBp7C,KAAKg1D,qBACLh1D,KAAKg1D,oBAAoB2F,UAAUz6D,GAGnCF,KAAK22D,iBAAmB9B,EAAgB70D,KAAMszD,KAC9C9S,EAAaga,eAAex6D,KAAK22D,gBACjC32D,KAAK22D,eAAiB,MAEtB32D,KAAKs0D,iBAAmBO,EAAgB70D,KAAMuzD,KAC9C/S,EAAaga,eAAex6D,KAAKs0D,gBACjCt0D,KAAKs0D,eAAiB,OAW9B5lC,iBA1rCc,SA0rCIhG,GACd,IAAIkyC,GAAM,EAOV,OANI56D,KAAK+0D,qBACL6F,EAAM56D,KAAK+0D,mBAAmBrmC,iBAAiBhG,KAE9CkyC,GAAO56D,KAAKg1D,sBACb4F,EAAM56D,KAAKg1D,oBAAoBtmC,iBAAiBhG,IAE7CkyC,GAqBXltC,KAvtCc,SAutCRhF,EAAM8nC,EAAMC,EAAMC,EAAMC,EAAMwJ,GAC5Bn6D,KAAK+0D,oBACL/0D,KAAK+0D,mBAAmBrnC,KAAKhF,EAAM8nC,EAAMC,EAAMC,EAAMC,EAAMwJ,IAanEpG,cAtuCc,SAsuCC7nC,IAzyCnB,SAA2B0nC,EAAO1nC,GAC9B,IAAIhsB,EAAQX,EAQZ,IAPA2sB,EAAMhsB,OAAS0zD,EAGf9B,EAAatyD,OAAS,EACtBo0D,EAAMiH,qBAAqB3uC,EAAMxD,KAAMopC,GAEvC5lC,EAAM4uC,WAAa,EACdv7D,EAAIuyD,EAAatyD,OAAS,EAAGD,GAAK,IAAKA,EAExC,IADAW,EAAS4xD,EAAavyD,IACXy1D,sBACP9oC,EAAM6uC,cAAgB76D,EAEtBA,EAAO80D,oBAAoBtnC,KAAKxB,EAAMxD,KAAMwD,EAAO4lC,GAE/C5lC,EAAM8uC,qBAEN,YADAlJ,EAAatyD,OAAS,GAkBlC,GAbAsyD,EAAatyD,OAAS,EAItB0sB,EAAM4uC,WAAa,EACnB5uC,EAAM6uC,cAAgBnH,EAClBA,EAAMoB,qBACNpB,EAAMoB,oBAAoBtnC,KAAKxB,EAAMxD,KAAMwD,IAE1CA,EAAM+uC,8BAAgCrH,EAAMmB,oBAC7CnB,EAAMmB,mBAAmBrnC,KAAKxB,EAAMxD,KAAMwD,IAGzCA,EAAM8uC,qBAAuB9uC,EAAM4nC,QAKpC,IAHAF,EAAMsH,oBAAoBhvC,EAAMxD,KAAMopC,GAEtC5lC,EAAM4uC,WAAa,EACdv7D,EAAI,EAAGA,EAAIuyD,EAAatyD,SAAUD,EAEnC,IADAW,EAAS4xD,EAAavyD,IACXw1D,qBACP7oC,EAAM6uC,cAAgB76D,EAEtBA,EAAO60D,mBAAmBrnC,KAAKxB,EAAMxD,KAAMwD,GAEvCA,EAAM8uC,qBAEN,YADAlJ,EAAatyD,OAAS,GAMtCsyD,EAAatyD,OAAS,GAovClB27D,CAAiBn7D,KAAMksB,GACvB4lC,EAAatyD,OAAS,GAe1B47D,kBAvvCc,SAuvCKC,GACf7a,EAAa9/B,YAAY1gB,KAAMq7D,IAenCC,mBAvwCc,SAuwCMD,GAChB7a,EAAa7/B,aAAa3gB,KAAMq7D,IAGpCxH,SA3wCc,SA2wCJ0H,EAAOC,GACb,IAAIloB,EAAItzC,KAAKo1D,aAAazxD,MACtB4vC,EAAIvzC,KAAKo1D,aAAaxxD,OACtB63D,EAAWjK,EACXkK,EAASjK,EAETkK,EAAS/7D,GAAGsnD,OAAO0U,WAAW57D,MAclC,GAbI27D,EACAA,EAAOE,sBAAsBN,EAAOE,GAGpCA,EAAS3vC,IAAIyvC,GAGjBv7D,KAAK87D,qBACLliB,EAAK/T,KAAKoS,OAAOyZ,EAAY1xD,KAAK+6C,cAClCnB,EAAKmiB,KAAKloB,cAAc6nB,EAAQD,EAAU/J,GAC1CgK,EAAOp8D,GAAKU,KAAKs1D,aAAah2D,EAAIg0C,EAClCooB,EAAOh4D,GAAK1D,KAAKs1D,aAAa5xD,EAAI6vC,EAE9BmoB,EAAOp8D,GAAK,GAAKo8D,EAAOh4D,GAAK,GAAKg4D,EAAOp8D,GAAKg0C,GAAKooB,EAAOh4D,GAAK6vC,EAAG,CAClE,GAAIioB,GAAYA,EAASjE,KAAM,CAG3B,IAFA,IAAIA,EAAOiE,EAASjE,KAChB5yD,EAAS3E,KACJT,EAAI,EAAGoF,GAAUpF,EAAIg4D,EAAKl2C,QAAS9hB,EAAGoF,EAASA,EAAOA,QAG/D,GAAIA,IAAW4yD,EAAK9yB,KAAM,CACtB,IAAIhf,EAAO9gB,EAAO+gB,aAAa9lB,GAAG+0D,MAClC,OAAQlvC,IAAQA,EAAKu2C,oBAAsBv2C,EAAKouC,SAAS4H,GAKzD,OADAD,EAASjE,KAAO,MACT,EAIX,OAAO,EAIX,OAAO,GAgBfsD,qBAr0Cc,SAq0CQnyC,EAAMpG,GAExB,IADA,IAAI3d,EAAS3E,KAAK2E,OACXA,GACCA,EAAOqwD,qBAAuBrwD,EAAOqwD,oBAAoBtmC,iBAAiBhG,IAC1EpG,EAAM5c,KAAKf,GAEfA,EAASA,EAAOA,QAexBu2D,oBA11Cc,SA01COxyC,EAAMpG,GAEvB,IADA,IAAI3d,EAAS3E,KAAK2E,OACXA,GACCA,EAAOowD,oBAAsBpwD,EAAOowD,mBAAmBrmC,iBAAiBhG,IACxEpG,EAAM5c,KAAKf,GAEfA,EAASA,EAAOA,QAyBxBs3D,UAAW3K,EAAqB,SAAUhxD,GACtC,GAAKN,KAAK23D,OAKV,OAHA/3D,GAAGygB,SAAS/f,EAAQ,MAEpBV,GAAG+e,SAASqpC,mBAAmBroC,UAAUrf,EAAQN,MAAM,GAChDM,GACPixD,EASJ2K,gBAAiB5K,EAAqB,WAClC1xD,GAAG+e,SAASqpC,mBAAmBtnC,YAAY1gB,OAC3CuxD,EASJ4K,iBAAkB7K,EAAqB,WACnC1xD,GAAG+e,SAASqpC,mBAAmBrnC,aAAa3gB,OAC5CuxD,EASJ6K,eAAgB9K,EAAqB,WACjC1xD,GAAG+e,SAASqpC,mBAAmBjoC,2BAA2B/f,OAC1DuxD,EAWJ8K,WAAY/K,EAAqB,SAAUhxD,GACvCV,GAAG+e,SAASqpC,mBAAmB9nC,aAAa5f,IAC5CixD,EAUJ+K,gBAAiBhL,EAAqB,SAAUnxD,GACxCA,IAAQP,GAAGC,OAAOO,YAItBR,GAAG+e,SAASqpC,mBAAmB5nC,kBAAkBjgB,EAAKH,MAHlDJ,GAAGgB,MAAM,OAIb2wD,EAYJ/wC,eAAgB8wC,EAAqB,SAAUnxD,GAC3C,OAAIA,IAAQP,GAAGC,OAAOO,aAClBR,GAAGgB,MAAM,MACF,MAEJhB,GAAG+e,SAASqpC,mBAAmBxnC,eAAergB,EAAKH,OAC1D,WACA,OAAO,MAqBXu8D,0BAA2BjL,EAAqB,WAC5C,OAAO1xD,GAAG+e,SAASqpC,mBAAmBvnC,kCAAkCzgB,OACxE,WACA,OAAO,GAkBXq8C,YA3/Cc,SA2/CD5nB,GAET,OADAA,EAAMA,GAAO70B,GAAGyW,MACLyV,IAAI9rB,KAAKq6C,YAsBxBv1C,YAnhDc,SAmhDDk2C,EAAWt3C,GACpB,IAAIpE,OACM+G,IAAN3C,GACApE,EAAI07C,EAAU17C,EACdoE,EAAIs3C,EAAUt3C,GAGdpE,EAAI07C,EAGR,IAAIwhB,EAAcx8D,KAAKq6C,UACnBmiB,EAAYl9D,IAAMA,GAAKk9D,EAAY94D,IAAMA,IAQzC84D,EAAYl9D,EAAIA,EAMhBk9D,EAAY94D,EAAIA,EAKpB1D,KAAKi7C,cAAcgX,EAAelvB,UAClC/iC,KAAKk7C,aAAerB,EAAWsB,qBAvgEnB,EA0gERn7C,KAAKo7C,YAMDp7C,KAAK0tB,KAAK+rB,EAAU4B,oBAgBhCohB,SA3kDc,SA2kDJhoC,GACN,YAAYpuB,IAARouB,EACOA,EAAI3I,IAAI9rB,KAAKs6C,SAGpB16C,GAAGu+B,OAAO,KAAM,mBAAoB,8CAC7Bn+B,KAAKs6C,OAAOh7C,IAoB3Bu8C,SArmDc,SAqmDJv8C,EAAGoE,GACLpE,GAAkB,iBAANA,GACZoE,EAAIpE,EAAEoE,EACNpE,EAAIA,EAAEA,QAEK+G,IAAN3C,IACLA,EAAIpE,GAEJU,KAAKs6C,OAAOh7C,IAAMA,GAAKU,KAAKs6C,OAAO52C,IAAMA,IACzC1D,KAAKs6C,OAAOh7C,EAAIA,EAChBU,KAAKs6C,OAAO52C,EAAIA,EAChB1D,KAAKi7C,cAAcgX,EAAenW,OAClC97C,KAAKk7C,aAAerB,EAAWkC,eArkE1B,EAukED/7C,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUuC,iBAehC0gB,YAnoDc,SAmoDDjoC,GACT,OAAIA,aAAe70B,GAAG8xC,KACXjd,EAAI3I,IAAI9rB,KAAKoyC,QAGpBxyC,GAAGu+B,OAAO,KAAM,sBAAuB,kDAC/Bn+B,KAAKgW,QAarB87B,YAtpDc,SAspDDvH,EAAM7mC,EAAG0lC,EAAGkK,GACrB,GAAoB,iBAAT/I,QAA2BlkC,IAAN3C,EAC5B9D,GAAGu+B,OAAO,KAAM,8BAA+B,8CAC/Cn+B,KAAKgW,OAASu0B,MAEb,CACD,IAAIjrC,EAAIirC,OACElkC,IAAN3C,IACApE,EAAIirC,EAAKjrC,EACToE,EAAI6mC,EAAK7mC,EACT0lC,EAAImB,EAAKnB,EACTkK,EAAI/I,EAAK+I,GAGb,IAAIqpB,EAAM38D,KAAKoyC,MACXuqB,EAAIr9D,IAAMA,GAAKq9D,EAAIj5D,IAAMA,GAAKi5D,EAAIvzB,IAAMA,GAAKuzB,EAAIrpB,IAAMA,IACvDqpB,EAAIr9D,EAAIA,EACRq9D,EAAIj5D,EAAIA,EACRi5D,EAAIvzB,EAAIA,EACRuzB,EAAIrpB,EAAIA,EACRtzC,KAAKi7C,cAAcgX,EAAezV,UAClCx8C,KAAKk7C,aAAerB,EAAWkC,eA9nE3B,EAgoEA/7C,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUqZ,qBAqBpC8J,eAnsDc,WAosDV,OAAOh9D,GAAGqvC,KAAKjvC,KAAKo1D,aAAazxD,MAAO3D,KAAKo1D,aAAaxxD,SAgB9Di5D,eAptDc,SAotDE5tB,EAAMrrC,GAClB,IAAIk5D,EAAiB98D,KAAKo1D,aAE1B,QAAe/uD,IAAXzC,EAAsB,CACtB,GAAKqrC,EAAKtrC,QAAUm5D,EAAen5D,OAAWsrC,EAAKrrC,SAAWk5D,EAAel5D,OACzE,OACA+nC,EAGJmxB,EAAen5D,MAAQsrC,EAAKtrC,MAC5Bm5D,EAAel5D,OAASqrC,EAAKrrC,WAC1B,CACH,GAAKqrC,IAAS6tB,EAAen5D,OAAWC,IAAWk5D,EAAel5D,OAC9D,OACA+nC,EAGJmxB,EAAen5D,MAAQsrC,EACvB6tB,EAAel5D,OAASA,EAxrEpB,EA0rEJ5D,KAAKo7C,YAKDp7C,KAAK0tB,KAAK+rB,EAAUsZ,eAyBhCgK,eAtwDc,WAuwDV,OAAOn9D,GAAGqE,GAAGjE,KAAKs1D,eAyBtB0H,eAhyDc,SAgyDEzB,EAAO73D,GACnB,IAAIu5D,EAAiBj9D,KAAKs1D,aAC1B,QAAUjvD,IAAN3C,EAAiB,CACjB,GAAK63D,EAAMj8D,IAAM29D,EAAe39D,GAAOi8D,EAAM73D,IAAMu5D,EAAev5D,EAC9D,OACJu5D,EAAe39D,EAAIi8D,EAAMj8D,EACzB29D,EAAev5D,EAAI63D,EAAM73D,MACtB,CACH,GAAK63D,IAAU0B,EAAe39D,GAAOoE,IAAMu5D,EAAev5D,EACtD,OACJu5D,EAAe39D,EAAIi8D,EACnB0B,EAAev5D,EAAIA,EAEvB1D,KAAKi7C,cAAcgX,EAAelvB,UA9vExB,GA+vEN/iC,KAAKo7C,YACLp7C,KAAK0tB,KAAK+rB,EAAUuZ,iBAU5BkK,mBAzzDc,SAyzDMzoC,EAAKrvB,GAkBrB,OAjBIpF,KAAK66C,QACL76C,KAAK66C,QAAQqiB,mBAAmBzoC,EAAKrvB,GAErCw0C,EAAKvY,KAAK6S,KAAKzf,EAAKrvB,GAIxBw0C,EAAKvY,KAAK58B,IAAIgwB,EAAKA,EAAKz0B,KAAKq6C,WAG7BT,EAAKrP,KAAK4yB,UAAUvL,EAAY5xD,KAAKoyC,OACrCwH,EAAKvY,KAAK+7B,cAAc3oC,EAAKA,EAAKm9B,GAGlChY,EAAKvY,KAAKg8B,YAAY1L,EAAY3xD,KAAKs6C,QACvCV,EAAKvY,KAAKn9B,IAAIuwB,EAAKA,EAAKk9B,GAEjBl9B,GAUX6oC,iBAr1Dc,SAq1DI7oC,GACdmlB,EAAKvY,KAAK6S,KAAKzf,EAAKz0B,KAAKq6C,WAEzB,IADA,IAAIua,EAAO50D,KAAK66C,QACT+Z,GAEHhb,EAAKvY,KAAKn9B,IAAIuwB,EAAKA,EAAKmgC,EAAKta,QAE7BV,EAAKvY,KAAK+7B,cAAc3oC,EAAKA,EAAKmgC,EAAKxiB,OAEvCwH,EAAKvY,KAAKx8B,IAAI4vB,EAAKA,EAAKmgC,EAAKva,WAC7Bua,EAAOA,EAAK/Z,QAEhB,OAAOpmB,GASX8oC,iBA12Dc,SA02DIn4D,GAKVpF,KAAK66C,QACL76C,KAAK66C,QAAQqiB,mBAAmBl9D,KAAKq6C,UAAWj1C,GAGhDw0C,EAAKvY,KAAK6S,KAAKl0C,KAAKq6C,UAAWj1C,GAEnCpF,KAAKi7C,cAAcgX,EAAelvB,UA10EtB,EA60ER/iC,KAAKo7C,YAMDp7C,KAAK0tB,KAAK+rB,EAAU4B,mBAYhCmiB,iBA14Dc,SA04DI/oC,GACdmlB,EAAKrP,KAAK2J,KAAKzf,EAAKz0B,KAAKoyC,OAEzB,IADA,IAAIwiB,EAAO50D,KAAK66C,QACT+Z,GACHhb,EAAKrP,KAAKrmC,IAAIuwB,EAAKmgC,EAAKxiB,MAAO3d,GAC/BmgC,EAAOA,EAAK/Z,QAEhB,OAAOpmB,GASXgpC,iBA15Dc,SA05DIlzB,GACVvqC,KAAK66C,SACL76C,KAAK66C,QAAQ2iB,iBAAiBx9D,KAAKoyC,OACnCwH,EAAKrP,KAAK4yB,UAAUn9D,KAAKoyC,MAAOpyC,KAAKoyC,OACrCwH,EAAKrP,KAAKrmC,IAAIlE,KAAKoyC,MAAOpyC,KAAKoyC,MAAO7H,IAGtCqP,EAAKrP,KAAK2J,KAAKl0C,KAAKoyC,MAAO7H,GAE/BvqC,KAAKg4D,WACLh4D,KAAKi7C,cAAcgX,EAAezV,WAUtCkhB,cA96Dc,SA86DCjpC,GACXmlB,EAAKvY,KAAK6S,KAAKzf,EAAKz0B,KAAKs6C,QAEzB,IADA,IAAIsa,EAAO50D,KAAK66C,QACT+Z,GACHhb,EAAKvY,KAAKn9B,IAAIuwB,EAAKA,EAAKmgC,EAAKta,QAC7Bsa,EAAOA,EAAK/Z,QAEhB,OAAOpmB,GASXkpC,cA97Dc,SA87DCjzB,GACP1qC,KAAK66C,SACL76C,KAAK66C,QAAQ6iB,cAAc19D,KAAKs6C,QAChCV,EAAKvY,KAAKu8B,IAAI59D,KAAKs6C,OAAQ5P,EAAO1qC,KAAKs6C,SAGvCV,EAAKvY,KAAK6S,KAAKl0C,KAAKs6C,OAAQ5P,GAEhC1qC,KAAKi7C,cAAcgX,EAAenW,QAGtC+hB,WAz8Dc,SAy8DFppC,GACR,IAAIqpC,EAAOnM,EACPoM,EAAOnM,EACXhY,EAAKvY,KAAK6S,KAAK4pB,EAAM99D,KAAKq6C,WAC1BT,EAAKrP,KAAK2J,KAAK6pB,EAAM/9D,KAAKoyC,OAG1B,IADA,IAAIwiB,EAAO50D,KAAK66C,QACT+Z,GAEHhb,EAAKvY,KAAKn9B,IAAI45D,EAAMA,EAAMlJ,EAAKta,QAE/BV,EAAKvY,KAAK+7B,cAAcU,EAAMA,EAAMlJ,EAAKxiB,OAEzCwH,EAAKvY,KAAKx8B,IAAIi5D,EAAMA,EAAMlJ,EAAKva,WAE/BT,EAAKrP,KAAKrmC,IAAI65D,EAAMnJ,EAAKxiB,MAAO2rB,GAChCnJ,EAAOA,EAAK/Z,QAGhB,OADAjB,EAAK/T,KAAKm4B,OAAOvpC,EAAKspC,EAAMD,GACrBrpC,GAUXskB,OAt+Dc,SAs+DN3zC,EAAK64D,GACTj+D,KAAKs9D,iBAAiB3L,GACtB/X,EAAKvY,KAAK58B,IAAIktD,EAAYA,EAAYvsD,GACtCw0C,EAAKvY,KAAK7L,UAAUm8B,EAAYA,GAChC/X,EAAKrP,KAAK2zB,WAAWtM,EAAYD,EAAYsM,GAE7Cj+D,KAAKy9D,iBAAiB7L,IAG1BhX,mBA/+Dc,WAg/DV,IAAIujB,EAAYn+D,KAAKk6C,eACrB,GAAKikB,EAAL,CAGA,IAAI/2D,EAAIpH,KAAKm6C,QAGb,GAAIgkB,GAAalM,EAAeE,GAAKF,EAAeC,MAAO,CACvD,IAAIrnB,GAAY7qC,KAAK61D,aAAazsB,EAC9Bg1B,EAAUp+D,KAAKyX,QAAUzX,KAAK0X,OAC9BH,EAAKvX,KAAKs6C,OAAOh7C,EAAGkY,EAAKxX,KAAKs6C,OAAO52C,EAEzC,GAAImnC,GAAYuzB,EAAS,CACrB,IAAIr1D,EAAI,EAAGmD,EAAI,EAAGC,EAAI,EAAGC,EAAI,EAE7B,GAAIy+B,EAAU,CACV,IAAIwzB,EAAkBxzB,EAAWiP,EACjC3tC,EAAI9G,KAAKiF,IAAI+zD,GAEbt1D,EADAqD,EAAI/G,KAAK6E,IAAIm0D,GAEbnyD,GAAKC,EAQT,GALA/E,EAAEsoC,IAAM3mC,GAAKwO,EACbnQ,EAAEuoC,IAAMzjC,GAAKqL,EACbnQ,EAAE0oC,IAAM3jC,GAAKqL,EACbpQ,EAAE2oC,IAAM3jC,GAAKoL,EAET4mD,EAAS,CACT,IAAIE,EAAIl3D,EAAEsoC,IAAK6uB,EAAIn3D,EAAEuoC,IAAK6uB,EAAIp3D,EAAE0oC,IAAK2uB,EAAIr3D,EAAE2oC,IACvCwK,EAAMl1C,KAAKm1C,IAAIx6C,KAAKyX,OAASqiC,GAC7BW,EAAMp1C,KAAKm1C,IAAIx6C,KAAK0X,OAASoiC,GAC7BS,IAAQp0B,EAAAA,IACRo0B,EAAM,UACNE,IAAQt0B,EAAAA,IACRs0B,EAAM,UACVrzC,EAAEsoC,IAAM4uB,EAAIE,EAAI/jB,EAChBrzC,EAAEuoC,IAAM4uB,EAAIE,EAAIhkB,EAChBrzC,EAAE0oC,IAAM0uB,EAAIF,EAAI/jB,EAChBnzC,EAAE2oC,IAAM0uB,EAAIF,EAAIhkB,QAIpBnzC,EAAEsoC,IAAMn4B,EACRnQ,EAAEuoC,IAAM,EACRvoC,EAAE0oC,IAAM,EACR1oC,EAAE2oC,IAAMv4B,EAKhBpQ,EAAEkpC,IAAMtwC,KAAKq6C,UAAU/6C,EACvB8H,EAAEmpC,IAAMvwC,KAAKq6C,UAAU32C,EAEvB1D,KAAKk6C,eAAiB,EAEtBl6C,KAAK06C,gBAAiB,IAG1Bc,mBA3iEc,WA6iENx7C,KAAKk6C,gBACLl6C,KAAK46C,qBAIT,IAAIj2C,EAAS3E,KAAK66C,QACdl2C,EACA3E,KAAK47C,QAAQ57C,KAAK+6C,aAAcp2C,EAAOo2C,aAAc/6C,KAAKm6C,SAG1DP,EAAK/T,KAAKqO,KAAKl0C,KAAK+6C,aAAc/6C,KAAKm6C,SAE3Cn6C,KAAK06C,gBAAiB,GAG1BkB,QA5jEc,SA4jELnnB,EAAK1rB,EAAGmD,GACb,IAAIwyD,EAAG31D,EAAE2mC,IAAK6F,EAAGxsC,EAAE4mC,IAAK6F,EAAGzsC,EAAE+mC,IAAK6uB,EAAG51D,EAAEgnC,IAAK6uB,EAAI71D,EAAEunC,IAAKuuB,EAAI91D,EAAEwnC,IACzDuuB,EAAG5yD,EAAEwjC,IAAKqvB,EAAG7yD,EAAEyjC,IAAKqvB,EAAG9yD,EAAE4jC,IAAKmvB,EAAG/yD,EAAE6jC,IAAKmvB,EAAIhzD,EAAEokC,IAAK6uB,EAAIjzD,EAAEqkC,IAClD,IAAPgF,GAAmB,IAAPC,GACZ/gB,EAAIib,IAAMovB,EAAKJ,EAAKK,EAAKvpB,EACzB/gB,EAAIkb,IAAMmvB,EAAKvpB,EAAKwpB,EAAKJ,EACzBlqC,EAAIqb,IAAMkvB,EAAKN,EAAKO,EAAKzpB,EACzB/gB,EAAIsb,IAAMivB,EAAKzpB,EAAK0pB,EAAKN,EACzBlqC,EAAI6b,IAAMouB,EAAKQ,EAAM1pB,EAAK2pB,EAAMP,EAChCnqC,EAAI8b,IAAMgF,EAAK2pB,EAAMP,EAAKQ,EAAMN,IAGhCpqC,EAAIib,IAAMovB,EAAKJ,EACfjqC,EAAIkb,IAAMovB,EAAKJ,EACflqC,EAAIqb,IAAMkvB,EAAKN,EACfjqC,EAAIsb,IAAMkvB,EAAKN,EACflqC,EAAI6b,IAAMouB,EAAKQ,EAAMN,EACrBnqC,EAAI8b,IAAMouB,EAAKQ,EAAMN,IAI7B/C,mBAjlEc,WAqlEV,GAHI97D,KAAK66C,SACL76C,KAAK66C,QAAQihB,qBAEb97D,KAAK06C,eAAgB,CACrB16C,KAAKw7C,qBAGL,IADA,IAAI9W,EAAW1kC,KAAKi3D,UACX13D,EAAI,EAAGgiB,EAAImjB,EAASllC,OAAQD,EAAIgiB,EAAGhiB,IACxCmlC,EAASnlC,GAAGm7C,gBAAiB,IAKzCO,cA/lEc,SA+lECmkB,GACXp/D,KAAKk6C,eAAiBl6C,KAAKk6C,eAAiBklB,EAC5Cp/D,KAAK06C,gBAAiB,GAG1B2kB,cApmEc,WAqmEVr/D,KAAK06C,gBAAiB,GAc1B4kB,eAnnEc,SAmnEE7qC,GAEZ,OADAz0B,KAAK46C,qBACEhB,EAAK/T,KAAKqO,KAAKzf,EAAKz0B,KAAKm6C,UAcpCtJ,eAnoEc,SAmoEEpc,GAEZ,OADAz0B,KAAK87D,qBACEliB,EAAK/T,KAAKqO,KAAKzf,EAAKz0B,KAAK+6C,eAgBpCwkB,mBArpEc,SAqpEMC,GAChBx/D,KAAK87D,qBACLliB,EAAK/T,KAAKoS,OAAOyZ,EAAY1xD,KAAK+6C,cAClC,IAAItmB,EAAM,IAAI70B,GAAGyE,KAIjB,OAHAu1C,EAAKmiB,KAAKloB,cAAcpf,EAAK+qC,EAAY9N,GACzCj9B,EAAIn1B,GAAKU,KAAKs1D,aAAah2D,EAAIU,KAAKo1D,aAAazxD,MACjD8wB,EAAI/wB,GAAK1D,KAAKs1D,aAAa5xD,EAAI1D,KAAKo1D,aAAaxxD,OAC1C6wB,GAcXgrC,oBA1qEc,SA0qEOC,GACjB1/D,KAAK87D,qBACL,IAAIrnC,EAAM,IAAI70B,GAAGyE,KACbq7D,EAAUpgE,EAAIU,KAAKs1D,aAAah2D,EAAIU,KAAKo1D,aAAazxD,MACtD+7D,EAAUh8D,EAAI1D,KAAKs1D,aAAa5xD,EAAI1D,KAAKo1D,aAAaxxD,QAE1D,OAAOg2C,EAAKmiB,KAAKloB,cAAcpf,EAAKA,EAAKz0B,KAAK+6C,eAclDn2C,qBA9rEc,SA8rEQ46D,GAClBx/D,KAAK87D,qBACLliB,EAAK/T,KAAKoS,OAAOyZ,EAAY1xD,KAAK+6C,cAClC,IAAItmB,EAAM,IAAI70B,GAAGyE,KACjB,OAAOu1C,EAAKmiB,KAAKloB,cAAcpf,EAAK+qC,EAAY9N,IAcpDttD,sBAhtEc,SAgtESs7D,GACnB1/D,KAAK87D,qBACL,IAAIrnC,EAAM,IAAI70B,GAAGyE,KACjB,OAAOu1C,EAAKmiB,KAAKloB,cAAcpf,EAAKirC,EAAW1/D,KAAK+6C,eAiBxD4kB,yBApuEc,SAouEYlrC,GACjBA,IACDA,EAAM08B,EAAYyO,YAEtB5/D,KAAK46C,qBAEL,IAAIilB,EAAc7/D,KAAKo1D,aAMvB,OALAzD,EAAWryD,GAAKU,KAAKs1D,aAAah2D,EAAIugE,EAAYl8D,MAClDguD,EAAWjuD,GAAK1D,KAAKs1D,aAAa5xD,EAAIm8D,EAAYj8D,OAElDg2C,EAAK/T,KAAKqO,KAAKwd,EAAY1xD,KAAKm6C,SAChCP,EAAK/T,KAAKi6B,UAAUpO,EAAYA,EAAYC,GACrCR,EAAY4O,SAAStrC,EAAKi9B,IAoBrCsO,2BApwEc,SAowEcvrC,GAKxB,OAJKA,IACDA,EAAM08B,EAAYyO,YAEtB5/D,KAAK46C,qBACEuW,EAAY4O,SAAStrC,EAAKz0B,KAAKm6C,UAc1C8lB,wBAvxEc,SAuxEWxrC,GAChBA,IACDA,EAAM08B,EAAYyO,YAEtB5/D,KAAK87D,qBAEL,IAAI+D,EAAc7/D,KAAKo1D,aAOvB,OANAzD,EAAWryD,GAAKU,KAAKs1D,aAAah2D,EAAIugE,EAAYl8D,MAClDguD,EAAWjuD,GAAK1D,KAAKs1D,aAAa5xD,EAAIm8D,EAAYj8D,OAElDg2C,EAAK/T,KAAKqO,KAAKwd,EAAY1xD,KAAK+6C,cAChCnB,EAAK/T,KAAKi6B,UAAUpO,EAAYA,EAAYC,GAErCR,EAAY4O,SAAStrC,EAAKi9B,IAkBrCwO,0BAtzEc,SAszEazrC,GAKvB,OAJKA,IACDA,EAAM08B,EAAYyO,YAEtB5/D,KAAK87D,qBACE3K,EAAY4O,SAAStrC,EAAKz0B,KAAK+6C,eAkB1ColB,yBA70Ec,SA60EY1rC,GAMtB,OALKA,IACDA,EAAM08B,EAAYyO,YAEtB5/D,KAAK46C,qBACLhB,EAAK/T,KAAKoS,OAAOyZ,EAAY1xD,KAAKm6C,SAC3BgX,EAAY4O,SAAStrC,EAAKi9B,IAcrC0O,wBAj2Ec,SAi2EW3rC,GAMrB,OALKA,IACDA,EAAM08B,EAAYyO,YAEtB5/D,KAAK87D,qBACLliB,EAAK/T,KAAKoS,OAAOyZ,EAAY1xD,KAAK+6C,cAC3BoW,EAAY4O,SAAStrC,EAAKi9B,IAarC2O,wBAp3Ec,SAo3EW3M,GACrB,OAAO1zD,KAAKu/D,mBAAmB7L,EAAMC,gBAazC2M,0BAl4Ec,SAk4Ea5M,GACvB,OAAO1zD,KAAK4E,qBAAqB8uD,EAAMC,gBAa3C4M,eAh5Ec,WAi5EVvgE,KAAK46C,qBACL,IAAIj3C,EAAQ3D,KAAKo1D,aAAazxD,MAC1BC,EAAS5D,KAAKo1D,aAAaxxD,OAC3BhB,EAAOhD,GAAGgD,MACT5C,KAAKs1D,aAAah2D,EAAIqE,GACtB3D,KAAKs1D,aAAa5xD,EAAIE,EACvBD,EACAC,GACJ,OAAOhB,EAAKixC,cAAcjxC,EAAM5C,KAAKm6C,UAezCqmB,sBAx6Ec,WAy6EV,OAAIxgE,KAAK66C,SACL76C,KAAK66C,QAAQihB,qBACN97D,KAAKygE,kBAAkBzgE,KAAK66C,QAAQE,eAGpC/6C,KAAKugE,kBAIpBE,kBAl7Ec,SAk7EK3lB,GACf96C,KAAK46C,qBACL,IAAIj3C,EAAQ3D,KAAKo1D,aAAazxD,MAC1BC,EAAS5D,KAAKo1D,aAAaxxD,OAC3BhB,EAAOhD,GAAGgD,MACT5C,KAAKs1D,aAAah2D,EAAIqE,GACtB3D,KAAKs1D,aAAa5xD,EAAIE,EACvBD,EACAC,GAEAk3C,EAAYlB,EAAK/T,KAAK3hC,IAAIlE,KAAK+6C,aAAcD,EAAW96C,KAAKm6C,SAIjE,GAHAv3C,EAAKixC,cAAcjxC,EAAMk4C,IAGpB96C,KAAKi3D,UACN,OAAOr0D,EAGX,IADA,IAAI89D,EAAc1gE,KAAKi3D,UACd13D,EAAI,EAAGA,EAAImhE,EAAYlhE,OAAQD,IAAK,CACzC,IAAIohE,EAAQD,EAAYnhE,GACxB,GAAIohE,GAASA,EAAMhJ,OAAQ,CACvB,IAAIiJ,EAAYD,EAAMF,kBAAkB3lB,GACpC8lB,GACAh+D,EAAKi+D,MAAMj+D,EAAMg+D,IAG7B,OAAOh+D,GAGXs0D,sBA/8Ec,WAg9EV,IAAI4J,IAAiBjP,EACrB7xD,KAAKu1D,aAAoC,WAApBv1D,KAAKu1D,aAA6BuL,GAe3DC,SAh+Ec,SAg+EJJ,EAAOpiB,EAAQt/C,GAIrBW,GAAGygB,SAASsgD,EAAO,MACnB/gE,GAAGygB,SAA2B,OAAlBsgD,EAAM9lB,QAAkB,MAGpC8lB,EAAMh8D,OAAS3E,UAEAqG,IAAXk4C,IACAoiB,EAAMpiB,OAASA,QAENl4C,IAATpH,IACA0hE,EAAM1hE,KAAOA,IAWrB+hE,QAz/Ec,WA2/EV1P,GAAsB1xD,GAAG+e,SAASqpC,mBAAmBjoC,2BAA2B/f,MAEhFwgD,EAAa8W,gBAAgBt3D,MAG7B,IAAIT,EAAgCklC,EAA7B1W,EAAM/tB,KAAKi3D,UAAUz3D,OAC5B,IAAKD,EAAI,EAAGA,EAAIwuB,IAAOxuB,GACnBklC,EAAOzkC,KAAKi3D,UAAU13D,KAElBklC,EAAKu8B,WAWjBvJ,gBA/gFc,WAghFV,GAAIz3D,KAAKy2D,mBAAoB,CACzBz2D,KAAKy2D,oBAAqB,EAC1B,IAAIQ,EAAYj3D,KAAKi3D,UACrB,GAAIA,EAAUz3D,OAAS,EAAG,CAEtB,IAA4BD,EAAG6sB,EAAGu0C,EAA9B5yC,EAAMkpC,EAAUz3D,OACpB,IAAKD,EAAI,EAAGA,EAAIwuB,EAAKxuB,IAAK,CAKtB,IAJAohE,EAAQ1J,EAAU13D,GAClB6sB,EAAI7sB,EAAI,EAGD6sB,GAAK,GACJu0C,EAAMpL,aAAe0B,EAAU7qC,GAAGmpC,cAClC0B,EAAU7qC,EAAI,GAAK6qC,EAAU7qC,GAIjCA,IAEJ6qC,EAAU7qC,EAAI,GAAKu0C,EAEvB3gE,KAAK0tB,KAAK+rB,EAAU2Z,cAAepzD,MAEvCJ,GAAG+e,SAASmqC,UAAUlpD,GAAG8gD,SAAS8E,mBAAoBxlD,KAAKy3D,gBAAiBz3D,QAIpFw2D,WA3iFc,WA4iFLx2D,KAAKy2D,qBACNz2D,KAAKy2D,oBAAqB,EAC1B72D,GAAG+e,SAASkqC,SAASjpD,GAAG8gD,SAAS8E,mBAAoBxlD,KAAKy3D,gBAAiBz3D,QAInFihE,oBAAoBt1B,EAkCpBu1B,WAAWv1B,GA2Cf,IAAIpoB,EAAO3jB,GAAGE,MAAMm1D,GA6HhBkM,EAAK59C,EAAKjhB,UACd+b,EAAGgR,OAAO8xC,EAAI,WAAYA,EAAG9kB,YAAa8kB,EAAGr8D,aAAa,GAAO,GAEjElF,GAAG2jB,KAAOpkB,EAAOE,QAAUkkB,oUCpvG3B,aAEA,IAAMA,EAAO7jB,EAAQ,YACfm6C,EAAan6C,EAAQ,0BACrBk6C,EAAOl6C,EAAQ,4BAA4Bk6C,KAE3CqY,EAAiB1uC,EAAKo2B,gBA6BxBynB,GA1BaxnB,EAAKvY,KAAKyL,SA0BTltC,GAAGE,OACjBb,KAAM,iBACNsC,QAASgiB,EAETiF,YACIlpB,GACIqpB,IADD,WAEK,OAAO3oB,KAAKqhE,WAAW/hE,GAE3BwsB,IAJD,SAIM/nB,GACD,IAAIu4C,EAAgBt8C,KAAKqhE,WACrBt9D,IAAUu4C,EAAch9C,IACxBg9C,EAAch9C,EAAIyE,EAClB/D,KAAKshE,WAAU,KAGvBj1B,UAAU,GAEd3oC,GACIilB,IADD,WAEK,OAAO3oB,KAAKqhE,WAAW39D,GAE3BooB,IAJD,SAIM/nB,GACD,IAAIu4C,EAAgBt8C,KAAKqhE,WACrBt9D,IAAUu4C,EAAc54C,IACxB44C,EAAc54C,EAAIK,EAClB/D,KAAKshE,WAAU,KAGvBj1B,UAAU,GAEdkS,QACI51B,IADI,WAEA,OAAO/oB,GAAGiI,MAAM0uD,YAEpBzqC,IAJI,WAKAlsB,GAAGu+B,OAAO,OAEdkO,UAAU,IAQlBtsC,KA9CuB,SA8CjBd,GACFe,KAAKu1D,aAAe31D,GAAGiI,MAAM0uD,YAAc,GAC3Cv2D,KAAKqhE,WAAazhE,GAAGqE,MAGzBq9D,UAnDuB,SAmDZC,GACPvhE,KAAKi7C,cAAcgX,EAAelvB,UAClC/iC,KAAKk7C,aAAerB,EAAWkC,gBACb,IAAdwlB,GAlFQ,EAkFevhE,KAAKo7C,YAC5Bp7C,KAAK0tB,KAAKnK,EAAKk2B,UAAU4B,mBAIjCT,mBA3DuB,WA4DnB,GAAK56C,KAAKk6C,eAAV,CAEA,IAAIv1C,EAAS3E,KAAK2E,OACdA,IAEA3E,KAAKq6C,UAAU/6C,EAAIU,KAAKqhE,WAAW/hE,GAAKqF,EAAO2wD,aAAah2D,EAAI,IAAOqF,EAAOywD,aAAazxD,MAC3F3D,KAAKq6C,UAAU32C,EAAI1D,KAAKqhE,WAAW39D,GAAKiB,EAAO2wD,aAAa5xD,EAAI,IAAOiB,EAAOywD,aAAaxxD,QAG/F5D,KAAKysC,WAGT4P,YAxEuB,WAyEnB,OAAO,IAAIz8C,GAAGyE,KAAKrE,KAAKqhE,aAG5Bv8D,YA5EuB,SA4EVxF,EAAGoE,QACF2C,IAAN3C,IAEAA,GADApE,EAAIA,EAAEA,GACAoE,GAGV,IAAI0B,EAAMpF,KAAKqhE,WACXj8D,EAAI9F,IAAMA,GAAK8F,EAAI1B,IAAMA,IAG7B0B,EAAI9F,EAAIA,EACR8F,EAAI1B,EAAIA,EACR1D,KAAKshE,WAAU,KAGnBE,UA3FuB,SA2Fbz9D,GACN,IAAI8zD,EAAY73D,KAAK66C,QACrB76C,KAAKysC,OAAO1oC,GACR8zD,IAAc9zD,IACV8zD,GACAA,EAAUppC,IAAIlL,EAAKk2B,UAAUuZ,eAAgBhzD,KAAKshE,UAAWthE,MAE7D+D,GACAA,EAAMmqB,GAAG3K,EAAKk2B,UAAUuZ,eAAgBhzD,KAAKshE,UAAWthE,QAMpEk3D,sBAzGuB,gBA4G3Bt3D,GAAGye,GAAGgR,OAAO+xC,EAAY9+D,UAAW,SAAU8+D,EAAY9+D,UAAUm/D,UAAWL,EAAY9+D,UAAUk/D,WACrG5hE,GAAGye,GAAGgR,OAAO+xC,EAAY9+D,UAAW,WAAY8+D,EAAY9+D,UAAU+5C,YAAa+kB,EAAY9+D,UAAUwC,aAEzGlF,GAAGwhE,YAAcjiE,EAAOE,QAAU+hE,oGCtIlCxhE,GAAGukD,MAAQvkD,GAAGE,OACVb,KAAM,WACNsC,QAAS7B,EAAQ,YAEjB8oB,YACIyzB,WACIxzB,SAAS,EACT4jB,UAAU,GASd2Y,mBACIv8B,aAASpiB,EACTqiB,KAAM9oB,GAAG8hE,UAKjB3hE,KAAM,WACFC,KAAKs1D,aAAah2D,EAAI,EACtBU,KAAKs1D,aAAa5xD,EAAI,EAEtB1D,KAAKy4D,oBAAqB,EAC1Bz4D,KAAKgrC,SAAWprC,GAAG06B,KAAK2vB,WAOxBjqD,KAAKilD,aAAe,MAGxBxqB,QAAS,WACL,GAAI76B,GAAG0kD,OAAOhiD,UAAUm4B,QAAQl4B,KAAKvC,MAEjC,IADA,IAAI0kC,EAAW1kC,KAAKi3D,UACX13D,EAAI,EAAGA,EAAImlC,EAASllC,SAAUD,EACnCmlC,EAASnlC,GAAGo4D,QAAS,EAG7B33D,KAAK2hE,SAAU,EACf3hE,KAAKy4D,oBAAqB,GAG9Bb,oBA7DM,aA8DNgK,aAAe,KAEfxd,MAAO,WACEpkD,KAAKgrC,UAQFhrC,KAAKo4D,kBAETp4D,KAAKgrC,SAAU,IAIvBqa,UAAW,SAAUsS,GACjBA,GAAqB,IAAXA,EAKV/3D,GAAG+e,SAAS0iC,eAAewgB,aAAa7hE,KAAM23D,MAItDx4D,EAAOE,QAAUO,GAAGukD,4CCrFpB,IAAM9lC,EAAK3e,EAAQ,iBAIfoiE,EAAc,IAHEpiE,EAAQ,2BAGV,CAAgB,aAW9BqiE,EAAY,SAAU7hE,EAAQ8hE,EAAU5iD,EAAQ6iD,GAChDjiE,KAAKE,OAASA,EACdF,KAAKgiE,SAAWA,EAChBhiE,KAAKof,OAASA,EACdpf,KAAKiiE,kBAAoBA,GAGzBC,KACJH,EAAUp5C,IAAM,SAAUzoB,EAAQ8hE,EAAU5iD,EAAQ6iD,GAChD,IAAI3tD,EAAS4tD,EAAax5D,MAU1B,OATI4L,GACAA,EAAOpU,OAASA,EAChBoU,EAAO0tD,SAAWA,EAClB1tD,EAAO8K,OAASA,EAChB9K,EAAO2tD,kBAAoBA,GAG3B3tD,EAAS,IAAIytD,EAAU7hE,EAAQ8hE,EAAU5iD,EAAQ6iD,GAE9C3tD,GAEXytD,EAAUvK,IAAM,SAAUz4D,GAClBmjE,EAAa1iE,OAnCC,KAoCdT,EAAMmB,OAAS,KACfgiE,EAAax8D,KAAK3G,KAY1B,IAAIojE,EAAkB,SAAU1kC,EAAM1+B,EAAOmB,EAAQiuB,GACjDnuB,KAAKy9B,KAAOA,EACZz9B,KAAKjB,MAAQA,EACbiB,KAAKE,OAASA,EACdF,KAAKmuB,SAAWA,GAEhBi0C,KACJD,EAAgBx5C,IAAM,SAAU8U,EAAM1+B,EAAOmB,EAAQiuB,GACjD,IAAI7Z,EAAS8tD,EAAmB15D,MAUhC,OATI4L,GACAA,EAAOmpB,KAAOA,EACdnpB,EAAOvV,MAAQA,EACfuV,EAAOpU,OAASA,EAChBoU,EAAO6Z,SAAWA,GAGlB7Z,EAAS,IAAI6tD,EAAgB1kC,EAAM1+B,EAAOmB,EAAQiuB,GAE/C7Z,GAEX6tD,EAAgB3K,IAAM,SAAUz4D,GACxBqjE,EAAmB5iE,OAtEL,KAuEdT,EAAM0+B,KAAO1+B,EAAMA,MAAQA,EAAMmB,OAASnB,EAAMovB,SAAW,KAC3Di0C,EAAmB18D,KAAK3G,KAehC,IAAIsjE,EAAiB,SAAUC,EAAQpiE,EAAQqiE,EAAYC,EAAcC,EAAsBrjD,GAC3F,IAAIsjD,EAAK1iE,KACT0iE,EAAGJ,OAASA,EACZI,EAAGxiE,OAASA,EACZwiE,EAAGH,WAAaA,EAChBG,EAAGF,aAAeA,EAClBE,EAAGD,qBAAuBA,EAC1BC,EAAGtjD,OAASA,GAEZujD,KA2BJ,SAASC,IACL5iE,KAAK6iE,OAAQ,EACb7iE,KAAK4e,WAAa,KAClB5e,KAAKuR,UAAY,EACjBvR,KAAK8iE,aAAc,EACnB9iE,KAAK+iE,WAAY,EACjB/iE,KAAKgjE,eAAiB,EACtBhjE,KAAKijE,QAAU,EACfjjE,KAAKitB,OAAS,EACdjtB,KAAKkjE,UAAY,EAEjBljE,KAAKwtB,QAAU,KACfxtB,KAAKmjE,UAAY,KAtCrBd,EAAe15C,IAAM,SAAU25C,EAAQpiE,EAAQqiE,EAAYC,EAAcC,EAAsBrjD,GAC3F,IAAI9K,EAASquD,EAAkBj6D,MAY/B,OAXI4L,GACAA,EAAOguD,OAASA,EAChBhuD,EAAOpU,OAASA,EAChBoU,EAAOiuD,WAAaA,EACpBjuD,EAAOkuD,aAAeA,EACtBluD,EAAOmuD,qBAAuBA,EAC9BnuD,EAAO8K,OAASA,GAGhB9K,EAAS,IAAI+tD,EAAeC,EAAQpiE,EAAQqiE,EAAYC,EAAcC,EAAsBrjD,GAEzF9K,GAEX+tD,EAAe7K,IAAM,SAAUz4D,GACvB4jE,EAAkBnjE,OAjHJ,KAkHdT,EAAMujE,OAASvjE,EAAMmB,OAASnB,EAAMyjE,aAAe,KACnDG,EAAkBj9D,KAAK3G,KAuB/B,IAAI4uB,EAAQi1C,EAActgE,UAE1BqrB,EAAMy1C,iBAAmB,SAAUrb,EAAW55B,EAAUjuB,EAAQmjE,EAAS7wD,EAAQ+a,GAY7E,OAXAvtB,KAAK6iE,OAAQ,EACb7iE,KAAK4e,WAAampC,EAClB/nD,KAAKwtB,QAAUttB,EACfF,KAAKmjE,UAAYh1C,EAEjBnuB,KAAKuR,UAAY,EACjBvR,KAAKkjE,UAAYG,EACjBrjE,KAAKitB,OAASM,EACdvtB,KAAK+iE,UAAa/iE,KAAKitB,OAAS,EAChCjtB,KAAKijE,QAAUzwD,EACfxS,KAAK8iE,YAAe9iE,KAAKijE,UAAYrjE,GAAGiI,MAAMy7D,gBACvC,GAKX31C,EAAM41C,YAAc,WAAW,OAAOvjE,KAAKkjE,WAI3Cv1C,EAAM61C,YAAc,SAASC,GAAUzjE,KAAKkjE,UAAYO,GAMxD91C,EAAM9sB,OAAS,SAAUF,IACE,IAAnBX,KAAKuR,UACLvR,KAAKuR,SAAW,EAChBvR,KAAKgjE,eAAiB,IAEtBhjE,KAAKuR,UAAY5Q,EACbX,KAAK8iE,cAAgB9iE,KAAK+iE,UACtB/iE,KAAKuR,UAAYvR,KAAKkjE,YACtBljE,KAAK0jE,UACL1jE,KAAKuR,SAAW,IAGhBvR,KAAK+iE,UACD/iE,KAAKuR,UAAYvR,KAAKitB,SACtBjtB,KAAK0jE,UAEL1jE,KAAKuR,UAAYvR,KAAKitB,OACtBjtB,KAAKgjE,gBAAkB,EACvBhjE,KAAK+iE,WAAY,GAGjB/iE,KAAKuR,UAAYvR,KAAKkjE,YACtBljE,KAAK0jE,UAEL1jE,KAAKuR,SAAW,EAChBvR,KAAKgjE,gBAAkB,GAI3BhjE,KAAKmjE,YAAcnjE,KAAK8iE,aAAe9iE,KAAKgjE,eAAiBhjE,KAAKijE,SAClEjjE,KAAK2jE,YAKrBh2C,EAAMi2C,YAAc,WAChB,OAAO5jE,KAAKmjE,WAGhBx1C,EAAM+1C,QAAU,WACR1jE,KAAKwtB,SAAWxtB,KAAKmjE,YACrBnjE,KAAK6iE,OAAQ,EACb7iE,KAAKmjE,UAAU5gE,KAAKvC,KAAKwtB,QAASxtB,KAAKuR,UACvCvR,KAAK6iE,OAAQ,IAIrBl1C,EAAMg2C,OAAS,WAEX3jE,KAAK4e,WAAWilD,WAAW7jE,KAAKmjE,UAAWnjE,KAAKwtB,UAGpD,IAAIs2C,KACJlB,EAAcj6C,IAAM,WAChB,OAAOm7C,EAAQp7D,OAAS,IAAIk6D,GAEhCA,EAAcpL,IAAM,SAAUuM,GACtBD,EAAQtkE,OAhOM,KAgOqBukE,EAAMlB,QACzCkB,EAAMnlD,WAAamlD,EAAMv2C,QAAUu2C,EAAMZ,UAAY,KACrDW,EAAQp+D,KAAKq+D,KAyBrBnkE,GAAG6gD,UAAY,WACXzgD,KAAKgkE,WAAa,EAClBhkE,KAAKikE,mBACLjkE,KAAKkkE,iBACLlkE,KAAKmkE,mBACLnkE,KAAKokE,gBAAkB/lD,EAAGG,WAAU,GACpCxe,KAAKqkE,eAAiBhmD,EAAGG,WAAU,GACnCxe,KAAK0e,eAAiB,KACtB1e,KAAKskE,wBAAyB,EAC9BtkE,KAAKukE,mBAAoB,EAEzBvkE,KAAKwkE,oBAIT5kE,GAAG6gD,UAAUn+C,WACTwc,YAAalf,GAAG6gD,UAGhBgkB,mBAAoB,SAAUplD,UACnBrf,KAAKqkE,eAAehlD,EAAQnf,OAAO0f,KAE1C,IADA,IAAIX,EAAMjf,KAAKwkE,gBACNjlE,EAAI,EAAGgiB,EAAItC,EAAIzf,OAAQD,EAAIgiB,EAAGhiB,IACnC,GAAI0f,EAAI1f,KAAO8f,EAAS,CACpBJ,EAAIkB,OAAO5gB,EAAG,GACd,MAGR8iE,EAAe7K,IAAIn4C,IAGvBqlD,sBAAuB,SAAU3lE,GAC7B,IAAI4lE,EAAW5lE,EAAMmB,OAAO0f,IACXP,EAANrf,KAAqBokE,gBAAgBO,GAChD,GAAItlD,EAAS,CAGT,IADA,IAAIoe,EAAOpe,EAAQoe,KAAMmnC,EAAYvlD,EAAQtgB,MACpCQ,EAAI,EAAGgiB,EAAIkc,EAAKj+B,OAAQD,EAAIgiB,EAAGhiB,IACpC,GAAIk+B,EAAKl+B,KAAOqlE,EAAW,CACvBnnC,EAAKtd,OAAO5gB,EAAG,GACf,aAPDS,KAWKokE,gBAAgBO,GAC5B5C,EAAUvK,IAAIoN,GACdzC,EAAgB3K,IAAIn4C,KAI5BwlD,YAAa,SAAUC,EAAQC,EAAa/C,GACxC,IAAK,IAAIziE,EAAI,EAAGA,EAAIulE,EAAOtlE,OAAQD,IAC/B,GAAIyiE,EAAW8C,EAAOvlE,GAAGyiE,SAErB,YADA8C,EAAO3kD,OAAO5gB,EAAG,EAAGwlE,GAI5BD,EAAOp/D,KAAKq/D,IAGhBC,UAAW,SAAUF,EAAQC,GACzBD,EAAOp/D,KAAKq/D,IAYhBlmD,gBAAiB,SAAU3e,GAClBA,EAAO0f,MACJ1f,EAAO+kE,aACPrlE,GAAGu+B,OAAO,MAGVj+B,EAAO0f,IAAMkiD,EAAYoD,aAqBrCC,aAAc,SAAUC,GACpBplE,KAAKgkE,WAAaoB,GAStBC,aAAc,WACV,OAAOrlE,KAAKgkE,YAShBnjE,OAAQ,SAAUF,GAKd,IAAIpB,EAAGk+B,EAAM1P,EAAKhvB,EAElB,IANAiB,KAAKukE,mBAAoB,EACF,IAApBvkE,KAAKgkE,aACJrjE,GAAMX,KAAKgkE,YAIXzkE,EAAE,EAA6BwuB,GAA3B0P,EAAKz9B,KAAKikE,iBAA4BzkE,OAAQD,EAAEwuB,EAAKxuB,KACzDR,EAAQ0+B,EAAKl+B,IACF6f,QAAWrgB,EAAMkjE,mBACxBljE,EAAMmB,OAAOW,OAAOF,GAG5B,IAAIpB,EAAE,EAA4BwuB,GAAzB0P,EAAKz9B,KAAKkkE,eAAwB1kE,OAAQD,EAAEwuB,EAAKxuB,KACtDR,EAAQ0+B,EAAKl+B,IACF6f,QAAWrgB,EAAMkjE,mBACxBljE,EAAMmB,OAAOW,OAAOF,GAG5B,IAAIpB,EAAE,EAA8BwuB,GAA3B0P,EAAKz9B,KAAKmkE,iBAA0B3kE,OAAQD,EAAEwuB,EAAKxuB,KACxDR,EAAQ0+B,EAAKl+B,IACF6f,QAAWrgB,EAAMkjE,mBACxBljE,EAAMmB,OAAOW,OAAOF,GAI5B,IAAI8gB,EAAKxC,EAAMjf,KAAKwkE,gBACpB,IAAIjlE,EAAE,EAAGA,EAAE0f,EAAIzf,OAAQD,IAAI,CAKvB,GAJAkiB,EAAMxC,EAAI1f,GACVS,KAAK0e,eAAiB+C,EACtBzhB,KAAKskE,wBAAyB,GAEzB7iD,EAAIrC,OAEL,IAAKqC,EAAI8gD,WAAa,EAAG9gD,EAAI8gD,WAAa9gD,EAAI6gD,OAAO9iE,SAAWiiB,EAAI8gD,WAChE9gD,EAAI+gD,aAAe/gD,EAAI6gD,OAAO7gD,EAAI8gD,YAClC9gD,EAAIghD,sBAAuB,EAE3BhhD,EAAI+gD,aAAa3hE,OAAOF,GACxB8gB,EAAI+gD,aAAe,KAKvBxiE,KAAKskE,wBAAgE,IAAtCtkE,KAAK0e,eAAe4jD,OAAO9iE,SAC1DQ,KAAKykE,mBAAmBzkE,KAAK0e,kBAC3Bnf,GAMV,IAAIA,EAAE,EAAEk+B,EAAKz9B,KAAKikE,gBAAiB1kE,EAAEk+B,EAAKj+B,SACtCT,EAAQ0+B,EAAKl+B,IACJ0iE,kBACLjiE,KAAK0kE,sBAAsB3lE,GAE3BQ,IAGR,IAAIA,EAAE,EAAGk+B,EAAKz9B,KAAKkkE,cAAe3kE,EAAEk+B,EAAKj+B,SACrCT,EAAQ0+B,EAAKl+B,IACH0iE,kBACNjiE,KAAK0kE,sBAAsB3lE,GAE3BQ,IAGR,IAAIA,EAAE,EAAGk+B,EAAKz9B,KAAKmkE,gBAAiB5kE,EAAEk+B,EAAKj+B,SACvCT,EAAQ0+B,EAAKl+B,IACH0iE,kBACNjiE,KAAK0kE,sBAAsB3lE,GAE3BQ,IAGRS,KAAKukE,mBAAoB,EACzBvkE,KAAK0e,eAAiB,MAmC1Bm7C,SAAU,SAAU1rC,EAAUjuB,EAAQujE,EAAUjxD,EAAQ+a,EAAOnO,GAC3D,aACA,GAAwB,mBAAb+O,EAAyB,CAChC,IAAIm3C,EAAMn3C,EACVA,EAAWjuB,EACXA,EAASolE,EAIY,IAArBpzD,UAAU1S,QAAqC,IAArB0S,UAAU1S,SACpC4f,IAAW5M,EACXA,EAAS5S,GAAGiI,MAAMy7D,eAClB/1C,EAAQ,GAGZ3tB,GAAGygB,SAASngB,EAAQ,MAEpB,IAAIykE,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAGnB,IAUI0hE,EAAOxkE,EAVP8f,EAAUrf,KAAKqkE,eAAeM,GAWlC,GAVKtlD,EAKMA,EAAQD,SAAWA,GAC1Bxf,GAAGu+B,OAAO,OAJV9e,EAAUgjD,EAAe15C,IAAI,KAAMzoB,EAAQ,EAAG,KAAM,KAAMkf,GAC1Dpf,KAAKwkE,gBAAgB9+D,KAAK2Z,GAC1Brf,KAAKqkE,eAAeM,GAAYtlD,GAMd,MAAlBA,EAAQijD,OACRjjD,EAAQijD,eAGR,IAAK/iE,EAAI,EAAGA,EAAI8f,EAAQijD,OAAO9iE,SAAUD,EAErC,IADAwkE,EAAQ1kD,EAAQijD,OAAO/iE,KACV4uB,IAAa41C,EAAMZ,UAG5B,OAFAvjE,GAAGgB,MAAM,KAAMmjE,EAAMR,cAAeE,QACpCM,EAAMb,UAAYO,IAM9BM,EAAQnB,EAAcj6C,OAChBy6C,iBAAiBpjE,KAAMmuB,EAAUjuB,EAAQujE,EAAUjxD,EAAQ+a,GACjElO,EAAQijD,OAAO58D,KAAKq+D,GAEhB/jE,KAAK0e,iBAAmBW,GAAWrf,KAAKskE,yBACxCtkE,KAAKskE,wBAAyB,IAiBtC3iB,eAAgB,SAASzhD,EAAQ8hE,EAAU5iD,GACvC,IAAIulD,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAGnB,IAAIkjE,EAAcvlE,KAAKokE,gBAAgBO,GACvC,GAAIY,GAAeA,EAAYxmE,MAAM,CAEjC,GAAIwmE,EAAYxmE,MAAMijE,WAAaA,EAa/B,OAFAuD,EAAYxmE,MAAMkjE,mBAAoB,OACtCsD,EAAYxmE,MAAMqgB,OAASA,GAX3B,GAAIpf,KAAKukE,kBAIL,OAHA3kE,GAAGgB,MAAM,MACT2kE,EAAYxmE,MAAMkjE,mBAAoB,OACtCsD,EAAYxmE,MAAMqgB,OAASA,GAI3Bpf,KAAKohB,iBAAiBlhB,GASlC,IACI4kE,EADAC,EAAchD,EAAUp5C,IAAIzoB,EAAQ8hE,EAAU5iD,GAAQ,GAKzC,IAAb4iD,GACA8C,EAAS9kE,KAAKkkE,cACdlkE,KAAKglE,UAAUF,EAAQC,KAGvBD,EAAS9C,EAAW,EAAIhiE,KAAKikE,gBAAkBjkE,KAAKmkE,gBACpDnkE,KAAK6kE,YAAYC,EAAQC,EAAa/C,IAI1ChiE,KAAKokE,gBAAgBO,GAAYxC,EAAgBx5C,IAAIm8C,EAAQC,EAAa7kE,EAAQ,OActF2jE,WAAY,SAAU11C,EAAUjuB,GAI5B,GAAKA,GAAWiuB,EAAhB,CAEA,IAAIw2C,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAInB,IAAiBgd,EAANrf,KAAqBqkE,eAAeM,GAC/C,GAAItlD,EAEA,IADA,IAAIijD,EAASjjD,EAAQijD,OACb/iE,EAAI,EAAGimE,EAAKlD,EAAO9iE,OAAQD,EAAIimE,EAAIjmE,IAAI,CAC3C,IAAIwkE,EAAQzB,EAAO/iE,GACnB,GAAI4uB,IAAa41C,EAAMZ,UAkBnB,OAjBKY,IAAU1kD,EAAQmjD,cAAmBnjD,EAAQojD,uBAC9CpjD,EAAQojD,sBAAuB,GAEnCH,EAAOniD,OAAO5gB,EAAG,GACjBqjE,EAAcpL,IAAIuM,GAEd1kD,EAAQkjD,YAAchjE,GACtB8f,EAAQkjD,kBAGU,IAAlBD,EAAO9iE,SAhBZQ,KAiBc0e,iBAAmBW,EAjBjCrf,KAkBcskE,wBAAyB,EAlBvCtkE,KAoBcykE,mBAAmBplD,QAehD+B,iBAAkB,SAAUlhB,GACxB,GAAKA,EAAL,CAEA,IAAIykE,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAInB,IAAIgd,EAAUrf,KAAKokE,gBAAgBO,GAC/BtlD,IACIrf,KAAKukE,kBACLllD,EAAQtgB,MAAMkjE,mBAAoB,EAElCjiE,KAAK0kE,sBAAsBrlD,EAAQtgB,UAa/C0mE,uBAAwB,SAAUvlE,GAE9B,GAAKA,EAAL,CAGA,IAAIykE,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAKnB,IAAIgd,EAAUrf,KAAKqkE,eAAeM,GAClC,GAAItlD,EAAS,CACT,IAAIijD,EAASjjD,EAAQijD,OACjBA,EAAO3+C,QAAQtE,EAAQmjD,eAAiB,IACtCnjD,EAAQojD,uBACVpjD,EAAQojD,sBAAuB,GAEnC,IAAK,IAAIljE,EAAI,EAAGgiB,EAAI+gD,EAAO9iE,OAAQD,EAAIgiB,EAAGhiB,IACtCqjE,EAAcpL,IAAI8K,EAAO/iE,IAE7B+iE,EAAO9iE,OAAS,EAEZQ,KAAK0e,iBAAmBW,EACxBrf,KAAKskE,wBAAyB,EAE9BtkE,KAAKykE,mBAAmBplD,GAKhCrf,KAAKohB,iBAAiBlhB,KAY1ByjD,cAAe,WACX3jD,KAAK0lE,6BAA6B9lE,GAAG6gD,UAAUmB,kBAcnD8jB,6BAA8B,SAASC,GAEnC,IAAIpmE,EAAG8f,EAOHtgB,EAPYkgB,EAAMjf,KAAKwkE,gBAC3B,IAAIjlE,EAAE0f,EAAIzf,OAAO,EAAGD,GAAG,EAAGA,IACtB8f,EAAUJ,EAAI1f,GACdS,KAAKylE,uBAAuBpmD,EAAQnf,QAKxC,IAAI0lE,EAAc,EAClB,GAAGD,EAAc,EACb,IAAIpmE,EAAE,EAAGA,EAAES,KAAKikE,gBAAgBzkE,QAC5BomE,EAAc5lE,KAAKikE,gBAAgBzkE,QACnCT,EAAQiB,KAAKikE,gBAAgB1kE,KACjBR,EAAMijE,UAAY2D,GAC1B3lE,KAAKohB,iBAAiBriB,EAAMmB,QAC5B0lE,GAAe5lE,KAAKikE,gBAAgBzkE,QACpCD,IAIZ,GAAGomE,GAAe,EACd,IAAIpmE,EAAE,EAAGA,EAAES,KAAKkkE,cAAc1kE,QAC1BomE,EAAc5lE,KAAKkkE,cAAc1kE,QACjCT,EAAQiB,KAAKkkE,cAAc3kE,KAEvBS,KAAKohB,iBAAiBriB,EAAMmB,QAC5B0lE,GAAe5lE,KAAKkkE,cAAc1kE,QAClCD,IAIZ,IAAIA,EAAE,EAAGA,EAAES,KAAKmkE,gBAAgB3kE,QAC5BomE,EAAc5lE,KAAKmkE,gBAAgB3kE,QACnCT,EAAQiB,KAAKmkE,gBAAgB5kE,KACjBR,EAAMijE,UAAY2D,GAC1B3lE,KAAKohB,iBAAiBriB,EAAMmB,QAC5B0lE,GAAe5lE,KAAKmkE,gBAAgB3kE,QACpCD,KAYZsmE,YAAa,SAAS13C,EAAUjuB,GAG5BN,GAAGygB,SAAS8N,EAAU,MACtBvuB,GAAGygB,SAASngB,EAAQ,MACpB,IAAIykE,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAInB,IAAIgd,EAAUrf,KAAKqkE,eAAeM,GAElC,IAAKtlD,EACD,OAAO,EAGX,GAAsB,MAAlBA,EAAQijD,OACR,OAAO,EAIP,IADA,IAAIA,EAASjjD,EAAQijD,OACZ/iE,EAAI,EAAGA,EAAI+iE,EAAO9iE,SAAUD,EAAG,CAGpC,GAAI4uB,IAFSm0C,EAAO/iE,GAEG4jE,UACnB,OAAO,EAGf,OAAO,GAaf2C,gBAAiB,WACb,OAAO9lE,KAAK+lE,+BAA+BnmE,GAAG6gD,UAAUmB,kBAa5DmkB,+BAAgC,SAAUJ,GACtC,IAEiBtmD,EACb9f,EAAGimE,EAUHzmE,EAbAinE,KAEsBC,EAAfjmE,KAAwCwkE,gBAGnD,IAAIjlE,EAAI,EAAGimE,EAAKS,EAAkBzmE,OAAQD,EAAIimE,EAAIjmE,KAC9C8f,EAAU4mD,EAAkB1mE,MAExB8f,EAAQD,QAAS,EACjB4mD,EAAiBtgE,KAAK2Z,EAAQnf,SAKtC,GAAGylE,EAAc,EACb,IAAIpmE,EAAE,EAAGA,EAAES,KAAKikE,gBAAgBzkE,OAAQD,KACpCR,EAAQiB,KAAKikE,gBAAgB1kE,KAEtBR,EAAMijE,UAAY2D,IACjB5mE,EAAMqgB,QAAS,EACf4mD,EAAiBtgE,KAAK3G,EAAMmB,SAM5C,GAAGylE,GAAe,EACd,IAAIpmE,EAAE,EAAGA,EAAES,KAAKkkE,cAAc1kE,OAAQD,KAClCR,EAAQiB,KAAKkkE,cAAc3kE,MAEvBR,EAAMqgB,QAAS,EACf4mD,EAAiBtgE,KAAK3G,EAAMmB,SAKxC,IAAIX,EAAE,EAAGA,EAAES,KAAKmkE,gBAAgB3kE,OAAQD,KACpCR,EAAQiB,KAAKmkE,gBAAgB5kE,KAEtBR,EAAMijE,UAAY2D,IACjB5mE,EAAMqgB,QAAS,EACf4mD,EAAiBtgE,KAAK3G,EAAMmB,SAKxC,OAAO8lE,GAaXllD,cAAe,SAAUC,GACrB,GAAKA,EAGL,IAAK,IAAIxhB,EAAI,EAAGA,EAAIwhB,EAAgBvhB,OAAQD,IACxCS,KAAK2gB,aAAaI,EAAgBxhB,KAgB1CmhB,YAAa,SAAUxgB,GACnBN,GAAGygB,SAASngB,EAAQ,MACpB,IAAIykE,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAKnB,IACIgd,EADOrf,KACQqkE,eAAeM,GAC9BtlD,IACAA,EAAQD,QAAS,GAIrB,IAAI8mD,EAPOlmE,KAOcokE,gBAAgBO,GACrCuB,IACAA,EAAcnnE,MAAMqgB,QAAS,IAgBrCuB,aAAc,SAAUzgB,GACpBN,GAAGygB,SAASngB,EAAQ,MACpB,IAAIykE,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAKnB,IACIgd,EADOrf,KACQqkE,eAAeM,GAC9BtlD,IACAA,EAAQD,QAAS,GAIrB,IAAI8mD,EAPOlmE,KAOcokE,gBAAgBO,GACrCuB,IACAA,EAAcnnE,MAAMqgB,QAAS,IAWrC+mD,eAAgB,SAAUjmE,GACtBN,GAAGygB,SAASngB,EAAQ,MACpB,IAAIykE,EAAWzkE,EAAO0f,IACjB+kD,IACGzkE,EAAO+kE,cACPrlE,GAAGu+B,OAAO,MACVwmC,EAAWzkE,EAAO0f,IAAM1f,EAAO+kE,cAG/BrlE,GAAGyC,QAAQ,OAKnB,IAAIgd,EAAUrf,KAAKqkE,eAAeM,GAClC,GAAItlD,EACA,OAAOA,EAAQD,OAEnB,IAAI8mD,EAAgBlmE,KAAKokE,gBAAgBO,GACzC,QAAIuB,GACOA,EAAcnnE,MAAMqgB,SAavCxf,GAAG6gD,UAAUmB,gBAAkB,GAAK,GASpChiD,GAAG6gD,UAAU2lB,oBAAsBxmE,GAAG6gD,UAAUmB,gBAAkB,EAElEziD,EAAOE,QAAUO,GAAG6gD,oFCxjCpB,IAAI4lB,EAAW3mE,EAAQ,gBAuBvBE,GAAG2oB,MAAQ3oB,GAAGE,OACVb,KAAM,WAAYsC,QAAS8kE,EAE3BtmE,KAHgB,WAaZC,KAAKu7B,QAAS,GAGlB/S,YAUImT,WACIhT,IAAK,WACD,GAAI3oB,KAAKsmE,QAAS,CACd,IAAIrnE,EAAOe,KAAKsmE,QAChB,GAA2B,KAAvBrnE,EAAKsnE,WAAW,GAGhB,OAAOtnE,EAAKuJ,MAAM,GAEtB,GAAI5I,GAAG+mD,aAAc,CACjB,IAAI6f,EAAO5mE,GAAG+mD,aAAa8f,eAAezmE,KAAKgnD,OAAO,GACtD,OAA2B,KAAvB/nD,EAAKsnE,WAAW,GAETC,EAAOvnE,EAIPunE,EAAO,IAAMvnE,EAIxBW,GAAGyC,QAAQ,MAGnB,MAAO,IAEXwmB,SAAS,GASby9C,QAAS,GAUT5sC,cACI/Q,IADU,aAEVmD,IAFU,SAEL+qC,OAIb/tC,SAUI49C,aAAa/6B,EAYbg7B,+BAA+B,EAU/BC,4BAA4B,GAahCC,SA1HgB,WA2HZ,OAAO7mE,KAAK27B,WAUhBmrC,WAAWn7B,EAiBXo7B,WAAY,KAWZC,aAAc,SAAUC,EAAUC,GAE1BlnE,KAAKsmE,SADS,IAAdY,EACeD,QAAY5gE,EAGZ,IAAM4gE,KAKjC9nE,EAAOE,QAAUO,GAAG2oB,gDClMpB,IAAMA,EAAQ7oB,EAAQ,aAChBk4B,EAAcl4B,EAAQ,yBAExBo4B,EAAWl4B,GAAG43B,MACd2vC,UAAW,EACXjtC,UAAW,IAUXgD,EAAYt9B,GAAGE,OACfb,KAAM,eACNsC,QAASgnB,EACT6+C,QAASxvC,GAET73B,KALqB,WAMjBC,KAAKu7B,QAAS,EAGdv7B,KAAK+7B,OAAS,MAGlBvT,YACIyR,UACIxR,QAASqP,EAASqvC,UAClBz+C,KAAMoP,GAEV4B,cACI/Q,IADU,WAEN,OAAO3oB,KAAK+7B,QAEhBjQ,IAJU,SAIL/nB,GACD/D,KAAK+7B,OAASh4B,EACVA,IACA/D,KAAKu7B,QAAS,EACdv7B,KAAK0tB,KAAK,UAGlB2e,UAAU,IAIlBvjB,SACIgP,SAAUA,EACVsG,WAAY,SAAU1C,EAAKvN,GACvB,IAAIqM,EAAO56B,GAAG47B,OAAO6rC,QAAQ3rC,IAAQ97B,GAAG47B,OAAO6rC,QAAQ3rC,EAAM,aACxDlB,GAASA,EAAK8sC,SAUX9sC,EAAK+sC,kBAAkBrqC,EAEvB/O,EAAS,KAAMqM,EAAK+sC,QAGpBp5C,EAAS,KAAMqM,EAAKgtC,SAdxB5nE,GAAG47B,OAAOC,KAAKC,EAAK,SAAUf,EAAO8sC,GACjC,GAAI9sC,EACA,OAAOxM,EAASwM,GAEpBH,EAAO56B,GAAG47B,OAAO6rC,QAAQ3rC,IAAQ97B,GAAG47B,OAAO6rC,QAAQ3rC,EAAM,aACzDvN,EAAS,KAAMqM,EAAKgtC,aAepC/sC,QAzDqB,WA0DjB76B,GAAG89B,YAAYqB,QAAQ/+B,MACvBA,KAAKysC,YAab7sC,GAAGs9B,UAAYA,EACf/9B,EAAOE,QAAU69B,oEC9EjB,IAAIwqC,EAAa9nE,GAAGE,OAChBb,KAAM,gBACNsC,QAAS3B,GAAG+nE,KAEZn/C,YACIo/C,YACIn/C,QAAS,IAGbU,aACIV,QAAS,KACTC,KAAM9oB,GAAGioE,aAGbC,UACIr/C,SAAU,GAGds/C,WAAY,QAIpBnoE,GAAG8nE,WAAaA,EAChBvoE,EAAOE,QAAUqoE,2BC7BjB,IAAIzmC,EAAcrhC,GAAGE,OACjBb,KAAM,iBACNsC,QAAS3B,GAAG2oB,MAEZxoB,KAJuB,WAKnBC,KAAKm8B,QAAU,MAGnB3T,YACIkR,cACI/Q,IADU,WAEN,OAAO3oB,KAAKm8B,SAEhBrQ,IAJU,SAIL2Z,GACDzlC,KAAKm8B,QAAUsJ,EAAI3J,QAAU2J,GAEjC4G,UAAU,MAKtBzsC,GAAGqhC,YAAc9hC,EAAOE,QAAU4hC,2BCnBlC,IAAI0mC,EAAO/nE,GAAGE,OACVb,KAAM,UACNsC,QAAS3B,GAAG2oB,QAGhB3oB,GAAG+nE,KAAOxoE,EAAOE,QAAUsoE,2BCE3B,IAAIK,EAAYpoE,GAAGE,OACfb,KAAM,eACNsC,QAAS3B,GAAG2oB,MACZC,YAIIy/C,KAAM,QAId9oE,EAAOE,QAAUO,GAAGooE,UAAYA,2BCdhC,IAAIE,EAAatoE,GAAGE,OAChBb,KAAM,gBACNsC,QAAS3B,GAAG8nE,aAGhB9nE,GAAGsoE,WAAaA,EAChB/oE,EAAOE,QAAU6oE,2BCNjB,IAAIC,EAAqBvoE,GAAG43B,MASxB4wC,KAAM,EAWNC,gBAAiB,EAYjBC,eAAgB,IAShBC,EAAS3oE,GAAGE,OACZb,KAAM,YACNsC,QAAS3B,GAAG2oB,MACZxoB,KAHkB,WASdC,KAAKwoE,gBAAkB,KAEvBxoE,KAAKyoE,mBAAqB,GAG9BjgD,YAII7X,KAAM,KAeN+3D,mBAAoBP,EAAmBC,KAQvCO,iBAAiB,EAMjBC,UACIngD,SAAS,EACTogD,YAAY,IAIpB//C,SACIq/C,mBAAAA,EACAW,4BAA6B,GAGjC/B,YAAYp7B,EAYZo9B,sBAAuB,WACnB,IAAIC,EAAMtpE,EAAQ,+BAClBM,KAAKwoE,gBAAkBQ,EAAIC,QAAQjpE,KAAK2Q,OAM5Cu4D,eAAgB,SAAUC,GAYtB,OAXInpE,KAAK2Q,KAAK2nD,QAEVt4D,KAAK2Q,KAAK2nD,QAAQ8Q,SAAU,EAI5BxpE,GAAGu+B,OAAO,MAETn+B,KAAKwoE,iBACNxoE,KAAK+oE,wBAEF/oE,KAAKwoE,gBAAgBW,IAGhCvH,aAAc,WACV,IAAIn9B,EAiCJ,OA/BQzkC,KAAK0oE,qBAAuBP,EAAmBE,kBAG1CroE,KAAK0oE,qBAAuBP,EAAmBG,gBAK1CtoE,KAAKyoE,mBAAqB,GAAMF,EAAOO,8BAKrDrkC,EAAOzkC,KAAKkpE,iBAEZlpE,KAAK2Q,KAAKixD,aAAan9B,KAIvBzkC,KAAK2Q,KAAK2nD,QAAQ8Q,SAAU,EAE5B3kC,EAAOzkC,KAAK2Q,KAAKixD,kBAEnB5hE,KAAKyoE,mBAQAhkC,KAIf7kC,GAAG2oE,OAASppE,EAAOE,QAAUkpE,EAC7B3oE,GAAGye,GAAG+Q,SAASxvB,GAAI,aAAc,oECvLjC,IAAIypE,EAAW3pE,EAAQ,wBACnB2e,EAAK3e,EAAQ,kBAWjBE,GAAGymE,SAAWzmE,GAAGE,OACbb,KAAM,cAAesC,QAAS8nE,EAE9BtpE,KAAM,WAMFukD,OAAOglB,eAAetpE,KAAM,SACxB+D,MAAO,GACPwlE,UAAU,OAatBlrD,EAAGta,MAAMnE,GAAGymE,SAAU,iBAAkB,SAAUtmE,GAC9C,OAAOse,EAAGmrD,eAAezpE,EAAMH,GAAGymE,YAAchoD,EAAGmrD,eAAezpE,EAAMH,GAAG2oB,SAI/ElK,EAAGta,MAAMnE,GAAGymE,SAAU,kBAAmB,SAAUtmE,GAC/C,OAAOA,IAASH,GAAGuvC,WACZpvC,IAASH,GAAGs9B,WACZn9B,IAASH,GAAG6pE,eACZ1pE,IAASH,GAAG2oB,QAGvBppB,EAAOE,QAAUO,GAAGymE,iFC1EpB,IAAMllC,EAAWzhC,EAAQ,eACnBwhC,EAAexhC,EAAQ,6BACvB0hC,EAAMF,EAAaE,IACnB+N,EAAYzvC,EAAQ,iBAOtBgqE,EAAgB9pE,GAAGE,OACnBb,KAAM,mBACNsC,QAAS4tC,EAETpvC,KAJyB,WAKrBC,KAAK2pE,aAAe,MAaxBC,aAlByB,SAkBXjmE,EAAOC,EAAQimE,GACzB7pE,KAAK2D,MAAQ0B,KAAK4xB,MAAMtzB,GAAS/D,GAAGkqE,YAAYnmE,OAChD3D,KAAK4D,OAASyB,KAAK4xB,MAAMrzB,GAAUhE,GAAGkqE,YAAYlmE,QAElD,IAAIkrD,KAqBJ,GApBAA,EAAKib,OAAS/pE,KAAK42C,QACnBkY,EAAKnrD,MAAQA,EACbmrD,EAAKlrD,OAASA,EACdkrD,EAAKkb,YAAS3jE,EACdyoD,EAAKmb,MAAQjqE,KAAKkqE,OAClBpb,EAAKqb,MAAQnqE,KAAKoqE,OAClBtb,EAAKub,iBAAmBrqE,KAAKsqE,kBAC7Bxb,EAAKyb,UAAYp7B,EAAUq7B,aAAaxqE,KAAKyqE,YAC7C3b,EAAK4b,UAAYv7B,EAAUq7B,aAAaxqE,KAAK2qE,YAExC3qE,KAAK4qE,SAIN5qE,KAAK4qE,SAAS/pE,OAAOiuD,GAHrB9uD,KAAK4qE,SAAW,IAAIzpC,EAASgO,UAAUhO,EAASsG,OAAQqnB,GAM5DA,GACI+b,QAAU7qE,KAAK4qE,WAEff,EAAoB,CACpB,IAAIiB,EAAqB,IAAI1pC,EAAI2pC,aAAa5pC,EAASsG,OAAQoiC,EAAoBlmE,EAAOC,GACtFimE,IAAuBzoC,EAAI4pC,aAC3Blc,EAAK1H,MAAQ0H,EAAKC,QAAU+b,EAEvBjB,IAAuBzoC,EAAI6pC,UAChCnc,EAAKC,QAAU+b,EAEVjB,IAAuBqB,GAAGC,aAC/Brc,EAAK1H,MAAQ0jB,GAIjB9qE,KAAK2pE,cACL3pE,KAAK2pE,aAAalvC,UAEtBz6B,KAAK2pE,aAAe,IAAIzoC,EAAaE,IAAIgqC,YAAYjqC,EAASsG,OAAQ9jC,EAAOC,EAAQkrD,GAErF9uD,KAAKu7B,QAAS,EACdv7B,KAAK0tB,KAAK,SAUd29C,cAxEyB,SAwEVn8B,EAAS5vC,EAAGoE,GAClBwrC,EAAQo8B,QAEbtrE,KAAK4qE,SAASW,gBACVjsE,EAAAA,EAAGoE,EAAAA,EACHitC,MAAOzB,EAAQo8B,OACf3nE,MAAOurC,EAAQvrC,MACfC,OAAQsrC,EAAQtrC,OAChB4nE,MAAO,EACPt7D,OAAO,EACPm6D,iBAAkBn7B,EAAQo7B,qBAsBlCmB,WAxGyB,SAwGb96D,EAAMrR,EAAGoE,EAAG4vC,EAAGC,GACvB,IAAKvzC,KAAK2pE,eAAiB3pE,KAAK4qE,SAAU,OAAOj6D,EAEjDrR,EAAIA,GAAK,EACToE,EAAIA,GAAK,EACT,IAAIC,EAAQ2vC,GAAKtzC,KAAK2D,MAClBC,EAAS2vC,GAAKvzC,KAAK4D,OACvB+M,EAAOA,GAAS,IAAIwxB,WAAWx+B,EAAQC,EAAS,GAEhD,IAAIsnE,EAAK/pC,EAASuqC,SAASC,QAAQrc,IAC/Bsc,EAASV,EAAGW,aAAaX,EAAGY,qBAMhC,OALAZ,EAAGa,gBAAgBb,EAAGc,YAAahsE,KAAK2pE,aAAasC,OACrDf,EAAGgB,qBAAqBhB,EAAGc,YAAad,EAAGiB,kBAAmBjB,EAAGkB,WAAYpsE,KAAK4qE,SAASqB,MAAO,GAClGf,EAAGO,WAAWnsE,EAAGoE,EAAGC,EAAOC,EAAQsnE,EAAGmB,KAAMnB,EAAGoB,cAAe37D,GAC9Du6D,EAAGa,gBAAgBb,EAAGc,YAAaJ,GAE5Bj7D,GAGX8pB,QA3HyB,WA4HrBz6B,KAAKysC,SACDzsC,KAAK2pE,cACL3pE,KAAK2pE,aAAalvC,aAK9B76B,GAAG8pE,cAAgBvqE,EAAOE,QAAUqqE,+FC5GpC,IAAIvlB,EAAQvkD,GAAGE,OACXb,KAAM,gBACNsC,QAAS3B,GAAG2oB,MAEZC,YAMIw7B,MAAO,KAQP2kB,qBAAiBtiE,KAWzBzG,GAAGmnD,WAAa5C,EAChBhlD,EAAOE,QAAU8kD,2BC7BjB,IAAIooB,EAAS3sE,GAAGE,OACZb,KAAM,YACNsC,QAAS3B,GAAG2oB,QAGhB3oB,GAAG4sE,QAAUD,EAUb,IAAIE,EAAa7sE,GAAGE,OAChBb,KAAM,gBACNsC,QAASgrE,IAGb3sE,GAAG8sE,YAAcD,EASjB,IAAIE,EAAe/sE,GAAGE,OAClBb,KAAM,kBACNsC,QAASgrE,IAGb3sE,GAAGgtE,cAAgBD,EASnB,IAAIE,EAAajtE,GAAGE,OAChBb,KAAM,gBACNsC,QAASgrE,IAGb3sE,GAAGktE,YAAcD,2BClDjB,IAAIE,EAAcntE,GAAGE,OACjBb,KAAM,iBACNsC,QAAS3B,GAAG2oB,MACZC,YACIwkD,eACIvkD,aASRwkD,WAAY,WACR,IAAI1oB,EAAOD,OAAOC,KAAKvkD,KAAKgtE,eAC5B,GAAIzoB,EAAK/kD,OAAS,EAAG,CACjB,IAAI2pB,EAAcnpB,KAAKgtE,cAAczoB,EAAK,IAC1C,OAAOp7B,EAAcA,EAAY8jD,aAAe,KAGhD,OAAO,MAUfC,eAAgB,SAAUxnB,GACtB,IAAIynB,EAAKntE,KAAKgtE,cAActnB,GAC5B,OAAKynB,GAGAA,EAAGluE,OACJkuE,EAAGluE,KAAOymD,GAEPynB,GALI,MAafC,gBAAiB,WACb,IAAInkD,KACAD,EAAehpB,KAAKgtE,cAExB,IAAK,IAAItnB,KAAO18B,EACZC,EAAOvjB,KAAK1F,KAAKktE,eAAexnB,IAGpC,OAAOz8B,KAIfrpB,GAAGmtE,YAAcA,EACjB5tE,EAAOE,QAAW0tE,2BCjElB,IAAMn1C,EAAcl4B,EAAQ,yBACtB2tE,EAAc3tE,EAAQ,yBAOxB4tE,IAAav3C,EAAG,EAAGvH,EAAG,IAAKuH,EAAG,EAAGvH,EAAG,IAAKuH,EAAG,EAAGvH,EAAG,IAAKuH,EAAG,EAAGvH,EAAG,IA2BhEq5C,EAAcjoE,GAAGE,OACjBb,KAAM,iBACNsC,QAAS7B,EAAQ,qBACjB0nE,QAASxvC,GAETpP,YAEI+kD,gBACIzhD,IAAK,SAAUojB,GACPA,IAMIlvC,KAAK4qE,WAAa17B,GAClBlvC,KAAKwtE,gBAAgBt+B,GAEzBlvC,KAAKytE,iBAAmBv+B,EAAQxT,OAsB5CgyC,UACI/kD,IAAK,WACD,OAAO3oB,KAAK2tE,WAzEV,IA2EN7hD,IAAK,SAAU/nB,GACX/D,KAAK2tE,WA5EH,GA4E2B5pE,EACzB/D,KAAK4qE,UACL5qE,KAAK4tE,uBAYjBC,aACIllD,IAAK,WACD,OAAO3oB,KAAK2tE,WA1FP,IA4FT7hD,IAAK,SAAU/nB,GACX/D,KAAK2tE,WA7FA,GA6F2B5pE,EAC5B/D,KAAK4qE,UACL5qE,KAAK4tE,uBAYjBE,WACInlD,IAAK,WACD,OAAO3oB,KAAK2tE,WAhHT,IAkHP7hD,IAAK,SAAU/nB,GACX/D,KAAK2tE,WAnHF,GAmH2B5pE,EAC1B/D,KAAK4qE,UACL5qE,KAAK4tE,uBAYjBG,YACIplD,IAAK,WACD,OAAO3oB,KAAK2tE,WAjIR,IAmIR7hD,IAAK,SAAU/nB,GACX/D,KAAK2tE,WApID,GAoI2B5pE,EAC3B/D,KAAK4qE,UACL5qE,KAAK4tE,wBAkBrB7tE,KAAM,WAEF63B,EAAYr1B,KAAKvC,MAEjB,IAAIinE,EAAW/0D,UAAU,GACrBtP,EAAOsP,UAAU,GACjB87D,EAAU97D,UAAU,GACpBkoB,EAASloB,UAAU,GACnB+7D,EAAe/7D,UAAU,GAG7BlS,KAAKkuE,MAAQ,KAGbluE,KAAKmuE,QAAU,KAGfnuE,KAAKouE,cAAgB,KAErBpuE,KAAKquE,UAAW,EAEhBruE,KAAKsuE,SAAW,KAEhBtuE,KAAK2tE,YAAc,EAAG,EAAG,EAAG,GAE5B3tE,KAAKuuE,MACLvuE,KAAKwuE,YAELxuE,KAAK4qE,SAAW,KAChB5qE,KAAKytE,iBAAmB,GAGxBztE,KAAKyuE,UAAY,UAOApoE,IAAb4gE,GACAjnE,KAAK0uE,WAAWzH,EAAUrkE,EAAMorE,EAAS5zC,EAAQ6zC,IAYzDU,cAAe,WACX,OAAO3uE,KAAK4qE,UAAY5qE,KAAK4qE,SAASrvC,QAS1CqzC,UAAW,WACP,OAAO5uE,KAAKquE,UAShBQ,WAAY,SAAUC,GAClB9uE,KAAKquE,SAAWS,EACZ9uE,KAAK4qE,UACL5qE,KAAK+uE,gBASbC,QAAS,WACL,OAAOpvE,GAAGgD,KAAK5C,KAAKkuE,QASxBe,QAAS,SAAUrsE,GACf5C,KAAKkuE,MAAQtrE,EACT5C,KAAK4qE,UACL5qE,KAAK+uE,gBASbG,gBAAiB,WACb,OAAOtvE,GAAGqvC,KAAKjvC,KAAKouE,gBASxBe,gBAAiB,SAAUlgC,GAClBjvC,KAAKouE,eAGNpuE,KAAKouE,cAAczqE,MAAQsrC,EAAKtrC,MAChC3D,KAAKouE,cAAcxqE,OAASqrC,EAAKrrC,QAHjC5D,KAAKouE,cAAgBxuE,GAAGqvC,KAAKA,IAarCg+B,WAAY,WACR,OAAOjtE,KAAK4qE,UAGhBwE,uBAjQoD,WAkQhD,IACIlgC,EAAUlvC,KAAK4qE,SACnB,GAAK17B,EAAL,CAIA,IAAIoE,EAAIpE,EAAQvrC,MAAO4vC,EAAIrE,EAAQtrC,OANxB5D,KAQFquE,UAAYzuE,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,qBARzC7pD,KAWFquE,UAAW,EAChB/6B,EAZOtzC,KAYE4qE,SAASjnE,MAClB4vC,EAbOvzC,KAaE4qE,SAAShnE,OAbX5D,KAcFkuE,MAAQtuE,GAAGgD,KAAK,EAAG,EAAG0wC,EAAGC,IAdvBvzC,KAiBFkuE,MAjBEluE,KAkBFqvE,WAlBErvE,KAkBc4qE,UAlBd5qE,KAqBFkuE,MAAQtuE,GAAGgD,KAAK,EAAG,EAAG0wC,EAAGC,GArBvBvzC,KAwBDouE,eAxBCpuE,KAyBFmvE,gBAAgBvvE,GAAGqvC,KAAKqE,EAAGC,IAzBzBvzC,KA4BDmuE,SA5BCnuE,KA6BFsvE,UAAU1vE,GAAGqE,GAAG,EAAG,IA7BjBjE,KAgCN+uE,eAhCM/uE,KAmCN0tB,KAAK,UASd8/C,gBAAiB,SAAUt+B,GACvBlvC,KAAK4qE,SAAW17B,EACZA,EAAQ3T,OACRv7B,KAAKovE,yBAGLlgC,EAAQ9gB,KAAK,OAAQpuB,KAAKovE,uBAAwBpvE,OAU1DuvE,UAAW,WACP,OAAO3vE,GAAGqE,GAAGjE,KAAKmuE,UAStBmB,UAAW,SAAUE,GACjBxvE,KAAKmuE,QAAUvuE,GAAGqE,GAAGurE,IASzBnvE,MAAO,WACH,OAAO,IAAIwnE,EAAY7nE,KAAK4qE,UAAY5qE,KAAKytE,iBAAkBztE,KAAKkuE,MAAOluE,KAAKquE,SAAUruE,KAAKmuE,QAASnuE,KAAKouE,gBAcjHM,WAAY,SAAUe,EAAsB7sE,EAAMorE,EAAS5zC,EAAQ6zC,GAE3DjuE,KAAKkuE,MADLtrE,GAIa,KAGbw3B,EACAp6B,KAAKsvE,UAAUl1C,GAGfp6B,KAAKmuE,QAAU,KAGfF,EACAjuE,KAAKmvE,gBAAgBlB,GAGrBjuE,KAAKouE,cAAgB,KAGzBpuE,KAAKquE,SAAWL,IAAW,EAG3B,IAAI9+B,EAAUugC,EASd,MARuB,iBAAZvgC,GAAwBA,IAC/BlvC,KAAKytE,iBAAmBv+B,EACxBlvC,KAAK0vE,gBAELxgC,aAAmBtvC,GAAGuvC,WAAanvC,KAAK4qE,WAAa17B,GACrDlvC,KAAKwtE,gBAAgBt+B,IAGlB,GAGXwgC,aAAc,WACV,GAAI1vE,KAAKytE,iBAAkB,CACvB,IAAIv+B,EAAUm+B,EAAYsC,UAAU3vE,KAAKytE,kBACzCztE,KAAKwtE,gBAAgBt+B,KAsB7B0gC,kBAAmB,WACX5vE,KAAK4qE,SACA5qE,KAAK4qE,SAASrvC,SAEfv7B,KAAKwtE,gBAAgBxtE,KAAK4qE,UAC1ByC,EAAYwC,gBAAgB7vE,KAAK4qE,WAGhC5qE,KAAKytE,kBAEVztE,KAAK0vE,gBAiBbI,aAAc,WACV9vE,KAAK4qE,SAAW,MAGpByE,WAAY,SAAUngC,GAClB,IAAItsC,EAAO5C,KAAKkuE,MACZ6B,EAAOntE,EAAKtD,EAAG0wE,EAAOptE,EAAKc,EAC3B1D,KAAKquE,UACL0B,GAAQntE,EAAKgB,OACbosE,GAAQptE,EAAKe,QAGbosE,GAAQntE,EAAKe,MACbqsE,GAAQptE,EAAKgB,QAEbmsE,EAAO7gC,EAAQvrC,OACf/D,GAAGyC,QAAQ,KAAM6sC,EAAQxT,IAAM,IAAM17B,KAAKf,KAAM8wE,EAAM7gC,EAAQvrC,OAE9DqsE,EAAO9gC,EAAQtrC,QACfhE,GAAGyC,QAAQ,KAAM6sC,EAAQxT,IAAM,IAAM17B,KAAKf,KAAM+wE,EAAM9gC,EAAQtrC,SAItEgqE,mBAjdoD,WAkdhD,IAAIhrE,EAAO5C,KAAKkuE,MACZ+B,EAAajwE,KAAK4qE,SAASjnE,MAC3BusE,EAAclwE,KAAK4qE,SAAShnE,OAC5BusE,EAAYnwE,KAAK2tE,WArfV,GAsfPyC,EAAapwE,KAAK2tE,WApfV,GAqfR0C,EAAcztE,EAAKe,MAAQwsE,EAAYC,EACvCE,EAAYtwE,KAAK2tE,WAvfX,GAwfN4C,EAAevwE,KAAK2tE,WAtfX,GAufT6C,EAAe5tE,EAAKgB,OAAS0sE,EAAYC,EAEzC/B,EAAWxuE,KAAKwuE,SAEpB,GADAA,EAAShvE,OAAS,EACdQ,KAAKquE,SAAU,CACff,EAAS,GAAGv3C,EAAKnzB,EAAKtD,EAAK2wE,EAC3B3C,EAAS,GAAGv3C,GAAKnzB,EAAKtD,EAAIixE,GAAgBN,EAC1C3C,EAAS,GAAGv3C,GAAKnzB,EAAKtD,EAAIixE,EAAeC,GAAgBP,EACzD3C,EAAS,GAAGv3C,GAAKnzB,EAAKtD,EAAIsD,EAAKgB,QAAUqsE,EACzC3C,EAAS,GAAG9+C,EAAK5rB,EAAKc,EAAKwsE,EAC3B5C,EAAS,GAAG9+C,GAAK5rB,EAAKc,EAAIysE,GAAaD,EACvC5C,EAAS,GAAG9+C,GAAK5rB,EAAKc,EAAIysE,EAAYE,GAAeH,EACrD5C,EAAS,GAAG9+C,GAAK5rB,EAAKc,EAAId,EAAKe,OAASusE,EAExC,IAAK,IAAIO,EAAM,EAAGA,EAAM,IAAKA,EAEzB,IADA,IAAIC,EAAOpD,EAASmD,GACXE,EAAM,EAAGA,EAAM,IAAKA,EAAK,CAC9B,IAAIC,EAAOtD,EAAS,EAAIqD,GACxBnC,EAAS9oE,MACLqwB,EAAG26C,EAAK36C,EACRvH,EAAGoiD,EAAKpiD,SAKnB,CACD8+C,EAAS,GAAGv3C,EAAKnzB,EAAKtD,EAAK2wE,EAC3B3C,EAAS,GAAGv3C,GAAKnzB,EAAKtD,EAAI6wE,GAAaF,EACvC3C,EAAS,GAAGv3C,GAAKnzB,EAAKtD,EAAI6wE,EAAYE,GAAeJ,EACrD3C,EAAS,GAAGv3C,GAAKnzB,EAAKtD,EAAIsD,EAAKe,OAASssE,EACxC3C,EAAS,GAAG9+C,EAAK5rB,EAAKc,EAAKwsE,EAC3B5C,EAAS,GAAG9+C,GAAK5rB,EAAKc,EAAI4sE,GAAaJ,EACvC5C,EAAS,GAAG9+C,GAAK5rB,EAAKc,EAAI4sE,EAAYE,GAAgBN,EACtD5C,EAAS,GAAG9+C,GAAK5rB,EAAKc,EAAId,EAAKgB,QAAUssE,EAEzC,IAAK,IAAIW,EAAM,EAAGA,EAAM,IAAKA,EAEzB,IADA,IAAIC,EAAOxD,EAASuD,GACXE,EAAM,EAAGA,EAAM,IAAKA,EAAK,CAC9B,IAAIC,EAAO1D,EAASyD,GACpBvC,EAAS9oE,MACLqwB,EAAGi7C,EAAKj7C,EACRvH,EAAGsiD,EAAKtiD,OAO5BugD,aA1gBoD,WA2gBhD,IAAInsE,EAAO5C,KAAKkuE,MACZh/B,EAAUlvC,KAAK4qE,SACf2D,EAAKvuE,KAAKuuE,GACV0C,EAAO/hC,EAAQvrC,MACfutE,EAAOhiC,EAAQtrC,OAEnB,GAAI5D,KAAKquE,SAAU,CACf,IAAI9sD,EAAa,IAAT0vD,EAAa,EAAIruE,EAAKtD,EAAI2xE,EAC9B/2D,EAAa,IAAT+2D,EAAa,GAAKruE,EAAKtD,EAAIsD,EAAKgB,QAAUqtE,EAC9C/kE,EAAa,IAATglE,EAAa,GAAKtuE,EAAKc,EAAId,EAAKe,OAASutE,EAC7C9pE,EAAa,IAAT8pE,EAAa,EAAItuE,EAAKc,EAAIwtE,EAClC3C,EAAG,GAAKhtD,EACRgtD,EAAG,GAAKnnE,EACRmnE,EAAG,GAAKhtD,EACRgtD,EAAG,GAAKriE,EACRqiE,EAAG,GAAKr0D,EACRq0D,EAAG,GAAKnnE,EACRmnE,EAAG,GAAKr0D,EACRq0D,EAAG,GAAKriE,MAEP,CACD,IAAI8Y,EAAa,IAATisD,EAAa,EAAIruE,EAAKtD,EAAI2xE,EAC9BE,EAAa,IAATF,EAAa,GAAKruE,EAAKtD,EAAIsD,EAAKe,OAASstE,EAC7C1S,EAAa,IAAT2S,EAAa,GAAKtuE,EAAKc,EAAId,EAAKgB,QAAUstE,EAC9CxO,EAAa,IAATwO,EAAa,EAAItuE,EAAKc,EAAIwtE,EAClC3C,EAAG,GAAKvpD,EACRupD,EAAG,GAAKhQ,EACRgQ,EAAG,GAAK4C,EACR5C,EAAG,GAAKhQ,EACRgQ,EAAG,GAAKvpD,EACRupD,EAAG,GAAK7L,EACR6L,EAAG,GAAK4C,EACR5C,EAAG,GAAK7L,EAGZ,IAAI4L,EAAWtuE,KAAKsuE,SACpB,GAAIA,EAAU,CACVA,EAAS8C,GAAG5xE,OAAS,EACrB8uE,EAAS+C,GAAG7xE,OAAS,EACrB,IAAK,IAAID,EAAI,EAAGA,EAAI+uE,EAASv4C,EAAEv2B,OAAQD,IACnC+uE,EAAS8C,GAAG7xE,GAAK+uE,EAASv4C,EAAEx2B,GAAG0xE,EAC/B3C,EAAS+C,GAAG9xE,GAAK+uE,EAAS9/C,EAAEjvB,GAAG2xE,EAIvClxE,KAAK4tE,sBAKTliC,YAAYC,EA2CZC,aAAc,SAAUj7B,EAAMk7B,GAC1B,IAAIjpC,EAAO+N,EAAK/N,KACZA,IACA5C,KAAKkuE,MAAQ,IAAItuE,GAAG6D,KAAKb,EAAK,GAAIA,EAAK,GAAIA,EAAK,GAAIA,EAAK,KAEzD+N,EAAKypB,QACLp6B,KAAKsvE,UAAU,IAAI1vE,GAAGyE,KAAKsM,EAAKypB,OAAO,GAAIzpB,EAAKypB,OAAO,KAEvDzpB,EAAKs9D,cACLjuE,KAAKmvE,gBAAgB,IAAIvvE,GAAGy1D,KAAK1kD,EAAKs9D,aAAa,GAAIt9D,EAAKs9D,aAAa,KAE7EjuE,KAAKquE,SAA4B,IAAjB19D,EAAKq9D,QACrBhuE,KAAKstB,MAAQ3c,EAAK1R,KAElB,IAAIqyE,EAAY3gE,EAAK2gE,UACjBA,IACAtxE,KAAK2tE,WAxpBE,GAwpBuB2D,EAxpBvB,GAypBPtxE,KAAK2tE,WAxpBC,GAwpBuB2D,EAxpBvB,GAypBNtxE,KAAK2tE,WAxpBG,GAwpBuB2D,EAxpBvB,GAypBRtxE,KAAK2tE,WAxpBI,GAwpBuB2D,EAxpBvB,IA+pBbtxE,KAAKsuE,SAAW39D,EAAK29D,SACjBtuE,KAAKsuE,WAELtuE,KAAKsuE,SAAS8C,MACdpxE,KAAKsuE,SAAS+C,OAIlB,IAAIE,EAAc5gE,EAAKu+B,QACnBqiC,GACA1lC,EAAOv3B,OAAO5O,KAAK1F,KAAM,iBAAkBuxE,MAKnD5jD,EAAQk6C,EAAYvlE,UAExBqrB,EAAM6jD,aAAe7jD,EAAMttB,MAC3BstB,EAAMumB,KAAOvmB,EAAMttB,MACnBstB,EAAM8jD,gBAAkB9jD,EAAM+gD,WAE9B9uE,GAAGioE,YAAcA,EAEjB1oE,EAAOE,QAAUwoE,wGC7rBjB,IAAMF,EAAOjoE,EAAQ,YAYjBgyE,EAAU9xE,GAAGE,OACbb,KAAM,aACNsC,QAASomE,EAETn/C,YACImpD,YAAa,KACbj4C,cACIhR,KAAM9oB,GAAGgyE,OACTjpD,IAFU,WAGN,OAAO3oB,KAAK2xE,aAEhB7lD,IALU,SAKL/nB,GACD/D,KAAK2xE,YAAc5tE,GAAS,SAEhCsoC,UAAU,MAKtBzsC,GAAG8xE,QAAUvyE,EAAOE,QAAUqyE,wCCzB9B,IAAIG,EAAYjyE,GAAGE,OACfb,KAAM,eACNsC,QAAS3B,GAAG2oB,MACZC,YAIIspD,KAAM,IAGVjL,SAVqB,WAWjB,OAAO7mE,KAAK8xE,QAIpB3yE,EAAOE,QAAUO,GAAGiyE,UAAYA,2BCrBhC,IAAMj6C,EAAcl4B,EAAQ,yBACtBwhC,EAAexhC,EAAQ,6BACvByhC,EAAWzhC,EAAQ,eACzBA,EAAQ,uBACR,IAAM0hC,EAAMF,EAAaE,IAWrB0gC,EAAc,IAAKpiE,EAAQ,4BAAb,CAA0C,OAqBtD2vC,EAAczvC,GAAG43B,MAOnBu6C,OAAQ3wC,EAAI4wC,qBAOZC,OAAQ7wC,EAAI8wC,wBAOZC,SAAU/wC,EAAIgxC,wBAOdC,OAAQjxC,EAAIkxC,iBAOZC,SAAUnxC,EAAIoxC,kBAOdljC,QAASlO,EAAIqxC,oBAObC,GAAItxC,EAAIuxC,eAORC,GAAIxxC,EAAIyxC,eAORC,IAAK1xC,EAAI2xC,kBAQTC,iBAAkB5xC,EAAI6xC,6BAOtBC,kBAAmB9xC,EAAI+xC,8BAOvBC,iBAAkBhyC,EAAIiyC,6BAOtBC,kBAAmBlyC,EAAImyC,gCAOrBlrD,EAAWzoB,GAAG43B,MAOhBg8C,OAtIc,MA6IdC,cA5IqB,MAmJrBC,gBAlJuB,QAyJrBC,EAAS/zE,GAAG43B,MAOdo8C,OAnKc,KA0KdC,QA3Ke,OA8KbC,GACFC,KAAM,EACNC,KAAM,GAGNC,KACAC,GACAvwE,WAAO0C,EACPzC,YAAQyC,EACRkkE,eAAWlkE,EACXqkE,eAAWrkE,EACX4jE,WAAO5jE,EACP8jE,WAAO9jE,EACP0jE,YAAQ1jE,EACR8tE,YAAQ9tE,EACR2jE,YAAQ3jE,EACRsqC,WAAOtqC,EACP6J,WAAO7J,EACPgkE,sBAAkBhkE,GAEtB,SAAS+tE,IACL,IAAK,IAAI1uB,KAAOwuB,EACZA,EAAYxuB,QAAOr/C,EAKvB,OAHA4tE,EAAQz0E,OAAS,EACjB00E,EAAYlK,OAASiK,EACrBC,EAAYhkE,OAAQ,EACbgkE,EAUX,IAAI/kC,EAAYvvC,GAAGE,OACfb,KAAM,eACNsC,QAAS7B,EAAQ,qBACjB0nE,QAASxvC,GAETpP,YACIkR,cACI/Q,IADU,WAGN,OAAO3oB,KAAKsrE,QAEhBx/C,IALU,SAKLnb,GACGA,EAAK0jE,aAAe1jE,EAAKG,MACzB9Q,KAAKovC,aAAaz+B,EAAKG,MAAO9Q,KAAK42C,QAASjmC,EAAKhN,MAAOgN,EAAK/M,QAG7D5D,KAAKs0E,gBAAgB3jE,IAG7B07B,UAAU,GAEdkoC,YAAY,EACZ39B,QAASvH,EAAYkjC,SACrBjI,mBAAmB,EACnBkK,QAAQ,EACR/J,WAAYkJ,EAAOC,OACnBjJ,WAAYgJ,EAAOC,OACnB1J,OAAQ7hD,EAASorD,cACjBrJ,OAAQ/hD,EAASorD,eAGrB3qD,SACIumB,YAAaA,EACbhnB,SAAUA,EACVsrD,OAAQA,EACRnJ,aAAcsJ,EAGdW,UAAW,OAAQ,OAAQ,QAAS,OAAQ,QAAS,OAAQ,QAE7DC,cATK,SASUxlC,GACX,OAAOA,EAAQ0H,SAAWvH,EAAY2jC,kBAAoB9jC,EAAQ0H,SAAWvH,EAAYikC,oBAIjGvzE,KA7CqB,WA+CjBC,KAAK4f,IAAMkiD,EAAYoD,WAYvBllE,KAAK07B,IAAM,GAUX17B,KAAKu7B,QAAS,EASdv7B,KAAK2D,MAAQ,EASb3D,KAAK4D,OAAS,EAEd5D,KAAK4qE,SAAW,MAcpB+J,QAvGqB,WAwGjB,OAAO30E,KAAK4qE,UAGhBgK,MA3GqB,WA4GjB,OAAO50E,KAAK4f,KAGhBinD,SA/GqB,WAgHjB,OAAO7mE,KAAK07B,KAAO,IAiBvB76B,OAjIqB,SAiIbg0E,GACJ,GAAIA,EAAS,CACT,IAAIC,GAAY,OACMzuE,IAAlBwuE,EAAQlxE,QACR3D,KAAK2D,MAAQkxE,EAAQlxE,YAEF0C,IAAnBwuE,EAAQjxE,SACR5D,KAAK4D,OAASixE,EAAQjxE,aAEAyC,IAAtBwuE,EAAQtK,YACRvqE,KAAKyqE,WAAaoK,EAAQtK,UAC1BsK,EAAQtK,UAAYuJ,EAAYe,EAAQtK,iBAElBlkE,IAAtBwuE,EAAQnK,YACR1qE,KAAK2qE,WAAakK,EAAQnK,UAC1BmK,EAAQnK,UAAYoJ,EAAYe,EAAQnK,iBAEtBrkE,IAAlBwuE,EAAQ5K,QACRjqE,KAAKkqE,OAAS2K,EAAQ5K,YAEJ5jE,IAAlBwuE,EAAQ1K,QACRnqE,KAAKoqE,OAASyK,EAAQ1K,YAEH9jE,IAAnBwuE,EAAQ9K,SACR/pE,KAAK42C,QAAUi+B,EAAQ9K,aAEL1jE,IAAlBwuE,EAAQ3kE,QACRlQ,KAAKw0E,OAASK,EAAQ3kE,MACtB4kE,GAAY,QAEiBzuE,IAA7BwuE,EAAQxK,mBACRrqE,KAAKsqE,kBAAoBuK,EAAQxK,iBACjCyK,GAAY,QAEOzuE,IAAnBwuE,EAAQV,SACRn0E,KAAKu0E,WAAaM,EAAQV,QAG1BW,GAAa90E,KAAKsrE,SAClBuJ,EAAQlkC,MAAQ3wC,KAAKsrE,QAErBuJ,EAAQ7K,QAAU6K,EAAQ7K,OAAOxqE,OAAS,EAC1CQ,KAAKsrE,OAASuJ,EAAQ7K,OAAO,QAEN3jE,IAAlBwuE,EAAQlkC,QACb3wC,KAAKsrE,OAASuJ,EAAQlkC,MACjBkkC,EAAQ7K,SACTiK,EAAQz0E,OAAS,EACjBq1E,EAAQ7K,OAASiK,GAGrBY,EAAQ7K,OAAOtkE,KAAKmvE,EAAQlkC,QAG5BkkC,EAAQ7K,QAAU6K,EAAQ7K,OAAOxqE,OAAS,GAC1CQ,KAAK4qE,SAAS/pE,OAAOg0E,KAgBjCP,gBAxMqB,SAwMJj1D,GACb,GAAKA,EAGL,GADArf,KAAKsrE,OAASjsD,EACoBA,EAAQioD,UAAYjoD,aAAmB01D,kBACrE/0E,KAAKg1E,0BAEJ,CACD,IAAIzmD,EAAOvuB,KACXqf,EAAQga,iBAAiB,OAAQ,WAC7B9K,EAAKymD,wBAET31D,EAAQga,iBAAiB,QAAS,SAAU4B,GACxCr7B,GAAGu+B,OAAO,KAAMlD,EAAIurB,aAgBhCpX,aArOqB,SAqOPz+B,EAAMskE,EAAaC,EAAaC,GAC1C,IAAIrmB,EAAOslB,IAwBX,OAvBAtlB,EAAKne,MAAQhgC,EAEbm+C,EAAKkb,QAAUlb,EAAKne,OACpBme,EAAKsmB,UAAYp1E,KAAKu0E,WACtBzlB,EAAKub,iBAAmBrqE,KAAKsqE,kBAC7Bxb,EAAK5+C,MAAQlQ,KAAKw0E,OAClB1lB,EAAKyb,UAAYuJ,EAAY9zE,KAAKyqE,YAClC3b,EAAK4b,UAAYoJ,EAAY9zE,KAAK2qE,YAClC7b,EAAKmb,MAAQjqE,KAAKkqE,OAClBpb,EAAKqb,MAAQnqE,KAAKoqE,OAClBtb,EAAKib,OAASkL,EACdnmB,EAAKnrD,MAAQuxE,EACbpmB,EAAKlrD,OAASuxE,EACTn1E,KAAK4qE,SAIN5qE,KAAK4qE,SAAS/pE,OAAOiuD,GAHrB9uD,KAAK4qE,SAAW,IAAIzpC,EAASgO,UAAUhO,EAASsG,OAAQqnB,GAK5D9uD,KAAK2D,MAAQuxE,EACbl1E,KAAK4D,OAASuxE,EACdn1E,KAAKu7B,QAAS,EACdv7B,KAAK0tB,KAAK,SACH,GAUX2nD,kBAxQqB,WAyQjB,OAAOr1E,KAAKsrE,QAchB7wC,QAvRqB,WAwRjBz6B,KAAKsrE,OAAS,KACdtrE,KAAK4qE,UAAY5qE,KAAK4qE,SAASnwC,UAG/Bz6B,KAAKysC,UAUT6oC,eAtSqB,WAwSjB,OAAOt1E,KAAK42C,SAUhB2+B,sBAlTqB,WAmTjB,OAAOv1E,KAAKsqE,oBAAqB,GAUrC8K,UA7TqB,WA8TjB,OAAOp1E,KAAKu0E,aAAc,GAW9BS,oBAzUqB,WA0UjB,GAAKh1E,KAAKsrE,QAAWtrE,KAAKsrE,OAAO3nE,OAAU3D,KAAKsrE,OAAO1nE,OAAvD,CAGA5D,KAAK2D,MAAQ3D,KAAKsrE,OAAO3nE,MACzB3D,KAAK4D,OAAS5D,KAAKsrE,OAAO1nE,OAC1B,IAAIkrD,EAAOslB,IACXtlB,EAAKne,MAAQ3wC,KAAKsrE,OAElBxc,EAAKkb,QAAUlb,EAAKne,OACpBme,EAAKnrD,MAAQ3D,KAAK2D,MAClBmrD,EAAKlrD,OAAS5D,KAAK4D,OACnBkrD,EAAKsmB,UAAYp1E,KAAKu0E,WACtBzlB,EAAKib,OAAS/pE,KAAK42C,QACnBkY,EAAKub,iBAAmBrqE,KAAKsqE,kBAC7Bxb,EAAK5+C,MAAQlQ,KAAKw0E,OAClB1lB,EAAKyb,UAAYuJ,EAAY9zE,KAAKyqE,YAClC3b,EAAK4b,UAAYoJ,EAAY9zE,KAAK2qE,YAClC7b,EAAKmb,MAAQjqE,KAAKkqE,OAClBpb,EAAKqb,MAAQnqE,KAAKoqE,OAEbpqE,KAAK4qE,SAIN5qE,KAAK4qE,SAAS/pE,OAAOiuD,GAHrB9uD,KAAK4qE,SAAW,IAAIzpC,EAASgO,UAAUhO,EAASsG,OAAQqnB,GAO5D9uD,KAAKu7B,QAAS,EACdv7B,KAAK0tB,KAAK,QAEN9tB,GAAGiI,MAAM0nD,qBAAuBvvD,KAAKsrE,kBAAkBkK,mBAGvDx1E,KAAKsrE,OAAOpzC,IAAM,GAElBt4B,GAAG47B,OAAOi6C,WAAWz1E,KAAKsrE,OAAOjzC,OAWzCq9C,YAzXqB,WA0XjB,MAAO,0BAA4B11E,KAAK07B,IAAM,mBAAqB17B,KAAK2D,MAAQ,MAAQ3D,KAAK4D,OAAS,KAU1G+xE,eApYqB,WAqYjB31E,KAAKsrE,OAAS,KACdtrE,KAAK4qE,UAAY5qE,KAAK4qE,SAASnwC,WAYnCm7C,YAlZqB,SAkZR3L,EAAOE,GAChB,GAAInqE,KAAKkqE,SAAWD,GAASjqE,KAAKoqE,SAAWD,EAAO,CAChD,IAAIrb,EAAOslB,IACXtlB,EAAKmb,MAAQA,EACbnb,EAAKqb,MAAQA,EACbnqE,KAAKa,OAAOiuD,KAWpB+mB,WAlaqB,SAkaTtL,EAAWG,GACnB,GAAI1qE,KAAKyqE,aAAeF,GAAavqE,KAAK2qE,aAAeD,EAAW,CAChE,IAAI5b,EAAOslB,IACXtlB,EAAKyb,UAAYA,EACjBzb,EAAK4b,UAAYA,EACjB1qE,KAAKa,OAAOiuD,KAWpBgnB,SAlbqB,SAkbX5lE,GACN,GAAIlQ,KAAKw0E,SAAWtkE,EAAO,CACvB,IAAI4+C,EAAOslB,IACXtlB,EAAK5+C,MAAQA,EACblQ,KAAKa,OAAOiuD,KAWpBinB,oBAjcqB,SAicAC,GACjB,GAAIh2E,KAAKsqE,oBAAsB0L,EAAa,CACxC,IAAIlnB,EAAOslB,IACXtlB,EAAKub,iBAAmB2L,EACxBh2E,KAAKa,OAAOiuD,KAWpBmnB,UAhdqB,SAgdV9B,GACP,GAAIn0E,KAAKu0E,aAAeJ,EAAQ,CAC5B,IAAIrlB,EAAOslB,IACXtlB,EAAKsmB,UAAYjB,EACjBn0E,KAAKa,OAAOiuD,KAMpBpjB,YAA0BwqC,EAiC1BtqC,aAAc,SAAUj7B,EAAMk7B,GAC1B,IAAIsqC,EAASxlE,EAAKmT,MAAM,KAEpBsyD,EAAWD,EAAO,GACtB,GAAIC,EAAU,CAOV,IANA,IAAIC,EAASD,EAAStyD,MAAM,KAExBwyD,EAAQ,IACRtnC,EAAM,GACN+6B,EAAS/pE,KAAK42C,QACd2/B,EAAwB32E,GAAGiI,MAAM2uE,wBAC5Bj3E,EAAI,EAAGA,EAAI82E,EAAO72E,OAAQD,IAAK,CACpC,IAAIk3E,EAAYJ,EAAO92E,GAAGukB,MAAM,KAC5B4yD,EAASD,EAAU,GACvBC,EAASA,EAAOnQ,WAAW,GAttBvB,GAutBJmQ,EAASvnC,EAAUslC,SAASiC,IAAWD,EAEvC,IAAIp1D,EAAQk1D,EAAsB5yD,QAAQ+yD,IAC3B,IAAXr1D,GAAgBA,EAAQi1D,IACxBA,EAAQj1D,EACR2tB,EAAM0nC,EACN3M,EAAS0M,EAAU,GAAK1wD,SAAS0wD,EAAU,IAAMz2E,KAAK42C,SAI1D5H,IACAhvC,KAAKgnE,aAAah4B,GAClBhvC,KAAK42C,QAAUmzB,GAInB,IAAI4M,EAAc9qC,EAAO+qC,UACrBjyB,EAAOgyB,GAAeA,EAAYhyB,KACtC,GAAIA,EAAM,CACN3kD,KAAKgnD,MAAQrC,EACb,IAAIjpB,EAAM17B,KAAK27B,UACf37B,KAAK07B,IAAMA,GAGG,IAAlBy6C,EAAO32E,SAEPQ,KAAKyqE,WAAa1kD,SAASowD,EAAO,IAClCn2E,KAAK2qE,WAAa5kD,SAASowD,EAAO,IAElCn2E,KAAKkqE,OAASnkD,SAASowD,EAAO,IAC9Bn2E,KAAKoqE,OAASrkD,SAASowD,EAAO,IAE9Bn2E,KAAKsqE,kBAtvBG,KAsvBiB6L,EAAO,GAAG5P,WAAW,OAc1D3mE,GAAGuvC,UAAYhwC,EAAOE,QAAU8vC,uLCjxBhCzvC,EAAQ,gBACRA,EAAQ,aACRA,EAAQ,YACRA,EAAQ,cACRA,EAAQ,iBACRA,EAAQ,eACRA,EAAQ,kBACRA,EAAQ,mBACRA,EAAQ,iBACRA,EAAQ,qBACRA,EAAQ,eACRA,EAAQ,mBACRA,EAAQ,kBACRA,EAAQ,kBACRA,EAAQ,iBACRA,EAAQ,iBACRA,EAAQ,0WChBIA,EAAQ,aAAa+5C,UAAjC,IAQIo9B,EAAaC,GACbC,EAAWC,EAEXC,EAAYr3E,GAAG43B,MACf0/C,KAAM,EACNC,iBAAkB,EAClBC,OAAQ,IAIZ,SAASC,EAAqB1yE,GAC1B,OAAIA,aAAkB/E,GAAGukD,MACoCvkD,GAAGkqE,YAGrDnlE,EAAOywD,aAItB,SAASkiB,EAA8BC,EAAYr3E,EAAQs3E,EAAsBC,GAK7E,IAJA,IAAI9nE,EAAS4nE,EAAW18B,QAAQP,OAAOh7C,EACnC2Q,EAASsnE,EAAW18B,QAAQP,OAAO52C,EACnCg0E,EAAa,EACbC,EAAa,EACRlzC,EAAO8yC,EAAW18B,UAAW,CAClC,IAAIz1C,EAAMq/B,EAAK4V,UAIf,GAHAq9B,GAActyE,EAAI9F,EAClBq4E,GAAcvyE,EAAI1B,IAClB+gC,EAAOA,EAAKoW,SAKR,OAFA28B,EAAqBl4E,EAAIk4E,EAAqB9zE,EAAI,OAClD+zE,EAAiBn4E,EAAIm4E,EAAiB/zE,EAAI,GAG9C,GAAI+gC,IAASvkC,EAST,MARA,IAAIqX,EAAKktB,EAAK6V,OAAOh7C,EACjBkY,EAAKitB,EAAK6V,OAAO52C,EACrBg0E,GAAcngE,EACdogE,GAAcngE,EACd7H,GAAU4H,EACVtH,GAAUuH,EAMlBigE,EAAiBn4E,EAAe,IAAXqQ,EAAgB,EAAIA,EAAU,EACnD8nE,EAAiB/zE,EAAe,IAAXuM,EAAgB,EAAIA,EAAU,EACnDunE,EAAqBl4E,GAAKo4E,EAC1BF,EAAqB9zE,GAAKi0E,EAG9B,IAAIC,EAAoBh4E,GAAGyE,KAAKC,KAC5BuzE,EAAgBj4E,GAAGyE,KAAKyzE,IAG5B,SAASC,EAAOtzC,EAAMuzC,GAClB,IACI93E,EACA+3E,EAAkBC,EAFlBC,EAAYH,EAAOxqD,QAGnB2qD,EAIAb,EAA6B7yC,EAH7BvkC,EAASi4E,EACTF,EAAmBL,EACnBM,EAAeL,GAIf33E,EAASukC,EAAKoW,QAElB,IAAIu9B,EAAaf,EAAoBn3E,GACjCm4E,EAAen4E,EAAOo1D,aAEtBgjB,EAAuBp4E,aAAkBN,GAAGukD,MAC5C7kD,EAAImlC,EAAK4V,UAAU/6C,EAAGoE,EAAI+gC,EAAK4V,UAAU32C,EACzC60E,EAAS9zC,EAAK6wB,aAElB,GAAI0iB,EAAOQ,YAAc3B,EAAY,CAEjC,IAAI4B,EAAWC,EAAYC,EAAcP,EAAWz0E,MAChD20E,GACAG,EAAY74E,GAAGkqE,YAAYrrB,KAAKn/C,EAChCo5E,EAAa94E,GAAGkqE,YAAY8O,MAAMt5E,GAIlCo5E,GADAD,GAAaJ,EAAa/4E,EAAIq5E,GACLA,EAI7BF,GAAaT,EAAOa,WAAab,EAAOc,MAAQd,EAAOc,MAAQH,EAC/DD,GAAcV,EAAOe,YAAcf,EAAOgB,OAAShB,EAAOgB,OAASL,EAE/DR,IACAM,GAAaR,EAAiB34E,EAC9Bm5E,GAAaP,EAAa54E,EAC1Bo5E,GAAcT,EAAiB34E,EAC/Bo5E,GAAcR,EAAa54E,GAG/B,IAAIqE,EAAOy0C,EAAUmgC,EAAOj5E,EAAGqQ,EAAS80B,EAAK6V,OAAOh7C,EAKpD,GAJIqQ,EAAS,IACTyoC,EAAU,EAAMA,EAChBzoC,GAAUA,GAEVqoE,EAAOiB,eACPt1E,EAAQ+0E,EAAaD,EACN,IAAX9oE,IACA80B,EAAK9gC,MAAQA,EAAQgM,GAEzBrQ,EAAIm5E,EAAYrgC,EAAUz0C,OAI1B,GADAA,EAAQ8gC,EAAK9gC,MAAQgM,EACjBqoE,EAAOkB,wBAAyB,CAChC,IAAIC,EAAwBnB,EAAOoB,uBAAyBpB,EAAOqB,kBAAoBrB,EAAOqB,kBAAoBV,EAC9GW,GAAgB,GAAMjB,EAAa/4E,GAAK84E,EAAWz0E,MACnDw0E,IACAgB,GAAyBjB,EAAa54E,EACtCg6E,GAAgBrB,EAAiB34E,EACjCg6E,GAAgBpB,EAAa54E,GAEjCA,EAAIg6E,GAAgBlhC,EAAU,IAAOz0C,EAAQw1E,OAG7C75E,EADK04E,EAAOuB,YACRd,EAAYrgC,EAAUz0C,EAGtB+0E,GAActgC,EAAU,GAAKz0C,EAK7C,GAAIq0E,EAAOQ,YAAczB,EAAU,CAE/B,IAAIyC,EAAUC,EAAaC,EAAetB,EAAWx0E,OACjD00E,GACAmB,EAAc75E,GAAGkqE,YAAY6P,OAAOj2E,EACpC81E,EAAW55E,GAAGkqE,YAAYtrB,IAAI96C,GAI9B81E,GADAC,GAAepB,EAAa30E,EAAIg2E,GACPA,EAI7BD,GAAezB,EAAO4B,aAAe5B,EAAO6B,QAAU7B,EAAO6B,QAAUH,EACvEF,GAAYxB,EAAO8B,UAAY9B,EAAO+B,KAAO/B,EAAO+B,KAAOL,EAEvDvB,IAEAsB,GAAexB,EAAiBv0E,EAChC+1E,GAAevB,EAAax0E,EAC5B81E,GAAYvB,EAAiBv0E,EAC7B81E,GAAYtB,EAAax0E,GAG7B,IAAIE,EAAQy0C,EAAUkgC,EAAO70E,EAAGuM,EAASw0B,EAAK6V,OAAO52C,EAKrD,GAJIuM,EAAS,IACTooC,EAAU,EAAMA,EAChBpoC,GAAUA,GAEV+nE,EAAOgC,gBACPp2E,EAAS41E,EAAWC,EACL,IAAXxpE,IACAw0B,EAAK7gC,OAASA,EAASqM,GAE3BvM,EAAI+1E,EAAcphC,EAAUz0C,OAI5B,GADAA,EAAS6gC,EAAK7gC,OAASqM,EACnB+nE,EAAOiC,sBAAuB,CAC9B,IAAIC,EAAsBlC,EAAOmC,qBAAuBnC,EAAOoC,gBAAkBpC,EAAOoC,gBAAkBV,EACtGW,GAAgB,GAAMhC,EAAa30E,GAAK00E,EAAWx0E,OACnDu0E,IACA+B,GAAuBhC,EAAax0E,EACpC22E,GAAgBpC,EAAiBv0E,EACjC22E,GAAgBnC,EAAax0E,GAEjCA,EAAI22E,GAAgBhiC,EAAU,IAAOz0C,EAASs2E,OAG9Cx2E,EADKs0E,EAAOsC,cACRb,EAAcphC,EAAUz0C,EAGxB41E,GAAYnhC,EAAU,GAAKz0C,EAK3C6gC,EAAK3/B,YAAYxF,EAAGoE,GAkCxB,SAAS62E,IAGD,IA+BAv2B,EAAQpkD,GAAG+e,SAASq5B,WACxB,GAAIgM,EAAO,CAEP,GADAw2B,EAAcC,YAAa,EACvBD,EAAcziB,iBACd2iB,EAAcl7E,OAAS,EArEnC,SAASm7E,EAAWl2C,GAChB,IAAIuzC,EAASvzC,EAAKiyB,QACdshB,IAIAD,EAAMtzC,EAAMuzC,GACiDA,EAAO4C,YAAc3D,EAAUG,OACxFY,EAAOtpE,SAAU,EAGjBgsE,EAAch1E,KAAKsyE,IAI3B,IADA,IAAItzC,EAAWD,EAAKwyB,UACX13D,EAAI,EAAGA,EAAImlC,EAASllC,OAAQD,IAAK,CACtC,IAAIohE,EAAQj8B,EAASnlC,GACjBohE,EAAMgB,SACNgZ,EAAUha,IAoDVga,CAAU32B,GACVw2B,EAAcziB,kBAAmB,MAEhC,CACD,IAAOigB,EAAQ5wD,EAAWozD,EAAcK,uBA0BpC,IAAKzzD,EAAS7nB,EAAI,EAAG6nB,EAAS7nB,EAAIm7E,EAAcl7E,SAAU4nB,EAAS7nB,EAE/Dw4E,GADAC,EAAS0C,EAActzD,EAAS7nB,IACnBklC,KAAMuzC,GAI/BwC,EAAcC,YAAa,GASnC,IAmFIC,KAeJ,IAAIF,EAAgB56E,GAAGwiD,eAAiBjjD,EAAOE,SAC3Cy7E,aACI9D,IA9ZM,EA+ZN+D,IA9ZM,EA+ZNC,IA9ZM,EA+ZNlE,KA9ZM,EA+ZNmE,OA9ZM,GA+ZNC,MA9ZM,IAgaVT,YAAY,EACZ1iB,kBAAkB,EAClB8iB,uBAAwB,IAAIj7E,GAAGye,GAAGiE,MAAMC,uBAAuBm4D,GAE/DtrE,KAAM,SAAUuP,GACZA,EAASuP,GAAGtuB,GAAG8gD,SAAS8E,mBAAoB+0B,GAMpC36E,GAAGi4B,IAAIsjD,SACPv4B,OAAOvpB,iBAAiB,SAAUr5B,KAAKo7E,UAAUviD,KAAK74B,OAGtDJ,GAAG6iD,KAAKv0B,GAAG,gBAAiBluB,KAAKo7E,UAAWp7E,OAIxD6E,IAAK,SAAUmzE,GACXA,EAAOvzC,KAAKiyB,QAAUshB,EACtBh4E,KAAK+3D,kBAAmB,GAM5BhP,OAAQ,SAAUivB,GACdA,EAAOvzC,KAAKiyB,QAAU,KACtB12D,KAAK66E,uBAAuB9xB,OAAOivB,IAMvCoD,UA5CqD,WA6CjD,IAAIp3B,EAAQpkD,GAAG+e,SAASq5B,WACpBgM,GACAhkD,KAAKq7E,uBAAuBr3B,IAGpCq3B,uBAlDqD,SAkD7B52C,GACpB,IAAIuzC,EAASp4E,GAAG2jB,KAAKuoC,OAAOrnB,IAASA,EAAK/e,aAAa9lB,GAAG07E,QACtDtD,GACIA,EAAO4C,YAAc3D,EAAUE,mBAC/Ba,EAAOtpE,SAAU,GAKzB,IADA,IAAIg2B,EAAWD,EAAKwyB,UACX13D,EAAI,EAAGA,EAAImlC,EAASllC,OAAQD,IAAK,CACtC,IAAIohE,EAAQj8B,EAASnlC,GACrBS,KAAKq7E,uBAAuB1a,KAGpC4a,gBA5EJ,SAASA,EAAiB92C,GACtB,IAAI9/B,EAAS8/B,EAAKoW,QACdj7C,GAAG2jB,KAAKuoC,OAAOnnD,IACf42E,EAAgB52E,GAEpB,IAAIqzE,EAASvzC,EAAKiyB,SACLjyB,EAAK/e,aAAa9lB,GAAG07E,QAC9BtD,GAAUrzE,GACVozE,EAAMtzC,EAAMuzC,IAqEhBf,UAAWA,0CC/df,IAAM9lB,EAAczxD,EAAQ,6BACtBwhC,EAAexhC,EAAQ,6BACvByhC,EAAWzhC,EAAQ,qBACnB46B,EAAO56B,EAAQ,aACfg1C,EAAMh1C,EAAQ,wBAEdmmC,EAAOjmC,GAAG0hC,MAAMuE,KAChBk2B,EAAOn8D,GAAG0hC,MAAMy6B,KAChB16B,EAAOzhC,GAAG0hC,MAAMD,KAElBm6C,EAAe31C,EAAKiH,SACpB2uC,EAAe51C,EAAKiH,SAEpB4uC,EAAar6C,EAAKyL,SAClB6uC,EAAat6C,EAAKyL,SAClB8uC,EAAav6C,EAAKyL,SAElB+uC,KAEAC,EAAe,KAEnB,SAASC,IACL,GAAKD,EAAL,CAEA,IAAIr3C,EAAOq3C,EAAalxC,MACpBrQ,EAAS36B,GAAG06B,KAAKC,OACrBkK,EAAK2E,EAAI7O,EAAO32B,OAAS,OACzB6gC,EAAKnlC,EAAIi7B,EAAO52B,MAAQ,EACxB8gC,EAAK/gC,EAAI62B,EAAO32B,OAAS,GAQ7B,IAAIo4E,EAAap8E,GAAG43B,MAIhBykD,MAAO,EAIPC,MAAO,EAIPC,QAAS,IAaTj1B,EAAStnD,GAAGE,OACZb,KAAM,YACNsC,QAAS3B,GAAGw8E,UAEZr8E,KAJkB,WAKd,GAAIu6B,EAAKkwB,aAAelwB,EAAKuvB,mBAAoB,CAC7C,IAAI8R,EAAS,IAAIz6B,EAAagmB,OAE9ByU,EAAO0gB,WACH,gBAGJ,IAAI55B,EAAO,IAAIvhB,EAAao7C,KAC5B3gB,EAAOlZ,KAAOA,EACdkZ,EAAO4gB,OAAQ,EAEfv8E,KAAKgrC,SAAU,EACfhrC,KAAKw8E,QAAU7gB,OAGf37D,KAAKgrC,SAAU,GAIvBmB,QAAQR,EAMRnjB,YACIouC,aAAc,WACd6lB,YAAaT,EAAWE,MAAQF,EAAWG,QAC3CO,iBAAkB98E,GAAG4c,MAAM,EAAG,EAAG,EAAG,KACpCmgE,OAAQ,EACRC,WAAY,EACZC,eAAgB,KAChBC,KAAM,GACNC,WAAY,GACZC,UAAW,GACXC,SAAU,KACVC,QAAQ,EACRhP,MAAOtuE,GAAGgD,KAAK,EAAG,EAAG,EAAG,GASxBu6E,WACIx0D,IADO,WAEH,OAAO3oB,KAAK48E,YAEhB9wD,IAJO,SAIF/nB,GACD/D,KAAK48E,WAAa74E,IAY1Bq5E,KACIz0D,IADC,WAEG,OAAO3oB,KAAK88E,MAEhBhxD,IAJC,SAII0C,GACDxuB,KAAK88E,KAAOtuD,IAYpB6uD,WACI10D,IADO,WAEH,OAAO3oB,KAAK+8E,YAEhBjxD,IAJO,SAIF0C,GACDxuB,KAAK+8E,WAAavuD,IAY1B8uD,UACI30D,IADM,WAEF,OAAO3oB,KAAKg9E,WAEhBlxD,IAJM,SAID0C,GACDxuB,KAAKg9E,UAAYxuD,EACjBxuB,KAAKu9E,2BAYbC,SACI70D,IADK,WAED,OAAO3oB,KAAKi9E,UAEhBnxD,IAJK,SAIA0C,GACDxuB,KAAKi9E,SAAWzuD,EAChBxuB,KAAKu9E,2BAYbE,OACI90D,IADG,WAEC,OAAO3oB,KAAKk9E,QAEhBpxD,IAJG,SAIE0C,GACDxuB,KAAKk9E,OAAS1uD,EACdxuB,KAAK09E,sBAYb96E,MACI+lB,IADE,WAEE,OAAO3oB,KAAKkuE,OAEhBpiD,IAJE,SAIG0C,GACDxuB,KAAKkuE,MAAQ1/C,EACbxuB,KAAK29E,gBAWbC,aACIj1D,IADS,WAEL,OAAO3oB,KAAK42D,cAEhB9qC,IAJS,SAIJ/nB,GACD/D,KAAK42D,aAAe7yD,EACpB/D,KAAK69E,sBAWbC,YACIn1D,IADQ,WAEJ,OAAO3oB,KAAKy8E,aAEhB3wD,IAJQ,SAIH/nB,GACD/D,KAAKy8E,YAAc14E,EACf/D,KAAKw8E,SACLx8E,KAAKw8E,QAAQuB,cAAch6E,KAYvC46C,iBACIh2B,IADa,WAET,OAAO3oB,KAAK08E,kBAEhB5wD,IAJa,SAIR/nB,GACD/D,KAAK08E,iBAAmB34E,EACxB/D,KAAKg+E,2BAWb52B,OACIz+B,IADG,WAEC,OAAO3oB,KAAK28E,QAEhB7wD,IAJG,SAIE/nB,GACD/D,KAAK28E,OAAS54E,EACV/D,KAAKw8E,UACLx8E,KAAKw8E,QAAQyB,WAAal6E,KActCm6E,eACIv1D,IADW,WAEP,OAAO3oB,KAAK68E,gBAEhB/wD,IAJW,SAIN/nB,GACD/D,KAAK68E,eAAiB94E,EACtB/D,KAAKm+E,yBAIbC,OACIz1D,IADG,WAEC,OAAO3oB,KAAKykC,KAAKwX,aAK7BnzB,SASIq+B,KAAM,KAUNk3B,QAASxC,EAETG,WAAYA,EAYZpgB,WAjCK,SAiCOn3B,GACR,IAAK,IAAIllC,EAAI,EAAGgiB,EAAIs6D,EAASr8E,OAAQD,EAAIgiB,EAAGhiB,IAAK,CAC7C,IAAIo8D,EAASkgB,EAASt8E,GACtB,GAAIo8D,EAAO2iB,aAAa75C,GACpB,OAAOk3B,EAIf,OAAO,MAGX4iB,kBA5CK,WA6CD,IAAIzC,GACAxhD,EAAKkwB,aAAelwB,EAAKuvB,mBAA7B,CACA,IAAI8R,EAAS,IAAIz6B,EAAagmB,OAC9B40B,EAAengB,EAEfA,EAAO0gB,WACH,gBAGJ1gB,EAAO6iB,OAAiB,GAAVn5E,KAAK8E,GAAU,KAC7BwxD,EAAO8iB,QAAQ,IACf9iB,EAAO+iB,OAAO,MAEd,IAAIj8B,EAAO,IAAIvhB,EAAao7C,KAC5B3gB,EAAOlZ,KAAOA,EACdkZ,EAAO4gB,OAAQ,EAEf5gB,EAAO/E,aAAe+E,EAAOlZ,KAAKmU,aAAe,GAAKh3D,GAAG2jB,KAAKwuC,kBAAkBC,MAChF2J,EAAOsiB,WAAar+E,GAAGiI,MAAMyuD,WAC7BqF,EAAOoiB,cAAc,GACrBpiB,EAAOgjB,SAAS,EAAG,EAAG,EAAG,GAEzB,IAAIl6C,EAAO,IAAI7kC,GAAG2jB,KAClBo4C,EAAOijB,QAAQn6C,GAEfs3C,IACAn8E,GAAG6iD,KAAKv0B,GAAG,4BAA6B6tD,GAExC56C,EAAS6iB,MAAM66B,UAAUljB,MAIjCkiB,kBArVkB,WAsVd,GAAI79E,KAAKw8E,QAAS,CACd,IAAIjlB,EAAOv3D,KAAK42D,eAAkB,GAAKh3D,GAAG2jB,KAAKwuC,kBAAkBC,OACjEhyD,KAAKw8E,QAAQ5lB,aAAeW,EAC5Bv3D,KAAKw8E,QAAQ/5B,KAAKmU,aAAeW,IAIzCymB,uBA7VkB,WA8Vd,GAAKh+E,KAAKw8E,QAAV,CAEA,IAAIhgE,EAAQxc,KAAK08E,iBACjB18E,KAAKw8E,QAAQmC,SACTniE,EAAMtC,EAAI,IACVsC,EAAMG,EAAI,IACVH,EAAMtQ,EAAI,IACVsQ,EAAMzT,EAAI,OAIlBo1E,qBAzWkB,WA0Wd,GAAKn+E,KAAKw8E,QAAV,CAEA,IAAIttC,EAAUlvC,KAAK68E,eACnB78E,KAAKw8E,QAAQ7S,aAAez6B,EAAUA,EAAQy6B,aAAe,OAGjE4T,uBAhXkB,WAiXTv9E,KAAKw8E,UACVx8E,KAAKw8E,QAAQiC,QAAQz+E,KAAKg9E,WAC1Bh9E,KAAKw8E,QAAQkC,OAAO1+E,KAAKi9E,YAG7BS,kBAtXkB,WAuXd,GAAK19E,KAAKw8E,QAAV,CACA,IAAI9zD,EAAO1oB,KAAKk9E,OAAS,EAAI,EAC7Bl9E,KAAKw8E,QAAQsC,QAAQp2D,KAGzBi1D,YA5XkB,WA6XT39E,KAAKw8E,SACVx8E,KAAKw8E,QAAQvN,QAAQjvE,KAAKkuE,QAG9B6Q,MAjYkB,WAkYd,IAAI/+E,KAAKgrC,QAAT,CACAhrC,KAAKgrC,SAAU,EAEf,IAAI2wB,EAAS37D,KAAKw8E,QACb7gB,IACLA,EAAOijB,QAAQ5+E,KAAKykC,MACpBk3B,EAAOoiB,cAAc/9E,KAAKy8E,aAC1B9gB,EAAOsiB,WAAaj+E,KAAK28E,OACzB38E,KAAKg+E,yBACLh+E,KAAK69E,oBACL79E,KAAKm+E,uBACLn+E,KAAKu9E,yBACLv9E,KAAK09E,uBAGTsB,OAjZkB,WAkZdh/E,KAAK++E,SAGTE,SArZkB,WAsZV3kD,EAAKkwB,aAAelwB,EAAKuvB,qBACzBjqD,GAAG+e,SAASuP,GAAGtuB,GAAG8gD,SAASgI,kBAAmB1oD,KAAKk/E,WAAYl/E,MAC/DmhC,EAAS6iB,MAAM66B,UAAU7+E,KAAKw8E,UAElCX,EAASn2E,KAAK1F,OAGlBm/E,UA7ZkB,WA8ZV7kD,EAAKkwB,aAAelwB,EAAKuvB,qBACzBjqD,GAAG+e,SAAS8P,IAAI7uB,GAAG8gD,SAASgI,kBAAmB1oD,KAAKk/E,WAAYl/E,MAChEmhC,EAAS6iB,MAAMo7B,aAAap/E,KAAKw8E,UAErC58E,GAAGye,GAAGiE,MAAMymC,OAAO8yB,EAAU77E,OAYjCq/E,yBA9akB,SA8aQ56C,GACtB,IAAIhQ,EAAM08B,EAAYyO,WAOtB,OANAn7B,EAAKoM,eAAe4qC,GAChBz7E,KAAKs+E,aAAa75C,KAClBzkC,KAAKs/E,uBAAuB9D,GAC5B31C,EAAK3hC,IAAIu3E,EAAcA,EAAcD,IAEzCrqB,EAAY4O,SAAStrC,EAAKgnD,GACnBhnD,GAaXonC,sBAnckB,SAmcKN,EAAO9mC,GAI1B,OAHAA,EAAMA,GAAO70B,GAAGqE,KAChBjE,KAAKu/E,uBAAuB/D,GAC5Bzf,EAAKloB,cAAcpf,EAAK8mC,EAAOigB,GACxB/mD,GAaX+qD,sBApdkB,SAodKjkB,EAAO9mC,GAI1B,OAHAA,EAAMA,GAAO70B,GAAGqE,KAChBjE,KAAKs/E,uBAAuB9D,GAC5Bzf,EAAKloB,cAAcpf,EAAK8mC,EAAOigB,GACxB/mD,GAYX8qD,uBApekB,SAoeM9qD,GAGpB,OAFAz0B,KAAKs/E,uBAAuB7qD,GAC5BoR,EAAKoS,OAAOxjB,EAAKA,GACVA,GAaX6qD,uBApfkB,SAofM7qD,GACpBz0B,KAAKykC,KAAKo5B,WAAW2d,GAErB,IAAI2B,EAAYn9E,KAAKm9E,UACrB3B,EAAa9rC,KAAOytC,EACpB3B,EAAa7rC,KAAOwtC,EACpB3B,EAAa1rC,KAAOqtC,EACpB3B,EAAazrC,KAAOotC,EAEpB,IAAI7sC,EAAMkrC,EAAalrC,IACnBC,EAAMirC,EAAajrC,IAEnBiD,EAAS5zC,GAAGkqE,YAAYt2B,OAO5B,OANAgoC,EAAalrC,IAAMkD,EAAOl0C,GAAKk8E,EAAa9rC,IAAMY,EAAMkrC,EAAa1rC,IAAMS,GAC3EirC,EAAajrC,IAAMiD,EAAO9vC,GAAK83E,EAAa7rC,IAAMW,EAAMkrC,EAAazrC,IAAMQ,GAEvE9b,IAAQ+mD,GACR31C,EAAKqO,KAAKzf,EAAK+mD,GAEZ/mD,GAYXgrD,OAnhBkB,SAmhBVC,GACJ,OAAKhrC,GAELrT,EAAKvV,IAAI8vD,EAAY8D,EAAUpgF,EAAGogF,EAAUh8E,EAAG,GAC/C1D,KAAKw8E,QAAQmD,cAAchE,EAAYC,EAAYh8E,GAAGkqE,YAAYnmE,MAAO/D,GAAGkqE,YAAYlmE,QAEpF5D,KAAKy9E,OACLp8C,EAAKvV,IAAI8vD,EAAY8D,EAAUpgF,EAAGogF,EAAUh8E,GAAI,GAChD1D,KAAKw8E,QAAQmD,cAAcjE,EAAYE,EAAYh8E,GAAGkqE,YAAYnmE,MAAO/D,GAAGkqE,YAAYlmE,SAGxF5D,KAAKykC,KAAK64B,iBAAiBoe,GAGxBhnC,EAAIP,WAAWO,EAAI5H,SAAU4uC,EAAYC,IAb/B+D,GAyBrBpB,aA7iBkB,SA6iBJ75C,GACV,OAAOA,EAAKmyB,aAAe52D,KAAK49E,aAWpC7uE,OAzjBkB,SAyjBV2T,GAEJ,KADAA,EAAOA,GAAQ9iB,GAAG+e,SAASq5B,YAChB,OAAO,KAGlBh4C,KAAKykC,KAAKoM,eAAe2qC,GACzBx7E,KAAKk/E,aACL/9C,EAASy+C,QAAQC,MAAMn9D,GACvBye,EAASuqC,SAASoU,aAAa9/E,KAAKw8E,QAASr7C,EAAS6iB,QAG1D+7B,QApkBkB,WAqkBd,IAAIn8E,EAAShE,GAAG06B,KAAKC,OAAO32B,OAAShE,GAAG6iD,KAAK9nC,QAEzCujE,EAAgBl+E,KAAK68E,eACrBqB,IACAt6E,EAASs6E,EAAct6E,QAG3B,IAAIw5E,EAAMp9E,KAAK88E,KAAOl9E,GAAGiI,MAAMyqC,IAC/BtyC,KAAKykC,KAAK2E,EAAIxlC,GAA8B,EAApByB,KAAKm1C,IAAI4iC,EAAM,IAEvCA,EAAsD,EAAhD/3E,KAAK26E,KAAK36E,KAAKm1C,IAAI4iC,EAAM,GAAKp9E,KAAKm9E,WACzCn9E,KAAKw8E,QAAQgC,OAAOpB,GACpBp9E,KAAKw8E,QAAQyD,eAAer8E,EAAS,EAAI5D,KAAKm9E,YAGlD+B,WAplBkB,WAqlBTl/E,KAAKw8E,UAELx8E,KAAKykC,KAAKwX,WAIXj8C,KAAKw8E,QAAQgC,OAAOx+E,KAAK88E,KAAOl9E,GAAGiI,MAAMyqC,KACzCtyC,KAAKw8E,QAAQyD,eAAejgF,KAAK+8E,aAJjC/8E,KAAK+/E,UAOT//E,KAAKw8E,QAAQD,OAAQ,MAI7Bp9E,EAAOE,QAAUO,GAAGsnD,OAASA,2JChqB7BxnD,EAAQ,sBACR,IAAI2xD,EAAQ3xD,EAAQ,uBAAuB2xD,MACvC6uB,EAAUxgF,EAAQ,iBAAiB4iB,MAEnC69D,EAAgB9uB,EAAM8uB,cACtBC,EAAmB/uB,EAAM+uB,iBAUzBC,GATyBhvB,EAAMivB,uBASF,0BAA4BH,GAIzDI,EAA8B,eAG9BC,EAAkC,mBAItC,SAASC,EAAan+D,EAAOmD,GAGzB,IAFA,IAAIi7D,EAAQj7D,EAAK3G,YAAY6hE,gBACzBtoD,EAAK5S,EAAK7F,IACL2B,EAAI,EAAGgyB,EAAIjxB,EAAM9iB,OAAS,EAAG8b,EAAIi4B,IAAM,EAC3ChyB,GAAKgyB,EACLj4B,EAAKiG,EAAIgyB,IAAO,EACnB,CACE,IAAIqtC,EAAOt+D,EAAMhH,GACbulE,EAAYD,EAAK9hE,YAAY6hE,gBACjC,GAAIE,EAAYH,EACZntC,EAAIj4B,EAAI,OAEP,GAAIulE,EAAYH,EACjBn/D,EAAIjG,EAAI,MAEP,CACD,IAAIwlE,EAASF,EAAKhhE,IAClB,GAAIkhE,EAASzoD,EACTkb,EAAIj4B,EAAI,MAEP,CAAA,KAAIwlE,EAASzoD,GAId,OAAO/c,EAHPiG,EAAIjG,EAAI,IAOpB,OAAQiG,EAIZ,SAASw/D,EAAsB35D,EAAU45D,GAGrC,IAFA,IAAI1+D,EAAQ8E,EAAS9E,MACjB2+D,EAAO75D,EAAS7nB,EAAI,EACjB0hF,EAAO3+D,EAAM9iB,QAAQ,CACxB,IAAIimB,EAAOnD,EAAM2+D,GACbx7D,EAAKy7D,UAAYz7D,EAAKgf,KAAKg0B,qBACzBwoB,GAGF75D,EAAS+5D,SAASF,GACdD,IACAv7D,EAAKqvC,YAAcksB,KAOnC,IAAII,EAAmBxhF,GAAGE,OACtBuhF,SAD4B,SAClBC,GACN,IAAIC,EAAWrB,EAAQ39D,uBAEvBviB,KAAKwhF,MAAQ,IAAID,MAEjBvhF,KAAKyhF,KAAO,IAAIF,MAEhBvhF,KAAK0hF,KAAO,IAAIH,MAKhBvhF,KAAK2hF,QAAUL,GAEnBx4D,SACIi4D,qBAAAA,GAEJl8E,IAAK,KACLkkD,OAAQ,KACR64B,OAAQ,OAGZ,SAASC,EAAc94E,EAAGmD,GACtB,OAAOnD,EAAE+V,YAAY6hE,gBAAkBz0E,EAAE4S,YAAY6hE,gBAIzD,IAAImB,EAAgBliF,GAAGE,OACnByB,QAAS6/E,EACTv8E,IAFyB,SAEpB4gB,GACD,IAAIi7D,EAAQj7D,EAAK3G,YAAY6hE,iBAClB,IAAVD,EAAc1gF,KAAKwhF,MAASd,EAAQ,EAAI1gF,KAAKyhF,KAAOzhF,KAAK0hF,MAAOp/D,MAAM5c,KAAK+f,IAEhFsjC,OANyB,SAMjBtjC,GACJ,IAAIi7D,EAAQj7D,EAAK3G,YAAY6hE,iBAClB,IAAVD,EAAc1gF,KAAKwhF,MAASd,EAAQ,EAAI1gF,KAAKyhF,KAAOzhF,KAAK0hF,MAAOjnB,WAAWh1C,IAEhFs8D,eAVyB,SAUTf,GACZD,EAAqB/gF,KAAKwhF,MAAOR,GACjCD,EAAqB/gF,KAAKyhF,KAAMT,GAChCD,EAAqB/gF,KAAK0hF,KAAMV,IAEpCY,OAfyB,WAgBrB,IAAII,EAAWhiF,KAAKyhF,KAChBO,EAAS1/D,MAAM9iB,OAAS,IACxBwiF,EAAS1/D,MAAMi2B,KAAKspC,GACpB7hF,KAAK2hF,QAAQK,GACbA,EAAS1/D,MAAM9iB,OAAS,GAG5BQ,KAAK2hF,QAAQ3hF,KAAKwhF,OAClBxhF,KAAKwhF,MAAMl/D,MAAM9iB,OAAS,EAE1B,IAAIyiF,EAAWjiF,KAAK0hF,KAChBO,EAAS3/D,MAAM9iB,OAAS,IACxByiF,EAAS3/D,MAAMi2B,KAAKspC,GACpB7hF,KAAK2hF,QAAQM,GACbA,EAAS3/D,MAAM9iB,OAAS,MAMhC0iF,EAAkBtiF,GAAGE,OACrByB,QAAS6/E,EACTv8E,IAF2B,SAEtB4gB,GACD,IAAIi7D,EAAQj7D,EAAK3G,YAAY6hE,gBAC7B,GAAc,IAAVD,EACA1gF,KAAKwhF,MAAMl/D,MAAM5c,KAAK+f,OAErB,CACD,IAAInD,EAAQo+D,EAAQ,EAAI1gF,KAAKyhF,KAAKn/D,MAAQtiB,KAAK0hF,KAAKp/D,MAChD/iB,EAAIkhF,EAAYn+D,EAAOmD,GACvBlmB,EAAI,GACJ+iB,EAAMnC,QAAQ5gB,EAAG,EAAGkmB,KAOhCsjC,OAlB2B,SAkBnBtjC,GACJ,IAAIi7D,EAAQj7D,EAAK3G,YAAY6hE,gBAC7B,GAAc,IAAVD,EACA1gF,KAAKwhF,MAAM/mB,WAAWh1C,OAErB,CACD,IAAI2B,EAAWs5D,EAAQ,EAAI1gF,KAAKyhF,KAAOzhF,KAAK0hF,KACxCniF,EAAIkhF,EAAYr5D,EAAS9E,MAAOmD,GAChClmB,GAAK,GACL6nB,EAAS+5D,SAAS5hF,KAI9BqiF,OA/B2B,SA+BnBjhF,GACAX,KAAKyhF,KAAKn/D,MAAM9iB,OAAS,GACzBQ,KAAK2hF,QAAQ3hF,KAAKyhF,KAAM9gF,GAG5BX,KAAK2hF,QAAQ3hF,KAAKwhF,MAAO7gF,GAErBX,KAAK0hF,KAAKp/D,MAAM9iB,OAAS,GACzBQ,KAAK2hF,QAAQ3hF,KAAK0hF,KAAM/gF,MAYpC,SAASwhF,EAAkBC,EAAYC,GACnC,GAA0B,mBAAfD,EACP,OAAIC,EACO,SAAUj7D,EAAUzmB,GACvB,IAAI2hB,EAAQ8E,EAAS9E,MACrB,IAAK8E,EAAS7nB,EAAI,EAAG6nB,EAAS7nB,EAAI+iB,EAAM9iB,SAAU4nB,EAAS7nB,EAAG,CAC1D,IAAIkmB,EAAOnD,EAAM8E,EAAS7nB,GAC1B6iF,EAAW38D,EAAM9kB,KAKlB,SAAUymB,GACb,IAAI9E,EAAQ8E,EAAS9E,MACrB,IAAK8E,EAAS7nB,EAAI,EAAG6nB,EAAS7nB,EAAI+iB,EAAM9iB,SAAU4nB,EAAS7nB,EAAG,CAC1D,IAAIkmB,EAAOnD,EAAM8E,EAAS7nB,GAC1B6iF,EAAW38D,KAavB,IAAIipC,EAAO,iEAGA0zB,EACA,IACX,OAAIC,EACOC,SAAS,KAAM,KAAM5zB,GAGrB4zB,SAAS,KAAM5zB,GASlC,SAAS3uD,IAELC,KAAKuiF,aAAe,IAAIT,EAAcK,EACA9B,IACtCrgF,KAAKwiF,cAAgB,IAAIN,EAAgBC,EACF5B,GAAY,IACnDvgF,KAAKyiF,kBAAoB,IAAIP,EAAgBC,EACF3B,GAAgB,IAG3DxgF,KAAK0iF,uBAGL1iF,KAAK2iF,WAAY,EAErB,IAAItiC,EAAqBzgD,GAAGE,OACxBC,KAAMA,EACN4jD,cAAe5jD,EAEf+oB,SACIs4D,iBAAAA,EACAU,cAAAA,EACAK,iBAAAA,EACAS,eAaI,SAAUx7D,GACV,IAAIy7D,EAAgBjjF,GAAG+e,SAASyiC,eAC5B9+B,EAAQ8E,EAAS9E,MACrB,IAAK8E,EAAS7nB,EAAI,EAAG6nB,EAAS7nB,EAAI+iB,EAAM9iB,SAAU4nB,EAAS7nB,EAAG,CAC1D,IAAIkmB,EAAOnD,EAAM8E,EAAS7nB,GAC1B,GAAIkmB,EAAKy7D,SACLz7D,EAAKw5D,YAC4Bx5D,EAAKgf,KAAKg0B,oBAEvCoqB,EAAcC,WAAWr9D,MAO7Cq9D,WArC8B,SAqClBr9D,GACR7lB,GAAG+e,SAASwC,eAAeR,aAAa8E,GACxCA,EAAKqvC,WAAasrB,EAGdpgF,KAAK2iF,UACL3iF,KAAK0iF,oBAAoBh9E,KAAK+f,GAG9BzlB,KAAK+iF,mBAAmBt9D,IAIhCu9D,YAlD8B,SAkDjBv9D,GACT7lB,GAAG+e,SAASwC,eAAeT,YAAY+E,GACvCA,EAAKqvC,YAAcsrB,EAGnB,IAAI/+D,EAAQrhB,KAAK0iF,oBAAoB/+D,QAAQ8B,GACzCpE,GAAS,EACT6+D,EAAQx4D,aAAa1nB,KAAK0iF,oBAAqBrhE,KAK/CoE,EAAKiE,OAAWjE,EAAKqvC,UAAYqrB,GACjCngF,KAAKuiF,aAAax5B,OAAOtjC,GAEzBA,EAAK5kB,QACLb,KAAKwiF,cAAcz5B,OAAOtjC,GAE1BA,EAAKw9D,YACLjjF,KAAKyiF,kBAAkB15B,OAAOtjC,KAItCy9D,WAsBI,SAAUz9D,EAAM09D,GAChB,KAAM19D,EAAKqvC,UAAYsrB,GAAmB,CACtC,GAAI36D,EAAKw5D,SAAU,CACf,GAAIkE,EAEA,YADAA,EAAQt+E,IAAI4gB,GAOZ,GAHAA,EAAKw5D,YAE4Bx5D,EAAKgf,KAAKg0B,mBAEvC,OAIZz4D,KAAK8iF,WAAWr9D,KAIxB29D,YAaI,SAAU39D,GACNA,EAAKqvC,UAAYsrB,IACb36D,EAAK05D,WACL15D,EAAK05D,YAETn/E,KAAKgjF,YAAYv9D,KAIzBs9D,mBAzI8B,SAyIVt9D,IACZA,EAAKiE,OAAWjE,EAAKqvC,UAAYqrB,GACjCngF,KAAKuiF,aAAa19E,IAAI4gB,GAEtBA,EAAK5kB,QACLb,KAAKwiF,cAAc39E,IAAI4gB,GAEvBA,EAAKw9D,YACLjjF,KAAKyiF,kBAAkB59E,IAAI4gB,IAInC49D,kBArJ8B,WAuJ1B,IADA,IAAI99D,EAAQvlB,KAAK0iF,oBACRnjF,EAAI,EAAGwuB,EAAMxI,EAAM/lB,OAAQD,EAAIwuB,EAAKxuB,IAAK,CAC9C,IAAIkmB,EAAOF,EAAMhmB,GACjBS,KAAK+iF,mBAAmBt9D,GAE5BF,EAAM/lB,OAAS,GAGnB+oD,WA9J8B,WAgK1BvoD,KAAK2iF,WAAY,EAEb3iF,KAAK0iF,oBAAoBljF,OAAS,GAClCQ,KAAKqjF,oBAITrjF,KAAKuiF,aAAaX,UAkBtBp5B,YAzL8B,SAyLjB7nD,GACTX,KAAKwiF,cAAcZ,OAAOjhF,IAG9B8nD,gBA7L8B,SA6Lb9nD,GACbX,KAAKyiF,kBAAkBb,OAAOjhF,GAG9BX,KAAK2iF,WAAY,KAIzBxjF,EAAOE,QAAUghD,oHClcjB,IAAMl+B,EAAoBziB,EAAQ,sCAC5B4oB,EAAgB5oB,EAAQ,kCACxBk4B,EAAcl4B,EAAQ,yBACtB2e,EAAK3e,EAAQ,kBAEnB,SAAS4jF,EAAYC,EAAOC,GACxB,OAAID,IAAUC,GAIPD,GAASC,IAAUD,EAAMtkF,OAASukF,EAAMvkF,MAAQskF,EAAMv8B,QAAUw8B,EAAMx8B,OAUjF,IAAIvN,EAAY75C,GAAG43B,MAOfisD,KAAM,OAONC,KAAM,OAONC,MAAO,QAOPC,OAAQ,SAORC,UAAW,YAOXC,SAAU,aA4BV93C,EAAYpsC,GAAGE,OACfb,KAAM,eACNsC,QAAS7B,EAAQ,iBACjB0nE,QAASxvC,GAETuU,QAAQR,EAMR7iB,SACI2wB,UAAAA,GAGJ15C,KAAM,WACFH,GAAGg4B,YAAYr1B,KAAKvC,MAGpBA,KAAK+jF,UAAY,KAEjB/jF,KAAKgkF,aAAe3lE,EAAGG,WAAU,GACjCxe,KAAKikF,UAAW,EAEhBjkF,KAAKkkF,aAAe,MAGxB17D,YAEI4jB,cACI3jB,QAAS,KACTC,KAAMJ,GASVikB,aACI7jB,KAAMJ,EACNK,IAAK,WACD,OAAO3oB,KAAKosC,cAEhBtgB,IAAK,SAAU/nB,KAqBfogF,SAASC,GASbC,aACI17D,IAAK,WACD,OAAO3oB,KAAKkkF,cAEhBp4D,IAAK,SAAU/nB,GACX/D,KAAKkkF,aAAengF,GAExB2kB,KAAMJ,EACNO,SAAS,GAUbyjB,QACI7jB,WACAC,MAAOJ,GACP67D,SAASC,EACTv7D,SAAS,GAUby7D,YACI77D,SAAS,EACT07D,SAASC,IAIjB16D,MAAO,WACH,GAAkB1pB,KAAKskF,YAActkF,KAAKosC,gBACtBpsC,KAAK+jF,WAAa/jF,KAAK+jF,UAAUQ,WACjC,CACZ,IAAI5hE,EAAQ3iB,KAAKwsC,kBAAkBxsC,KAAKosC,aAAantC,MACrDe,KAAK+jF,UAAUl9D,UAAUlE,KAKrCs8D,SAAU,WACFj/E,KAAK+jF,WACL/jF,KAAK+jF,UAAUj8D,UAIvBq3D,UAAW,WACHn/E,KAAK+jF,WACL/jF,KAAK+jF,UAAUn8D,SAIvB48D,UAAW,WACPxkF,KAAKS,QAaTgkF,SAAU,WACN,OAAOzkF,KAAKssC,QAchBrlB,KAAM,SAAUhoB,EAAM6nB,GAClB,IAAInE,EAAQ3iB,KAAK0kF,aAAazlF,EAAM6nB,GAEpC,OADA9mB,KAAK+jF,UAAU58D,iBAAiBxE,GACzBA,GAkBX+hE,aAAc,SAAUzlF,EAAM6nB,GAC1B9mB,KAAK++E,QACL,IAAIp8D,EAAQ3iB,KAAKwsC,kBAAkBvtC,GAASe,KAAKosC,cAAgBpsC,KAAKosC,aAAantC,MAEnF,GAAI0jB,EAAO,CACP3iB,KAAK0O,SAAU,EAEf,IAAIsY,EAAWhnB,KAAK+jF,UAChB/8D,EAASu9D,WAAa5hE,EAAM4hE,UACxB5hE,EAAMoF,SACNf,EAASa,YAAYlF,IAGrBqE,EAASM,UAAU3E,GACnBqE,EAASH,UAAUlE,EAAOmE,IAI9BE,EAASH,UAAUlE,EAAOmE,GAOzB9mB,KAAKg8D,oBACNh1C,EAASY,QAGb5nB,KAAKqkF,YAAc1hE,EAAMC,KAE7B,OAAOD,GAUXliB,KAAM,SAAUxB,GACZ,GAAKe,KAAKikF,SAGV,GAAIhlF,EAAM,CACN,IAAI0jB,EAAQ3iB,KAAKgkF,aAAa/kF,GAC1B0jB,GACA3iB,KAAK+jF,UAAUz8D,UAAU3E,QAI7B3iB,KAAK+jF,UAAUtjF,QAUvBmnB,MAAO,SAAU3oB,GACb,GAAKe,KAAKikF,SAGV,GAAIhlF,EAAM,CACN,IAAI0jB,EAAQ3iB,KAAKgkF,aAAa/kF,GAC1B0jB,GACA3iB,KAAK+jF,UAAUp8D,WAAWhF,QAI9B3iB,KAAK0O,SAAU,GAUvBoZ,OAAQ,SAAU7oB,GACd,GAAKe,KAAKikF,SAGV,GAAIhlF,EAAM,CACN,IAAI0jB,EAAQ3iB,KAAKgkF,aAAa/kF,GAC1B0jB,GACA3iB,KAAK+jF,UAAUl8D,YAAYlF,QAI/B3iB,KAAK0O,SAAU,GAWvBsrB,eAAgB,SAAU1tB,EAAMrN,GAE5B,GADAe,KAAK++E,QACD9/E,EAAM,CACN,IAAI0jB,EAAQ3iB,KAAKgkF,aAAa/kF,GAC1B0jB,GACA3iB,KAAK+jF,UAAU/7D,aAAarF,EAAOrW,QAIvCtM,KAAK+jF,UAAU/7D,aAAa1b,IAWpCkgC,kBAAmB,SAAUvtC,GACzBe,KAAK++E,QACL,IAAIp8D,EAAQ3iB,KAAKgkF,aAAa/kF,GAiB9B,OAJI0jB,IAAUA,EAAMoE,aAChB/mB,KAAK+jF,UAAU37D,YAAYzF,GAGxBA,GAAS,MAWpBgiE,QAAS,SAAU/hE,EAAMgiE,GACrB,GAAKhiE,EAAL,CAIA5iB,KAAK++E,QAGAn/E,GAAGye,GAAGiE,MAAMuiE,SAAS7kF,KAAKssC,OAAQ1pB,IACnC5iB,KAAKssC,OAAO5mC,KAAKkd,GAIrBgiE,EAAUA,GAAWhiE,EAAK3jB,KAC1B,IAAI6lF,EAAW9kF,KAAKgkF,aAAaY,GACjC,GAAIE,EAAU,CACV,GAAIA,EAASliE,OAASA,EAClB,OAAOkiE,EAGP,IAAIzjE,EAAQrhB,KAAKssC,OAAO3oB,QAAQmhE,EAASliE,OAC1B,IAAXvB,GACArhB,KAAKssC,OAAOnsB,OAAOkB,EAAO,GAMtC,IAAI0jE,EAAW,IAAInlF,GAAGmtB,eAAenK,EAAMgiE,GAE3C,OADA5kF,KAAKgkF,aAAaY,GAAWG,EACtBA,EA5BHnlF,GAAGu+B,OAAO,OA4ClB6mD,WAAY,SAAUpiE,EAAM4rB,GACxB,GAAK5rB,EAAL,CAIA5iB,KAAK++E,QAEL,IAAIp8D,OAAA,EACJ,IAAK,IAAI1jB,KAAQe,KAAKgkF,aAAc,CAGhC,IAFArhE,EAAQ3iB,KAAKgkF,aAAa/kF,IACJ2jB,OACJA,EACd,MAIR,GAAIA,IAAS5iB,KAAKosC,aAAc,CAC5B,IAAIoC,EAGA,YADc5uC,GAAGu+B,OAAO,MAFjBn+B,KAAKosC,aAAe,KAOnC,GAAIzpB,GAASA,EAAM4hE,UAAW,CAC1B,IAAI/1C,EAGA,YADc5uC,GAAGu+B,OAAO,MAFjBn+B,KAAKS,KAAKkiB,EAAM1jB,MAO/Be,KAAKssC,OAAStsC,KAAKssC,OAAOsL,OAAO,SAAUpd,GACvC,OAAOA,IAAS5X,IAGhBD,UACO3iB,KAAKgkF,aAAarhE,EAAM1jB,WAnC/BW,GAAGu+B,OAAO,OA+ClBxZ,OAAQ,SAAU1lB,GAGd,GAFAe,KAAK++E,QAED9/E,EAAM,CACN,IAAI0jB,EAAQ3iB,KAAKgkF,aAAa/kF,GAC1B0jB,GACAA,EAAMgC,cAIV3kB,KAAK+jF,UAAUp/D,UAqCvBuJ,GAAI,SAAUxF,EAAMyF,EAAUjuB,EAAQ45D,GAClC95D,KAAK++E,QAEL,IAAI1pE,EAAMrV,KAAKilF,eAAev8D,EAAMyF,EAAUjuB,EAAQ45D,GAEtD,GAAa,cAATpxC,EAEA,IADA,IAAIpG,EAAQtiB,KAAK+jF,UAAU1hE,OAAOC,MACzB/iB,EAAI,EAAGA,EAAI+iB,EAAM9iB,SAAUD,EAAG,CACvB+iB,EAAM/iB,GACZkuB,mBAAoB,EAIlC,OAAOpY,GAsBXoZ,IAAK,SAAU/F,EAAMyF,EAAUjuB,EAAQ45D,GAGnC,GAFA95D,KAAK++E,QAEQ,cAATr2D,EAAsB,CACtB,IAAIw8D,EAAcllF,KAAKgkF,aACvB,IAAK,IAAI/kF,KAAQimF,EAAa,CACdA,EAAYjmF,GAClBwuB,mBAAoB,GAIlCztB,KAAKmlF,gBAAgBz8D,EAAMyF,EAAUjuB,EAAQ45D,IAUjDilB,MAAO,WACC/+E,KAAKikF,WAGTjkF,KAAKikF,UAAW,EAChBjkF,KAAK+jF,UAAY,IAAI5hE,EAAkBniB,KAAKykC,KAAMzkC,MAClDA,KAAKolF,kBAGTA,cAAe,WACXplF,KAAKgkF,aAAe3lE,EAAGG,WAAU,GAKjC,IAFA,IAAImE,EAAQ,KACR0iE,GAAmB,EACd9lF,EAAI,EAAGA,EAAIS,KAAKssC,OAAO9sC,SAAUD,EAAG,CACzC,IAAIqjB,EAAO5iB,KAAKssC,OAAO/sC,GACnBqjB,IACAD,EAAQ,IAAI/iB,GAAGmtB,eAAenK,GAM9B5iB,KAAKgkF,aAAarhE,EAAM1jB,MAAQ0jB,EAC5B2gE,EAAWtjF,KAAKosC,aAAcxpB,KAC9ByiE,EAAmB1iE,IAI3B3iB,KAAKosC,eAAiBi5C,IACtB1iE,EAAQ,IAAI/iB,GAAGmtB,eAAe/sB,KAAKosC,cAMnCpsC,KAAKgkF,aAAarhE,EAAM1jB,MAAQ0jB,MAK5CqpB,EAAU1pC,UAAU2iF,eAAiBrtD,EAAYt1B,UAAU4rB,GAC3D8d,EAAU1pC,UAAU6iF,gBAAkBvtD,EAAYt1B,UAAUmsB,IAE5D7uB,GAAGosC,UAAY7sC,EAAOE,QAAU2sC,uKCjqBhC,IAAMrsC,EAAOD,EAAQ,iBACf08E,EAAY18E,EAAQ,iBACpBw9B,EAAYx9B,EAAQ,yBAQtB4lF,EAAc1lF,GAAGE,OACjBb,KAAM,iBACNsC,QAAS66E,EAETjwC,QAAQR,EAKR5rC,KAAM,WAGFC,KAAKq6B,MAAQ,IAAIz6B,GAAGq4B,OAGxBzP,YACI6E,OACI5E,QAAS,KACTC,KAAMwU,GAEV5E,QAAS,EACTitD,OAAO,EACPhtD,OAAO,EACPitD,aACI/8D,SAAS,EACT+sC,cAAc,GAelB+uB,WACI57D,IAAK,WAED,OADY3oB,KAAKq6B,MAAMc,aACNv7B,GAAGq4B,MAAMS,MAAMK,SAEpClQ,SAAS,GAUbjG,MACI+F,IAAK,WACD,OAAO3oB,KAAKqtB,OAEhBvB,IAAK,SAAU/nB,GAAO,IAAAsqB,EAAAruB,KAClB,GAAqB,iBAAV+D,EAAoB,CAAA,IAAAuqB,EAAA,WAE3B1uB,GAAGu+B,OAAO,KAAM,iBAAkB,eAAgB,YAAa,eAAgB,SAC/E,IAAI5P,EAAAF,EAMJ,OALA6O,EAAUkB,WAAWr6B,EAAO,SAAUk3B,EAAKrY,GACnCA,IACA2L,EAAK3L,KAAOA,MAGpB4L,OAAA,GAT2B,GAAA,GAAA,iBAAAF,EAAA,OAAAA,EAAAE,EAY3BzqB,IAAU/D,KAAKqtB,QAGnBrtB,KAAKqtB,MAAQtpB,EACb/D,KAAKq6B,MAAM55B,OACPT,KAAKo/B,UACLp/B,KAAKq6B,MAAMnC,IAAMl4B,KAAKqtB,SAG9B3E,KAAMwU,EACNinD,SAASC,EACTqB,YAAY,GAUhB1qD,QACIpS,IAAK,WACD,OAAO3oB,KAAKs4B,SAEhBxM,IAAK,SAAU/nB,GAMX,OALAA,EAAQpE,EAAK+lF,QAAQ3hF,GACrB/D,KAAKs4B,QAAUv0B,EACV/D,KAAKulF,OACNvlF,KAAKq6B,MAAMP,UAAU/1B,GAElBA,GAEXogF,SAASC,GAUbuB,MACIh9D,IAAK,WACD,OAAO3oB,KAAKulF,OAEhBz5D,IAAK,SAAU/nB,GAGX,OAFA/D,KAAKulF,MAAQxhF,EACb/D,KAAKq6B,MAAMP,UAAU/1B,EAAQ,EAAI/D,KAAKs4B,SAC/Bv0B,GAEX0hF,YAAY,EACZtB,SAASC,GAUbxpD,MACIjS,IAAK,WACD,OAAO3oB,KAAKu4B,OAEhBzM,IAAK,SAAU/nB,GAGX,OAFA/D,KAAKu4B,MAAQx0B,EACb/D,KAAKq6B,MAAMN,QAAQh2B,GACZA,GAEX0hF,YAAY,EACZtB,SAASC,GAUbE,YACI77D,SAAS,EACT07D,SAASC,EACTqB,YAAY,GAGhBrmD,SACI3W,SAAS,EACTg9D,YAAY,IAIpBG,kBAvKuB,WAwKf5lF,KAAKq6B,MAAMnC,MAAQl4B,KAAKqtB,QACxBrtB,KAAKq6B,MAAMnC,IAAMl4B,KAAKqtB,QAI9Bw4D,gBAAiB,WACD7lF,KAAKq6B,MAAMc,aACTv7B,GAAGq4B,MAAMS,MAAMK,UACzB/4B,KAAKq6B,MAAMzS,QACX5nB,KAAKwlF,aAAc,IAI3BM,iBAAkB,WACV9lF,KAAKwlF,aACLxlF,KAAKq6B,MAAMvS,SAEf9nB,KAAKwlF,aAAc,GAGvBxG,OAAQ,WACJh/E,KAAKq6B,MAAMP,UAAU95B,KAAKulF,MAAQ,EAAIvlF,KAAKs4B,SAC3Ct4B,KAAKq6B,MAAMN,QAAQ/5B,KAAKu4B,QAG5B0mD,SAAU,WACFj/E,KAAKo/B,UACLp/B,KAAKq6B,MAAMnC,IAAMl4B,KAAKqtB,OAEtBrtB,KAAKskF,YACLtkF,KAAKinB,OAETrnB,GAAG06B,KAAKpM,GAAGtuB,GAAG06B,KAAKovB,WAAY1pD,KAAK6lF,gBAAiB7lF,MACrDJ,GAAG06B,KAAKpM,GAAGtuB,GAAG06B,KAAKinB,WAAYvhD,KAAK8lF,iBAAkB9lF,OAG1Dm/E,UAAW,WACPn/E,KAAKS,OACLb,GAAG06B,KAAK7L,IAAI7uB,GAAG06B,KAAKovB,WAAY1pD,KAAK6lF,gBAAiB7lF,MACtDJ,GAAG06B,KAAK7L,IAAI7uB,GAAG06B,KAAKinB,WAAYvhD,KAAK8lF,iBAAkB9lF,OAG3DwkF,UAAW,WACPxkF,KAAKS,OACLT,KAAKq6B,MAAMI,UACX76B,GAAG89B,YAAYqB,QAAQ/+B,KAAKqtB,QAQhCpG,KAAM,WACF,GAAMjnB,KAAKqtB,MAAX,CAEA,IAAIgN,EAAQr6B,KAAKq6B,MACbr6B,KAAKqtB,MAAMkO,QACXlB,EAAM55B,OAEVT,KAAK4lF,oBACLvrD,EAAML,eAAe,GACrBK,EAAMpT,SAQVxmB,KAAM,WACFT,KAAKq6B,MAAM55B,QAQfmnB,MAAO,WACH5nB,KAAKq6B,MAAMzS,SAQfE,OAAQ,WACJ9nB,KAAK4lF,oBACL5lF,KAAKq6B,MAAMvS,UAQfi+D,OAAQ,WACJ/lF,KAAKq6B,MAAML,eAAe,IAS9BkB,eAAgB,WACZ,OAAOl7B,KAAKq6B,MAAMa,kBAUtBlB,eAAgB,SAAU1tB,GAEtB,OADAtM,KAAKq6B,MAAML,eAAe1tB,GACnBA,GASX7K,YAAa,WACT,OAAOzB,KAAKq6B,MAAM54B,iBAK1B7B,GAAG0lF,YAAcnmF,EAAOE,QAAUimF,4FC1TlC,IAAMU,GAAe,aAAc,YAAa,WAC3B,YAAa,YAAa,UAC1B,aAAc,aAAc,cAEjD,SAASzxB,EAAiBroC,GACtBA,EAAMqoC,kBAcV,IAAM0xB,EAAmBrmF,GAAGE,OACxBb,KAAM,sBACNsC,QAAS7B,EAAQ,iBACjBysC,QACI+5C,KAAM,iDACNC,UAAW,8DACXC,KAAM,8CAGVnH,SAT8B,WAU1B,IAAK,IAAI1/E,EAAI,EAAGA,EAAIymF,EAAYxmF,OAAQD,IAGpCS,KAAKykC,KAAKvW,GAAG83D,EAAYzmF,GAAIg1D,EAAiBv0D,OAGtDm/E,UAhB8B,WAiB1B,IAAK,IAAI5/E,EAAI,EAAGA,EAAIymF,EAAYxmF,OAAQD,IACpCS,KAAKykC,KAAKhW,IAAIu3D,EAAYzmF,GAAIg1D,EAAiBv0D,SAK3DJ,GAAGqmF,iBAAmB9mF,EAAOE,QAAU4mF,6CC1CvC,IAAM7J,EAAY18E,EAAQ,iBACpBC,EAAOD,EAAQ,iBAOjB2mF,EAAazmF,GAAG43B,MAMhBkmB,KAAM,EAONu+B,MAAO,EAOPqK,OAAQ,EAMRxqC,MAAO,IAGLpjB,EAAQ94B,GAAG43B,MACbyL,OAAQ,EACRsjD,MAAO,EACPC,QAAS,EACTC,SAAU,IA0DVC,EAAS9mF,GAAGE,OACZb,KAAM,YACNsC,QAAS66E,EAETr8E,KAJkB,WAKdC,KAAK2mF,UAAW,EAChB3mF,KAAK4mF,UAAW,EAChB5mF,KAAK6mF,WAAa,KAClB7mF,KAAK8mF,SAAW,KAChB9mF,KAAK+mF,MAAQ,EACb/mF,KAAKgnF,qBAAsB,EAC3BhnF,KAAKinF,WAAa,EAClBjnF,KAAKknF,SAAW,EAChBlnF,KAAKmnF,eAAiB,EAEtBnnF,KAAKonF,QAAU,MAGnBj7C,QAAQR,EAORnjB,YAUI6+D,cACI5+D,SAAS,EACT07D,SAASC,EACTkD,OAHU,WAINtnF,KAAKunF,eAEAvnF,KAAKqnF,cACNrnF,KAAKwnF,eAGb/B,YAAY,GAGhBgC,iBACIhC,YAAY,EACZ35D,IAFa,SAER/nB,GACGA,GACA/D,KAAK0nF,4BAUjBC,sBACIl/D,SAAS,EACT07D,SAASC,EACTkD,OAHkB,WAIdtnF,KAAK4nF,yBAUbC,YACIp/D,QAAS49D,EAAW3oC,KACpBymC,SAASC,EACT17D,KAAM29D,EACNZ,YAAY,EACZ6B,OALQ,SAKAQ,GACJ9nF,KAAK+nF,kBAAkBD,IAE3BE,qBAAsB,cAU1BC,aACIx/D,QAAS7oB,GAAG4c,MAAM,IAAK,IAAK,KAC5B0rE,YAAa,SACb/D,SAASC,EACTkD,OAJS,WAKDtnF,KAAK6nF,aAAexB,EAAW3pE,OAAS1c,KAAKmoF,oBAAsBzvD,EAAMuK,SACzEjjC,KAAKooF,aAAa7sE,QAAUvb,KAAKioF,YAAYl/E,GAEjD/I,KAAKunF,iBASbc,cACI5/D,QAAS7oB,GAAG4c,MAAM,IAAK,IAAK,KAC5B0rE,YAAa,UACb/D,SAASC,EACTkD,OAJU,WAKFtnF,KAAK6nF,aAAexB,EAAW3pE,OAAS1c,KAAKmoF,oBAAsBzvD,EAAM8tD,UACzExmF,KAAKooF,aAAa7sE,QAAUvb,KAAKqoF,aAAat/E,GAElD/I,KAAKunF,gBAETS,qBAAsB,gBAQ1BM,YACI7/D,QAAS7oB,GAAG8c,MAAMoxB,MAClBo6C,YAAa,QACb/D,SAASC,EACTkD,OAJQ,WAKAtnF,KAAK6nF,aAAexB,EAAW3pE,OAAS1c,KAAKmoF,oBAAsBzvD,EAAM6tD,QACzEvmF,KAAKooF,aAAa7sE,QAAUvb,KAAKsoF,WAAWv/E,GAEhD/I,KAAKunF,gBAETS,qBAAsB,cAQ1BO,eACI9/D,QAAS7oB,GAAG4c,MAAM,IAAK,IAAK,KAC5B0rE,YAAa,WACb/D,SAASC,EACTkD,OAJW,WAKHtnF,KAAK6nF,aAAexB,EAAW3pE,OAAS1c,KAAKmoF,oBAAsBzvD,EAAM+tD,WACzEzmF,KAAKooF,aAAa7sE,QAAUvb,KAAKuoF,cAAcx/E,GAEnD/I,KAAKunF,iBASb3lF,UACI6mB,QAAS,GACT0tC,OAAQ,EAAG,IACXguB,SAASC,GASboE,WACI//D,QAAS,IACT07D,SAASC,GASbqE,cACIhgE,QAAS,KACTC,KAAM9oB,GAAGioE,YACTqgB,YAAa,SACb/D,SAASC,EACTkD,OALU,WAMNtnF,KAAKunF,iBASbmB,eACIjgE,QAAS,KACTC,KAAM9oB,GAAGioE,YACTqgB,YAAa,UACb/D,SAASC,EACT4D,qBAAsB,gBACtBV,OANW,WAOPtnF,KAAKunF,iBASboB,aACIlgE,QAAS,KACTC,KAAM9oB,GAAGioE,YACTqgB,YAAa,QACb/D,SAASC,EACT4D,qBAAsB,cACtBV,OANS,WAOLtnF,KAAKunF,iBASbqB,gBACIngE,QAAS,KACTC,KAAM9oB,GAAGioE,YACTqgB,YAAa,WACb/D,SAASC,EACTkD,OALY,WAMRtnF,KAAKunF,iBAmBbrnF,QACIuoB,QAAS,KACTC,KAAM9oB,GAAG2jB,KACT4gE,SAASC,EACTkD,OAJI,WAKAtnF,KAAK6oF,iBASbC,aACIrgE,WACAC,KAAM9oB,GAAGw8E,UAAU2M,aACnB5E,SAASC,IAIjBt7D,SACIu9D,WAAYA,GAGhB33C,UA5RkB,WA6Rd1uC,KAAK6oF,eACL7oF,KAAKunF,gBAGTC,YAjSkB,WAkSdxnF,KAAK2mF,UAAW,EAChB3mF,KAAK4mF,UAAW,EAEhB,IAAI1mF,EAASF,KAAKooF,aACdP,EAAa7nF,KAAK6nF,WAClBA,IAAexB,EAAWpK,OAASj8E,KAAKqnF,aACxCrnF,KAAKgpF,gBAAgBhpF,KAAKioF,aACnBJ,IAAexB,EAAWvqC,QACjC57C,EAAOwqC,MAAQ1qC,KAAKmnF,gBAExBnnF,KAAKgnF,qBAAsB,GAG/B/H,SA/SkB,WAiTVj/E,KAAKyoF,cACLzoF,KAAKyoF,aAAa7Y,oBAElB5vE,KAAK2oF,aACL3oF,KAAK2oF,YAAY/Y,oBAEjB5vE,KAAK0oF,eACL1oF,KAAK0oF,cAAc9Y,oBAEnB5vE,KAAK4oF,gBACL5oF,KAAK4oF,eAAehZ,oBAIpB5vE,KAAKipF,kBAebb,WA9UkB,WA+Ud,OAAOpoF,KAAKE,OAASF,KAAKE,OAASF,KAAKykC,MAG5CukD,gBAlVkB,SAkVFxsE,GACZ,IAAItc,EAASF,KAAKooF,aAClBloF,EAAOsc,MAAQA,EACftc,EAAOqb,QAAUiB,EAAMzT,GAG3BmgF,eAxVkB,SAwVFvmE,GACZ,OAAQA,GACJ,KAAK+V,EAAMuK,OACP,OAAOjjC,KAAKioF,YAChB,KAAKvvD,EAAM6tD,MACP,OAAOvmF,KAAKsoF,WAChB,KAAK5vD,EAAM8tD,QACP,OAAOxmF,KAAKqoF,aAChB,KAAK3vD,EAAM+tD,SACP,OAAOzmF,KAAKuoF,gBAIxBY,gBArWkB,SAqWDxmE,GACb,OAAQA,GACJ,KAAK+V,EAAMuK,OACP,OAAOjjC,KAAKyoF,aAChB,KAAK/vD,EAAM6tD,MACP,OAAOvmF,KAAK2oF,YAChB,KAAKjwD,EAAM8tD,QACP,OAAOxmF,KAAK0oF,cAChB,KAAKhwD,EAAM+tD,SACP,OAAOzmF,KAAK4oF,iBAIxBQ,sBAlXkB,SAkXK5sE,GACnB,OAASxc,KAAKmoF,mBACV,KAAKzvD,EAAMuK,OACPjjC,KAAKioF,YAAczrE,EACnB,MACJ,KAAKkc,EAAM6tD,MACPvmF,KAAKsoF,WAAa9rE,EAClB,MACJ,KAAKkc,EAAM8tD,QACPxmF,KAAKqoF,aAAe7rE,EACpB,MACJ,KAAKkc,EAAM+tD,SACPzmF,KAAKuoF,cAAgB/rE,IAKjC6sE,uBAnYkB,SAmYMlgE,GACpB,OAASnpB,KAAKmoF,mBACV,KAAKzvD,EAAMuK,OACPjjC,KAAKyoF,aAAet/D,EACpB,MACJ,KAAKuP,EAAM6tD,MACPvmF,KAAK2oF,YAAcx/D,EACnB,MACJ,KAAKuP,EAAM8tD,QACPxmF,KAAK0oF,cAAgBv/D,EACrB,MACJ,KAAKuP,EAAM+tD,SACPzmF,KAAK4oF,eAAiBz/D,IAKlCg2D,UApZkB,WAqZdn/E,KAAKwnF,cAGDxnF,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAU2Y,YAAapyD,KAAKspF,cAAetpF,MACjEA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAU4Y,WAAYryD,KAAKupF,aAAcvpF,MAC/DA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAU6Y,UAAWtyD,KAAKwpF,cAAexpF,MAC/DA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAU8Y,aAAcvyD,KAAKypF,eAAgBzpF,MAEnEA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAUiZ,YAAa1yD,KAAK0pF,eAAgB1pF,MAClEA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAUkZ,YAAa3yD,KAAK2pF,gBAAiB3pF,OAM3Ea,OApakB,SAoaVF,GACJ,IAAIT,EAASF,KAAKooF,aAClB,IAAIpoF,KAAKgnF,sBACLhnF,KAAK6nF,aAAexB,EAAWpK,OAASj8E,KAAK6nF,aAAexB,EAAWvqC,OAA3E,CAEA97C,KAAKsM,MAAQ3L,EACb,IAAIujB,EAAQ,EAUZ,GATIlkB,KAAK4B,SAAW,IAChBsiB,EAAQlkB,KAAKsM,KAAOtM,KAAK4B,UAGzBsiB,GAAS,IACTA,EAAQ,EACRlkB,KAAKgnF,qBAAsB,GAG3BhnF,KAAK6nF,aAAexB,EAAWpK,MAAO,CACtC,IAAIz/D,EAAQxc,KAAK6mF,WAAW58D,KAAKjqB,KAAK8mF,SAAU5iE,GAChDlkB,KAAKgpF,gBAAgBxsE,QACdxc,KAAK6nF,aAAexB,EAAWvqC,QACtC57C,EAAOwqC,MAAQ/qC,EAAKsqB,KAAKjqB,KAAKinF,WAAYjnF,KAAKknF,SAAUhjE,MAKjE+kE,eA7bkB,WA8bdjpF,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAU2Y,YAAapyD,KAAKspF,cAAetpF,MAChEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAU4Y,WAAYryD,KAAKupF,aAAcvpF,MAC9DA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAU6Y,UAAWtyD,KAAKwpF,cAAexpF,MAC9DA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAU8Y,aAAcvyD,KAAKypF,eAAgBzpF,MAElEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUiZ,YAAa1yD,KAAK0pF,eAAgB1pF,MACjEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUkZ,YAAa3yD,KAAK2pF,gBAAiB3pF,OAGtE4pF,iBAvckB,SAucA1pF,GACd,IAAI2pF,EAAS,KAIb,OAHI3pF,IACA2pF,EAAS3pF,EAAOwlB,aAAa9lB,GAAGkqF,SAE7BD,GAGXhB,aA/ckB,WAgdd,IAAI3oF,EAASF,KAAKooF,aAClBpoF,KAAKonF,QAAUpnF,KAAK4pF,iBAAiB1pF,GACrCF,KAAKmnF,eAAiBjnF,EAAOwqC,OAIjC4+C,cAtdkB,SAsdHp9D,GACNlsB,KAAKqnF,cAAiBrnF,KAAKg8D,qBAEhCh8D,KAAK2mF,UAAW,EAChB3mF,KAAKunF,eACLr7D,EAAMqoC,oBAGVg1B,aA9dkB,SA8dJr9D,GACV,GAAKlsB,KAAKqnF,cAAiBrnF,KAAKg8D,oBAAuBh8D,KAAK2mF,SAA5D,CAGA,IAAIjzB,EAAQxnC,EAAMwnC,MACdq2B,EAAM/pF,KAAKykC,KAAKovB,SAASH,EAAMC,eAC/BzzD,EAASF,KAAKooF,aAElB,GAAIpoF,KAAK6nF,aAAexB,EAAWvqC,MAC3BiuC,GACA/pF,KAAKinF,WAAajnF,KAAKmnF,eACvBnnF,KAAKknF,SAAWlnF,KAAKmnF,eAAiBnnF,KAAKwoF,UAC3CxoF,KAAKgnF,qBAAsB,IAE3BhnF,KAAKsM,KAAO,EACZtM,KAAKgnF,qBAAsB,EAC3B9mF,EAAOwqC,MAAQ1qC,KAAKmnF,oBAErB,CACH,IAAIxkE,OAAA,EAEAA,EADAonE,EACQrxD,EAAM8tD,QAEN9tD,EAAMuK,OAElBjjC,KAAKgqF,iBAAiBrnE,GAE1BuJ,EAAMqoC,oBAGVi1B,cA5fkB,SA4fHt9D,GACNlsB,KAAKqnF,cAAiBrnF,KAAKg8D,qBAE5Bh8D,KAAK2mF,WACL/mF,GAAGw8E,UAAU2M,aAAakB,WAAWjqF,KAAK8oF,YAAa58D,GACvDlsB,KAAKykC,KAAK/W,KAAK,QAAS1tB,OAE5BA,KAAK2mF,UAAW,EAChB3mF,KAAKunF,eACLr7D,EAAMqoC,oBAGVk1B,eAxgBkB,WAygBTzpF,KAAKqnF,cAAiBrnF,KAAKg8D,qBAEhCh8D,KAAK2mF,UAAW,EAChB3mF,KAAKunF,iBAGTmC,eA/gBkB,YAghBV1pF,KAAK2mF,UAAa3mF,KAAKqnF,cAAiBrnF,KAAKg8D,qBAC7Ch8D,KAAK6nF,aAAexB,EAAWC,QAAWtmF,KAAK2oF,eAE9C3oF,KAAK4mF,WACN5mF,KAAK4mF,UAAW,EAChB5mF,KAAKunF,kBAIboC,gBAzhBkB,WA0hBV3pF,KAAK4mF,WACL5mF,KAAK4mF,UAAW,EAChB5mF,KAAKunF,iBAKbA,aAjiBkB,WAkiBd,IAAI5kE,EAAQ3iB,KAAKmoF,kBACjBnoF,KAAKgqF,iBAAiBrnE,GACtB3iB,KAAK4nF,wBAGTO,gBAviBkB,WAqjBd,OAZKnoF,KAAKqnF,aAGDrnF,KAAK2mF,SACFjuD,EAAM8tD,QAETxmF,KAAK4mF,SACFluD,EAAM6tD,MAGN7tD,EAAMuK,OATNvK,EAAM+tD,UActByD,kCAxjBkB,SAwjBiBvnE,GAC/B,IAAInG,EAAQxc,KAAKkpF,eAAevmE,GAChC3iB,KAAKgpF,gBAAgBxsE,IAGzB2tE,uBA7jBkB,SA6jBMxnE,GACpB,GAAiBA,IAAU+V,EAAM+tD,SAC7BzmF,KAAKkqF,kCAAkCvnE,OAEtC,CACD,IAAIziB,EAASF,KAAKooF,aACd5rE,EAAQxc,KAAKkpF,eAAevmE,GAChC3iB,KAAK6mF,WAAa3mF,EAAOsc,MAAMnc,QAC/BL,KAAK8mF,SAAWtqE,EAChBxc,KAAKsM,KAAO,EACZtM,KAAKgnF,qBAAsB,IAInCoD,wBA3kBkB,SA2kBOznE,GACrB,IAAIknE,EAAS7pF,KAAKmpF,gBAAgBxmE,GAC9B3iB,KAAKonF,SAAWyC,IAChB7pF,KAAKonF,QAAQj+D,YAAc0gE,IAInCQ,uBAllBkB,SAklBM1nE,GAChBA,IAAU+V,EAAM8tD,QAChBxmF,KAAKsqF,UAELtqF,KAAKuqF,aAIbD,QA1lBkB,WA2lBdtqF,KAAKinF,WAAajnF,KAAKmnF,eACvBnnF,KAAKknF,SAAWlnF,KAAKmnF,eAAiBnnF,KAAKwoF,UAC3CxoF,KAAKsM,KAAO,EACZtM,KAAKgnF,qBAAsB,GAG/BuD,UAjmBkB,WAkmBd,IAAIrqF,EAASF,KAAKooF,aAClBpoF,KAAKinF,WAAa/mF,EAAOwqC,MACzB1qC,KAAKknF,SAAWlnF,KAAKmnF,eACrBnnF,KAAKsM,KAAO,EACZtM,KAAKgnF,qBAAsB,GAG/Be,kBAzmBkB,SAymBCyC,GAEXA,IAAkBnE,EAAWpK,MAC7Bj8E,KAAKkqF,kCAAkCxxD,EAAMuK,QAExCunD,IAAkBnE,EAAWC,QAClCtmF,KAAKoqF,wBAAwB1xD,EAAMuK,QAEvCjjC,KAAKunF,gBAGTyC,iBApnBkB,SAonBArnE,GACd,IAAIklE,EAAa7nF,KAAK6nF,WAClBA,IAAexB,EAAWpK,MAC1Bj8E,KAAKmqF,uBAAuBxnE,GACrBklE,IAAexB,EAAWC,OACjCtmF,KAAKoqF,wBAAwBznE,GACtBklE,IAAexB,EAAWvqC,OACjC97C,KAAKqqF,uBAAuB1nE,IAIpC+kE,yBAAyB/7C,EAIzBi8C,qBAnoBkB,WAooBd,GAAI5nF,KAAKonF,QAAS,CACd,GAAIpnF,KAAK2nF,wBACC3nF,KAAK6nF,aAAexB,EAAWC,QAAUtmF,KAAK4oF,gBAC3C5oF,KAAKqnF,cAEN,YADArnF,KAAKonF,QAAQqD,SAAS7qF,GAAGkqF,OAAOpxD,MAAMgyD,MAKlD1qF,KAAKonF,QAAQqD,SAAS7qF,GAAGkqF,OAAOpxD,MAAMuK,YAKlDrjC,GAAG8mF,OAASvnF,EAAOE,QAAUqnF,iECrvB7B,IAAIx/B,EAASxnD,EAAQ,sBACjB08E,EAAY18E,EAAQ,iBASpBirF,EAAS/qF,GAAGE,OACZb,KAAM,YACNsC,QAAS66E,EAETjwC,QAAQR,EAORi/C,eAAej/C,EAIf7iB,SAOIqR,SAAU,MAGd3R,YAQIqiE,kBAAmBjrF,GAAGqvC,KAAK,IAAK,KAChC67C,kBACIniE,IAAK,WACD,OAAO/oB,GAAGqvC,KAAKjvC,KAAK6qF,oBAExB/+D,IAAK,SAAU/nB,GACX/D,KAAK6qF,kBAAkBlnF,MAAQI,EAAMJ,MACrC3D,KAAK6qF,kBAAkBjnF,OAASG,EAAMH,OACtC5D,KAAK+qF,gBACL/qF,KAAKgrF,mBAET7G,SAASC,GAGb6G,WAAW,EACXC,YAAY,EAQZC,WACIxiE,IAAK,WACD,OAAO3oB,KAAKkrF,YAEhBp/D,IAAK,SAAU/nB,GACP/D,KAAKkrF,aAAennF,IACpB/D,KAAKkrF,WAAannF,EAClB/D,KAAK+qF,gBACL/qF,KAAKgrF,oBAGb7G,SAASC,GASbgH,UACIziE,IAAK,WACD,OAAO3oB,KAAKirF,WAEhBn/D,IAAK,SAAU/nB,GACP/D,KAAKirF,YAAclnF,IACnB/D,KAAKirF,UAAYlnF,EACjB/D,KAAK+qF,gBACL/qF,KAAKgrF,oBAGb7G,SAASC,IAIjBrkF,KAAM,WACFC,KAAKqrF,eAAiBrrF,KAAKgrF,gBAAgBnyD,KAAK74B,OAGpD0uC,UAAW,WAMP,GAAIi8C,EAAOxwD,SACP,OAAOv6B,GAAGyC,QAAQ,KACdrC,KAAKykC,KAAKxlC,KAAM0rF,EAAOxwD,SAASsK,KAAKxlC,MAE7C0rF,EAAOxwD,SAAWn6B,KAMVJ,GAAGi4B,IAAIsjD,SACPv4B,OAAOvpB,iBAAiB,SAAUr5B,KAAKqrF,gBAGvCzrF,GAAG6iD,KAAKv0B,GAAG,gBAAiBluB,KAAKqrF,gBAIzCrrF,KAAK+qF,gBACL/qF,KAAKgrF,kBAGL,IAAIM,EAAa1rF,GAAG2mB,KAAK,cAAevmB,KAAKykC,MACxC6mD,KACDA,EAAa,IAAI1rF,GAAG2jB,KAAK,gBACd5e,OAAS3E,KAAKykC,KACzB6mD,EAAWC,gBAAgB,IAE/B,IAAI5vB,EAAS2vB,EAAW5lE,aAAawhC,GACrC,IAAKyU,EAAQ,CACTA,EAAS2vB,EAAWE,aAAatkC,GAEjC,IAAI80B,EAAa90B,EAAO80B,WACxBrgB,EAAOmiB,WAAa9B,EAAWC,MAAQD,EAAWE,MAAQF,EAAWG,QACrExgB,EAAOvU,OAAS,EAEpBF,EAAOC,KAAOwU,GAGlB6oB,UAAW,WAKC5kF,GAAGi4B,IAAIsjD,SACPv4B,OAAOppB,oBAAoB,SAAUx5B,KAAKqrF,gBAG1CzrF,GAAG6iD,KAAKh0B,IAAI,gBAAiBzuB,KAAKqrF,gBAItCV,EAAOxwD,WAAan6B,OACpB2qF,EAAOxwD,SAAW,OAM1B6wD,gBAAiB,WACb,IAAIS,EAAYC,EAMRC,EAAaD,EAAW9rF,GAAGkqE,YAC/B2hB,EAAa7rF,GAAG6iD,KAAKmpC,0BACrB,IACIC,EAAU,EACVC,EAAU,GAFM9rF,KAAKmrF,YAAcnrF,KAAKorF,WAKxCS,EAAkD,IAAvCJ,EAAW9nF,MAAQgoF,EAAWhoF,OACzCmoF,EAAoD,IAAzCL,EAAW7nF,OAAS+nF,EAAW/nF,SAE9C5D,KAAKykC,KAAK3/B,YAA+B,GAAnB6mF,EAAWhoF,MAAckoF,EAA6B,GAApBF,EAAW/nF,OAAekoF,GAEtF9rF,KAAKykC,KAAK9gC,MAAQ+nF,EAAS/nF,MAC3B3D,KAAKykC,KAAK7gC,OAAS8nF,EAAS9nF,QAGhCmnF,cAAe,WACX,IACIgB,EADAC,EAAmBpsF,GAAGosF,iBAItBD,EADA/rF,KAAKmrF,WAAanrF,KAAKorF,SACdY,EAAiBC,SAEpBjsF,KAAKmrF,WAAcnrF,KAAKorF,SAGzBprF,KAAKorF,SACDY,EAAiBE,YAGjBF,EAAiBG,aANjBH,EAAiBI,UAS9B,IAAIC,EAAYrsF,KAAK6qF,kBAKjBjrF,GAAG6iD,KAAK6pC,wBAAwBD,EAAU1oF,MAAO0oF,EAAUzoF,OAAQmoF,MAM/EnsF,GAAG+qF,OAASxrF,EAAOE,QAAUsrF,qEC7N7B,IAAIthB,EAAW3pE,EAAQ,wBACnB2e,EAAK3e,EAAQ,kBACboiE,EAAc,IAAKpiE,EAAQ,4BAAb,CAA0C,QAExD0gF,EAAmB/W,EAAShY,MAAM+uB,iBAClCmM,EAAiBljB,EAAShY,MAAMk7B,eAgBhCnQ,EAAYx8E,GAAGE,OACfb,KAAM,eACNsC,QAAS8nE,EAETtpE,KAaI,WACAC,KAAK4f,IAAMkiD,EAAYoD,WAEvBllE,KAAKo6D,mBAGT5xC,YASIic,MACIhc,QAAS,KACTI,SAAS,GAGb5pB,MACI0pB,IADE,WAEE,GAAI3oB,KAAKstB,MACL,OAAOttB,KAAKstB,MAEhB,IAAIshC,EAAYhvD,GAAGye,GAAGmuE,aAAaxsF,MAC/BysF,EAAW79B,EAAU89B,YAAY,KAIrC,OAHID,GAAY,IACZ79B,EAAYA,EAAUpmD,MAAMikF,EAAW,IAEpCzsF,KAAKykC,KAAKxlC,KAAO,IAAM2vD,EAAY,KAE9C9iC,IAZE,SAYG/nB,GACD/D,KAAKstB,MAAQvpB,GAEjB8kB,SAAS,GAYb87B,MACIh8B,IADE,WAEE,OAAO3oB,KAAK4f,KAEhBiJ,SAAS,GAGb8jE,eAAehhD,EA8Bfu1C,UAAU,EAYVxyE,SACIia,IADK,WAED,OAAO3oB,KAAKkhF,UAEhBp1D,IAJK,SAIA/nB,GACD,GAAI/D,KAAKkhF,WAAan9E,IAClB/D,KAAKkhF,SAAWn9E,EACZ/D,KAAKykC,KAAKg0B,oBAAoB,CAC9B,IAAIoqB,EAAgBjjF,GAAG+e,SAASyiC,eAC5Br9C,EACA8+E,EAAcK,WAAWljF,MAGzB6iF,EAAcO,YAAYpjF,QAK1C6oB,SAAS,GAYbmzC,oBACIrzC,IADgB,WAEZ,OAAQ3oB,KAAK80D,UAAYsrB,GAAoB,GAEjDv3D,SAAS,GAYb+jE,iBACIjkE,IADa,WAET,OAAO3oB,KAAK80D,UAAYy3B,KAmBpC1rF,OAAQ,KAURoiF,WAAY,KAWZv0C,UAAW,KAaXswC,OAAQ,KAaRt1D,MAAO,KAUPu1D,SAAU,KAUVE,UAAW,KAUXqF,UAAW,KAMXqI,gBAAiB,KAKjBC,oBAAqB,KAOrBlC,cAAe,KAkBfY,aArSqB,SAqSPuB,GACV,OAAO/sF,KAAKykC,KAAK+mD,aAAauB,IAuBlCrnE,aA7TqB,SA6TPqnE,GACV,OAAO/sF,KAAKykC,KAAK/e,aAAaqnE,IAiBlCC,cA/UqB,SA+UND,GACX,OAAO/sF,KAAKykC,KAAKuoD,cAAcD,IAiBnCE,uBAjWqB,SAiWGF,GACpB,OAAO/sF,KAAKykC,KAAKwoD,uBAAuBF,IAiB5Cv+E,wBAnXqB,SAmXIu+E,GACrB,OAAO/sF,KAAKykC,KAAKj2B,wBAAwBu+E,IAgB7CG,gBAAiB,KA2CjBhsB,UAAW,KAIXzmC,QAnbqB,WA2bbz6B,KAAKysC,UACDzsC,KAAKkhF,UAAYlhF,KAAKykC,KAAKg0B,oBAC3B74D,GAAG+e,SAASyiC,eAAegiC,YAAYpjF,OAKnDo3D,cAlcqB,WAocjBp3D,KAAKmtF,yBAIL,IADA,IAAIC,EAAeptF,KAAKo6D,eACf76D,EAAI,EAAGgiB,EAAI6rE,EAAa5tF,OAAQD,EAAIgiB,IAAKhiB,EAAG,CACjD,IAAIW,EAASktF,EAAa7tF,GAC1BW,GAAUA,EAAOy6D,UAAU36D,MAE/BotF,EAAa5tF,OAAS,EAQtBI,GAAG+e,SAAS0iC,eAAegsC,YAAYrtF,MAGvCA,KAAKykC,KAAK6oD,iBAAiBttF,OAG/B4hE,aA1dqB,SA0dP2rB,GAKV,OAJKA,IACDA,EAAS3tF,GAAG4tF,YAAYC,OAAOztF,KAAMA,OAEzCutF,EAAO9oD,KAAO,KACP8oD,GAuBX1zB,SAtfqB,SAsfX1rC,EAAUs1C,EAAUjxD,EAAQ+a,GAClC3tB,GAAGygB,SAAS8N,EAAU,MACtBvuB,GAAGygB,SAASojD,GAAY,EAAG,MAE3BA,EAAWA,GAAY,EACvBjxD,EAASG,MAAMH,GAAU5S,GAAGiI,MAAMy7D,eAAiB9wD,EACnD+a,EAAQA,GAAS,EAEjB,IAAIw6B,EAAYnoD,GAAG+e,SAASwC,eAMxB/B,EAAS2oC,EAAUoe,eAAenmE,MAEtC+nD,EAAU8R,SAAS1rC,EAAUnuB,KAAMyjE,EAAUjxD,EAAQ+a,EAAOnO,IAgBhEsuE,aAthBqB,SAshBPv/D,EAAUZ,GACpBvtB,KAAK65D,SAAS1rC,EAAU,EAAG,EAAGZ,IAYlCs2C,WAniBqB,SAmiBT8pB,GACHA,GAGL/tF,GAAG+e,SAASwC,eAAe0iD,WAAW8pB,EAAa3tF,OAYvDmtF,uBAnjBqB,WAojBjBvtF,GAAG+e,SAASwC,eAAeskD,uBAAuBzlE,SAI1Do8E,EAAUwR,kBAAoB,KAC9BxR,EAAUuE,gBAAkB,EA+B5BtiE,EAAGta,MAAMq4E,EAAW,uBAAwB,SAAUyR,EAAKxoE,GACvD,IAAIyoE,EAAUzoE,EAAM0oE,iBAChBD,IACAD,EAAID,kBAAoBE,GAE5B,IAAIpN,EAAQr7D,EAAM2oE,eACdtN,GAA0B,iBAAVA,IAChBmN,EAAIlN,gBAAkBD,KAwD9BtE,EAAU95E,UAAU2rF,aAAe,GAEnCruF,GAAGw8E,UAAYj9E,EAAOE,QAAU+8E,yGC5pBhCx8E,GAAGw8E,UAAU2M,aAAenpF,GAAGE,OAC3Bb,KAAM,gBACNupB,YAQItoB,QACIuoB,QAAS,KACTC,KAAM9oB,GAAG2jB,MAUb8I,UAAW,GACX6hE,aAAc,GACdC,gBACIxlE,IADY,WAIR,OAFA3oB,KAAKouF,qBAEEpuF,KAAKquF,aAAaruF,KAAKkuF,eAElCpiE,IANY,SAMP/nB,GACD/D,KAAKkuF,aAAeluF,KAAKsuF,aAAavqF,KAU9C4zC,SACIlvB,QAAS,IAUb8lE,iBACI9lE,QAAS,KAIjBK,SAOImhE,WAAY,SAASzjE,GACjB,aACA,IAAIoG,OAAA,EACJ,GAAI1a,UAAU1S,OAAS,EAEnB,IAAK,IAAID,EAAI,EAAGgiB,GADhBqL,EAAO,IAAIvZ,MAAMnB,UAAU1S,OAAS,IACXA,OAAQD,EAAIgiB,EAAGhiB,IACpCqtB,EAAKrtB,GAAK2S,UAAU3S,EAAE,GAG9B,IAAK,IAAIwlB,EAAI,EAAGC,EAAIwB,EAAOhnB,OAAQulB,EAAIC,EAAGD,IAAK,CAC3C,IAAImH,EAAQ1F,EAAOzB,GACbmH,aAAiBtsB,GAAGw8E,UAAU2M,cAEpC78D,EAAMwB,KAAKd,MAkBvBc,KAAM,SAAS9G,GACX,IAAI1mB,EAASF,KAAKE,OAClB,GAAKN,GAAGmsB,QAAQ7rB,GAAhB,CAEAF,KAAKouF,qBACL,IAAII,EAAW5uF,GAAGye,GAAGowE,cAAczuF,KAAKkuF,cAEpCzoE,EAAOvlB,EAAOwlB,aAAa8oE,GAC/B,GAAK5uF,GAAGmsB,QAAQtG,GAAhB,CAEA,IAAIkyB,EAAUlyB,EAAKzlB,KAAK23C,SACA,mBAAbA,IAEiB,MAAxB33C,KAAKuuF,iBAAoD,KAAzBvuF,KAAKuuF,kBACrC3nE,EAASA,EAAOpe,SACT9C,KAAK1F,KAAKuuF,iBAGrB52C,EAAQrrB,MAAM7G,EAAMmB,OAGxB0nE,aApHiC,SAoHnB9oE,GACV,IAAIC,EAAO7lB,GAAGye,GAAGqwE,eAAelpE,GAChC,OAAO5lB,GAAGye,GAAGswE,YAAYlpE,IAG7B4oE,aAzHiC,SAyHnBO,GACV,IAAInpE,EAAO7lB,GAAGye,GAAGowE,cAAcG,GAC/B,OAAOhvF,GAAGye,GAAGmuE,aAAa/mE,IAI9B2oE,mBA/HiC,WAgIxBpuF,KAAKkuF,eACNluF,KAAKmuF,eAAiBnuF,KAAKqsB,UAC3BrsB,KAAKqsB,UAAY,gCCpJ7B,IAAMxkB,EAAQnI,EAAQ,uBAChB+O,EAAkB/O,EAAQ,uBAC1BwhC,EAAexhC,EAAQ,6BACvBm6C,EAAan6C,EAAQ,2BACrBmvF,EAAiB3tD,EAAa2tD,eAsB9BC,EAAkBjnF,EAAMknF,cAsBxBC,EAAgBnnF,EAAMonF,sBA2BtBC,EAAWtvF,GAAG43B,MAChBkmB,KAAM,EACNyxC,MAAO,EACPC,OAAQ,EACRC,cAAe,IA8BfC,EAAQ1vF,GAAGE,OACXb,KAAM,WACNsC,QAASkN,EAET1O,KAJiB,WASbC,KAAKuvF,gBAAkB,EACvBvvF,KAAKwvF,eAAiB,KAEtBxvF,KAAKyvF,YAAc,MAGvBtjD,QAAQR,EAMRnjB,YACIknE,kBAAkB,EAOlBC,SACIlnE,QAAS,GACTu/D,qBAAsB,aAE1B4H,QACIjnE,IADI,WAEA,OAAO3oB,KAAK2vF,SAEhB7jE,IAJI,SAIC/nB,GACD,IAAI+jF,EAAW9nF,KAAK2vF,QACpB3vF,KAAK2vF,QAAU5rF,EAAM8iE,WAEjB7mE,KAAK4vF,SAAW9H,GAChB9nF,KAAK6vF,oBAGT7vF,KAAK8vF,qBAETC,WAAW,EACX5L,SAASC,GAQb4L,iBACIvnE,QAASqmE,EAAgBhY,KACzBpuD,KAAMomE,EACN3K,SAASC,EACTkD,OAJa,SAIJQ,GACD9nF,KAAKgwF,kBAAoBlI,GAC7B9nF,KAAK6vF,qBAETpK,YAAY,GAQhBwK,eACIxnE,QAASumE,EAAchY,IACvBtuD,KAAMsmE,EACN7K,SAASC,EACTkD,OAJW,SAIHQ,GACA9nF,KAAKiwF,gBAAkBnI,GAC3B9nF,KAAK6vF,qBAETpK,YAAY,GAShByK,gBACIhI,YAAa,mBACbzC,YAAY,EACZ7c,UAAU,EACVjgD,IAJY,WAKR,OAAO3oB,KAAKuvF,kBAIpBY,UAAW,GAMXroB,UACIn/C,IADM,WAEF,OAAO3oB,KAAKmwF,WAEhBrkE,IAJM,SAID/nB,GACG/D,KAAKmwF,YAAcpsF,IAEvB/D,KAAKmwF,UAAYpsF,EACjB/D,KAAK6vF,sBAET1L,SAASC,GAQbgM,YACI3nE,QAAS,QACT07D,SAASC,EACTkD,OAHQ,SAGAQ,GACA9nF,KAAKowF,aAAetI,GACxB9nF,KAAK6vF,qBAETpK,YAAY,GAGhB4K,YAAa,GAMbC,YACI3nE,IADQ,WAEJ,OAAO3oB,KAAKqwF,aAEhBvkE,IAJQ,SAIH/nB,GACG/D,KAAKqwF,cAAgBtsF,IACzB/D,KAAKqwF,YAActsF,EACnB/D,KAAK6vF,sBAET1L,SAASC,GAObmM,UACI9nE,QAASymE,EAASxxC,KAClBh1B,KAAMwmE,EACN/K,SAASC,EACTkD,OAJM,SAIEQ,GACA9nF,KAAKuwF,WAAazI,GACtB9nF,KAAK6vF,qBAETpK,YAAY,GAGhB+K,iBAAiB,EAMjBC,gBACI9nE,IADY,WAER,OAAO3oB,KAAKwwF,iBAEhB1kE,IAJY,SAIP/nB,GACG/D,KAAKwwF,kBAAoBzsF,IAE7B/D,KAAKwwF,gBAAkBzsF,EACvB/D,KAAK6vF,sBAETpK,YAAY,EACZtB,SAASC,GAIbsM,QAAS,KAOTC,MACIhoE,IADE,WAEE,OAAO3oB,KAAK0wF,SAEhB5kE,IAJE,SAIG/nB,GACG/D,KAAK2wF,OAAS5sF,IAGbA,IACD/D,KAAK4wF,mBAAoB,GAO7B5wF,KAAK0wF,QAAU3sF,EACXA,GAAS/D,KAAK4wF,oBACd5wF,KAAK4wF,mBAAoB,GAEP,iBAAV7sF,GACRnE,GAAGu+B,OAAO,KAGVn+B,KAAK6wF,cACL7wF,KAAK8wF,kBAAkB9wF,KAAK6wF,aAC5B7wF,KAAK6wF,YAAc,MAEvB7wF,KAAK+wF,WAAa,KAClB/wF,KAAKgxF,mBACLhxF,KAAKixF,mBAAkB,GACvBjxF,KAAK6vF,sBAETnnE,KAAM9oB,GAAG+nE,KACTwc,SAASC,EACTqB,YAAY,GAGhBmL,mBAAmB,EAOnBM,eACIvoE,IADW,WAEP,OAAO3oB,KAAK4wF,mBAEhB9kE,IAJW,SAIN/nB,GACG/D,KAAK4wF,oBAAsB7sF,IAE/B/D,KAAK8wF,kBAAkB9wF,KAAK6wF,aAC5B7wF,KAAK6wF,YAAc,KAUnB7wF,KAAK4wF,oBAAsB7sF,EACvBA,GACA/D,KAAK2wF,KAAO,KACZ3wF,KAAKgxF,mBACLhxF,KAAK6vF,oBACL7vF,KAAK8vF,qBAEC9vF,KAAKmxF,kBACXnxF,KAAKyuC,kBAIbg3C,YAAY,EACZtB,SAASC,GAGbgN,qBACIlJ,YAAa,uBACbv/D,IAFiB,WAGb,OAAI3oB,KAAK0wF,mBAAmB9wF,GAAG8nE,WACpB1nE,KAAK0wF,QAAQ5oB,UAGZ,GAGhBj/C,SAAS,EACT48D,YAAY,GAGhB4L,UAAW,EACXC,UACI3oE,IADM,WAEF,OAAO3oB,KAAKqxF,WAEhBvlE,IAJM,SAID/nB,GACD/D,KAAKqxF,UAAYttF,EACjB/D,KAAK6vF,sBAIb0B,SACI9oE,SAAS,EACT+sC,cAAc,GAElBg8B,WACI/oE,SAAS,EACT+sC,cAAc,GAElBi8B,cACIhpE,SAAS,EACT+sC,cAAc,IAItB1sC,SACIgmE,gBAAiBA,EACjBE,cAAeA,EACfE,SAAUA,GAGdjQ,SA7TiB,WA8Tbj/E,KAAKysC,SAGAzsC,KAAK2wF,MAAS3wF,KAAK4wF,oBACpB5wF,KAAKkxF,eAAgB,GAGrBlxF,KAAKkxF,gBAAkBlxF,KAAKowF,aAC5BpwF,KAAKowF,WAAa,SAItBpwF,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUsZ,aAAc/yD,KAAK6vF,kBAAmB7vF,MACrEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUuZ,eAAgBhzD,KAAK6vF,kBAAmB7vF,MAEvEA,KAAK8vF,oBACL9vF,KAAK6vF,mBAAkB,IAG3B1Q,UAjViB,WAkVbn/E,KAAKysC,SACLzsC,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAUsZ,aAAc/yD,KAAK6vF,kBAAmB7vF,MACtEA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAUuZ,eAAgBhzD,KAAK6vF,kBAAmB7vF,OAG5EwkF,UAvViB,WAwVbxkF,KAAKotC,WAAWskD,qBAAuB1xF,KAAKotC,WAAWskD,oBAAoB1xF,KAAKwvF,gBAChFxvF,KAAKwvF,eAAiB,KAClBxvF,KAAKyvF,cACLzvF,KAAKyvF,YAAYh1D,UACjBz6B,KAAKyvF,YAAc,MAEvBzvF,KAAKysC,UAGTklD,WAjWiB,WAkWb,IAAIr9E,EAAStU,KAAKysC,SACdkkD,EAAO3wF,KAAK2wF,KAChB,GAAIA,aAAgB/wF,GAAG8nE,WAAY,CAC/B,IAAIv+C,EAAcwnE,EAAKxnE,YAElBA,GAAgBA,EAAYwlD,kBAC7Br6D,GAAS,GAGjB,OAAOA,GAGXw7E,kBA9WiB,WA+Wb9vF,KAAK4xF,gBAAgB5xF,KAAK4vF,SAG9BzzC,iBAlXiB,WAmXbn8C,KAAKgxF,oBAGTA,iBAtXiB,WAuXb,IAAIa,EAAYvC,EAAMliD,WAAW0kD,aAAa9xF,MAE1CA,KAAKotC,aAAeykD,IACpB7xF,KAAKotC,WAAaykD,EAClB7xF,KAAK6wF,YAAc,MAGlB7wF,KAAK6wF,cACN7wF,KAAK6wF,YAAc7wF,KAAKotC,WAAW2kD,WAAW/xF,MAC9CA,KAAKgyF,yBAAwB,KAIrCf,kBApYiB,SAoYEziD,GAAO,IAAAngB,EAAAruB,KAClB2wF,EAAO3wF,KAAK2wF,KACZA,aAAgB/wF,GAAG8nE,WAAY,WAC/B,IAAIv+C,EAAcwnE,EAAKxnE,YACnBoF,EAAAF,EACA4jE,EAAwB,WAExB1jE,EAAKq8C,SAAWzhD,EAAYyhD,SAC5Br8C,EAAK2jE,kBAAkB1jD,GAENA,GACbxuC,KAAKotC,YAAcptC,KAAKotC,WAAW+kD,iBAAiBnyF,OAIxDmpB,GAAeA,EAAYwlD,gBAC3BsjB,KAGA5jE,EAAKogB,gBAEDtlB,IACAA,EAAYiF,KAAK,OAAQ6jE,EAAzB5jE,GACAlF,EAAYymD,sBArBW,IA0B1B5vE,KAAKyvF,cACNzvF,KAAKyvF,YAAc,IAAI7vF,GAAGuvC,UAGtBnvC,KAAKyvF,YAAY1Z,qBAAoB,GAEzC/1E,KAAKwvF,eAAiBxvF,KAAKotC,WAAWglD,oBACtCpyF,KAAKyvF,YAAYnb,gBAAgBt0E,KAAKwvF,eAAej1D,SAEzDv6B,KAAK4qE,SAAW5qE,KAAKyvF,YACrBzvF,KAAKkyF,kBAAkB1jD,GAENA,GACbxuC,KAAKotC,YAAcptC,KAAKotC,WAAW+kD,iBAAiBnyF,QAKhEkyF,kBAlbiB,SAkbE1jD,GACf,IAAIZ,EAAW5tC,KAAKqyF,UAChBzkD,IAAaY,IAKb5uC,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,mBAC/B7pD,KAAK4qE,SAASlvC,IAAM17B,KAAK2kD,KAAO,YAI3B/W,IACDA,EAAW,IAAIihD,GAGf7uF,KAAK4qE,WAAa5qE,KAAKyvF,YACvBzvF,KAAKsyF,gBAAkB1yF,GAAGiI,MAAM0qF,YAAYza,IAG5C93E,KAAKsyF,gBAAkB1yF,GAAGiI,MAAM0qF,YAAYC,UAEhD5kD,EAASsB,QAAUlvC,KAAK4qE,SAExBh9B,EAAS6kD,UAAW,EACpBzyF,KAAK0yF,gBAAgB9kD,IAGzB5tC,KAAKgyF,yBAAwB,GAC7BhyF,KAAK4xF,eAAc,KAGvBe,aAldiB,WAmdF3yF,KAAK2wF,gBACI/wF,GAAG8nE,WACnB1nE,KAAKysC,UAGLzsC,KAAK6vF,oBACL7vF,KAAKykC,KAAKyW,cAAgBrB,EAAWqc,aAI7C25B,kBA7diB,SA6dErhD,GACf,IAAIokD,EAAa5yF,KAAK6wF,YAClB+B,IACAA,EAAWC,WAAY,EACvBD,EAAWE,SAAU,EACrB9yF,KAAKgyF,yBAAwB,IAGhBxjD,IACbxuC,KAAKgxF,mBACLhxF,KAAKixF,kBAAkBziD,KAI/BukD,YA3eiB,SA2eJrkF,GACT1O,KAAKuxF,UAAY7iF,GAGrBskF,eA/eiB,SA+eDtkF,GACZ1O,KAAKwxF,YAAc9iF,GAGvBukF,iBAnfiB,SAmfCvkF,GACd1O,KAAKyxF,eAAiB/iF,KAI7B9O,GAAG0vF,MAAQnwF,EAAOE,QAAUiwF,2ICxlB7B,IAAI4D,EAAetzF,GAAGE,OAClBb,KAAM,kBACNsC,QAAS7B,EAAQ,iBACjBysC,QAAQR,EAMRnjB,YACI2sC,OAAQv1D,GAAG4c,MAAM,IAAI,IAAI,IAAI,KAC7B22E,OAAQ,EAUR32E,OACImM,IAAK,WACD,OAAO3oB,KAAKm1D,QAEhBrpC,IAAK,SAAU/nB,GACX/D,KAAKm1D,OAASv1D,GAAG4c,MAAMzY,GACvB/D,KAAK6vF,sBAYblsF,OACIglB,IAAK,WACD,OAAO3oB,KAAKmzF,QAEhBrnE,IAAK,SAAU/nB,GACX/D,KAAKmzF,OAASpvF,EACd/D,KAAK6vF,uBAKjB5Q,SAlDwB,WAmDpBj/E,KAAK6vF,qBAGT1Q,UAtDwB,WAuDpBn/E,KAAK6vF,qBAGTA,kBA1DwB,WA2DpB,IAAIuD,EAAQpzF,KAAKykC,KAAK/e,aAAa9lB,GAAG0vF,OAClC8D,GACAA,EAAMvD,uBAMlBjwF,GAAGszF,aAAe/zF,EAAOE,QAAU6zF,6CChFnC,IAAMvzF,EAAOD,EAAQ,iBACfwhC,EAAexhC,EAAQ,6BACvBk6C,EAAO1Y,EAAa0Y,KACpBy5C,EAAkBnyD,EAAamyD,gBAC/B5kF,EAAkB/O,EAAQ,uBAC1Bm6C,EAAan6C,EAAQ,2BACrB4zF,EAAW5zF,EAAQ,wBACnB6jB,EAAO7jB,EAAQ,aAEjB6zF,EAAa3zF,GAAGqE,KAChBytD,EAAa9X,EAAK/T,KAAKiH,SAEvB0mD,KAiBJ,IAAIC,EAAW7zF,GAAG43B,MAMdk8D,KAAM,EAMNC,QAAS,EAMTC,cAAe,IAYfj/B,EAAO/0D,GAAGE,OACVb,KAAM,UACNsC,QAASkN,EAET09B,QAAQR,EAMR5rC,KAVgB,WAWZC,KAAK6zF,UAAY,KACjB7zF,KAAK8zF,eAAiB,MAG1BtrE,YACIurE,cACItrE,QAAS,KACTC,KAAM9oB,GAAGioE,aAWbmsB,MAAOP,EAASC,KAChBhrE,MACIC,IAAK,WACD,OAAO3oB,KAAKg0F,OAEhBloE,IAAK,SAAU/nB,GACX/D,KAAKg0F,MAAQjwF,EACT/D,KAAKg0F,QAAUP,EAASG,gBACxB5zF,KAAKmpB,YAAc,KACnBnpB,KAAKi0F,eAAiB,EACtBj0F,KAAKk0F,mBAELl0F,KAAK6wF,cACL7wF,KAAK8wF,kBAAkB9wF,KAAK6wF,aAC5B7wF,KAAK6wF,YAAc,MAEvB7wF,KAAKkyF,qBAETxpE,KAAM+qE,EACNtP,SAASC,GAYbj7D,aACIT,KAAM9oB,GAAGioE,YACTsc,SAASC,EACTz7D,IAAK,WACD,OAAO3oB,KAAK+zF,cAEhBjoE,IAAK,SAAU/nB,GACX,IAAIowF,EAAan0F,KAAK+zF,aAOdI,IAAepwF,IAIvB/D,KAAK+zF,aAAehwF,EACpB/D,KAAKo0F,kBAAkBD,MAqB/BF,gBACIxrE,QAAS,EACTC,KAAM9oB,GAAGy0F,MACTl+B,OAAQ,EAAG,EAAG,IACdm+B,OAAO,EACPnQ,SAASC,EACTkD,OAAQ,WACA1nF,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,mBAI/B7pD,KAAKqyF,YACLryF,KAAKqyF,UAAU4B,eAAiBj0F,KAAKi0F,eACrCj0F,KAAKqyF,UAAUkC,cALf30F,GAAGu+B,OAAO,QAiBtBq2D,UACI/rE,SAAS,EACTC,KAAM9oB,GAAG8hE,QACTyiB,SAASC,EACTkD,OAAQ,WACA1nF,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,oBAC/BjqD,GAAGu+B,OAAO,QActBs2D,UAAW,GACXC,WACI/rE,IAAK,WACD,OAAO3oB,KAAKy0F,WAEhB3oE,IAAK,SAAU/nB,GACX/D,KAAKy0F,UAAY90F,EAAKoF,OAAOhB,EAhKvB,EACA,KAgKN/D,KAAKk0F,mBAETxrE,KAAM9oB,GAAG+1D,QACTwuB,SAASC,GAGbqD,iBACIhC,YAAY,EACZ35D,IAAK,SAAU/nB,GACRA,GACC/D,KAAK0nF,6BAMrB5+D,SACI6rE,KAAMlB,GAGVzU,OA5KgB,WA6KZh/E,KAAK40F,mBAGT1zB,UAhLgB,WAiLZlhE,KAAK40F,kBACD50F,KAAKg0F,QAAUP,EAASG,eACxB5zF,KAAKk0F,mBAIbjV,SAvLgB,WAwLZj/E,KAAKysC,SACDzsC,KAAKg0F,QAAUP,EAASG,cACnB5zF,KAAK+zF,cAAiB/zF,KAAK+zF,aAAaplB,kBAEzC3uE,KAAK4xF,eAAc,GACf5xF,KAAK+zF,eACL/zF,KAAK+zF,aAAa3lE,KAAK,OAAQpuB,KAAK60F,iBAAkB70F,MACtDA,KAAK+zF,aAAankB,sBAK1B5vE,KAAKk0F,kBAGTl0F,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAU4B,iBAAkBr7C,KAAKk0F,gBAAiBl0F,MACvEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUqZ,iBAAkB9yD,KAAKk0F,gBAAiBl0F,MACvEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUuC,cAAeh8C,KAAKk0F,gBAAiBl0F,MACpEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUsZ,aAAc/yD,KAAKk0F,gBAAiBl0F,MACnEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUuZ,eAAgBhzD,KAAKk0F,gBAAiBl0F,MAErEA,KAAKykC,KAAKyW,aAAerB,EAAWi7C,iBACpC90F,KAAKkyF,qBAGT/S,UAjNgB,WAkNZn/E,KAAKysC,SAELzsC,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAU4B,iBAAkBr7C,KAAKk0F,gBAAiBl0F,MACxEA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAUqZ,iBAAkB9yD,KAAKk0F,gBAAiBl0F,MACxEA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAUuC,cAAeh8C,KAAKk0F,gBAAiBl0F,MACrEA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAUsZ,aAAc/yD,KAAKk0F,gBAAiBl0F,MACpEA,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAUuZ,eAAgBhzD,KAAKk0F,gBAAiBl0F,MAEtEA,KAAKykC,KAAKyW,cAAgBrB,EAAWi7C,kBAGzCtQ,UA7NgB,WA8NZxkF,KAAKysC,SACLzsC,KAAK+0F,mBAGTrN,yBAAyB/7C,EAOzBkpD,iBAzOgB,WA2OR70F,KAAK6wF,cACL7wF,KAAK6wF,YAAYiC,SAAU,EAC3B9yF,KAAK6wF,YAAYgC,WAAY,EAC7B7yF,KAAKgyF,yBAAwB,IAG7BhyF,KAAKg8D,oBACLh8D,KAAKkyF,qBAIbkC,kBAtPgB,SAsPGY,GACXA,GAAYA,EAASvmE,KACrBumE,EAASvmE,IAAI,OAAQzuB,KAAK60F,iBAAkB70F,MAEhD,IAAImpB,EAAcnpB,KAAK+zF,aACnB5qE,IACIA,EAAYwlD,gBACZ3uE,KAAK60F,iBAAiB,OAGtB1rE,EAAYiF,KAAK,OAAQpuB,KAAK60F,iBAAkB70F,MAChDmpB,EAAYymD,uBAKxBsiB,kBAtQgB,WAwQZ,GAAIlyF,KAAKg0F,QAAUP,EAASG,eAAmB5zF,KAAKmpB,aAAgBnpB,KAAKmpB,YAAYwlD,gBAArF,CAMA,GAAI/uE,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,mBAO/B,GALK7pD,KAAKqyF,YACNryF,KAAKqyF,UAAY,IAAIgB,GAIrBrzF,KAAKg0F,QAAUP,EAASG,cAAe,CACvC,IAAI1kD,EAAUlvC,KAAKmpB,YAAY8jD,aAC/BjtE,KAAKqyF,UAAUnkD,UAAW,EAC1BluC,KAAKqyF,UAAU4C,YAAa,EAC5Bj1F,KAAKqyF,UAAUI,UAAW,EAC1BzyF,KAAKqyF,UAAUnjD,QAAUA,EACzBlvC,KAAKqyF,UAAU4B,eAAiBj0F,KAAKi0F,oBAGrCj0F,KAAKqyF,UAAUnkD,UAAW,EAC1BluC,KAAKqyF,UAAU4C,YAAa,EAC5Bj1F,KAAKqyF,UAAUI,UAAW,EAIlCzyF,KAAK4xF,eAAc,QA3Bf5xF,KAAK4xF,eAAc,IA8B3BgD,gBAvSgB,WAwSP50F,KAAK6zF,YACN7zF,KAAK6zF,UAAY,IAAIP,EACrBtzF,KAAK6zF,UAAUpvD,KAAOzkC,KAAKykC,KAC3BzkC,KAAK6zF,UAAUqB,UAAY,EAC3Bl1F,KAAK6zF,UAAUsB,YAAcv1F,GAAG4c,MAAM,EAAG,EAAG,EAAG,IAG9Cxc,KAAK8zF,iBACN9zF,KAAK8zF,eAAiB,IAAIR,EAC1BtzF,KAAK8zF,eAAervD,KAAO,IAAIlhB,EAC/BvjB,KAAK8zF,eAAe5B,oBACpBlyF,KAAK8zF,eAAeoB,UAAY,EAChCl1F,KAAK8zF,eAAelxF,KAAK,EAAG,EAAGhD,GAAGkqE,YAAYnmE,MAAO/D,GAAGkqE,YAAYlmE,QACpE5D,KAAK8zF,eAAesB,SAI5BlB,gBAzTgB,WA0TZ,IAAIzvD,EAAOzkC,KAAKykC,KACZ4wD,EAAWr1F,KAAK6zF,UAEpBwB,EAASzxC,OAAM,GACf,IAAIjgD,EAAQ8gC,EAAK2wB,aAAazxD,MAC1BC,EAAS6gC,EAAK2wB,aAAaxxD,OAC3BtE,GAAKqE,EAAQ8gC,EAAK6wB,aAAah2D,EAC/BoE,GAAKE,EAAS6gC,EAAK6wB,aAAa5xD,EACpC,GAAI1D,KAAKg0F,QAAUP,EAASC,KACxB2B,EAASzyF,KAAKtD,EAAGoE,EAAGC,EAAOC,QAE1B,GAAI5D,KAAKg0F,QAAUP,EAASE,QAAS,CAOtC,IANA,IAKI7tF,EAzXhB,SAA2B0tC,EAAQ8hD,EAAQZ,GACvClB,EAAch0F,OAAS,EAEvB,IADA,IAAI+1F,EAAyB,EAAVlwF,KAAK8E,GAASuqF,EACxBh0F,EAAO,EAAGA,EAAOg0F,IAAah0F,EACnC8yF,EAAc9tF,KAAK9F,GAAGqE,GAAGqxF,EAAOh2F,EAAI+F,KAAK6E,IAAIqrF,EAAe70F,GAAQ8yC,EAAOl0C,EACvEg2F,EAAO5xF,EAAI2B,KAAKiF,IAAIirF,EAAe70F,GAAQ8yC,EAAO9vC,IAG1D,OAAO8vF,EAiXcgC,CALA51F,GAAGqE,GAAG3E,EAAIqE,EAAQ,EAAGD,EAAIE,EAAS,IAE3CtE,EAAGqE,EAAQ,EACXD,EAAGE,EAAS,GAE8B5D,KAAKy0F,WAC1Cl1F,EAAI,EAAGA,EAAIuG,EAAOtG,SAAUD,EAAG,CACpC,IAAIg8D,EAAQz1D,EAAOvG,GACT,IAANA,EACA81F,EAASh+E,OAAOkkD,EAAMj8D,EAAGi8D,EAAM73D,GAG/B2xF,EAASI,OAAOl6B,EAAMj8D,EAAGi8D,EAAM73D,GAGvC2xF,EAAStqC,QAETnrD,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,mBAC/BwrC,EAASK,SAGTL,EAASD,QAIjBL,gBA/VgB,WAgWR/0F,KAAK6zF,WACL7zF,KAAK6zF,UAAUp5D,UAGfz6B,KAAK8zF,gBACL9zF,KAAK8zF,eAAer5D,WAI5Bo5B,SAzWgB,SAyWN4H,GACN,IAAIh3B,EAAOzkC,KAAKykC,KACZwK,EAAOxK,EAAKm4B,iBACZtpB,EAAIrE,EAAKtrC,MACT4vC,EAAItE,EAAKrrC,OACT83D,EAAS63B,EAQb,GANA9uD,EAAKq3B,qBACLliB,EAAK/T,KAAKoS,OAAOyZ,EAAYjtB,EAAKsW,cAClCnB,EAAKmiB,KAAKloB,cAAc6nB,EAAQD,EAAU/J,GAC1CgK,EAAOp8D,GAAKmlC,EAAK6wB,aAAah2D,EAAIg0C,EAClCooB,EAAOh4D,GAAK+gC,EAAK6wB,aAAa5xD,EAAI6vC,EAE9BvzC,KAAK0oB,OAAS+qE,EAASC,MAAQ1zF,KAAK0oB,OAAS+qE,EAASG,cACtD,OAAOl4B,EAAOp8D,GAAK,GAAKo8D,EAAOh4D,GAAK,GAAKg4D,EAAOp8D,GAAKg0C,GAAKooB,EAAOh4D,GAAK6vC,EAErE,GAAIvzC,KAAK0oB,OAAS+qE,EAASE,QAAS,CACrC,IAAIgC,EAAKriD,EAAI,EAAGsiD,EAAKriD,EAAI,EACrBJ,EAAKuoB,EAAOp8D,EAAI,GAAMg0C,EAAGF,EAAKsoB,EAAOh4D,EAAI,GAAM6vC,EACnD,OAAOJ,EAAKA,GAAMwiD,EAAKA,GAAMviD,EAAKA,GAAMwiD,EAAKA,GAAM,IAI3D5D,wBAhYgB,SAgYS6D,GACjBA,GAAU71F,KAAKg8D,mBACfh8D,KAAKykC,KAAKyW,aAAerB,EAAWi8C,wBAE9BD,IACN71F,KAAKykC,KAAKyW,cAAgBrB,EAAWi8C,0BAI7ClE,cAzYgB,SAyYDiE,GACPA,GAAU71F,KAAKg8D,mBACfh8D,KAAKykC,KAAKyW,aAAgBrB,EAAWk8C,YAAcl8C,EAAWi8C,wBACpCj8C,EAAWi7C,iBAE/Be,IACN71F,KAAKykC,KAAKyW,eAAiBrB,EAAWk8C,YAAcl8C,EAAWi7C,oBAIvErmD,cAnZgB,WAoZZzuC,KAAKykC,KAAKyW,eAAiBrB,EAAWk8C,YAAcl8C,EAAWi8C,wBACpCj8C,EAAWi7C,qBAI9Cl1F,GAAG+0D,KAAOx1D,EAAOE,QAAUs1D,kLCpd3B,IAAMh1D,EAAOD,EAAQ,iBACf08E,EAAY18E,EAAQ,iBAOtBs2F,EAAOp2F,GAAG43B,MAMVq/C,WAAY,EAOZE,SAAU,EAMVkf,OAAQ,IAyBRC,EAAct2F,GAAGE,OACjBb,KAAM,iBACNsC,QAAS66E,EAETjwC,QAAQR,EAKRwqD,eAAgB,WACZ,GAAIn2F,KAAKo2F,UAAW,CAChB,IAAIC,EAASr2F,KAAKo2F,UAAU3xD,KAC5B,IAAK4xD,EAAQ,OAEb,IAAI3K,EAAW1rF,KAAKykC,KAAKm4B,iBACrB05B,EAAat2F,KAAKykC,KAAKs4B,iBAEvBw5B,EAAaF,EAAOz5B,iBAErBy5B,EAAO1xF,SAAW3E,KAAKykC,MACtBzkC,KAAKykC,KAAKo4B,eAAe05B,GAGzBv2F,KAAKo2F,UAAUI,WAAa52F,GAAGkqF,OAAO2M,SAASC,SAC/C12F,KAAKi+C,KAAO+3C,EAAKC,QAGrB,IAAIU,EAAgBN,EAAOz5B,iBAW3B,GAVI58D,KAAKi+C,OAAS+3C,EAAKnf,WACnB72E,KAAK42F,YAAcD,EAAchzF,MAE7B3D,KAAKi+C,OAAS+3C,EAAKjf,SACvB/2E,KAAK42F,YAAcD,EAAc/yF,OAGjC5D,KAAK42F,YAAc52F,KAAKo2F,UAAUS,UAGnCR,EAAO1xF,SAAW3E,KAAKykC,KAAK,CAC3B,IAAInlC,GAAMosF,EAAS/nF,MAAQ2yF,EAAWh3F,EAEtC+2F,EAAOvxF,YAAYlF,GAAGqE,GAAG3E,EADjB,OAMpBw3F,iBAAkB,WACd,GAAI92F,KAAKo2F,UAAW,CAChB,IAAIC,EAASr2F,KAAKo2F,UAAU3xD,KAE5B,IAAK4xD,EAAQ,OAEb,IAOIU,EACAC,EACAC,EATAC,EAAoBb,EAAOt5B,iBAC3Bw5B,EAAaF,EAAOz5B,iBACpBu6B,EAAiBd,EAAOh6C,cAExBga,EAAcz2D,GAAGqE,GAAG,EAAG,IACvBmxB,EAAWz1B,EAAK+lF,QAAQ1lF,KAAKo1B,UAC7BgiE,EAAcp3F,KAAK42F,YAAcxhE,EAIrC,OAAQp1B,KAAKi+C,MACT,KAAK+3C,EAAKnf,WACF72E,KAAK6B,UACLw0D,EAAcz2D,GAAGqE,GAAG,EAAG,KAE3B8yF,EAAmBn3F,GAAGqvC,KAAKmoD,EAAab,EAAW3yF,QACnDozF,EAAah3F,KAAK42F,YAClBK,EAAcV,EAAW3yF,OACzB,MACJ,KAAKoyF,EAAKjf,SAEF1gB,EADAr2D,KAAK6B,QACSjC,GAAGqE,GAAG,GAAK,GAEXrE,GAAGqE,GAAG,GAAK,GAE7B8yF,EAAmBn3F,GAAGqvC,KAAKsnD,EAAW5yF,MAAOyzF,GAC7CJ,EAAaT,EAAW5yF,MACxBszF,EAAcj3F,KAAK42F,YAK3B,GAAI52F,KAAKi+C,OAAS+3C,EAAKC,OACfj2F,KAAKo2F,UAAU1tE,OAAS9oB,GAAGkqF,OAAO6K,KAAKsB,OACvCr2F,GAAGivC,KAAK,wEAEJ7uC,KAAK6B,UACLu1F,IAA6B,GAEjCp3F,KAAKo2F,UAAUS,UAAYO,QAG/B,GAAIp3F,KAAKo2F,UAAU1tE,OAAS9oB,GAAGkqF,OAAO6K,KAAKsB,OAAQ,CAE/C,IAAIoB,EAAgBhhC,EAAY/2D,EAAI43F,EAAkB53F,EAClDg4F,EAAgBjhC,EAAY3yD,EAAIwzF,EAAkBxzF,EAClD6zF,EAAgB33F,GAAGqE,GAAG+yF,EAAaK,EAAeJ,EAAcK,GAEpEjB,EAAOvxF,YAAYqyF,EAAe73F,EAAIi4F,EAAcj4F,EAAG63F,EAAezzF,EAAI6zF,EAAc7zF,GAExF2yF,EAAOr5B,eAAe3G,GACtBggC,EAAOx5B,eAAek6B,QAEtBn3F,GAAGivC,KAAK,iFASxBrmB,YAMI4tE,WACI3tE,QAAS,KACTC,KAAM9oB,GAAGkqF,OACT3F,SAASC,EACTkD,OAAQ,WACJtnF,KAAKm2F,kBAET1Q,YAAY,GAQhBxnC,MACIx1B,QAASutE,EAAKnf,WACdnuD,KAAMstE,EACN7R,SAASC,EACTkD,OAAQ,WACJ,GAAItnF,KAAKo2F,UAAW,CAChB,IAAIC,EAASr2F,KAAKo2F,UAAU3xD,KAC5B,IAAK4xD,EAAQ,OAEb,IAAIE,EAAaF,EAAOz5B,iBACpB58D,KAAKi+C,OAAS+3C,EAAKnf,WACnB72E,KAAK42F,YAAcL,EAAW5yF,MACvB3D,KAAKi+C,OAAS+3C,EAAKjf,SAC1B/2E,KAAK42F,YAAcL,EAAW3yF,OACvB5D,KAAKi+C,OAAS+3C,EAAKC,SAC1Bj2F,KAAK42F,YAAc52F,KAAKo2F,UAAUS,aAI9CpR,YAAY,GAGhB+R,eAAgB,EAMhBZ,aACIzgC,OAAQ,EAAGvwC,OAAOtU,WAClB6yE,SAASC,EACTz7D,IAAK,WACD,OAAO3oB,KAAKw3F,gBAEhB1rE,IAAK,SAAS/nB,GACN/D,KAAKi+C,OAAS+3C,EAAKC,SACnBlyF,EAAQpE,EAAK+lF,QAAQ3hF,IAEzB/D,KAAKw3F,eAAiBzzF,EACtB/D,KAAK82F,qBASb1hE,UACI3M,QAAS,EACTC,KAAM,QACNytC,OAAQ,EAAG,EAAG,IACdm+B,OAAO,EACPnQ,SAASC,EACTkD,OAAQ,WACJtnF,KAAK82F,qBASbj1F,SACI4mB,SAAS,EACT07D,SAASC,EACTkD,OAAQ,WACAtnF,KAAKo2F,YACLp2F,KAAKo2F,UAAUqB,UAAY,EAAIz3F,KAAKo2F,UAAUqB,WAElDz3F,KAAK82F,oBAETrR,YAAY,IAIpB38D,SACIktE,KAAMA,KAKdp2F,GAAGs2F,YAAc/2F,EAAOE,QAAU62F,iEC/QlC,IAAM9Z,EAAY18E,EAAQ,iBACpBwhC,EAAexhC,EAAQ,6BACvBm6C,EAAan6C,EAAQ,2BACrB6yF,EAAc7yF,EAAQ,uBAAuB6yF,YAC7CmF,EAAax2D,EAAaw2D,WAC1Bt2D,EAAMF,EAAaE,IAWrB3yB,EAAkB7O,GAAGE,OACrBb,KAAM,kBACNsC,QAAS66E,EAETjwC,QAAQR,EAKRnjB,YACI8pE,gBAAiBC,EAAYC,UAC7BmF,gBAAiBpF,EAAYqF,oBAU7BC,gBACIlvE,IAAK,WACD,OAAO3oB,KAAKsyF,iBAEhBxmE,IAAK,SAAS/nB,GACN/D,KAAKsyF,kBAAoBvuF,IAC7B/D,KAAKsyF,gBAAkBvuF,EACvB/D,KAAK83F,kBAAiB,KAE1BrS,YAAY,EACZ/8D,KAAK6pE,EACLpO,SAASC,GAWb2T,gBACIpvE,IAAK,WACD,OAAO3oB,KAAK23F,iBAEhB7rE,IAAK,SAAS/nB,GACN/D,KAAK23F,kBAAoB5zF,IAC7B/D,KAAK23F,gBAAkB5zF,EACvB/D,KAAK83F,kBAAiB,KAE1BrS,YAAY,EACZ/8D,KAAM6pE,EACNpO,SAASC,IAIjBrkF,KA1D2B,WA2DvBC,KAAKqyF,UAAY,KACjBryF,KAAK6wF,YAAc,KACnB7wF,KAAKg4F,kBACLh4F,KAAKi4F,cAAgB,KACrBj4F,KAAKk4F,eAAgB,EACrBl4F,KAAKotC,WAAaptC,KAAK8e,YAAYsuB,WACnCptC,KAAKm4F,eAAiBn4F,KAAK8e,YAAYq5E,gBAG3ClZ,SApE2B,WAqEnBj/E,KAAKykC,KAAKyT,mBACVl4C,KAAKykC,KAAKyT,iBAAiBxpC,SAAU,GAEzC1O,KAAKykC,KAAKyT,iBAAmBl4C,KAC7BA,KAAKykC,KAAKyW,aAAerB,EAAWk8C,YAAcl8C,EAAWi8C,wBAA0Bj8C,EAAWqc,YAGtGipB,UA5E2B,WA6EvBn/E,KAAKykC,KAAKyT,iBAAmB,KAC7Bl4C,KAAKyuC,iBAGT+1C,UAjF2B,WAkFvB,IAAK,IAAIjlF,EAAI,EAAGgiB,EAAIvhB,KAAKg4F,eAAex4F,OAAQD,EAAIgiB,EAAGhiB,IACnDm4F,EAAWU,KAAKp4F,KAAKg4F,eAAez4F,IAExCS,KAAKg4F,eAAex4F,OAAS,EAC7BQ,KAAKqyF,UAAY,KACjBryF,KAAK6wF,YAAc,MAGvBc,WA1F2B,WA4FvB,OAAO3xF,KAAKkhF,UAAYlhF,KAAKykC,KAAKg0B,oBAGtCu5B,wBA/F2B,SA+FF6D,GACjBA,GAAU71F,KAAK2xF,aACf3xF,KAAKykC,KAAKyW,aAAerB,EAAWi8C,wBAE9BD,IACN71F,KAAKykC,KAAKyW,cAAgBrB,EAAWi8C,0BAI7ClE,cAxG2B,SAwGZiE,GACPA,GAAU71F,KAAK2xF,aACf3xF,KAAKykC,KAAKyW,aAAerB,EAAWk8C,YAE9BF,IACN71F,KAAKykC,KAAKyW,cAAgBrB,EAAWk8C,cAI7CsC,sBAjH2B,SAiHJxC,GACfA,GAAU71F,KAAK2xF,aACf3xF,KAAKykC,KAAKyW,aAAerB,EAAWy+C,sBAE9BzC,IACN71F,KAAKykC,KAAKyW,cAAgBrB,EAAWy+C,wBAI7C7pD,cA1H2B,WA2HvBzuC,KAAKykC,KAAKyW,eAAiBrB,EAAWk8C,YAAcl8C,EAAWy+C,sBAAwBz+C,EAAWi8C,wBAA0Bj8C,EAAWqc,aAG3IqiC,kBA9H2B,WA+HvB,IAAI5nF,EAAO+mF,EAAWc,QAEtB,OADAx4F,KAAKg4F,eAAetyF,KAAKiL,GAClBA,GAGXmgF,kBApI2B,SAoIRngF,GACf,IAAI0Q,EAAQrhB,KAAKg4F,eAAer0E,QAAQhT,IACzB,IAAX0Q,IACArhB,KAAKg4F,eAAe73E,OAAOkB,EAAO,GAClCq2E,EAAWU,KAAKznF,KAIxBgiF,aA5I2B,WA6IvB,IAAI/kD,EAAW5tC,KAAKqyF,UAChBzkD,IAEIA,EAAS6kD,WACT7kD,EAASpxB,MAAQxc,KAAKykC,KAAKjoB,MAC3BoxB,EAAS2mD,cAIbv0F,KAAKykC,KAAKyW,cAAgBrB,EAAWqc,aAI7CuiC,YA1J2B,WA2JvB,OAAOz4F,KAAKqyF,WAGhBK,gBA9J2B,SA8JV9kD,GACb5tC,KAAKqyF,UAAYzkD,EAEjB5tC,KAAK83F,mBACLlqD,EAAS2mD,cAGbuD,iBAAkB,SAAUvD,GACnBv0F,KAAKqyF,YAICryF,KAAKqyF,UAAUtkD,UAAU2qD,OAAO,GACtCC,SACDv3D,EAAIw3D,eACJ54F,KAAKsyF,gBAAiBtyF,KAAK23F,gBAC3Bv2D,EAAIw3D,eACJ54F,KAAKsyF,gBAAiBtyF,KAAK23F,iBAG3BpD,GACAv0F,KAAKqyF,UAAUkC,iBAI3B9lF,EAAgB2+B,WAAa,KAC7B3+B,EAAgB0pF,eAAiB,KAEjCv4F,GAAG6O,gBAAkBtP,EAAOE,QAAUoP,qICzMtC,IAAM4P,EAAK3e,EAAQ,kBACbmI,EAAQnI,EAAQ,uBAChBm5F,EAAYn5F,EAAQ,uBAEpBo5F,EAAkB,IADDp5F,EAAQ,8BAGzBovF,EAAkBjnF,EAAMknF,cACxBC,EAAgBnnF,EAAMonF,sBA0B5B,IAAI8J,EAAO,IAAI16E,EAAG26E,KAAK,SAAUv0D,GAO7B,QAAK7kC,GAAGmsB,QAAQ0Y,KAGPA,EAAK/e,aAAa9lB,GAAGszF,eAI/B,IAEH6F,EAAKpwE,IAAM,SAAUinE,EAAQqJ,EAAWnxB,GACpC,IAAIoxB,EAAYl5F,KAAKm5F,OAChBD,IACDA,EAAY,IAAIt5F,GAAGwhE,YA5CD,mBA8CtB,IAAIg4B,EAAiBF,EAAUxzE,aAAa9lB,GAAG0vF,OA8B/C,OA7BK8J,IACDA,EAAiBF,EAAU1N,aAAa5rF,GAAG0vF,QAG/C4J,EAAUp0F,YAAY,EAAG,GACzBo0F,EAAUl8B,eAAe,GAAK,IAC9Bk8B,EAAUr8B,eAAe,IAAK,KAC9Bq8B,EAAUjhF,MAAQ,EAEI,iBAAX23E,IACPA,EAAS,GAAKA,GAEJqJ,aAAqBr5F,GAAG+nE,KAElCyxB,EAAezI,KAAOsI,EAEtBG,EAAehJ,WAAa,QAEhCgJ,EAAexJ,OAASA,EACxBwJ,EAAepJ,gBAAkBlB,EAAgBhY,KACjDsiB,EAAenJ,cAAgBjB,EAAchY,IAC7CoiB,EAAetxB,SAAWA,GAAY,GACtCsxB,EAAe7I,SAAW,EAC1B6I,EAAe3I,gBAAiB,EAChC2I,EAAe9I,WAAa,GAC5B8I,EAAerG,aAAY,GAC3BqG,EAAepG,gBAAe,GAC9BoG,EAAenG,kBAAiB,GAEzBiG,GASX,IAAIG,EAAWz5F,GAAGE,OACdb,KAAM,cACNsC,QAAS3B,GAAGw8E,UAEZr8E,KAAM,WACFC,KAAKs5F,WAAa,KAClBt5F,KAAKu5F,kBACLv5F,KAAKw5F,uBACLx5F,KAAKy5F,eAMDz5F,KAAK05F,sBAAwB15F,KAAK25F,iBAI1CxtD,QAAQR,EAMRnjB,YAMIonE,QACInnE,QAAS,qDACTsnE,WAAW,EACX5L,SAASC,EACTkD,OAAQ,WACJtnF,KAAK05F,0BASb1J,iBACIvnE,QAASqmE,EAAgBhY,KACzBpuD,KAAMomE,EACN3K,SAASC,EACTqB,YAAY,EACZ6B,OAAQ,SAAUQ,GACV9nF,KAAKgwF,kBAAoBlI,IAE7B9nF,KAAK45F,cAAe,EACpB55F,KAAK05F,2BASb5xB,UACIr/C,QAAS,GACT07D,SAASC,EACTkD,OAAQ,SAAUQ,GACV9nF,KAAK8nE,WAAaggB,IAEtB9nF,KAAK45F,cAAe,EACpB55F,KAAK05F,2BASb/I,MACIloE,QAAS,KACTC,KAAM9oB,GAAG8xE,QACTyS,SAASC,EACTkD,OAAQ,SAAUQ,GACV9nF,KAAK2wF,OAAS7I,IAElB9nF,KAAK45F,cAAe,EAChB55F,KAAK2wF,MACL3wF,KAAK65F,eAET75F,KAAK05F,2BASbI,UACIrxE,QAAS,EACT07D,SAASC,EACTkD,OAAQ,SAAUQ,GACV9nF,KAAK85F,WAAahS,IAEtB9nF,KAAK45F,cAAe,EACpB55F,KAAK05F,2BASbpJ,YACI7nE,QAAS,GACT07D,SAASC,EACTkD,OAAQ,SAAUQ,GACV9nF,KAAKswF,aAAexI,IAExB9nF,KAAK45F,cAAe,EACpB55F,KAAK05F,2BASbK,YACItxE,QAAS,KACTC,KAAM9oB,GAAGmtE,YACToX,SAASC,EACTkD,OAAQ,SAAUQ,GACV9nF,KAAK+5F,aAAejS,IAExB9nF,KAAK45F,cAAe,EACpB55F,KAAK05F,2BAabM,kBACIvxE,SAAS,EACT07D,SAASC,EACTkD,OAAQ,SAAUQ,GACV9nF,KAAKg6F,mBAAqBlS,GAC1B9nF,KAAKg8D,qBACLh8D,KAAKg6F,iBAAmBh6F,KAAKi6F,qBAAuBj6F,KAAKk6F,4BAMzEpxE,SACIgmE,gBAAiBA,EACjBE,cAAeA,GAGnB/P,SAxKoB,WAyKZj/E,KAAKg6F,kBACLh6F,KAAKi6F,qBAETj6F,KAAK25F,kBACL35F,KAAKm6F,mBAAkB,IAG3Bhb,UAhLoB,WAiLZn/E,KAAKg6F,kBACLh6F,KAAKk6F,wBAETl6F,KAAKm6F,mBAAkB,IAG3BzwE,MAvLoB,WAwLhB1pB,KAAK65F,gBAGTI,mBA3LoB,WA4LhBj6F,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAU6Y,UAAWtyD,KAAKwpF,cAAexpF,OAGlEk6F,sBA/LoB,WAgMhBl6F,KAAKykC,KAAKhW,IAAI7uB,GAAG2jB,KAAKk2B,UAAU6Y,UAAWtyD,KAAKwpF,cAAexpF,OAGnEo6F,kCAnMoB,WAoMhBp6F,KAAKu5F,eAAec,QAAQ,SAAU7/D,GAClCx6B,KAAKs6F,oBAAoB9/D,IAC3B3B,KAAK74B,QAGXu6F,iBAzMoB,SAyMF3K,GACd,OAAOmJ,EAAKpwE,IAAIinE,EAAQ5vF,KAAK2wF,KAAM3wF,KAAK8nE,WAG5C+xB,aA7MoB,WA6MJ,IAAAxrE,EAAAruB,KACRA,KAAK2wF,gBAAgB/wF,GAAG8xE,QACpB1xE,KAAK2wF,KAAKj3D,cACV15B,KAAK45F,cAAe,EACpB55F,KAAK25F,mBAEJ,WACD,IAAIprE,EAAAF,EACJzuB,GAAG47B,OAAOC,KAAKpN,EAAKsiE,KAAKh1D,UAAW,SAAUV,EAAKm1D,GAC/C7hE,EAAKqrE,cAAe,EACpBrrE,EAAKorE,oBAJR,IASL35F,KAAK45F,cAAe,EACpB55F,KAAK25F,oBAIba,aAjOoB,SAiONC,EAAY7K,GACtB,IAAIrhE,EAAOvuB,KACP2mB,EAAO,SAAUipE,GACjB,IAAIwD,OAAA,EAYJ,OAXwC,IAApC7kE,EAAKirE,oBAAoBh6F,QACzB4zF,EAAQ7kE,EAAKgsE,iBAAiB3K,GAC9BrhE,EAAKirE,oBAAoB9zF,KAAK0tF,KAG9BA,EAAQ7kE,EAAKirE,oBAAoB,IAC3B9zE,aAAa9lB,GAAG0vF,OAAOM,OAASA,EAE1CwD,EAAMsH,YAAcD,EACpBlsE,EAAK+rE,oBAAoBlH,GACTA,EAAMx2B,iBACLj5D,OAErB,OAAIisF,EACOjpE,EAAKipE,GAGLjpE,GAIf6iE,cA1PoB,SA0PLt9D,GAGX,IAHkB,IAAAoP,EAAAt7B,KACdgsB,EAAahsB,KAAKykC,KAAKuoD,cAAcptF,GAAGw8E,WAD1B7jD,EAAA,SAGTh5B,GACL,IAAIo7F,EAAer/D,EAAKi+D,eAAeh6F,GACnCq7F,EAAeD,EAAaE,cAC5BC,EAAaH,EAAaI,YAC1BH,GAAgBt/D,EAAK0/D,uBAAuBL,EAAczuE,EAAMwnC,MAAMC,iBACtE3nC,EAAWquE,QAAQ,SAAUhuE,GACrBA,EAAU2vC,oBAAsB3vC,EAAUuuE,IAC1CvuE,EAAUuuE,GAAc1uE,EAAO4uE,KAGvC5uE,EAAMqoC,oBAVLh1D,EAAI,EAAGA,EAAIS,KAAKu5F,eAAe/5F,SAAUD,EAAGg5B,EAA5Ch5B,IAeby7F,uBA5QoB,SA4QI5H,EAAO73B,GAE3B,OADa63B,EAAM5yB,wBACLqkB,SAAStpB,IAG3BisB,YAjRoB,WAmRhB,IADA,IAAI9iD,EAAW1kC,KAAKykC,KAAKC,SAChBnlC,EAAImlC,EAASllC,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAC3C,IAAIohE,EAAQj8B,EAASnlC,GAzWP,mBA0WVohE,EAAM1hE,MAzWS,yBAyWqB0hE,EAAM1hE,OACtC0hE,EAAMh8D,SAAW3E,KAAKykC,KACtBk8B,EAAMh8D,OAAS,KAIf+/B,EAASvkB,OAAO5gB,EAAG,GAhXb,mBAkXNohE,EAAM1hE,MACN85F,EAAKvhC,IAAImJ,IAKrB3gE,KAAKu5F,eAAe/5F,OAAS,EAC7BQ,KAAKw5F,oBAAoBh6F,OAAS,EAClCQ,KAAKy5F,YAAYj6F,OAAS,EAC1BQ,KAAKi7F,aAAe,EACpBj7F,KAAKk7F,WAAa,EAClBl7F,KAAKm7F,YAAc,EACnBn7F,KAAKo7F,aAAe,EACpBp7F,KAAK45F,cAAe,GAGxB14B,WAAWv1B,EAYXwuD,kBAzToB,SAyTDxiC,GACf,IAAK,IAAIp4D,EAAIS,KAAKykC,KAAKC,SAASllC,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACrD,IAAIohE,EAAQ3gE,KAAKykC,KAAKC,SAASnlC,GAhZjB,mBAiZVohE,EAAM1hE,MAhZS,yBAgZqB0hE,EAAM1hE,OAC1C0hE,EAAMhJ,OAASA,KAK3B0jC,iBAlUoB,SAkUFC,EAAab,GAC3B,IAAIE,OAAA,EAkBJ,OAjBwC,IAApC36F,KAAKw5F,oBAAoBh6F,OACzBm7F,EAAe36F,KAAKu6F,iBAAiBe,IAGrCX,EAAe36F,KAAKw5F,oBAAoB9wF,OAC3Bgd,aAAa9lB,GAAG0vF,OAAOM,OAAS0L,EAEjDX,EAAaD,YAAcD,EAC3BE,EAAaO,WAAal7F,KAAKk7F,WAC/BP,EAAahjC,OAAS33D,KAAKykC,KAAKkzB,OAEhCgjC,EAAa39B,eAAe,EAAG,GAC/Bh9D,KAAKs6F,oBAAoBK,GAEzB36F,KAAKykC,KAAKs8B,SAAS45B,GACnB36F,KAAKu5F,eAAe7zF,KAAKi1F,GAElBA,GAGXY,4BAxVoB,SAwVSC,EAAaC,EAAYhB,GAClD,IAAIiB,EAAgBD,EAGpB,GAAIz7F,KAAKi7F,aAAe,GAAKS,EAAgB17F,KAAKi7F,aAAej7F,KAAK85F,SAGlE,IADA,IAAI6B,EAAkB,EACf37F,KAAKi7F,cAAgBj7F,KAAK85F,UAAU,CACvC,IAAI8B,EAAgB57F,KAAK67F,iBAAiBL,EACtCG,EACAH,EAAYh8F,QACZs8F,EAAcN,EAAYO,OAAOJ,EAAiBC,GAClDI,EAAmBh8F,KAAKw6F,aAAaC,EAAYqB,GAErD,KAAI97F,KAAKi7F,aAAee,GAAoBh8F,KAAK85F,UAI5C,CAED,GAAI6B,EAAkB,EAAG,CACrB,IAAIM,EAAkBT,EAAYO,OAAO,EAAGJ,GAC5C37F,KAAKq7F,iBAAiBY,EAAiBxB,GACvCe,EAAcA,EAAYO,OAAOJ,EAAiBH,EAAYh8F,QAC9Dk8F,EAAgB17F,KAAKw6F,aAAaC,EAAYe,GAElDx7F,KAAKk8F,kBACL,MAZAl8F,KAAKi7F,cAAgBe,EACrBL,GAAmBC,EAe/B,GAAIF,EAAgB17F,KAAK85F,SAKrB,IAJA,IAAIqC,EAAYtD,EAAUuD,aAAaZ,EACnCE,EACA17F,KAAK85F,SACL95F,KAAKw6F,aAAaC,IACbv7E,EAAI,EAAGA,EAAIi9E,EAAU38F,SAAU0f,EAAG,CACvC,IAAIm9E,EAAcF,EAAUj9E,GAExBo9E,EADWt8F,KAAKq7F,iBAAiBgB,EAAa5B,GACrB79B,iBAC7B58D,KAAKi7F,cAAgBqB,EAAU34F,MAC3Bw4F,EAAU38F,OAAS,GAAK0f,EAAIi9E,EAAU38F,OAAS,GAC/CQ,KAAKk8F,uBAKbl8F,KAAKi7F,cAAgBS,EACrB17F,KAAKq7F,iBAAiBG,EAAaf,IAI3C8B,mBA5YoB,SA4YAjB,GAChB,OAAOA,EAAY97F,OAAS,IAAM87F,EAAY5O,YAAY,OAG9DwP,gBAhZoB,WAiZhBl8F,KAAKy5F,YAAY/zF,KAAK1F,KAAKi7F,cAC3Bj7F,KAAKi7F,aAAe,EACpBj7F,KAAKk7F,cAGTsB,uBAtZoB,SAsZIC,GACpB,GAAIz8F,KAAK45F,eAAiB55F,KAAKs5F,aAAemD,EAC1C,OAAO,EAGX,GAAIz8F,KAAKs5F,WAAW95F,SAAWi9F,EAAaj9F,OACxC,OAAO,EAGX,IAAK,IAAID,EAAI,EAAGA,EAAIS,KAAKs5F,WAAW95F,SAAUD,EAAG,CAC7C,IAAIm9F,EAAU18F,KAAKs5F,WAAW/5F,GAC1Bo9F,EAAUF,EAAal9F,GAC3B,GAAIm9F,EAAQ5qB,OAAS6qB,EAAQ7qB,KACzB,OAAO,EAGP,GAAI4qB,EAAQp+C,OACR,GAAIq+C,EAAQr+C,MAAO,CACf,KAAMq+C,EAAQr+C,MAAMs+C,WAAcF,EAAQp+C,MAAMs+C,QAC5C,OAAO,EAEX,GAAIF,EAAQp+C,MAAMrP,OAAS0tD,EAAQr+C,MAAMrP,MAClCytD,EAAQp+C,MAAMu+C,SAAWF,EAAQr+C,MAAMu+C,QACvCH,EAAQp+C,MAAMw+C,UAAYH,EAAQr+C,MAAMw+C,QAC3C,OAAO,EAEX,GAAIJ,EAAQp+C,MAAMw+C,UAAYH,EAAQr+C,MAAMw+C,SACpCJ,EAAQp+C,MAAMpmB,MAAQykE,EAAQr+C,MAAMpmB,IACpC,OAAO,OAKf,GAAIwkE,EAAQp+C,MAAMrP,MAAQytD,EAAQp+C,MAAMu+C,QAAUH,EAAQp+C,MAAMw+C,SAAWJ,EAAQp+C,MAAMs+C,QACrF,OAAO,OAKf,GAAID,EAAQr+C,QACJq+C,EAAQr+C,MAAMrP,MAAQ0tD,EAAQr+C,MAAMu+C,QAAUF,EAAQr+C,MAAMw+C,SAAWH,EAAQr+C,MAAMs+C,SACrF,OAAO,EAM3B,OAAO,GAGXG,yBAxcoB,SAwcMC,GACtB,IAAIC,EAAkBD,EAAgB1+C,MAAMpmB,IACxC/O,EAAcnpB,KAAK+5F,WAAW7sB,eAAe+vB,GACjD,GAAI9zE,EAAa,CACb,IAAI+zE,EAAa,IAAIt9F,GAAGwhE,YAhiBL,wBAiiBf+7B,EAAkBD,EAAW1R,aAAa5rF,GAAGkqF,QACjDoT,EAAWlgC,eAAe,EAAG,GAC7BmgC,EAAgBz0E,KAAO9oB,GAAGkqF,OAAO6K,KAAKyI,OACtCD,EAAgBE,SAAWz9F,GAAGkqF,OAAOwT,SAASC,OAC9Cv9F,KAAKykC,KAAKs8B,SAASm8B,GACnBl9F,KAAKu5F,eAAe7zF,KAAKw3F,GAEzB,IAAIM,EAAar0E,EAAY6lD,UACzByuB,EAAc,EACdC,EAAcF,EAAW75F,MACzBg6F,EAAeH,EAAW55F,OAC1Bg6F,EAAcZ,EAAgB1+C,MAAMu/C,WACpCC,EAAed,EAAgB1+C,MAAMy/C,YAGrCD,EAAe,GAAKA,EAAe99F,KAAKswF,YAExCoN,GADAD,EAAcK,EAAeH,EAE7BA,GAA8BF,IAI9BC,GADAD,EAAcz9F,KAAKswF,WAAaqN,EAEhCA,GAA8BF,GAG9BG,EAAc,IAAGF,EAAcE,GAE/B59F,KAAK85F,SAAW,GACZ95F,KAAKi7F,aAAeyC,EAAc19F,KAAK85F,UACvC95F,KAAKk8F,kBAETl8F,KAAKi7F,cAAgByC,IAIrB19F,KAAKi7F,cAAgByC,EACjB19F,KAAKi7F,aAAej7F,KAAKm7F,cACzBn7F,KAAKm7F,YAAcn7F,KAAKi7F,eAGhCkC,EAAgBh0E,YAAcA,EAC9B+zE,EAAWrgC,eAAe6gC,EAAaC,GACvCT,EAAWhC,WAAal7F,KAAKk7F,WAEzB8B,EAAgB1+C,MAAMpyB,QAClB8wE,EAAgB1+C,MAAMpyB,MAAM8xE,QAC5Bd,EAAWrC,cAAgBmC,EAAgB1+C,MAAMpyB,MAAM8xE,OAEvDhB,EAAgB1+C,MAAMpyB,MAAM+xE,QAC5Bf,EAAWnC,YAAciC,EAAgB1+C,MAAMpyB,MAAM+xE,aAK7Dr+F,GAAGu+B,OAAO,OAIlBw7D,gBAxgBoB,WAygBhB,GAAK35F,KAAK0O,QAAV,CAEA,IAAI+tF,EAAe3D,EAAgBoF,MAAMl+F,KAAK4vF,QAC9C,IAAK5vF,KAAKw8F,uBAAuBC,GAG7B,OAFAz8F,KAAKs5F,WAAamD,OAClBz8F,KAAKo6F,oCAITp6F,KAAKs5F,WAAamD,EAClBz8F,KAAKwnF,cAML,IAJA,IAAI2W,GAAgB,EAEhB7B,OAAA,EAEK/8F,EAAI,EAAGA,EAAIS,KAAKs5F,WAAW95F,SAAUD,EAAG,CAC7C,IAAIy9F,EAAkBh9F,KAAKs5F,WAAW/5F,GAClCuyE,EAAOkrB,EAAgBlrB,KAE3B,GAAa,KAATA,EAAa,CACb,GAAIkrB,EAAgB1+C,OAAS0+C,EAAgB1+C,MAAM8/C,QAAS,CACxDp+F,KAAKk8F,kBACL,SAEJ,GAAIc,EAAgB1+C,OAAS0+C,EAAgB1+C,MAAMw+C,SAAW98F,KAAK+5F,WAAY,CAC3E/5F,KAAK+8F,yBAAyBC,GAC9B,UAKR,IAFA,IAAIqB,EAAiBvsB,EAAKhuD,MAAM,MAEvBsI,EAAI,EAAGA,EAAIiyE,EAAe7+F,SAAU4sB,EAAG,CAC5C,IAAIovE,EAAc6C,EAAejyE,GACjC,GAAoB,KAAhBovE,EAYJ,GAFA2C,GAAgB,EAEZn+F,KAAK85F,SAAW,EAAG,CACnB,IAAI2B,EAAaz7F,KAAKw6F,aAAaj7F,EAAGi8F,GACtCx7F,KAAKu7F,4BAA4BC,EAAaC,EAAYl8F,GAEtD8+F,EAAe7+F,OAAS,GAAK4sB,EAAIiyE,EAAe7+F,OAAS,GACzDQ,KAAKk8F,uBAKTI,EADQt8F,KAAKq7F,iBAAiBG,EAAaj8F,GACzBq9D,iBAElB58D,KAAKi7F,cAAgBqB,EAAU34F,MAC3B3D,KAAKi7F,aAAej7F,KAAKm7F,cACzBn7F,KAAKm7F,YAAcn7F,KAAKi7F,cAGxBoD,EAAe7+F,OAAS,GAAK4sB,EAAIiyE,EAAe7+F,OAAS,GACzDQ,KAAKk8F,sBA9Bb,CAEI,GAAIl8F,KAAKu8F,mBAAmBzqB,IACrB1lD,IAAMiyE,EAAe7+F,OAAS,EACjC,SAEJQ,KAAKk8F,kBACLiC,GAAgB,IA4BvBA,GACDn+F,KAAKy5F,YAAY/zF,KAAK1F,KAAKi7F,cAG3Bj7F,KAAK85F,SAAW,IAChB95F,KAAKm7F,YAAcn7F,KAAK85F,UAE5B95F,KAAKo7F,aAAep7F,KAAKk7F,WAAal7F,KAAKswF,WAG3CtwF,KAAKykC,KAAKo4B,eAAe78D,KAAKm7F,YAAan7F,KAAKo7F,cAEhDp7F,KAAKs+F,0BACLt+F,KAAK45F,cAAe,IAGxBiC,iBA9lBoB,SA8lBF/pB,EAAMysB,EAAYC,GAChC,IAAIC,EAAY3sB,EAAK4sB,OAAOH,GAC5B,GAAI1F,EAAU8F,aAAaF,IACpB5F,EAAU+F,eAAeH,GAC5B,OAAO,EAIX,IADA,IAAI1wE,EAAM,EACD1M,EAAQk9E,EAAa,EAAGl9E,EAAQm9E,IACrCC,EAAY3sB,EAAK4sB,OAAOr9E,IACpBw3E,EAAU+F,eAAeH,KACtB5F,EAAU8F,aAAaF,MAHkBp9E,EAMhD0M,IAGJ,OAAOA,GAGXuwE,wBAlnBoB,WAsnBhB,IAHA,IAAIO,EAAa,EACbC,EAAgB,EAChBC,EAAiB/+F,KAAKk7F,WACjB37F,EAAI,EAAGA,EAAIS,KAAKu5F,eAAe/5F,SAAUD,EAAG,CACjD,IAAI6zF,EAAQpzF,KAAKu5F,eAAeh6F,GAC5By/F,EAAY5L,EAAM8H,WAClB8D,EAAYF,IACZD,EAAa,EACbC,EAAgBE,GAEpB,IAAIC,EAAc,EAElB,OAAQj/F,KAAKgwF,iBACT,KAAKlB,EAAgBhY,KACjBmoB,GAAgBj/F,KAAKm7F,YAAc,EACnC,MACJ,KAAKrM,EAAgB7T,OACjBgkB,GAAgBj/F,KAAKy5F,YAAYuF,EAAY,GAAK,EAClD,MACJ,KAAKlQ,EAAgB5T,MACjB+jB,EAAcj/F,KAAKm7F,YAAc,EAAIn7F,KAAKy5F,YAAYuF,EAAY,GAK1E5L,EAAM9zF,EAAIu/F,EAAaI,EAEvB,IAAI3C,EAAYlJ,EAAMx2B,iBAEtBw2B,EAAM1vF,EAAI1D,KAAKswF,YAAcyO,EAAiBC,GAAah/F,KAAKo7F,aAAe,EAE3E4D,IAAcF,IACdD,GAAcvC,EAAU34F,SAKpCu7F,0BAxpBoB,SAwpBO1iF,GACvB,IAAI2iF,EAAa3iF,EAAM4iF,cACvB,OAAIx/F,GAAG8c,MAAMyiF,GACFv/F,GAAG8c,MAAMyiF,GAGNv/F,GAAG4c,QACF6iF,QAAQ7iF,IAI3B89E,oBAnqBoB,SAmqBCpB,GACjB,IAAIE,EAAiBF,EAAUxzE,aAAa9lB,GAAG0vF,OAC/C,GAAK8J,EAAL,CAIA,IAAI/3E,EAAQ63E,EAAUwB,YACtBtB,EAAe9I,WAAatwF,KAAKswF,WACjC8I,EAAepJ,gBAAkBlB,EAAgBhY,KACjDsiB,EAAenJ,cAAgBjB,EAAc/T,OAE7C,IAAIqkB,EAAY,KAqBhB,GApBIt/F,KAAKs5F,WAAWj4E,KAChBi+E,EAAYt/F,KAAKs5F,WAAWj4E,GAAOi9B,OAGnCghD,GAAaA,EAAU9iF,MACvB08E,EAAU18E,MAAQxc,KAAKk/F,0BAA0BI,EAAU9iF,OAE3D08E,EAAU18E,MAAQxc,KAAKk/F,0BAA0B,SAGrD9F,EAAerG,YAAYuM,GAAaA,EAAUC,MAElDnG,EAAepG,eAAesM,GAAaA,EAAUzC,QAEjDyC,GAAaA,EAAUzC,SACvB3D,EAAUjhF,MAAQ,IAGtBmhF,EAAenG,iBAAiBqM,GAAaA,EAAUE,WAEnDF,GAAaA,EAAU1C,QAAS,CAChC,IAAI6C,EAAwBvG,EAAUxzE,aAAa9lB,GAAGszF,cACjDuM,IACDA,EAAwBvG,EAAU1N,aAAa5rF,GAAGszF,eAEtDuM,EAAsBjjF,MAAQxc,KAAKk/F,0BAA0BI,EAAU1C,QAAQpgF,OAC/EijF,EAAsB97F,MAAQ27F,EAAU1C,QAAQj5F,MAGhD27F,GAAaA,EAAUrwD,KACvBmqD,EAAetxB,SAAWw3B,EAAUrwD,KAGpCmqD,EAAetxB,SAAW9nE,KAAK8nE,SAGnCsxB,EAAevJ,mBAAkB,GAE7ByP,GAAaA,EAAUpzE,QACnBozE,EAAUpzE,MAAM8xE,QAChB9E,EAAU2B,cAAgByE,EAAUpzE,MAAM8xE,OAE1CsB,EAAUpzE,MAAM+xE,QAChB/E,EAAU6B,YAAcuE,EAAUpzE,MAAM+xE,UAKpDzZ,UA/tBoB,WAguBhB,IAAK,IAAIjlF,EAAI,EAAGA,EAAIS,KAAKu5F,eAAe/5F,SAAUD,EAC9CS,KAAKu5F,eAAeh6F,GAAG8P,mBACvB0pF,EAAKvhC,IAAIx3D,KAAKu5F,eAAeh6F,OAKzCK,GAAGy5F,SAAWl6F,EAAOE,QAAUg6F,mICp0B/B,IAAM15F,EAAOD,EAAQ,iBACfggG,EAAYhgG,EAAQ,aAAa+5C,UACjChrC,EAAkB/O,EAAQ,uBAC1Bm6C,EAAan6C,EAAQ,2BACrBwhC,EAAexhC,EAAQ,6BACvBmvF,EAAiB3tD,EAAa2tD,eAC9B8Q,EAAqBz+D,EAAay+D,mBAOpCC,EAAahgG,GAAG43B,MAMhBqoE,OAAQ,EAMRzC,OAAQ,EAMR0C,MAAO,EAMP7J,OAAQ,EAMR8J,KAAM,IAQNtJ,EAAW72F,GAAG43B,MAMdq/C,WAAY,EAMZE,SAAU,EAMV2f,OAAO,IAQP4G,EAAW19F,GAAG43B,MAMd+lE,OAAQ,EAMRyC,QAAS,EAMTC,IAAK,IAOLvnE,EAAQ94B,GAAG43B,MAMXyL,OAAQ,EAMRynD,KAAM,IAcNZ,EAASlqF,GAAGE,OACZb,KAAM,YACNsC,QAASkN,EAET1O,KAJkB,WAKdC,KAAKotC,WAAa,KAClBptC,KAAKkgG,oBAAsB,KAC3BlgG,KAAKmgG,gBAAkB,MAG3Bh0D,QAAQR,EAMRnjB,YACIurE,cACItrE,QAAS,KACTC,KAAM9oB,GAAGioE,aAEbmsB,MAAO4L,EAAWC,OAClBO,UAAW9C,EAAS0C,QACpBK,UAAW,EACXC,YAAa1gG,GAAGqE,GAAG,EAAE,GACrBs8F,WAAY,EACZC,WAAY,EACZC,gBAAgB,EAChBhoE,OAAQ,EACRioE,QACIj4E,QAAS,KACTC,KAAM9oB,GAAGmtE,YACToX,SAASC,EACTvb,YAAY,EACZhgD,SAAS,EACT48D,YAAY,GAWhBt8D,aACIR,IAAK,WACD,OAAO3oB,KAAK+zF,cAEhBjoE,IAAK,SAAU/nB,EAAOyqC,GAClB,IAAI2lD,EAAan0F,KAAK+zF,aAOdI,IAAepwF,IAIvB/D,KAAK+zF,aAAehwF,EAEpB/D,KAAKgyF,yBAAwB,GAC7BhyF,KAAKo0F,kBAAkBD,KAK3BzrE,KAAM9oB,GAAGioE,aAWbn/C,MACIC,IAAK,WACD,OAAO3oB,KAAKg0F,OAEhBloE,IAAK,SAAU/nB,GACP/D,KAAKg0F,QAAUjwF,IACf/D,KAAK8wF,kBAAkB9wF,KAAK6wF,aAC5B7wF,KAAK6wF,YAAc,KACnB7wF,KAAKg0F,MAAQjwF,EACb/D,KAAKgxF,qBAGbtoE,KAAMk3E,EACNna,YAAY,EACZtB,SAASC,GAaboS,UACI7tE,IAAK,WACD,OAAO3oB,KAAKqgG,WAEhBv0E,IAAK,SAAS/nB,GACNA,IAAU/D,KAAKqgG,YACXt8F,IAAU0yF,EAASC,QAAU12F,KAAKqgG,YAAc5J,EAASC,QACzD12F,KAAK8wF,kBAAkB9wF,KAAK6wF,aAC5B7wF,KAAK6wF,YAAc,MAEd7wF,KAAK6wF,aACV7wF,KAAKgyF,yBAAwB,GAEjChyF,KAAKqgG,UAAYt8F,EACjB/D,KAAKgxF,qBAGbtoE,KAAM+tE,EACNtS,SAASC,GAabuc,YACIh4E,IAAK,WACD,OAAO3oB,KAAKsgG,aAEhBx0E,IAAK,SAAS/nB,GACV/D,KAAKsgG,YAAYhhG,EAAIyE,EAAMzE,EAC3BU,KAAKsgG,YAAY58F,EAAIK,EAAML,EACvB1D,KAAKg0F,QAAU4L,EAAW3J,QAAUj2F,KAAK6wF,aACzC7wF,KAAKgyF,yBAAwB,IAGrC7N,SAASC,GAcbqT,WACI9uE,IAAK,WACD,OAAO3oB,KAAKugG,YAEhBz0E,IAAK,SAAS/nB,GACV/D,KAAKugG,WAAa5gG,EAAKoF,OAAOhB,GAAQ,EAAG,GACrC/D,KAAKg0F,QAAU4L,EAAW3J,QAAUj2F,KAAK6wF,aACzC7wF,KAAKgyF,yBAAwB,IAGrC7N,SAASC,GAcbyS,WACIluE,IAAK,WACD,OAAO3oB,KAAKwgG,YAEhB10E,IAAK,SAAS/nB,GACV/D,KAAKwgG,WAAa7gG,EAAKoF,OAAOhB,GAAQ,EAAG,GACrC/D,KAAKg0F,QAAU4L,EAAW3J,QAAUj2F,KAAK6wF,aACzC7wF,KAAKgyF,yBAAwB,IAGrC7N,SAASC,GAUbwc,MACIj4E,IAAK,WACD,OAAO3oB,KAAKygG,gBAEhB30E,IAAK,SAAU/nB,GACP/D,KAAKygG,iBAAmB18F,IACxB/D,KAAKygG,eAAiB18F,EACjB/D,KAAKg0F,QAAU4L,EAAWC,QAAU7/F,KAAKg0F,QAAU4L,EAAWG,OAC/D//F,KAAK6wF,aACL7wF,KAAKgyF,yBAAwB,KAIzCvM,YAAY,EACZtB,SAASC,GAYbiZ,UACI10E,IAAK,WACD,OAAO3oB,KAAKogG,WAEhBt0E,IAAK,SAAU/nB,GACX/D,KAAKogG,UAAYr8F,EACbA,IAAUu5F,EAASC,QACnBv9F,KAAK6gG,oBAGbpb,YAAY,EACZ/8D,KAAM40E,EACNnZ,SAASC,IAIjBt7D,SACI2tE,SAAUA,EACV9B,KAAMiL,EACNtC,SAAUA,EACV5kE,MAAOA,GAGXooE,WAAY,SAAUj4E,GAClB7oB,KAAK0O,QAAUma,GASnB4hE,SAAU,SAAU9nE,GACZ3iB,KAAKy4B,SAAW9V,IACpB3iB,KAAKy4B,OAAS9V,EACd3iB,KAAKkyF,sBAST/2D,SAAU,WACN,OAAOn7B,KAAKy4B,QAGhBwmD,SAAU,WACNj/E,KAAKysC,SAEAzsC,KAAK+zF,cAAiB/zF,KAAK+zF,aAAaplB,kBAEzC3uE,KAAKyuC,gBACDzuC,KAAK+zF,eACL/zF,KAAK+zF,aAAa3lE,KAAK,OAAQpuB,KAAK60F,iBAAkB70F,MACtDA,KAAK+zF,aAAankB,sBAI1B5vE,KAAKgxF,mBACLhxF,KAAKkyF,oBAELlyF,KAAKykC,KAAKvW,GAAGwxE,EAAU3sC,aAAc/yD,KAAK+gG,iBAAkB/gG,MAC5DA,KAAKykC,KAAKvW,GAAGwxE,EAAU1sC,eAAgBhzD,KAAK+gG,iBAAkB/gG,OAGlEm/E,UAAW,WACPn/E,KAAKysC,SAELzsC,KAAKykC,KAAKhW,IAAIixE,EAAU3sC,aAAc/yD,KAAK+gG,iBAAkB/gG,MAC7DA,KAAKykC,KAAKhW,IAAIixE,EAAU1sC,eAAgBhzD,KAAK+gG,iBAAkB/gG,OAGnE+gG,iBArTkB,WAsTT/gG,KAAK6wF,aACV7wF,KAAKgyF,yBAAwB,IAGjC71C,iBA1TkB,WA2Tdn8C,KAAKgxF,oBAGTA,iBAAkB,WACd,IAAIa,EAAY/H,EAAO18C,WAAW0kD,aAAa9xF,MAE3CA,KAAKotC,aAAeykD,IACpB7xF,KAAKotC,WAAaykD,EAClB7xF,KAAK6wF,YAAc,MAGlB7wF,KAAK6wF,cACN7wF,KAAK6wF,YAAc7wF,KAAKotC,WAAW2kD,WAAW/xF,MAC9CA,KAAK6wF,YAAYjjD,SAAW5tC,KAAKqyF,UACjCryF,KAAKgyF,yBAAwB,KAIrCE,kBAAmB,WACf,IAAI/oE,EAAcnpB,KAAK+zF,aAGvB,GAAIn0F,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,mBAAoB,CAEnD,IAAIjc,OAAA,EAgBJ,GAfI5tC,KAAKy4B,SAAWC,EAAMgyD,MACjB1qF,KAAKkgG,sBACNlgG,KAAKkgG,oBAAsB,IAAIP,GAEnC/xD,EAAW5tC,KAAKkgG,sBAGXlgG,KAAKmgG,kBACNngG,KAAKmgG,gBAAkB,IAAItR,GAE/BjhD,EAAW5tC,KAAKmgG,iBAGpBvyD,EAAS6kD,UAAW,EAEhBtpE,GAAeA,EAAYwlD,gBAAiB,CAC5C,IAAIz/B,EAAU/lB,EAAY8jD,aACtBr/B,EAASsB,UAAYA,GACrBtB,EAASsB,QAAUA,EACnBlvC,KAAK0yF,gBAAgB9kD,IAEhBA,IAAa5tC,KAAKqyF,WACvBryF,KAAK0yF,gBAAgB9kD,GAErB5tC,KAAK6wF,cACL7wF,KAAK6wF,YAAYjjD,SAAWA,GAGhC5tC,KAAKykC,KAAKyW,aAAerB,EAAWqc,WACpCl2D,KAAKgyF,yBAAwB,GAC7BhyF,KAAK4xF,eAAc,QAGnB5xF,KAAKyuC,qBAITzuC,KAAKgyF,yBAAwB,GAC7BhyF,KAAK4xF,eAAc,IAI3BoP,aAAar1D,EAYbgmD,WA1YkB,WA2Yd,GAAI/xF,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,oBAC/B,IAAK7pD,KAAKkhF,SAAU,OAAO,OAG3B,IAAKlhF,KAAKkhF,WAAalhF,KAAKqyF,YAAcryF,KAAKykC,KAAKg0B,mBAAoB,OAAO,EAGnF,IAAItvC,EAAcnpB,KAAK+zF,aACvB,SAAK5qE,IAAgBA,EAAYwlD,kBAMrCqjB,wBAzZkB,SAyZO6D,GACrB,GAAIA,GAAU71F,KAAK2xF,aAAc,CAC7B3xF,KAAKykC,KAAKyW,aAAerB,EAAWi8C,wBAEpC,IAAIlD,EAAa5yF,KAAK6wF,YAClB+B,IACAA,EAAWE,SAAU,EACrBF,EAAWC,WAAY,QAGrBgD,IACN71F,KAAKykC,KAAKyW,cAAgBrB,EAAWi8C,0BAI7C+K,iBAAkB,WACd,GAAI7gG,KAAK+zF,aAAc,CACnB,GAAIuJ,EAAS2C,MAAQjgG,KAAKogG,UAAW,CACjC,IAAInxD,EAAOjvC,KAAK+zF,aAAa7kB,kBAC7BlvE,KAAKykC,KAAKo4B,eAAe5tB,QACtB,GAAIquD,EAAS0C,UAAYhgG,KAAKogG,UAAW,CAC5C,IAAIx9F,EAAO5C,KAAK+zF,aAAa/kB,UAC7BhvE,KAAKykC,KAAKo4B,eAAej6D,EAAKe,MAAOf,EAAKgB,QAG9C5D,KAAKkyF,sBAIb2C,iBAAkB,WACT70F,KAAK+rB,SAIV/rB,KAAK6gG,oBAGTzM,kBAAmB,SAAUY,GACrBA,GAAYA,EAASvmE,KACrBumE,EAASvmE,IAAI,OAAQzuB,KAAK60F,iBAAkB70F,MAGhD,IAAImpB,EAAcnpB,KAAK+zF,aAClB5qE,IAAgBnpB,KAAKqyF,WAAaryF,KAAKqyF,UAAUznB,aAAezhD,GAAeA,EAAYyhD,WAE5F5qE,KAAK4xF,eAAc,GAGnBzoE,IACK6rE,GAAY7rE,EAAYyhD,WAAaoqB,EAASpqB,SAU/C5qE,KAAK6gG,mBATD13E,EAAYwlD,gBACZ3uE,KAAK60F,iBAAiB,OAGtB1rE,EAAYiF,KAAK,OAAQpuB,KAAK60F,iBAAkB70F,MAChDmpB,EAAYymD,uBAc5BqxB,UAAUt1D,IAsCd/rC,GAAGkqF,OAAS3qF,EAAOE,QAAUyqF,oJCpoB7B,IAAIoX,EAAgBxhG,EAAQ,8BA4BxBu3E,EAAYiqB,EAAcjqB,UAE1BkqB,EAAaD,EAAcpmB,YAC3B9D,EAAUmqB,EAAWnqB,IACrB+D,EAAUomB,EAAWpmB,IACrBC,EAAUmmB,EAAWnmB,IACrBlE,EAAUqqB,EAAWrqB,KACrBmE,EAAUkmB,EAAWlmB,OACrBC,EAAUimB,EAAWjmB,MACrBkmB,EAAUpqB,EAAMgE,EAChBqmB,EAAavqB,EAAOoE,EAcpBI,EAAS17E,GAAGE,OACZb,KAAM,YAAasC,QAAS7B,EAAQ,iBAEpCysC,QAAQR,EAQRnjB,YASItoB,QACIyoB,IAAK,WACD,OAAO3oB,KAAKwtB,SAEhB1B,IAAK,SAAU/nB,GACX/D,KAAKwtB,QAAUzpB,GAMnB2kB,KAAM9oB,GAAG2jB,KACT4gE,SAASC,GAYbkd,YACI34E,IAAK,WACD,OAAQ3oB,KAAKw4E,YAAcxB,GAAO,GAEtClrD,IAAK,SAAU/nB,GACX/D,KAAKuhG,UAAUvqB,EAAKjzE,IAExB0hF,YAAY,EACZtB,SAASC,GAYbnK,uBACItxD,IAAK,WACD,OAAQ3oB,KAAKw4E,YAAcuC,GAAO,GAEtCjvD,IAAK,SAAU/nB,GACPA,GACA/D,KAAKshG,YAAa,EAClBthG,KAAKs6E,eAAgB,EACrBt6E,KAAKw4E,aAAeuC,GAGpB/6E,KAAKw4E,cAAgBuC,GAG7B0K,YAAY,EACZtB,SAASC,GAUb9J,eACI3xD,IAAK,WACD,OAAQ3oB,KAAKw4E,YAAcwC,GAAO,GAEtClvD,IAAK,SAAU/nB,GACX/D,KAAKuhG,UAAUvmB,EAAKj3E,IAExB0hF,YAAY,EACZtB,SAASC,GAUb7K,aACI5wD,IAAK,WACD,OAAQ3oB,KAAKw4E,YAAc1B,GAAQ,GAEvChrD,IAAK,SAAU/nB,GACX/D,KAAKuhG,UAAUzqB,EAAM/yE,IAEzB0hF,YAAY,EACZtB,SAASC,GAYblL,yBACIvwD,IAAK,WACD,OAAQ3oB,KAAKw4E,YAAcyC,GAAU,GAEzCnvD,IAAK,SAAU/nB,GACPA,GACA/D,KAAKu5E,aAAc,EACnBv5E,KAAKwhG,cAAe,EACpBxhG,KAAKw4E,aAAeyC,GAGpBj7E,KAAKw4E,cAAgByC,GAG7BwK,YAAY,EACZtB,SAASC,GAUbod,cACI74E,IAAK,WACD,OAAQ3oB,KAAKw4E,YAAc0C,GAAS,GAExCpvD,IAAK,SAAU/nB,GACX/D,KAAKuhG,UAAUrmB,EAAOn3E,IAE1B0hF,YAAY,EACZtB,SAASC,GAcbnL,gBACItwD,IAAK,WACD,OAAQ3oB,KAAKw4E,YAAc6oB,KAAgBA,GAE/Cx4E,SAAS,GAabmxD,iBACIrxD,IAAK,WACD,OAAQ3oB,KAAKw4E,YAAc4oB,KAAaA,GAE5Cv4E,SAAS,GAeb21B,KACI71B,IAAK,WACD,OAAO3oB,KAAK+5E,MAEhBjuD,IAAK,SAAU/nB,GACX/D,KAAK+5E,KAAOh2E,GAEhBogF,SAASC,GAabzK,QACIhxD,IAAK,WACD,OAAO3oB,KAAK65E,SAEhB/tD,IAAK,SAAU/nB,GACX/D,KAAK65E,QAAU91E,GAEnBogF,SAASC,GAab3lC,MACI91B,IAAK,WACD,OAAO3oB,KAAK84E,OAEhBhtD,IAAK,SAAU/nB,GACX/D,KAAK84E,MAAQ/0E,GAEjBogF,SAASC,GAabxL,OACIjwD,IAAK,WACD,OAAO3oB,KAAKg5E,QAEhBltD,IAAK,SAAU/nB,GACX/D,KAAKg5E,OAASj1E,GAElBogF,SAASC,GAYbqd,kBACI94E,IAAK,WACD,OAAO3oB,KAAKq5E,mBAEhBvtD,IAAK,SAAU/nB,GACX/D,KAAKq5E,kBAAoBt1E,GAE7BogF,SAASC,GAYbsd,gBACI/4E,IAAK,WACD,OAAO3oB,KAAKo6E,iBAEhBtuD,IAAK,SAAU/nB,GACX/D,KAAKo6E,gBAAkBr2E,GAE3BogF,SAASC,GAYbud,4BACIh5E,IAAK,WACD,OAAO3oB,KAAKo5E,wBAEhBttD,IAAK,SAAU/nB,GACX/D,KAAKo5E,uBAAyBr1E,GAElC0hF,YAAY,GAUhBmc,0BACIj5E,IAAK,WACD,OAAO3oB,KAAKm6E,sBAEhBruD,IAAK,SAAU/nB,GACX/D,KAAKm6E,qBAAuBp2E,GAEhC0hF,YAAY,GAYhBoc,eACIl5E,IAAK,WACD,OAAO3oB,KAAK85E,WAEhBhuD,IAAK,SAAU/nB,GACX/D,KAAK85E,UAAY/1E,GAErB0hF,YAAY,GAYhBqc,kBACIn5E,IAAK,WACD,OAAO3oB,KAAK45E,cAEhB9tD,IAAK,SAAU/nB,GACX/D,KAAK45E,aAAe71E,GAExB0hF,YAAY,GAYhBsc,gBACIp5E,IAAK,WACD,OAAO3oB,KAAK64E,YAEhB/sD,IAAK,SAAU/nB,GACX/D,KAAK64E,WAAa90E,GAEtB0hF,YAAY,GAYhBuc,iBACIr5E,IAAK,WACD,OAAO3oB,KAAK+4E,aAEhBjtD,IAAK,SAAU/nB,GACX/D,KAAK+4E,YAAch1E,GAEvB0hF,YAAY,GAUhB7K,WACGnyD,QAASwuD,EAAUE,iBACnBzuD,KAAMuuD,EACNkN,SAASC,GAKZ6d,eACIx5E,aAASpiB,EACT2hF,qBAAsB,eAG1Bx6D,QAAS,KAUTgrD,YAAa,EAEbM,MAAO,EACPE,OAAQ,EACRe,KAAM,EACNF,QAAS,EACTO,gBAAiB,EACjBf,kBAAmB,EACnBR,YAAY,EACZE,aAAa,EACbe,WAAW,EACXF,cAAc,EACdR,wBAAwB,EACxBe,sBAAsB,EAGtB+nB,eAAgB,EAChBC,gBAAiB,GAGrBr5E,SACImuD,UAAWA,GAGf+H,OAAQ,gBACuB34E,IAAvBrG,KAAKiiG,gBAELjiG,KAAK46E,UAAY56E,KAAKiiG,cAAgBhrB,EAAUC,KAAOD,EAAUG,OACjEp3E,KAAKiiG,mBAAgB57F,IAI7B44E,SAAU,WACNiiB,EAAcr8F,IAAI7E,OAGtBm/E,UAAW,WACP+hB,EAAcn4C,OAAO/oD,OAGzBoiG,sBAAsBhe,EAYtBmd,UAAW,SAAUniC,EAAMijC,GAEvB,GAAIA,KADWriG,KAAKw4E,YAAcpZ,GAAQ,EAC1C,CAGA,IAAIkjC,GAAgBljC,EAAOiiC,GAAc,EACrCgB,GACAriG,KAAKw4E,aAAepZ,EAEhBkjC,GACAtiG,KAAKk5E,yBAA0B,EAC3Bl5E,KAAKi5E,iBAELj5E,KAAKkiG,eAAiBliG,KAAKykC,KAAK9gC,SAQpC3D,KAAKi6E,uBAAwB,EACzBj6E,KAAKg6E,kBAELh6E,KAAKmiG,gBAAkBniG,KAAKykC,KAAK7gC,WAcrC0+F,EACItiG,KAAKi5E,iBAELj5E,KAAKykC,KAAK9gC,MAAQ3D,KAAKkiG,gBAIvBliG,KAAKg6E,kBAELh6E,KAAKykC,KAAK7gC,OAAS5D,KAAKmiG,iBAIhCniG,KAAKw4E,cAAgBpZ,KAoB7Bmc,gBAAiB,WACb2lB,EAAc3lB,gBAAgBv7E,KAAKykC,SAkB3C6f,OAAOglB,eAAegS,EAAOh5E,UAAW,eACpCqmB,IADmD,WAK/C,OAAO3oB,KAAK46E,YAAc3D,EAAUC,MAExCprD,IAPmD,SAO9C/nB,GAID/D,KAAK46E,UAAY72E,EAAQkzE,EAAUC,KAAOD,EAAUG,UAK5Dx3E,GAAG07E,OAASn8E,EAAOE,QAAUi8E,6EC/pB7B,IAAMc,EAAY18E,EAAQ,iBAEtB6iG,OAAA,EAGAA,EAAmB3iG,GAAGE,OAClBb,KAAM,sBACNsC,QAAS66E,IAuGjBx8E,GAAG2iG,iBAAmBpjG,EAAOE,QAAUkjG,6CC7GvC,IAAM16F,EAAQnI,EAAQ,0BAChB8iG,EAAc9iG,EAAQ,4BACtB4vF,EAAQ5vF,EAAQ,cAChBotB,EAAQptB,EAAQ,WAChB+iG,EAAY31E,EAAM21E,UAClBC,EAAY51E,EAAM41E,UAClBC,EAAqB71E,EAAM61E,mBAmBjC,IAAIC,EAAUhjG,GAAGE,OACbb,KAAM,aACNsC,QAAS3B,GAAGw8E,UAEZjwC,QAAQR,EAORnjB,YACIknE,kBAAkB,EAClBC,QAAS,GAMTC,QACIzL,SAASC,EACTz7D,IAFI,WAGA,OAAO3oB,KAAK2vF,SAEhB7jE,IALI,SAKA/nB,GACI/D,KAAK6iG,WAAa,GAAK9+F,EAAMvE,QAAUQ,KAAK6iG,YAC5C9+F,EAAQA,EAAMyE,MAAM,EAAGxI,KAAK6iG,YAGhC7iG,KAAK2vF,QAAU5rF,EACX/D,KAAK8iG,OACL9iG,KAAK+iG,cAAch/F,KAU/Bi/F,iBACI7e,SAASC,EACT37D,QAAS,KACTC,KAAM9oB,GAAGioE,YACTyf,OAJa,WAKTtnF,KAAKijG,4BAcbC,YACIz6E,QAASk6E,EAAmBQ,QAC5Bhf,SAASC,EACT8D,YAAa,qBACbx/D,KAAMi6E,EACNrb,OALQ,WAMAtnF,KAAK8iG,QACL9iG,KAAK8iG,MAAMI,WAAaljG,KAAKkjG,cAWzCE,WACIjf,SAASC,EACT37D,QAASi6E,EAAUS,QACnBz6E,KAAMg6E,EACNpb,OAJO,WAKCtnF,KAAK8iG,QACL9iG,KAAK8iG,MAAMO,aAAarjG,KAAKojG,WAC7BpjG,KAAK+iG,cAAc/iG,KAAK2vF,YAapC2T,WACInf,SAASC,EACT37D,QAASg6E,EAAUc,IACnB76E,KAAM+5E,EACNnb,OAJO,WAKCtnF,KAAK8iG,OACL9iG,KAAK8iG,MAAMU,aAAaxjG,KAAKsjG,aAUzCx7B,UACIqc,SAASC,EACT37D,QAAS,GACT6+D,OAHM,WAIEtnF,KAAKyjG,aACLzjG,KAAKyjG,WAAW37B,SAAW9nE,KAAK8nE,UAEhC9nE,KAAK8iG,OACL9iG,KAAK8iG,MAAMY,YAAY1jG,KAAK8nE,YAUxCwoB,YACInM,SAASC,EACT37D,QAAS,GACT6+D,OAHQ,WAIAtnF,KAAKyjG,aACLzjG,KAAKyjG,WAAWnT,WAAatwF,KAAKswF,cAU9CqT,WACIxf,SAASC,EACT37D,QAAS7oB,GAAG8c,MAAMoxB,MAClBw5C,OAHO,WAICtnF,KAAKyjG,aACLzjG,KAAKyjG,WAAWh/D,KAAKlpB,QAAUvb,KAAK2jG,UAAU56F,EAC9C/I,KAAKyjG,WAAWh/D,KAAKjoB,MAAQxc,KAAK2jG,WAElC3jG,KAAK8iG,OACL9iG,KAAK8iG,MAAMc,aAAa5jG,KAAK2jG,aAUzCE,aACI1f,SAASC,EACT37D,QAAS,qBACT6+D,OAHS,WAIDtnF,KAAK8jG,oBACL9jG,KAAK8jG,kBAAkBlU,OAAS5vF,KAAK6jG,aAErC7jG,KAAK8iG,OACL9iG,KAAK8iG,MAAMiB,mBAAmB/jG,KAAK6jG,eAU/CG,qBACI7f,SAASC,EACT37D,QAAS,GACT6+D,OAHiB,WAITtnF,KAAK8jG,oBACL9jG,KAAK8jG,kBAAkBh8B,SAAW9nE,KAAKgkG,uBAUnDC,sBACI9f,SAASC,EACT37D,QAAS7oB,GAAG8c,MAAMguE,KAClBpD,OAHkB,WAIVtnF,KAAK8jG,oBACL9jG,KAAK8jG,kBAAkBr/D,KAAKjoB,MAAQxc,KAAKikG,qBACzCjkG,KAAK8jG,kBAAkBr/D,KAAKlpB,QAAUvb,KAAKikG,qBAAqBl7F,KAc5E85F,WACI1e,SAASC,EACT37D,QAAS,GACT6+D,OAHO,WAICtnF,KAAK8iG,OACL9iG,KAAK8iG,MAAMoB,aAAalkG,KAAK6iG,aAWzCsB,WACIhgB,SAASC,EACT37D,SAAS,EACT6+D,OAHO,WAICtnF,KAAK8iG,OACL9iG,KAAKokG,qBAKjBC,UAAW,EAOXC,UACIngB,SAASC,EACTz7D,IAFM,WAGF,OAAO3oB,KAAKqkG,WAEhBv4E,IALM,SAKD/nB,GACD/D,KAAKqkG,UAAYtgG,EACb/D,KAAK8iG,OACL9iG,KAAK8iG,MAAMyB,YAAYxgG,KAUnCygG,iBACI/7E,WACAC,KAAM9oB,GAAGw8E,UAAU2M,cAQvB0b,aACIh8E,WACAC,KAAM9oB,GAAGw8E,UAAU2M,cAQvB2b,iBACIj8E,WACAC,KAAM9oB,GAAGw8E,UAAU2M,cAQvB4b,eACIl8E,WACAC,KAAM9oB,GAAGw8E,UAAU2M,eAK3BjgE,SACI87E,aAAcpC,EACdG,mBAAoBA,EACpBD,UAAWA,EACXD,UAAWA,GAGf1jB,MA1TmB,WA2Tf/+E,KAAKijG,0BACLjjG,KAAK6kG,gBACL7kG,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAUsZ,aAAc/yD,KAAK8kG,kBAAmB9kG,MAErE,IAAI+kG,EAAO/kG,KAAK8iG,MAAQ,IAAIN,EAE5BuC,EAAKC,YAAYhlG,MACjB+kG,EAAKnmB,QAAQ5+E,KAAKykC,MAClBsgE,EAAKvB,aAAaxjG,KAAKsjG,WACvByB,EAAKb,aAAalkG,KAAK6iG,WACvBkC,EAAK1B,aAAarjG,KAAKojG,WACvB2B,EAAKE,cAAcjlG,KAAKkjG,YACxB6B,EAAKR,YAAYvkG,KAAKskG,UACtBS,EAAKnB,aAAa5jG,KAAK2jG,WACvBoB,EAAKrB,YAAY1jG,KAAK8nE,UACtBi9B,EAAKhB,mBAAmB/jG,KAAK6jG,aAE7B7jG,KAAKokG,mBACLpkG,KAAK+iG,cAAc/iG,KAAK4vF,QACxB5vF,KAAKklG,aAGTd,iBAjVmB,WAkVXpkG,KAAKmkG,UACLnkG,KAAKmlG,cAGLnlG,KAAKolG,cAETplG,KAAK8iG,MAAMqB,UAAUnkG,KAAKmkG,YAG9Be,UA3VmB,WA4Vf,IAAIj2D,EAAOjvC,KAAKykC,KAAKm4B,iBAErB58D,KAAKqlG,YAAY5gE,KAAKu4B,eAAeh9D,KAAKykC,KAAKs4B,kBAC/C/8D,KAAKqlG,YAAY5gE,KAAKo4B,eAAe5tB,GAErCjvC,KAAKslG,qBAAqBr2D,GAC1BjvC,KAAK8iG,MAAMyC,QAAQt2D,EAAKtrC,MAAOsrC,EAAKrrC,SAGxC0hG,qBArWmB,SAqWGr2D,GAClB,IAAIxK,EAAOzkC,KAAKykC,KACZ+gE,GAAQ/gE,EAAK2T,QAAU3T,EAAK9gC,MAC5B8hG,GAAQhhE,EAAK4T,QAAU5T,EAAK7gC,OAE5B8hG,EAAmB1lG,KAAK8jG,kBACxB6B,EAAY3lG,KAAKyjG,WAErBkC,EAAUlhE,KAAKo4B,eAAe5tB,EAAKtrC,MA9XtB,EA8X4CsrC,EAAKrrC,QAC9D8hG,EAAiBjhE,KAAKo4B,eAAe5tB,EAAKtrC,MA/X7B,EA+XmDsrC,EAAKrrC,QACrE8hG,EAAiBpV,WAAarhD,EAAKrrC,OAEnC8hG,EAAiBjhE,KAAK3/B,YAAY0gG,EAlYrB,EAkY0CC,EAAOx2D,EAAKrrC,QACnE+hG,EAAUlhE,KAAK3/B,YAAY0gG,EAnYd,EAmYmCC,EAAOx2D,EAAKrrC,QAExD5D,KAAKsjG,YAAcb,EAAUc,KAC7BmC,EAAiBzV,cAAgBpoF,EAAMonF,sBAAsBjY,IAC7D0uB,EAAiBjV,gBAAiB,EAClCkV,EAAU1V,cAAgBpoF,EAAMonF,sBAAsBjY,IACtD2uB,EAAUlV,gBAAiB,IAG3BiV,EAAiBzV,cAAgBpoF,EAAMonF,sBAAsBhU,OAC7DyqB,EAAiBjV,gBAAiB,EAClCkV,EAAU1V,cAAgBpoF,EAAMonF,sBAAsBhU,OACtD0qB,EAAUlV,gBAAiB,IAInCwS,wBAlYmB,WAmYf,IAAI2C,EAAa5lG,KAAKqlG,YACtB,IAAKO,EAAY,CACb,IAAInhE,EAAOzkC,KAAKykC,KAAKohE,eAAe,qBAC/BphE,IACDA,EAAO,IAAI7kC,GAAG2jB,KAAK,uBAGvBqiF,EAAanhE,EAAK/e,aAAa9lB,GAAGkqF,WAE9B8b,EAAanhE,EAAK+mD,aAAa5rF,GAAGkqF,SAEtC8b,EAAWl9E,KAAO9oB,GAAGkqF,OAAO6K,KAAKyI,OAEjC34D,EAAK9/B,OAAS3E,KAAKykC,KACnBzkC,KAAKqlG,YAAcO,EAEvBA,EAAWz8E,YAAcnpB,KAAKgjG,iBAGlC6B,cAtZmB,WAuZf,IAAK7kG,KAAKyjG,WAAY,CAClB,IAAIh/D,EAAOzkC,KAAKykC,KAAKohE,eAAe,cAC/BphE,IACDA,EAAO,IAAI7kC,GAAG2jB,KAAK,eAEvBkhB,EAAKjoB,MAAQxc,KAAK2jG,UAClBl/D,EAAK9/B,OAAS3E,KAAKykC,KACnBA,EAAKu4B,eAAe,EAAG,GAEvB,IAAI2oC,EAAYlhE,EAAK/e,aAAa4pE,GAC7BqW,IACDA,EAAYlhE,EAAK+mD,aAAa8D,IAElCqW,EAAUpV,SAAWjB,EAAMJ,SAASC,MACpCwW,EAAU79B,SAAW9nE,KAAK8nE,SAC1B69B,EAAUrV,WAAatwF,KAAKswF,WAC5BtwF,KAAKyjG,WAAakC,EAGtB,IAAK3lG,KAAK8jG,kBAAmB,CACzB,IAAIl5D,EAAO5qC,KAAKykC,KAAKohE,eAAe,qBAC/Bj7D,IACDA,EAAO,IAAIhrC,GAAG2jB,KAAK,sBAEvBqnB,EAAKpuB,MAAQxc,KAAKikG,qBAClBr5D,EAAKjmC,OAAS3E,KAAKykC,KACnBmG,EAAKoyB,eAAe,EAAG,GAEvB,IAAI0oC,EAAmB96D,EAAKllB,aAAa4pE,GACpCoW,IACDA,EAAmB96D,EAAK4gD,aAAa8D,IAEzCoW,EAAiBnV,SAAWjB,EAAMJ,SAASC,MAC3CuW,EAAiB59B,SAAW9nE,KAAKgkG,oBACjC0B,EAAiB9V,OAAS5vF,KAAK6jG,YAC/B7jG,KAAK8jG,kBAAoB4B,IAIjCZ,kBA9bmB,WA+bf,IAAIgB,EAAgB9lG,KAAKyjG,WAAWh/D,KAChCshE,EAAuB/lG,KAAK8jG,kBAAkBr/D,KAC9CuhE,EAAiBhmG,KAAKqlG,YAAY5gE,KAEtCqhE,EAAcxmG,GAAKU,KAAKykC,KAAK9gC,MAAM,EACnCmiG,EAAcpiG,EAAI1D,KAAKykC,KAAK7gC,OAAO,EACnCkiG,EAAcniG,MAAQ3D,KAAKykC,KAAK9gC,MAChCmiG,EAAcliG,OAAS5D,KAAKykC,KAAK7gC,OAEjCmiG,EAAqBzmG,GAAKU,KAAKykC,KAAK9gC,MAAM,EAC1CoiG,EAAqBriG,EAAI1D,KAAKykC,KAAK7gC,OAAO,EAC1CmiG,EAAqBpiG,MAAQ3D,KAAKykC,KAAK9gC,MACvCoiG,EAAqBniG,OAAS5D,KAAKykC,KAAK7gC,OAExCoiG,EAAeriG,MAAQ3D,KAAKykC,KAAK9gC,MACjCqiG,EAAepiG,OAAS5D,KAAKykC,KAAK7gC,QAGtCwhG,YAjdmB,WAkdf,IAAIa,EAAcjmG,KAAKyjG,WAAW7T,OAClC5vF,KAAKyjG,WAAWh/D,KAAKkzB,OAAyB,KAAhBsuC,EAC9BjmG,KAAK8jG,kBAAkBr/D,KAAKkzB,OAAyB,KAAhBsuC,GAGzCd,YAvdmB,WAwdfnlG,KAAKyjG,WAAWh/D,KAAKkzB,QAAS,EAC9B33D,KAAK8jG,kBAAkBr/D,KAAKkzB,QAAS,GAGzCorC,cA5dmB,SA4dJjxB,GACX,IAAI6zB,EAAY3lG,KAAKyjG,WAErB,GAAKkC,EAAL,CAIA,IAAIM,EAAcn0B,EACdm0B,IACAA,EAAcjmG,KAAKkmG,wBAAwBD,IAG/CN,EAAU/V,OAASqW,EACnBjmG,KAAK8iG,MAAMqD,UAAUr0B,GAChB9xE,KAAK8iG,MAAMsD,UAAapmG,KAAKmkG,WAC9BnkG,KAAKolG,gBAIbc,wBA/emB,SA+eMp0B,EAAMu0B,GAC3B,IAAIjD,EAAYpjG,KAAKojG,UACrB,GAAKiD,GAAkBjD,IAAcV,EAAU4D,SAQtClD,IAAcV,EAAU6D,4BAC7Bz0B,EAAOA,EAAKstB,cAEPgE,IAAcV,EAAU8D,kBAC7B10B,EA5gBZ,SAAqB8d,GACjB,OAAOA,EAAO6W,QAAQ,cAAe,SAAS19F,GAAK,OAAOA,EAAEq2F,gBA2gB7CsH,CAAW50B,GAEbsxB,IAAcV,EAAUiE,wBAC7B70B,EA3gBZ,SAAgC8d,GAC5B,OAAOA,EAAO8O,OAAO,GAAGU,cAAgBxP,EAAOpnF,MAAM,GA0gBtCo+F,CAAsB90B,QAfwB,CAGrD,IAFA,IAAI+0B,EAAiB,GACjB94E,EAAM+jD,EAAKtyE,OACND,EAAI,EAAGA,EAAIwuB,IAAOxuB,EACvBsnG,GAAkB,SAEtB/0B,EAAO+0B,EAYX,OAAO/0B,GAGXg1B,uBAtgBmB,WAugBf9mG,KAAKmlG,cACLvlG,GAAGw8E,UAAU2M,aAAakB,WAAWjqF,KAAKwkG,gBAAiBxkG,MAC3DA,KAAKykC,KAAK/W,KAAK,oBAAqB1tB,OAGxC+mG,uBA5gBmB,WA6gBV/mG,KAAKmkG,WACNnkG,KAAKolG,cAETxlG,GAAGw8E,UAAU2M,aAAakB,WAAWjqF,KAAK0kG,gBAAiB1kG,MAC3DA,KAAKykC,KAAK/W,KAAK,oBAAqB1tB,OAGxCgnG,mBAphBmB,SAohBCl1B,GAChBA,EAAO9xE,KAAKkmG,wBAAwBp0B,GAAM,GAC1C9xE,KAAK4vF,OAAS9d,EACdlyE,GAAGw8E,UAAU2M,aAAakB,WAAWjqF,KAAKykG,YAAa3yB,EAAM9xE,MAC7DA,KAAKykC,KAAK/W,KAAK,eAAgB1tB,OAGnCinG,qBA3hBmB,WA4hBfrnG,GAAGw8E,UAAU2M,aAAakB,WAAWjqF,KAAK2kG,cAAe3kG,MACzDA,KAAKykC,KAAK/W,KAAK,iBAAkB1tB,OAGrCwkF,UAhiBmB,WAiiBfxkF,KAAK8iG,MAAMl/C,SAGfq7B,SApiBmB,WAqiBfj/E,KAAK8iG,OAAS9iG,KAAK8iG,MAAM7jB,YAG7BE,UAxiBmB,WAyiBfn/E,KAAK8iG,OAAS9iG,KAAK8iG,MAAM3jB,aAG7BzwC,UA5iBmB,WA8iBX1uC,KAAKipF,iBAETjpF,KAAK++E,SAGTkK,eAnjBmB,WAojBfjpF,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAU2Y,YAAapyD,KAAKspF,cAAetpF,MAChEA,KAAKykC,KAAKvW,GAAGtuB,GAAG2jB,KAAKk2B,UAAU6Y,UAAWtyD,KAAKwpF,cAAexpF,OAGlEspF,cAxjBmB,SAwjBJp9D,GACPlsB,KAAK8iG,OACL9iG,KAAK8iG,MAAMxZ,cAAcp9D,EAAMwnC,OAEnCxnC,EAAMqoC,mBAGVk1B,eA/jBmB,SA+jBHv9D,GACRlsB,KAAK8iG,OACL9iG,KAAK8iG,MAAMrZ,iBAEfv9D,EAAMqoC,mBAGVi1B,cAtkBmB,SAskBJt9D,GACPlsB,KAAK8iG,OACL9iG,KAAK8iG,MAAMtZ,gBAEft9D,EAAMqoC,mBAQV2yC,SAllBmB,WAmlBZlnG,KAAK8iG,OACJ9iG,KAAK8iG,MAAMoE,YAUnBC,UA9lBmB,WA+lBf,IAAIA,GAAY,EAIhB,OAHInnG,KAAK8iG,QACLqE,EAAYnnG,KAAK8iG,MAAMqE,aAEpBA,GAGXtmG,OAtmBmB,WAumBXb,KAAK8iG,OACL9iG,KAAK8iG,MAAMjiG,YAMvBjB,GAAGgjG,QAAUzjG,EAAOE,QAAUujG,kHCroB9B,IAAMwE,EAAQ1nG,EAAQ,wBAChBmI,EAAQnI,EAAQ,0BAChBotB,EAAQptB,EAAQ,WAChB+iG,EAAY31E,EAAM21E,UAClBC,EAAY51E,EAAM41E,UAClBC,EAAqB71E,EAAM61E,mBAS7B/oD,EAAOh6C,GAAG0hC,MACV6Y,EAAUP,EAAK/T,KAAKiH,SACpBu6D,EAAeztD,EAAK/T,KAAKiH,SACzBw6D,EAAQ1nG,GAAGyW,KAEXkxF,EAAsB,KAGtBC,GACAC,aAAa,GAGb7nG,GAAGi4B,IAAI6vE,aAAe9nG,GAAGi4B,IAAImF,IAC5Bp9B,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAI8vE,qBAC/B/nG,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAI+vE,mBAC9BJ,EAASC,aAAc,GAoB3B,IAAIjF,EAAc5iG,GAAGE,OACjBC,KADuB,WAEnBC,KAAK6nG,UAAY,KACjB7nG,KAAK8nG,YAAc,EACnB9nG,KAAK+nG,YAAc,EACnB/nG,KAAKgoG,YAAcrF,EAAmBQ,QACtCnjG,KAAKioG,WAAa,GAClBjoG,KAAKkoG,MAAQ,GACbloG,KAAKmoG,iBAAmB,GACxBnoG,KAAKooG,cAAe,EACpBpoG,KAAKqoG,MAAQzoG,GAAGqvC,OAChBjvC,KAAK4qC,MAAQ,KACb5qC,KAAKomG,UAAW,EAEhBpmG,KAAKsoG,oBACLtoG,KAAKuoG,cAAe,EACpBvoG,KAAKwoG,cAAe,EACpBxoG,KAAKyoG,gBAAiB,EACtBzoG,KAAK0oG,qBAAuB,MAGhCzpB,SArBuB,WAsBdj/E,KAAK2oG,SAGN3oG,KAAKooG,aACLpoG,KAAK2oG,OAAOrqD,MAAMsqD,QAAU,GAG5B5oG,KAAK2oG,OAAOrqD,MAAMsqD,QAAU,SAIpCzpB,UAjCuB,WAkCdn/E,KAAK2oG,SAGV3oG,KAAK2oG,OAAOrqD,MAAMsqD,QAAU,SAGhCrE,YAxCuB,SAwCVljF,GACLrhB,KAAK2oG,SACL3oG,KAAK2oG,OAAOrE,SAAWjjF,IAI/B6lF,SA9CuB,WA+CnBlnG,KAAK6oG,iBAGT1B,UAlDuB,WAmDnB,OAAInnG,KAAK2oG,OACEhvE,SAASmvE,gBAAkB9oG,KAAK2oG,QAE3C/oG,GAAGu+B,OAAO,OACH,IAGXgmE,UA1DuB,SA0DZ/kC,GACJp/D,KAAKooG,eAAiBhpC,GAASp/D,KAAK2oG,SAEvC3oG,KAAKooG,aAAehpC,EAGhBp/D,KAAK2oG,OAAOrqD,MAAMsqD,QADlBxpC,EAC4B,GAEA,SAIpC8kC,aAtEuB,SAsETrB,GACLlwF,MAAMkwF,KACJA,EAAY,IAGXA,EAAY,OAEhB7iG,KAAKioG,WAAapF,EAClB7iG,KAAK2oG,SAAW3oG,KAAK2oG,OAAO9F,UAAYA,KAIhDsD,UAlFuB,SAkFZr0B,GACP9xE,KAAKkoG,MAAQp2B,EACb9xE,KAAK2oG,SAAW3oG,KAAK2oG,OAAO5kG,MAAQ+tE,IAGxCi3B,UAvFuB,WAwFnB,OAAO/oG,KAAKkoG,OAGhBnE,mBA3FuB,SA2FHjyB,GAChB9xE,KAAKmoG,iBAAmBr2B,GAG5Bk3B,mBA/FuB,WAgGnB,OAAOhpG,KAAKmoG,kBAGhBnD,YAnGuB,SAmGViE,GACTjpG,KAAK6nG,UAAYoB,GAGrBzF,aAvGuB,SAuGTF,GACNtjG,KAAK8nG,aAAexE,IAExBtjG,KAAK8nG,WAAaxE,EAClBtjG,KAAKkpG,cAELlpG,KAAKmpG,sBACLnpG,KAAKopG,YAAYppG,KAAKqoG,MAAM1kG,MAAO3D,KAAKqoG,MAAMzkG,UAGlDy/F,aAjHuB,SAiHTD,GACV,GAAIpjG,KAAK+nG,aAAe3E,EAAxB,CAEApjG,KAAK+nG,WAAa3E,EAClBpjG,KAAKmpG,sBAEL,IAAIE,EAAgB,OAEhBjG,IAAcV,EAAU6D,4BACxB8C,EAAgB,YAEXjG,IAAcV,EAAU8D,oBAC7B6C,EAAgB,cAGhBrpG,KAAK2oG,SACL3oG,KAAK2oG,OAAOrqD,MAAM+qD,cAAgBA,EAClCrpG,KAAK2oG,OAAO5kG,MAAQ/D,KAAKkoG,SAIjCjD,cAtIuB,SAsIR/B,GACXljG,KAAKgoG,YAAc9E,EACnBljG,KAAKmpG,uBAGTzF,YA3IuB,SA2IV57B,GACT9nE,KAAKspG,YAAcxhC,GAAY9nE,KAAKspG,YACpCtpG,KAAK2oG,SAAW3oG,KAAK2oG,OAAOrqD,MAAMwpB,SAAW9nE,KAAKspG,YAAc,OAGpE1F,aAhJuB,SAgJTpnF,GACVxc,KAAKupG,WAAa/sF,EAClBxc,KAAK2oG,SAAW3oG,KAAK2oG,OAAOrqD,MAAM9hC,MAAQA,EAAMgtF,MAAM,UAG1DjE,QArJuB,SAqJd5hG,EAAOC,GACZ5D,KAAKqoG,MAAM1kG,MAAQA,EACnB3D,KAAKqoG,MAAMzkG,OAASA,EACpB5D,KAAKopG,YAAYzlG,EAAOC,IAG5Bg7E,QA3JuB,SA2Jdn6C,GACLzkC,KAAK4qC,MAAQnG,GAGjB5jC,OA/JuB,WAkKfb,KAAKypG,iBAIb7lD,MAtKuB,WAuKnB5jD,KAAK4qC,MAAQ,KACb5qC,KAAKglG,YAAY,MACjBhlG,KAAK0pG,YACD1pG,KAAK0oG,uBACL9lD,OAAOppB,oBAAoB,oBAAqBx5B,KAAK0oG,sBACrD1oG,KAAK0oG,qBAAuB,OAIpCpf,cAhLuB,SAgLR51B,KAIf81B,cApLuB,WAqLnBxpF,KAAK6oG,iBAGTA,cAxLuB,WAwLN,IAAAx6E,EAAAruB,KACTJ,GAAGi4B,IAAIsjD,WAAan7E,KAAKomG,UAEzBpmG,KAAK2pG,wBAGL3pG,KAAK2oG,QAAQ,WACbt6E,EAAKs6E,OAAOrqD,MAAMsqD,QAAU,GAE5B,IAAIr6E,EAAAF,EACJ,SAASu7E,IACLr7E,EAAKo6E,OAAOkB,QAGZjqG,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAIiyE,gBAC9BhtE,WAAW8sE,EA7ON,KA+OAhqG,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAIkyE,qBACnCjtE,WAAW8sE,EA/OD,GAkPVA,IAfS,GAmBjB5pG,KAAKomG,UAAW,GAGpB4D,YApNuB,WAqNnB,IAAIz7E,EAAOvuB,KACPiqG,EAA2B,YACtB17E,EAAK65E,cAAgB75E,EAAKo6E,SAC3Bp6E,EAAKo6E,OAAOrqD,MAAMsqD,QAAU,QAE5Br6E,EAAKs5E,WAAat5E,EAAKs5E,UAAUd,wBACjCx4E,EAAKs5E,UAAUd,0BAGnB/mG,KAAKomG,WACDxmG,GAAGi4B,IAAIsjD,SAEPr+C,WAAW,WACPvO,EAAK27E,sBACLD,KA1QH,KA8QDA,KAGRjqG,KAAKomG,UAAW,GAGpB+C,oBA7OuB,WA8OnB,IAAI7F,EAAYtjG,KAAK8nG,WACjBqC,EAAQnqG,KAAK2oG,OACjB,GAAKwB,EAEL,GAAInqG,KAAK+nG,aAAerF,EAAU4D,SAAlC,CAKA,IAAI59E,EAAOyhF,EAAMzhF,KACb46E,IAAcb,EAAU2H,WACxB1hF,EAAO,QACD46E,IAAcb,EAAU4H,SAAW/G,IAAcb,EAAU6H,QACjE5hF,EAAO,SACD46E,IAAcb,EAAU8H,cAC9B7hF,EAAO,SACPyhF,EAAMK,QAAU,UACVlH,IAAcb,EAAUgI,IAC9B/hF,EAAO,OAEPA,EAAO,OAEH1oB,KAAKgoG,cAAgBrF,EAAmB+H,SACxChiF,EAAO,WAIfyhF,EAAMzhF,KAAOA,OAtBTyhF,EAAMzhF,KAAO,YAyBrB0gF,YA5QuB,SA4QVuB,EAAUC,GACnB,IAAIT,EAAQnqG,KAAK2oG,OACZwB,IAELA,EAAM7rD,MAAM36C,MAAQgnG,EAAW,KAC/BR,EAAM7rD,MAAM16C,OAASgnG,EAAY,OAGrCnB,cApRuB,WAqRnB,GAAKzpG,KAAK2oG,OAAV,CAEA,IAAIhtC,OAAA,EAQJ,GAFIA,EAAS/7D,GAAGsnD,OAAO0U,WAAW57D,KAAK4qC,OAEvC,CAEA,IAAInG,EAAOzkC,KAAK4qC,MACZj7B,EAAS/P,GAAG6iD,KAAK/nC,QAASzK,EAASrQ,GAAG6iD,KAAK9nC,QAC3CkwF,EAAWjrG,GAAG6iD,KAAKU,cACnB2nD,EAAMlrG,GAAG6iD,KAAKQ,kBAElBxe,EAAKoM,eAAesJ,GACpB,IAAI0lB,EAAcp7B,EAAK2wB,aACvBkyC,EAAMhoG,GAAKmlC,EAAK6wB,aAAah2D,EAAIugE,EAAYl8D,MAC7C2jG,EAAM5jG,GAAK+gC,EAAK6wB,aAAa5xD,EAAIm8D,EAAYj8D,OAE7Cg2C,EAAK/T,KAAKi6B,UAAU3lB,EAASA,EAASmtD,GAEtC3rC,EAAO2jB,uBAAuB+nB,GAC9BztD,EAAK/T,KAAK3hC,IAAImjG,EAAcA,EAAcltD,GAE1CxqC,GAAUm7F,EACV76F,GAAU66F,EAEV,IAAItoD,EAAY5iD,GAAG06B,KAAKkoB,UACpBz5C,EAAIs+F,EAAa33D,IAAM//B,EAAQzD,EAAIiuC,EAAQxK,IAAKxjC,EAAIguC,EAAQrK,IAAK1jC,EAAIi7F,EAAat3D,IAAM9/B,EAExF47E,EAAUrpC,GAAaA,EAAUlE,MAAMysD,aAAehlF,SAASy8B,EAAUlE,MAAMysD,aACnFlf,GAAWgf,EAASvrG,EAAIwrG,EACxB,IAAIhf,EAAUtpC,GAAaA,EAAUlE,MAAM0sD,eAAiBjlF,SAASy8B,EAAUlE,MAAM0sD,eACrFlf,GAAW+e,EAASnnG,EAAIonG,EACxB,IAAIG,EAAK5D,EAAa/2D,IAAM3gC,EAASk8E,EAASqf,EAAK7D,EAAa92D,IAAMtgC,EAAS67E,EAE3E0b,EAASC,cACTznG,KAAKopG,YAAYppG,KAAKqoG,MAAM1kG,MAAQoF,EAAG/I,KAAKqoG,MAAMzkG,OAASwI,GAC3DrD,EAAI,EACJqD,EAAI,GAGR,IAAIqjC,EAAS,UAAY1mC,EAAI,KAAOmD,EAAI,KAAOC,EAAI,IAAMC,EAAI,IAAM6+F,EAAK,KAAOC,EAAK,IACpFlrG,KAAK2oG,OAAOrqD,MAAZ,UAAiC7O,EACjCzvC,KAAK2oG,OAAOrqD,MAAM,qBAAuB7O,EACzCzvC,KAAK2oG,OAAOrqD,MAAM,oBAAsB,eACxCt+C,KAAK2oG,OAAOrqD,MAAM,4BAA8B,kBAGpD6sD,uBAzUuB,WA0UnBnrG,KAAK4qC,MAAMiG,eAAesJ,GAC1B,IAAIz2C,EAAIy2C,EAAQ5J,IACZ66D,EAAexrG,GAAGkqE,YAAYlmE,OAE9BynG,EAAS,GADKzrG,GAAGkqE,YAAYnmE,MAEfynG,IACdC,EAAS,IAEbvuE,WAAW,WACP,GAAI8lB,OAAO0oD,QA5XT,IA4X8B5nG,EAAI0nG,EAAeC,EAAQ,CACvD,IAAIE,EAAeH,EAAeC,EAAS3nG,EAAIk/C,OAAO0oD,QAClDC,EAAe,KAAIA,EAAe,IAClCA,EAAe,MAAKA,EAAe,KACvC3oD,OAAO4oD,SAAS,EAAGD,KA9XlB,QAoYbpqC,EAAKqhC,EAAYlgG,UAkErB,SAASmpG,EAAmB1hE,EAAO2hE,GAC3B3hE,EAAMhmC,MAAMvE,OAASksG,EAAYzD,aACjCl+D,EAAMhmC,MAAQgmC,EAAMhmC,MAAMyE,MAAM,EAAGkjG,EAAYzD,aAE/CyD,EAAY7D,WAAa6D,EAAY7D,UAAUb,oBAC3C0E,EAAYxD,QAAUn+D,EAAMhmC,QAC5B2nG,EAAYxD,MAAQn+D,EAAMhmC,MAC1B2nG,EAAY7D,UAAUb,mBAAmB0E,EAAYxD,QAKjE,SAASyD,EAA4BC,EAAUF,EAAaG,GACxD,IAAIC,GAAY,EACZC,GAAsB,EACtBC,EAAMN,EAAYpD,iBACtB0D,EAAIC,iBAAmB,WACnBH,GAAY,GAEhBF,EAASvyE,iBAAiB,mBAAoB2yE,EAAIC,kBAElDD,EAAIE,eAAiB,WACjBJ,GAAY,EACRC,IAEA/rG,KAAK+D,MAAQ2nG,EAAYxD,MACzB6D,GAAsB,GAE1BN,EAAkBzrG,KAAM0rG,IAE5BE,EAASvyE,iBAAiB,iBAAkB2yE,EAAIE,gBAEhDF,EAAIjiE,MAAQ,WACJ+hE,GAGJL,EAAkBzrG,KAAM0rG,IAE5BE,EAASvyE,iBAAiB,QAAS2yE,EAAIjiE,OAEvCiiE,EAAInC,MAAQ,WACR7pG,KAAKs+C,MAAMwpB,SAAW4jC,EAAYpC,YAAc,KAChDtpG,KAAKs+C,MAAM9hC,MAAQkvF,EAAYnC,WAAWC,MAAM,QAE5CkC,EAAYtD,eACZsD,EAAYtF,UAAW,GAGvBxmG,GAAGi4B,IAAIsjD,UACPuwB,EAAY/B,wBAGZ+B,EAAY7D,WAAa6D,EAAY7D,UAAUf,wBAC/C4E,EAAY7D,UAAUf,0BAI9B8E,EAASvyE,iBAAiB,QAAS2yE,EAAInC,OAEvCmC,EAAIG,SAAW,SAAUC,GACjBA,EAAEC,UAAYxkG,EAAMykG,IAAIC,QACxBH,EAAE73C,kBAEEm3C,EAAY7D,WAAa6D,EAAY7D,UAAUZ,sBAC/CyE,EAAY7D,UAAUZ,uBAErB4E,IACDH,EAAYxD,MAAQloG,KAAK+D,MACzB2nG,EAAY1B,cACZpqG,GAAG06B,KAAKC,OAAOsvE,WAI3B+B,EAASvyE,iBAAiB,WAAY2yE,EAAIG,UAE1CH,EAAIQ,KAAO,WACHV,EACAC,GAAsB,EAGtBL,EAAYxD,MAAQloG,KAAK+D,MAE7B2nG,EAAY1B,eAEhB4B,EAASvyE,iBAAiB,OAAQ2yE,EAAIQ,MAEtCd,EAAYe,yBAtJhBtrC,EAAG+nC,YAAc,WACTlpG,KAAK8nG,aAAerF,EAAUc,IAC9BvjG,KAAK0sG,qBAGL1sG,KAAK2sG,mBAKbxrC,EAAGwoC,sBAAwB,WACvB,IAAIp7E,EAAOvuB,KACNA,KAAK0oG,uBACN1oG,KAAK0oG,qBAAuB,WACxBn6E,EAAK48E,0BAETvoD,OAAOvpB,iBAAiB,oBAAqBr5B,KAAK0oG,uBAGlD9oG,GAAG6iD,KAAKmqD,2BACR5sG,KAAKuoG,cAAe,EACpB3oG,GAAG6iD,KAAKoqD,sBAAqB,GAC7BjtG,GAAGktG,OAAOC,kBAEV/sG,KAAKuoG,cAAe,EAExBvoG,KAAKwoG,aAAe5oG,GAAG6iD,KAAKuqD,uBAC5BptG,GAAG6iD,KAAKwqD,uBAAsB,GAC9B1F,EAAsBvnG,MAI1BmhE,EAAG+oC,oBAAsB,WACrB,GAAIlqG,KAAKyoG,eAAgB,CACrB7oG,GAAG06B,KAAKkoB,UAAUlE,MAAM,qBAAuB,gBAC/C1+C,GAAG06B,KAAKkoB,UAAUlE,MAAM3K,UAAY,gBAEpC,IAAI8O,EAAO7iD,GAAG6iD,KACV9+C,EAAQ8+C,EAAKyqD,8BAA8BvpG,MAC3CC,EAAS6+C,EAAKyqD,8BAA8BtpG,OAC5CD,EAAQ,GACR8+C,EAAK6pC,wBAAwB3oF,EAAOC,EAAQ6+C,EAAK0qD,mBAErDntG,KAAKyoG,gBAAiB,EAGtBzoG,KAAK0oG,uBACL9lD,OAAOppB,oBAAoB,oBAAqBx5B,KAAK0oG,sBACrD1oG,KAAK0oG,qBAAuB,MAG7B1oG,KAAKuoG,cACJ3oG,GAAG6iD,KAAKoqD,sBAAqB,GAO7B7sG,KAAKwoG,cAAgBjB,IAAwBvnG,MAC7CJ,GAAG6iD,KAAKwqD,uBAAsB,IA6FtC9rC,EAAGwrC,gBAAkB,WACjB3sG,KAAK0pG,YAEL,IAAIkC,EAAW5rG,KAAK2oG,OAAShvE,SAASC,cAAc,SAsBpD,OArBAgyE,EAASljF,KAAO,OAChBkjF,EAASttD,MAAMwpB,SAAW9nE,KAAKspG,YAAc,KAC7CsC,EAASttD,MAAM9hC,MAAQ,UACvBovF,EAASttD,MAAM8uD,OAAS,EACxBxB,EAASttD,MAAMsnD,WAAa,cAC5BgG,EAASttD,MAAM36C,MAAQ,OACvBioG,EAASttD,MAAM16C,OAAS,OACxBgoG,EAASttD,MAAMqZ,OAAS,EACxBi0C,EAASttD,MAAMs+C,QAAU,SACzBgP,EAASttD,MAAMa,QAAU,IACzBysD,EAASttD,MAAM+qD,cAAgB,YAC/BuC,EAASttD,MAAMsqD,QAAU,OACzBgD,EAASttD,MAAM3nC,SAAW,WAC1Bi1F,EAASttD,MAAMq7B,OAAS,MACxBiyB,EAASttD,MAAMG,KAAO4uD,MACtBzB,EAASttD,MAAM,mBAAqB,YACpCstD,EAASttD,MAAMsQ,UAAY,eAC3Bg9C,EAASttD,MAAM8xC,WAAa,QAE5Bub,EAA2BC,EAAU5rG,MAE9B4rG,GAGXzqC,EAAGurC,mBAAqB,WACpB1sG,KAAK0pG,YAEL,IAAIkC,EAAW5rG,KAAK2oG,OAAShvE,SAASC,cAAc,YAuBpD,OAtBAgyE,EAASljF,KAAO,OAChBkjF,EAASttD,MAAMwpB,SAAW9nE,KAAKspG,YAAc,KAC7CsC,EAASttD,MAAM9hC,MAAQ,UACvBovF,EAASttD,MAAM8uD,OAAS,EACxBxB,EAASttD,MAAMsnD,WAAa,cAC5BgG,EAASttD,MAAM36C,MAAQ,OACvBioG,EAASttD,MAAM16C,OAAS,OACxBgoG,EAASttD,MAAMqZ,OAAS,EACxBi0C,EAASttD,MAAMs+C,QAAU,SACzBgP,EAASttD,MAAMa,QAAU,IACzBysD,EAASttD,MAAMgvD,OAAS,OACxB1B,EAASttD,MAAM+qD,cAAgB,YAC/BuC,EAASttD,MAAMivD,WAAa,SAC5B3B,EAASttD,MAAMsqD,QAAU,OACzBgD,EAASttD,MAAM3nC,SAAW,WAC1Bi1F,EAASttD,MAAMq7B,OAAS,MACxBiyB,EAASttD,MAAMG,KAAO4uD,MACtBzB,EAASttD,MAAMsQ,UAAY,eAC3Bg9C,EAASttD,MAAM8xC,WAAa,QAE5Bub,EAA2BC,EAAU5rG,MAAM,GAEpC4rG,GAGXzqC,EAAGsrC,uBAAyB,WACxB7sG,GAAG06B,KAAKkoB,UAAUnD,YAAYr/C,KAAK2oG,SAGvCxnC,EAAGuoC,UAAY,WACX,IAAIS,EAAQnqG,KAAK2oG,OACjB,GAAIwB,EAAO,CAEP,IAAI6B,EAAMhsG,KAAKsoG,iBACf6B,EAAM3wE,oBAAoB,mBAAoBwyE,EAAIC,kBAClD9B,EAAM3wE,oBAAoB,iBAAkBwyE,EAAIE,gBAChD/B,EAAM3wE,oBAAoB,QAASwyE,EAAIjiE,OACvCogE,EAAM3wE,oBAAoB,QAASwyE,EAAInC,OACvCM,EAAM3wE,oBAAoB,WAAYwyE,EAAIG,UAC1ChC,EAAM3wE,oBAAoB,OAAQwyE,EAAIQ,MACtCR,EAAIC,iBAAmB,KACvBD,EAAIE,eAAiB,KACrBF,EAAIjiE,MAAQ,KACZiiE,EAAInC,MAAQ,KACZmC,EAAIG,SAAW,KACfH,EAAIQ,KAAO,KAEIpF,EAAMviB,SAASjlF,GAAG06B,KAAKkoB,UAAW2nD,IAE7CvqG,GAAG06B,KAAKkoB,UAAUgrD,YAAYrD,GAGtCnqG,KAAK2oG,OAAS,MAGlBxpG,EAAOE,QAAUmjG,+FC9nBjB,IAAIG,EAAqB/iG,GAAG43B,MAMxB2rE,QAAS,EAMTsK,KAAM,EAMNC,KAAM,EAMNhD,OAAQ,EAMRiD,GAAI,EAMJC,KAAM,IASNnL,EAAY7iG,GAAG43B,MAMf+rE,IAAK,EAML6G,WAAY,EAMZC,QAAS,EAMTE,aAAc,EAMdE,IAAK,EASLH,QAAS,EAMTuD,YAAa,IASbnL,EAAY9iG,GAAG43B,MASf8uE,SAAU,EAYVwH,UAAW,EASXtH,kBAAmB,EASnBG,sBAAuB,EAMvBJ,4BAA6B,EAK7BpD,QAAS,IAGbhkG,EAAOE,SACHsjG,mBAAoBA,EACpBF,UAAWA,EACXC,UAAWA,4BC/JfhjG,EAAQ,iBACRA,EAAQ,6BACRA,EAAQ,oBAER,IAAIssB,GACAtsB,EAAQ,cACRA,EAAQ,cACRA,EAAQ,cACRA,EAAQ,mBACRA,EAAQ,iBACRA,EAAQ,cACRA,EAAQ,aACRA,EAAQ,mBACRA,EAAQ,YACRA,EAAQ,iBACRA,EAAQ,kBACRA,EAAQ,yBACRA,EAAQ,gBACRA,EAAQ,cACRA,EAAQ,cACRA,EAAQ,uBACRA,EAAQ,oBACRA,EAAQ,gBACRA,EAAQ,uBACRA,EAAQ,mBACRA,EAAQ,cACRA,EAAQ,wBACRA,EAAQ,oBACRA,EAAQ,uBAGZP,EAAOE,QAAU2sB,+lBC/BjB,IAAI3N,EAAKze,GAAGye,GACR0vF,EAAqBruG,EAAQ,iBAAiBquG,mBAK9CC,EAAepuG,GAAGE,OAClBb,KAAM,kBACNupB,YAEIylF,aACIxlF,QAAS,KACTI,SAAS,EACTggD,YAAY,MAQpBqlC,EAAgBtuG,GAAGE,OACnBb,KAAM,mBACNsC,QAAS3B,GAAGw8E,UACZjwC,QACIg6C,UAAW,2DAEf39D,YA6BI2lF,UACI1lF,SAAS,EACT+sC,cAAc,GAGlBy4C,aACIxlF,QAAS,KACTI,SAAS,EACTggD,YAAY,IAGpB9oE,MAAM4rC,EAGN7iB,SAKIslF,cAAe,SAAU/1E,EAAI1nB,GACzB,IAAIk9E,EAAMxvE,EAAGowE,cAAcp2D,GAC3B,OAAIw1D,IAGAx1D,GACAz4B,GAAG8mE,YAAY2nC,mBAAmBh2E,GAC3B61E,EAAcI,kBAAkBj2E,EAAI1nB,IAExC,OAEX29F,kBAAmB,SAAUj2E,EAAI1nB,GAC7B,OAAIA,EAAK8zB,OAAS,sBAAsBm8C,KAAKvoD,IAAO01E,EAAmBntB,KAAKvoD,IAEjE61E,EAGAF,IAInBhvB,OAAQ,WACJp/E,GAAGu+B,OAAO,KAAMn+B,KAAKykC,KAAKxlC,SAIlCW,GAAG2uG,eAAiBpvG,EAAOE,QAAU6uG,8CCrGrC,IAAI7vF,EAAKze,GAAGye,GAEZ3e,EAAQ,kBAWR,IAAI8uG,EAAa,SAAUC,EAAW36C,GAClCl0D,GAAG8uG,MAAMnsG,KAAKvC,KAAMJ,GAAG8uG,MAAMl1C,MAAO1F,GACpC9zD,KAAK2uG,WAAaF,EAClBzuG,KAAK4uG,QAAU,EACf5uG,KAAKoQ,GAAK,EACVpQ,KAAKqQ,GAAK,EACVrQ,KAAK6uG,OAAS,EACd7uG,KAAK8uG,OAAS,EACd9uG,KAAK+uG,SAAW,EAChB/uG,KAAKgvG,SAAW,GAGpB3wF,EAAGmE,OAAOgsF,EAAY5uG,GAAG8uG,OACzB,IAAI/gF,EAAQ6gF,EAAWlsG,UASvBqrB,EAAMshF,cAAgB,SAAUC,EAAS5D,GACrCtrG,KAAK+uG,SAAWG,EAChBlvG,KAAKgvG,SAAW1D,GASpB39E,EAAMwhF,WAAa,WACf,OAAOnvG,KAAK+uG,UAShBphF,EAAMyhF,WAAa,WACf,OAAOpvG,KAAKgvG,UAUhBrhF,EAAM0hF,YAAc,SAAU/vG,EAAGoE,GAC7B1D,KAAKoQ,GAAK9Q,EACVU,KAAKqQ,GAAK3M,GASdiqB,EAAMgmC,YAAc,WAChB,OAAO/zD,GAAGqE,GAAGjE,KAAKoQ,GAAIpQ,KAAKqQ,KAS/Bsd,EAAM2hF,kBAAoB,WACtB,OAAO1vG,GAAGqE,GAAGjE,KAAKoQ,GAAIxQ,GAAG6iD,KAAK8sD,sBAAsB3rG,OAAS5D,KAAKqQ,KAGtEsd,EAAM6hF,eAAiB,SAAUlwG,EAAGoE,GAChC1D,KAAK6uG,OAASvvG,EACdU,KAAK8uG,OAASprG,GASlBiqB,EAAM8hF,oBAAsB,WACxB,OAAO7vG,GAAGqE,GAAGjE,KAAK6uG,OAAQ7uG,KAAK8uG,SASnCnhF,EAAM+hF,SAAW,WACb,OAAO9vG,GAAGqE,GAAGjE,KAAKoQ,GAAKpQ,KAAK6uG,OAAQ7uG,KAAKqQ,GAAKrQ,KAAK8uG,SASvDnhF,EAAMgiF,UAAY,WACd,OAAO3vG,KAAKoQ,GAAKpQ,KAAK6uG,QAS1BlhF,EAAMiiF,UAAY,WACd,OAAO5vG,KAAKqQ,GAAKrQ,KAAK8uG,QAS1BnhF,EAAMkiF,UAAY,SAAUC,GACxB9vG,KAAK4uG,QAAUkB,GASnBniF,EAAMoiF,UAAY,WACd,OAAO/vG,KAAK4uG,SAShBjhF,EAAMqiF,aAAe,WACjB,OAAOhwG,KAAKoQ,IAShBud,EAAMsiF,aAAe,WACjB,OAAOjwG,KAAKqQ,IAWhBm+F,EAAW9wD,KAAO,EAQlB8wD,EAAW0B,KAAO,EAQlB1B,EAAW2B,GAAK,EAQhB3B,EAAW4B,KAAO,EAQlB5B,EAAW6B,OAAS,EASpB7B,EAAW8B,YAAc,EASzB9B,EAAW+B,aAAe,EAS1B/B,EAAWgC,cAAgB,EAS3BhC,EAAWiC,SAAW,EAStBjC,EAAWkC,SAAW,EAStBlC,EAAWmC,SAAW,EAStBnC,EAAWoC,SAAW,EAStBpC,EAAWqC,SAAW,EActB,IAAIC,EAAa,SAAUC,EAAUj9C,GACjCl0D,GAAG8uG,MAAMnsG,KAAKvC,KAAMJ,GAAG8uG,MAAMsC,MAAOl9C,GACpC9zD,KAAKixG,WAAa,EAClBjxG,KAAKkxG,SAAWH,MAOhB/wG,KAAK0zD,MAAQ,KAGb1zD,KAAKmxG,aAAe,MAGxB9yF,EAAGmE,OAAOsuF,EAAYlxG,GAAG8uG,QACzB/gF,EAAQmjF,EAAWxuG,WAQb8uG,aAAe,WACjB,OAAOpxG,KAAKixG,YAShBtjF,EAAM0jF,WAAa,WACf,OAAOrxG,KAAKkxG,UAGhBvjF,EAAM2jF,cAAgB,SAAUC,GAC5BvxG,KAAKixG,WAAaM,GAGtB5jF,EAAM6jF,YAAc,SAAUC,GAC1BzxG,KAAKkxG,SAAWO,GAUpB9jF,EAAM0hF,YAAc,SAAU/vG,EAAGoE,GAC7B1D,KAAK0zD,OAAS1zD,KAAK0zD,MAAMg+C,aAAa1xG,KAAK0zD,MAAMi+C,QAASryG,EAAGoE,IASjEiqB,EAAMgmC,YAAc,WAChB,OAAO3zD,KAAK0zD,MAAQ1zD,KAAK0zD,MAAMC,cAAgB/zD,GAAGqE,MAStD0pB,EAAM2hF,kBAAoB,WACtB,OAAOtvG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAM47C,oBAAsB1vG,GAAGqE,MAS5D0pB,EAAM8hF,oBAAsB,WACxB,OAAOzvG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAM+7C,sBAAwB7vG,GAAGqE,MAS9D0pB,EAAMikF,iBAAmB,WACrB,OAAO5xG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAMk+C,mBAAqBhyG,GAAGqE,MAS3D0pB,EAAMgkF,MAAQ,WACV,OAAO3xG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAMi+C,QAAU,MAS7ChkF,EAAM+hF,SAAW,WACb,OAAO1vG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAMg8C,WAAa9vG,GAAGqE,MASnD0pB,EAAMgiF,UAAY,WACd,OAAO3vG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAMg8C,WAAWpwG,EAAI,GASlDquB,EAAMiiF,UAAY,WACd,OAAO5vG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAMg8C,WAAWhsG,EAAI,GASlDiqB,EAAMqiF,aAAe,WACjB,OAAOhwG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAMs8C,eAAiB,GASpDriF,EAAMsiF,aAAe,WACjB,OAAOjwG,KAAK0zD,MAAQ1zD,KAAK0zD,MAAMu8C,eAAiB,GASpDa,EAAWe,YAAc,EAQzBf,EAAWgB,MAAQ,EAOnBhB,EAAWiB,MAAQ,EAOnBjB,EAAWkB,MAAQ,EAOnBlB,EAAWmB,SAAW,EAWtB,IAAIC,EAAoB,SAAUtrE,EAAKktB,GACnCl0D,GAAG8uG,MAAMnsG,KAAKvC,KAAMJ,GAAG8uG,MAAMyD,aAAcr+C,GAC3C9zD,KAAK4mC,IAAMA,GAEfvoB,EAAGmE,OAAO0vF,EAAmBtyG,GAAG8uG,OAYhC,IAAI0D,EAAgB,SAAU/F,EAASgG,EAAWv+C,GAC9Cl0D,GAAG8uG,MAAMnsG,KAAKvC,KAAMJ,GAAG8uG,MAAM4D,SAAUx+C,GAevC9zD,KAAKqsG,QAAUA,EACfrsG,KAAKqyG,UAAYA,GAErBh0F,EAAGmE,OAAO4vF,EAAexyG,GAAG8uG,OAE5B9uG,GAAG8uG,MAAMF,WAAaA,EACtB5uG,GAAG8uG,MAAMoC,WAAaA,EACtBlxG,GAAG8uG,MAAMwD,kBAAoBA,EAC7BtyG,GAAG8uG,MAAM0D,cAAgBA,EAEzBjzG,EAAOE,QAAUO,GAAG8uG,kDCriBpB,IAAIrwF,EAAK3e,EAAQ,kBAyBjBE,GAAGo5D,cAAgB,SAAUtwC,EAAM6pF,EAAYpkF,GAC3CnuB,KAAKwyG,SAAWrkF,EAChBnuB,KAAKg0F,MAAQtrE,GAAQ,EACrB1oB,KAAKyyG,YAAcF,GAAc,GACjCvyG,KAAK0yG,aAAc,EAEnB1yG,KAAK2yG,eAAiB,EACtB3yG,KAAK4qC,MAAQ,KACb5qC,KAAKwtB,QAAU,KACfxtB,KAAK4gD,SAAU,EACf5gD,KAAK4yG,YAAa,GAGtBhzG,GAAGo5D,cAAc12D,WACbwc,YAAalf,GAAGo5D,cAchB65C,WAAY,SAAUzzF,GAClBpf,KAAK4gD,QAAUxhC,GAQnBuN,UAAW,WACP,OAAO3sB,KAAK4gD,SAQhBkyD,eAAgB,SAAUC,GACtB/yG,KAAK0yG,YAAcK,GAQvBC,cAAe,WACX,OAAOhzG,KAAK0yG,aAShBO,SAAU,WACN,OAAOjzG,KAAKg0F,OAShBkf,eAAgB,WACZ,OAAOlzG,KAAKyyG,aAShBU,kBAAmB,SAAUC,GACzBpzG,KAAK2yG,eAAiBS,GAQ1BC,kBAAmB,WACf,OAAOrzG,KAAK2yG,gBAQhBW,uBAAwB,SAAU7uE,GAC9BzkC,KAAKwtB,QAAUiX,EACfzkC,KAAK4qC,MAAQnG,GAQjB8uE,uBAAwB,WACpB,OAAOvzG,KAAK4qC,OAShB4oE,eAAgB,WACZ,OAAyB,OAAlBxzG,KAAKwyG,UAShBnyG,MAAO,WACH,OAAO,MAaXyhD,WAAY,SAASpzC,GACjB1O,KAAK4yG,WAAalkG,GAStB+kG,UAAW,WACP,OAAOzzG,KAAK4yG,YAiBhBxxG,OAAO,aAgBPC,QAAQ,cAYZzB,GAAGo5D,cAAc06C,QAAU,EAQ3B9zG,GAAGo5D,cAAcC,iBAAmB,EAQpCr5D,GAAGo5D,cAAc26C,kBAAoB,EAQrC/zG,GAAGo5D,cAAcs5C,SAAW,EAQ5B1yG,GAAGo5D,cAAcQ,MAAQ,EAQzB55D,GAAGo5D,cAAcm5C,aAAe,EAQhCvyG,GAAGo5D,cAAcukC,OAAS,EAE1B,IAAIqW,EAAah0G,GAAGo5D,cAAc46C,YAC9Bp6C,MAAO,aACPP,iBAAkB,wBAClB06C,kBAAmB,yBACnBrB,SAAU,gBACVH,aAAc,qBAGd0B,EAAS,SAAUC,EAAY3lF,GAC/BnuB,KAAK+zG,eAAiB5lF,EACtBvuB,GAAGo5D,cAAcz2D,KAAKvC,KAAMJ,GAAGo5D,cAAcukC,OAAQuW,EAAY9zG,KAAKmjE,YAE1E9kD,EAAGmE,OAAOqxF,EAAQj0G,GAAGo5D,eACrB36C,EAAG21F,MAAMH,EAAOvxG,WACZyxG,eAAgB,KAEhB5wC,UAAW,SAAUj3C,GACW,OAAxBlsB,KAAK+zG,gBACL/zG,KAAK+zG,eAAe7nF,IAG5BsnF,eAAgB,WACZ,OAAQ5zG,GAAGo5D,cAAc12D,UAAUkxG,eAAejxG,KAAKvC,OAAiC,OAAxBA,KAAK+zG,gBAGzE1zG,MAAO,WACH,OAAO,IAAIwzG,EAAO7zG,KAAKyyG,YAAazyG,KAAK+zG,mBAIjD,IAAIE,EAAQ,WACRr0G,GAAGo5D,cAAcz2D,KAAKvC,KAAMJ,GAAGo5D,cAAcQ,MAAOo6C,EAAWp6C,MAAOx5D,KAAKmjE,YAE/E9kD,EAAGmE,OAAOyxF,EAAOr0G,GAAGo5D,eACpB36C,EAAG21F,MAAMC,EAAM3xG,WACXm3D,YAAa,KACbE,UAAW,KACXD,YAAa,KACbE,cAAe,KAEfuJ,UAAW,SAAUj3C,GACjB,IAAIuiF,EAAY7uG,GAAG8uG,MAAMF,WACzB,OAAQtiF,EAAMyiF,YACV,KAAKF,EAAUyB,KACPlwG,KAAKy5D,aACLz5D,KAAKy5D,YAAYvtC,GACrB,MACJ,KAAKuiF,EAAU0B,GACPnwG,KAAK25D,WACL35D,KAAK25D,UAAUztC,GACnB,MACJ,KAAKuiF,EAAU2B,KACPpwG,KAAK05D,aACL15D,KAAK05D,YAAYxtC,GACrB,MACJ,KAAKuiF,EAAU4B,OACPrwG,KAAK45D,eACL55D,KAAK45D,cAAc1tC,KAOnC7rB,MAAO,WACH,IAAI6zG,EAAgB,IAAID,EAKxB,OAJAC,EAAcz6C,YAAcz5D,KAAKy5D,YACjCy6C,EAAcv6C,UAAY35D,KAAK25D,UAC/Bu6C,EAAcx6C,YAAc15D,KAAK05D,YACjCw6C,EAAct6C,cAAgB55D,KAAK45D,cAC5Bs6C,GAGXV,eAAgB,WACZ,OAAO,KAIf,IAAIW,EAAgB,WAChBv0G,GAAGo5D,cAAcz2D,KAAKvC,KAAMJ,GAAGo5D,cAAcC,iBAAkB26C,EAAW36C,iBAAkB,MAC5Fj5D,KAAKo0G,oBAET/1F,EAAGmE,OAAO2xF,EAAev0G,GAAGo5D,eAC5B36C,EAAG21F,MAAMG,EAAc7xG,WACnBwc,YAAaq1F,EACbC,gBAAiB,KACjBl7C,gBAAgB,EAChBC,aAAc,KACdC,aAAc,KACdC,aAAc,KACdC,iBAAkB,KAElB+6C,kBAAmB,SAAUC,GACzBt0G,KAAKk5D,eAAiBo7C,GAG1BC,iBAAkB,WACd,OAAOv0G,KAAKk5D,gBAGhB74D,MAAO,WACH,IAAI6zG,EAAgB,IAAIC,EAMxB,OALAD,EAAc/6C,aAAen5D,KAAKm5D,aAClC+6C,EAAc96C,aAAep5D,KAAKo5D,aAClC86C,EAAc76C,aAAer5D,KAAKq5D,aAClC66C,EAAc56C,iBAAmBt5D,KAAKs5D,iBACtC46C,EAAch7C,eAAiBl5D,KAAKk5D,eAC7Bg7C,GAGXV,eAAgB,WACZ,QAAIxzG,KAAKm5D,eACLv5D,GAAGgB,MAAM,OACF,MAMnB,IAAI4zG,EAAiB,WACjB50G,GAAGo5D,cAAcz2D,KAAKvC,KAAMJ,GAAGo5D,cAAc26C,kBAAmBC,EAAWD,kBAAmB,OAElGt1F,EAAGmE,OAAOgyF,EAAgB50G,GAAGo5D,eAC7B36C,EAAG21F,MAAMQ,EAAelyG,WACpBwc,YAAa01F,EACbC,eAAgB,KAChBC,eAAgB,KAChBC,eAAgB,KAChBC,mBAAoB,KAEpBv0G,MAAO,WACH,IAAI6zG,EAAgB,IAAIM,EAKxB,OAJAN,EAAcO,eAAiBz0G,KAAKy0G,eACpCP,EAAcQ,eAAiB10G,KAAK00G,eACpCR,EAAcS,eAAiB30G,KAAK20G,eACpCT,EAAcU,mBAAqB50G,KAAK40G,mBACjCV,GAGXV,eAAgB,WACZ,OAA4B,OAAxBxzG,KAAKy0G,gBAAmD,OAAxBz0G,KAAK00G,gBACV,OAAxB10G,KAAK20G,gBAAuD,OAA5B30G,KAAK40G,qBACxCh1G,GAAGgB,MAAM,OACF,MAOnB,IAAIi0G,EAAe,SAAU1mF,GACzBnuB,KAAK80G,qBAAuB3mF,EAC5BvuB,GAAGo5D,cAAcz2D,KAAKvC,KAAMJ,GAAGo5D,cAAcm5C,aAAcyB,EAAWzB,aAAcnyG,KAAKmjE,YAE7F9kD,EAAGmE,OAAOqyF,EAAcj1G,GAAGo5D,eAC3B36C,EAAG21F,MAAMa,EAAavyG,WAClBwc,YAAa+1F,EACbC,qBAAsB,KAEtB3xC,UAAW,SAAUj3C,GACjBlsB,KAAK80G,qBAAqB5oF,EAAM0a,IAAK1a,IAGzCsnF,eAAgB,WAGZ,OAFA5zG,GAAGygB,SAASrgB,KAAK80G,qBAAsB,OAEhC,GAGXz0G,MAAO,WACH,OAAO,IAAIw0G,EAAa70G,KAAK80G,yBAMrC,IAAIC,EAAW,WACXn1G,GAAGo5D,cAAcz2D,KAAKvC,KAAMJ,GAAGo5D,cAAcs5C,SAAUsB,EAAWtB,SAAUtyG,KAAKmjE,YAErF9kD,EAAGmE,OAAOuyF,EAAUn1G,GAAGo5D,eACvB36C,EAAG21F,MAAMe,EAASzyG,WACdwc,YAAai2F,EACbC,aAAc,KACdC,cAAe,KAEf9xC,UAAW,SAAUj3C,GACbA,EAAMmmF,UACFryG,KAAKg1G,cACLh1G,KAAKg1G,aAAa9oF,EAAMmgF,QAASngF,GAEjClsB,KAAKi1G,eACLj1G,KAAKi1G,cAAc/oF,EAAMmgF,QAASngF,IAI9C7rB,MAAO,WACH,IAAI6zG,EAAgB,IAAIa,EAGxB,OAFAb,EAAcc,aAAeh1G,KAAKg1G,aAClCd,EAAce,cAAgBj1G,KAAKi1G,cAC5Bf,GAGXV,eAAgB,WACZ,OAA0B,OAAtBxzG,KAAKg1G,cAAgD,OAAvBh1G,KAAKi1G,gBACnCr1G,GAAGgB,MAAM,OACF,MAmBnBhB,GAAGo5D,cAAclsB,OAAS,SAAUooE,GAChCt1G,GAAGygB,SAAS60F,GAAQA,EAAOhpF,MAAO,MAElC,IAAIipF,EAAeD,EAAOhpF,aACnBgpF,EAAOhpF,MAEd,IAAIsvC,EAAW,KAkBf,IAAI,IAAI9V,KAjBLyvD,IAAiBv1G,GAAGo5D,cAAcC,iBACjCuC,EAAW,IAAI24C,EACXgB,IAAiBv1G,GAAGo5D,cAAc26C,kBACtCn4C,EAAW,IAAIg5C,EACXW,IAAiBv1G,GAAGo5D,cAAcQ,MACtCgC,EAAW,IAAIy4C,EACXkB,IAAiBv1G,GAAGo5D,cAAcukC,QACtC/hC,EAAW,IAAIq4C,EAAOqB,EAAOE,UAAWF,EAAO/mF,iBACxC+mF,EAAOE,iBACPF,EAAO/mF,UACRgnF,IAAiBv1G,GAAGo5D,cAAcs5C,SACxC92C,EAAW,IAAIu5C,EACXI,IAAiBv1G,GAAGo5D,cAAcm5C,eACtC32C,EAAW,IAAIq5C,EAAaK,EAAO/mF,iBAC5B+mF,EAAO/mF,UAGH+mF,EACX15C,EAAS9V,GAAOwvD,EAAOxvD,GAE3B,OAAO8V,GAGXr8D,EAAOE,QAAUO,GAAGo5D,2DCrhBpB,IAAI36C,EAAK3e,EAAQ,kBACjBA,EAAQ,qBACR,IAAIk0G,EAAah0G,GAAGo5D,cAAc46C,WAE9ByB,EAAuB,WACvBr1G,KAAKs1G,mBACLt1G,KAAKu1G,wBACLv1G,KAAKw1G,SAAW,GAEpBH,EAAqB/yG,WACjBwc,YAAau2F,EACbpmE,KAAM,WACF,OAAOjvC,KAAKs1G,gBAAgB91G,OAASQ,KAAKu1G,qBAAqB/1G,QAGnEi2G,MAAO,WACH,OAAwC,IAAhCz1G,KAAKs1G,gBAAgB91G,QAAuD,IAArCQ,KAAKu1G,qBAAqB/1G,QAG7EkG,KAAM,SAAU81D,GACyB,IAAjCA,EAAS63C,oBACTrzG,KAAKu1G,qBAAqB7vG,KAAK81D,GAE/Bx7D,KAAKs1G,gBAAgB5vG,KAAK81D,IAGlCk6C,yBAA0B,WACtB11G,KAAKu1G,qBAAqB/1G,OAAS,GAGvCm2G,oBAAqB,WACjB31G,KAAKs1G,gBAAgB91G,OAAS,GAGlCokD,MAAO,WACH5jD,KAAKu1G,qBAAqB/1G,OAAS,EACnCQ,KAAKs1G,gBAAgB91G,OAAS,GAGlCo2G,0BAA2B,WACvB,OAAO51G,KAAKs1G,iBAGhBO,+BAAgC,WAC5B,OAAO71G,KAAKu1G,uBAIpB,IAkCI/0D,GAEAs1D,WAAY,EACZC,qBAAsB,EACtBC,2BAA4B,EAC5BC,UAAW,EAEXC,iBACAC,yBACAC,qBACAC,iBAAkBh4F,EAAGG,WAAU,GAC/B83F,wBACAC,qBACAC,uBACAC,eACAC,YAAa,EACb9D,YAAY,EACZ+D,mBAAoB,EAEpBC,8BAEAz/C,iBAAkB,SAAU1yB,GAKxB,QAHyCp+B,IAArCrG,KAAKo2G,kBAAkB3xE,EAAK7kB,MAC5B5f,KAAKy2G,YAAY/wG,KAAK++B,GAEtBA,EAAKoyE,YAEL,IADA,IAAI5/C,EAAYxyB,EAAKoyE,cACbt3G,EAAI,EAAGwuB,EAAMkpC,EAAYA,EAAUz3D,OAAS,EAAGD,EAAIwuB,EAAKxuB,IAC5DS,KAAKm3D,iBAAiBF,EAAU13D,KAW5CmhB,YAAa,SAAU+jB,EAAM42B,GACzB,GAAM52B,aAAgB7kC,GAAGk3G,UAAzB,CAIA,IAAkDv3G,EAAGwuB,EAAjDksC,EAAYj6D,KAAKo2G,kBAAkB3xE,EAAK7kB,KAC5C,GAAIq6C,EACA,IAAK16D,EAAI,EAAGwuB,EAAMksC,EAAUz6D,OAAQD,EAAIwuB,EAAKxuB,IACzC06D,EAAU16D,GAAGszG,YAAW,GAEhC,IAAkB,IAAdx3C,EAAoB,CACpB,IAAIqF,EAAcj8B,EAAKoyE,cACvB,IAAKt3G,EAAI,EAAGwuB,EAAM2yC,EAAcA,EAAYlhE,OAAS,EAAGD,EAAIwuB,EAAKxuB,IAC7DS,KAAK0gB,YAAYggD,EAAYnhE,IAAI,SAXrCK,GAAGu+B,OAAO,OAsBlBxd,aAAc,SAAU8jB,EAAM42B,GAC1B,GAAM52B,aAAgB7kC,GAAGk3G,UAAzB,CAIA,IAAkDv3G,EAAGwuB,EAAjDksC,EAAYj6D,KAAKo2G,kBAAkB3xE,EAAK7kB,KAC5C,GAAIq6C,EACA,IAAM16D,EAAI,EAAGwuB,EAAMksC,EAAUz6D,OAAQD,EAAIwuB,EAAKxuB,IAC1C06D,EAAU16D,GAAGszG,YAAW,GAGhC,GADA7yG,KAAKm3D,iBAAiB1yB,IACJ,IAAd42B,GAAsB52B,EAAKoyE,YAAa,CACxC,IAAIn2C,EAAcj8B,EAAKoyE,cACvB,IAAKt3G,EAAI,EAAGwuB,EAAM2yC,EAAcA,EAAYlhE,OAAS,EAAGD,EAAIwuB,EAAKxuB,IAC7DS,KAAK2gB,aAAa+/C,EAAYnhE,IAAI,SAZtCK,GAAGu+B,OAAO,OAgBlB44E,aAAc,SAAUv7C,GACK,IAArBx7D,KAAK02G,YACL12G,KAAKg3G,uBAAuBx7C,GAE5Bx7D,KAAKu2G,kBAAkB7wG,KAAK81D,IAGpCw7C,uBAAwB,SAAUx7C,GAC9B,IAAI+2C,EAAa/2C,EAAS03C,iBACtBj5C,EAAYj6D,KAAKk2G,cAAc3D,GAOnC,GANKt4C,IACDA,EAAY,IAAIo7C,EAChBr1G,KAAKk2G,cAAc3D,GAAct4C,GAErCA,EAAUv0D,KAAK81D,GAEsB,IAAjCA,EAAS63C,oBAA2B,CACpCrzG,KAAKi3G,UAAU1E,EAAYvyG,KAAKg2G,4BAEhC,IAAIvxE,EAAO+2B,EAAS+3C,yBACP,OAAT9uE,GACA7kC,GAAGgB,MAAM,MAEbZ,KAAKk3G,+BAA+BzyE,EAAM+2B,GACtC/2B,EAAKz/B,mBACLhF,KAAK2gB,aAAa8jB,QAEtBzkC,KAAKi3G,UAAU1E,EAAYvyG,KAAK+1G,uBAGxCoB,cAAe,SAAU5E,GACrB,OAAOvyG,KAAKk2G,cAAc3D,IAG9B6E,8BAA+B,WAC3B,GAAgC,IAA5Bp3G,KAAKy2G,YAAYj3G,OAArB,CAIA,IADA,IAAsC63G,EAAcC,EAAhDC,EAAgBv3G,KAAKy2G,YAAwCe,EAAsBx3G,KAAKo2G,kBACnF72G,EAAI,EAAGwuB,EAAMwpF,EAAc/3G,OAAQD,EAAIwuB,EAAKxuB,IAEjD,GADA83G,EAAeG,EAAoBD,EAAch4G,GAAGqgB,KAEhD,IAAK,IAAIwM,EAAI,EAAGqrF,EAAeJ,EAAa73G,OAAQ4sB,EAAIqrF,EAAcrrF,KAClEkrF,EAAcD,EAAajrF,KAEvBpsB,KAAKi3G,UAAUK,EAAYpE,iBAAkBlzG,KAAKg2G,4BAIlEh2G,KAAKy2G,YAAYj3G,OAAS,IAG9Bk4G,4BAA6B,SAAUC,GACnC,GAAKA,EAGL,IADA,IAAIL,EACK/3G,EAAI,EAAGA,EAAIo4G,EAAen4G,SAC/B83G,EAAcK,EAAep4G,IACjBuzG,gBAAe,GACiB,MAAxCwE,EAAY/D,2BACZvzG,KAAK43G,gCAAgCN,EAAY/D,yBAA0B+D,GAC3EA,EAAYhE,uBAAuB,OAGd,IAArBtzG,KAAK02G,YACL92G,GAAGye,GAAGiE,MAAMymC,OAAO4uD,EAAgBL,KAEjC/3G,GAIds4G,8BAA+B,SAAUtF,GACrC,IAAgDhzG,EAA5C06D,EAAYj6D,KAAKk2G,cAAc3D,GACnC,GAAIt4C,EAAW,CACX,IAAI69C,EAAyB79C,EAAU27C,4BACnCmC,EAA8B99C,EAAU47C,iCAE5C71G,KAAK03G,4BAA4BK,GACjC/3G,KAAK03G,4BAA4BI,UAI1B93G,KAAKm2G,sBAAsB5D,GAE7BvyG,KAAK02G,cACNz8C,EAAUrW,eACH5jD,KAAKk2G,cAAc3D,IAIlC,IAAkD/2C,EAA9Cw8C,EAAsBh4G,KAAKu2G,kBAC/B,IAAKh3G,EAAI,EAAGA,EAAIy4G,EAAoBx4G,SAChCg8D,EAAWw8C,EAAoBz4G,KACfi8D,EAAS03C,mBAAqBX,EAC1C3yG,GAAGye,GAAGiE,MAAMymC,OAAOivD,EAAqBx8C,KAEtCj8D,GAId04G,oBAAqB,SAAU1F,GAC3B,IAAIp0C,EAAYn+D,KAAK81G,WAAYoC,EAAal4G,KAAKm2G,sBAInD,GAHI+B,EAAW3F,KACXp0C,EAAY+5C,EAAW3F,IAEvBp0C,IAAcn+D,KAAK81G,aAEnBoC,EAAW3F,GAAcvyG,KAAK81G,WAE1B33C,EAAYn+D,KAAK+1G,sBACjB/1G,KAAKm4G,8BAA8B5F,GAEnCp0C,EAAYn+D,KAAKg2G,4BAA2B,CAC5C,IAAIoC,EAAax4G,GAAG+e,SAASq5B,WAC1BogE,GACCp4G,KAAKq4G,mCAAmC9F,EAAY6F,KAKpEC,mCAAoC,SAAU9F,EAAY+F,GACtD,IAAIr+C,EAAYj6D,KAAKm3G,cAAc5E,GACnC,GAAKt4C,EAAL,CAGA,IAAIs+C,EAAqBt+C,EAAU47C,iCAC9B0C,GAAoD,IAA9BA,EAAmB/4G,SAI9CQ,KAAK22G,mBAAqB,EAC1B32G,KAAKq2G,iBAAmBh4F,EAAGG,WAAU,GAErCxe,KAAKw4G,aAAaF,GAAU,GAG5Br+C,EAAU47C,iCAAiCt9D,KAAKv4C,KAAKy4G,+CAGzDA,2CAA4C,SAAUC,EAAIrjF,GACtD,IAAIsjF,EAAqBn4D,EAAa61D,iBAClCuC,EAAQF,EAAGnF,yBACXsF,EAAQxjF,EAAGk+E,yBACf,OAAKl+E,GAAOwjF,GAAUF,EAAmBE,EAAMj5F,KAErC84F,GAAOE,GAAUD,EAAmBC,EAAMh5F,KAE7C+4F,EAAmBE,EAAMj5F,KAAO+4F,EAAmBC,EAAMh5F,KADrD,GAFC,GAMhBu4F,8BAA+B,SAAU5F,GACrC,IAAIt4C,EAAYj6D,KAAKk2G,cAAc3D,GACnC,GAAKt4C,EAAL,CAGA,IAAI6+C,EAAiB7+C,EAAU27C,4BAC/B,GAAIkD,GAA4C,IAA1BA,EAAet5G,OAArC,CAGAs5G,EAAevgE,KAAKv4C,KAAK+4G,kCAIzB,IADA,IAAI13F,EAAQ,EACH0M,EAAM+qF,EAAet5G,OAAQ6hB,EAAQ0M,KACtC+qF,EAAez3F,GAAOgyF,qBAAuB,MAE/ChyF,EAEN44C,EAAUu7C,SAAWn0F,KAGzB03F,iCAAkC,SAAUL,EAAIrjF,GAC5C,OAAOqjF,EAAGrF,oBAAsBh+E,EAAGg+E,qBAGvC2F,mBAAoB,SAAU/+C,GAC1B,IAEI16D,EAAG+3G,EAAaxgE,EAFhBghE,EAAyB79C,EAAU27C,4BACnCmC,EAA8B99C,EAAU47C,iCACnBoD,EAAqBj5G,KAAKw2G,oBAEnD,GAAIuB,EACA,IAAKx4G,EAAI,EAAGA,EAAIw4G,EAA4Bv4G,SACxC83G,EAAcS,EAA4Bx4G,IACzByzG,kBAOXzzG,GANFK,GAAGye,GAAGiE,MAAMymC,OAAOgvD,EAA6BT,IAGpC,KADZxgE,EAAMmiE,EAAmBt1F,QAAQ2zF,KAE7B2B,EAAmB94F,OAAO22B,EAAK,IAM/C,GAAIghE,EACA,IAAKv4G,EAAI,EAAGA,EAAIu4G,EAAuBt4G,SACnC83G,EAAcQ,EAAuBv4G,IACpByzG,kBAQXzzG,GAPFK,GAAGye,GAAGiE,MAAMymC,OAAO+uD,EAAwBR,IAG/B,KADZxgE,EAAMmiE,EAAmBt1F,QAAQ2zF,KAE7B2B,EAAmB94F,OAAO22B,EAAK,IAO3CihE,GAAsE,IAAvCA,EAA4Bv4G,QAC3Dy6D,EAAUy7C,2BAEVoC,GAA4D,IAAlCA,EAAuBt4G,QACjDy6D,EAAU07C,uBAGlB/sD,qBAAsB,WAClB,IAAIswD,EAAkBl5G,KAAKk2G,cAAeiD,EAA0Bn5G,KAAKm2G,sBACzE,IAAK,IAAIiD,KAAUF,EACXA,EAAgBE,GAAQ3D,iBACjB0D,EAAwBC,UACxBF,EAAgBE,IAI/B,IAAIpB,EAAsBh4G,KAAKu2G,kBAC/B,GAAmC,IAA/ByB,EAAoBx4G,OAAc,CAClC,IAAK,IAAID,EAAI,EAAGwuB,EAAMiqF,EAAoBx4G,OAAQD,EAAIwuB,EAAKxuB,IACvDS,KAAKg3G,uBAAuBgB,EAAoBz4G,IACpDy4G,EAAoBx4G,OAAS,EAEO,IAApCQ,KAAKw2G,oBAAoBh3G,QACzBQ,KAAKq5G,4BAIbC,sBAAuB,SAAUptF,GAC7B,IAAIqtF,EAAgBv5G,KAAK02G,YAGzB,GAFA92G,GAAGygB,SAASk5F,EAAgB,EAAG,QAE3BA,EAAgB,GAApB,CAGA,IAAIt/C,GACJA,EAAYj6D,KAAKk2G,cAActC,EAAW36C,oBAEtCj5D,KAAKg5G,mBAAmB/+C,IAE5BA,EAAYj6D,KAAKk2G,cAActC,EAAWD,qBAEtC3zG,KAAKg5G,mBAAmB/+C,GAG5Br6D,GAAGygB,SAA2B,IAAlBk5F,EAAqB,MAEjC,IAAIvB,EAAsBh4G,KAAKu2G,kBAC/B,GAAmC,IAA/ByB,EAAoBx4G,OAAc,CAClC,IAAK,IAAID,EAAI,EAAGwuB,EAAMiqF,EAAoBx4G,OAAQD,EAAIwuB,EAAKxuB,IACvDS,KAAKg3G,uBAAuBgB,EAAoBz4G,IACpDS,KAAKu2G,kBAAkB/2G,OAAS,EAGI,IAApCQ,KAAKw2G,oBAAoBh3G,QACzBQ,KAAKq5G,6BAKbA,yBAA0B,WAEtB,IADA,IAAIJ,EAAqBj5G,KAAKw2G,oBACrBj3G,EAAI,EAAGA,EAAI05G,EAAmBz5G,OAAQD,IAAK,CAChD,IAAI+3G,EAAc2B,EAAmB15G,GACjC06D,EAAYj6D,KAAKk2G,cAAcoB,EAAYpE,kBAC/C,GAAKj5C,EAAL,CAGA,IAAInjB,EAAKghE,EAAyB79C,EAAU27C,4BACxCmC,EAA8B99C,EAAU47C,iCAExCkC,IAEa,KADbjhE,EAAMihE,EAA4Bp0F,QAAQ2zF,KAEtCS,EAA4B53F,OAAO22B,EAAK,GAG5CghE,IAEa,KADbhhE,EAAMghE,EAAuBn0F,QAAQ2zF,KAEjCQ,EAAuB33F,OAAO22B,EAAK,IAI/CmiE,EAAmBz5G,OAAS,GAGhCg6G,sBAAuB,SAAUh+C,EAAUi+C,GAEvC,IAAKj+C,EAASw3C,gBACV,OAAO,EAEX,IAAI9mF,EAAQutF,EAAQvtF,MAAOwtF,EAAWxtF,EAAMilF,aAC5CjlF,EAAM6uC,cAAgBS,EAAS5wB,MAE/B,IAAuB+uE,EAAnBC,GAAY,EACZC,EAAU3tF,EAAMklF,eAAgBN,EAAalxG,GAAG8uG,MAAMoC,WA0B1D,OAzBI+I,IAAY/I,EAAWgB,MACnBt2C,EAASrC,eACTygD,EAAYp+C,EAASrC,aAAaugD,EAAUxtF,KAC3BsvC,EAASk3C,aACtBl3C,EAAS44C,gBAAgB1uG,KAAKg0G,GAE/Bl+C,EAAS44C,gBAAgB50G,OAAS,IAC0B,KAA9Dm6G,EAAan+C,EAAS44C,gBAAgBzwF,QAAQ+1F,MACnDE,GAAY,EACRC,IAAY/I,EAAWiB,OAASv2C,EAASpC,aACzCoC,EAASpC,aAAasgD,EAAUxtF,GACzB2tF,IAAY/I,EAAWkB,OAC1Bx2C,EAASnC,cACTmC,EAASnC,aAAaqgD,EAAUxtF,GAChCsvC,EAASk3C,aACTl3C,EAAS44C,gBAAgBj0F,OAAOw5F,EAAY,IACzCE,IAAY/I,EAAWgJ,YAC1Bt+C,EAASlC,kBACTkC,EAASlC,iBAAiBogD,EAAUxtF,GACpCsvC,EAASk3C,aACTl3C,EAAS44C,gBAAgBj0F,OAAOw5F,EAAY,KAKpDztF,EAAM6tF,aACNv5D,EAAa84D,sBAAsBptF,IAC5B,MAGP0tF,IAAap+C,EAAStC,kBAClBugD,EAAQO,iBACRP,EAAQhI,QAAQtxF,OAAOu5F,EAAU,IAC9B,IAKfO,oBAAqB,SAAU/tF,GAC3BlsB,KAAKi4G,oBAAoBrE,EAAW36C,kBACpCj5D,KAAKi4G,oBAAoBrE,EAAWD,mBAEpC,IAAIuG,EAAoBl6G,KAAKm3G,cAAcvD,EAAW36C,kBAClDkhD,EAAqBn6G,KAAKm3G,cAAcvD,EAAWD,mBAGvD,GAAI,OAASuG,GAAqB,OAASC,EAA3C,CAGA,IAAIC,EAAkBluF,EAAMmlF,aAAcgJ,EAAiBz6G,GAAGye,GAAGiE,MAAM4xB,KAAKkmE,GACxEE,GAAmBpuF,MAAOA,EAAO8tF,gBAAkBE,GAAqBC,EAAqB1I,QAAS4I,EAAgBX,SAAU,MAKpI,GAAIQ,EACA,IAAK,IAAI36G,EAAI,EAAGA,EAAI66G,EAAgB56G,OAAQD,IACxC2sB,EAAMilF,aAAeiJ,EAAgB76G,GACrC2sB,EAAM8uC,oBAAsB9uC,EAAM+uC,8BAA+B,EACjEj7D,KAAKu6G,0BAA0BL,EAAmBl6G,KAAKw5G,sBAAuBc,GAOlFH,GAAsBE,EAAe76G,OAAS,IAC9CQ,KAAKu6G,0BAA0BJ,EAAoBn6G,KAAKw6G,yBAA0BtuF,MAAOA,EAAOulF,QAAS4I,IACrGnuF,EAAM6tF,cAGd/5G,KAAKs5G,sBAAsBptF,KAG/BsuF,wBAAyB,SAAUh/C,EAAUi/C,GAEzC,IAAKj/C,EAASk3C,YACV,OAAO,EAEX,IAAI5B,EAAalxG,GAAG8uG,MAAMoC,WAAY5kF,EAAQuuF,EAAevuF,MAAOulF,EAAUgJ,EAAehJ,QAASoI,EAAU3tF,EAAMklF,eAYtH,OAXAllF,EAAM6uC,cAAgBS,EAAS5wB,MAC3BivE,IAAY/I,EAAWgB,OAASt2C,EAASi5C,eACzCj5C,EAASi5C,eAAehD,EAASvlF,GAC5B2tF,IAAY/I,EAAWiB,OAASv2C,EAASk5C,eAC9Cl5C,EAASk5C,eAAejD,EAASvlF,GAC5B2tF,IAAY/I,EAAWkB,OAASx2C,EAASm5C,eAC9Cn5C,EAASm5C,eAAelD,EAASvlF,GAC5B2tF,IAAY/I,EAAWgJ,WAAat+C,EAASo5C,oBAClDp5C,EAASo5C,mBAAmBnD,EAASvlF,KAGrCA,EAAM6tF,cACNv5D,EAAa84D,sBAAsBptF,IAC5B,IAKfgrF,+BAAgC,SAAUzyE,EAAM+2B,GAC5C,IAAIvB,EAAYj6D,KAAKo2G,kBAAkB3xE,EAAK7kB,KACvCq6C,IACDA,KACAj6D,KAAKo2G,kBAAkB3xE,EAAK7kB,KAAOq6C,GAEvCA,EAAUv0D,KAAK81D,IAGnBo8C,gCAAiC,SAAUnzE,EAAM+2B,GAC7C,IAAIvB,EAAYj6D,KAAKo2G,kBAAkB3xE,EAAK7kB,KACxCq6C,IACAr6D,GAAGye,GAAGiE,MAAMymC,OAAOkR,EAAWuB,GACL,IAArBvB,EAAUz6D,eACHQ,KAAKo2G,kBAAkB3xE,EAAK7kB,OAI/C26F,0BAA2B,SAAUtgD,EAAWygD,EAASC,GACrD,IAIWvuF,EAAGkrF,EAJVsD,GAAwB,EACxB9C,EAAyB79C,EAAU27C,4BACnCmC,EAA8B99C,EAAU47C,iCAExCt2G,EAAI,EACR,GAAIu4G,GACsC,IAAlCA,EAAuBt4G,OACvB,KAAOD,EAAI06D,EAAUu7C,WAAYj2G,EAE7B,IADA+3G,EAAcQ,EAAuBv4G,IACrBk0G,cAAgB6D,EAAY3qF,aAAe2qF,EAAYtE,iBAAmB0H,EAAQpD,EAAaqD,GAAc,CACzHC,GAAwB,EACxB,MAMhB,GAAI7C,IAAgC6C,EAChC,IAAKxuF,EAAI,EAAGA,EAAI2rF,EAA4Bv4G,OAAQ4sB,IAEhD,IADAkrF,EAAcS,EAA4B3rF,IAC1BqnF,cAAgB6D,EAAY3qF,aAAe2qF,EAAYtE,iBAAmB0H,EAAQpD,EAAaqD,GAAc,CACzHC,GAAwB,EACxB,MAKZ,GAAI9C,IAA2B8C,EAC3B,KAAOr7G,EAAIu4G,EAAuBt4G,SAAUD,EAExC,IADA+3G,EAAcQ,EAAuBv4G,IACrBk0G,cAAgB6D,EAAY3qF,aAAe2qF,EAAYtE,iBAAmB0H,EAAQpD,EAAaqD,GAAc,CACzHC,GAAwB,EACxB,QAMhB3D,UAAW,SAAU1E,EAAYnzC,GAC7B,IAAIy7C,EAAkB76G,KAAKm2G,sBACQ,MAA/B0E,EAAgBtI,GAChBsI,EAAgBtI,GAAcnzC,EAE9By7C,EAAgBtI,GAAcnzC,EAAOy7C,EAAgBtI,IAG7DiG,aAAc,SAAU/zE,EAAMq2E,GAEtBr2E,EAAKgyB,oBACLhyB,EAAKgzB,kBAET,IAUQkJ,EAVJj8B,EAAWD,EAAKoyE,cAAet3G,EAAI,EACnCw7G,EAAgBr2E,EAASllC,OAAQw7G,EAAyBh7G,KAAKs2G,qBAAsBkB,EAAsBx3G,KAAKo2G,kBAEpH,GAAI2E,EAAgB,EAQhB,SAPsC10G,IAAlCmxG,EAAoB/yE,EAAK7kB,OACpBo7F,IACDA,MACJA,EAAuBt1G,KAAK++B,EAAK7kB,MAI9BrgB,EAAIw7G,EAAex7G,KACtBohE,EAAQj8B,EAASnlC,KAEbS,KAAKw4G,aAAa73C,GAAO,aAGKt6D,IAAlCmxG,EAAoB/yE,EAAK7kB,OACpBo7F,IACDA,MACJA,EAAuBt1G,KAAK++B,EAAK7kB,MAIzC,GAAIk7F,EAAY,CAEZ,IADA,IAAInC,EAAqB34G,KAAKq2G,iBACrBjqF,EAAI,EAAGA,EAAI4uF,EAAuBx7G,OAAQ4sB,IAC/CusF,EAAmBqC,EAAuB5uF,MAAQpsB,KAAK22G,mBAC3D32G,KAAKs2G,qBAAqB92G,OAAS,IAI3Cy7G,eAAgB,SAAUlyG,EAAGmD,GACzB,OAAOnD,EAAImD,GAUfwiB,iBAAkB,SAAU6jF,GACxB,QAASvyG,KAAKm3G,cAAc5E,IA0BhCh5C,YAAa,SAAUiC,EAAU0/C,GAE7B,GADAt7G,GAAGygB,SAASm7C,GAAY0/C,EAAgB,MAClCt7G,GAAGye,GAAG0L,SAASmxF,IAAmBA,aAA0Bt7G,GAAGk3G,UAArE,CAIA,GAAMt7C,aAAoB57D,GAAGo5D,eAIzB,GAAIwC,EAASw3C,gBAET,YADApzG,GAAGgB,MAAM,WAJbhB,GAAGygB,UAAUzgB,GAAGye,GAAG0L,SAASmxF,GAAiB,MAC7C1/C,EAAW57D,GAAGo5D,cAAclsB,OAAO0uB,GAQvC,GAAKA,EAASg4C,iBAAd,CAGA,GAAI5zG,GAAGye,GAAG0L,SAASmxF,GAAiB,CAChC,GAAuB,IAAnBA,EAEA,YADAt7G,GAAGgB,MAAM,MAIb46D,EAAS83C,uBAAuB,MAChC93C,EAAS23C,kBAAkB+H,GAC3B1/C,EAASs3C,gBAAe,GACxBt3C,EAASq3C,YAAW,GACpB7yG,KAAK+2G,aAAav7C,QAElBA,EAAS83C,uBAAuB4H,GAChC1/C,EAAS23C,kBAAkB,GAC3B33C,EAASs3C,gBAAe,GACxB9yG,KAAK+2G,aAAav7C,GAGtB,OAAOA,QAlCH57D,GAAGu+B,OAAO,OA6ClBg9E,kBAAmB,SAAU/F,EAAWjnF,GACpC,IAAIqtC,EAAW,IAAI57D,GAAGo5D,cAAclsB,QAChC5gB,MAAOtsB,GAAGo5D,cAAcukC,OACxB6X,UAAWA,EACXjnF,SAAUA,IAGd,OADAnuB,KAAKu5D,YAAYiC,EAAU,GACpBA,GAUXhB,eAAgB,SAAUgB,GACtB,GAAgB,MAAZA,EAAJ,CAGA,IAAI4/C,EAASC,EAAcr7G,KAAKk2G,cAChC,IAAK,IAAIkD,KAAUiC,EAAa,CAC5B,IAAIphD,EAAYohD,EAAYjC,GACxBtB,EAAyB79C,EAAU27C,4BAA6BmC,EAA8B99C,EAAU47C,iCAiB5G,IAfAuF,EAAUp7G,KAAKs7G,wBAAwBvD,EAA6Bv8C,IAGhEx7D,KAAKi3G,UAAUz7C,EAAS03C,iBAAkBlzG,KAAKg2G,6BAE/CoF,EAAUp7G,KAAKs7G,wBAAwBxD,EAAwBt8C,KAE3Dx7D,KAAKi3G,UAAUz7C,EAAS03C,iBAAkBlzG,KAAK+1G,sBAGnD97C,EAAUw7C,iBACHz1G,KAAKm2G,sBAAsB36C,EAAS03C,yBACpCmI,EAAYjC,IAGnBgC,EACA,MAGR,IAAKA,EAED,IADA,IAAIpD,EAAsBh4G,KAAKu2G,kBACtBh3G,EAAI,EAAGwuB,EAAMiqF,EAAoBx4G,OAAQD,EAAIwuB,EAAKxuB,IAAK,CAC5D,IAAI+3G,EAAcU,EAAoBz4G,GACtC,GAAI+3G,IAAgB97C,EAAU,CAC1B57D,GAAGye,GAAGiE,MAAMymC,OAAOivD,EAAqBV,GACxCA,EAAYxE,gBAAe,GAC3B,UAMhByI,0BAA2B,SAASthD,EAAW9rC,GAC3C,GAAiB,MAAb8rC,EACA,OAAO,EAEX,IAAK,IAAI16D,EAAI,EAAGwuB,EAAMksC,EAAUz6D,OAAQD,EAAIwuB,EAAKxuB,IAAK,CAClD,IAAI+3G,EAAcr9C,EAAU16D,GAC5B,GAAI+3G,EAAYvD,iBAAmB5lF,GAAYmpF,EAAY9E,WAAarkF,EAWpE,OAVAmpF,EAAYxE,gBAAe,GACiB,MAAxCwE,EAAY/D,2BACZvzG,KAAK43G,gCAAgCN,EAAY/D,yBAA0B+D,GAC3EA,EAAYhE,uBAAuB,OAGd,IAArBtzG,KAAK02G,YACL92G,GAAGye,GAAGiE,MAAMymC,OAAOkR,EAAWq9C,GAE9Bt3G,KAAKw2G,oBAAoB9wG,KAAK4xG,IAC3B,EAGf,OAAO,GAGXgE,wBAAyB,SAAUrhD,EAAWuB,GAC1C,GAAiB,MAAbvB,EACA,OAAO,EAEX,IAAK,IAAI16D,EAAI,EAAGwuB,EAAMksC,EAAUz6D,OAAQD,EAAIwuB,EAAKxuB,IAAK,CAClD,IAAI+3G,EAAcr9C,EAAU16D,GAC5B,GAAI+3G,IAAgB97C,EAWhB,OAVA87C,EAAYxE,gBAAe,GACiB,MAAxCwE,EAAY/D,2BACZvzG,KAAK43G,gCAAgCN,EAAY/D,yBAA0B+D,GAC3EA,EAAYhE,uBAAuB,OAGd,IAArBtzG,KAAK02G,YACL92G,GAAGye,GAAGiE,MAAMymC,OAAOkR,EAAWq9C,GAE9Bt3G,KAAKw2G,oBAAoB9wG,KAAK4xG,IAC3B,EAGf,OAAO,GAqBXhgD,gBAAiB,SAAU69C,EAAc95C,GACrC,IAAOqH,EAAK1iE,KACZ,GAAMJ,GAAGye,GAAG0L,SAASorF,IAAiBA,aAAwBv1G,GAAGk3G,UAIjE,QAAyBzwG,IAArB8uG,EAAav1F,IAAmB,QAGzB8iD,EAAG2zC,iBAAiBlB,EAAav1F,KACxChgB,GAAGye,GAAGiE,MAAMymC,OAAO2Z,EAAG+zC,YAAatB,GACnC,IAAwD51G,EAApD06D,EAAYyI,EAAG0zC,kBAAkBjB,EAAav1F,KAClD,GAAIq6C,EAAW,CACX,IAAIuhD,EAAgB57G,GAAGye,GAAGiE,MAAM4xB,KAAK+lB,GACrC,IAAK16D,EAAI,EAAGA,EAAIi8G,EAAch8G,OAAQD,IAClCmjE,EAAGlI,eAAeghD,EAAcj8G,WAC7BmjE,EAAG0zC,kBAAkBjB,EAAav1F,KAQ7C,IAAIo4F,EAAsBt1C,EAAG6zC,kBAC7B,IAAKh3G,EAAI,EAAGA,EAAIy4G,EAAoBx4G,QAAU,CAC1C,IAAIg8D,EAAWw8C,EAAoBz4G,GAC/Bi8D,EAAS+3C,2BAA6B4B,GACtC35C,EAAS83C,uBAAuB,MAChC93C,EAASs3C,gBAAe,GACxBkF,EAAoB73F,OAAO5gB,EAAG,MAE5BA,EAGV,IAAkB,IAAd87D,EAAoB,CACpB,IAA8CttC,EAA1C2yC,EAAcy0C,EAAa0B,cAC/B,IAAKt3G,EAAI,EAAGwuB,EAAM2yC,EAAYlhE,OAAQD,EAAGwuB,EAAKxuB,IAC1CmjE,EAAGpL,gBAAgBoJ,EAAYnhE,IAAI,SAGvC41G,IAAiBv1G,GAAGo5D,cAAcC,iBAClCyJ,EAAGm1C,8BAA8BjE,EAAW36C,kBACvCk8C,IAAiBv1G,GAAGo5D,cAAc26C,kBACvCjxC,EAAGm1C,8BAA8BjE,EAAWD,mBACvCwB,IAAiBv1G,GAAGo5D,cAAcQ,MACvCkJ,EAAGm1C,8BAA8BjE,EAAWp6C,OACvC27C,IAAiBv1G,GAAGo5D,cAAcm5C,aACvCzvC,EAAGm1C,8BAA8BjE,EAAWzB,cACvCgD,IAAiBv1G,GAAGo5D,cAAcs5C,SACvC5vC,EAAGm1C,8BAA8BjE,EAAWtB,UAE5C1yG,GAAGgB,MAAM,WAjDbhB,GAAGu+B,OAAO,OA2DlBs9E,sBAAuB,SAAUC,GAC7B17G,KAAK63G,8BAA8B6D,IAQvCC,mBAAoB,WAChB,IAAIC,EAAe57G,KAAKk2G,cAAe2F,EAA4B77G,KAAK42G,2BACxE,IAAK,IAAIwC,KAAUwC,GACmC,IAA/CC,EAA0Bl4F,QAAQy1F,IACjCp5G,KAAK63G,8BAA8BuB,IAW/C0C,YAAa,SAAUtgD,EAAU43C,GAC7B,GAAgB,MAAZ53C,EAAJ,CAGA,IAAIogD,EAAe57G,KAAKk2G,cACxB,IAAK,IAAIkD,KAAUwC,EAAc,CAC7B,IACI9D,EADe8D,EAAaxC,GACUxD,4BAC1C,GAAIkC,EAEA,IAAe,IADHA,EAAuBn0F,QAAQ63C,GAQvC,OANwC,MAArCA,EAAS+3C,0BACR3zG,GAAGgB,MAAM,WACT46D,EAAS63C,sBAAwBD,IACjC53C,EAAS23C,kBAAkBC,GAC3BpzG,KAAKi3G,UAAUz7C,EAAS03C,iBAAkBlzG,KAAK+1G,2BAcnEj0D,WAAY,SAAUpzC,GAClB1O,KAAK4yG,WAAalkG,GAStB+kG,UAAW,WACP,OAAOzzG,KAAK4yG,YAShB7+C,cAAe,SAAU7nC,GACrB,GAAKlsB,KAAK4yG,WAKV,GAFA5yG,KAAKo3G,gCACLp3G,KAAK02G,cACAxqF,GAAUA,EAAM6vF,QAArB,CAIA,GAAI7vF,EAAM6vF,UAAUj2D,WAAWlmD,GAAG8uG,MAAMsC,OAGpC,OAFAhxG,KAAKi6G,oBAAoB/tF,QACzBlsB,KAAK02G,cAIT,IAAInE,EAp9BU,SAAUrmF,GAC5B,IAAIuiF,EAAY7uG,GAAG8uG,MAAOhmF,EAAOwD,EAAMxD,KACvC,OAAIA,IAAS+lF,EAAU0D,aACZyB,EAAWzB,aAClBzpF,IAAS+lF,EAAU6D,SACZsB,EAAWtB,SAClB5pF,EAAKo9B,WAAW2oD,EAAUj1C,OACnBo6C,EAAWp6C,OAClB9wC,EAAKo9B,WAAW2oD,EAAUuC,QAG1BpxG,GAAGgB,MAAM,KAEN,IAu8Bco7G,CAAgB9vF,GACjClsB,KAAKi4G,oBAAoB1F,GACzB,IAAI8E,EAAer3G,KAAKk2G,cAAc3D,GAClB,MAAhB8E,IACAr3G,KAAKu6G,0BAA0BlD,EAAcr3G,KAAKi8G,oBAAqB/vF,GACvElsB,KAAKg5G,mBAAmB3B,IAG5Br3G,KAAK02G,mBAjBD92G,GAAGyC,QAAQ,OAoBnB45G,oBAAqB,SAASzgD,EAAUtvC,GAGpC,OAFAA,EAAM6uC,cAAgBS,EAAShuC,QAC/BguC,EAASg3C,SAAStmF,GACXA,EAAM6tF,aAUjBmC,oBAAqB,SAAU9G,EAAW+G,GACtC,IAAIC,EAAK,IAAIx8G,GAAG8uG,MAAM2N,YAAYjH,GAClCgH,EAAGE,YAAYH,GACfn8G,KAAK+zD,cAAcqoD,KAK3B/9F,EAAGsK,IAAI/oB,GAAI,eAAgB,WAEvB,OADAA,GAAGu+B,OAAO,KAAM,kBAAmB,oCAC5BqiB,IAGXrhD,EAAOE,QAAUmhD,sEC/hCjB5gD,GAAG28G,MAAQ,SAAUj9G,EAAGoE,EAAG20B,GACvBr4B,KAAKw8G,cAAgB,EACrBx8G,KAAK0xG,aAAar5E,EAAI/4B,EAAGoE,IAE7B9D,GAAG28G,MAAMj6G,WACLwc,YAAalf,GAAG28G,MAOhB5oD,YAAY,WACR,OAAO/zD,GAAGqE,GAAGjE,KAAKy8G,OAAOn9G,EAAGU,KAAKy8G,OAAO/4G,IAS/CssG,aAAc,WACb,OAAOhwG,KAAKy8G,OAAOn9G,GASpB2wG,aAAc,WACb,OAAOjwG,KAAKy8G,OAAO/4G,GASjB+rG,oBAAoB,WAChB,OAAO7vG,GAAGqE,GAAGjE,KAAK08G,WAAWp9G,EAAGU,KAAK08G,WAAWh5G,IASpDkuG,iBAAkB,WACd,OAAOhyG,GAAGqE,GAAGjE,KAAK28G,YAAYr9G,EAAGU,KAAK28G,YAAYj5G,IAStDgsG,SAAS,WACL,OAAO1vG,KAAKy8G,OAAOh4G,IAAIzE,KAAK08G,aAShCpN,kBAAmB,WACf,OAAO1vG,GAAGqE,GAAGjE,KAAKy8G,OAAOn9G,EAAGM,GAAG6iD,KAAK8sD,sBAAsB3rG,OAAS5D,KAAKy8G,OAAO/4G,IASnFk5G,0BAA2B,WACvB,OAAOh9G,GAAGqE,GAAGjE,KAAK08G,WAAWp9G,EAAGM,GAAG6iD,KAAK8sD,sBAAsB3rG,OAAS5D,KAAK08G,WAAWh5G,IAS3Fm5G,uBAAwB,WACpB,OAAOj9G,GAAGqE,GAAGjE,KAAK28G,YAAYr9G,EAAGM,GAAG6iD,KAAK8sD,sBAAsB3rG,OAAS5D,KAAK28G,YAAYj5G,IAS7FiuG,MAAM,WACF,OAAO3xG,KAAK4f,KAWhB8xF,aAAa,SAAUr5E,EAAI/4B,EAAGoE,GAC1B1D,KAAK08G,WAAa18G,KAAKy8G,OACvBz8G,KAAKy8G,OAAS78G,GAAGqE,GAAG3E,GAAK,EAAGoE,GAAK,GACjC1D,KAAK4f,IAAMyY,EACPr4B,KAAK88G,sBACL98G,KAAK28G,YAAc/8G,GAAGqE,GAAGjE,KAAKy8G,QAC9B78G,GAAG6iD,KAAKs6D,uBAAuB/8G,KAAK28G,aACpC38G,KAAK88G,qBAAsB,IAInCE,UAAW,SAAS19G,EAAGoE,QACV2C,IAAN3C,GACC1D,KAAKy8G,OAAOn9G,EAAIA,EAAEA,EAClBU,KAAKy8G,OAAO/4G,EAAIpE,EAAEoE,IAElB1D,KAAKy8G,OAAOn9G,EAAIA,EAChBU,KAAKy8G,OAAO/4G,EAAIA,IAIxBu5G,cAAc,SAAU39G,EAAGoE,GAEnB1D,KAAK08G,gBADAr2G,IAAN3C,EACmB9D,GAAGqE,GAAG3E,EAAEA,EAAGA,EAAEoE,GAEb9D,GAAGqE,GAAG3E,GAAK,EAAGoE,GAAK,8BCpJjDhE,EAAQ,aACRA,EAAQ,aACRA,EAAQ,qBAER,IAAI8gD,EAAe9gD,EAAQ,oBAE3BP,EAAOE,QAAUmhD,qGCNjB,IAAIniC,EAAKze,GAAGye,GACR6+F,EAAmBx9G,EAAQ,iCAAiCw9G,iBAGhE,SAASC,IACLD,EAAiB36G,KAAKvC,MAE1Bqe,EAAGmE,OAAO26F,EAAgBD,GAE1BC,EAAe76G,UAAUs/E,OAAS,SAAU11D,EAAOkxF,GAC/C,IAAI13D,EAAMx5B,EAAMxD,KACZ+U,EAAOz9B,KAAKq9G,eAAe33D,GAC/B,GAAIjoB,EAAM,CACN,IAAI6/E,GAAe7/E,EAAK8/E,WACxB9/E,EAAK8/E,YAAa,EAIlB,IAFA,IAAIC,EAAY//E,EAAK+/E,UACjBl8F,EAAUmc,EAAKnc,QACV/hB,EAAI,EAAGwuB,EAAMyvF,EAAUh+G,OAAQD,EAAIwuB,IAAOxuB,EAAG,CAClD,IAAI4uB,EAAWqvF,EAAUj+G,GACzB,GAAI4uB,EAAU,CACV,IAAIjuB,EAASohB,EAAQ/hB,IAAM2sB,EAAM6uC,cAEjC,GADA5sC,EAAS5rB,KAAKrC,EAAQgsB,EAAOkxF,GACzBlxF,EAAM+uC,6BACN,OAKRqiD,IACA7/E,EAAK8/E,YAAa,EACd9/E,EAAKggF,iBACLhgF,EAAKigF,mBAMrBv+G,EAAOE,QAAU89G,8DCtCjB,IAAM9+F,EAAK3e,EAAQ,kBACbi+G,EAAmBj+G,EAAQ,iCAE7B+6D,EAAap8C,EAAGiE,MAAMm4C,WA4B1B,SAAS7iC,IACL+lF,EAAiBp7G,KAAKvC,MAE1Bqe,EAAGmE,OAAOoV,EAAa+lF,GAEvB,IAAIhwF,EAAQiK,EAAYt1B,UAmCxBqrB,EAAMO,GAAK,SAAUxF,EAAMyF,EAAUjuB,GACjC,GAAKiuB,EAWL,OANMnuB,KAAK0uB,iBAAiBhG,EAAMyF,EAAUjuB,KACxCF,KAAK6E,IAAI6jB,EAAMyF,EAAUjuB,GAErBA,GAAUA,EAAOk6D,gBACjBl6D,EAAOk6D,eAAe10D,KAAK1F,OAE5BmuB,EAVHvuB,GAAGyC,QAAQ,OAkCnBsrB,EAAMc,IAAM,SAAU/F,EAAMyF,EAAUjuB,GAC7BiuB,GAIDnuB,KAAK+oD,OAAOrgC,EAAMyF,EAAUjuB,GAExBA,GAAUA,EAAOk6D,gBACjBK,EAAWv6D,EAAOk6D,eAAgBp6D,OANtCA,KAAK06D,UAAUhyC,IAsBvBiF,EAAMgtC,UAAYhtC,EAAM+sC,UAwBxB/sC,EAAMS,KAAO,SAAU1F,EAAMyF,EAAUjuB,GACnC,IAAI85D,EAA4B,eAAiBtxC,EAEjD,IADsB1oB,KAAK0uB,iBAAiBsrC,EAA2B7rC,EAAUjuB,GAC3D,CAClB,IAAIquB,EAAOvuB,KACPk6D,EAAc,SAAU1J,EAAMC,EAAMC,EAAMC,EAAMwJ,GAChD5rC,EAAKE,IAAI/F,EAAMwxC,EAAah6D,GAC5BquB,EAAKw6B,OAAOiR,EAA2B7rC,EAAUjuB,GACjDiuB,EAAS5rB,KAAKvC,KAAMwwD,EAAMC,EAAMC,EAAMC,EAAMwJ,IAEhDn6D,KAAKkuB,GAAGxF,EAAMwxC,EAAah6D,GAC3BF,KAAK6E,IAAIm1D,EAA2B7rC,EAAUjuB,KAsBtDytB,EAAMD,KAAOiwF,EAAiBr7G,UAAUs/E,OAWxCj0D,EAAMomC,cAAgB,SAAU7nC,GAC5BlsB,KAAK4hF,OAAO11D,EAAMxD,KAAMwD,IAG5BtsB,GAAGg4B,YAAcz4B,EAAOE,QAAUu4B,mFC3MlC,IAAIvZ,EAAK3e,EAAQ,kBAajBE,GAAG8uG,MAAQ,SAAShmF,EAAMorC,GAOtB9zD,KAAK0oB,KAAOA,EAQZ1oB,KAAK8zD,UAAYA,EAQjB9zD,KAAKE,OAAS,KAQdF,KAAK+6D,cAAgB,KAgBrB/6D,KAAK86D,WAAa,EAQlB96D,KAAKg7D,qBAAsB,EAQ3Bh7D,KAAKi7D,8BAA+B,GAExCr7D,GAAG8uG,MAAMpsG,WACLwc,YAAalf,GAAG8uG,MAQhBkP,MAAO,WACH59G,KAAK0oB,KAAO9oB,GAAG8uG,MAAMmP,QACrB79G,KAAKE,OAAS,KACdF,KAAK+6D,cAAgB,KACrB/6D,KAAK86D,WAAal7D,GAAG8uG,MAAMhxD,KAC3B19C,KAAKg7D,qBAAsB,EAC3Bh7D,KAAKi7D,8BAA+B,GASxC6iD,MAAO,SAAUp1F,EAAMorC,GACnB9zD,KAAK0oB,KAAOA,EACZ1oB,KAAK8zD,QAAUA,IAAW,GAQ9BS,gBAAiB,WACbv0D,KAAKg7D,qBAAsB,GAS/B+iD,yBAA0B,WACtB/9G,KAAKi7D,8BAA+B,GASxC8+C,UAAW,WACP,OAAO/5G,KAAKg7D,qBAAuBh7D,KAAKi7D,8BAc5C+iD,iBAAkB,WACd,OAAOh+G,KAAK+6D,eAShBghD,QAAS,WACL,OAAO/7G,KAAK0oB,OAYpB9oB,GAAG8uG,MAAMmP,QAAU,UASnBj+G,GAAG8uG,MAAMsC,MAAQ,QAQjBpxG,GAAG8uG,MAAMl1C,MAAQ,QAQjB55D,GAAG8uG,MAAM4D,SAAW,WAQpB1yG,GAAG8uG,MAAMyD,aAAe,eAUxBvyG,GAAG8uG,MAAMhxD,KAAO,EAUhB99C,GAAG8uG,MAAMuP,gBAAkB,EAU3Br+G,GAAG8uG,MAAMwP,UAAY,EAUrBt+G,GAAG8uG,MAAMyP,eAAiB,EAe1B,IAAI9B,EAAc,SAAU3zF,EAAMorC,GAC9Bl0D,GAAG8uG,MAAMnsG,KAAKvC,KAAM0oB,EAAMorC,GAQ1B9zD,KAAKo+G,OAAS,MAGlB//F,EAAGmE,OAAO65F,EAAaz8G,GAAG8uG,OAE1B2N,EAAY/5G,UAAUu1C,MAAQwkE,EAQ9BA,EAAY/5G,UAAUg6G,YAAc,SAAU3rG,GAC1C3Q,KAAKo+G,OAASztG,GASlB0rG,EAAY/5G,UAAU+7G,YAAc,WAChC,OAAOr+G,KAAKo+G,QAShB/B,EAAY/5G,UAAUg8G,aAAe1+G,GAAG8uG,MAAMpsG,UAAUy5G,QAExD,IACIwC,EAAa,IAAIlgG,EAAG26E,KADJ,IAEpBqjB,EAAY7kD,IAAM,SAAUtrC,GACxBqyF,EAAW/mD,IAAItrC,IAEnBmwF,EAAY1zF,IAAM,SAAUD,EAAMorC,GAC9B,IAAI5nC,EAAQqyF,EAAWplB,OAOvB,OANIjtE,EACAA,EAAM2rB,MAAMnvB,EAAMorC,GAGlB5nC,EAAQ,IAAImwF,EAAY3zF,EAAMorC,GAE3B5nC,GAGXtsB,GAAG8uG,MAAM2N,YAAcA,EAEvBl9G,EAAOE,QAAUO,GAAG8uG,mDChUpBhvG,EAAQ,WACRA,EAAQ,qBACRA,EAAQ,kBACRA,EAAQ,sHCHR,IAAIk4B,EAAcl4B,EAAQ,yBACtB8gD,EAAe9gD,EAAQ,oBACvB8+G,EAAc9+G,EAAQ,8BAStB+5C,EAAY75C,GAAG43B,MAQfinF,SAAU,UAQVC,OAAQ,QAQRC,aAAc,iBAyBdC,EAAmB,KACnBC,EAAuB,KACvBC,EAAcl/G,GAAGE,OACjBb,KAAM,cACNsC,QAASq2B,EAET9O,SACI2wB,UAAWA,GASfslE,wBAAyB,SAAUC,GAC/BR,EAAYO,wBAAwBC,IASxCC,yBAA0B,SAASx7C,GAC/B+6C,EAAYS,yBAAyBx7C,IAGzCv1C,GAAI,SAAUxF,EAAMyF,EAAUjuB,GAC1BF,KAAKysC,OAAO/jB,EAAMyF,EAAUjuB,GAGxBwoB,IAAS+wB,EAAUglE,UAAY/1F,IAAS+wB,EAAUilE,SAC7CE,IACDA,EAAmBh/G,GAAGo5D,cAAclsB,QAChC5gB,MAAOtsB,GAAGo5D,cAAcs5C,SACxB0C,aAAc,SAAU3I,EAASngF,GAC7BA,EAAMxD,KAAO+wB,EAAUglE,SACvB7+G,GAAGs/G,YAAYnrD,cAAc7nC,IAEjC+oF,cAAe,SAAU5I,EAASngF,GAC9BA,EAAMxD,KAAO+wB,EAAUilE,OACvB9+G,GAAGs/G,YAAYnrD,cAAc7nC,OAIpCs0B,EAAa9xB,iBAAiB9uB,GAAGo5D,cAAc46C,WAAWtB,WAC3D9xD,EAAa+Y,YAAYqlD,EAAkB,IAK/Cl2F,IAAS+wB,EAAUklE,eACdE,IACDA,EAAuBj/G,GAAGo5D,cAAclsB,QACpC5gB,MAAOtsB,GAAGo5D,cAAcm5C,aACxBhkF,SAAU,SAAUyY,EAAK1a,GACrBA,EAAMxD,KAAO+wB,EAAUklE,aACvB/+G,GAAGs/G,YAAYnrD,cAAc7nC,OAIpCs0B,EAAa9xB,iBAAiB9uB,GAAGo5D,cAAc46C,WAAWzB,eAC3D3xD,EAAa+Y,YAAYslD,EAAsB,KAM3DpwF,IAAK,SAAU/F,EAAMyF,EAAUjuB,GAI3B,GAHAF,KAAKysC,OAAO/jB,EAAMyF,EAAUjuB,GAGxB0+G,IAAqBl2F,IAAS+wB,EAAUglE,UAAY/1F,IAAS+wB,EAAUilE,QAAS,CAChF,IAAIS,EAA0Bn/G,KAAK0uB,iBAAiB+qB,EAAUglE,UAC1DW,EAAwBp/G,KAAK0uB,iBAAiB+qB,EAAUilE,QACvDS,GAA4BC,GAC7B5+D,EAAaga,eAAeokD,GAKhCC,GAAwBn2F,IAAS+wB,EAAUklE,cAC3Cn+D,EAAaga,eAAeqkD,MAMxCj/G,GAAGk/G,YAAc3/G,EAAOE,QAAUy/G,EAY9Bl/G,GAAGs/G,YAAc,IAAIt/G,GAAGk/G,sHCnK5B,aAEAp/G,EAAQ,0DCFRA,EAAQ,cACRA,EAAQ,YAGJA,EAAQ,YACRA,EAAQ,mBACRA,EAAQ,aAERA,EAAQ,gBACRA,EAAQ,cACRA,EAAQ,cAERA,EAAQ,6BACRA,EAAQ,aACRA,EAAQ,qBAGZA,EAAQ,UACRA,EAAQ,QACRA,EAAQ,oBAERA,EAAQ,qVCrBR,IAAI2e,EAAK3e,EAAQ,kBACb2/G,EAAW3/G,EAAQ,cACnB4/G,EAAe5/G,EAAQ,mBACvB6/G,EAAc7/G,EAAQ,kBACtB8/G,EAAa9/G,EAAQ,gBACrB+/G,EAAS//G,EAAQ,YACjBggH,EAAahgH,EAAQ,iBACrBigH,EAAiBjgH,EAAQ,qBAAqBigH,eAC9Cv/D,EAAmB1gD,EAAQ,wBAI3BkgH,EAAY,IAAIF,EAMpB,IAAIG,GAASnkF,IAAK,KAAMokF,KAAK,GAI7B,SAASC,EAAeznE,GACpB,IAAIjgB,EAAI/jB,EAAQ0rG,EAChB,GAAmB,iBAAR1nE,EAAkB,CAEzB,GADAhkC,EAASgkC,EACLA,EAAI5c,IACJ,OAAOpnB,EAGP+jB,EAAKigB,EAAIqM,UAIbrwC,KACA+jB,EAAKigB,EAYT,OAVA0nE,EAAS1rG,EAAOoU,KAAuB,SAAhBpU,EAAOoU,KAAkB9oB,GAAG+mD,aAAas5D,gBAAgB5nF,GAChFz4B,GAAG+mD,aAAau5D,uBAAuB7nF,EAAIwnF,GAC3CvrG,EAAOonB,IAAOskF,EAAcH,EAAMnkF,IAAXrD,EACnBwnF,EAAMnkF,KAAuB,SAAhBpnB,EAAOoU,MAAmBm3F,EAAMC,KAC7CxrG,EAAOoU,KAAO,KACdpU,EAAO6rG,YAAa,GAEdH,IACN1rG,EAAO6rG,YAAa,GAEjB7rG,EAGX,IAAI8rG,KACAC,KAQJ,SAASC,IACL,IAAIC,EAAc,IAAIhB,EAClBiB,EAAa,IAAIhB,EACjBhkF,EAAS,IAAIikF,EAEjBJ,EAAS98G,KAAKvC,MACVugH,EACAC,EACAhlF,IASJx7B,KAAKugH,YAAcA,EAQnBvgH,KAAKygH,QAAU,KASfzgH,KAAKwgH,WAAaA,EASlBxgH,KAAKw7B,OAASA,EAEdx7B,KAAKqmD,WAAa,KAGlBrmD,KAAK0gH,oBAAsBriG,EAAGG,WAAU,GAM5CH,EAAGmE,OAAO89F,EAAUjB,GACpB,IAAI1xF,EAAQ2yF,EAASh+G,UAErBqrB,EAAMve,KAAO,SAAUuP,KAcvBgP,EAAMgzF,kBApHN,WACI,OAAO/9D,OAAOg+D,eAAiB,IAAIh+D,OAAOg+D,eAAmB,IAAIC,cAAc,mBA+HnFlzF,EAAMmzF,oBAAsB,SAAUC,GAClC/gH,KAAKwgH,WAAWQ,YAAYD,IAahCpzF,EAAMszF,gBAAkB,SAAUF,GAC9B/gH,KAAKw7B,OAAOwlF,YAAYD,IA2C5BpzF,EAAM8N,KAAO,SAASmkF,EAAWsB,EAAkBC,QAKtB96G,IAArB86G,IACAA,EAAmBD,EACnBA,EAAmBlhH,KAAKqmD,YAAc,MAG1C,IAEI/N,EAFA/pB,EAAOvuB,KACPohH,GAAY,EAEVxB,aAAqBvsG,QACnBusG,GACAwB,GAAY,EACZxB,GAAaA,IAEbA,MAIRQ,EAAiB5gH,OAAS,EAC1B,IAAK,IAAID,EAAI,EAAGA,EAAIqgH,EAAUpgH,SAAUD,EAAG,CACvC,IAAI8hH,EAAWzB,EAAUrgH,GASzB,GAPI8hH,GAAYA,EAAShpF,KACrBz4B,GAAGu+B,OAAO,KAAMkjF,EAAShpF,IACpBgpF,EAAS18D,MAAS08D,EAAS3lF,MAC5B2lF,EAAS3lF,IAAM2lF,EAAShpF,MAGhCigB,EAAMynE,EAAcsB,IACX3lF,KAAQ4c,EAAIqM,KAArB,CAEA,IAAInqB,EAAOx6B,KAAKshH,OAAOhpE,EAAI5c,KAC3B0kF,EAAiB16G,KAAK80B,GAAQ8d,IAGlC,IAAIipE,EAAQjC,EAAaxyE,OAAO9sC,KAAMkhH,EAAkB,SAAUM,EAAQC,GACtE9B,EAAe,WACX,GAAIwB,EAAkB,CAClB,GAAIC,EAAW,CACX,IAAI/oF,EAAKigB,EAAI5c,IACbylF,EAAiB5+G,KAAKgsB,EAAMkzF,EAAMlqF,SAASc,GAAKopF,EAAMC,WAAWrpF,SAGjE8oF,EAAiB5+G,KAAKgsB,EAAMizF,EAAQC,GAExCN,EAAmB,KAUvBM,EAAMhnF,cAGd6kF,EAAaqC,cAAcJ,GAC3BA,EAAMK,OAAOxB,GACbA,EAAiB5gH,OAAS,GAG9BmuB,EAAMk0F,WAAa,SAAUjuD,EAAOkuD,EAAS3zF,GACzCkyF,EAAY7gH,OAAS,EACrB,IAAK,IAAID,EAAI,EAAGA,EAAIuiH,EAAQtiH,SAAUD,EAAG,CACrC,IAAI+4C,EAAMynE,EAAc+B,EAAQviH,IAChC,GAAK+4C,EAAI5c,KAAS4c,EAAIqM,KAAtB,CAEA,IAAInqB,EAAOx6B,KAAKshH,OAAOhpE,EAAI5c,KACvBlB,EACA6lF,EAAY36G,KAAK80B,GAGjB6lF,EAAY36G,KAAK4yC,IAIzB,IAAIipE,EAAQjC,EAAaxyE,OAAO9sC,KAAM4zD,EAAQ,SAAUmuD,EAAgBC,EAAYxnF,GAC5Ex6B,KAAKiiH,aAAejiH,KAAKiiH,YAAY57D,YACrCrmD,KAAKiiH,YAAYC,iBAAiB1nF,IAEtC,KAAM,SAAUgnF,EAAQC,GACxBtzF,EAASqzF,EAAQC,GAGjB7tD,GAASA,EAAMuuD,OAASvuD,EAAMuuD,KAAK3iH,OAAS,GAC5CiiH,EAAMhnF,YAEV,GAAIm5B,EAAO,CACP,IAAIwuD,EAAa9C,EAAa+C,SAASzuD,GAEvC2tD,EAAMU,YAAcG,EAAWH,aAAeG,EAElD,IAAIE,EAAWf,EAAMK,OAAOvB,EAAazsD,GAEzC,OADAysD,EAAY7gH,OAAS,EACd8iH,GAGX30F,EAAM40F,WAAa3C,EACnBjyF,EAAM60F,YAAc,SAAU9mF,EAAKhT,EAAM+5F,GACrC,IAAK/mF,EACD,OAAO,KAGX,IAAIra,EAAQqa,EAAI/X,QAAQ,MACT,IAAXtC,IACAqa,EAAMA,EAAIqgE,OAAO,EAAG16E,IACxB,IAAIsjC,EAAOi7D,EAAU8C,QAAQhnF,EAAKhT,GAClC,IAAMi8B,EAAO,CACT,IAAIg+D,EAAU/iH,GAAG49B,KAAKmlF,QAAQjnF,GAC1BinF,IAEAjnF,EAAMA,EAAIlzB,MAAM,GAAKm6G,EAAQnjH,SAC7BmlD,EAAOi7D,EAAU8C,QAAQhnF,EAAKhT,MACjB+5F,GACT7iH,GAAGu+B,OAAO,KAAMzC,EAAKinF,IAIjC,OAAOh+D,GAGXh3B,EAAMi1F,iBAAmB,SAAUC,GAC/B,IAAIn9D,EAOJ,MANgC,iBAArBm9D,EACPn9D,EAAMm9D,EAAiB77D,OAAS,KAEC,iBAArB67D,IACZn9D,EAAM1lD,KAAKwiH,YAAYK,EAAkB,MAAM,IAASA,GAEvDn9D,GAIL9lD,GAAG+mD,aAAau5D,uBAAuBx6D,EAAKm6D,GACrC7/G,KAAKshH,OAAOzB,EAAMnkF,KAAOmkF,EAAMnkF,IAAMgqB,IAJxC9lD,GAAGu+B,OAAO,KAAM0kF,GACTn9D,IAMf/3B,EAAMm1F,aAAe,SAAUpnF,EAAKhT,EAAMy4F,GACtCxB,EAAe,WACXjkF,EAAM97B,GAAG87B,IAAIlG,UAAUkG,GACvB,IAAInP,GAAU7D,EAAOrK,EAAGmuE,aAAa9jE,GAAQ,SAAzC,kBAAkEgT,EAAlE,oBACAylF,GACAA,EAAiB,IAAIzhE,MAAMnzB,UAcvCoB,EAAMo1F,kBAAoB,SAAUr6F,EAAM29B,EAAY28D,GAClD,QAAmB38G,IAAf28G,EAA0B,CAC1B,IAAIC,EAAev6F,aAAgBrV,OAAUgL,EAAGmrD,eAAe9gD,EAAM9oB,GAAGymE,UACpEhgB,GACA28D,EAAa38D,EACT48D,IACA58D,EAAarmD,KAAKqmD,YAAc,YAGhBhgD,IAAfggD,GAA6B48D,IAClCD,EAAat6F,EACb29B,EAAarmD,KAAKqmD,YAAc,KAChC39B,EAAO,WAEQriB,IAAfggD,GAA6B48D,IAC7B58D,EAAa39B,EACbA,EAAO,MAGf,OACIA,KAAMA,EACN29B,WAAYA,EACZ28D,WAAYA,IAgDpBr1F,EAAMu1F,QAAU,SAAUxnF,EAAKhT,EAAMw4F,EAAkBC,GACnD,IAAIv0F,EAAO5sB,KAAK+iH,kBAAkBr6F,EAAMw4F,EAAkBC,GAC1Dz4F,EAAOkE,EAAKlE,KACZw4F,EAAmBt0F,EAAKy5B,WACxB86D,EAAmBv0F,EAAKo2F,WACxB,IAAIz0F,EAAOvuB,KACP2kD,EAAOp2B,EAAKi0F,YAAY9mF,EAAKhT,GAC7Bi8B,EACA3kD,KAAKy7B,MAEG/S,KAAM,OACNi8B,KAAMA,GAEVu8D,EACA,SAAUjmF,EAAKsrB,GACPA,GAEAh4B,EAAK40F,0BAA0Bx+D,GAAM,GAErCw8D,GACAA,EAAiBlmF,EAAKsrB,KAMlCh4B,EAAKu0F,aAAapnF,EAAKhT,EAAMy4F,IAIrCxzF,EAAMy1F,cAAgB,SAAUC,EAAOnC,EAAkBC,EAAkBmC,GACvE,GAAID,EAAM7jH,OAAS,EAAG,CAClB,IAAI+uB,EAAOvuB,KACPs4C,EAAM+qE,EAAM3uF,IAAI,SAAUiwB,GAC1B,OACIj8B,KAAM,OACNi8B,KAAMA,KAGd3kD,KAAKy7B,KAAK6c,EAAK4oE,EAAkB,SAAUM,EAAQC,GAC/C,GAAIN,EAAkB,CAGlB,IAFA,IAAIoC,KACAC,EAASF,MACJ/jH,EAAI,EAAGA,EAAI+4C,EAAI94C,SAAUD,EAAG,CACjC,IAAIolD,EAAOrM,EAAI/4C,GAAGolD,KACdtsB,EAAKr4B,KAAK4iH,iBAAiBj+D,GAC3BnqB,EAAOinF,EAAMC,WAAWrpF,GACxBmC,IAEAjM,EAAK40F,0BAA0Bx+D,GAAM,GACrC4+D,EAAS79G,KAAK80B,GACVgpF,GACAA,EAAO99G,KAAK49G,EAAK/jH,KAIzB+jH,EACAnC,EAAiBK,EAAQ+B,EAAUC,GAGnCrC,EAAiBK,EAAQ+B,WAMjCpC,GACAxB,EAAe,WACP2D,EACAnC,EAAiB,YAGjBA,EAAiB,YA6CrCxzF,EAAM81F,aAAe,SAAUH,EAAM56F,EAAMw4F,EAAkBC,GACzD,IAAIv0F,EAAO5sB,KAAK+iH,kBAAkBr6F,EAAMw4F,EAAkBC,GAC1Dz4F,EAAOkE,EAAKlE,KACZw4F,EAAmBt0F,EAAKy5B,WACxB86D,EAAmBv0F,EAAKo2F,WAIxB,IAFA,IAAIK,KACAK,EAAeh7F,aAAgBrV,MAC1B9T,EAAI,EAAGA,EAAI+jH,EAAK9jH,OAAQD,IAAK,CAClC,IAAIm8B,EAAM4nF,EAAK/jH,GACXokH,EAAYD,EAAeh7F,EAAKnpB,GAAKmpB,EACrCi8B,EAAO3kD,KAAKwiH,YAAY9mF,EAAKioF,GACjC,IAAIh/D,EAKA,YADA3kD,KAAK8iH,aAAapnF,EAAKioF,EAAWxC,GAHlCkC,EAAM39G,KAAKi/C,GAOnB3kD,KAAKojH,cAAcC,EAAOnC,EAAkBC,IAsDhDxzF,EAAMi2F,WAAa,SAAUloF,EAAKhT,EAAMw4F,EAAkBC,GACtD,IAAIv0F,EAAO5sB,KAAK+iH,kBAAkBr6F,EAAMw4F,EAAkBC,GAC1Dz4F,EAAOkE,EAAKlE,KACZw4F,EAAmBt0F,EAAKy5B,WACxB86D,EAAmBv0F,EAAKo2F,WAExB,IAAIM,KACAD,EAAQzD,EAAUiE,aAAanoF,EAAKhT,EAAM46F,GAC9CtjH,KAAKojH,cAAcC,EAAOnC,EAAkB,SAAUM,EAAQ+B,EAAUC,GAIpE,IADA,IAAIM,EAAiBP,EAAS/jH,OACrBD,EAAI,EAAGA,EAAIukH,IAAkBvkH,EAClC,GAAIgkH,EAAShkH,aAAcK,GAAGmtE,YAAa,CACvC,IAAI/jD,EAAeu6F,EAAShkH,GAAG6tE,kBAC/B,IAAK,IAAIluD,KAAK8J,EAAc,CACxB,IAAImkD,EAAKnkD,EAAa9J,GACtBqkG,EAAS79G,KAAKynE,GACVq2C,GACAA,EAAO99G,KAAQ89G,EAAOjkH,GAAtB,IAA4B4tE,EAAGluE,OAK/CkiH,GAAoBA,EAAiBK,EAAQ+B,EAAUC,IACxDF,IAcP31F,EAAMo2F,OAAS,SAAUroF,EAAKhT,GAC1B,IAAI8R,EAAOx6B,KAAKshH,OAAO5lF,GACvB,IAAKlB,EAAM,CACP,IAAImqB,EAAO3kD,KAAKwiH,YAAY9mF,EAAKhT,GAAM,GACvC,IAAIi8B,EAKA,OAAO,KAJP,IAAIq/D,EAAMhkH,KAAK4iH,iBAAiBj+D,GAChCnqB,EAAOx6B,KAAKshH,OAAO0C,GAS3B,OAHIxpF,GAAQA,EAAKypF,QACbzpF,EAAOA,EAAKypF,OAERzpF,GAAQA,EAAK8sC,SAAY9sC,EAAKgtC,QAAU,MAOpD75C,EAAMu2F,YAAc,WAChB,OAAO5/D,OAAOC,KAAKvkD,KAAKshH,QAAQ9hH,QAkCpCmuB,EAAMw2F,sBAAwB,SAAUvwD,GACpC,GAAIA,EAAO,CACP,IAAIlO,EAAM1lD,KAAK4iH,iBAAiBhvD,GAC5BwwD,EAAShkE,EAAiB+jE,sBAAsBz+D,GAEpD,OADA0+D,EAAO1+G,KAAKggD,GACL0+D,EAGP,UAwCRz2F,EAAMtsB,QAAU,SAAUklD,GACtB,GAAIlzC,MAAM2P,QAAQujC,GACd,IAAK,IAAIhnD,EAAI,EAAGA,EAAIgnD,EAAM/mD,OAAQD,IAAK,CACnC,IAAImmD,EAAMa,EAAMhnD,GAChBS,KAAKqB,QAAQqkD,QAGhB,GAAIa,EAAO,CACZ,IAAIluB,EAAKr4B,KAAK4iH,iBAAiBr8D,GAC3B/rB,EAAOx6B,KAAKqnE,QAAQhvC,GACxB,GAAImC,EAAM,CACQx6B,KAAKy1E,WAAWp9C,GAE9B,IADAkuB,EAAQ/rB,EAAKgtC,mBACQ5nE,GAAG2oB,MAAO,CAC3B,IAAIoT,EAAY4qB,EAAM5qB,UAClBA,GACA37B,KAAKqB,QAAQs6B,GAEjB4qB,EAAM9rB,UAEN4pF,KAchB12F,EAAM22F,aAAe,SAAU/9D,GAC3B,IAAI5B,EAAO4B,EAAMS,MACbrC,GACA3kD,KAAKqB,QAAQsjD,IAYrBh3B,EAAM42F,WAAa,SAAU7oF,EAAKhT,GAC9B,IAAIi8B,EAAO3kD,KAAKwiH,YAAY9mF,EAAKhT,GAC7Bi8B,EACA3kD,KAAKqB,QAAQsjD,GAGb/kD,GAAGyC,QAAQ,KAAMq5B,IAYzB/N,EAAM62F,cAAgB,SAAU9oF,EAAKhT,GAEjC,IADA,IAAI26F,EAAQzD,EAAUiE,aAAanoF,EAAKhT,GAC/BnpB,EAAI,EAAGA,EAAI8jH,EAAM7jH,OAAQD,IAAK,CACnC,IAAIolD,EAAO0+D,EAAM9jH,GACjBS,KAAKqB,QAAQsjD,KAUrBh3B,EAAM81B,WAAa,WACf,IAAK,IAAIprB,KAAMr4B,KAAKshH,OAChBthH,KAAKqB,QAAQg3B,IAOrB1K,EAAM8nD,WAAa,SAAU/vB,GACzB,IAAI++D,EAAUpF,EAAS/8G,UAAUmzE,WAAWlzE,KAAKvC,KAAM0lD,GAEvD,cADO1lD,KAAK0gH,oBAAoBh7D,GACzB++D,GAiCX92F,EAAM+2F,eAAiB,SAAU7B,EAAkB39D,GAC/C,IAAIQ,EAAM1lD,KAAK4iH,iBAAiBC,GAC5Bn9D,IACA1lD,KAAK0gH,oBAAoBh7D,KAASR,IAqC1Cv3B,EAAMw1F,0BAA4B,SAAUN,EAAkB39D,GAC1DA,IAAgBA,EAChB,IAAIQ,EAAM1lD,KAAK4iH,iBAAiBC,GAChC,GAAIn9D,EAAK,CACL1lD,KAAK0gH,oBAAoBh7D,GAAOR,EAGhC,IADA,IAAIy/D,EAAUvkE,EAAiB+jE,sBAAsBz+D,GAC5CnmD,EAAI,EAAGA,EAAIolH,EAAQnlH,OAAQD,IAAK,CACrC,IAAIqlH,EAASD,EAAQplH,GACrBS,KAAK0gH,oBAAoBkE,GAAU1/D,QAGlCk/B,GAoBbz2D,EAAMk3F,cAAgB,SAAUC,GAC5B,IAAIp/D,EAAM1lD,KAAK4iH,iBAAiBkC,GAChC,QAAIp/D,KACS1lD,KAAK0gH,oBAAoBh7D,IAK1C9lD,GAAG47B,OAAS,IAAI8kF,EAmBhBnhH,EAAOE,QAAUO,GAAG47B,sPCh+BpB97B,EAAQ,mBACR,IAAMy3B,EAAQz3B,EAAQ,cAChB2/G,EAAW3/G,EAAQ,cACnB4/G,EAAe5/G,EAAQ,mBAEzBqlH,EAAK,cAELxF,EAAc,SAAUwB,GACxB/gH,KAAKq4B,GAAK0sF,EACV/kH,KAAKglH,OAAQ,EACbhlH,KAAKilH,SAAW,MAEpB1F,EAAYwF,GAAKA,EAEjB,IAAIG,KACJ3F,EAAYj9G,UAAUupC,OAAS,SAAUrR,EAAMrM,GAC3C,IAAIw2B,EAAOnqB,EAAKmqB,KAChB,IAAKA,EACD,OAAOnqB,EAAKgtC,SAAW,KAI3B5nE,GAAG+mD,aAAaw+D,eAAexgE,EAAM,SAAUhqB,EAAOe,EAAKykF,GACvD,GAAIxlF,EACAxM,EAASwM,QAKT,GAFAH,EAAKkB,IAAMlB,EAAK4qF,OAAS1pF,EACzBlB,EAAK2lF,WAAaA,EACdA,EAAY,CACZ,IAAInxE,EAAMpvC,GAAG49B,KAAKmlF,QAAQjnF,GAAK2pF,cAC/B,IAAKr2E,EAED,YADA7gB,EAAS,IAAIuxB,MAAMvoB,EAAMI,SAAS,KAAMotB,EAAMjpB,KAGlDsT,EAAMA,EAAI+sD,OAAO,GACjB,IAAIwlB,EAAQjC,EAAa+C,SAAS7nF,GAClC0qF,EAAY,IACRI,QAAS9qF,EAAK8qF,QACdjtF,GAAIqD,EACJA,IAAKA,EACLhT,KAAMsmB,EACNrU,MAAO,KACPspF,MAAOzpF,EACP8sC,UAAU,GAKdi6C,EAAMK,OAAOsD,GAEb1qF,EAAK9R,KAAOsmB,EACZ7gB,EAAS,KAAMqM,EAAKgtC,cAGpBhtC,EAAK9R,KAAO,OACZyF,EAAS,KAAMqM,EAAKgtC,YAMpC63C,EAASE,YAAcpgH,EAAOE,QAAUkgH,uGC9DxC,IAAIgG,EAAY7lH,EAAQ,iBAAiB6lH,UACrClnG,EAAK3e,EAAQ,kBAcjB,SAASggH,IACL1/G,KAAKwlH,YAAcnnG,EAAGG,WAAU,GAGpC,SAASinG,EAAejoF,EAAMojD,GAC1B,GAAIpjD,EAAKh+B,OAASohF,EAAKphF,OAAQ,CAC3B,IAAIkmH,EAAYloF,EAAK+oC,WAAWqa,EAAKphF,QACrC,OAAsB,KAAdkmH,GAAkC,KAAdA,EAEhC,OAAO,EAGX,IAAI/3F,EAAQ+xF,EAAWp9G,UAEvBqrB,EAAM+0F,QAAU,SAAUllF,EAAM9U,GAC5B8U,EAAO59B,GAAG87B,IAAIlG,UAAUgI,GACxB,IAAIhD,EAAOx6B,KAAKwlH,YAAYhoF,GAC5B,GAAIhD,EACA,GAAInnB,MAAM2P,QAAQwX,GAAO,CACrB,IAAI9R,EAoBA,OAAO8R,EAAK,GAAGmqB,KAnBf,IAAK,IAAIplD,EAAI,EAAGA,EAAIi7B,EAAKh7B,OAAQD,IAAK,CAClC,IAAIR,EAAQy7B,EAAKj7B,GACjB,GAAI8e,EAAGmrD,eAAezqE,EAAM2pB,KAAMA,GAC9B,OAAO3pB,EAAM4lD,UAmBxB,CAAA,IAAKj8B,GAAQrK,EAAGmrD,eAAehvC,EAAK9R,KAAMA,GAC3C,OAAO8R,EAAKmqB,KAOpB,MAAO,IAGXh3B,EAAMk2F,aAAe,SAAUrmF,EAAM9U,EAAMi9F,GAET,OAD9BnoF,EAAO59B,GAAG87B,IAAIlG,UAAUgI,IACfA,EAAKh+B,OAAS,KACnBg+B,EAAOA,EAAKh1B,MAAM,GAAI,IAE1B,IAAIo9G,EAAY5lH,KAAKwlH,YACjBnC,KACA75C,EAAiBnrD,EAAGmrD,eAExB,IAAK,IAAIhjE,KAAKo/G,EACV,GAAKp/G,EAAEs/C,WAAWtoB,IAASioF,EAAcj/G,EAAGg3B,KAAWA,EAAM,CACzD,IAAIhD,EAAOorF,EAAUp/G,GACrB,GAAI6M,MAAM2P,QAAQwX,GACd,IAAK,IAAIj7B,EAAI,EAAGA,EAAIi7B,EAAKh7B,OAAQD,IAAK,CAClC,IAAIR,EAAQy7B,EAAKj7B,KACZmpB,GAAQ8gD,EAAezqE,EAAM2pB,KAAMA,MACpC26F,EAAM39G,KAAK3G,EAAM4lD,MACbghE,GACAA,EAASjgH,KAAKc,UASrBkiB,GAAQ8gD,EAAehvC,EAAK9R,KAAMA,MACnC26F,EAAM39G,KAAK80B,EAAKmqB,MACZghE,GACAA,EAASjgH,KAAKc,IAalC,OAAO68G,GAuBX11F,EAAM9oB,IAAM,SAAU24B,EAAMmnB,EAAMj8B,EAAMm9F,GAGpCroF,EAAOA,EAAKsoF,UAAU,EAAGtoF,EAAKh+B,OAASI,GAAG49B,KAAKmlF,QAAQnlF,GAAMh+B,QAC7D,IAAIumH,EAAW,IAvInB,SAAgBphE,EAAMj8B,GAClB1oB,KAAK2kD,KAAOA,EACZ3kD,KAAK0oB,KAAOA,EAqIG,CAAUi8B,EAAMj8B,GAC/B68F,EAAUvlH,KAAKwlH,YAAahoF,EAAMuoF,EAAUF,IAGhDl4F,EAAMq4F,gBAAiB3B,EAyBvB12F,EAAMkqB,MAAQ,WACV73C,KAAKwlH,YAAcnnG,EAAGG,WAAU,IAIpCrf,EAAOE,QAAUqgH,mEC5KjB,IAAM7nF,EAAMn4B,EAAQ,qBACdy3B,EAAQz3B,EAAQ,cAElBu8B,EAAiBpE,EAAIoE,eACrBgqF,EAAgBhqF,EAAe8tC,OAC/B7tC,EAAUD,EAAeC,QAE7B,SAASgqF,EAAc1rF,EAAMrM,GACzB,IAAIg4F,EAAMxsF,SAASC,cAAc,SACjCusF,EAAIjuF,IAAMsC,EAAKkB,IAOf,IAAI0qF,EAAa,WACbvpF,aAAaknC,GACboiD,EAAI3sF,oBAAoB,iBAAkB6sF,GAAS,GACnDF,EAAI3sF,oBAAoB,QAAS8sF,GAAS,GACvCrqF,EAAesqF,kBACdJ,EAAI3sF,oBAAoByC,EAAesqF,iBAAkBF,GAAS,IAEtEtiD,EAAQjnC,WAAW,WACI,IAAnBqpF,EAAIK,WACJF,IAEAD,KACL,KACCA,EAAU,WACVD,IACAj4F,EAAS,KAAMg4F,IAEfG,EAAU,WACVF,IACA,IAAI5/D,EAAU,wBAA0BhsB,EAAKkB,IAC7C97B,GAAG+8C,IAAI6J,GACPr4B,EAASq4B,IAEb2/D,EAAI9sF,iBAAiB,iBAAkBgtF,GAAS,GAChDF,EAAI9sF,iBAAiB,QAASitF,GAAS,GACpCrqF,EAAesqF,kBACdJ,EAAI9sF,iBAAiB4C,EAAesqF,iBAAkBF,GAAS,GAGvE,SAASI,EAAcjsF,EAAMrM,GACpB+N,GACD/N,EAAS,IAAIuxB,MAAMvoB,EAAMI,SAAS,QAEtC,IAAImvF,EAAU9mH,GAAG47B,OAAOmlF,oBACxB+F,EAAQC,KAAK,MAAOnsF,EAAKkB,KAAK,GAC9BgrF,EAAQE,aAAe,cAGvBF,EAAQG,OAAS,WACb3qF,EAAA,gBAA2BwqF,EAAQI,SAAU,SAAShrF,GAElD3N,EAAS,KAAM2N,IAChB,WAEC3N,EAAS,kBAAoBqM,EAAKnC,GAAI,SAI9CquF,EAAQK,QAAU,WACd54F,EAAS,mBAAqBqM,EAAKnC,GAAI,OAG3CquF,EAAQM,OAyBZ7nH,EAAOE,QAtBP,SAAwBm7B,EAAMrM,GAC1B,GAA6B,IAAzB83F,EAAczmH,OACd,OAAO,IAAIkgD,MAAMvoB,EAAMI,SAAS,OAGpC,IAAIiE,EAQIA,EAPHS,EAAekrC,UAKc3sC,EAAK+sC,kBAAkB3nE,GAAGs9B,UAE1C1C,EAAK+sC,OAAOttC,WAAar6B,GAAGs9B,UAAUpF,SAASqvC,UAAas/C,EAAeP,EAG3E1rF,EAAKysF,UAAYzsF,EAAKysF,SAAL,OAA2Bf,EAAeO,EARhEP,EAWb1qF,EAAOhB,EAAMrM,qEC1FjB,IAAI9P,EAAK3e,EAAQ,kBAEjB,SAASwnH,EAAcxhE,EAAKyhE,GACxB,IAAI3sF,EAAO56B,GAAG47B,OAAO6rC,QAAQ3hB,GAC7B,GAAIlrB,EAAM,CACN,IAAImqF,EAAUnqF,EAAK4sF,WACnB,GAAIzC,EACA,IAAK,IAAIplH,EAAI,EAAGA,EAAIolH,EAAQnlH,OAAQD,IAAK,CACrC,IAAIqlH,EAASD,EAAQplH,GACf4nH,EAAOvC,KACTuC,EAAOvC,IAAU,EACjBsC,EAAatC,EAAQuC,MAOzC,SAASE,EAAY9gE,EAAO+gE,GAExB,GAAK/gE,EAAMS,MAAX,CAGA,IAAItB,EAAM9lD,GAAG47B,OAAOonF,iBAAiBr8D,GAC/B+gE,EAAW5hE,KACb4hE,EAAW5hE,IAAO,EAClBwhE,EAAaxhE,EAAK4hE,KAI1B,SAASC,EAAgB9hG,EAAM6hG,GAE3B,IADA,IAAIjiG,EAAQi/B,OAAOkjE,oBAAoB/hG,GAC9BlmB,EAAI,EAAGA,EAAI8lB,EAAM7lB,OAAQD,IAAK,CACnC,IAAIwE,EAAQ0hB,EAAKJ,EAAM9lB,IACvB,GAAqB,iBAAVwE,GAAsBA,EAC7B,GAAIsP,MAAM2P,QAAQjf,GACd,IAAK,IAAIqoB,EAAI,EAAGA,EAAIroB,EAAMvE,OAAQ4sB,IAAK,CACnC,IAAI+e,EAAMpnC,EAAMqoB,GACZ+e,aAAevrC,GAAGymE,UAClBghD,EAAWl8E,EAAKm8E,QAIvB,GAAKvjH,EAAM+a,aAAe/a,EAAM+a,cAAgBwlC,OAS5CvgD,aAAiBnE,GAAGymE,UACzBghD,EAAWtjH,EAAOujH,QARlB,IADA,IAAI/iE,EAAOD,OAAOkjE,oBAAoBzjH,GAC7B0jH,EAAI,EAAGA,EAAIljE,EAAK/kD,OAAQioH,IAAK,CAClC,IAAIC,EAAM3jH,EAAMwgD,EAAKkjE,IACjBC,aAAe9nH,GAAGymE,UAClBghD,EAAWK,EAAKJ,KAWxC,SAAS3sC,EAAWl2C,EAAM6iF,GACtB,IAAK,IAAI/nH,EAAI,EAAGA,EAAIklC,EAAKxY,YAAYzsB,OAAQD,IACzCgoH,EAAe9iF,EAAKxY,YAAY1sB,GAAI+nH,GAExC,IAAK,IAAIviG,EAAI,EAAGA,EAAI0f,EAAKwyB,UAAUz3D,OAAQulB,IACvC41D,EAAUl2C,EAAKwyB,UAAUlyC,GAAIuiG,GAIrCnoH,EAAOE,SAEH6lD,YAAa,SAAUyiE,EAAgBC,EAAiBC,GACpD,IAAIC,EAAkBloH,GAAG47B,OAAOklF,oBAC5B4G,EAAajpG,EAAGG,YAGpB,GAAIopG,EACA,IAAK,IAAIroH,EAAI,EAAGA,EAAIqoH,EAAgBpoH,OAAQD,IACxC+nH,EAAWM,EAAgBroH,KAAM,EAKzC,IAAK,IAAI6qC,EAAI,EAAGA,EAAIy9E,EAAaroH,OAAQ4qC,IACrCuwC,EAAUktC,EAAaz9E,GAAIk9E,GAI/B,GAAIK,EACA,IAAK,IAAIr9E,EAAI,EAAGA,EAAIq9E,EAAenoH,OAAQ8qC,IAAK,CAC5C,IAAIob,EAAMiiE,EAAer9E,IACI,IAAzBw9E,EAAgBpiE,IAAmB4hE,EAAW5hE,IAC9C9lD,GAAG47B,OAAOn6B,QAAQqkD,GAQ9B,IADA,IAAInB,EAAOD,OAAOC,KAAKujE,GACdr9E,EAAI,EAAGA,EAAI8Z,EAAK/kD,OAAQirC,IAAK,CAClC,IAAIs9E,EAAMxjE,EAAK9Z,IACc,IAAzBq9E,EAAgBC,IAAkBT,EAAWS,IAC7CnoH,GAAG47B,OAAOn6B,QAAQ0mH,KAM9B5D,sBAAuB,SAAUz+D,GAC7B,IAAIi/D,KAEJ,OADAuC,EAAaxhE,EAAKi/D,GACXrgE,OAAOC,KAAKogE,mDCtF3BxlH,EAAOE,QAzBP,SAAyBm7B,EAAMrM,GAC3B,IAAIuN,EAAMlB,EAAKkB,IACXssF,EAAMpoH,GAAG47B,OAAOmlF,oBAChBsH,EAAU,4BAA8BvsF,EAC5CssF,EAAIrB,KAAK,MAAOjrF,GAAK,GACrBssF,EAAIpB,aAAe,cACnBoB,EAAInB,OAAS,WACT,IAAIqB,EAAcF,EAAIlB,SACtB,GAAIoB,EAAa,CACb,IAAI5zG,EAAS,IAAI6tB,WAAW+lF,GAC5B/5F,EAAS,KAAM7Z,QAGf6Z,GAAUg6F,OAAOH,EAAIG,OAAQC,aAAaH,EAAU,mBAG5DD,EAAIjB,QAAU,WACV54F,GAAUg6F,OAAOH,EAAIG,OAAQC,aAAaH,EAAU,aAExDD,EAAIK,UAAY,WACZl6F,GAAUg6F,OAAOH,EAAIG,OAAQC,aAAaH,EAAU,gBAExDD,EAAIhB,KAAK,iCCvBb,IAAM3oG,EAAK3e,EAAQ,kBACby3B,EAAQz3B,EAAQ,cACtBA,EAAQ,mBACR,IAOI4oH,EAPEjJ,EAAW3/G,EAAQ,cACnB6oH,EAAiB7oH,EAAQ,qBAE3B8oH,EAAiB9oH,EAAQ,uBACzB+oH,EAAe/oH,EAAQ,qBACvBgpH,EAAqBhpH,EAAQ,WAAWgpH,mBAU5C,SAASn7D,IACL,OAAO,KAGX,SAASo7D,EAAgBnuF,EAAMrM,EAAUy6F,GACrC,IAAIltF,EAAMlB,EAAKkB,IACXtvB,EAAIutB,SACJpyB,EAAIoyB,SAASC,cAAc,UAQ/B,SAASivF,IACLthH,EAAE+3C,WAAWkuD,YAAYjmG,GACzBA,EAAEiyB,oBAAoB,OAAQqvF,GAAa,GAC3CthH,EAAEiyB,oBAAoB,QAASsvF,GAAc,GAC7C36F,EAAS,KAAMuN,GAEnB,SAASotF,IACLvhH,EAAE+3C,WAAWkuD,YAAYjmG,GACzBA,EAAEiyB,oBAAoB,OAAQqvF,GAAa,GAC3CthH,EAAEiyB,oBAAoB,QAASsvF,GAAc,GAC7C36F,EAAS,IAAIuxB,MAAMvoB,EAAMI,SAAS,KAAMmE,KAhBX,UAA7BknB,OAAOmmE,SAASC,WAChBzhH,EAAE0hH,YAAc,aAGpB1hH,EAAEy9G,MAAQ4D,EACVrhH,EAAE2wB,IAAMwwF,EAAmBhtF,GAa3Bn0B,EAAE8xB,iBAAiB,OAAQwvF,GAAa,GACxCthH,EAAE8xB,iBAAiB,QAASyvF,GAAc,GAC1C18G,EAAEsiD,KAAKrP,YAAY93C,GAUvB,SAAS2hH,EAAe1uF,EAAMrM,EAAUg7F,EAAeC,QAC7B/iH,IAAlB8iH,IACAA,GAAgB,GAGpB,IAAIztF,EAAMgtF,EAAmBluF,EAAKkB,KASlC,GARA0tF,EAAMA,GAAO,IAAIC,MACbF,GAA8C,UAA7BvmE,OAAOmmE,SAASC,SACjCI,EAAIH,YAAc,YAGlBG,EAAIH,YAAc,KAGlBG,EAAI9hD,UAAY8hD,EAAIE,aAAe,GAAKF,EAAIlxF,MAAQwD,EACpD,OAAO0tF,GAEN,WACD,SAASG,IACLH,EAAI5vF,oBAAoB,OAAQ+vF,GAChCH,EAAI5vF,oBAAoB,QAASgwF,GAEjCJ,EAAI/wF,GAAKmC,EAAKnC,GACdlK,EAAS,KAAMi7F,GAEnB,SAASI,IACLJ,EAAI5vF,oBAAoB,OAAQ+vF,GAChCH,EAAI5vF,oBAAoB,QAASgwF,GAIA,WAA7B5mE,OAAOmmE,SAASC,UAAyBI,EAAIH,aAAiD,cAAlCG,EAAIH,YAAY5D,cAC5E6D,EAAc1uF,EAAMrM,GAAU,EAAOi7F,GAGrCj7F,EAAS,IAAIuxB,MAAMvoB,EAAMI,SAAS,KAAMmE,KAIhD0tF,EAAI/vF,iBAAiB,OAAQkwF,GAC7BH,EAAI/vF,iBAAiB,QAASmwF,GAC9BJ,EAAIlxF,IAAMwD,GAxBT,GAqCT,IAAI+tF,GAEAprG,GAAOsqG,EAGPe,IAAQR,EACRS,IAAQT,EACRU,IAAQV,EACRW,KAASX,EACTY,IAAQZ,EACRa,IAAQb,EACRc,KAASd,EACTe,KAzEJ,SAAuBzvF,EAAMrM,EAAUg7F,EAAeC,GAClD,OAAKxpH,GAAGi4B,IAAIo2B,aAAag8D,KAGlBf,EAAc1uF,EAAMrM,EAAUg7F,EAAeC,GAFzC,IAAI1pE,MAAMvoB,EAAMI,SAAS,KAAMiD,EAAKkB,OAwE/CiV,MAAUu4E,EACVgB,IAAO1B,EACP2B,IAAO3B,EAGP33F,IArHAy3F,EAAgB5oH,EAAQ,sBAsHxB0qH,IAAQ9B,EACR+B,IAAQ/B,EACRgC,IAAQhC,EAGRiC,IAAQ9B,EACR+B,IAAQ/B,EACRgC,IAAQhC,EACRiC,IAAQjC,EACRkC,MAAUlC,EAEVmC,IAAQnC,EACRoC,IAAQpC,EAERxgD,KAASwgD,EACTqC,WAAerC,EACfsC,MAAUtC,EAEVuC,IAAQvC,EAGR93B,KAASpjC,EACT09D,IAAQ19D,EACR29D,IAAQ39D,EACR49D,KAAS59D,EACT69D,IAAQ79D,EACR89D,IAAQ99D,EAGR5I,KAzDJ,SAAuBnqB,EAAMrM,GACzB,IAAI7Z,EAASi0G,EAAe9sF,KAAKjB,EAAMrM,GACvC,YAAe9nB,IAAXiO,EACOtU,KAAK+gH,OAAL,KAAoBvmF,EAAMrM,GAE9B7Z,QAAUjO,GAuDjBilH,OAAW9C,EACX/iF,IAAO+iF,EAEP//F,QAAYggG,GAGZ1D,EAAK,aAwBLvF,EAAa,SAAUuB,GACvB/gH,KAAKq4B,GAAK0sF,EACV/kH,KAAKglH,OAAQ,EACbhlH,KAAKilH,SAAW,KAChBjlH,KAAKurH,eAAiB,EACtBvrH,KAAKwrH,cAELxrH,KAAKyrH,gBAELzrH,KAAK+gH,OAAS1iG,EAAG21F,MAAM+M,EAAQ0I,IAEnCjK,EAAWuF,GAAKA,EAChBvF,EAAW+I,eAAiBA,EAO5B/I,EAAWl9G,UAAU0+G,YAAc,SAAUD,GACzC1iG,EAAG21F,MAAMh0G,KAAK+gH,OAAQA,IAG1BvB,EAAWl9G,UAAUopH,iBAAmB,WACpC,KAAO1rH,KAAKurH,eAAiB3rH,GAAGiI,MAAM8jH,yBAAyB,CAC3D,IAAIC,EAAU5rH,KAAKwrH,WAAWznG,QAC9B,IAAK6nG,EACD,MAEJ,IAAIC,EAAU7rH,KAAK6rC,OAAO+/E,EAAQpxF,KAAMoxF,EAAQz9F,eAChC9nB,IAAZwlH,IACIA,aAAmBnsE,MACnBksE,EAAQz9F,SAAS09F,GAGjBD,EAAQz9F,SAAS,KAAM09F,MAMvCrM,EAAWl9G,UAAUupC,OAAS,SAAUrR,EAAMrM,GAC1C,IAAII,EAAOvuB,KACP8rH,EAAe9rH,KAAK+gH,OAAOvmF,EAAK9R,OAAS1oB,KAAK+gH,OAAL,QACzC8K,OAAUxlH,EACd,GAAIrG,KAAKurH,eAAiB3rH,GAAGiI,MAAM8jH,yBAO/B,GANA3rH,KAAKurH,sBAMWllH,KALhBwlH,EAAUC,EAAavpH,KAAKvC,KAAMw6B,EAAM,SAAUS,EAAK3mB,GACnDia,EAAKg9F,eAAiBlmH,KAAKE,IAAI,EAAGgpB,EAAKg9F,eAAiB,GACxDh9F,EAAKm9F,mBACLv9F,GAAYA,EAAS8M,EAAK3mB,MAK1B,OAFAtU,KAAKurH,eAAiBlmH,KAAKE,IAAI,EAAGvF,KAAKurH,eAAiB,GACxDvrH,KAAK0rH,mBACEG,OAGV,GAAIrxF,EAAKuxF,sBAEV,QAAgB1lH,KADhBwlH,EAAUC,EAAavpH,KAAKvC,KAAMw6B,EAAMrM,IAEpC,OAAO09F,OAIX7rH,KAAKwrH,WAAW9lH,MACZ80B,KAAMA,EACNrM,SAAUA,KAetBqxF,EAAWl9G,UAAU0pH,eAAiB,SAAU/sH,EAAMkiH,GAClD,IAAI8K,EAAMjsH,KAAKyrH,aAAaxsH,GACxBgtH,EACIA,EAAI1wF,OACA4lF,GAAkBA,IAGtBwH,GAAgBjtF,IAAKuwF,EAAIzuF,MAAO,SAAUvC,GACjCA,IACDgxF,EAAI1wF,QAAS,GAEb4lF,GAAkBA,EAAiBlmF,KAI1CkmF,GACLA,EAAiB,IAAIzhE,MAAJ,yBAAmCzgD,KAI5DogH,EAASG,WAAargH,EAAOE,QAAUmgH,uNCtSvC,IAAM3mB,EAAYn5F,EAAQ,uBAEtBwsH,EAAiB,KACjBC,EAAc,eAEdC,KACA/hE,GAAe,EACfgiE,KAEAC,EAAW,IAEf,SAASC,IAIL,IAHA,IAAIC,GAAiB,EACjB/qE,EAAMwK,KAAKxK,MAENliD,EAAI8sH,EAAc7sH,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAChD,IAAIktH,EAAiBJ,EAAc9sH,GAC/B6wF,EAAaq8B,EAAeC,eAEhC,GAAIjrE,EAAMgrE,EAAe3lG,UAAYwlG,EACjC1sH,GAAGu+B,OAAO,KAAMiyD,GAChBq8B,EAAet+F,SAAS,KAAMiiE,GAC9Bi8B,EAAclsG,OAAO5gB,EAAG,OAH5B,CAOA,IAAIotH,EAAWF,EAAeG,SAC9BV,EAAev7B,KAAO,QAAUP,EAG5Bu8B,IAFW9zB,EAAUg0B,gBAAgBX,EAAgBC,IAGrDE,EAAclsG,OAAO5gB,EAAG,GACxBktH,EAAet+F,SAAS,KAAMiiE,IAG9Bo8B,GAAiB,GAIrBA,IACAM,cAAcziE,GACdA,GAAe,GAIvB,IAAI0iE,GACAC,SAAU,SAAUxyF,EAAMrM,GACtB,IAAIuN,EAAMlB,EAAKkB,IACXgxF,EAAiBK,EAAWE,eAAevxF,GAG/C,GAAI0wF,EAAWM,GACX,OAAOA,EAGX,IAAKR,EAAgB,CACjB,IAAIgB,EAAcvzF,SAASC,cAAc,UACzCszF,EAAYvpH,MAAQ,IACpBupH,EAAYtpH,OAAS,IACrBsoH,EAAiBgB,EAAYC,WAAW,MAI5C,IAAIC,EAAW,QAAUV,EACzBR,EAAev7B,KAAOy8B,EACtB,IAAIR,EAAW/zB,EAAUg0B,gBAAgBX,EAAgBC,GAGrDkB,EAAY1zF,SAASC,cAAc,SACvCyzF,EAAU3kG,KAAO,WACjB,IAAI4kG,EAAU,GACV36G,MAAM+5G,EAAiB,GACvBY,GAAW,4BAA8BZ,EAAiB,SAE1DY,GAAW,6BAA+BZ,EAAiB,UAC/DY,GAAW,QAAU5xF,EAAM,MAC3B2xF,EAAUE,YAAcD,EAAU,IAClC3zF,SAAS+0B,KAAKrP,YAAYguE,GAG1B,IAAIG,EAAa7zF,SAASC,cAAc,OACpC6zF,EAAWD,EAAWlvE,MAC1BmvE,EAASr9B,WAAas8B,EACtBc,EAAWE,UAAY,IACvBD,EAAS92G,SAAW,WACpB82G,EAAShvE,KAAO,SAChBgvE,EAASjvE,IAAM,SACf7kB,SAAS+0B,KAAKrP,YAAYmuE,GAG1B,IAAIf,GACAC,eAAAA,EACAE,SAAAA,EACAz+F,SAAAA,EACArH,UAAWmlC,KAAKxK,OAEpB4qE,EAAc3mH,KAAK+mH,GACnBL,EAAWM,GAAkBW,GAER,IAAjBhjE,IACAA,EAAcmZ,YAAY+oD,EAAkB,OAIpDU,eAAgB,SAAUU,GACtB,IAAIC,EAAWD,EAAWjhC,YAAY,QACtC,IAAkB,IAAdkhC,EAAiB,OAAOD,EAE5B,IACIjB,EADAmB,EAAWF,EAAWjhC,YAAY,KAUtC,OAHqC,KAJjCggC,GADc,IAAdmB,EACiBF,EAAW7H,UAAU,EAAG8H,GAAY,SAEpCD,EAAW7H,UAAU+H,EAAW,EAAGD,GAAY,UAEjDjqG,QAAQ,OACvB+oG,EAAiB,IAAMA,EAAiB,KAErCA,IAIfvtH,EAAOE,QAAU0tH,qDCzHjBrtH,EAAQ,gBACRA,EAAQ,YAERA,EAAQ,mBACRA,EAAQ,cAERA,EAAQ,gICNR,IAAM2e,EAAK3e,EAAQ,kBACbouH,EAAcpuH,EAAQ,2BAA2BouH,YACjDzO,EAAW3/G,EAAQ,cACnByvC,EAAYzvC,EAAQ,yBACpBquH,EAAWruH,EAAQ,iBACnBqtH,EAAartH,EAAQ,iBAM3B,SAASsuH,EAAUxzF,GACf,GAA4B,iBAAjBA,EAAKgtC,QACZ,OAAO,IAAI9nB,MAAM,0DAGrB,IAEI,OADa+L,KAAKyyC,MAAM1jE,EAAKgtC,SAGjC,MAAO4kC,GACH,OAAO,IAAI1sD,MAAM,4BAA8BllB,EAAKnC,GAAK,cAAgB+zE,IAIjF,SAASz8B,EAAWn1C,GAEhB,GAD+BA,EAAK+sC,kBAAkB3nE,GAAG2oB,MAGrD,OAAO,KAGX,IAAIooB,EAAQnW,EAAKgtC,QACjB,GAAoC5nE,GAAGi4B,IAAIo2F,WAAaruH,GAAGi4B,IAAIq2F,mBAAqBv9E,aAAiB04E,OACjG,OAAO,IAAI3pE,MAAM,0DAIrB,IAAI0lE,EAAS5qF,EAAK4qF,OACd+I,EAAM3zF,EAAK0U,SAAW,IAAIC,EAK9B,OAJAg/E,EAAInnE,MAAQxsB,EAAKmqB,KACjBwpE,EAAIzyF,IAAM0pF,EACV+I,EAAInnD,aAAao+C,GAAQ,GACzB+I,EAAIz0F,aAAeiX,EACZw9E,EAKX,SAASC,EAAkB5zF,EAAMrM,GAE7B,GAD+BqM,EAAK+sC,kBAAkB3nE,GAAG2oB,MAGrD,OAAO,KAGX,IAAI8lG,EAAY,IAAIzuH,GAAGs9B,UAGvB,OAFAmxF,EAAUrnD,aAAaxsC,EAAK4qF,QAAQ,GACpCiJ,EAAU30F,aAAec,EAAKgtC,QACvB6mD,EA8BX,IAAMC,EAAoB,GACpBC,EAAY,SAGZC,EAAmB,EAEnBC,EAAoB,EACpBC,EAAmB,EACnBC,EAAyB,GACzBC,EAAsB,GAE5B,SAASC,EAAmBr0F,GAExB,IAAIs0F,EAAS,IAAIrsF,WAAWjI,EAAKgtC,QAAQ1rC,OAAQ,EAAGwyF,GAGpD,GAAGQ,EAAON,IAAqBD,EAC7B,OAAO,IAAI7uE,MAAM,sCAInB,IAAI/7C,EAAQmrH,EAAOJ,GACf9qH,EAASkrH,EAAOL,GAEhBM,GADSD,EAAOH,GACHG,EAAOF,GAAuB,IAW/C,OAPI99G,MAHY,IAAIqxB,WAAW3H,EAAKgtC,QAAQ1rC,OAAQizF,GAIhD16C,aAAa,EAEb1wE,MAAOA,EACPC,OAAQA,GAMhB,IAAI6lH,GAEAC,IAAQ/5C,EACRg6C,IAAQh6C,EACRi6C,IAAQj6C,EACRk6C,KAASl6C,EACTm6C,IAAQn6C,EACRo6C,IAAQp6C,EACRq6C,KAASr6C,EACTs6C,KAASt6C,EACTh/B,MAAUg/B,EACVu6C,IAAQ2E,EACR1E,IAAQ0E,EAGRh+F,IAAQu9F,EACRhE,IAAQgE,EACR/D,IAAQ+D,EACR9D,IAAQ8D,EAGRnmD,KAAS+lD,EACTlD,WAAekD,EAGfjD,MA1FJ,SAAoBvwF,GAChB,GAA4B,iBAAjBA,EAAKgtC,QACZ,OAAO,IAAI9nB,MAAM,2DAErB,IAAIprC,EAASw5G,EAAY5vB,MAAM1jE,EAAKgtC,SACpC,OAAIlzD,GAIO,IAAIorC,MAAM,wBAA0BllB,EAAKnC,GAAK,aAoFzDssB,KAASopE,EACTiB,OAAWjB,EACXkB,KAASlB,EACT/pE,MAAU+pE,EAGVzC,OAtFJ,SAAqB9wF,GAEjB,OAAIA,EAAKiB,KACEjB,EAAKiB,KAAKjB,EAAKgtC,SAGf,MAmFXmpB,KAASo8B,EAAWC,SACpB/B,IAAQ8B,EAAWC,SACnB9B,IAAQ6B,EAAWC,SACnB7B,KAAS4B,EAAWC,SACpB5B,IAAQ2B,EAAWC,SACnB3B,IAAQ0B,EAAWC,SAEnBvkG,QApKJ,WACI,OAAO,OA+LPg3F,EAAS,SAAUsB,GACnB/gH,KAAKq4B,GA1BA,SA2BLr4B,KAAKglH,OAAQ,EACbhlH,KAAKilH,SAAW,KAEhBjlH,KAAK+gH,OAAS1iG,EAAG21F,MAAM+M,EAAQ0I,IAEnChK,EAAOsF,GAhCE,SAuCTtF,EAAOn9G,UAAU0+G,YAAc,SAAUD,GACrC/gH,KAAK+gH,OAAS1iG,EAAG21F,MAAMh0G,KAAK+gH,OAAQA,IAGxCtB,EAAOn9G,UAAUupC,OAAS,SAAUrR,EAAMrM,GAEtC,OADenuB,KAAK+gH,OAAOvmF,EAAK9R,OAAS1oB,KAAK+gH,OAAL,SACzBx+G,KAAKvC,KAAMw6B,EAAMrM,IAGrCkxF,EAASI,OAAStgH,EAAOE,QAAUogH,kKC9NnC,IAAI9B,EAAmBj+G,EAAQ,iCAC/BA,EAAQ,mBACR,IAAI2e,EAAK3e,EAAQ,kBAEbwvH,EAAQ,EAAiB,IAAd7pH,KAAK8pH,SAChBC,EAAU/wG,EAAGG,WAAU,GACvB6wG,KAGAC,GACAC,QAAS,EACTC,SAAU,EACV12F,MAAO,GAGP22F,EAAapxG,EAAGG,WAAU,GAE9B,SAASkxG,EAAWr3F,GAEhB,MAA0B,iBADbA,EAAGqD,KAAOrD,GAkB3B,SAASs3F,EAAYt3F,EAAIitF,GACrB,IAAI5pF,EAAqB,iBAAPrD,EAAmBA,EAAGqD,IAAMrD,EAC1C/jB,GACAgxG,QAASA,EACTjtF,GAAIqD,EACJA,IAAKA,EACL0pF,YAAQ/+G,EACR4gH,SArBR,SAAyBvrF,GACrB,GAAKA,EAAL,CACA,IAAI5X,EAAQ4X,EAAI5X,MAAM,KACtB,GAAKA,GAAUA,EAAM,IAAOA,EAAM,GAAlC,CAGA,IAAImjG,KAMJ,OALcnjG,EAAM,GAAGA,MAAM,KACrBu2E,QAAQ,SAAU7/D,GACtB,IAAIo1F,EAAYp1F,EAAK1W,MAAM,KAC3BmjG,EAAS2I,EAAU,IAAMA,EAAU,KAEhC3I,IASO4I,CAAen0F,GACzBhT,KAAM,GACNiS,MAAO,KACP6sC,QAAS,KACTF,UAAU,EACVwoD,UACA3N,KAAM,MAGV,GAAkB,iBAAP9pF,IACPha,EAAG21F,MAAM1/F,EAAQ+jB,GACbA,EAAGuD,OACH,IAAK,IAAIr8B,EAAI,EAAGA,EAAI84B,EAAGuD,MAAMp8B,OAAQD,IAAK,CACtC,IAAIguD,EAAOl1B,EAAGuD,MAAMr8B,GACpB+U,EAAOw7G,OAAOviE,GAAQ+hE,EAAUE,SAQ5C,OAJAl7G,EAAO8wG,OAAS9wG,EAAOonB,IACnBA,IAAQpnB,EAAOoU,OACfpU,EAAOoU,KAAO9oB,GAAG49B,KAAKmlF,QAAQjnF,GAAK2pF,cAActpB,OAAO,IAErDznF,EAGX,IAAIy7G,KACJ,SAASC,EAAqBp8D,EAAOp5B,EAAMy1F,GACvC,IAAKr8D,IAAUp5B,EACX,OAAO,EAEX,IAAIlmB,GAAS,EAEb,GADAy7G,EAAWrqH,KAAK80B,EAAKnC,IACjBmC,EAAK2nF,KAAM,CACX,IAAI5iH,EAAqB2wH,EAAlB/N,EAAO3nF,EAAK2nF,KACnB,IAAK5iH,EAAI,EAAGA,EAAI4iH,EAAK3iH,OAAQD,IAAK,CAE9B,IADA2wH,EAAS/N,EAAK5iH,IACH84B,KAAOu7B,EAAMv7B,GAAI,CACxB/jB,GAAS,EACT,MAEC,KAAIy7G,EAAWpsG,QAAQusG,EAAO73F,KAAO,KAGjC63F,EAAO/N,MAAQ6N,EAAqBp8D,EAAOs8D,GAAQ,IAAO,CAC/D57G,GAAS,EACT,QAOZ,OAHK27G,IACDF,EAAWvwH,OAAS,GAEjB8U,EAuCX,IAAIgrG,EAAe,SAAU2F,EAAUnD,EAASz7D,EAAY28D,GACxDrF,EAAiBp7G,KAAKvC,MAEtBA,KAAK4f,MAAQsvG,EAEbE,EAAQpvH,KAAK4f,KAAO5f,KAEpBA,KAAKmwH,UAAYlL,EAEjBjlH,KAAKowH,cAELpwH,KAAKqwH,YAAa,EAElBrwH,KAAKiiH,YAAc,KAgBnBjiH,KAAKqmD,WAAaA,EAiBlBrmD,KAAKgjH,WAAaA,EAQlBhjH,KAAK00B,IAAMrW,EAAGG,WAAU,GAQxBxe,KAAKswH,aAQLtwH,KAAKgiH,WAAa,EAQlBhiH,KAAK+hH,eAAiB,EAQlB/hH,KAAKmwH,UACLnwH,KAAK23D,QAAS,EAGd33D,KAAK23D,QAAS,EAGdmqD,IACIA,EAAQtiH,OAAS,EACjBQ,KAAK4hH,OAAOE,GAGZ9hH,KAAKuwH,gBAuBjBjR,EAAagQ,UAAY,IAAI1vH,GAAG43B,KAAK83F,GAmCrChQ,EAAaxyE,OAAS,SAAUm4E,EAAUnD,EAASz7D,EAAY28D,QACxC38G,IAAfggD,EACuB,mBAAZy7D,IACPkB,EAAalB,EACbA,EAAUz7D,EAAa,WAGPhgD,IAAf28G,IACkB,mBAAZlB,GACPkB,EAAa38D,EACbA,EAAay7D,EACbA,EAAU,OAGVkB,EAAa38D,EACbA,EAAa,OAIrB,IAAIk7D,EAAQ8N,EAAM3mH,MAiBlB,OAhBI64G,GACAA,EAAM4O,UAAYlL,EAClB1D,EAAMl7D,WAAaA,EACnBk7D,EAAMyB,WAAaA,EACnBoM,EAAQ7N,EAAM3hG,KAAO2hG,EACjBA,EAAM4O,YACN5O,EAAM5pD,QAAS,GAEfmqD,GACAP,EAAMK,OAAOE,IAIjBP,EAAQ,IAAIjC,EAAa2F,EAAUnD,EAASz7D,EAAY28D,GAGrDzB,GAWXjC,EAAa+C,SAAW,SAAU7nF,GAC9B,OAAOA,EAAK8qF,QAAU8J,EAAQ50F,EAAK8qF,SAAW,MAUlDhG,EAAakR,aAAe,SAAUh2F,GAClC,IAAI+mF,EAAQ6N,EAAQ50F,EAAK8qF,SACrB/D,GAEAA,EAAMiP,aAAah2F,EAAKnC,KAIhCinF,EAAaqC,cAAgB,SAAUJ,GACnC,IAAIkP,EAAMhB,EAAWlO,EAAM3hG,KACtB6wG,GAODA,EAAIH,UAAU9wH,OAAS,EACvBixH,EAAItO,KAAK3iH,OAAS,GAPlBixH,EAAMhB,EAAWlO,EAAM3hG,MACnB0wG,aACAnO,UASZ7C,EAAaoR,iBAAmB,SAAU98D,EAAO+8D,GAC7C,IAAIrL,EAAU1xD,EAAM0xD,SAAW1xD,EAC/B,IAAK0xD,EACD,OAAO,EAEX,IAAIsL,EAAenB,EAAWnK,GAE9B,GAAIsL,GAC0C,IAAtCA,EAAazO,KAAKx+F,QAAQgtG,IAC1BC,EAAazO,KAAKz8G,KAAKirH,QAI1B,GAAI/8D,EAAMv7B,GACX,IAAK,IAAIA,KAAMo3F,EAAY,CACvB,IAAIlO,EAAQkO,EAAWp3F,IAEe,IAAlCkpF,EAAMY,KAAKx+F,QAAQiwC,EAAMv7B,MACU,IAA/BkpF,EAAMY,KAAKx+F,QAAQgtG,IACnBpP,EAAMY,KAAKz8G,KAAKirH,KAOpCrR,EAAauR,UAAY,SAAUF,GAC/B,IAAK,IAAIt4F,KAAMo3F,EAAY,CACvB,IAAIlO,EAAQkO,EAAWp3F,IAEY,IAA/BkpF,EAAMY,KAAKx+F,QAAQgtG,KAAqD,IAApCpP,EAAM+O,UAAU3sG,QAAQgtG,IAC5DpP,EAAM+O,UAAU5qH,KAAKirH,KAKjC,IAAIhjG,EAAQ2xF,EAAah9G,UACzB+b,EAAG21F,MAAMrmF,EAAOgwF,EAAiBr7G,WASjCqrB,EAAMi0F,OAAS,SAAUE,EAASluD,GAC9B,IAAK5zD,KAAK23D,OACN,SAEA/D,IAAUA,EAAMuuD,OAChBvuD,EAAMuuD,SAGVniH,KAAKqwH,YAAa,EAClB,IAAmB9wH,EAAGm8B,EAAKlB,EAAvB8nF,KACJ,IAAK/iH,EAAI,EAAGA,EAAIuiH,EAAQtiH,SAAUD,EAI9B,KAHAm8B,EAAMomF,EAAQviH,IAGN+lH,SAAYtlH,KAAK00B,IAAIgH,EAAIrD,KA4BjC,GAAIq3F,EAAUh0F,GAAM,CAEhB,IAAIgqB,GADJlrB,EAAOm1F,EAAWj0F,EAAK17B,KAAK4f,MACbyY,GAEVr4B,KAAK00B,IAAIgxB,KACV1lD,KAAK00B,IAAIgxB,GAAOlrB,EAChBx6B,KAAKgiH,aAELpuD,GAASA,EAAMuuD,KAAKz8G,KAAK80B,GACzB8kF,EAAaoR,iBAAiB98D,GAAS5zD,KAAK4f,IAAK8lC,GACjD48D,EAAS58G,KAAK80B,SAtCtB,CAKI,GAJAx6B,KAAK00B,IAAIgH,EAAIrD,IAAMqD,EAEnBk4B,GAASA,EAAMuuD,KAAKz8G,KAAKg2B,GAErBA,EAAI4rC,UAAY0oD,EAAqBp8D,EAAOl4B,GAAM,CAClD17B,KAAKgiH,aAELhiH,KAAKwwH,aAAa90F,EAAIrD,IACtB,SAIA,IAAI9J,EAAOvuB,KACPuhH,EAAQ6N,EAAQ1zF,EAAI4pF,SACpB/D,IACAvhH,KAAKgiH,aACL1C,EAAaoR,iBAAiB98D,GAAS5zD,KAAK4f,IAAK8b,EAAIrD,IAErDkpF,EAAMhoD,YAAY79B,EAAIrD,GAAI,SAAUmC,GAEhCjM,EAAKiiG,aAAah2F,EAAKnC,OAgC3C,OAVAr4B,KAAKqwH,YAAa,EAGdrwH,KAAK+hH,iBAAmB/hH,KAAKgiH,WAE7BhiH,KAAKuwH,cAGLvwH,KAAKmwH,UAAUW,OAAOxO,GAEnBA,GAGX30F,EAAMu0F,iBAAmB,SAAU1nF,GAC/B,GAAIx6B,KAAKqmD,WAAY,CACjB,IAAIoqE,EAAMhB,EAAWzvH,KAAK4f,KAC1B5f,KAAKqmD,WAAWoqE,EAAMA,EAAIH,UAAU9wH,OAASQ,KAAK+hH,eAAgB0O,EAAMA,EAAItO,KAAK3iH,OAASQ,KAAKgiH,WAAYxnF,KASnH7M,EAAM4iG,YAAc,WAChB,IAAI/O,EAAoC,IAA3BxhH,KAAKowH,WAAW5wH,OAAe,KAAOQ,KAAKowH,WACpDpwH,KAAKgjH,YACLhjH,KAAKgjH,WAAWxB,EAAQxhH,OAUhC2tB,EAAMojG,YAAc,WAChB,OAAO/wH,KAAK+hH,gBAAkB/hH,KAAKgiH,YAUvCr0F,EAAMqjG,gBAAkB,SAAU34F,GAC9B,QAASr4B,KAAKswH,UAAUj4F,IAU5B1K,EAAMsjG,OAAS,SAAU54F,GACrB,QAASr4B,KAAK00B,IAAI2D,IAUtB1K,EAAM+zF,WAAa,SAAUrpF,GACzB,IAAImC,EAAOx6B,KAAK00B,IAAI2D,GAChBhjB,EAAM,KAUV,OATImlB,IACIA,EAAKgtC,QACLnyD,EAAMmlB,EAAKgtC,QAENhtC,EAAKypF,QACV5uG,EAAMmlB,EAAKypF,MAAMz8C,UAIlBnyD,GAUXsY,EAAM4J,SAAW,SAAUc,GACvB,IAAImC,EAAOx6B,KAAK00B,IAAI2D,GAChBhjB,EAAM,KASV,OARImlB,IACIA,EAAKG,MACLtlB,EAAMmlB,EAAKG,MACJH,EAAKypF,QACZ5uG,EAAMmlB,EAAKypF,MAAMtpF,QAIlBtlB,GAYXsY,EAAM4rC,YAAcokD,EAAiBr7G,UAAUuC,IAe/C8oB,EAAMujG,YAAcvT,EAAiBr7G,UAAUs4D,IAe/CjtC,EAAM6sC,eAAiBmjD,EAAiBr7G,UAAUymD,OAUlDp7B,EAAMguF,mBAAqBgC,EAAiBr7G,UAAUo4D,UAOtD/sC,EAAM8nD,WAAa,SAAU/5C,GACzB,IAAIlB,EAAOx6B,KAAK00B,IAAIgH,GACflB,GAEAx6B,KAAKswH,UAAU91F,EAAKypF,OAASvoF,YAE3B17B,KAAKswH,UAAU50F,UACf17B,KAAK00B,IAAIgH,GACZlB,EAAKypF,eACEjkH,KAAKswH,UAAU91F,EAAKypF,MAAM5rF,WAC1Br4B,KAAK00B,IAAI8F,EAAKypF,MAAM5rF,KAG/Br4B,KAAK+hH,iBACL/hH,KAAKgiH,eASTr0F,EAAM6iG,aAAe,SAAUn4F,GAC3B,IAAImC,EAAOx6B,KAAK00B,IAAI2D,GACpB,GAAKmC,EAAL,CAKA,IAAI22F,EAAcnxH,KAAKowH,WAAWzsG,QAAQ0U,GAY1C,GAXImC,EAAKG,QAA0B,IAAjBw2F,EACdnxH,KAAKowH,WAAW1qH,KAAK2yB,GAEfmC,EAAKG,QAA0B,IAAjBw2F,GACpBnxH,KAAKowH,WAAWjwG,OAAOgxG,EAAa,GAGxCnxH,KAAKswH,UAAUj4F,GAAMmC,EACrBx6B,KAAK+hH,iBAELzC,EAAauR,UAAUr2F,EAAKnC,IACxBr4B,KAAKqmD,WAAY,CACjB,IAAIoqE,EAAMhB,EAAWzvH,KAAK4f,KAC1B5f,KAAKqmD,WAAWoqE,EAAMA,EAAIH,UAAU9wH,OAASQ,KAAK+hH,eAAgB0O,EAAMA,EAAItO,KAAK3iH,OAASQ,KAAKgiH,WAAYxnF,GAG/Gx6B,KAAK4hF,OAAOvpD,EAAImC,GAChBx6B,KAAK06D,UAAUriC,IAGVr4B,KAAKqwH,YAAcrwH,KAAK+hH,gBAAkB/hH,KAAKgiH,YAEhDhiH,KAAKuwH,gBASb5iG,EAAM8M,QAAU,WACZz6B,KAAK23D,QAAS,EACd33D,KAAKqwH,YAAa,EAClBrwH,KAAKmwH,UAAY,KACjBnwH,KAAKiiH,YAAc,KACnBjiH,KAAKowH,WAAW5wH,OAAS,EACzBQ,KAAKqmD,WAAa,KAClBrmD,KAAKgjH,WAAa,KAElBhjH,KAAK00B,IAAMrW,EAAGG,WAAU,GACxBxe,KAAKswH,aAELtwH,KAAKgiH,WAAa,EAClBhiH,KAAK+hH,eAAiB,EAGtBpE,EAAiBp7G,KAAKvC,MAElByvH,EAAWzvH,KAAK4f,OAChB6vG,EAAWzvH,KAAK4f,KAAK0wG,UAAU9wH,OAAS,EACxCiwH,EAAWzvH,KAAK4f,KAAKuiG,KAAK3iH,OAAS,UAEhC4vH,EAAQpvH,KAAK4f,YACb6vG,EAAWzvH,KAAK4f,MAEM,IAAzByvG,EAAM1rG,QAAQ3jB,OAAgBqvH,EAAM7vH,OA5sBrB,IA6sBf6vH,EAAM3pH,KAAK1F,OAInBJ,GAAG0/G,aAAengH,EAAOE,QAAUigH,0GCxtBnC,IAAID,EAAW3/G,EAAQ,cAEjBqlH,EAAK,UACLqM,EAAe,kBACfC,EAAY,+CAUlB,IAAIC,EAAU,SAAUC,EAAcC,EAAoBC,GACtDzxH,KAAKq4B,GAAK0sF,EACV/kH,KAAKglH,OAAQ,EACbhlH,KAAKilH,SAAW,KAChBjlH,KAAKuxH,aAAeA,EACpBvxH,KAAKwxH,mBAAqBA,EAC1BxxH,KAAKyxH,YAAcA,GAEvBH,EAAQvM,GAAKA,EAEbuM,EAAQhvH,UAAUupC,OAAS,SAASrR,GAChC,IAAIk3F,GAAoB,EAMxB,MAJkB,QAAdl3F,EAAK9R,OACLgpG,GAAoB,GAExBl3F,EAAKkB,IAAM17B,KAAK2xH,aAAan3F,EAAKkB,IAAKg2F,GAChCl3F,GAGX82F,EAAQhvH,UAAUqvH,aAAe,SAAUj2F,EAAKg2F,GAAmB,IAGvDE,EAKQC,EACAC,EAGAC,EAZ+C1jG,EAAAruB,KAC3D2kD,EA7BR,SAAyBjpB,GACrB,IAAIs2F,EAAUt2F,EAAIu2F,MAAMZ,GACxB,OAAIW,EACOA,EAAQ,GAEZ,GAwBIE,CAAex2F,GACtBipB,GAAM,WACFitE,GAAiBl2F,EAAIoqB,WAAWz3B,EAAKojG,aAEzC,IAAIU,GADMP,EAAgBvjG,EAAKmjG,mBAAqBnjG,EAAKkjG,cACrC5sE,GAChBwtE,IACIT,GACIG,EAAUjyH,GAAG49B,KAAKq0F,QAAQn2F,GAC1Bo2F,EAAWlyH,GAAG49B,KAAKs0F,SAASp2F,GAChCA,EAASm2F,EAAT,IAAoBM,EAApB,IAAiCL,IAE7BC,GAAU,EACdr2F,EAAMA,EAAI+qE,QAAQ2qB,EAAe,SAASa,EAAOhrH,GAE7C,OADA8qH,GAAU,EACH,IAAMI,EAAYlrH,IAExB8qH,IACDr2F,EAAMA,EAAM,IAAMy2F,KAhBxB,GAqBV,OAAOz2F,GAIX2jF,EAASiS,QAAUnyH,EAAOE,QAAUiyH,4CC7DpC,IAAIc,EAAY1yH,EAAQ,eACpB6lH,EAAY7lH,EAAQ,iBAAiB6lH,UAIrC8M,GACAC,QAAS,EACTC,QAAS,EACTC,YAAa,EACbC,OAAQ,GAGZ,SAASC,IACL1yH,KAAK2yH,SAAW,KAChB3yH,KAAK2iB,MAAQ0vG,EAAUC,QAM3B,IAAIM,KAGAC,KAIAC,KAGJ,SAASn4F,EAAOgqB,EAAMouE,GAClB,OAAO,IAAIrzE,MAAM,oBAAsBiF,EAAO,gBAAkBouE,GAGpE5zH,EAAOE,SACH2zH,UAAW,SAAUC,GAEjB,IAAK,IAAIF,KADTF,EAAcI,EACOA,EAEjB,IADA,IAAI5P,EAAQ4P,EAAMF,GACTxzH,EAAI,EAAGA,EAAI8jH,EAAM7jH,OAAQD,IAAK,CACnC,IAAIolD,EAAO0+D,EAAM9jH,GAEb2zH,EAA6B,IAAjB7P,EAAM7jH,OACtB+lH,EAAUqN,EAAYjuE,EAAMouE,EAAUG,KAKlDC,aAAc,SAAUxuE,EAAMouE,EAAU5kG,GACpC,IAAII,EAAOvuB,KACPozH,EAAUxzH,GAAG+mD,aAAa8f,eAAessD,GAAY,QACzDnzH,GAAG47B,OAAOC,MAAOC,IAAK03F,EAASrH,sBAAsB,GAAQ,SAAU9wF,EAAKo4F,GACxE,GAAIp4F,EAEA,OADAr7B,GAAGyC,QAAQ,KAAMsiD,GACVx2B,EAAS8M,GAEpB,IAAIqd,EAAM/pB,EAAK+kG,eAAe3uE,EAAMouE,EAAUM,GAC1C/6E,EACAnqB,EAAS,KAAMmqB,GAGfnqB,EAASwM,EAAMgqB,EAAMouE,OAKjCQ,WAhCa,SAgCDR,EAAUM,GAClB,IAAIG,EAAeV,EAAgBC,GAC9BS,KACDA,EAAeV,EAAgBC,GAAY,IAAIL,GAClC/vG,MAAQ0vG,EAAUG,aAE/BgB,EAAa7wG,QAAU0vG,EAAUI,SACjCe,EAAab,SAAW,IAAIP,EAAUqB,aACtCD,EAAab,SAASl3F,KAAKo3F,EAAYE,GAAWM,GAClDG,EAAa7wG,MAAQ0vG,EAAUI,SAIvCa,eAAgB,SAAU3uE,EAAMouE,EAAUW,GACtC,IAAIF,EAAeV,EAAgBC,GAiBnC,OAfIS,EAAa7wG,QAAU0vG,EAAUI,SAEP,iBAAfiB,IACPA,EAAajoE,KAAKyyC,MAAMw1B,IAExBrgH,MAAM2P,QAAQ0wG,GACdF,EAAab,SAAW,IAAIP,EAAUqB,aAEjCC,EAAWhrG,OAAS0pG,EAAUuB,gBAAgB5O,KACnDyO,EAAab,SAAW,IAAIP,EAAUuB,iBAE1CH,EAAab,SAASl3F,KAAKo3F,EAAYE,GAAWW,GAClDF,EAAa7wG,MAAQ0vG,EAAUI,QAG5Be,EAAab,SAASiB,SAASjvE,IAG1CkvE,kBAAmB,SAAUC,GAGzB,IAFA,IAAIC,EAAkB1B,EAAUC,QAC5B0B,EAAiB,GACZz0H,EAAI,EAAGA,EAAIu0H,EAAUt0H,OAAQD,IAAK,CACvC,IAAIwzH,EAAWe,EAAUv0H,GACrBi0H,EAAeV,EAAgBC,GACnC,GAAIS,EAAc,CACd,IAAI7wG,EAAQ6wG,EAAa7wG,MACzB,GAAIA,IAAU0vG,EAAUI,OACpB,OAAOM,EAEFpwG,EAAQoxG,IACbA,EAAkBpxG,EAClBqxG,EAAiBjB,IAK7B,OAAOgB,IAAoB1B,EAAUC,QAAU0B,EAAiBF,EAAU,IAM9Er4F,KAAM,SAAUjB,EAAMrM,GAClB,IAAIw2B,EAAOnqB,EAAKmqB,KACZouE,EAAWH,EAAWjuE,GAC1B,GAAKouE,EAAL,CAOI1/G,MAAM2P,QAAQ+vG,KACdA,EAAW/yH,KAAK6zH,kBAAkBd,IAGtC,IAAIS,EAAeV,EAAgBC,GACnC,GAAIS,GAAgBA,EAAa7wG,QAAU0vG,EAAUI,OAAQ,CAEzD,IAAIxqD,EAAOurD,EAAab,SAASiB,SAASjvE,GAC1C,OAAIsjB,GAIOttC,EAAMgqB,EAAMouE,GAc3B,OAVSS,IAEG7sF,QAAQgW,IAAI,4BAA6Bo2E,EAAUpuE,IAEvD6uE,EAAeV,EAAgBC,GAAY,IAAIL,GAClC/vG,MAAQ0vG,EAAUG,aAEnCxyH,KAAKmzH,aAAaxuE,EAAMouE,EAAU5kG,GAG/B,uEChKf,IAAI9P,EAAK3e,EAAQ,kBACb4/G,EAAe5/G,EAAQ,mBACvB4vH,EAAYhQ,EAAagQ,UAE7B,SAAS2E,EAAMC,EAAM15F,GACjB,IAAI25F,EAASD,EAAK77F,GACd+7F,EAAY55F,EAAKs1F,OAAOqE,GACxBlzC,EAAOizC,EAAKjzC,KACZgkC,EAAWiP,EAAKjP,SAEpB,IAAIzqF,EAAKG,OAASy5F,IAAc9E,EAAUC,SAAW6E,IAAc9E,EAAUx2F,MAGxE,GAAIs7F,IAAc9E,EAAUE,SACzBvuC,EACAgzC,EAAKhzC,EAAMzmD,GAGXyqF,EAASoP,QAAQ75F,OAGpB,CACDA,EAAKs1F,OAAOqE,GAAU7E,EAAUC,QAEhC,IAAIj7G,EAAS4/G,EAAKroF,OAAOrR,EAAM,SAAUS,EAAK3mB,GACtC2mB,GACAT,EAAKG,MAAQM,EACbT,EAAKs1F,OAAOqE,GAAU7E,EAAUx2F,MAChCmsF,EAASoP,QAAQ75F,KAIblmB,IACAkmB,EAAKgtC,QAAUlzD,GAEnBkmB,EAAKs1F,OAAOqE,GAAU7E,EAAUE,SAC5BvuC,EACAgzC,EAAKhzC,EAAMzmD,GAGXyqF,EAASoP,QAAQ75F,MAKzBlmB,aAAkBorC,OAClBllB,EAAKG,MAAQrmB,EACbkmB,EAAKs1F,OAAOqE,GAAU7E,EAAUx2F,MAChCmsF,EAASoP,QAAQ75F,SAEDn0B,IAAXiO,IAEU,OAAXA,IACAkmB,EAAKgtC,QAAUlzD,GAEnBkmB,EAAKs1F,OAAOqE,GAAU7E,EAAUE,SAC5BvuC,EACAgzC,EAAKhzC,EAAMzmD,GAGXyqF,EAASoP,QAAQ75F,KA8CjC,IAAI6kF,EAAW,SAAUiV,GACrBt0H,KAAKu0H,OAASD,EACdt0H,KAAKshH,OAASjjG,EAAGG,WAAU,GAE3B,IAAK,IAAIjf,EAAI,EAAGA,EAAI+0H,EAAM90H,SAAUD,EAAG,CACnC,IAAI20H,EAAOI,EAAM/0H,GAEZ20H,EAAKroF,QAAWqoF,EAAK77F,KAI1B67F,EAAKjP,SAAWjlH,KAChBk0H,EAAKjzC,KAAO1hF,EAAI+0H,EAAM90H,OAAS,EAAI80H,EAAM/0H,EAAE,GAAK,QAIxD8/G,EAASiQ,UAAYA,EAErB,IAAI3hG,EAAQ0xF,EAAS/8G,UAarBqrB,EAAM6mG,WAAa,SAAUN,EAAM7yG,GAE/B,IAAK6yG,EAAKroF,SAAWqoF,EAAK77F,IAAMhX,EAAQrhB,KAAKu0H,OAAO/0H,OAChDI,GAAGu+B,OAAO,WAId,GAAIn+B,KAAKu0H,OAAO5wG,QAAQuwG,GAAQ,EAC5Bt0H,GAAGu+B,OAAO,UADd,CAKA+1F,EAAKjP,SAAWjlH,KAEhB,IAAIy0H,EAAW,KACXpzG,EAAQrhB,KAAKu0H,OAAO/0H,SACpBi1H,EAAWz0H,KAAKu0H,OAAOlzG,IAG3B,IAAIqzG,EAAe,KACfrzG,EAAQ,IACRqzG,EAAe10H,KAAKu0H,OAAOlzG,EAAM,IAGjCqzG,IACAA,EAAazzC,KAAOizC,GAExBA,EAAKjzC,KAAOwzC,EAEZz0H,KAAKu0H,OAAOp0G,OAAOkB,EAAO,EAAG6yG,KAYjCvmG,EAAMgnG,gBAAkB,SAAUC,EAASC,GACvC,IAAIxzG,EAAQrhB,KAAKu0H,OAAO5wG,QAAQixG,GAC5BvzG,EAAQ,GAGZrhB,KAAKw0H,WAAWK,EAASxzG,EAAM,IAanCsM,EAAMmnG,WAAa,SAAUZ,GAEpBA,EAAKroF,QAAWqoF,EAAK77F,KAI1B67F,EAAKjP,SAAWjlH,KAChBk0H,EAAKjzC,KAAO,KACRjhF,KAAKu0H,OAAO/0H,OAAS,IACrBQ,KAAKu0H,OAAOv0H,KAAKu0H,OAAO/0H,OAAS,GAAGyhF,KAAOizC,GAE/Cl0H,KAAKu0H,OAAO7uH,KAAKwuH,KA+BrBvmG,EAAMmjG,OAAS,SAAUrP,GACrB,IAAIliH,EAA0Bi7B,EAAvB05F,EAAOl0H,KAAKu0H,OAAO,GAC1B,GAAIL,EAAM,CAEN,IAAK30H,EAAI,EAAGA,EAAIkiH,EAAMjiH,OAAQD,IAC1Bi7B,EAAOinF,EAAMliH,GACbS,KAAKshH,OAAO9mF,EAAKnC,IAAMmC,EAE3B,IAAKj7B,EAAI,EAAGA,EAAIkiH,EAAMjiH,OAAQD,IAE1B00H,EAAKC,EADL15F,EAAOinF,EAAMliH,SAKjB,IAAKA,EAAI,EAAGA,EAAIkiH,EAAMjiH,OAAQD,IAC1BS,KAAKq0H,QAAQ5S,EAAMliH,KAuB/BouB,EAAMk0F,WAAa,SAAUjuD,EAAOkuD,EAAS3zF,GAKzC,OAJWmxF,EAAaxyE,OAAO9sC,KAAM,SAAUwhH,EAAQC,GACnDtzF,EAASqzF,EAAQC,GACjBA,EAAMhnF,YAEEmnF,OAAOE,EAASluD,IAGhCjmC,EAAM0mG,QAAU,SAAU75F,GAClBA,EAAKG,aACE36B,KAAKshH,OAAO9mF,EAAKnC,IAElBr4B,KAAKshH,OAAO9mF,EAAKnC,MACvBr4B,KAAKshH,OAAO9mF,EAAKnC,IAAMmC,GAE3BA,EAAK8sC,UAAW,EAChBg4C,EAAakR,aAAah2F,IAsB9B7M,EAAMonG,eAAiB,SAAUC,EAASC,GACtC,GAAMA,aAAoB5hH,MAI1B,IAAK,IAAI9T,EAAI,EAAGA,EAAI01H,EAASz1H,SAAUD,EACnC01H,EAAS11H,GAAGuwH,OAASkF,EAAQlF,YAJ7BmF,EAASnF,OAASkF,EAAQlF,QAelCniG,EAAM05C,QAAU,SAAUhvC,GACtB,IAAImC,EAAOx6B,KAAKshH,OAAOjpF,GAEvB,OAAKmC,GAIDA,EAAKypF,QACLzpF,EAAOA,EAAKypF,OAETzpF,GANIA,GAqBf7M,EAAM8nD,WAAa,SAAUp9C,GACzB,IAAIosF,EAAUzkH,KAAKshH,OAAOjpF,GAI1B,OAHIosF,GAAWA,EAAQn9C,iBACZtnE,KAAKshH,OAAOjpF,GAEhBosF,GAQX92F,EAAMi2B,MAAQ,WACV,IAAK,IAAIvrB,KAAMr4B,KAAKshH,OAAQ,CACxB,IAAI9mF,EAAOx6B,KAAKshH,OAAOjpF,UAChBr4B,KAAKshH,OAAOjpF,GACdmC,EAAK8sC,WACN9sC,EAAKG,MAAQ,IAAI+kB,MAAM,qBACvB1/C,KAAKq0H,QAAQ75F,MAKzB56B,GAAGy/G,SAAWlgH,EAAOE,QAAUggH,qHC7X/B,IAAIqJ,EAAqBhpH,EAAQ,WAAWgpH,mBAE5CvpH,EAAOE,QAAU,SAAUm7B,EAAMrM,GAC7B,IAAIuN,EAAMlB,EAAKkB,IACfA,EAAMgtF,EAAmBhtF,GAEzB,IAAIssF,EAAMpoH,GAAG47B,OAAOmlF,oBAChBsH,EAAU,0BAA4BvsF,EAC1CssF,EAAIrB,KAAK,MAAOjrF,GAAK,GACjBssF,EAAIkN,kBAAkBlN,EAAIkN,iBAAiB,6BAC/ClN,EAAInB,OAAS,WACc,IAAnBmB,EAAIxB,WACe,MAAfwB,EAAIG,QAAiC,IAAfH,EAAIG,OAC1Bh6F,EAAS,KAAM65F,EAAImN,cAGnBhnG,GAAUg6F,OAAOH,EAAIG,OAAQC,aAAaH,EAAU,mBAIxD95F,GAAUg6F,OAAOH,EAAIG,OAAQC,aAAaH,EAAU,wBAG5DD,EAAIjB,QAAU,WACV54F,GAAUg6F,OAAOH,EAAIG,OAAQC,aAAaH,EAAU,aAExDD,EAAIK,UAAY,WACZl6F,GAAUg6F,OAAOH,EAAIG,OAAQC,aAAaH,EAAU,gBAExDD,EAAIhB,KAAK,8CC5Bb,IAAI73E,EAAYzvC,EAAQ,yBACpB2e,EAAK3e,EAAQ,kBAEjB,SAAS+zH,IACLzzH,KAAKo1H,SAuBT,SAASzB,IACL3zH,KAAKq1H,YAjBT5B,EAAanxH,UAAUm5B,KAAO,SAAUoM,EAAS6rF,GACzCA,EAAWl0H,SAAWqoC,EAAQroC,QAC9BI,GAAGyC,QAAQ,MAEf,IAAK,IAAI9C,EAAI,EAAGA,EAAIsoC,EAAQroC,OAAQD,IAAK,CACrC,IAAImmD,EAAM7d,EAAQtoC,GACd0oE,EAAOyrD,EAAWn0H,GACtBS,KAAKo1H,MAAM1vE,GAAOuiB,IAI1BwrD,EAAanxH,UAAUsxH,SAAW,SAAUluE,GACxC,OAAO1lD,KAAKo1H,MAAM1vE,IAAQ,MAO9BiuE,EAAgB5O,GAAK1mG,EAAGswE,YAAYx/C,GAMpCwkF,EAAgBrxH,UAAUm5B,KAAO,SAAUoM,EAAS6rF,GAChD,IAAI4B,EAAQ5B,EAAW/iH,KAAKmT,MAAM,KAC9BwxG,EAAM91H,SAAWqoC,EAAQroC,QACzBI,GAAGyC,QAAQ,MAEf,IAAK,IAAI9C,EAAI,EAAGA,EAAIsoC,EAAQroC,OAAQD,IAChCS,KAAKq1H,SAASxtF,EAAQtoC,IAAM+1H,EAAM/1H,IAI1Co0H,EAAgBrxH,UAAUsxH,SAAW,SAAUluE,GAC3C,IAAI8hB,EAAUxnE,KAAKq1H,SAAS3vE,GAC5B,OAAI8hB,GAEI+tD,SAAU5B,EAAgB5O,GAC1Bv9C,QAASA,GAIN,MASfroE,EAAOE,SACHo0H,aAAAA,EACAE,gBAAAA,4ECnEJ,IAAI6B,EAAc,KAElBr2H,EAAOE,SAcHqpH,mBAAoB,SAAUhtF,GAO1B,OANI97B,GAAG06B,KAAK4lB,OAAR,SAA4C,iBAARxkB,IAChC85F,EAAY50C,KAAKllD,GACjBA,GAAO,QAAU,IAAIuwB,KAAS,GAE9BvwB,GAAO,QAAU,IAAIuwB,KAAS,IAE/BvwB,8BCtBf,IAAMrd,EAAK3e,EAAQ,kBACby3B,EAAQz3B,EAAQ,cACtBA,EAAQ,2BACR,IAAM4/G,EAAe5/G,EAAQ,mBAE7B,SAAS+1H,EAAYxtD,GAGjB,OAAOA,IACKA,EAAK,IAHF,aAGQA,EAAK,GAAGstD,UACnBttD,EAAK,IAJF,aAIQA,EAAK,GAAGstD,UACnBttD,EAAK,IAJD,cAIOA,EAAK,GAAGstD,UA4KnC,SAASxH,EAAUvzF,EAAMrM,GAKrB,IAAI85C,EAgBAytD,EAfJ,GAA4B,iBAAjBl7F,EAAKgtC,QACZ,IACIS,EAAOxc,KAAKyyC,MAAM1jE,EAAKgtC,SAE3B,MAAO4kC,GACH,OAAO,IAAI1sD,MAAMvoB,EAAMI,SAAS,KAAMiD,EAAKnC,GAAI+zE,EAAEjvD,YAGpD,CAAA,GAA4B,iBAAjB3iB,EAAKgtC,QAIjB,OAAO,IAAI9nB,MAAMvoB,EAAMI,SAAS,OAHhC0wC,EAAOztC,EAAKgtC,QAOhB,IAAImuD,EAAUF,EAAWxtD,GAcjBytD,EAbJC,EAakB/1H,GAAG2uG,eAAeH,cAItB,SAAU/1E,GACpB,IAAIw1D,EAAMxvE,EAAGowE,cAAcp2D,GAC3B,OAAIw1D,IAGJjuF,GAAGu+B,OAAO,KAAM9F,GACTisB,SAIf,IAEIiC,EAFAqvE,EAASh2H,GAAG8mE,YAAYmvD,QAAQ98B,KAAKpwE,MAGzC,IACI49B,EAAQ3mD,GAAG8mE,YAAYuB,EAAM2tD,GACzBF,YAAaA,EACbx1H,OAAQs6B,EAAKs7F,cACbl/C,UAAWp8C,IAGnB,MAAO4xE,GACHxsG,GAAG8mE,YAAYmvD,QAAQ98B,KAAKvhC,IAAIo+D,GAChC,IAAI36F,EAAsCmxE,EAAEjvD,MAC5C,OAAO,IAAIuC,MAAMvoB,EAAMI,SAAS,KAAMiD,EAAKnC,GAAI4C,IAGnDsrB,EAAMS,MAAQxsB,EAAKmqB,KAMnB,IACIggE,EAjPR,SAAuBnqF,EAAM+rB,EAAOqvE,EAAQG,GACxC,IAIIpR,EACAplH,EAAGy2H,EALHC,EAAWL,EAAOK,SAClBC,EAAUN,EAAOO,YACjBC,EAAWR,EAAOS,aAClBC,EAAcV,EAAOW,aAIrBnP,EAAa5sF,EAAK4sF,cAEtB,GAAI2O,EAGA,IAFApR,KAEKplH,EAAI,EAAGA,EAAI02H,EAASz2H,OAAQD,IAAK,CAClCy2H,EAAaC,EAAS12H,GACtB,IAAIs3D,EAAMq/D,EAAQ32H,GACdqkB,EAAOwyG,EAAS72H,GAChBgtB,EAAO3sB,GAAG+mD,aAAau5D,uBAAuB8V,GAClD,GAAIzpG,EAAKuzF,IAAK,CAEV,IAAIpkF,EAAMnP,EAAKmP,IACfm7B,EAAIjzC,GAAQ8X,EACZ0rF,EAAW1hH,KAAKg2B,QAIhBipF,EAAQj/G,MACJgjB,KAAM,OACNi8B,KAAMqxE,EACNQ,iBAAiB,EACjBjvD,OAAQ1Q,EACR4/D,WAAY7yG,EACZ2yG,aAAcD,EAAY/2H,SAKrC,CAID,IAHAolH,EAAU,IAAItxG,MAAM4iH,EAASz2H,QAGxBD,EAAI,EAAGA,EAAI02H,EAASz2H,OAAQD,IAC7By2H,EAAaC,EAAS12H,GACtBolH,EAAQplH,IACJmpB,KAAM,OACNi8B,KAAMqxE,EACNzuD,OAAQ2uD,EAAQ32H,GAChBk3H,WAAYL,EAAS72H,GACrBg3H,aAAcD,EAAY/2H,IAK9BgnD,EAAM+f,UAAY/f,EAAMznC,YAAY8nD,4BACpC+9C,EAAQj/G,MACJg2B,IAAK6qB,EAAM5qB,UACX4rC,OAAQhhB,EACRkwE,WAAY,iBAKxB,OAAO9R,EAmLOuC,CAAa1sF,EAAM+rB,EAAOqvE,EAjG5C,SAA0BrvE,EAAO/rB,EAAMm7F,GAInC,IAAIr9E,EAAM9d,EAAKg8F,gBAef,OAdIl+E,EAEKiO,aAAiB3mD,GAAG2oB,OAAUg+B,EAAMznC,YAAY6nD,gCACjDruB,GAAM,GAGLq9E,IACDpvE,aAAiB3mD,GAAGmnD,YAAcR,aAAiB3mD,GAAG2oE,UACtDjwB,EAAMiO,EAAMoiB,iBAMbrwB,EA6EYo+E,CAAgBnwE,EAAO/rB,EAAMm7F,IAKhD,GAFA/1H,GAAG8mE,YAAYmvD,QAAQ98B,KAAKvhC,IAAIo+D,GAET,IAAnBjR,EAAQnlH,OACR,OAAO2uB,EAAS,KAAMo4B,IArL9B,SAAsB0+D,EAAUzqF,EAAM+rB,EAAOo+D,EAASx2F,GAElDqM,EAAKgtC,QAAUjhB,EACf,IAAI6gE,EAAa5sF,EAAK4sF,WACtBnC,EAASpD,WAAWrnF,EAAMmqF,EAAS,SAAUnD,EAAQC,GACjD,IAAIjnF,EACAm8F,EAAWlV,EAAM/sF,IACrB,IAAK,IAAIwD,KAAOy+F,GACZn8F,EAAOm8F,EAASz+F,IACPysB,MAAQnqB,EAAKgtC,UAClBhtC,EAAKgtC,QAAQxgB,MAAQxsB,EAAKmqB,MAGlC,IAAK,IAAIplD,EAAI,EAAGA,EAAIolH,EAAQnlH,OAAQD,IAAK,CACrC,IAAIkxH,EAAM9L,EAAQplH,GACdq3H,EAAYnG,EAAI9rE,KAChBkyE,EAAYpG,EAAI/0F,IAIpB,GAHgB+0F,EAAIlpD,OACHkpD,EAAIgG,WACrBj8F,EAAOm8F,EAASE,GAChB,CAIA,IAAIC,EAAkBrG,EAYtB,GAAIj2F,EAAK8sC,UAAY9sC,EAAKgtC,QAClBhtC,EAAKG,MASD/6B,GAAGs9C,OAAO1iB,EAAKG,OAInB4uF,EAAahnH,KAAKu0H,EAAiBt8F,OAGtC,CAED,IAAI+mF,EAAQjC,EAAa+C,SAAS7nF,GAE9BiD,EAAO8jF,EAAMlE,eAAeuZ,GAC5Bn5F,EACAA,EAAK90B,QAAQ4gH,EAAcuN,GAG3BvV,EAAMhoD,YAAYq9D,EAAWrN,EAAcuN,IArCnD,SAASvN,EAAc/uF,GACnB,IAAIz2B,EAAQy2B,EAAKgtC,QACbxnE,KAAKu2H,eACLxyH,EAASA,GAASnE,GAAGymE,SAAS0wD,gBAAgBhzH,EAAM+a,aAAgB/a,EAAM43B,UAAYnB,EAAK4qF,QAE/FplH,KAAKunE,OAAOvnE,KAAKy2H,YAAc1yH,EAC3By2B,EAAKmqB,OAAS4B,EAAMS,OAASogE,EAAWzjG,QAAQ6W,EAAKnC,IAAM,GAC3D+uF,EAAW1hH,KAAK80B,EAAKnC,KAyC7BlK,EAASqzF,EAAQj7D,MA8GzBywE,CAAYh3H,KAAKilH,SAAUzqF,EAAM+rB,EAAOo+D,EAASx2F,GAGrDhvB,EAAOE,QAAU0uH,EACjBA,EAAS0H,WAAaA,oHC5QtB,IAAMwB,EAAev3H,EAAQ,oBACvByhC,EAAWzhC,EAAQ,eACnBwhC,EAAexhC,EAAQ,6BACvB0hC,EAAMF,EAAaE,IAEzB,SAAS81F,EAAYvmH,EAAMypB,EAAQr2B,GAC/B4M,EAAKypB,GAAUr2B,EAAM2jH,KAGzB,SAASyP,EAAWxmH,EAAMypB,EAAQr2B,GAC9B4M,EAAKypB,GAAUr2B,EAAMzE,EACrBqR,EAAKypB,EAAS,GAAKr2B,EAAML,EAG7B,SAAS0zH,EAAWzmH,EAAMypB,EAAQr2B,GAC9B4M,EAAKypB,GAAUr2B,EAAMzE,EACrBqR,EAAKypB,EAAS,GAAKr2B,EAAML,EACzBiN,EAAKypB,EAAS,GAAKr2B,EAAMqlC,EAY7B,IAAIiuF,EAAOz3H,GAAGE,OACVb,KAAM,UACNsC,QAAS3B,GAAG2oB,MAEZC,YACI8uG,WACI7uG,QAAS,KACTC,KAAMuuG,GAQV1gF,WACI5tB,IADO,WAEH,OAAO3oB,KAAK4oC,YAEhB9c,IAJO,SAIF0C,GACDxuB,KAAK4oC,WAAapa,KAK9BzuB,KAzBgB,WA0BZC,KAAK4oC,cAEL5oC,KAAK0oC,QACL1oC,KAAK2oC,QAEL3oC,KAAK6oC,QAAUjpC,GAAGyW,KAClBrW,KAAK8oC,QAAUlpC,GAAGyW,KAElBrW,KAAKu3H,iBAAkB,GAG3BC,cArCgB,YAsCRx3H,KAAKu3H,iBAAoBv3H,KAAKs3H,YAClCt3H,KAAKu3H,iBAAkB,EAEvBv3H,KAAKs3H,UAAUjsF,MAAMrrC,QAazBoP,KAtDgB,SAsDVqoH,EAAcC,EAAaC,GAC7B33H,KAAK4jD,QAEL,IAAIjzC,EAAO,IAAIwxB,WAAWs1F,EAAaG,OAASF,GAC5C3uF,EAAK,IAAI3H,EAAIoG,aACbrG,EAASsG,OACTgwF,EACAE,EAAUv2F,EAAIsG,aAAetG,EAAIy2F,cACjClnH,EACA+mH,GAGJ13H,KAAK2oC,KAAK,IACN7M,OAAQiN,EACRp4B,KAAMA,EACN4rE,OAAO,IAcfu7C,YAnFgB,SAmFH74H,EAAMqlB,EAAQjD,GACvBA,EAAQA,GAAS,EACjB,IAAI0nB,EAAK/oC,KAAK2oC,KAAKtnB,GAGf+lB,EADS2B,EAAGjN,OACA8a,QAAQmhF,SAAS94H,GACjC,IAAKmoC,EACD,OAAOxnC,GAAGivC,KAAH,eAAuB5vC,EAAvB,iCAKX,IAAI+4H,EAAkC,iBAAd1zG,EAAO,GAC3B2zG,EAAQ7wF,EAAGtM,IAEXo9F,EAASr1F,aACTyE,EAAQ,EACRroC,IAASmiC,EAAI+2F,aACTH,GACAE,EAASr1F,aACTyE,EAAQ,GAGR4wF,EAASv1F,aAIjB,IAAIhyB,EAAOo4B,EAAGmvF,EAAOj5H,MACrB,IAAK0R,EAAM,CACP,IAAI42B,EAASwB,EAAGp4B,KAChBA,EAAOo4B,EAAGmvF,EAAOj5H,MAAQ,IAAIi5H,EAAO3wF,EAAOzL,OAAQyL,EAAO7B,WAAY6B,EAAOR,WAAaO,GAG9F,IAAID,EAASD,EAAGC,OAASC,EACrBlN,EAASgN,EAAGhN,OAASkN,EAEzB,GAAI0wF,EACA,IAAK,IAAIz4H,EAAI,EAAGgiB,EAAK+C,EAAO9kB,OAASy4H,EAAQ14H,EAAIgiB,EAAGhiB,IAGhD,IAFA,IAAI64H,EAAU74H,EAAI04H,EACdI,EAAU94H,EAAI8nC,EAASjN,EAClBhO,EAAI,EAAGA,EAAI6rG,EAAO7rG,IACvBzb,EAAK0nH,EAAUjsG,GAAK9H,EAAO8zG,EAAUhsG,OAI5C,CACD,IAAIksG,OAAA,EAEAA,EADAr5H,IAASmiC,EAAI+2F,WACDjB,EAIE,IAAVe,EACYd,EAGAC,EAIpB,IAAK,IAAIryG,EAAI,EAAGC,EAAIV,EAAO9kB,OAAQulB,EAAIC,EAAGD,IAAK,CAG3CuzG,EAAU3nH,EADIoU,EAAIsiB,EAASjN,EADnB9V,EAAOS,KAKvBgkB,EAAGwzC,OAAQ,GAYfg8C,WAjKgB,SAiKJ1wF,EAASxmB,GACjBA,EAAQA,GAAS,EAEjB,IAAI1Q,EAAO,IAAI4xB,YAAYsF,GAEvBmB,EAAKhpC,KAAK0oC,KAAKrnB,GACnB,GAAK2nB,EAmBDA,EAAGr4B,KAAOA,EACVq4B,EAAGuzC,OAAQ,MApBN,CACL,IAAIzgD,EAAS,IAAIsF,EAAI4G,YACjB7G,EAASsG,OACTrG,EAAIo3F,iBACJp3F,EAAIsG,aACJ/2B,EACAA,EAAKnR,QAGTQ,KAAK0oC,KAAKrnB,IACNya,OAAQA,EACRnrB,KAAMA,EACN4rE,OAAO,GAGX,IAAIxzC,EAAK/oC,KAAK2oC,KAAK,GACnB3oC,KAAK4oC,WAAWvnB,GAAS,IAAI6f,EAAamI,eAAeN,EAAGjN,OAAQA,KAiB5E28F,iBAxMgB,SAwME/vG,EAAMrH,GACpBA,EAAQA,GAAS,EACHrhB,KAAK4oC,WAAWvnB,GAK9BrhB,KAAK4oC,WAAWvnB,GAAOm1B,eAAiB9tB,EAHpC9oB,GAAGivC,KAAH,iCAAyCxtB,IAajDuiC,MAzNgB,WA0NZ5jD,KAAK4oC,WAAWppC,OAAS,EAGzB,IADA,IAAIk5H,EAAM14H,KAAK0oC,KACNnpC,EAAI,EAAGA,EAAIm5H,EAAIl5H,OAAQD,IAC5Bm5H,EAAIn5H,GAAGu8B,OAAOrB,UAElBi+F,EAAIl5H,OAAS,EAGb,IADA,IAAIm5H,EAAM34H,KAAK2oC,KACNyB,EAAI,EAAGA,EAAIuuF,EAAIn5H,OAAQ4qC,IAC5BuuF,EAAIvuF,GAAGtO,OAAOrB,UAElBk+F,EAAIn5H,OAAS,GAGjBi7B,QAzOgB,WA0OZz6B,KAAK4jD,SAGTg1E,YA7OgB,WA+OZ,IADA,IAAID,EAAM34H,KAAK2oC,KACNppC,EAAI,EAAGA,EAAIo5H,EAAIn5H,OAAQD,IAAK,CACjC,IAAIwpC,EAAK4vF,EAAIp5H,GAEb,GAAIwpC,EAAGwzC,MAAO,CACV,IAAIzgD,EAASiN,EAAGjN,OAAQnrB,EAAOo4B,EAAGp4B,KAClCmrB,EAAO+8F,aAAeloH,EAAKnR,OAC3Bs8B,EAAO87F,OAASjnH,EAAKo2B,WACrBjL,EAAOj7B,OAAO,EAAG8P,GACjBo4B,EAAGwzC,OAAQ,GAKnB,IADA,IAAIm8C,EAAM14H,KAAK0oC,KACN4B,EAAI,EAAGA,EAAIouF,EAAIl5H,OAAQ8qC,IAAK,CACjC,IAAItB,EAAK0vF,EAAIpuF,GAEb,GAAItB,EAAGuzC,MAAO,CACV,IAAIpgD,EAAS6M,EAAGlN,OAAQhrB,EAAOk4B,EAAGr4B,KAClCwrB,EAAO28F,YAAchoH,EAAKtR,OAC1B28B,EAAOy7F,OAAS9mH,EAAKi2B,WACrB5K,EAAOt7B,OAAO,EAAGiQ,GACjBk4B,EAAGuzC,OAAQ,OAM3B38E,GAAGy3H,KAAOl4H,EAAOE,QAAUg4H,oGCvS3B,IAAM5oH,EAAkB/O,EAAQ,mCAC1B23H,EAAO33H,EAAQ,YACfwhC,EAAexhC,EAAQ,6BACvB0hC,EAAMF,EAAaE,IACnByY,EAAan6C,EAAQ,2BACrBwzC,EAAOxzC,EAAQ,yBAEjBktC,EAAehtC,GAAGE,OAClBb,KAAM,kBACNsC,QAASkN,EAET09B,QAAQR,EAIRnjB,YACIuwG,OACItwG,QAAS,KACTC,KAAM2uG,GAGV/rF,MACI3iB,IADE,WAEE,OAAO3oB,KAAK+4H,OAEhBjtG,IAJE,SAIG0C,GACGxuB,KAAK+4H,QAAUvqG,IACnBxuB,KAAK+4H,MAAQvqG,EACbxuB,KAAKytC,iBAAgB,GACrBztC,KAAKgyF,yBAAwB,GAC7BhyF,KAAKykC,KAAKyW,aAAerB,EAAWkC,iBAExCrzB,KAAM2uG,GAGV2B,UACIvwG,WACAC,KAAM9oB,GAAGuvC,YAIjBpvC,KAlCwB,WAmCpBC,KAAKi5H,gBACLj5H,KAAKk5H,cACLl5H,KAAKm4C,aAAe,MAGxB8mC,SAxCwB,WAyCpBj/E,KAAKysC,SACLzsC,KAAKytC,mBAGTE,gBA7CwB,SA6CPwrF,GACb,IAAIvrF,EAAW,IAAI1M,EAAa2M,aAShC,OARAD,EAASpxB,MAAQxc,KAAKykC,KAAKjoB,MAC3BoxB,EAASG,UAAUC,QAAQ,GAAGC,UAAS,GAAM,GAC7CL,EAASM,UAAW,EAEhBirF,EAAQC,cAAcxiF,QAAQmhF,SAAS32F,EAAI+2F,cAC3CvqF,EAASyrF,mBAAoB,GAG1BzrF,GAGX+kD,aA1DwB,WA4DpB,IADA,IAAI2mC,EAAYt5H,KAAKk5H,WACZ35H,EAAI,EAAGA,EAAI+5H,EAAU95H,OAAQD,IAAK,CACvC,IAAIquC,EAAW0rF,EAAU/5H,GACzBquC,EAASpxB,MAAQxc,KAAKykC,KAAKjoB,MAC3BoxB,EAAS2mD,aAGbv0F,KAAKykC,KAAKyW,cAAgBrB,EAAWqc,YAGzCqjE,OArEwB,WAsEpBv5H,KAAKk5H,WAAW15H,OAAS,EACzBQ,KAAKqyF,UAAY,MAGrB5kD,gBA1EwB,SA0EPe,GACb,IAAIlD,EAAOtrC,KAAK+4H,MAMhB,GAJIztF,GACAA,EAAKksF,gBAGJlsF,GAAkC,IAA1BA,EAAKiL,UAAU/2C,QAK5B,IAAIQ,KAAKqyF,WAAc7jD,EAAvB,CAII0E,IACAlzC,KAAKm4C,aAAejF,EAAKiB,WAAWjB,EAAKpG,SAAUxB,EAAKzC,QAASyC,EAAKxC,UAG1E9oC,KAAKu5H,SAGL,IADA,IAAIhjF,EAAYjL,EAAK1C,WACZrpC,EAAI,EAAGA,EAAIg3C,EAAU/2C,OAAQD,IAAK,CACvC,IAAIquC,EAAW5tC,KAAK2tC,gBAAgB4I,EAAUh3C,IAC9CS,KAAKk5H,WAAWxzH,KAAKkoC,GAEzB5tC,KAAKqyF,UAAYryF,KAAKk5H,WAAW,GAEjCl5H,KAAKgyF,yBAAwB,GAC7BhyF,KAAK4xF,eAAc,SAtBf5xF,KAAKyuC,mBA0BjB7uC,GAAGgtC,aAAeztC,EAAOE,QAAUutC,wKCnHnC,IAAIqqF,EAAer3H,GAAGE,OAClBb,KAAM,kBAENosC,MAHwB,SAGjBC,OAKXnsC,EAAOE,QAAU43H,4BCjCjBv3H,EAAQ,YAEJA,EAAQ,oBACRA,EAAQ,wGCsBZ,IAAMktC,EAAeltC,EAAQ,oBAEvBwhC,EAAexhC,EAAQ,6BACvB85H,EAAet4F,EAAas4F,aAC5Bp4F,EAAMF,EAAaE,IAGnBq4F,GAFiBv4F,EAAamI,eAEhBzpC,GAAG8c,MAAMg9G,OAEzBC,GACAzrF,UAAU,EACVikD,iBAFwB,SAEN1sE,GACd,IAAIm0G,EAAcn0G,EAAKwzG,aAEvB,GADAW,EAAYp6H,OAAS,EAChBimB,EAAK6lB,KAEV,IADA,IAAIuuF,EAAYp0G,EAAK6lB,KAAK1C,WACjBrpC,EAAI,EAAGA,EAAIs6H,EAAUr6H,OAAQD,IAAK,CACvC,IAAIoR,EAAO,IAAI6oH,EACf7oH,EAAKi9B,SAAWnoB,EAAKyzG,WAAW35H,GAChCoR,EAAKmpH,GAAKD,EAAUt6H,GACpBq6H,EAAYl0H,KAAKiL,KAIzBopH,oBAfwB,SAeHD,EAAIE,EAAWpsF,EAAUzM,GAC1C,IAAIxwB,EAAO,IAAI6oH,EACXl+G,EAAIsyB,EAASvtC,QACjBib,EAAEkB,MAAQi9G,EACVn+G,EAAE25E,YAAa,EACf35E,EAAEyyB,UAAUC,QAAQ,GAAGC,UAAS,GAAM,GACtCt9B,EAAKi9B,SAAWtyB,EAGhB,IADA,IAAIusB,KACKtoC,EAAI,EAAGA,EAAIy6H,EAAUx6H,OAAQD,GAAG,EAAG,CACxC,IAAIwJ,EAAIixH,EAAWz6H,EAAI,GACnB2M,EAAI8tH,EAAWz6H,EAAI,GACnB4M,EAAI6tH,EAAWz6H,EAAI,GACvBsoC,EAAQniC,KAAKqD,EAAGmD,EAAGA,EAAGC,EAAGA,EAAGpD,GAGhC,IAAIg/B,EAAS,IAAIxF,YAAYsF,GACzBmB,EAAK,IAAI5H,EAAI4G,YACb7G,EAASwqC,QACTvqC,EAAIo3F,iBACJp3F,EAAIsG,aACJK,EACAA,EAAOvoC,QAIX,OADAmR,EAAKmpH,GAAK,IAAI54F,EAAamI,eAAeywF,EAAGV,cAAepwF,EAAI5H,EAAI64F,UAC7DtpH,GAGXupH,YA5CwB,SA4CXz0G,EAAM0b,GACf,GAAK1b,EAAK6lB,KAAV,CAEAnK,EAASg5F,SAET,IAAIP,EAAcn0G,EAAKwzG,aACnBY,EAAYp0G,EAAK6lB,KAAK1C,WAC1B,GAAIhpC,GAAGiI,MAAMuyH,qBACT,GAAIR,EAAYp6H,SAAWq6H,EAAUr6H,OAEjC,IADA,IAAIk5H,EAAMjzG,EAAK6lB,KAAK5C,KACXnpC,EAAI,EAAGA,EAAIs6H,EAAUr6H,OAAQD,IAAK,CACvC,IAAIoR,EAAOipH,EAAYr6H,GACvBq6H,EAAYl0H,KAAM1F,KAAK+5H,oBAAoBppH,EAAKmpH,GAAIpB,EAAIn5H,GAAGoR,KAAMA,EAAKi9B,SAAUzM,UAKxFy4F,EAAYp6H,OAASq6H,EAAUr6H,OAGnC,IAAI66H,EAAcl5F,EAASyM,SAEvB0sF,EAAUn5F,EAASsD,KACvBtD,EAASsD,KAAOhf,EAAK4sE,UAAUnkD,SAAWzoB,EAAKgf,KAAOtD,EAASo5F,WAE/D90G,EAAK6lB,KAAKstF,cAIV,IAFA,IAAII,EAAWvzG,EAAKuzG,SAEXj0G,GADOU,EAAKyzG,WACR,GAAGn0G,EAAI60G,EAAYp6H,OAAQulB,IAAK,CACzC,IAAI6tE,EAAagnC,EAAY70G,GACzB6oB,EAAWglD,EAAWhlD,SACtBorF,EAASj0G,GACT6oB,EAASsB,QAAU8pF,EAASj0G,GAG5B6oB,EAASqnD,YAAa,EAG1B9zD,EAASyM,SAAWA,EACpBzM,EAASq5F,SAAS5nC,GAGtBzxD,EAASsD,KAAO61F,EAChBn5F,EAASyM,SAAWysF,KAI5Bl7H,EAAOE,QAAUutC,EAAaQ,WAAausF,kFCpG3C,IAAIc,EAAgB/6H,EAAQ,yBACxB2xD,EAAQ3xD,EAAQ,uBAAuB2xD,MACvChzC,EAAK3e,EAAQ,iBAKbg7H,EAAmBrpE,EAAMqpE,iBACzBC,EAAkBtpE,EAAMspE,gBACxBpuC,EAAiBl7B,EAAMk7B,eACvBquC,EAAevpE,EAAMupE,aAWrBC,EAA+B,2BAA6BtuC,EAM5DuuC,EAAkBl7H,GAAGE,OACrByB,QAASk5H,EAAcr5C,iBACvBv8E,IAF2B,SAEtB4gB,GACDzlB,KAAKwhF,MAAMl/D,MAAM5c,KAAK+f,IAE1BsjC,OAL2B,SAKnBtjC,GACJzlB,KAAKwhF,MAAM/mB,WAAWh1C,IAE1Bs8D,eAR2B,SAQXf,GACZy5C,EAAcr5C,iBAAiBL,qBAAqB/gF,KAAKwhF,MAAOR,IAEpEY,OAX2B,WAYvB5hF,KAAK2hF,QAAQ3hF,KAAKwhF,OAClBxhF,KAAKwhF,MAAMl/D,MAAM9iB,OAAS,KAI9Bu7H,EAAgBN,EAAct4C,iBAxBC,kBA2B/B64C,EAAeP,EAAct4C,iBACM04C,GAGnCI,EAAoB,IAAI58G,EAAG26E,KA9CX,GAoEpB,SAASkiC,EAAqBz2F,EAAMhf,EAAMpE,GAKlCoE,EACAgf,EAAK6oD,iBAAiB7nE,GAGtBpH,EAAGiE,MAAM6+D,SAAS18C,EAAKxY,YAAa5K,GAsB5C,SAASthB,IAELC,KAAKm7H,oBAtDTF,EAAkBtyG,IAAM,WACpB,IAAIyyG,EAAOp7H,KAAKm5F,SACZ/5D,QAAS,IAAI07F,EAAgBC,GAC7B/7C,OAAQ,IAAIy7C,EAAc34C,cAAck5C,GACxC/7C,SAAU,IAAIw7C,EAAc34C,cAAc24C,EAAc73C,iBAI5Dw4C,EAAKh8F,QAAQoiD,MAAMjiF,GAAK,EACxB,IAAI4jF,EAAUi4C,EAAKp8C,OASnB,OARAmE,EAAQ3B,MAAMjiF,GAAK,EACnB4jF,EAAQ1B,KAAKliF,GAAK,EAClB4jF,EAAQzB,KAAKniF,GAAK,GAClB4jF,EAAUi4C,EAAKn8C,UACPuC,MAAMjiF,GAAK,EACnB4jF,EAAQ1B,KAAKliF,GAAK,EAClB4jF,EAAQzB,KAAKniF,GAAK,EAEX67H,GAsCX,IAAI96E,EAAgB1gD,GAAGE,OACnBC,KAAMA,EACN83C,MAAO93C,EAEPs7H,yBAJyB,SAIC52F,EAAM62F,EAAgBC,EAAeC,GAC3D,GAAI/2F,EAAKqwB,UAAY8lE,EAOjBh7H,GAAGyC,QAAQ,KAAMoiC,EAAKxlC,UAP1B,CAWAwlC,EAAKg0B,oBAAqB,EAM1B,IAFA,IAAIgjE,EAAch3F,EAAKxY,YAAYzsB,OAE1BD,EAAI,EAAGA,EAAIk8H,IAAel8H,EAAG,CAClC,IAAI8sB,EAAYoY,EAAKxY,YAAY1sB,GAC7B8sB,aAAqBzsB,GAAGw8E,UACxBp8E,KAAK07H,aAAarvG,EAAWivG,EAAgBC,EAAeC,IAG5DN,EAAoBz2F,EAAMpY,EAAW9sB,KACnCA,IACAk8H,GAIV,IAAK,IAAI12G,EAAI,EAAGgJ,EAAM0W,EAAKwyB,UAAUz3D,OAAQulB,EAAIgJ,IAAOhJ,EAAG,CACvD,IAAI47C,EAAQl8B,EAAKwyB,UAAUlyC,GACvB47C,EAAMgB,SACN3hE,KAAKq7H,yBAAyB16D,EAAO26D,EAAgBC,EAAeC,GAI5E/2F,EAAKizB,kBAAiB,KAG1BikE,2BA5CyB,SA4CGl3F,GAMxBA,EAAKqwB,WAAa8lE,EAClBn2F,EAAKg0B,oBAAqB,EAK1B,IADA,IAAIgjE,EAAch3F,EAAKxY,YAAYzsB,OAC1B2M,EAAI,EAAGA,EAAIsvH,IAAetvH,EAAG,CAClC,IAAIkgB,EAAYoY,EAAKxY,YAAY9f,GACjC,GAAIkgB,EAAU60D,WACVthF,GAAG+e,SAASyiC,eAAegiC,YAAY/2D,GAEnCoY,EAAKg0B,oBAGL,YADAh0B,EAAKqwB,YAAc8lE,GAK/B,IAAK,IAAIr7H,EAAI,EAAGwuB,EAAM0W,EAAKwyB,UAAUz3D,OAAQD,EAAIwuB,IAAOxuB,EAAG,CACvD,IAAIohE,EAAQl8B,EAAKwyB,UAAU13D,GAC3B,GAAIohE,EAAMlI,qBACNz4D,KAAK27H,2BAA2Bh7D,GAE5Bl8B,EAAKg0B,oBAGL,YADAh0B,EAAKqwB,YAAc8lE,GAM/Bn2F,EAAKizB,kBAAiB,GACtBjzB,EAAKqwB,YAAc8lE,GAGvB/4D,aArFyB,SAqFXp9B,EAAMkzB,GAChB,GAAIA,EAAQ,CACR,IAAIyjE,EAAOH,EAAkBtyG,MAC7B3oB,KAAKm7H,iBAAiBz1H,KAAK01H,GAE3Bp7H,KAAKq7H,yBAAyB52F,EAAM22F,EAAKh8F,QAASg8F,EAAKp8C,OAAQo8C,EAAKn8C,UACpEm8C,EAAKh8F,QAAQwiD,SACbw5C,EAAKp8C,OAAO4C,SACZw5C,EAAKn8C,SAAS2C,SAEd5hF,KAAKm7H,iBAAiBzyH,MACtBuyH,EAAkBzjE,IAAI4jE,OAErB,CACDp7H,KAAK27H,2BAA2Bl3F,GAKhC,IADA,IAAI0Y,EAAQn9C,KAAKm7H,iBACR57H,EAAI,EAAGA,EAAI49C,EAAM39C,OAAQD,IAAK,CACnC,IAAIq8H,EAAWz+E,EAAM59C,GACrBq8H,EAASx8F,QAAQ2iD,eAAe24C,GAChCkB,EAAS58C,OAAO+C,eAAe44C,GAC/BiB,EAAS38C,SAAS8C,kBAG1Bt9C,EAAK/W,KAAK,8BAA+B+W,IAG7Ci3F,aAwCI,SAAUj2G,EAAM61G,EAAgBC,EAAeC,GAC/C,GAAK57H,GAAGmsB,QAAQtG,GAAM,KAIhBA,EAAKqvC,UAAY4lE,IACnBj1G,EAAKqvC,WAAa4lE,EACdj1G,EAAKipB,YACD4sF,EACAA,EAAez2H,IAAI4gB,GAGnBA,EAAKipB,cAIXjpB,EAAKqvC,UAAY6lE,IACnBl1G,EAAKqvC,WAAa6lE,EACdl1G,EAAKu5D,OACDu8C,EACAA,EAAc12H,IAAI4gB,IAGlBA,EAAKu5D,SACLv5D,EAAKqvC,WAAay3B,GAItB9mE,EAAKqvC,WAAay3B,GAGtB9mE,EAAKy7D,UAAU,CAEf,IAD4Bz7D,EAAKgf,KAAKg0B,mBAElC,OAEJ74D,GAAG+e,SAASyiC,eAAe8hC,WAAWz9D,EAAM+1G,KAIpDnuC,YASI,SAAU5nE,GAEV7lB,GAAG+e,SAASyiC,eAAegiC,YAAY39D,GAEnCA,EAAK++D,WAAc/+D,EAAKqvC,UAAYy3B,GACpC9mE,EAAK++D,aAIbq3C,WAAWlwF,IAOfxsC,EAAOE,QAAUihD,0NCvUL5gD,EAAQ,qBAApB,IACIigH,EAAiBjgH,EAAQ,WAAWigH,eACpCF,EAAS//G,EAAQ,6BACjB6oH,EAAiB7oH,EAAQ,oCACzB0gD,EAAmB1gD,EAAQ,uCAC3Bo8H,EAAap8H,EAAQ,wBACrB4xH,EAAU5xH,EAAQ,6BAClB2e,EAAK3e,EAAQ,QAWbq8H,EAAe,GACfC,EAAiB,GACjBC,EAAkB59G,EAAGG,WAAU,GAEnC,SAASm3G,EAASpvE,GACd,OAAOA,IAAUA,EAAMznC,cAAgBlf,GAAGmnD,YAAcR,aAAiB3mD,GAAGukD,OAKhF,SAAS+3E,EAAexgG,EAAKhT,GACzB1oB,KAAK07B,IAAMA,EACX17B,KAAK0oB,KAAOA,EAKhB,IAAIi+B,GAiBAC,UAAW,SAAUjC,EAAMx2B,EAAU0mD,GACjC,GAAoB,iBAATlwB,EACP,OAAOg7D,EAAexxF,EAAU,IAAIuxB,MAAM,sCAAuC,MAIrF,IAAIllB,GACAmqB,KAAMA,EACNj8B,KAAM,QAENmsD,GAAWA,EAAQihD,gBACnBt7F,EAAKs7F,cAAgBjhD,EAAQihD,eAEjCrW,EAAOhkF,KAAKjB,EAAM,SAAUG,EAAO4rB,GAC/B,GAAI5rB,IAAU4rB,EACV5rB,EAAQ,IAAI+kB,MAAM,wDAA0D/kB,EAAQA,EAAM6rB,QAAU,sBAEnG,CACD,GAAID,EAAMznC,cAAgBlf,GAAGmnD,WAAY,CAKjC,IAAIrB,EAAM9lD,GAAG47B,OAAOonF,iBAAiBj+D,GACrC4B,EAAMvC,MAAMiB,aAAe7E,EAAiB+jE,sBAAsBz+D,GAG1E,GAAiBiwE,EAAQpvE,GAAQ,CAC7B,IAAIluB,EAAKz4B,GAAG47B,OAAOonF,iBAAiBj+D,GACpC86D,EAAOhqC,WAAWp9C,IAGtBlK,GACAA,EAASwM,EAAO4rB,MAK5BkgB,eAAgB,SAAU9hB,EAAMw3E,GAK5B,OAHIx3E,EAAOm3E,EAAWn3E,IAEEw3E,EAAmBH,EAAiB,UAAaD,GAC3Dp3E,EAAKn8C,MAAM,EAAG,GAAK,IAAMm8C,GAG3Cy3E,wBAAyB,SAAUz3E,EAAMx2B,GACjCwd,GAsBRu0E,uBAAwB,SAAUv7D,EAAMrwC,GACpCA,EAASA,IAAWonB,IAAK,KAAMokF,KAAK,GACpC,IAAIvzF,EAAO0vG,EAAgBt3E,GAU3B,OATIp4B,IAASlO,EAAGmrD,eAAej9C,EAAK7D,KAAM9oB,GAAG2oB,QAEzCjU,EAAOonB,IAAMsgG,EAAiBzvG,EAAKmP,IACnCpnB,EAAOwrG,KAAM,IAGbxrG,EAAOonB,IAAM17B,KAAKymE,eAAe9hB,GAAQ,QACzCrwC,EAAOwrG,KAAM,GAEVxrG,GAGX2rG,gBAAiB,SAAUt7D,GACvB,OAAOA,KAAQs3E,GAYnB9W,eAAgB,SAAUxgE,EAAMx2B,GAKxB,IAAI5B,EAAOvsB,KAAKkgH,uBAAuBv7D,GACvCx2B,EAAS,KAAM5B,EAAKmP,IAAKnP,EAAKuzF,MAKtCuc,kBAAmB,SAAU3gG,KAiC7B4gG,SAAU,SAAUr0D,EAAM95C,GACtB,IAAIouG,EAAa,KAAO,IAAItwE,MAAQoB,UAAYhoD,KAAK8pH,UACjD30F,GACAmqB,KAAM43E,EACN7zG,KAAM,OACN8+C,QAASS,EACTrsC,OAAS6jF,EAAOc,YAAYloF,GAAIonF,EAAOe,WAAWnoF,KAEtDonF,EAAOhkF,KAAKjB,EAAM,SAAUG,EAAO4rB,GAC/B,GAAI5rB,EACAA,EAAQ,IAAI+kB,MAAM,uDAAyD/kB,EAAM6rB,aAEhF,CACD,GAAID,EAAMznC,cAAgBlf,GAAGmnD,WAAY,CACrC,IAAIrB,EAAM9lD,GAAG47B,OAAOonF,iBAAiB2Z,GACrCh2E,EAAMvC,MAAMiB,aAAe7E,EAAiB+jE,sBAAsBz+D,GAEtE,GAAiBiwE,EAAQpvE,GAAQ,CAC7B,IAAIluB,EAAKz4B,GAAG47B,OAAOonF,iBAAiB2Z,GACpC9c,EAAOhqC,WAAWp9C,IAG1BkuB,EAAMS,MAAQ,GACV74B,GACAA,EAASwM,EAAO4rB,MAa5Bi2E,eAAgB,SAAU73E,GACtB,OAAOgC,EAAa81E,aAAa93E,IAAS,MAc9Cv1C,KAAM,SAAUylE,GASZ,IAAI6nD,EAAc7nD,EAAQ6nD,YAC1BA,EAAcA,EAAYj2B,QAAQ,MAAO,KACzCs1B,EAAen8H,GAAG49B,KAAKm/F,SAASD,GAAe,IAE/CV,EAAiBnnD,EAAQ+nD,cAEzB,IAAIrL,EAAe18C,EAAQ08C,aAC3B,GAAIA,GAAgBA,EAAasL,OAAQ,CAErC,IAAIt9H,EAAI,EAAGolD,EAAO,EACdm4E,EAAez+G,EAAGG,WAAU,GAC5Bu+G,EAAaxL,EAAasL,OAC9B,IAAKt9H,EAAI,EAAGA,EAAIw9H,EAAWv9H,OAAQD,GAAK,EAEpCu9H,EADAn4E,EAAOm3E,EAAWiB,EAAWx9H,KACRw9H,EAAWx9H,EAAI,GAGxC,IAAIy9H,EAAkB3+G,EAAGG,WAAU,GAEnC,IADAu+G,EAAaxL,EAAa,cACrBhyH,EAAI,EAAGA,EAAIw9H,EAAWv9H,OAAQD,GAAK,EAEpCy9H,EADAr4E,EAAOm3E,EAAWiB,EAAWx9H,KACLw9H,EAAWx9H,EAAI,GAG3C,IAAIkhH,EAAU,IAAI6Q,EAAQwL,EAAcE,EAAiBjB,GACzDn8H,GAAG47B,OAAOm5F,gBAAgB/0H,GAAG47B,OAAO+kF,YAAaE,GACjD7gH,GAAG47B,OAAOilF,QAAUA,EAKxB,IAAIb,EAAYH,EAAO8C,WACvB3C,EAAU/nE,QACV,IAAIolF,EAAYpoD,EAAQooD,UACxB,GAAIA,EACA,IAAK,IAAIC,KAAcD,EAAW,CAC9B,IAAI7Y,EAAS6Y,EAAUC,GACvB,IAAK,IAAIv4E,KAAQy/D,EAAQ,CACrB,IAAI73F,EAAO63F,EAAOz/D,GACdjpB,EAAMnP,EAAK,GACX4wG,EAAS5wG,EAAK,GACd7D,EAAO9oB,GAAGye,GAAGowE,cAAc0uC,GAC/B,GAAKz0G,GAOL,GAFAuzG,EAAgBt3E,GAAQ,IAAIu3E,EAAcgB,EAAa,IAAMxhG,EAAKhT,GAE/C,WAAfw0G,EAAyB,CACzB,IAAIluF,EAAMpvC,GAAG49B,KAAKmlF,QAAQjnF,GACtBsT,IAEAtT,EAAMA,EAAIlzB,MAAM,GAAKwmC,EAAIxvC,SAE7B,IAAI49H,EAAyB,IAAZ7wG,EAAK,GAEtBqzF,EAAU/6G,IAAI62B,EAAKipB,EAAMj8B,GAAO00G,SAdhCx9H,GAAG+6B,MAAM,aAAcwiG,IAoBnCtoD,EAAQwoD,cACR9U,EAAeyK,UAAUn+C,EAAQwoD,cAIrCz9H,GAAG87B,IAAIqjD,MAAOlK,EAAQyoD,YAAczoD,EAAQyoD,WAAWlZ,QAAW4X,EAAiB,WAoB3FS,iBAYAt9H,EAAOE,QAAUO,GAAG+mD,aAAeA,sPClWnC,IAAItoC,EAAK3e,EAAQ,QACb83B,EAAO93B,EAAQ,YACf0nG,EAAQ1nG,EAAQ,WAGhB69H,GAFuBn2B,EAAMo2B,oBACZp2B,EAAMq2B,cAChB/9H,EAAQ,gBACfg+H,EAAYH,EAAKG,UACjBC,EAAiBJ,EAAKI,eACtBC,EAAal+H,EAAQ,sBACzBA,EAAQ,qBAER,IAAIm+H,GAAmB,OAAQ,UAAW,SAAU,OAAQ,WAAY,aAAc,UAAW,SAAU,WAK3G,SAASC,EAAYx7G,EAAOkY,GACpBlY,EAAMqB,QAAQ6W,GAAQ,GACtBlY,EAAM5c,KAAK80B,GAInB,IAAIujG,GAGAzI,MAAO,KAIP5vH,KAAM,SAAUiL,GACZ,GAAI3Q,KAAKs1H,MACLt1H,KAAKs1H,MAAM5vH,KAAKiL,OAEf,CACD3Q,KAAKs1H,OAAS3kH,GAEd,IAAI4d,EAAOvuB,KACX88B,WAAW,WACPvO,EAAKnf,QACN,KAIXA,KAAM,WACF,IAAIkmH,EAAQt1H,KAAKs1H,MACjB,GAAIA,EAAO,CACP,IAAK,IAAI/1H,EAAI,EAAGA,EAAI+1H,EAAM91H,SAAUD,EAAG,CACnC,IAAIoR,EAAO2kH,EAAM/1H,GACbsuF,EAAMl9E,EAAKk9E,IACXrlE,EAAa7X,EAAK0U,MACI,mBAAfmD,IACPA,EAAaA,KAEjB,IAAIvpB,EAAOof,EAAGmuE,aAAaqB,GACvBrlE,EACAw1G,EAAkBnwC,EAAK5uF,EAAMupB,EAAYqlE,EAAIowC,OAAQttH,EAAKy2D,QAG1DxnE,GAAGyC,QAAQ,KAAMpD,GAGzBe,KAAKs1H,MAAQ,QAMzB,SAAS4I,EAAYrwC,EAAK5uF,GAWtB6+H,EAAWjwC,EAAIswC,UAAWl/H,GAG9B,IAAIm/H,KACJ,SAASC,EAAYxwC,EAAKj/B,EAAWvrC,EAAU8nB,EAAKmzF,GAChD,IAAIC,EAAepzF,EAAI1iB,QAiCvB80G,EAAKiB,aAAa3wC,EAAKxqE,EAAU,UAAWk7G,GAE5CL,EAAWrwC,EAAKxqE,GAGhB,IAAIo7G,EAAQC,EAAgB7wC,EAAK1iD,EAAKyjB,EAAWvrC,GAAU,GAC3D,GAAIo7G,EAAO,CAEP,IADA,IAAIE,EAAcP,EACT7+H,EAAI,EAAGA,EAAIk/H,EAAMj/H,OAAQD,IAAK,CACnC,IAAIq/H,EAAOH,EAAMl/H,GACjBg+H,EAAKqB,KAAK/wC,EAAKxqE,EAAUu7G,GAErBA,EAAKC,cACLF,EAAYj5H,KAAKk5H,EAAKC,cAI9B,IAAK,IAAI1yH,EAAI,EAAGA,EAAIwyH,EAAYn/H,OAAQ2M,IACpCwyH,EAAYxyH,GAAG0hF,EAAKxqE,GAExB+6G,EAAS5+H,OAAS,EAClBi/H,EAAMj/H,OAAS,GAIvB,SAASs/H,EAAcjxC,EAAK5uF,EAAMokB,EAAU8nB,EAAKmzF,GAC7C,IAAIS,EAAS5zF,EAAIxiB,IACbq2G,EAAS7zF,EAAIrf,IACb6B,EAAQkgE,EAAIvrF,UACZ8J,EAAIk4C,OAAO26E,yBAAyBtxG,EAAOtK,GAC3C67G,GAAmB9yH,EAEvB,GAAI2yH,EAAQ,CACJ36C,EAMJ,IADA,IAAIq6C,EAAQC,EAAgB7wC,EAAK1iD,EAAKlsC,EAAMokB,GAAU,GAC7C9jB,EAAI,EAAGA,EAAIk/H,EAAMj/H,OAAQD,IAC9Bg+H,EAAKqB,KAAK/wC,EAAKxqE,EAAUo7G,EAAMl/H,IAEnCk/H,EAAMj/H,OAAS,EAEf+9H,EAAKiB,aAAa3wC,EAAKxqE,EAAU,gBAAgB,GAO5Ci7G,GACDjgH,EAAGsK,IAAIgF,EAAOtK,EAAU07G,EAAQG,EAAiBA,GAQrDF,IACKV,GAIDjgH,EAAGyN,IAAI6B,EAAOtK,EAAU27G,EAAQE,EAAiBA,IAQ7D,SAASC,EAAYC,GACjB,MAA0B,mBAAfA,EAWIA,IAGRA,EAGX,SAASC,EAAoBC,EAAMpnG,EAAK0f,GACpC,IAAK,IAAIh0B,KAAQsU,EACRonG,EAAKC,eAAe37G,IAAWg0B,IAAUA,EAAOh0B,IACjD0gC,OAAOglB,eAAeg2D,EAAM17G,EAAMvF,EAAGmhH,sBAAsBtnG,EAAKtU,IAK5E,SAAS67G,EAAU7wE,EAAW8wE,EAAWt4D,EAAQyN,GAC7C,IAqCI8qD,EACAC,EArCAv+C,EAAWxM,EAAQwM,SACnBthF,EAAO80E,EAAQ90E,KACf8/H,EAAUhrD,EAAQirD,QAoClBD,GACAF,GAAS5/H,GACT6/H,EAAY7/H,IAGZ4/H,EAAQt+C,GAAYA,GA8Z5B,SAAuBq+C,EAAWt4D,EAAQyN,GAEtC,SAASkrD,EAAUlyC,GACf,OAAImyC,EAAQC,WAAWpyC,GACZA,EAAIqyC,eAGHryC,GAuBhB,IAnBA,IAAI8xC,KAkBAQ,GAAgBT,GAAWU,OAAOh5D,GAC7Bl7D,EAAI,EAAGA,EAAIi0H,EAAa3gI,OAAQ0M,IAAK,CAC1C,IAAIm0H,EAAcF,EAAaj0H,GAC/B,GAAIm0H,EAEA,IADA,IAAIC,EAAYP,EAASM,GAChBl0H,EAAI,EAAGA,EAAIm0H,EAAU9gI,OAAQ2M,IAClC2xH,EAAW6B,EAAOW,EAAUn0H,IAOxC,IAAIpM,EAAO80E,EAAQ90E,KACfA,GACA4/H,EAAMj6H,KAAK3F,GAGf,OAAO4/H,EA7c6BY,CAAab,EAAWt4D,EAAQyN,GAChE+qD,EAAYY,EAAYb,EAAOD,EAAW9wE,EAAWimB,GAGrDx2D,EAAGta,MAAM67H,EAAW,SAAU,SAAU/qD,GAEpC,OADAA,EAAQtzE,QAAUvB,KACXggI,EAAQnrD,KAChB,IAGPx2D,EAAGta,MAAM67H,EAAW,YAAaD,EAAMngI,OAAS,EAAImgI,EAAQ,MAAM,GAGlE,IAAIr9H,EAAYs9H,EAAUt9H,UAY1B,GAXIo9H,IACKG,IACDxhH,EAAGmE,OAAOo9G,EAAWF,GACrBp9H,EAAYs9H,EAAUt9H,WAE1Bs9H,EAAU3B,OAASyB,GAMnBt4D,EAAQ,CACR,IAAK,IAAI9rD,EAAI8rD,EAAO5nE,OAAS,EAAG8b,GAAK,EAAGA,IAAK,CACzC,IAAI04F,EAAQ5sC,EAAO9rD,GACnB+jH,EAAmB/8H,EAAW0xG,EAAM1xG,WAGpC+8H,EAAmBO,EAAW5rB,EAAO,SAAUpwF,GAC3C,OAAOowF,EAAMurB,eAAe37G,KAAU,IAItCo8G,EAAQC,WAAWjsB,IACnBqrB,EACI9B,EAAKkD,cAAcb,GAAW9gH,YAAYxc,UAC1Ci7H,EAAKkD,cAAczsB,GAAOl1F,YAAYxc,WAKlDA,EAAUwc,YAAc8gH,EAQ5B,OALKC,IACDv9H,EAAUo+H,cAAgBC,GAG9BtiH,EAAGuiH,aAAahyE,EAAWgxE,GACpBA,EAuDX,SAASiB,EAAwB98H,GAI7B,IAHA,IAAI+8H,EAAUziH,EAAGmuE,aAAazoF,GAC1B2kB,EAAO3kB,EAAM+a,YACbw5B,EAAM,OAASwoF,EAAU,IACpBvhI,EAAI,EAAGA,EAAImpB,EAAKy1G,UAAU3+H,OAAQD,IAAK,CAC5C,IACIwhI,EAAUh9H,EADH2kB,EAAKy1G,UAAU5+H,IAEtB6kF,EAIJ9rC,GAAOyoF,EACHxhI,EAAImpB,EAAKy1G,UAAU3+H,OAAS,IAC5B84C,GAAO,KAGf,OAAOA,EAAM,IAOjB,SAAS0oF,EAAaz5H,GAClB,OAAOkkD,KAAKC,UAAUnkD,GAElBk/F,QAAQ,UAAW,WACnBA,QAAQ,UAAW,WAmI3B,IAAIw6B,EAAgB,6BACpB,SAASN,EAAcO,GAEnB,IAAIzC,EAAQlB,EAAKkD,cAAcS,GAC3B9K,EAAW8K,EAAY/C,UACV,OAAb/H,IACA2H,EAAoB3uH,OACpBgnH,EAAW8K,EAAY/C,WAI3B,IAAIgD,EA3IR,SAA0B1C,EAAOrI,GAK7B,IAHA,IAAIgL,KACAz6G,EAAO,GAEFpnB,EAAI,EAAGA,EAAI62H,EAAS52H,OAAQD,IAAK,CACtC,IAAIqkB,EAAOwyG,EAAS72H,GAChB8hI,EAAUz9G,EAAO85G,EAAY,UACjC,GAAI2D,KAAW5C,EAAO,CAClB,IAAI6C,EAOAC,EALAD,EADAL,EAAcrgD,KAAKh9D,GACP,QAAUA,EAAO,IAGjB,QAAUo9G,EAAYp9G,GAAQ,KAG9C,IAAI49G,EAAM/C,EAAM4C,GAChB,GAAmB,iBAARG,GAAoBA,EAEvBD,EADAC,aAAe5hI,GAAG6hI,UACLZ,EAAuBW,GAE/BnuH,MAAM2P,QAAQw+G,GACN,KAGA,UAGhB,GAAmB,mBAARA,EAAoB,CAChC,IAAIngH,EAAQ+/G,EAAE5hI,OACd4hI,EAAE17H,KAAK87H,GACPD,EAAa,KAAOlgH,EAAQ,WAO5BkgH,EADoB,iBAARC,EACCR,EAAYQ,GAIZA,EAGjB76G,GADA26G,EAAYA,EAAYC,EAAa,OAiB7C,OAPiB,IAAbH,EAAE5hI,OACU8iF,SAAS37D,GAGT27D,SAAS,IAAK,wBAA0B37D,EAAO,KAA/C27D,CAAqD8+C,GAgFpCM,CAAgBjD,EAAOrI,GACxD8K,EAAY5+H,UAAUo+H,cAAgBS,EAItCA,EAAU5+H,KAAKvC,MAGnB,IAAIwgI,EAA+B,SAAUb,EAAOD,EAAW9wE,EAAWimB,GACtE,IAGInmB,EAAO,+BAHYgxE,GAAaiC,EAAgBjC,EAAW7qD,EAASjmB,KAMpEF,GAAQ,uBAIZA,GAAQ,iCAGR,IAAIkzE,EAAUjC,EAAMngI,OACpB,GAAIoiI,EAAU,EAAG,CACKx9C,EAIlB,IAAIy9C,EAAU,6BACd,GAAgB,IAAZD,EACAlzE,GAAQozE,sBAA4BD,MAEnC,CACDnzE,GAAQ,8BACR,IAAK,IAAInvD,EAAI,EAAGA,EAAIqiI,EAASriI,IACzBmvD,GAAQ,MAAQnvD,EAAIsiI,EAXVz9C,EAsBtB,OAFA11B,GAAQ,IAED4zB,SAAS5zB,EAAT4zB,IA8IX,IAAIy/C,EAAe,MAAMnhD,KAAK,WAAWohD,MAAQ,eAAiB,KACzC,MAAMphD,KAAK,WAAWohD,MAC/C,SAASL,EAAiBjC,EAAW7qD,EAASjmB,GAC1C,IAAIqzE,GAAe,EACnB,IAAK,IAAI91G,KAAY0oD,EACjB,KAAIgpD,EAAgBl6G,QAAQwI,IAAa,GAAzC,CAGA,IAAIxF,EAAOkuD,EAAQ1oD,GACnB,GAAoB,mBAATxF,EAAX,CAGA,IAAIu7G,EAAK7jH,EAAGmhH,sBAAsBE,EAAUp9H,UAAW6pB,GACvD,GAAI+1G,EAAI,CACJ,IAAIC,EAAYD,EAAGn+H,MAEnB,GAAyB,mBAAdo+H,EAA0B,CAC7BJ,EAAanhD,KAAKj6D,KAClBs7G,GAAe,EAEfptD,EAAQ1oD,GAAa,SAAUg2G,EAAWx7G,GACtC,OAAO,WACH,IAAI2+C,EAAMtlE,KAAKysC,OAGfzsC,KAAKysC,OAAS01F,EAEd,IAAI9sH,EAAMsR,EAAK2F,MAAMtsB,KAAMkS,WAK3B,OAFAlS,KAAKysC,OAAS64B,EAEPjwD,GAZM,CAclB8sH,EAAWx7G,IAElB,UAGJy9D,GAIR,OAAO69C,EAGX,SAASjE,EAAmBnwC,EAAKj/B,EAAWpmC,EAAYk3G,EAAWt4D,EAAQk3D,GAOvE,GANAzwC,EAAIswC,aAEAuB,GAAaA,EAAUvB,YACvBtwC,EAAIswC,UAAYuB,EAAUvB,UAAU31H,SAGpC4+D,EACA,IAAK,IAAI9rD,EAAI,EAAGA,EAAI8rD,EAAO5nE,SAAU8b,EAAG,CACpC,IAAI04F,EAAQ5sC,EAAO9rD,GACf04F,EAAMmqB,YACNtwC,EAAIswC,UAAYtwC,EAAIswC,UAAUiC,OAAOpsB,EAAMmqB,UAAUvmF,OAAO,SAAUt4C,GAClE,OAAOuuF,EAAIswC,UAAUx6G,QAAQrkB,GAAK,MAMlD,GAAIkpB,EAIA,IAAK,IAAInF,KAFTu6G,EAAWwE,gBAAgB55G,EAAYomC,EAAWi/B,EAAKywC,GAElC91G,EAAY,CAC7B,IAAI2iB,EAAM3iB,EAAWnF,GACjB,YAAa8nB,EACbkzF,EAAWxwC,EAAKj/B,EAAWvrC,EAAU8nB,GAGrC2zF,EAAajxC,EAAKj/B,EAAWvrC,EAAU8nB,EAAKmzF,GAKxD,IAAIG,EAAQlB,EAAKkD,cAAc5yC,GAC/BA,EAAIw0C,WAAax0C,EAAIswC,UAAUvmF,OAAO,SAAUh0B,GAC5C,OAAoD,IAA7C66G,EAAM76G,EAAO85G,EAAY,kBAiGxC,SAASsC,EAASnrD,GAGd,IAAI51E,GAFJ41E,EAAUA,OAES51E,KACfunE,EAAOqO,EAAQtzE,QACf6lE,EAASyN,EAAQzN,OAGjBymB,EAnlBR,SAAiBj/B,EAAW8wE,EAAWt4D,EAAQyN,GAC3C,IAAIuH,EAAYx8E,GAAGw8E,UACfj4D,EAAQvkB,GAAG0iI,IAAIC,OACnB,GAAIp+G,GAAS9F,EAAGmrD,eAAek2D,EAAWtjD,GAAY,CAElD,GAAI/9D,EAAGmrD,eAAerlD,EAAM0pE,IAAKzR,GAE7B,OADAx8E,GAAGyC,QAAQ,MACJ,KAKXusD,EAAYA,GAAazqC,EAAMq+G,OAGnC,IAAI30C,EAAM4xC,EAAS7wE,EAAW8wE,EAAWt4D,EAAQyN,GAEjD,GAAI1wD,EACA,GAAI9F,EAAGmrD,eAAek2D,EAAWtjD,GAAY,CACzC,IAAIz3B,EAAOxgC,EAAMwgC,KACbA,GACAtmC,EAAGokH,YAAY99E,EAAMkpC,GAMzB1pE,EAAM0pE,IAAMA,OAENxvE,EAAGmrD,eAAerlD,EAAM0pE,IAAKzR,KACnCj4D,EAAM0pE,IAAMA,GAGpB,OAAOA,EAkjBG60C,CAAOzjI,EAAMunE,EAAMY,EAAQyN,GAChC51E,IACDA,EAAOW,GAAGye,GAAGmuE,aAAaqB,IAG9BA,EAAI80C,SAAU,EACVn8D,IACAA,EAAKm8D,SAAU,GAInB,IAAIn6G,EAAaqsD,EAAQrsD,WACC,mBAAfA,GACNg+C,GAA2B,OAAnBA,EAAK23D,WACb/2D,GAAUA,EAAOw7D,KAAK,SAAUtjI,GAC7B,OAAuB,OAAhBA,EAAE6+H,aAOTJ,EAAoBr4H,MAAMmoF,IAAKA,EAAKxoE,MAAOmD,EAAY4+C,OAAQA,IAC/DymB,EAAIswC,UAAYtwC,EAAIw0C,WAAa,MAIrCrE,EAAkBnwC,EAAK5uF,EAAMupB,EAAYg+C,EAAMqO,EAAQzN,OAAQyN,EAAQirD,SAI3E,IAEQ+C,EAFJ/5G,EAAU+rD,EAAQ/rD,QACtB,GAAIA,EAUA,IAAK+5G,KAAkB/5G,EACnB+kE,EAAIg1C,GAAkB/5G,EAAQ+5G,GAKtC,IAAK,IAAI12G,KAAY0oD,EACjB,KAAIgpD,EAAgBl6G,QAAQwI,IAAa,GAAzC,CAGA,IAAIxF,EAAOkuD,EAAQ1oD,GACdyxG,EAAWkF,wBAAwBn8G,EAAMwF,EAAUltB,EAAM4uF,EAAKrnB,IAInEnoD,EAAGta,MAAM8pF,EAAIvrF,UAAW6pB,EAAUxF,GAAM,GAAM,GAIlD,IAAIwlB,EAAS0oC,EAAQ1oC,OAUrB,OATIA,GACI9tB,EAAGmrD,eAAehD,EAAM5mE,GAAGw8E,YAC3Bx8E,GAAGw8E,UAAU2mD,qBAAqBl1C,EAAK1hD,GAOxC0hD,EAWXmyC,EAAQC,WAAa,SAAUnhH,GAC3B,OAAOA,GACAA,EAAYygH,eAAe,cAYtCS,EAAQgD,YAAc,SAAUp0E,EAAW9vC,EAAamkH,GACpD5kH,EAAGuiH,aAAahyE,EAAW9vC,GAI3B,IAFA,IAAIuG,EAAQvG,EAAYq/G,UAAYr/G,EAAYujH,WAAa/9E,OAAOC,KAAK0+E,GACrEC,EAAa3F,EAAK4F,mBAAmBrkH,GAChCvf,EAAI,EAAGA,EAAI8lB,EAAM7lB,OAAQD,IAAK,CACnC,IAAImmD,EAAMrgC,EAAM9lB,GAChB2jI,EAAWx9E,EAAMg4E,EAAY,YAAa,EAC1CwF,EAAWx9E,EAAMg4E,EAAY,WAAauF,EAAmBv9E,KAIrEs6E,EAAQzC,KAAOA,EACfyC,EAAQpB,KAAOrB,EAAKqB,KAQpBoB,EAAQoD,oBAAsB,SAAUC,GAEpC,IADA,IAAIC,KAEAD,EAAQhlH,EAAGklH,SAASF,IAIhBA,IAAU/+E,QACVg/E,EAAM59H,KAAK29H,GAGnB,OAAOC,GAGX,IAAIE,GAGA7tE,QAAS,SAET0+B,MAAO,SACP3yB,QAAS,UACTkQ,OAAQ,UAER6xD,KACJ,SAAS/E,EAAiB7wC,EAAK4wC,EAAO7vE,EAAWvrC,EAAUqgH,GACvD,IAEIC,EAAa,KACbC,EAAgB,GACpB,SAASC,IAEL,OADAD,EAAgBvgH,EAAWq6G,EACpBiG,EAAapG,EAAK4F,mBAAmBt1C,GAGhD41C,EAASjkI,OAAS,EAClB,IAAI8U,EAASmvH,EAET/6G,EAAO+1G,EAAM/1G,KACjB,GAAIA,EAAM,CACN,IAAIo7G,EAAgBN,EAAe96G,GACnC,GAAIo7G,EACAxvH,EAAO5O,MACHgjB,KAAMA,EACNm2G,aAAclB,EAAemG,EAAe,MAAQp7G,UAGvD,GAAa,WAATA,EACD07D,OAKJ,GAAI17D,IAAS60G,EAAKwG,WAAY,CAC1B,IAAInF,EAAOrB,EAAKyG,WAAWpkI,GAAGqkI,aAC9BrF,EAAKl2G,KAAO,SACZpU,EAAO5O,KAAKk5H,OAGQ,iBAATl2G,EACH8O,EAAK0sG,OAAOx7G,IACZpU,EAAO5O,MACHgjB,KAAM,OACNy7G,SAAU3sG,EAAK4sG,QAAQ17G,KAOV,mBAATA,IACR+1G,EAAM/iG,IACNpnB,EAAO5O,MACHgjB,KAAM,SACN3oB,KAAM2oB,EACNm2G,aAAclB,EAAe,SAAU,eAI3CrpH,EAAO5O,KAAK+4H,EAAM4F,QACd37G,KAAM,SACN3oB,KAAM2oB,GACN60G,EAAKyG,WAAWt7G,KAUxC,SAAS47G,EAAiBC,EAAUC,GAChC,GAAID,KAAY9F,EAAO,CACnB,IAAItzF,EAAMszF,EAAM8F,UACLp5F,IAAQq5F,KACdb,GAAcE,KAAiBD,EAAgBW,GAAYp5F,IAQpEszF,EAAM51D,cAKD86D,GAAcE,KAAiBD,EAAgB,eAAgB,GAcpEnF,EAAM/iG,OACLioG,GAAcE,KAAiBD,EAAgB,mBAAoB,IAE7C,IAAvBnF,EAAMjpE,gBAKDmuE,GAAcE,KAAiBD,EAAgB,iBAAkB,GAG1EU,EAAgB,uBAAwB,UA0BxC,IAAInuE,EAAQsoE,EAAMtoE,MAsBlB,OArBIA,GACI9iD,MAAM2P,QAAQmzC,IACVA,EAAM32D,QAAU,KACfmkI,GAAcE,KAAiBD,EAAgB,OAASztE,EAAM,GAC/DwtE,EAAWC,EAAgB,OAASztE,EAAM,GACtCA,EAAM32D,OAAS,IACfmkI,EAAWC,EAAgB,QAAUztE,EAAM,KAW3DmuE,EAAgB,MAAO,UACvBA,EAAgB,MAAO,UACvBA,EAAgB,OAAQ,UAEjBhwH,EAGX1U,GAAGE,MAAQkgI,EAEX7gI,EAAOE,SACH2jB,QAAS,SAAUo8G,GAEf,OADAA,EAAaD,EAAWC,GACjB/rH,MAAM2P,QAAQo8G,IAEzBqF,WAAYzE,EAAQgD,YACpB0B,oBAAuC7D,EACvCI,cAAAA,EACAD,YAAAA,EACA7B,WAAYA,uICxrChBz/H,EAAQ,aACR,IAAMilI,EAAajlI,EAAQ,sBACrB2e,EAAK3e,EAAQ,QAIbklI,EAAY,mBAElB,SAASC,EAAM9kI,GACX,OAAOA,EAGX,SAAS+kI,EAAYjuE,EAAKnR,GACtB,OAAOmR,EAAInR,KAASmR,EAAInR,OAG5B,SAASq/E,EAAmBC,GACxB,OAAO,SAAU9kI,GACb,MAAsB,mBAAXA,EAEA8kI,EAAS9kI,GAEb,SAAUH,GACb,OAAOilI,EAASjlI,EAAMG,KAKlC,SAAS+kI,EAAsBC,EAAeF,EAAUG,GACpD,OAAO,SAAUjlI,GAMb,OAAO,SAAUH,GACb,OAAOilI,EAASjlI,EAAMG,KAKlC,IAAIklI,EAAoBH,EAAqBpsG,KAAK,MAAMurD,GAOxD,SAASihD,EAAkB38G,GACvB,OAAOu8G,EAAqBpsG,KAAK,MAAMurD,GAW3C,IAAIkhD,EAAsBD,IACtBE,EAAsBF,IAI1B,SAASG,EAAezlI,EAAMolI,GAK1B,OAAOL,EAAW/kI,EAAM6kI,GA4J5B,IAAIa,EAAUV,EAAkB,SAAUhlI,EAAMd,GAI5C,IAAIunE,EAAOnoD,EAAGklH,SAASxjI,GACnBymE,IAASliB,SACTkiB,EAAO,MAGX,IAAI74C,GACA1uB,KAAAA,EACAsC,QAASilE,EACTzmE,KAAAA,EACA+/H,SAAS,GAEThhI,EAAQiB,EAAK6kI,GACjB,GAAI9lI,EAAO,CACP,IAAI4mI,EAAiB5mI,EAAM6uB,MACvB+3G,GAEArnH,EAAG21F,MAAMrmF,EAAO+3G,GAEpB3lI,EAAK6kI,QAAav+H,EAoBtB,OAjBUzG,GAAGE,MAAM6tB,KAuJvB,SAASg4G,EAAuBC,EAAcC,EAAgBC,GAC1D,OAAOF,EAAa,SAAU7lI,EAAMgmI,GAChC,IAAIjnI,EAAQ0mI,EAAczlI,GAC1B,GAAIjB,EAAO,CACP,IAAIiF,OAAyBsC,IAAhBy/H,EAA6BA,EAAcC,EAExDjB,EADYA,EAAWhmI,EAAO,SACZ,UAAU+mI,GAAkB9hI,IAEnD8hI,GAGP,SAASG,EAAsBJ,GAC3B,OAAOA,EAAaf,GAyBxB,IAAIoB,EAAsDD,EAAsBjB,GAqB5Eh3C,EAAmB43C,EAAsBP,EAAmB,oBAsB5Dl/C,EAAyC8/C,EAAsBV,GAuB/Dt3C,EAAiB23C,EAAsBJ,EAAqB,kBAqB5DW,EAAqDF,EAAsBjB,GAuB3EoB,EAAgDH,EAAsBjB,GAqBtE5+C,EAA8C6/C,EAAsBV,GAsBpEc,EAAyCJ,EAAsBV,GAqB/Dl/C,EAAyC4/C,EAAsBV,GAyDnE1lI,GAAGymI,WAAalnI,EAAOE,SACnBomI,QAAAA,EACAa,SAnSJ,SAAmBC,EAAoBljH,EAAUmjH,GAC7C,IAAI3xD,EAAU,KACd,SAAS4xD,EAAYC,EAAWrjH,EAAUmjH,GACtC,IAAI1nI,EAAQ0mI,EAAckB,EAAU5nH,aACpC,GAAIhgB,EAAO,CACP,IACI0pB,EAAas8G,EADEA,EAAWhmI,EAAO,SACK,eAvRtD,SAAsBiB,EAAMyoB,EAAYnF,EAAUwxD,EAAS2xD,EAAM1nI,GAC7D,IAAI6nI,EACA9xD,IAGA8xD,GAFAA,EACuBhC,EAAWiC,sBAAsB/xD,KAC3BA,GAEjC,IAAIgyD,EAAiBr+G,EAAWnF,GAC5BO,EAAOvF,EAAG21F,MAAM6yB,MAAsBF,OAG1C,GADeH,IAASA,EAAK79G,KAAO69G,EAAK16G,KAUjC06G,EAAK79G,MACL/E,EAAK+E,IAAM69G,EAAK79G,KAEhB69G,EAAK16G,MACLlI,EAAKkI,IAAM06G,EAAK16G,SAGnB,CAWD,IAAIyyG,OAAel4H,EAEnB,GAAImgI,EAEIA,EAAKM,cAGLvI,EAhFhB,SAAoCuI,GAChC,IAAI/iI,EACJ,IACIA,EAAQ+iI,IAEZ,MAAO16B,GAEH,OAAO06B,EAEX,MAAqB,iBAAV/iI,GAAgC,OAAVA,EAEtBA,EAKA+iI,EAgEgBC,CAA0BP,EAAKM,kBAQjD,CAED,IAAIE,EAAsBloI,EAAM2pB,UAAY3pB,EAAM2pB,QArE9D,SAAqC1oB,GACjC,IAAIknI,EACJ,IACIA,EAAW,IAAIlnI,EAEnB,MAAOqsG,GAIH,SAEJ,OAAO66B,EA0D6DC,CAA2BnnI,IACnFinI,EAAoBzH,eAAel8G,KAGnCk7G,EAAeyI,EAAoB3jH,IA0B3CO,EAAK6E,QAAU81G,EAGnB/1G,EAAWnF,GAAYO,GAgMfujH,CAAYT,EAAU5nH,YAAa0J,EAAYnF,EAAUwxD,EAAS2xD,EAAM1nI,IAGhF,QAAwB,IAAbukB,EAEP,OADAwxD,EAAU0xD,EACHE,EAGPA,EAAWF,EAAoBljH,EAAUmjH,IAqR7CP,kBAAAA,EACAl4C,iBAAAA,EACA7H,KAAAA,EACA8H,eAAAA,EACAk4C,iBAAAA,EACAC,YAAAA,EACAhgD,UAAAA,EACAigD,KAAAA,EACAhgD,KAAAA,EACAhf,OAzBJ,WAEI,IADA,IAAIA,KACK7nE,EAAI,EAAGA,EAAI2S,UAAU1S,OAAQD,IAClC6nE,EAAO7nE,GAAK2S,UAAU3S,GAE1B,OAAO,SAAUQ,GACb,IAAIjB,EAAQ0mI,EAAczlI,GACtBjB,IACAgmI,EAAWhmI,EAAO,SAASsoE,OAASA,iGCvqBhD,IAAI/oD,EAAK3e,EAAQ,QAoBjB,SAAS83B,EAAMq/B,GACX,GAAI,cAAeA,EACf,OAAOA,EAEXx4C,EAAGta,MAAM8yD,EAAK,YAAa,MAAM,GAIjC,IAFA,IAAIrrC,GAAa,EACb+4B,EAAOD,OAAOC,KAAKsS,GACdt3D,EAAI,EAAGA,EAAIglD,EAAK/kD,OAAQD,IAAK,CAClC,IAAImmD,EAAMnB,EAAKhlD,GACX4rC,EAAM0rB,EAAInR,GAEd,IAAa,IAATva,EACAA,IAAQ3f,EACRqrC,EAAInR,GAAOva,OAGX,GAAmB,iBAARA,EACP3f,EAAY2f,OAEX,GAAmB,iBAARA,GAAoBvlB,OAAOwhH,UAAUvhH,WAAW6/B,IAC5D,SAGR,IAAI2hF,EAAa,GAAKl8F,EAClBua,IAAQ2hF,GAKRhpH,EAAGta,MAAM8yD,EAAKwwE,EAAY3hF,GAGlC,OAAOmR,EAGXr/B,EAAK0sG,OAAS,SAAUoD,GACpB,OAAOA,GAAYA,EAAS/H,eAAe,cAS/C/nG,EAAK4sG,QAAU,SAAUmD,GACrB,GAAIA,EAAQC,UACR,OAAOD,EAAQC,UAEnB,IAAIC,EAAQF,EAAQC,aACpB,IAAK,IAAIvoI,KAAQsoI,EAAS,CACtB,IAAIxjI,EAAQwjI,EAAQtoI,GAChB2mB,OAAOwhH,UAAUrjI,IACjB0jI,EAAM/hI,MAAOzG,KAAAA,EAAM8E,MAAAA,IAI3B,OADA0jI,EAAMlvF,KAAM,SAAWxvC,EAAGmD,GAAM,OAAOnD,EAAEhF,MAAQmI,EAAEnI,QAC5C0jI,GAgBXtoI,EAAOE,QAAUO,GAAG43B,KAAOA,sCC9F3B,IAAMgpB,EAAe9gD,EAAQ,oBACvB8pD,EAAe9pD,EAAQ,oBAOzBgoI,OAAA,EAYJ9nI,GAAGi1G,aAAe,SAAUv1G,EAAGoE,EAAG0lC,EAAGu+F,GACjC3nI,KAAKV,EAAIA,GAAK,EACdU,KAAK0D,EAAIA,GAAK,EACd1D,KAAKopC,EAAIA,GAAK,EACdppC,KAAK2nI,UAAYA,GAAa,GAQlCn+E,EAAau1D,wBAA0B,SAAUC,GAC7C,IAAIt8C,EAAK1iE,KACT,GAAG0iE,EAAGklE,gBAAkB5oB,EAAxB,CAGAt8C,EAAGklE,cAAgB5oB,EACnB,IAAIj3D,EAAYnoD,GAAG+e,SAASwC,eAC5B4mC,EAAUlpC,gBAAgB6jD,GACtBA,EAAGklE,eACHllE,EAAGmlE,8BACHnlE,EAAGolE,cAAgB,EACnB//E,EAAUpG,eAAe+gB,KAEzBA,EAAGqlE,gCACHrlE,EAAGolE,cAAgB,EACnB//E,EAAU3mC,iBAAiBshD,MAanClZ,EAAay1D,yBAA2B,SAAUx7C,GAC1CzjE,KAAKgoI,iBAAmBvkE,IACxBzjE,KAAKgoI,eAAiBvkE,IAQ9Bja,EAAay+E,uBAAyB,WAClCroI,GAAG06B,KAAKC,OAAOlB,iBAAiB,UAAW,SAAU+yE,GACjD5rD,EAAauT,cAAc,IAAIn0D,GAAG8uG,MAAM0D,cAAchG,EAAEC,SAAS,IACjED,EAAE73C,kBACF63C,EAAE87B,mBACH,GACHtoI,GAAG06B,KAAKC,OAAOlB,iBAAiB,QAAS,SAAU+yE,GAC/C5rD,EAAauT,cAAc,IAAIn0D,GAAG8uG,MAAM0D,cAAchG,EAAEC,SAAS,IACjED,EAAE73C,kBACF63C,EAAE87B,mBACH,IAGP1+E,EAAaq+E,4BAA8B,WACvC,IAAIv0F,EAAIsP,OAAQ8f,EAAK1iE,KACrB0iE,EAAGylE,cAAgB,IAAIvoI,GAAGi1G,aAC1BnyC,EAAG0lE,kBAAoB90F,EAAE+0F,mBAAqB/0F,EAAEg1F,uBAG5C1oI,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAI0wG,yBAC9B7lE,EAAG0lE,kBAAoBxlF,OAAO0lF,wBAElC,IAAIE,EAAoB9lE,EAAG0lE,oBAAsB90F,EAAE+0F,kBAAqB,eAAiB,oBACrFI,EAAK53E,UAAUC,WACf,UAAU8vB,KAAK6nD,IAAQ,MAAM7nD,KAAK6nD,IAAO7oI,GAAGi4B,IAAI23B,cAAgB5vD,GAAGkqG,mBACnEpnC,EAAGgmE,QAAU,GAGjBhB,EAAoBhlE,EAAGimE,cAAc9vG,KAAK6pC,GAC1CpvB,EAAEja,iBAAiBmvG,EAAkBd,GAAmB,IAG5Dl+E,EAAau+E,8BAAgC,WACzC,IAAIz0F,EAAIsP,OACJ4lF,EADiBxoI,KACMooI,oBAAsB90F,EAAE+0F,kBAAqB,eAAiB,oBACrFX,GACAp0F,EAAE9Z,oBAAoBgvG,EAAkBd,GAAmB,IAInEl+E,EAAam/E,cAAgB,SAAUjiH,GACnC,IAAIg8C,EAAK1iE,KAAMszC,EAAIsP,OACnB,GAAK8f,EAAGklE,cAAR,CAGA,IAAIgB,EAAgBlmE,EAAGylE,cAEnB7oI,OAAA,EAAGoE,OAAA,EAAG0lC,OAAA,EAEV,GAAIs5B,EAAG0lE,oBAAsBxlF,OAAOylF,kBAAmB,CACnD,IAAIQ,EAAoBniH,EAAA,6BACxBpnB,EAAIojE,EAAGomE,YAAcD,EAAkBvpI,EAAI,GAC3CoE,EAAIg/D,EAAGomE,YAAcD,EAAkBnlI,EAAI,GAC3C0lC,EAA0B,GAAtBy/F,EAAkBz/F,OAEtB9pC,EAAKonB,EAAA,MAAqB,GAAM,KAChChjB,GAAMgjB,EAAA,KAAoB,GAAM,KAChC0iB,EAAK1iB,EAAA,MAAqB,GAAM,KAGpC,GAAI9mB,GAAG6iD,KAAKS,WAAY,CACpB,IAAIoiB,EAAMhmE,EACVA,GAAKoE,EACLA,EAAI4hE,EAERsjE,EAActpI,EAAIA,EAClBspI,EAAcllI,EAAIA,EAClBklI,EAAcx/F,EAAIA,EAElBw/F,EAAcjB,UAAYjhH,EAAUqiH,WAAa98E,KAAKxK,MAEtD,IAAIunF,EAAOJ,EAActpI,EAvIL,KAwIhBg0C,EAAE21F,aACFL,EAActpI,GAAKspI,EAAcllI,EACjCklI,EAAcllI,EAAIslI,IA5IH,KA6IR11F,EAAE21F,aACTL,EAActpI,EAAIspI,EAAcllI,EAChCklI,EAAcllI,GAAKslI,GA9IE,MA+Id11F,EAAE21F,cACTL,EAActpI,GAAKspI,EAActpI,EACjCspI,EAAcllI,GAAKklI,EAAcllI,GAGjC9D,GAAGi4B,IAAImF,KAAOp9B,GAAGi4B,IAAI6vE,YACrB9nG,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAI0wG,yBAC9BK,EAActpI,GAAKspI,EAActpI,EACjCspI,EAAcllI,GAAKklI,EAAcllI,2EC5JzC,IAAMmE,EAAQnI,EAAQ,aAChBm4B,EAAMn4B,EAAQ,WACd8gD,EAAe9gD,EAAQ,oBAEvBwpI,EAAgBrhI,EAAMqhI,cAExBC,EAAQvpI,GAAGqE,KAKXulD,GACA4/E,eAAe,EAEfC,kBAAkB,EAElBC,eAAgB1pI,GAAGqE,GAAG,EAAE,GACxBslI,gBAAiB3pI,GAAGqE,GAAG,EAAE,GAEzBulI,iBACAC,qBAAsB,EAEtBv4B,YACAw4B,uBAEAC,eAAgB,EAChBC,YAAa,EAEbhC,eAAe,EACfI,eAAgB,GAChBc,YAAa,EACbhB,cAAe,EACfK,cAAe,KACfC,kBAAmB,KAEnByB,gBAxBe,WA4BX,IAHA,IAAIC,EAAO9pI,KAAK2pI,eACZloF,EAAM7hD,GAAGi4B,IAAI4pB,MAERliD,EAAI,EAAGA,EAAIS,KAAK4pI,YAAarqI,IAAK,CACvC,KAAa,EAAPuqI,GAEF,OADA9pI,KAAK2pI,gBAAmB,GAAKpqI,EACtBA,EAGP,IAAIm0D,EAAQ1zD,KAAKkxG,SAAS3xG,GAC1B,GAAIkiD,EAAMiS,EAAM8oD,cAAgB0sB,EAG5B,OAFAlpI,KAAK+pI,oBAAoBxqI,UAClBS,KAAK0pI,oBAAoBh2E,EAAMi+C,SAC/BpyG,EAGfuqI,IAAS,EAIb,OAAQ,GAGZC,oBAhDe,SAgDM1oH,GACjB,KAAIA,EAAQ,GAAKA,GAASrhB,KAAK4pI,aAA/B,CAGA,IAAIE,EAAO,GAAKzoH,EAChByoH,GAAQA,EACR9pI,KAAK2pI,gBAAkBG,IAG3BE,QAAS,KAMTC,mBA/De,SA+DKx4B,GAIhB,IAHA,IAAIiI,OAAA,EAAiBwwB,OAAA,EAAUC,OAAA,EAC3BC,KAAoBC,EAAkBrqI,KAAK0pI,oBAC3CjoF,EAAM5pB,EAAI4pB,MACLliD,EAAI,EAAGwuB,EAAM0jF,EAAQjyG,OAAQD,EAAIwuB,EAAKxuB,IAK3C,GAAa,MAFL8qI,EADRF,GADAzwB,EAAWjI,EAAQlyG,IACAoyG,SAGA,CACf,IAAI24B,EAActqI,KAAK6pI,kBACvB,IAAqB,IAAjBS,EAAoB,CACpB1qI,GAAGgB,MAAM,KAAM0pI,GACf,UAGJJ,EAAWlqI,KAAKkxG,SAASo5B,GAAe,IAAI1qI,GAAG28G,MAAM7C,EAAS+C,OAAOn9G,EAAGo6G,EAAS+C,OAAO/4G,EAAGg2G,EAAS/H,UAC3F6K,cAAgB/6D,EACzByoF,EAASjtB,cAAcvD,EAASgD,YAChC2tB,EAAgBF,GAAWG,EAC3BF,EAAc1kI,KAAKwkI,GAG3B,GAAIE,EAAc5qI,OAAS,EAAG,CAC1BQ,KAAKgqI,QAAQO,yBAAyBH,GACtC,IAAI/vE,EAAa,IAAIz6D,GAAG8uG,MAAMoC,WAAWs5B,GACzC/vE,EAAW42C,WAAarxG,GAAG8uG,MAAMoC,WAAWgB,MAC5CtxD,EAAauT,cAAcsG,KAQnCmwE,kBAlGe,SAkGI/4B,GAIf,IAHA,IAAIiI,OAAA,EAAUr4F,OAAA,EAAO8oH,OAAA,EACjBC,KAAoBK,EAAazqI,KAAKkxG,SACtCzvD,EAAM5pB,EAAI4pB,MACLliD,EAAI,EAAGwuB,EAAM0jF,EAAQjyG,OAAQD,EAAIwuB,EAAKxuB,IAE3C4qI,GADAzwB,EAAWjI,EAAQlyG,IACAoyG,QAGN,OAFbtwF,EAAQrhB,KAAK0pI,oBAAoBS,KAM7BM,EAAWppH,KACXopH,EAAWppH,GAAO27F,UAAUtD,EAAS+C,QACrCguB,EAAWppH,GAAO47F,cAAcvD,EAASgD,YACzC+tB,EAAWppH,GAAOm7F,cAAgB/6D,EAClC2oF,EAAc1kI,KAAK+kI,EAAWppH,KAGtC,GAAI+oH,EAAc5qI,OAAS,EAAG,CAC1BQ,KAAKgqI,QAAQO,yBAAyBH,GACtC,IAAI/vE,EAAa,IAAIz6D,GAAG8uG,MAAMoC,WAAWs5B,GACzC/vE,EAAW42C,WAAarxG,GAAG8uG,MAAMoC,WAAWiB,MAC5CvxD,EAAauT,cAAcsG,KAQnCqwE,iBAlIe,SAkIGj5B,GACd,IAAI24B,EAAgBpqI,KAAK2qI,2BAA2Bl5B,GACpD,GAAI24B,EAAc5qI,OAAS,EAAG,CAC1BQ,KAAKgqI,QAAQO,yBAAyBH,GACtC,IAAI/vE,EAAa,IAAIz6D,GAAG8uG,MAAMoC,WAAWs5B,GACzC/vE,EAAW42C,WAAarxG,GAAG8uG,MAAMoC,WAAWkB,MAC5CxxD,EAAauT,cAAcsG,GAE/Br6D,KAAKwpI,cAAchqI,OAAS,GAOhCorI,oBAjJe,SAiJMn5B,GACjB,IAAI24B,EAAgBpqI,KAAK2qI,2BAA2Bl5B,GACpD,GAAI24B,EAAc5qI,OAAS,EAAG,CAC1BQ,KAAKgqI,QAAQO,yBAAyBH,GACtC,IAAI/vE,EAAa,IAAIz6D,GAAG8uG,MAAMoC,WAAWs5B,GACzC/vE,EAAW42C,WAAarxG,GAAG8uG,MAAMoC,WAAWgJ,UAC5Ct5D,EAAauT,cAAcsG,GAE/Br6D,KAAKwpI,cAAchqI,OAAS,GAQhCmrI,2BAjKe,SAiKal5B,GAExB,IADA,IAAIiI,OAAA,EAAUr4F,OAAA,EAAO8oH,OAAA,EAASC,KAAoBK,EAAazqI,KAAKkxG,SAAU25B,EAAoB7qI,KAAK0pI,oBAC9FnqI,EAAI,EAAGwuB,EAAM0jF,EAAQjyG,OAAQD,EAAGwuB,EAAKxuB,IAK7B,OAFb8hB,EAAQwpH,EADRV,GADAzwB,EAAWjI,EAAQlyG,IACAoyG,WAMf84B,EAAWppH,KACXopH,EAAWppH,GAAO27F,UAAUtD,EAAS+C,QACrCguB,EAAWppH,GAAO47F,cAAcvD,EAASgD,YACzC0tB,EAAc1kI,KAAK+kI,EAAWppH,IAC9BrhB,KAAK+pI,oBAAoB1oH,UAClBwpH,EAAkBV,IAGjC,OAAOC,GAQXU,uBA3Le,SA2LSzrH,GAUpB,IAAI0rH,EAAUpxG,SAASg1B,gBACnBq8E,EAAapoF,OAAOC,YAAckoF,EAAQjoF,WAC1CmoF,EAAYroF,OAAOG,YAAcgoF,EAAQ/nF,UAC7C,GAAI3jC,EAAQsjC,sBAAuB,CAC/B,IAAID,EAAMrjC,EAAQsjC,wBAClB,OACIlE,KAAMiE,EAAIjE,KAAOusF,EACjBxsF,IAAKkE,EAAIlE,IAAMysF,EACftnI,MAAO++C,EAAI/+C,MACXC,OAAQ8+C,EAAI9+C,QAIhB,OAAIyb,aAAmB01D,mBAEft2B,KAAMusF,EACNxsF,IAAKysF,EACLtnI,MAAO0b,EAAQ1b,MACfC,OAAQyb,EAAQzb,SAKhB66C,KAAMusF,EACNxsF,IAAKysF,EACLtnI,MAAOoiB,SAAS1G,EAAQi/B,MAAM36C,OAC9BC,OAAQmiB,SAAS1G,EAAQi/B,MAAM16C,UAW/CsnI,YA1Oe,SA0OFx3E,GAIT,IAHA,IAAIy3E,EAAW,KACXC,EAAkBprI,KAAKwpI,cACvBnxG,EAAKq7B,EAAMi+C,QACNpyG,EAAI6rI,EAAgB5rI,OAAS,EAAGD,GAAK,EAAGA,IAC7C,GAAI6rI,EAAgB7rI,GAAGoyG,UAAYt5E,EAAI,CACnC8yG,EAAWC,EAAgB7rI,GAC3B,MAKR,OAFK4rI,IACDA,EAAWz3E,GACRy3E,GAOXE,YA7Pe,SA6PF33E,GAIT,IAHA,IAAIntC,GAAO,EACP6kH,EAAkBprI,KAAKwpI,cACvBnxG,EAAKq7B,EAAMi+C,QACNpyG,EAAI6rI,EAAgB5rI,OAAS,EAAGD,GAAK,EAAGA,IAC7C,GAAI6rI,EAAgB7rI,GAAGoyG,UAAYt5E,EAAI,CACnC+yG,EAAgB7rI,GAAKm0D,EACrBntC,GAAO,EACP,MAGHA,IACG6kH,EAAgB5rI,QAAU,GAC1B4rI,EAAgB1lI,KAAKguD,IAErB03E,EAAgBprI,KAAKypI,sBAAwB/1E,EAC7C1zD,KAAKypI,sBAAwBzpI,KAAKypI,qBAAuB,GAAK,MAY1E6B,aAzRe,SAyRDrgC,EAAIC,EAAI9lG,GAClB,IAAImmI,EAAcvrI,KAAKspI,eACnBvgB,EAAW/oH,KAAKgqI,QAAQwB,wBAAwBvgC,EAAIC,EAAI9lG,GACxDsuD,EAAQ,IAAI9zD,GAAG28G,MAAMwM,EAASzpH,EAAIypH,EAASrlH,EAAG,GAIlD,OAHAgwD,EAAMupD,cAAcsuB,EAAYjsI,EAAGisI,EAAY7nI,GAC/C6nI,EAAYjsI,EAAIypH,EAASzpH,EACzBisI,EAAY7nI,EAAIqlH,EAASrlH,EAClBgwD,GAUX+3E,cA1Se,SA0SA1iB,EAAU3jH,EAAKqpG,GAC1B,IAAIi9B,EAAc1rI,KAAKupI,gBACnBjvE,EAAa,IAAI16D,GAAG8uG,MAAMF,WAAWC,GAMzC,OALAn0C,EAAWk1C,eAAek8B,EAAYpsI,EAAGosI,EAAYhoI,GACrDgoI,EAAYpsI,EAAIypH,EAASzpH,EACzBosI,EAAYhoI,EAAIqlH,EAASrlH,EACzB1D,KAAKgqI,QAAQ2B,8BAA8BD,EAAatmI,GACxDk1D,EAAW+0C,YAAYq8B,EAAYpsI,EAAGosI,EAAYhoI,GAC3C42D,GASXsxE,gBA3Te,SA2TE1/G,EAAO9mB,GACpB,OAAmB,MAAf8mB,EAAM2/G,OACEvsI,EAAG4sB,EAAM2/G,MAAOnoI,EAAGwoB,EAAM4/G,QAOjC1mI,EAAIq5C,MAAQ9kB,SAAS+0B,KAAKq9E,WAC1B3mI,EAAIo5C,KAAO7kB,SAAS+0B,KAAKnP,WAErBjgD,EAAG4sB,EAAM8/G,QAAStoI,EAAGwoB,EAAM+/G,WASvCC,kBAhVe,SAgVIhgH,EAAO9mB,GAMtB,IALA,IAAI2rG,KAAeo7B,EAAUnsI,KAAKgqI,QAC9BoC,OAAA,EAAa14E,OAAA,EAAO24E,OAAA,EACpBd,EAAcvrI,KAAKspI,eAEnB9pI,EAAS0sB,EAAMogH,eAAe9sI,OACzBD,EAAI,EAAGA,EAAIC,EAAQD,IAExB,GADA6sI,EAAclgH,EAAMogH,eAAe/sI,GAClB,CACb,IAAIwpH,OAAA,EAEAA,EADAlxF,EAAIkyE,uBAAyBlyE,EAAI23B,YACtB28E,EAAQX,wBAAwBY,EAAYP,MAAOO,EAAYN,MAAO1mI,EAAK+jI,GAE3EgD,EAAQX,wBAAwBY,EAAYJ,QAASI,EAAYH,QAAS7mI,EAAK+jI,GAChE,MAA1BiD,EAAYG,YACZ74E,EAAQ,IAAI9zD,GAAG28G,MAAMwM,EAASzpH,EAAGypH,EAASrlH,EAAG0oI,EAAYG,YAEzDF,EAAcrsI,KAAKkrI,YAAYx3E,GAAOC,cACtCD,EAAMupD,cAAcovB,EAAY/sI,EAAG+sI,EAAY3oI,GAC/C1D,KAAKqrI,YAAY33E,KAEjBA,EAAQ,IAAI9zD,GAAG28G,MAAMwM,EAASzpH,EAAGypH,EAASrlH,IACpCu5G,cAAcsuB,EAAYjsI,EAAGisI,EAAY7nI,GAEnD6nI,EAAYjsI,EAAIypH,EAASzpH,EACzBisI,EAAY7nI,EAAIqlH,EAASrlH,EACzBqtG,EAASrrG,KAAKguD,GAGtB,OAAOq9C,GAOXpjD,oBApXe,SAoXMtuC,GACjB,IAAGrf,KAAKqpI,iBAAR,CAEArpI,KAAKgqI,QAAUpqI,GAAG6iD,KAClB,IAAI+pF,EAAcxsI,KAEdysI,EAAc50G,EAAIsjD,SAClBuxD,EAAgB,UAAW70G,EAAIo2B,aAC/B0+E,EAAkB,YAAa90G,EAAIo2B,aAQvC,GAAIy+E,EAAc,CAQTD,IACD7pF,OAAOvpB,iBAAiB,YAAa,WACjCmzG,EAAYpD,eAAgB,IAC7B,GAEHxmF,OAAOvpB,iBAAiB,UAAW,SAAUnN,GACzC,GAAKsgH,EAAYpD,cAAjB,CAGAoD,EAAYpD,eAAgB,EAE5B,IAAIhkI,EAAMonI,EAAY1B,uBAAuBzrH,GACzC0pG,EAAWyjB,EAAYZ,gBAAgB1/G,EAAO9mB,GAClD,IAAKxF,GAAGgD,KAAKwC,EAAIq5C,KAAMr5C,EAAIo5C,IAAKp5C,EAAIzB,MAAOyB,EAAIxB,QAAQihF,SAASkkC,GAAU,CACtEyjB,EAAY9B,kBAAkB8B,EAAYlB,aAAaviB,EAASzpH,EAAGypH,EAASrlH,EAAG0B,KAE/E,IAAIk1D,EAAakyE,EAAYf,cAAc1iB,EAAS3jH,EAAIxF,GAAG8uG,MAAMF,WAAW2B,IAC5E71C,EAAWu1C,UAAU3jF,EAAM4jF,QAC3BtvD,EAAauT,cAAcuG,OAEhC,IA6BP,IAzBA,IAAIk0C,EAAa5uG,GAAG8uG,MAAMF,WACtBo+B,IACCH,IAAgB,YAAaj+B,EAAW0B,KAAM,SAAUhkF,EAAOouC,EAAYyuD,EAAU3jH,GAClFonI,EAAYpD,eAAgB,EAC5BoD,EAAYvC,oBAAoBuC,EAAYlB,aAAaviB,EAASzpH,EAAGypH,EAASrlH,EAAG0B,KACjFia,EAAQwqF,WAEX4iC,IAAgB,UAAWj+B,EAAW2B,GAAI,SAAUjkF,EAAOouC,EAAYyuD,EAAU3jH,GAC9EonI,EAAYpD,eAAgB,EAC5BoD,EAAY9B,kBAAkB8B,EAAYlB,aAAaviB,EAASzpH,EAAGypH,EAASrlH,EAAG0B,QAElFqnI,IAAgB,YAAaj+B,EAAW4B,KAAM,SAAUlkF,EAAOouC,EAAYyuD,EAAU3jH,GAClFonI,EAAYhC,mBAAmBgC,EAAYlB,aAAaviB,EAASzpH,EAAGypH,EAASrlH,EAAG0B,KAC3EonI,EAAYpD,eACb9uE,EAAWu1C,UAAU,SAG5B,aAAcrB,EAAW6B,OAAQ,SAAUnkF,EAAOouC,GAC/CA,EAAW20C,cAAc,EAAG/iF,EAAM2gH,eAGrC,iBAAkBr+B,EAAW6B,OAAQ,SAAUnkF,EAAOouC,GACnDA,EAAW20C,cAAc,GAAmB,IAAhB/iF,EAAMkyF,WAGjC7+G,EAAI,EAAGA,EAAIqtI,EAAsBptI,SAAUD,EAAG,CACnD,IAAIR,EAAQ6tI,EAAsBrtI,GAC9BR,GAAO,WACP,IAAIE,EAAOF,EAAM,GACb2pB,EAAO3pB,EAAM,GACb44C,EAAU54C,EAAM,GACpBsgB,EAAQga,iBAAiBp6B,EAAM,SAAUitB,GACrC,IAAI9mB,EAAMonI,EAAY1B,uBAAuBzrH,GACzC0pG,EAAWyjB,EAAYZ,gBAAgB1/G,EAAO9mB,GAC9Ck1D,EAAakyE,EAAYf,cAAc1iB,EAAU3jH,EAAKsjB,GAC1D4xC,EAAWu1C,UAAU3jF,EAAM4jF,QAE3Bn4D,EAAQzrB,EAAOouC,EAAYyuD,EAAU3jH,GAErCo7C,EAAauT,cAAcuG,GAC3BpuC,EAAMqoC,kBACNroC,EAAMg8G,mBACP,GAfI,IAoBnB,GAAItlF,OAAOiO,UAAUi8E,iBAAkB,CACnC,IAAIC,GACAC,cAAsBR,EAAYvC,mBAClCgD,cAAsBT,EAAYhC,kBAClC0C,YAAsBV,EAAY9B,iBAClCyC,gBAAsBX,EAAY5B,qBALHryG,EAAA,SAO1B68E,GACL,IAAI/6C,EAAa0yE,EAAkB33B,GACnC/1F,EAAQga,iBAAiB+7E,EAAW,SAAUlpF,GAC1C,IAAI9mB,EAAMonI,EAAY1B,uBAAuBzrH,GAC7Cja,EAAIq5C,MAAQ9kB,SAASg1B,gBAAgBo9E,WACrC3mI,EAAIo5C,KAAO7kB,SAASg1B,gBAAgBpP,UAEpC8a,EAAW93D,KAAKiqI,GAAcA,EAAYlB,aAAap/G,EAAM8/G,QAAS9/G,EAAM+/G,QAAS7mI,KACrF8mB,EAAMqoC,oBACP,IATP,IAAK,IAAI6gD,KAAa23B,EAAmBx0G,EAAhC68E,GAcTu3B,GAAgB,WAChB,IAAIS,GACAC,WAAc,SAAUC,GACpBd,EAAYvC,mBAAmBqD,GAE3BjuH,EAAQwqF,SAGhB0jC,UAAa,SAAUD,GACnBd,EAAYhC,kBAAkB8C,IAElCE,SAAY,SAAUF,GAClBd,EAAY9B,iBAAiB4C,IAEjCG,YAAe,SAAUH,GACrBd,EAAY5B,oBAAoB0C,KAIpCI,OAAA,EAmCJ,IAAK,IAAIt4B,KAlCLx1G,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAI81G,8BAC9BP,GACIQ,aAAcR,EAAgBC,WAC9BQ,YAAaT,EAAgBG,UAC7BO,WAAYV,EAAgBI,SAC5BO,cAAeX,EAAgBK,aAEnCC,EAAqB,SAASt4B,GAC1B,IAAIz9D,EAAUy1F,EAAgBh4B,GAC9B44B,GAAG54B,GAAW,SAASlpF,GACnB,GAAKA,EAAMogH,eAAX,CACA,IAAIlnI,EAAMonI,EAAY1B,uBAAuBzrH,GACzCqvC,EAAO/0B,SAAS+0B,KACpBtpD,EAAIq5C,MAAQiQ,EAAKq9E,YAAc,EAC/B3mI,EAAIo5C,KAAOkQ,EAAKnP,WAAa,EAC7B5H,EAAQ60F,EAAYN,kBAAkBhgH,EAAO9mB,SAKrDsoI,EAAqB,SAASt4B,GAC1B,IAAIz9D,EAAUy1F,EAAgBh4B,GAC9B/1F,EAAQga,iBAAiB+7E,EAAY,SAASlpF,GAC1C,GAAKA,EAAMogH,eAAX,CACA,IAAIlnI,EAAMonI,EAAY1B,uBAAuBzrH,GACzCqvC,EAAO/0B,SAAS+0B,KACpBtpD,EAAIq5C,MAAQiQ,EAAKq9E,YAAc,EAC/B3mI,EAAIo5C,KAAOkQ,EAAKnP,WAAa,EAC7B5H,EAAQ60F,EAAYN,kBAAkBhgH,EAAO9mB,IAC7C8mB,EAAMqoC,kBACNroC,EAAMg8G,oBACN,IAGUkF,EAClBM,EAAmBt4B,GAvDP,GA2DhBx1G,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAI81G,8BAE9B3tI,KAAKioI,yBAGTjoI,KAAKqpI,kBAAmB,IAG5BpB,uBA3iBe,aA6iBfJ,4BA7iBe,aAmjBfhnI,OAnjBe,SAmjBPF,GACAX,KAAK8nI,cAAgB9nI,KAAKgoI,iBAC1BhoI,KAAK8nI,eAAiB9nI,KAAKgoI,eAC3BxnF,EAAauT,cAAc,IAAIn0D,GAAG8uG,MAAMwD,kBAAkBlyG,KAAKmoI,iBAEnEnoI,KAAK8nI,eAAiBnnI,IAI9BxB,EAAOE,QAAU4uI,IAAIzkF,aAAeA,+ECtkBzB9pD,EAAQ,QAOnBE,GAAGiI,OAMCyqC,IAAKjtC,KAAK8E,GAAK,IAOf+jI,IAAK,IAAM7oI,KAAK8E,GAMhBm5D,eAAiB19C,OAAOtU,UAAY,EAMpCQ,YAAa,eAObykD,YAAalxD,KAAKmE,IAAI,EAAG,IAOzB8sD,WAAYjxD,KAAKmE,IAAI,EAAG,IAAM,EAO9BsuE,IAAK,EAMLxzE,KAAM,EAMNkuF,UAAW,IAMX27C,mBAAoB,IAMpBC,UAAW,IAMXC,UAAW,IAMXC,UAAW,IAMX12C,oBAAqB,IAMrB22C,oBAAqB,IAMrBC,oBAAqB,IAMrBC,oBAAqB,IAMrBC,yBAA0B,MAM1BC,yBAA0B,MAQ1BC,qBAAsB,EAOtBC,sBAAuB,EAOvBC,iBAAkB,EAElBC,kBAAmB,aACnBC,gBAAiB,WACjBC,kBAAmB,aACnBC,eAAgB,UAwBhBC,sCAAsC,EAOtCC,wBAAyBxvI,GAAGqE,GAAG,EAAG,GAUlC6D,0BAA0B,EAsB1BohI,cAAe,IASfmG,mBAAoB,IAUpBC,yBAAyB,EAUzB3jB,wBAAyB,GAezBx8D,2BAA2B,EAsB3BF,wBAAwB,EAkBxBsgF,gBAAgB,EAkBhBhgF,qBAAqB,EAUrB6qE,qBAAqB,GAIzB,IAAI5jD,GAA2B,QAAS,OAAQ,QAAS,OAAQ,QAC7D52E,GAAGi4B,IAAIsjD,UACHv7E,GAAGi4B,IAAImF,KAAOp9B,GAAGi4B,IAAIoF,SACrBu5C,GAA2B,QAAQ4pD,OAAO5pD,IAgBlD52E,GAAGiI,MAAM2uE,wBAA0BA,EASnC52E,GAAGiI,MAAMykG,KAQLkjC,KAAK,EAULC,KAAK,EAQLvpD,KAAK,GASLwpD,UAAU,EASVC,IAAI,EASJpjC,MAAM,GASNxoF,MAAM,GASN6rH,KAAK,GASLC,IAAI,GASJjoH,MAAM,GASNkoH,SAAS,GASTC,OAAO,GASPC,MAAM,GASNC,OAAO,GASPC,SAAS,GASTvmH,IAAI,GASJwmH,KAAK,GASL1xF,KAAK,GASLwf,GAAG,GASH2a,MAAM,GASNw3D,KAAK,GASLC,OAAO,GASPC,OAAO,GASPC,OAAO,GASPC,EAAE,GASF/wI,EAAE,GASFgxI,EAAE,GASFC,EAAE,GASFC,EAAE,GASFC,EAAE,GASFC,EAAE,GASFC,EAAE,GASFC,EAAE,GASFC,EAAE,GASFjoI,EAAE,GASFmD,EAAE,GASFC,EAAE,GASFC,EAAE,GASFggG,EAAE,GASF6kC,EAAE,GASFt0H,EAAE,GASF42B,EAAE,GASFh0C,EAAE,GASF6sB,EAAE,GASFlN,EAAE,GASFqC,EAAE,GASFjG,EAAE,GASFlJ,EAAE,GASFyiC,EAAE,GASFruC,EAAE,GASFkqB,EAAE,GASFxW,EAAE,GASF3S,EAAE,GASFH,EAAE,GASF2uB,EAAE,GASFvH,EAAE,GASF8kB,EAAE,GASFh0C,EAAE,GASFoE,EAAE,GASF0lC,EAAE,GASF8nG,KAAK,GASLC,KAAK,GASLC,KAAK,GASLC,KAAK,GASLC,KAAK,IASLC,KAAK,IASLC,KAAK,IASLC,KAAK,IASLC,KAAK,IASLC,KAAK,IASLC,IAAI,IASJC,IAAI,IASJC,IAAI,IASJC,OAAS,IASTC,IAAI,IASJC,GAAG,IASHC,GAAG,IASHC,GAAG,IASHC,GAAG,IASHC,GAAG,IASHC,GAAG,IASHC,GAAG,IASHC,GAAG,IASHC,GAAG,IASHC,IAAI,IASJC,IAAI,IASJC,IAAI,IASJC,QAAQ,IASRC,WAAW,IASXC,IAAI,IASJC,UAAU,IASVC,MAAM,IASNC,IAAI,IASJC,IAAI,IASJC,MAAM,IASNC,KAAK,IASLC,IAAI,IASJzoI,OAAO,IASP0oI,aAAa,IASbC,MAAM,IASNC,IAAI,IASJC,YAAY,IASZC,UAAU,IASVC,IAAI,IASJC,aAAa,IASbC,MAAM,IAWNC,SAAS,IASTC,UAAU,KASVC,OAAO,KASPC,SAAS,KASTC,WAAW,MAOfv0I,GAAGiI,MAAMusI,YAAcx0I,GAAG43B,MAMtB68G,IAAK,EAMLC,IAAK,EAMLC,KAAM,EAMNC,KAAM,EAMNC,IAAK,EAMLC,IAAK,EAMLC,KAAM,EAMNC,MAAO,EAMPC,IAAK,EAMLC,QAAS,EAMTphC,QAAS,KAYb9zG,GAAGiI,MAAM0qF,YAAc3yF,GAAG43B,MAMtBsgD,IAAwB,EAMxBxzE,KAAwB,EAMxBkuF,UAAwB,IAMxB47C,UAAwB,IAMxBC,UAAwB,IAMxBC,UAAwB,IAMxB12C,oBAAwB,IAMxB22C,oBAAwB,IAMxBC,oBAAwB,IAMxBC,oBAAwB,MAM5B7uI,GAAGiI,MAAMknF,cAAgBnvF,GAAG43B,MAIxBs/C,KAAM,EAINmE,OAAQ,EAIRC,MAAO,IAMXt7E,GAAGiI,MAAMonF,sBAAwBrvF,GAAG43B,MAIhCw/C,IAAK,EAILiE,OAAQ,EAIR85D,OAAQ,IAGZ51I,EAAOE,QAAUO,GAAGiI,0CCzgDpB,IAAIwW,EAAK3e,EAAQ,QACbsgI,EAAUtgI,EAAQ,aAIlBs1I,EAAY,EAyChB,SAAS3rE,IAMLrpE,KAAKstB,MAAQ,GAObttB,KAAK80D,UAAY,EAErBkrE,EAAQyE,WAAW,YAAap7D,GAAY/7C,MAAO,GAAIwnC,UAAW,IAQlEz2C,EAAGta,MAAMslE,EAAU,SAEf2rE,UAAAA,EAQAC,SAvEW,EA8EXC,WA7Ea,GA+EbC,MA9EQ,GAsFRC,YArFc,GAuFdC,gBAjEiB,QAqEjBjkF,WA1Fa,IAkGbwpE,aAjGe,IA0Gf0a,eAzGiB,IA+IjB5a,iBAzImB,KA0InBC,gBAxIkB,MAyIlBpuC,eA1IiB,MA2IjBnM,iBA9ImB,KA+InBD,cA1IgB,MA2IhBG,uBA/IyB,KAiJzBi1D,iBAvImB,GAAK,GAwIxBC,iBA5ImB,GAAK,GA6IxBC,cA5IgB,GAAK,GA6IrBC,eA5IiB,GAAK,GA6ItBC,aA5Ie,GAAK,KA+IxB,IAAIC,KAEJ,SAASC,IAEL,IADA,IAAIC,EAAcF,EAAiBp2I,OAC1BD,EAAI,EAAGA,EAAIu2I,IAAev2I,EAAG,CAClC,IAAIs3D,EAAM++E,EAAiBr2I,GACrBs3D,EAAI/B,UAAYkgF,GAClBn+E,EAAIhS,oBAKRixF,IAAgBF,EAAiBp2I,OACjCo2I,EAAiBp2I,OAAS,EAG1Bo2I,EAAiBz1H,OAAO,EAAG21H,GAQnCz3H,EAAGta,MAAMslE,EAAU,mBAAoBwsE,GAiBvC,IAAIvzI,EAAY+mE,EAAS/mE,UAUzB+b,EAAGgR,OAAO/sB,EAAW,OACjB,WACI,OAAOtC,KAAKstB,OAEhB,SAAUvpB,GACN/D,KAAKstB,MAAQvpB,IAEjB,GA0BJsa,EAAGsK,IAAIrmB,EAAW,UAAW,WACzB,QAAStC,KAAK80D,UAAYkgF,KAC3B,GAyBH1yI,EAAUm4B,QAAU,WAChB,OAAIz6B,KAAK80D,UAAYkgF,GACjBp1I,GAAGu+B,OAAO,MACH,KAtRC,EAwRRn+B,KAAK80D,aAGT90D,KAAK80D,WA3RO,EA4RZ8gF,EAAiBlwI,KAAK1F,OAMf,IA+HXsC,EAAUyzI,UAAY,WAClB,IAAIh2I,EAAOC,KAAK8e,YACZ+N,EAAW9sB,EAAKi2I,aACfnpH,IACDA,EAvGR,SAA0BgqC,EAAK92D,GAC3B,IAGI2lD,EAHAuwF,EAAep/E,aAAej3D,GAAGk3G,WAAajgD,aAAej3D,GAAGw8E,UAChE85D,EAAWD,EAAe,MAAQ,KAE7BE,KACT,IAAKzwF,KAAOmR,EACR,GAAIA,EAAI0oE,eAAe75E,GAAM,CACzB,GAAIA,IAAQwwF,EACR,SAEJ,cAAer/E,EAAInR,IACf,IAAK,SACDywF,EAAazwF,GAAO,GACpB,MACJ,IAAK,SACL,IAAK,WACDywF,EAAazwF,GAAO,MAMpC,GAAI9lD,GAAGE,MAAMmgI,WAAWlgI,GAGpB,IAFA,IAAI0+H,EAAQ7+H,GAAGE,MAAMy9H,KAAKkD,cAAc1gI,GACpCq2H,EAAWr2H,EAAKo+H,UACX5+H,EAAI,EAAGA,EAAI62H,EAAS52H,OAAQD,IAAK,CAEtC,IAAI8hI,GADJ37E,EAAM0wE,EAAS72H,IACKK,GAAGE,MAAMy9H,KAAKG,UAAY,UAC9C,GAAI2D,KAAW5C,EAAO,CAClB,GAAIwX,GAAwB,QAARvwF,EAChB,SAEJ,cAAe+4E,EAAM4C,IACjB,IAAK,SACD8U,EAAazwF,GAAO,GACpB,MACJ,IAAK,SACL,IAAK,WACDywF,EAAazwF,GAAO,KACpB,MACJ,IAAK,YACDywF,EAAazwF,QAAOr/C,IASpC,IAAIsgB,EAAO,GACX,IAAK++B,KAAOywF,EAAc,CACtB,IAAI7U,EAEAA,EADAtB,EAAQiB,cAAcrgD,KAAKl7B,GACf,KAAOA,EAAM,IAGb,KAAOs6E,EAAQgB,YAAYt7E,GAAO,KAElD,IAAIva,EAAMgrG,EAAazwF,GACX,KAARva,IACAA,EAAM,MAEVxkB,GAAS26G,EAAYn2F,EAAM,MAE/B,OAAOm3C,SAAS,IAAK37D,GAsCVyvH,CAAgBp2I,KAAMD,GACjCse,EAAGta,MAAMhE,EAAM,eAAgB8sB,GAAU,IAE7CA,EAAS7sB,OAQbsC,EAAU80D,cAAgB,KAE1B90D,EAAUuiD,kBAAoB,WACtB7kD,KAAK80D,UAAYkgF,EACjBp1I,GAAGyC,QAAQ,MAIXrC,KAAKo3D,eACLp3D,KAAKo3D,gBAILp3D,KAAK+1I,YAGT/1I,KAAK80D,WAAakgF,IAqBtB1yI,EAAUspC,aAAe,KA8BzBhsC,GAAGmsB,QAAU,SAAUhoB,EAAOsyI,GAC1B,MAAqB,iBAAVtyI,KACEA,GAAWA,EAAM+wD,WAAauhF,EArf/B,EAqf6CrB,EAAyBA,SAGtD,IAAVjxI,GActBnE,GAAG0kD,OAASnlD,EAAOE,QAAUgqE,sDC3gB7B,IAAIhrD,EAAK3e,EAAQ,kBAMjBE,GAAG02I,UAAY,WACiC1zF,OAAO2zF,WAC/Cv2I,KAAKw2I,qBAAsB,EAC3Bx2I,KAAKy2I,QAAU,IAAIF,YAEnBv2I,KAAKw2I,qBAAsB,EAC3Bx2I,KAAKy2I,QAAU,OAGvB72I,GAAG02I,UAAUh0I,WACTwc,YAAalf,GAAG02I,UAMhBp4C,MAAQ,SAASw4C,GACb,OAAO12I,KAAK22I,UAAUD,IAG1BC,UAAW,SAAUC,GAEjB,IAAIC,EASJ,OARI72I,KAAKw2I,oBACLK,EAAS72I,KAAKy2I,QAAQK,gBAAgBF,EAAS,cAG/CC,EAAS,IAAIh2B,cAAc,qBACpBmE,MAAQ,QACf6xB,EAAOE,QAAQH,IAEZC,IAUfj3I,GAAGo3I,YAAc,WACbp3I,GAAG02I,UAAU/zI,KAAKvC,OAEtBqe,EAAGmE,OAAO5iB,GAAGo3I,YAAap3I,GAAG02I,WAC7Bj4H,EAAG21F,MAAMp0G,GAAGo3I,YAAY10I,WAMpB47F,MAAQ,SAAUw4C,GACd,IAAIG,EAAS72I,KAAK22I,UAAUD,GACxB3rB,EAAQ8rB,EAAOloF,gBACnB,GAAsB,UAAlBo8D,EAAMz8D,QAEN,OADA1uD,GAAGu+B,OAAO,SAMd,IADA,IAAIsG,EAAO,KACFllC,EAAI,EAAGwuB,EAAMg9F,EAAMksB,WAAWz3I,OAAQD,EAAIwuB,GAEzB,KADtB0W,EAAOsmF,EAAMksB,WAAW13I,IACf23I,SAF2C33I,KAMxD,OADAs3I,EAAS,KACF72I,KAAKm3I,WAAW1yG,IAG3B0yG,WAAY,SAAU1yG,GAClB,IAAI9zB,EAAO,KAAM29C,EAAU7pB,EAAK6pB,QAChC,GAAe,SAAZA,EACC39C,EAAO3Q,KAAKo3I,WAAW3yG,QACrB,GAAe,UAAZ6pB,EACL39C,EAAO3Q,KAAKq3I,YAAY5yG,QACtB,GAAe,WAAZ6pB,EACL,GAA+B,IAA3B7pB,EAAKwyG,WAAWz3I,OAChBmR,EAAO8zB,EAAK6yG,WAAWC,cACtB,CAED5mI,EAAO,GACP,IAAK,IAAIpR,EAAI,EAAGA,EAAIklC,EAAKwyG,WAAWz3I,OAAQD,IACxCoR,GAAQ8zB,EAAKwyG,WAAW13I,GAAGg4I,cAElB,UAAZjpF,EACL39C,GAAO,EACU,SAAZ29C,EACL39C,GAAO,EACU,SAAZ29C,EACL39C,EAAOkV,WAAW4e,EAAK6yG,WAAWC,WACjB,YAAZjpF,IACL39C,EAAOoV,SAAS0e,EAAK6yG,WAAWC,UAAW,KAE/C,OAAO5mI,GAGX0mI,YAAa,SAAU5yG,GAEnB,IADA,IAAI9zB,KACKpR,EAAI,EAAGwuB,EAAM0W,EAAKwyG,WAAWz3I,OAAQD,EAAIwuB,EAAKxuB,IAAK,CACxD,IAAIohE,EAAQl8B,EAAKwyG,WAAW13I,GACL,IAAnBohE,EAAMu2E,UAEVvmI,EAAKjL,KAAK1F,KAAKm3I,WAAWx2E,IAE9B,OAAOhwD,GAGXymI,WAAY,SAAU3yG,GAGlB,IAFA,IAAI9zB,KACA+0C,EAAM,KACDnmD,EAAI,EAAGwuB,EAAM0W,EAAKwyG,WAAWz3I,OAAQD,EAAIwuB,EAAKxuB,IAAK,CACxD,IAAIohE,EAAQl8B,EAAKwyG,WAAW13I,GACL,IAAnBohE,EAAMu2E,WAIY,QAAlBv2E,EAAMrS,QACN5I,EAAMib,EAAM22E,WAAWC,UAEvB5mI,EAAK+0C,GAAO1lD,KAAKm3I,WAAWx2E,IAEpC,OAAOhwD,KAIf/Q,GAAG43I,UAAY,IAAI53I,GAAG02I,UAMtB12I,GAAGkuH,YAAc,IAAIluH,GAAGo3I,YAExB73I,EAAOE,SACHm4I,UAAW53I,GAAG43I,UACd1pB,YAAaluH,GAAGkuH,2DCzIpBluH,GAAGktG,QACC2qC,qBAAqB,EAErBC,uBAAwB,KACxBC,YAAa,GACbC,IAAK,KAELC,SAEQ,oBACA,iBACA,mBACA,oBACA,sBAGA,oBACA,iBACA,mBACA,oBACA,sBAGA,0BACA,yBACA,yBACA,qBACA,mCAGA,uBACA,sBACA,sBACA,gBACA,yBAGA,sBACA,mBACA,qBACA,sBACA,wBAQRzoI,KAAM,WACFpP,KAAK43I,OACL,IAAIr4I,EAAGgiB,EAAG4pB,EAAwB2sG,EAAnBpjH,EAAM10B,KAAK63I,OAC1B,IAAKt4I,EAAI,EAAGgiB,EAAImT,EAAIl1B,OAAQD,EAAIgiB,EAAGhiB,IAE/B,IADA4rC,EAAMzW,EAAIn1B,UAC8B,IAArBo6B,SAASwR,EAAI,IAAsB,CAClD,IAAK5rC,EAAI,EAAGu4I,EAAO3sG,EAAI3rC,OAAQD,EAAIu4I,EAAMv4I,IACrCS,KAAK43I,IAAIljH,EAAI,GAAGn1B,IAAM4rC,EAAI5rC,GAE9B,MAIRS,KAAKy3I,yBAAsDpxI,IAA/BrG,KAAK43I,IAAIG,kBACrC/3I,KAAK23I,YAAe,iBAAkB/0F,OAAU,aAAe,aAQnEo1F,WAAY,WACR,QAAIh4I,KAAKy3I,2BACyCpxI,IAAzCszB,SAAS35B,KAAK43I,IAAIK,oBAA6E,OAAzCt+G,SAAS35B,KAAK43I,IAAIK,qBAYrFC,kBAAmB,SAAU74H,EAAS84H,GAClC,GAAsC,UAAlC94H,EAAQivC,QAAQ+2D,cAA2B,CAC3C,GAAIzlH,GAAGi4B,IAAImF,KAAOp9B,GAAGi4B,IAAIoF,QAAUr9B,GAAGi4B,IAAIugH,WAAa/4H,EAAQmnG,WAAa,EAExE,YADAnnG,EAAQg5H,uBAAyBh5H,EAAQg5H,yBAIzCh5H,EAAQ++B,aAAa,6BAA8B,QAI3D,GAAKp+C,KAAKy3I,oBAAV,CAMA,GAFAp4H,EAAUA,GAAWsa,SAASg1B,gBAE1BwpF,EAAoB,CACpB,IAAI/iC,EAAYp1G,KAAK43I,IAAIU,iBACrBt4I,KAAK03I,wBACL/9G,SAASH,oBAAoB47E,EAAWp1G,KAAK03I,wBAEjD13I,KAAK03I,uBAAyBS,EAC9Bx+G,SAASN,iBAAiB+7E,EAAW+iC,GAAoB,GAG7D,OAAO94H,EAAQrf,KAAK43I,IAAIG,uBAQ5BhrC,eAAgB,SAAU1tF,GACtB,GAAsC,UAAlCA,EAAQivC,QAAQ+2D,cAA2B,CAC3C,GAAIzlH,GAAGi4B,IAAImF,KAAOp9B,GAAGi4B,IAAIoF,QAAUr9B,GAAGi4B,IAAIugH,UAEtC,YADA/4H,EAAQk5H,sBAAwBl5H,EAAQk5H,wBAIxCl5H,EAAQ++B,aAAa,6BAA8B,SAG3D,OAAOp+C,KAAKy3I,qBAAsB99G,SAAS35B,KAAK43I,IAAIY,mBASxDC,eAAgB,SAAUp5H,EAAS84H,GAC/B94H,EAAUA,GAAWsa,SAAS+0B,KAC9B,IAAIgqF,EAAc94I,GAAG06B,KAAKC,QAAUlb,EAChCs5H,EAAY34I,KAMhBA,KAAKk4I,kBAAkB74H,EAAS84H,GAChCO,EAAYr/G,iBAAiBr5B,KAAK23I,YALlC,SAASxpH,IACLuqH,EAAYl/G,oBAAoBm/G,EAAUhB,YAAaxpH,GACvDwqH,EAAUT,kBAAkB74H,EAAS84H,OAMjDv4I,GAAGktG,OAAO19F,iCCy+BV,IAAIyoB,EAAMj4B,IAAMA,GAAGi4B,IAAMj4B,GAAGi4B,IAtoC5B,WAOIj4B,GAAGi4B,OACH,IAAIA,EAAMj4B,GAAGi4B,IAObA,EAAI+gH,iBAAmB,KAOvB/gH,EAAIghH,iBAAmB,KAOvBhhH,EAAIihH,gBAAkB,KAOtBjhH,EAAIkhH,iBAAmB,KAOvBlhH,EAAImhH,gBAAkB,KAOtBnhH,EAAIohH,iBAAmB,KAOvBphH,EAAIqhH,eAAiB,KAOrBrhH,EAAIshH,iBAAmB,KAOvBthH,EAAIuhH,gBAAkB,KAOtBvhH,EAAIwhH,kBAAoB,KAOxBxhH,EAAIyhH,mBAAqB,KAOzBzhH,EAAI0hH,oBAAsB,KAO1B1hH,EAAI2hH,gBAAkB,KAOtB3hH,EAAI4hH,mBAAqB,KAOzB5hH,EAAI6hH,gBAAkB,KAOtB7hH,EAAI8hH,iBAAmB,KAOvB9hH,EAAI+hH,mBAAqB,KAOzB/hH,EAAIgiH,kBAAoB,KAOxBhiH,EAAIiiH,mBAAqB,KAOzBjiH,EAAIkiH,iBAAmB,UAMvBliH,EAAIoF,OAAS,MAKbpF,EAAI6vE,WAAa,UAKjB7vE,EAAImiH,WAAa,UAKjBniH,EAAIoiH,aAAe,YAKnBpiH,EAAIqiH,SAAW,QAKfriH,EAAIsiH,QAAU,OAKdtiH,EAAIuiH,cAAgB,aAKpBviH,EAAIwiH,OAAS,OAKbxiH,EAAIyiH,OAAS,MAKbziH,EAAI0iH,SAAW,QAKf1iH,EAAI2iH,WAAa,UAOjB3iH,EAAI67E,SAAW,EAMf77E,EAAI4iH,MAAQ,EAMZ5iH,EAAI6iH,MAAQ,EAMZ7iH,EAAI8iH,MAAQ,EAMZ9iH,EAAI+iH,QAAU,EAMd/iH,EAAIgjH,OAAS,EAMbhjH,EAAIijH,KAAO,EAMXjjH,EAAIkjH,WAAa,EAMjBljH,EAAImjH,KAAO,EAMXnjH,EAAIojH,WAAa,EAMjBpjH,EAAIqjH,MAAQ,EAMZrjH,EAAIsjH,MAAQ,GAMZtjH,EAAIujH,IAAM,GAMVvjH,EAAIwjH,eAAiB,IAMrBxjH,EAAIyjH,gBAAkB,IAQtBzjH,EAAI0jH,YAAc,IAOlB1jH,EAAI2jH,YAAc,IAMlB3jH,EAAI4jH,YAAc,IAMlB5jH,EAAI6jH,QAAU,IAMd7jH,EAAIq2F,gBAAkB,IAOtBr2F,EAAI8jH,oBAAsB,SAO1B9jH,EAAI+jH,yBAA2B,aAO/B/jH,EAAI81G,6BAA+B,gBAOnC91G,EAAIgkH,qBAAuB,SAO3BhkH,EAAIikH,qBAAuB,iBAO3BjkH,EAAIkkH,gBAAkB,KAOtBlkH,EAAImkH,gBAAkB,YAOtBnkH,EAAI0wG,uBAAyB,aAO7B1wG,EAAIiyE,gBAAkB,YAOtBjyE,EAAIokH,kBAAoB,OAOxBpkH,EAAI+vE,iBAAmB,aAOvB/vE,EAAIqkH,uBAAyB,cAO7BrkH,EAAIskH,mBAAqB,eAOzBtkH,EAAIukH,qBAAuB,UAO3BvkH,EAAIwkH,mBAAqB,QAOzBxkH,EAAIykH,oBAAsB,SAO1BzkH,EAAI0kH,kBAAoB,cAOxB1kH,EAAIkyE,qBAAuB,UAO3BlyE,EAAI2kH,oBAAsB,SAO1B3kH,EAAI43B,oBAAsB,SAO1B53B,EAAI4kH,oBAAsB,SAO1B5kH,EAAI6kH,mBAAqB,QAOzB7kH,EAAI8vE,oBAAsB,QAO1B9vE,EAAI8kH,qBAAuB,UAM3B9kH,EAAI+kH,UAAWC,EAOfhlH,EAAIugH,UAA8B,iBAAXx1F,QAA2C,iBAAbjpB,WAAyD,EA6K1G,IAAIq2B,EAAMpN,OAAQk6F,EAAM9sF,EAAIa,UAAWksF,EAAMpjH,SAAUqjH,EAASD,EAAIpuF,gBAChE85E,EAAKqU,EAAIhsF,UAAUu0D,cAWnBxtF,EAAIsjD,SAAW,6BAA6ByF,KAAK6nD,GAMrB,oBAAjBwU,aACPplH,EAAIo2F,SAAWp2F,EAAIq2F,gBAGnBr2F,EAAIo2F,SAAWp2F,EAAIsjD,SAAWtjD,EAAIwjH,eAAiBxjH,EAAIyjH,gBAI/D,IAAI4B,EAAeJ,EAAIK,SAEvBD,GADAA,EAAeA,GAA8BJ,EAAIM,iBACnBF,EAAap5H,MAAM,KAAK,GAAK+T,EAAI+gH,iBAM/D/gH,EAAIslH,SAAWD,EAGf,IAAIG,GAAY,EAAOC,GAAM,EAAOC,EAAY,GAAIC,EAAgB,EAChEC,EAAW,2BAA2BC,KAAKjV,IAAO,2BAA2BiV,KAAKZ,EAAI7uB,UACtFwvB,IACAJ,GAAY,EACZE,EAAYE,EAAS,IAAM,GAC3BD,EAAgBz3H,SAASw3H,IAAc,IAE3CE,EAAW,yCAAyCC,KAAKjV,KAErD6U,GAAM,EACNC,EAAYE,EAAS,IAAM,GAC3BD,EAAgBz3H,SAASw3H,IAAc,GAElC,qBAAqBG,KAAKZ,EAAI7uB,YACnCqvB,GAAM,EACNC,EAAY,GACZC,EAAgB,GAGpB,IAAIG,EAAS9lH,EAAI2iH,YACsB,IAAnCsC,EAAIc,WAAWj6H,QAAQ,OAAeg6H,EAAS9lH,EAAImiH,WAC9CsD,EAAKK,EAAS9lH,EAAIoF,QACiB,IAAnC6/G,EAAIc,WAAWj6H,QAAQ,OAAeg6H,EAAS9lH,EAAIwiH,QAChB,IAAnCyC,EAAIc,WAAWj6H,QAAQ,SAAsD,IAArCm5H,EAAIc,WAAWj6H,QAAQ,SAAiBg6H,EAAS9lH,EAAIgmH,QAC7FR,EAAWM,EAAS9lH,EAAI6vE,YACa,IAArCo1C,EAAIc,WAAWj6H,QAAQ,WAA6C,IAA1B8kH,EAAG9kH,QAAQ,YAAkBg6H,EAAS9lH,EAAIqiH,UAM7FriH,EAAImF,GAAK2gH,EAKT9lH,EAAI0lH,UAAYA,EAKhB1lH,EAAI2lH,cAAgBA,EAMpB3lH,EAAI23B,YAAc33B,EAAI8kH,qBAEtB,WACI,IAGImB,EAHW,6IAGaJ,KAAKjV,GAC7BqV,IAAcA,EAHH,uBAG2BJ,KAAKjV,IAC3CqV,IAAcA,EAHH,oDAG2BJ,KAAKjV,IAE/C,IAAIj5E,EAAcsuF,EAAeA,EAAa,GAAGz4B,cAAgBxtF,EAAI8kH,qBAK5C,mBAAhBntF,EACLA,EAAc33B,EAAI8jH,oBACG,WAAhBnsF,GAA4B6tF,EACjC7tF,EAAc33B,EAAIikH,qBACG,OAAhBtsF,GAAwBi5E,EAAGxW,MAAM,yBACtCziE,EAAc33B,EAAIikH,qBACG,YAAhBtsF,EACLA,EAAc33B,EAAIkkH,gBACG,eAAhBvsF,EACLA,EAAc33B,EAAI+vE,iBACG,cAAhBp4C,EACLA,EAAc33B,EAAIukH,qBACG,SAAhB5sF,IACLA,EAAc33B,EAAIwkH,oBAEtBxkH,EAAI23B,YAAcA,EA5BtB,GAmCA33B,EAAI63B,eAAiB,GAErB,WACI,IAEI4V,EAAMmjE,EAAGxW,MAFK,wKAGd3sD,IAAKA,EAAMmjE,EAAGxW,MAFA,gGAGlBp6F,EAAI63B,eAAiB4V,EAAMA,EAAI,GAAK,GALxC,GAQA,IAAIhyB,EAAIsP,OAAOm7F,YAAcpkH,SAASg1B,gBAAgBH,YAClDjb,EAAIqP,OAAOo7F,aAAerkH,SAASg1B,gBAAgBF,aACnDvqC,EAAQ0+B,OAAOq7F,kBAAoB,EAMvCpmH,EAAIqmH,uBACAv6I,MAAOugB,EAAQovB,EACf1vC,OAAQsgB,EAAQqvB,GAGpB1b,EAAIsmH,sBAAwB,WACxB,GAAIv+I,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKwvB,kBAC/B,MAAM,IAAIpK,MAAM,kDAGxB,IAAI0+F,EAAczkH,SAASC,cAAc,UAuBzC,IACI,IAAIykH,EAAexmH,EAAIwmH,aAAeruF,EAAIquF,aAC1CA,EAAaC,QAAQ,UAAW,IAChCD,EAAa5oE,WAAW,WACxB4oE,EAAe,KACjB,MAAOjyC,GACL,IAAIv9D,EAAO,WACPjvC,GAAGu+B,OAAO,OAEdtG,EAAIwmH,cACAh3E,QAAUx4B,EACVyvG,QAAUzvG,EACV4mC,WAAa5mC,EACb+U,MAAQ/U,GAIhB,IAAI0vG,EAAeH,EAAYI,UAAU,cAAc14F,WAAW,mBAC9D24F,IAAmBL,EAAYjxB,WAAW,MAC1CuxB,GAAgB,EAIX7mH,EAAI23B,cAAgB33B,EAAI+jH,yBAC7B8C,GAAgB,EAEX1uF,EAAI2uF,wBACTD,GAAgB,GAOpB,IAcIziH,EAdAgyB,EAAep2B,EAAIo2B,cACnB1zB,OAAUkkH,EACVG,OAAUF,EACVz0B,KAAQs0B,SAEmBl4I,IAA3B22I,EAAA,mBAAgE32I,IAAxB02I,EAAA,cAAqCD,EAAIhQ,oBACjF7+E,EAAA,SAA0B,QACF5nD,IAAxB22I,EAAA,YACA/uF,EAAA,OAAwB,QACF5nD,IAAtB22I,EAAA,UACA/uF,EAAA,UAA2B,IAC3B+B,EAAIq4E,mBAAqBr4E,EAAIs4E,0BAC7Br6E,EAAA,eAAgC,GAiBpC,WAIkBp2B,EAAI63B,eAFlB,IAMImvF,EAAkBhnH,EAAI23B,cAAgB33B,EAAI+jH,6BACvBh5F,OAAOk8F,cAAgBl8F,OAAOm8F,oBAAsBn8F,OAAOo8F,iBAElF/iH,GAAmBgjH,UAAU,EAAO93E,UAAW03E,EAAiBK,kBAAkB,GAE9ErnH,EAAImF,KAAOnF,EAAIoF,SAIfhB,EAAesqF,iBAAmB,kBAGlC1uF,EAAI23B,cAAgB33B,EAAIkyE,uBACxB9tE,EAAeijH,kBAAmB,EAClCjjH,EAAesqF,iBAAmB,WAGlC1uF,EAAImF,KAAOnF,EAAI6vE,YACX7vE,EAAI23B,cAAgB33B,EAAIiyE,kBACxB7tE,EAAekjH,YAAa,GA3BxC,GA0CA,IACQljH,EAAekrC,YACflrC,EAAeC,QAAU,IAAK0mB,OAAOk8F,cAAgBl8F,OAAOm8F,oBAAsBn8F,OAAOo8F,iBACtF/iH,EAAeijH,kBACdpiH,WAAW,WAAYb,EAAeC,QAAU,IAAK0mB,OAAOk8F,cAAgBl8F,OAAOm8F,oBAAsBn8F,OAAOo8F,kBAAuB,IAGjJ,MAAMrkH,GACJsB,EAAekrC,WAAY,EAC3BvnE,GAAGgB,MAAM,MAGb,IAAIqlH,KAwLR,OAtLI,WACI,IAAI5rF,EAAQV,SAASC,cAAc,SAChCS,EAAM+kH,cACK/kH,EAAM+kH,YAAY,+BACnBn5B,EAAcvgH,KAAK,QAClB20B,EAAM+kH,YAAY,eACnBn5B,EAAcvgH,KAAK,QAClB20B,EAAM+kH,YAAY,0BACnBn5B,EAAcvgH,KAAK,QAClB20B,EAAM+kH,YAAY,cACnBn5B,EAAcvgH,KAAK,QAClB20B,EAAM+kH,YAAY,gBACnBn5B,EAAcvgH,KAAK,SAZpC,GAeAu2B,EAAe8tC,OAASk8C,EAExBpuF,EAAIoE,eAAiBA,EAWzBpE,EAAIwnH,aASA3hG,KAAM,EASN4hG,IAAK,EASLC,KAAM,GAgBV1nH,EAAI2nH,eAAiB,WAEjB,OAAO3nH,EAAIwnH,YAAYC,KAY3BznH,EAAI4nH,gBAAkB,WAElB,OAAO,GAOX5nH,EAAI6nH,eAAiB,aAQrB7nH,EAAI8nH,UAAY,aAahB9nH,EAAI+nH,gBAAkB,WAClB,IAAIC,EAAcjgJ,GAAG6iD,KAAKq9F,iBAC1B,OAAOlgJ,GAAGgD,KAAK,EAAG,EAAGi9I,EAAYl8I,MAAOk8I,EAAYj8I,SAWxDi0B,EAAIkoH,cAAgB,SAAUlpF,GAC1B,QAAIA,GAURh/B,EAAImoH,KAAO,WACP,IACIC,EAAM,GACVA,GAAO,cAFIjgJ,KAEiBm7E,SAAW,OACvC8kE,GAAO,cAHIjgJ,KAGiBm9I,SAAW,OACvC8C,GAAO,iBAJIjgJ,KAIoBwvD,YAAc,OAC7CywF,GAAO,oBALIjgJ,KAKuB0vD,eAAiB,OACnDuwF,GAAO,kBAAoBx0F,KAAKC,UANrB1rD,KAMoCiuD,cAAgB,OAC/DgyF,GAAO,QAPIjgJ,KAOWg9B,GAAK,OAC3BijH,GAAO,eARIjgJ,KAQkBu9I,UAAY,OACzC0C,GAAO,cATIjgJ,KASiBiuH,SAAW,OACvCgyB,GAAO,UAAYrgJ,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKwvB,kBAAoB,QAAU,UAAY,iBAC5FlqD,GAAG+8C,IAAIsjG,IAQXpoH,EAAIqoH,QAAU,SAAUxkH,GAKhBknB,OAAO+jE,KAAKjrF,IASpB7D,EAAI4pB,IAAM,WACN,OAAIwK,KAAKxK,IACEwK,KAAKxK,OAGH,IAAIwK,MAIdp0B,EAGuBsoH,GAElChhJ,EAAOE,QAAUw4B,4BCvoCjB,IAAMD,EAAcl4B,EAAQ,yBACtB2e,EAAK3e,EAAQ,kBACbyhC,EAAWzhC,EAAQ,eACzBA,EAAQ,uBAER,IAAI0gJ,GACAhxI,KAAM,WAEEpP,KAAKqgJ,KAAO1mH,SAAS2mH,qBAAqB,QAAQ,IAG1DC,WAAY,SAASp8H,GACjB,OAAKA,GAASA,IAAUnkB,KAAKqgJ,KAGlBl8H,EAAMqqC,YAFN5L,OAAOm7F,YAItByC,YAAa,SAASr8H,GAClB,OAAKA,GAASA,IAAUnkB,KAAKqgJ,KAGlBl8H,EAAMsqC,aAFN7L,OAAOo7F,aAItByC,MACI98I,MAAS,gBAEb+8I,eAAgB9gJ,GAAGi4B,IAAI23B,aAmB3B,OAhBI5vD,GAAGi4B,IAAImF,KAAOp9B,GAAGi4B,IAAIoF,SACrBmjH,EAAgBM,eAAiB9gJ,GAAGi4B,IAAI2kH,qBAepC4D,EAAgBM,gBACpB,KAAK9gJ,GAAGi4B,IAAI2kH,oBACR4D,EAAgBK,KAAK,cAAgB,OACzC,KAAK7gJ,GAAGi4B,IAAI8vE,oBACZ,KAAK/nG,GAAGi4B,IAAIiyE,gBACRs2C,EAAgBG,WAAa,SAASp8H,GAClC,OAAOA,EAAMqqC,aAEjB4xF,EAAgBI,YAAc,SAASr8H,GACnC,OAAOA,EAAMsqC,cAEjB,MACJ,KAAK7uD,GAAGi4B,IAAI+jH,yBACRwE,EAAgBG,WAAa,WACzB,OAAO39F,OAAOm7F,YAElBqC,EAAgBI,YAAc,WAC1B,OAAO59F,OAAOo7F,aAElB,MACJ,KAAKp+I,GAAGi4B,IAAI81G,6BACR,IAAIgT,EAAe/9F,OAAO+9F,cAAgB3S,GAAG4S,kBAC7CR,EAAgBG,WAAa,WACzB,OAAOI,EAAah9I,OAExBy8I,EAAgBI,YAAc,WAC1B,OAAOG,EAAa/8I,QAKhC,IAAIi9I,EAAe,KAgBfvkE,EAAO,WACP1kD,EAAYr1B,KAAKvC,MAEjB,IAAI0iE,EAAK1iE,KAAM8gJ,EAAclhJ,GAAGmhJ,kBAAmBC,EAAYphJ,GAAGqhJ,gBAElEb,EAAgBhxI,KAAKpP,MAGrB0iE,EAAGw+E,WAAathJ,GAAGqvC,KAAK,EAAG,GAG3ByzB,EAAG6sC,sBAAwB3vG,GAAGqvC,KAAK,EAAG,GACtCyzB,EAAGwqC,8BAAgCttG,GAAGqvC,KAAK,EAAG,GAC9CyzB,EAAGhoD,QAAU,EACbgoD,EAAG/nD,QAAU,EAEb+nD,EAAGvf,cAAgBvjD,GAAGgD,KAAK,EAAG,EAAG,EAAG,GAEpC8/D,EAAGy+E,aAAevhJ,GAAGgD,KAAK,EAAG,EAAG,EAAG,GAEnC8/D,EAAG0+E,iBAAkB,EAErB1+E,EAAGzf,kBAAoB,EAEvByf,EAAG2+E,gBAAiB,EAEpB3+E,EAAG4+E,gBAAkB,KACrB5+E,EAAG6+E,WAAY,EACf7+E,EAAGsqC,wBAAyB,EAC5BtqC,EAAG8+E,sBAAuB,EAC1B9+E,EAAGxf,YAAa,EAChBwf,EAAG++E,aAAe7hJ,GAAGiI,MAAMinI,iBAC3BpsE,EAAGg/E,mBAAoB,EACvBh/E,EAAGi/E,mBAAoB,EAGvBj/E,EAAGyqC,kBAAoB,KACvBzqC,EAAGk/E,YAAc,IAAIhiJ,GAAGosF,iBAAiB80D,EAAYe,eAAgBb,EAAUc,WAC/Ep/E,EAAGq/E,WAAa,IAAIniJ,GAAGosF,iBAAiB80D,EAAYe,eAAgBb,EAAU/0D,UAC9EvpB,EAAGs/E,YAAc,IAAIpiJ,GAAGosF,iBAAiB80D,EAAYe,eAAgBb,EAAU50D,WAC/E1pB,EAAGu/E,eAAiB,IAAIriJ,GAAGosF,iBAAiB80D,EAAYe,eAAgBb,EAAU70D,cAClFzpB,EAAGw/E,cAAgB,IAAItiJ,GAAGosF,iBAAiB80D,EAAYe,eAAgBb,EAAU90D,aAEjFtsF,GAAG06B,KAAKlM,KAAKxuB,GAAG06B,KAAKonB,oBAAqB1hD,KAAKoP,KAAMpP,OAGzDJ,GAAGye,GAAGmE,OAAO85D,EAAM1kD,GAGnBh4B,GAAGye,GAAG21F,MAAM13B,EAAKh6E,WACb8M,KADwB,WAEpBpP,KAAKmiJ,iBACLniJ,KAAKoiJ,iBAAgB,GAErB,IAAI9uG,EAAI1zC,GAAG06B,KAAKC,OAAO52B,MAAO4vC,EAAI3zC,GAAG06B,KAAKC,OAAO32B,OACjD5D,KAAKuvG,sBAAsB5rG,MAAQ2vC,EACnCtzC,KAAKuvG,sBAAsB3rG,OAAS2vC,EACpCvzC,KAAKktG,8BAA8BvpG,MAAQ2vC,EAC3CtzC,KAAKktG,8BAA8BtpG,OAAS2vC,EAC5CvzC,KAAKmjD,cAAcx/C,MAAQ2vC,EAC3BtzC,KAAKmjD,cAAcv/C,OAAS2vC,EAC5BvzC,KAAKmhJ,aAAax9I,MAAQ2vC,EAC1BtzC,KAAKmhJ,aAAav9I,OAAS2vC,EAE3B3zC,GAAGoE,QAAQL,MAAQ3D,KAAKmhJ,aAAax9I,MACrC/D,GAAGoE,QAAQJ,OAAS5D,KAAKmhJ,aAAav9I,OACtChE,GAAGkqE,aAAelqE,GAAGkqE,YAAY16D,KAAKpP,KAAKmhJ,eAI/CkB,aAAc,WACV,IAAI5/F,EAQA6/F,GANA7/F,EADAziD,KAAKssF,wBACEtsF,KAEAJ,GAAG6iD,MAIQy+F,WAAWv9I,MAAO4+I,EAAa9/F,EAAKy+F,WAAWt9I,OAAQ4+I,EAAc//F,EAAKS,WAChG,GAAItjD,GAAGi4B,IAAIsjD,SAAU,CACjB,IAAIsnE,EAAiB7iJ,GAAG06B,KAAKkoB,UAAUlE,MACnCc,EAASqjG,EAAerjG,OAC5BqjG,EAAerjG,OAAS,IACxBqjG,EAAe75C,QAAU,OACzBnmD,EAAK0/F,iBACLM,EAAerjG,OAASA,EACxBqjG,EAAe75C,QAAU,aAGzBnmD,EAAK0/F,iBAET,GAAI1/F,EAAKS,aAAes/F,GAAe//F,EAAKy+F,WAAWv9I,QAAU2+I,GAAc7/F,EAAKy+F,WAAWt9I,SAAW2+I,EAA1G,CAIA,IAAI5+I,EAAQ8+C,EAAKyqD,8BAA8BvpG,MAC3CC,EAAS6+C,EAAKyqD,8BAA8BtpG,OAChD6+C,EAAK8+F,WAAY,EACb59I,EAAQ,GACR8+C,EAAK6pC,wBAAwB3oF,EAAOC,EAAQ6+C,EAAK0qD,mBACrD1qD,EAAK8+F,WAAY,EAEjB9+F,EAAK/0B,KAAK,iBACN+0B,EAAK6+F,iBACL7+F,EAAK6+F,gBAAgB/+I,SAI7BmgJ,mBAAoB,WAChB9iJ,GAAG6iD,KAAK++F,sBAAuB,EAC/B5hJ,GAAG6iD,KAAK4/F,gBAoCZp1C,sBAAuB,SAAUv+F,GACzBA,EAEK1O,KAAKgtG,yBACNhtG,KAAKgtG,wBAAyB,EAC9BpqD,OAAOvpB,iBAAiB,SAAUr5B,KAAKqiJ,cACvCz/F,OAAOvpB,iBAAiB,oBAAqBr5B,KAAK0iJ,qBAIlD1iJ,KAAKgtG,yBACLhtG,KAAKgtG,wBAAyB,EAC9BpqD,OAAOppB,oBAAoB,SAAUx5B,KAAKqiJ,cAC1Cz/F,OAAOppB,oBAAoB,oBAAqBx5B,KAAK0iJ,sBAkBjEC,kBAAmB,SAAUx0H,GACD,mBAAbA,GAAuC,MAAZA,IAClCnuB,KAAKshJ,gBAAkBnzH,IAkB/By0H,eAAgB,SAAU3Z,GAEtB,IADAA,GAA4BrpI,GAAGiI,MAAMinI,mBAClB9uI,KAAKyhJ,eAAiBxY,EAAa,CAClDjpI,KAAKyhJ,aAAexY,EACpB,IAAI4Z,EAAc7iJ,KAAKktG,8BAA8BvpG,MACjDm/I,EAAe9iJ,KAAKktG,8BAA8BtpG,OACtD5D,KAAKssF,wBAAwBu2D,EAAaC,EAAc9iJ,KAAKmtG,qBAIrEg1C,eAAgB,WACZ,IAAIY,EAAe/iJ,KAAKkhJ,WACpB5tG,EAAI8sG,EAAgBG,WAAW3gJ,GAAG06B,KAAKnW,OACvCovB,EAAI6sG,EAAgBI,YAAY5gJ,GAAG06B,KAAKnW,OACxC6+H,EAAc1vG,GAAKC,GAEL3zC,GAAGi4B,IAAIsjD,UACpB6nE,GAAehjJ,KAAKyhJ,aAAe7hJ,GAAGiI,MAAMgnI,wBAC3CmU,GAAehjJ,KAAKyhJ,aAAe7hJ,GAAGiI,MAAM+mI,sBAC9CmU,EAAap/I,MAAQ2vC,EACrByvG,EAAan/I,OAAS2vC,EACtB3zC,GAAG06B,KAAKkoB,UAAUlE,MAAM,qBAAuB,eAC/C1+C,GAAG06B,KAAKkoB,UAAUlE,MAAM3K,UAAY,eACpC3zC,KAAKkjD,YAAa,IAGlB6/F,EAAap/I,MAAQ4vC,EACrBwvG,EAAan/I,OAAS0vC,EACtB1zC,GAAG06B,KAAKkoB,UAAUlE,MAAM,qBAAuB,gBAC/C1+C,GAAG06B,KAAKkoB,UAAUlE,MAAM3K,UAAY,gBACpC/zC,GAAG06B,KAAKkoB,UAAUlE,MAAM,4BAA8B,cACtD1+C,GAAG06B,KAAKkoB,UAAUlE,MAAM2kG,gBAAkB,cAC1CjjJ,KAAKkjD,YAAa,GAElBljD,KAAKwhJ,sBACL1kH,WAAW,WACPl9B,GAAG6iD,KAAK++F,sBAAuB,GAChC,MAKX0B,0BAA2B,WACvB,IAAIL,EAAc7iJ,KAAKktG,8BAA8BvpG,MACjDm/I,EAAe9iJ,KAAKktG,8BAA8BtpG,OAClDi/I,EAAc,GACd7iJ,KAAKssF,wBAAwBu2D,EAAaC,EAAc9iJ,KAAKmtG,oBAGrEg2C,iBAAkB,SAAUC,EAAOC,GAC/B,IAAIC,EAAK3pH,SAAS4pH,eAAe,oBAC9BD,GAAMD,GACL1pH,SAAS6pH,KAAKh2C,YAAY81C,GAG9B,IAEI97E,EAAS9hB,EAAK8kD,EAFdi5C,EAAQ9pH,SAAS+pH,kBAAkB,YACnCC,EAAYF,EAAQA,EAAM,GAAK,KASnC,IAAK/9F,KANL8hB,EAAUm8E,EAAYA,EAAUn8E,QAAU,IAC1C87E,EAAKA,GAAM3pH,SAASC,cAAc,SAC/BvB,GAAK,mBACRirH,EAAGrkJ,KAAO,WACVqkJ,EAAG97E,QAAU,GAED47E,GACqB,GAAzB57E,EAAQ7jD,QAAQ+hC,GAChB8hB,GAAW,IAAM9hB,EAAM,IAAM09F,EAAM19F,GAE9B29F,IACL74C,EAAU,IAAIo5C,OAAOl+F,EAAI,cACzB8hB,EAAQi/B,QAAQ+D,EAAS9kD,EAAM,IAAM09F,EAAM19F,KAGhD,KAAKk7B,KAAKpZ,KACTA,EAAUA,EAAQu0B,OAAO,IAE7BunD,EAAG97E,QAAUA,EAETm8E,IACAA,EAAUn8E,QAAUA,GAExB7tC,SAAS6pH,KAAKnkG,YAAYikG,IAG9BO,oBAAqB,WACb7jJ,KAAK0hJ,oBACL1hJ,KAAKmjJ,iBAAiB/C,EAAgBK,MAAM,GAC5CzgJ,KAAK0hJ,mBAAoB,IAiBjCoC,mBAAoB,SAAUp1I,GAC1B1O,KAAK0hJ,kBAAoBhzI,GAc7Bq1I,aAAc,SAASr1I,GACnB1O,KAAKqhJ,iBAAmB3yI,GAY5Bs1I,gBAAiB,WACb,OAAOhkJ,KAAKqhJ,gBAShBe,gBAAiB,SAAU1zI,GACvB,GAAI1O,KAAK2hJ,oBAAsBjzI,EAI/B,GADA1O,KAAK2hJ,kBAAoBjzI,EACtB9O,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKwvB,kBAAmB,CACjD,IAAIhrD,EAAQc,GAAG47B,OAAO8lF,OACtB,IAAK,IAAI57D,KAAO5mD,EAAO,CACnB,IAAI07B,EAAO17B,EAAM4mD,GACbyoE,EAAM3zF,GAAQA,EAAKgtC,mBAAmB5nE,GAAGuvC,UAAY3U,EAAKgtC,QAAU,KACxE,GAAI2mD,EAAK,CACL,IAAIx6C,EAAS/zE,GAAGuvC,UAAUwkC,OACtBjlE,EACAy/G,EAAIt4C,WAAWlC,EAAOC,OAAQD,EAAOC,QAGrCu6C,EAAIt4C,WAAWlC,EAAOE,QAASF,EAAOE,gBAKjD,GAAGj0E,GAAG06B,KAAKkwB,aAAe5qD,GAAG06B,KAAKuvB,mBAAoB,CACvD,IAAIo6F,EAAMrkJ,GAAG06B,KAAKC,OAAO4yF,WAAW,MACpC82B,EAAIC,sBAAwBx1I,EAC5Bu1I,EAAIE,yBAA2Bz1I,IAUvC01I,mBAAoB,WAChB,OAAOpkJ,KAAK2hJ,mBAYhB90C,qBAAsB,SAASn+F,GACvBA,GACAA,IAAY1O,KAAKohJ,iBACjBxhJ,GAAGi4B,IAAIsjD,UACPv7E,GAAGi4B,IAAI23B,cAAgB5vD,GAAGi4B,IAAI8jH,qBAE9B37I,KAAKohJ,iBAAkB,EACvBxhJ,GAAGktG,OAAO2rC,eAAe74I,GAAG06B,KAAKnW,QAGjCnkB,KAAKohJ,iBAAkB,GAa/Bx0C,wBAAyB,WACrB,OAAO5sG,KAAKohJ,iBAWhBiD,cAAe,SAAU1gJ,EAAOC,GAC5B,IAAI22B,EAAS36B,GAAG06B,KAAKC,OACjBioB,EAAY5iD,GAAG06B,KAAKkoB,UAExBjoB,EAAO52B,MAAQA,EAAQ3D,KAAKijD,kBAC5B1oB,EAAO32B,OAASA,EAAS5D,KAAKijD,kBAE9B1oB,EAAO+jB,MAAM36C,MAAQA,EAAQ,KAC7B42B,EAAO+jB,MAAM16C,OAASA,EAAS,KAE/B4+C,EAAUlE,MAAM36C,MAAQA,EAAQ,KAChC6+C,EAAUlE,MAAM16C,OAASA,EAAS,KAElC5D,KAAKqiJ,gBAcTiC,cAAe,WACX,OAAO1kJ,GAAGqvC,KAAKrvC,GAAG06B,KAAKC,OAAO52B,MAAO/D,GAAG06B,KAAKC,OAAO32B,SAcxD2gJ,aAAc,WACV,OAAO3kJ,GAAGqvC,KAAKjvC,KAAKkhJ,WAAWv9I,MAAO3D,KAAKkhJ,WAAWt9I,SAa1D4gJ,aAAc,SAAU7gJ,EAAOC,GAC3B5D,KAAKkhJ,WAAWv9I,MAAQA,EACxB3D,KAAKkhJ,WAAWt9I,OAASA,EACzBhE,GAAG06B,KAAKnW,MAAMm6B,MAAM36C,MAAQA,EAAQ,KACpC/D,GAAG06B,KAAKnW,MAAMm6B,MAAM16C,OAASA,EAAS,KACtC5D,KAAKqiJ,gBAUTvC,eAAgB,WACZ,OAAOlgJ,GAAGqvC,KAAKjvC,KAAKmhJ,aAAax9I,MAAM3D,KAAKmhJ,aAAav9I,SAU7D6gJ,sBAAuB,WACnB,OAAO7kJ,GAAGqvC,KAAMjvC,KAAKmhJ,aAAax9I,MAAQ3D,KAAK0a,QAC/B1a,KAAKmhJ,aAAav9I,OAAS5D,KAAK2a,UAUpD+pI,iBAAkB,WACd,OAAO9kJ,GAAGqE,GAAGjE,KAAKmhJ,aAAa7hJ,EAAEU,KAAKmhJ,aAAaz9I,IAUvDihJ,wBAAyB,WACrB,OAAO/kJ,GAAGqE,GAAGjE,KAAKmhJ,aAAa7hJ,EAAIU,KAAK0a,QAC5B1a,KAAKmhJ,aAAaz9I,EAAI1D,KAAK2a,UAW3CiqI,oBAAqB,WACjB,OAAO5kJ,KAAKmtG,mBAWhB03C,oBAAqB,SAAUC,GAC3B,IAAIpiF,EAAK1iE,KACT,GAAI8kJ,aAA4BllJ,GAAGosF,iBAC/BtpB,EAAGyqC,kBAAoB23C,MAGtB,CACD,IAAIC,EAAanlJ,GAAGosF,iBACjB84D,IAAqBC,EAAWjD,YAC/Bp/E,EAAGyqC,kBAAoBzqC,EAAGk/E,aAC3BkD,IAAqBC,EAAW94D,WAC/BvpB,EAAGyqC,kBAAoBzqC,EAAGq/E,YAC3B+C,IAAqBC,EAAW34D,YAC/B1pB,EAAGyqC,kBAAoBzqC,EAAGs/E,aAC3B8C,IAAqBC,EAAW54D,eAC/BzpB,EAAGyqC,kBAAoBzqC,EAAGu/E,gBAC3B6C,IAAqBC,EAAW74D,cAC/BxpB,EAAGyqC,kBAAoBzqC,EAAGw/E,iBAoBtC51D,wBAAyB,SAAU3oF,EAAOC,EAAQkhJ,GAE9C,GAAMnhJ,EAAQ,GAAKC,EAAS,EAA5B,CAKA5D,KAAK6kJ,oBAAoBC,GACzB,IAAI/4D,EAAS/rF,KAAKmtG,kBAelB,GAdIphB,GACAA,EAAOi5D,SAAShlJ,MAIhBJ,GAAGi4B,IAAIsjD,UACPn7E,KAAK6jJ,sBAGT7jJ,KAAKwhJ,sBAAuB,EAEvBxhJ,KAAKuhJ,WACNvhJ,KAAKmiJ,iBAEJp2D,EAAL,CAKA/rF,KAAKktG,8BAA8BvpG,MAAQ3D,KAAKuvG,sBAAsB5rG,MAAQA,EAC9E3D,KAAKktG,8BAA8BtpG,OAAS5D,KAAKuvG,sBAAsB3rG,OAASA,EAEhF,IAAI0Q,EAASy3E,EAAOz/D,MAAMtsB,KAAMA,KAAKuvG,uBAOrC,GALGj7F,EAAOo2B,OAAiC,IAAxBp2B,EAAOo2B,MAAMlrC,SAC5BQ,KAAK0a,QAAUpG,EAAOo2B,MAAM,GAC5B1qC,KAAK2a,QAAUrG,EAAOo2B,MAAM,IAG7Bp2B,EAAOu2F,SAAS,CACf,IAAIy4C,EAAKtjJ,KAAKmjD,cACVpa,EAAK/oC,KAAKmhJ,aACV8D,EAAK3wI,EAAOu2F,SAEhBy4C,EAAGhkJ,EAAI2lJ,EAAG3lJ,EACVgkJ,EAAG5/I,EAAIuhJ,EAAGvhJ,EACV4/I,EAAG3/I,MAAQshJ,EAAGthJ,MACd2/I,EAAG1/I,OAASqhJ,EAAGrhJ,OAEfmlC,EAAGzpC,EAAI,EACPypC,EAAGrlC,EAAI,EACPqlC,EAAGplC,MAAQshJ,EAAGthJ,MAAQ3D,KAAK0a,QAC3BquB,EAAGnlC,OAASqhJ,EAAGrhJ,OAAS5D,KAAK2a,QAGjCoxE,EAAOm5D,UAAUllJ,MACjBJ,GAAGoE,QAAQL,MAAQ3D,KAAKmhJ,aAAax9I,MACrC/D,GAAGoE,QAAQJ,OAAS5D,KAAKmhJ,aAAav9I,OAEtChE,GAAGkqE,aAAelqE,GAAGkqE,YAAY16D,KAAKpP,KAAKmhJ,cAE3ChgH,EAASgkH,uBACTnlJ,KAAK0tB,KAAK,kCArCN9tB,GAAGgB,MAAM,WArBThB,GAAGgB,MAAM,OAsEjBgrF,wBAAyB,WACrB,OAAOhsF,GAAGqvC,KAAKjvC,KAAKuvG,sBAAsB5rG,MAAO3D,KAAKuvG,sBAAsB3rG,SAoBhFwhJ,uBAAwB,SAAUzhJ,EAAOC,EAAQkhJ,GAGzC9kJ,KAAKmjJ,kBAAkBx/I,MAASA,IAAQ,GAGxCg2B,SAASg1B,gBAAgBrQ,MAAM36C,MAAQA,EAAQ,KAC/Cg2B,SAAS+0B,KAAKpQ,MAAM36C,MAAQA,EAAQ,KACpCg2B,SAAS+0B,KAAKpQ,MAAMG,KAAO,MAC3B9kB,SAAS+0B,KAAKpQ,MAAME,IAAM,MAI9Bx+C,KAAKssF,wBAAwB3oF,EAAOC,EAAQkhJ,IAchDO,oBAAqB,SAAU/lJ,EAAGoE,EAAG4vC,EAAGC,GACpC,IAAI+xG,EAAYtlJ,KAAK0a,QAAS6qI,EAAYvlJ,KAAK2a,QAC/C/a,GAAG06B,KAAK8vB,eAAeygD,SAAUvrG,EAAIgmJ,EAAYtlJ,KAAKmjD,cAAc7jD,EAC/DoE,EAAI6hJ,EAAYvlJ,KAAKmjD,cAAcz/C,EACnC4vC,EAAIgyG,EACJ/xG,EAAIgyG,IAcbC,mBAAoB,SAAUlmJ,EAAGoE,EAAG4vC,EAAGC,GACnC,IAAI5jC,EAAS3P,KAAK0a,QAASzK,EAASjQ,KAAK2a,QACrCpD,EAAKlS,KAAKogJ,KAAKnmJ,EAAIqQ,EAAS3P,KAAKmjD,cAAc7jD,GAC/CkY,EAAKnS,KAAKogJ,KAAK/hJ,EAAIuM,EAASjQ,KAAKmjD,cAAcz/C,GAC/CgiJ,EAAKrgJ,KAAKogJ,KAAKnyG,EAAI3jC,GACnBg2I,EAAKtgJ,KAAKogJ,KAAKlyG,EAAItjC,GACnBi7D,EAAKtrE,GAAG06B,KAAK8vB,eAEjB,IAAKy2F,EAAc,CACf,IAAI+E,EAAS16E,EAAGW,aAAaX,EAAG26E,aAChChF,EAAejhJ,GAAGgD,KAAKgjJ,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,IAG/D/E,EAAavhJ,IAAMiY,GAAMspI,EAAan9I,IAAM8T,GAAMqpI,EAAal9I,QAAU+hJ,GAAM7E,EAAaj9I,SAAW+hJ,IACvG9E,EAAavhJ,EAAIiY,EACjBspI,EAAan9I,EAAI8T,EACjBqpI,EAAal9I,MAAQ+hJ,EACrB7E,EAAaj9I,OAAS+hJ,EACtBz6E,EAAG46E,QAAQvuI,EAAIC,EAAIkuI,EAAIC,KAY/BI,iBAAkB,WACd,OAAOnmJ,GAAG06B,KAAK8vB,eAAeqpD,UAAUvoC,GAAG86E,eAW/CC,eAAgB,WACZ,IAAKpF,EAAc,CACf,IAAI+E,EAAS16E,GAAGW,aAAaX,GAAG26E,aAChChF,EAAejhJ,GAAGgD,KAAKgjJ,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,IAEnE,IAAIM,EAAe,EAAIlmJ,KAAK0a,QACxByrI,EAAe,EAAInmJ,KAAK2a,QAC5B,OAAO/a,GAAGgD,MACLi+I,EAAavhJ,EAAIU,KAAKmjD,cAAc7jD,GAAK4mJ,GACzCrF,EAAan9I,EAAI1D,KAAKmjD,cAAcz/C,GAAKyiJ,EAC1CtF,EAAal9I,MAAQuiJ,EACrBrF,EAAaj9I,OAASuiJ,IAW9BC,gBAAiB,WACb,OAAOpmJ,KAAKmjD,eAUhBkjG,UAAW,WACP,OAAOrmJ,KAAK0a,SAUhB4rI,UAAW,WACP,OAAOtmJ,KAAK2a,SAUhB4rI,oBAAqB,WACjB,OAAOvmJ,KAAKijD,mBAahBuoF,wBAAyB,SAAUvgC,EAAIC,EAAIs7C,EAAY/xH,GACnD,IAAIngB,EAASmgB,GAAO70B,GAAGqE,KACnB3E,EAAIU,KAAKijD,mBAAqBgoD,EAAKu7C,EAAW/nG,MAC9C/6C,EAAI1D,KAAKijD,mBAAqBujG,EAAWhoG,IAAMgoG,EAAW5iJ,OAASsnG,GASvE,OARIlrG,KAAKkjD,YACL5uC,EAAOhV,EAAIM,GAAG06B,KAAKC,OAAO52B,MAAQD,EAClC4Q,EAAO5Q,EAAIpE,IAGXgV,EAAOhV,EAAIA,EACXgV,EAAO5Q,EAAIA,GAER4Q,GAGXq3H,8BAA+B,SAAU8a,EAAcD,GACnD,IAAI37C,EAAW7qG,KAAKmjD,cACpBsjG,EAAannJ,GAD2BU,KAClBijD,mBAAqBwjG,EAAannJ,EAAIknJ,EAAW/nG,MAASosD,EAASvrG,GADjDU,KACyD0a,QACjG+rI,EAAa/iJ,GAF2B1D,KAEnBijD,mBAAqBujG,EAAWhoG,IAAMgoG,EAAW5iJ,OAAS6iJ,EAAa/iJ,GAAKmnG,EAASnnG,GAFlE1D,KAE0E2a,SAGtHoiG,uBAAwB,SAAUxhD,GAC9B,IAAIsvC,EAAW7qG,KAAKmjD,cACpBoY,EAAMj8D,GAAKi8D,EAAMj8D,EAAIurG,EAASvrG,GAAKU,KAAK0a,QACxC6gD,EAAM73D,GAAK63D,EAAM73D,EAAImnG,EAASnnG,GAAK1D,KAAK2a,SAG5C4vH,yBAA0B,SAAU94B,GAGhC,IAFA,IACIiI,EAAUgtC,EAAUC,EADpB97C,EAAW7qG,KAAKmjD,cAAexzC,EAAS3P,KAAK0a,QAASzK,EAASjQ,KAAK2a,QAE/Dpb,EAAI,EAAGA,EAAIkyG,EAAQjyG,OAAQD,IAEhCmnJ,GADAhtC,EAAWjI,EAAQlyG,IACCk9G,OACpBkqC,EAAcjtC,EAASgD,WAEvBgqC,EAASpnJ,GAAKonJ,EAASpnJ,EAAIurG,EAASvrG,GAAKqQ,EACzC+2I,EAAShjJ,GAAKgjJ,EAAShjJ,EAAImnG,EAASnnG,GAAKuM,EACzC02I,EAAYrnJ,GAAKqnJ,EAAYrnJ,EAAIurG,EAASvrG,GAAKqQ,EAC/Cg3I,EAAYjjJ,GAAKijJ,EAAYjjJ,EAAImnG,EAASnnG,GAAKuM,KA2B3DrQ,GAAGmhJ,kBAAoBnhJ,GAAGE,OACtBb,KAAM,oBAQN+lJ,SAAU,SAAUviG,KAWpBn2B,MAAO,SAAUm2B,EAAMmkG,KAUvB1B,UAAW,SAAUziG,KAIrBokG,gBAAiB,SAAUpkG,EAAMnP,EAAGC,GAChC,IAAIuzG,EAAYlnJ,GAAG06B,KAAKC,OAAQwsH,EAAennJ,GAAG06B,KAAKkoB,UAG/C5iD,GAAGi4B,IAAImF,KAAOp9B,GAAGi4B,IAAI6vE,aACrB/tE,SAAS+0B,KAAKpQ,MAAM36C,OAAS8+C,EAAKS,WAAa3P,EAAID,GAAK,KACxD3Z,SAAS+0B,KAAKpQ,MAAM16C,QAAU6+C,EAAKS,WAAa5P,EAAIC,GAAK,MAG7DwzG,EAAazoG,MAAM36C,MAAQmjJ,EAAUxoG,MAAM36C,MAAQ2vC,EAAI,KACvDyzG,EAAazoG,MAAM16C,OAASkjJ,EAAUxoG,MAAM16C,OAAS2vC,EAAI,KAG7D,IAAI0qG,EAAmBx7F,EAAKQ,kBAAoB,EAC5CR,EAAKuhG,oBACL/F,EAAmBx7F,EAAKQ,kBAAoB59C,KAAKC,IAAI,EAAGs9C,OAAOq7F,kBAAoB,IAEvF6I,EAAUnjJ,MAAQ2vC,EAAI2qG,EACtB6I,EAAUljJ,OAAS2vC,EAAI0qG,GAG3B+I,cAAe,WAEXrtH,SAAS+0B,KAAKH,aAAa3uD,GAAG06B,KAAKkoB,UAAW7oB,SAAS+0B,KAAK4oF,YAE5D,IAAI2P,EAAKttH,SAAS+0B,KAAKpQ,MACvB2oG,EAAGtjJ,MAAQi/C,OAAOm7F,WAAa,KAC/BkJ,EAAGrjJ,OAASg/C,OAAOo7F,YAAc,KACjCiJ,EAAG12D,SAAW,SAEd,IAAI22D,EAAYtnJ,GAAG06B,KAAKkoB,UAAUlE,MAClC4oG,EAAUvwI,SAAW,QACrBuwI,EAAUzoG,KAAOyoG,EAAU1oG,IAAM,MAEjC7kB,SAAS+0B,KAAKnP,UAAY,KAUlC3/C,GAAGqhJ,gBAAkBrhJ,GAAGE,OACpBb,KAAM,kBAENc,KAAM,WACFC,KAAKmnJ,SACDz8G,OAAQ,EAAG,GACXmgE,SAAU,OAIlBu8C,aAAc,SAAUC,EAAYC,EAAYC,EAAUC,EAAU73I,EAAQM,GAExE5K,KAAKuK,IAAIy3I,EAAaE,GAAY,IAAMA,EAAWF,GACnDhiJ,KAAKuK,IAAI03I,EAAaE,GAAY,IAAMA,EAAWF,GAEnD,IAAIz8C,EAAWjrG,GAAGgD,MAAMykJ,EAAaE,GAAY,GAAID,EAAaE,GAAY,EAAGD,EAAUC,GAU3F,OAPI5nJ,GAAG06B,KAAKkwB,WAAe5qD,GAAG06B,KAAKuvB,mBAKnC7pD,KAAKmnJ,QAAQz8G,OAAS/6B,EAAQM,GAC9BjQ,KAAKmnJ,QAAQt8C,SAAWA,EACjB7qG,KAAKmnJ,SAUhBnC,SAAU,SAAUviG,KAapBn2B,MAAO,SAAUm2B,EAAMmkG,GACnB,OAAQl8G,OAAU,EAAG,KAUzBw6G,UAAW,SAAUziG,OAIzB,WAOI,IAAIglG,EAAe7nJ,GAAGE,OAClBb,KAAM,eACNsC,QAAS3B,GAAGmhJ,kBACZz0H,MAAO,SAAUm2B,GACb,IAAIilG,EAASjlG,EAAKy+F,WAAWt9I,OAAQ6+I,EAAiB7iJ,GAAG06B,KAAKkoB,UAAUlE,MACxEt+C,KAAK6mJ,gBAAgBpkG,EAAMA,EAAKy+F,WAAWv9I,MAAO8+C,EAAKy+F,WAAWt9I,QAE9D6+C,EAAKS,WACLu/F,EAAerjG,OAAS,SAAWsoG,EAAS,KAG5CjF,EAAerjG,OAAS,MAE5BqjG,EAAetjG,QAAU,SAQ7BwoG,EAAsB/nJ,GAAGE,OACzBb,KAAM,sBACNsC,QAAS3B,GAAGmhJ,kBACZz0H,MAAO,SAAUm2B,EAAMmkG,GACnB,IAGIS,EAAYC,EAHZM,EAASnlG,EAAKy+F,WAAWv9I,MAAO+jJ,EAASjlG,EAAKy+F,WAAWt9I,OAAQ6+I,EAAiB7iJ,GAAG06B,KAAKkoB,UAAUlE,MACpGupG,EAAUjB,EAAmBjjJ,MAAOmkJ,EAAUlB,EAAmBhjJ,OACjE+L,EAASi4I,EAASC,EAAS53I,EAASy3I,EAASI,EAGjDn4I,EAASM,GAAUo3I,EAAaO,EAAQN,EAAaQ,EAAUn4I,IAAW03I,EAAaQ,EAAU53I,EAAQq3I,EAAaI,GAGtH,IAAIliD,EAAOngG,KAAKqN,OAAOk1I,EAASP,GAAc,GAC1C5hD,EAAOpgG,KAAKqN,OAAOg1I,EAASJ,GAAc,GAC9CD,EAAaO,EAAS,EAAIpiD,EAC1B8hD,EAAaI,EAAS,EAAIjiD,EAE1BzlG,KAAK6mJ,gBAAgBpkG,EAAM4kG,EAAYC,GAG/B7kG,EAAKS,WACLu/F,EAAerjG,OAAS,SAAWsoG,EAAS,KAG5CjF,EAAerjG,OAAS,MAE5BqjG,EAAe13C,YAAcvF,EAAO,KACpCi9C,EAAesF,aAAeviD,EAAO,KACrCi9C,EAAeuF,WAAaviD,EAAO,KACnCg9C,EAAez3C,cAAgBvF,EAAO,QA6C9CwiD,GApCgBroJ,GAAGE,OACnBb,KAAM,gBACNsC,QAASkmJ,EACTzC,SAAU,SAAUviG,GAChBziD,KAAKysC,OAAOgW,GACZ7iD,GAAG06B,KAAKnW,MAAQwV,SAASg1B,iBAG7BriC,MAAO,SAAUm2B,GACbziD,KAAKysC,OAAOgW,GACZziD,KAAKgnJ,mBAQcpnJ,GAAGE,OAC1Bb,KAAM,uBACNsC,QAASomJ,EACT3C,SAAU,SAAUviG,GAChBziD,KAAKysC,OAAOgW,GACZ7iD,GAAG06B,KAAKnW,MAAQwV,SAASg1B,iBAG7BriC,MAAO,SAAUm2B,EAAMmkG,GACnB5mJ,KAAKysC,OAAOgW,EAAMmkG,GAClB5mJ,KAAKgnJ,mBAQWpnJ,GAAGE,OACvBb,KAAM,oBACNsC,QAAS3B,GAAGmhJ,kBACZz0H,MAAO,SAAUm2B,GACbziD,KAAK6mJ,gBAAgBpkG,EAAM7iD,GAAG06B,KAAKC,OAAO52B,MAAO/D,GAAG06B,KAAKC,OAAO32B,YASxEhE,GAAGmhJ,kBAAkBc,eAAiB,IAAI4F,EAE1C7nJ,GAAGmhJ,kBAAkBmH,oBAAsB,IAAIP,EAE/C/nJ,GAAGmhJ,kBAAkBoH,mBAAqB,IAAIF,EAG9C,IAAIG,EAAWxoJ,GAAGE,OACdb,KAAM,WACNsC,QAAS3B,GAAGqhJ,gBACZ30H,MAAO,SAAUm2B,EAAMmkG,GACnB,IAAIS,EAAaznJ,GAAG06B,KAAKC,OAAO52B,MAAO2jJ,EAAa1nJ,GAAG06B,KAAKC,OAAO32B,OAC/D+L,EAAS03I,EAAaT,EAAmBjjJ,MAAOsM,EAASq3I,EAAaV,EAAmBhjJ,OAE7F,OAAO5D,KAAKonJ,aAAaC,EAAYC,EAAYD,EAAYC,EAAY33I,EAAQM,MAIrFo4I,EAAUzoJ,GAAGE,OACbb,KAAM,UACNsC,QAAS3B,GAAGqhJ,gBACZ30H,MAAO,SAAUm2B,EAAMmkG,GACnB,IAGIW,EAAUC,EAHVH,EAAaznJ,GAAG06B,KAAKC,OAAO52B,MAAO2jJ,EAAa1nJ,GAAG06B,KAAKC,OAAO32B,OAC/DikJ,EAAUjB,EAAmBjjJ,MAAOmkJ,EAAUlB,EAAmBhjJ,OACjE+L,EAAS03I,EAAaQ,EAAS53I,EAASq3I,EAAaQ,EAASp9G,EAAQ,EAM1E,OAHA/6B,EAASM,GAA0Bs3I,EAAWF,EAAYG,EAAWM,GAAlDp9G,EAAQ/6B,KACJ43I,EAAWM,GAA3Bn9G,EAAQz6B,GAAoCu3I,EAAWF,GAEvDtnJ,KAAKonJ,aAAaC,EAAYC,EAAYC,EAAUC,EAAU98G,EAAOA,MAIhF49G,EAAW1oJ,GAAGE,OACdb,KAAM,WACNsC,QAAS3B,GAAGqhJ,gBACZ30H,MAAO,SAAUm2B,EAAMmkG,GACnB,IAEkEl8G,EAC9D68G,EAAUC,EAHVH,EAAaznJ,GAAG06B,KAAKC,OAAO52B,MAAO2jJ,EAAa1nJ,GAAG06B,KAAKC,OAAO32B,OAC/DikJ,EAAUjB,EAAmBjjJ,MAAOmkJ,EAAUlB,EAAmBhjJ,OACjE+L,EAAS03I,EAAaQ,EAAS53I,EAASq3I,EAAaQ,EAMzD,OAHAn4I,EAASM,GAA0Bs3I,EAAWM,GAA3Bn9G,EAAQz6B,GAAoCu3I,EAAWF,IACnDC,EAAWF,EAAYG,EAAWM,GAAlDp9G,EAAQ/6B,IAER3P,KAAKonJ,aAAaC,EAAYC,EAAYC,EAAUC,EAAU98G,EAAOA,MAIhF69G,EAAc3oJ,GAAGE,OACjBb,KAAM,cACNsC,QAAS3B,GAAGqhJ,gBACZ30H,MAAO,SAAUm2B,EAAMmkG,GACnB,IAAIS,EAAaznJ,GAAG06B,KAAKC,OAAO52B,MAAO2jJ,EAAa1nJ,GAAG06B,KAAKC,OAAO32B,OAC1B8mC,EAAQ48G,EAAnCV,EAAmBhjJ,OAC7B2jJ,EAAWF,EAAYG,EAAWF,EAEtC,OAAOtnJ,KAAKonJ,aAAaC,EAAYC,EAAYC,EAAUC,EAAU98G,EAAOA,MAIhF89G,EAAa5oJ,GAAGE,OAChBb,KAAM,aACNsC,QAAS3B,GAAGqhJ,gBACZ30H,MAAO,SAAUm2B,EAAMmkG,GACnB,IAAIS,EAAaznJ,GAAG06B,KAAKC,OAAO52B,MAAO2jJ,EAAa1nJ,GAAG06B,KAAKC,OAAO32B,OAC3B8mC,EAAQ28G,EAAlCT,EAAmBjjJ,MAC7B4jJ,EAAWF,EAAYG,EAAWF,EAEtC,OAAOtnJ,KAAKonJ,aAAaC,EAAYC,EAAYC,EAAUC,EAAU98G,EAAOA,MAKpF9qC,GAAGqhJ,gBAAgBa,UAAY,IAAIsG,EAEnCxoJ,GAAGqhJ,gBAAgBh1D,SAAW,IAAIo8D,EAElCzoJ,GAAGqhJ,gBAAgB70D,UAAY,IAAIk8D,EAEnC1oJ,GAAGqhJ,gBAAgB90D,aAAe,IAAIo8D,EAEtC3oJ,GAAGqhJ,gBAAgB/0D,YAAc,IAAIs8D,EAtMzC,GAqNA5oJ,GAAGosF,iBAAmBpsF,GAAGE,OACrBb,KAAM,sBAMNc,KAAM,SAAU0oJ,EAAcC,GAC1B1oJ,KAAK2oJ,mBAAqB,KAC1B3oJ,KAAK4oJ,iBAAmB,KACxB5oJ,KAAK6oJ,qBAAqBJ,GAC1BzoJ,KAAK8oJ,mBAAmBJ,IAS5B1D,SAAU,SAAUviG,GAChBziD,KAAK2oJ,mBAAmB3D,SAASviG,GACjCziD,KAAK4oJ,iBAAiB5D,SAASviG,IAanCn2B,MAAO,SAAUm2B,EAAMmkG,GAEnB,OADA5mJ,KAAK2oJ,mBAAmBr8H,MAAMm2B,EAAMmkG,GAC7B5mJ,KAAK4oJ,iBAAiBt8H,MAAMm2B,EAAMmkG,IAS7C1B,UAAW,SAAUziG,GACjBziD,KAAK2oJ,mBAAmBzD,UAAUziG,GAClCziD,KAAK4oJ,iBAAiB1D,UAAUziG,IAUpComG,qBAAsB,SAAUJ,GACxBA,aAAwB7oJ,GAAGmhJ,oBAC3B/gJ,KAAK2oJ,mBAAqBF,IAUlCK,mBAAoB,SAAUJ,GACtBA,aAAsB9oJ,GAAGqhJ,kBACzBjhJ,KAAK4oJ,iBAAmBF,MAIpCrqI,EAAGsK,IAAI/oB,GAAGosF,iBAAiB1pF,UAAW,aAAc,WAChD,OAAO1C,GAAGqE,GAAGrE,GAAG06B,KAAKC,OAAO52B,MAAO/D,GAAG06B,KAAKC,OAAO32B,UAUtDhE,GAAGosF,iBAAiB81D,UAAY,EAShCliJ,GAAGosF,iBAAiBI,UAAY,EAShCxsF,GAAGosF,iBAAiBC,SAAW,EAW/BrsF,GAAGosF,iBAAiBG,aAAe,EAWnCvsF,GAAGosF,iBAAiBE,YAAc,EAQlCtsF,GAAGosF,iBAAiB0nB,QAAU,EAa9B9zG,GAAG6iD,KAAO,IAAI65B,EAQd18E,GAAGoE,QAAUpE,GAAGqE,KAEhB9E,EAAOE,QAAUO,GAAG6iD,0HCh+CpB7iD,GAAGkqE,aACCi/E,QAAQnpJ,GAAGqE,GAAG,EAAE,GAChB+kJ,SAASppJ,GAAGqE,GAAG,EAAE,GACjBu6C,IAAI5+C,GAAGqE,GAAG,EAAE,GACZglJ,WAAWrpJ,GAAGqE,GAAG,EAAE,GACnBilJ,YAAYtpJ,GAAGqE,GAAG,EAAE,GACpB01E,OAAO/5E,GAAGqE,GAAG,EAAE,GACfuvC,OAAO5zC,GAAGqE,GAAG,EAAE,GACfw6C,KAAK7+C,GAAGqE,GAAG,EAAE,GACb20E,MAAMh5E,GAAGqE,GAAG,EAAE,GACdN,MAAM,EACNC,OAAO,EAOPwL,KAAK,SAAS06D,GAEV,IAAIx2B,EAAItzC,KAAK2D,MAAQmmE,EAAYnmE,MAC7B4vC,EAAIvzC,KAAK4D,OAASkmE,EAAYlmE,OAC9B2d,EAAIuoD,EAAYxqE,EAChB4M,EAAI49D,EAAYpmE,EAChB0D,EAAI8E,EAAIqnC,EACRr5B,EAAIqH,EAAI+xB,EAGZtzC,KAAK+oJ,QAAQzpJ,EAAIiiB,EACjBvhB,KAAK+oJ,QAAQrlJ,EAAI0D,EACjBpH,KAAKgpJ,SAAS1pJ,EAAI4a,EAClBla,KAAKgpJ,SAAStlJ,EAAI0D,EAClBpH,KAAKw+C,IAAIl/C,EAAIiiB,EAAI+xB,EAAE,EACnBtzC,KAAKw+C,IAAI96C,EAAI0D,EAGbpH,KAAKipJ,WAAW3pJ,EAAIiiB,EACpBvhB,KAAKipJ,WAAWvlJ,EAAIwI,EACpBlM,KAAKkpJ,YAAY5pJ,EAAI4a,EACrBla,KAAKkpJ,YAAYxlJ,EAAIwI,EACrBlM,KAAK25E,OAAOr6E,EAAIiiB,EAAI+xB,EAAE,EACtBtzC,KAAK25E,OAAOj2E,EAAIwI,EAGhBlM,KAAKwzC,OAAOl0C,EAAIiiB,EAAI+xB,EAAE,EACtBtzC,KAAKwzC,OAAO9vC,EAAIwI,EAAIqnC,EAAE,EAGtBvzC,KAAKy+C,KAAKn/C,EAAIiiB,EACdvhB,KAAKy+C,KAAK/6C,EAAIwI,EAAIqnC,EAAE,EAGpBvzC,KAAK44E,MAAMt5E,EAAI4a,EACfla,KAAK44E,MAAMl1E,EAAIwI,EAAIqnC,EAAE,8BC5D7B,IAAIl1B,EAAK3e,EAAQ,QAGXg+H,GAFgBh+H,EAAQ,WAAW89H,oBAEvB,OAElB,SAAS2rB,EAAmBv1F,EAAOw1F,EAAWC,GAC1C,IAAIC,EAYAA,EAAY,aAEZD,GACAhrI,EAAGmE,OAAO8mI,EAAWD,EAAWvqI,aAEpC,IAAI2/G,EAAQ,IAAI6qB,EAEhB,OADAjrI,EAAGta,MAAM6vD,EAAO,YAAa6qE,GACtBA,EAkCX,SAASG,EAAM7+H,EAAMsjB,EAAUkmI,GAC3B,IAAI9qB,EAAOO,EAAQt5E,EACnB,GAAoB,mBAAT3lD,EAGPi/H,GADAP,EAAQgC,EAAc1gI,IACP+e,YAAYxc,cAE1B,CAED,IAAI63B,EAAWp6B,EAEf,KADA0+H,EAAQtkG,EAASqvH,WAIb/qB,EAAQ0qB,EAAkBhvH,EAAUp6B,EADrB0gI,EADf1gI,EAAOo6B,EAASrb,cAIpBkgH,EAASP,EAGb,QAAwB,IAAb8qB,EAA0B,CAEjC,IAAIE,EAASpmI,EAAWq6G,EACpBroH,KACJ,IAAKqwC,KAAO+4E,EACJ/4E,EAAII,WAAW2jG,KACfp0I,EAAIqwC,EAAIl9C,MAAMihJ,EAAOjqJ,SAAWi/H,EAAM/4E,IAG9C,OAAOrwC,EAIP,GAAwB,iBAAbk0I,EACP,IAAK7jG,KAAO6jG,EACkB,KAAtB7jG,EAAI6gB,WAAW,KACfy4D,EAAO37G,EAAWq6G,EAAYh4E,GAAO6jG,EAAS7jG,SAIjD0+B,EAOjB,SAASq8C,EAAe1gI,GACpB,OAAQA,EAAKw/H,eAAe,cAAgBx/H,EAAKypJ,WA7ErD,SAAsBE,GAGlB,IAFA,IAAIC,EACAC,EAAShqJ,GAAGE,MAAMsjI,oBAAoBsmB,GACjCnqJ,EAAIqqJ,EAAOpqJ,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACzC,IAAIsuF,EAAM+7D,EAAOrqJ,GACLsuF,EAAI0xC,eAAe,cAAgB1xC,EAAI27D,WAG/CL,EAAkBt7D,EAAKA,GADvB87D,EAAaC,EAAOrqJ,EAAI,KACkBoqJ,EAAWH,WAK7D,OADAL,EAAkBO,EAAUA,GAD5BC,EAAaC,EAAO,KACgCD,EAAWH,WACxDE,EAASF,UAgE+CK,CAAY9pJ,GAI/E,SAASojI,EAAoBpjI,GACzB,OAAO0gI,EAAc1gI,GAAM+e,YAAYxc,UA4G3C,SAASq7H,EAAgBj1G,EAAM67G,GACvBngD,EAhFRxkF,GAAG+1D,QAAU,UAkBb/1D,GAAGy0F,MAAQ,QAyBXz0F,GAAG8hE,QAAU,UAkBb9hE,GAAGgyE,OAAS,SAmHZzyE,EAAOE,SACHu/H,KAAMA,EACN6B,cAAeA,EACf0C,mBAAoBA,EACpB3E,aA9MJ,SAAuBz+H,EAAMsjB,EAAUqiC,EAAK3hD,GAC5Bo/H,EAAmBpjI,GACzBsjB,EAAWq6G,EAAYh4E,GAAO3hD,GA6MpC25H,UAAWA,EACXC,eAAgBA,EAChBqG,WA/BJ,SAAqB8lB,GACjB,OACIphI,KAAM,SACN3oB,KAAM+pJ,EACNjrB,cAAcz6C,IA4BlB2/C,iFCpUJ,IAAM1lH,EAAK3e,EAAQ,QACbgoB,EAAerJ,EAAGiE,MAAMoF,aAE9B,SAASqiI,IACL/pJ,KAAKw9G,aACLx9G,KAAKshB,WACLthB,KAAKu9G,YAAa,EAClBv9G,KAAKy9G,iBAAkB,EAE3B,IAAI9vF,EAAQo8H,EAAaznJ,UAEzBqrB,EAAMq8H,SAAW,SAAU1nI,EAAOve,GAG9B,IAFA,IAAIy5G,EAAYx9G,KAAKw9G,UACjBl8F,EAAUthB,KAAKshB,QACV/hB,EAAI,EAAGA,EAAI+iB,EAAM9iB,SAAUD,EAC5B+iB,EAAM/iB,KAAOwE,IACb2jB,EAAa81F,EAAWj+G,GACxBmoB,EAAapG,EAAS/hB,KACpBA,IAKdouB,EAAMg2C,OAAS,SAAUtiD,GACrBrhB,KAAKw9G,UAAUn8F,GAASrhB,KAAKshB,QAAQD,GAAS,KAC9CrhB,KAAKy9G,iBAAkB,GAG3B9vF,EAAMs8H,UAAY,WAGd,IAFA,IAAIzsC,EAAYx9G,KAAKw9G,UACjBl8F,EAAUthB,KAAKshB,QACV/hB,EAAI,EAAGA,EAAIi+G,EAAUh+G,OAAQD,IAClCi+G,EAAUj+G,GAAK+hB,EAAQ/hB,GAAK,KAEhCS,KAAKy9G,iBAAkB,GAI3B9vF,EAAM+vF,cAAgB,WAClB19G,KAAKgqJ,SAAShqJ,KAAKw9G,UAAW,MAC9Bx9G,KAAKy9G,iBAAkB,GAI3B,IACMysC,EAAmB,IAAI7rI,EAAG26E,KAAK,SAAUv7D,GAC3CA,EAAK+/E,UAAUh+G,OAAS,EACxBi+B,EAAKnc,QAAQ9hB,OAAS,EACtBi+B,EAAK8/E,YAAa,EAClB9/E,EAAKggF,iBAAkB,GALV,IAkBjB,SAASP,IACLl9G,KAAKq9G,eAAiBh/F,EAAGG,WAAU,GAZvC0rI,EAAiBvhI,IAAM,WACnB,OAAO3oB,KAAKm5F,QAAU,IAAI4wD,IAa9Bp8H,EAAQuvF,EAAiB56G,WAQnBuC,IAAM,SAAU6gD,EAAKv3B,EAAUjuB,GACjC,IAAIu9B,EAAOz9B,KAAKq9G,eAAe33D,GAC1BjoB,IACDA,EAAOz9B,KAAKq9G,eAAe33D,GAAOwkG,EAAiBvhI,OAEvD8U,EAAK+/E,UAAU93G,KAAKyoB,GACpBsP,EAAKnc,QAAQ5b,KAAKxF,GAAU,OAYhCytB,EAAMe,iBAAmB,SAAUg3B,EAAKv3B,EAAUjuB,GAC9C,IAAIu9B,EAAOz9B,KAAKq9G,eAAe33D,GAC/B,IAAKjoB,EACD,OAAO,EAIX,IAAI+/E,EAAY//E,EAAK+/E,UACrB,IAAKrvF,EAAU,CAEX,GAAIsP,EAAK8/E,WAAY,CACjB,IAAK,IAAIh+G,EAAI,EAAGA,EAAIi+G,EAAUh+G,OAAQD,IAClC,GAAIi+G,EAAUj+G,GACV,OAAO,EAGf,OAAO,EAGP,OAAOi+G,EAAUh+G,OAAS,EAIlCU,EAASA,GAAU,KAEnB,IADA,IAAIohB,EAAUmc,EAAKnc,QACVyD,EAAI,EAAGA,EAAIy4F,EAAUh+G,SAAUulB,EACpC,GAAIy4F,EAAUz4F,KAAOoJ,GAAY7M,EAAQyD,KAAO7kB,EAC5C,OAAO,EAGf,OAAO,GAQXytB,EAAM+sC,UAAY,SAAUyvF,GACxB,GAA2B,iBAAhBA,EAA0B,CAEjC,IAAI1sH,EAAOz9B,KAAKq9G,eAAe8sC,GAC3B1sH,IACIA,EAAK8/E,WACL9/E,EAAKwsH,aAGLC,EAAiB1yF,IAAI/5B,UACdz9B,KAAKq9G,eAAe8sC,UAIlC,GAAIA,EAEL,IAAK,IAAIzkG,KAAO1lD,KAAKq9G,eAAgB,CACjC,IAAI+sC,EAAOpqJ,KAAKq9G,eAAe33D,GAC/B,GAAI0kG,EAAK7sC,WAEL,IADA,IAAIj8F,EAAU8oI,EAAK9oI,QACV/hB,EAAI,EAAGA,EAAI+hB,EAAQ9hB,SAAUD,EAC9B+hB,EAAQ/hB,KAAO4qJ,GACfC,EAAKzmF,OAAOpkE,QAKpB6qJ,EAAKJ,SAASI,EAAK9oI,QAAS6oI,KAY5Cx8H,EAAMo7B,OAAS,SAAUrD,EAAKv3B,EAAUjuB,GACpC,IAAIu9B,EAAOz9B,KAAKq9G,eAAe33D,GAC/B,GAAIjoB,EAAM,CACNv9B,EAASA,GAAU,KAGnB,IAFA,IAAIs9G,EAAY//E,EAAK+/E,UACjBl8F,EAAUmc,EAAKnc,QACV/hB,EAAI,EAAGA,EAAIi+G,EAAUh+G,SAAUD,EACpC,GAAIi+G,EAAUj+G,KAAO4uB,GAAY7M,EAAQ/hB,KAAOW,EAAQ,CAChDu9B,EAAK8/E,WACL9/E,EAAKkmC,OAAOpkE,IAGZmoB,EAAa81F,EAAWj+G,GACxBmoB,EAAapG,EAAS/hB,IAE1B,SAchB,IAAIo+G,EAAmB,WACnBT,EAAiB36G,KAAKvC,OAE1Bqe,EAAGmE,OAAOm7F,EAAkBT,GAe5BS,EAAiBr7G,UAAUs/E,OAAS,SAAUl8B,EAAKz+C,EAAIC,EAAIC,EAAIkjJ,EAAIC,GAC/D,IAAI7sH,EAAOz9B,KAAKq9G,eAAe33D,GAC/B,GAAIjoB,EAAM,CACN,IAAI6/E,GAAe7/E,EAAK8/E,WACxB9/E,EAAK8/E,YAAa,EAIlB,IAFA,IAAIC,EAAY//E,EAAK+/E,UACjBl8F,EAAUmc,EAAKnc,QACV/hB,EAAI,EAAGwuB,EAAMyvF,EAAUh+G,OAAQD,EAAIwuB,IAAOxuB,EAAG,CAClD,IAAI4uB,EAAWqvF,EAAUj+G,GACzB,GAAI4uB,EAAU,CACV,IAAIjuB,EAASohB,EAAQ/hB,GACjBW,EACAiuB,EAAS5rB,KAAKrC,EAAQ+G,EAAIC,EAAIC,EAAIkjJ,EAAIC,GAGtCn8H,EAASlnB,EAAIC,EAAIC,EAAIkjJ,EAAIC,IAKjChtC,IACA7/E,EAAK8/E,YAAa,EACd9/E,EAAKggF,iBACLhgF,EAAKigF,mBAMrBC,EAAiBT,iBAAmBA,EACpC/9G,EAAOE,QAAUs+G,sCChOjBx+G,EAAOE,SACHkrJ,iBARJ,SAA2BjoI,GACvB,IACIkoI,KAEJ,OAnBJ,SAASC,EAAaD,EAASloI,GAC3B,IAAK,IAAI/iB,EAAI,EAAGA,EAAI+iB,EAAM9iB,OAAQD,IAAK,CACnC,IAAIi7B,EAAOlY,EAAM/iB,GACb8T,MAAM2P,QAAQwX,GACdiwH,EAAYD,EAAShwH,GAMrBgwH,EAAQ9kJ,KAAK80B,IAQrBiwH,CAAYD,EAASloI,GACdkoI,EAAQvtG,KAHiB,gCChBpC,IAAI5+B,EAAK3e,EAAQ,QACb69H,EAAO79H,EAAQ,eACfsgI,EAAUtgI,EAAQ,aAClBC,EAAOD,EAAQ,iBAUfm2H,EAAU,WAKV71H,KAAKi2H,YAKLj2H,KAAKm2H,eAKLn2H,KAAKq2H,gBAGLr2H,KAAKu2H,aAAel4G,EAAGG,WAAU,IAKrCq3G,EAAQvzH,UAAUu1C,MAAQ,WACtB73C,KAAKi2H,SAASz2H,OAAS,EACvBQ,KAAKm2H,YAAY32H,OAAS,EAC1BQ,KAAKq2H,aAAa72H,OAAS,EAC3B6e,EAAGulC,MAAM5jD,KAAKu2H,eAiClBV,EAAQvzH,UAAUoD,KAAO,SAAUmxD,EAAKxzC,EAAUshC,EAAM4xE,GAChDA,IACAv2H,KAAKu2H,aAAav2H,KAAKi2H,SAASz2H,SAAU,GAE9CQ,KAAKi2H,SAASvwH,KAAKi/C,GACnB3kD,KAAKm2H,YAAYzwH,KAAKmxD,GACtB72D,KAAKq2H,aAAa3wH,KAAK2d,KAG3BwyG,EAAQ98B,KAAO,IAAI16E,EAAG26E,KAAK,SAAUniC,GACjCA,EAAIhf,SACL,KAEUlvB,IAAM,WACf,OAAO3oB,KAAKm5F,QAAU,IAAI08B,GAK9B,IAAI60B,EAAiB,WACjB,SAASA,EAAcp2I,EAAQpU,EAAQw1H,EAAa9+C,EAAW+zE,GAC3D3qJ,KAAKsU,OAASA,EACdtU,KAAK42E,UAAYA,EACjB52E,KAAK4qJ,oBACL5qJ,KAAK6qJ,iBAAmB,KACxB7qJ,KAAK8qJ,aAAep1B,EAKpB11H,KAAK+qJ,WACL/qJ,KAAKgrJ,cACLhrJ,KAAKirJ,eA4BT,IAAI3oJ,EAAYooJ,EAAcpoJ,UAkR9B,SAAS4oJ,EAAsBC,EAAS5sB,EAAc6sB,EAAeC,EAAsBC,EAAyBh1B,GAChH,GAAIiI,aAAwB3+H,GAAG6hI,UAAW,CAEjC6pB,GACDH,EAAQzlJ,KAAK,aAEjB,IAAI6lJ,EAAWltI,EAAGmuE,aAAa+xC,GAC/B4sB,EAAQzlJ,KAAR,8BAA2C0lJ,EAA3C,SAAiEG,EAAjE,MACKD,GACDH,EAAQzlJ,KAAK,UAAY0lJ,EAAgB,eAI7CD,EAAQzlJ,KAAK,aACTylJ,EAAQzlJ,KAAK,iCACI2lJ,EACqC,WACnC/0B,EACN,MACjB60B,EAAQzlJ,KAAK,UAAY0lJ,EAAgB,UAnSjD9oJ,EAAUokE,YAAc,SAAU8kF,GAC9B,GAAIn4I,MAAM2P,QAAQwoI,GAAU,CACxB,IAAIC,EAAYD,EACZE,EAAWD,EAAUjsJ,OACzBQ,KAAK4qJ,iBAAiBprJ,OAASksJ,EAE/B,IAAK,IAAInsJ,EAAI,EAAGA,EAAImsJ,EAAUnsJ,IAAK,CAC/B,GAAIksJ,EAAUlsJ,GAMNS,KAAK4qJ,iBAAiBrrJ,GAAKS,KAAK2rJ,mBAAmBF,EAAUlsJ,IAAI,GAI7ES,KAAK6qJ,iBAAmBa,EAAW,EAAI1rJ,KAAK4qJ,iBAAiB,WAU7D5qJ,KAAK4qJ,iBAAiBprJ,OAAS,EAK3BQ,KAAK6qJ,iBAAmBW,EAAUxrJ,KAAK2rJ,mBAAmBH,GAAS,GAAS,KAEhFxrJ,KAAK4qJ,iBAAiB,GAAK5qJ,KAAK6qJ,iBAWpC,OAxEJ,SAAuBt8H,GAEnB,IAKIhvB,EAAG8jB,EAAUgV,EALbuyH,EAAmBr8H,EAAKq8H,iBACxBgB,EAAar9H,EAAK08H,YAClBY,EAASt9H,EAAKw8H,QACde,EAAYv9H,EAAKy8H,WAYjB,IAXiBz8H,EAAKu8H,cAAgBv8H,EAAKu8H,aAAaiB,eAWnDxsJ,EAAI,EAAGA,EAAIssJ,EAAOrsJ,OAAQD,IAC3B8jB,EAAWuoI,EAAWrsJ,GACtB84B,EAAKwzH,EAAOtsJ,GACZusJ,EAAUvsJ,GAAG8jB,GAAYunI,EAAiBvyH,GAkDlD2zH,CAAahsJ,MAENA,KAAK6qJ,kBAUhBvoJ,EAAUqpJ,mBAAqB,SAAUM,EAAY11B,EAAcr2H,EAAQ0zD,EAAOvwC,GAC9E,IAAIO,EACAizC,EAAM,KACNwsE,EAAQ,KACR36G,EAAOujI,EAAW12B,SACtB,GAAI7sG,EAAM,CAKN,KADA26G,EAAQrjI,KAAK8qJ,aAAapiI,EAAMujI,EAAYr4F,EAAOvwC,IAM/C,OAJkBrjB,KAAK8qJ,eAAiBzsI,EAAGowE,eAEvC7uF,GAAG8mE,YAAY2nC,mBAAmB3lF,GAE/B,KAeX,IAHImuC,EAAM,IAAIwsE,GAGNz3F,aAEJ,OADAirB,EAAIjrB,aAAaqgH,EAAWzkF,QAASxnE,MAC9B62D,EAEPj3D,GAAGE,MAAMmgI,WAAWoD,GA+bhC,SAAgC90G,EAAMsoC,EAAKo1F,EAAY5oB,EAAOnjI,GAC1D,IAAIwmE,EACA28D,EAAM9D,eAAe,mBACrB74D,EAAc28D,EAAM6oB,iBAGpBxlF,EAAcylF,EAAmB59H,EAAM80G,GAIvChlH,EAAGta,MAAMs/H,EAAO,kBAAmB38D,GAAa,IAEpDA,EAAYn4C,EAAMsoC,EAAKo1F,EAAY5oB,EAAOnjI,GAEvByrC,EA5cXygH,CAAsBpsJ,KAAM62D,EAAKo1F,EAAY5oB,EAAOnjI,GAGpDF,KAAKqsJ,wBAAwBx1F,EAAKo1F,EAAY5oB,QAGjD,GAAMhwH,MAAM2P,QAAQipI,GAOpB,CASGp1F,EAAM,IAAIxjD,MAAM44I,EAAWzsJ,QAG/B,IAAK,IAAID,EAAI,EAAGA,EAAI0sJ,EAAWzsJ,OAAQD,IAEf,iBADpBqkB,EAAOqoI,EAAW1sJ,KACcqkB,EAKxB5jB,KAAKssJ,qBAAqBz1F,EAAKjzC,EAAM,GAAKrkB,EAAG,KAAMg3H,GAIvD1/D,EAAIt3D,GAAKqkB,OA1BjBizC,KACA72D,KAAKusJ,4BAA4B11F,EAAKo1F,GA6B1C,OAAOp1F,GAIXv0D,EAAUgqJ,qBAAuB,SAAUz1F,EAAK20F,EAASnoI,EAAUnjB,EAAQq2H,GACvE,IAAIl+F,EAAKmzH,EAAQgB,OACjB,QAAWnmJ,IAAPgyB,EAAkB,CAClB,IAAIssB,EAAO6mG,EAAQiB,SACf9nG,EAUA3kD,KAAKsU,OAAO5O,KAAKmxD,EAAKxzC,EAAUshC,EAAM4xE,GAOlC1/D,EAAIxzC,GAAYrjB,KAAK2rJ,mBAAmBH,EAASj1B,OAIxD,CACD,IAAIm2B,EAAO1sJ,KAAK4qJ,iBAAiBvyH,GAC7Bq0H,EACA71F,EAAIxzC,GAAYqpI,GAGhB1sJ,KAAK+qJ,QAAQrlJ,KAAK2yB,GAClBr4B,KAAKgrJ,WAAWtlJ,KAAKmxD,GACrB72D,KAAKirJ,YAAYvlJ,KAAK2d,MAKlC/gB,EAAUiqJ,4BAA8B,SAAUpyH,EAAU8xH,GAExD,IAAK,IAAI5oI,KAAY4oI,EACjB,GAAIA,EAAW1sB,eAAel8G,GAAW,CACrC,IAAIO,EAAOqoI,EAAW5oI,GACF,iBAATO,EACU,aAAbP,IACA8W,EAAS9W,GAAYO,GAIrBA,EAVL5jB,KAecssJ,qBAAqBnyH,EAAUvW,EAAMP,GAI9C8W,EAAS9W,GAAY,OAkCzC/gB,EAAU+pJ,wBAA0B,SAAUlyH,EAAU8xH,EAAY5oB,GAChE,GAAIA,IAAUzjI,GAAGyE,KAGb,OAFA81B,EAAS76B,EAAI2sJ,EAAW3sJ,GAAK,OAC7B66B,EAASz2B,EAAIuoJ,EAAWvoJ,GAAK,GAG5B,GAAI2/H,IAAUzjI,GAAG8c,MAAjB,CAQA,GAAI2mH,IAAUzjI,GAAGy1D,KAGlB,OAFAl7B,EAASx2B,MAAQsoJ,EAAWtoJ,OAAS,OACrCw2B,EAASv2B,OAASqoJ,EAAWroJ,QAAU,GAI3C,IAAI+oJ,EAAmBtpB,EAAMlF,UACxBwuB,IACDA,EAAmBroG,OAAOC,KAAKpqB,IAEnC,IAAK,IAAI56B,EAAI,EAAGA,EAAIotJ,EAAiBntJ,OAAQD,IAAK,CAC9C,IAAI8jB,EAAWspI,EAAiBptJ,GAC5BqkB,EAAOqoI,EAAW5oI,QACThd,IAATud,GAAsBqoI,EAAW1sB,eAAel8G,KAC5B,iBAATO,EACPuW,EAAS9W,GAAYO,EAEhBA,EAKD5jB,KAAKssJ,qBAAqBnyH,EAAUvW,EAAMP,GAI9C8W,EAAS9W,GAAY,WAlC5B,CACD8W,EAASjgB,EAAI+xI,EAAW/xI,GAAK,EAC7BigB,EAASxd,EAAIsvI,EAAWtvI,GAAK,EAC7Bwd,EAASjuB,EAAI+/I,EAAW//I,GAAK,EAC7B,IAAInD,EAAIkjJ,EAAWljJ,EACnBoxB,EAASpxB,OAAW1C,IAAN0C,EAAkB,IAAMA,IA0D9C,IAAIojJ,EAAsC,SAAU59H,EAAM80G,GAetD,IAdA,IAAIupB,EAAOrvB,EAAKG,UAAY,OAExBv6B,GADco6B,EAAKG,UACTH,EAAKG,UAAY,WAC3BmvB,EAAoBtvB,EAAKG,UAAY,iBACrCovB,EAAyBvvB,EAAKG,UAAY,uBAC1Ce,EAAQlB,EAAKkD,cAAc4C,GAE3Bh+G,EAAQg+G,EAAMhB,WAEd8oB,GACA,aAEA4B,EAAWptJ,EAAKouG,mBAAmBntB,KAAKviE,EAAGswE,YAAY00C,IAElD78H,EAAI,EAAGA,EAAI6e,EAAM7lB,OAAQgH,IAAK,CACnC,IAKI4kJ,EAAeC,EALfhoI,EAAWgC,EAAM7e,GACDmlC,EAKhBq0F,EAAQiB,cAAcrgD,KAAKv9D,IAC3BgoI,EAAuB,IAAMhoI,EAAW,IACxC+nI,EAAgB,IAAM/nI,GAItB+nI,EAAgB,KADhBC,EAAuBrrB,EAAQgB,YAAY39G,IACE,IAGjD,IAAI2pI,EAAgB5B,EACpB,GAAI3sB,EAAMp7G,EAAWypI,GAAyB,CAC1C,IAAIG,EAAiBxuB,EAAMp7G,EAAWypI,GAElCE,EADAhtB,EAAQiB,cAAcrgD,KAAKqsE,GACX,IAAMA,EAGN,IAAMjtB,EAAQgB,YAAYisB,GAAkB,IAIpE9B,EAAQzlJ,KAAK,SAAWsnJ,EAAgB,KACxC7B,EAAQzlJ,KAAR,kCAEA,IAAI4wH,EAAcmI,EAAMp7G,EAAWwpI,GAE/BtuB,EAAeyB,EAAQb,WAAWV,EAAMp7G,EAAW8/E,IACvD,GAAI4pD,EAAU,CACV,IAAIG,EACAC,EAAW1uB,EAAMp7G,EAAWupI,GAChC,QAAqBvmJ,IAAjBk4H,GAA8B4uB,EAC9BD,EAAkBC,IAAavtJ,GAAGgyE,QAChBu7E,IAAavtJ,GAAG+1D,SAChBw3F,IAAavtJ,GAAGy0F,OAChB84D,IAAavtJ,GAAG8hE,YAEjC,CACD,IAAI0rF,SAAqB7uB,EACzB2uB,EAAmC,WAAhBE,IAA6B92B,GACd,WAAhB82B,GACgB,YAAhBA,EAGlBF,EACA/B,EAAQzlJ,KAAR,IAAiB0lJ,EAAjB,UAGAF,EAAqBC,EAAS5sB,EAAc6sB,EAAeC,GAAsB,EAAM/0B,QAI3F60B,EAAQzlJ,KAAK,+BACU0lJ,EAAgB,gBAEvCF,EAAqBC,EAAS5sB,EAAc6sB,EAAeC,GAAsB,EAAO/0B,GACxF60B,EAAQzlJ,KAAK,KAEjBylJ,EAAQzlJ,KAAK,MAEb9F,GAAGye,GAAGmrD,eAAe65D,EAAOzjI,GAAGk3G,YAAcl3G,GAAGye,GAAGmrD,eAAe65D,EAAOzjI,GAAGw8E,aAQxE+uE,EAAQzlJ,KAAK,yBASrB,MANgC,gBAA5B2f,EAAMA,EAAM7lB,OAAS,KAErB2rJ,EAAQzlJ,KAAK,gDAEbylJ,EAAQzlJ,KAAK,oDAEV48E,SAAS,IAAK,IAAK,IAAK,IAAK,IAAK6oE,EAAQluG,KAAK,MAoM1D,OA/BAytG,EAAc3xD,KAAO,IAAI16E,EAAG26E,KAAK,SAAUniC,GACvCA,EAAIviD,OAAS,KACbuiD,EAAI+f,UAAY,KAChB/f,EAAI+zF,iBAAiBprJ,OAAS,EAC9Bq3D,EAAIg0F,iBAAmB,KACvBh0F,EAAIi0F,aAAe,KAInBj0F,EAAIk0F,QAAQvrJ,OAAS,EACrBq3D,EAAIm0F,WAAWxrJ,OAAS,EACxBq3D,EAAIo0F,YAAYzrJ,OAAS,GAC1B,GAEHkrJ,EAAc3xD,KAAKpwE,IAAM,SAAUrU,EAAQpU,EAAQw1H,EAAa9+C,EAAW+zE,GACvE,IAAI7rJ,EAAQkB,KAAKm5F,OACjB,OAAIr6F,GACAA,EAAMwV,OAASA,EACfxV,EAAM83E,UAAYA,EAClB93E,EAAMgsJ,aAAep1B,EAKd52H,GAGA,IAAI4rJ,EAAcp2I,EAAQpU,EAAQw1H,EAAa9+C,EAAW+zE,IAIlED,EAvnBU,GA2oBrB9qJ,GAAG8mE,YAAc,SAAU/1D,EAAM08I,EAASx4E,GAEtC,IAAI6gD,GADJ7gD,EAAUA,OACgB6gD,aAAer3G,EAAGowE,cAExC6+D,EAAkBz4E,EAAQy4E,iBAAmB1tJ,GAAGi4B,IAAIo2F,WAAaruH,GAAGi4B,IAAI2jH,YAExE5kE,EAAY/B,EAAQ+B,UACpB+zE,EAAmB91E,EAAQ81E,iBAMX,iBAATh6I,IACPA,EAAO86C,KAAKyyC,MAAMvtF,IAKtB,IAAI48I,GAAeF,EACnBA,EAAUA,GAAWx3B,EAAQ98B,KAAKpwE,MAClC,IAAI6kI,EAAe9C,EAAc3xD,KAAKpwE,IAAI0kI,GAhBfn3E,EAgBgCw/C,EAAa9+C,EAAW+zE,GAEnF/qJ,GAAG06B,KAAK2vB,YAAa,EACrB,IAAI3R,EAAMk1G,EAAa9mF,YAAY/1D,GAgBnC,OAfA/Q,GAAG06B,KAAK2vB,YAAa,EAErBygG,EAAc3xD,KAAKvhC,IAAIg2F,GACnBF,GACAD,EAAQI,eAAeC,OAAO5mF,UAAU6mF,SAExCJ,GACA13B,EAAQ98B,KAAKvhC,IAAI61F,GAQd/0G,GAGX14C,GAAG8mE,YAAYmvD,QAAUA,EACzBj2H,GAAG8mE,YAAY2nC,mBAAqB,SAAUh2E,GAMtCz4B,GAAGu+B,OAAO,KAAM9F,8FCvxBxB,IAAIu1H,EAAc,IAKlB,SAASC,EAAaC,GAElB9tJ,KAAKq4B,GAAK,EAAqB,IAAhBhzB,KAAK8pH,SAEpBnvH,KAAKypJ,OAASqE,EAAYA,EAAWF,EAAe,GAOxDC,EAAYvrJ,UAAU4iE,SAAW,WAC7B,OAAOllE,KAAKypJ,UAAYzpJ,KAAKq4B,IAOjCw1H,EAAYE,OAAS,IAAIF,EAAY,UAErC1uJ,EAAOE,QAAUwuJ,4BC5BjBnuJ,EAAQ,QACRA,EAAQ,aACRA,EAAQ,sBACRA,EAAQ,YACRA,EAAQ,cACRA,EAAQ,uBACRA,EAAQ,SACRA,EAAQ,iBACRA,EAAQ,iBACRA,EAAQ,qBACRA,EAAQ,qBACRA,EAAQ,WACRA,EAAQ,aAGJA,EAAQ,oBACRA,EAAQ,yUCdZ,IAAI2pE,EAAW3pE,EAAQ,cACnBs1I,EAAY3rE,EAAShY,MAAM2jF,UAC3BK,EAAiBhsE,EAAShY,MAAMgkF,eAChC9X,EAAO79H,EAAQ,eACf2e,EAAK3e,EAAQ,QACbsgI,EAAUtgI,EAAQ,aAClBsuJ,EAAWtuJ,EAAQ,cAEnByjG,EAAUo6B,EAAKG,UAAY,UAC3BuD,EAAgBjB,EAAQiB,cACxBD,EAAchB,EAAQgB,YAEpBitB,EAAM,OACNC,EAAY,IACZC,EAAiB,IAIjBC,GACFC,UAAW,UACXnlI,YAAa,YACbolI,WAAY,WACZC,YAAa,YACbC,YAAa,YACbC,eAAgB,eAChBC,iBAAiB,EACjBC,iBAAiB,GAOrB,SAASC,EAAaC,EAASttB,GAC3BvhI,KAAK6uJ,QAAUA,EACf7uJ,KAAKuhI,WAAaA,EAUtB,SAASutB,EAAkBxtB,EAAWC,GAClC,OAAIA,aAAsBqtB,EACf,IAAIA,EAAYrtB,EAAWstB,QAASvtB,EAAYC,EAAWA,YAG3DD,EAAYC,EAW3B,SAASwtB,EAAiBC,EAAW1tB,EAAWC,GACxCluH,MAAM2P,QAAQu+G,IACdA,EAAW,GAAKutB,EAAiBxtB,EAAWC,EAAW,IACvDytB,EAAUtpJ,KAAK67H,IAGfytB,EAAUtpJ,KAAKopJ,EAAiBxtB,EAAWC,GAAc,KAWjE,SAAS0tB,EAAaC,GAClBlvJ,KAAKmvJ,SACLnvJ,KAAKovJ,WAAaF,EAmCtB,SAASG,EAAiB7tB,EAAKz9H,GAC3B,GAAmB,mBAARy9H,EACP,IACIA,EAAMA,IAEV,MAAOp1B,GACH,OAAO,EAGf,GAAIo1B,IAAQz9H,EACR,OAAO,EAEX,GAAIy9H,GAAOz9H,EAAO,CACd,GAAIy9H,aAAe5hI,GAAG6hI,WAAaD,EAAIprE,OAAOryD,GAC1C,OAAO,EAEX,GAAKsP,MAAM2P,QAAQw+G,IAAQnuH,MAAM2P,QAAQjf,IACpCy9H,EAAI1iH,cAAgBwlC,QAAUvgD,EAAM+a,cAAgBwlC,OAErD,IACI,OAAOjxC,MAAM2P,QAAQw+G,IAAQnuH,MAAM2P,QAAQjf,IAAyB,IAAfy9H,EAAIhiI,QAAiC,IAAjBuE,EAAMvE,OAEnF,MAAO4sG,KAIf,OAAO,EAGX,SAASkjD,EAAiB5pG,GACtB,OAAOu7E,EAAcrgD,KAAKl7B,GAAQ,IAAMA,EAAQ,IAAMs7E,EAAYt7E,GAAO,IAiB7E,SAAS6pG,EAAQ14F,EAAKlyD,GAsClB,IAAI6qJ,EArCJxvJ,KAAK2E,OAASA,EAEd3E,KAAKyvJ,oBACLzvJ,KAAKgvJ,aAGLhvJ,KAAK0vJ,QACL1vJ,KAAK2vJ,SAEL3vJ,KAAK4vJ,gBAAkBvxI,EAAGG,YAC1BH,EAAG21F,MAAMh0G,KAAK4vJ,gBAAiBxB,GAI/BpuJ,KAAK6vJ,mBAEL7vJ,KAAK8vJ,iBAAmB,EAExB9vJ,KAAK+vJ,gBAAkB,EAOnB/vJ,KAAKgvJ,UAAUtpJ,KAAKuoJ,EAAMC,EAAY,IAAMC,EAAiB,IAC1C,SACKD,EAAY,MACjB,SACKA,EAAY,UAAYluJ,KAAKgwJ,cAAcn5F,EAAI/3C,aAAa,GAAQ,MACzE,KACnB+3C,EAAIo5F,OAAUC,UAAW,KACzBlwJ,KAAKyvJ,iBAAiB/pJ,KAAKmxD,GAC3B72D,KAAKmwJ,gBAAgBnwJ,KAAKgvJ,UAAWn4F,GAKrC72D,KAAK6vJ,gBAAgBrwJ,OAAS,IAC9BgwJ,EAA6BvB,EAAMjuJ,KAAK6vJ,gBAAgB5yG,KAAK,KAAO,KAExE,IAAImzG,EAAOpC,EAASzD,kBAAkB,uBACNiF,MACAxvJ,KAAKgvJ,UACL,YACH,OAG7BhvJ,KAAKsU,OAASguE,SAAS,IAAK,IAAK8tE,EAAnB9tE,CAAyBtiF,KAAK0vJ,KAAM1vJ,KAAK2vJ,OAOvD,IAAK,IAAIpwJ,EAAI,EAAGwuB,EAAM/tB,KAAKyvJ,iBAAiBjwJ,OAAQD,EAAIwuB,IAAOxuB,EAC3DS,KAAKyvJ,iBAAiBlwJ,GAAG0wJ,MAAQ,KAErCjwJ,KAAKyvJ,iBAAiBjwJ,OAAS,EAxLnCovJ,EAAYtsJ,UAAUukE,SAAW,WAC7B,OAAOonF,EAAMjuJ,KAAK6uJ,QAAU,IAAM7uJ,KAAKuhI,WAAa,KA4CxD0tB,EAAY3sJ,UAAUs/G,OAAS,SAAUl8D,EAAK67E,GAC1CvhI,KAAKmvJ,MAAMzpJ,MAAMggD,EAAK67E,KAE1B0tB,EAAY3sJ,UAAU+tJ,UAAY,SAAUrB,GACxC,IAAIsB,EACJ,GAAItwJ,KAAKmvJ,MAAM3vJ,OAAS,EACpBwvJ,EAAUtpJ,KAAKyoJ,EAAiB,IAAMnuJ,KAAKovJ,WAAa,KACxDkB,EAAYnC,MAEX,CAAA,GAA0B,IAAtBnuJ,KAAKmvJ,MAAM3vJ,OAIhB,OAHA8wJ,EAAYtwJ,KAAKovJ,WAKrB,IAAK,IAAI7vJ,EAAI,EAAGA,EAAIS,KAAKmvJ,MAAM3vJ,OAAQD,IAAK,CACxC,IAAIgxJ,EAAOvwJ,KAAKmvJ,MAAM5vJ,GACtBwvJ,EAAgBC,EAAWsB,EAAYhB,EAAgBiB,EAAK,IAAM,IAAKA,EAAK,MAIpFtB,EAAYl2D,KAAO,IAAI16E,EAAG26E,KAAK,SAAUniC,GACTA,EAAIs4F,MAAM3vJ,OAAS,EACnBq3D,EAAIu4F,WAAa,MAClB,GAC/BH,EAAYl2D,KAAKpwE,IAAM,SAAUumI,GAC7B,IAAIpwJ,EAAQkB,KAAKm5F,QAAU,IAAI81D,EAE/B,OADAnwJ,EAAMswJ,WAAaF,EACZpwJ,GAkHX,IAAI6uB,EAAQ4hI,EAAOjtJ,UAEnBqrB,EAAMqiI,cAAgB,SAAUrpI,EAAM6pI,GAClC,IAAI1vB,EAAUziH,EAAGmuE,aAAa7lE,GAC9B,GAAIm6G,EAAS,CACT,IAAIhiI,EAAQkB,KAAK4vJ,gBAAgB9uB,GACjC,GAAIhiI,EACA,OAAOA,EAEN,QAAcuH,IAAVvH,EAAqB,CAC1B,IAAI2xJ,GAA4C,IAA1B3vB,EAAQn9G,QAAQ,KACtC,GAAI8sI,EACA,IAGI,GADAA,EAAmB9pI,IAAS27D,SAAS,UAAYw+C,EAArBx+C,GAGxB,OADAtiF,KAAK4vJ,gBAAgB9uB,GAAWA,EACzBA,EAGf,MAAO10B,MAInB,IAAI/qF,EAAQrhB,KAAK2vJ,MAAMhsI,QAAQgD,GAC3BtF,EAAQ,IACRA,EAAQrhB,KAAK2vJ,MAAMnwJ,OACnBQ,KAAK2vJ,MAAMjqJ,KAAKihB,IAEpB,IAAI2xB,EAAM,KAAOj3B,EAAQ,IAKzB,OAJImvI,IACAl4G,EAAM,IAAMA,EAAM,KAEtBt4C,KAAK4vJ,gBAAgB9uB,GAAWxoF,EACzBA,GAGX3qB,EAAM+iI,UAAY,SAAU75F,GACxB,IAAIx1C,EAAQrhB,KAAK0vJ,KAAK/rI,QAAQkzC,GAK9B,OAJIx1C,EAAQ,IACRA,EAAQrhB,KAAK0vJ,KAAKlwJ,OAClBQ,KAAK0vJ,KAAKhqJ,KAAKmxD,IAEZ,KAAOx1C,EAAQ,KAG1BsM,EAAMgjI,aAAe,SAAU3B,EAAWzwB,EAAcqyB,EAAU1B,GAC9D,IAAI2B,EAAc5B,EAAYl2D,KAAKpwE,IAAIumI,GACnCvC,EAAmBpuB,EAAaz/G,YAAYq/G,UAC3CwuB,IACDA,EAAmBroG,OAAOC,KAAKg6E,IAEnC,IAAK,IAAIh/H,EAAI,EAAGA,EAAIotJ,EAAiBntJ,OAAQD,IAAK,CAC9C,IAAI8jB,EAAWspI,EAAiBptJ,GAC5BqkB,EAAOgtI,EAASvtI,GACpB,GAAIk7G,EAAal7G,KAAcO,EAA/B,CAGA,IAAI29G,EAAavhI,KAAK8wJ,eAAeF,EAAUvtI,EAAUO,GACzDitI,EAAYjvC,OAAOv+F,EAAUk+G,IAEjCsvB,EAAYR,UAAUrB,GACtBC,EAAYl2D,KAAKvhC,IAAIq5F,IAGzBljI,EAAMojI,iBAAmB,SAAU/B,EAAWn4F,EAAKwsE,GAG/C,IAFA,IAAIh+G,EAAQg+G,EAAMhB,WACd5D,EAAQlB,EAAKkD,cAAc4C,GACtB78H,EAAI,EAAGA,EAAI6e,EAAM7lB,OAAQgH,IAAK,CACnC,IAAIk/C,EAAMrgC,EAAM7e,GACZ2kC,EAAM0rB,EAAInR,GACV64E,EAAeE,EAAM/4E,EAAMy9C,GAC/B,IAAIksD,EAAgB9wB,EAAcpzF,GAGlC,GAAmB,iBAARA,GAAoBA,aAAevrC,GAAG6hI,YAC7ClD,EAAeyB,EAAQb,WAAWZ,KACdA,EAAaz/G,cAAgBqsB,EAAIrsB,YAFzD,CAIQ,IAAIowI,EAAmBhB,EAAYoB,EAAgB5pG,GACnD1lD,KAAK2wJ,aAAa3B,EAAWzwB,EAAcpzF,EAAK+jH,QAIxDlvJ,KAAKgxJ,WAAWhC,EAAWn4F,EAAKnR,EAAKva,KAI7Cxd,EAAMsjI,iBAAmB,SAAUltJ,GAC/B,GAAqB,IAAjBA,EAAMvE,OACN,MAAO,KAGX,IAAI0xJ,EA9SY,OA8SgBlxJ,KAAK+vJ,gBAEjCf,GADc,IAAIJ,EAAYsC,EAAU,aAAentJ,EAAMvE,OAAS,MAI1EuE,EAAMksJ,OACFC,UAAW,GACXiB,OAAQnC,GAEZhvJ,KAAKyvJ,iBAAiB/pJ,KAAK3B,GAE3B,IAAK,IAAIxE,EAAI,EAAGA,EAAIwE,EAAMvE,SAAUD,EAAG,CAGnCwvJ,EAAgBC,EAFAkC,EAAW,IAAM3xJ,EAAI,KACpBS,KAAK8wJ,eAAe/sJ,EAAOxE,EAAGwE,EAAMxE,KAGzD,OAAOyvJ,GAGXrhI,EAAMmjI,eAAiB,SAAUj6F,EAAKnR,EAAK3hD,GACvC,GAAqB,iBAAVA,GAAsBA,EAAO,CACpC,IAAIksJ,EAAQlsJ,EAAMksJ,MAClB,GAAIA,EAAO,CAEP,IAAIC,EAAYD,EAAMC,UACtB,IAAKA,EAAW,CAEZA,EAAYD,EAAMC,UAAY,OAASlwJ,KAAK8vJ,iBAC5C9vJ,KAAK6vJ,gBAAgBnqJ,KAAKwqJ,GAE1B,IAAIkB,EAAOnB,EAAMkB,OA3UH,GA4UdlB,EAAMkB,OA5UQ,GA4UwBrC,EAAiBoB,EAAY,IAAKkB,GAO5E,OAAOlB,EAEN,OAAI78I,MAAM2P,QAAQjf,GACZ/D,KAAKixJ,iBAAiBltJ,GAGtB/D,KAAKqxJ,eAAettJ,GAG9B,MAAqB,mBAAVA,EACL/D,KAAKgwJ,cAAcjsJ,GAEJ,iBAAVA,EACLi9H,EAAYj9H,IAGP,cAAR2hD,GAAwBmR,aAAewS,IACvCtlE,GAASsxI,GAENtxI,IAIf4pB,EAAMqjI,WAAa,SAAUhC,EAAWn4F,EAAKnR,EAAK3hD,GAG9CgrJ,EAAgBC,EAFAd,EAAYoB,EAAgB5pG,GAAO,IAClC1lD,KAAK8wJ,eAAej6F,EAAKnR,EAAK3hD,KAKnD4pB,EAAMwiI,gBAAkB,SAAUnB,EAAWn4F,GACzC,IAAIwsE,EAAQxsE,EAAI/3C,YAChB,GAAIlf,GAAGE,MAAMmgI,WAAWoD,GACpBrjI,KAAK+wJ,iBAAiB/B,EAAWn4F,EAAKwsE,QAItC,IAAK,IAAI39E,KAAOmR,EACZ,GAAKA,EAAI0oE,eAAe75E,KACG,KAAtBA,EAAI6gB,WAAW,IAAmC,KAAtB7gB,EAAI6gB,WAAW,IACnC,aAAR7gB,GAFL,CAMA,IAAI3hD,EAAQ8yD,EAAInR,GACK,iBAAV3hD,GAAsBA,GAASA,IAAU8yD,EAAIo5F,OAGxDjwJ,KAAKgxJ,WAAWhC,EAAWn4F,EAAKnR,EAAK3hD,KAKjD4pB,EAAM0jI,eAAiB,SAAUx6F,GAC7B,GAAIA,aAAej3D,GAAG6hI,UAClB,OAAOzB,EAAQ0E,oBAAoB7tE,GAEvC,GAAIA,aAAej3D,GAAG2oB,MAElB,OAAOvoB,KAAK0wJ,UAAU75F,GAE1B,GAAIA,EAAI/B,UAAYkgF,EAEhB,OAAO,KAGX,IAAIsc,EACAvxJ,EAAO82D,EAAI/3C,YACf,GAAIlf,GAAGE,MAAMmgI,WAAWlgI,GAAO,CAC3B,GAAIC,KAAK2E,OACL,GAAI3E,KAAK2E,kBAAkB/E,GAAGw8E,WAC1B,GAAIvlB,aAAej3D,GAAGk3G,WAAajgD,aAAej3D,GAAGw8E,UACjD,OAAOp8E,KAAK0wJ,UAAU75F,QAGzB,GAAI72D,KAAK2E,kBAAkB/E,GAAGk3G,UAC/B,GAAIjgD,aAAej3D,GAAGk3G,WAClB,IAAKjgD,EAAI06F,UAAUvxJ,KAAK2E,QAEpB,OAAO3E,KAAK0wJ,UAAU75F,QAGzB,GAAIA,aAAej3D,GAAGw8E,YAClBvlB,EAAIpyB,KAAK8sH,UAAUvxJ,KAAK2E,QAEzB,OAAO3E,KAAK0wJ,UAAU75F,GAKtCy6F,EAAa,IAAI1C,EAAYV,EAAW,OAASluJ,KAAKgwJ,cAAcjwJ,GAAM,GAAQ,WAEjF,GAAIA,IAASukD,OACdgtG,EAAa,IAAI1C,EAAYV,EAAW,UAEvC,CAAA,GAAKnuJ,EAKN,OAAOC,KAAK0wJ,UAAU75F,GAJtBy6F,EAAa,IAAI1C,EAAYV,EAAW,uBAO5C,IAAIc,GAAasC,GAYjB,OATAz6F,EAAIo5F,OACAC,UAAW,GACXiB,OAAQnC,GAIZhvJ,KAAKyvJ,iBAAiB/pJ,KAAKmxD,GAE3B72D,KAAKmwJ,gBAAgBnB,EAAWn4F,IACxB,eACIm4F,EACJ,mBAUZ7vJ,EAAOE,SACH4pE,QAPJ,SAAkBxkC,GAGd,OADa,IAAI8qH,EAAO9qH,EADZA,aAAgB7kC,GAAGk3G,WAAcryE,GAE/BnwB,QAKd+6I,gBAAiBA,2GCterB,IAAIhmF,EAAW3pE,EAAQ,cACnB8xJ,EAAc9xJ,EAAQ,6BACtBs1I,EAAY3rE,EAAShY,MAAM2jF,UAC3BK,EAAiBhsE,EAAShY,MAAMgkF,eAChCoc,EAAa/xJ,EAAQ,WAAWgyJ,UAwBpC,SAASlkE,EAAamkE,EAAUC,GAC5B,IAAKA,EAAgB,CACjB,GAAwB,iBAAbD,GAAyBt+I,MAAM2P,QAAQ2uI,GAI9C,OAAO,KAEX,IAAKA,EAID,OAAO,KAEX,IAAK/xJ,GAAGmsB,QAAQ4lI,GAIZ,OAAO,KAEPvtE,EAKR,IAAI/jF,EACJ,GAAIsxJ,aAAoBtoF,EAAU,CAO9B,GAAIsoF,EAAS/vF,aAIT,OAHAhiE,GAAG06B,KAAK2vB,YAAa,EACrB5pD,EAAQsxJ,EAAS/vF,eACjBhiE,GAAG06B,KAAK2vB,YAAa,EACd5pD,EAEN,GAAIsxJ,aAAoB/xJ,GAAG2oB,MAK5B,OAAO,KAOf,OAHA3oB,GAAG06B,KAAK2vB,YAAa,EACrB5pD,EAAQwxJ,EAAcF,GACtB/xJ,GAAG06B,KAAK2vB,YAAa,EACd5pD,EAGX,IAAIyxJ,KAaJ,SAASD,EAAeh7F,EAAKlyD,GACzB,GAAI0O,MAAM2P,QAAQ6zC,GAId,OAAO,KAEX,GAAI46F,GAAcA,EAAW56F,GAIzB,OAAO,KAGX,IAAIx2D,EACJ,GAAIw2D,EAAIo5F,MAGJ5vJ,EAAQw2D,EAAIo5F,WAEX,GAAIp5F,EAAI/3C,YAAa,CAEtBze,EAAQ,IAAIgjI,EADAxsE,EAAI/3C,kBAIhBze,EAAQikD,OAAOxX,OAAO,MAG1BqjH,EAAgBt5F,EAAKx2D,EAAOsE,GAE5B,IAAK,IAAIpF,EAAI,EAAGwuB,EAAM+jI,EAAkBtyJ,OAAQD,EAAIwuB,IAAOxuB,EACvDuyJ,EAAkBvyJ,GAAG0wJ,MAAQ,KAIjC,OAFA6B,EAAkBtyJ,OAAS,EAEpBa,EA0BX,SAAS8vJ,EAAiBt5F,EAAKx2D,EAAOsE,GAGlCkyD,EAAIo5F,MAAQ5vJ,EACZyxJ,EAAkBpsJ,KAAKmxD,GACvB,IAAIwsE,EAAQxsE,EAAI/3C,YAChB,GAAIlf,GAAGE,MAAMmgI,WAAWoD,IA3B5B,SAA2BA,EAAOxsE,EAAKx2D,EAAOsE,GAE1C,IADA,IAAI0gB,EAAQg+G,EAAMhB,WACT77H,EAAI,EAAGA,EAAI6e,EAAM7lB,OAAQgH,IAAK,CACnC,IAAIk/C,EAAMrgC,EAAM7e,GACZzC,EAAQ8yD,EAAInR,GAChB,GAAqB,iBAAV3hD,GAAsBA,EAAO,CACpC,IAAIguJ,EAAY1xJ,EAAMqlD,GAClBqsG,aAAqBP,GACrBO,EAAUjzI,cAAgB/a,EAAM+a,YAChCizI,EAAUjmI,IAAI/nB,GAGd1D,EAAMqlD,GAAO3hD,EAAMksJ,OAASoB,EAAettJ,EAAOY,QAItDtE,EAAMqlD,GAAO3hD,IAYjBgtJ,CAAiB1tB,EAAOxsE,EAAKx2D,EAAOsE,QAIpC,IAAK,IAAI+gD,KAAOmR,EACZ,GAAKA,EAAI0oE,eAAe75E,KACG,KAAtBA,EAAI6gB,WAAW,IAAmC,KAAtB7gB,EAAI6gB,WAAW,IACnC,aAAR7gB,GAFL,CAMA,IAAI3hD,EAAQ8yD,EAAInR,GAChB,GAAqB,iBAAV3hD,GAAsBA,EAAO,CACpC,GAAIA,IAAU1D,EACV,SAEJA,EAAMqlD,GAAO3hD,EAAMksJ,OAASoB,EAAettJ,EAAOY,QAGlDtE,EAAMqlD,GAAO3hD,EAIrB8yD,aAAewS,IACfhpE,EAAMy0D,WAAaugF,GAQ3B,SAASgc,EAAgBx6F,EAAKlyD,GAC1B,GAAIkyD,aAAe26F,EACf,OAAO36F,EAAIx2D,QAEf,GAAIw2D,aAAej3D,GAAG2oB,MAElB,OAAOsuC,EAEX,IAAIx2D,EACJ,GAAIgT,MAAM2P,QAAQ6zC,GAAM,CACpB,IAAI9oC,EAAM8oC,EAAIr3D,OACda,EAAQ,IAAIgT,MAAM0a,GAClB8oC,EAAIo5F,MAAQ5vJ,EACZ,IAAK,IAAId,EAAI,EAAGA,EAAIwuB,IAAOxuB,EAAG,CAC1B,IAAIwE,EAAQ8yD,EAAIt3D,GAEZc,EAAMd,GADW,iBAAVwE,GAAsBA,EAClBA,EAAMksJ,OAASoB,EAAettJ,EAAOY,GAGrCZ,EAInB,OADA+tJ,EAAkBpsJ,KAAKmxD,GAChBx2D,EAEN,GAAIw2D,EAAI/B,UAAYkgF,EAErB,OAAO,KAGX,IAAIj1I,EAAO82D,EAAI/3C,YACf,GAAIlf,GAAGE,MAAMmgI,WAAWlgI,GAAO,CAC3B,GAAI4E,EACA,GAAIA,aAAkB/E,GAAGw8E,WACrB,GAAIvlB,aAAej3D,GAAGk3G,WAAajgD,aAAej3D,GAAGw8E,UACjD,OAAOvlB,OAGV,GAAIlyD,aAAkB/E,GAAGk3G,UAC1B,GAAIjgD,aAAej3D,GAAGk3G,WAClB,IAAKjgD,EAAI06F,UAAU5sJ,GAEf,OAAOkyD,OAGV,GAAIA,aAAej3D,GAAGw8E,YAClBvlB,EAAIpyB,KAAK8sH,UAAU5sJ,GAEpB,OAAOkyD,EAKvBx2D,EAAQ,IAAIN,OAEX,GAAIA,IAASukD,OACdjkD,SAEC,CAAA,GAAKN,EAKN,OAAO82D,EAJPx2D,EAAQikD,OAAOxX,OAAO,MAO1B,OADAqjH,EAAgBt5F,EAAKx2D,EAAOsE,GACrBtE,EAGXmtF,EAAYC,OAASokE,EACrBjyJ,GAAG4tF,YAAcA,EACjBruF,EAAOE,QAAUmuF,0FCzQjB,IAAMwkE,EAAmB,IAAKtyJ,EAAQ,kBAAb,CAAgC,WAGzD,SAASuyJ,EAAwBp7F,EAAK53D,GAClC,KAAO43D,GAAK,CACR,IAAIqrE,EAAK59E,OAAO26E,yBAAyBpoE,EAAK53D,GAC9C,GAAIijI,EACA,OAAOA,EAEXrrE,EAAMvS,OAAO4tG,eAAer7F,GAEhC,OAAO,KAGX,SAASs7F,EAAUlzJ,EAAMkyJ,EAAQjxJ,GAC7B,IAAIgiI,EAAK+vB,EAAuBd,EAAQlyJ,GACxCqlD,OAAOglB,eAAeppE,EAAQjB,EAAMijI,GASxC,IAAI7jH,GAUA0L,SAAU,SAAS8sC,GACf,MAAsB,iBAARA,GAAoBA,aAAejxC,QAWrDwsI,SAAU,SAASv7F,GACf,MAAsB,iBAARA,GAAoBA,aAAe+a,QAUrD5oB,MAAO,SAAU6N,GACb,aACAA,EAAMA,MACN,IAAK,IAAIt3D,EAAI,EAAGC,EAAS0S,UAAU1S,OAAQD,EAAIC,EAAQD,IAAK,CACxD,IAAI4xJ,EAASj/I,UAAU3S,GACvB,GAAI4xJ,EAAQ,CACR,GAAsB,iBAAXA,EAAqB,CAC5BvxJ,GAAGyC,QAAQ,KAAM8uJ,GACjB,SAEJ,IAAM,IAAIlyJ,KAAQkyJ,EACPlyJ,KAAQ43D,GACXs7F,EAAWlzJ,EAAMkyJ,EAAQt6F,IAKzC,OAAOA,GAUXm9C,MAAO,SAAUn9C,GACb,aACAA,EAAMA,MACN,IAAK,IAAIt3D,EAAI,EAAGC,EAAS0S,UAAU1S,OAAQD,EAAIC,EAAQD,IAAK,CACxD,IAAI4xJ,EAASj/I,UAAU3S,GACvB,GAAI4xJ,EAAQ,CACR,GAAsB,iBAAXA,EAAqB,CAC5BvxJ,GAAGyC,QAAQ,KAAM8uJ,GACjB,SAEJ,IAAM,IAAIlyJ,KAAQkyJ,EACdgB,EAAWlzJ,EAAMkyJ,EAAQt6F,IAIrC,OAAOA,GAYXr0C,OAAQ,SAAUqrE,EAAKrnB,GAcnB,IAAK,IAAIhgE,KAAKggE,EAAUA,EAAK+4D,eAAe/4H,KAAIqnF,EAAIrnF,GAAKggE,EAAKhgE,IAQ9D,OAPAqnF,EAAIvrF,UAAYgiD,OAAOxX,OAAO05B,EAAKlkE,WAC/Bwc,aACI/a,MAAO8pF,EACPtkB,UAAU,EACV8oF,cAAc,KAGfxkE,GASX01C,SAtHK,SAsHKxjI,GACN,IAAI4tB,EAAQ5tB,EAAKuC,UACbgwJ,EAAc3kI,GAAS22B,OAAO4tG,eAAevkI,GACjD,OAAO2kI,GAAeA,EAAYxzI,aAWtC0qD,eApIK,SAoIWkgF,EAAU6I,GACtB,GAAI7I,GAAY6I,EAAY,CACxB,GAAwB,mBAAb7I,EACP,OAAO,EAEX,GAA0B,mBAAf6I,EAIP,OAAO,EAEX,GAAI7I,IAAa6I,EACb,OAAO,EAEX,OAAS,CAEL,KADA7I,EAAWrrI,EAAGklH,SAASmmB,IAEnB,OAAO,EAEX,GAAIA,IAAa6I,EACb,OAAO,GAInB,OAAO,GAQX3uG,MAAO,SAAUiT,GAEb,IADA,IAAItS,EAAOD,OAAOC,KAAKsS,GACdt3D,EAAI,EAAGA,EAAIglD,EAAK/kD,OAAQD,WACtBs3D,EAAItS,EAAKhlD,KAWxBigI,sBAAuByyB,GAIvBO,GACAzuJ,WAAOsC,EACPosJ,YAAY,EACZlpF,UAAU,EACV8oF,cAAc,GAalBh0I,EAAGta,MAAQ,SAAU8yD,EAAKjzC,EAAM7f,EAAOwlE,EAAUkpF,GAC7CD,EAAazuJ,MAAQA,EACrByuJ,EAAajpF,SAAWA,EACxBipF,EAAaC,WAAaA,EAC1BnuG,OAAOglB,eAAezS,EAAKjzC,EAAM4uI,GACjCA,EAAazuJ,WAAQsC,GAGzB,IAAIqsJ,GACA/pI,IAAK,KACLmD,IAAK,KACL2mI,YAAY,GAahBp0I,EAAGgR,OAAS,SAAUwnC,EAAKjzC,EAAMm7G,EAAQC,EAAQyzB,EAAYJ,GACnC,mBAAXrzB,IACPyzB,EAAazzB,EACbA,OAAS34H,GAEbqsJ,EAAc/pI,IAAMo2G,EACpB2zB,EAAc5mI,IAAMkzG,EACpB0zB,EAAcD,WAAaA,EAC3BC,EAAcL,aAAeA,EAC7B/tG,OAAOglB,eAAezS,EAAKjzC,EAAM8uI,GACjCA,EAAc/pI,IAAM,KACpB+pI,EAAc5mI,IAAM,MAGxB,IAAI6mI,GACAhqI,IAAK,KACL8pI,YAAY,EACZJ,cAAc,GAYlBh0I,EAAGsK,IAAM,SAAUkuC,EAAKjzC,EAAMm7G,EAAQ0zB,EAAYJ,GAC9CM,EAAWhqI,IAAMo2G,EACjB4zB,EAAWF,WAAaA,EACxBE,EAAWN,aAAeA,EAC1B/tG,OAAOglB,eAAezS,EAAKjzC,EAAM+uI,GACjCA,EAAWhqI,IAAM,MAGrB,IAAIiqI,GACA9mI,IAAK,KACL2mI,YAAY,EACZJ,cAAc,GAYlBh0I,EAAGyN,IAAM,SAAU+qC,EAAKjzC,EAAMo7G,EAAQyzB,EAAYJ,GAC9CO,EAAW9mI,IAAMkzG,EACjB4zB,EAAWH,WAAaA,EACxBG,EAAWP,aAAeA,EAC1B/tG,OAAOglB,eAAezS,EAAKjzC,EAAMgvI,GACjCA,EAAW9mI,IAAM,MAUrBzN,EAAGmuE,aAAe,SAAUqmE,GACxB,GAAyB,mBAAdA,EAA0B,CACjC,IAAIvwJ,EAAYuwJ,EAAUvwJ,UAC1B,GAAIA,GAAaA,EAAUi9H,eAAe,kBAAoBj9H,EAAUwwJ,cACpE,OAAOxwJ,EAAUwwJ,cAErB,IAAIC,EAAS,GAKb,GAHIF,EAAU5zJ,OACV8zJ,EAASF,EAAU5zJ,MAEnB4zJ,EAAUhsF,SAAU,CACpB,IAAI5nD,EAAKghI,EAAM4S,EAAUhsF,YAGrB5nD,EAFkB,MAAlBghI,EAAIvhD,OAAO,GAELuhD,EAAIhuB,MAAM,mBAIVguB,EAAIhuB,MAAM,sBAEM,IAAfhzG,EAAIzf,SACXuzJ,EAAS9zI,EAAI,IAGrB,MAAkB,WAAX8zI,EAAsBA,EAAS,GAErC,OAAIF,GAAaA,EAAU/zI,YACrBT,EAAGmuE,aAAaqmE,EAAU/zI,aAE9B,IAQX,WACI,IAAIk0I,KACAC,KAEJ,SAASC,EAAOxtG,EAAKytG,EAAYC,GAU7B,OATA/0I,EAAGgR,OAAOhR,EAAI80I,EACV,WACI,OAAO7uG,OAAO+uG,UAAWD,IAE7B,SAAUrvJ,GACNsa,EAAGulC,MAAMwvG,GACT9uG,OAAO+uG,OAAOD,EAAOrvJ,KAGtB,SAAUs0B,EAAIvZ,GAOjB,GALIA,EAAYxc,UAAUi9H,eAAe75E,WAC9B0tG,EAAMt0I,EAAYxc,UAAUojD,IAEvCrnC,EAAGta,MAAM+a,EAAYxc,UAAWojD,EAAKrtB,GAEjCA,EAAI,CACJ,IAAI06E,EAAaqgD,EAAM/6H,GACvB,GAAI06E,GAAcA,IAAej0F,EAAa,CAC1C,IAAI6b,EAAQ,wCAA0C+qB,EAAM,OAASrtB,EAAK,KACtE69C,EAQJt2E,GAAA+6B,MAAAA,QAEJy4H,EAAA/6H,GAAAvZ,IA8BZT,EAAAokH,YAAAywB,EAAA,UAAA,sBAAAF,GAgBA,IAAAM,EAAAJ,EAAA,gBAAA,wBAAAD,GAQI50I,EAAAuiH,aAAA,SAAAhyE,EAAA9vC,GAGI,GAFJw0I,EAAK1kG,EAAA9vC,IAEDA,EAAQxc,UAAAi9H,eAAA,WAAA,CACJ,IAAAlnG,EAAGu2B,GAAHojG,EAAA9sF,WACH7sC,GACJha,EAAAokH,YAAApqG,EAAAvZ,KAcGT,EAAAk1I,gBAAQ,WACR,IAAA,IAAIh0J,EAAA,EAAAA,EAAY2S,UAAhB1S,OAAAD,IAAA,CACA,IAAIiH,EAAA0L,UAAS3S,GAAA+C,UACTkxJ,EAAOhtJ,EAAAitJ,QACVD,UACGR,EAAcQ,GAEd,IAAAE,EAAOltJ,EAAAssJ,cACVY,UACJT,EAAAS,KAYJr1I,EAFDowE,cAAA,SAAA+kE,gBAYCn1I,EAFDqwE,eAAA,SAAAglE,4CAkBQ,GAHJC,OAAA,IAAAA,GAAAA,EAGS,mBAAA98F,GAAgBA,EAAUv0D,UAA3Bi9H,eAAyC,WAK7C,OAJI1oE,EAAAv0D,UAAAmxJ,QAMJ,GAAA58F,GAAIA,EAAA/3C,YAAa,CACb,IAAAxc,EAAUu0D,EAAA/3C,YAAVxc,UACA,GAAAA,GAAKA,EAAgBi9H,eAAU,WAKtC,OAJW1oE,EAAA48F,QAtKpB,MAAA,IAAA,GAyLIp1I,EAAA+Q,SAAI,SAAUynC,EAAA+8F,EAAqBC,EAArBtqF,GACd,IAAIuqF,EAAU,WACdC,EAAAD,EAAgBpW,KAAAkW,GAAA,GACZI,EAAAF,EAAYpW,KAAAmW,GAAA,GACR,SAAAlrI,IAIJ,OAAA3oB,KAAUg0J,GAIFzqF,EACIlrD,EAAAgR,OAAAwnC,EAAGk9F,EAAaprI,EAAA,SAAW5kB,GAMtC/D,KAAAg0J,GAAAjwJ,IArBTsa,EAAAsK,IAAAkuC,EAAAk9F,EAAAprI,IAoCQtK,EAAA41I,UAAI,SAAUp9F,EAAMq9F,EAApB7uI,EAAAkkD,GACA,IAAA,IAAGqqF,KAAcvuI,EAAA,CACpB,IAAAu/D,EAAAv/D,EAAAuuI,GAJLv1I,EAAA+Q,SAAAynC,EAAAq9F,EAAA,IAAAN,EAAAhvE,EAAArb,uBAUA4qF,EAAA,KAqFC,SAAAhzE,EAAA7+D,EAAAjB,iBA2BG,SAAI0nC,EAAAzmC,EAAYve,GACZ,IAAAsd,EAAAiB,EAAAqB,QAAA5f,GACA,OAAAsd,GAAO,IAFX8/D,EAIK7+D,EAAAjB,IACM,GAzGXhD,EAAAohC,UAAI,WACA,IAAA20G,EAAAliJ,UAAA1S,OACH,GAAA,IAAA40J,EACG,MAAM,GAEN,IAAAt3G,EAAA5qC,UAAA,GACH,GAAA,IAAAkiJ,aAKO,GAD6B,iBAAbt3G,GAAau3G,EAAAzzE,KAAA9jC,GAE7B,IAAA,IAAIv9C,EAAA,EAAAA,EAAA60J,IAAsB70J,EAAP,CACnB,IAAI+0J,EAAApiJ,UAAa3S,GAIpBg1J,EAAA,iBAAAD,EAAAD,EAAAF,EAEAI,EAAA3zE,KAAA9jC,GAAAA,EAAAA,EAAA2pD,QAAA8tD,EAAAD,GAAAx3G,GAAA,IAAAw3G,OAGA,IAAA,IAAAvvI,EAAA,EAAAA,EAAAqvI,IAAArvI,EACJ+3B,GAAA,IAAA5qC,UAAA6S,aAOD1G,EAAA2+B,eAAe,WAGd,IAFD,IAAAjvB,EAAQ7b,UAAW1S,OAAnB,EACIotB,EAAA,IAAUvZ,MAAA0a,GACbxuB,EAAA,EAAAA,EAAAwuB,IAAAxuB,EACDqtB,EAAOrtB,GAAP2S,UAAA3S,EAAA,aAeA8e,EAAAG,UAAI,SAAeg2I,GACf,IAAA9/H,EAAM4vB,OAAAxX,OAAA,MACN,GAAA0nH,EAAM,CAGN9/H,EAFA,MAEW,EACXA,EAFA,MAEW,SACdA,EAJG,YAKJA,EAJI,eA+HR,IAAA/Q,EAAAtQ,MAAA/Q,UAAAqhB,QA0GQ,SAAAq1E,EAAAy7D,EAAAxlH,QACA5oC,IAAA4oC,IACHA,EAAAwlH,EACDA,EAAA,MAEAz0J,KAAK2oB,IAAL,KACA3oB,KAAK2lC,MAAL,EACH3lC,KAAAqvH,MAAA,IAAAh8G,MAAA47B,mBAvFG5wB,EAAAiE,OACAymC,OAAAA,EACA0R,WA1FA,SAAgBn4C,EAAAve,GACZ,IAAAsd,EAAMiB,EAANqB,QAAqB5f,GACrBsd,GAAQ,IACXiB,EAAAjB,GAAAiB,EAAAA,EAAA9iB,OAAA,KACJ8iB,EAAA9iB,SAuFG2hF,SAAAA,EACAz5D,aA9HA,SAAiBpF,EAAAjB,GACb,IAAA7hB,EAAA8iB,EAAA9iB,OACH6hB,EAAA,GAAAA,GAAA7hB,IAGJ8iB,EAAAjB,GAAAiB,EAAA9iB,EAAA,kBA0HGqlF,SAtBH,SAAAviE,EAAAve,2BAuBG2wJ,WA/EI,SAASpyI,EAAOoG,GACZ,GAAApG,GAAIA,EAAE9iB,OAAA,EACF,IAAA,IAAAD,EAAG,EAAHA,EAAS+iB,EAAT9iB,OAAAD,IACA,KAAA+iB,EAAO/iB,aAAPmpB,GAEP,OADI9oB,GAAAgB,MAAA,OACJ,YA2EL+zJ,YA9DI,SAAAryI,EAAcsyI,GACjB,IAAA,IAAAr1J,EAAA,EAAAgiB,EAAAqzI,EAAAp1J,OAAAD,EAAAgiB,EAAAhiB,IACJwpD,EAAAzmC,EAAAsyI,EAAAr1J,KA6DGs1J,gBAjDA,SAAAvyI,EAAAwyI,EAAAzzI,UACHiB,EAAAnC,OAAAmM,MAAAhK,GAAAjB,EAAA,GAAA++G,OAAA00B,OAiDG5gH,KAjBA,SAAa5xB,GAAb,IAA2B/iB,EAC3BwuB,EAAAzL,EAAgB9iB,OACZu1J,EAAA,IAAe1hJ,MAAA0a,GADnB,IAEAxuB,EAAO,EAAAA,EAAAwuB,EAAPxuB,GAAA,EACHw1J,EAAAx1J,GAAA+iB,EAAA/iB,aAEDokB,QAAAA,iEAyHQq1E,EAAA12F,UAAO62F,KAAP,WACA,GAAAn5F,KAAI2lC,MAAQ,EAAA,GACZ3lC,KAAK2lC,MACL,IAAA7mC,EAAAkB,KAAAqvH,MAAArvH,KAAA2lC,OAEJ,OADC3lC,KAAAqvH,MAAArvH,KAAA2lC,OAAA,KACD7mC,eAUAk6F,EAAA12F,UAASk1D,IAAQ,SAAKX,GAClB,IAAAkiC,EAAI/4F,KAAKqvH,MACL,GAAArvH,KAAA2lC,MAAAozD,EAAAv5F,OAAA,CACH,GAAAQ,KAAAg1J,WAAA,IAAAh1J,KAAAg1J,SAAAn+F,GACD,OAEHkiC,EAAA/4F,KAAA2lC,OAAAkxB,IARL72D,KAAA2lC,QAkBQqzD,EAAA12F,UAAKgrG,OAAM,SAAX9tG,GACAA,GAAS,IACLQ,KAAAqvH,MAAK7vH,OAAQA,EAChBQ,KAAA2lC,MAAAnmC,IACJQ,KAAA2lC,MAAAnmC,KAKL6e,EAAA26E,KAAAA,EAIAp5F,GAAAye,GAAOA,EAEPlf,EAAAE,QAAAgf,wFCl8BA,IAAAA,EAAA3e,EAAA,QAIQu1J,GADCv5H,KAGLw5H,cAJoB,GAMpBzsI,WACA+sC,gBAPJqT,uCAoBQ,SAAAssF,EAAYhqH,EAAA9nB,EAAAikE,EAAA9+D,GACR,IAAA2iB,EAAAxiB,MAAGwiB,EAAOrf,IAMd,GAAAqf,EAAAo0F,eAAA,WAAA,CAGA,IAAI61B,EAAM,MAAA/xI,EAET8nB,EAFDxiB,IAAA,WAGI,OAAM3oB,KAAAo1J,IAENjqH,EAAArf,IAAK,SAAU/nB,GACf,IAAA+jF,EAAY9nF,KAAMo1J,GAHtBp1J,KAAAo1J,GAAArxJ,kBAQA,IAAAsxJ,KAGI,IAAA,IAAIz2B,KAFRp2G,EAAS4sI,GAAQC,EAELJ,EAAsB,CAC1B,IAAAzmI,EAAAymI,EAAqBr2B,GACrBzzF,EAAIo0F,eAAJX,KACIy2B,EAAAz2B,GAAWzzF,EAAXyzF,GACHpwG,EAAA0mI,qBACJ/pH,EAAAyzF,UAKRx6C,EAKG,SAAAkxE,EAAQnqH,EAAJyjB,EAAgBvrC,EAAAqY,GAChBroB,MAAA2P,QAAU0Y,IADdA,EAGKl8B,OAAI,IACLk8B,EAAAA,EAAU,aAoEd,SAAA65H,EAAIpqH,EAAAziB,EAAakmC,EAAjBvrC,GACI,GAAAhQ,MAAA2P,QAAI0F,GAAU,CAOV,KAAAA,EAAAlpB,OAAU,GAWrB,OAAAI,GAAAyC,QAAA,KAAAusD,EAAAvrC,GAVW,GAAAzjB,GAAAymE,SAAWmvF,eAAX9sI,EAAA,IAIA,OAHAyiB,EAAAzP,IAAAhT,EAAA,eAECyiB,EAAAziB,KAIJyiB,EAAAziB,KAAAA,EAAAA,EAAA,IA2CTrpB,EAAKunI,sBAAa,SAAA/xD,EAAA4gF,EAAAC,GAEV,KADM7gF,GAAQA,EAAY/1D,cAAiBwlC,QACvC,CACJ,GAAAjxC,MAAI2P,QAAU6xD,IAAYA,EAAAr1E,OAAgB,EAA5B,CACV,IAAAkpB,EAAAmsD,EAAA,GAsBA,OACApsD,WAHJC,KAAAmsD,EAMCwvD,QAAI,GAEL,GAAiB,mBAATxvD,EAAR,CACInsD,EAAOmsD,EACH,OAAAj1E,GAAAymE,SAAAmvF,eAAA9sI,IACA9oB,GAAAymE,SAAY0wD,gBAAAruG,IA2BhBD,QAAQ,GAHZiT,IAAAhT,EAMC27G,QAAA,IAVW57G,QAAQpK,EAAAmrD,eAAA9gD,EAAA9oB,GAAA6hI,WAAA,IAAA/4G,EAAA,KAHZA,KAAAA,EAKH27G,QAAA,GAWD,OAFJ57G,QAAAosD,EAIHwvD,QAAA,gBAODhlI,EAAA+iI,gBAAU,SAAW55G,EAArBomC,EAAAi/B,EAAAywC,GACA,IAAA,IAAIj7G,KAAWmF,EAAQ,CACvB,IAAI2iB,EAAA3iB,EAAUnF,GACVsyI,EAAMt2J,EAAWunI,sBAAjBz7F,EAAA9nB,EAAAurC,GAII,GAHP+mG,IACGxqH,EAAK3iB,EAAAnF,GAAAsyI,GAEDxqH,EAAA,CAeQ,IAWRm8C,EAAIn8C,EAAAm8C,OACAA,GAKP6tE,EAAAhqH,EAAA9nB,EAAAikE,EAAA9+D,GAIA,SAAA2iB,mBAIA,QAAAA,kBAIA,SAAAA,GACJA,EAAAziB,QAwBDrpB,EAAAyjI,wBAAA,SAAAn8G,EAAAwF,EAAAyiC,EAAAi/B,EAAArnB,GAKI,MAAK,mBAAL7/C,GAAmC,OAA9BA,uDC9VjB,IAAGivI,KAEKh2J,GAAA0iI,KACI58H,KAAA,SAAAvG,EAAAwlD,EAAA69E,QACAn8H,IAAAm8H,IACHA,EAAA79E,EACDA,EAAA,IAEIixG,EAAQlwJ,MACRi/C,KAAAA,EACA69E,OAAAA,EACArjI,OAAKA,EALTE,QAAAF,EAAAE,QANCw2J,IAAA,QAgBDntJ,IAAA,WACA,IAAIotJ,EAASF,EAAbltJ,MAEIvJ,EAAA22J,EAAY32J,OACZE,EAASF,EAATE,QACI,GAAAA,IAAAy2J,EAAAz2J,QAAA,CACA,IAAA,IAAA02J,KAAA12J,EAEJ,OAxBHF,EAAAE,QAAAA,EAAAy2J,EAAAjoE,MA8BJ00C,KAAA,WA9BL,OAAAqzB,EAAAA,EAAAp2J,OAAA,+BCIII,GAAA87B,KAQAs6H,WAAW,GAEHxgI,UAAA,SAAQkG,UACJA,IACA,KAAAA,EAAA6qC,WAAM,IAAN,KAAA7qC,EAAA6qC,WAAA,GAGA7qC,EAAAA,EAAAlzB,MAAA,GACA,KAAMkzB,EAAI6qC,WAAV,KAEP7qC,EAAAA,EAAAlzB,MAAA,QAcGs3G,IAAA,SAAGpkF,GAQN,IAFDA,EAAM17B,KAAIw1B,UAAWkG,IAGhBoqB,WAAA,cAED,CAEI,IAAAnB,EAAO/kD,GAAG47B,OAAAgnF,YAAa9mF,EAAAlzB,MAAe,IAAM5I,GAAA2oB,OAAQ,GACvD,GAAAo8B,EACJ,OAAA/kD,GAAA+mD,aAAA8f,eAAA9hB,GAAA,GAAA/kD,GAAA49B,KAAAmlF,QAAAjnF,QALG97B,GAAAyC,QAAA,KAAAq5B,6BAYPqjD,MAAA,SAAAqlC,GAxDLpkH,KAAAg2J,WAAAp2J,GAAA49B,KAAAm/F,SAAAvY,GAAA,iDCAQjlH,EAAAE,SACIwlF,SAAA,SAAOoxE,EAAQC,GAClB,GAAuB,mBAAfD,EAAOpxE,SACZ,OAAOoxE,EAAGpxE,SAAQqxE,GAChB,GAAA,mBAAAD,EAAAE,wBACF,SAAA,GAAIF,EAAOE,wBAAXD,IAEI,IAAAzxH,EAAGyxH,EAAA52G,WACC,GAAA7a,EACI,EAAA,CACH,GAFDA,IAEOwxH,EACH,OAAO,EAJfxxH,EAMSA,EAAQ6a,iBAErB,OAAA7a,GAjBK,OAAA,GAwBLitH,UAAA,iBAAA9uG,SAAA,mBAAAr/B,KAAA,SAAAszC,GAIA,OAAOA,aACOtzC,MA7BT,SAAAszC,4FAsCD8oD,eAUI,SAAAxxF,EAAWlnB,EAAAC,GACPinB,GACH2O,WAFD,WAGH3O,EAAAlnB,EAAAC,IACJ,+BCnDbxH,EAAQ,iBACRA,EAAQ,iBACRA,EAAQ,WACRA,EAAQ,6BACRA,EAAQ,+BACRA,EAAQ,WACRA,EAAQ,oBACRA,EAAQ,sBACRA,EAAQ,qCAERA,EAAM,cAGFA,EAAQ,qBACRA,EAAQ,uBACXA,EAAA,uYCjBOA,EAAA,qBAAR,0BAEAA,EAAI,eAEA,IAAA02J,EAAA,SAAA3uH,EAAA4uH,GACAr2J,KAAA2rE,QAAAlkC,EAIAznC,KAAKw8E,QAAA65E,EAELr2J,KAAKs2J,cAAgB,4BAErBt2J,KAAAu2J,cAAA,6BAMAz3I,YAH8Bs3I,EAM1Bv+G,MAAA,aACA2+G,YAAI,SAAW/wI,EAAfosE,GACA,IAAIoyD,EAAAjkJ,KAAA2rE,QAAJ/b,KACI6mG,EAAMz2J,KAAVw8E,QACAynE,EAAAyS,aAAeD,EAAK1tJ,EAApB0tJ,EAAAvqJ,EAAAuqJ,EAAAtqJ,EAAAsqJ,EAAArqJ,EAAAqqJ,EAAAxrD,GAAAwrD,EAAAvrD,IAV0B+4C,EAAAv5G,MAAA,GAAA,GAa9BmnD,EAb8B8kE,KAavB1S,EAAOx+H,IAEVo6D,MAAA,SAAa77B,GACb,IAAIigG,EAAAjkJ,KAAW2rE,QAAO/b,KAClBr1B,EAAAv6B,KAAA2rE,QAAeirF,QACfp6I,EAAA5c,GAAJsnD,OAAAC,KAAAxI,gBACIk4G,EAAA,QAAJr6I,EAAAtC,EAAA,KAAAsC,EAAAG,EAAA,KAAAH,EAAAtQ,EAAA,KAAAsQ,EAAAzT,EAAA,IAAA,IACAk7I,EAAI6S,UAAJD,EACA5S,EAAIyS,aAAJ,EAAmB,EAAA,EAAO,EAAA,EAA1B,GACAzS,EAAA8S,UAAa,EAAA,EAAOx8H,EAAA52B,MAApB42B,EAAA32B,yCAEA5D,KAAA2rE,QAAWqrF,OAAOC,UAAlB,EAxBRp9G,EAAA9qC,OAAAi1C,yGCfA,IAAAkzG,EAAgB,0BAGZp4I,YAHwBo4I,EAA5B39B,OAAA,wECDIp6H,EAAAE,SACA63J,gBAAYx3J,EAAQ,sBAHxB02J,sBAAA12J,EAAA,wJCEA,IAAI2e,EAAA3e,EAAS,wBAEToqF,EAAOpqF,EAAQ,gCACf4vF,EAAA5vF,EAAW,iEAEX4zF,EAAA5zF,EAAiB,8BAEjBy3J,EAAAz3J,EAAmB,YACnB03J,EAAe13J,EAAQ,6BAEvB23J,EAAJ33J,EAAA,eAGA43J,KAEI,SAAIC,EAAJn7E,EAAAzkC,EAAA6/G,GACA,IAAIv4J,EAAAof,EAAAmuE,aAAapQ,GACb1nD,EAAAz1B,GAAQ04C,EACX6/G,IACDF,EAAUr4J,GAAAu4J,GAEbp7E,EAAAhvC,WAAAuK,qBAID4/G,EAAUztE,EAAAqtE,GACNI,EAAAjoE,EAAA8nE,GACHziG,GACD4iG,EAAc5iG,EAAA0iG,EAAAI,cAAAJ,EAAAK,cAEbpkE,UAIGn0F,EAAAE,SACAq1B,IAAAA,EAHJ4iI,QAAAA,0QChCA,IAAMK,EAAQj4J,EAAQ,8DAEfA,EAAa,YAEZP,EAAAE,QAAOgf,EAAK2qC,OACf+oC,WAHqB,SAAAtsE,GAKtB,OALsBA,EAAA8yE,wDAQlB,IAAAw2B,EAAWn8B,EAAXglE,WAEAhlE,EAAWglE,YAAW,EACtB,IACIjnJ,EAAOiiF,EAAQ9hF,iBAEfo+B,EAAYtrC,gBAGZi0J,EAAJj1J,EAAAgB,OAAU2d,OAAA,EAAGrV,OAAA,EACTgO,OAAC,EACD9S,OAAI,EACJ4mE,GAWAzsD,EAAI3e,EAAKtD,EACT4a,EAAItX,EAAKtD,EAAIu4J,QAEbzwJ,EAAAxE,EAAKc,EAAAo0J,EAELnnJ,EAAKo+G,GAAAh5F,EAAcxU,EACnB5Q,EAAKo+G,GAAAvgG,EAAcpnB,EACtBuJ,EAAAo+G,EAAA,GAAAh5F,EAAAxU,eAjBGA,EAAI3e,EAAKtD,EACT4a,EAAItX,EAAKtD,EAAIw4J,QAEb1wJ,EAAAxE,EAAKc,EAAAm0J,EAELlnJ,EAAKo+G,GAAAh5F,EAAcxU,EACnB5Q,EAAKo+G,GAAAvgG,EAActiB,EATvByE,EAUOo+G,EAAA,GAAAh5F,EAAA7b,EACHvJ,EAAIo+G,EAAJ,GAAAvgG,EAAApnB,GAaJuJ,EAAKo+G,GAAAzvH,EAAcA,EACnBqR,EAAKo+G,GAAArrH,EAAcA,EAAIm0J,EAAvBntH,EA3CkB/5B,EAAAo+G,EAAA,GAAAzvH,EAAAA,EAAAw4J,EAAAptH,EAAA/5B,EAAAo+G,EA8CX,GA9CWrrH,EA8CLA,GAEbizJ,KAAA,SAAA1S,EAAAx+H,GACA,IAAIgf,EAAAhf,EAASgf,KACOgL,EAAIhL,EAAxBsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IACtBk7D,EAAAx7D,EAAJa,IACI46D,EAAJz7D,EAAAc,6BAEA0zG,EAAAv5G,MAAA,GAAA,GAKAu5G,EAAI8T,YAAWtzH,EAAflpB,QAAA,IAOI,qBAJA5K,EAAA8U,EAAYorE,YAAA//E,MAEhB6/B,EAASw9E,EAAO94C,oBAER91E,EAAI,EAAAgiB,EAAQ5Q,EAAhBnR,OAAAD,EAAAgiB,EAAAhiB,GAAA,EAAA,CACA,IAAID,EAAIqR,EAAKpR,GAAAD,EACToE,EAAIiN,EAAKpR,GAAAmE,EACT4vC,EAAA3iC,EAAJpR,EAAA,GAAAD,EAAAA,eAEAoE,GAAIA,EAAK6vC,EAET,IAAIh8B,EAAK5G,EAAKpR,GAAAw2B,EACVve,EAAK7G,EAAKpR,GAAAivB,eAEVm3H,EAAAh1I,EAAUpR,EAAA,GACVivB,EAAIhX,iCAMjB,OApFH,gICDAwgJ,EAAOt4J,EAAU,YAETP,EAAAE,kCAEA,IAAIwyF,EAAAq5B,EAOR,OALKzlG,EAAAkrE,gBAAA/wF,GAAA8nE,kBANQmqB,GAaZE,WAbY,SAAAtsE,GAAA,OAAAA,EAeP2nB,WAAW2kD,WAAAtsE,IAEbkxI,KAAA,SAAU1S,EAAAx+H,GAET,IAAAA,EAAAmlD,qCAKD,OAAAinB,GAEHA,EAAAM,iBAAA1sE,GA1BLosE,EAAA8kE,KAAA1S,EAAAx+H,IAwBkB,wDCzBlB,IAAMwyI,EAAQv4J,EAAQ,2DAEtB0nG,EAAO1nG,EAAa,YAEZP,EAAAE,QAAIgf,EAAA2qC,OACJ+oC,WAAA,SAAAlI,GACA,IAAA+I,EAAW/I,EAAa0O,oBAI5B,OARsB3F,EAAAglE,WAAA,EAQtBhlE,4BAGI,IAAIA,EAAYntE,EAAhBorE,YAEIpsD,EAAAhf,EAASgf,KACT9gC,EAAO8gC,EAAK9gC,MACZC,EAAO6gC,EAAK7gC,qBAEZs0J,EAAOzzH,EAAA4T,QAAWz0C,EAEtB+M,EAAAiiF,EAAA9hF,MACAH,EAAK,GAAGrR,GAAI64J,EACZxnJ,EAAK,GAAGjN,GAAIw0J,EArBMvnJ,EAAA,GAAArR,EAAAqE,EAAAw0J,EAwBtBxnJ,EAAA,GAAAjN,EAxBsBE,EAAAs0J,GA0BlBE,eAAM,SAAA3yI,GA1BYwyI,EAAAG,eAAA3yI,GAAA2hF,EAAAixD,mBA6BL5yI,EAAAmlD,SAAAnlD,EAAAgf,KAAAjoB,QAEbm6I,KAAA,SAAA1S,EAAAx+H,GACA,IAAIgf,EAAAhf,EAASgf,KACOgL,EAAIhL,EAAxBsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IACtBk7D,EAAAx7D,EAAJa,IACI46D,EAAJz7D,EAAAc,6BAEA0zG,EAAAv5G,MAAA,GAAA,GAKAu5G,EAAI8T,YAAWtzH,EAAflpB,QAAA,qBAGI5K,EAAA8U,EAAYorE,YAAA//E,MAEZ6/B,EAAIw9E,EAAQ94C,oBAEZ/1E,EAAIqR,EAAK,GAAGrR,EACZoE,EAAIiN,EAAK,GAAGjN,EACZ4vC,EAAA3iC,EAAJ,GAAArR,EAAAA,aAKL,OAHKoE,GAAIA,EAAA6vC,EAEP0wG,EAAAqU,UAAA3nH,EAAArxC,EAAAoE,EAAA4vC,EAAAC,GAxDL,gJCDIglH,EAAgB74J,EAAA,cAGhB+3J,GACItlE,iBAAA,SAAA1sE,wBAEAw+H,EAAAuU,OAGAD,EAAA5B,KAAA1S,EAAA1sF,EAAAs8B,WATRowD,EAAArhI,SAsBIzjB,EAAAE,SAFJo4J,cAAAA,gBAJQtlE,iBAAA,SAAA1sE,KACHkxI,KAAA,SAAA1S,EAAA1sF,GAJL0sF,EAAAwU,0FCdA,IAAM3uE,EAAApqF,EAAW,mCACbkgG,EAAS9V,EAAQ6K,KACjB8B,EAAS3M,EAAQ2M,SACjBiiE,EAAQh5J,EAAQ,4BAEpBi5J,EAAOj5J,EAAU,WAETP,EAAAE,SACIyyF,aAAK,SAAWjI,GACZ,OAAAA,EAAOnhE,MACX,KAAKk3E,EAAWC,OACZ,OAAO64D,EACX,KAAK94D,EAAWxC,OACZ,OAAOw7D,EACX,KAAKh5D,EAAWE,MACZ,OAAI64D,EACA,KAAA/4D,EAAO3J,OACV,OAFDpM,EAGKwW,UAAA5J,EAAAC,OACM,OAOtB3E,WAAA,SAAAlI,GArBL,OAAAA,EAAAz8C,WAAA2kD,WAAAlI,+GCLA,IAAIud,EAAA1nG,EAAW,YAGPyhC,GACA4wD,WAAA,SAAAlI,GACA,IAAA+I,EAAW/I,EAAa0O,oBAI5B,OATW3F,EAAAglE,WAAA,EASXhlE,GAEQT,iBAAO,SAAAtI,GACVA,EAAAwI,iCAIG,IAAAO,EAAK/I,EAAUgH,YAClB+B,EAAAE,2BAIAF,EAAAC,WArBM7yF,KAAA64J,YAAAhvE,IA0BPivE,UAAI,SAAajvE,GACjB,IAAI1lE,EAAO0lE,EAAA1gE,YACPypE,EAAa/I,EAAjBgH,YACIlgF,EAAAiiF,EAAgB9hF,gBAEVqT,EAAUymD,SAEhB,GAAAzmD,EAAIkqD,SAAS,CACb,IAAI9sD,EAAI3e,EAAKtD,EACT4a,EAAItX,EAAKgB,OACbsI,EAAQtJ,EAARc,EACA0D,EAAQxE,EAARe,MACAgN,EAAK,GAAGolB,EAAIxU,EACZ5Q,EAAK,GAAG6d,EAAIpnB,EARhBuJ,EAUK,GAAAolB,EAAA7b,EACDvJ,EAAI,GAAA6d,EAAItiB,MACR,CACA,IAAI8Y,EAAIpiB,EAAKtD,EACT6xE,EAAIvuE,EAAKe,MACb46D,EAAA37D,EAAAc,EACAg/D,EAAA9/D,EAAAgB,OACA+M,EAAK,GAAGolB,EAAI/Q,EACZrU,EAAK,GAAG6d,EAAI+vC,EACf5tD,EAAA,GAAAolB,EAAAo7C,WAKLyhB,EAvDWE,SAuDE,GACT+lE,YACI,SAAchvE,GADlB,IAEI+I,EAAO/I,EAAWgH,YAClBpsD,EAAKolD,EAAKplD,KAAO9zB,EAAKiiF,EAH1B9hF,MAIIioJ,EAAAt0H,EAAO9gC,MAAmBq1J,EAAAv0H,EAAO7gC,OACjCu0J,EAAA1zH,EALJ2T,QAAA2gH,EAKOb,EAAAzzH,EALP4T,QAAA2gH,EAKUz3I,OAAA,EAAGrV,OAAA,EACTgO,OAAA,EACA9S,OAAI,EACJ,GAAAyiF,EAAK+W,KACLr/E,GAAI42I,EACJjsJ,GAAIgsJ,EAJRh+I,EAMK6+I,EACD3xJ,EAAI4xJ,MAAJ,CAAA,IACoC70I,EAAK0lE,EAAM1gE,YAC3C8vI,EAAK90I,EAAMiqD,cAFfzqE,MAE4Bu1J,EAAK/0I,EAAMiqD,cAFvCxqE,OAGIu1J,EAAAh1I,EAAS+pD,MAAMvqE,MACfy1J,EAAAj1I,EAAS+pD,MAJbtqE,OAIsBw2B,EAASjW,EAAKgqD,QAChCx+D,EAAAopJ,EAAWE,EACXhpJ,EAAA+oJ,EAAYE,EACZzsE,EAAAryD,EAAa96B,GAAA25J,EAAYE,GAAD,EAExBE,GADUj/H,EAAA96B,EACC86B,EAAS12B,GAAxBw1J,EAAAE,GAAA,GACIh/H,EAAa12B,EACjB6d,EAAIkrE,EAAJ98E,EAAAwoJ,EACAjsJ,EAAImtJ,EAAJppJ,EAAAioJ,EACHh+I,EAAA6+I,MAIDpoJ,EAAK,GAAGrR,EAAIiiB,EACZ5Q,EAAK,GAAGjN,EAAIwI,WAEZyE,EAAA,GAAAjN,EAAW0D,EAzFJwrF,EAAAC,WA4FM,GAEb8jE,KAAA,SAAA1S,EAAAx+H,GACA,IAAIgf,EAAAhf,EAASgf,KACOgL,EAAIhL,EAAxBsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IACtBk7D,EAAAx7D,EAAJa,IACI46D,EAAJz7D,EAAAc,6BAEA0zG,EAAAv5G,MAAA,GAAA,GAKAu5G,EAAI8T,YAAWtzH,EAAAlpB,QAAa,kCAGxB5K,EAAA8U,EAAQorE,YAAM//E,MAEd6/B,EAAIy2D,EAARkyD,kBAAAnrC,EAAA1pF,EAAA0wB,QAEI71D,EAAIqR,EAAK,GAAGrR,EACZoE,EAAIiN,EAAK,GAAGjN,EACZ4vC,EAAA3iC,EAAJ,GAAArR,WAEAoE,GAAIA,EAAK6vC,EAET,IAAIh8B,EAAK5G,EAAK,GAAGolB,EACbve,EAAK7G,EAAK,GAAG6d,WAEbm3H,EAAAh1I,EAAU,GAAA6d,EA1HtB,OA8HKy1H,EAAAqU,UAAA3nH,EAAAp5B,EAAAC,EAAAkuI,EAAAC,EAAArmJ,EAAAoE,EAAA4vC,EAAAC,GA9HL,4ECGQpS,GACA4wD,WAAA,SAAAlI,GACA,IAAA+I,EAAW/I,EAAa0O,2BAJjB3F,EAAAglE,WAAA,KAUXzlE,iBAVAzyF,EAAW,YAUAyyF,iBAEP2mE,UAAI,SAAajvE,GACjB,IAAI1lE,EAAO0lE,EAAM1gE,YACbypE,EAAU/I,EAAMgH,sBAKhB1gB,GAHJhsD,EAAAymD,SAGIzmD,EAAc2pD,WACdsC,EAAYjsD,EAAM4pD,WAClBsC,EAAAztE,EAAee,MAAMwsE,EAAzBC,EACIE,EAAAnsD,EAAeupD,yBAEnB8C,EAAA5tE,EAAAgB,OAAA0sE,EAAAC,EAGI5/D,EAAAiiF,EAAA9hF,MACAqT,EAAAkqD,UACA19D,EAAK,GAAGolB,EAAInzB,EAAAtD,EACZqR,EAAK,GAAGolB,EAAIw6C,EAAc3tE,EAA1BtD,EACAqR,EAAK,GAAGolB,EAAIw6C,EAAZC,EAAA5tE,EAAAtD,EACAqR,EAAK,GAAGolB,EAAInzB,EAAAtD,EAAAsD,EAAYgB,OACxB+M,EAAK,GAAG6d,EAAI5rB,EAAAc,EACZiN,EAAK,GAAG6d,EAAI2hD,EAASvtE,EAAKc,EAR9BiN,EAUK,GAAA6d,EAAA2hD,EAAAE,EAAAztE,EAAAc,EACDiN,EAAK,GAAG6d,EAAI5rB,EAAKc,EAAjBd,EAAAe,QAEAgN,EAAK,GAAGolB,EAAInzB,EAAAtD,EACZqR,EAAK,GAAGolB,EAAIo6C,EAASvtE,EAAKtD,EAC1BqR,EAAK,GAAGolB,EAAIo6C,EAAZE,EAAAztE,EAAAtD,EACAqR,EAAK,GAAGolB,EAAInzB,EAAAtD,EAAAsD,EAAYe,MACxBgN,EAAK,GAAG6d,EAAI5rB,EAAAc,EACZiN,EAAK,GAAG6d,EAAI8hD,EAAS1tE,EAAKc,EAC7BiN,EAAA,GAAA6d,EAAA8hD,EAAAE,EAAA5tE,EAAAc,EACDiN,EAAA,GAAW6d,EAAA5rB,EAAUc,EAAAd,EAArBgB,QAGJgvF,EAjDWE,SAiDE,GACT+lE,YACI,SAAOhvE,GADX,IAEI+I,EAAO/I,EAFXgH,YAGIlgF,EAAAiiF,EAHJ9hF,MAGwB2zB,EAAAolD,EAAcplD,KAClC9gC,EAAO8gC,EAAK9gC,MAAiBC,EAAO6gC,EAAK7gC,qBAEzCs0J,EAAAzzH,EAAQ4T,QAAOz0C,EAEfugB,EAAA0lE,EAAY1gE,YAEZgnD,GADAhsD,EAAa+pD,MACD/pD,EAAM2pD,WAClBsC,EAAAjsD,EAAe4pD,wBAEfwC,EAAepsD,EAAA0pD,YAEf0rF,EAAS51J,EAASwsE,EAAYC,EAC9BopF,EAAS51J,EAAU0sE,EAAYC,EACnCkpF,EAAU91J,GAAAwsE,EAAiBC,GAC3BspF,EAAU91J,GAAA0sE,EAA0BC,GACpCkpF,EAAA9mJ,MAAe8mJ,IAAAA,EAAA,EAAuB,EAAAA,EACtCC,EAAA/mJ,MAAA+mJ,IAAgBA,EAAA,EAAA,EAAwBA,YAExCF,EAAaA,EAAb,EAAA,EAAAA,EAEA7oJ,EAAK,GAAGrR,GAAI64J,EACZxnJ,EAAK,GAAGjN,GAAIw0J,EACZvnJ,EAAK,GAAGrR,EAAI6wE,EAAYspF,EAAAtB,EACxBxnJ,EAAK,GAAGjN,EAAI6sE,EAAYmpF,EAAAxB,EACxBvnJ,EAAK,GAAGrR,EAAIqR,EAAA,GAAQrR,EAApBi6J,EACA5oJ,EAAK,GAAGjN,EAAIiN,EAAA,GAAAjN,EAAS81J,aAErB7oJ,EAAA,GAAAjN,EAAWE,EAAXs0J,EAjFOtlE,EAAAC,WAoFM,GAEb8jE,KAAA,SAAA1S,EAAAx+H,GACA,IAAIgf,EAAAhf,EAASgf,KACOgL,EAAIhL,EAAxBsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IACtBk7D,EAAAx7D,EAAJa,IACI46D,EAAJz7D,EAAAc,6BAEA0zG,EAAAv5G,MAAA,GAAA,GAKAu5G,EAAI8T,YAAWtzH,EAAAlpB,QAAa,IAWxB,kCARA5K,EAAA8U,EAAQorE,YAAM//E,MAEd6/B,EAAAy2D,EAAJkyD,kBAAAnrC,EAAA1pF,EAAA0wB,QACSwkG,EAAT,EAAiBC,OAAA,EAAIppI,OAAA,EACjBqpI,OAAA,EAAG56F,OAAA,EAAG3/D,OAAA,EAAGoE,OAAA,EACT4vC,OAAA,EAAIC,OAAA,EAAIh8B,OAAA,EAAIC,OAAA,EAChBkuI,OAAS,EACLC,OAAK,EACAzrI,EAAA,EAAKA,EAAV,IAAAA,EAAA,CACA+kD,EAAKtuD,EAAIuJ,GACL2/I,EAAAlpJ,EAAKuJ,EAAK,GACV,IAAA,IAAKskD,EAAK,EAAAA,EAAV,IAAAA,EACAo7F,EAAIjpJ,EAAJ6tD,GACAhuC,EAAI7f,EAAJ6tD,EAAA,GACAl/D,EAAIs6J,EAAGt6J,EACPoE,EAAIu7D,EAAGv7D,EACP4vC,EAAI9iB,EAAAlxB,EAAJA,EAEAoE,GAAKA,YAEL6T,EAAKqiJ,EAAG7jI,EAERve,EAAKqiJ,EAAGrrI,UAERm3H,EAAI1mF,EAAAzwC,EAAAhX,EAIAkuI,EAAA,GAAAC,EAAA,GAAAryG,EAAA,GAAAC,EAAA,IACH0wG,EAAAqU,UAAA3nH,EAAAp5B,EAAAC,EAAAkuI,EAAAC,EAAArmJ,EAAAoE,EAAA4vC,EAAAC,GACJomH,KAnIb,OAAAA,2FCEQx4H,GAFJzhC,EAAW,aAGPqyF,WAAO,SAAPlI,GAGJ,OANWA,EAAA0O,qBAQHpG,iBAAO,SAAAtI,GACVA,EAAAwI,WATMxI,EAAAqI,qBAcPykE,KAAA,SAAA1S,EAAAp6D,GACA,IAAIplD,EAAAolD,EAAcplD,KACEgL,EAAIhL,EAAxBsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IACtBk7D,EAAAx7D,EAAJa,IACI46D,EAAJz7D,EAAAc,6BAEA0zG,EAAAv5G,MAAA,GAAA,GAKAu5G,EAAI8T,YAAQtzH,EAAOlpB,QAAnB,IAEA,IAAI4I,EAAM0lE,EAAM1gE,YACZvmB,EAAKuhB,EAAT+pD,MACIigD,EAAKhqG,EAATymD,SACIrzD,EAAK3U,EAAAtD,EACLkY,EAAK5U,EAAAc,gCAELiiJ,EAAAxhI,EAAQkqD,SAAMzrE,EAANe,MAAyBf,EAAKgB,OAEtC+sC,EAAIy2D,EAAR0yD,cAAA3rC,EAAA1pF,EAAA0wB,OAAA59C,EAAAC,EAAAkuI,EAAAC,GAEIryG,EAAI7O,EAAC9gC,MACL4vC,EAAI9O,EAAC7gC,OACLtE,GAAMmlC,EAAV2T,QAAA9E,iBAxCR,OA0CQ5vC,GAAIA,EAAA6vC,EAEJ0wG,EAAInkF,UAAJxgE,EAAAoE,GACAugJ,EAAA6S,UAAA7S,EAAA8V,cAAAppH,EAAA,UACHszG,EAAA+V,SAAA,EAAA,EAAA1mH,EAAAC,GA9CL,wECEQ,SAAA0mH,EAAA1/H,EAAA2U,EAAA1yB,EAAAjF,EAAAC,EAAAkuI,EAAAC,GACH,GAAA/lJ,GAAAi4B,IAAA23B,cAAA5vD,GAAAi4B,IAAA81G,6BACG,OAAApzG,EAEJ,IAAIoW,EAAMzB,EAAOo8B,OAEjB24E,EAAO1pH,EAAS4yF,WAAhB,uBAEA5yF,EAAA32B,OAAA+hJ,EAGA1B,EAAIiW,yBAAJ,yDAEAjW,EAAA+V,SAAA,EAAA,EAAAtU,EAAAC,yCAIA1B,EAAAqU,UAAA3nH,EAAAp5B,EAAAC,EAAAkuI,EAAAC,EAAA,EAAA,EAAAD,EAAAC,GAGA1B,EAAAiW,yBAAA,mBACHjW,EAAAqU,UAAA3nH,EAAAp5B,EAAAC,EAAAkuI,EAAAC,EAAA,EAAA,EAAAD,EAAAC,KAIG,IAAAwU,GACAC,2BAEAC,cAEAC,UAPY,EASRC,MAAA,WACI,IAAAC,GAAQ,EACR,IAAA,IAAK90G,KAAK1lD,KAAAy6J,WAEN,GADAD,GAAI,EACJx6J,KAAAy6J,WAAA/0G,GAWP1lD,KAAAy6J,WAAA/0G,IAAA,MAXO,CACA,IAAAnrB,EAAAv6B,KAAAo6J,UAAA10G,GACAnrB,EAAI52B,MAAK,EACL42B,EAAA32B,OAAK,EACR5D,KAAAq6J,WAAA76J,OAAA,IACDQ,KAAOq6J,WAAK30J,KAAL60B,UAGNv6B,KAAAo6J,UAAA10G,UACI1lD,KAAAy6J,WAAkB/0G,GAK3B80G,IACH56J,GAAA+e,SAAA8P,IAAA7uB,GAAA8gD,SAAAiI,iBAAA3oD,KAAAu6J,MAAAv6J,MA5BOA,KAAAs6J,UAAA,IAiCRI,WAAK,WAjCG96J,GAAA+e,SAAAuP,GAAAtuB,GAAA8gD,SAAAiI,iBAAA3oD,KAAAu6J,MAAAv6J,MAoCZA,KApCYs6J,UAAA,GAsCRK,UAAO,SAAKj1G,GAGhB,OAzCY1lD,KAAAy6J,WAAA/0G,IAAA,EAAA1lD,KAAAo6J,UAyCC10G,IAETk1G,YAAK,SAALrgI,EAAAmrB,GACA1lD,KAAKo6J,UAAK10G,GAAUnrB,EAChBv6B,KAAAy6J,WAAK/0G,IAAL,EACH1lD,KAAAs6J,UA9COt6J,KAAA06J,cAmDJG,UAAA,SAAYn1G,GACf1lD,KAAAo6J,UAAA10G,WACJ1lD,KAAAo6J,UAAA10G,KAKGvmD,EAAAE,SACAi6J,kBAAY,SAARpqH,EAAuB1yB,qBAE3B,GAAA,IAAA0yB,EAAAvrC,OAAA,IAAAurC,EAAAtrC,OAAA,OAAAsrC,EAAAo8B,OAGI,IAAAwvF,EAAe,SAARt+I,EAAAkrG,KACV,cAAAozC,kBAKD,IAAIp1G,EAAJxW,EAAYxT,IAAAo/H,EACRh8J,EAAQq7J,EAAUQ,UAAVj1G,GAOhB,OANQ5mD,IAEHm7J,EADGn7J,EAAAq7J,EAAUE,WAAmB3xJ,OAA7BixB,SAAAC,cAAA,UACHsV,EAAA1yB,EAAA,EAAA,EAAA0yB,EAAAvrC,MAAAurC,EAAAtrC,QACDu2J,EAAAS,YAAA97J,EAAA4mD,IAGJ5mD,GAEQg7J,cAAO,SAAP5qH,EAAA1yB,EAAAjF,EAAAC,EAAAkuI,EAAAC,GACH,IAAAz2G,IAAAA,EAAAxT,KAAAnkB,EAAA,GAAAC,EAAA,GAAAkuI,GAAA,GAAAC,GAAA,cAID,IAAIjgG,EAAAxW,EAAaxT,IACbq/H,GAAS,EACTD,EAAA,SAAOt+I,EAAPkrG,KASH,cARGozC,IACHp1G,GAAAo1G,EACGC,GAAA,IAEA,IAAAxjJ,GAAA,IAAWC,GAAXkuI,IAAAx2G,EAAAvrC,OAAAgiJ,IAAAz2G,EAAAtrC,UACH8hD,GAAA,IAAAnuC,EAAA,IAAAC,EAAA,IAAAkuI,EAAA,IAAAC,EACGoV,GAAW,IAEdA,kBAKG,IAAAj8J,EAAQq7J,EAAUQ,UAAVj1G,GAOhB,OANQ5mD,IAEHm7J,EADGn7J,EAAAq7J,EAAUE,WAAmB3xJ,OAA7BixB,SAAAC,cAAA,UACHsV,EAAA1yB,EAAAjF,EAAAC,EAAAkuI,EAAAC,GACDwU,EAAAS,YAAA97J,EAAA4mD,IAGJ5mD,GAEIu5J,mBAAU,SAAVnpH,EAAA1yB,GACH,IAAAkpC,EAAAxW,EAAAxT,KAAA,SAAAlf,EAAAkrG,MAvDLyyC,EAAAU,UAAAn1G,0DCjFWxkB,EAAU0Y,KAEZvY,KAAAyL,+CA0CLqC,UAAA,iBAeA1H,OAAA,gBAQAuzH,UAAA,EACAp7E,QAAS,KACTq7E,YAAU,kBAEVvvF,SAxC2B,KA0CvBrc,UAAM,SAAA90B,EAAAu0B,2BAEN,IAAAsnG,EAAiB12J,EAAa,mCAE9BM,KAAKmvC,UAASjO,EAAdiO,UAEInvC,KAAAu6B,OAAAA,gCASJv6B,KAAKgkD,MAAL,IAAe9iB,EAAIijB,MAEnBnkD,KAAI4/E,QAAW,IAAAw2E,EAAAp2J,KAAAynC,OAAAznC,KAAAgkD,OA3DQ,IAAAk3G,EA3BvB,SADoDzzH,GAYpD,OACA0zH,eAboD,IAAAj6H,EAAAiO,UAAA1H,GAGpDuiC,UACArmE,MAAO,IACPC,OAAO,IACPqmE,MAAA/oC,EAAQE,IAAAg6H,YACRjxF,MAAAjpC,EAAQE,IAAAg6H,YAPZrxF,OAAA7oC,EAAAE,IAAAkxC,6BAUA+oF,iBAAAn6H,EAAAo6H,QAAAC,UAKHC,cAAAt6H,EAAAo6H,QAAAG,QAa8BC,CAAA17J,KAAAynC,QAsF3BznC,KAAA0rE,SAtF2B,IAsFfxqC,EAAQg2H,gBAAAl3J,KAAAynC,OAAAyzH,2BAGhB,IAAIS,EAASj8J,EAAA,YAQbM,KAAKmvC,UAASjO,EAAdiO,UAEAnvC,KAAKu6B,OAALA,EACIv6B,KAAAynC,OADW,IACCvG,EAAY06H,OAAOrhI,GADpBv6B,KAAfw8E,SAGAzzE,EAAK,EAAAmD,EAAL,EAAeC,EAAI,EAAAC,EAAA,EAAA6+F,GAAA,EAAeC,GAAA,GAtGXlrG,KAAA4/E,QAAA,IAAA+7E,EAAAvF,sBAAAp2J,KAAAynC,OAAAznC,KAAAw8E,SA0G3Bx8E,KAAA0rE,SA1G2B,IAAAiwF,EA0GHzE,iBAEpB/R,qBAAkB,WAENvlJ,GAAS+e,UACpB/e,GAAA+e,SAAAq5B,2BAIG,GAAAp4C,GAAA06B,KAAKkwB,aAAL5qD,GAAwB06B,KAAMuvB,mBAAmB,CACjD,IAAAy5F,EAAK1jJ,GAAL6iD,KAAiB2jG,kBACjBpmJ,KAAKynC,OAALo0H,YAAiBvY,EAAQhkJ,EAAAgkJ,EAAA5/I,EAAzB4/I,EAAA3/I,MAAA2/I,EAAA1/I,QACA5D,KAAKw8E,QAAQzzE,EAAbnJ,GAAkB6iD,KAAlB4jG,YACArmJ,KAAKw8E,QAAQpwE,EAAbxM,GAAkB6iD,KAAO6jG,YAN7BtmJ,KAQKw8E,QAAIyuB,GAAAq4C,EAAahkJ,EAClBU,KAAIw8E,QAAS0uB,GAAKo4C,EAAA5/I,EAAlB4/I,EAAA1/I,WACA,IAgBJmL,OAAI,SAAS+sJ,GACT97J,KAAAynC,OAAAuvH,OAAAC,UAAA,EACA6E,IAEA97J,KAAK4/E,QAALC,MAAci8E,GAEjB97J,KAAA0rE,SAAA38D,OAAA/O,KAAAgkD,OAjJsBhkD,KAAAg7J,UAAAh7J,KAAAynC,OAAAuvH,OAAAC,YAsJvBrzG,MAAA,WACH5jD,KAAA4/E,QAAA/nC,QAvJL73C,KAAA0rE,SAAA6tD,aC1DAwiC,WAAA,IAAAC,kBAAA,IAAAC,qBAAA,IAAAC,kCAAA,MAAAC,KAAA,SAAAz8J,EAAAP,EAAAE,GA6BA,+BAGA+8J,EAAA,IAAA/2J,KAAA8E,GAKAkyJ,EAAA,KAoEC,SAAAC,EAAAvzJ,cASA,SAAAwzJ,EAAAxzJ,cAOD,IAAAomH,EAAA9pH,KAAA8pH,OAUC,SAAAqtC,EAAAl3J,EAAAC,gCA6CD,IAAIk3J,EAAW,GAEfC,GAAA,GAAAD,EAAA,EAoGE,SAAAE,EAAAnuI,GACA,IAAIriB,EAAG,UAAEqiB,IAAAA,IACTriB,IAAgC,MAAAqiB,IAChCriB,GAAI,IAA2B,SAAAqiB,IAC/BriB,GAAI,GAA2B,UAAAqiB,IAC/BriB,GAAI,GAA2B,UAAAqiB,IAC/BriB,GAAI,GAA2B,WAAAqiB,IAC/BriB,GAAO,KAmDT,IAACywJ,EAAc,IAAAvpJ,MAAA,MAEX,SAAIs8H,GAAJ,IAAA,IAAWpwI,EAAX,EAAAA,EAAA,MAAAA,EAAA,CAAA,IAAkBivB,EAAIjvB,EACtB2a,EAAK3a,EACHgI,EAAM,EACN,IAAAinB,KAAA,EAAAA,EAAAA,KAAA,EACAtU,IAAA,EACDA,GAAA,EAAAsU,IACGjnB,EAELooI,EAAApwI,GAAA2a,GAVH3S,EAAA,MAEI,CAUJq1J,GAgHC,IAAAC,EAASv4G,OAFgBw4G,QAGzBL,SAASA,EACTM,mBACAL,QALyBA,EAMzBM,KAtRA,SAAAxuI,sBAuRA5e,IA7QC,SAAQ4e,GACT,IAAA+oC,EAAA/oC,GAAAiuI,EAAA,iBA6QAn3J,IAlQA,SAAAhG,EAAAoE,0BAmQA6B,IAxPA,SAAAjG,EAAAoE,0BAyPAu5J,OA/OA,SAAAzuI,uBAgPA0uI,KAtOC,SAAa1uI,GACb,IAAAtU,EAAA6J,SACA7J,GAAAsU,EAAS,QAAD,EACiCtU,GAAzC6J,IADAyK,KAA2BtU,GACd,MAAb,EACAA,GAAA6J,IAD2ByK,KAAOzK,GACtB,KAAZ,GACD7J,GAAA6J,IADCyK,KAAAzK,GACD,IAAA,IAAAyK,KAAAzK,OAkOAo5I,MAtNA,SAAA3uI,6FAuNA4uI,SA7MC,SAAS5uI,qBAEVA,GAAA,WADCA,GAASA,IAAK,EAAM,cACrBA,IAAA,EAAA,qCA4MAmuI,mBAdyBA,EAezBU,SAjLC,SAAA7uI,UACAA,GAAW,IAANA,IACLA,EACAA,GAAKA,IAAM,EACXA,GAAKA,IAAM,EACXA,GAAKA,IAAM,EACXA,GAAAA,IAAW,KACZA,GAAAA,IAAA,KA2KA8uI,SAjKC,SAAA9uI,UACAA,GAAKA,IAAM,EACXA,GAAKA,IAAM,EACXA,GAAKA,IAAM,EACXA,GAAAA,IAAO,GACRA,GAAAA,IAAA,aA6JA+uI,OAnJC,SAAA/uI,UACAA,GAAKA,IAAM,GACXA,GAAKA,IAAL,EACAA,GAAAA,IAAQ,WACTA,GAAA,OAgJA3sB,QArHA,SAAA2sB,wEAsHAgvI,YA3GC,SAAqBl+J,EAAAoE,UAKrBpE,EAAA,2BAFAA,EAAqB,YADrBA,EAAqB,WADrBA,GAAK,OACKA,GAAK,IACLA,GAAK,WAEVA,GAAL,KAMAoE,EAAA,2BAFAA,EAAqB,YADrBA,EAAqB,WADrBA,GAAK,OACKA,GAAK,IACLA,GAAK,WAERA,GAAK,QAiGb+5J,cArFC,SAAuBjvI,EAAApc,UAKxBoc,EAAA,QADCA,EAAA,WADAA,EAAI,YADJA,EAAuB,YADvBA,EAAIA,IAAMpc,EAAA,YACAoc,IAAM,IACNA,IAAM,IACRA,IAAD,IACRA,IAAA,cAiFAkvI,YArEC,SAAKp+J,EAAgBoE,EAAA0lC,UAKrB9pC,EAAA,4BAFAA,EAAqB,YADrBA,EAAqB,aADrBA,GAAM,MACKA,GAAG,KACHA,GAAG,WAETA,GAAL,IAOAA,mBAFAoE,EAAA,aADAA,EAAqB,YADrBA,EAAqB,aADrBA,GAAM,MACKA,GAAG,KACHA,GAAG,IACRA,GAAN,YAEA,IAMA0lC,EAAA,4BAFAA,EAAqB,YADrBA,EAAqB,aADrBA,GAAM,MACKA,GAAG,KACHA,GAAG,WAEPA,GAAK,QA8Bdu0H,cAlBE,SAAsBnvI,EAAApc,UAKvBoc,EAAA,OADCA,EAAA,aADAA,EAAI,YADJA,EAAsB,aADtBA,EAAIA,IAAMpc,EAAA,YACAoc,IAAI,IACJA,IAAI,IACNA,IAAD,IACRA,IAAA,8BAUC,SAA2BA,GAC5B,IAAApnB,EAAAonB,EAAAA,EAAA,oCA4BGovI,EAAA,IAAQvqJ,MAAS,GAEnB81H,EAAA,SAAA7pI,EAAAoE,GAFF1D,KAAAV,EAAAA,YAOE6pI,EAAA7mI,UAAUu7J,OAAV,8BAEAD,EAAA,GAAO59J,KAAP0D,KASF,IAAAq4D,GAOCjvB,OAFD,8BAaChH,IAFD,SAAAxmC,EAAAoE,sBAYCrD,MAFD,SAAA0I,0BAaEmrC,KAAU,SAAVzf,EAAA1rB,UACA0rB,EAAAn1B,EAAOyJ,EAAPzJ,EAHFm1B,EAAA/wB,EAAAqF,EAAArF,KAgBEooB,IAAA,SAAA2I,EAAAn1B,EAAAoE,UACA+wB,EAAAn1B,EAAOA,EAHTm1B,EAAA/wB,EAAAA,KAgBEmB,IAAQ,SAAR4vB,EAAA1rB,EAAAmD,UACAuoB,EAAAn1B,EAAOyJ,EAAPzJ,EAAA4M,EAAA5M,EAHFm1B,EAAA/wB,EAAAqF,EAAArF,EAAAwI,EAAAxI,KAgBEo6J,SAAc,SAAdrpI,EAAA1rB,EAAAmD,UACAuoB,EAAAn1B,EAAOyJ,EAAPzJ,EAAA4M,EAAA5M,EAHFm1B,EAAA/wB,EAAAqF,EAAArF,EAAAwI,EAAAxI,MAYAq4D,EAAAt3D,IAAAs3D,EAAA+hG,SAUE/hG,EAAA/qB,SAAc,SAAdvc,EAAA1rB,EAAAmD,UACAuoB,EAAAn1B,EAAOyJ,EAAPzJ,EAAA4M,EAAA5M,EAHFm1B,EAAA/wB,EAAAqF,EAAArF,EAAAwI,EAAAxI,KAYAq4D,EAAA73D,IAAA63D,EAAA/qB,SAUE+qB,EAAAgiG,OAAQ,SAARtpI,EAAA1rB,EAAAmD,UACAuoB,EAAAn1B,EAAOyJ,EAAPzJ,EAAA4M,EAAA5M,EAHFm1B,EAAA/wB,EAAAqF,EAAArF,EAAAwI,EAAAxI,KAYAq4D,EAAA6B,IAAA7B,EAAAgiG,OASEhiG,EAAA0pF,KAAQ,SAAYhxH,EAApB1rB,UACA0rB,EAAAn1B,EAAO+F,KAAPogJ,KAAA18I,EAAAzJ,GAHFm1B,EAAA/wB,EAAA2B,KAAAogJ,KAAA18I,EAAArF,MAeEq4D,EAAA9kC,MAAQ,SAAaxC,EAArB1rB,UACA0rB,EAAAn1B,EAAO+F,KAAP4xB,MAAAluB,EAAAzJ,GAHFm1B,EAAA/wB,EAAA2B,KAAA4xB,MAAAluB,EAAArF,MAgBEq4D,EAAAz2D,IAAQ,SAAWmvB,EAAK1rB,EAAxBmD,UACAuoB,EAAAn1B,EAAO+F,KAAPC,IAAAyD,EAAAzJ,EAAA4M,EAAA5M,GAHFm1B,EAAA/wB,EAAA2B,KAAAC,IAAAyD,EAAArF,EAAAwI,EAAAxI,MAgBEq4D,EAAAx2D,IAAQ,SAAWkvB,EAAK1rB,EAAxBmD,UACAuoB,EAAAn1B,EAAO+F,KAAPE,IAAAwD,EAAAzJ,EAAA4M,EAAA5M,GAHFm1B,EAAA/wB,EAAA2B,KAAAE,IAAAwD,EAAArF,EAAAwI,EAAAxI,MAeEq4D,EAAArpD,MAAQ,SAAa+hB,EAArB1rB,UACA0rB,EAAAn1B,EAAO+F,KAAPqN,MAAA3J,EAAAzJ,GAHFm1B,EAAA/wB,EAAA2B,KAAAqN,MAAA3J,EAAArF,MAgBEq4D,EAAArxB,MAAQ,SAARjW,EAAA1rB,EAAAmD,UACAuoB,EAAAn1B,EAAOyJ,EAAPzJ,EAAA4M,EAHFuoB,EAAA/wB,EAAAqF,EAAArF,EAAAwI,KAiBE6vD,EAAAiiG,YAAe,SAAfvpI,EAAA1rB,EAAAmD,EAAAw+B,UACAjW,EAAAn1B,EAAOyJ,EAAPzJ,EAAA4M,EAAA5M,EAAAorC,EAHFjW,EAAA/wB,EAAAqF,EAAArF,EAAAwI,EAAAxI,EAAAgnC,KAcEqxB,EAAArlC,SACc,SADd3tB,EAAAmD,GAEA,IAAA5M,EAAO4M,EAAA5M,EAAKyJ,EAALzJ,EAHToE,EAAAwI,EAAAxI,EAAAqF,EAAArF,6BAYAq4D,EAAAhlB,KAAAglB,EAAArlC,SAQEqlC,EAAAkiG,gBAAA,SAAAl1J,EAAAmD,GAEA,IAAA5M,EAAO4M,EAAA5M,EAAAyJ,EAAQzJ,EAHjBoE,EAAAwI,EAAAxI,EAAAqF,EAAArF,kBAYAq4D,EAAAmiG,QAAAniG,EAAAkiG,gBAOEliG,EAAAv8D,OAAA,SAAAuJ,GAEA,IAAAzJ,EAAOyJ,EAAAzJ,EAHToE,EAAAqF,EAAArF,6BAYAq4D,EAAAhuC,IAAAguC,EAAAv8D,OAOEu8D,EAAAoiG,cAAA,SAAAp1J,GAEA,IAAAzJ,EAAOyJ,EAAAzJ,EAHToE,EAAAqF,EAAArF,kBAYAq4D,EAAAqiG,OAAAriG,EAAAoiG,cASEpiG,EAAAsiG,OAAA,SAAA5pI,EAAA1rB,UACA0rB,EAAAn1B,GAAOyJ,EAAPzJ,EAHFm1B,EAAA/wB,GAAAqF,EAAArF,KAeEq4D,EAAAuiG,QAAQ,SAAR7pI,EAAA1rB,UACA0rB,EAAAn1B,EAAO,EAAPyJ,EAAAzJ,EAHFm1B,EAAA/wB,EAAA,EAAAqF,EAAArF,KAcEq4D,EAAAsB,YAAA,SAAA5oC,EAAA1rB,aAGIrF,EAAAqF,EAAKrF,SAAT2B,KAEOuK,IAAAtQ,GAAA+8J,EACL5nI,EAAIn1B,EAAI,UAGV+F,KAEOuK,IAAAlM,GAAA24J,EACL5nI,EAAI/wB,EAAI,eAcVq4D,EAAAvmC,UAAA,SAAAf,EAAA1rB,GAEA,IAAIzJ,EAAAyJ,EAAMzJ,EACNoE,EAAAqF,EAAMrF,EACRqqB,EAAAzuB,EAAAA,EAAAoE,EAAAA,SACAqqB,EAAM,IAENA,EAAA,EAAU1oB,KAAIoI,KAAdsgB,GACD0G,EAAAn1B,EAAAyJ,EAAAzJ,EAAAyuB,EACD0G,EAAA/wB,EAAAqF,EAAArF,EAAAqqB,MAYDguC,EAFDjmB,IAAA,SAAA/sC,EAAAmD,2BAeE6vD,EAAAnmB,MAAQ,SAARnhB,EAAA1rB,EAAAmD,GACA,IAAIk9B,EAAIrgC,EAARzJ,EAAA4M,EAAAxI,EAAAqF,EAAArF,EAAAwI,EAAA5M,SACAm1B,EAAAn1B,EAAOm1B,EAAP/wB,EAAA,EAJF+wB,EAAA2U,EAAAA,KAiBE2yB,EAAA9xC,KACS,SADTwK,EAAA1rB,EAAAmD,EAAA9E,GAEA,IAAI4xC,EAAIjwC,EAAAzJ,EACJ25C,EAAIlwC,EAAArF,SACR+wB,EAAAn1B,EAAO05C,EAAP5xC,GAAA8E,EAAA5M,EAAA05C,GALFvkB,EAAA/wB,EAAAu1C,EAAA7xC,GAAA8E,EAAAxI,EAAAu1C,MAiBE8iB,EAAAozD,OAAQ,SAAA16F,EAAiBiW,GACzBA,EAAQA,GAAS,EACjB,IAAIxwB,EAAI,EAAAi1G,IAAc9pH,KAAtB8E,UACAsqB,EAAAn1B,EAAO+F,KAAP6E,IAAAgQ,GAAAwwB,EALFjW,EAAA/wB,EAAA2B,KAAAiF,IAAA4P,GAAAwwB,KAiBEqxB,EAAAwiG,cAAA,SAAA9pI,EAAA1rB,EAAAuS,GAEA,IAAIhc,EAAIyJ,EAAEzJ,EACNoE,EAAIqF,EAAErF,SACV+wB,EAAAn1B,EAAOgc,EAAPo0B,IAAApwC,EAAAgc,EAAAs0B,IAAAlsC,EALF+wB,EAAA/wB,EAAA4X,EAAAq0B,IAAArwC,EAAAgc,EAAAu0B,IAAAnsC,KAiBEq4D,EAAAyiG,eAAA,SAAA/pI,EAAA1rB,EAAAuS,GAEA,IAAIhc,EAAIyJ,EAAEzJ,EACNoE,EAAIqF,EAAErF,SACV+wB,EAAAn1B,EAAOgc,EAAPo0B,IAAApwC,EAAAgc,EAAAs0B,IAAAlsC,EAAA4X,EAAAw0B,IALFrb,EAAA/wB,EAAA4X,EAAAq0B,IAAArwC,EAAAgc,EAAAu0B,IAAAnsC,EAAA4X,EAAAy0B,OAkBEgsB,EAAA/nB,cAAA,SAAAvf,EAAA1rB,EAAAuS,GAEA,IAAIhc,EAAIyJ,EAAEzJ,EACNoE,EAAIqF,EAAErF,SACV+wB,EAAAn1B,EAAOgc,EAAPo0B,IAAApwC,EAAAgc,EAAAu0B,IAAAnsC,EAAA4X,EAAA00B,IALFvb,EAAA/wB,EAAA4X,EAAAq0B,IAAArwC,EAAAgc,EAAAw0B,IAAApsC,EAAA4X,EAAA20B,OAmBE8rB,EAAAloB,cAAA,SAAApf,EAAA1rB,EAAAuS,GAEA,IAAIhc,EAAIyJ,EAAEzJ,EACNoE,EAAIqF,EAAErF,SACV+wB,EAAAn1B,EAAOgc,EAAPo0B,IAAApwC,EAAAgc,EAAAw0B,IAAApsC,EAAA4X,EAAAg1B,IALF7b,EAAA/wB,EAAA4X,EAAAq0B,IAAArwC,EAAAgc,EAAAy0B,IAAArsC,EAAA4X,EAAAi1B,4BAuBE,IAAAkuH,EAAO1iG,EAAAjvB,SAEL,OAAK,SAAQ/jC,EAAAs+B,EAAAjN,EAAAuL,EAAAkR,EAAAy9G,GACX,IAAA/0J,EAAAgiB,EAeA,IAdD8lB,SAIAjN,SAKC7Y,EAHFokB,EAGMtgC,KAAEC,IAANqgC,EAAA0B,EAAAjN,EAAArxB,EAAAvJ,iBAKGD,EAAH66B,EAAa76B,EAAbgiB,EAAAhiB,GAAA8nC,EACAo3H,EAAAn/J,EAAOyJ,EAAAxJ,GAAOk/J,EAAE/6J,EAAFqF,EAAAxJ,EAAW,GAC1Bs3C,EAAA4nH,EAAAA,EAAAnK,uBAvBL,OAAAvrJ,MAqCCgzD,EAFDkkF,IAAA,SAAAl3I,mCAaEgzD,EAAAz5C,MAAW,SAAXmS,EAAAjG,mBAEAiG,EAAA,GAAOjG,EAAP9qB,KAYDq4D,EAFD2iG,YAAA,SAAA31J,EAAAmD,gCAYE6vD,EAAA3F,OAAA,SAAArtD,EAAAmD,GACA,IAAIyyJ,EAAK51J,EAAEzJ,EAAGs/J,EAAK71J,EAAErF,EACrBm7J,EAAQ3yJ,EAAA5M,EAHVkI,EAAA0E,EAAAxI,qHASA,IAAIo7J,EAAQ,IAAAzrJ,MAAS,GAEnBi0F,EAAA,SAAAhoG,EAAAoE,EAAA0lC,GACAppC,KAAKV,EAAIA,EAHXU,KAAA0D,EAAAA,YAQE4jG,EAAAhlG,UAAYu7J,OAAZ,kBACAiB,EAAO,GAAK9+J,KAAKV,cAEjBw/J,EAAO,GAAA9+J,KAAPopC,KASF,IAAA/H,GAOCyL,OAFD,gCAcChH,IAFD,SAAAxmC,EAAAoE,EAAA0lC,wBAYC/oC,MAFD,SAAA0I,8BAaEmrC,KAAU,SAAVzf,EAAA1rB,UACA0rB,EAAIn1B,EAAIyJ,EAAEzJ,EACVm1B,EAAA/wB,EAAOqF,EAAPrF,EAJF+wB,EAAA2U,EAAArgC,EAAAqgC,KAkBEtd,IAAA,SAAA2I,EAAAn1B,EAAAoE,EAAA0lC,UACA3U,EAAIn1B,EAAIA,EACRm1B,EAAA/wB,EAAOA,EAJT+wB,EAAA2U,EAAAA,KAiBEvkC,IAAQ,SAAR4vB,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,EAChBm1B,EAAA/wB,EAAOqF,EAAPrF,EAAAwI,EAAAxI,EAJF+wB,EAAA2U,EAAArgC,EAAAqgC,EAAAl9B,EAAAk9B,KAiBE00H,SAAc,SAAdrpI,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,EAChBm1B,EAAA/wB,EAAOqF,EAAPrF,EAAAwI,EAAAxI,EAJF+wB,EAAA2U,EAAArgC,EAAAqgC,EAAAl9B,EAAAk9B,MAaA/H,EAAA58B,IAAA48B,EAAAy8H,SAUEz8H,EAAA2P,SAAc,SAAdvc,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,EAChBm1B,EAAA/wB,EAAOqF,EAAPrF,EAAAwI,EAAAxI,EAJF+wB,EAAA2U,EAAArgC,EAAAqgC,EAAAl9B,EAAAk9B,KAaA/H,EAAAn9B,IAAAm9B,EAAA2P,SAUE3P,EAAA08H,OAAQ,SAARtpI,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,EAChBm1B,EAAA/wB,EAAOqF,EAAPrF,EAAAwI,EAAAxI,EAJF+wB,EAAA2U,EAAArgC,EAAAqgC,EAAAl9B,EAAAk9B,KAaA/H,EAAAu8B,IAAAv8B,EAAA08H,OASE18H,EAAAokH,KAAQ,SAAYhxH,EAApB1rB,UACA0rB,EAAIn1B,EAAI+F,KAAKogJ,KAAK18I,EAAEzJ,GACpBm1B,EAAA/wB,EAAO2B,KAAPogJ,KAAA18I,EAAArF,GAJF+wB,EAAA2U,EAAA/jC,KAAAogJ,KAAA18I,EAAAqgC,MAgBE/H,EAAApK,MAAQ,SAAaxC,EAArB1rB,UACA0rB,EAAIn1B,EAAI+F,KAAK4xB,MAAMluB,EAAEzJ,GACrBm1B,EAAA/wB,EAAO2B,KAAP4xB,MAAAluB,EAAArF,GAJF+wB,EAAA2U,EAAA/jC,KAAA4xB,MAAAluB,EAAAqgC,MAiBE/H,EAAA/7B,IAAQ,SAAWmvB,EAAK1rB,EAAxBmD,UACAuoB,EAAIn1B,EAAI+F,KAAKC,IAAIyD,EAAEzJ,EAAG4M,EAAE5M,GACxBm1B,EAAA/wB,EAAO2B,KAAPC,IAAAyD,EAAArF,EAAAwI,EAAAxI,GAJF+wB,EAAA2U,EAAA/jC,KAAAC,IAAAyD,EAAAqgC,EAAAl9B,EAAAk9B,MAiBE/H,EAAA97B,IAAQ,SAAWkvB,EAAK1rB,EAAxBmD,UACAuoB,EAAIn1B,EAAI+F,KAAKE,IAAIwD,EAAEzJ,EAAG4M,EAAE5M,GACxBm1B,EAAA/wB,EAAO2B,KAAPE,IAAAwD,EAAArF,EAAAwI,EAAAxI,GAJF+wB,EAAA2U,EAAA/jC,KAAAE,IAAAwD,EAAAqgC,EAAAl9B,EAAAk9B,MAgBE/H,EAAA3uB,MAAQ,SAAa+hB,EAArB1rB,UACA0rB,EAAIn1B,EAAI+F,KAAKqN,MAAM3J,EAAEzJ,GACrBm1B,EAAA/wB,EAAO2B,KAAPqN,MAAA3J,EAAArF,GAJF+wB,EAAA2U,EAAA/jC,KAAAqN,MAAA3J,EAAAqgC,MAiBE/H,EAAAqJ,MAAQ,SAARjW,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EACduoB,EAAA/wB,EAAOqF,EAAPrF,EAAAwI,EAJFuoB,EAAA2U,EAAArgC,EAAAqgC,EAAAl9B,KAkBEm1B,EAAA28H,YAAe,SAAfvpI,EAAA1rB,EAAAmD,EAAAw+B,UACAjW,EAAIn1B,EAAIyJ,EAAEzJ,EAAK4M,EAAE5M,EAAIorC,EACrBjW,EAAA/wB,EAAOqF,EAAPrF,EAAAwI,EAAAxI,EAAAgnC,EAJFjW,EAAA2U,EAAArgC,EAAAqgC,EAAAl9B,EAAAk9B,EAAAsB,KAeErJ,EAAA3K,SACY,SADZ3tB,EAAAmD,GAAA,IAEE5M,EAAI4M,EAAE5M,EAAIyJ,EAAEzJ,EACdoE,EAAOwI,EAAAxI,EAAKqF,EAALrF,EAJT0lC,EAAAl9B,EAAAk9B,EAAArgC,EAAAqgC,iCAaA/H,EAAA0V,KAAA1V,EAAA3K,SAQE2K,EAAA48H,gBAAA,SAAAl1J,EAAAmD,GAAA,IAEI5M,EAAI4M,EAAE5M,EAAIyJ,EAAEzJ,EAChBoE,EAAOwI,EAAAxI,EAAAqF,EAAQrF,EAJjB0lC,EAAAl9B,EAAAk9B,EAAArgC,EAAAqgC,sBAaA/H,EAAA68H,QAAA78H,EAAA48H,gBAOE58H,EAAA7hC,OAAA,SAAAuJ,GAAA,IAEIzJ,EAAIyJ,EAAEzJ,EACVoE,EAAOqF,EAAArF,EAJT0lC,EAAArgC,EAAAqgC,iCAaA/H,EAAAtT,IAAAsT,EAAA7hC,OAOE6hC,EAAA88H,cAAA,SAAAp1J,GAAA,IAEIzJ,EAAIyJ,EAAEzJ,EACVoE,EAAOqF,EAAArF,EAJT0lC,EAAArgC,EAAAqgC,sBAaA/H,EAAA+8H,OAAA/8H,EAAA88H,cASE98H,EAAAg9H,OAAA,SAAA5pI,EAAA1rB,UACA0rB,EAAIn1B,GAAKyJ,EAAEzJ,EACXm1B,EAAA/wB,GAAOqF,EAAPrF,EAJF+wB,EAAA2U,GAAArgC,EAAAqgC,KAgBE/H,EAAAi9H,QAAQ,SAAR7pI,EAAA1rB,UACA0rB,EAAIn1B,EAAI,EAAMyJ,EAAEzJ,EAChBm1B,EAAA/wB,EAAO,EAAPqF,EAAArF,EAJF+wB,EAAA2U,EAAA,EAAArgC,EAAAqgC,KAeE/H,EAAAg8B,YAAA,SAAA5oC,EAAA1rB,GAAA,IAEIzJ,EAAIyJ,EAAEzJ,QAEN8pC,EAAArgC,EAAKqgC,SAAT/jC,KAEOuK,IAAAtQ,GAAA+8J,EACL5nI,EAAIn1B,EAAI,UAGV+F,KAEOuK,IAAAlM,GAAA24J,EACL5nI,EAAI/wB,EAAI,UAGV2B,KAEOuK,IAAAw5B,GAAAizH,EACL5nI,EAAI2U,EAAI,aAcV/H,EAAA7L,UAAA,SAAAf,EAAA1rB,GAAA,IAEIzJ,EAAIyJ,EAAEzJ,QAEN8pC,EAAArgC,EAAMqgC,EAERrb,EAAAzuB,EAAAA,EAAAoE,EAAAA,EAAA0lC,EAAAA,SACArb,EAAM,IAENA,EAAA,EAAQ1oB,KAARoI,KAAAsgB,GACA0G,EAAIn1B,EAAIA,EAAIyuB,EACb0G,EAAA/wB,EAAAA,EAAAqqB,EACD0G,EAAA2U,EAAAA,EAAArb,MAYDsT,EAFDyU,IAAA,SAAA/sC,EAAAmD,mCAaEm1B,EAAAuU,MAAqB,SAArBnhB,EAAA1rB,EAAAmD,GAAA,IAAwB8sC,EAAKjwC,EAAEzJ,EAC3B25C,EAAKlwC,EAAErF,EAAGw1C,EAAKnwC,EAAEqgC,EAAG+P,EAAKjtC,EAAE5M,QAE3B+5C,EAAIntC,EAAAk9B,SAER3U,EAAIn1B,EAAI25C,EAAKI,EAAKH,EAAKE,EACvB3kB,EAAA/wB,EAAOw1C,EAAPC,EAAAH,EAAAK,EAPF5kB,EAAA2U,EAAA4P,EAAAI,EAAAH,EAAAE,KAoBE9X,EAAApX,KACS,SADTwK,EAAA1rB,EAAAmD,EAAA9E,GAAA,IAEI4xC,EAAKjwC,EAAEzJ,EACP25C,EAAIlwC,EAAArF,EACJw1C,EAAInwC,EAAAqgC,SACR3U,EAAIn1B,EAAI05C,EAAK5xC,GAAK8E,EAAE5M,EAAI05C,GACxBvkB,EAAA/wB,EAAOu1C,EAAP7xC,GAAA8E,EAAAxI,EAAAu1C,GAPFxkB,EAAA2U,EAAA8P,EAAA9xC,GAAA8E,EAAAk9B,EAAA8P,MAsBE7X,EAAA09H,QACI,SAAUtqI,EAAA1rB,EAAgBmD,EAAIC,EAAJC,EAAhBhF,GADd,IAEI43J,EAAU53J,EAAAA,EACV63J,EAAUD,GAAgB,EAAI53J,EAHlC,GAAA,EAII83J,EAAUF,GAAgB53J,EAAI,GAApBA,YAEV+3J,EAAUH,GAAgB,EAAA,EAAtB53J,UAERqtB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI2/J,EAAU/yJ,EAAE5M,EAAI4/J,EAAU/yJ,EAAE7M,EAAI8/J,EAAUhzJ,EAAE9M,EAAI6/J,8BAE9D1qI,EAAA2U,EAAOrgC,EAAPqgC,EAAA61H,EAAA/yJ,EAAAk9B,EAAA81H,EAAA/yJ,EAAAi9B,EAAAg2H,EAAAhzJ,EAAAg9B,EAAA+1H,KAeA99H,EAAA9R,OACI,SAAAkF,EAAA1rB,EAAwBmD,EAAAC,EAAAC,EAAAhF,GAD5B,IAEIi4J,EAAe,EAFnBj4J,EAGIk4J,EAAUD,EAAwBA,EAClCL,EAAU53J,EAAQA,EAClB63J,EAAUK,EAAmBD,EAC7BH,EAAU,EAAA93J,EAAAk4J,UAEVH,EAAUH,EAAU53J,SAExBqtB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI2/J,EAAU/yJ,EAAE5M,EAAI4/J,EAAU/yJ,EAAE7M,EAAI8/J,EAAUhzJ,EAAE9M,EAAI6/J,8BAE9D1qI,EAAA2U,EAAOrgC,EAAPqgC,EAAA61H,EAAA/yJ,EAAAk9B,EAAA81H,EAAA/yJ,EAAAi9B,EAAAg2H,EAAAhzJ,EAAAg9B,EAAA+1H,4BAaAz0H,EAAQA,GAAA,EAER,IAAIxwB,EAAc,EAAdi1G,IAAmB9pH,KAAM8E,aAEzBo1J,EAASl6J,KAALoI,KAAc,EAAtB27B,EAAAA,GAAAsB,SAEAjW,EAAIn1B,EAAI+F,KAAI6E,IAAZgQ,GAAAqlJ,EACA9qI,EAAA/wB,EAAO2B,KAAPiF,IAAA4P,GAAAqlJ,EAVF9qI,EAAA2U,EAAAA,EAAAsB,KAuBErJ,EAAAwS,cAAA,SAAApf,EAAA1rB,EAAAuS,GAAA,IAAsBhc,EAAIyJ,EAAEzJ,EACxBoE,EAAIqF,EAAErF,EACN0lC,EAAArgC,EAAKqgC,EACLkK,EAAIh4B,EAACu0B,IAAAvwC,EAAAgc,EAAY20B,IAAAvsC,EAAZ4X,EAAwB+0B,IAAAjH,EAAxB9tB,EAAoCm1B,WAC7C6C,EAAIA,GAAK,EACT7e,EAAIn1B,GAAKgc,EAAEo0B,IAAMpwC,EAAIgc,EAAEw0B,IAAMpsC,EAAI4X,EAAE40B,IAAM9G,EAAI9tB,EAAEg1B,KAAOgD,EACtD7e,EAAA/wB,GAAO4X,EAAPq0B,IAAArwC,EAAAgc,EAAAy0B,IAAArsC,EAAA4X,EAAA60B,IAAA/G,EAAA9tB,EAAAi1B,KAAA+C,EAPF7e,EAAA2U,GAAA9tB,EAAAs0B,IAAAtwC,EAAAgc,EAAA00B,IAAAtsC,EAAA4X,EAAA80B,IAAAhH,EAAA9tB,EAAAk1B,KAAA8C,KAmBEjS,EAAA2S,cAAA,SAAAvf,EAAA1rB,EAAAuS,GAAA,IAAsBhc,EAAIyJ,EAAEzJ,EACxBoE,EAAIqF,EAAArF,EACJ0lC,EAAIrgC,EAAAqgC,SACR3U,EAAIn1B,EAAIA,EAAIgc,EAAEo0B,IAAMhsC,EAAI4X,EAAEu0B,IAAMzG,EAAI9tB,EAAE00B,IACtCvb,EAAA/wB,EAAOpE,EAAPgc,EAAAq0B,IAAAjsC,EAAA4X,EAAAw0B,IAAA1G,EAAA9tB,EAAA20B,IALFxb,EAAA2U,EAAA9pC,EAAAgc,EAAAs0B,IAAAlsC,EAAA4X,EAAAy0B,IAAA3G,EAAA9tB,EAAA40B,uCAmBE,IAAsB5wC,EAAIyJ,EAAEzJ,EACxBoE,EAAAqF,EAAKrF,EAAK0lC,EAAArgC,EAAKqgC,EAAKo2H,EAAK9uI,EAAEpxB,EAAGmgK,EAAK/uI,EAAEhtB,QAEzCg8J,EAAAhvI,EAAA4iB,EAGIwB,EAAK4qH,EAAKpgK,EAAImgK,EAAKr2H,EAAIu2H,EAAKj8J,EAC5BqxC,EAAK2qH,EAAAh8J,EAAAi8J,EAAUrgK,EAAVkgK,EAAmBp2H,gBAE5Bw2H,GAAAJ,EAAAlgK,EAAAmgK,EAAA/7J,EAAAi8J,EAAAv2H,SAGA3U,EAAIn1B,EAAIw1C,EAAK4qH,EAAKE,GAAMJ,EAAKzqH,GAAM4qH,EAAK3qH,GAAMyqH,EAC9ChrI,EAAA/wB,EAAOqxC,EAAP2qH,EAAAE,GAAAH,EAAAzqH,GAAAwqH,EAAA1qH,GAAA6qH,EAhBFlrI,EAAA2U,EAAA4L,EAAA0qH,EAAAE,GAAAD,EAAA7qH,GAAA2qH,EAAA1qH,GAAAyqH,KA4BEn+H,EAAAqR,QAAA,SAAAje,EAAA1rB,EAAAmD,EAAAC,GACA,IAAA3F,KACA0T,YAEA1T,EAAElH,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,cAEdkH,EAAA4iC,EAAArgC,EAAAqgC,EAAAl9B,EAAAk9B,EAGAlvB,EAAE5a,EAAIkH,EAAElH,sCAER4a,EAAAkvB,EAAA5iC,EAAA9C,EAAA2B,KAAAiF,IAAA6B,GAAA3F,EAAA4iC,EAAA/jC,KAAA6E,IAAAiC,GAGAsoB,EAAIn1B,EAAI4a,EAAE5a,EAAI4M,EAAE5M,cAEhBm1B,EAAA2U,EAAOlvB,EAAPkvB,EAAAl9B,EAAAk9B,KAYA/H,EAAAsR,QAAA,SAAAle,EAAA1rB,EAAAmD,EAAAC,GACA,IAAA3F,KACA0T,YAEA1T,EAAElH,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,cAEdkH,EAAA4iC,EAAArgC,EAAAqgC,EAAAl9B,EAAAk9B,EAGAlvB,EAAE5a,EAAIkH,EAAE4iC,EAAI/jC,KAAKiF,IAAI6B,GAAK3F,EAAElH,EAAI+F,KAAK6E,IAAIiC,WAEzC+N,EAAAkvB,EAAA5iC,EAAA4iC,EAAA/jC,KAAA6E,IAAAiC,GAAA3F,EAAAlH,EAAA+F,KAAAiF,IAAA6B,GAGAsoB,EAAIn1B,EAAI4a,EAAE5a,EAAI4M,EAAE5M,cAEhBm1B,EAAA2U,EAAOlvB,EAAPkvB,EAAAl9B,EAAAk9B,KAYA/H,EAAAuR,QAAA,SAAAne,EAAA1rB,EAAAmD,EAAAC,GACA,IAAA3F,KACA0T,YAEA1T,EAAElH,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,cAEdkH,EAAA4iC,EAAArgC,EAAAqgC,EAAAl9B,EAAAk9B,EAGAlvB,EAAE5a,EAAIkH,EAAElH,EAAR+F,KAAA6E,IAAAiC,GAAA3F,EAAA9C,EAAA2B,KAAAiF,IAAA6B,uCAEA+N,EAAAkvB,EAAA5iC,EAAA4iC,EAGA3U,EAAIn1B,EAAI4a,EAAE5a,EAAI4M,EAAE5M,cAEhBm1B,EAAA2U,EAAOlvB,EAAPkvB,EAAAl9B,EAAAk9B,0BAkBA,IAAAq1H,EAAOp9H,EAAAyL,SAEL,OAAK,SAAQ/jC,EAAAs+B,EAAAjN,EAAAuL,EAAAkR,EAAAy9G,GACX,IAAA/0J,EAAAgiB,EAeA,IAdD8lB,SAIAjN,SAKC7Y,EAHFokB,EAGMtgC,KAAEC,IAANqgC,EAAA0B,EAAAjN,EAAArxB,EAAAvJ,iBAKGD,EAAH66B,EAAa76B,EAAbgiB,EAAAhiB,GAAA8nC,EACAo3H,EAAAn/J,EAAOyJ,EAAAxJ,GAAOk/J,EAAE/6J,EAAFqF,EAAAxJ,EAAW,GAAOk/J,EAAEr1H,EAAFrgC,EAAAxJ,EAAW,GAC5Cs3C,EAAA4nH,EAAAA,EAAAnK,kCAvBL,OAAAvrJ,MAqCEs4B,EAAArrB,MAAI,4BAEJ6pJ,EAAOx+H,EAAUyL,SAEf,OAAK,SAAL/jC,EAAAmD,eAEAm1B,EAAK6S,KAAA2rH,EAAU3zJ,oBAGfm1B,EAAI7L,UAASqqI,EAASA,GAEtB,IAAIC,EAASz+H,EAAKyU,IAAAiqH,EAAAF,GAEjB,OAAAC,EAAA,IAIAA,GAAA,UAnBLz6J,KAAAwqB,KAAAiwI,IAEM,GA+BLz+H,EAFD4+G,IAAA,SAAAl3I,4CAaEs4B,EAAA/e,MAAW,SAAXmS,EAAAjG,UACAiG,EAAI,GAAKjG,EAAElvB,WAEXm1B,EAAA,GAAOjG,EAAP4a,KAYD/H,EAFDq9H,YAAA,SAAA31J,EAAAmD,2CAYEm1B,EAAA+0B,OAAA,SAAArtD,EAAAmD,GAAA,IAAwByyJ,EAAK51J,EAAEzJ,EAC3Bs/J,EAAK71J,EAAErF,EAAGs8J,EAAKj3J,EAAEqgC,EAAGy1H,EAAK3yJ,EAAE5M,EAC/BkI,EAAQ0E,EAAAxI,EAHV+D,EAAAyE,EAAAk9B,2KAUA,IAAI62H,EAAQ,IAAA5sJ,MAAS,GAEnB6sJ,EAAA,SAAA5gK,EAAAoE,EAAA0lC,EAAAkK,GACAtzC,KAAKV,EAAIA,EACTU,KAAK0D,EAAIA,EAJX1D,KAAAopC,EAAAA,YASE82H,EAAA59J,UAAYu7J,OAAZ,kBACAoC,EAAO,GAAKjgK,KAAKV,EACjB2gK,EAAO,GAAKjgK,KAAK0D,cAEjBu8J,EAAO,GAAAjgK,KAAPszC,KASF,IAAA6sH,GAOCrzH,OAFD,kCAeChH,IAFD,SAAAxmC,EAAAoE,EAAA0lC,EAAAkK,0BAYCjzC,MAFD,SAAA0I,kCAaEmrC,KAAU,SAAVzf,EAAA1rB,UACA0rB,EAAIn1B,EAAIyJ,EAAEzJ,EACVm1B,EAAI/wB,EAAIqF,EAAErF,EACV+wB,EAAA2U,EAAOrgC,EAAPqgC,EALF3U,EAAA6e,EAAAvqC,EAAAuqC,KAoBExnB,IAAA,SAAA2I,EAAAn1B,EAAAoE,EAAA0lC,EAAAkK,UACA7e,EAAIn1B,EAAIA,EACRm1B,EAAI/wB,EAAIA,EACR+wB,EAAA2U,EAAOA,EALT3U,EAAA6e,EAAAA,KAkBEzuC,IAAQ,SAAR4vB,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,EAChBm1B,EAAI/wB,EAAIqF,EAAErF,EAAIwI,EAAExI,EAChB+wB,EAAA2U,EAAOrgC,EAAPqgC,EAAAl9B,EAAAk9B,EALF3U,EAAA6e,EAAAvqC,EAAAuqC,EAAApnC,EAAAonC,KAkBEwqH,SAAc,SAAdrpI,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,EAChBm1B,EAAI/wB,EAAIqF,EAAErF,EAAIwI,EAAExI,EAChB+wB,EAAA2U,EAAOrgC,EAAPqgC,EAAAl9B,EAAAk9B,EALF3U,EAAA6e,EAAAvqC,EAAAuqC,EAAApnC,EAAAonC,MAcA6sH,EAAA17J,IAAA07J,EAAArC,SAUEqC,EAAAnvH,SAAc,SAAdvc,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,EAChBm1B,EAAI/wB,EAAIqF,EAAErF,EAAIwI,EAAExI,EAChB+wB,EAAA2U,EAAOrgC,EAAPqgC,EAAAl9B,EAAAk9B,EALF3U,EAAA6e,EAAAvqC,EAAAuqC,EAAApnC,EAAAonC,KAcA6sH,EAAAj8J,IAAAi8J,EAAAnvH,SAUEmvH,EAAApC,OAAQ,SAARtpI,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EAAE5M,EAChBm1B,EAAI/wB,EAAIqF,EAAErF,EAAIwI,EAAExI,EAChB+wB,EAAA2U,EAAOrgC,EAAPqgC,EAAAl9B,EAAAk9B,EALF3U,EAAA6e,EAAAvqC,EAAAuqC,EAAApnC,EAAAonC,KAcA6sH,EAAAviG,IAAAuiG,EAAApC,OASEoC,EAAA1a,KAAQ,SAAYhxH,EAApB1rB,UACA0rB,EAAIn1B,EAAI+F,KAAKogJ,KAAK18I,EAAEzJ,GACpBm1B,EAAI/wB,EAAI2B,KAAKogJ,KAAK18I,EAAErF,GACpB+wB,EAAA2U,EAAO/jC,KAAPogJ,KAAA18I,EAAAqgC,GALF3U,EAAA6e,EAAAjuC,KAAAogJ,KAAA18I,EAAAuqC,MAiBE6sH,EAAAlpI,MAAQ,SAAaxC,EAArB1rB,UACA0rB,EAAIn1B,EAAI+F,KAAK4xB,MAAMluB,EAAEzJ,GACrBm1B,EAAI/wB,EAAI2B,KAAK4xB,MAAMluB,EAAErF,GACrB+wB,EAAA2U,EAAO/jC,KAAP4xB,MAAAluB,EAAAqgC,GALF3U,EAAA6e,EAAAjuC,KAAA4xB,MAAAluB,EAAAuqC,MAkBE6sH,EAAA76J,IAAQ,SAAWmvB,EAAK1rB,EAAxBmD,UACAuoB,EAAIn1B,EAAI+F,KAAKC,IAAIyD,EAAEzJ,EAAG4M,EAAE5M,GACxBm1B,EAAI/wB,EAAI2B,KAAKC,IAAIyD,EAAErF,EAAGwI,EAAExI,GACxB+wB,EAAA2U,EAAO/jC,KAAPC,IAAAyD,EAAAqgC,EAAAl9B,EAAAk9B,GALF3U,EAAA6e,EAAAjuC,KAAAC,IAAAyD,EAAAuqC,EAAApnC,EAAAonC,MAkBE6sH,EAAA56J,IAAQ,SAAWkvB,EAAK1rB,EAAxBmD,UACAuoB,EAAIn1B,EAAI+F,KAAKE,IAAIwD,EAAEzJ,EAAG4M,EAAE5M,GACxBm1B,EAAI/wB,EAAI2B,KAAKE,IAAIwD,EAAErF,EAAGwI,EAAExI,GACxB+wB,EAAA2U,EAAO/jC,KAAPE,IAAAwD,EAAAqgC,EAAAl9B,EAAAk9B,GALF3U,EAAA6e,EAAAjuC,KAAAE,IAAAwD,EAAAuqC,EAAApnC,EAAAonC,MAiBE6sH,EAAAztJ,MAAQ,SAAa+hB,EAArB1rB,UACA0rB,EAAIn1B,EAAI+F,KAAKqN,MAAM3J,EAAEzJ,GACrBm1B,EAAI/wB,EAAI2B,KAAKqN,MAAM3J,EAAErF,GACrB+wB,EAAA2U,EAAO/jC,KAAPqN,MAAA3J,EAAAqgC,GALF3U,EAAA6e,EAAAjuC,KAAAqN,MAAA3J,EAAAuqC,MAkBE6sH,EAAAz1H,MAAQ,SAARjW,EAAA1rB,EAAAmD,UACAuoB,EAAIn1B,EAAIyJ,EAAEzJ,EAAI4M,EACduoB,EAAI/wB,EAAIqF,EAAErF,EAAIwI,EACduoB,EAAA2U,EAAOrgC,EAAPqgC,EAAAl9B,EALFuoB,EAAA6e,EAAAvqC,EAAAuqC,EAAApnC,KAmBEi0J,EAAAnC,YAAe,SAAfvpI,EAAA1rB,EAAAmD,EAAAw+B,UACAjW,EAAIn1B,EAAIyJ,EAAEzJ,EAAK4M,EAAE5M,EAAIorC,EACrBjW,EAAI/wB,EAAIqF,EAAErF,EAAKwI,EAAExI,EAAIgnC,EACrBjW,EAAA2U,EAAOrgC,EAAPqgC,EAAAl9B,EAAAk9B,EAAAsB,EALFjW,EAAA6e,EAAAvqC,EAAAuqC,EAAApnC,EAAAonC,EAAA5I,KAgBEy1H,EAAAzpI,SACY,SADZ3tB,EAAAmD,GAAA,IAEE5M,EAAI4M,EAAE5M,EAAIyJ,EAAEzJ,EACZoE,EAAIwI,EAAExI,EAAIqF,EAAErF,EACd0lC,EAAOl9B,EAAAk9B,EAAKrgC,EAALqgC,EALTkK,EAAApnC,EAAAonC,EAAAvqC,EAAAuqC,qCAcA6sH,EAAAppH,KAAAopH,EAAAzpI,SAQEypI,EAAAlC,gBAAA,SAAAl1J,EAAAmD,GAAA,IAEI5M,EAAI4M,EAAE5M,EAAIyJ,EAAEzJ,EACZoE,EAAIwI,EAAExI,EAAIqF,EAAErF,EAChB0lC,EAAOl9B,EAAAk9B,EAAArgC,EAAQqgC,EALjBkK,EAAApnC,EAAAonC,EAAAvqC,EAAAuqC,0BAcA6sH,EAAAjC,QAAAiC,EAAAlC,gBAOEkC,EAAA3gK,OAAA,SAAAuJ,GAAA,IAEIzJ,EAAIyJ,EAAEzJ,EACNoE,EAAIqF,EAAErF,EACV0lC,EAAOrgC,EAAAqgC,EALTkK,EAAAvqC,EAAAuqC,qCAcA6sH,EAAApyI,IAAAoyI,EAAA3gK,OAOE2gK,EAAAhC,cAAA,SAAAp1J,GAAA,IAEIzJ,EAAIyJ,EAAEzJ,EACNoE,EAAIqF,EAAErF,EACV0lC,EAAOrgC,EAAAqgC,EALTkK,EAAAvqC,EAAAuqC,0BAcA6sH,EAAA/B,OAAA+B,EAAAhC,cASEgC,EAAA9B,OAAA,SAAA5pI,EAAA1rB,UACA0rB,EAAIn1B,GAAKyJ,EAAEzJ,EACXm1B,EAAI/wB,GAAKqF,EAAErF,EACX+wB,EAAA2U,GAAOrgC,EAAPqgC,EALF3U,EAAA6e,GAAAvqC,EAAAuqC,KAiBE6sH,EAAA7B,QAAQ,SAAR7pI,EAAA1rB,UACA0rB,EAAIn1B,EAAI,EAAMyJ,EAAEzJ,EAChBm1B,EAAI/wB,EAAI,EAAMqF,EAAErF,EAChB+wB,EAAA2U,EAAO,EAAPrgC,EAAAqgC,EALF3U,EAAA6e,EAAA,EAAAvqC,EAAAuqC,KAgBE6sH,EAAA9iG,YAAA,SAAA5oC,EAAA1rB,GAAA,IAEIzJ,EAAIyJ,EAAEzJ,EACNoE,EAAIqF,EAAErF,QAEN4vC,EAAAvqC,EAAKuqC,SAATjuC,KAEOuK,IAAAtQ,GAAA+8J,EACL5nI,EAAIn1B,EAAI,UAGV+F,KAEOuK,IAAAlM,GAAA24J,EACL5nI,EAAI/wB,EAAI,UAGV2B,KAEOuK,IAAAw5B,GAAAizH,EACL5nI,EAAI2U,EAAI,UAGV/jC,KAEOuK,IAAA0jC,GAAA+oH,EACL5nI,EAAI6e,EAAI,aAcV6sH,EAAA3qI,UAAA,SAAAf,EAAA1rB,GAAA,IAEIzJ,EAAIyJ,EAAEzJ,EACNoE,EAAIqF,EAAErF,EACN0lC,EAAArgC,EAAMqgC,EACNkK,EAAAvqC,EAAMuqC,EACRvlB,EAAMzuB,EAAIA,EAAKoE,EAAKA,EAApB0lC,EAAAA,EAAAkK,EAAAA,SACAvlB,EAAQ,IACRA,EAAA,EAAQ1oB,KAARoI,KAAAsgB,GACA0G,EAAIn1B,EAAIA,EAAIyuB,EACZ0G,EAAI/wB,EAAIA,EAAIqqB,EACb0G,EAAA2U,EAAAA,EAAArb,EACD0G,EAAA6e,EAAAA,EAAAvlB,MAYDoyI,EAFDrqH,IAAA,SAAA/sC,EAAAmD,2CAcEi0J,EAAAl2I,KACS,SADTwK,EAAA1rB,EAAAmD,EAAA9E,GAAA,IAEI4xC,EAAKjwC,EAAEzJ,EACP25C,EAAKlwC,EAAErF,EACPw1C,EAAInwC,EAAAqgC,EACJg3H,EAAIr3J,EAAAuqC,SACR7e,EAAIn1B,EAAI05C,EAAK5xC,GAAK8E,EAAE5M,EAAI05C,GACxBvkB,EAAI/wB,EAAIu1C,EAAK7xC,GAAK8E,EAAExI,EAAIu1C,GACxBxkB,EAAA2U,EAAO8P,EAAP9xC,GAAA8E,EAAAk9B,EAAA8P,GATFzkB,EAAA6e,EAAA8sH,EAAAh5J,GAAA8E,EAAAonC,EAAA8sH,oCAsBE11H,EAAAA,GAAA,EAGAjW,EAAIn1B,EAAI6vH,IACR16F,EAAI/wB,EAAIyrH,IACR16F,EAAA2U,EAAK+lF,IACL16F,EAAA6e,EAAK67E,IACLgxC,EAAA3qI,UAAAf,EAAAA,GAVF0rI,EAAAz1H,MAAAjW,EAAAA,EAAAiW,MAsBEy1H,EAAAtsH,cAAA,SAAApf,EAAA1rB,EAAAuS,GAAA,IAAsBhc,EAAIyJ,EAAEzJ,EAAGoE,EAAIqF,EAAErF,EACjC0lC,EAAIrgC,EAAEqgC,EACNkK,EAAIvqC,EAAEuqC,SACV7e,EAAIn1B,EAAIgc,EAAEo0B,IAAMpwC,EAAIgc,EAAEw0B,IAAMpsC,EAAI4X,EAAE40B,IAAM9G,EAAI9tB,EAAEg1B,IAAMgD,EACpD7e,EAAI/wB,EAAI4X,EAAEq0B,IAAMrwC,EAAIgc,EAAEy0B,IAAMrsC,EAAI4X,EAAE60B,IAAM/G,EAAI9tB,EAAEi1B,IAAM+C,EACpD7e,EAAA2U,EAAO9tB,EAAPs0B,IAAAtwC,EAAAgc,EAAA00B,IAAAtsC,EAAA4X,EAAA80B,IAAAhH,EAAA9tB,EAAAk1B,IAAA8C,EANF7e,EAAA6e,EAAAh4B,EAAAu0B,IAAAvwC,EAAAgc,EAAA20B,IAAAvsC,EAAA4X,EAAA+0B,IAAAjH,EAAA9tB,EAAAm1B,IAAA6C,KAkBE6sH,EAAA/iG,cAAA,SAAA3oC,EAAA1rB,EAAA2nB,GAAA,IAAsBpxB,EAAIyJ,EAAEzJ,EACxBoE,EAAAqF,EAAKrF,EAAK0lC,EAAArgC,EAAKqgC,EAAKo2H,EAAK9uI,EAAEpxB,EAAGmgK,EAAK/uI,EAAEhtB,QAEzCg8J,EAAAhvI,EAAA4iB,EAGIwB,EAAK4qH,EAAKpgK,EAAImgK,EAAKr2H,EAAIu2H,EAAKj8J,EAC5BqxC,EAAK2qH,EAAAh8J,EAAAi8J,EAAUrgK,EAAVkgK,EAAmBp2H,gBAE5Bw2H,GAAAJ,EAAAlgK,EAAAmgK,EAAA/7J,EAAAi8J,EAAAv2H,SAGA3U,EAAIn1B,EAAIw1C,EAAK4qH,EAAKE,GAAMJ,EAAKzqH,GAAM4qH,EAAK3qH,GAAMyqH,EAC9ChrI,EAAI/wB,EAAIqxC,EAAR2qH,EAAAE,GAAAH,EAAAzqH,GAAAwqH,EAAA1qH,GAAA6qH,EACAlrI,EAAA2U,EAAO4L,EAAP0qH,EAAAE,GAAAD,EAAA7qH,GAAA2qH,EAAA1qH,GAAAyqH,EAfF/qI,EAAA6e,EAAAvqC,EAAAuqC,0BAiCE,IAAAmrH,EAAO0B,EAAArzH,SAEL,OAAK,SAAQ/jC,EAAAs+B,EAAAjN,EAAAuL,EAAAkR,EAAAy9G,GACX,IAAA/0J,EAAAgiB,EAeA,IAdD8lB,SAIAjN,SAKC7Y,EAHFokB,EAGMtgC,KAAEC,IAANqgC,EAAA0B,EAAAjN,EAAArxB,EAAAvJ,iBAKGD,EAAH66B,EAAa76B,EAAbgiB,EAAAhiB,GAAA8nC,EACAo3H,EAAAn/J,EAAOyJ,EAAAxJ,GAAOk/J,EAAE/6J,EAAFqF,EAAAxJ,EAAW,GAAOk/J,EAAEr1H,EAAFrgC,EAAAxJ,EAAW,GAAOk/J,EAAEnrH,EAAFvqC,EAAAxJ,EAAW,GAC9Ds3C,EAAA4nH,EAAAA,EAAAnK,6CAvBL,OAAAvrJ,MAqCCo3J,EAFDlgB,IAAA,SAAAl3I,qDAaEo3J,EAAA79I,MAAW,SAAXmS,EAAAjG,UACAiG,EAAI,GAAKjG,EAAElvB,EACXm1B,EAAI,GAAKjG,EAAE9qB,WAEX+wB,EAAA,GAAOjG,EAAP8kB,KAYD6sH,EAFDzB,YAAA,SAAA31J,EAAAmD,sDAYEi0J,EAAA/pG,OAAA,SAAArtD,EAAAmD,GAAA,IAAwByyJ,EAAK51J,EAAEzJ,EAAGs/J,EAAK71J,EAAErF,EACrCs8J,EAAKj3J,EAAEqgC,EAAG3Y,EAAK1nB,EAAEuqC,EAAGurH,EAAK3yJ,EAAE5M,EAAGkI,EAAK0E,EAAExI,EACzC+D,EAAQyE,EAAAk9B,EAHV1hC,EAAAwE,EAAAonC,iOAWA,IAAI+sH,EAAQ,IAAAhtJ,MAAS,GAEnBitJ,EAAA,SAAA5wH,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GACAlwC,KAAK0vC,IAAMA,EACX1vC,KAAK2vC,IAAMA,EACX3vC,KAAK4vC,IAAMA,EACX5vC,KAAK6vC,IAAMA,EACX7vC,KAAK8vC,IAAMA,EACX9vC,KAAK+vC,IAAMA,EACX/vC,KAAKgwC,IAAMA,EATbhwC,KAAAiwC,IAAAA,cAcEqwH,EAAAh+J,UAAYu7J,OAAZ,kBACAwC,EAAO,GAAKrgK,KAAK0vC,IACjB2wH,EAAO,GAAKrgK,KAAK2vC,IACjB0wH,EAAO,GAAKrgK,KAAK4vC,IACjBywH,EAAO,GAAKrgK,KAAK6vC,IACjBwwH,EAAO,GAAKrgK,KAAK8vC,IACjBuwH,EAAO,GAAKrgK,KAAK+vC,IACjBswH,EAAO,GAAKrgK,KAAKgwC,kBAEjBqwH,EAAO,GAAArgK,KAAPkwC,OAgCF,IAAA4C,GAWChG,OAND,4CA4BChH,IAND,SAAA4J,EAAAC,EAAAC,EAAAQ,EAAAC,EAAAC,EAAAiwH,EAAAC,EAAAC,oCAoBCpgK,MAND,SAAA0I,wEAiBEmrC,KAAU,SAAVzf,EAAA1rB,UACA0rB,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE4mC,IACZlb,EAAImb,IAAM7mC,EAAE6mC,IACZnb,EAAIob,IAAM9mC,EAAE8mC,IACZpb,EAAIqb,IAAM/mC,EAAE+mC,IACZrb,EAAIsb,IAAMhnC,EAAEgnC,IACZtb,EAAIub,IAAMjnC,EAAEinC,IACZvb,EAAAwb,IAAAlnC,EAAAknC,IAVFxb,EAAAyb,IAAAnnC,EAAAmnC,OA8BEpkB,IAAA,SAAA2I,EAAAib,EAAAC,EAAAC,EAAAQ,EAAAC,EAAAC,EAAAiwH,EAAAC,EAAAC,UACAhsI,EAAIib,IAAMA,EACVjb,EAAIkb,IAAMA,EACVlb,EAAImb,IAAMA,EACVnb,EAAIob,IAAMO,EACV3b,EAAIqb,IAAMO,EACV5b,EAAIsb,IAAMO,EACV7b,EAAIub,IAAMuwH,EACV9rI,EAAAwb,IAAAuwH,EAVF/rI,EAAAyb,IAAAuwH,KAqBE7gG,SAAA,SAAAnrC,UACAA,EAAIib,IAAM,EACVjb,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAM,EACVtb,EAAIub,IAAM,EACVvb,EAAAwb,IAAA,EAVFxb,EAAAyb,IAAA,KAsBEwwH,UAAe,SAAAjsI,EAAA1rB,GACb,GAAA0rB,IAAuB1rB,EAAE,CAAzB,IAA8B43J,EAAM53J,EAAE4mC,IAClCixH,EAAM73J,EAAE6mC,IACRixH,EAAM93J,EAAEgnC,IACZtb,EAAIkb,IAAM5mC,EAAA8mC,IACVpb,EAAImb,IAAM7mC,EAAEinC,IACZvb,EAAIob,IAAM8wH,EACVlsI,EAAIsb,IAAMhnC,EAAAknC,IAPZxb,EAAAub,IAQO4wH,EACLnsI,EAAIwb,IAAM4wH,OAEVpsI,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE8mC,IACZpb,EAAImb,IAAM7mC,EAAEinC,IACZvb,EAAIob,IAAM9mC,EAAE4mC,IACZlb,EAAIqb,IAAM/mC,EAAE+mC,IACZrb,EAAIsb,IAAMhnC,EAAEknC,IACZxb,EAAIub,IAAMjnC,EAAE6mC,IACbnb,EAAAwb,IAAAlnC,EAAAgnC,0BAaDkI,OAAyB,SAAzBxjB,EAAA1rB,GAAA,IAA8B+3J,EAAM/3J,EAAE2mC,IAClCixH,EAAM53J,EAAE4mC,IAAKixH,EAAM73J,EAAE6mC,IAAKmxH,EAAMh4J,EAAE8mC,IAClCmxH,EAAMj4J,EAAE+mC,IAAK+wH,EAAM93J,EAAEgnC,IAAKkxH,EAAMl4J,EAAEinC,YAElCkxH,EAAMn4J,EAAAmnC,IAENixH,EAAMD,EAAMF,EAAMH,EAAMO,aAE5BC,EAAAD,EAAAL,EAAAC,EAAAC,EAGIprH,EAAMirH,EAAAK,EAAAR,EAAAW,EAAAV,EAAAS,EAET,OAAAxrH,GAGDA,EAAI,EAAMA,EAEVphB,EAAIib,IAAMyxH,EAACtrH,EACXphB,EAAIkb,MAAMuxH,EAAMP,EAAhBC,EAAAQ,GAAAvrH,EACAphB,EAAImb,KAAOixH,EAAMF,EAAMC,EAAMI,GAAOnrH,EACpCphB,EAAIob,IAAMyxH,EAACzrH,EACXphB,EAAIqb,KAAMoxH,EAAMJ,EAAhBF,EAAAK,GAAAprH,EACAphB,EAAIsb,MAAQ8wH,EAAMC,EAAMF,EAAMG,GAAOlrH,EACrCphB,EAAIub,IAAMqxH,EAACxrH,EACXphB,EAAAwb,MAAAmxH,EAAAN,EAAAH,EAAAM,GAAAprH,EA1BFphB,EAAAyb,KAAA8wH,EAAAF,EAAAH,EAAAI,GAAAlrH,KAeQ,MAsBN0rH,QAAyB,SAAzB9sI,EAAA1rB,GAAA,IAA8B+3J,EAAM/3J,EAAE2mC,IAClCixH,EAAM53J,EAAE4mC,IAAKixH,EAAM73J,EAAE6mC,IAAKmxH,EAAMh4J,EAAE8mC,IAClCmxH,EAAMj4J,EAAE+mC,IAAK+wH,EAAM93J,EAAEgnC,IAAKkxH,EAAMl4J,EAAEinC,YAElCkxH,EAAOn4J,EAAAmnC,WAEXzb,EAAIib,IAAOsxH,EAAME,EAAML,EAAMO,EAC7B3sI,EAAIkb,IAAOixH,EAAMQ,EAAMT,EAAMO,EAC7BzsI,EAAImb,IAAO+wH,EAAME,EAAMD,EAAMI,EAC7BvsI,EAAIob,IAAOgxH,EAAMI,EAAMF,EAAMG,EAC7BzsI,EAAIqb,IAAOgxH,EAAMI,EAAMN,EAAMK,EAC7BxsI,EAAIsb,IAAO6wH,EAAMG,EAAMD,EAAMD,EAC7BpsI,EAAIub,IAAO+wH,EAAMK,EAAMJ,EAAMC,EAC7BxsI,EAAAwb,IAAA0wH,EAAAM,EAAAH,EAAAM,EAdF3sI,EAAAyb,IAAA4wH,EAAAE,EAAAL,EAAAI,KAwBES,YAAA,SAAAz4J,GAAA,IAA8B+3J,EAAM/3J,EAAE2mC,IAClCixH,EAAM53J,EAAE4mC,IAAKixH,EAAM73J,EAAE6mC,IAAKmxH,EAAMh4J,EAAE8mC,IAClCmxH,EAAMj4J,EAAE+mC,IAAK+wH,EAAM93J,EAAEgnC,IAAKkxH,EAAMl4J,EAAEinC,YAEtCkxH,EAAOn4J,EAAAmnC,iDAYPc,SAAyB,SAAzBvc,EAAA1rB,EAAAmD,GAAA,IAA8B40J,EAAM/3J,EAAE2mC,IAClCixH,EAAM53J,EAAE4mC,IAAKixH,EAAM73J,EAAE6mC,IAAKmxH,EAAMh4J,EAAE8mC,IAClCmxH,EAAMj4J,EAAE+mC,IAAK+wH,EAAM93J,EAAEgnC,IAAKkxH,EAAMl4J,EAAEinC,YAElCkxH,EAAMn4J,EAAEmnC,IAAkBuxH,EAAMv1J,EAAEwjC,IAClCyxH,EAAMj1J,EAAEyjC,IAAK+xH,EAAMx1J,EAAE0jC,IAAK+xH,EAAMz1J,EAAE2jC,IAClCyxH,EAAMp1J,EAAE4jC,IAAK8xH,EAAM11J,EAAE6jC,IAAK8xH,EAAM31J,EAAE8jC,YAElC8xH,EAAM51J,EAAAgkC,WAEVzb,EAAIib,IAAM+xH,EAAMX,EAAMK,EAAMJ,EAAMW,EAAMT,oBAExCxsI,EAAImb,IAAM6xH,EAAMb,EAAMO,EAAMN,EAAMa,EAAMR,EAExCzsI,EAAIob,IAAM8xH,EAAMb,EAAMQ,EAAMP,EAAMa,EAAMX,oBAExCxsI,EAAIsb,IAAM4xH,EAAMf,EAAMU,EAAMT,EAAMe,EAAMV,EAExCzsI,EAAIub,IAAM6xH,EAAMf,EAAMO,EAAMN,EAAMe,EAAMb,EACxCxsI,EAAAwb,IAAA4xH,EAAAlB,EAAAU,EAAAL,EAAAc,EAAAV,EApBF3sI,EAAAyb,IAAA2xH,EAAAjB,EAAAS,EAAAR,EAAAiB,EAAAZ,MA6BApuH,EAAA5uC,IAAA4uC,EAAA9B,SASE8B,EAAAgtB,UAAA,SAAArrC,EAAA1rB,EAAAylB,GAAA,IAA8BsyI,EAAM/3J,EAAE2mC,IAClCixH,EAAM53J,EAAE4mC,IAAKixH,EAAM73J,EAAE6mC,IAAKmxH,EAAMh4J,EAAE8mC,IAClCmxH,EAAMj4J,EAAE+mC,IAAK+wH,EAAM93J,EAAEgnC,IAAKkxH,EAAMl4J,EAAEinC,IAClCoxH,EAAMr4J,EAAVknC,IAAaixH,EAAMn4J,EAAnBmnC,UAEIxsC,EAAJ8qB,EAAU9qB,SAEV+wB,EAAIib,IAAMoxH,UAEVrsI,EAAImb,IAAMgxH,EAEVnsI,EAAIob,IAAMkxH,UAEVtsI,EAAIsb,IAAM8wH,EAEVpsI,EAAIub,IAAM1wC,EAAIwhK,EAAMp9J,EAAIq9J,EAAME,EAC9BxsI,EAAAwb,IAAA3wC,EAAAqhK,EAAAj9J,EAAAs9J,EAAAI,EAjBF3sI,EAAAyb,IAAA5wC,EAAAshK,EAAAl9J,EAAAm9J,EAAAK,KA6BEpuH,EAAAivH,OAAyB,SAAzBttI,EAAA1rB,EAAAi5J,GAAA,IAA8BlB,EAAM/3J,EAAE2mC,IAClCixH,EAAM53J,EAAE4mC,IAAKixH,EAAM73J,EAAE6mC,IAAKmxH,EAAMh4J,EAAE8mC,IAClCmxH,EAAMj4J,EAAE+mC,IAAK+wH,EAAM93J,EAAEgnC,IAAKkxH,EAAMl4J,EAAEinC,YAElCkxH,EAAIn4J,EAAAmnC,kBAGJ/jC,EAAJ9G,KAAU6E,IAAA83J,UAEVvtI,EAAIib,IAAMvjC,EAAI20J,EAAMv5J,EAAIw5J,gBAExBtsI,EAAImb,IAAMzjC,EAAIy0J,EAAMr5J,EAAIs5J,EAExBpsI,EAAIob,IAAM1jC,EAAI40J,EAAMx5J,EAAIu5J,gBAExBrsI,EAAIsb,IAAM5jC,EAAV00J,EAAAt5J,EAAAq5J,EAEAnsI,EAAIub,IAAMixH,EACVxsI,EAAAwb,IAAAmxH,EAnBF3sI,EAAAyb,IAAAgxH,KA+BEpuH,EAAApI,MAAA,SAAAjW,EAAA1rB,EAAAylB,aAEI9qB,EAAJ8qB,EAAU9qB,SAEV+wB,EAAIib,IAAMpwC,EAAIyJ,EAAE2mC,kBAEhBjb,EAAImb,IAAMtwC,EAAIyJ,EAAE6mC,IAEhBnb,EAAIob,IAAMnsC,EAAIqF,EAAE8mC,kBAEhBpb,EAAIsb,IAAMrsC,EAAEqF,EAAZgnC,IAEAtb,EAAIub,IAAMjnC,EAAEinC,IACZvb,EAAAwb,IAAAlnC,EAAAknC,IAdFxb,EAAAyb,IAAAnnC,EAAAmnC,OA0BE4C,EAAAitB,SAAY,SAAZtrC,EAAA1rB,UACA0rB,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE4mC,IACZlb,EAAImb,IAAM7mC,EAAE6mC,IACZnb,EAAIob,IAAM9mC,EAAE+mC,IACZrb,EAAIqb,IAAM/mC,EAAEgnC,IACZtb,EAAIsb,IAAMhnC,EAAEinC,IACZvb,EAAIub,IAAMjnC,EAAEmnC,IACZzb,EAAAwb,IAAAlnC,EAAAonC,IAVF1b,EAAAyb,IAAAnnC,EAAAqnC,OA0BE0C,EAAAmvH,gBAAA,SAAAxtI,EAAAjG,UACAiG,EAAIib,IAAM,EACVjb,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAM,EACVtb,EAAIub,IAAMxhB,EAAVlvB,EACAm1B,EAAAwb,IAAAzhB,EAAA9qB,EAVF+wB,EAAAyb,IAAA,KAyBE4C,EAAAovH,aAAoC,SAApCztI,EAAAutI,qBAEI71J,EAAJ9G,KAAA6E,IAAA83J,UAEAvtI,EAAIib,IAAMvjC,UAEVsoB,EAAImb,IAAM,EAEVnb,EAAIob,KAAJtoC,UAEAktB,EAAIsb,IAAM,EAEVtb,EAAIub,IAAM,EACVvb,EAAAwb,IAAA,EAdFxb,EAAAyb,IAAA,KA8BE4C,EAAAqvH,YAAA,SAAA1tI,EAAAjG,UACAiG,EAAIib,IAAMlhB,EAAVlvB,UAEAm1B,EAAImb,IAAM,EAEVnb,EAAIob,IAAM,YAEVpb,EAAIsb,IAAM,EAEVtb,EAAIub,IAAM,EACVvb,EAAAwb,IAAA,EAZFxb,EAAAyb,IAAA,KAwBE4C,EAAAsvH,UAAA,SAAA3tI,EAAA1rB,UACA0rB,EAAIib,IAAM3mC,EAAV2mC,gBAEAjb,EAAImb,IAAM,EAEVnb,EAAIob,IAAM9mC,EAAV6mC,gBAEAnb,EAAIsb,IAAM,EAEVtb,EAAIub,IAAMjnC,EAAV+mC,IACArb,EAAAwb,IAAAlnC,EAAAgnC,IAZFtb,EAAAyb,IAAA,KAwBE4C,EAAAuvH,SAAA,SAAA5tI,EAAA/D,GAAA,IAAsBpxB,EAAIoxB,EAAEpxB,EAAGoE,EAAIgtB,EAAEhtB,EACjC0lC,EAAA1Y,EAAK0Y,EACLkK,EAAA5iB,EAAK4iB,EACLt5B,EAAK1a,EAAIA,QAETgjK,EAAKl5H,EAAIA,EAETm5H,EAAKjjK,EAAI0a,EACTwoJ,EAAK9+J,EAAIsW,EACTyoJ,EAAK/+J,EAAIuW,EACTyoJ,EAAKt5H,EAAIpvB,EACT2oJ,EAAKv5H,EAAInvB,EACT2oJ,EAAKx5H,EAAIk5H,EACTt0B,EAAK16F,EAAIt5B,QAET6oJ,EAAJvvH,EAAUgvH,SAEV7tI,EAAIib,IAAM,EAAA+yH,EAAVG,YAEAnuI,EAAIub,IAAM0yH,EAAKI,EAEfruI,EAAIkb,IAAM6yH,EAAKK,cAEfpuI,EAAIwb,IAAM0yH,EAAK30B,EAEfv5G,EAAImb,IAAM8yH,EAAII,YAEdruI,EAAAyb,IAAA,EAAAqyH,EAAAE,KAcA3vH,EAAAorB,WAAa,WACb,IAAI6kG,EAAS1hI,EAAbyE,IAAA,EAAA,EAAA,gBAEApiC,EAAO29B,EAAAyL,SAEH,OAAA,SAAArY,EAAAguB,EAAAwb,GACA,OAAA58B,EAAO+8H,OAAP37G,GAAA45G,EAAAA,GACDvpH,EAAA8sB,SAAAnrC,cAKD4M,EAAIuU,MAAKt2C,EAAA2+D,EAALxb,GAEFphB,EAAO+8H,OAAP9+J,GAAA+8J,EAAAA,GACDvpH,EAAA8sB,SAAAnrC,sBASDqe,EAAAhnB,IAAO2I,EAAPn1B,EAAAA,EAAAA,EAAAoE,EAAApE,EAAA8pC,EAAA1lC,EAAApE,EAAAoE,EAAAA,EAAAA,EAAA0lC,EAAAqZ,EAAAnjD,EAAAmjD,EAAA/+C,EAAA++C,EAAArZ,GA1BJ3U,KAEe,GAqCbqe,EAAAkwH,eAAA,SAAAvuI,EAAA1rB,GAAA,IAA8B+3J,EAAM/3J,EAAE2mC,IAAKixH,EAAM53J,EAAE4mC,IAC/CixH,EAAM73J,EAAE6mC,IAAKqzH,EAAMl6J,EAAE8mC,IAAKkxH,EAAMh4J,EAAE+mC,IAAKkxH,EAAMj4J,EAAEgnC,IAC/C8wH,EAAM93J,EAAEinC,IAAKkzH,EAAMn6J,EAAEknC,IAAKgxH,EAAMl4J,EAAEmnC,IAAKkxH,EAAMr4J,EAAEonC,IAC/C+wH,EAAMn4J,EAAEqnC,IAAK+yH,EAAMp6J,EAAEsnC,IAAK+yH,EAAMr6J,EAAEunC,IAAK+yH,EAAMt6J,EAAEwnC,YAE/C+yH,EAAMv6J,EAAA0nC,IAENgxH,EAAMX,EAAME,EAAML,EAAMI,EACxBI,EAAML,EAAMD,EAAMD,EAAMG,EACxBW,EAAMZ,EAAMoC,EAAMD,EAAMlC,EACxBwC,EAAM5C,EAAME,EAAMD,EAAMI,EACxBwC,EAAM7C,EAAMuC,EAAMD,EAAMjC,EACxByC,EAAM7C,EAAMsC,EAAMD,EAAMpC,EACxB6C,EAAMzC,EAAMoC,EAAMjC,EAAMgC,EACxBO,EAAM1C,EAAM2C,EAAM1C,EAAMkC,EACxBS,EAAM5C,EAAMqC,EAAMH,EAAMC,EACxBU,EAAM1C,EAAMwC,EAAM1C,EAAMmC,YAE5B/B,EAAAJ,EAAAoC,EAAAH,EAAAS,EAGI/tH,EAAM4rH,EAAAH,EAAAH,EAAAQ,EAAAD,EAAAoC,EAAAP,EAAAM,EAAAL,EAAAG,EAAAF,EAAAC,EAET,OAAA7tH,GAGDA,EAAI,EAAOA,EAEXphB,EAAIib,KAAOsxH,EAAMM,EAAMT,EAAMc,EAAMuB,EAAMY,GAAOjuH,wBAEhDphB,EAAImb,KAAOmxH,EAAMY,EAAMX,EAAM6C,EAAMX,EAAMQ,GAAO7tH,EAEhDphB,EAAIob,KAAO+wH,EAAMe,EAAMhB,EAAMW,EAAM2B,EAAMa,GAAOjuH,wBAEhDphB,EAAIsb,KAAO4wH,EAAMkD,EAAM/C,EAAMa,EAAMsB,EAAMS,GAAO7tH,EAEhDphB,EAAIub,KAAOqzH,EAAMI,EAAMG,EAAMJ,EAAMF,EAAMC,GAAO1tH,wBAEhDphB,EAAAyb,KAAAkzH,EAAAI,EAAAH,EAAA3B,EAAA4B,EAAA7B,GAAA5rH,KAdM,MAyBP/C,EAFDmtG,IAAA,SAAAl3I,oHAaE+pC,EAAAxwB,MAAW,SAAXmS,EAAAnZ,UACAmZ,EAAI,GAAKnZ,EAAEo0B,IACXjb,EAAI,GAAKnZ,EAAEq0B,IACXlb,EAAI,GAAKnZ,EAAEs0B,IACXnb,EAAI,GAAKnZ,EAAEu0B,IACXpb,EAAI,GAAKnZ,EAAEw0B,IACXrb,EAAI,GAAKnZ,EAAEy0B,IACXtb,EAAI,GAAKnZ,EAAE00B,eAEXvb,EAAA,GAAOnZ,EAAP40B,OAWD4C,EAFDixH,KAAA,SAAAh7J,wLAcE+pC,EAAAjuC,IAAA,SAAkB4vB,EAAlB1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAAEwjC,IACpBjb,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAAEyjC,IACpBlb,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAAE0jC,IACpBnb,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAAE2jC,IACpBpb,EAAIqb,IAAM/mC,EAAE+mC,IAAM5jC,EAAE4jC,IACpBrb,EAAIsb,IAAMhnC,EAAEgnC,IAAM7jC,EAAE6jC,IACpBtb,EAAIub,IAAMjnC,EAAEinC,IAAM9jC,EAAE8jC,IACpBvb,EAAAwb,IAAAlnC,EAAAknC,IAAA/jC,EAAA+jC,IAVFxb,EAAAyb,IAAAnnC,EAAAmnC,IAAAhkC,EAAAgkC,OAuBE4C,EAAAgrH,SAAY,SAAZrpI,EAAA1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAAEwjC,IACpBjb,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAAEyjC,IACpBlb,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAAE0jC,IACpBnb,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAAE2jC,IACpBpb,EAAIqb,IAAM/mC,EAAE+mC,IAAM5jC,EAAE4jC,IACpBrb,EAAIsb,IAAMhnC,EAAEgnC,IAAM7jC,EAAE6jC,IACpBtb,EAAIub,IAAMjnC,EAAEinC,IAAM9jC,EAAE8jC,IACpBvb,EAAAwb,IAAAlnC,EAAAknC,IAAA/jC,EAAA+jC,IAVFxb,EAAAyb,IAAAnnC,EAAAmnC,IAAAhkC,EAAAgkC,OAmBA4C,EAAAruC,IAAAquC,EAAAgrH,SAUEhrH,EAAAkxH,eAAA,SAAAvvI,EAAA1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAClBuoB,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAClBuoB,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAClBuoB,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAClBuoB,EAAIqb,IAAM/mC,EAAE+mC,IAAM5jC,EAClBuoB,EAAIsb,IAAMhnC,EAAEgnC,IAAM7jC,EAClBuoB,EAAIub,IAAMjnC,EAAEinC,IAAM9jC,EAClBuoB,EAAAwb,IAAAlnC,EAAAknC,IAAA/jC,EAVFuoB,EAAAyb,IAAAnnC,EAAAmnC,IAAAhkC,KAwBE4mC,EAAAmxH,qBAA2B,SAA3BxvI,EAAA1rB,EAAAmD,EAAAw+B,UACAjW,EAAIib,IAAM3mC,EAAE2mC,IAAOxjC,EAAEwjC,IAAMhF,EAC3BjW,EAAIkb,IAAM5mC,EAAE4mC,IAAOzjC,EAAEyjC,IAAMjF,EAC3BjW,EAAImb,IAAM7mC,EAAE6mC,IAAO1jC,EAAE0jC,IAAMlF,EAC3BjW,EAAIob,IAAM9mC,EAAE8mC,IAAO3jC,EAAE2jC,IAAMnF,EAC3BjW,EAAIqb,IAAM/mC,EAAE+mC,IAAO5jC,EAAE4jC,IAAMpF,EAC3BjW,EAAIsb,IAAMhnC,EAAEgnC,IAAO7jC,EAAE6jC,IAAMrF,EAC3BjW,EAAIub,IAAMjnC,EAAEinC,IAAO9jC,EAAE8jC,IAAMtF,EAC3BjW,EAAAwb,IAAAlnC,EAAAknC,IAAA/jC,EAAA+jC,IAAAvF,EAVFjW,EAAAyb,IAAAnnC,EAAAmnC,IAAAhkC,EAAAgkC,IAAAxF,KAwBCoI,EAJD4rH,YAAA,SAAA31J,EAAAmD,iJAcE4mC,EAAAsjB,OAAuB,SAAvBrtD,EAAAmD,GAAA,IAA4ByyJ,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAAKqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IAAKq0H,EAAKn7J,EAAE+mC,IAAKq0H,EAAKp7J,EAAEgnC,IAAKq0H,EAAKr7J,EAAEinC,IACvGq0H,EAAKt7J,EAAEknC,IAAKq0H,EAAKv7J,EAAEmnC,IAAK2uH,EAAK3yJ,EAAEwjC,IAAKloC,EAAK0E,EAAEyjC,IAAKloC,EAAKyE,EAAE0jC,IAAKloC,EAAKwE,EAAE2jC,IAAKloC,EAAKuE,EAAE4jC,IAAKy0H,EAAKr4J,EAAE6jC,IAAKy0H,EAAKt4J,EAAE8jC,IAC3Gy0H,EACEv4J,EAAA+jC,IAJJy0H,EAAAx4J,EAAAgkC,ifAkBA,IAAIy0H,EAAQ,IAAAtxJ,MAAS,GAEnB++B,EAAA,SAAA9yC,EAAAoE,EAAA0lC,EAAAkK,GACAtzC,KAAKV,EAAIA,EACTU,KAAK0D,EAAIA,EAJX1D,KAAAopC,EAAAA,YASEgJ,EAAA9vC,UAAYu7J,OAAZ,kBACA8G,EAAO,GAAK3kK,KAAKV,EACjBqlK,EAAO,GAAK3kK,KAAK0D,cAEjBihK,EAAO,GAAA3kK,KAAPszC,KASF,IAAA/I,GAOCuC,OAFD,kCAgBChH,IAFD,SAAAxmC,EAAAoE,EAAA0lC,EAAAkK,0BAaCjzC,MAFD,SAAA0I,mCAcAwhC,EAAA2J,KAAAisH,EAAAjsH,KAaA3J,EAAAze,IAAAq0I,EAAAr0I,IAQEye,EAAAq1B,SAAA,SAAAnrC,UACAA,EAAIn1B,EAAI,EACRm1B,EAAI/wB,EAAI,EACR+wB,EAAA2U,EAAO,EALT3U,EAAA6e,EAAA,KAqBE/I,EAAAq6H,WAAgB,WAChB,IAAIC,EAAAxjI,EAAYyL,wBAEhBg4H,EAAOzjI,EAAAyE,IAAkB,EAAG,EAAA,GAE1B,OAAI,SAAOrR,EAAX1rB,EAAqBmD,GACnB,IAAA4pC,EAAKzU,EAAMyU,IAAA/sC,EAASmD,GACpB,OAAA4pC,GAAS,SACPzU,EAAAuU,MAAKivH,EAALE,EAAAh8J,GACDs4B,EAAA7hC,OAAAqlK,GAAA,MACDxjI,EAAKuU,MAAAivH,EAALC,EAAA/7J,GAEAs4B,EAAA7L,UAAAqvI,EAAAA,GAPFt6H,EAQOy6H,cAAUvwI,EAAVowI,EAAoBx/J,KAAA8E,IACzBsqB,GACAqhB,EAAA,SACArhB,EAAIn1B,EAAI,EACRm1B,EAAI/wB,EAAI,EACR+wB,EAAA2U,EAAO,EALF3U,EAAA6e,EAMA,EACA7e,IAEL4M,EAAAuU,MAAQivH,EAAR97J,EAAAmD,GACAuoB,EAAIn1B,EAAIulK,EAAQvlK,EAChBm1B,EAAI/wB,EAAImhK,EAARnhK,EACA+wB,EAAA2U,EAAOy7H,EAAKz7H,EACb3U,EAAA6e,EAAA,EAAAwC,EAvBHvL,EAAA/U,UAAAf,EAAAA,KAHgB,GA6ChB8V,EAAA06H,aAAiB,SAAjBC,EAAAx0I,GACA,IAAIsxI,EAAU,EAAL38J,KAAKwqB,KAAAa,EAAA4iB,GACZ/rC,EAAAlC,KAAAiF,IAAe03J,EAAf,UACA,GAAAz6J,GACA29J,EAAS5lK,EAAIoxB,EAAEpxB,EAAIiI,EAHrB29J,EAIOxhK,EAAAgtB,EAAAhtB,EAAA6D,EACL29J,EAAA97H,EAAA1Y,EAAA0Y,EAAA7hC,IAGA29J,EAAS5lK,EAAI,EACd4lK,EAAAxhK,EAAA,EACDwhK,EAAA97H,EAAA,MAYAmB,EAAAyG,SAAA,SAAAvc,EAAA1rB,EAAAmD,GAAA,IAAwB8sC,EAAKjwC,EAAEzJ,EAAG25C,EAAKlwC,EAAErF,EACrCw1C,EAAKnwC,EAAEqgC,EAAGg3H,EAAKr3J,EAAEuqC,EAAG6F,EAAKjtC,EAAE5M,EAAG85C,EAAKltC,EAAExI,QAErCyhK,EAAIj5J,EAAAonC,SAER7e,EAAIn1B,EAAI05C,EAAKmsH,EAAK/E,EAAKjnH,EAAKF,EAAKI,EAAKH,EAAKE,EAC3C3kB,EAAI/wB,EAAIu1C,EAAKksH,EAAK/E,EAAKhnH,EAAKF,EAAKC,EAAKH,EAAKK,EAC3C5kB,EAAA2U,EAAO8P,EAAPisH,EAAA/E,EAAA/mH,EAAAL,EAAAI,EAAAH,EAAAE,EARF1kB,EAAA6e,EAAA8sH,EAAA+E,EAAAnsH,EAAAG,EAAAF,EAAAG,EAAAF,EAAAG,KAiBA9O,EAAArmC,IAAAqmC,EAAAyG,SAWAzG,EAAAG,MAAAy1H,EAAAz1H,gCAWEs3H,GAAI,GAAJ,IAAwBhpH,EAAKjwC,EAAEzJ,EAAG25C,EAAKlwC,EAAErF,EACrCw1C,EAAKnwC,EAAAqgC,EAAeg3H,EAAKr3J,EAAAuqC,gBAEzB6xH,EAAI9/J,KAAK6E,IAAK83J,UAElBvtI,EAAIn1B,EAAI05C,EAAKmsH,EAAK/E,EAAKjnH,EACvB1kB,EAAI/wB,EAAIu1C,EAAKksH,EAAKjsH,EAAKC,EACvB1kB,EAAA2U,EAAO8P,EAAPisH,EAAAlsH,EAAAE,EAVF1kB,EAAA6e,EAAA8sH,EAAA+E,EAAAnsH,EAAAG,+BAwBE6oH,GAAI,GAAJ,IAAwBhpH,EAAKjwC,EAAEzJ,EAAG25C,EAAKlwC,EAAErF,EACrCw1C,EAAKnwC,EAAAqgC,EAAeg3H,EAAKr3J,EAAAuqC,gBAEzB6xH,EAAI9/J,KAAK6E,IAAK83J,UAElBvtI,EAAIn1B,EAAI05C,EAAKmsH,EAAKjsH,EAAKE,EACvB3kB,EAAI/wB,EAAIu1C,EAAKksH,EAAK/E,EAAKhnH,EACvB3kB,EAAA2U,EAAO8P,EAAPisH,EAAAnsH,EAAAI,EAVF3kB,EAAA6e,EAAA8sH,EAAA+E,EAAAlsH,EAAAG,+BAwBE4oH,GAAI,GAAJ,IAAwBhpH,EAAKjwC,EAAEzJ,EAAG25C,EAAKlwC,EAAErF,EACrCw1C,EAAKnwC,EAAAqgC,EAAeg3H,EAAKr3J,EAAAuqC,gBAEzB6xH,EAAI9/J,KAAK6E,IAAK83J,UAElBvtI,EAAIn1B,EAAI05C,EAAKmsH,EAAKlsH,EAAKI,EACvB5kB,EAAI/wB,EAAIu1C,EAAKksH,EAAKnsH,EAAKK,EACvB5kB,EAAA2U,EAAO8P,EAAPisH,EAAA/E,EAAA/mH,EAVF5kB,EAAA6e,EAAA8sH,EAAA+E,EAAAjsH,EAAAG,KAwBE9O,EAAA66H,aAAiB,4BAEjBC,EAAO96H,EAAUuC,SAEf,OAAK,SAAOrY,EAAOmf,EAAnB0xH,EAAAtD,GANJ,OAQIz3H,EAAA0N,OAAAotH,EAAAzxH,GACAvS,EAAK+7B,cAAcmoG,EAAOD,EAA1BD,0BAGA96H,EAAArmC,IAAOuwB,EAAPmf,EAAAyxH,GAZJ5wI,GAEmB,kCA0BjB,IAAA4wI,EAAO96H,EAAUuC,SAEf,OAAK,SAASrY,EAAKmf,EAAnB0xH,EAAAtD,GALJ,8BAOIz3H,EAAArmC,IAAOuwB,EAAPmf,EAAAyxH,GAPJ5wI,MAqBE8V,EAAAi7H,WAAA,SAAA/wI,EAAA1rB,GAAA,IAAsBzJ,EAAIyJ,EAAEzJ,QAExB8pC,EAAIrgC,EAARqgC,SAEA3U,EAAIn1B,EAAIA,EACRm1B,EAAI/wB,EAAIA,EACR+wB,EAAA2U,EAAOA,EAPT3U,EAAA6e,EAAAjuC,KAAAoI,KAAApI,KAAAuK,IAAA,EAAAtQ,EAAAA,EAAAoE,EAAAA,EAAA0lC,EAAAA,OAoBAmB,EAAAuL,IAAAqqH,EAAArqH,IAYAvL,EAAAtgB,KAAAk2I,EAAAl2I,KAWEsgB,EAAAsH,MAAA,SAAApd,EAAA1rB,EAAAmD,EAAA9E,GAEA,IAKAq+J,EAAAC,EAAAC,EAAAC,EAAAC,EALwB7sH,EAAKjwC,EAAEzJ,EAAG25C,EAAKlwC,EAAErF,EACrCw1C,EAAKnwC,EAAEqgC,EAAGg3H,EAAKr3J,EAAEuqC,EAAG6F,EAAKjtC,EAAE5M,EAAG85C,EAAKltC,EAAExI,QAErCyhK,EAAJj5J,EAAWonC,SAKXoyH,EAAI1sH,EAAQG,EAAKF,EAAAG,EAAAF,EAAAG,EAAA+mH,EAAA+E,GAEf,IACAO,GAAAA,EACAvsH,GAAOA,EACPC,GAAOA,EACRC,GAAAA,EACD8rH,GAAAA,GAGE,EAAQO,EAAK,MAEbD,EAAApgK,KAASwqB,KAAS61I,GAClBC,EAAAtgK,KAASiF,IAAAm7J,GALXG,EAMOvgK,KAAAiF,KAAA,EAAAlD,GAAAq+J,GAAAE,EACLE,EAAAxgK,KAAAiF,IAAAlD,EAAAq+J,GAAAE,IAIDC,EAAA,EAAAx+J,EACDy+J,EAAAz+J,GAGAqtB,EAAIn1B,EAAIsmK,EAAS5sH,EAAK6sH,EAAS1sH,EAC/B1kB,EAAI/wB,EAAIkiK,EAAS3sH,EAAK4sH,EAASzsH,cAE/B3kB,EAAA6e,EAAOsyH,EAAPxF,EAAAyF,EAAAV,KAgBA56H,EAAAu7H,OAAY,4BAEZC,EAAOx7H,EAAUuC,SAEf,OAAK,SAAMrY,EAAX1rB,EAAAmD,EAAAC,EAAAC,EAAAhF,GANJ,OAOImjC,EAAKsH,MAAMm0H,EAAKj9J,EAAhBqD,EAAuBhF,oBAEvBmjC,EAAAsH,MAAApd,EAAAuxI,EAAAD,EAAA,EAAA3+J,GAAA,EAAAA,IATJqtB,GAEc,GAmBZ8V,EAAA0N,OAAA,SAAAxjB,EAAA1rB,GAAA,IAAwB41J,EAAK51J,EAAEzJ,EAAGs/J,EAAK71J,EAAErF,EACrCs8J,EAAAj3J,EAAMqgC,EACN3Y,EAAA1nB,EAAAuqC,oBAEJ2yH,EAAAnwH,EAAA,EAAAA,EAAA,SAIArhB,EAAIn1B,GAAKq/J,EAAKsH,EACdxxI,EAAI/wB,GAAIk7J,EAAKqH,EACbxxI,EAAA2U,GAAO42H,EAAPiG,EAXFxxI,EAAA6e,EAAA7iB,EAAAw1I,KAwBE17H,EAAA4yB,UAAA,SAAA1oC,EAAA1rB,UACA0rB,EAAIn1B,GAAKyJ,EAAEzJ,EACXm1B,EAAI/wB,GAAIqF,EAARrF,EACA+wB,EAAA2U,GAAOrgC,EAAPqgC,EALF3U,EAAA6e,EAAAvqC,EAAAuqC,KAiBA/I,EAAA/qC,OAAA2gK,EAAA3gK,OAMA+qC,EAAAxc,IAAAwc,EAAA/qC,OASA+qC,EAAA4zH,cAAAgC,EAAAhC,cAMA5zH,EAAA6zH,OAAA7zH,EAAA4zH,cAUA5zH,EAAA/U,UAAA2qI,EAAA3qI,gCAaE,IAAA0wI,EAAOpzH,EAAAhG,SAOL,OAAA,SAAYrY,EAAA0xI,EAAeC,EAAKC,GAVpC,OAGEvzH,EAAAhnB,IAAAo6I,EAAAC,EAAA7mK,EAAA6mK,EAAAziK,EAAAyiK,EAAA/8H,EAAAg9H,EAAA9mK,EAAA8mK,EAAA1iK,EAAA0iK,EAAAh9H,EAAAi9H,EAAA/mK,EAAA+mK,EAAA3iK,EAAA2iK,EAAAj9H,GAHFmB,EAAA/U,UAAAf,EAAA8V,EAAA+7H,SAAA7xI,EAAAyxI,gCA0BE,IAAAA,EAAOpzH,EAAAhG,SAEL,OAAK,SAAMrY,EAAAguB,EAAAwb,GAEV,OADCnrB,EAAAorB,WAAAgoG,EAAAzjH,EAAAwb,GACDioG,EAPL37H,EAAA/U,UAAAf,EAAA8V,EAAA+7H,SAAA7xI,EAAAyxI,aAwBE37H,EAAAy6H,cAAiB,SAAjBvwI,EAAA6wI,EAAAtD,GACAA,GAAY,GACZ,IAAIz6J,EAAIlC,KAAIiF,IAAK03J,UACjBvtI,EAAIn1B,EAAIiI,EAAI+9J,EAAKhmK,EACjBm1B,EAAI/wB,EAAI6D,EAAA+9J,EAAS5hK,EACjB+wB,EAAA2U,EAAO7hC,EAAP+9J,EAAAl8H,EAPF3U,EAAA6e,EAAAjuC,KAAA6E,IAAA83J,+BAwBE,IAA8BtyH,EAAMp0B,EAAEo0B,IAClCC,EAAMr0B,EAAEu0B,IAAKD,EAAMt0B,EAAE00B,IAAKI,EAAM90B,EAAEq0B,IAClCU,EAAM/0B,EAAEw0B,IAAKQ,EAAMh1B,EAAE20B,IAAKswH,EAAMjlJ,EAAEs0B,YAElC6wH,EAAAnlJ,EAAQ40B,IAERq2H,EAAQ72H,EAAGW,EAAAowH,UAGb,IAAIl5J,EAAI,GAAAlC,KAARoI,KAAA84J,EAAA,GAEA9xI,EAAI6e,EAAI,IAAO/rC,EACfktB,EAAIn1B,GAAKkhK,EAAMlwH,GAAO/oC,EANxBktB,EAAA/wB,GAQYksC,EAAM2wH,GAASh5J,EACzBktB,EAAI2U,GAAAgH,EAAMT,GAAWpoC,oBAErB,IAAIi/J,EAAK,EAAMnhK,KAAPoI,KAAR,EAAAiiC,EAAAW,EAAAowH,GAEAhsI,EAAI6e,GAAKktH,EAAMlwH,GAAOk2H,EACtB/xI,EAAIn1B,EAAI,IAAOknK,EANV/xI,EAAA/wB,GAQIisC,EAAMS,GAAKo2H,EACpB/xI,EAAI2U,GAAAwG,EAAM2wH,GAAWiG,eAErB,IAAIC,EAAK,EAAMphK,KAAPoI,KAAR,EAAA4iC,EAAAX,EAAA+wH,GAEAhsI,EAAI6e,GAAI1D,EAAO2wH,GAAfkG,EACAhyI,EAAIn1B,GAAKqwC,EAAMS,GAAOq2H,EANjBhyI,EAAA/wB,EAQA,IAAA+iK,EACLhyI,EAAI2U,GAAAkH,EAAMkwH,GAAWiG,OAErB,IAAIC,EAAK,EAAMrhK,KAAPoI,KAAR,EAAAgzJ,EAAA/wH,EAAAW,GAEA5b,EAAI6e,GAAKlD,EAAMT,GAAO+2H,EACtBjyI,EAAIn1B,GAAIswC,EAAO2wH,GAAfmG,EACDjyI,EAAA/wB,GAAA4sC,EAAAkwH,GAAAkG,sBAiBDn8H,EAAAqH,UAAA,SAAAnd,EAAAn1B,EAAAoE,EAAA0lC,GACA,IAAAu9H,EAAA,GAAAthK,KAAA8E,GAAA,IACA7K,GAAKqnK,OAELv9H,GAAIu9H,EAEJ,IAAIpvJ,EAAKlS,KAAKiF,IAAIhL,GACdg6C,EAAKj0C,KAAK6E,IAAI5K,GACdkY,EAAKnS,KAAKiF,IAAI5G,GACd61C,EAAKl0C,KAAK6E,IAAIxG,iBAEd81C,EAAIn0C,KAAK6E,IAAKk/B,UAElB3U,EAAIn1B,EAAIiY,EAAKgiC,EAAKC,EAAKF,EAAK9hC,EAAKovJ,EACjCnyI,EAAI/wB,EAAI41C,EAAK9hC,EAAKgiC,EAAKjiC,EAAKgiC,EAAKqtH,kBAEjCnyI,EAAA6e,EAAOgG,EAAPC,EAAAC,EAAAjiC,EAAAC,EAAAovJ,KAWAr8H,EAAAgS,QAAA,SAAA9nB,EAAA/D,GAAA,IAGIm2I,EAAOC,EAAOC,EAHIznK,EAAIoxB,EAAEpxB,EAAGoE,EAAIgtB,EAAEhtB,EACjC0lC,EAAA1Y,EAAA0Y,EACAkK,EAAA5iB,EAAA4iB,EACgBstC,EAAAthF,EAAAoE,EAAA0lC,EAAAkK,EAYlB,GAXAstC,EAAA,OAEAimF,EAAA,EAAAxhK,KAAA2hK,MAAA1nK,EAAAg0C,GACDwzH,EAAAzhK,KAAA8E,GAAA,EACD48J,EAAI,GACFnmF,GAAU,OAEVimF,GAAA,EAAAxhK,KAAA2hK,MAAA1nK,EAAAg0C,GACDwzH,GAAAzhK,KAAA8E,GAAA,EACD48J,EAAG,GAEDp0J,MAAIk0J,GAAJ,CACA,IAAII,EAAM3nK,EAAEA,EACZ4nK,EAAUxjK,EAAAA,EACVyjK,EAAA/9H,EAAWA,EACXy9H,EAAOxhK,KAAK2hK,MAAM,EAAAtjK,EAAA4vC,EAAQ,EAAAh0C,EAAQ8pC,EAAA,EAAI,EAAJ89H,EAAY,EAAvCC,GACRL,EAAAzhK,KAAAotB,KAAA,EAAAmuD,8CAIDnsD,EAAI/wB,EAAI64J,EAASsK,YAEjBpyI,EAAAn1B,EAAOi9J,EAAPwK,MAYDx8H,EAFD01G,IAAA,SAAAl3I,qDAaEwhC,EAAAjoB,MAAW,SAAXmS,EAAA/D,UACA+D,EAAI,GAAK/D,EAAEpxB,EACXm1B,EAAI,GAAK/D,EAAEhtB,WAEX+wB,EAAA,GAAO/D,EAAP4iB,KAYF/I,EAAAm0H,YAAAyB,EAAAzB,YASAn0H,EAAI6rB,OAAS+pG,EAAI/pG,OAEjB,IAAIgxG,EAAQ,IAAA/zJ,MAAS,GAEnBg0J,EAAA,SAAA33H,EAAAC,EAAAC,EAAAC,GACA7vC,KAAK0vC,IAAMA,EACX1vC,KAAK2vC,IAAMA,EAJb3vC,KAAA4vC,IAAAA,cASEy3H,EAAA/kK,UAAYu7J,OAAZ,kBACAuJ,EAAO,GAAKpnK,KAAK0vC,IACjB03H,EAAO,GAAKpnK,KAAK2vC,kBAEjBy3H,EAAO,GAAApnK,KAAP6vC,OASF,IAAAy3H,GAOCx6H,OAFD,kCAeChH,IAFD,SAAA4J,EAAAC,EAAAS,EAAAC,0BAYChwC,MAFD,SAAA0I,0CAaEmrC,KAAU,SAAVzf,EAAA1rB,UACA0rB,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE4mC,IACZlb,EAAAmb,IAAA7mC,EAAA6mC,IALFnb,EAAAob,IAAA9mC,EAAA8mC,OAgBE+vB,SAAA,SAAAnrC,UACAA,EAAIib,IAAM,EACVjb,EAAIkb,IAAM,EACVlb,EAAAmb,IAAA,EALFnb,EAAAob,IAAA,KAoBE/jB,IAAA,SAAA2I,EAAAib,EAAAC,EAAAS,EAAAC,UACA5b,EAAIib,IAAMA,EACVjb,EAAIkb,IAAMA,EACVlb,EAAAmb,IAAAQ,EALF3b,EAAAob,IAAAQ,KAkBEqwH,UAAe,SAAAjsI,EAAA1rB,GAEb,GAAA0rB,IAAU1rB,EAAE,CACZ,IAAI61J,EAAJ71J,EAAU4mC,IAHZlb,EAAAkb,IAIO5mC,EAAA6mC,IACLnb,EAAImb,IAAMgvH,OAEVnqI,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE6mC,IACbnb,EAAAmb,IAAA7mC,EAAA4mC,0BAaDsI,OAAuB,SAAvBxjB,EAAA1rB,GAAA,IAA4B41J,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,YAE/Clf,EAAA1nB,EAAA8mC,IAGIgG,EAAM8oH,EAAAluI,EAAAuvI,EAAApB,EAET,OAAA/oH,GAGDA,EAAI,EAAMA,EAEVphB,EAAIib,IAAMjf,EAAAolB,EACVphB,EAAIkb,KAAMivH,EAAK/oH,aAEfphB,EAAAob,IAAA8uH,EAAA9oH,KAPM,MAmBN0rH,QAAW,SAAX9sI,EAAA1rB,GAEA,IAAI41J,EAAJ51J,EAAW2mC,WACXjb,EAAIib,IAAM3mC,EAAC8mC,IACXpb,EAAIkb,KAAM5mC,EAAV4mC,iBAEAlb,EAAAob,IAAA8uH,KAWD6C,YAFD,SAAAz4J,mCAaEioC,SAAA,SAAAvc,EAAA1rB,EAAAmD,GAAA,IAA4ByyJ,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAC3CqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IAAKgvH,EAAK3yJ,EAAEwjC,IAAKloC,EAAK0E,EAAEyjC,IAC3CloC,EAAJyE,EAAU0jC,IACNloC,EAAJwE,EAAU2jC,WACVpb,EAAIib,IAAMivH,EAAKE,EAAKmB,EAAKx4J,EACzBitB,EAAIkb,IAAMivH,EAAKC,EAAKpuI,EAAKjpB,EACzBitB,EAAAmb,IAAA+uH,EAAAl3J,EAAAu4J,EAAAt4J,EAPF+sB,EAAAob,IAAA+uH,EAAAn3J,EAAAgpB,EAAA/oB,MAgBA4/J,EAAApjK,IAAAojK,EAAAt2H,SASEs2H,EAAAvF,OAAuB,SAAvBttI,EAAA1rB,EAAAi5J,GAAA,IAA4BrD,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAC3CqwH,EAAIj3J,EAAA6mC,IACJnf,EAAI1nB,EAAA8mC,IACJtoC,EAAJlC,KAAUiF,IAAA03J,GACN71J,EAAJ9G,KAAU6E,IAAA83J,UACVvtI,EAAIib,IAAMivH,EAAKxyJ,EAAL6zJ,EAAUz4J,EACpBktB,EAAIkb,IAAMivH,EAAKzyJ,EAALskB,EAAUlpB,EACpBktB,EAAAmb,IAAA+uH,GAAAp3J,EAAAy4J,EAAA7zJ,EARFsoB,EAAAob,IAAA+uH,GAAAr3J,EAAAkpB,EAAAtkB,KAoBEm7J,EAAA58H,MAAuB,SAAvBjW,EAAA1rB,EAAAylB,GAAA,IAA4BmwI,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAC3CqwH,EAAKj3J,EAAE6mC,IAAGnf,EAAK1nB,EAAE8mC,IACjB03H,EAAJ/4I,EAAUlvB,EACNkoK,EAAJh5I,EAAU9qB,SACV+wB,EAAIib,IAAMivH,EAAK4I,EACf9yI,EAAIkb,IAAMivH,EAAK2I,EACf9yI,EAAAmb,IAAAowH,EAAAwH,EAPF/yI,EAAAob,IAAApf,EAAA+2I,KAsBEF,EAAApF,aACiB,SADjBztI,EAAAutI,GAEA,IAAIz6J,EAAJlC,KAAAiF,IAAA03J,GACI71J,EAAJ9G,KAAA6E,IAAA83J,UACAvtI,EAAIib,IAAMvjC,EACVsoB,EAAIkb,IAAMpoC,EACVktB,EAAAmb,KAAAroC,EAPFktB,EAAAob,IAAA1jC,KAuBEm7J,EAAAnF,YAAA,SAAA1tI,EAAAjG,UACAiG,EAAIib,IAAMlhB,EAAVlvB,EACAm1B,EAAIkb,IAAM,EACVlb,EAAAmb,IAAA,EALFnb,EAAAob,IAAArhB,EAAA9qB,KAgBC4jK,EAFDrnB,IAAA,SAAAl3I,6DAaEu+J,EAAAhlJ,MAAW,SAAXmS,EAAAnZ,UACAmZ,EAAI,GAAKnZ,EAAEo0B,IACXjb,EAAI,GAAKnZ,EAAEq0B,eAEXlb,EAAA,GAAOnZ,EAAPu0B,OAWDy3H,EAFDvD,KAAA,SAAAh7J,8FAcEu+J,EAAEG,IAAM,SAARC,EAAAC,EAAAC,EAAA7+J,GACA2+J,EAAE93H,IAAM7mC,EAAE6mC,IAAV7mC,EAAA2mC,IACAk4H,EAAEl4H,IAAM3mC,EAAE2mC,IAJZk4H,EAAAj4H,IAAA5mC,EAAA4mC,6BAiBE23H,EAAAziK,IAAA,SAAkB4vB,EAAlB1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAAEwjC,IACpBjb,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAAEyjC,IACpBlb,EAAAmb,IAAA7mC,EAAA6mC,IAAA1jC,EAAA0jC,IALFnb,EAAAob,IAAA9mC,EAAA8mC,IAAA3jC,EAAA2jC,OAkBEy3H,EAAAxJ,SAAY,SAAZrpI,EAAA1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAAEwjC,IACpBjb,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAAEyjC,IACpBlb,EAAAmb,IAAA7mC,EAAA6mC,IAAA1jC,EAAA0jC,IALFnb,EAAAob,IAAA9mC,EAAA8mC,IAAA3jC,EAAA2jC,OAcAy3H,EAAA7iK,IAAA6iK,EAAAxJ,SASCwJ,EAFD5I,YAAA,SAAA31J,EAAAmD,sEAYEo7J,EAAAlxG,OAAuB,SAAvBrtD,EAAAmD,GAAA,IAA4ByyJ,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAC3CqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IAAKgvH,EAAK3yJ,EAAEwjC,IAAKloC,EAAK0E,EAAEyjC,IAC/CloC,EACEyE,EAAA0jC,IAJJloC,EAAAwE,EAAA2jC,mOAqBEy3H,EAAAtD,eAAA,SAAAvvI,EAAA1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAClBuoB,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAClBuoB,EAAAmb,IAAA7mC,EAAA6mC,IAAA1jC,EALFuoB,EAAAob,IAAA9mC,EAAA8mC,IAAA3jC,KAmBEo7J,EAAArD,qBAA2B,SAA3BxvI,EAAA1rB,EAAAmD,EAAAw+B,UACAjW,EAAIib,IAAM3mC,EAAE2mC,IAAOxjC,EAAEwjC,IAAMhF,EAC3BjW,EAAIkb,IAAM5mC,EAAE4mC,IAAOzjC,EAAEyjC,IAAMjF,EAC3BjW,EAAAmb,IAAA7mC,EAAA6mC,IAAA1jC,EAAA0jC,IAAAlF,EALFjW,EAAAob,IAAA9mC,EAAA8mC,IAAA3jC,EAAA2jC,IAAAnF,KAUA,IAAIm9H,EAAS,IAAAx0J,MAAS,GAEpBy0J,EAAW,SAAXp4H,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GACA/vC,KAAK0vC,IAAMA,EACX1vC,KAAK2vC,IAAMA,EACX3vC,KAAK4vC,IAAMA,EACX5vC,KAAK6vC,IAAMA,EANb7vC,KAAA8vC,IAAAA,cAWEg4H,EAAAxlK,UAAYu7J,OAAZ,kBACAgK,EAAO,GAAK7nK,KAAK0vC,IACjBm4H,EAAO,GAAK7nK,KAAK2vC,IACjBk4H,EAAO,GAAK7nK,KAAK4vC,IACjBi4H,EAAO,GAAK7nK,KAAK6vC,kBAEjBg4H,EAAO,GAAA7nK,KAAP+vC,OAuBF,IAAAg4H,GAWCj7H,OAND,sCAyBChH,IAND,SAAA/8B,EAAAmD,EAAAC,EAAAC,EAAA6+F,EAAAC,8BAoBC7qG,MAND,SAAA0I,sDAiBEmrC,KAAU,SAAVzf,EAAA1rB,UACA0rB,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE4mC,IACZlb,EAAImb,IAAM7mC,EAAE6mC,IACZnb,EAAIob,IAAM9mC,EAAE8mC,IACZpb,EAAAqb,IAAA/mC,EAAA+mC,IAPFrb,EAAAsb,IAAAhnC,EAAAgnC,OAkBE6vB,SAAA,SAAAnrC,UACAA,EAAIib,IAAM,EACVjb,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAAqb,IAAA,EAPFrb,EAAAsb,IAAA,KAwBEjkB,IAAU,SAAV2I,EAAA1rB,EAAAmD,EAAAC,EAAAC,EAAA6+F,EAAAC,UACAz2E,EAAIib,IAAM3mC,EACV0rB,EAAIkb,IAAMzjC,EACVuoB,EAAImb,IAAMzjC,EACVsoB,EAAIob,IAAMzjC,EACVqoB,EAAAqb,IAAAm7D,EAPFx2E,EAAAsb,IAAAm7D,KAkBEjzD,OAAuB,SAAvBxjB,EAAA1rB,GAAA,IAA4B21D,EAAK31D,EAAE2mC,IAAK6F,EAAKxsC,EAAE4mC,IAC7C6F,EAAAzsC,EAAM6mC,IAAO+uB,EAAA51D,EAAM8mC,YAEjBgvB,EAAM91D,EAAAgnC,IAER8F,EAAO6oB,EAAPC,EAAAppB,EAAAC,EACD,OAAAK,GAGDA,EAAI,EAAMA,EAEVphB,EAAIib,IAAMivB,EAAA9oB,EACVphB,EAAIkb,KAAM4F,EAAKM,EACfphB,EAAImb,KAAO4F,EAAKK,EAChBphB,EAAIob,IAAM6uB,EAAC7oB,EACXphB,EAAAqb,KAAA0F,EAAAqpB,EAAAF,EAAAC,GAAA/oB,EAhBFphB,EAAAsb,KAAAwF,EAAAqpB,EAAAF,EAAAG,GAAAhpB,KAQQ,MAmBP2rH,YAFD,SAAAz4J,mCAaEioC,SAAA,SAAAvc,EAAA1rB,EAAAmD,GAAA,IAA4ByyJ,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAAKqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IACrEq0H,EAAKn7J,EAAE+mC,IAAKq0H,EAAKp7J,EAAEgnC,IAAK8uH,EAAK3yJ,EAAEwjC,IAAKloC,EAAK0E,EAAEyjC,IAAKloC,EAAKyE,EAAE0jC,IAAKloC,EAAKwE,EAAE2jC,IACjEloC,EAAJuE,EAAU4jC,IACNy0H,EAAJr4J,EAAU6jC,WACVtb,EAAIib,IAAMivH,EAAKE,EAAKmB,EAAKx4J,EACzBitB,EAAIkb,IAAMivH,EAAKC,EAAKpuI,EAAKjpB,EACzBitB,EAAImb,IAAM+uH,EAAKl3J,EAAKu4J,EAAKt4J,EACzB+sB,EAAIob,IAAM+uH,EAAKn3J,EAAKgpB,EAAK/oB,EACzB+sB,EAAAqb,IAAA6uH,EAAAh3J,EAAAq4J,EAAAuE,EAAAL,EATFzvI,EAAAsb,IAAA6uH,EAAAj3J,EAAA8oB,EAAA8zI,EAAAJ,MAkBA4D,EAAA7jK,IAAA6jK,EAAA/2H,SASE+2H,EAAgBhG,OAAO,SAAvBttI,EAAA1rB,EAAAi5J,GAAA,IAA4BrD,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAAKqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IACrEq0H,EAAIn7J,EAAA+mC,IACJq0H,EAAIp7J,EAAAgnC,IACFxoC,EAAJlC,KAAUiF,IAAA03J,GACN71J,EAAJ9G,KAAU6E,IAAA83J,UACVvtI,EAAIib,IAAMivH,EAAKxyJ,EAAL6zJ,EAAUz4J,EACpBktB,EAAIkb,IAAMivH,EAAKzyJ,EAALskB,EAAUlpB,EACpBktB,EAAImb,IAAM+uH,GAAVp3J,EAAAy4J,EAAA7zJ,EACAsoB,EAAIob,IAAM+uH,GAAVr3J,EAAAkpB,EAAAtkB,EACAsoB,EAAAqb,IAAAo0H,EAVFzvI,EAAAsb,IAAAo0H,KAsBE4D,EAAgBr9H,MAAO,SAAvBjW,EAAA1rB,EAAAylB,GAAA,IAA4BmwI,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAAKqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IACrEq0H,EAAKn7J,EAAE+mC,IAAGq0H,EAAKp7J,EAAEgnC,IACfw3H,EAAJ/4I,EAAUlvB,EACNkoK,EAAJh5I,EAAU9qB,SACV+wB,EAAIib,IAAMivH,EAAK4I,EACf9yI,EAAIkb,IAAMivH,EAAK2I,EACf9yI,EAAImb,IAAMowH,EAAVwH,EACA/yI,EAAIob,IAAMpf,EAAV+2I,EACA/yI,EAAAqb,IAAAo0H,EATFzvI,EAAAsb,IAAAo0H,KAqBE4D,EAAgBjoG,UAAhB,SAAArrC,EAAA1rB,EAAAylB,GAAA,IAA4BmwI,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAAKqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IACrEq0H,EAAKn7J,EAAE+mC,IAAGq0H,EAAKp7J,EAAEgnC,IACfw3H,EAAJ/4I,EAAUlvB,EACNkoK,EAAJh5I,EAAU9qB,SACV+wB,EAAIib,IAAMivH,EACVlqI,EAAIkb,IAAMivH,EACVnqI,EAAImb,IAAMowH,EACVvrI,EAAIob,IAAMpf,EACVgE,EAAAqb,IAAA6uH,EAAA4I,EAAAvH,EAAAwH,EAAAtD,EATFzvI,EAAAsb,IAAA6uH,EAAA2I,EAAA92I,EAAA+2I,EAAArD,KAwBE4D,EAAuB7F,aAAa,SAApCztI,EAAAutI,GACA,IAAIz6J,EAAJlC,KAAAiF,IAAA03J,GACI71J,EAAJ9G,KAAA6E,IAAA83J,UACAvtI,EAAIib,IAAMvjC,EACVsoB,EAAIkb,IAAMpoC,EACVktB,EAAImb,KAAJroC,EACAktB,EAAIob,IAAM1jC,EACVsoB,EAAAqb,IAAA,EARFrb,EAAAsb,IAAA,KAwBEg4H,EAAI5F,YAAJ,SAAA1tI,EAAAjG,UACAiG,EAAIib,IAAMlhB,EAAVkhB,IACAjb,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAMrhB,EAAVmhB,IACAlb,EAAAqb,IAAA,EAPFrb,EAAAsb,IAAA,KAuBEg4H,EAAI9F,gBAAJ,SAAAxtI,EAAAjG,UACAiG,EAAIib,IAAM,EACVjb,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAAqb,IAAAthB,EAAAlvB,EAPFm1B,EAAAsb,IAAAvhB,EAAA9qB,KAkBCqkK,EAFD9nB,IAAA,SAAAl3I,oFAaEg/J,EAAIzlJ,MAAO,SAAXmS,EAAAnZ,UACAmZ,EAAI,GAAKnZ,EAAEo0B,IACXjb,EAAI,GAAKnZ,EAAEq0B,IACXlb,EAAI,GAAKnZ,EAAEs0B,IACXnb,EAAI,GAAKnZ,EAAEu0B,eAEXpb,EAAA,GAAOnZ,EAAPy0B,OAYAg4H,EAAIC,SAAJ,SAAAvzI,EAAAnZ,UACAmZ,EAAI,GAAKnZ,EAATo0B,IACAjb,EAAI,GAAKnZ,EAATq0B,IACAlb,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAKnZ,EAATs0B,IACAnb,EAAI,GAAKnZ,EAATu0B,IACApb,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAJ,EACAA,EAAI,GAAJ,EACAA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAMnZ,EAAVw0B,IACArb,EAAI,IAAMnZ,EAAVy0B,YAEAtb,EAAA,IAAA,KAWDszI,EAFDhE,KAAA,SAAAh7J,oIAcEg/J,EAAIljK,IAAM,SAAU4vB,EAApB1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAAEwjC,IACpBjb,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAAEyjC,IACpBlb,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAAE0jC,IACpBnb,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAAE2jC,IACpBpb,EAAAqb,IAAA/mC,EAAA+mC,IAAA5jC,EAAA4jC,IAPFrb,EAAAsb,IAAAhnC,EAAAgnC,IAAA7jC,EAAA6jC,OAoBEg4H,EAAIjK,SAAM,SAAVrpI,EAAA1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAAEwjC,IACpBjb,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAAEyjC,IACpBlb,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAAE0jC,IACpBnb,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAAE2jC,IACpBpb,EAAAqb,IAAA/mC,EAAA+mC,IAAA5jC,EAAA4jC,IAPFrb,EAAAsb,IAAAhnC,EAAAgnC,IAAA7jC,EAAA6jC,OAgBAg4H,EAAAtjK,IAAAsjK,EAAAjK,SAUEiK,EAAI/D,eAAJ,SAAAvvI,EAAA1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAClBuoB,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAClBuoB,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAClBuoB,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAClBuoB,EAAAqb,IAAA/mC,EAAA+mC,IAAA5jC,EAPFuoB,EAAAsb,IAAAhnC,EAAAgnC,IAAA7jC,KAqBE67J,EAAI9D,qBAAuB,SAA3BxvI,EAAA1rB,EAAAmD,EAAAw+B,UACAjW,EAAIib,IAAM3mC,EAAE2mC,IAAOxjC,EAAEwjC,IAAMhF,EAC3BjW,EAAIkb,IAAM5mC,EAAE4mC,IAAOzjC,EAAEyjC,IAAMjF,EAC3BjW,EAAImb,IAAM7mC,EAAE6mC,IAAO1jC,EAAE0jC,IAAMlF,EAC3BjW,EAAIob,IAAM9mC,EAAE8mC,IAAO3jC,EAAE2jC,IAAMnF,EAC3BjW,EAAAqb,IAAA/mC,EAAA+mC,IAAA5jC,EAAA4jC,IAAApF,EAPFjW,EAAAsb,IAAAhnC,EAAAgnC,IAAA7jC,EAAA6jC,IAAArF,KAmBCq9H,EAFDrJ,YAAA,SAAA31J,EAAAmD,oGAYE67J,EAAgB3xG,OAAO,SAAvBrtD,EAAAmD,GAAA,IAA4ByyJ,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAAKqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IACnEq0H,EAAKn7J,EAAE+mC,IAAKq0H,EAAKp7J,EAAEgnC,IAAK8uH,EAAK3yJ,EAAEwjC,IAAKloC,EAAK0E,EAAEyjC,IAAKloC,EAAKyE,EAAE0jC,IAAKloC,EAAKwE,EAAE2jC,IACvEloC,EACEuE,EAAA4jC,IAJJy0H,EAAAr4J,EAAA6jC,+UAeA,IAAIk4H,EAAQ,IAAA50J,MAAS,IAOnB60J,EAAA,SAAAx4H,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GACAzwC,KAAK0vC,IAAMA,EACX1vC,KAAK2vC,IAAMA,EACX3vC,KAAK4vC,IAAMA,EACX5vC,KAAK6vC,IAAMA,EACX7vC,KAAK8vC,IAAMA,EACX9vC,KAAK+vC,IAAMA,EACX/vC,KAAKgwC,IAAMA,EACXhwC,KAAKiwC,IAAMA,EACXjwC,KAAKkwC,IAAMA,EACXlwC,KAAKmwC,IAAMA,EACXnwC,KAAKowC,IAAMA,EACXpwC,KAAKqwC,IAAMA,EACXrwC,KAAKswC,IAAMA,EACXtwC,KAAKuwC,IAAMA,EArBbvwC,KAAAwwC,IAAAA,cA0BE03H,EAAA5lK,UAAYu7J,OAAZ,kBACAoK,EAAO,GAAKjoK,KAAK0vC,IACjBu4H,EAAO,GAAKjoK,KAAK2vC,IACjBs4H,EAAO,GAAKjoK,KAAK4vC,IACjBq4H,EAAO,GAAKjoK,KAAK6vC,IACjBo4H,EAAO,GAAKjoK,KAAK8vC,IACjBm4H,EAAO,GAAKjoK,KAAK+vC,IACjBk4H,EAAO,GAAKjoK,KAAKgwC,IACjBi4H,EAAO,GAAKjoK,KAAKiwC,IACjBg4H,EAAO,GAAPjoK,KAAakwC,IACb+3H,EAAO,GAAPjoK,KAAamwC,IACb83H,EAAO,IAAMjoK,KAAKowC,IAClB63H,EAAO,IAAMjoK,KAAKqwC,IAClB43H,EAAO,IAAMjoK,KAAKswC,IAClB23H,EAAO,IAAMjoK,KAAKuwC,mBAElB03H,EAAO,IAAPjoK,KAAAywC,OAgCF,IAAA5K,GAYCiH,OAPD,0DAqCChH,IAPD,SAAA4J,EAAAC,EAAAC,EAAAC,EAAAO,EAAAC,EAAAC,EAAAC,EAAAgwH,EAAAC,EAAAC,EAAA0H,EAAAC,EAAAC,EAAAC,EAAAC,kDAsBCloK,MAPD,SAAA0I,kHAkBEmrC,KAAU,SAAVzf,EAAA1rB,UACA0rB,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE4mC,IACZlb,EAAImb,IAAM7mC,EAAE6mC,IACZnb,EAAIob,IAAM9mC,EAAE8mC,IACZpb,EAAIqb,IAAM/mC,EAAE+mC,IACZrb,EAAIsb,IAAMhnC,EAAEgnC,IACZtb,EAAIub,IAAMjnC,EAAEinC,IACZvb,EAAIwb,IAAMlnC,EAAEknC,IACZxb,EAAIyb,IAAMnnC,EAAEmnC,IACZzb,EAAI0b,IAAMpnC,EAAEonC,IACZ1b,EAAI2b,IAAMrnC,EAAEqnC,IACZ3b,EAAI4b,IAAMtnC,EAAEsnC,IACZ5b,EAAI6b,IAAMvnC,EAAEunC,IACZ7b,EAAI8b,IAAMxnC,EAAEwnC,IACZ9b,EAAA+b,IAAAznC,EAAAynC,IAjBF/b,EAAAgc,IAAA1nC,EAAA0nC,OA4CE3kB,IAAA,SAAA2I,EAAAib,EAAAC,EAAAC,EAAAC,EAAAO,EAAAC,EAAAC,EAAAC,EAAAgwH,EAAAC,EAAAC,EAAA0H,EAAAC,EAAAC,EAAAC,EAAAC,UACA9zI,EAAIib,IAAMA,EACVjb,EAAIkb,IAAMA,EACVlb,EAAImb,IAAMA,EACVnb,EAAIob,IAAMA,EACVpb,EAAIqb,IAAMM,EACV3b,EAAIsb,IAAMM,EACV5b,EAAIub,IAAMM,EACV7b,EAAIwb,IAAMM,EACV9b,EAAIyb,IAAMqwH,EACV9rI,EAAI0b,IAAMqwH,EACV/rI,EAAI2b,IAAMqwH,EACVhsI,EAAI4b,IAAM83H,EACV1zI,EAAI6b,IAAM83H,EACV3zI,EAAI8b,IAAM83H,EACV5zI,EAAA+b,IAAA83H,EAjBF7zI,EAAAgc,IAAA83H,KA6BE3oG,SAAA,SAAAnrC,UACAA,EAAIib,IAAM,EACVjb,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAM,EACVtb,EAAIub,IAAM,EACVvb,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM,EACVzb,EAAI0b,IAAM,EACV1b,EAAI2b,IAAM,EACV3b,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM,EACV7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA,EAjBF/b,EAAAgc,IAAA,KA6BEiwH,UAAe,SAAAjsI,EAAA1rB,GACb,GAAA0rB,IAAuB1rB,EAAE,CAAzB,IAA8B43J,EAAM53J,EAAE4mC,IAClCixH,EAAM73J,EAAE6mC,IAAKqzH,EAAMl6J,EAAE8mC,IACrBgxH,EAAM93J,EAAEinC,YAERmzH,EAAMp6J,EAAEsnC,IAEZ5b,EAAIkb,IAAM5mC,EAAE+mC,IACZrb,EAAImb,IAAM7mC,EAAAmnC,IACVzb,EAAIob,IAAM9mC,EAAEunC,IACZ7b,EAAIqb,IAAM6wH,EACVlsI,EAAIub,IAAMjnC,EAAAonC,IACV1b,EAAIwb,IAAMlnC,EAAAwnC,IACV9b,EAAIyb,IAAM0wH,EACVnsI,EAAI0b,IAAM0wH,EACVpsI,EAAI4b,IAAMtnC,EAAAynC,IACV/b,EAAI6b,IAAM2yH,EAhBZxuI,EAAA8b,IAiBO2yH,EACLzuI,EAAI+b,IAAM2yH,OAEV1uI,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE+mC,IACZrb,EAAImb,IAAM7mC,EAAEmnC,IACZzb,EAAIob,IAAM9mC,EAAEunC,IACZ7b,EAAIqb,IAAM/mC,EAAE4mC,IACZlb,EAAIsb,IAAMhnC,EAAEgnC,IACZtb,EAAIub,IAAMjnC,EAAEonC,IACZ1b,EAAIwb,IAAMlnC,EAAEwnC,IACZ9b,EAAIyb,IAAMnnC,EAAE6mC,IACZnb,EAAI0b,IAAMpnC,EAAEinC,IACZvb,EAAI2b,IAAMrnC,EAAEqnC,IACZ3b,EAAI4b,IAAMtnC,EAAEynC,IACZ/b,EAAI6b,IAAMvnC,EAAE8mC,IACZpb,EAAI8b,IAAMxnC,EAAEknC,IACbxb,EAAA+b,IAAAznC,EAAAsnC,0BAaD4H,OAAyB,SAAzBxjB,EAAA1rB,GAAA,IAA8B+3J,EAAM/3J,EAAE2mC,IAAKixH,EAAM53J,EAAE4mC,IAC/CixH,EAAM73J,EAAE6mC,IAAKqzH,EAAMl6J,EAAE8mC,IAAKkxH,EAAMh4J,EAAE+mC,IAAKkxH,EAAMj4J,EAAEgnC,IAC/C8wH,EAAM93J,EAAEinC,IAAKkzH,EAAMn6J,EAAEknC,IAAKgxH,EAAMl4J,EAAEmnC,IAAKkxH,EAAMr4J,EAAEonC,IAC/C+wH,EAAMn4J,EAAEqnC,IAAK+yH,EAAMp6J,EAAEsnC,IAAK+yH,EAAMr6J,EAAEunC,IAAK+yH,EAAMt6J,EAAEwnC,YAE/C+yH,EAAMv6J,EAAA0nC,IAENgxH,EAAMX,EAAME,EAAML,EAAMI,EACxBI,EAAML,EAAMD,EAAMD,EAAMG,EACxBW,EAAMZ,EAAMoC,EAAMD,EAAMlC,EACxBwC,EAAM5C,EAAME,EAAMD,EAAMI,EACxBwC,EAAM7C,EAAMuC,EAAMD,EAAMjC,EACxByC,EAAM7C,EAAMsC,EAAMD,EAAMpC,EACxB6C,EAAMzC,EAAMoC,EAAMjC,EAAMgC,EACxBO,EAAM1C,EAAM2C,EAAM1C,EAAMkC,EACxBS,EAAM5C,EAAMqC,EAAMH,EAAMC,EACxBU,EAAM1C,EAAMwC,EAAM1C,EAAMmC,YAE5B/B,EAAAJ,EAAAoC,EAAAH,EAAAS,EAGI/tH,EAAM4rH,EAAAH,EAAAH,EAAAQ,EAAAD,EAAAoC,EAAAP,EAAAM,EAAAL,EAAAG,EAAAF,EAAAC,EAET,OAAA7tH,GAGDA,EAAI,EAAOA,EAEXphB,EAAIib,KAAOsxH,EAAMM,EAAMT,EAAMc,EAAMuB,EAAMY,GAAOjuH,EAChDphB,EAAIkb,KAAOixH,EAAMe,EAAMhB,EAAMW,EAAM2B,EAAMa,GAAOjuH,EAChDphB,EAAImb,KAAOyzH,EAAMI,EAAMG,EAAMJ,EAAMF,EAAMC,GAAO1tH,EAChDphB,EAAIob,KAAOqxH,EAAMsC,EAAMpC,EAAMqC,EAAMN,EAAMI,GAAO1tH,EAChDphB,EAAIqb,KAAO+wH,EAAMgD,EAAM9C,EAAMO,EAAM4B,EAAMS,GAAO9tH,EAChDphB,EAAIsb,KAAO+wH,EAAMQ,EAAMV,EAAMiD,EAAMZ,EAAMU,GAAO9tH,EAChDphB,EAAIub,KAAO4zH,EAAMlC,EAAM0B,EAAMK,EAAMH,EAAMnC,GAAOtrH,EAChDphB,EAAIwb,KAAOgxH,EAAMwC,EAAMvC,EAAMQ,EAAMyB,EAAMhC,GAAOtrH,EAChDphB,EAAIyb,KAAO6wH,EAAMY,EAAMX,EAAM6C,EAAMX,EAAMQ,GAAO7tH,EAChDphB,EAAI0b,KAAOwwH,EAAMkD,EAAM/C,EAAMa,EAAMsB,EAAMS,GAAO7tH,EAChDphB,EAAI2b,KAAOgzH,EAAMI,EAAMH,EAAM3B,EAAM4B,EAAM7B,GAAO5rH,EAChDphB,EAAI4b,KAAO+wH,EAAMM,EAAMT,EAAMuC,EAAML,EAAM1B,GAAO5rH,EAChDphB,EAAI6b,KAAO0wH,EAAM2C,EAAM5C,EAAM+C,EAAMjD,EAAM6C,GAAO7tH,EAChDphB,EAAI8b,KAAOuwH,EAAMgD,EAAMnD,EAAMgD,EAAM/C,EAAM8C,GAAO7tH,wBAEhDphB,EAAAgc,KAAAwwH,EAAAsC,EAAAnC,EAAAD,EAAAD,EAAAO,GAAA5rH,KAnBM,MA8BN0rH,QAAyB,SAAzB9sI,EAAA1rB,GAAA,IAA8B+3J,EAAM/3J,EAAE2mC,IAAKixH,EAAM53J,EAAE4mC,IAC/CixH,EAAM73J,EAAE6mC,IAAKqzH,EAAMl6J,EAAE8mC,IAAKkxH,EAAMh4J,EAAE+mC,IAAKkxH,EAAMj4J,EAAEgnC,IAC/C8wH,EAAM93J,EAAEinC,IAAKkzH,EAAMn6J,EAAEknC,IAAKgxH,EAAMl4J,EAAEmnC,IAAKkxH,EAAMr4J,EAAEonC,IAC/C+wH,EAAMn4J,EAAEqnC,IAAK+yH,EAAMp6J,EAAEsnC,IAAK+yH,EAAMr6J,EAAEunC,IAAK+yH,EAAMt6J,EAAEwnC,YAE/C+yH,EAAOv6J,EAAA0nC,WAEXhc,EAAIib,IAAOsxH,GAAOE,EAAMoC,EAAMH,EAAMS,GAAOxC,GAAOP,EAAMyC,EAAMJ,EAAMU,GAAOP,GAAOxC,EAAMsC,EAAMD,EAAMhC,GACpGzsI,EAAIkb,MAAQgxH,GAAOO,EAAMoC,EAAMH,EAAMS,GAAOxC,GAAOR,EAAM0C,EAAML,EAAMW,GAAOP,GAAOzC,EAAMuC,EAAMF,EAAM/B,IACrGzsI,EAAImb,IAAM+wH,GAAEE,EAAOyC,EAAAJ,EAAYU,GAAnB5C,GAAgCJ,EAAO0C,EAAAL,EAAYW,GAAnDP,GAAgEzC,EAAOsC,EAAAD,EAAYpC,GAC/FpsI,EAAIob,MAAO8wH,GAAOE,EAAMsC,EAAMD,EAAMhC,GAAOF,GAAOJ,EAAMuC,EAAMF,EAAM/B,GAAOE,GAAOR,EAAMsC,EAAMD,EAAMpC,IACpGpsI,EAAIqb,MAAQixH,GAAOG,EAAMoC,EAAMH,EAAMS,GAAO3C,GAAOJ,EAAMyC,EAAMJ,EAAMU,GAAOR,GAAOvC,EAAMsC,EAAMD,EAAMhC,IACrGzsI,EAAIsb,IAAO+wH,GAAOI,EAAMoC,EAAMH,EAAMS,GAAO3C,GAAOL,EAAM0C,EAAML,EAAMW,GAAOR,GAAOxC,EAAMuC,EAAMF,EAAM/B,GACpGzsI,EAAIub,MAAO8wH,GAAOD,EAAMyC,EAAMJ,EAAMU,GAAO7C,GAAOH,EAAM0C,EAAML,EAAMW,GAAOR,GAAOxC,EAAMsC,EAAMD,EAAMpC,IACpGpsI,EAAIwb,IAAM6wH,GAAED,EAAOsC,EAAAD,EAAYhC,GAAnBH,GAAgCH,EAAOuC,EAAAF,EAAY/B,GAAnDD,GAAgEL,EAAOsC,EAAAD,EAAYpC,GAC/FpsI,EAAIyb,IAAO6wH,GAAOK,EAAMkC,EAAMH,EAAME,GAAOpC,GAAOD,EAAMsC,EAAMJ,EAAMG,GAAOD,GAAOpC,EAAMmC,EAAMD,EAAM9B,GACpG3sI,EAAI0b,MAAQ2wH,GAAOM,EAAMkC,EAAMH,EAAME,GAAOpC,GAAON,EAAM2C,EAAML,EAAMI,GAAOD,GAAOzC,EAAMwC,EAAMF,EAAM7B,IACrG3sI,EAAI2b,IAAM0wH,GAAEE,EAAOsC,EAAAJ,EAAYG,GAAnBtC,GAAgCJ,EAAO2C,EAAAL,EAAYI,GAAnDD,GAAgEzC,EAAOuC,EAAAD,EAAYjC,GAC/FvsI,EAAI4b,MAAOywH,GAAOE,EAAMmC,EAAMD,EAAM9B,GAAOL,GAAOJ,EAAMwC,EAAMF,EAAM7B,GAAOH,GAAON,EAAMuC,EAAMD,EAAMjC,IACpGvsI,EAAI6b,MAAQywH,GAAOK,EAAMwC,EAAM1C,EAAMmC,GAAOpC,GAAOD,EAAM4C,EAAM/C,EAAMwC,GAAOD,GAAOpC,EAAME,EAAML,EAAMO,IACrG3sI,EAAI8b,IAAOuwH,GAAOM,EAAMwC,EAAM1C,EAAMmC,GAAOpC,GAAON,EAAMiD,EAAMhD,EAAMyC,GAAOD,GAAOzC,EAAMO,EAAMN,EAAMQ,GACpG3sI,EAAA+b,MAAAswH,GAAAE,EAAA4C,EAAA/C,EAAAwC,GAAAtC,GAAAJ,EAAAiD,EAAAhD,EAAAyC,GAAAD,GAAAzC,EAAAE,EAAAD,EAAAI,IAtBFvsI,EAAAgc,IAAAqwH,GAAAE,EAAAE,EAAAL,EAAAO,GAAAL,GAAAJ,EAAAO,EAAAN,EAAAQ,GAAAH,GAAAN,EAAAE,EAAAD,EAAAI,MAgCEQ,YAAA,SAAAz4J,GAAA,IAA8B+3J,EAAM/3J,EAAE2mC,IAAKixH,EAAM53J,EAAE4mC,IAC/CixH,EAAM73J,EAAE6mC,IAAKqzH,EAAMl6J,EAAE8mC,IAAKkxH,EAAMh4J,EAAE+mC,IAAKkxH,EAAMj4J,EAAEgnC,IAC/C8wH,EAAM93J,EAAEinC,IAAKkzH,EAAMn6J,EAAEknC,IAAKgxH,EAAMl4J,EAAEmnC,IAAKkxH,EAAMr4J,EAAEonC,IAC/C+wH,EAAMn4J,EAAEqnC,IAAK+yH,EAAMp6J,EAAEsnC,IAAK+yH,EAAMr6J,EAAEunC,IAAK+yH,EAAMt6J,EAAEwnC,YAE/C+yH,EAAMv6J,EAAA0nC,WAEAqwH,EAAME,EAAML,EAAMI,IAW5BG,EAAAoC,EAAAH,EAAAS,IAVU9C,EAAMD,EAAMD,EAAMG,cAClBD,EAAMoC,EAAMD,EAAMlC,IAOlBK,EAAMwC,EAAM1C,EAAMmC,IANlB1C,EAAME,EAAMD,EAAMI,IAKlBC,EAAMqC,EAAMH,EAAMC,IAJlBzC,EAAMuC,EAAMD,EAAMjC,IAGlBC,EAAM2C,EAAM1C,EAAMkC,IAFlBxC,EAAMsC,EAAMD,EAAMpC,IAClBI,EAAMoC,EAAMjC,EAAMgC,IAkB5BpyH,SAAyB,SAAzBvc,EAAA1rB,EAAAmD,GAAA,IAA8B40J,EAAM/3J,EAAE2mC,IAAKixH,EAAM53J,EAAE4mC,IAC/CixH,EAAM73J,EAAE6mC,IAAKqzH,EAAMl6J,EAAE8mC,IAAKkxH,EAAMh4J,EAAE+mC,IAAKkxH,EAAMj4J,EAAEgnC,IAC/C8wH,EAAM93J,EAAEinC,IAAKkzH,EAAMn6J,EAAEknC,IAAKgxH,EAAMl4J,EAAEmnC,IAAKkxH,EAAMr4J,EAAEonC,IAC/C+wH,EAAMn4J,EAAEqnC,IAAK+yH,EAAMp6J,EAAEsnC,IAAK+yH,EAAMr6J,EAAEunC,IAAK+yH,EAAMt6J,EAAEwnC,YAEnD+yH,EAAAv6J,EAAA0nC,IAC4BouH,EAAK3yJ,EAAEwjC,IAAKloC,EAAK0E,EAAEyjC,IAC3CloC,EAAJyE,EAAU0jC,IACNloC,EAAJwE,EAAU2jC,WACVpb,EAAIib,IAAMmvH,EAAKiC,EAAMt5J,EAAKu5J,EAAMt5J,EAAKw5J,EAAMv5J,EAAK07J,EAChD3uI,EAAIkb,IAAMkvH,EAAK8B,EAAMn5J,EAAKw5J,EAAMv5J,EAAK25J,EAAM15J,EAAK27J,wBAEhD5uI,EAAAob,IAAAgvH,EAAYoE,EAAAz7J,EAAY07J,EAAAz7J,EAAY07J,EAAAz7J,EAAA47J,EAEpCzE,EAAI3yJ,EAAJ4jC,IAAUtoC,EAAK0E,EAAL6jC,IAAWtoC,EAAKyE,EAAhB8jC,IAAsBtoC,EAAKwE,EAA3B+jC,IACVxb,EAAIqb,IAAM+uH,EAAKiC,EAAMt5J,EAAKu5J,EAAMt5J,EAAKw5J,EAAMv5J,EAAK07J,EAChD3uI,EAAIsb,IAAM8uH,EAAK8B,EAAMn5J,EAAKw5J,EAAMv5J,EAAK25J,EAAM15J,EAAK27J,wBAEhD5uI,EAAAwb,IAAA4uH,EAAYoE,EAAAz7J,EAAY07J,EAAAz7J,EAAY07J,EAAAz7J,EAAA47J,EAEpCzE,EAAI3yJ,EAAJgkC,IAAU1oC,EAAK0E,EAALikC,IAAW1oC,EAAKyE,EAAhBkkC,IAAsB1oC,EAAKwE,EAA3BmkC,IACV5b,EAAIyb,IAAM2uH,EAAKiC,EAAMt5J,EAAKu5J,EAAMt5J,EAAKw5J,EAAMv5J,EAAK07J,EAChD3uI,EAAI0b,IAAM0uH,EAAK8B,EAAMn5J,EAAKw5J,EAAMv5J,EAAK25J,EAAM15J,EAAK27J,wBAEhD5uI,EAAA4b,IAAAwuH,EAAYoE,EAAAz7J,EAAY07J,EAAAz7J,EAAY07J,EAAAz7J,EAAA47J,EAEpCzE,EAAI3yJ,EAAJokC,IAAU9oC,EAAK0E,EAALqkC,IAAW9oC,EAAKyE,EAAhBskC,IAAsB9oC,EAAKwE,EAA3BukC,IACVhc,EAAI6b,IAAMuuH,EAAKiC,EAAMt5J,EAAKu5J,EAAMt5J,EAAKw5J,EAAMv5J,EAAK07J,EAChD3uI,EAAI8b,IAAMsuH,EAAK8B,EAAMn5J,EAAKw5J,EAAMv5J,EAAK25J,EAAM15J,EAAK27J,EAChD5uI,EAAA+b,IAAAquH,EAAA+B,EAAAp5J,EAAAq5J,EAAAp5J,EAAAy5J,EAAAx5J,EAAAk8J,EA9BFnvI,EAAAgc,IAAAouH,EAAAoE,EAAAz7J,EAAA07J,EAAAz7J,EAAA07J,EAAAz7J,EAAA47J,MAuCAz9H,EAAA3hC,IAAA2hC,EAAAmL,SASEnL,EAAAi6B,UAAA,SAAArrC,EAAA1rB,EAAAylB,GAAA,IACcsyI,EAAKH,EACfC,EAAKqC,EAAKlC,EAAKC,EACfH,EAAKqC,EAAKjC,EAAKG,IAEf+B,EALkB7jK,EAAIkvB,EAAElvB,EACxBoE,EADJ8qB,EAAA9qB,EACS0lC,EADT5a,EAAA4a,SAOErgC,IAAA0rB,GACAA,EAAI6b,IAAMvnC,EAAE2mC,IAAMpwC,EAAIyJ,EAAE+mC,IAAMpsC,EAAIqF,EAAEmnC,IAAM9G,EAAIrgC,EAAEunC,IAChD7b,EAAI8b,IAAMxnC,EAAE4mC,IAAMrwC,EAAIyJ,EAAEgnC,IAAMrsC,EAAIqF,EAAEonC,IAAM/G,EAAIrgC,EAAEwnC,IAJlD9b,EAAA+b,IAKOznC,EAAA6mC,IAAAtwC,EAAAyJ,EAAAinC,IAAAtsC,EAAAqF,EAAAqnC,IAAAhH,EAAArgC,EAAAynC,IACL/b,EAAAgc,IAAQ1nC,EAAK8mC,IAAMvwC,EAAEyJ,EAAKknC,IAAMvsC,EAAEqF,EAAKsnC,IAAMjH,EAAErgC,EAAR0nC,MAEvCqwH,EAAM/3J,EAAE2mC,IAAKixH,EAAM53J,EAAE4mC,IAAKixH,EAAM73J,EAAE6mC,IAAKqzH,EAAMl6J,EAAE8mC,oCAE/CoxH,EAAIl4J,EAAJmnC,IAAUkxH,EAASr4J,EAAAonC,IAAM+wH,EAAKn4J,EAAIqnC,IAAJ+yH,EAAep6J,EAAAsnC,IAE7C5b,EAAIib,IAAMoxH,EAAKrsI,EAAIkb,IAAMgxH,EAAKlsI,EAAImb,IAAMgxH,EAAKnsI,EAAIob,IAAMozH,kCAEvDxuI,EAAIyb,IAAM+wH,EAAAxsI,EAAA0b,IAAUixH,EAAV3sI,EAAoB2b,IAApB8wH,EAAgCzsI,EAA1C4b,IAAA8yH,EAEA1uI,EAAI6b,IAAMwwH,EAAMxhK,EAAIyhK,EAAMr9J,EAAIu9J,EAAM73H,EAAIrgC,EAAEunC,IAC1C7b,EAAI8b,IAAMowH,EAAMrhK,EAAI0hK,EAAMt9J,EAAI09J,EAAMh4H,EAAIrgC,EAAEwnC,IAC3C9b,EAAA+b,IAAAowH,EAAAthK,EAAAuhK,EAAAn9J,EAAAw9J,EAAA93H,EAAArgC,EAAAynC,gCAcD3K,EAAA6E,MAAA,SAAAjW,EAAA1rB,EAAAylB,GAAA,IAAsBlvB,EAAIkvB,EAAElvB,QAExB8pC,EAAJ5a,EAAU4a,SAEV3U,EAAIib,IAAM3mC,EAAE2mC,IAAMpwC,EAClBm1B,EAAIkb,IAAM5mC,EAAE4mC,IAAMrwC,EAClBm1B,EAAImb,IAAM7mC,EAAE6mC,IAAMtwC,EAClBm1B,EAAIob,IAAM9mC,EAAE8mC,IAAMvwC,EAClBm1B,EAAIqb,IAAM/mC,EAAE+mC,IAAMpsC,EAClB+wB,EAAIsb,IAAMhnC,EAAEgnC,IAAMrsC,EAClB+wB,EAAIub,IAAMjnC,EAAEinC,IAAMtsC,EAClB+wB,EAAIwb,IAAMlnC,EAAEknC,IAAMvsC,EAClB+wB,EAAIyb,IAAMnnC,EAAEmnC,IAAM9G,EAClB3U,EAAI0b,IAAMpnC,EAAEonC,IAAM/G,EAClB3U,EAAI2b,IAAMrnC,EAAEqnC,IAAZhH,EACA3U,EAAI4b,IAAMtnC,EAAEsnC,IAAZjH,EACA3U,EAAI6b,IAAMvnC,EAAEunC,IACZ7b,EAAI8b,IAAMxnC,EAAEwnC,IACZ9b,EAAA+b,IAAAznC,EAAAynC,IAnBF/b,EAAAgc,IAAA1nC,EAAA0nC,OAgCE5K,EAAAk8H,OAAoB,SAApBttI,EAAA1rB,EAAAi5J,EAAAsD,GAAA,IASI/9J,EAAA4E,EAAM/E,EAAA05J,EAAKH,EAAKC,EAAQqC,EAARlC,EAAgBC,EAApCH,EAAAqC,EAAAjC,EAAAG,EAAAF,EAAAiC,EAAA1B,EAAAN,EAAAO,EAAAC,EAAAL,EAAAM,EAAAC,EAAAR,EAAAS,EAT4BxiK,EAAIgmK,EAAKhmK,EACjCoE,EAAJ4hK,EACI5hK,QASAqqB,EAAK1oB,KAAIoI,KAAOnO,EAAAA,EAApBoE,EAA6BA,EAAA0lC,EAAAA,GAE5B,OAAA/jC,KAAAuK,IAAAme,GAAAsuI,QAKD/8J,GADAyuB,EAAK,EAALA,OAGAqb,GAAIrb,EAEJxmB,EAAIlC,KAAJiF,IAAA03J,GAEA56J,EAAA,kBAEA05J,EAAM/3J,EAAE2mC,IAAKixH,EAAM53J,EAAE4mC,IAAKixH,EAAM73J,EAAE6mC,IAAKqzH,EAAMl6J,EAAE8mC,oCAE/CoxH,EAAAl4J,EAAAmnC,IAAAkxH,EAAAr4J,EAAAonC,IAAA+wH,EAAAn4J,EAAAqnC,IAAA+yH,EAAAp6J,EAAAsnC,IAGAoxH,EAAMniK,EAAIA,EAAI8H,EAAI+E,EAAAg1J,EAAOz9J,EAAMpE,EAAI8H,EAAIgiC,EAAI7hC,EAAAm6J,EAAOt4H,EAAM9pC,EAAI8H,EAAI1D,EAAI6D,oCAEpEs6J,EAAAviK,EAAA8pC,EAAAhiC,EAAA1D,EAAA6D,EAAA85J,EAAA39J,EAAA0lC,EAAAhiC,EAAA9H,EAAAiI,EAAAu6J,EAAA14H,EAAAA,EAAAhiC,EAAA+E,EAGAsoB,EAAIib,IAAMoxH,EAAMW,EAAMV,EAAMI,EAAMF,EAAMS,EACxCjtI,EAAIkb,IAAMgxH,EAAMc,EAAMT,EAAMG,EAAMC,EAAMM,EACxCjtI,EAAImb,IAAMgxH,EAAMa,EAAMZ,EAAMM,EAAMD,EAAMQ,EACxCjtI,EAAIob,IAAMozH,EAAMxB,EAAMyB,EAAM/B,EAAMgC,EAAMzB,EACxCjtI,EAAIqb,IAAMgxH,EAAMa,EAAMZ,EAAMO,EAAML,EAAMW,EACxCntI,EAAIsb,IAAM4wH,EAAMgB,EAAMX,EAAMM,EAAMF,EAAMQ,EACxCntI,EAAIub,IAAM4wH,EAAMe,EAAMd,EAAMS,EAAMJ,EAAMU,EACxCntI,EAAIwb,IAAMgzH,EAAMtB,EAAMuB,EAAM5B,EAAM6B,EAAMvB,EACxCntI,EAAIyb,IAAM4wH,EAAMe,EAAMd,EAAMM,EAAMJ,EAAMa,EACxCrtI,EAAI0b,IAAMwwH,EAAMkB,EAAMb,EAAMK,EAAMD,EAAMU,oBAExCrtI,EAAA4b,IAAA4yH,EAAApB,EAAAqB,EAAA7B,EAAA8B,EAAArB,EAGE/4J,IAAA0rB,IACAA,EAAI6b,IAAMvnC,EAAEunC,IACZ7b,EAAI8b,IAAMxnC,EAAEwnC,IACb9b,EAAA+b,IAAAznC,EAAAynC,qBAcD3K,EAAA6M,QACa,SADbje,EAAA1rB,EAAAi5J,GAAA,IAEIz6J,EAAAlC,KAAQiF,IAFZ03J,GAGI71J,EAAA9G,KAAQ6E,IAHZ83J,GAIIjB,EAAMh4J,EAAE+mC,IACRkxH,EAAMj4J,EAAEgnC,IACR8wH,EAAM93J,EAAEinC,IACRkzH,EAAMn6J,EAAEknC,IACRgxH,EAAMl4J,EAAEmnC,IACRkxH,EAAMr4J,EAAEonC,YAERgzH,EAAMp6J,EAAAsnC,WACRtnC,IAAA0rB,IAEAA,EAAIib,IAAM3mC,EAAE2mC,IACZjb,EAAIkb,IAAM5mC,EAAE4mC,IACZlb,EAAImb,IAAM7mC,EAAE6mC,IACZnb,EAAIob,IAAM9mC,EAAE8mC,IACZpb,EAAI6b,IAAMvnC,EAAEunC,IACZ7b,EAAI8b,IAAMxnC,EAAEwnC,IACb9b,EAAA+b,IAAAznC,EAAAynC,iBAKD/b,EAAIqb,IAAMixH,EAAM50J,EAAI80J,EAAM15J,EAC1BktB,EAAIsb,IAAMixH,EAAM70J,EAAIi1J,EAAM75J,EAC1BktB,EAAIub,IAAM6wH,EAAM10J,EAAI+0J,EAAM35J,EAC1BktB,EAAIwb,IAAMizH,EAAM/2J,EAAIg3J,EAAM57J,EAC1BktB,EAAIyb,IAAM+wH,EAAM90J,EAAI40J,EAAMx5J,EAC1BktB,EAAI0b,IAAMixH,EAAMj1J,EAAI60J,EAAMz5J,gBAE1BktB,EAAA4b,IAAA8yH,EAAAh3J,EAAA+2J,EAAA37J,KAYAs+B,EAAA8M,QACa,SADble,EAAA1rB,EAAAi5J,GAAA,IAEIz6J,EAAAlC,KAAQiF,IAFZ03J,GAGI71J,EAAA9G,KAAQ6E,IAHZ83J,GAIIlB,EAAM/3J,EAAE2mC,IACRixH,EAAM53J,EAAE4mC,IACRixH,EAAM73J,EAAE6mC,IACRqzH,EAAMl6J,EAAE8mC,IACRoxH,EAAMl4J,EAAEmnC,IACRkxH,EAAMr4J,EAAEonC,YAERgzH,EAAMp6J,EAAAsnC,WACRtnC,IAAA0rB,IAEAA,EAAIqb,IAAM/mC,EAAE+mC,IACZrb,EAAIsb,IAAMhnC,EAAEgnC,IACZtb,EAAIub,IAAMjnC,EAAEinC,IACZvb,EAAIwb,IAAMlnC,EAAEknC,IACZxb,EAAI6b,IAAMvnC,EAAEunC,IACZ7b,EAAI8b,IAAMxnC,EAAEwnC,IACb9b,EAAA+b,IAAAznC,EAAAynC,iBAKD/b,EAAIib,IAAMoxH,EAAM30J,EAAI80J,EAAM15J,EAC1BktB,EAAIkb,IAAMgxH,EAAMx0J,EAAIi1J,EAAM75J,EAC1BktB,EAAImb,IAAMgxH,EAAMz0J,EAAI+0J,EAAM35J,EAC1BktB,EAAIob,IAAMozH,EAAM92J,EAAIg3J,EAAM57J,EAC1BktB,EAAIyb,IAAM4wH,EAAMv5J,EAAI05J,EAAM90J,EAC1BsoB,EAAI0b,IAAMwwH,EAAMp5J,EAAI65J,EAAMj1J,gBAE1BsoB,EAAA4b,IAAA4yH,EAAA17J,EAAA47J,EAAAh3J,KAYA05B,EAAA+M,QACa,SADbne,EAAA1rB,EAAAi5J,GAAA,IAEIz6J,EAAAlC,KAAQiF,IAFZ03J,GAGI71J,EAAA9G,KAAQ6E,IAHZ83J,GAIIlB,EAAM/3J,EAAE2mC,IACRixH,EAAM53J,EAAE4mC,IACRixH,EAAM73J,EAAE6mC,IACRqzH,EAAMl6J,EAAE8mC,IACRkxH,EAAMh4J,EAAE+mC,IACRkxH,EAAMj4J,EAAEgnC,YAEZmzH,EAAAn6J,EAAAknC,WAGElnC,IAAA0rB,IACAA,EAAIyb,IAAMnnC,EAAEmnC,IACZzb,EAAI0b,IAAMpnC,EAAEonC,IACZ1b,EAAI2b,IAAMrnC,EAAEqnC,IACZ3b,EAAI4b,IAAMtnC,EAAEsnC,IACZ5b,EAAI6b,IAAMvnC,EAAEunC,IACZ7b,EAAI8b,IAAMxnC,EAAEwnC,IACb9b,EAAA+b,IAAAznC,EAAAynC,iBAKD/b,EAAIib,IAAMoxH,EAAM30J,EAAI40J,EAAMx5J,EAC1BktB,EAAIkb,IAAMgxH,EAAMx0J,EAAI60J,EAAMz5J,EAC1BktB,EAAImb,IAAMgxH,EAAMz0J,EAAI00J,EAAMt5J,EAC1BktB,EAAIob,IAAMozH,EAAM92J,EAAI+2J,EAAM37J,EAC1BktB,EAAIqb,IAAMixH,EAAM50J,EAAI20J,EAAMv5J,EAC1BktB,EAAIsb,IAAMixH,EAAM70J,EAAIw0J,EAAMp5J,gBAE1BktB,EAAAwb,IAAAizH,EAAA/2J,EAAA82J,EAAA17J,KAgBAs+B,EAAAo8H,gBAAA,SAAAxtI,EAAAjG,UACAiG,EAAIib,IAAM,EACVjb,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAM,EACVtb,EAAIub,IAAM,EACVvb,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM,EACVzb,EAAI0b,IAAM,EACV1b,EAAI2b,IAAM,EACV3b,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM9hB,EAAElvB,EACZm1B,EAAI8b,IAAM/hB,EAAV9qB,EACA+wB,EAAA+b,IAAAhiB,EAAA4a,EAjBF3U,EAAAgc,IAAA,KAiCE5K,EAAAs8H,YAAA,SAAA1tI,EAAAjG,UACAiG,EAAIib,IAAMlhB,EAAVlvB,EACAm1B,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAMvhB,EAAV9qB,EACA+wB,EAAIub,IAAM,EACVvb,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM,EACVzb,EAAI0b,IAAM,EACV1b,EAAI2b,IAAM5hB,EAAV4a,EACA3U,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM,EACV7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA,EAjBF/b,EAAAgc,IAAA,KAiCE5K,EAAAq8H,aAAA,SAAAztI,EAAAutI,EAAAsD,GAAA,IAII/9J,EAAA4E,EAAK/E,EAJmB9H,EAAIgmK,EAAKhmK,EACjCoE,EAAA4hK,EAAM5hK,EACN0lC,EAAJk8H,EAAAl8H,2BAIC,OAAA/jC,KAAAuK,IAAAme,GAAAsuI,QAKD/8J,GADAyuB,EAAK,EAALA,OAGAqb,GAAIrb,EAEJxmB,EAAIlC,KAAJiF,IAAA03J,GAEA56J,EAAA,kBAGAqtB,EAAIib,IAAMpwC,EAAIA,EAAI8H,EAAI+E,EACtBsoB,EAAIkb,IAAMjsC,EAAVpE,EAAA8H,EAAAgiC,EAAA7hC,EACAktB,EAAImb,IAAMxG,EAAI9pC,EAAI8H,EAAI1D,EAAI6D,EAC1BktB,EAAIob,IAAM,EACVpb,EAAIqb,IAAMxwC,EAAIoE,EAAI0D,EAAIgiC,EAAI7hC,EAC1BktB,EAAIsb,IAAMrsC,EAAVA,EAAA0D,EAAA+E,EACAsoB,EAAIub,IAAM5G,EAAI1lC,EAAI0D,EAAI9H,EAAIiI,EAC1BktB,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM5wC,EAAI8pC,EAAIhiC,EAAI1D,EAAtB6D,EACAktB,EAAI0b,IAAMzsC,EAAV0lC,EAAAhiC,EAAA9H,EAAAiI,EACAktB,EAAI2b,IAAMhH,EAAVA,EAAAhiC,EAAA+E,EACAsoB,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM,EACV7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA,EAnCF/b,EAAAgc,IAAA,MAkDE5K,EAAA2iI,cACiB,SADjB/zI,EAAAutI,qBAGA71J,EAAA9G,KAAA6E,IAAA83J,UAGAvtI,EAAIib,IAAM,EACVjb,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAM5jC,EACVsoB,EAAIub,IAAMzoC,EACVktB,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM,EACVzb,EAAI0b,KAAJ5oC,EACAktB,EAAI2b,IAAMjkC,EACVsoB,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM,EACV7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA,EArBF/b,EAAAgc,IAAA,KAoCE5K,EAAA4iI,cACiB,SADjBh0I,EAAAutI,qBAGA71J,EAAA9G,KAAA6E,IAAA83J,UAGAvtI,EAAIib,IAAMvjC,EACVsoB,EAAIkb,IAAM,EACVlb,EAAImb,KAAJroC,EACAktB,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAM,EACVtb,EAAIub,IAAM,EACVvb,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM3oC,EACVktB,EAAI0b,IAAM,EACV1b,EAAI2b,IAAMjkC,EACVsoB,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM,EACV7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA,EArBF/b,EAAAgc,IAAA,KAoCE5K,EAAA6iI,cACiB,SADjBj0I,EAAAutI,qBAGA71J,EAAA9G,KAAA6E,IAAA83J,UAGAvtI,EAAIib,IAAMvjC,EACVsoB,EAAIkb,IAAMpoC,EACVktB,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,KAAJvoC,EACAktB,EAAIsb,IAAM5jC,EACVsoB,EAAIub,IAAM,EACVvb,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM,EACVzb,EAAI0b,IAAM,EACV1b,EAAI2b,IAAM,EACV3b,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM,EACV7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA,EArBF/b,EAAAgc,IAAA,KAyCE5K,EAAAm4B,OAAA,SAAAvpC,EAAA/D,EAAAlC,GAAA,IAAsBlvB,EAAIoxB,EAAEpxB,EAAGoE,EAAIgtB,EAAEhtB,EACjC0lC,EAAA1Y,EAAK0Y,EACLkK,EAAA5iB,EAAK4iB,EACLt5B,EAAK1a,EAAIA,QAETgjK,EAAKl5H,EAAIA,EAETm5H,EAAKjjK,EAAI0a,EACT2uJ,EAAKrpK,EAAI2a,EACT2uJ,EAAKtpK,EAAIgjK,EACTG,EAAK/+J,EAAIuW,EACT4uJ,EAAKnlK,EAAI4+J,EACTM,EAAKx5H,EAAIk5H,EACTt0B,EAAK16F,EAAIt5B,QAET6oJ,EAAJvvH,EAAUgvH,SAEV7tI,EAAIib,IAAM,GAAK+yH,EAAfG,GACAnuI,EAAIkb,IAAMg5H,EAAV9F,EACApuI,EAAImb,IAAMg5H,EAAK9F,EACfruI,EAAIob,IAAM,EACVpb,EAAIqb,IAAM64H,EAAK9F,EACfpuI,EAAIsb,IAAM,GAAVwyH,EAAAK,GACAnuI,EAAIub,IAAM64H,EAAK76B,EACfv5G,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM04H,EAAK9F,EACfruI,EAAI0b,IAAM04H,EAAV76B,EACAv5G,EAAI2b,IAAM,GAAVmyH,EAAAE,GACAhuI,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM9hB,EAAElvB,EACZm1B,EAAI8b,IAAM/hB,EAAV9qB,YAEA+wB,EAAAgc,IAAA,KAcA5K,EAAAijI,eAAA,SAAAr0I,EAAAs0I,UACAt0I,EAAIn1B,EAAIypK,EAAIz4H,cAEZ7b,EAAA2U,EAAO2/H,EAAPv4H,OAcA3K,EAAAmjI,WACc,SADdv0I,EAAAs0I,GAAA,IAEI14H,EAAM04H,EAAIr5H,IACVY,EAAMy4H,EAAIp5H,IACVY,EAAMw4H,EAAIn5H,IACV4wH,EAAMuI,EAAIj5H,IACV2wH,EAAMsI,EAAIh5H,IACVo4H,EAAMY,EAAI/4H,IACVq4H,EAAMU,EAAI74H,YAEVq4H,EAAIQ,EAAK34H,WAEb3b,EAAIn1B,EAAI+F,KAAKoI,KAAK4iC,EAAMA,EAAMC,EAAMA,EAAMC,EAAMA,8BAEhD9b,EAAA2U,EAAO/jC,KAAPoI,KAAA46J,EAAAA,EAAAC,EAAAA,EAAAC,EAAAA,MAcA1iI,EAAA62B,YAAgB,SAAUjoC,EAAMs0I,2BAG5BE,EAAA,SAEF1C,EAAQ,GACR0C,EAAQ,EAAJ5jK,KAAKoI,KAAI84J,EAAM,GACnB9xI,EAAI6e,EAAI,IAAK21H,EACbx0I,EAAIn1B,GAAKypK,EAAI/4H,IAAM+4H,EAAI54H,KAAO84H,EALhCx0I,EAAA/wB,GAMYqlK,EAAI74H,IAAM64H,EAAIn5H,KAAQq5H,EAChCx0I,EAAI2U,GAAK2/H,EAALp5H,IAAUo5H,EAAMj5H,KAAUm5H,GACrBF,EAAIr5H,IAAMq5H,EAAIh5H,IAAfg5H,EAARr5H,IAAAq5H,EAAA34H,KACA64H,EAAA,EAAI5jK,KAAIoI,KAAA,EAARs7J,EAAAr5H,IAAAq5H,EAAAh5H,IAAAg5H,EAAA34H,KACA3b,EAAI6e,GAAKy1H,EAAI/4H,IAAM+4H,EAAI54H,KAAO84H,EAC9Bx0I,EAAIn1B,EAAI,IAAK2pK,EALRx0I,EAAA/wB,GAMIqlK,EAAIp5H,IAAMo5H,EAAIj5H,KAAKm5H,EAC5Bx0I,EAAI2U,GAAK2/H,EAAL74H,IAAU64H,EAAMn5H,KAAUq5H,GACrBF,EAAIh5H,IAAMg5H,EAAI34H,KACvB64H,EAAA,EAAI5jK,KAAKoI,KAAI,EAAMs7J,EAAIh5H,IAAOg5H,EAA9Br5H,IAAAq5H,EAAA34H,KACA3b,EAAI6e,GAAIy1H,EAAA74H,IAAR64H,EAAAn5H,KAAAq5H,EACAx0I,EAAIn1B,GAAKypK,EAAIp5H,IAAMo5H,EAAIj5H,KAAOm5H,EALzBx0I,EAAA/wB,EAMA,IAAAulK,EACLx0I,EAAI2U,GAAK2/H,EAAL/4H,IAAU+4H,EAAM54H,KAAU84H,IAE9BA,EAAA,EAAI5jK,KAAKoI,KAAI,EAAMs7J,EAAI34H,IAAO24H,EAA9Br5H,IAAAq5H,EAAAh5H,KACAtb,EAAI6e,GAAKy1H,EAAIp5H,IAAMo5H,EAAIj5H,KAAOm5H,EAC9Bx0I,EAAIn1B,GAAIypK,EAAA74H,IAAR64H,EAAAn5H,KAAAq5H,EACDx0I,EAAA/wB,GAAAqlK,EAAA/4H,IAAA+4H,EAAA54H,KAAA84H,gBAwBDpjI,EAAAuU,QAAA,SAAA3lB,EAAA/D,EAAAlC,EAAAjnB,GAAA,IAAsBjI,EAAIoxB,EAAEpxB,EAAGoE,EAAIgtB,EAAEhtB,EACjC0lC,EAAA1Y,EAAK0Y,EACLkK,EAAA5iB,EAAK4iB,EACLt5B,EAAK1a,EAAIA,QAETgjK,EAAKl5H,EAAIA,EAETm5H,EAAKjjK,EAAI0a,EACT2uJ,EAAKrpK,EAAI2a,EACT2uJ,EAAKtpK,EAAIgjK,EACTG,EAAK/+J,EAAIuW,EACT4uJ,EAAKnlK,EAAI4+J,EACTM,EAAKx5H,EAAIk5H,EACTt0B,EAAK16F,EAAIt5B,EACT8oJ,EAAKxvH,EAATr5B,EACI4oJ,EAAKvvH,EAATgvH,EACI/qJ,EAAKhQ,EAAEjI,QAEPsnK,EAAJr/J,EAAW6hC,SAEX3U,EAAIib,KAAO,GAAK+yH,EAANG,IAAVrrJ,EACAkd,EAAIkb,KAAJg5H,EAAA9F,GAAAtrJ,EACAkd,EAAImb,KAAOg5H,EAAK9F,GAAMvrJ,EACtBkd,EAAIob,IAAM,EACVpb,EAAIqb,KAAO64H,EAAK9F,GAAMrrJ,EACtBid,EAAIsb,KAAJ,GAAAwyH,EAAAK,IAAAprJ,EACAid,EAAIub,KAAO64H,EAAK76B,GAAMx2H,EACtBid,EAAIwb,IAAM,EACVxb,EAAIyb,KAAO04H,EAAK9F,GAAK8D,EACrBnyI,EAAI0b,KAAJ04H,EAAA76B,GAAA44B,EACAnyI,EAAI2b,KAAM,GAAVmyH,EAAAE,IAAAmE,EACAnyI,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM9hB,EAAElvB,EACZm1B,EAAI8b,IAAM/hB,EAAV9qB,YAEA+wB,EAAAgc,IAAA,KAyBA5K,EAAAqjI,cAAA,SAAAz0I,EAAA/D,EAAAlC,EAAAjnB,EAAAstC,GAAA,IAAsBv1C,EAAIoxB,EAAEpxB,EAAGoE,EAAIgtB,EAAEhtB,EACjC0lC,EAAA1Y,EAAK0Y,EACLkK,EAAA5iB,EAAK4iB,EACLt5B,EAAK1a,EAAIA,QAETgjK,EAAKl5H,EAAIA,EAETm5H,EAAKjjK,EAAI0a,EACT2uJ,EAAKrpK,EAAI2a,EACT2uJ,EAAKtpK,EAAIgjK,EACTG,EAAK/+J,EAAIuW,EACT4uJ,EAAKnlK,EAAI4+J,EACTM,EAAKx5H,EAAIk5H,EACTt0B,EAAK16F,EAAIt5B,QAET6oJ,EAAKvvH,EAATgvH,EAEI/qJ,EAAKhQ,EAAEjI,QAEPsnK,EAAKr/J,EAAE6hC,EAEPoP,EAAK3D,EAAEv1C,QAEPo5C,EAAJ7D,EAAWzL,SAEX3U,EAAIib,KAAO,GAAK+yH,EAANG,IAAVrrJ,EACAkd,EAAIkb,KAAJg5H,EAAA9F,GAAAtrJ,EACAkd,EAAImb,KAAOg5H,EAAK9F,GAAMvrJ,EACtBkd,EAAIob,IAAM,EACVpb,EAAIqb,KAAO64H,EAAK9F,GAAMrrJ,EACtBid,EAAIsb,KAAJ,GAAAwyH,EAAAK,IAAAprJ,EACAid,EAAIub,KAAO64H,EAAK76B,GAAMx2H,EACtBid,EAAIwb,IAAM,EACVxb,EAAIyb,KAAO04H,EAAK9F,GAAK8D,EACrBnyI,EAAI0b,KAAJ04H,EAAA76B,GAAA44B,EACAnyI,EAAI2b,KAAM,GAAMmyH,EAANE,IAAgBmE,EAC1BnyI,EAAI4b,IAAM,EACV5b,EAAI6b,IAAM9hB,EAAElvB,EAAIk5C,GAAM/jB,EAAIib,IAAM8I,EAAK/jB,EAAIqb,IAAM2I,EAAKhkB,EAAIyb,IAAMwI,GAC9DjkB,EAAI8b,IAAM/hB,EAAV9qB,EAAA+0C,GAAAhkB,EAAAkb,IAAA6I,EAAA/jB,EAAAsb,IAAA0I,EAAAhkB,EAAA0b,IAAAuI,yCAEAjkB,EAAAgc,IAAA,KAYA5K,EAAAw8H,SAAA,SAAA5tI,EAAA/D,GAAA,IAAsBpxB,EAAIoxB,EAAEpxB,EAAGoE,EAAIgtB,EAAEhtB,EACjC0lC,EAAA1Y,EAAK0Y,EACLkK,EAAA5iB,EAAK4iB,EACLt5B,EAAK1a,EAAIA,QAETgjK,EAAKl5H,EAAIA,EAETm5H,EAAKjjK,EAAI0a,EACTwoJ,EAAK9+J,EAAIsW,EACTyoJ,EAAK/+J,EAAIuW,EACTyoJ,EAAKt5H,EAAIpvB,EACT2oJ,EAAKv5H,EAAInvB,EACT2oJ,EAAKx5H,EAAIk5H,EACTt0B,EAAK16F,EAAIt5B,QAET6oJ,EAAJvvH,EAAUgvH,SAEV7tI,EAAIib,IAAM,EAAA+yH,EAAVG,EACAnuI,EAAIkb,IAAM6yH,EAAVK,YAEApuI,EAAIob,IAAM,EAEVpb,EAAIqb,IAAM0yH,EAAKK,EACfpuI,EAAIsb,IAAM,EAAVwyH,EAAAK,YAEAnuI,EAAIwb,IAAM,EAEVxb,EAAIyb,IAAMwyH,EAAII,EACdruI,EAAI0b,IAAMwyH,EAAV30B,cAEAv5G,EAAI4b,IAAM,EAEV5b,EAAI6b,IAAM,EACV7b,EAAI8b,IAAM,UAEV9b,EAAAgc,IAAA,KAiBA5K,EAAAsjI,QAAS,SAAW10I,EAApBgqB,EAAAm6B,EAAAe,EAAAn7B,EAAA4qH,EAAAC,GACA,IAAIC,EAAK,GAAK1wF,EAAOn6B,aAEjB8qH,EAAJ,GAAWH,EAAYC,UAEvB50I,EAAIib,IAAJ,EAAU05H,EAAVE,EACA70I,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAO,EACXpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAJ,EAAUq5H,EAAVI,EACA/0I,EAAIub,IAAM,EACVvb,EAAIwb,IAAM,EACVxb,EAAIyb,KAAO0oC,EAAMn6B,GAAjB6qH,EACA70I,EAAI0b,KAAOqO,EAAXm7B,GAAA6vF,EACA/0I,EAAI2b,KAAJi5H,EAAAD,GAAAG,EACA90I,EAAI4b,KAAJ,EACA5b,EAAI6b,IAAO,EACX7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA64H,EAAAD,EAAA,EAAAG,EArBF90I,EAAAgc,IAAA,KAoCE5K,EAAA4jI,YAAc,SAAdh1I,EAAAi1I,EAAAC,EAAAP,EAAAC,yBAEIE,EAAJ,GAAcH,EAAdC,UAEA50I,EAAIib,IAAMuhG,EAAV04B,EACAl1I,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAMkhG,EACVx8G,EAAIub,IAAM,EACVvb,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM,EACVzb,EAAI0b,IAAM,EACV1b,EAAI2b,KAAJi5H,EAAAD,GAAAG,EACA90I,EAAI4b,KAAJ,EACA5b,EAAI6b,IAAO,EACX7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA,EAAA64H,EAAAD,EAAAG,EApBF90I,EAAAgc,IAAA,KAoCE5K,EAAA+jI,2BAA2B,SAAcn1I,EAAK2oD,EAAKgsF,EAAnDC,GACA,IAAIQ,EAAAxkK,KAAUm1C,IAAK4iC,EAAI0sF,UAAIzkK,KAAc8E,GAAK,KAC1C4/J,EAAA1kK,KAAWm1C,IAAA4iC,EAAS4sF,YAAA3kK,KAAmB8E,GAAnB,KACpB8/J,EAAS5kK,KAAAm1C,IAAO4iC,EAAA8sF,YAApB7kK,KAAA8E,GAAA,KACIggK,EAAS9kK,KAAOm1C,IAAA4iC,EAAQgtF,aAA5B/kK,KAAA8E,GAAA,eAEIuvJ,EAAM,GAAVmQ,EAAAE,UAEAt1I,EAAIib,IAAM+pH,EACVhlI,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,IAAM2pH,EACVjlI,EAAIub,IAAM,EACVvb,EAAIwb,IAAO,EACXxb,EAAIyb,MAAM+5H,EAAOE,GAAjB1Q,EAAA,GACAhlI,EAAI0b,KAAO05H,EAAXE,GAAArQ,EAAA,GACAjlI,EAAI2b,IAAMi5H,GAAVD,EAAAC,GACA50I,EAAI4b,KAAM,EACV5b,EAAI6b,IAAO,EACX7b,EAAI8b,IAAM,EACV9b,EAAA+b,IAAA64H,EAAAD,GAAAA,EAAAC,GAxBF50I,EAAAgc,IAAA,KAyCE5K,EAAA43C,MAAS,SAAKhpD,EAALgqB,EAATm6B,EAAAe,EAAAn7B,EAAA4qH,EAAAC,GACA,IAAIgB,EAAK,GAAK5rH,EAAOm6B,GACjB0xF,EAAJ,GAAU3wF,EAAVn7B,GACI+qH,EAAJ,GAAAH,EAAAC,UACA50I,EAAIib,KAAJ,EAAA26H,EACA51I,EAAIkb,IAAM,EACVlb,EAAImb,IAAM,EACVnb,EAAIob,IAAM,EACVpb,EAAIqb,IAAM,EACVrb,EAAIsb,KAAJ,EAAAu6H,EACA71I,EAAIub,IAAM,EACVvb,EAAIwb,IAAM,EACVxb,EAAIyb,IAAM,EACVzb,EAAI0b,IAAM,EACV1b,EAAI2b,IAAM,EAACm5H,EACX90I,EAAI4b,IAAM,EACV5b,EAAI6b,KAAOmO,EAAMm6B,GAAjByxF,EACA51I,EAAI8b,KAAJiO,EAAAm7B,GAAA2wF,EACA71I,EAAA+b,KAAA64H,EAAAD,GAAAG,EApBF90I,EAAAgc,IAAA,KAkCE5K,EAAAkT,OAAW,SAAXtkB,EAAA81I,EAAA/2H,EAAAyqB,GACA,IAAIrkD,EAAAE,EAAOE,EAAXH,EAAAE,EAAAE,EAAAuwJ,EAAAC,EAAAnI,EAAAv0I,EACI28I,EAAOH,EAAIjrK,EACXqrK,EAAMJ,EAAV7mK,EACIknK,EAAML,EAAVnhI,EACIyhI,EAAM5sG,EAAG3+D,EACTwrK,EAAA7sG,EAAAv6D,EACAqnK,EAAA9sG,EAAA70B,EACA4hI,EAAUx3H,EAAOl0C,QAGnB2rK,EAASz3H,EAAOpK,EAKjB,OAAA/jC,KAAAuK,IAAA86J,EAAAM,GAAA3O,GAAAh3J,KAAAuK,IAAA+6J,EAAAO,GAAA7O,GAAAh3J,KAAAuK,IAAAg7J,EAAAK,GAAA5O,iBAIDmO,EAAKE,EAAOM,QAEZ1I,EAAAsI,EAAUK,EAOVrxJ,EAAKkxJ,GAFLxI,GAHAv0I,EAAM,EAAN1oB,KAAAoI,KAAA+8J,EAAAA,EAAAC,EAAAA,EAAAnI,EAAAA,IAKgByI,SAChBjxJ,EAAAixJ,GALAP,GAAMz8I,GAKU88I,EAAKvI,EACrBtoJ,EAAK6wJ,EAAKJ,EAAAK,EAAAN,GACRz8I,EAAA1oB,KAAAoI,KAAAmM,EAAAA,EAAAE,EAAAA,EAAAE,EAAAA,KAOAJ,GADAmU,EAAM,EAANA,EAEDjU,GAAAiU,SANCnU,EAAK,EAHPE,EAIO,EACLE,EAAA,GAQFH,EAAK4wJ,EAAKzwJ,EAAKsoJ,EAAKxoJ,YAEpBG,EAAAuwJ,EAAM1wJ,EAAA2wJ,EAAU7wJ,GAEdmU,EAAA1oB,KAAAoI,KAAAoM,EAAAA,EAAAE,EAAAA,EAAAE,EAAAA,KAOAJ,GADAkU,EAAM,EAANA,EAEDhU,GAAAgU,SANClU,EAAK,EAHPE,EAIO,EACLE,EAAA,GAQFwa,EAAIib,IAAM91B,EACV6a,EAAIkb,IAAM91B,EACV4a,EAAImb,IAAM46H,EACV/1I,EAAIob,IAAM,EACVpb,EAAIqb,IAAMh2B,EACV2a,EAAIsb,IAAMh2B,EACV0a,EAAIub,IAAMy6H,EACVh2I,EAAIwb,IAAM,EACVxb,EAAIyb,IAAMl2B,EACVya,EAAI0b,IAAMl2B,EACVwa,EAAI2b,IAAMkyH,EACV7tI,EAAI4b,IAAM,EACV5b,EAAI6b,MAAQ12B,EAAK8wJ,EAAO5wJ,EAAK6wJ,EAAO3wJ,EAAK4wJ,GACzCn2I,EAAI8b,MAAJ12B,EAAA6wJ,EAAA3wJ,EAAA4wJ,EAAA1wJ,EAAA2wJ,wBAEAn2I,EAAAgc,IAAA,MAWD5K,EAFDo6G,IAAA,SAAAl3I,iMAaE88B,EAAAvjB,MAAY,SAAZmS,EAAAnZ,UACAmZ,EAAI,GAAMnZ,EAAEo0B,IACZjb,EAAI,GAAMnZ,EAAEq0B,IACZlb,EAAI,GAAMnZ,EAAEs0B,IACZnb,EAAI,GAAMnZ,EAAEu0B,IACZpb,EAAI,GAAMnZ,EAAEw0B,IACZrb,EAAI,GAAMnZ,EAAEy0B,IACZtb,EAAI,GAAMnZ,EAAE00B,IACZvb,EAAI,GAAMnZ,EAAE20B,IACZxb,EAAI,GAAJnZ,EAAU40B,IACVzb,EAAI,GAAJnZ,EAAU60B,IACV1b,EAAI,IAAMnZ,EAAE80B,IACZ3b,EAAI,IAAMnZ,EAAE+0B,IACZ5b,EAAI,IAAMnZ,EAAEg1B,IACZ7b,EAAI,IAAMnZ,EAAEi1B,gBAEZ9b,EAAA,IAAAnZ,EAAAm1B,OAWD5K,EAFDk+H,KAAA,SAAAh7J,sTAcE88B,EAAAhhC,IAAA,SAAkB4vB,EAAlB1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAAEwjC,IACpBjb,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAAEyjC,IACpBlb,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAAE0jC,IACpBnb,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAAE2jC,IACpBpb,EAAIqb,IAAM/mC,EAAE+mC,IAAM5jC,EAAE4jC,IACpBrb,EAAIsb,IAAMhnC,EAAEgnC,IAAM7jC,EAAE6jC,IACpBtb,EAAIub,IAAMjnC,EAAEinC,IAAM9jC,EAAE8jC,IACpBvb,EAAIwb,IAAMlnC,EAAEknC,IAAM/jC,EAAE+jC,IACpBxb,EAAIyb,IAAMnnC,EAAEmnC,IAAMhkC,EAAEgkC,IACpBzb,EAAI0b,IAAMpnC,EAAEonC,IAAMjkC,EAAEikC,IACpB1b,EAAI2b,IAAMrnC,EAAEqnC,IAAMlkC,EAAEkkC,IACpB3b,EAAI4b,IAAMtnC,EAAEsnC,IAAMnkC,EAAEmkC,IACpB5b,EAAI6b,IAAMvnC,EAAEunC,IAAMpkC,EAAEokC,IACpB7b,EAAI8b,IAAMxnC,EAAEwnC,IAAMrkC,EAAEqkC,IACpB9b,EAAA+b,IAAAznC,EAAAynC,IAAAtkC,EAAAskC,IAjBF/b,EAAAgc,IAAA1nC,EAAA0nC,IAAAvkC,EAAAukC,OA8BE5K,EAAAi4H,SAAY,SAAZrpI,EAAA1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAAEwjC,IACpBjb,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAAEyjC,IACpBlb,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAAE0jC,IACpBnb,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAAE2jC,IACpBpb,EAAIqb,IAAM/mC,EAAE+mC,IAAM5jC,EAAE4jC,IACpBrb,EAAIsb,IAAMhnC,EAAEgnC,IAAM7jC,EAAE6jC,IACpBtb,EAAIub,IAAMjnC,EAAEinC,IAAM9jC,EAAE8jC,IACpBvb,EAAIwb,IAAMlnC,EAAEknC,IAAM/jC,EAAE+jC,IACpBxb,EAAIyb,IAAMnnC,EAAEmnC,IAAMhkC,EAAEgkC,IACpBzb,EAAI0b,IAAMpnC,EAAEonC,IAAMjkC,EAAEikC,IACpB1b,EAAI2b,IAAMrnC,EAAEqnC,IAAMlkC,EAAEkkC,IACpB3b,EAAI4b,IAAMtnC,EAAEsnC,IAAMnkC,EAAEmkC,IACpB5b,EAAI6b,IAAMvnC,EAAEunC,IAAMpkC,EAAEokC,IACpB7b,EAAI8b,IAAMxnC,EAAEwnC,IAAMrkC,EAAEqkC,IACpB9b,EAAA+b,IAAAznC,EAAAynC,IAAAtkC,EAAAskC,IAjBF/b,EAAAgc,IAAA1nC,EAAA0nC,IAAAvkC,EAAAukC,OA0BA5K,EAAAphC,IAAAohC,EAAAi4H,SAUEj4H,EAAAm+H,eAAA,SAAAvvI,EAAA1rB,EAAAmD,UACAuoB,EAAIib,IAAM3mC,EAAE2mC,IAAMxjC,EAClBuoB,EAAIkb,IAAM5mC,EAAE4mC,IAAMzjC,EAClBuoB,EAAImb,IAAM7mC,EAAE6mC,IAAM1jC,EAClBuoB,EAAIob,IAAM9mC,EAAE8mC,IAAM3jC,EAClBuoB,EAAIqb,IAAM/mC,EAAE+mC,IAAM5jC,EAClBuoB,EAAIsb,IAAMhnC,EAAEgnC,IAAM7jC,EAClBuoB,EAAIub,IAAMjnC,EAAEinC,IAAM9jC,EAClBuoB,EAAIwb,IAAMlnC,EAAEknC,IAAM/jC,EAClBuoB,EAAIyb,IAAMnnC,EAAEmnC,IAAMhkC,EAClBuoB,EAAI0b,IAAMpnC,EAAEonC,IAAMjkC,EAClBuoB,EAAI2b,IAAMrnC,EAAEqnC,IAAMlkC,EAClBuoB,EAAI4b,IAAMtnC,EAAEsnC,IAAMnkC,EAClBuoB,EAAI6b,IAAMvnC,EAAEunC,IAAMpkC,EAClBuoB,EAAI8b,IAAMxnC,EAAEwnC,IAAMrkC,EAClBuoB,EAAA+b,IAAAznC,EAAAynC,IAAAtkC,EAjBFuoB,EAAAgc,IAAA1nC,EAAA0nC,IAAAvkC,KA+BE25B,EAAAo+H,qBAA2B,SAA3BxvI,EAAA1rB,EAAAmD,EAAAw+B,UACAjW,EAAIib,IAAM3mC,EAAE2mC,IAAOxjC,EAAEwjC,IAAMhF,EAC3BjW,EAAIkb,IAAM5mC,EAAE4mC,IAAOzjC,EAAEyjC,IAAMjF,EAC3BjW,EAAImb,IAAM7mC,EAAE6mC,IAAO1jC,EAAE0jC,IAAMlF,EAC3BjW,EAAIob,IAAM9mC,EAAE8mC,IAAO3jC,EAAE2jC,IAAMnF,EAC3BjW,EAAIqb,IAAM/mC,EAAE+mC,IAAO5jC,EAAE4jC,IAAMpF,EAC3BjW,EAAIsb,IAAMhnC,EAAEgnC,IAAO7jC,EAAE6jC,IAAMrF,EAC3BjW,EAAIub,IAAMjnC,EAAEinC,IAAO9jC,EAAE8jC,IAAMtF,EAC3BjW,EAAIwb,IAAMlnC,EAAEknC,IAAO/jC,EAAE+jC,IAAMvF,EAC3BjW,EAAIyb,IAAMnnC,EAAEmnC,IAAOhkC,EAAEgkC,IAAMxF,EAC3BjW,EAAI0b,IAAMpnC,EAAEonC,IAAOjkC,EAAEikC,IAAMzF,EAC3BjW,EAAI2b,IAAMrnC,EAAEqnC,IAAOlkC,EAAEkkC,IAAM1F,EAC3BjW,EAAI4b,IAAMtnC,EAAEsnC,IAAOnkC,EAAEmkC,IAAM3F,EAC3BjW,EAAI6b,IAAMvnC,EAAEunC,IAAOpkC,EAAEokC,IAAM5F,EAC3BjW,EAAI8b,IAAMxnC,EAAEwnC,IAAOrkC,EAAEqkC,IAAM7F,EAC3BjW,EAAA+b,IAAAznC,EAAAynC,IAAAtkC,EAAAskC,IAAA9F,EAjBFjW,EAAAgc,IAAA1nC,EAAA0nC,IAAAvkC,EAAAukC,IAAA/F,KAgCC7E,EALD64H,YAAA,SAAA31J,EAAAmD,0PAeE25B,EAAAuwB,OAAuB,SAAvBrtD,EAAAmD,GAAA,IAA4ByyJ,EAAK51J,EAAE2mC,IAAKkvH,EAAK71J,EAAE4mC,IAC3CqwH,EAAKj3J,EAAE6mC,IAAKnf,EAAK1nB,EAAE8mC,IAAKq0H,EAAKn7J,EAAE+mC,IAAKq0H,EAAKp7J,EAAEgnC,IAC3Cq0H,EAAKr7J,EAAEinC,IAAKq0H,EAAKt7J,EAAEknC,IAAKq0H,EAAAv7J,EAAMmnC,IAAOi7H,EAAApiK,EAAMonC,IAC3C4wH,EAAMh4J,EAAEqnC,IAAK4wH,EAAMj4J,EAAEsnC,IAAKwwH,EAAM93J,EAAEunC,IAAK4yH,EAAMn6J,EAAEwnC,YAE/C66H,EAAKriK,EAAE0nC,IAAiBouH,EAAK3yJ,EAAEwjC,IAAKloC,EAAK0E,EAAEyjC,IAC3CloC,EAAKyE,EAAE0jC,IAAKloC,EAAKwE,EAAE2jC,IAAKloC,EAAKuE,EAAE4jC,IAAKy0H,EAAKr4J,EAAE6jC,IAC3Cy0H,EAAKt4J,EAAE8jC,IAAKy0H,EAAKv4J,EAAE+jC,IAAKy0H,EAAAx4J,EAAMgkC,IAAOm7H,EAAAn/J,EAAMikC,IAC3CwxH,EAAMz1J,EAAEkkC,IAAKkxH,EAAMp1J,EAAEmkC,IAAKuxH,EAAM11J,EAAEokC,IAAKg7H,EAAMp/J,EAAEqkC,YAEnDg7H,EACEr/J,EAAKukC,22BAqBT,IAAI+6H,EAAA,IAAUn4J,MAAS,GAErBo4J,EAAA,SAAAvxJ,EAAAyC,EAAAzQ,GACAlM,KAAKka,EAAIA,EAHXla,KAAA2c,EAAAA,YAQE8uJ,EAAAnpK,UAAYu7J,OAAZ,kBACA2N,EAAO,GAAKxrK,KAAKka,cAEjBsxJ,EAAO,GAAAxrK,KAAPkM,KASF,IAAAw/J,GAOC5+H,OAFD,gCAeChH,IAFD,SAAA5rB,EAAAyC,EAAAzQ,wBAaC7L,MAFD,SAAA0I,kCAcEmrC,KAAA,SAAAzf,EAAA1rB,UACA0rB,EAAIva,EAAInR,EAAEmR,EACVua,EAAA9X,EAAO5T,EAAP4T,EAJF8X,EAAAvoB,EAAAnD,EAAAmD,KAmBE4f,IAAA,SAAA2I,EAAAva,EAAAyC,EAAAzQ,UACAuoB,EAAIva,EAAIA,EACRua,EAAA9X,EAAOA,EAJT8X,EAAAvoB,EAAAA,KAiBEy/J,QAAU,SAAFl3I,EAAsBm3I,GAC9B,IAAI1xJ,GAAM0xJ,GAAO,IAAT,qBAEJ1/J,GAAJ,IAAA0/J,GAAA,WAEAn3I,EAAIva,EAAIA,EACRua,EAAA9X,EAAOA,EART8X,EAAAvoB,EAAAA,KAsBErH,IAAQ,SAAR4vB,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EAAEgO,EAChBua,EAAA9X,EAAO5T,EAAP4T,EAAAzQ,EAAAyQ,EAJF8X,EAAAvoB,EAAAnD,EAAAmD,EAAAA,EAAAA,KAiBE4xJ,SAAgB,SAAhBrpI,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EAAEgO,EAChBua,EAAA9X,EAAO5T,EAAP4T,EAAAzQ,EAAAyQ,EAJF8X,EAAAvoB,EAAAnD,EAAAmD,EAAAA,EAAAA,MAaAw/J,EAAAjnK,IAAAinK,EAAA5N,SAWE4N,EAAA16H,SAAgB,SAAhBvc,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EAAEgO,EAChBua,EAAA9X,EAAO5T,EAAP4T,EAAAzQ,EAAAyQ,EAJF8X,EAAAvoB,EAAAnD,EAAAmD,EAAAA,EAAAA,KAaAw/J,EAAAxnK,IAAAwnK,EAAA16H,SAUE06H,EAAA3N,OAAc,SAAdtpI,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EAAEgO,EAChBua,EAAA9X,EAAO5T,EAAP4T,EAAAzQ,EAAAyQ,EAJF8X,EAAAvoB,EAAAnD,EAAAmD,EAAAA,EAAAA,KAcAw/J,EAAA9tG,IAAA8tG,EAAA3N,OAWE2N,EAAAhhI,MAAQ,SAARjW,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EACduoB,EAAA9X,EAAO5T,EAAP4T,EAAAzQ,EAJFuoB,EAAAvoB,EAAAnD,EAAAmD,EAAAA,KAkBEw/J,EACIzhJ,KADJ,SAAAwK,EAAA1rB,EAAAmD,EAAA9E,GAAA,IAEIykK,EAAK9iK,EAAEmR,EACP4xJ,EAAI/iK,EAAA4T,EACJ44B,EAAIxsC,EAAAmD,SACRuoB,EAAIva,EAAI2xJ,EAAKzkK,GAAK8E,EAAEgO,EAAI2xJ,GACxBp3I,EAAA9X,EAAOmvJ,EAAP1kK,GAAA8E,EAAAyQ,EAAAmvJ,GAPFr3I,EAAAvoB,EAAAqpC,EAAAnuC,GAAA8E,EAAAA,EAAAqpC,MAkBCm2H,EAFDzrB,IAAA,SAAAl3I,8CAaE2iK,EAAAppJ,MAAA,SAAAmS,EAAA1rB,UACA0rB,EAAI,GAAK1rB,EAAEmR,WAEXua,EAAA,GAAO1rB,EAAPmD,KAYDw/J,EAFDhN,YAAA,SAAA31J,EAAAmD,2CAYEw/J,EAAct1G,OAAd,SAAArtD,EAAAmD,GAAA,IAAwByyJ,EAAK51J,EAAEmR,EAC3B0kJ,EAAK71J,EAAE4T,EAAGqjJ,EAAKj3J,EAAEmD,EAAG2yJ,EAAK3yJ,EAAEgO,EAC/B1S,EAAQ0E,EAAAyQ,EAHVlV,EAAAyE,EAAAA,2KAgBCw/J,EAFDE,IAAA,SAAA7iK,0CAMA,IAAIgjK,EAAA,IAAU14J,MAAS,GAErB24J,EAAA,SAAA9xJ,EAAAyC,EAAAzQ,EAAAnD,GACA/I,KAAKka,EAAIA,EACTla,KAAK2c,EAAIA,EAJX3c,KAAAkM,EAAAA,YASE8/J,EAAA1pK,UAAYu7J,OAAZ,kBACAkO,EAAO,GAAK/rK,KAAKka,EACjB6xJ,EAAO,GAAK/rK,KAAK2c,cAEjBovJ,EAAO,GAAA/rK,KAAP+I,KASF,IAAAkjK,GAOCn/H,OAFD,kCAgBChH,IAFD,SAAA5rB,EAAAyC,EAAAzQ,EAAAnD,0BAaC1I,MAFD,SAAA0I,kCAcEmrC,KAAA,SAAAzf,EAAA1rB,UACA0rB,EAAIva,EAAInR,EAAEmR,EACVua,EAAI9X,EAAI5T,EAAE4T,EACV8X,EAAAvoB,EAAOnD,EAAPmD,EALFuoB,EAAA1rB,EAAAA,EAAAA,KAqBE+iB,IAAA,SAAA2I,EAAAva,EAAAyC,EAAAzQ,EAAAnD,UACA0rB,EAAIva,EAAIA,EACRua,EAAI9X,EAAIA,EACR8X,EAAAvoB,EAAOA,EALTuoB,EAAA1rB,EAAAA,KAkBE4iK,QAAU,SAAFl3I,EAAuBm3I,GAC/B,IAAI1xJ,GAAM0xJ,GAAO,IAAK,IAClBjvJ,GAAMivJ,GAAO,GAAT,KAAR,qBAEI7iK,GAAJ,IAAA6iK,GAAA,WAEAn3I,EAAIva,EAAIA,EACRua,EAAI9X,EAAIA,EACR8X,EAAAvoB,EAAOA,EAVTuoB,EAAA1rB,EAAAA,KAwBElE,IAAQ,SAAR4vB,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EAAEgO,EAChBua,EAAI9X,EAAI5T,EAAE4T,EAAIzQ,EAAEyQ,EAChB8X,EAAAvoB,EAAOnD,EAAPmD,EAAAA,EAAAA,EALFuoB,EAAA1rB,EAAAA,EAAAA,EAAAmD,EAAAnD,KAkBE+0J,SAAgB,SAAhBrpI,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EAAEgO,EAChBua,EAAI9X,EAAI5T,EAAE4T,EAAIzQ,EAAEyQ,EAChB8X,EAAAvoB,EAAOnD,EAAPmD,EAAAA,EAAAA,EALFuoB,EAAA1rB,EAAAA,EAAAA,EAAAmD,EAAAnD,MAcAkjK,EAAAxnK,IAAAwnK,EAAAnO,SAWEmO,EAAAj7H,SAAgB,SAAhBvc,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EAAEgO,EAChBua,EAAI9X,EAAI5T,EAAE4T,EAAIzQ,EAAEyQ,EAChB8X,EAAAvoB,EAAOnD,EAAPmD,EAAAA,EAAAA,EALFuoB,EAAA1rB,EAAAA,EAAAA,EAAAmD,EAAAnD,KAcAkjK,EAAA/nK,IAAA+nK,EAAAj7H,SAUEi7H,EAAAlO,OAAc,SAAdtpI,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EAAEgO,EAChBua,EAAI9X,EAAI5T,EAAE4T,EAAIzQ,EAAEyQ,EAChB8X,EAAAvoB,EAAOnD,EAAPmD,EAAAA,EAAAA,EALFuoB,EAAA1rB,EAAAA,EAAAA,EAAAmD,EAAAnD,KAeAkjK,EAAAruG,IAAAquG,EAAAlO,OAWEkO,EAAAvhI,MAAQ,SAARjW,EAAA1rB,EAAAmD,UACAuoB,EAAIva,EAAInR,EAAEmR,EAAIhO,EACduoB,EAAI9X,EAAI5T,EAAE4T,EAAIzQ,EACduoB,EAAAvoB,EAAOnD,EAAPmD,EAAAA,EALFuoB,EAAA1rB,EAAAA,EAAAA,EAAAmD,KAmBE+/J,EACIhiJ,KADJ,SAAAwK,EAAA1rB,EAAAmD,EAAA9E,GAAA,IAEIykK,EAAK9iK,EAAEmR,EACP4xJ,EAAK/iK,EAAE4T,EACP44B,EAAIxsC,EAAAmD,EACJwyD,EAAI31D,EAAAA,SACR0rB,EAAIva,EAAI2xJ,EAAKzkK,GAAK8E,EAAEgO,EAAI2xJ,GACxBp3I,EAAI9X,EAAImvJ,EAAK1kK,GAAK8E,EAAEyQ,EAAImvJ,GACxBr3I,EAAAvoB,EAAOqpC,EAAPnuC,GAAA8E,EAAAA,EAAAqpC,GATF9gB,EAAA1rB,EAAA21D,EAAAt3D,GAAA8E,EAAAnD,EAAA21D,MAoBCutG,EAFDhsB,IAAA,SAAAl3I,uDAaEkjK,EAAA3pJ,MAAA,SAAAmS,EAAA1rB,UACA0rB,EAAI,GAAK1rB,EAAEmR,EACXua,EAAI,GAAK1rB,EAAE4T,WAEX8X,EAAA,GAAO1rB,EAAPA,KAYDkjK,EAFDvN,YAAA,SAAA31J,EAAAmD,sDAYE+/J,EAAc71G,OAAd,SAAArtD,EAAAmD,GAAA,IAAwByyJ,EAAK51J,EAAEmR,EAAG0kJ,EAAK71J,EAAE4T,EACrCqjJ,EAAKj3J,EAAEmD,EAAGukB,EAAK1nB,EAAEA,EAAG81J,EAAK3yJ,EAAEgO,EAAG1S,EAAK0E,EAAEyQ,EACzClV,EAAQyE,EAAAA,EAHVxE,EAAAwE,EAAAnD,iOAiBCkjK,EAFDL,IAAA,SAAA7iK,2DASA,IAAImjK,EAAOrP,EAEVjjH,EAAM0K,OAFkBw4G,QAGxBoP,KAAMA,EACNnwG,KAAMA,EACN16B,KAAMA,EACN8+H,KAAMA,EACN51H,KAAAA,EACA+8H,KAAMA,EACNS,MAAMA,EACNj1H,KAAAA,EACAjN,KAAAA,EACA6lI,OAAAA,EACAO,OAAQA,EACR5P,QAAQA,EACRjmG,OApnOA,SAAArtD,EAAAmD,gEAqnOAigK,OAzmOC,SAAYpjK,EAAImD,EAAIkgK,UACrBA,EAAAA,GAAA/P,oBAymOAgQ,MA5lOA,SAAAlhI,EAAA7lC,EAAAC,yBA6lOAmgF,QAllOA,SAAAv6C,yBAmlOAlhB,KAxkOA,SAAAqiJ,EAAAC,EAAAroJ,qBAykOAo4I,SAAQA,EACRC,SAAAA,EACAptC,OAAAA,EACAqtC,YAAUA,EAvBXgQ,eAtgOC,SAAAlnK,EAAAC,uCAWC,SAAM4lC,WACNA,EACAA,GAAOA,GAAO,EACdA,GAAOA,GAAO,EACdA,GAAOA,GAAO,EACdA,GAAAA,GAAA,aAEAA,KAkhOAs8F,sBAGAglC,WAAA,EAGAC,kBARU,gBAUVC,WAAA,EAGAC,YAAa,gBAEbC,YAAA,EAGAC,UAAA,EACAC,WAAuB,EACvBC,WAAA,EACAC,WAAA,EACAC,YAAA,EACAC,aAAuB,EACvBC,aAAuB,EACvBC,aAAuB,EACvBC,aA1BU,EA2BVC,aA3BU,EA4BVC,WAAsB,GACtBC,WAAA,GACAC,WAAA,uBAEAC,mBAAA,GAGAC,YAAA,EAnCFC,YAAA,mBAgFIC,IAxCA,KAE2B,YAD3B,KAE0B,KAE9B,OAqCIC,IAEFhkG,OAvBE,KAuBFikG,eAlBE,MAkBFC,UAAA,OAGAlkG,OAzBE,KAyBFikG,eApBqC,MAoBrCC,UAAA,OAGAlkG,OA5BE,KA4BFikG,qBAAAC,UAAA,OAGAlkG,OA/BE,KA+BFikG,eAxBE,MAwBFC,UAAA,OAGAlkG,OAnCE,KAmCFikG,eAnBe,MAmBfC,UAAA,OAGAlkG,OAtCE,KAsCFikG,eA3BE,MA2BFC,UAAA,OAGAlkG,OAxCE,KAwCFikG,qBAAAC,UAAA,OAGAlkG,OA5CE,KA4CFikG,eAlCE,MAkCFC,UAAA,OAGAlkG,OA9CE,KA8CFikG,qBAAAC,UAAA,OAGAlkG,OAnDY,KAmDZikG,eAnDY,KAmDZC,UA/DE,OAkEFlkG,YAAAikG,oBAAAC,UAlEE,OAqEFlkG,OArDE,KAqDFikG,eArDE,KAqDFC,UArEE,OAwEFlkG,OA3DE,KA2DFikG,eA3DE,KA2DFC,UAnEE,QAsEFlkG,OA7DE,KA6DFikG,eA7DE,KA6DFC,kBAGAlkG,OAhEE,KAgEFikG,eAhEE,KAgEFC,UAxEsC,QA2EtClkG,OApEE,KAoEFikG,eApEE,KAoEFC,UAjFE,OAoFFlkG,OAtEE,KAsEFikG,eAtEE,KAsEFC,UApFE,OAuFFlkG,OA1EE,KA0EFikG,eA1EE,KA0EFC,UA/EE,QAkFFlkG,OA5EE,KA4EFikG,eA5EE,KA4EFC,UAlFE,QAqFFlkG,OAhFE,KAgFFikG,eAhFE,KAgFFC,UAzFE,OA4FFlkG,OAlFE,KAkFFikG,eAlFE,KAkFFC,UA5FE,OA+FFlkG,OAAA,KAAAikG,eAAA,KAAAC,UAAA,OAGAlkG,OAAA,KAAAikG,eAAA,KAAAC,UAAA,OAGAlkG,OAAA,KAAAikG,eAAA,KAAAC,UAAA,OAGAlkG,OAAA,KAAAikG,eAAA,KAAAC,UAAA,OAGAlkG,OArG8B,KAqG9BikG,eArG8B,KAqG9BC,UA7GsC,OAgHtClkG,OAxG8B,KAwG9BikG,eAxG8B,KAwG9BC,UA/GE,OAkHJlkG,OAAA,KAAAikG,eAAA,KAAAC,UAAA,OAKEC,GAEAxmI,aAAc,0BAEdymI,aAAA,MAGAC,gBAAA,2BAEAC,iBAAA,KAGArrI,cAAc,aACdE,YAAA,WACAE,aAAc,YACdkrI,eAAa,cACbpqI,aAAY,YACZF,YAAa,WACbm0F,WAAA,UACA70F,YAAS,WACTirI,YAAU,WACVC,QAAA,OACAhrI,SAAU,QACVE,SAAU,QACVE,SAAU,QACVE,SAAU,QACV2qI,SAAU,QACVC,SAAU,yBAEVC,SAAA,QAGAC,eAAA,KACAC,gBAAA,KACAC,gBAAiB,KACjBC,iBAAkB,KAClBC,gBAAA,2BAEAC,kBAAA,sBAIAC,cAAA,EAGA9T,YAAa,uBAEb+T,YAAA,MAIAC,qBAAA,EACAC,sBAAuB,EACvBC,sBAvDY,EAwDZC,sBAAA,EACAC,qBAAA,EACAv8F,6BAA8B,EAC9BE,8BAA+B,iCAE/BI,8BAAA,EAGAZ,eAAA,EACAE,eAAA,GACAE,kBAAA,GACAf,qBAAA,GACAE,wBApEY,GAqEZE,wBArEY,GAsEZE,iBAAA,GACAE,kBAAA,GACAi9F,mBAAoB,GACpBC,oBAAqB,GACrBC,mBA1EY,GA2EZl9F,oBAAqB,GACrBm9F,iBAAkB,GAClBC,oBA7EY,uBA+EZC,kBAAA,GAGAC,gBAAA,sBAEAC,kBAAA,GAGAC,cAAe,IACfC,aAAA,IACAC,cAAA,IACAC,eAAA,IACAC,gBAAgB,IAChBC,iBAAgB,uBAEhBC,eAAA,IAGAC,aAAA,MACAC,eAAY,MACZC,cAAW,MACXvlG,WAAA,sBAEAH,aAAA,MAGA4tB,eAAA,gCAEA+3E,4BAAA,MAGAC,WAAA,EACAC,UAAA,EACAC,gBAAiB,IACjBC,0BAA2B,IAC3BC,gBAAiB,IACjBC,0BAA2B,IAC3BC,gBAAiB,IACjBC,0BAA2B,IAC3BC,gBAAA,IACAC,0BAAA,IACAC,qBAAsB,MACtBC,+BAAgC,MAChCC,qBAAA,2CAEAC,yBAAA,IAGAC,gBAAA,KACAC,gBAAiB,EACjBC,mBAAA,KACAC,gBAAiB,KACjBC,qBAAsB,MACtBC,gBAAA,gCAEAC,kBAAA,KAGAC,UAAW,EACXC,WAAA,oBAEAC,oBAAA,KAGAC,UAAA,EACAn4C,SAAA,EACAo4C,aAAc,EACdC,cAAA,EACA77H,aAAA,EAnJF87H,kBAAA,qBA4JI,SAAAC,EAAAC,GACD,OAFDA,IAEWvE,EAAaU,eACf,EACE6D,IAAavE,EAAQW,gBACvB,EACE4D,IAAavE,EAAQY,gBACvB,EACE2D,IAAavE,EAAQa,iBACvB,EACE0D,IAAavE,EAAQc,gBACvB,EACEyD,IAAavE,EAAQwE,iBACvB,EACRD,IAAAvE,EAAAe,qBAIFtoI,QAAAkI,KAAA,sBAAA4jI,6BAWc,IAATE,IAAmBA,GAAQ,GAE7B,IAAAr+J,EAAQw5J,EAAMl2H,GAAA+6H,EAAd,GACA,YAAOtsK,IAAPiO,GACDqyB,QAAAkI,KAAA,mBAAA+I,6CAWD,SAAIg7H,EAAWj8H,GACb,IAAAriC,EAAQy5J,EAAMp3H,GACd,YAAOtwC,IAAPiO,GACDqyB,QAAAkI,KAAA,wBAAA8H,gDAcD32C,KAAK+3H,8BAEL/3H,KAAI43H,OAAJ,EAGE,IADA,IAAAx9F,EAAW,EACP76B,EAAK,EAAAwuB,EAAA8kJ,EAAArzK,OAAAD,EAAAwuB,IAAAxuB,EAAA,CACP,IAAAgtB,EAAMsmJ,EADCtzK,GAEP6nC,GACAnoC,KAAAstB,EAHOttB,KAIPm7B,OAAQA,EACRiN,OAAM,EACNyrI,QAAK,EACLpqJ,KAAA6D,EAAY7D,KACZoS,IAAAvO,EAAOuO,IARTtF,eAAAnvB,IAAAkmB,EAAAiJ,WAAAjJ,EAAAiJ,iCAPFx1B,wBAAAA,KAqBSmnC,UAAUzhC,KAAG0hC,GArBtBpnC,KAuBC43H,QAAAxwF,EAAAE,iBAIC,IAAA,IAAKyrI,EAAL,EAAcC,EAAOhzK,KAArBmnC,UAAA3nC,OAAAuzK,EAAAC,IAAAD,EAAA,CA3BF/yK,KA4BCmnC,UAAA4rI,GA/BH1rI,OAGErnC,KAHF43H,SAwCC3wF,GAFD3kC,UAAA+c,QAAA,SAAAklH,4BAME,IAAAv8F,GAAe,SAAfP,EAAAsiC,EAAAkpG,EAAAtiK,EAAAuiK,GACAlzK,KAAK2rE,QAASlkC,EACdznC,KAAK42C,QAAAmzB,EACL/pE,KAAKmzK,OAAAF,qBAELjzK,KAAAozK,eAAA,EACArpG,IAEWmkG,EAAWE,gBACpBpuK,KAAKozK,eAAiB,EACbrpG,IAAWmkG,EAAQ11C,iBAC5Bx4H,KAAKozK,eAAiB,EACvBrpG,IAAAmkG,EAAAG,mBACDruK,KAAKozK,eAAc,GAEnBpzK,KAAA43H,OAAA53H,KAAAozK,eAAAF,kCAIAlzK,KAAAa,OAAA,EAAA8P,6BAMF0iK,IAAA1tI,OAAA0sH,cAAA,IAKIrqH,GAAQ1lC,UAAMm4B,QAAA,YACd,IAAAz6B,KAAAisE,OAKGjsE,KAAQ2rE,QAAbrc,6BAEAtvD,KAAK2rE,QAAQqrF,OAAbhuH,IAAAhpC,KAAAsnC,qBANCX,QAAAhM,MAAA,iCAgBCqN,GAAQ1lC,UAAMzB,OAAA,SAAdu5B,EAAAzpB,GACA,IAAA,IAAA3Q,KAAAisE,MAKA,GAAAt7D,GAAAA,EAAAo2B,WAAA3M,EAAAp6B,KAAA43H,OACDjxF,QAAAhM,MAAA,4CADC,wBAMC24I,EAAWtzK,KAAGmzK,OAEfjoG,EAAAqoG,WAASroG,EAATsoG,qBAAiBxzK,KAAAisE,OACft7D,EAKFypB,EAGE8wC,EAAGuoG,cAAcvoG,EAAAsoG,qBAAsBp5I,EAAMzpB,GAEhDu6D,EAAAwoG,WAAAxoG,EAAAsoG,qBAAA7iK,EAAA2iK,GAXCtzK,KAEO43H,OACL1sD,EAAAwoG,WAAaxoG,EAAAsoG,qBAAAxzK,KAAA43H,OAAA07C,GAJjB3sI,QAMOkI,KAAA,qFAjBNlI,QAAAhM,MAAA,4BA6BF04I,GAFD1tI,MAAAhd,IAAA,oCAMA27B,OAAIqvH,iBAAe3rI,GAAS1lC,UAAT+wK,IAEjB,IAAA7rI,GAAe,SAAfC,EAAAsiC,EAAAkpG,EAAAtiK,EAAAijK,GACA5zK,KAAK2rE,QAASlkC,EACdznC,KAAK42C,QAAAmzB,gBAEL/pE,KAAA64H,aAAA+6C,EAGA5zK,KAAA43H,OAAA53H,KAAA42C,QAAAghF,OAAAg8C,kCAIA5zK,KAAAa,OAAA,EAAA8P,6BAMFkjK,IAAAluI,OAAA0sH,cAAA,IAKI7qH,GAAQllC,UAAMm4B,QAAA,YACd,IAAAz6B,KAAAisE,OAKGjsE,KAAQ2rE,QAAbrc,6BAEAtvD,KAAK2rE,QAAQqrF,OAAbjuH,IAAA/oC,KAAAsnC,qBANCX,QAAAhM,MAAA,iCAgBC6M,GAAQllC,UAAMzB,OAAA,SAAdu5B,EAAAzpB,GACA,IAAA,IAAA3Q,KAAAisE,MAKA,GAAAt7D,GAAAA,EAAAo2B,WAAA3M,EAAAp6B,KAAA43H,OACDjxF,QAAAhM,MAAA,4CADC,wBAMC24I,EAAWtzK,KAAGmzK,OAEfjoG,EAAAqoG,WAASroG,EAAT4oG,aAAiB9zK,KAAAisE,OACft7D,EAKFypB,EAGE8wC,EAAGuoG,cAAcvoG,EAAA4oG,aAAc15I,EAAMzpB,GAExCu6D,EAAAwoG,WAAAxoG,EAAA4oG,aAAAnjK,EAAA2iK,GAXCtzK,KAEO43H,OACL1sD,EAAAwoG,WAAaxoG,EAAA4oG,aAAA9zK,KAAA43H,OAAA07C,GAJjB3sI,QAMOkI,KAAA,oFAjBNlI,QAAAhM,MAAA,4BA6BFk5I,GAFDluI,MAAAhd,IAAA,qCAMA27B,OAAIqvH,iBAAJnsI,GAAAllC,UAAAuxK,IAEA,IAAAE,GAAS,EAEL,SAAIC,GAAav/I,EAAG/L,EAAAurJ,GAClBA,EAAAnwJ,MAAA,MAAAu2E,QAAA,SAAAv9C,GACD,KAAAA,EAAAt9C,OAAA,GAAA,CAIC,IAAA00K,EAAS,oCAAAx2B,KAAA5gG,GACPo3H,EACAz/I,EAAA/uB,MACAgjB,KAAMA,EACNyrJ,OAAkB,EAAlBD,EAAS,GAJX9iB,KAAA,EAAA8iB,EAAA,GADF1tH,QAOW0tH,EAAI,GAAJtzE,SAED9jD,EADCt9C,OAAA,GAEPi1B,EAAA/uB,MACAgjB,KAAMA,EACNyrJ,QAAS,EAJX/iB,KAAA,EAMD5qG,QAAA1J,4BAOH98C,KAAA2rE,QAAAlkC,EAGAznC,KAAKo0K,eACLp0K,KAAKq0K,aACLr0K,KAAKs0K,aACLt0K,KAAKu0K,WACLv0K,KAAKw0K,SAAA,EACLx0K,KAAKy0K,YAAL5/F,EAAA6/F,KACA10K,KAAK20K,YAAL9/F,EAAA+/F,KAZF50K,KAAAisE,MAAA,oBAiBA4oG,IAAAx8I,IAA8Bg6H,cAAY,IA6GxC,SAAGyiB,GAAa5pG,EAAQxiD,EAAxBwP,GACA,IAAG68I,EAAA7pG,EAAH8pG,aAAAtsJ,8BAEAwiD,EAAA+pG,cAAAF,KA9GDF,GAFDx8I,GAAA1P,IAAA,yDASG,IAAA3oB,KAAAw0K,QAAA,CAID,IAAItpG,EAAAlrE,KAAA2rE,QAAarc,6CAGb4lH,EAAaJ,GAAH5pG,EAAdA,EAAAiqG,gBAAAn1K,KAAA20K,aAEGS,EAAAlqG,EAAamqG,gBAChBnqG,EAAGoqG,aAAYF,EAAfG,uBAEArqG,EAAAsqG,YAAaJ,YAGT5zD,EAAIxhH,KAAAu0K,QAeJ,GAbFrpG,EAAAuqG,mBAAAF,EAAArqG,EAAAwqG,kBACD1B,GAAAxyD,EAAA,KAAAt2C,EAAAyqG,iBAAAJ,UAICrqG,EAAAuqG,mBAAAP,EAAAhqG,EAAAwqG,kBACD1B,GAAAxyD,EAAA,KAAAt2C,EAAAyqG,iBAAAT,4BAKDhqG,EAAA0qG,aAAYV,GAERW,EACDr0D,EAFDnnB,QAAA,SAAAp/D,GAGA0L,QAAAhM,MAAA,qBAAAM,EAAAvS,KAAA,IAAAuS,EAAAk5I,OAAA,QAAAl5I,EAAAm2H,KAAA,MAAAn2H,EAAAurB,gBAUD,GALC0kB,EAAA4qG,oBAAAV,EAAAlqG,EAAA6qG,eACDpvI,QAAAhM,MAAA,kCAAAuwC,EAAA8qG,kBAAAZ,WAIAS,EAAA,CAID71K,KAAAisE,MAAAmpG,EAIE,IADA,IAAAa,EAAc/qG,EAAA4qG,oBAAdV,EAAAlqG,EAAAgrG,mBACI32K,EAAA,EAAAA,EAAc02K,IAAH12K,EAAqB,8BAEpCwpH,EAAO79C,EAAPirG,kBAAwBf,EAAA7oJ,EAAAttB,MAtDjBe,KAwDLo0K,YAAU1uK,MACVzG,KAAMstB,EAAKttB,KAHb8pH,SAAAA,EAKDrgG,KAAA6D,EAAA7D,OAMC,IADA,IAAA0tJ,EAAgBlrG,EAAA4qG,oBAAiBV,EAAjClqG,EAAAmrG,iBACItD,EAAO,EAAAA,EAAXqD,IAAArD,EAAA,CACA,IAAIuD,EAAAprG,EAAAqrG,iBAAgBnB,EAAmBrC,GACnC9zK,EAAAq3K,EAAUr3K,KACVu3K,EAAStrG,EAAAurG,mBAAArB,EAAAn2K,GACX+jB,EAAA,QAAY/jB,EAAA88F,OAAU98F,EAAKO,OAA3B,GACDwjB,8BAtEMhjB,KA0ELq0K,UAAU3uK,MACVzG,KAAMA,EACN8pH,SAAMytD,EAJR9tJ,KAAA4tJ,EAAA5tJ,KAMDumB,KAAAjsB,EAAAszJ,EAAArnI,UAAA5oC,uBAODqwK,GAAGp0K,UAAHm4B,QAAsB,4BAEtBk8I,cAAe32K,KAAfisE,OAEAjsE,KAAKw0K,SAAA,EACLx0K,KAAKisE,MAAA,KACLjsE,KAAKo0K,eARPp0K,KAAAq0K,gCAaA/vH,OAAAqvH,iBAAA+C,GAAAp0K,UAAAuyK,uBAeE70K,KAAK2rE,QAALlkC,EAEAznC,KAAKmzF,OAAA,EACLnzF,KAAK2Y,QAAA,qBAEL3Y,KAAKq0E,aAAc,EAEnBr0E,KAAK42K,YAAa,EAClB52K,KAAKyqE,WAAayjG,EAAQgB,cAC1BlvK,KAAK2qE,WAASujG,EAAQgB,cACtBlvK,KAAK62K,WAAS3I,EAAQgB,cACtBlvK,KAAAkqE,OAAAgkG,EAAA9S,YACAp7J,KAAAoqE,OAAA8jG,EAAA9S,YAGAp7J,KAAK42C,QAAUs3H,EAAf17F,mCAqBD,SAAAskG,GAAAtoJ,sBAbGuoJ,GAAAz0K,UAAcm4B,QAAA,YACd,IAAAz6B,KAAAisE,wBAMF+qG,cAAah3K,KAAOisE,OATtBjsE,KAAA2rE,QAAAqrF,OAAA7oC,KAAAnuH,KAAAsnC,qBAIGX,QAAAhM,MAAA,kCAeC,IAAAwU,GAAW,SAAW8nI,mBAEtBA,EAAS10K,KAAKvC,KAAQynC,GAEtB,IAAAyjC,EAAKlrE,KAAQ2rE,QAAGrc,8BAEhBtvD,KAAAisE,MAAAf,EAAAgsG,gBAGDriG,EAAA7K,OAAA6K,EAAA7K,SAAA,4BAIDitG,IAAU9nI,EAAUgoI,UAAcF,6CAElC9nI,EAAA7sC,UAAAwc,YAAAqwB,EAmBEA,EAAI7sC,UAAYzB,OAAK,SAArBg0E,0BAEIuiG,EAASp3K,KAAAu0E,WAETM,SACDxuE,IAAAwuE,EAAAlxE,QACD3D,KAAImzF,OAAQte,EAAWlxE,YAEtB0C,IAAAwuE,EAAAjxE,SACD5D,KAAI2Y,QAAQk8D,EAARjxE,aAEHyC,IAAAwuE,EAAAwiG,aACDr3K,KAAI42K,YAAA/hG,EAAsBwiG,iBAEzBhxK,IAAAwuE,EAAAtK,YACDvqE,KAAIyqE,WAAQoK,EAActK,gBAEzBlkE,IAAAwuE,EAAAnK,YACD1qE,KAAI2qE,WAAQkK,EAAcnK,gBAEzBrkE,IAAAwuE,EAAA89F,YACD3yK,KAAI62K,WAAAhiG,EAAkB89F,gBAErBtsK,IAAAwuE,EAAA5K,QACDjqE,KAAIkqE,OAAQ2K,EAAU5K,YAErB5jE,IAAAwuE,EAAA1K,QACDnqE,KAAIoqE,OAAQyK,EAAW1K,YAGnB9jE,IADFwuE,EAAK9K,SAIN/pE,KAAA42C,QAAAi+B,EAAA9K,kHAKqB1jE,IAApBwuE,EAAAV,SACDn0E,KAAAu0E,WAAAM,EAAAV,wBAIG9tE,IAAAwuE,EAAA7K,QACA6K,EAAI7K,OAAYxqE,OAAQ,IACxB43K,GAAI,GACYviG,EAAAlxE,MAAAkxE,EAAAjxE,OAAAixE,EAAAlxE,MAAAkxE,EAAdjxE,SACDixE,EAAA7K,OAAAxqE,OAAA,GAAA,GACFmnC,QAAAhM,MAAA,6DAOHm8I,GAAA92K,KAAAmzF,SAAA2jF,GAAA92K,KAAA2Y,iBAKFuyD,EAAAosG,cAAYpsG,EAARqsG,UACFrsG,EAAAssG,YAAKtsG,EAAWkB,WAAQpsE,KAAQisE,YACjC5lE,IAAAwuE,EAAA7K,QAAA6K,EAAA7K,OAAAxqE,OAAA,wDAIDQ,KAAIy3K,cAEFL,IACDlsG,EAAAwsG,KAAAxsG,EAAAysG,qBAAAzsG,EAAA0sG,QACD1sG,EAAK2sG,eAAQ3sG,EAAAkB,8CAiBbj9B,EAAI7sC,UAAQipE,eAAkB,SAA9BsJ,0BAEGijG,EAAAlF,EAAiB5yK,KAApB42C,SAEAs0B,EAAAosG,cAAApsG,EAAkBqsG,UAClBrsG,EAAAssG,YAAatsG,EAAAkB,WAAbpsE,KAAAisE,OAPFjsE,KAAA+3K,aAAAD,EAAAjjG,oCAsBE1lC,EAAI7sC,UAAQ01K,YAAkB,SAA9BnjG,0BAEGijG,EAAAlF,EAAiB5yK,KAApB42C,SAEAs0B,EAAAosG,cAAepsG,EAAfqsG,UACArsG,EAAAssG,YAAatsG,EAAAkB,WAAbpsE,KAAAisE,OAPFjsE,KAAAi4K,UAAAH,EAAAjjG,oCAYE1lC,EAAI7sC,UAAQy1K,aAAZ,SAAAD,EAAAjjG,GACA,IAAI3J,EAAAlrE,KAAA2rE,QAAArc,IACAp/C,EAAM2kE,EAAQ3kE,2BAGhBk5G,EAAAv0C,EAAAlkC,MAKEy4E,aAAer0C,mBAAGq0C,aAAlB5zC,kBAAA4zC,aAAA8uD,uBACK7xK,IAFP6J,EAGEg7D,EAAGitG,YAAYjtG,EAAGktG,qBAAqB,+CAKlC/xK,IAFPgkE,EAGEa,EAAGitG,YAAYjtG,EAAGmtG,gCAAgC,qDAKpDntG,EAAAotG,cAAcptG,EAAAkB,WAAWyI,EAAArJ,MAAAqJ,EAAAv1E,EAAAu1E,EAAAnxE,EAAAo0K,EAAA/tG,OAAA+tG,EAAA7J,UAAA7kD,UAElB/iH,IAFP6J,EAGEg7D,EAAGitG,YAAYjtG,EAAGktG,qBAAqB,+CAKlC/xK,IAFPgkE,EAGEa,EAAGitG,YAAYjtG,EAAGmtG,gCAAgC,qDAGpDr4K,KAUOq0E,YACLnJ,EAAGqtG,wBACErtG,EADLkB,WAEUyI,EACRrJ,MAHFqJ,EAIEv1E,EAJFu1E,EAKEnxE,EAAQmxE,EACRlxE,MAAQkxE,EACRjxE,OAAMk0K,EACN/tG,OAAMq/C,GAIXl+C,EAAAotG,cAAAptG,EAAAkB,WAAAyI,EAAArJ,MAAAqJ,EAAAv1E,EAAAu1E,EAAAnxE,EAAAmxE,EAAAlxE,MAAAkxE,EAAAjxE,OAAAk0K,EAAA/tG,OAAA+tG,EAAA7J,UAAA7kD,KAKDj6E,EAAI7sC,UAAQ21K,UAAZ,SAAAH,EAAAjjG,GACA,IAAI3J,EAAAlrE,KAAA2rE,QAAArc,IACAp/C,EAAM2kE,EAAQ3kE,2BAGhBk5G,EAAAv0C,EAAAlkC,MAKEy4E,aAAer0C,mBAAGq0C,aAAlB5zC,kBAAA4zC,aAAA8uD,uBACK7xK,IAFP6J,EAGEg7D,EAAGitG,YAAYjtG,EAAGktG,qBAAqB,+CAKlC/xK,IAFPgkE,EAGEa,EAAGitG,YAAYjtG,EAAGmtG,gCAAgC,qDAYpDntG,EAAAstG,WAActtG,EAAAkB,WAAWyI,EAAArJ,MAAAssG,EAAA9J,eAAA8J,EAAA/tG,OAAA+tG,EAAA7J,UAAA7kD,UAElB/iH,IAFP6J,EAGEg7D,EAAGitG,YAAYjtG,EAAGktG,qBAAqB,+CAKlC/xK,IAFPgkE,EAGEa,EAAGitG,YAAYjtG,EAAGmtG,gCAAgC,qDAGpDr4K,KAUOq0E,YACLnJ,EAAGutG,qBACEvtG,EADLkB,WAEUyI,EACRrJ,MAAMssG,EAAA9J,eACEn5F,EACRlxE,MAAQkxE,EALVjxE,OAOQ,EAAAwlH,GAKXl+C,EAAAstG,WAAAttG,EAAAkB,WAAAyI,EAAArJ,MAAAssG,EAAA9J,eAAAn5F,EAAAlxE,MAAAkxE,EAAAjxE,OAAA,EAAAk0K,EAAA/tG,OAAA+tG,EAAA7J,UAAA7kD,4CAkBC,IAZF,IAEE0uD,EAAOlF,EADK5yK,KAAA42C,SAEZi+B,GACAlxE,MAAO3D,KAHKmzF,OAIZvvF,OAAA5D,KAAA2Y,QACAzI,MAAOA,EACPm6D,iBAAOA,EANTmB,MAAA,cAWEjsE,EAAQ,EAARA,EAAgByqE,EAAOxqE,SAAvBD,EACAs1E,EAAQrJ,MAARjsE,EACAs1E,EAAQlxE,MAdE3D,KAcamzF,QAAvB5zF,EACAs1E,EAAOjxE,OAfG5D,KAec2Y,SAAxBpZ,EACDs1E,EAAAlkC,MAAAq5B,EAAAzqE,GAhBWS,KAHdi4K,UAAAH,EAAAjjG,IAwBE1lC,EAAI7sC,UAAMm1K,YAAA,kCAEViB,EAAA5B,GAAA92K,KAAAmzF,SAAA2jF,GAAA92K,KAAA2Y,SAGE+/J,GAAA14K,KAAckqE,SAAQgkG,EAAtByK,YAAA34K,KAAAoqE,SAAA8jG,EAAAyK,aACAhyI,QAAKkI,KAAL,4DACD7uC,KAAAkqE,OAAAgkG,EAAAyK,qCAIC,IAAAhG,EAAa3yK,KAAAu0E,WAAAv0E,KAAA62K,YAAA,EACb6B,IAAA,IAAA/F,IACDhsI,QAAAkI,KAAA,oDAIDq8B,EAAG0tG,cAAc1tG,EAAGkB,WAAYlB,EAAG2tG,mBAAgBC,EAAnD5tG,EAAAlrE,KAAAyqE,WAAAkoG,IACAznG,EAAG0tG,cAAc1tG,EAAGkB,WAAYlB,EAAG6tG,mBAAgBD,EAAnD5tG,EAAAlrE,KAAA2qE,YAAA,+DAEAO,EAAA0tG,cAAe1tG,EAAAkB,WAAYlB,EAAA8tG,eAAAh5K,KAAAoqE,QAEzB,IAAAp7B,EAAGhvC,KAAA2rE,QAAiB38B,IAAA,kCACrBA,GAAAA,EAAAiqI,4BAzBH/tG,EAAA0tG,cAAA1tG,EAAAkB,WAAAp9B,EAAAiqI,2BAAAj5K,KAAA42K,gBAhTa,CA+UfG,IAEImC,GAAW,SAAWjC,GACtB,SAAIiC,EAAUzxI,EAAdotC,GACAoiG,EAAK10K,KAAUvC,KAAGynC,GAClB,IAAAyjC,EAAKlrE,KAAQ2rE,QAAGrc,IAChBtvD,KAAKwtB,QAAO09C,EAAAiuG,iBACbn5K,KAAAisE,MAAAf,EAAAgsG,sCAIDD,IAAYiC,EAAU/B,UAAcF,6CAEpCiC,EAAA52K,UAAAwc,YAAAo6J,EAoBEA,EAAI52K,UAAYzB,OAAK,SAArBg0E,0BAEIuiG,EAASp3K,KAAAu0E,WAETM,SACDxuE,IAAAwuE,EAAAlxE,QACD3D,KAAImzF,OAAQte,EAAWlxE,YAEtB0C,IAAAwuE,EAAAjxE,SACD5D,KAAI2Y,QAAQk8D,EAARjxE,aAEHyC,IAAAwuE,EAAAwiG,aACDr3K,KAAI42K,YAAA/hG,EAAsBwiG,iBAEzBhxK,IAAAwuE,EAAAtK,YACDvqE,KAAIyqE,WAAQoK,EAActK,gBAEzBlkE,IAAAwuE,EAAAnK,YACD1qE,KAAI2qE,WAAQkK,EAAcnK,gBAEzBrkE,IAAAwuE,EAAA89F,YACD3yK,KAAI62K,WAAAhiG,EAAkB89F,gBAErBtsK,IAAAwuE,EAAA5K,QACDjqE,KAAIkqE,OAAQ2K,EAAU5K,YAErB5jE,IAAAwuE,EAAA1K,QACDnqE,KAAAoqE,OAAAyK,EAAA1K,YAOI9jE,IADFwuE,EAAK9K,SAIN/pE,KAAA42C,QAAAi+B,EAAA9K,kHAKqB1jE,IAApBwuE,EAAAV,SACDn0E,KAAAu0E,WAAAM,EAAAV,wBAIG9tE,IAAAwuE,EAAA7K,QACA6K,EAAI7K,OAAAxqE,OAAkB,IACpB43K,GAAQ,EACTviG,EAAAlxE,QAAAkxE,EAAAjxE,QACD+iC,QAAIkI,KAAQ,sDAEXgmC,EAAAlxE,OAAAkxE,EAAA7K,OAAAxqE,OAAA,GAAA,GACFmnC,QAAAhM,MAAA,gFAOHm8I,GAAA92K,KAAAmzF,SAAA2jF,GAAA92K,KAAA2Y,iBAKFuyD,EAAAosG,cAAYpsG,EAARqsG,UACFrsG,EAAAssG,YAAKtsG,EAAWiuG,iBAAgBn5K,KAAAisE,YACjC5lE,IAAAwuE,EAAA7K,QAAA6K,EAAA7K,OAAAxqE,OAAA,wDAIDQ,KAAIy3K,cAEFL,IACDlsG,EAAAwsG,KAAAxsG,EAAAysG,qBAAAzsG,EAAA0sG,QACD1sG,EAAK2sG,eAAQ3sG,EAAAiuG,oDAkBbD,EAAI52K,UAAQipE,eAAA,SAAZsJ,0BAEGijG,EAAAlF,EAAiB5yK,KAApB42C,SAEAs0B,EAAAosG,cAAApsG,EAAkBqsG,uDAElBv3K,KAAK+3K,aAAQD,EAAAjjG,oCAgBbqkG,EAAI52K,UAAQ01K,YAAkB,SAA9BnjG,0BAEGijG,EAAAlF,EAAiB5yK,KAApB42C,SAEAs0B,EAAAosG,cAAepsG,EAAfqsG,UACArsG,EAAAssG,YAAatsG,EAAAiuG,iBAAbn5K,KAAAisE,OAPFjsE,KAAAi4K,UAAAH,EAAAjjG,oCAYEqkG,EAAI52K,UAAgBy1K,aAApB,SAAAD,EAAAjjG,GACA,IAAI3J,EAAAlrE,KAAA2rE,QAAArc,IACAp/C,EAAA2kE,EAAY3kE,MACZm6D,EAAJwK,EAAAxK,+BAEI++C,EAAAv0C,EAAUlkC,WAEPtqC,IAFP6J,EAGEg7D,EAAGitG,YAAYjtG,EAAGktG,qBAAqB,+CAKlC/xK,IAFPgkE,EAGEa,EAAGitG,YAAYjtG,EAAGmtG,gCAAgC,qDAGpDjvD,aAMOr0C,mBAAAq0C,aAAA5zC,kBAAA4zC,aAAA8uD,iBACLhtG,EAAAotG,cAASptG,EAATkuG,4BAAsBC,EAAAxkG,EAAArJ,MAAAqJ,EAAAv1E,EAAAu1E,EAAAnxE,EAAAo0K,EAAA/tG,OAAA+tG,EAAA7J,UAAA7kD,GAAtBppH,KAUOq0E,YACLnJ,EAAGqtG,wBACErtG,EAAAkuG,4BADLC,EAEUxkG,EACRrJ,MAHFqJ,EAIEv1E,EAJFu1E,EAKEnxE,EAAQmxE,EACRlxE,MAAQkxE,EACRjxE,OAAMk0K,EACN/tG,OAAMq/C,GAIXl+C,EAAAotG,cAAAptG,EAAAkuG,4BAAAC,EAAAxkG,EAAArJ,MAAAqJ,EAAAv1E,EAAAu1E,EAAAnxE,EAAAmxE,EAAAlxE,MAAAkxE,EAAAjxE,OAAAk0K,EAAA/tG,OAAA+tG,EAAA7J,UAAA7kD,IAKD8vD,EAAI52K,UAAgB21K,UAApB,SAAAH,EAAAjjG,GACA,IAAI3J,EAAAlrE,KAAA2rE,QAAArc,IACAp/C,EAAA2kE,EAAY3kE,MACZm6D,EAAJwK,EAAAxK,+BAEI++C,EAAAv0C,EAAUlkC,WAEPtqC,IAFP6J,EAGEg7D,EAAGitG,YAAYjtG,EAAGktG,qBAAqB,+CAKlC/xK,IAFPgkE,EAGEa,EAAGitG,YAAYjtG,EAAGmtG,gCAAgC,GAEpDntG,EACEitG,YAAAjtG,EAAemtG,+BACfhuG,GAFF++C,aAaOr0C,mBAAAq0C,aAAA5zC,kBAAA4zC,aAAA8uD,iBACLhtG,EAAAstG,WAASttG,EAAAkuG,4BAAaC,EAAAxkG,EAAArJ,MAAAssG,EAAA9J,eAAA8J,EAAA/tG,OAAA+tG,EAAA7J,UAAA7kD,GAAtBppH,KAUOq0E,YACLnJ,EAAGutG,qBACEvtG,EAAAkuG,4BADLC,EAEUxkG,EACRrJ,MAAMssG,EAAA9J,eACEn5F,EACRlxE,MAAQkxE,EALVjxE,OAOQ,EAAAwlH,GAKXl+C,EAAAstG,WAAAttG,EAAAkuG,4BAAAC,EAAAxkG,EAAArJ,MAAAssG,EAAA9J,eAAAn5F,EAAAlxE,MAAAkxE,EAAAjxE,OAAA,EAAAk0K,EAAA/tG,OAAA+tG,EAAA7J,UAAA7kD,2CAqBC,IAbF,IAEE0uD,EAAOlF,EADK5yK,KAAA42C,SAEZi+B,GACAlxE,MAAA3D,KAHYmzF,OAIZvvF,OAAO5D,KAJK2Y,QAKZ0gK,UAAA,EACAnpK,MAAOA,EACPm6D,iBAAOA,EAPTmB,MAAA,cAYEjsE,EAAQ,EAARA,EAAAyqE,EAAAxqE,SAAAD,EAAA,CACA,IAAA+5K,EAAgBtvG,EAAOzqE,GACvBs1E,EAAQrJ,MAARjsE,UAfUS,eAiBV60E,EAAKjxE,OAjBK5D,KAiBS2Y,SAAnBpZ,EAEE,IAAA,IAAAg6K,EAAA,EAAgBA,EAAA,IAAYA,EAC5B1kG,EAAOwkG,UAAUE,EAClB1kG,EAAAlkC,MAAA2oI,EAAAC,GArBSv5K,KAsBXi4K,UAAAH,EAAAjjG,KAKDqkG,EAAU52K,UAASm1K,YAAT,kCAEViB,EAAA5B,GAAA92K,KAAAmzF,SAAA2jF,GAAA92K,KAAA2Y,SAGE+/J,GAAA14K,KAAckqE,SAAQgkG,EAAtByK,YAAA34K,KAAAoqE,SAAA8jG,EAAAyK,aACAhyI,QAAKkI,KAAL,4DACD7uC,KAAAkqE,OAAAgkG,EAAAyK,qCAIC,IAAAhG,EAAa3yK,KAAAu0E,WAAAv0E,KAAA62K,YAAA,EACb6B,IAAA,IAAA/F,IACDhsI,QAAAkI,KAAA,oDAIDq8B,EAAG0tG,cAAc1tG,EAAGiuG,iBAAkBjuG,EAAG2tG,mBAAgBC,EAAzD5tG,EAAAlrE,KAAAyqE,WAAAkoG,IACAznG,EAAG0tG,cAAc1tG,EAAGiuG,iBAAkBjuG,EAAG6tG,mBAAgBD,EAAzD5tG,EAAAlrE,KAAA2qE,YAAA,IACAO,EAAA0tG,cAAA1tG,EAAAiuG,iBAAAjuG,EAAAsuG,eAAAx5K,KAAAkqE,QACAgB,EAAA0tG,cAAA1tG,EAAAiuG,iBAAAjuG,EAAA8tG,eAAAh5K,KAAAoqE,QAIE,IAAAp7B,EAAGhvC,KAAA2rE,QAAiB38B,IAAA,kCACrBA,GAAAA,EAAAiqI,4BA3BH/tG,EAAA0tG,cAAA1tG,EAAAiuG,iBAAAnqI,EAAAiqI,2BAAAj5K,KAAA42K,gBAvSa,CAwUfG,IAEEhsG,GAAe,SAAftjC,EAAAsiC,EAAApmE,EAAAC,GACA5D,KAAK2rE,QAASlkC,EACdznC,KAAK42C,QAAUmzB,gBAEf/pE,KAAI2Y,QAAK/U,cAGT5D,KAAGisE,MAAAf,EAAAuuG,qBAEHvuG,EAAGwuG,iBAAiBxuG,EAAGyuG,aAAc35K,KAArCisE,OAXFf,EAAA0uG,oBAAA1uG,EAAAyuG,aAAA5vG,EAAApmE,EAAAC,4CAmBImnE,GAAQzoE,UAAMm4B,QAAA,WACd,GAAA,OAAAz6B,KAAAisE,MAAA,CAKF,IAAGf,EAAAlrE,KAAA2rE,QAAiBrc,4CAGpB4b,EAAA2uG,mBAAA75K,KAAAisE,4BAPCtlC,QAAAhM,MAAA,wCAYD,IAAAywC,GAAc,SAAd3jC,EAAA9jC,EAAAC,EAAAixE,GACA70E,KAAK2rE,QAAUlkC,gBAEfznC,KAAK2Y,QAAU/U,EAEf5D,KAAK85K,QAALjlG,EAAgBhK,WAChB7qE,KAAK28E,OAAA9H,EAAgBztB,OAAQ,mCAE7BpnD,KAAK+5K,cAAellG,EAAImlG,cAAxB,2CAQE5uG,GAAQ9oE,UAAMm4B,QAAA,WACd,OAAAz6B,KAAAisE,OAKCjsE,KAAA2rE,QAAkBrc,IAErB2qH,kBAAAj6K,KAAAisE,wBANCtlC,QAAAhM,MAAA,uCAWD,IAAAu/I,IAEAC,OAAA,EACAC,UAAS,EACTC,WAAA,WACAC,QAAApM,EAAUt1E,eACV2hF,aAAUrM,EAAQt1E,eAClB4hF,SAAAtM,EAAe2C,UACf4J,SAAAvM,EAAe0C,qCAEf8J,cAAAxM,EAAA0C,WAGA+J,WAAW,gBAEXC,UAAA1M,EAAAgC,aAGA2K,aAAA,EACAC,YAAA,EACAC,iBAAkB7M,EAtBLqC,eAuBbyK,gBAAA,EACAC,iBAAA,IACAC,mBAAAhN,EAAqBwD,gBACrByJ,oBAAAjN,EA1BawD,gBA2Bb0J,oBAAiBlN,EAAQwD,gBACzB2J,sBA5Ba,IA6BbC,gBAAiBpN,EA7BJqC,eA8BbgL,eAAA,EACAC,gBAAA,IACAC,kBAAAvN,EAAoBwD,gBACpBgK,mBAAAxN,EAjCawD,qDAmCbiK,qBAAA,IAGAC,SAAA1N,EAAA2N,UAGA/3C,cAAAoqC,EAAAz3H,aAGAqlI,WAAA,EACAC,iBACAC,uBACAC,YAAA,KACAC,gBAAS,EAhDXC,8BAqDEzjJ,GAAK,SAAoB+O,GAEzBznC,KAAK+7K,cAAe,IAAI1oK,MAAMo0B,EAAO20I,MAAMC,+EAE3Cr8K,KAAKm8K,aAAL,IAAA9oK,MAAAo0B,EAAA20I,MAAAE,+BAKA5jJ,GAAA6jJ,YAAS,SAA0B90I,GACnCyyI,GAAS6B,cAAe,IAAI1oK,MAAMo0B,EAAO20I,MAAMC,kBAHjDnC,GAAA8B,oBAAA,IAAA3oK,MAAAo0B,EAAA20I,MAAAC,sEAQC3jJ,GAFDp2B,UAAAu1C,MAAA,sDAUE73C,KAAKm6K,MAAAqC,EAALrC,MACAn6K,KAAKo6K,SAAUoC,EAAIpC,SACnBp6K,KAAKq6K,WAALmC,EAAoBnC,WACpBr6K,KAAKs6K,QAALkC,EAAgBlC,QAChBt6K,KAAKu6K,aAAeiC,EAAAjC,aACpBv6K,KAAKw6K,SAAAgC,EAALhC,SACAx6K,KAAKy6K,SAAA+B,EAAL/B,4CAEAz6K,KAAA06K,cAAA8B,EAAA9B,cAGA16K,KAAK26K,UAAY6B,EAAI7B,uCAErB36K,KAAA46K,UAAA4B,EAAA5B,UAGA56K,KAAK66K,YAAA2B,EAAL3B,YACA76K,KAAK86K,WAAA0B,EAAL1B,WACA96K,KAAK+6K,iBAAmByB,EAAIzB,iBAC5B/6K,KAAKg7K,gBAALwB,EAA0BxB,gBAC1Bh7K,KAAKi7K,iBAALuB,EAA2BvB,iBAC3Bj7K,KAAKk7K,mBAALsB,EAA2BtB,mBAC3Bl7K,KAAKm7K,oBAALqB,EAA6BrB,oBAC7Bn7K,KAAKo7K,oBAAsBoB,EAAApB,oBAC3Bp7K,KAAKq7K,sBAAqBmB,EAAAnB,sBAC1Br7K,KAAKs7K,gBAAkBkB,EAAIlB,gBAC3Bt7K,KAAKu7K,eAALiB,EAAyBjB,eACzBv7K,KAAKw7K,gBAALgB,EAA0BhB,gBAC1Bx7K,KAAKy7K,kBAALe,EAA0Bf,kBAC1Bz7K,KAAK07K,mBAALc,EAA4Bd,gEAE5B17K,KAAA27K,qBAAAa,EAAAb,qBAGA37K,KAAA47K,SAAAY,EAAAZ,SAGA57K,KAAA8jI,cAAA04C,EAAA14C,cAGE9jI,KAAA87K,UAAOU,EAAAV,UACR,IAAA,IAAAv8K,EAAA,EAAAA,EAAAi9K,EAAAT,cAAAv8K,SAAAD,EA5CDS,KA6CS+7K,cAASx8K,GAAUi9K,EAAAT,cAAAx8K,GAE3B,IAAA,IAAAwzK,EAAA,EAAAA,EAAAyJ,EAAAR,oBAAAx8K,SAAAuzK,EA/CD/yK,KAgDKg8K,oBAAkBjJ,GAAvByJ,EAAAR,oBAAAjJ,GAEA/yK,KAAAi8K,YAAAO,EAAAP,YAGEj8K,KAAAk8K,eAAoBM,EAApBN,eACD,IAAA,IAAAO,EAAA,EAAAA,EAAAD,EAAAL,aAAA38K,SAAAi9K,EAtDDz8K,+DA6DF,IAqBI08K,IACDl6I,KAFH,SAAA0oC,EAAA7yC,EAAAt0B,GAGAmnE,EAAAyxG,UAAAtkJ,EAAAt0B,IAEG6+B,KAFH,SAAAsoC,EAAA7yC,EAAAt0B,GAGAmnE,EAAA0xG,UAAAvkJ,EAAAt0B,IAEG84K,MAFH,SAAA3xG,EAAA7yC,EAAAt0B,GAGAmnE,EAAA4xG,WAAAzkJ,EAAoBt0B,IAEjBg5K,MAFH,SAAA7xG,EAAA7yC,EAAAt0B,GAGAmnE,EAAA8xG,WAAA3kJ,EAAoBt0B,IAEjBk5K,MAFH,SAAA/xG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAgyG,WAAA7kJ,EAAoBt0B,IAEjBo5K,MAFH,SAAAjyG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAkyG,WAAA/kJ,EAAoBt0B,IAEjBs5K,MAFH,SAAAnyG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAoyG,WAAAjlJ,EAAoBt0B,IAEjBw5K,MAFH,SAAAryG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAsyG,WAAAnlJ,EAAoBt0B,IAEjB05K,MAFH,SAAAvyG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAyxG,UAAAtkJ,EAAAt0B,IAEG25K,MAFH,SAAAxyG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAkyG,WAAA/kJ,EAAoBt0B,IAEjB45K,MAFH,SAAAzyG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAoyG,WAAAjlJ,EAAoBt0B,IAEjB65K,MAFH,SAAA1yG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAsyG,WAAAnlJ,EAAoBt0B,IAEjB85K,MAFH,SAAA3yG,EAAA7yC,EAAAt0B,GAGAmnE,EAAA4yG,iBAAoBzlJ,GAAA,EAApBt0B,IAEGg6K,MAFH,SAAA7yG,EAAA7yC,EAAAt0B,GAGAmnE,EAAA8yG,iBAAoB3lJ,GAAA,EAApBt0B,IAEGk6K,MAFH,SAAA/yG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAgzG,iBAAoB7lJ,GAAA,EAApBt0B,IAEGo6K,MAFH,SAAAjzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAyxG,UAAAtkJ,EAAAt0B,IAEGq6K,MAFH,SAAAlzG,EAAA7yC,EAAAt0B,sBASIs6K,gCAkaE,IAAA9E,IAAAA,EAAsB,GAA1B+E,aAQWnvI,GACT+7B,EAAGgB,qBACDhB,EAAGc,YACH+8C,EACA79C,EAAGkB,WAAAkyG,EAAAryG,MAA8B,GAI9BqyG,aAAApF,GACLhuG,EAAGgB,qBAAAhB,EACDc,YAAG+8C,EACH79C,EACAkuG,4BACWG,EAJb+E,EAAAryG,MAAA,GAOHf,EAAAqzG,wBAAArzG,EAAAc,YAAA+8C,EAAA79C,EAAAyuG,aAAA2E,EAAAryG,OAzbEoyG,GA9EC,MA4EJ,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAszG,WAAAnmJ,EAAAt0B,IAEGs6K,GAhFC,MA8EJ,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAuzG,WAAApmJ,EAAAt0B,IAEGs6K,GAlFiB,OAgFpB,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAA4xG,WAAAzkJ,EAAAt0B,IAEGs6K,GApFe,OAkFlB,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAA8xG,WAAA3kJ,EAAAt0B,IAEGs6K,GAtFe,OAoFlB,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAgyG,WAAA7kJ,EAAAt0B,IAEGs6K,GAxFe,OAsFlB,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAkyG,WAAA/kJ,EAAAt0B,IAEGs6K,GA1FW,OAwFd,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAoyG,WAAAjlJ,EAAAt0B,IAEGs6K,GA5FC,OA0FJ,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAsyG,WAAAnlJ,EAAAt0B,IAEGs6K,GA9FC,OA4FJ,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAszG,WAAAnmJ,EAAAt0B,IAEGs6K,GAhGgB,OA8FnB,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAkyG,WAAA/kJ,EAAAt0B,IAEGs6K,GAlGC,OAgGJ,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAoyG,WAAAjlJ,EAAAt0B,IAEGs6K,GApGC,OAkGJ,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAsyG,WAAAnlJ,EAAAt0B,IAEGs6K,GAtGiB,OAoGpB,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAA4yG,iBAAAzlJ,GAAyB,EAAAt0B,IAEtBs6K,GAxGiB,OAsGpB,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAA8yG,iBAAA3lJ,GAAyB,EAAAt0B,IAEtBs6K,GA1GC,OAwGJ,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAgzG,iBAAA7lJ,GAAyB,EAAAt0B,IAEtBs6K,UAFH,SAAAnzG,EAAA7yC,EAAAt0B,GAGAmnE,EAAAszG,WAAAnmJ,EAAAt0B,IAEGs6K,GA9GH,OA4GA,SAAAnzG,EAAA7yC,EAAAt0B,2CAgZE,IAEAmnE,OAIC7kE,KADCyoD,EAAKA,OACNI,QACDJ,EAAII,OAAK,QAER7oD,IAAAyoD,EAAAC,UACDD,EAAIC,SAAA,QAEH1oD,IAAAyoD,EAAA1H,QACD0H,EAAI1H,OAAK,QAER/gD,IAAAyoD,EAAAE,YACDF,EAAAE,WAAA,QAGC3oD,IAAAyoD,EAAA4vH,oDAOA,IACCxzG,EAAAyzG,EAAcxxD,WAAd,QAAAr+D,IAAA6vH,EAAAxxD,WAAA,qBAAAr+D,IAAA6vH,EAAAxxD,WAAA,YAAAr+D,IAAA6vH,EAAAxxD,WAAA,YAAAr+D,GACA,MAAA7zB,eACD0L,QAAAhM,MAAAM,GAKDj7B,KAAKsvD,IAAL4b,EACAlrE,KAAK4+K,eACH5+K,KAAAo8K,SACAp8K,KAAAg3J,QACA9nH,QAHY,EAIZnG,GAAA,EAJFC,GAAA,eAuBAhpC,KAAK6+K,iBAAL,iCAAA,yBAAA,2BAAA,oBAAA,2BAAA,yBAAA,gCAAA,0BAAA,+BAAA,gCAAA,iCAAA,gCAAA,sBAAA,wCAEA7+K,KAAA8+K,cAGApmJ,GAAK6jJ,YAAYv8K,MACjBA,KAAK++K,SAAL,IAnE2CrmJ,GAmEtB14B,MACrBA,KAAKg/K,MAAM,IAAKtmJ,GAAM14B,MACtBA,KAAKq0K,aACLr0K,KAAKi/K,IAAAj/K,KAAAk/K,IAAel/K,KAApBm/K,IAAAn/K,KAAAo/K,IAAA,wCAEAp/K,KAAA2pE,aAAA,oEAIA3pE,KAAKq/K,eAAe,IAAKhsK,MAAMrT,KAAAo8K,MAAAkD,kBAE7B,IAAA,IAAO//K,EAAA,EAAAA,EAAAS,KAAPo8K,MAAAkD,mBAAA//K,EA3EFS,KA4ECu/K,mBAAAhgL,GAAA,EA5EDS,KAHFq/K,eAAA9/K,GAAA,gDAqFE,IAEA2rE,EAASlrE,KAATsvD,uBAMM,IAHJ,IAAIrwD,EAAAugL,EAAkBjgL,GAEpBkgL,GAAI,GAAA,UAAA,QACErzJ,EAAA,EAAMA,EAAGqzJ,EAAajgL,OAAA4sB,IAC1B,IACE,IAAA4iB,EAAOk8B,EAAAw0G,aAAPD,EAAArzJ,GAAAntB,GACD+vC,IAXEhvC,KAYH4+K,YAAU3/K,GAAA+vC,GAEX,MAAAo9D,GACFzlE,QAAAhM,MAAAyxE,KAMHwvD,GAAIt5J,UAAAq9K,UAAsB,0BAE1BC,EAAW5/K,KAAAgvC,IAAmB,sBAE9BhvC,KAAKo8K,MAAMC,iBAAkB,EAC7Br8K,KAAKo8K,MAAMyD,kBAAkB30G,EAAGW,aAAaX,EAAG40G,gCAChD9/K,KAAKo8K,MAAM2D,gBAAX70G,EAA8BW,aAAAX,EAAgB80G,mGAE9ChgL,KAAKo8K,MAAMkD,iBAAiBp0G,EAAAW,aAAiBX,EAAG+0G,oBAVlDjgL,KAAAo8K,MAAA8D,eAAAN,EAAA10G,EAAAW,aAAA+zG,EAAAO,wBAAA,wHAiBE,IAAAj1G,EAAAlrE,KAAAsvD,IAGA4b,EAAGk1G,QAAAl1G,EAAAm1G,OACHn1G,EAAGo1G,UAAHp1G,EAAA4M,IAAA5M,EAAA5mE,kCAEA4mE,EAAGmvG,WAAU,EAAb,EAAmB,EAAnB,GAEAnvG,EAAGq1G,WAAU,GAAA,GAAb,GAAA,yBAGAr1G,EAAGs1G,SAAQt1G,EAAGu1G,MAEdv1G,EAAGk1G,QAAAl1G,EAAUw1G,YACbx1G,EAAG0vG,UAAQ1vG,EAAGy1G,MACdz1G,EAAG01G,WAAH,oCAEA11G,EAAG21G,WAAW,EAAA,GAEd31G,EAAGk1G,QAAAl1G,EAAH41G,cACA51G,EAAG61G,YAAU71G,EAAGkM,OAAS,EAAzB,wBAEAlM,EAAA81G,UAAA91G,EAAA+1G,KAAA/1G,EAAA+1G,KAAA/1G,EAAA+1G,MAQA/1G,EAAGg2G,WAAA,yBAEHh2G,EAAGi2G,aAAW,uEAMd,IAAIj2G,EAAAlrE,KAAUsvD,IAEZpgB,EAAGlvC,KAAY++K,SAAQ5C,aAASiF,GADlClyI,IAEO,IAAAA,EAAA+8B,MACLf,EAAGssG,YAAYtoI,EAAG1hB,QAAY0hB,EAA9B+8B,OAPJf,EAAAssG,YAAAtsG,EAAAkB,WAAA,mDAcE,IAAIlB,EAAKlrE,KAAKsvD,IAEZtmB,EAAGhpC,KAAA++K,SAAc9C,YADnBjzI,IAGK,IAAAA,EAAAijC,MACHf,EAAGqoG,WAAWroG,EAAGsoG,qBAAsBxqI,EAAAijC,OAR3Cf,EAAAqoG,WAAAroG,EAAAsoG,qBAAA,OAkBC5X,GAFDt5J,UAAA0sC,IAAA,SAAA/vC,uEAiBG,GAAAe,KAAA2pE,eAAA03G,EAAA,qBAKD,IAAIn2G,EAAAlrE,KAAOsvD,IAET,GAAA,OAAA+xH,EAAA,CAKFn2G,EAAAa,gBAAgBb,EAAKc,YAAaq1G,EAAAp1G,OAGhC,IADA,IAAAq1G,EAAIthL,KAAc2pE,aAAOmwG,QAAat6K,OACtCD,EAAA,EAAYA,EAAG+hL,IAAA/hL,EAAH,OAjBLS,6BAmBPuhL,GAAAr2G,EAAAA,EAAAiB,kBAAA5sE,EAAAiiL,GAUD,IAAA,IAAAzO,EAAAuO,EAAAvO,EAAA/yK,KAAAo8K,MAAAqF,sBAAA1O,kFAIA/yK,KAAA2pE,aAAAgT,0DAIA38E,KAAA2pE,aAAA+3G,gDAIA1hL,KAAA2pE,aAAAowG,eA5CHwH,GAAAr2G,EAAAA,EAAAy2G,yBAAAN,EAAAtH,oBAaG7uG,EAAAa,gBAAAb,EAAAc,YAAA,QAgDC4vF,GAAAt5J,UAASu5J,YAAkB,SAA3Bv8J,EAAAoE,EAAA4vC,EAAAC,GACAvzC,KAAKi/K,MAAL3/K,GAAAU,KAAAk/K,MAAAx7K,GAAA1D,KAAAm/K,MAAA7rI,GAAAtzC,KAAAo/K,MAAA7rI,IACAvzC,KAAKsvD,IAALu7C,SAAAvrG,EAAAoE,EAAA4vC,EAAAC,GACAvzC,KAAKi/K,IAAM3/K,EACXU,KAAKk/K,IAAMx7K,EACZ1D,KAAAm/K,IAAA7rI,EAZHtzC,KAAAo/K,IAAA7rI,IA6BIqoH,GAAAt5J,UAASs/K,WAAiB,SAA1BtiL,EAAAoE,EAAA4vC,EAAAC,GACAvzC,KAAK6hL,MAALviL,GAAAU,KAAA8hL,MAAAp+K,GAAA1D,KAAA+hL,MAAAzuI,GAAAtzC,KAAAgiL,MAAAzuI,IACAvzC,KAAKsvD,IAALw2F,QAAAxmJ,EAAAoE,EAAA4vC,EAAAC,GACAvzC,KAAK6hL,IAAMviL,EACXU,KAAK8hL,IAAMp+K,EACZ1D,KAAA+hL,IAAAzuI,EAZHtzC,KAAAgiL,IAAAzuI,IAwBEqoH,GAAIt5J,UAAJshD,MAAA,SAAAkL,kBAEImzH,EAAK,OAEO57K,IAAdyoD,EAAGtyC,QACJylK,GAAA/2G,EAAAg3G,iFAIe77K,IAAdyoD,EAAG1H,8BAEH8jB,EAAGg2G,WAAUpyH,EAAA1H,OAEb8jB,EAAG2qB,OAAA3qB,EAAUw1G,YACdx1G,EAAA01G,WAAA,+BAIiBv6K,IAAhByoD,EAAGC,UACJkzH,GAAA/2G,EAAAi3G,8CAIDj3G,EAAAtnB,MAAAq+H,QAGkB57K,IAAdyoD,EAAG1H,SACE,IAFPpnD,KAEO++K,SAAApE,UACLzvG,EAAAk1G,QAASl1G,EAAAw1G,cAER,IAAA1gL,KAAA++K,SAAAqD,YACDl3G,EAAI01G,WAAK,GAER5gL,KAAA++K,SAAAnE,YAAA1M,EAAAqC,gBACFrlG,EAAA0vG,UAAA56K,KAAA++K,SAAAnE,cAaJhf,GAFDt5J,UAAA+/K,YAAA,gCASCzmB,GAFDt5J,UAAAggL,gBAAA,oCASC1mB,GAFDt5J,UAAAigL,iBAAA,qCASC3mB,GAFDt5J,UAAAkgL,kBAAA,sCAYE5mB,GAAKt5J,UAAMmgL,eAAmB,SAAA97J,EAA6Bq9F,EAA3DzsD,GACAv3D,KAAKg/K,MAAMlE,YAAA,EACX96K,KAAKg/K,MAAMjE,iBAAmB/6K,KAAKg/K,MAAM1D,gBAAkB30J,EAJ7D3mB,KAAAg/K,MAAAhE,gBAAAh7K,KAAAg/K,MAAAzD,eAAAv3D,4DAeE43C,GAAKt5J,UAAMogL,oBAAX,SAAA/7J,EAAAq9F,EAAAzsD,GACAv3D,KAAKg/K,MAAMlE,YAAA,EACX96K,KAAKg/K,MAAMjE,iBAAmBp0J,EAJhC3mB,KAAAg/K,MAAAhE,gBAAAh3D,iCAeE43C,GAAKt5J,UAAMqgL,mBAAX,SAAAh8J,EAAAq9F,EAAAzsD,GACAv3D,KAAKg/K,MAAMlE,YAAA,EACX96K,KAAKg/K,MAAM1D,gBAAkB30J,EAJ/B3mB,KAAAg/K,MAAAzD,eAAAv3D,gCAgBE43C,GAAKt5J,UAAMsgL,aAAX,SAA4CC,EAAAC,EAAqBC,EAAjEC,GACAhjL,KAAKg/K,MAAM9D,mBAAXl7K,KAAiCg/K,MAAAvD,kBAAAoH,EACjC7iL,KAAKg/K,MAAM7D,oBAAXn7K,KAAmCg/K,MAAKtD,mBAAMoH,EAJhD9iL,KAAAg/K,MAAA5D,oBAAAp7K,KAAAg/K,MAAAiE,mBAAAF,sEAgBEnnB,GAAKt5J,UAAM4gL,kBAAqB,SAAhCL,EAAAC,EAAAC,EAAAC,GACAhjL,KAAKg/K,MAAMlE,YAAA,EACX96K,KAAKg/K,MAAM9D,mBAAX2H,EACA7iL,KAAKg/K,MAAM7D,oBAAX2H,EALF9iL,KAAAg/K,MAAA5D,oBAAA2H,sCAiBEnnB,GAAKt5J,UAAM6gL,iBAAoB,SAA/BN,EAAAC,EAAAC,EAAAC,GACAhjL,KAAKg/K,MAAMlE,YAAA,EACX96K,KAAKg/K,MAAMvD,kBAAXoH,EACA7iL,KAAKg/K,MAAMtD,mBAAXoH,EALF9iL,KAAAg/K,MAAAiE,mBAAAF,qCAcCnnB,GAFDt5J,UAAA8gL,aAAA,SAAAxI,2BAUChf,GAFDt5J,UAAA+gL,gBAAA,SAAAxsB,4BAaC+E,GAFDt5J,UAAAghL,cAAA,SAAAppK,EAAAyC,EAAAzQ,EAAAnD,mEAWE6yJ,GAAKt5J,UAAMihL,aAAX,SAAArrJ,EAAAsrJ,GACAxjL,KAAKg/K,MAAM5E,UAAW,EAHxBp6K,KAAAg/K,MAAAxE,SAAAtiJ,yBAeE0jI,GAAKt5J,UAAMmhL,gBAAX,SAAAvrJ,EAAAsrJ,EAAAE,EAAAC,GACA3jL,KAAKg/K,MAAM5E,UAAW,EACtBp6K,KAAKg/K,MAAMxE,SAAAtiJ,EACXl4B,KAAKg/K,MAAMvE,SAAA+I,EALbxjL,KAAAg/K,MAAA4E,cAAAF,8BAcE9nB,GAAKt5J,UAAMuhL,WAAX,SAAAC,GAFF9jL,KAAAg/K,MAAA5E,UAAA,wBAYExe,GAAKt5J,UAAMyhL,cAAX,SAAAD,EAAAE,GACAhkL,KAAKg/K,MAAM5E,UAAA,EAHbp6K,KAAAg/K,MAAA1E,QAAAwJ,6BAYCloB,GAFDt5J,UAAA2hL,YAAA,SAAAhmI,4EAaa,IAAXv0B,IAAWA,EAAc,GAEzB1pB,KAAIg/K,MAAKjD,cAALjJ,GAA+Bh3I,EACjC97B,KAAAg/K,MAAKhD,oBAALlJ,GAAAppJ,EACD1pB,KAAAg/K,MAAAlD,UAAAhJ,IAPH9yK,KAAAg/K,MAAAlD,UAAAhJ,IAgBClX,GAFDt5J,UAAA4hL,eAAA,SAAApoJ,6BAUC8/H,GAFDt5J,UAAA6hL,WAAA,SAAA/O,yBAYIxZ,GAAAt5J,UAAcosE,WAAA,SAAgCzvE,EAAAiwC,EAAek1I,GAC7DA,GAAApkL,KAAAo8K,MAAAE,gBACD31I,QAAAkI,KAAA,uBAAA5vC,EAAA,aAAAmlL,EAAA,yBAAApkL,KAAAo8K,MAAAE,+CAKDt8K,KAAIqkL,WAAWplL,EAAAmlL,GAEdpkL,KAAAg/K,MAAA9C,eAAAkI,IAXHpkL,KAAAg/K,MAAA9C,eAAAkI,kDAuBE,IAEEr2J,EAAQirG,EAAMx5H,OACd,GAAAuuB,GAAA/tB,KAAAo8K,MAAAE,gBACD31I,QAAAkI,KAAA,eAAA9gB,EAAA,iBAAA9uB,EAAA,yBAAAe,KAAAo8K,MAAAE,qBADC,CAIA,IAAA,IAAO/8K,EAAA,EAAMA,EAAAwuB,IAAbxuB,EAA0B,CAC3B,IAAA6kL,EAAAE,EAAA/kL,GARSS,KASLg/K,MAAL7C,aAAAiI,GAAAprD,EAAAz5H,0BAUAq8J,GAAKt5J,UAAD+hL,WAAqB,SAAWplL,EAAc8E,GAChD,IAAAwgL,EAAIvkL,KAAWq0K,UAAfp1K,GACA,IAAAslL,GAAcA,EAAdvhK,SAAAuhK,EAAAxgL,MAAAvE,OAAAuE,EAAAvE,OAAA,CACA,IAAI61J,EAAAtxJ,EACFif,GAAW,EACXjf,aAAA8+B,cAAAxvB,MAAA2P,QAAAjf,IAFFsxJ,EAIS,IAAAxyH,aAAiB9+B,GACxBif,GAAA,GACAjf,aAAA0+B,aACD4yH,EAAA,IAAA5yH,WAAA1+B,SAICwgL,GACAhoG,OAAA,EAHFx4E,MAAAsxJ,EAZFryI,QAiBOA,OAED,CACJ,IAAI8kE,EAAQy8F,EAASxgL,MACnBw4E,GAAS,EACP,GAAAgoG,EAAIvhK,QACF,IAAA,IAAAzjB,EAAQ,EAARgiB,EAAAumE,EAAAtoF,OAAAD,EAAAgiB,EAAAhiB,IACAuoF,EAAAvoF,KAAcwE,EAAdxE,KACDg9E,GAAA,EACFuL,EAAAvoF,GAAAwE,EAAAxE,SAKCuoF,IAAA/jF,IACDw4E,GAAA,EACFgoG,EAAAxgL,MAAAA,GAIAw4E,IACFgoG,EAAAhoG,OAAA,wBAUFq/E,GAFDt5J,UAAAm2H,iBAAA,SAAA/vG,+DAYE,IAEIwiD,EAAAlrE,KAAOsvD,oBAEX2xB,EAAAjhF,KAAAg/K,OAniCA,SAAuB9zG,EAAOs5G,EAAAvjG,GAE1B,GAAAujG,EAAGrK,QAAWl5F,EAAdk5F,MACA,OAAAl5F,EAAAk5F,OAKFjvG,EAAA2qB,OACO3qB,EAAAm1G,OAWNp/F,EAAAu5F,WAAAtM,EAAAoD,sBAAArwF,EAAAu5F,WAAAtM,EAAAqD,gCAAAtwF,EAAAw5F,WAAAvM,EAAAoD,sBAAArwF,EAAAw5F,WAAAvM,EAAAqD,sJAICtwF,EAAGm5F,UAFLlvG,EAAAu5G,kBAGOxjG,EAAAu5F,SAAAv5F,EAAAw5F,SAAAx5F,EAAA2iG,cAAA3iG,EAAAy5F,eACLxvG,EAAGw5G,sBAAezjG,EAAUq5F,QAAKr5F,EAAjCs5F,gBAEDrvG,EAAAo1G,UAAAr/F,EAAAu5F,SAAAv5F,EAAAw5F,6CAxBAvvG,EAAAk1G,QAAAl1G,EAAAm1G,QAgCF,IAAAp/F,EAAAk5F,QAUAqK,EAAAnK,aAAAp5F,EAAAo5F,6HAKGmK,EAAGpK,WAAAn5F,EAAkBm5F,SAYvBn5F,EACEm5F,UAMDoK,EAAAhK,WAAAv5F,EAAAu5F,UAAAgK,EAAA/J,WAAAx5F,EAAAw5F,UAAA+J,EAAAZ,gBAAA3iG,EAAA2iG,eAAAY,EAAA9J,gBAAAz5F,EAAAy5F,0FAQA8J,EAAAlK,UAAAr5F,EAAAq5F,SAAAkK,EAAAjK,eAAAt5F,EAAAs5F,cAjBHrvG,EAkBOw5G,sBAAAzjG,EAAAq5F,QAAAr5F,EAAAs5F,gBAOJiK,EAAAhK,WAAAv5F,EAAAu5F,UAAAgK,EAAA/J,WAAAx5F,EAAAw5F,6CAKA+J,EAAAlK,UAAAr5F,EAAAq5F,SACFpvG,EAAAy5G,cAAA1jG,EAAAq5F,UAxCGr5F,EAAGm5F,UAFLlvG,EAAAu5G,kBAGOxjG,EAAAu5F,SAAAv5F,EAAAw5F,SAAAx5F,EAAA2iG,cAAA3iG,EAAAy5F,eACLxvG,EAAGw5G,sBAAezjG,EAAUq5F,QAAKr5F,EAAjCs5F,gBAEDrvG,EAAAo1G,UAAAr/F,EAAAu5F,SAAAv5F,EAAAw5F,wCA8+BHmK,CAAA15G,EAAAs5G,EAAAvjG,GAl8BA,SAAsB/V,EAAKs5G,EAAAvjG,GAEvB,GAAAujG,EAAG7J,YAAW15F,EAAA05F,UACd,OAAA15F,EAAA05F,WAKFzvG,EAAG2qB,OAAA3qB,EAAUw1G,0CAEbx1G,EAAA01G,UAAA3/F,EAAAmhG,kBANCl3G,EAAAk1G,QAAAl1G,EAAAw1G,YAYF8D,EAAApC,aAAAnhG,EAAAmhG,uCAKoB,IAAjBnhG,EAAK05F,UAaR6J,EAAA5J,YAAA35F,EAAA25F,WACF1vG,EAAA0vG,UAAA35F,EAAA25F,WAbK35F,EAAKmhG,4BAELnhG,EAAG25F,UAAU1M,EAAbqC,eAEDrlG,EAAA2qB,OAAA3qB,EAAAw1G,sCA26BHmE,CAAA35G,EAAAs5G,EAAAvjG,GA35BE,SAAuB/V,EAAAs5G,EAAAvjG,GACrB,GAAAA,EAAG45F,cAAW2J,EAAA3J,YACd,OAAA55F,EAAA45F,aAKF3vG,EAAA2qB,OAAS3qB,EAAA41G,mBAEP7/F,EAAG65F,YACH5vG,EAAG45G,oBAAkB55G,EAAG65G,MAAO9jG,EAAK85F,iBAAoB95F,EAAK+5F,gBAAA/5F,EAAqBg6F,kBAClF/vG,EAAG85G,oBAAoB95G,EAAG65G,MAAM9jG,EAAKo6F,uBACrCnwG,EAAG+5G,kBAAA/5G,EAAoB65G,MAAvB9jG,EAAgCi6F,mBAAKj6F,EAArCk6F,oBAAAl6F,EAAAm6F,qBACAlwG,EAAG45G,oBAAkB55G,EAAGu1G,KAAMx/F,EAAKq6F,gBAAmBr6F,EAAKs6F,eAAAt6F,EAAoBu6F,iBANjFtwG,EAAA85G,oBAOO95G,EAAAu1G,KAAAx/F,EAAA06F,sBACLzwG,EAAG+5G,kBAAiB/5G,EAAAu1G,KAAAx/F,EAAAw6F,kBAAuBx6F,EAA3Cy6F,mBAAiEz6F,EAAjEgiG,sBAEA/3G,EAAG61G,YAAU9/F,EAAK85F,iBAAoB95F,EAAK+5F,gBAAA/5F,EAAqBg6F,kBACjE/vG,EAAAg6G,YAAAjkG,EAAAo6F,6GAfAnwG,EAAAk1G,QAAAl1G,EAAA41G,cAuBF7/F,EAAA45F,cAIG2J,EAAG1J,aAAA75F,EAAoB65F,WAgBzB75F,EACE65F,YAKD0J,EAAAzJ,mBAAA95F,EAAA85F,kBAAAyJ,EAAAxJ,kBAAA/5F,EAAA+5F,iBAAAwJ,EAAAvJ,mBAAAh6F,EAAAg6F,kBACD/vG,EAAI45G,oBAAI55G,EAAA65G,MAA0B9jG,EAAK85F,iBAAA95F,EAAuB+5F,gBAAA/5F,EAAAg6F,kBAE7DuJ,EAAAnJ,wBAAAp6F,EAAAo6F,uBACDnwG,EACE85G,oBAAI95G,EAAJ65G,MAA2B9jG,EAAKo6F,uBAKjCmJ,EAAAtJ,qBAAAj6F,EAAAi6F,oBAAAsJ,EAAArJ,sBAAAl6F,EAAAk6F,qBAAAqJ,EAAApJ,sBAAAn6F,EAAAm6F,mHASAoJ,EAAAlJ,kBAAAr6F,EAAAq6F,iBAAAkJ,EAAAjJ,iBAAAt6F,EAAAs6F,gBAAAiJ,EAAAhJ,kBAAAv6F,EAAAu6F,iBACDtwG,EAAI45G,oBAAI55G,EAAJu1G,KAA6Bx/F,EAAKq6F,gBAAAr6F,EAAsBs6F,eAAAt6F,EAAAu6F,iBAE3DgJ,EAAA7I,uBAAA16F,EAAA06F,sBACDzwG,EACE85G,oBAAA95G,EAAAu1G,KAA0Bx/F,EAAK06F,sBAKhC6I,EAAA/I,oBAAAx6F,EAAAw6F,mBAAA+I,EAAA9I,qBAAAz6F,EAAAy6F,oBAAA8I,EAAAvB,qBAAAhiG,EAAAgiG,oBArCH/3G,EAsCO+5G,kBAAA/5G,EAAAu1G,KAAAx/F,EAAAw6F,kBAAAx6F,EAAAy6F,mBAAAz6F,EAAAgiG,sBAOJuB,EAAAzJ,mBAAA95F,EAAA85F,kBAAAyJ,EAAAxJ,kBAAA/5F,EAAA+5F,iBAAAwJ,EAAAvJ,mBAAAh6F,EAAAg6F,kBACD/vG,EAAI61G,YAAI9/F,EAAA85F,iBAA+B95F,EAAA+5F,gBAAuB/5F,EAAAg6F,kBAE7DuJ,EAAAnJ,wBAAAp6F,EAAAo6F,uBACDnwG,EACEg6G,YAAIjkG,EAAAo6F,uBAKLmJ,EAAAtJ,qBAAAj6F,EAAAi6F,oBAAAsJ,EAAArJ,sBAAAl6F,EAAAk6F,qBAAAqJ,EAAApJ,sBAAAn6F,EAAAm6F,qBACFlwG,EAAA81G,UAAA//F,EAAAi6F,mBAAAj6F,EAAAk6F,oBAAAl6F,EAAAm6F,sBArEGn6F,EAAG65F,YACH5vG,EAAG45G,oBAAkB55G,EAAG65G,MAAO9jG,EAAK85F,iBAAoB95F,EAAK+5F,gBAAA/5F,EAAqBg6F,kBAClF/vG,EAAG85G,oBAAoB95G,EAAG65G,MAAM9jG,EAAKo6F,uBACrCnwG,EAAG+5G,kBAAA/5G,EAAoB65G,MAAvB9jG,EAAgCi6F,mBAAKj6F,EAArCk6F,oBAAAl6F,EAAAm6F,qBACAlwG,EAAG45G,oBAAkB55G,EAAGu1G,KAAMx/F,EAAKq6F,gBAAmBr6F,EAAKs6F,eAAAt6F,EAAoBu6F,iBANjFtwG,EAAA85G,oBAOO95G,EAAAu1G,KAAAx/F,EAAA06F,sBACLzwG,EAAG+5G,kBAAiB/5G,EAAAu1G,KAAAx/F,EAAAw6F,kBAAuBx6F,EAA3Cy6F,mBAAiEz6F,EAAjEgiG,sBAEA/3G,EAAG61G,YAAU9/F,EAAK85F,iBAAoB95F,EAAK+5F,gBAAA/5F,EAAqBg6F,kBACjE/vG,EAAAg6G,YAAAjkG,EAAAo6F,uBACDnwG,EAAA81G,UAAA//F,EAAAi6F,mBAAAj6F,EAAAk6F,oBAAAl6F,EAAAm6F,uBAq3BF+J,CAAAj6G,EAAAs5G,EAAAvjG,GAjzBE,SAAA/V,EAAAs5G,EAAAvjG,GACDujG,EAAA5I,WAAA36F,EAAA26F,WAIC36F,EAAA26F,WAAA1N,EAAA+D,WAKH/mG,EAAA2qB,OAAA3qB,EAAAk6G,mCAJEl6G,EAAAk1G,QAAAl1G,EAAAk6G,YA8yBDC,CAAAn6G,EAAAs5G,EAAAvjG,qBAlyBA,IAAAqkG,GAAA,EAGE,IAAA,IAAArkG,EAAA66F,UAAA,CAKD,GAFD0I,EAEO1I,YAAI76F,EAAgB66F,UACzBwJ,GAAa,OACR,GAAAd,EAAApP,UAAAn0F,EAAAm0F,QACLkQ,GAAa,OAKT,IAAA,IAAA/lL,EAAA,EAAAA,EAAa0hF,EAAb66F,UAAA,IAAAv8K,EACA,GAAAilL,EAAAzI,cAAAx8K,KAAA0hF,EAAA86F,cAAAx8K,IAAAilL,EAAAxI,oBAAAz8K,KAAA0hF,EAAA+6F,oBAAAz8K,GAAA,CACD+lL,GAAA,EACF,MAKC,GAAAA,EAAO,CACR,IAAA,IAAAvS,EAAA,EAAAA,EAAAtrI,EAAA20I,MAAAkD,mBAAAvM,wBAIC,IAAA,IAAI0J,EAAA,EAAWA,EAAKx7F,EAAA66F,UAAL,IAAfW,EAAA,CACA,IAAI1zI,EAAKk4C,EAAA86F,cAAAU,GACP8I,EAAAtkG,EAAA+6F,oBAAAS,GACD,GAAA1zI,EAAA,CAIDmiC,EAAAqoG,WAAAroG,EAAgB4oG,aAAS/qI,EAAQkjC,uDAG/B,IAAI2yD,EAAK39C,EAAGm0F,QAAQhB,YAAahoJ,GAE/Bgb,EAAA2B,EAAQ6N,QAAMv3B,QAAAu/G,EAAA3/H,MACdmoC,GAKA,IAAAK,EAAO83I,mBAAmB3gD,EAAK7V,YAChC79C,EAAAs6G,wBAAA5mD,EAAA7V,UACDthF,EAAO83I,mBAAoB3gD,EAAA7V,UAA3B,GAEAthF,EAAG43I,eAAHzgD,EACE7V,UACA,EAOL79C,EAAAu6G,oBAAA7mD,EAAA7V,SAAA3hF,EAAAtM,IAAAsM,EAAA1e,KAAA0e,EAAA5R,UAAA4R,EAAAC,OAAAD,EAAAhN,OAAAmrJ,EAAAn+I,EAAAC,SAjBIV,QAAAkI,KAAA,kCAAA+vF,EAAA3/H,QAsBD,IAAA,IAAGymL,EAAA,EAAAA,EAAAj+I,EAAH20I,MAAAkD,mBAAAoG,EACAj+I,EAAO83I,mBAAmBmG,KAA1Bj+I,EAAA43I,eAAAqG,KACDx6G,EAAAy6G,yBAAAD,GACFj+I,EAAA83I,mBAAAmG,GAAA,SAhEF/+I,QAAAkI,KAAA,6EAiyBD+2I,CAAA5lL,KAAAkrE,EAAAs5G,EAAAvjG,GAGCujG,EAAAvI,cAAAh7F,EAAAg7F,yFAKC,IAAA4J,GAAiB,EACfrB,EAAGpP,UAAWn0F,EAAKm0F,UADrBn0F,EAEOm0F,QAAAZ,QACLtpG,EAAA46G,WAAa7kG,EAAAm0F,QAAAnpG,OAEftlC,QAAAkI,KAAe,oDAruBf,SAAqBq8B,EAAjBs5G,EAAwBvjG,GAC1B,IAAA,IAAI1hF,EAAA,EAAAA,EAAU0hF,EAAKi7F,eAAnB,IAAA38K,EACA,GAAAilL,EAAIrI,aAAW58K,KAAQ0hF,EAARk7F,aAAsB58K,GAAA,CACnC,IAAA2vC,EAAG+xC,EAAck7F,aAAA58K,GACjB2vC,IAAgC,IAA7BA,EAAY+8B,QAChBf,EAAAosG,cAAApsG,EAAAqsG,SAAAh4K,GACF2rE,EAAAssG,YAAAtoI,EAAA1hB,QAAA0hB,EAAA+8B,SAquBH85G,CAAA76G,EAAAs5G,EAAAvjG,GAGE,IAAA,IAAI1hF,EAAA,EAAUA,EAAA0hF,EAAOm0F,QAAUf,UAAA70K,SAA/BD,EAAA,CACA,IAAIymL,EAAU/kG,EAAAm0F,QAAAf,UAAA90K,GACZglL,EA3CKvkL,KA2CLq0K,UAAA2R,EAAA/mL,MACA,GAAAslL,IAKDsB,GAAAtB,EAAAhoG,OAAA,CAIDgoG,EAAAhoG,OAAA,EAIE,IAAA0pG,OAAc5/K,IAAA2/K,EAAA/2I,KAAAytI,GAA+CsJ,EAA7Dt9J,MAAA21J,GAAA2H,EAAAt9J,MACAu9J,0BACDt/I,QAAAkI,KAAA,4CAAAm3I,EAAA/mL,OAMHgiF,EAOOg7F,YACL/wG,EAAGg7G,aACDlmL,KAAKg/K,MAAMl7C,cACXn+F,EACAs7C,EAHFg7F,YAAArlI,QAAA4vB,EAAAya,EAAAg7F,YAAA7I,2DAgBFpzK,KAAAg3J,OAAAC,WAAA,EA5FFutB,EAAA14J,IAAAm1D,cAmGE,IAAA7/C,IAEA6F,aAAcA,GACde,YAASA,GACTR,aAASA,GACTkvI,QAAAA,GACAK,QAAAA,GACA5nI,UAAAA,GACA+pI,YAAaA,GACbnuG,aAXQA,kBAaR6wF,OAAAA,GAGA4W,cAAcA,EAhBhBsG,SAAAA,EAkBAlG,aAAcA,GAEdtuH,OAAA+uG,OAAAjyH,GAAA8sI,+BAKO,IAALiY,IAAAA,EAAA/kJ,GAAAqV,cAEAz2C,KAAKo5H,cAALrwF,EACA/oC,KAAKomL,aAALp9I,EACAhpC,KAAKw2C,eAAL2vI,gBAEAnmL,KAAAqmL,QAAA,GAMEh9I,GAAO/mC,UAAPgkL,kBAAA,WACD,OAAA,IAAAtmL,KAAAqmL,mBAIArmL,KAAAomL,kFAUDpmL,KAAAumL,aAAAtnL,EAGAe,KAAAwmL,UAAAplJ,GAAAy6I,UAGA77K,KAAKymL,QAAA,EACLzmL,KAAK0mL,SAALtlJ,GAAiBw3D,eACjB54F,KAAK2mL,cAAgBvlJ,GAAAw3D,eACrB54F,KAAK4mL,UAAAxlJ,GAALyvI,UACA7wK,KAAK6mL,UAAAzlJ,GAALwvI,WACA5wK,KAAK8mL,eAAc1lJ,GAAAyvI,4CAEnB7wK,KAAA+mL,YAAA,WAGA/mL,KAAKgnL,YAAa,EAClBhnL,KAAKinL,aAAL,EACAjnL,KAAAknL,WAAA9lJ,GAAA8uI,aACAlwK,KAAKmnL,cAAA,EAELnnL,KAAKonL,kBAAoBhmJ,GAAzBmvI,eACAvwK,KAAKqnL,iBAAL,EACArnL,KAAKsnL,kBAAL,IACAtnL,KAAKunL,oBAALnmJ,GAA4BswI,gBAC5B1xK,KAAKwnL,qBAALpmJ,GAA8BswI,gBAC9B1xK,KAAAynL,qBAAArmJ,GAAAswI,gBACA1xK,KAAK0nL,uBAAuB,IAE5B1nL,KAAK2nL,iBAAmBvmJ,GAAxBmvI,eACAvwK,KAAK4nL,gBAAL,EACA5nL,KAAK6nL,iBAAL,IACA7nL,KAAK8nL,mBAAL1mJ,GAA2BswI,gBAC3B1xK,KAAK+nL,oBAAL3mJ,GAA6BswI,gBApC/B1xK,KAAAgoL,oBAAA5mJ,GAAAswI,gDAyCIuW,GAAA3lL,UAAA4xC,KAAA,SAAAg0I,GACAloL,KAAKumL,aAAY2B,EAAK3B,aAEtBvmL,KAAKwmL,UAAS0B,EAAK1B,UAEnBxmL,KAAKymL,OAAAyB,EAALzB,OACAzmL,KAAK0mL,SAALwB,EAAiBxB,SACjB1mL,KAAK2mL,cAAYuB,EAAKvB,cACtB3mL,KAAK4mL,UAAAsB,EAAiBtB,UACtB5mL,KAAK6mL,UAAAqB,EAAiBrB,UACtB7mL,KAAK8mL,eAAcoB,EAAKpB,eACxB9mL,KAAAmoL,eAAAD,EAAAC,eACAnoL,KAAK+mL,YAAamB,EAAKnB,YAEvB/mL,KAAKgnL,WAAakB,EAAKlB,WACvBhnL,KAAKinL,YAALiB,EAAoBjB,YACpBjnL,KAAAknL,WAAAgB,EAAAhB,WACAlnL,KAAKmnL,aAAAe,EAAoBf,aAEzBnnL,KAAKonL,kBAAoBc,EAAKd,kBAC9BpnL,KAAKqnL,iBAALa,EAA2Bb,iBAC3BrnL,KAAKsnL,kBAALY,EAA4BZ,kBAC5BtnL,KAAKunL,oBAALW,EAA4BX,oBAC5BvnL,KAAKwnL,qBAALU,EAA8BV,qBAC9BxnL,KAAAynL,qBAAAS,EAAAT,qBACAznL,KAAK0nL,uBAAwBQ,EAAAR,uBAE7B1nL,KAAK2nL,iBAAmBO,EAAKP,iBAC7B3nL,KAAK4nL,gBAALM,EAA0BN,gBAC1B5nL,KAAK6nL,iBAALK,EAA2BL,iBAC3B7nL,KAAK8nL,mBAALI,EAA2BJ,mBAC3B9nL,KAAK+nL,oBAALG,EAA6BH,oBAjCjC/nL,KAAAgoL,oBAAAE,EAAAF,wEAsCCC,GAFD3lL,UAAA2hL,YAAA,SAAArI,qBAcIqM,GAAA3lL,UAAKq2F,SAAL,SAA0C2hF,EAAfE,EAAAC,EAAAF,EAAAqJ,EAAAlJ,EAAAL,QACtB,IAAAC,IAALA,EAA2Bl5I,GAAWw3D,qBACjC,IAAA4hF,IAAiBA,EAASp5I,GAAAyvI,gBAC1B,IAAA4J,IAAkBA,EAASr5I,GAAAwvI,iBAC3B,IAAA2J,IAALA,EAAgCn5I,GAAgBw3D,qBAC5B,IAAfgrF,IAAwBA,EAAaxiJ,GAAbyvI,8CAE/B,IAAAwJ,IAAAA,EAAA,YAEAr6K,KAAKymL,QAAL,EACAzmL,KAAK0mL,SAALpM,EACAt6K,KAAK4mL,UAAApM,EACLx6K,KAAK6mL,UAAApM,EACLz6K,KAAK2mL,cAALpM,EACAv6K,KAAK8mL,eAAclD,EAxBrB5jL,KAAAmoL,eAAAzN,sBAiCIuN,GAAA3lL,UAAK2rC,SAAoB,SAAiB0sI,EAAbyH,EAAAxH,QACV,IAAdD,IAAuBA,GAAY,2BAExB,IAAlBC,IAAkBA,EAAlBx5I,GAAA8uI,cAEAlwK,KAAKgnL,WAAarM,EAXpB36K,KAAAinL,YAAA7E,qBAwBI6F,GAAA3lL,UAAK8lL,gBAAwB,SAAArH,EAAAsH,EAAAnD,EAAAoD,EAAAC,EAAAC,EAAAC,QACR,IAAhB1H,IAAyBA,EAAc3/I,GAAdmvI,qBACzB,IAAA8X,IAAuBA,EAAI,QAC3B,IAAAnD,IAAwBA,EAAI,UAC5B,IAAAoD,IAALA,EAAiClnJ,GAAiBswI,sBAC7C,IAAA6W,IAALA,EAAmCnnJ,GAAmBswI,yDAExD,IAAA+W,IAAAA,EAAA,KAEAzoL,KAAKmnL,cAAA,EACLnnL,KAAKonL,kBAAoBrG,EACzB/gL,KAAKqnL,iBAALgB,EACAroL,KAAKsnL,kBAALpC,EACAllL,KAAKunL,oBAALe,EACAtoL,KAAKwnL,qBAALe,EAxBFvoL,KAAAynL,qBAAAe,iCAqCIP,GAAA3lL,UAAKomL,eAAwB,SAAA3H,EAAAsH,EAAAnD,EAAAoD,EAAAC,EAAAC,EAAAC,QACR,IAAhB1H,IAAyBA,EAAc3/I,GAAdmvI,qBACzB,IAAA8X,IAAuBA,EAAI,QAC3B,IAAAnD,IAAwBA,EAAI,UAC5B,IAAAoD,IAALA,EAAiClnJ,GAAiBswI,sBAC7C,IAAA6W,IAALA,EAAmCnnJ,GAAmBswI,yDAExD,IAAA+W,IAAAA,EAAA,KAEAzoL,KAAKmnL,cAAL,EACAnnL,KAAK2nL,iBAAmB5G,EACxB/gL,KAAK4nL,gBAALS,EACAroL,KAAK6nL,iBAAL3C,EACAllL,KAAK8nL,mBAALQ,EACAtoL,KAAK+nL,oBAALQ,EAxBFvoL,KAAAgoL,oBAAAQ,gCA6BCP,GAFD3lL,UAAAqmL,mBAAA,0CASIC,MAEA1oI,IACA2oI,SAAI,SAAc5pL,GAEjB,QAAAoH,IAAAuiL,GAAA3pL,GAAA,aAKD2pL,GAAA3pL,GAAA6pL,UAKAA,QAAI,SAAO7pL,GACT,IAAAo5B,EAAOuwJ,GAAP3pL,GACD,YAAAoH,IAAAgyB,GACD,KAKA0wJ,SAAK,SAAWC,GAEd,IADA,IAAAtjI,EAAI,EACAnmD,EAAO,EAAAA,EAAAypL,EAAWxpL,SAAAD,EAAA,CACpB,IAAA84B,EAAOuwJ,GAAPI,EAAAzpL,SACD8G,IAAAgyB,IACFqtB,GAAArtB,GA5BL,OAAAqtB,IAqCIujI,GAAA,4BAGS,IAAXC,IAAAA,EAAA,GAEAlpL,KAAK4f,IAAAqpK,KACLjpL,KAAKmpL,UAAUjpI,GAAf6oI,SAAAK,GACAppL,KAAKqpL,YAALC,EACAtpL,KAAAguC,QAAA0qD,EARF14F,KAAAupL,OAAAL,GAaAM,IAA2B9wF,QAAU25D,cAAW,GAAA02B,UAAA12B,cAAA,IAE9Co3B,GAAKnnL,UAAY4xC,KAAA,SAAUw1I,kBAE3B1pL,KAAKmpL,UAALO,EAAAP,UAEEnpL,KAAAqpL,eACA,IAAA,IAAKtkK,EAAA,EAAAA,EAAY2kK,EAAYL,YAAU7pL,SAAYulB,EAAA,CACpD,IAAA4kK,EAAAD,EAAAL,YAAAtkK,oDAIC,IAAA,IAAKqlB,EAAM,EAAAA,EAAAs/I,EAAA17I,QAAAxuC,SAAA4qC,EAAA,CACT,IAAA89I,EAAOloL,KAAIguC,QAAS5D,GACpB89I,IACDA,EAAA,IAAA/mJ,GAAA8mJ,KACDjoL,KAAKguC,QAAKtoC,KAAUwiL,IAEtBA,EAAKh0I,KAALw1I,EAAsB17I,QAAA5D,IAEtBpqC,KAAKguC,QAALxuC,OAAckqL,EAAd17I,QAAAxuC,6BAKDiqL,GAFDnnL,UAAA+5E,UAAA,SAAA+sG,kCAMCI,GAFD9wF,OAAA/vE,IAAA,gCAMC6gK,GAFDT,SAAApgK,IAAA,kCAMA27B,OAAAqvH,iBAAA8V,GAAAnnL,UAAAknL,IAIE,IAAAI,GAAK,SAAqBC,EAAArhK,EAAAshK,2BAE1B,IAAAA,IAAmBA,MAEnB9pL,KAAK+pL,YAAWF,qBAEhB7pL,KAAAgqL,SAAAF,GAKAF,GAAKtnL,UAAAshD,MAAL,WACA5jD,KAAK+pL,YAASvqL,OAAd,EAHFQ,KAAAiqL,YAAA,mEAYI,IAHF,IAEEnB,EAAW5oI,GAAO4oI,QAAAoB,GACd3qL,EAAK,EAAAA,EAALS,KAAgB+pL,YAASvqL,SAAAD,EAAA,CAC3B,IAAA4qL,EAJAnqL,KAIA+pL,YAAAxqL,GACD,GAAA4qL,EAAApB,SAAAD,EACF,OAAAqB,eAOFP,GAFDtnL,UAAA8nL,YAAA,SAAAnrL,+BAME2qL,GAAKtnL,UAAA+nL,YAAoB,SAAzBprL,EAAA8E,6DAQE,IAFF,IAEOxE,EAAI,EAAJA,EAAaS,KAAOgqL,SAAAxqL,SAAAD,EAAA,CACvB,IAAAiiI,EAHSxhI,KAGEgqL,SAAXzqL,GACD,GAAAiiI,EAAAviI,OAAAA,EACF,OAAAuiI,EAAAz9H,aARH4iC,QAAAkI,KAAA,wBAAA5vC,EAAA,+DAmBI,IAFF,IAEOM,EAAI,EAAJA,EAAaS,KAAOgqL,SAAAxqL,SAAAD,EAAA,CACvB,IAAAiiI,EAHSxhI,KAGGgqL,SAAZzqL,GACA,GAAAiiI,EAAAviI,OAAAA,EAEH,YADEuiI,EAAAz9H,MAAAA,kEAQD6lL,GAAKtnL,UAAQgoL,eAAS,SAAA71J,QAEf,IAATA,IAAoBA,MAElB,IAAA,IAAIl1B,EAAI,EAARA,EAAgBS,KAAIgqL,SAApBxqL,SAAAD,EAAA,CACD,IAAAiiI,OAAAwoD,SAAAzqL,iDAyECgrL,GAAO,gBAGTvqL,KAAA4f,IAAA2qK,KACavqL,KAAbkuE,wBAYAluE,KAAKm1D,OAAL82G,EAAAnmI,IAAA,GAAA,GAAA,GAAA,GACA9lC,KAAK28E,OAAA,kBAEL38E,KAAAy8E,YAAAgrD,EAAAmmC,YAAAnmC,EAAAomC,YAGA7tK,KAAKwqL,SAAA3kJ,EAAeiH,SACpB9sC,KAAKyqL,SAAA5kJ,EAALiH,sCAEA9sC,KAAA0qL,gBAAA7kJ,EAAAiH,SAGA9sC,KAAK2qL,+BAEL3qL,KAAK2pE,aAAe,6BAUrB2S,GAPDh6E,UAAAsoL,WAAA,SAAAn2J,6EAWE6nD,GAAAh6E,UAAY+5C,YAAe,SAA3B5nB,UAFFoR,EAAAoS,OAAApL,GAAA7sC,KAAAwqL,kCASA,IAAI9+G,GAAArqC,EAAYyE,IAAK,EAAL,GAAhB,GAEI+kJ,GAAAhlJ,EAAAiH,uBAEJg+I,GAAAzpJ,EAAAyL,SA2BE,IAAAi+I,GAAA,2BAEA/qL,KAAK4qC,MAAQ,KAEb5qC,KAAKg0F,MAALyzC,EAAcilC,2CAGd1sK,KAAAgrL,WAAA,EAGAhrL,KAAKirL,OAAA,EAELjrL,KAAAkrL,WAAA5uB,EAAA,IACAt8J,KAAKmrL,SAAA,EAELnrL,KAAKorL,kBAAoB,IAAAvoJ,aAAc,GACvC7iC,KAAKqrL,iBAAmB,IAAAxoJ,aAAc,oIAEtC7iC,KAAAsrL,aAAA,IAAAzoJ,cAAAx9B,KAAA6E,IAAA,GAAAlK,KAAAkrL,YAAAlrL,KAAAmrL,WAGAnrL,KAAKurL,YAAa9jD,EAAlBmlC,YACA5sK,KAAKwrL,mBAAkB,KACvBxrL,KAAKyrL,WAAA,KACLzrL,KAAK0rL,iBAAL,EACA1rL,KAAK2rL,mBAAL,KACA3rL,KAAK4rL,kBAAL,KACA5rL,KAAK6rL,YAAA,KACL7rL,KAAK8rL,gBAAkB,EACvB9rL,KAAK+rL,gBAAL,EACA/rL,KAAKgsL,gBAAA,IACLhsL,KAAKisL,kBAAkB,GACvBjsL,KAAKksL,oBAAqB,EAC1BlsL,KAAKmsL,gBAALtmJ,EAnC2BiH,SAA7B9sC,KAAAosL,gBAAA,6BAwCAC,IAA0B7vK,OAAS61I,cAAe,GAAAi6B,WAAAj6B,cAAA,GAAA3pI,MAAA2pI,cAAA,GAAAk6B,WAAAl6B,cAAA,GAAAm6B,SAAAn6B,cAAA,GAAAl8F,OAAAk8F,cAAA,GAAAo6B,YAAAp6B,cAAA,GAAAq6B,WAAAr6B,cAAA,GAAAs6B,gBAAAt6B,cAAA,GAAAu6B,kBAAAv6B,cAAA,GAAAw6B,YAAAx6B,cAAA,GAAAy6B,gBAAAz6B,cAAA,GAAA06B,gBAAA16B,cAAA,GAAA26B,gBAAA36B,cAAA,GAAA46B,kBAAA56B,cAAA,GAAA66B,oBAAA76B,cAAA,IAEjD04B,GAFDzoL,UAAAs8E,QAAA,SAAAn6C,iBAMEsmJ,GAAAzoL,UAAKq8E,SAAmB,SAAxBzkE,EAAAyC,EAAAzQ,GACAw/J,EAAK5/I,IAAA9rB,KAAAm1D,OAAmBj7C,EAAAyC,EAAIzQ,GAC5BlM,KAAKmtL,cAAc,GAAKjzK,EAAIla,KAAKgrL,WAJnChrL,KAAAmtL,cAAA,GAAAxwK,EAAA3c,KAAAgrL,WAMAhrL,KAAAmtL,cAAqB,GAArBjhL,EAAAlM,KAAiCgrL,YAEhCqB,GAFD7vK,MAAAmM,IAAA,+BAMEoiK,GAAAzoL,UAAK8qL,aAAmB,SAAxBjiJ,GACAnrC,KAAKgrL,WAAL7/I,EACAnrC,KAAKmtL,cAAc,GAAKhiJ,EAAMnrC,KAAKm1D,OAAOj7C,EAJ5Cla,KAAAmtL,cAAA,GAAAhiJ,EAAAnrC,KAAAm1D,OAAAx4C,EAMA3c,KAAAmtL,cAAqB,GAAAhiJ,EAAUnrC,KAAMm1D,OAAAjpD,GAEpCmgL,GAFDC,UAAA3jK,IAAA,mCAMCoiK,GAFDzoL,UAAAw8E,QAAA,SAAAuuG,GAGArtL,KAAAg0F,MAAAq5F,GAEChB,GAFD3jK,KAAAC,IAAA,8BAMEoiK,GAAAzoL,UAAKgrL,aAAuB,SAAsBniJ,GAFpDnrC,KAAAkrL,WAAA//I,EAIAnrC,KAAAsrL,aAAA,GAAqBjmL,KAArB6E,IAAiD,GAAjDlK,KAAqCkrL,aAEpCmB,GAFDE,UAAA5jK,IAAA,mCAMEoiK,GAAAzoL,UAAKirL,WAAL,SAAApiJ,GAFFnrC,KAAAmrL,SAAAhgJ,EAIAnrC,KAAAsrL,aAAA,GAAqBngJ,GAEpBkhJ,GAFDG,QAAA7jK,IAAA,iCAMCoiK,GAFDzoL,UAAAkrL,SAAA,SAAAH,GAGArtL,KAAAirL,OAAAoC,GAEChB,GAFDl2H,MAAAxtC,IAAA,+BAMIoiK,GAAAzoL,UAAKmrL,cAAL,SAAA/kK,GACD1oB,KAAAurL,cAAA9jD,EAAAmlC,aAAAlkJ,IAAA++G,EAAAmlC,cACD5sK,KAAK0rL,iBAAL,GAEF1rL,KAAAurL,YAAqB7iK,GAEpB2jK,GAFDI,WAAA9jK,IAAA,oCAMC0jK,GAFDK,UAAA/jK,IAAA,mCAMC0jK,GAFDM,eAAAhkK,IAAA,wCAMIoiK,GAAAzoL,UAAKorL,oBAAL,SAAAviJ,GACDnrC,KAAA4rL,oBAAAzgJ,IACDnrC,KAAK0rL,iBAAoB,GAE3B1rL,KAAA4rL,kBAAqBzgJ,GAEpBkhJ,GAFDO,iBAAAjkK,IAAA,0CAMCoiK,GAFDzoL,UAAAqrL,cAAA,SAAAxiJ,GAGAnrC,KAAA6rL,YAAqB1gJ,GAEpBkhJ,GAFDQ,WAAAlkK,IAAA,oCAMCoiK,GAFDzoL,UAAAsrL,kBAAA,SAAAziJ,GAGAnrC,KAAA8rL,gBAAqB3gJ,GAEpBkhJ,GAFDS,eAAAnkK,IAAA,wCAMCoiK,GAFDzoL,UAAAurL,kBAAA,SAAA1iJ,GAGAnrC,KAAA+rL,gBAAqB5gJ,GAEjBkhJ,GAAAU,eAAApkK,IAAA,WACD,OAAA3oB,KAAAg0F,QAAAyzC,EAAAilC,kBACM,wBAKRqe,GAFDzoL,UAAAwrL,kBAAA,SAAA3iJ,GAGAnrC,KAAAgsL,gBAAqB7gJ,GAEjBkhJ,GAAAW,eAAArkK,IAAA,WACD,OAAA3oB,KAAAg0F,QAAAyzC,EAAAilC,kBACM,wBAKRqe,GAFDzoL,UAAAyrL,oBAAA,SAAA5iJ,GAGAnrC,KAAAisL,kBAAqB9gJ,GAEpBkhJ,GAFDY,iBAAAtkK,IAAA,0CAMCoiK,GAFDzoL,UAAA0rL,sBAAA,SAAA7iJ,GAGAnrC,KAAAksL,oBAAqB/gJ,GAEpBkhJ,GAFDa,mBAAAvkK,IAAA,4CAMEoiK,GAAIzoL,UAAA2rL,YAAJ,SAAAx5J,EAAA20J,GAqBI,OAnBJ30J,EAAAy5J,aAAAluL,KAGAy0B,EAAIy5C,MAAM5uE,EAAI,EACdm1B,EAAIy5C,MAAMxqE,EAAI,mCAEd+wB,EAAAy5C,MAAA36B,EAAAvzC,KAAA4rL,kBAGA3f,EAAIngJ,IAAA2I,EAAW0gC,OAAf,EAAA,EAAA,EAAA,GACA1gC,EAAIkoD,OAAA,eAEJloD,EAAAgoD,YAAAgrD,EAAAmmC,YAAAnmC,EAAAomC,wBAIAp5I,EAAAk1C,aAAA3pE,KAAAwrL,mBAGIxrL,KAAAg0F,OACA,KAAAyzC,EAAAklC,YAxNJ,SAAAwhB,EAAAC,EAAAC,yBAGAxoJ,EAAAoS,OAAAm2I,EAAAA,uHAuNE,MAEE,KAAA3mD,EAAAilC,mBAnNJ,SAAAyhB,EAAAC,EAAAC,yBAGAxoJ,EAAAoS,OAAAm2I,EAAAA,GAID,IAAAE,EAAAH,EAAAI,kBAAA,yFA8MG,MAEE,KAAA9mD,EAAA+mD,kCAEF,MAbF,mEAoBA3oJ,EAAK3hC,IAAAuwB,EAAOg6J,aAAIh6J,EAAhBg2J,SAAqCh2J,EAAA+1J,UAzCvCxqL,KAAAmsL,gBAAA13J,EAAAg6J,yDA8CE1D,GAAAzoL,UAAcosL,iCAAd,WACA1uL,KAAK4qC,MAAAiG,eAAcg6I,IACnB/3I,EAAKitB,SAAM9sB,GAAK43I,IAChBxpJ,EAAI2S,cAAW82I,GAAfp/G,GAAAz4B,IACA5R,EAAA/e,MAAStiB,KAAAorL,kBAATN,IACA,IAAI1lL,EAAKpF,KAAAqrL,iBACTjmL,EAAI,GAAKylL,GAAUv6I,IARrBlrC,EAAA,GAAAylL,GAAAt6I,iBAaIw6I,GAAAzoL,UAAYqsL,mBAD8B,SAAAlnJ,GAE1CznC,KAAAyrL,WAAa,IAAArqJ,GAAA+N,UAF6B1H,GAG1C9jC,MAAA3D,KAAY4rL,kBACZhoL,OAAO5D,KAAI4rL,kBACX7hH,OAAO3oC,GAAIoxC,kBALbvI,MAAA7oC,GAAAu3I,WAOAxuG,MAAK/oC,GAAAu3I,aAMH34K,KAAA2rL,mBAAQ,IAD4FvqJ,GAAA2pC,aAAAtjC,EAAArG,GAAA+pC,WAAAnrE,KAAA4rL,kBAAA5rL,KAAA4rL,mBAEpG5rL,KAAAwrL,mBAAY,IAAApqJ,GAAAgqC,YAAA3jC,EAAAznC,KAAA4rL,kBAAA5rL,KAAA4rL,mBAFd/gH,QAAA7qE,KAAAyrL,YAbFrkI,MAAApnD,KAAA2rL,sBAqBIZ,GAAAzoL,UAAKssL,kBAAL,WACA5uL,KAAKyrL,aACLzrL,KAAKyrL,WAAAhxJ,UACLz6B,KAAK2rL,mBAALlxJ,UACAz6B,KAAKwrL,mBAAL/wJ,UACAz6B,KAAKyrL,WAAA,KACNzrL,KAAA2rL,mBAAA,KARH3rL,KAAAwrL,mBAAA,uCAcExrL,KAAI0uL,mCAAJ1uL,KAEOurL,cAAS9jD,EAATmlC,YACL5sK,KAAK4uL,oBACA5uL,KAAA0rL,kBACL1rL,KAAK4uL,oBACN5uL,KAAA2uL,mBAAAlnJ,GATHznC,KAAA0rL,iBAAA,IAeApnI,OAAAqvH,iBAAAoX,GAAAzoL,UAAA+pL,IAIA,IAAI7B,GAAA3kJ,EAAeiH,SACf29I,GAAA5kJ,EAAAiH,SACA2hJ,GAAe5oJ,EAAAiH,uBAEf+hJ,GAASxtJ,EAAAyL,SAEXoa,GAAA,2BAEAlnD,KAAA4qC,MAAA,KAGA5qC,KAAA8uL,YAAArnD,EAAAsnD,iBAGA/uL,KAAKm1D,OAAL82G,EAAAnmI,IAAA,GAAA,GAAA,IAAA,GACA9lC,KAAK28E,OAAA,EACL38E,KAAK0hL,SAAL,oBAEA1hL,KAAAy8E,YAAAgrD,EAAAmmC,YAAAnmC,EAAAomC,YAGA7tK,KAAA42D,aAAA,kBAIA52D,KAAA2pE,aAAA,KAGA3pE,KAAKgvL,MAAO,IACZhvL,KAAAivL,KAAA,IACAjvL,KAAK88E,KAALz3E,KAAa8E,GAAA,EAAAnK,KAAbkuE,8CAUFghH,IAAAtxG,aAAAy0E,cAAA,IAGC68B,GAFDtxG,YAAAj1D,IAAA,qCAMCumK,GAFDtxG,YAAA9xD,IAAA,SAAAyrC,wBAOCrQ,GAFD5kD,UAAA6sL,QAAA,WAGA,OAAOnvL,KAAA4qC,OAENsc,GAFD5kD,UAAAs8E,QAAA,SAAAn6C,iBAOCyiB,GAFD5kD,UAAAy5G,QAAA,WAGA,OAAO/7G,KAAA8uL,aAEN5nI,GAFD5kD,UAAAw8E,QAAA,SAAAp2D,uBAOCw+B,GAFD5kD,UAAA8sL,eAAA,WAGA,OAAOpvL,KAAAqvL,cAENnoI,GAFD5kD,UAAA29E,eAAA,SAAA90C,wBAOC+b,GAFD5kD,UAAAgtL,OAAA,WAGA,OAAOtvL,KAAA88E,MAEN51B,GAFD5kD,UAAAk8E,OAAA,SAAApB,gBAOCl2B,GAFD5kD,UAAAitL,QAAA,WAGA,OAAOvvL,KAAAgvL,OAEN9nI,GAFD5kD,UAAAm8E,QAAA,SAAA2qF,iBAOCliH,GAFD5kD,UAAAktL,OAAA,WAGA,OAAOxvL,KAAAivL,MAEN/nI,GAFD5kD,UAAAo8E,OAAA,SAAA2qF,gBAOCniH,GAFD5kD,UAAAmtL,SAAA,SAAAh7J,GAGA,OAAOw3I,EAAP/3H,KAAiBzf,EAAjBz0B,KAA4Bm1D,SAE3BjO,GAFD5kD,UAAAq8E,SAAA,SAAAzkE,EAAAyC,EAAAzQ,EAAAnD,+BAOCm+C,GAFD5kD,UAAAotL,SAAA,WAGA,OAAO1vL,KAAA28E,QAENz1B,GAFD5kD,UAAA2rC,SAAA,SAAAmZ,kBAOCF,GAFD5kD,UAAAqtL,WAAA,WAGA,OAAO3vL,KAAA0hL,UAENx6H,GAFD5kD,UAAAstL,WAAA,SAAA7gI,oBAOC7H,GAFD5kD,UAAAutL,cAAA,WAGA,OAAO7vL,KAAAy8E,aAENv1B,GAFD5kD,UAAAy7E,cAAA,SAAAkkG,uBAOE/6H,GAAA5kD,UAAa0sE,QAAb,SAAAv6C,GAMF,OALEA,EAAIn1B,EAAIU,KAAKkuE,MAAM5uE,EACnBm1B,EAAI/wB,EAAI1D,KAAKkuE,MAAMxqE,mBAEnB+wB,EAAA8e,EAAOvzC,KAAPkuE,MAAA36B,EAEF9e,GAQEyyB,GAAK5kD,UAAU2sE,QAAf,SAAA3vE,EAAAoE,EAAA4vC,EAAAC,GACAvzC,KAAKkuE,MAAM5uE,EAAIA,EACfU,KAAKkuE,MAAMxqE,EAAIA,EAJjB1D,KAAAkuE,MAAA56B,EAAAA,kBAUC4T,GAFD5kD,UAAAwtL,UAAA,WAGA,OAAO9vL,KAAA2qL,SAENzjI,GAFD5kD,UAAA+5E,UAAA,SAAA+sG,mBAOCliI,GAFD5kD,UAAAytL,eAAA,WAGA,OAAO/vL,KAAA2pE,cAENziB,GAFD5kD,UAAA0tL,eAAA,SAAAC,wBAME/oI,GAAI5kD,UAAU2rL,YAAe,SAA7Bx5J,EAAA9wB,EAAAC,GAEA6wB,EAAIy5C,MAAM5uE,EAAIU,KAAKkuE,MAAM5uE,EAAIqE,EAC7B8wB,EAAIy5C,MAAMxqE,EAAI1D,KAAKkuE,MAAMxqE,EAAIE,2BAE7B6wB,EAAAy5C,MAAA36B,EAAAvzC,KAAAkuE,MAAA36B,EAAA3vC,EAGA6wB,EAAI0gC,OAAJn1D,KAAem1D,OACf1gC,EAAIkoD,OAAA38E,KAAc28E,gCAElBloD,EAAAgoD,YAAAz8E,KAAAy8E,YAGAhoD,EAAAmiC,aAAA52D,KAAA42D,oCAIAniC,EAAAk1C,aAAA3pE,KAAA2pE,+CAIA9jC,EAAAoS,OAAAxjB,EAAA+1J,SAAA/1J,EAAA+1J,UAIE,IAAA7gB,EAAKhmK,EAAYC,EAMlB,GAPD5D,KAOO8uL,cAAArnD,EAAAsnD,iBACLlpJ,EAAI4jI,YAASh1I,EAAAg2J,SAAezqL,KAA5B88E,KAAA6sF,EAAA3pK,KAAAgvL,MAAAhvL,KAAAivL,UACI,CACJ,IAAA3vL,EAAKU,KAAMqvL,aAAX1lB,EAGDjmK,EAAA1D,KAAAqvL,gEAxCHxpJ,EAAA3hC,IAAAuwB,EAAAg6J,aAAAh6J,EAAAg2J,SAAAh2J,EAAA+1J,sDAiDEtjI,GAAI5kD,UAAUq9E,cAAd,SAAAlrD,EAAAirD,EAAA/7E,EAAAC,GACA,IAAI+lK,EAAKhmK,EAAAC,EACL01C,EAAKt5C,KAAKkuE,MAAM5uE,EAAIqE,EACpB41C,EAAKv5C,KAAKkuE,MAAMxqE,EAAIE,mBAExBo1J,EAAAh5J,KAAAkuE,MAAA36B,EAAA3vC,EAYC,6BARDiiC,EAAAoS,OAAAuyI,GAAAA,IACAxqL,KAOO8uL,cAAArnD,EAAAsnD,iBACLlpJ,EAAI4jI,YAASghB,GAALzqL,KAAoB88E,KAA5B6sF,EAAA3pK,KAAAgvL,MAAAhvL,KAAAivL,UACI,CACJ,IAAA3vL,EAAKU,KAAMqvL,aACF1lB,EAEVjmK,EAAA1D,KAAAqvL,+DAKDxpJ,EAAA3hC,IAAAuqL,GAAAhE,GAAAD,IAGA3kJ,EAAAoS,OAAAyyI,GAAA+D,IAGEzuL,KAAK8uL,cACFrnD,EAAcsnD,sDAKjB,GAGA1tJ,EAAAwS,cAAApf,EAAAA,EAAAi2J,IAXF1qL,KAcO4qC,MAAA0yB,iBAAAuxH,IACLxtJ,EAAKpX,KAAIwK,EACNo6J,GAAAp6J,EAAc70B,GAAf0hC,MAAArX,KAAAjqB,KAAgCgvL,MAC/BhvL,KAAAivL,KAAc,EAAfvvG,EAAAt2C,MAIF/H,EAAAvV,IAAA2I,EAAA,GAAAirD,EAAApgF,EAAAg6C,GAAAy/G,EAAA,EAAA,GAAAr5E,EAAAh8E,EAAA61C,GAAAy/G,EAAA,EAAA,EAAAt5E,EAAAt2C,EAAA,+BASF8d,GAAI5kD,UAAU4tL,cAAd,SAAAz7J,EAAA07J,EAAAxsL,EAAAC,GACA,IAAI+lK,EAAKhmK,EAAAC,EACL01C,EAAKt5C,KAAKkuE,MAAM5uE,EAAIqE,EACpB41C,EAAKv5C,KAAKkuE,MAAMxqE,EAAIE,mBAExBo1J,EAAAh5J,KAAAkuE,MAAA36B,EAAA3vC,EAYC,6BARDiiC,EAAAoS,OAAAuyI,GAAAA,IACAxqL,KAOO8uL,cAAArnD,EAAAsnD,iBACLlpJ,EAAI4jI,YAASghB,GAALzqL,KAAoB88E,KAA5B6sF,EAAA3pK,KAAAgvL,MAAAhvL,KAAAivL,UACI,CACJ,IAAA3vL,EAAKU,KAAMqvL,aACF1lB,EAEVjmK,EAAA1D,KAAAqvL,+DAKDxpJ,EAAK3hC,IAAAuqL,GAALhE,GAAAD,IAEAnpJ,EAAAwS,cAAcpf,EAAD07J,EAAoB1B,IACjCh6J,EAAIn1B,EAAIg6C,EAAR,IAAQ7kB,EAAQn1B,EAAM,GAAtBy5J,qBAEAtkI,EAAA2U,EAAA,GAAO3U,EAAP2U,EAAA,MAKFkb,OAAAqvH,iBAAAzsH,GAAA5kD,UAAA4sL,IAIE,IAAA/qJ,GAAA,WACAnkC,KAAKowL,SAAA,EACLpwL,KAAK4qC,MAAL,KACA5qC,KAAKqwL,oBACLrwL,KAAKswL,YACLtwL,KAAKgqL,+BAELhqL,KAAA42D,cAAA,GAMF25H,IAAqBC,qBAA0Bn+B,cAAY,GAAAo+B,WAAAp+B,cAAA,GAAAq+B,eAAAr+B,cAAA,GAAAz0E,aAAAy0E,cAAA,IAE1Dk+B,GAFDC,oBAAA7nK,IAAA,gDAMC4nK,GAFDE,UAAA9nK,IAAA,mCAMC4nK,GAFDG,cAAA/nK,IAAA,kEAMC4nK,GAFD3yG,YAAAj1D,IAAA,qCAMC4nK,GAFD3yG,YAAA9xD,IAAA,SAAAyrC,wBAMCpzB,GAFD7hC,UAAAs8E,QAAA,SAAAn6C,iBAMCN,GAFD7hC,UAAAquL,aAAA,SAAAjiL,sBAMIy1B,GAAA7hC,UAAAsuL,kBAAA,SAAA92D,IACD,IAAA95H,KAAAqwL,iBAAA1sK,QAAAm2G,mCAMF31F,GAFD7hC,UAAAuuL,qBAAA,2CAMI1sJ,GAAA7hC,UAAAwuL,UAAA,SAAAnwJ,GACD,IAAA,IAAA3gC,KAAAswL,SAAA3sK,QAAAgd,GAAA,CAGD3gC,KAAAswL,SAAA5qL,KAAAi7B,GAGA,IAAAowJ,EAAKzsI,OAALxX,OAAA,MATFnM,EAAA2pJ,eAAAyG,2BAcE5sJ,GAAA7hC,UAAc0uL,aAAd,WAFFhxL,KAAAswL,SAAA9wL,OAAA,0BAOI2kC,GAAA7hC,UAAY2uL,gBAAZ,SAAAx8J,EAAApT,GACA,OAAArhB,KAAIkxL,YACJz8J,EAAI2W,MAAKprC,KACTy0B,EAAIgQ,KAAJzkC,KAAa4qC,MACbnW,EAAIqlG,GAAA,oCAEJrlG,EAAAq1J,QAAAr1J,EAAAkM,OAAA2pJ,eAAAtqL,KAAAgqL,SAAA,MAKA3oK,GAAWrhB,KAAXqwL,iBAAA7wL,QACAi1B,EAAI2W,MAAK,KACT3W,EAAIgQ,KAAJ,KACAhQ,EAAIqlG,GAAA,wBAEJrlG,EAAAq1J,QAAA,QAKFr1J,EAAI2W,MAAKprC,uBAETy0B,EAAIqlG,GAAA95H,KAAQqwL,iBAAZhvK,GAGEA,EAAUrhB,KAAKswL,SAAS9wL,QAF1BmhC,EAGO3gC,KAAAswL,SAAAjvK,GACLyoK,EAAS9pL,KAAKgqL,SAAS3oK,KAExBsf,EAAA3gC,KAAAswL,SAAAtwL,KAAAswL,SAAA9wL,OAAA,GACDsqL,EAAA9pL,KAAagqL,SAAbhqL,KAAAswL,SAAA9wL,OAAA,IAjCFi1B,EAAAkM,OAAAA,uCA2BI,IAAAA,EAASmpJ,GAYbxlI,OAAAqvH,iBAAAxvI,GAAA7hC,UAAAiuL,IAOA,IAAAY,GAAA,GAiBAC,IAAA,EAAA,GAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,KAQI,SAAIC,GAAS/xL,GACX,OAAAA,EAAA,IACDA,EAAA,aAIAA,EAAA,gBAOFA,EAAA,cAIAA,EAAA,gBAeC,SAAAgyL,GAAAvoL,EAAAmD,GACD,GAAAnD,IAAAmD,WAIG,KAAAnD,IAAOA,KAAQmD,IAAfA,EAAA,CACD,GAAA,IAAAnD,GAAA,IAAAmD,kBAIG,GAAAnD,EAAA,GAAAmD,EAAA,EAAA,CACD,GAAAA,GAAA,WAIA,GAAAnD,GAAA,WAIFA,GAAAA,mBAKGwoL,EAAJF,GAAAnlL,GAEI9E,EAAA,EAYH,OAVCoqL,EAAAD,GACAxoL,GAAKqoL,GAALG,EAAAC,EAAA,GAHFtlL,GAIO,GACL9E,GAAK,GACLoqL,EAAAD,IACArlL,GAAAklL,GAAAI,EAAAD,EAAA,GACDxoL,GAAA,QAIAA,IAAAmD,6BAQCulL,EAAA7/G,OAAJ1lE,GAEC,OAAAwlL,IAAAD,kCAmCD,IAAIE,EAAAC,EAAJ,EAEC,GAAAD,IAAAE,WAKG,GAAAC,EAAAxvK,EAAAqvK,KAAArvK,EAAAsvK,IAAA,EAAA,CACD,KAAAD,EAAAE,GAAAC,EAAAxvK,EAAAqvK,GAAArvK,EAAAqvK,EAAA,IAAA,wBAuBHE,IAEE,KAAAD,EAAAC,GAAc,CACd,IAAAzqL,EAAMkb,EAAQsvK,GACftvK,EAAAsvK,KAAAtvK,EAAAuvK,GACFvvK,EAAAuvK,KAAAzqL,IA/BC2qL,CAOOzvK,EAAAsvK,EAAAD,QAGJ,KAAAA,EAAAE,GAAAC,EAAAxvK,EAAAqvK,GAAArvK,EAAAqvK,EAAA,KAAA,GACFA,eAkCC,SAAAK,GAAA1vK,EAAAsvK,EAAAC,EAAAnoK,EAAAooK,OACDpoK,IAAAkoK,oBAKC,IAAAK,EAAA3vK,EAAAoH,OAIAkvD,EAAAlvD,QAOE,IAAIwoK,EAAAzzI,EAAAm6B,IAAqB,EAAzBk5G,EAEOG,EAAA3vK,EAAA4vK,IAAA,EACLt5G,EAAOs5G,EAEVzzI,EAAAyzI,EAAA,EASD,IAAA9/K,EAAQsX,EAAR+0B,EAEI,OAAArsC,GACF,KAAA,EACAkQ,EAAAm8B,EAAA,GAAAn8B,EAAAm8B,EAAA,GAEA,KAAA,EACAn8B,EAAAm8B,EAAA,GAAAn8B,EAAAm8B,EAAA,GAEE,KAAA,EACFn8B,EAAAm8B,EAAA,GAAAn8B,EAAAm8B,GACE,MACE,QACA,KAAArsC,EAAA,GACDkQ,EAAAm8B,EAAArsC,GAAAkQ,EAAAm8B,EAAArsC,EAAA,GAdLA,IAmBHkQ,EAAAm8B,GAAAwzI,GAiBC,SAAIE,GAAJpuL,EAAAue,EAAAoH,EAAAlqB,EAAAk4K,EAAAoa,GACA,IAAIM,EAAJ,MAEIh4J,EAAQ,oBAKR,IAFFi4J,EAAO7yL,EAASk4K,EAEdt9I,EAAUi4J,GAAVP,EAAA/tL,EAAAue,EAAAoH,EAAAguJ,EAAAt9I,IAAA,QAEAA,EAAiB,GAAbA,GAAa,KAEhB,IACFA,EAAAi4J,GAIAj4J,EAAAi4J,cAMDj4J,GAAAs9I,MAGA,CAEE,IADA2a,EAAA3a,EAAa,EACbt9I,EAAUi4J,GAAVP,EAAA/tL,EAAAue,EAAAoH,EAAAguJ,EAAAt9I,KAAA,QAEAA,EAAiB,GAAbA,GAAa,KAEhB,IACFA,EAAAi4J,GAGAj4J,EAAAi4J,SAKD,IAAA/sH,EAAS8sH,EACVA,EAAA1a,EAAAt9I,YAUCg4J,UAEA,IAAI92K,EAAA82K,GAAeh4J,EAAMg4J,IAAiB,GAA1CN,EAGO/tL,EAAAue,EAAAoH,EAAApO,IAAA,EACL82K,EAAA92K,EAAA,EAEH8e,EAAA9e,WAmBD,SAAIg3K,GAAJvuL,EAAAue,EAAAoH,EAAAlqB,EAAAk4K,EAAAoa,GACA,IAAIM,EAAJ,MAEIh4J,EAAQ,oBAKR,IAFFi4J,EAAO3a,EAAS,EAEdt9I,EAAUi4J,GAAVP,EAAA/tL,EAAAue,EAAAoH,EAAAguJ,EAAAt9I,IAAA,QAEAA,EAAiB,GAAbA,GAAa,KAEhB,IACFA,EAAAi4J,GAIAj4J,EAAAi4J,SAKD,IAAA/sH,EAAS8sH,QAETh4J,EAAAs9I,EAAApyG,OAME,IAFF+sH,EAAO7yL,EAASk4K,EAEdt9I,EAAUi4J,GAAVP,EAAA/tL,EAAAue,EAAAoH,EAAAguJ,EAAAt9I,KAAA,QAEAA,EAAiB,GAAbA,GAAa,KAEhB,IACFA,EAAAi4J,GAIAj4J,EAAAi4J,SAKFD,GAAA1a,WAUD0a,UAGE,IAAI92K,EAAA82K,GAAeh4J,EAAMg4J,IAAiB,GAA1CN,EAGO/tL,EAAAue,EAAAoH,EAAApO,IAAA,EACL8e,EAAA9e,EAEH82K,EAAA92K,EAAA,WAOD,IAAAi3K,GAAA,SAAAjwK,EAAAwvK,GACA9xL,KAAKsiB,MAAAA,EACLtiB,KAAK8xL,QAASA,iBAnZhB,EAqZE9xL,KAAKR,OAAA8iB,EAAA9iB,OAEHQ,KAAAwyL,iBAjZJ,IAkZGxyL,KAAAR,OAAA,6CAIDQ,KAAKslE,IAAA,IAAAjyD,MACFrT,KAAKwyL,kBAIRxyL,KAAKyyL,YAAWzyL,KAAIR,OAAW,IAAA,EAA/BQ,KAAAR,OAAA,KAAA,GAAAQ,KAAAR,OAAA,OAAA,GAAA,GAEAQ,KAAK0yL,SAAL,IAAAr/K,MAAArT,KAAAyyL,aApBFzyL,KAAA2yL,UAAA,IAAAt/K,MAAArT,KAAAyyL,+BA8eI,SAAAl6I,GAAUj2B,EAAAsvK,EAAUC,EAAAC,GACrB,IAAAz+K,MAAA2P,QAAAV,oDASAjc,IAAAurL,cAIAvrL,IAAAwrL,qBAIAxrL,IAAAyrL,UAID,IAAAc,EAAAf,EAAAD,EAGC,KAAAgB,EAAA,GAAA,CAID,IAAID,EAAY,EAEd,GAAAC,EAAAzB,GAEDa,GAAA1vK,EAAAsvK,EAAAC,EAAAD,GADCe,EAAAE,GAAAvwK,EAAAsvK,EAAAC,EAAAC,IACDA,OAFC,CAMF,IAAIgB,EAAA,IAASP,GAAAjwK,EAAawvK,GAEvBiB,cAjzBD,IAFF,IAAA74K,EAAO,EAEL9H,GAAA++K,IACDj3K,GAAA,EAAA9H,mBAgzBE4gL,CAAAJ,GAED,EAAA,CAEE,IADAD,EAAIE,GAAJvwK,EAAAsvK,EAAAC,EAAAC,IACYiB,EAAQ,CAClB,IAAAvkJ,EAAQokJ,EACTpkJ,EAAAukJ,SAIFf,GAAA1vK,EAAAsvK,EAAAA,EAAApjJ,EAAAojJ,EAAAe,EAAAb,GACDa,EAAAnkJ,iBAIAskJ,EAAAG,YAfFL,GAmBSD,aAET,IAAAC,wBA3gBAL,GAAKjwL,UAAU4wL,QAAK,SAApBR,EAAAC,GACA3yL,KAAK0yL,SAAL1yL,KAAAmzL,WAAAT,EAHF1yL,KAAA2yL,UAAA3yL,KAAAmzL,WAAAR,+EAiBI,IAAKvgL,EAHKpS,KAIRmzL,UAAO,EAIP,GAAA/gL,GAAI,GARIpS,KAQG2yL,UAAPvgL,EAA0B,IARtBpS,KAQsB2yL,UAAyBvgL,GAR/CpS,KAQ+C2yL,UAAAvgL,EAAA,IAAAA,GAAA,GAR/CpS,KAQ+C2yL,UAAAvgL,EAAA,IAR/CpS,KAQ+C2yL,UAAAvgL,GAR/CpS,KAQ+C2yL,UAAAvgL,EAAA,GAR/CpS,KAUP2yL,UAAAvgL,EAAA,GAVOpS,KAUP2yL,UAAAvgL,EAAA,IAPHA,SAWC,GAdSpS,KAcT2yL,UAAAvgL,GAdSpS,KAcT2yL,UAAAvgL,EAAA,GACD,MAfUpS,KAHdozL,QAAAhhL,oEA+BI,IAAIA,EAHMpS,KAGGmzL,UAAO,EAEnB/gL,EAAA,GALSpS,KAKT2yL,UAAAvgL,EAAA,GALSpS,KAKT2yL,UAAAvgL,EAAA,QALSpS,KAHdozL,QAAAhhL,KAsBEmgL,GAAIjwL,UAAQ8wL,QAAZ,SAAA7zL,sBAEI+iB,EAAAtiB,KAASsiB,MAET+wK,EAASrzL,KAAK0yL,SAASnzL,GACvB+zL,EAAUtzL,KAAK2yL,UAAUpzL,wBAE7Bg0L,EAAAvzL,KAAA2yL,UAAoBpzL,EAAU,GAE9BS,KAAI2yL,UAAWpzL,GAAA+zL,EAAeC,EAE5Bh0L,IAAKS,KAAAmzL,UAAmB,IACzBnzL,KAAA0yL,SAAAnzL,EAAA,GAAAS,KAAA0yL,SAAAnzL,EAAA,4CAIDS,KAAAmzL,YAMA,IAAAj0K,EAAAozK,GAAAhwK,EAAAkxK,GAAAlxK,EAAA+wK,EAAAC,EAAA,EAAAxB,QAIC,KAFDwB,GAAIp0K,IAYH,KAFDq0K,EAAIpB,GAAe7vK,EAAA+wK,EAAAC,EAAA,GAAAhxK,EAAAkxK,EAAAD,EAAAA,EAAA,EAAAzB,MAQnBwB,GAGOC,EACLvzL,KAAKyzL,SAALJ,EAAAC,EAAAE,EAAAD,GAhDJvzL,KAAA0zL,UAAAL,EAAAC,EAAAE,EAAAD,KAmEEhB,GAAIjwL,UAAUmxL,SAAd,SAAAJ,EAAAC,EAAAE,EAAAD,GAEA,IAAIzB,EAAM9xL,KAAV8xL,QACIxvK,EAAJtiB,KAAAsiB,iBAEA/iB,EAAK,EAEJ,IAAAA,EAAA,EAAAA,EAAA+zL,EAAA/zL,gBAID,IAAIo0L,EAAO,MAEXr0D,EAAM+zD,EAIF,GAFJ/wK,EAAMg9G,KAAFh9G,EAAiBsxK,KAEjB,KAAAL,EAOA,GAAM,IAAND,EAAA,CAUF,IAFF,IAAAO,EAAa7zL,KAAA6zL,YAEP,CACJ,IAAIC,EAAO,MAERC,GAAA,EAEC,GACA,GAAAjC,EAAAxvK,EAAAsxK,GAAAtuH,EAAAquH,IAAA,GAKE,GAJFrxK,EAAAg9G,KAAAh9G,EAAAsxK,SAEAE,EAAM,EAEJ,KAAAP,EAAA,CACDQ,GAAA,EARH,YAgBI,GAHFzxK,EAAAg9G,KAAAh6D,EAAAquH,KACAG,IACEE,EAAO,EACP,KAAAV,EAAA,CACDS,GAAA,EACF,cAGOD,EAAAE,GAAAH,GAET,GAAAE,WAOK,GAAM,KAFVD,EAAIxB,GAAchwK,EAAAsxK,GAAAtuH,EAAAquH,EAAAL,EAAA,EAAAxB,IAEd,CACD,IAAAvyL,EAAA,EAAAA,EAAAu0L,EAAAv0L,kBAOC,GAHF+/H,GAAAw0D,EACAH,GAAIG,GACFR,GAAOQ,IACP,EAAA,CACDC,GAAA,EACF,OAMC,GAFFzxK,EAAMg9G,KAAFh9G,EAAiBsxK,KAEnB,KAAAL,EAAA,CACDQ,GAAA,QAMG,GAAM,KAFVC,EAAI7B,GAAc7sH,EAAAquH,GAAArxK,EAAAsxK,EAAAL,EAAA,EAAAzB,IAEd,CACD,IAAAvyL,EAAA,EAAAA,EAAAy0L,EAAAz0L,kBAQC,GAJF+/H,GAAA00D,OAIE,KAFFT,GAAIS,GAEF,CACDD,GAAA,EACF,OAKC,GAFFzxK,EAAMg9G,KAAFh6D,EAAJquH,KAEE,KAAAL,EAAA,CACDS,GAAA,kBAMHD,GAzpBJ,GAypBcE,GAzpBd,GA2pBK,GAAAD,QAIAF,EAAA,cAaC,GANJ7zL,KAAI6zL,UAAJA,EAECA,EAAA,sBAIS,IAANP,EAAA,CACD,IAAA/zL,EAAA,EAAAA,EAAAg0L,EAAAh0L,IACD+iB,EAAMg9G,EAAO//H,GAAb+iB,EAAwBsxK,EAAxBr0L,GAGA+iB,EAAMg9G,EAAIi0D,GAAMjuH,EAAAquH,OAEX,CAAA,GAAA,IAAAL,EACL,MAAK,IAAL5zI,MAAgB,6CAEf,IAAAngD,EAAA,EAAAA,EAAA+zL,EAAA/zL,IACF+iB,EAAAg9G,EAAA//H,GAAA+lE,EAAAquH,EAAAp0L,QAxHG,CACD,IAAAA,EAAA,EAAAA,EAAAg0L,EAAAh0L,IACD+iB,EAAMg9G,EAAO//H,GAAb+iB,EAAwBsxK,EAAxBr0L,GAED+iB,EAAAg9G,EAAAi0D,GAAAjuH,EAAAquH,QAVE,IAAAp0L,EAAA,EAAAA,EAAA+zL,EAAA/zL,IACD+iB,EAAAg9G,EAAA//H,GAAA+lE,EAAAquH,EAAAp0L,IA+IFgzL,GAAIjwL,UAAQoxL,UAAZ,SAAAL,EAAAC,EAAAE,EAAAD,GACA,IAAIzB,EAAM9xL,KAAV8xL,QACIxvK,EAAJtiB,KAAAsiB,iBAEA/iB,EAAK,EAEJ,IAAAA,EAAA,EAAAA,EAAAg0L,EAAAh0L,gBAID,IAAIo0L,EAAON,EAASC,EAApB,EACIM,EAAAL,EAAJ,EACIj0D,EAAAk0D,EAAJD,EAAA,MAEAU,EAAgB,KAEhB3xK,EAAMg9G,KAAFh9G,EAAiBqxK,YAYnB,GAAW,IAAXJ,EAAA,CAgBA,IAFF,IAAAM,EAAa7zL,KAAA6zL,YAEP,CACJ,IAAIC,EAAO,MAERC,GAAA,EAEC,GACA,GAAAjC,EAAAxsH,EAAAsuH,GAAAtxK,EAAAqxK,IAAA,GAIE,GAHFrxK,EAAAg9G,KAAAh9G,EAAAqxK,KACAG,IACEE,EAAO,EACP,KAAAV,EAAA,CACDS,GAAA,EAPH,YAeI,GAHFzxK,EAAAg9G,KAAAh6D,EAAAsuH,KACAI,IACEF,EAAO,EACP,KAAAP,EAAA,CACDQ,GAAA,EACF,cAIOD,EAAAE,GAAAH,GAET,GAAAE,WAOG,GAAW,KAFbD,EAAIR,EAAchB,GAAAhtH,EAAAsuH,GAAAtxK,EAAA+wK,EAAAC,EAAAA,EAAA,EAAAxB,IAEL,CAOV,IAJDwB,GAAAQ,KAFAx0D,GAAAw0D,KAIAI,GAHAP,GAAAG,GAGqB,EAEpBv0L,EAAAu0L,EAAA,EAAAv0L,GAAA,EAAAA,kBAIC,GAAA,IAAA+zL,EAAA,CACDS,GAAA,EACF,OAMC,GAFFzxK,EAAMg9G,KAAFh6D,EAAJsuH,KAEE,KAAAL,EAAA,CACDQ,GAAA,QAMC,GAAW,KAFbC,EAAIT,EAAcpB,GAAA7vK,EAAAqxK,GAAAruH,EAAA,EAAAiuH,EAAAA,EAAA,EAAAzB,IAEL,CAOV,IAJDyB,GAAAS,KAFA10D,GAAA00D,KAIAE,GAHAN,GAAAI,GAGwB,EAEvBz0L,EAAA,EAAAA,EAAAy0L,EAAAz0L,kBAIC,GAAAg0L,GAAA,EAAA,CACDQ,GAAA,EACF,OAMC,GAFFzxK,EAAMg9G,KAAFh9G,EAAiBqxK,KAEnB,KAAAL,EAAA,CACDS,GAAA,kBAMHD,GA30BJ,GA20BcE,GA30Bd,GA60BK,GAAAD,QAIAF,EAAA,cAaD,GANF7zL,KAAI6zL,UAAJA,EAECA,EAAA,sBAIY,IAAXN,EAAW,CAMV,OALDj0D,GAAAg0D,KAGAY,GAFAP,GAAAL,GAEsB,EAErB/zL,EAAA+zL,EAAA,EAAA/zL,GAAA,EAAAA,kBAKD+iB,EAAMg9G,GAAIh6D,EAAMsuH,OAEX,CAAA,GAAA,IAAAL,EACL,MAAA,IAAA7zI,MAAe,8CAGd,IADCw0I,EAAM50D,GAAei0D,EAAK,GAC3Bh0L,EAAA,EAAAA,EAAAg0L,EAAAh0L,IACF+iB,EAAA4xK,EAAA30L,GAAA+lE,EAAA/lE,QA3IC,CAMC,OALD+/H,GAAAg0D,KAGAY,GAFAP,GAAAL,GAEsB,EAErB/zL,EAAA+zL,EAAA,EAAA/zL,GAAA,EAAAA,kBAIF+iB,EAAAg9G,GAAAh6D,EAAAsuH,QAjBE,IAFDM,EAAY50D,GAAZi0D,EAA8B,GAE7Bh0L,EAAA,EAAAA,EAAAg0L,EAAAh0L,iBAiOH,IAAA40L,GAAa,SAAbllJ,GAFFjvC,KAAAqmL,OAAA,2BAOA+N,IAAA50L,QAA+B6yJ,cAAA,GAAwB1hJ,MAAA0hJ,cAAA,qCAKjD,GAAApjH,EAAOjvC,KAAP8Q,MAAkBtR,OACnB,IAAA,IAAAD,EAAAS,KAAA8Q,MAAAtR,OAAAD,EAAA0vC,IAAA1vC,EAHQS,KAIV8Q,MAAAvR,QAAA8G,GAKF+tL,GAFD50L,OAAAmpB,IAAA,+BAMCyrK,GAFDzjL,KAAAgY,IAAA,4DASG,IAFD,IAECppB,EAAA,EAAAA,EAAAS,KAAAqmL,SAAA9mL,EAFYS,oCASXm0L,GAAK7xL,UAAQoD,KAAW,SAAxBylC,GACDnrC,KAAAqmL,QAAArmL,KAAA8Q,MAAAtR,0CAHHQ,KAAA8Q,MAAA9Q,KAAAqmL,QAAAl7I,+CAYEnrC,KAAIqmL,OAEHrmL,KAAAqmL,OAAA,wDAKDrmL,KAAA8Q,MAAA9Q,KAAAqmL,aAAAhgL,KAKE8tL,GAAA7xL,UAAAm4D,WAAA,SAAA3jB,GACD,KAAAA,GAAA92C,KAAAqmL,QAAA,CAID,IAAA/yK,EAAWtT,KAAXqmL,OAAmB,EACnBrmL,KAAK8Q,MAALgmC,GAAA92C,KAAA8Q,MAAAwC,GARFtT,KAAA8Q,MAAAwC,QAAAjN,mBAaE8tL,GAAI7xL,UAAYqhB,QAAQ,SAAAwnB,GACtB,IAAA2L,EAAQ92C,KAAR8Q,MAAA6S,QAAAwnB,GACD,OAAA2L,GAAA92C,KAAAqmL,aAOF8N,GAFD7xL,UAAAi2C,KAAA,SAAAtB,0CAMAqN,OAAIqvH,iBAAOwgB,GAAwB7xL,UAAA8xL,yBAKjCp0L,KAAK43I,IAAL/gG,gBAEA72C,KAAKq0L,OAAL,IAAgBhhL,MAAhB47B,GAEC,IAAA,IAAA1vC,EAAA,EAAAA,EAAA0vC,IAAA1vC,EANDS,KAHFq0L,OAAA90L,GAAAs3C,sCAeE,kBAGA72C,KAAIq0L,OAAM,IAAOhhL,MAAI47B,GAGpB,IADC,IAAAlhB,EAAOkhB,EAAP0tB,EAAmBn9D,OACpBD,EAAA,EAAAA,EAAAwuB,IAAAxuB,EANSS,eAAAA,WAUT,IAAA,IAAA+yK,EAAAhlJ,EAAA3B,EAAA,EAAA2mJ,EAAA9jI,IAAA8jI,IAAA3mJ,EAVSpsB,kCAiBVg5F,GAAA12F,UAAIk2F,MAAe,WAElBx4F,KAAAs0L,KAAA,sDAID,IAAEj/K,EAAKrV,KAAPq0L,OAAAr0L,KAAAs0L,2CAEAt0L,KAAOs0L,QAKPt7F,GAAA12F,UAAY81F,KAAK,SAAjBvhC,KAFF72D,KAAAs0L,+BASE,IAAAC,GAAA,SAAA19I,EAAA5H,GACAjvC,KAAK43I,IAAL/gG,EACA72C,KAAKqmL,OAAQ,kBAEbrmL,KAAKw0L,MAAQ,6BAKfC,IAAAjxC,MAAgC6O,cAAY,GAAAqiC,MAAAriC,cAAA,GAAA7yJ,QAAA6yJ,cAAA,IAE3CoiC,GAFDjxC,KAAA76H,IAAA,8BAMC8rK,GAFDC,KAAA/rK,IAAA,8BAMC8rK,GAFDj1L,OAAAmpB,IAAA,2DAOE,IAAI8b,EAAMzkC,KAAVqvH,MAAiB72B,eAAjBx4F,KAEOw0L,OAGNx0L,KAAAw0L,MAAAxV,MAAAv6I,EACDA,EAAKkwJ,MAAQ30L,KAAbw0L,OAHEx0L,KAAK40L,MAAMnwJ,eAMbzkC,KAAAqmL,QAAA,KAKEkO,GAAKjyL,UAALymD,OAAwB,SAAxBtkB,GADFA,EAEOkwJ,MACLlwJ,EAAKkwJ,MAAL3V,MAAkBv6I,EAAlBu6I,yBAGFv6I,EAEOu6I,MACLv6I,EAAKu6I,MAAL2V,MAAkBlwJ,EAAlBkwJ,yBAKFlwJ,EAAKu6I,MAAM,KACXv6I,EAAKkwJ,MAAL,KAhBF30L,KAAAqvH,MAAAj3B,KAAA3zD,sDAsBE,IAEEowJ,EAAA70L,KAAA40L,MACD,GAAAC,EAAA,CAIAC,iBAOC,YAFF7zG,EAAO4zG,EAEFA,aAEHh+I,EAAAg+I,EAAS/9I,EAhBE92C,MAkBZ60L,EAAA5zG,IArBHnqC,IA0BAwN,OAAIqvH,iBAAc4gB,GAASjyL,UAATmyL,yBAKhBz0L,KAAK43I,IAAL/gG,gBAEA72C,KAAK8Q,MAAQ,IAAGuC,MAAI47B,GAEnB,IAAA,IAAA1vC,EAAA,EAAAA,EAAA0vC,IAAA1vC,EANDS,KAHF8Q,MAAAvR,GAAAs3C,KAcAk+I,IAA4Bv1L,QAAM6yJ,cAAY,GAAA1hJ,MAAA0hJ,cAAA,IAE7C0iC,GAFDv1L,OAAAmpB,IAAA,+BAMCosK,GAFDpkL,KAAAgY,IAAA,8BAMC8rB,GAFDnyC,UAAAu1C,MAAA,0DASM,GAAA5I,EAAOjvC,KAAP8Q,MAAkBtR,OACnB,IAAA,IAAAD,EAAAS,KAAA8Q,MAAAtR,OAAAD,EAAA0vC,IAAA1vC,EAHQS,KAIV8Q,MAAAvR,GAJUS,KAIV43I,OAKCnjG,GAAKnyC,UAAYuC,IAAM,kBACxB7E,KAAAqmL,QAAArmL,KAAA8Q,MAAAtR,oEAOCi1C,GAAAnyC,UAAAymD,OAAA,SAAAjS,GACD,KAAAA,GAAA92C,KAAAqmL,QAAA,CAID,IAAA/yK,EAAWtT,KAAXqmL,OAAuB,EACvB/gH,EAAAtlE,KAAA8Q,MAAmBgmC,GACnB92C,KAAK8Q,MAALgmC,GAAA92C,KAAA8Q,MAAAwC,GATFtT,KAAA8Q,MAAAwC,GAAAgyD,mBAcC7wB,GAFDnyC,UAAAi2C,KAAA,SAAAtB,0CAMAqN,OAAIqvH,iBAAel/H,GAAnBnyC,UAAAyyL,IAGC,IADC,IAAAC,GAAA3hL,MAAA,GACD9T,GAAA,EAAAA,GAAA,IAAAA,aAMC,IAAA4kD,GAAK,WACLnkD,KAAKi1L,QAAL,IAAgBd,GAAA,IAChBn0L,KAAKk1L,QAAA,IAALf,GAAA,6BAEAn0L,KAAA87E,aAAA,qBAME33B,GAAA7hD,UAAA6yL,KAAA,SAAAp8F,EAAAv+D,IACD,IAAAA,EAAA41J,UAHHr3F,EAAArzF,KAAA80B,0BAWI2pB,GAAA7hD,UAAA8yL,QAAA,SAAAr8F,EAAAv+D,IACD,IAAAA,EAAA41J,UAIDr3F,EAAKpoF,KAAAooF,EAAUv5F,OAAf,GAAA4wL,QAAA51J,EAAA41J,QAPFr3F,EAAAt+B,WAAAjgC,EAAA41J,sDAeI,IAFF,IAEQ7wL,EAAA,EAAAA,EAANS,KAAAk1L,QAAA11L,SAAAD,EAAA,CAFWS,KAGZk1L,QAAAvkL,KAAApR,GANHq3D,cAAA,IAWCzS,GAFD7hD,UAAA+yL,eAAA,SAAA5+B,wBAQCtyG,GAFD7hD,UAAAgzL,eAAA,wCAMCnxI,GAFD7hD,UAAAizL,UAAA,SAAAz+I,iCAMCqN,GAFD7hD,UAAAu8E,UAAA,SAAAljB,+BAMCxX,GAFD7hD,UAAA88E,aAAA,SAAAzjB,kCAQCxX,GAFD7hD,UAAAkzL,cAAA,uCAMCrxI,GAFD7hD,UAAAmzL,SAAA,SAAA3+I,gCAMCqN,GAFD7hD,UAAAozL,SAAA,SAAAtqJ,8BAMC+Y,GAFD7hD,UAAAqzL,YAAA,SAAAvqJ,iCAQC+Y,GAFD7hD,UAAAszL,cAAA,uCAMCzxI,GAFD7hD,UAAAuzL,SAAA,SAAA/+I,gCAMCqN,GAFD7hD,UAAAwzL,SAAA,SAAA3H,8BAMChqI,GAFD7hD,UAAAyzL,YAAA,SAAA5H,iCAQIhqI,GAAA7hD,UAAY0zL,QAAZ,SAAAvzI,IACD,IAAAziD,KAAAi2L,OAAAtyK,QAAA8+B,IAHHziD,KAAAi2L,OAAAvwL,KAAA+8C,IAQE0B,GAAI7hD,UAAJ4zL,WAAgB,SAAAzzI,GACd,IAAA3L,EAAK92C,KAAOi2L,OAAOtyK,QAAnB8+B,IACD,IAAA3L,GAJH92C,KAAAi2L,OAAA91K,OAAA22B,EAAA,IAWA,IAAAq/I,GAAS,EAYP,SAAIC,GAAJxmG,EAAAmhG,GACA,IAAAjyL,KACEwmE,EAAIsqB,EACF,IAAA,IAAA4xC,KAAAuvD,EACDnrK,OAAAwhH,UAAA2pD,EAAAvvD,MACF1iI,EAAA0iI,GAAAuvD,EAAAvvD,IAGC,IAAA,IAAM60D,KAAIv3L,EAAa,CACxB,IAAAw3L,EAAA,IAAA1yC,OAAAyyC,EAAA,KACD/wH,EAAOA,EAAPmhC,QAAA6vF,EAAAx3L,EAAAu3L,aAKA,SAAAE,GAAiB3mG,oBACX,iFACJ,SAAIqiC,EAAc5wG,EAASm1K,EAA3B7sK,EAAA8sK,GACA,IAAIC,EAAA,GACAC,EAAY5wK,SAASywK,GACvBI,EAAc7wK,SAAA4D,IACfgtK,EAAAhkL,OAAAikL,EAAAjkL,QACDg0B,QAAShM,MAAI,sEAEZ,IAAA,IAAAp7B,EAAAo3L,EAAAp3L,EAAAq3L,IAAAr3L,EACDm3L,GAAOD,EAAPhwF,QAAA,IAAAm9C,OAAA,IAAAviI,EAAA,IAAA,KAAA9hB,GAEF,OAAOm3L,IAKP,IAAAG,GAAK,SAAuBpvJ,EAAA8zH,EAAAE,2BAGb,IAAfA,IAAAA,qBAGAz7J,KAAA82L,WAAA,2BAGE92L,KAAA+2L,cACA,IAAA,IAAOx3L,EAAA,EAAOA,EAAAg8J,EAAW/7J,SAAWD,EAAK,CAC1C,IAAAy3L,EAAAz7B,EAAAh8J,GAVIS,4DAgBLskD,OAAK+uG,OAASrzJ,KAAdi3L,QAAAx7B,mBAgBEo7B,GAAAv0L,UAAcogI,OAAA,SAA6BzjI,EAA7By1K,EAAoCE,EAAAkV,GAClD,GAAA9pL,KAAA+2L,WAAA93L,GACD0nC,QAAAkI,KAAA,2BAAA5vC,EAAA,yBADC,CAiCA,IA5BF,IAAAo5B,IAAA89J,GAGE/7J,EAAU,EACVQ,EAAI,SAAUr7B,cAEdiiI,EAAIrzD,QAAJ/zC,EAEA,IAAI88J,EAAI,kCAGNA,EAAI7xL,KAAOogJ,KAAiB,IAAjBjkB,EAAUj8H,IAAVi8H,EAAiBl8H,MAE3Bk8H,EAAC21D,KAFF,SAAApzL,GAHF,OAMOA,EAAA/D,KAAAo3L,MAAA51D,EAAArzD,SACLt1C,KAAI2oG,IAEAA,EAAA21D,KAAO,SAASpzL,GACjB,OAAAA,EACD,GAAAy9H,EAAArzD,QAEH,WAID/zC,GAAI88J,eAKC33L,EAAK,EAAAA,EAAAuqL,EAAatqL,SAAzBD,EACAq7B,EAAOr7B,uBAEPq1K,EAAA50K,KAAA82L,WAAAliB,EAGE50K,KAAA+2L,WAFsB93L,IAGtBo5B,GAAAA,EACAp5B,KAAMA,EACNy1K,KAAAA,EALFE,KAAAA,EA1CFkV,QAAAA,KAyDE+M,GAAIv0L,UAAJ+0L,OAAA,SAAAp4L,EAAA6qL,GAGE,IAFF,IAAAkN,EAASh3L,KAAO+2L,WAAS93L,GACvBymD,EAAI,EACAnmD,EAAA,EAAQA,EAAAy3L,EAAQlN,QAAStqL,SAA7BD,EAAA,CACA,IAAI+3L,EAAUN,EAAAlN,QAAWvqL,GACvBwE,EAAA+lL,EAAAwN,EAAAr4L,WACDoH,IAAAtC,oCAcH8yL,GAAIv0L,UAAei1L,WAAnB,SAAAt4L,EAAA6qL,GACA,IAAIpkI,EAAA1lD,KAASq3L,OAAAp4L,EAAA6qL,GACX1U,EAAOp1K,KAAPshH,OAAA57D,GACD,GAAA0vH,WAKD,IAAI4hB,EAAOh3L,KAAA+2L,WAAA93L,GACXu4L,EA/JA,SAAsBzG,GACpB,IAAAjH,KACE,IAAA,IAAAtoD,KAAAuvD,GACD,IAAAA,EAAAvvD,IACFsoD,EAAApkL,KAAA,WAAA87H,uBA2JMi2D,CAAyB3N,GAAhC,KACIpV,EAAO0hB,GAAkBY,EAAKtiB,KAAMoV,GACxCpV,EAAO8iB,EAAYjB,GAAa7hB,6BAEhCE,EAAA4iB,EAAkBjB,GAAa3hB,IAE7BQ,EAAM,IAAAh0I,GAAAs1I,QAAA12K,KAAA2rE,SAFR+oG,KAAAA,EAIAE,KAAQA,YAGR50K,KAAAshH,OAAO57D,GAAP0vH,uBAQEsiB,GAAA7xJ,EAAciH,SAEd6qJ,GADK,IAAAljJ,GAAA,WAEL,OAFFy1I,MAAA,KADgBzoE,MAAlB,OAOA,GAAmBm2E,GAAnB,IAAAnjJ,GAAA,uCAIA,GAAmBojJ,GAAnB,IAAApjJ,GAAA,uCAIA,GAAmBqjJ,GAAnB,IAAArjJ,GAAA,uCAIA,GAAmBsjJ,GAAnB,IAAAtjJ,GAAA,uCAIA,GAAoBujJ,GAApB,IAAAvjJ,GAAA,wCAIA,GAAoBwjJ,GAApB,IAAAxjJ,GAAA,wCAIA,GAAiByjJ,GAAjB,IAAAzjJ,GAAA,qCAIA,GAAiB0jJ,GAAjB,IAAA1jJ,GAAA,qCAIA,GAAiB2jJ,GAAjB,IAAA3jJ,GAAA,qCAIA,GAAkB4jJ,GAAlB,IAAA5jJ,GAAA,sCAIA,GAEI6jJ,MACDA,GAFH7wD,EAAAqlC,WAAA,SAAA/oK,GAGA,OAAAA,GAEGu0L,GAFH7wD,EAAAslC,YAAA,SAAAhpK,GAGA,OAAAg4D,EAAAz5C,MAAmB41K,GAAMrzL,MAAzBd,IAEGu0L,GAFH7wD,EAAAulC,YAAA,SAAAjpK,GAGA,OAAAs9B,EAAA/e,MAAmB61K,GAAMtzL,MAAzBd,IAEGu0L,GAFH7wD,EAAAwlC,YAAA,SAAAlpK,GAGA,OAAAo8J,EAAA79I,MAAmB81K,GAAMvzL,MAAzBd,IAEGu0L,GAFH7wD,EAAAylC,aAAA,SAAAnpK,GAGA,OAAAA,GAEGu0L,GAFH7wD,EAAA0lC,cAAA,SAAAppK,GAGA,OAAAg4D,EAAAz5C,MAAmBs1K,GAAM/yL,MAAzBd,IAEGu0L,GAFH7wD,EAAA2lC,cAAA,SAAArpK,GAGA,OAAAs9B,EAAA/e,MAAmBu1K,GAAMhzL,MAAzBd,IAEGu0L,GAFH7wD,EAAA4lC,cAAA,SAAAtpK,GAGA,OAAAo8J,EAAA79I,MAAmBw1K,GAAMjzL,MAAzBd,IAEGu0L,GAFH7wD,EAAA6lC,cAAA,SAAAvpK,GAGA,OAAA2nK,EAAAppJ,MAAmBu1K,GAAMhzL,MAAgBd,IAEtCu0L,GAFH7wD,EAAA8lC,cAAA,SAAAxpK,GAGA,OAAAkoK,EAAA3pJ,MAAmBw1K,GAAnBjzL,MAAuCd,IAEpCu0L,GAFH7wD,EAAA+lC,YAAA,SAAAzpK,GAGA,OAAAujK,EAAAhlJ,MAAmBw1K,GAAMjzL,MAAcd,IAEpCu0L,GAFH7wD,EAAAgmC,YAAA,SAAA1pK,GAGA,OAAA+uC,EAAAxwB,MAAmBy1K,GAAMlzL,MAAcd,IAEpCu0L,GAFH7wD,EAAAimC,YAAA,SAAA3pK,+BAMI,IAAAw0L,MACEA,GAAa9wD,EAAYqlC,YACzBnmJ,KAAA,SAAgBrC,GAEf,IADC,IAAAhQ,EAAA+jL,GAAAxzL,MACDtF,EAAA,EAAAA,EAAA+kB,EAAA9kB,SAAAD,EACD+U,EAAO/U,GAAP+kB,EAAA/kB,GAEF,OAAM+U,GAEV26B,KAAA,GAEMspJ,GAAa9wD,EAAYslC,aACzBpmJ,KAAA,SAAgBrC,GAEd,IADA,IAAAhQ,EAAW+jL,GAAYxzL,MAChBtF,EAAI,EAAJA,EAAP+kB,EAAoB9kB,SAApBD,EACD+U,EAAA,EAAA/U,GAAA+kB,EAAA/kB,GAAAD,EACDgV,EAAO,EAAP/U,EAAA,GAAA+kB,EAAA/kB,GAAAmE,EAEF,OAAM4Q,GAEV26B,KAAA,GAEIspJ,GAAM9wD,EAAAulC,aAFVrmJ,UAAAtgB,EAIA4oC,KAAA,GAEMspJ,GAAa9wD,EAAYwlC,aACzBtmJ,KAAA,SAAgBrC,GAEd,IADA,IAAAhQ,EAAQ+jL,GAARxzL,MACOtF,EAAI,EAAXA,EAAkB+kB,EAAlB9kB,SAAAD,EAAA,CACA,IAAAivB,EAAOlK,EAAQ/kB,GACf+U,EAAO,EAAI/U,GAAXivB,EAAAlvB,EACAgV,EAAO,EAAI/U,EAAI,GAAKivB,EAAE9qB,EACvB4Q,EAAA,EAAA/U,EAAA,GAAAivB,EAAA4a,EACD90B,EAAO,EAAP/U,EAAA,GAAAivB,EAAA8kB,EAEF,OAAMh/B,GAEV26B,KAAA,GAEMspJ,GAAa9wD,EAAAylC,cACbvmJ,KAAA,SAAgBrC,GAEf,IADC,IAAAhQ,EAAA2jL,GAAApzL,MACDtF,EAAA,EAAAA,EAAA+kB,EAAA9kB,SAAAD,EACD+U,EAAO/U,GAAP+kB,EAAA/kB,GAEF,OAAM+U,GAEV26B,KAAA,GAEMspJ,GAAa9wD,EAAA0lC,eACbxmJ,KAAA,SAAgBrC,GAEd,IADA,IAAAhQ,EAAW2jL,GAAKpzL,MACTtF,EAAI,EAAJA,EAAP+kB,EAAoB9kB,SAApBD,EACD+U,EAAA,EAAA/U,GAAA+kB,EAAA/kB,GAAAD,EACDgV,EAAO,EAAP/U,EAAA,GAAA+kB,EAAA/kB,GAAAmE,EAEF,OAAM4Q,GAEV26B,KAAA,GAEIspJ,GAAM9wD,EAAA2lC,eAFVzmJ,UAAAtgB,EAIA4oC,KAAA,GAEMspJ,GAAa9wD,EAAA4lC,eACb1mJ,KAAA,SAAgBrC,GAEd,IADA,IAAAhQ,EAAQ2jL,GAARpzL,MACOtF,EAAI,EAAXA,EAAkB+kB,EAAlB9kB,SAAAD,EAAA,CACA,IAAAivB,EAAOlK,EAAQ/kB,GACf+U,EAAO,EAAI/U,GAAXivB,EAAAlvB,EACAgV,EAAO,EAAI/U,EAAI,GAAKivB,EAAE9qB,EACvB4Q,EAAA,EAAA/U,EAAA,GAAAivB,EAAA4a,EACD90B,EAAO,EAAP/U,EAAA,GAAAivB,EAAA8kB,EAEF,OAAMh/B,GAEV26B,KAAA,GAEIspJ,GAAM9wD,EAAA6lC,eAFV3mJ,UAAAtgB,EAIA4oC,KAAA,GAEMspJ,GAAa9wD,EAAA8lC,eACb5mJ,KAAA,SAAgBrC,GAEd,IADA,IAAAhQ,EAAQ2jL,GAARpzL,MACOtF,EAAI,EAAXA,EAAkB+kB,EAAlB9kB,SAAAD,EAAA,CACA,IAAAivB,EAAOlK,EAAQ/kB,GACf+U,EAAO,EAAI/U,GAAXivB,EAAAtU,EACA5F,EAAO,EAAI/U,EAAI,GAAKivB,EAAE7R,EACvBrI,EAAA,EAAA/U,EAAA,GAAAivB,EAAAtiB,EACDoI,EAAO,EAAP/U,EAAA,GAAAivB,EAAAzlB,EAEF,OAAMuL,GAEV26B,KAAA,GAEMspJ,GAAa9wD,EAAA+lC,aACb7mJ,KAAA,SAAgBrC,GAEd,IADA,IAAAhQ,EAAQ2jL,GAARpzL,MACOtF,EAAI,EAAXA,EAAkB+kB,EAAlB9kB,SAAAD,EAAA,CACA,IAAAivB,EAAOlK,EAAQ/kB,GACf+U,EAAO,EAAI/U,GAAXivB,EAAAkhB,IACAp7B,EAAO,EAAI/U,EAAI,GAAKivB,EAAEmhB,IACvBr7B,EAAA,EAAA/U,EAAA,GAAAivB,EAAAohB,IACDt7B,EAAO,EAAP/U,EAAA,GAAAivB,EAAAqhB,IAEF,OAAMv7B,GAEV26B,KAAA,GAEIspJ,GAAM9wD,EAAAgmC,aAFV9mJ,UAAAtgB,EAIA4oC,KAAA,GAEMspJ,GAAa9wD,EAAAimC,aACb/mJ,KAAA,SAAgBrC,GAEd,IADA,IAAAhQ,EAAQ2jL,GAARpzL,MACOtF,EAAA,EAAPA,EAAiB+kB,EAAjB9kB,SAAAD,EAAA,CACA,IAAAivB,EAAOlK,EAAA/kB,GACP+U,EAAO,GAAK/U,GAAZivB,EAAAkhB,IACAp7B,EAAO,GAAK/U,EAAI,GAAKivB,EAAEmhB,IACvBr7B,EAAO,GAAK/U,EAAI,GAAKivB,EAAEohB,IACvBt7B,EAAO,GAAK/U,EAAI,GAAKivB,EAAEqhB,IACvBv7B,EAAO,GAAK/U,EAAI,GAAKivB,EAAEshB,IACvBx7B,EAAO,GAAK/U,EAAI,GAAKivB,EAAEuhB,IACvBz7B,EAAO,GAAK/U,EAAI,GAAKivB,EAAEwhB,IACvB17B,EAAO,GAAK/U,EAAI,GAAKivB,EAAEyhB,IACvB37B,EAAO,GAAK/U,EAAI,GAAhBivB,EAAsB0hB,IACtB57B,EAAO,GAAK/U,EAAI,GAAhBivB,EAAsB2hB,IACtB77B,EAAO,GAAK/U,EAAI,IAAMivB,EAAE4hB,IACxB97B,EAAO,GAAK/U,EAAI,IAAMivB,EAAE6hB,IACxB/7B,EAAO,GAAK/U,EAAI,IAAMivB,EAAE8hB,IACxBh8B,EAAO,GAAK/U,EAAI,IAAMivB,EAAE+hB,IACzBj8B,EAAA,GAAA/U,EAAA,IAAAivB,EAAAgiB,IACDl8B,EAAO,GAAP/U,EAAA,IAAAivB,EAAAiiB,IAEF,OAAMn8B,iCAMR,IAAAuiD,EAEA72D,KAAK2rE,QAAQlkC,EACbznC,KAAKw4L,YAAA,IAAL3B,GAAkCpvJ,EAAQqnB,EAAMusG,iBAAgBvsG,EAAI0sG,eACpEx7J,KAAKy4L,MAAA3pI,EACL9uD,KAAK04L,qBAAL7hI,MAAA4wE,EAAAqlC,WAAA,EAAAj2G,EAAA4wE,EAAAslC,YAAAhxG,EAAAj2B,IAAA,EAAA,GAAA+wB,EAAA4wE,EAAAulC,YAAA3rI,EAAAyE,IAAA,EAAA,EAAA,GAAA+wB,EAAA4wE,EAAAwlC,YAAA9M,EAAAr6H,IAAA,EAAA,EAAA,EAAA,GAAA+wB,EAAA4wE,EAAAylC,aAAA,EAAAr2G,EAAA4wE,EAAA0lC,cAAApxG,EAAAj2B,IAAA,EAAA,GAAA+wB,EAAA4wE,EAAA2lC,cAAA/rI,EAAAyE,IAAA,EAAA,EAAA,GAAA+wB,EAAA4wE,EAAA4lC,cAAAlN,EAAAr6H,IAAA,EAAA,EAAA,EAAA,GAAA+wB,EAAA4wE,EAAA6lC,cAAA5B,EAAA5lI,IAAA,EAAA,EAAA,GAAA+wB,EAAA4wE,EAAA8lC,cAAAtB,EAAAnmI,IAAA,EAAA,EAAA,EAAA,GAAA+wB,EAAA4wE,EAAA+lC,YAAAlG,EAAAx6H,SAAA+pB,EAAA4wE,EAAAgmC,YAAA36H,EAAAhG,SAAA+pB,EAAA4wE,EAAAimC,YAAA7nI,EAAAiH,SAAA+pB,EAAA4wE,EAAAkxD,kBAAA7pI,EAAAqsG,eAAAtkG,EAAA4wE,EAAAkmC,oBAAA7+G,EAAA8pI,mBAAA/hI,qBAEA72D,KAAK64L,kBAAiB,EAErB74L,KAFD84L,WAAA,IAAArkJ,GAAA,0BAIA,GAEIz0C,KAAA+4L,gBADK,IAAAtkJ,GAAA,WAEL,OACArJ,MAAI,KACJ3G,KAAA,KACAq1F,GAAA,KALFn5F,OAAA,KAOCmpJ,QARH,OAUA,KAEI9pL,KAAAg5L,iBAAO,IAAAvkJ,GAAA,WACL,OAAA,IAAOA,GADF,WAEL,OACArJ,MAAI,KACJ3G,KAAA,KACAq1F,GAAA,KACAn5F,OAAA,KACAmpJ,QAAS,KAPXJ,UAAA,KASCuP,SAVH,IAzBJ,WAyCCC,GAFD52L,UAAA62L,kBAAA,+EAOE,IAAI1xJ,EAAOznC,KAAK2rE,QAEdy1G,EAAQphL,KAAM64L,yBACfzX,GAAA35I,EAAA20I,MAAAE,yHANHt8K,KAAA64L,mBAAA,KAcCK,GAFD52L,UAAA82L,eAAA,SAAAn6L,EAAA43C,wBAMEqiJ,GAAA52L,UAAKi3H,OAAiB,WAFxBv5H,KAAA84L,WAAAjhJ,uCAOCqhJ,GAFD52L,UAAA+2L,aAAA,4EAOE,IAEA5xJ,EAAAznC,KAAA2rE,QAGAlkC,EAAA6xJ,eAAA72I,EAAAknB,cAQAliC,EAAAo0H,YAAAp5G,EAAAyrB,MAAA5uE,EAAAmjD,EAAAyrB,MAAAxqE,EAAA++C,EAAAyrB,MAAA56B,EAAAmP,EAAAyrB,MAAA36B,GAGE,IAAAgmJ,KAMD92I,EAAAg6B,YAAAgrD,EAAAmmC,cACD2rB,EAAS/8K,OAALimC,EAAmB0S,OAAMj7C,EAAAuoC,EAA7B0S,OAA0Cx4C,EAAA8lC,EAAA0S,OAAAjpD,EAAAu2C,EAAA0S,OAAApsD,IAEzC05C,EAAAg6B,YAAAgrD,EAAAomC,cACD0rB,EAASnyI,MAAL3E,EAAmBk6B,QAEtBl6B,EAAAg6B,YAAAgrD,EAAA+xD,gBACDD,EAAAxqI,QAAAtM,EAAAi/H,UAEAj6I,EAAAmc,MAAA21I,GAGAv5L,KAAK+4L,gBAAelhJ,4CAGlB,IAAAzM,EAAA4Y,EAAAkxI,QAAAvkL,KAAApR,GAGC,GAAA,IAAA6rC,EAAAwrB,aAAAnU,EAAAmU,cAIC,IAAA,IAAMt7C,EAAA,EAAAA,EAAA8vB,EAAgBslJ,gBAAtBp1K,EAAA,CACD,IAAAm+K,EA7CUz5L,KA6CV+4L,gBAAAl0L,MACFumC,EAAA6lJ,gBAAAwI,EAAAn+K,IASDq8K,GAAS9/I,QAEP,IAAA,IAAIk7H,EAAA,EAAAA,EAAatwH,EAAOkoI,QAAAnrL,SAAPuzK,EAAjB,CACA,IAAAmX,EAAWznI,EAAXkoI,QAAA5X,KA1DW/yK,4BA4DX05L,EAAS7hJ,QAEP,IAAA,IAAIzrB,EAAO,EAAAA,EAAApsB,KAAW+4L,gBAAOv5L,SAA7B4sB,EAAA,OA9DSpsB,6BAgELmqL,EAAMwP,EAAAh5J,OAAAi5J,aAAA1P,GAER,GAAAC,EAAA,CACA,IAAA0P,EAAAH,EAAiB70L,MACjBg1L,EAAUzuJ,MAAKuuJ,EAAfvuJ,MACAyuJ,EAAUp1J,KAAVk1J,EAAmBl1J,KACnBo1J,EAAU//D,GAAA6/D,EAAU7/D,GACpB+/D,EAAUl5J,OAAVg5J,EAAAh5J,OACAk5J,EAAU/P,QAAU6P,EAApB7P,QACD+P,EAAAnQ,UAAAS,EACF0P,EAAAZ,SAAA,GAID,IAAAa,EAAAnC,GAAA9yL,MACDi1L,EAAA5P,MAAAA,YAKC,IAAA,IAAIzN,EAAK,EAAOA,EAAAkb,GAAen4L,SAA/Bi9K,EAAA,mBAvFJ5lI,EAGe72C,KAsFG+5L,UAAdxtK,EAAA29J,QAzFJznI,EAAAl2B,EAAAk1F,wCAgGE,IAEIh6E,EAAOznC,KAAK2rE,QACVquH,EAAJh6L,KAAAw4L,YACI/zJ,EAAAjK,EAASiK,KACTq1F,EAAAt/F,EAAAs/F,GACAn5F,EAAAnG,EAAUmG,qBAEhBmpJ,EAAAtvJ,EAAAsvJ,QAKA8N,GAAa//I,QACbggJ,GAAahgJ,QACbigJ,GAAAjgJ,QACAkgJ,GAAAlgJ,QACAmgJ,GAAWngJ,QACXogJ,GAAWpgJ,QACXqgJ,GAAWrgJ,QACXsgJ,GAAAtgJ,mBAEAwgJ,GAAAxgJ,6BAMApQ,EAAI48I,WAAU,QAAYx+I,EAAAvjB,MAAW01K,GAAcnzL,MAAA6yL,KAEjD,IAAAp5B,EAAKxrH,EAAUmF,OAAfgiJ,GAAAnnJ,EAAAitB,SAAAk6H,GAAAvC,KACAp5B,IACDxrH,EAAA4tH,UAAAu5B,GAAA37B,GACD72H,EAAA48I,WAAA,eAAAvxI,EAAAxwB,MAAAy1K,GAAAlzL,MAAAo1L,MAKE,IAAA,IAAI16L,EAAA,EAAQA,EAAAmqL,EAAOL,YAAP7pL,SAAZD,EAAA,wBAEI0+F,EAAAt9D,EAAUypJ,YAAWxmK,EAAA3kB,MAUvB,QARDoH,IAAA43F,kBAIA53F,IAAA43F,MA9CUj+F,sCAkDTqG,IAAA43F,EAQE,GAAAr6E,EAAI8E,OAAA++G,EAAckxD,kBAAc/0K,EAAA8E,OAAA++G,EAAAkmC,mBAC9B,QAAetnK,IAAfud,EAAAqrB,KAAe,CACf,GAAArrB,EAAAqrB,OAAAgvD,EAAAz+F,OAAA,CACDmnC,QAAAhM,MAAA,gCAAAsjE,EAAAz+F,OAAA,2BAAAokB,EAAAqrB,KAAA,MACD,SAGC,IADC,IAAAq1I,EAAM+T,GAAgBxzL,MACvBwc,EAAA,EAAAA,EAAA48E,EAAAz+F,SAAA6hB,EACDijK,EAAOjjK,GAlEArhB,KAkEgBk6L,oBAEvBzyJ,EAAO0yJ,gBAAgBv2K,EAAvB3kB,KAAAg/F,EAAoCqmF,QAfxC78I,EAiBOinC,WAAA9qD,EAAA3kB,KAAAg/F,EAtEIj+F,KAsEJk6L,yBAED,CACF,IAAAE,OAAiB,EAClB,GAFDn8F,aAGSp7D,cAAyBo7D,aAAAx7D,WAChC23J,EAAIn8F,OACA,QAAA53F,IAAAud,EAAAqrB,KAAsB,CACxB,IAAAorJ,EAAc9B,GAAA30K,EAAA8E,MACd,QAAAriB,IAAAg0L,EAAA1zK,KAAA,CACDggB,QAAAhM,MAAA,mEACD,SAEE,GAAA/W,EAAAqrB,KAAAorJ,EAAAprJ,KAAA,GAAA,CACDtI,QAAAhM,MAAA,8BACD,SAEAy/J,EAAgBC,EAAA1zK,KAAmBs3E,OACnC,CAEFm8F,GAAkBE,EADjBhC,GAAA10K,EAAA8E,OAC4Bu1E,GAEhCx2D,EAAA48I,WAAAzgK,EAAA3kB,KAAAm7L,QAzCEzzJ,QAAAkI,KAAA,oCAAAjrB,EAAA3kB,KAAA,sBA8CD,IAAA,IAAI8zK,EAAQ,EAAGA,EAAA2W,EAAH17I,QAAZxuC,SAAAuzK,EAAA,oBAEAptI,EAAAm0F,EAAAwsD,oBAGA7+I,EAAA8yJ,gBAAA,EAAAzgE,EAAAV,eAGCU,EAAAssD,+CAKD3+I,EAAAgxF,iBAAAqB,EAAAtjF,qDAIA/O,EAAA08I,WAAA/O,GAGA3tI,EAAAw8I,YAAAiE,EAAA1B,WAGE0B,EAAOzB,SAMPh/I,EAAO46I,cAIP56I,EAAOg8I,gBAAgByE,EAAKtB,UAA5BsB,EAAArB,UAAAqB,EAAApB,eAAAoB,EAAAC,gBACD1gJ,EAAAs8I,cAAAmE,EAAAxB,SAAAwB,EAAAvB,iDAKCuB,EAAOlB,aACRv/I,EAAA66I,kBACD76I,EAAS27I,aAAa8E,EAAAhB,aAErBgB,EAAAjB,mDAMCx/I,EAAA+6I,sGAaA/6I,EAAAy7I,kBAAAgF,EAAAX,oBAAAW,EAAAV,qBAAAU,EAAAT,qBAAAS,EAAAR,wBAYDjgJ,EAAAk7I,mBAAAuF,EAAAP,iBAAAO,EAAAN,gBAAAM,EAAAL,gIAKDpgJ,EAAOkvH,KAAA78B,EAAA0gE,OAAA70J,GAhLI3lC,KAHfm5L,sBAyLE,IAAAh4J,IAEA0nJ,SAAA3oI,GAAA2oI,SAGA4R,SAv5FE,SAAchzJ,EAAA92B,GACd,IAAAA,EAAO+pL,iBACR/zJ,QAAAhM,MAAA,wDAKD0L,EAAa11B,EAAG+pL,UAAYl7L,OAAK,cAG/Bm7L,EAAIj1L,KAAKiL,EAAT+pL,UAAkB,EAAAn7L,GAAAoR,EAAA+pL,UAAA,EAAAn7L,EAAA,GAAAoR,EAAA+pL,UAAA,EAAAn7L,EAAA,IAEjBoR,EAAAiqL,kEAIAjqL,EAAAkqL,KACFF,EAAAj1L,KAAAiL,EAAAkqL,IAAA,EAAAt7L,GAAAoR,EAAAkqL,IAAA,EAAAt7L,EAAA,IAID,IAAI6mC,KACFA,EAAA1gC,MAAUzG,KAAEmiC,GAAM4B,cAAiBta,KAAM0Y,GAAI6tI,kBAAmBn0I,IAAK,IACtEnqB,EAAAiqL,SACDx0J,EAAI1gC,MAAUzG,KAAAmiC,GAAA8B,YAAAxa,KAAA0Y,GAAA6tI,kBAAAn0I,IAAA,IAEbnqB,EAAAkqL,gEAUD,IAAI9xJ,EAAK,IAAT3H,GAAAoG,aAAAC,EAAA,IAAArG,GAAA6F,aAAAb,GAAAhF,GAAAsG,aAAA,IAAA7E,aAAA83J,GAAAt0J,GAEE2C,EAAK,YAONr4B,EAAAk3B,gIA62FDogJ,KAAAA,GACAwB,UAAAA,GACAG,OAAMA,qBAENttG,KAAAA,GAEAyuG,MAAOA,GACP7jI,OAAOA,YAEP/C,MAAMA,GAnBR+0I,KAAAA,GAsBArC,WAAcA,IAEdvyI,OAAA+uG,OAAAlyH,GAAAsmG,GAIA,IAoIEpY,GApIEyrE,GAAA,IAAgBj4J,aAAI,4BAEpBk4J,GAAA,IAAmBl4J,aAAU,IAE7Bq0H,GAAgB,SAAhB3E,GACA,SAAK2E,EAAezvH,EAAAuzJ,GACrBzoC,EAAAhwJ,KAAAvC,KAAAynC,EAAAuzJ,+EAIDzoC,IAAgB2E,EAAUigB,UAAc5kB,6CAExC2E,EAAgB50J,UAAUwc,YAAQo4I,EAEjCA,EAFD50J,UAAAu1C,MAAA,yDASE73C,KAAAu5H,SACqCv1E,EAAA63B,SAAAtjC,KAAA,SAAAxvC,EAAAmD,GAAW,OAA9CnD,EAAAk1E,WACW/xE,EAAA+xE,WAAoC,EAC1Cl1E,EAAAk1E,WAAA/xE,EAAA+xE,YAAE,EAHT,yCASE,IAAAtiB,EAAA3X,EAAA63B,SAAAlrE,KAAApR,GAGAo8D,EAAOy0H,QAAA7wL,EAdTS,KAHF8/E,aAAAnkB,EAAA3X,4CAwBE,IAAIzpB,EAAOv6B,KAAO2rE,QAAlBrc,IAAA/0B,OAEIkoB,EAAOkZ,EAAAlZ,KACT85B,EAAO5gB,EAAK4gB,MAKZ,GAJA95B,IACDA,EAAAziD,KAAAq5L,eACD98G,GAAA,GAEEA,EAAI,CACJ,IAAI54E,EAAO42B,EAAA52B,MACTC,EAAQ22B,EAAO32B,OACf+3D,EAASgO,eACVhmE,EAAAg4D,EAAAgO,aAAAwpB,OACDvvF,EAAO+3D,EAAPgO,aAAAhxD,SAEFgjD,EAAKsyH,YAAcxrI,EAAnB9+C,EAAAC,kEASA5D,KAAK2rE,QAAQ04G,WAAW,OAAAx+I,EAAYvjB,MAAKw4K,GAAMr4I,EAAA+nI,kEAE/CxqL,KAAA2rE,QAAA04G,WAAA,WAAAx+I,EAAAvjB,MAAAy4K,GAAAt4I,EAAAgsI,eAGE,IAAA,IAAOlvL,EAAA,EAAMA,EAAbkiH,EAAAjiH,SAAAD,EAAA,CACD,IAAAi7B,EAAAinF,EAAA9wG,KAAApR,GATDS,KAHFi7L,MAAAzgK,OAtDkB,CAwEpB2G,GAAI+3J,MAoCA59B,IAFJG,mjCA1BIx8J,KAAM,cACNy1K,KAAA,2NALYE,KAQd,4PACEkV,aAEA7qL,KAAM,OACNy1K,KAAA,ypDAZYE,KAmBd,8VACEkV,UAAM7qL,KADR,eAAAA,KAAA,aAAAA,KAAA,gBAAAA,KAAA,qBAAAA,KAAA,wBAGEA,KAAM,SACNy1K,KAAA,mkBAvBJE,KAAA,wmBA4CIsmB,GAAmB,WACnBl7L,KAAK4tC,SAAL,KAHJ5tC,KAAA03H,YAAA,sBAWIyjE,GADK,IAAAniG,GAAA,WAEL,OACA15F,EAAG,EACHoE,EAAG,EACH0lC,EAAG,EACHrT,EAAA,EANFvH,EAAA,EAQChS,MATH,IAWA,KASIk7E,GAAA,SAAuB0jG,GACvB,SAAK1jG,IACL0jG,EAAA74L,KAAAvC,oBAEAA,KAAKq7L,YAELr7L,KAAKs7L,QAAL,EACAt7L,KAAKu7L,QAAU,gBAEfv7L,KAAK2Y,QAAU,EAEhB3Y,KAAA8yF,SAAA,oBAIDsoG,IAAqB1jG,EAArBy/E,UAAAikB,6CAEA1jG,EAAIp1F,UAAAwc,YAA+B44E,EAEnC,IAAA27E,GAAA3qJ,MAA8B2pI,cAAY,GAAAuF,YAAAvF,cAAA,WAEzCghB,EAFD3qJ,KAAAC,IAAA,0BAMC0qJ,EAFDzb,WAAAjvI,IAAA,qCAME0qJ,EAAIzb,WAAwB9rI,IAAA,SAAAtsB,GAC1B,IAAAmR,EAAA3Q,KAAA8Q,MACA,GAAAH,EAAKnR,SAAQA,EAAY,CAExB,IAAA,IAAAD,EAAAC,EAAAD,EAAAoR,EAAAnR,OAAAD,IACD47L,GAAA/iG,KAAAznF,EAAApR,IAGC,IAAA,IAAAwzK,EAAApiK,EAAAnR,OAAAuzK,EAAAvzK,EAAAuzK,IACDpiK,EAAKoiK,GAASooB,GAAd3iG,QAXJ7nF,EAAAnR,OAAAA,IAqBIk4F,EAAKp1F,UAASk5L,iBAAd,SAAA73L,EAAAC,EAAA63L,EAAAC,GACA/3L,IAAA3D,KAAemzF,QAAfvvF,IAAA5D,KAAA2Y,SAAA8iL,IAAAz7L,KAAAs7L,SAAAI,IAAA17L,KAAAu7L,UACAv7L,KAAKmzF,OAALxvF,EACA3D,KAAK2Y,QAAU/U,EACf5D,KAAKs7L,QAALG,EACDz7L,KAAAu7L,QAAAG,EAXH17L,KAAA6yF,WAAA,IAgBC6E,EAFDc,MAAA,8BAMId,EAAKU,KAAQ,SAAbznF,GACE,GAAAA,aAAe+mF,EAAf,CACD,IAAA,IAAAn4F,EAAAoR,EAAAnR,OAAA,EAAAD,EAAA,EAAAA,IACD47L,GAAW/iG,KAAXznF,EAAAG,MAAAvR,IAEAoR,EAAKG,MAAAtR,OAAL,EACAmR,EAAK0qL,SAAL77L,OAAA,EACAmR,EAAKi9B,SAAL,KACAj9B,EAAKmiF,SAAA,EACLniF,EAAKkiF,WAAL,EACAliF,EAAA+mH,YAAA,EACD/mH,EAAAgrL,YAAA,EAbHtsE,GAAAj3B,KAAAznF,KAkBA2zC,OAAOqvH,iBAAPj8E,EAAAp1F,UAAA+wK,KA9EE,CAiFJ6nB,IAEAxjG,GAAQhvE,KAAS,aAEhB2mG,GAFD,IAAAr2B,GAAA,0BAIA,IASQ,IAAAwgC,GAAA,SAAuB4hE,GACvB,SAAA5hE,IACH4hE,EAAA74L,KAAAvC,mBAIDo7L,IAAuB5hE,EAAvB29C,UAAqCikB,6CAErC5hE,EAAIl3H,UAAAwc,YAA+B06G,EAEnC,IAAA65C,GAAA3qJ,MAA8B2pI,cAAY,WAEzCghB,EAFD3qJ,KAAAC,IAAA,0BAMA27B,OAAOqvH,iBAAPn6C,EAAAl3H,UAAA+wK,KAhBI,CAmBR6nB,IAEA1hE,GAAA9wG,KAAA,uCAKiB,IAAfkzK,IAAAA,GAAA,GAHF57L,KAAA67L,SAAA,mBASCtzK,GAFDjmB,UAAAw5L,OAAA,4BAMCvzK,GAFDjmB,UAAAy5L,OAAA,aAQI,IAAAC,GAAK,SAALC,sBAEc,IAAdL,IAAoBA,GAApB,GAEAK,EAAK15L,KAALvC,KAAA47L,6BAKFK,IAAQllB,EAAUI,UAAc8kB,6CAEhCllB,EAAQz0K,UAAUwc,YAAUi4J,EAE3BA,EAFDz0K,UAAAqyE,QAAA,iCAMAoiG,EAAQz0K,UAAUsyE,MAAlB,aAECmiG,EAFDz0K,UAAAm4B,QAAA,qDAjBO,CAwBTlS,IA4EI,SAAI2zK,GAAahU,GACb,IAAAjoC,EAAOioC,EAAK3B,aAAgB2B,EAAA1B,iBAE/B0B,EAAAzB,SACDxmC,GAASioC,EAAAxB,SAAYwB,EAAAvB,cAAAuB,EAAAtB,UAAAsB,EAAArB,UAAAqB,EAAApB,eAAAoB,EAAAC,eAAAD,EAAAnB,aAEpBmB,EAAAlB,aACD/mC,GAASioC,EAAAjB,YAAciB,EAAAhB,YAOtBgB,EAAAf,eACDlnC,GAAOioC,EAAPd,kBAAAc,EAAAb,iBAAAa,EAAAZ,kBAAAY,EAAAX,oBAAAW,EAAAV,qBAAAU,EAAAT,qBAAAS,EAAAR,uBAAAQ,EAAAP,iBAAAO,EAAAN,gBAAAM,EAAAL,iBAAAK,EAAAJ,mBAAAI,EAAAH,oBAAAG,EAAAF,oBAAAE,EAAAiU,yBAyEA,IAAAC,GAAK,SAAiBH,sBAER,IAAdL,IAAoBA,GAApB,GAEAK,EAAK15L,KAALvC,KALyB47L,GAOzB57L,KAAK2/B,QAAL,KACD3/B,KAAAq8L,yBAIDJ,IAASG,EAAUjlB,UAAc8kB,6CAEjCG,EAAI95L,UAAAwc,YAA6Bs9K,EAEjC,IAAA/oB,GAAAipB,MAA8BjqC,cAAY,WAEzCghB,EAFDipB,KAAA3zK,IAAA,8BAMCyzK,EAFD95L,UAAAiyF,WAAA,SAAAxwF,iBAvFE,SAAA6pC,GACA,IAGIruC,EAAA6sB,EAAAmwK,EAAAt+F,EAAAr6E,EAAA44K,EAHA77J,EAAQiN,EAAAjO,QACR88J,EAAU,QAON,IAFJA,GAnCJ,SAAoB3S,GAEnB,IADG,IAAA7pC,EAAO,GACV1gJ,EAAA,EAAAA,EAAAuqL,EAAAtqL,OAAAD,IACD0gJ,GAAO6pC,EAAPvqL,GAAAN,KAAA6qL,EAAAvqL,GAAAwE,eAgCgB24L,CAAW/7J,EAAYqpJ,UAE/BzqL,EAAA,EAAAA,EAAAohC,EAAAopJ,YAAAvqL,OAAAD,IAAA,CAOC,IAJDk9L,IAFAF,EAAA57J,EAAYopJ,YAAZxqL,IAEAwpL,SAIC38J,EAAA,EAAAA,EAAAmwK,EAAA7jG,OAAAl5F,OAAA4sB,IACDqwK,GAAAP,GAAAK,EAAA7jG,OAAAtsE,IAGI,IAAAA,EAAA,EAAUA,EAAAmwK,EAAVlT,YAAA7pL,OAAA4sB,IAIC,GAFDowK,GADAv+F,EAAOs+F,EAAOlT,YAAYj9J,IACfntB,KACP2kB,EAAA+c,EAAAspJ,YAAAuS,GAIA,OAAKv+F,EAAAv1E,MACD,KAAAyY,GAAY2rI,UACZ,KAAA3rI,GAAA+rI,YACJuvB,GAAc74K,EAAA,IACd,MACI,KAAAud,GAAY4rI,WACZ,KAAA5rI,GAAAgsI,aACJsvB,GAAc74K,EAAAtkB,EAAA,IAAdskB,EAAAlgB,EAAA,IACA,MACI,KAAAy9B,GAAY8rI,WACZ,KAAA9rI,GAAAksI,aACJovB,GAAc74K,EAAAtkB,EAAA,IAAdskB,EAAAlgB,EAAA,IAAAkgB,EAAAwlB,EAAA,IAAAxlB,EAAA0vB,EAAA,IACI,MACA,KAAAnS,GAAAosI,aACJkvB,GAAc74K,EAAA1J,EAAA,IAAd0J,EAAAjH,EAAA,IAAAiH,EAAA1X,EAAA,IAAA0X,EAAA7a,EAAA,IACI,MACA,KAAAo4B,GAAAqsI,WACJivB,GAAc74K,EAAA8rB,IAAA,IAAd9rB,EAAA+rB,IAAA,IAAA/rB,EAAAgsB,IAAA,IAAAhsB,EAAAisB,IAAA,IACA,MACI,KAAA1O,GAAYw3J,iBACZ,KAAAx3J,GAAAwsI,mBACJ8uB,GAAc7uJ,EAAAyuJ,QAAdG,GAAA,IACA,MACA,KAAKr7J,GAAS6rI,WACd,KAAK7rI,GAASisI,aACd,KAAKjsI,GAASmsI,aACV,KAAAnsI,GAAYssI,WACZ,KAAAtsI,GAAAusI,WACJ+uB,GAAAhxI,KAAAC,UAAA9nC,GAAA,cAzIlB,SAAAq8H,EAAA08C,OAAA,IAMAz9K,EAHEqC,EAAI0+H,EAHNzgJ,OAIE+zC,EAJFopJ,EAAAp7K,YAeErC,EAAqB,YAAV,OAFXA,EAAqB,IAAf+gI,EAAC15E,WAAchnE,IAA8B,IAA9C0gJ,EAAkC15E,aAAYhnE,KAAc,GAAjE,IAAoC0gJ,EAAwC15E,aAA5EhnE,KAAA,IAAA,IAAA0gJ,EAAA15E,aAAAhnE,KAAA,OAEmD,YAAZ2f,IAAM,IAAoB,QAAW,IAI5Eq0B,EAAA,YAAA,MAAKA,KAAL,YAAAA,IAAA,IAAA,QAAA,KAFHr0B,EAAqB,YAAV,qBAAwC,YAAZA,IAAM,IAAoB,QAAW,KAI1EqC,GAAA,MAGO,OAAAA,GACR,KAAK,EAAGgyB,IAA8B,IAAxB0sG,EAAI15E,WAAWhnE,EAAI,KAAc,GAC/C,KAAK,EAAGg0C,IAAA,IAAM0sG,EAAI15E,WAAJhnE,EAAoB,KAA1B,EACA,KAAA,uBAJRg0C,GAAA,IAAA0sG,EAAA15E,WAAAhnE,mEASAg0C,GAAKA,IAAM,wCAEXA,GAAAA,IAAO,0BA6IP+Q,OAAOqvH,iBAAPyoB,EAAA95L,UAAA+wK,KAzBO,CA4BT9qJ,IAIIsmE,GAAiB,SAAM+tG,gBAEvBA,EAAWr6L,KAAIvC,MAAA,GAEf,IAAAkoL,EAAK,IAAA/mJ,GAAgB8mJ,KAAA,UACrBC,EAAKj6I,UACH,GAAI,+BAMNi6I,EAAIvvF,SAAAv3D,GAAWw3D,eAAax3D,GAC1B8vI,gBACA9vI,GACI+vI,0BAAuB/vI,GAASw3D,eAAlCx3D,GACA8vI,gBAAiB9vI,GAAA+vI,2BAMrB,IAAA0rB,EAAc,IAAI17J,GAASsoJ,WAAb,iBAAdxqL,KAAA,UAAAypB,KAAAyY,GAAAw3J,mBAAA15L,KAAA,QAAAypB,KAAAyY,GAAAosI,gBAAA2a,IAKIloL,KAAAm1D,QAAcj7C,EAAA,EAAAyC,EAAA,EAAAzQ,EAAA,EAAAnD,EAAA,GADhB/I,KAIE2/B,QAAQ,IAAAwB,GAAcyoJ,QAAOiT,yBAM5B59L,KAAA,aAAL8E,OAAA,IAAA9E,KAAA,WAAA8E,OAAA,IAAA9E,KAAA,YAAA8E,OAAA,IAAA9E,KAAA,WAAA8E,OAAA,KAED/D,KAAA+tC,UAAA8uJ,qBAIDD,IAAe/tG,EAAUsoF,UAAcylB,6CAEvC/tG,EAAIvsF,UAAqBwc,YAAY+vE,EAErC,IAAAwkF,GAA0B1yI,QAAM0xH,cAAY,GAAAp9D,YAAAo9D,cAAA,GAAAnkH,UAAAmkH,cAAA,GAAA5/D,UAAA4/D,cAAA,GAAAnjH,SAAAmjH,cAAA,GAAA71I,OAAA61I,cAAA,WAE3CghB,EAFD1yI,OAAAhY,IAAA,gCAMC0qJ,EAFDp+E,WAAAtsE,IAAA,wDAMC0qJ,EAFDp+E,WAAAnpE,IAAA,SAAAqf,wCAMCkoI,EAFDnlI,SAAAvlB,IAAA,sDAMC0qJ,EAFDnlI,SAAApiB,IAAA,SAAAqf,sCAMCkoI,EAFD5gF,SAAA9pE,IAAA,sDAMC0qJ,EAFD5gF,SAAA3mE,IAAA,SAAAqf,sCAMCkoI,EAFDnkI,QAAAvmB,IAAA,iCAMI0qJ,EAAAnkI,QAAApjB,IAAA,SAAAqf,GACAnrC,KAAK4qE,WAAQz/B,IACbnrC,KAAK4qE,SAAQz/B,EACdnrC,KAAA2/B,QAAA0qJ,YAAA,UAAAl/I,EAAAwpC,WALH30E,KAAAq8L,QAAA,QAAAlxJ,EAAAypC,UAUCy+F,EAFD72J,MAAAmM,IAAA,+BAME0qJ,EAAU72J,MAAVsP,IAAA,SAAAqf,GACA,IAAA3uB,EAAUxc,KAAAm1D,OACV34C,EAAMtC,EAAIixB,EAAIjxB,EAAI,IAClBsC,EAAMG,EAAIwuB,EAAIxuB,EAAI,IAClBH,EAAKtQ,EAAAi/B,EAAQj/B,EAAA,IANfsQ,EAAAzT,EAAAoiC,EAAApiC,EAAA,yCAWE8lF,EAAKvsF,UAAejC,MAAK,WACzB,IAAA6zC,EAAK,IAAU26C,SACf36C,EAAKnG,UAALmG,KAAkBl0C,KAAK+tC,WACvBmG,EAAKhF,QAALlvC,KAAgBkvC,QAChBgF,EAAK+gD,WAAWj1F,KAAKi1F,WACrB/gD,EAAKhG,SAALluC,KAAAkuC,SACAgG,EAAAu+C,SAAAzyF,KAAAyyF,SARFv+C,EAAAqgD,gBAaAjwC,OAAOqvH,iBAAP9kF,EAAAvsF,UAAA+wK,KAhHmB,CAmHrB+oB,IAIIz8F,GAAA,SAAAi9F,gBAEAA,EAAWr6L,KAAIvC,MAAA,GAEf,IAAAkoL,EAAK,IAAA/mJ,GAAgB8mJ,KAAA,eACrBC,EAAKj6I,UACH,GAAI,+BAMNi6I,EAAIvvF,SAAAv3D,GAAWw3D,eAAax3D,GAC1B8vI,gBACA9vI,GACI+vI,0BAAuB/vI,GAASw3D,eAAlCx3D,GACA8vI,gBAAiB9vI,GAAA+vI,2BAMrB,IAAA0rB,EAAc,IAAI17J,GAASsoJ,WAAb,iBAAdxqL,KAAA,UAAAypB,KAAAyY,GAAAw3J,mBAAA15L,KAAA,QAAAypB,KAAAyY,GAAAosI,gBAAA2a,IAKIloL,KAAAm1D,QAAcj7C,EAAA,EAAAyC,EAAA,EAAAzQ,EAAA,EAAAnD,EAAA,GADhB/I,KAHa2/B,QAAf,IAAAwB,GAAAyoJ,QAAAiT,2BAWD78L,KAAA+tC,UAAA8uJ,qBAIDD,IAAAj9F,EAA6Bw3E,UAAcylB,6CAE3Cj9F,EAAIr9F,UAAuBwc,YAAU6gF,EAErC,IAAA0zE,GAA0B1yI,QAAM0xH,cAAY,GAAAnjH,SAAAmjH,cAAA,GAAA71I,OAAA61I,cAAA,WAE3CghB,EAFD1yI,OAAAhY,IAAA,gCAMC0qJ,EAFDnkI,QAAAvmB,IAAA,iCAMI0qJ,EAAAnkI,QAAApjB,IAAA,SAAAqf,GACAnrC,KAAK4qE,WAAQz/B,IACbnrC,KAAK4qE,SAAQz/B,EACdnrC,KAAA2/B,QAAA0qJ,YAAA,UAAAl/I,EAAAwpC,WALH30E,KAAAq8L,QAAA,QAAAlxJ,EAAAypC,UAUCy+F,EAFD72J,MAAAmM,IAAA,+BAME0qJ,EAAU72J,MAAVsP,IAAA,SAAAqf,GACA,IAAA3uB,EAAUxc,KAAAm1D,OACV34C,EAAMtC,EAAIixB,EAAIjxB,EAAI,IAClBsC,EAAMG,EAAIwuB,EAAIxuB,EAAI,IAClBH,EAAKtQ,EAAAi/B,EAAQj/B,EAAA,IANfsQ,EAAAzT,EAAAoiC,EAAApiC,EAAA,yCAWE42F,EAAer9F,UAAUjC,MAAzB,WACA,IAAA6zC,EAAK,IAAUyrD,SACfzrD,EAAKnG,UAAQmG,KAAKl0C,KAAlB+tC,WACAmG,EAAKhF,QAALlvC,KAAAkvC,QACAgF,EAAA13B,MAAAxc,KAAAwc,MANF03B,EAAAqgD,gBAWAjwC,OAAOqvH,iBAAAh0E,EAAPr9F,UAAA+wK,KAlFE,CAqFJ+oB,IAII/oG,GAAiB,SAAjBupG,gBAEAA,EAAAr6L,KAAiBvC,MAAA,GAEjBA,KAAK88L,MAAM,IAAA37J,GAAY8mJ,KAAI,UAC3BjoL,KAAK88L,MAAM7uJ,UACT,GAAI,wCAMNjuC,KAAI88L,MAAAnkG,SAAev3D,GAAAw3D,eAChBx3D,GAAA8vI,gBAEG9vI,GAAM+vI,0BAA0B/vI,GAAAw3D,eAChCx3D,GAAA8vI,gBAAM9vI,GAAkB+vI,2BAO9B,IAAA0rB,EAAe,IAAI17J,GAASsoJ,WAExB,iBACFxqL,KAAA,UAAAypB,KAAAyY,GAAAw3J,mBAAA15L,KAAA,iBAAAypB,KAAAyY,GAAA+rI,cAAAjuK,KAAA,QAAAypB,KAAAyY,GAAAosI,gBAAAvtK,KAAA88L,QAAA98L,KAIE2/B,QAAQ,IAAAwB,GAAcyoJ,QAAOiT,+BAM5B59L,KAAA,aAAL8E,OAAA,IAAA9E,KAAA,WAAA8E,OAAA,IAAA9E,KAAA,YAAA8E,OAAA,IAAA9E,KAAA,WAAA8E,OAAA,KAED/D,KAAA+tC,UAAA8uJ,qBAIDD,IAAgBvpG,EAAU8jF,UAAcylB,6CAExCvpG,EAAI/wF,UAAqBwc,YAAYu0E,EAErC,IAAAggF,GAA0B1yI,QAAM0xH,cAAY,GAAAp9D,YAAAo9D,cAAA,GAAAnkH,UAAAmkH,cAAA,GAAA5/D,UAAA4/D,cAAA,GAAAnjH,SAAAmjH,cAAA,GAAAp+D,gBAAAo+D,cAAA,WAE3CghB,EAFD1yI,OAAAhY,IAAA,gCAMC0qJ,EAFDp+E,WAAAtsE,IAAA,iDAMC0qJ,EAFDp+E,WAAAnpE,IAAA,SAAAqf,wCAMCkoI,EAFDnlI,SAAAvlB,IAAA,+CAMC0qJ,EAFDnlI,SAAApiB,IAAA,SAAAqf,sCAMCkoI,EAFD5gF,SAAA9pE,IAAA,+CAMC0qJ,EAFD5gF,SAAA3mE,IAAA,SAAAqf,sCAMCkoI,EAFDnkI,QAAAvmB,IAAA,iCAMI0qJ,EAAAnkI,QAAApjB,IAAA,SAAAqf,GACAnrC,KAAK4qE,WAAQz/B,IACbnrC,KAAK4qE,SAAQz/B,EACdnrC,KAAA2/B,QAAA0qJ,YAAA,UAAAl/I,EAAAwpC,WALH30E,KAAAq8L,QAAA,QAAAlxJ,EAAAypC,UAUCy+F,EAFDp/E,eAAAtrE,IAAA,8DAMC0qJ,EAFDp/E,eAAAnoE,IAAA,SAAAqf,iDAMEkoD,EAAA/wF,UAAoBjC,MAAK,WACzB,IAAA6zC,EAAK,IAALm/C,SACAn/C,EAAKnG,UAALmG,KAAgBl0C,KAAK+tC,WACrBmG,EAAK+gD,WAAWj1F,KAAKi1F,WACrB/gD,EAAKhG,SAAUluC,KAAKkuC,SACpBgG,EAAKu+C,SAAAzyF,KAALyyF,SACAv+C,EAAKhF,QAALlvC,KAAAkvC,QACAgF,EAAA+/C,eAAAj0F,KAAAi0F,eATF//C,EAAAqgD,gBAcAjwC,OAAOqvH,iBAAPtgF,EAAA/wF,UAAA+wK,KA5GmB,CA+GrB+oB,IAIIvuJ,GAAY,SAAW+uJ,gBAEvBA,EAAWr6L,KAAIvC,MAAA,GAEf,IAAAkoL,EAAK,IAAA/mJ,GAAgB8mJ,KAAA,QACrBC,EAAKj6I,UACH,GAAI,+BAMNi6I,EAAIvvF,SAAAv3D,GAAWw3D,eAAax3D,GAC1B8vI,gBACA9vI,GACI+vI,0BAAuB/vI,GAASw3D,eAAlCx3D,GACA8vI,gBAAiB9vI,GAAA+vI,2BAUrB,IAAA0rB,EAAe,IAAI17J,GAASsoJ,WAExB,iBACFxqL,KAAA,UAAAypB,KAAAyY,GAAAw3J,mBAAA15L,KAAA,QAAAypB,KAAAyY,GAAAosI,eAAAtuK,KAAA,kBAAAypB,KAAAyY,GAAAw3J,mBAAA15L,KAAA,sBAAAypB,KAAAyY,GAAA+rI,cAAAjuK,KAAA,kBAAAypB,KAAAyY,GAAAusI,cAAAwa,IAAAloL,KAIE2/B,QAAQ,IAAAwB,GAAcyoJ,QAAOiT,+BAO5B59L,KAAA,aAAL8E,OAAA,IAAA9E,KAAA,WAAA8E,OAAA,IAAA9E,KAAA,cAAA8E,OAAA,IAAA9E,KAAA,mBAAA89L,MAAA,IAAA99L,KAAA,oBAAA89L,MAAA,KAEA/8L,KAAK+tC,UAAA8uJ,EACL78L,KAAK4qE,SAAA,KACL5qE,KAAKitC,eAAgB,KACrBjtC,KAAKg9L,mBAAL,EACDh9L,KAAAm1D,QAAAj7C,EAAA,EAAAyC,EAAA,EAAAzQ,EAAA,EAAAnD,EAAA,4BAID6zL,IAAa/uJ,EAAUspI,UAAcylB,6CAErC/uJ,EAAIvrC,UAAAwc,YAAiC+uB,EAErC,IAAAwlI,GAA0B1yI,QAAM0xH,cAAY,GAAAnkH,UAAAmkH,cAAA,GAAAp9D,YAAAo9D,cAAA,GAAAlkH,aAAAkkH,cAAA,GAAAjkH,kBAAAikH,cAAA,GAAAh5B,mBAAAg5B,cAAA,GAAAnjH,SAAAmjH,cAAA,GAAA9jH,eAAA8jH,cAAA,GAAAhkH,eAAAgkH,cAAA,GAAA/jH,mBAAA+jH,cAAA,GAAA71I,OAAA61I,cAAA,WAE3CghB,EAFD1yI,OAAAhY,IAAA,gCAMC0qJ,EAFDnlI,SAAAvlB,IAAA,sDAMC0qJ,EAFDnlI,SAAApiB,IAAA,SAAAqf,sCAMCkoI,EAFDp+E,WAAAtsE,IAAA,wDAMC0qJ,EAFDp+E,WAAAnpE,IAAA,SAAAqf,wCAMCkoI,EAFDllI,YAAAxlB,IAAA,yDAMC0qJ,EAFDllI,YAAAriB,IAAA,SAAAqf,yCAMCkoI,EAFDjlI,iBAAAzlB,IAAA,8DAMC0qJ,EAFDjlI,iBAAAtiB,IAAA,SAAAqf,8CAMCkoI,EAFDh6C,kBAAA1wG,IAAA,+DAMC0qJ,EAFDh6C,kBAAAvtG,IAAA,SAAAqf,+CAMCkoI,EAFDnkI,QAAAvmB,IAAA,iCAMI0qJ,EAAAnkI,QAAApjB,IAAA,SAAAqf,GACAnrC,KAAK4qE,WAAQz/B,IACbnrC,KAAK4qE,SAAQz/B,EACdnrC,KAAA2/B,QAAA0qJ,YAAA,UAAAl/I,EAAAwpC,WALH30E,KAAAq8L,QAAA,QAAAlxJ,EAAAypC,UAUCy+F,EAFD9kI,cAAA5lB,IAAA,uCAME0qJ,EAAa9kI,cAAYziB,IAAA,SAAzBqf,GAFFnrC,KAAAi9L,eAAA9xJ,iDAOCkoI,EAFDhlI,cAAA1lB,IAAA,uCAMI0qJ,EAAKhlI,cAALviB,IAAA,SAAAqf,GACAnrC,KAAKitC,iBAAoB9B,IACzBnrC,KAAKitC,eAAQ9B,EACdnrC,KAAA2/B,QAAA0qJ,YAAA,kBAAAl/I,EAAAwpC,WALH30E,KAAAq8L,QAAA,cAAAlxJ,EAAAypC,UAUCy+F,EAFD/kI,kBAAA3lB,IAAA,2CAMI0qJ,EAAK/kI,kBAALxiB,IAAA,SAAAqf,GACAnrC,KAAKg9L,qBAAoB7xJ,IAC1BnrC,KAAAg9L,mBAAA7xJ,EAJHnrC,KAAA2/B,QAAA0qJ,YAAA,sBAAAl/I,KASCkoI,EAFD72J,MAAAmM,IAAA,qDAME0qJ,EAAU72J,MAAVsP,IAAA,SAAAqf,GACA,IAAA3uB,EAAUxc,KAAAm1D,OACV34C,EAAMtC,EAAIixB,EAAIjxB,EAAI,IAClBsC,EAAMG,EAAIwuB,EAAIxuB,EAAI,IAClBH,EAAKtQ,EAAAi/B,EAAQj/B,EAAA,IANfsQ,EAAAzT,EAAAoiC,EAAApiC,EAAA,yCAWE8kC,EAAKvrC,UAAejC,MAApB,WACA,IAAA6zC,EAAK,IAAArG,SACLqG,EAAKhF,QAAAlvC,KAAAkvC,QACLgF,EAAK7F,cAAaruC,KAAKquC,cACvB6F,EAAK5F,kBAALtuC,KAAAsuC,kBACA4F,EAAK+gD,WAAWj1F,KAAKi1F,WACrB/gD,EAAK13B,MAAAxc,KAALwc,MACA03B,EAAKhG,SAAAluC,KAALkuC,SACAgG,EAAK/F,YAAAnuC,KAALmuC,YACA+F,EAAK9F,iBAALpuC,KAAAouC,iBACA8F,EAAAmlF,kBAAAr5H,KAAAq5H,kBAZFnlF,EAAAqgD,gBAiBAjwC,OAAOqvH,iBAAP9lI,EAAAvrC,UAAA+wK,KA5Kc,CA+KhB+oB,mBAKE,IAAIn4C,EAEH,IACCA,EAAA06B,EAAcxxD,WAAd,MACA,MAAAlyF,eACD0L,QAAAhM,MAAAM,GAKDj7B,KAAK42J,QAAL+nB,EACA3+K,KAAK4vD,KAALq0F,EACEjkJ,KAAAo8K,SADYp8K,KAAdg3J,qBAdFh3J,KAAAi/K,IAAAj/K,KAAAk/K,IAAAl/K,KAAAm/K,IAAAn/K,KAAAo/K,IAAA,yCA0BA8d,GAAA56L,UAAA66L,gBAAA,SAAA/b,KAkBI8b,GAAK56L,UAALu5J,YAAA,SAAAv8J,EAAAoE,EAAA4vC,EAAAC,GACAvzC,KAAKi/K,MAAL3/K,GAAAU,KAAAk/K,MAAAx7K,GAAA1D,KAAAm/K,MAAA7rI,GAAAtzC,KAAAo/K,MAAA7rI,IACAvzC,KAAKi/K,IAAM3/K,EACXU,KAAKk/K,IAAMx7K,EACZ1D,KAAAm/K,IAAA7rI,EAXHtzC,KAAAo/K,IAAA7rI,IA4BI2pJ,GAAK56L,UAALs/K,WAAA,SAAAtiL,EAAAoE,EAAA4vC,EAAAC,GACAvzC,KAAK6hL,MAALviL,GAAAU,KAAA8hL,MAAAp+K,GAAA1D,KAAA+hL,MAAAzuI,GAAAtzC,KAAAgiL,MAAAzuI,IACAvzC,KAAK6hL,IAAMviL,EACXU,KAAK8hL,IAAMp+K,EACZ1D,KAAA+hL,IAAAzuI,EAXHtzC,KAAAgiL,IAAAzuI,IAgBE2pJ,GAAI56L,UAAUshD,MAAU,SAAepnC,GACvC,IAAIynI,EAAAjkJ,KAAU4vD,KACZq0F,EAAA8S,UAAI/2J,KAAYi/K,IAAAj/K,KAASk/K,IAAAl/K,KAAWm/K,IAAMn/K,KAAAo/K,MAC1C5iK,GAAkB,IAAdA,EAAc,IAAlB,IAAAA,EAAA,IAAA,IAAAA,EAAA,KACAynI,EAAI6S,UAAS,OAAUt6I,EAAvB,GAAiC,IAAjCA,EAAgD,GAAhD,IAAAA,EAAA,GAAA,IACDynI,EAAA8T,YAAAv7I,EAAA,GAPHynI,EAAA+V,SAAAh6J,KAAAi/K,IAAAj/K,KAAAk/K,IAAAl/K,KAAAm/K,IAAAn/K,KAAAo/K,4BAeEp/K,KAAK2rE,QAALlkC,gBAGAznC,KAAK2Y,QAAS,EAEd3Y,KAAIsrE,OAAS,KAETuJ,SACDxuE,IAAAwuE,EAAAlxE,QACD3D,KAAImzF,OAAQte,EAAWlxE,YAEtB0C,IAAAwuE,EAAAjxE,gCAdL5D,KAAAg4K,YAAAnjG,KAsBCuoH,GAFD96L,UAAAzB,OAAA,SAAAg0E,wBAMIuoH,GAAI96L,UAAQ01K,YAAZ,SAAAnjG,GACA,GAAAA,EAAI7K,QAAS6K,EAAe7K,OAA5B,GAAoC,CAClC,IAAAr5B,EAAKkkC,EAAS7K,OAAd,GACDr5B,GAAAA,IAAA3wC,KAAAsrE,SACFtrE,KAAAsrE,OAAA36B,KAKFysJ,GAFD96L,UAAAm4B,QAAA,6BAMI,IAAAF,IAFJqhI,OAAAshC,iBASIG,GAASl8J,GAASgjB,MAClBm5I,GAAAn8J,GAAkB+lB,OAClBq2I,GAAAp8J,GAAem7C,KACfkhH,GAAUp8J,GAAA+N,UACVsuJ,GAAAr8J,GAAAw6H,mBAEJ8hC,GAAkBv8J,GAAlBkI,eAEAlI,GAAI0nJ,SAAA,eAEF,IAAA3nJ,IAEA06H,OAAA6hC,sBAEAtuJ,UAAAquJ,GAGAjjK,OAAAA,GAGA4pB,MAAMk5I,GACNn2I,OAAOo2I,GACPhhH,KAAAihH,GACAp5J,MAAAw5J,GACAjmG,WAAAA,mBAEAruD,eAAAq0J,GAGAn1K,MAAAA,mBAEA6zK,SAAAA,GAGAvtG,eAAAA,GACA8Q,mBAAcA,sBAEd9xD,aAAAA,GAGAytH,QAAAA,kBAIAtiE,KAAAA,GAGAp/C,KAAKA,EAvCPzY,SAAAA,6BCp+cMy8J,KAAA,SAAAl+L,EAANP,EAAAE,GACA,IAAMw+L,EAAA,EACAC,EAAY,EACZC,EAAA,EACAC,EAAUF,EAAhBC,EACME,EAAN,EACMC,EAAS,EACTjiH,EAAA,GACAkiH,EAAA,GACAC,EAAA,GACAC,EAAA,IACAC,EAAN,UAEIC,EAAA,YAGJ3nI,EAAA,EAGI,SAAK/c,IACR75C,KAAAw+L,MAAApvL,oCAMDqvL,EAAOC,WAAA,aAEHD,EAAAE,gBAAqB,SAAAl6J,GACrBA,EAAKmW,qBAHTnW,EAAAyW,cAAA4iJ,qDASIl+G,EAAQ22E,gBAER,IAAEnvJ,EAAMq9B,EAAA0V,QACNxjC,EAAM8tB,EAAR4V,oBAEAjzC,EAAAmpC,IAAK55B,EAAQjT,EAEb+gC,EAAKmX,QAAMnX,EAAMsW,aAAjBtW,EAAAoW,QAAAE,aAAA3zC,qBAEApH,KAAAg/K,MAAQwf,MAAA/5J,sBAKRg6J,EAAAtpI,OAAU,SAAA1wB,GACN,IAAAhf,EAAKgf,EAAAyT,iBADTzyB,EAIIA,EAAKktE,eAETluD,EAAKyW,cAAL+gC,8CAMA2D,EAAKg/G,uCAGL5+L,KAAAg/K,MAAQwf,MAAA/5J,2BAKRg6J,EAAA5uG,kBAAgB,SAAiBprD,GACjC,IAAAhf,EAAKgf,EAALyT,iBACAzyB,EAAK2nB,WAAL+kD,iBAAA1sE,GAJJgf,EAAAyW,cAAA+iJ,uBASIQ,EAAAI,QAAQ,SAAYp6J,GACpB,IAAAhf,EAAWgf,EAAXyT,iBAHJ0nC,EAAA42E,YAAA/wI,EAAAA,EAAA2nB,WAAA3I,EAAAmyB,mCAQI6nI,EAAAK,gBAAkB,SAAWr6J,GAC7B,IAAAhf,EAAWgf,EAAXyT,iBAHJ0nC,EAAAm/G,UAAAt5K,EAAAA,EAAA2nB,WAAA3I,EAAAmyB,2DASI,IAAIgnB,EAAAhnB,oBAGJgpB,EAAI02E,eAAqB7xH,EAAAywB,SAAQ,IAM7B,8BAHA8pI,EAAgBp/G,EAApBg/G,mBAAA3iH,EAAA,EAEIv3C,EAAQD,EAAAwyB,UACR13D,EAAA,EAAAgiB,EAAAmjB,EAAAllC,OAAAD,EAAAgiB,EAAAhiB,IAAA,CACA,IAAE4M,EAAAu4B,EAAenlC,GAEjB4M,EAAA+uC,aAAiB+jJ,EAAiBD,yCAElCpoI,EAAAzqD,EAAAyqD,aAAA,IAAAzqD,EAAAupD,WAAAkoB,EAAA,GAAAzxE,EAAAupD,WAGAvpD,EAAEgpD,OAAOpsD,EAAIoD,EAAA+oD,SAAb0qB,EAAA02E,cACH4oC,EAAA/yL,EAAA+uC,aAAAsjJ,MAAAryL,mBAIDyzE,EAAK02E,cAALA,EAEAt2J,KAAAg/K,MAAAwf,MAAe/5J,QAKfg6J,EAAAU,sBAAuB,SAAK16J,GAC5B,IAAAhf,EAAKgf,EAALyT,iBACAzyB,EAAK0yE,gBAAL1yE,EAAA0yE,eAAAhG,iBAAA1sE,GAJJgf,EAAAyW,cAAAojJ,uBASIG,EAAAW,YAAQ,SAAkB36J,GAC1B,IAAAhf,EAAWgf,EAAXyT,iBAHJ0nC,EAAA42E,YAAA/wI,EAAAA,EAAA0yE,eAAA1zD,EAAAmyB,mCAQA,IAAAyoI,EAAA,IAAmBxlJ,uBAEnBwlJ,EAAIrgB,MAAJqgB,EAEA,IAAAH,KAEI,SAAKI,EAAQlgI,EAAQ6hB,eAIb,OAFRgzC,EAAA+qD,MAAA/9F,GAAAo+G,EAEQjgI,GACA,KAAAy+H,EACJ5pE,EAAKuqE,MAAAvqE,EAALyqE,WACI,MACA,KAAAZ,EACJ7pE,EAAKuqE,MAAAvqE,EAAL0qE,gBACI,MACA,KAAAZ,EACJ9pE,EAAKuqE,MAALvqE,EAAAsrE,gBACI,MACA,KAAAtjH,EACJg4C,EAAKuqE,MAALvqE,EAAA9+D,OACI,MACA,KAAA+oI,EACJjqE,EAAKuqE,MAAAvqE,EAAA/+D,SACD,MACA,KAAA+oI,EACJhqE,EAAKuqE,MAALvqE,EAAApkC,kBACI,MACA,KAAAsuG,EACJlqE,EAAKuqE,MAAAvqE,EAAL4qE,QACI,MACA,KAAAT,EACJnqE,EAAKuqE,MAALvqE,EAAA6qE,gBACI,MACA,KAAAT,EACJpqE,EAAKuqE,MAAAvqE,EAAAh9D,UACD,MACA,KAAAqnI,EACJrqE,EAAKuqE,MAALvqE,EAAAkrE,sBACI,MACA,KAAAK,EAjCRvrE,EAAAuqE,MAAAvqE,EAAAmrE,qBAuEA,SAAIhwL,EAAIq1B,GACR,IAAE26B,EAAM36B,EAARyW,aACHgkJ,EAAA9/H,GAhCG,SAAYA,GAIR,IAHJ,IAAA60D,EAAO,KACHwrE,EAAIlB,EAEJkB,EAAQ,GACXA,EAAArgI,IAAA60D,EAAAqrE,EAAAG,EAAAxrE,IACDwrE,IAAA,WA0BHC,CAAAtgI,aAIDvlB,EAAWqlJ,MAAXA,iBAEArlJ,EAAW9qC,mBAzBP6nD,EAAU,GAAA5S,EAAc0R,WAEpB1R,EAAM9I,YAAA6iJ,GACNn+G,EAAM22E,uCAENvyG,EAAM9I,cAAM6iJ,EAEZmB,EAAAl7I,EAAQ9I,aAARsjJ,MAAAx6I,GAGA47B,EAAM22E,iBAEb2oC,EAAAl7I,EAAA9I,aAAAsjJ,MAAAx6I,uBAgBG47B,EAAA+/G,EAEAT,EAAK,GAAIG,EAER,IAAA,IAAA9/L,EAAA,EAAAA,EAAAg/L,EAAAh/L,IAPL2/L,EAAA3/L,GAAA,IAAAs6C,GAYAA,EAAW+lJ,eAAA/B,EACXhkJ,EAAWgmJ,qBAAiB/B,EAC5BjkJ,EAAWsB,qBAAX4iJ,EACAlkJ,EAAWkC,eAAeiiJ,EAC1BnkJ,EAAWqc,WAAA+lB,EACXpiC,EAAWoc,aAAcioI,EACzBrkJ,EAAWi8C,wBAAwBmoG,EACnCpkJ,EAAWk8C,YAAXooG,EACAtkJ,EAAWy+C,sBAAA8lG,EACXvkJ,EAAW6e,cAAX2lI,EACAxkJ,EAAWimJ,6BAAXxB,uBAEAzkJ,EAAOkmJ,WAAaxB,sDCjPpB,IAAAvuD,EAAS,EAEL,SAAAgwD,EAAQr8L,EAAAC,GACR,IAAAsrC,EAAA,IAAAtvC,GAAA8pE,kCAEAx6B,EAAKruC,SAELb,KAAK4qE,SAAL17B,EAEAlvC,KAAKoQ,GAAA4/H,YAELhwI,KAAKigM,OAASjwD,gBAGdhwI,KAAK2Y,QAAA/U,EAER5D,KAAAkgM,iDAIOtgM,GAAAye,GAAA21F,MAAIgsF,EAAA19L,WAAJ69L,kBACc,SAAAh3K,GADd,IAEIvmB,EAAOumB,EAAK+kD,mBAEZ3hD,EAAKvsB,KAATkgM,mBAAAhxJ,EAAAtvB,WAEIpI,EAAJ5U,EAAUc,EAEN,GAAA6oB,EAFJ3pB,EAIKtD,GAAAitB,EAAAjtB,EACDsD,EAAIc,GAAA6oB,EAAQ7oB,MAAZ,eAEKE,EAAAsrC,EAAAtrC,OAWJ,GATG5D,KAAKoQ,GAAKzM,EAAKqsI,EAAfhwI,KAAAmzF,SACHnzF,KAAAoQ,GAAA4/H,uBAIAhwI,KAAAqQ,GAAAzM,EAAA5D,KAAAigM,kCAIAjgM,KAAAigM,OAAAjgM,KAAA2Y,iBAKD3Y,KAAK4qE,SAASS,cAAcn8B,EAASlvC,KAAKoQ,GAAI,EAAApQ,KAAAqQ,IAC9CrQ,KAAK4qE,SAASS,cAAcn8B,EAASlvC,KAAKoQ,GAAI,EAAApQ,KAAAqQ,IAC9CrQ,KAAK4qE,SAASS,cAAcn8B,EAASlvC,KAAKoQ,GAAIpQ,KAAKqQ,GAAnD,oDAEArQ,KAAK4qE,SAAAS,cAAmBn8B,EAAxBlvC,KAAuCoQ,GAAApQ,KAAAqQ,IAEnCrQ,KAAAkgM,mBAFmChxJ,EAAAtvB,MAGnCtgB,EAAAU,KAAAoQ,GAHJ1M,EAAA1D,KAAAqQ,2BASAzN,EAAKc,GAAL1D,KAAWqQ,GAEXrQ,KAAKoQ,IAALzM,EAAAqsI,iBAiBR,OAZQ7mH,EAFoBslD,WAGpBnvE,EAAAiY,EAHJ7T,EAAA8T,+CASA2R,EAAK4lD,eAEL/uE,KAAAogM,mBAAA16L,KAAAyjB,IA5DqB,GAiErBtoB,OAAA,WACKb,KAAAqgM,SAlEgBrgM,KAAA4qE,SAAA/pE,SAqEzBb,KArEyBqgM,QAAA,IAuErBxoJ,MAAA,WACA73C,KAAKoQ,GAAA4/H,YAELhwI,KAAIigM,OAASjwD,EAGT,IADA,IAAA/mH,EAAIjpB,KAAQogM,mBACP7gM,EAAA,EAAMgiB,EAAA0H,EAASzpB,OAAAD,EAAAgiB,EAAAhiB,IAAA,CAChB,IAAA4kB,EAAA8E,EAAA1pB,GACH,GAAA4kB,EAAA4H,QAAA,CAGD,IAAAu0K,EAAAn8K,EAAgBsqD,UAChBtqD,EAAM+pD,MAAA5uE,EAANghM,EAAiBhhM,EACjB6kB,EAAM+pD,MAAAxqE,EAAA48L,EAAN58L,EACAygB,EAAMymD,SAAN01H,EAAApxJ,QACH/qB,EAAA4qD,eACD5qD,EAAKsqD,UAAA,MAvFgBzuE,KAAAogM,mBAAA5gM,OAAA,EA2FzBQ,KA3FyBkgM,uBA6FrBzlK,QAAK,WACRz6B,KAAA63C,QA9FL73C,KAAA4qE,SAAAnwC,mDClBA,IAAIulK,EAAAtgM,EAAJ,gBAGI6gM,GAAA,EAEJC,EAAA,EACIC,EAAA,KAIAC,EAAa,IAIb,SAAKC,IACD,IAAAh2E,EAAQi2E,IAAUL,UAClB51E,IACHA,EAAA,IAAAq1E,EAAAS,EAAAA,GACDG,EAAAl7L,KAAAilH,MAKH,SAAAk2E,cAID,IAAA3/G,GAAA,EAOIz3B,GAQC/6C,cACG,OAAJwyE,kBAGQA,IAAOn9E,IAEPA,GAFJ/D,KAIK63C,QACDj4C,GAAG+e,SAASuP,GAAZtuB,GAAgB8gD,SAAA0E,0BAAhBy7I,mEAcPC,oBACG,OAAAN,GAEHM,kBApCqB/8L,QA8CrBg9L,kBACG,OAAAN,GAEHM,gBAjDqBh9L,QA2DrBi9L,mBACG,OAAAN,GAEHM,iBA9DqBj9L,QAwElBo8L,kBAAI,SAAah3K,GAGjB,GAAI+3D,GAAUq/G,IAAYC,GAA1Br3K,IAAAA,EAAAslD,UAAA,kBAGA,KAAIv/B,aAAJtvC,GAAA8pE,eAAA9pE,GAAAuvC,UAAAulC,cAAAxlC,IAAA,CACA,IAAIoE,EAAApE,EAAMvrC,MAAoB4vC,EAAArE,EAAMtrC,OAChC0B,EAAA4pC,EAAYu7B,WACZh0C,EAAIyY,EAAAy7B,WACJiJ,EAAAh0E,GAAAuvC,UAAAwkC,OAAAC,OACH,KAAAtgC,EAAAotJ,GAAAntJ,EAAAmtJ,GAAAptJ,MAAAC,OAAAjuC,EAAAmxB,KAAAm9C,GAAA,CAIG,IAAA+2C,EAAQi2E,EAAAL,GACX51E,WAIGA,EAAMw1E,kBAAkBh3K,IAAxBo3K,IAAAC,IACH71E,EAAAg2E,KA7FiBR,kBAAAh3K,OAuGd0uB,MAAA,WACH,IAAA,IAAAt4C,EAAA,EAAAgiB,EAAAq/K,EAAAphM,OAAAD,EAAAgiB,EAAAhiB,IACDqhM,EAASrhM,GAATk7B,UAzGkBmmK,EAAAphM,OAAA,QAqHdyhM,WAAA78G,oBAqDJ,GAAKpkF,KAAI0O,QAER,IAAA,IAAAnP,EAAA,EAAAA,GAAAghM,EAAAhhM,IACJqhM,EAAArhM,GAAAsB,qFCpLL,IAAMgH,EAAQnI,EAAQ,6BAGhBwvF,mCAAYA,SAEd2J,EAAAn5F,EAAA,6BAEAwhM,EAAA,WACAlhM,KAAKmhM,GAAA,EACLnhM,KAAKohM,GAAA,EACLphM,KAAKmzF,OAAL,EACAnzF,KAAK2Y,QAAL,EACA3Y,KAAKqhM,SAAL,EACArhM,KAAKshM,SAAA,EACLthM,KAAKuhM,WAAL,EATJvhM,KAAAwhM,kBAAA,oBAcC5hM,GAFD6hM,UAAA,SAAAC,+BAMI9hM,GAAA6hM,UAAAn/L,WACIwc,YAAKlf,GAAA6hM,UACRE,qBAJoB,SAAAC,EAAAC,GAKrB7hM,KAAA8hM,mBAAuBF,GAAWC,GAE9BE,sBAAgB,WACZ,IAAAC,KACA,IAAA,IAAAt8I,KAAY1lD,KAAZ8hM,mBAAwB,CACxB,IAAA/9L,EAAA,IAAAm9L,EACHthM,GAAAye,GAAA21F,MAAAjwG,EAAA/D,KAAA8hM,mBAAAp8I,IACDs8I,EAAOt8I,GAAP3hD,EAEJ,OAAAi+L,GAEQC,wBAAe,SAAAJ,GACf,IAAA,IAAIn8I,KAAA1lD,KAAW8hM,mBAAK,CACpB,IAAGzsC,EAASwsC,EAAZn8I,GACHoiC,EAAA9nF,KAAA8hM,mBAAAp8I,GAnBgB9lD,GAAAye,GAAA21F,MAAAlsB,EAAAutE,KAuBb6sC,0BAAI,SAAyBzkG,GAC7B,IAAA,IAAA0kG,KAAkBniM,KAAU8hM,mBAA5B,CACA,IAAAM,EAAkBpiM,KAAW8hM,mBAA7BK,GACAC,EAAkBjvG,QAAlBsK,EACA2kG,EAAkBzpL,SAAlB8kF,EACA2kG,EAAkBf,UAAlB5jG,EACH2kG,EAAAd,UAAA7jG,EA7BgB2kG,EAAAC,WAAA5kG,IAiCjB6kG,2BAAI,SAAJC,GAjCR,OAkCoBviM,KAAA8hM,mBAAAviE,eAAAgjE,EAAAh8H,WAAA,IAGWvmE,KAAnB8hM,mBAAAS,EAAAh8H,WAAA,IAEJ,OAMJ,IAAAi8H,EAAA,WACAxiM,KAAKyiM,MAAA,GACLziM,KAAK0iM,QAAA,EACL1iM,KAAK2iM,WAAa,EALtB3iM,KAAA4iM,WAAA,qBAUIC,EAAQjjM,GAAZgD,OAEIkgM,EAAA,KAEAC,KACAC,KACAvpG,UAEAwpG,EAAJrjM,GAAAqvC,OAEI8hD,EAAA,KACAhpB,EAAA,KACAm7H,EAAkB,EAClBC,EAAJ,EACIC,EAAA,EACAC,EAAgB,EAChBC,EAAA,EACAC,EAAe,EAEfxvG,EAAJ,KAEIpE,EAAA,GACAQ,EAAA,EACAqzG,EAAJ,EACIpuI,EAAJx1D,GAAAqvC,OACIw0J,EAAA,EACAC,EAAA,EACAryG,EAAY,EACZhB,EAAc,EACdszG,EAAA,EACAC,GAAA,EACAzoG,EAAA,MAEJ0oG,EAAiB,EAET1kM,EAAAE,SACA8yF,iBAAc,SAAM1sE,4BAEpBq9K,IAAAr9K,IAEAq9K,EAAKr9K,2BAGLzlB,KAAA8jM,qCAGAhB,EAAMr+J,KAAAo4B,eAAYzH,GAElB0tI,EAAAjyG,YAAAgC,UAAAiwG,EAAAjyG,YAAAiC,SAAA,EAEAgwG,EAAK,KAGT9iM,KAAA+jM,qBAECC,iBAtBY,WAwBbT,EAxBapzG,EAwBQqzG,GAEjBS,kBAAe,WACf,IAAAhrG,EAAa6pG,EAAAnyG,wBAEb5oB,EAAakxB,EAAMlxB,aAEfgpB,EAAA+xG,EAAa/xG,aAEbA,EAAI,IAAWnxF,GAAA6hM,UAAW15H,GAE1B,IAAAm8H,EAASn8H,EAAWo8H,kCAGhB,IAAItC,EAAgB,IAATX,EAEXt+L,EAAAshM,EAAiBE,GAAWxhM,KAE5Bi/L,EAAiBR,SAAS6C,EAA1BE,GAAAC,QACAxC,EAAiBP,SAAU4C,EAAKE,GAAhCE,QACAzC,EAAiB1uG,OAAKvwF,EAAtBe,MACAk+L,EAAiBlpL,QAAU/V,EAA3BgB,OACAi+L,EAAAV,GAAAv+L,EAAAtD,EACAuiM,EAAiBT,GAAAx+L,EAAjBc,EAEAm+L,EAAiBN,WAAY,wBAE7BM,EAAWQ,UAAA6B,EAAqBE,GAASG,oDAQjD50G,EAAAmzG,EAAAlzG,OAAkB/oB,WAClBspB,EAAA2yG,EAAAh7H,SACA07H,EAAaz7H,EAAeD,SAC5B1S,EAAUzxD,MAAMm/L,EAAAr+J,KAAhB2wB,aAAAzxD,MACAyxD,EAAUxxD,OAAMk/L,EAAAr+J,KAAhB2wB,aAAAxxD,OACA6/L,EAAAX,EAAY9yG,gBACZ0zG,EAAAZ,EAAY7yG,cACZoB,EAAAyxG,EAAcxxG,sBAEdjB,EAAAyyG,EAAAzyG,YAKIuzG,EAJJD,IAGSz0G,EAAcxxC,OAGlBimJ,IAAAz0G,EAAAG,iCAOTrvF,KAAAwkM,+BAEIT,iBAAa,WACbhzG,EAAA,KArFShpB,EAAA,KAwFbgsB,EAxFa,MA0FT+vG,eAAK,WACL9jM,KAAKgkM,mBA3FIhkM,KAAAykM,mCA8FbzkM,KAAA0kM,cAEID,iCAAA,WAQI,YANAE,EAAA/0G,EAAcpwF,uBAGdolM,EAAJ7B,EAEIvvL,GAAI,EACAjU,EAAA,EAAAA,EAAAolM,IAAgBplM,EAAa,CACjC,IAAImmD,EAAIkqC,EAAArpB,WAAehnE,GACnBslM,EAAAC,EAAwBtxL,GAAA,GAAxB,MAAAkyC,IAAA,EAEAk/I,EAAmBrlM,GAHvBA,EAEOolM,EAAA,EACqBE,EAE5B,EA9GKrxL,EAAAkyC,mCAqHT,IAAI84C,EAAA7O,EAAJnwF,OAEIulM,EAAA,EACAlmG,EAAA,EACAmmG,EAAA,MAEAC,EAAJ,EAEIC,EAAA,EACAC,EAAA,SAEJC,EAAAxlM,GAAAqE,GAAA,EAAA,GAEAjE,KAAIgkM,mBAIA,IAFJ,IAAA5B,EAAoBrxG,EAApB+wG,mBAEQzgL,EAAA,EAAAA,EAAoBm9E,GAAA,CACpB,IAAAC,EAAY9O,EAAK+O,OAAAr9E,GACjB,GAAc,OAAdo9E,EAAA,CAkBA,IAPJ,IAAI4mG,EAAAC,EAAJ31G,EAAAtuE,EAAAm9E,GACI+mG,EAAaL,EACbM,EAAcL,EACdM,EAAUR,MAEdS,GAAS,EAELpgI,EAAA,EAAYA,EAAQ+/H,IAAO//H,EAAA,CAC3B,IAAIqgI,EAActkL,EAAMikD,EAEpB,GAAA,QADAm5B,EAAK9O,EAAA+O,OAAAinG,IAML,GADAC,EAAK70G,EAAAuxG,2BAAoC7jG,GACzC,CAMJ,IAAIonG,EAAAC,EACGF,EADHvE,SAEGkC,EAIH,GAAAK,GAAAC,EAAA,GAAAhlG,EAAA,GAAAgnG,EAAAD,EAAAzyG,OAAAowG,EAAAM,IAAAhrG,EAAA+F,eAAAH,GAAA,CACAhF,EAAA/zF,KAAAu/L,GACAA,EAAA,EACAF,IACAlmG,EAAU,EACVmmG,GAAA30G,EAAAkzG,EAhMpB,EAqLgBmC,GAYO,EACH,+BAMJ1lM,KAAI+lM,kBAAkB3D,EAAoBgD,EAAU3mG,EAAcknG,EAAaZ,GAE9EY,EAAA,EAAA5C,EAAAvjM,QAAAmmM,EAAAnnG,EAAA,eAIDsnG,GAAaF,EAAAvD,UAAmBkB,EAAmBlyG,EAEnDo0G,EAAIL,EAAgB9lM,EAAAsmM,EAAkBzyG,OAAAowG,EAErCgC,EAAAH,EAAA1hM,WAIA8hM,EAAAJ,EAAA1hM,EAAAkiM,EAAAjtL,QAAA4qL,IAEHiC,EAAAJ,EAAA1hM,EAAAkiM,EAAAjtL,QAAA4qL,QAxCMvjM,KAAAgmM,uBAAAL,EAAAlnG,GACH93D,QAAAgW,IAAA,iDAAAorB,EAAAk+H,UAAA,eAAAxnG,QANAz+F,KAAAgmM,uBAAAL,EAAAlnG,GAiDLinG,QAGAT,EAAIQ,EAEHP,EAAAK,IACGL,EAAUK,GAEbJ,EAAAK,IACGL,EAAAK,GAEHU,EAAAjB,oBAjFGxrG,EAAA/zF,KAAAu/L,GACAA,EAAA,EACAF,IACAlmG,EAAK,EACLmmG,GAAA30G,EAAAkzG,EA1JhB,EA2JgBvjM,KAAAgmM,uBAAA3kL,EAAAo9E,GACHp9E,WAkFLo4E,EAAA/zF,KAAiBu/L,GAGb9B,GADJD,EAAI6B,EAAoB,GACG10G,EAAsBkzG,EAChDL,EAAA,OAlPT,SAsPQ9tI,EAAIzxD,MAAJw3F,EACI/lC,EAAAxxD,OAAAw3F,EACHD,GAAA,IACG/lC,EAAAzxD,MAAmBkiB,WAAAqgL,EAAAC,QAAA,KAEtB/qG,GAAA,uCAIDioG,EAAAjuI,EAAkBxxD,OACd0/L,EAAA,EACH4B,EAAA,IACG7B,EAAWjuI,EAAfxxD,OAAmCshM,GAElCC,GAAAhC,eAOJiD,iBA9PY,qBAkQTvqG,iBAAc,SAAA/pB,EAAaysB,EACpBC,GAEH,IAAAC,EAAA3sB,EAAA4sB,OAAAH,GACH,GAAA1F,EAAA8F,aAAAF,IAAA,OAAAA,GAAA5F,EAAA+F,eAAAH,YAID,IAAI1wE,EAAC,EACD63K,EAAA70G,EAAAuxG,2BAAA7jG,GACH,IAAAmnG,EACG,OAAA73K,MAEJ,IAAA+3K,EAAiBF,EAAAvD,UAAgBkB,EAAmBlyG,cAGhDoN,EAAY3sB,EAAA4sB,OAAWr9E,GAEnBukL,EAAA70G,EAAAuxG,2BAAA7jG,SAQH,GAJEqnG,EAAoBF,EAASvE,SAA7BkC,EAIFqC,EAAAzyG,OAAAowG,EAAAM,IAAAhrG,EAAA+F,eAAAH,IAAAolG,EAAA,EACD,OAAA91K,EAKC,GADG+3K,GAAAF,EAAAvD,UAAAkB,EAAAlyG,EACH,OAAAoN,GAAA5F,EAAA+F,eAAAH,IAAA5F,EAAA8F,aAAAF,GACD,oBAQP4nG,yBA3SY,kEA+SZC,yBA/SY,kEAmTLN,uBAAc,SAAIL,EAAlBpD,GACA,GAAAoD,GAAa3C,EAAbxjM,OAAA,CACH,IAAA+mM,EAAA,IAAA/D,YArTQQ,EAAA2C,GAAAlD,MAAAF,kBA6TLwD,kBAAI,SAAc3D,EAAlBgD,EAAA3mG,EAAAknG,EAAAZ,GACA,GAAAY,GAAa3C,EAAbxjM,OAAA,CACH,IAAA+mM,EAAA,IAAA/D,EACDQ,EAAYt9L,KAAU6gM,GAEtB9nG,EAAAA,EAAal4B,WAAa,GAE1By8H,EAAa2C,GAAaa,WAASzB,EACnC/B,EAAa2C,GAAalD,MAAAhkG,EAC1BukG,EAAa2C,GAAajD,OAAAN,EAAa3jG,GAAvC+iG,iBAtUSwB,EAAA2C,GAAAhD,WAAAyC,EAAA9lM,uBA2UTolM,WAAA,eAEAjrG,EAAKj6F,OAAA,EAGDQ,KAAKqmM,2BAKTrmM,KAAAymM,0BAGQ9C,IAAKz0G,EAAAE,QACRe,EAAA,GAAAnwF,KAAA0mM,oBACJ1mM,KAAA2mM,0BAAA3mM,KAAA0mM,kBAIO1mM,KAAA4mM,gBACHjD,IAAAz0G,EAAAE,QACJpvF,KAAA2mM,0BAAA3mM,KAAA6mM,qBAKDC,mBAAe,SAAAh/H,GACX,IAAAi/H,GAAA,EACAj/H,IACHA,EAAA,GACDi/H,GAAA,GAEA52G,EAAIroB,EAEHi/H,GA7WQ/mM,KAAA8jM,kBAkXT6C,0BAAI,SAAqBK,OACzB,IAAIl/H,EAAAqoB,MAEA82G,EAAJl2G,EAEIxxF,EAAA,8BAEJ6/D,GAAO,QAKH,IAAI8nI,EAAAp/H,IAFJvoE,EAIC,GADG6/D,GAAA,EACH8nI,GAAA,QAID,IAAAx8J,EAAUw8J,EAAAp/H,EACVm/H,EAAAhF,wBAAckF,GACdF,EAAK/E,0BAAyBx3J,GAC1B2lD,EAAK+2G,EAAL18J,EAEA1qC,KAAKqmM,8DAQbY,EAAAhF,wBAAWkF,GAEH/nI,GACH0I,EAAAvoE,GAAA,GACJS,KAAA8mM,mBAAAh/H,EAAAvoE,IAKGmnM,iBAAO,WACV,OAFDvD,EAEO/tI,EAAAxxD,QAOPijM,mBAAI,WAGA,IAFJ,IAAAzE,EAAsBrxG,EAAQ+wG,mBAC1BuF,GAAI,EACAC,EAAA,EAAA/lL,EAAWouE,EAAQnwF,OAAA8nM,EAAA/lL,IAAA+lL,EAAA,CACnB,IAAAC,EAAIvE,EAAYsE,gBAEhB,IAAI1B,EAAKxD,EAAwBmF,EAAU9E,OAEvCtvJ,EAAAo0J,EAAJ5E,WAAqBiD,EAAAzyG,OAAA,EAAAowG,EACjBwB,EAAKwC,EAAaf,WACd,GAAArrG,EAAQ,EACJ,GAAAyoG,GAOA,GADAnqG,EAAAsrG,GACA3vI,EAAAzxD,QAAAwvC,EAAAiiB,EAAAzxD,OAAAwvC,EAAA,GAAA,CACHk0J,GAAA,EACJ,YARO,GAAAl0J,EAAAiiB,EAAAzxD,MAAA,CACH0jM,GAAA,EACA,QAcrB,OAAAA,GAEIG,qBAAI,SAAwBr0J,EAAA4xJ,cAEzB0C,EAAat0J,EAAAiiB,EAAAzxD,OAAAwvC,EAAA,EAEf,OAFDywJ,EAlcS8D,EAAAtyI,EAAAzxD,OAAA8jM,EAqcGA,2BAOZ,IAAIrF,EAAUrxG,EAAd+wG,mBAEI5yJ,EAAO6kD,EAAXnpB,SAEAnmC,EAAWq+J,EAAAr+J,qBAEXmuD,EAAIglE,WAAchlE,EAAlB8kC,YAAA9kC,EAAA+oG,YAAA,EAOI,IAPJ,IAEI97H,EAAYzK,6BAEZ8iG,EAAMzzH,EAAV6wB,aAAA5xD,EAAAm8D,EAAAj8D,OAEIyR,GAAI,EACCiyL,EAAA,EAAA/lL,EAAWouE,EAAQnwF,OAAA8nM,EAAA/lL,IAAA+lL,EAAA,CACxB,IAAIC,EAAYvE,EAAAsE,gBAEhB,IAAA1B,EAAAxD,EAA4BmF,EAA5B9E,OAEAI,EAASj/L,OAAIgiM,EAAbjtL,QACAkqL,EAASl/L,MAAIiiM,EAAbzyG,gBAEA0vG,EAASn/L,EAAAkiM,EAAWxE,GAEpB,IAAIhuJ,EAAAm0J,EAAJ3E,WAAsBQ,EAEd,GAAAhoG,EAAI,EAAU,CACd,GAAAhoD,EAAAiwJ,EAAc,CACd,IAAAsE,EAASv0J,EAAUiwJ,EACnBR,EAAKn/L,GAAKikM,EACb9E,EAAAj/L,QAAA+jM,OAIAv0J,EAAAwyJ,EAAAjtL,QAAA4qL,EAAAD,IACJT,EAAAj/L,OAAAwvC,EAAAkwJ,EAAA,EAAAlwJ,EAAAkwJ,sBAKGnwJ,EAAAo0J,EAAJ5E,WAAqBiD,EAAAzyG,OAAA,EAAAowG,EAAAqE,EAAA7C,GAEb,GAAA5pG,EAAI,GACAn7F,KAAAwnM,qBAAAr0J,EAAA4xJ,GACH,GAFDpB,IAEWz0G,EAAcC,MACrB0zG,EAAIl/L,MAAa,OACb,GAAAggM,IAAAz0G,EAAAE,OAAA,CACA,GAAAh6B,EAAAzxD,MAAAiiM,EAAAzyG,OAAA,CAFJ99E,GAGO,EACH,MAEPwtL,EAAAl/L,MAAA,4BAOL,IAAIirE,EAAAmlB,EAAenlB,YAEfX,EAAS8lB,EAAa3lB,cACtBxrE,EAAAmxF,EAAc7lB,MACd9zC,EAAA25D,EAAa5lB,kCAEd05H,EAAYztK,EAAA12B,GAAAuqE,EAAArqE,OAAAhB,EAAAgB,QAAA,EAEX,GAAAgrE,EAGA,CACA,IAAAk5H,EAAajF,EAAYvjM,EACzBujM,EAAIvjM,EAASsD,EAAbtD,EAAoBsD,EAAAgB,OAAAi/L,EAAAn/L,EAAAm/L,EAAAj/L,OAAAikM,EAChBhF,EAAAn/L,EAASokM,EAASllM,EAAAc,EAASqkM,EAC9BlF,EAAAn/L,EAAA,IACJm/L,EAAAj/L,OAAAi/L,EAAAj/L,OAAAikM,QAVDhF,EAGOvjM,GAAAsD,EAAAtD,EAAAyoM,EACHlF,EAAIn/L,GAAAd,EAAYc,EAAAmkM,EAUvB,IAAAG,EAAAT,EAAA5E,WAAAiF,EAAAL,EAAAf,YACJxmM,KAAAioM,WAAAr1G,EAAA1jD,EAAA2zJ,EAAAj0H,EAAAo5H,EAAA7vC,EAAA/kH,EAAA8kH,EAAAqrC,KAKL,OA/hBaluL,2EAuiBD,OAFRuyL,EAAQpoM,OAAR,EAEQikM,GACI,KAAA57L,EAAAknF,cAAcjY,KACjB,IAAA,IAAAv3E,EAAA,EAAAA,EAAA2jM,IAAA3jM,EACDqoM,EAAAliM,KAAA,GAEA,MACI,KAAAmC,EAAAknF,cAAc9T,OACjB,IAAA,IAAAl2D,EAAA,EAAAxD,EAAAk4E,EAAAj6F,OAAAulB,EAAAxD,EAAAwD,IACD6iL,EAAAliM,MAAA0vD,EAAAzxD,MAAA81F,EAAA10E,IAAA,GAEA,MACI,KAAAld,EAAAknF,cAAc7T,MACjB,IAAA,IAAA9wC,EAAA,EAAAplB,EAAAy0E,EAAAj6F,OAAA4qC,EAAAplB,EAAAolB,IACDw9J,EAAAliM,KAAA0vD,EAAAzxD,MAAA81F,EAAArvD,IAOA,OAAAs5J,GACA,KAAA77L,EAAAonF,sBAAAjY,IACJosH,EAAWhuI,EAAsBxxD,OAC7B,MACA,KAAAiE,EAAAonF,sBAAAhU,OACJmoH,GAAWhuI,EAAsBxxD,OAAjCu/L,GAAA,EACI,MACA,KAAAt7L,EAAAonF,sBAAA8lD,OACJquD,EAAAD,IAMJqB,4BACgB,yBAEZ55F,EAAAx1C,EAAuBxxD,OAE1B+/L,IAAAz0G,EAAAG,qBAIGs0G,IAAAz0G,EAAAxxC,OACHitD,EAAA,OAIDxP,EAAAwP,EACAvP,EAAAwP,EACAq4F,EAAgBt/L,MAAhBgnG,EACHs4F,EAAAr/L,OAAAgnG,EA1lBLi5F,EAAAl5F,mKC1GM9R,EAAYn5F,EAAQ,6BAEpB08E,EAAA18E,EAAe,mCACf4vF,EAAA5vF,EAAW,yEAEXwvF,EAAWI,EAAMJ,0BAGnBg5G,EAAJtoM,GAAAye,GAAAmrD,eAAA0pB,EAAA9W,GAEIpgD,EAAW,YAEX4uC,EAAA,KAEAu9H,EAAY,GACZx4G,EAAA,GACAQ,EAAA,EACAi4G,EAAc,EACdC,KACAC,EAAJ1oM,GAAAqvC,OACIohD,EAAJ,EACIozG,EAAS,EACTC,EAAA,EACAvuI,EAAA,KACAwc,EAAc,YAElBiyH,GAAA,EAGI2E,GAAA,EACAC,EAAJ,SAEIC,EAAU,EAEVl3G,GAAA,OAEAE,GAAA,EAEJi3G,OAAA,EAGIC,GACI5vG,uBAEA,IAAIpoF,EAAO3Q,KAAA+4F,KAAArwF,MAEP,IAAAiI,EAAI,CACJ,IAAA4pB,EAAOZ,SAAAC,cAAA,UAEHjpB,GAFJ4pB,OAAAA,EAIH2B,QAHe3B,EADL4yF,WAAA,OARD,OAAAx8G,GAkBN6mD,IAAA,SAAAj9B,GACHv6B,KAAA+4F,KAAAv5F,QAAA,IAnBTQ,KAAA+4F,KAAArzF,KAAA60B,KA4BQp7B,EAAAE,SACI+yF,kBAAA,WACH,GAFDxyF,GAGK06B,KAAAkwB,aAAA5qD,GAAA06B,KAAAuvB,mBACD6+I,EAAKC,EAAkBhgL,WAEnB,IAAA+/K,EAAmB,CACf,IAAAx7E,EAAQvzF,SADOC,cAAA,UAEf8uK,GAFJnuK,OAAA2yF,EAIHhxF,QAAAgxF,EAAAC,WAAA,OAMT,OAnBau7E,EAAAnuK,OAAA52B,MAAA+kM,EAAAnuK,OAAA32B,OAAA,EAmBb8kM,GAEQh3G,oBAAY,SAAIk3G,GACnBhpM,GAAA06B,KAAAkwB,aAAA5qD,GAAA06B,KAAAuvB,oBAAA++I,GAtBQD,EAAAnxI,IAAAoxI,iCA4BJnjL,EAAAorE,YAALgC,YAEA7yF,KAAK6oM,kBAAApjL,GACLzlB,KAAKikM,kBAAAx+K,GACLzlB,KAAK8oM,sBACL9oM,KAAK+oM,2BACL/oM,KAAKgpM,uDAELhpM,KAAKo4J,eAAL3yI,uBAGAA,EAAKgf,KAAAo4B,eAALyrI,GAEAtoM,KAAKipM,aAAYxjL,GAEjBA,EAAAorE,YAAAgC,UAAAptE,EAAAorE,YAAAiC,SAAA,EAEA92D,EAAW,KA7CF46H,EAAA,KAgDbhsF,EAhDa,OAoDTq+H,aAAU,aACNJ,kBAAS,SAAMpjL,GACXA,EAAAyrE,cAtDCvf,EAAAlsD,EAAA2qE,WAuDG3qE,EAAAkrE,KADJlrE,EAGKkrE,KAAAj3D,aACDi4C,EAAAlsD,EAAekrE,KAAAj3D,aAEX95B,GAAA47B,OAAKC,KAAKhW,EAAAkrE,KAAAh1D,UAAe,SAAzBV,EAAAm1D,GACAze,EAAKye,GAAL,QAHJ3qE,EAAAkrE,KAAAj3D,aAAA02D,EAKH3qE,EAAAoqE,mBAAA,KAMJle,EAAA,SAOLsyH,kBAAW,SAAcx+K,GACzB,IAAAmjL,EAAUnjL,EAAc+pE,eACxBxzD,EAAW4sK,EAAX1sK,mBAEA0uC,EAAUnlD,EAAKmlD,SAEf+kB,EAAAlqE,EAAAmqE,OAAgB/oB,WAChBspB,EAAY1qE,EAAK0qE,UACjBi4G,EAAYj4G,EACZwzG,EAAYl+K,EAAA8qE,SACZ+3G,EAAA3kM,MAAmB8hB,EAAAgf,KAAnB9gC,MACA2kM,EAAU1kM,OAAK6hB,EAAAgf,KAAf7gC,OACAysF,EAAU5qE,EAAK4qE,YACfozG,EAASh+K,EAAKuqE,gBACd0zG,EAAUj+K,EAAKwqE,cACf96B,EAAA1vC,EAAYgf,KAAKjoB,MACjB+0E,EAAA9rE,EAAe8rE,sBAEfE,EAAIhsE,EAAcgsE,aAIdmyG,EAJJD,IAGSz0G,EAAcxxC,OAGlBimJ,IAAAz0G,EAAAG,iCAOD,IAAAuN,EAAAsrG,GAAAziL,EAAAC,aAAAwtE,GACA0J,GAAUA,EAAAluF,SACV65L,GAAA,EACAE,EAAAS,EAAAtsG,EAAAj5F,OACA6kM,EAAA5oM,GAAkB4c,MAAAogF,EAAApgF,QAGJzT,EAAAy/L,EAAdz/L,EAAA0c,EAAAgf,KAAAjoB,MAAAzT,EAAA,MAEHw/L,GAAA,EApHQE,EAAA,IAyHTU,gCAAgB,WAChB,IAAI74G,EAAAtwF,KAAJopM,iBACIpqG,EAAAqpG,EAAJ7oM,gBAEI6pM,OAAkB,EAuB1B,OAnBQC,EAJJ7F,IAGS57L,EAAAknF,cAAkB7T,MACdotH,EAAY3kM,MAAQ8kM,EAE5BhF,IAAA57L,EAAAknF,cAAA9T,OACQqtH,EAAT3kM,MAAA,MAOA0lM,EAJJ3F,IAGS77L,EAAAonF,sBAAkBjY,IACL,EAEjB0sH,IAAA77L,EAAAonF,sBAAAhU,OACiBqtH,EAAY1kM,OAAS,EAAA0sF,GAAc0O,EAArD,GAAA,mBAMRp/F,GApJaqE,GAAAqlM,EAAAD,IAsJTjxC,eAAS,6CAETp8H,EAAI20D,KAAAw3G,EAEJ,IAAAoB,EAAAvpM,KAAAmpM,kCACA74G,EAAAtwF,KAAoBopM,iBAEpBptK,EAAIwtK,SAAA,mEAKI,IAHR,IAAAC,OAAA,EAGQlqM,EAAI,EAAAA,EAAA8oM,EAAc7oM,SAAiBD,EAAnC,CACA,GAAAgpM,EAAS,CACT,IAAApzG,EAAAqzG,GAAqB16J,EACrB9R,EAAS0tK,YAAW,QAAAv0G,EAAoBj7E,EAAA,KAAxCi7E,EAAyDx4E,EAAA,KAAsBw4E,EAA/EjpF,EAAA,KAAAipF,EAAApsF,EAAA,IAAA,IACHizB,EAAAk5D,UAAA,EAAAg0G,EACDltK,EAAS2tK,WAAStB,EAAoB9oM,GAAAgqM,EAAiBjqM,EAAAiqM,EAAkB7lM,EAAInE,EAAA+wF,GAE7Et0D,EAAI4tK,SAAcvB,EAAA9oM,GAAAgqM,EAAAjqM,EAAAiqM,EAAA7lM,EAAAnE,EAAA+wF,GAEdmB,IACAg4G,EAAAzpM,KAAA6pM,mCACA7tK,EAASw8H,OACTx8H,EAAS8tK,YACT9tK,EAASk5D,UAAO/E,EAAA,EAChBn0D,EAAS0tK,YAAO,QAAAv0I,EAAAj7C,EAA2B,KAAQi7C,EAAOx4C,EAAA,KAAAw4C,EAAAjpD,EAAA,KAA2BipD,EAAIpsD,EAAA,IAAzF,IACAizB,EAAS3kB,OAAToyL,EAAAnqM,EAAAmqM,EAAA/lM,EAAAnE,EAAA+wF,EAAA,GACAt0D,EAASy5D,OAATg0G,EAAAnqM,EAAAs3J,EAAAjzJ,MAAA8lM,EAAA/lM,EAAAnE,EAAA+wF,EAAA,GACHt0D,EAAA05D,SACJ15D,EAAAy8H,WAKL7tF,EAAAoK,uBAEI60H,iCAAgB,WAChB,MAAIv5G,EAAAtwF,KAAJopM,iBACIpqG,EAAAqpG,EAAJ7oM,OAEA6pM,OAAA,EAeJ,OAbIC,EAAI,EAAAb,EAIAY,EAJJ3F,IAGS77L,EAAAonF,sBAAkBjY,IACLmZ,EAEjBuzG,IAAA77L,EAAAonF,sBAAAhU,OACiBqtH,EAAY1kM,OAAS,EAAA0sF,GAAc0O,EAArD,GAAA,EAAA7O,EAAA,mBAMRvwF,GAAAqE,GAAAqlM,EA9MaD,sCAiNT,IAAIU,EAAcp6G,EAAS7rE,MAAA,MAE1B,GAFD6/K,IAGSz0G,EAAcG,cACnBi5G,EAAA1kM,OAAkBykM,EAAlB7oM,OAAAQ,KAAAopM,sBACA,GAAIzF,IAAJz0G,EAAAxxC,KAAA,CACA2qJ,EAAkB0B,EAGd,IAFJ,IAAAC,EAAgB,EACZC,EAAI,EACJ1qM,EAAA,EAAAA,EAAcwqM,EAAcvqM,SAAaD,EAAA,CAC5C,IAAA2qM,EAAArxG,EAAAg0B,gBAAA7wF,EAAA+tK,EAAAxqM,IACDyqM,EAAcA,EAAgBE,EAAcF,EAALE,EAEvCD,EAAY5B,EAAQ7oM,OAAWQ,KAAYopM,iBAE3Cd,EAAI3kM,MAAWkiB,WAAAmkL,EAAA7D,QAAA,IAAA,EAAAsC,EACXH,EAAA1kM,OAAAiiB,WAAAokL,EAAA9D,QAAA,IACA30G,IAEP82G,EAAA3kM,OAAAykM,EAAA/iM,KAAAm1C,IAAA,YApOQo8G,EAAAjzJ,MAAA2kM,EAAA3kM,MA0ObizJ,EAAAhzJ,OAAA0kM,EA1Oa1kM,QA4OTumM,uBAAA,WACInqM,KAAA4qC,MAAJ,aAEIw/J,OAAA,EAIAC,EAJJ5G,IAGS57L,EAAAknF,cAAkB7T,MACd,QAERuoH,IAAA57L,EAAAknF,cAAA9T,OACQ,SAEJ,OAETj/C,EAAIsuK,UAAYD,EAIZD,EAJJ1G,IAGS77L,EAAAonF,sBAAkBjY,IACd,MAER0sH,IAAA77L,EAAAonF,sBAAAhU,OACQ,SAEJ,SAGbj/C,EAAAuuK,aAtQaH,uCAyQT,IAAIL,EAAap6G,EAAA7rE,MAAA,MAEb,GAAA8/K,EAAI,CACJyE,KAEI,IADA,IAAAmC,EAAelC,EAAU3kM,MAAgB,EAAA8kM,EACrClpM,EAAA,EAAAA,EAAAwqM,EAAyBvqM,SAAaD,EAAA,CAI1C,IAAAkrM,EAAA5xG,EAAkBg0B,gBAAuB7wF,EAAA+tK,EAAzCxqM,IACHmrM,EAAA7xG,EAAAuD,aAAA2tG,EAAAxqM,GAAAkrM,EAAAD,EAAAxqM,KAAAw6F,aAAAx+D,IAEAqsK,EAAAA,EAAAjoE,OAAAsqE,SArRIrC,EAAA0B,GA6RTY,aAAA,WACA,IAAIv9E,EAASj9B,EAAAtpB,WAAA,MAOjB,OANQumD,GAAWz7C,EACd4f,iBAKL67B,GAEIg8E,eAAI,WACA,IAAAwB,EAAev6G,EAQvB,OAhTa,GA0SLu6G,EADG,IAFPA,EAGmBz6G,kDAWf,IAFJ,IAAA06G,KAEItrM,EAAA,EAAAA,EAAgBwqM,EAAhBvqM,SAAAD,EAAA,CACH,IAAAoE,EAAAk1F,EAAAg0B,gBAAAo3B,EAAA8lD,EAAAxqM,cAKL,OAAAsrM,GAEQrwG,aAAA,SAAOypD,GACV,OAFD,SAAAr0D,GA5TS,OAAAiJ,EAAAg0B,gBAAAo3B,EAAAr0D,KAmUTk5G,oBAAgB,WAIZ,yBAFJ9sK,EAAI20D,KAAAw3G,EAEAxE,IAAIz0G,EAAkBE,OAAK,qBAEvBy7G,EAAJ7qM,KAAA8qM,0BAAAf,EAAA/tK,GAEIz8B,EAAA,MAEAsjG,EAAJ,EAEI,GAAA+gG,EAAI,CACJ,IAAI4G,EAAsBlC,EAAK3kM,MAAA,EAAA8kM,EAC3BsC,EAAiBzC,EAAjB1kM,OAAA,EAAA6kM,EACA,GAAA+B,EAAgB,GAAhBO,EAAA,EAGJ,OAFI5C,EAAAnoM,KAAA2qM,oBACH3uK,EAAA20D,KAAAw3G,GAGDlxG,EAAI8zG,EAAJ,EACAloG,EAAI2nG,EAAJ,EAMQ,IALR,IAAIt6G,EAAiBC,EAArB,EACIu6G,EAAA,QAEJM,EAAO,EAAc96G,EAEb+G,EAAA8zG,GAAkBloG,EAAlB2nG,GAAA,CAOA,GARJS,EAGI/6G,EAAiB86G,EAAsB,EAAvC,EAGAA,EADH96G,EAAA86G,EAAA,EAGG96G,GAAA,EAAA,CACHtwF,GAAAgB,MAAA,MACD,MAOI,IALJuvF,EAASD,wBAETl0D,EAAA20D,KAAAw3G,EAEIlxG,EAAA,EACA13F,EAAI,EAAAA,EAAAwqM,EAAqBvqM,SAAgBD,EAAA,CACzC,IAAA6sB,EAAA,EAIAq+K,EAAW5xG,EAAag0B,gBAAQ7wF,EAAA+tK,EAAAxqM,IAE5B,IADAmrM,EAAI7xG,EAAeuD,aAAU2tG,EAAVxqM,GAAoCkrM,EAAAD,EAAvDxqM,KAAAw6F,aAAAx+D,IACA5P,EAAAs+K,EAAYlrM,QAAZ,CAEAqjG,EADehK,EAAKg0B,gBAApB7wF,EAAA0uK,EAAAt+K,IAEH6qE,GAAAj3F,KAAAopM,mBACJh9K,GAIO6+K,IADJh0G,EAEO8zG,EACHC,EAAA,EAAA96G,GAEH+6G,GAAA,EACJh0G,EAAA8zG,EAAA,UAQG,IAFR9zG,EAAY8yG,EAAIvqM,OAAhBQ,KAAAopM,iBAEQ7pM,EAAA,EAAAA,EAAAwqM,EAAYvqM,SAAZD,EACHsjG,EAAAgoG,EAAAtrM,KACJsjG,EAAAgoG,EAAAtrM,0BAID0Q,EAAaq4L,EAAA1kM,OAAqBqzF,EAElC9G,EAASi4G,EAAT/iM,KAAAC,IAAA,EAAAqK,EAAAM,GAAA,EACHk4L,EAAAnoM,KAAA2qM,eACJ3uK,EAAA20D,KAAAw3G,6MCrdTzoM,EAAQ,YACRA,EAAQ,oBACRA,EAAQ,0KCFR,IAAM2e,EAAA3e,EAAA,oEAENwrM,EAAiBxrM,EAAS,eAAAwrM,aAElB/rM,EAAAE,QAAOgf,EAAK2qC,OACf+oC,WAHqB,SAAAtsE,GAKtB,OALsBA,EAAA8yE,qBAOlB2hC,YAAA,SAAmBz0G,EAAA0b,GAPD,IAAAsD,EAAAhf,EAAAgf,KAUtBymK,EAVsBzmK,EAUVtD,EAVUgqK,YAUW1lL,EAAMorE,YAVjBpsD,EAUgC0wB,OAAOuyD,0CAGzD,IAAAqH,EAAWn8B,EAAXglE,WAEAhlE,EAAWglE,YAAc,6BAEzBhlE,EAAW+oG,YAAW/oG,EAAtBglE,WAAA,EAAA,EACA,IACIjnJ,EAAOiiF,EAAQ9hF,gBAEfogE,EAAAhiC,EAAYtrC,iBAGZi0J,EAAJj1J,EAAAgB,OAAU2d,OAAA,EAAGrV,OAAA,EACTgO,OAAC,EACD9S,OAAK,EACL4mE,GAeAzsD,EAAI3e,EAACtD,EAAA2xE,EACL/2D,GAAKtX,EAADtD,EAAWu4J,GAAf5mF,cAEA7pE,EAAAxE,EAAKc,EAAAwtE,EAELvgE,EAAKo+G,GAAAh5F,EAAgBxU,EACrB5Q,EAAKo+G,GAAAvgG,EAAgBpnB,EACrBuJ,EAAKo+G,EAAa,GAAGh5F,EAAIxU,EACzB5Q,EAAKo+G,EAAa,GAAGvgG,EAAItiB,EACzByE,EAAKo+G,EAAa,GAAGh5F,EAAI7b,EACzBvJ,EAAKo+G,EAAa,GAAGvgG,EAAIpnB,EAC5BuJ,EAAAo+G,EAAA,GAAAh5F,EAAA7b,eAzBGqH,EAAI3e,EAACtD,EAAA2xE,EACL/2D,GAAKtX,EAADtD,EAAWw4J,GAAf7mF,cAEA7pE,EAAAxE,EAAKc,EAAAwtE,EAELvgE,EAAKo+G,GAAAh5F,EAAgBxU,EACrB5Q,EAAKo+G,GAAAvgG,EAAgBtiB,EACrByE,EAAKo+G,EAAa,GAAGh5F,EAAI7b,EACzBvJ,EAAKo+G,EAAa,GAAGvgG,EAAItiB,EACzByE,EAAKo+G,EAAa,GAAGh5F,EAAIxU,EACzB5Q,EAAKo+G,EAAa,GAAGvgG,EAAIpnB,EAb7BuJ,EAcOo+G,EAAA,GAAAh5F,EAAA7b,EACHvJ,EAAKo+G,EAAL,GAAAvgG,EAAApnB,GAiBJuJ,EAAKo+G,GAAAzvH,EAAgBA,EACrBqR,EAAKo+G,GAAArrH,EAAgBA,EAAIm0J,EAAIntH,EAC7B/5B,EAAKo+G,EAAa,GAAGzvH,EAAIA,EAAzBw4J,EAAAptH,EACA/5B,EAAKo+G,EAAa,GAAGrrH,EAAIA,EAAzBm0J,EAAAntH,EACA/5B,EAAKo+G,EAAa,GAAGzvH,EAAIA,EACzBqR,EAAKo+G,EAAa,GAAGrrH,EAAIA,EAC5BiN,EAAAo+G,EAAA,GAAAzvH,EAAAA,EAAAw4J,EAAAptH,EACF/5B,EAhEco+G,EAAjB,GAAArrH,EAAAA,wHCFA,IAAM2a,EAAA3e,EAAA,iEAEAwrM,EAAWxrM,EAAW,eAA5BwrM,aAEAp9J,EAAOluC,GAAP4c,MAAoB,IAAM,IAAA,IAAA,KAElBrd,EAAAE,QAAIgf,EAAA2qC,8BAEJ,IAAA4pC,EAAWntE,EAAX8yE,oBAEA3F,EAAWglE,WAAX,kBAEAhlE,EAAW+oG,YAAW,EAEtB,IAAAhrL,EAAAiiF,EAAA9hF,MAUJ,OATIH,EAAK,GAAGolB,EAAI,EACZplB,EAAK,GAAG6d,EAAI,EACZ7d,EAAK,GAAGolB,EAAI,EACZplB,EAAK,GAAG6d,EAAI,EACZ7d,EAAK,GAAGolB,EAAI,EACZplB,EAAK,GAAG6d,EAAI,EACZ7d,EAAA,GAAOolB,EAAA,EAjBWplB,EAAA,GAAA6d,EAAA,EAAAokE,GAsBrBsnC,YAtBqB,SAAAz0G,EAAA0b,GAwBtB+pK,EAxBsBzlL,EAAAgf,KAAAtD,EAwBFgqK,YAAA1lL,EAAAorE,YAAA/iD,EAAA45E,gCAGhB,IAAI90B,EAAYntE,EAAhBorE,YAEIpsD,EAAAhf,EAASgf,KACT9gC,EAAO8gC,EAAK9gC,MACZC,EAAO6gC,EAAK7gC,qBAEZs0J,EAAOzzH,EAAA4T,QAAWz0C,EAEtB+M,EAAAiiF,EAAA9hF,MACAH,EAAK,GAAGrR,GAAI64J,EACZxnJ,EAAK,GAAGjN,GAAKw0J,EACbvnJ,EAAK,GAAGrR,EAAIqE,EAAZw0J,EACAxnJ,EAAK,GAAGjN,GAAIw0J,EACZvnJ,EAAK,GAAGrR,GAAI64J,EACZxnJ,EAAK,GAAGjN,EAAIE,EAASs0J,EACxBvnJ,EAAA,GAAArR,EAAAqE,EAAAw0J,EACFxnJ,EA3CH,GAAAjN,EAAAE,EAAAs0J,qHCJA,IAAM75I,EAAA3e,EAAA,kDAEN0rM,EAAoB1rM,EAAM,eAAA0rM,eAElBjsM,EAAAE,QAAWgf,EAAK2qC,OAChBkxE,YAAA,SAAqBz0G,EAAA0b,GACxB,IAAAsD,EAAAhf,EAAAgf,KACF2mK,EALH3mK,EAAAtD,EAAAkqK,cAAA5lL,EAAAorE,YAAApsD,EAAA0wB,OAAAuyD,0GCFA,IAAMrpG,EAAA3e,EAAA,+CAEA0rM,EAAiB1rM,EAAT,eAAd0rM,eAEAt9J,EAAOluC,GAAP4c,MAAoB,IAAM,IAAA,IAAA,KAElBrd,EAAAE,QAAAgf,EAAe2qC,OAClBkxE,YAAA,SAAAz0G,EAAA0b,GACFiqK,EAJH3lL,EAAAgf,KAAAtD,EAAAkqK,cAAA5lL,EAAAorE,YAAA/iD,EAAA45E,uGCJA,IAAMp4B,EAAA5vF,EAAe,kDAGf4rM,EAAiB5rM,EAAQ,+BAG3B6rM,EAAiB7rM,EAAA,eAEb8rM,GACA15G,aAAI,SAAYrsE,yBAEZosE,EAAA55B,EAAqBwzI,EAAeC,SAEvCjmL,EAAAkrE,gBAAA/wF,GAAA8nE,yBAQJyqB,iBAAA,SAAAiB,GAfL,OAAAA,EAAA4E,iBAoBA1I,EAAAliD,WAAiBo+J,6IC1BjB,IAAMG,EAAajsM,EAAQ,sBACrBi1D,EAAAj1D,EAAA,8BACAm6C,EAAAn6C,EAAoB,+CAEtBksM,EAAclsM,EAAA,cAEdmsM,EAAAF,EAAqBG,cAEjBC,GACI55G,iBAAA,SAAA56B,GACAA,EAAAs5B,cAEA+6G,EAAIz5G,iBAAyB56B,EAAAu8B,gBAA7Bv8B,EAGKy8B,QAAAr/B,EAAAggC,KAAAf,cACDr8B,EAAAs5B,YAAAm7G,EAAAj6G,WAAAx6B,GAGPA,EAAAs5B,YAAAt5B,EAAAghC,qBAGD,IAAI3F,EAAAr7B,EAAes5B,YAEX,GAAAt5B,EAAAy8B,QAAWr/B,EAAKggC,KAAKf,cACrB,GAAAr8B,EAAIpuC,YAAc,CAClB,IAAA8lB,EAAWsoB,EAAA9yB,KAAA2wB,aACXmjB,EAAWhhB,EAAA9yB,KAAX6wB,aACAs9B,EAAA4oG,iBAAgBvsJ,EAAiBtrC,MAAjCsrC,EAAArrC,OAAA20E,EAAAj5E,EAAAi5E,EAAA70E,GACAkvF,EAAWglE,WAAW,EAN1Bo0C,EAQK75G,iBAAA56B,GACDq7B,EAAKhlD,SAAL2pB,EAAA86B,eAGH96B,EAAA86B,UAAA,UAGJ96B,EAAAs8B,UAAAxB,UAAA96B,EAAA86B,UAhCgBu5G,EAAAz5G,iBAAA56B,EAAAs8B,YAqCjBqmC,YAAS,SAAU3iE,EAAKp2B,IAEpBo2B,EAAAy8B,QAAYr/B,EAAZggC,KAAAf,eAAAr8B,EAAApuC,6BAGA0iL,EAAAjoJ,QAEAgoJ,EAAY1xE,YAAZ3iE,EAAAu8B,eAAA3yD,GAEA0qK,EAAAI,aAGA9qK,EAASsD,KAAL8yB,EAAe9yB,KACftD,EAAAyM,SAAgB2pB,EAAA86B,UAChB96B,EAAAy8B,QAAAr/B,EAAAggC,KAAAf,eAFJo4G,EAIK9xE,YAAA3iE,EAAAp2B,GACDA,EAAAg5F,UAEJyxE,EAAA1xE,YAAA3iE,EAAAs8B,UAAA1yD,mBAxDZo2B,EAAA9yB,KAAAyW,aAAArB,EAAAi8C,0BAiEQo2G,GACAhyE,YAAS,SAAU3iE,EAAKp2B,IAEpBo2B,EAAAy8B,QAAYr/B,EAAZggC,KAAAf,eAAAr8B,EAAApuC,2BALZouC,EAAA9yB,KAAAyW,aAAArB,EAAAi8C,yCAeAnhC,EAAAwjC,eAAiB+zG,EAEb/sM,EAAAE,SAFJ8sM,MAAAJ,oKCnFMt1G,0CAAAA,wDAGN21G,EAAiB1sM,EAAA,eAAA0sM,wBAEbjtM,EAAAE,SACI6uC,UAAI,+BAEJ,IAAA/pB,EAAA0lE,EAAA1gE,YAIQhF,KACHA,EAAAsqD,WAAAhlB,GACGA,EAAiB02I,kBAAmBh8K,GAEvC0lE,EAAAwI,UAAAznB,WAAAzmD,EAAAymD,UACJif,EAAAqI,qBAIG,IAAAU,EAAI/I,EAAUgH,YAAd,GAAA+B,GACIzuE,EAAY,iBAEZ0uE,EAAYD,EAAhBC,UAEC,IAAAC,IAAAD,6CAKGgE,EAAYhN,EAAG2W,WAEf3J,EAAY,IACfY,GAAAZ,QAIDA,EAAYY,EAAYZ,EAGxBY,cAAwB,EAAM,EAAMA,EAGpCZ,GADAA,EAAYA,EAAY,EAAA,EAAxBA,GACwB,EAAZ,EAAoBA,WAEhCA,SAAc,EAAY,EAAAA,GAG1Bw1G,EAAIA,EAAS,EAAA,EAAAA,EAEZv5G,GACG9yF,KAAA84J,UAAWjvE,EAAA4N,EAAA40G,GAEXx5G,IACH7yF,KAAA64J,YAAAhvE,EAAA4N,EAAA40G,GACJrsM,KAAAssM,iBAAAziH,MAIDivE,UACI,SAAajvE,EAAO4N,EADxB40G,GAAA,IAEIljL,EAAO0gE,EAAWkK,6BAEtBpjF,EAAAiiF,EAAA9hF,MAGIm/D,EAAA9mD,EAAcyhD,SAAlBjnE,MACAusE,EAAA/mD,EAAAyhD,SAAAhnE,OACI2oM,EAAJpjL,EAAA+kD,MAAYs+H,OAAA,EAAIzjK,OAAA,EACM0jK,OAAA,EAASC,OAAA,EAASC,OAAA,EAASC,OAAA,EAASC,OAAA,EAASC,OAAA,EAC/DC,OAAA,EACAC,OAAM,EAwBF,OAvBJ7jL,EAAMklD,UACNm+H,EAAKD,EAACjtM,EAAA2wE,EACNlnC,GAAMwjK,EAAD7oM,EAAkB6oM,EAAvB5oM,OAAAusE,EAIAu8H,EAAUE,EAAUH,EACpBK,EAAUE,mBATdH,EAWKI,EAAAjkK,EACD2jK,EAAMI,EANNP,EAAU7oM,EAAUwsE,IAQpBs8H,EAAKD,EAACjtM,EAAA2wE,EACNlnC,GAAMwjK,EAAD7oM,EAAkB6oM,EAAvB3oM,QAAAssE,EAIAu8H,EAAUI,EAAUL,EACpBG,EAAUI,kBACbL,EAAAE,EAAA7jK,MAJGwjK,EAAU7oM,EAAUwsE,GAQhB2Z,EAAAwW,WACA,KAAA5J,EAAA5f,WACAlmE,EAAK,GAAGolB,EAAI02K,GAAWE,EAAUF,GAAWh1G,EAC5C9mF,EAAK,GAAG6d,EAAIk+K,EACZ/7L,EAAK,GAAGolB,EAAI02K,GAAWE,EAAUF,GAAWJ,EAC5C17L,EAAK,GAAG6d,EAAIo+K,EACZj8L,EAAK,GAAGolB,EAAI82K,GAAWE,EAAUF,GAAWp1G,EAC5C9mF,EAAK,GAAG6d,EAAIs+K,EACZn8L,EAAA,GAAAolB,EAAA82K,GAAAE,EAAAF,GAAAR,EACJ17L,EAAK,GAAA6d,EAASw+K,EACV,MACA,KAAAv2G,EAAA1f,SACApmE,EAAK,GAAGolB,EAAI02K,EACZ97L,EAAK,GAAG6d,EAAIk+K,GAAWI,EAAUJ,GAAWj1G,EAC5C9mF,EAAK,GAAGolB,EAAI42K,EACZh8L,EAAK,GAAG6d,EAAIo+K,GAAWI,EAAUJ,GAAWn1G,EAC5C9mF,EAAK,GAAGolB,EAAI82K,EACZl8L,EAAK,GAAG6d,EAAIk+K,GAAWI,EAAUJ,GAAWL,EAC5C17L,EAAA,GAAAolB,EAAAg3K,EACJp8L,EAAA,GAAA6d,EAAAo+K,GAAAI,EAAAJ,GAAAP,EACI,MACA,QAvBRzsM,GAAAyC,QAAA,MA6BJuwF,EAxHaE,SAwHA,GACT+lE,YACI,SAAOhvE,EADX4N,EAAA40G,GAAA,IAEIz5G,EAAO/I,EAFXgH,YAGIlgF,EAAAiiF,EAHJ9hF,MAGwB2zB,EAAAolD,EAAcplD,KAClC9gC,EAAO8gC,EAAK9gC,MAAiBC,EAAO6gC,EAAK7gC,qBAEzCs0J,EAAKzzH,EAAT4T,QAAAz0C,EACI2d,GAAI42I,EAAcjsJ,GAAIgsJ,QAEtB9wJ,EAAAxD,EAAAs0J,EAEA+0C,OAAc,EACV,OAAApjH,EAAAwW,WACA,KAAA5J,EAAA5f,WAEAo2H,EAAI1rL,GAAJrH,EAAAqH,GAAA8qL,EAEA9qL,YACJrH,EAAK+yL,EACD,MACA,KAAAx2G,EAAA1f,SAEAk2H,EAAI/gM,GAAJ9E,EAAA8E,GAAAmgM,EAEAngM,YACJ9E,EAAA6lM,EACI,MACA,QAjBRrtM,GAAAyC,QAAA,MAsBAsO,EAAK,GAAGrR,EAAIiiB,EACZ5Q,EAAK,GAAGjN,EAAIwI,EACZyE,EAAK,GAAGrR,EAAI4a,EACZvJ,EAAK,GAAGjN,EAAIwI,EACZyE,EAAK,GAAGrR,EAAIiiB,EACZ5Q,EAAK,GAAGjN,EAAI0D,WAEZuJ,EAAA,GAAAjN,EAAW0D,EAGfwrF,EAnKaC,WAmKD,GAERd,WAAA,SAAAlI,GACA,IAAA+I,EAAA/I,EAAA0O,oBAGA3F,EAAWglE,WAAX,kBAEAhlE,EAAW+oG,YAAW,EAGrB,IADG,IAAAhrL,EAAAiiF,EAAA9hF,MACHvR,EAAA,EAAAA,EAAAoR,EAAAnR,OAAAD,IACDoR,EAAOpR,GAAA6pC,EAAA,EAGX,OAAAwpD,GACI05G,iBACW,SAAOziH,GAQd,iBANAl5E,EAAAk5E,EAAcgH,YAAlB//E,MACoB2+B,EAAIhL,EAAxBsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,YAE1Bm7D,EAASz7D,EAAOc,IAERhxC,EAAA,EAAQA,EAAA,EAAZA,IAAA,CACA,IAAA2tM,EAAUv8L,EAAApR,EAAA,GACV4tM,EAAUx8L,EAAApR,GACb4tM,EAAA7tM,EAAA4tM,EAAA5tM,EAAAyJ,EAAAmkM,EAAAxpM,EAAAyI,EAAA8+F,EA/LQkiG,EAAAzpM,EAAAwpM,EAAA5tM,EAAA4M,EAAAghM,EAAAxpM,EAAA0I,EAAA8+F,IAoMLgvB,YAAK,SAAArwC,EAAiB1oD,GACzBA,EAAAo1H,wCAGD,IAEIz6H,EAAAqF,EAAkBisK,6BAElBC,EAAOvxK,EAAXwxK,sBAGAlB,EAAA3nK,EAAA3I,EAAA+tD,EAAAgH,YAAApsD,EAAA0wB,OAAAuyD,MAGA,IAAA6lF,EAAKzxK,EAAA0xK,OACLD,EAAKE,KAAkBJ,EACvBE,EAAKE,KAAkBJ,EAAW,EAClCE,EAAKE,KAAkBJ,EAAW,EAClCE,EAAKE,KAAkBJ,EAAW,EACrCE,EAAAE,KAAAJ,EAAA,EAvNLE,EAAAE,KAAAJ,EAAA,wLCHAjB,EAAiB1sM,EAAA,eAAA0sM,mCAGbl+J,UAHa,EAKZ6jD,WALY,SAAAlI,GAOb,OAAAA,EAPa0O,kDAUT,IAAAp0E,EAAA0lE,EAAA1gE,YAIQhF,KACHA,EAAAsqD,WAAAhlB,GACGA,EAAiB02I,kBAAmBh8K,GAEvC0lE,EAAAwI,UAAAznB,WAAAzmD,EAAAymD,UACJif,EAAAqI,qBAIG,IAAAU,EAAI/I,EAAWgH,YACf,GAAA+B,GAAczuE,EAAA,CACV,IAAAmqD,EAAInqD,EAAWmqD,SACX,GAAAA,EACAskB,EAAW8kC,cAAcppD,EAAShvE,EAAAE,kCAElCozF,EAAA+oG,YAAArtH,EAAAo/H,UAAAluM,OAGAozF,EAAWglE,WAAX,EAAqBhlE,EAAW8kC,sCAKnC9kC,EAAAE,SACG9yF,KAAA84J,UAAYjvE,GAEP+I,EAALC,YAEH7yF,KAAA64J,YAAAhvE,GACJ7pF,KAAAssM,iBAAAziH,MAKLivE,UACI,SAAajvE,GAOb,IARJ,IAEIvb,EAAIub,EAFR1gE,YAAAmlD,gBAII9/C,EAAA8/C,EAAa+C,GAEjBuhB,EAAgB/I,EAAMgH,YAClBlgF,EAAIiiF,EAAU9hF,MACdvR,EAAA,EAAYgiB,EAAZwU,EAAAv2B,OAAAD,EAAAgiB,EAAAhiB,IAAA,CACA,IAAAouM,EAAch9L,EAAdpR,GACHouM,EAAA53K,EAAAA,EAAAx2B,YAKLqzF,EA/DaE,SA+DA,GACT+lE,YACI,SAAehvE,GADnB,IAEIplD,EAAAolD,EAAAplD,KACAmpK,EAAYvoM,KAALuK,IAAe60B,EAAA9gC,OACtBkqM,EAAYxoM,KAALuK,IAAe60B,EAAA7gC,sBAEtBs0J,EAAAzzH,EAAQ4T,QAAOw1J,EAEf1pL,EAAI0lE,EAFR1gE,YAGImlD,EAAInqD,EAHRmqD,SAIIhvE,EAAAgvE,EAAAhvE,EACAoE,EAAA4qE,EAAA5qE,EACAoqM,EAAY3pL,EAAMiqD,cANtBzqE,MAOIoqM,EAAa5pL,EAAMiqD,cAPvBxqE,OAQIk0J,EAAU3zI,EAAM+pD,MAAQvqE,MACxBk0J,EAAU1zI,EAAM+pD,MATpBtqE,SAUYugB,EAAAgqD,QAAW7uE,UAGnB0uM,EAFQ7pL,EAAAgqD,QAAWzqE,GAEVqqM,EAAgBl2C,GAAA,mBAGzB5nJ,EAAA49L,GAAoBhkH,EAAxB+W,KAAAi3D,EAAAk2C,mBAGIp9L,EAACiiF,EAAa9hF,MAEV,GAAA+4E,EAAI+W,KAQJ,IAAA,IAAA77E,EAAA,EAAYC,EAAC1lB,EAAAE,OAADulB,EAAiBC,EAAjBD,IAA0B,CACtC,IAAAkpL,EAAat9L,EAAAoU,EAAAC,GAChBipL,EAAA3uM,GAAAA,EAAAylB,GAAAmpL,GAAAv+L,EAAAwoJ,EACJ81C,EAAAvqM,GAAAqqM,EAAArqM,EAAAqhB,GAAAipL,GAAA/9L,EAAAioJ,OAVO,IAAA,IAAA34J,EAAA,EAAagiB,EAADjiB,EAAAE,OAAAD,EAAkBgiB,EAA9BhiB,IAAA,CACA,IAAAouM,EAAah9L,EAAApR,EAAAgiB,GAChBosL,EAAAruM,EAAAA,EAAAC,GAAAoQ,EAAAwoJ,EAEAw1C,EAAAjqM,GAAAqqM,EAAArqM,EAAAnE,IAAA0Q,EAAAioJ,EAWTtlE,EAAAC,WA3Ga,GA4GTy5G,iBACI,SAAoBziH,GASpB,IAVJ,IAEIplD,EAAOolD,EAAAplD,qBAEP9zB,EAAAiiF,EAAc9hF,MAEd2+B,EAAIhL,EAARsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IAC1Bk7D,EAASx7D,EAAOa,IACZ46D,EAAIz7D,EAAQc,IACRhxC,EAAA,EAAQgiB,EAAAqxE,EAAZ8kC,YAAAn4H,EAAAgiB,EAAAhiB,IAAA,CACA,IAAA2tM,EAAUv8L,EAAApR,EAAAgiB,GACV4rL,EAAUx8L,EAAApR,GACb4tM,EAAA7tM,EAAA4tM,EAAA5tM,EAAAyJ,EAAAmkM,EAAAxpM,EAAAyI,EAAA8+F,EAzHQkiG,EAAAzpM,EAAAwpM,EAAA5tM,EAAA4M,EAAAghM,EAAAxpM,EAAA0I,EAAA8+F,IA8HTgvB,YAAK,SAAUrwC,EAAA1oD,GACX,IAAAmtC,EAAAub,EAAA1gE,YAAAmlD,SACH,GAAAA,EAAA,CAKAntC,EAAAo1H,wCAGD,IAEIz6H,EAAAqF,EAAkBgtK,+BAElBd,EAAOvxK,EAAXwxK,sBAGAlB,EAAA3nK,EAAA3I,EAAA+tD,EAAAgH,YAAApsD,EAAA0wB,OAAAuyD,MAKC,IAFD,IAAA6lF,EAASzxK,EAAO0xK,OACZE,EAAKp/H,EAALo/H,UACHnuM,EAAA,EAAAgiB,EAAAmsL,EAAAluM,OAAAD,EAAAgiB,EAAAhiB,IACJguM,EAAAE,KAAAJ,EAAAK,EAAAnuM,kJCrJC2rM,EAAOxrM,EAAb,eAAAwrM,aAGIkD,EAAY,EAAZ/oM,KAAY8E,GAEZkkM,GAAOzuM,GAAAqE,GAAA,EAAA,GAAArE,GAAAqE,GAAX,EAAA,GAAArE,GAAAqE,GAAA,EAAA,GAAArE,GAAAqE,GAAA,EAAA,IACIqqM,GAAA,EAAA,EAAA,EAAqB,GACrBC,GAAA,EAAA,EAAA,EAAA,EAAoB,EAAC,EAAA,EAAA,GACrBC,GAAJ5uM,GAAAqE,GAAA,EAAA,GAAArE,GAAAqE,GAAA,EAAA,GAAArE,GAAAqE,GAAA,EAAA,GAAArE,GAAAqE,GAAA,EAAA,IACIwqM,GAAJ7uM,GAAAqE,GAAA,EAAA,GAAArE,GAAAqE,GAAA,EAAA,GAAArE,GAAAqE,GAAA,EAAA,GAAArE,GAAAqE,GAAA,EAAA,iBAEAyqM,KAEI,SAAIC,EAAoBlwJ,EAAxBm6B,EAAAe,EAAAn7B,EAAAhL,EAAAx9B,EAAA44L,GAEA,IAAIC,EAAAxpM,KAAAiF,IAAJ0L,GAAc84L,EAAAzpM,KAAA6E,IAAd8L,GACI+4L,OAAS,EACTC,OAAW,EACX,GAAA,IAAA3pM,KAAA6E,IAAA8L,GAAA,CAGI,GAFJ+4L,EAAKF,EAADC,GAEArwJ,EAAAjL,EAAAl0C,GAAAwvM,EAAA,EAAA,CACA,IAAAG,EAAAz7J,EAAmB9vC,EAAIqrM,GAAvBtwJ,EAAAjL,EAAAl0C,GACHsvM,EAAA,GAAAtvM,EAAAm/C,EACGmwJ,EAAgB,GAAhBlrM,EAAqBurM,kBAGrB,IAAAC,EAAA17J,EAAA9vC,EAAuBqrM,GAAvBn2H,EAAAplC,EAAAl0C,GAEHsvM,EAAA,GAAAtvM,EAAAs5E,EAEJg2H,EAAA,GAAAlrM,EAAAwrM,GAIG,GAAA,IAAA7pM,KAAAiF,IAAA0L,GAAA,CAGI,GAFJg5L,EAAWF,EAAPD,GAEArwJ,EAAAhL,EAAA9vC,GAAmBmrM,EAAnB,EAAA,CACA,IAAAM,EAAA37J,EAAAl0C,EAAA0vM,GAAAxwJ,EAAAhL,EAAA9vC,GACHkrM,EAAA,GAAAtvM,EAAA6vM,EACGP,EAAU,GAAVlrM,EAAsB86C,EAEtB,IAAAm7B,EAAAnmC,EAAA9vC,GAAAmrM,EAAA,EAAA,CACA,IAAAO,EAAA57J,EAAAl0C,EAAuB0vM,GAAvBr1H,EAAAnmC,EAAA9vC,GACHkrM,EAAA,GAAAtvM,EAAA8vM,EAEJR,EAAA,GAAAlrM,EAAAi2E,IA4ED,SAAgB01H,EAAA3lL,EAAhBC,GACA,IAAA2lL,EACAC,EAIC,aAFDA,EAAI5lL,EAAAjmB,EAAAgmB,EAAoBhmB,EAEb,IAFX4rM,GAE6B,IAAlBC,EAAV,CAEO,GAAiB,IAAjBD,EACH,OAFDC,EAEO,EACc,GAAVlqM,KAAK8E,GAEb,IAAA9E,KAAA8E,GAGC,IAAA6L,EAAA3Q,KAAS26E,KAATuvH,EAAAD,GAKX,OAJQA,EAAA,gBAIRt5L,GAIG,SAAIw5L,EAAJ7+L,EAAAypB,EAAAq1K,EAAAC,EAAAC,GACA,IAAIrhI,EAAMggI,EACNsB,EAAMthI,EAAS,GACfuhI,EAAMvhI,EAAS,UAEnBwhI,EAAKxhI,EAAY,GAEjB39D,EAAKypB,GAAA96B,EAAYmwM,EAAInwM,EACrBqR,EAAKypB,GAAA12B,EAAY+rM,EAAI/rM,EACrBiN,EAAKypB,EAAS,GAAG96B,EAAIowM,EAAMpwM,EAC3BqR,EAAKypB,EAAS,GAAG12B,EAAIgsM,EAAMhsM,eAE3BiN,EAAIypB,EAAA,GAAA12B,EAAAisM,EAAJjsM,EAKAqsM,GAFYN,EAAAnwM,EAAWswM,IAAAI,EAAWJ,iBAEHj/L,EAAnBypB,GAIZ21K,GAFYL,EAAApwM,EAAWswM,IAAAI,EAAWJ,iBAEHj/L,EAAnBypB,EAAZ,MAEYu1K,EAAArwM,EAAWswM,IAAAI,EAAWJ,IACrCD,EAAAjsM,EAAAmsM,IAAAC,EAAAD,UAIG,SAAIE,EAAME,EAAUC,EAAmBv/L,EAAAypB,GACvC,IAAIygK,EAAM0T,EACN4B,EAAMtV,EAAI,IAAMA,EAAI,GAAKA,EAAI,IAAMoV,EACnCG,EAAMvV,EAAI,IAAMA,EAAI,GAAKA,EAAI,IAAMoV,EACnCI,EAAKxV,EAAK,IAALA,EAAT,GAAAA,EAAA,IAAAoV,EACAK,EAAOzV,EAAO,IAAMA,EAAP,GAAcA,EAAA,IAA3BoV,EACA1hI,EAAO59D,EAAOypB,GACjBm0C,EAAAx4C,EAAAo6K,GAAAC,EAAAD,GAAAD,2BAKGhiK,UAHa,EAKZ6jD,WALY,SAAAlI,GAOb,OAAAA,EAPa0O,kDAUT,IAAAp0E,EAAA0lE,EAAA1gE,YAIQhF,KACHA,EAAAsqD,WAAAhlB,GACGA,EAAiB02I,kBAAmBh8K,GAEvC0lE,EAAAwI,UAAAznB,WAAAzmD,EAAAymD,UACJif,EAAAqI,qBAIG,IAAAU,EAAI/I,EAAWgH,YACX,GAAA+B,GAAIzuE,6BAEJ,IAAIxT,EAAAiiF,EAAY9hF,MAEZ2mF,EAAY5N,EAAG0W,WACf1J,EAAAhN,EAAa2W,WAKjB,IAJI3J,EAAY,IACfY,GAAAZ,QAIDY,GAAmB,GAAKA,GAAa,EAErC,KAAAA,EAAA,GACAA,GAAA,EAGA,IAAA40G,GAFA50G,GAAc22G,WA5K1B,SAAAvkH,GAAA,IACwBplD,EAAAolD,EAAcplD,KAClC9gC,EAAO8gC,EAAK9gC,MAAiBC,EAAO6gC,EAAK7gC,qBAEzCs0J,EAAKzzH,EAAT4T,QAAAz0C,EACI2d,GAAI42I,EAAcjsJ,GAAIgsJ,QAEtB9wJ,EAAAxD,EAAWs0J,EAEf5pF,EAAAggI,EACAhgI,EAAS,GAAK/sD,EACd+sD,EAAS,GAAKpiE,SAEdoiE,EAAI,GAAAlnE,EAAJ,IAEIu5F,EAAa9W,EAAIyW,sDAErB/mD,EAASg3J,EAAO7sM,EAAA2B,KAAAC,IAAAD,KAAhBE,IAAA,EAAAo7F,EAAAj9F,GAAA,IAAA0D,EAAA8E,GAAAA,EAEAmiM,EAAS,GAAG/uM,EAAI+uM,EAAS,GAAG/uM,EAAIiiB,EAChC8sL,EAAS,GAAG/uM,EAAI+uM,EAAS,GAAG/uM,EAAI4a,kBAEhCm0L,EAAA,GAAW3qM,EAAA2qM,EAAX,GAAA3qM,EAAA0D,EAEIsnM,EAAAlvM,OAAgB,EACnB85C,IAAAg1B,EAAA,KACGogI,EAAO,IAAA,EAAa,IAEvBp1J,IAAAg1B,EAAA,KACGogI,EAAO,IAAA,EAAa,IAEvBn1J,IAAA+0B,EAAA,KACGogI,EAAO,IAAA,EAAa,IAEvBn1J,IAAA+0B,EAAA,KACJogI,EAAA,IAAA,EAAA,KA8Ie8B,CAAA3mH,GA1IZ,SAAkB1gE,GAClB,IAAI8mD,EAAA9mD,EAAcyhD,SAAlBjnE,0BAEI4oM,EAAJpjL,EAAA+kD,MAAYuiI,OAAA,EAAIxgL,OAAA,EACZs3I,OAAA,WAEAszB,EAAA0T,EAEAplL,EAAMklD,kBAENp+C,GAAMs8K,EAADjtM,EAAkBitM,EAAvB3oM,QAAAqsE,UAGAu3F,GAAA+kC,EAAkB7oM,EAAlB6oM,EAAA5oM,OAAAusE,EAEA2qH,EAAI,GAAKA,EAAI,GAAK4V,EAClB5V,EAAI,GAAKA,EAAI,GAAK5qK,EAVtB4qK,EAYK,GAAAA,EAAA,GAAArzB,EACDqzB,EAAA,GAAMA,EAAA,GAADtzB,YAGLt3I,GAAMs8K,EAADjtM,EAAkBitM,EAAvB5oM,OAAAssE,UAGAu3F,GAAA+kC,EAAkB7oM,EAAlB6oM,EAAA3oM,QAAAssE,EAEA2qH,EAAI,GAAKA,EAAI,GAAK4V,EAClB5V,EAAI,GAAKA,EAAI,GAAK5qK,EACrB4qK,EAAA,GAAAA,EAAA,GAAArzB,EACJqzB,EAAA,GAAAA,EAAA,GAAAtzB,GA8GempC,CAAAvsL,gCAGAwqL,EAAAL,EAAA,GAAAA,EAAA,GAAAA,EAAA,GAAAA,EAAA,GAAAiC,EAAA94G,EAAAZ,EAAA43G,GAGI,IADA,IAAAr0K,EAAI,EACCu2K,EAAU,EAAAA,EAAA,IAAAA,EAAA,CACX,IAAAh8J,EAAA+5J,EAAAiC,GACH,GAAAh8J,EAIG,GAAAkiD,GAAAu3G,EACAx7G,EAAAglE,WAAAx9H,EAAA,EACAo1K,EAAA7+L,EAAAypB,EAAAm2K,EAAAlC,EAAA15J,EAAA,IAAA05J,EAAA15J,EAAA,KACHva,GAAA,MAHG,CAOJ,IAAIw2K,EAAWvB,EAAYkB,EAAYlC,EAAZ15J,EAAA,KAC3Bk8J,EAAcxB,EAAdkB,EAAAlC,EAAA15J,EAAA,KACAk8J,EAAYD,IAAZC,GAAAzC,GACAwC,GAAAxC,EACAyC,GAASzC,EAED,IAAA,IAAA0C,EAAA,EAAAA,EAAA,IAAAA,EADJF,GAEWvE,IAEHuE,GAAYn5G,GACZ7E,EAAAglE,WAAAx9H,EAAA,EAGAo1K,EAAA7+L,EAAAypB,EAAAm2K,EAAAlC,EAAA15J,EAAA,IAFAk8J,GAAAxE,EAEAoC,EAAAkC,GAGJtC,EAAA15J,EAAA,KAEAva,GAAA,GACAy2K,GAEWp5G,IAEPo5G,GAAAxE,GACAz5G,EAAAglE,WAAwBx9H,EAAQ,EAH7Bo1K,EAKA7+L,EAAAypB,EAAAm2K,EAAA/B,EAAAmC,GAAAtC,EAAA15J,EAAA,KACHva,GAAA,IAEAw4D,EAAAglE,WAAwBx9H,EAAQ,EAEnCo1K,EAAA7+L,EAAAypB,EAAAm2K,EAAA/B,EAAAmC,GAAAlC,EAAAkC,IACJv2K,GAAA,KAIJw2K,GAAAxC,EACJyC,GAAAzC,GAIJx7G,EAAA+oG,YAAA/oG,EAAA8kC,YAAAt9F,EACJw4D,EAAAC,UAAAD,EAAAE,SAAA,IAIDonC,YACI,SAAaz0G,EAAO0b,GADxB,IAEIsD,EAAAhf,EAASgf,KACTjoB,EAAAioB,EAAa0wB,OAAKuyD,qBAElB90B,EAAAntE,EAAeorE,YAEnB48G,EAAmB3xK,EAAnB2xK,8BAEAvC,EAAAzmK,EAAA3I,EAAA82D,EAAAp2E,GAIC,IADG,IAAA+wL,EAAKzxK,EAAA0xK,OACRjuM,EAAA,EAAAA,EAAAqzF,EAAAglE,WAAAr4J,IACJguM,EAAAE,EAAAluM,GAAA8tM,EAAA9tM,6FCtTL,IAAAkqD,EAAiB/pD,EAAA,sDAGbwuC,UAAA,+BAGI,IAAA/pB,EAAA0lE,EAAAkK,aAIQ5vE,KACHA,EAAAsqD,WAAAhlB,GACGA,EAAiB02I,kBAAmBh8K,GAEvC0lE,EAAAwI,UAAAznB,WAAAzmD,EAAAymD,UACJif,EAAAqI,qBAIG,IAAAU,EAAI/I,EAAWgH,YACX+B,GAAKzuE,GACRyuE,EAAAC,WACJ7yF,KAAA64J,YAAAhvE,IAIDqwC,YACI,SAAcrwC,EADlB1oD,GAAA,IAEIxwB,EAAAk5E,EAAagH,YAFjB//E,MAGI2zB,EAAAolD,EAAcplD,qBAEdgL,EAAShL,EAAAsW,aAETjf,EAAAqF,EAAeisK,YACfE,EAAWxxK,EAAO4J,YAHtB,mBAKA2nK,EAAevxK,EAAfwxK,aAEAxxK,EAAA4qF,QAAA,EAAA,GACA,IAEIqqF,EAAOj1K,EAAOk1K,sBAElBzD,EAAAzxK,EAAA0xK,OAGAj/H,EAAKsb,EAAAkK,aAAoBxlB,GACzBwiI,EAAKzD,EAAe,GAAK/+H,EAAG,GAC5BwiI,EAAKzD,EAAe,GAAK/+H,EAAG,GAC5BwiI,EAAKzD,EAAe,GAApB/+H,EAA0B,GAC1BwiI,EAAKzD,EAAe,GAApB/+H,EAA0B,GAC1BwiI,EAAKzD,EAAe,IAAM/+H,EAAG,GAC7BwiI,EAAKzD,EAAe,IAAM/+H,EAAG,gBAE7BwiI,EAAIzD,EAAJ,IAAA/+H,EAAA,GAAA,IACI0iI,EAAKtgM,EADT,GACkBugM,EAAKvgM,EADvB,GAEIwgM,EAAKF,EAAM3xM,EAAG8xM,EAAKF,EAAM5xM,QAEzB+xM,EAAIH,EAAOxtM,EAAqBqF,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IACtBk7D,EAAKx7D,EAATa,IAAiB46D,EAAKz7D,EAAtBc,IACIihJ,EAAKzoL,EAAIooM,EAAItlC,EAAK9iK,EAAIqoM,EACtB7f,EAAKrlL,EAAIilM,EAAIG,EAAKplM,EAAIklM,EACtBr5J,EAAK5rC,EAAI48B,EAAIwoK,EAAKplM,EAAIklM,QAE1B1wM,EAAAyL,EAAAilM,EAGAN,EAAAzD,GAAA9b,EAAAz5I,EAAAkzD,EACA8lG,EAAKzD,EAAe,GAAK/b,EAAKigB,EAAKtmG,EAEnC6lG,EAAAzD,EAAA,GAAAzhC,EAAA9zH,EAAAkzD,EACA8lG,EAAKzD,EAAe,GAApBgE,EAA0BE,EAAAtmG,EAE1B6lG,EAAAzD,EAAA,IAAA9b,EAAA+f,EAAAtmG,EACA8lG,EAAKzD,EAAe,IAAM/b,EAAK5wL,EAAKuqG,gBAGpC6lG,EAAAzD,EAAA,IAAAgE,EAAA3wM,EAAAuqG,EAGAumG,EAAQnE,EAAe,GAAvB9wL,EACAi1L,EAAQnE,EAAe,GAAvB9wL,YAEAi1L,EAAAnE,EAAA,IAAA9wL,EAGA+wL,EAAKE,KAAkBJ,EACvBE,EAAKE,KAAkBJ,EAAW,EAClCE,EAAKE,KAAkBJ,EAAW,EAClCE,EAAKE,KAAkBJ,EAAW,EA1FzBE,EAAAE,KAAAJ,EAAA,EA6FbE,EAAAE,KAAYJ,EAAQ,GAEhBt7G,WAAA,SAAWlI,GACX,IAAA+I,EAAW/I,EAAX0O,oBAKJ,OAJI3F,EAAWglE,WAAX,EACAhlE,EAAO8kC,YAAP,EAlGS9kC,EAAA+oG,YAAA,EAAA/oG,GAsGTimE,YACI,SAAchvE,GADlB,IAEI+I,EAAO/I,EAAWgH,YAClBpsD,EAAKolD,EAAKplD,KAAO9zB,EAAKiiF,EAH1B9hF,MAIIioJ,EAAAt0H,EAAO9gC,MAAmBq1J,EAAAv0H,EAAO7gC,OACjCu0J,EAAA1zH,EALJ2T,QAAA2gH,EAKOb,EAAAzzH,EALP4T,QAAA2gH,EAKUz3I,OAAA,EAAGrV,OAAA,EACTgO,OAAA,EACA9S,OAAI,EACJ,GAAAyiF,EAAK+W,KACLr/E,GAAI42I,EACJjsJ,GAAIgsJ,EAJRh+I,EAMK6+I,EAAAZ,EACD/wJ,EAAI4xJ,EAAAd,MAAJ,CAAA,IACoC/zI,EAAK0lE,EAAM1gE,YAC3C8vI,EAAK90I,EAAMiqD,cAFfzqE,MAE4Bu1J,EAAK/0I,EAAMiqD,cAFvCxqE,OAGIu1J,EAAAh1I,EAAS+pD,MAAMvqE,MACfy1J,EAAAj1I,EAAS+pD,MAJbtqE,OAIsBw2B,EAASjW,EAAKgqD,QAChCx+D,EAAAopJ,EAAWE,EACXhpJ,EAAA+oJ,EAAYE,EACZzsE,EAAAryD,EAAa96B,GAAA25J,EAAYE,GAAD,EACxBu4C,EAAUt3K,EAAA96B,GAAY25J,EAADE,GAAzB,EAGA53I,EAAIkrE,EAAK98E,EAAYwoJ,EACrBjsJ,GAHekuB,EAAS12B,GAAxBw1J,EAAAE,GAAA,GAGSnpJ,EAALioJ,EACPh+I,EAAA6+I,EAAA24C,EAAA/hM,EAAAwoJ,OAHO/9H,EAAa12B,GAASw1J,EAA1BE,GAAA,OAOJzoJ,EAAA,GAAArR,EAAAiiB,EACA5Q,EAAA,GAAAjN,EAAAwI,WAMAyE,EAAA,GAAAjN,EAAW0D,EA3InBwrF,EAAAC,WAAA,2ECAA,IAAAppC,EAAiB/pD,EAAA,sDAGbwuC,UAHa,EAKT6jD,WAAA,SAAAlI,GACA,IAAA+I,EAAA/I,EAAA0O,oBAQJ,OALI3F,EAAWglE,WAAX,GAEAhlE,EAAO8kC,YAAP,GAXS9kC,EAAA+oG,YAAA,GAcb/oG,kCAGI,IAAAzuE,EAAA0lE,EAAA1gE,YAIQhF,KACHA,EAAAsqD,WAAAhlB,GACGA,EAAiB02I,kBAAmBh8K,GAEvC0lE,EAAAwI,UAAAznB,WAAAzmD,EAAAymD,UACJif,EAAAqI,qBAIG,IAAAU,EAAI/I,EAAYgH,YAChB+B,GAAAzuE,IACSyuE,EAALC,YAEH7yF,KAAA64J,YAAAhvE,GACJ7pF,KAAAssM,iBAAAziH,MAIDgvE,YACI,SAAOhvE,GADX,IAEI+I,EAAO/I,EAFXgH,YAGIlgF,EAAAiiF,EAHJ9hF,MAGwB2zB,EAAAolD,EAAcplD,KAClC9gC,EAAO8gC,EAAK9gC,MAAiBC,EAAO6gC,EAAK7gC,qBAEzCs0J,EAAAzzH,EAAQ4T,QAAOz0C,EAEfugB,EAAA0lE,EAAa1gE,YACbgnD,EAAYhsD,EAAM2pD,UAClBsC,EAAAjsD,EAAe4pD,wBAEfwC,EAAepsD,EAAA0pD,YAEf0rF,EAAS51J,EAASwsE,EAAYC,EAC9BopF,EAAS51J,EAAU0sE,EAAYC,EACnCkpF,EAAU91J,GAAAwsE,EAAiBC,GAC3BspF,EAAU91J,GAAA0sE,EAA0BC,GACpCkpF,EAAA9mJ,MAAe8mJ,IAAAA,EAAA,EAAuB,EAAAA,EACtCC,EAAA/mJ,MAAA+mJ,IAAgBA,EAAA,EAAA,EAAwBA,YAExCF,EAAaA,EAAb,EAAA,EAAAA,EAEA7oJ,EAAK,GAAGrR,GAAI64J,EACZxnJ,EAAK,GAAGjN,GAAIw0J,EACZvnJ,EAAK,GAAGrR,EAAI6wE,EAAYspF,EAAAtB,EACxBxnJ,EAAK,GAAGjN,EAAI6sE,EAAYmpF,EAAAxB,EACxBvnJ,EAAK,GAAGrR,EAAIqR,EAAA,GAAQrR,EAApBi6J,EACA5oJ,EAAK,GAAGjN,EAAIiN,EAAA,GAAAjN,EAAS81J,aAErB7oJ,EAAA,GAAAjN,EAAWE,EAAXs0J,EAGJtlE,EAxEaC,WAwEA,GAELqnC,YAAK,SAAArwC,EAAiB1oD,GACzBA,EAAAo1H,wCAED,IAEI3jE,EAAa/I,EAAOgH,cACbhH,EAAAplD,iBAEP9zB,EAAAiiF,EAAkB9hF,MAElBgrB,EAAAqF,EAAcisK,YACdE,EAAexxK,EAAO4J,YAH1B,EAIIgyF,EAAW9kC,EAAO8kC,6BAElB21E,EAAWvxK,EAAOwxK,aAEtB9+H,EAAeqb,EAAA1gE,YAAaqlD,SAE5B1yC,EAAA4qF,QAAAgR,EAAA9kC,EAAA+oG,aAOI,IANJ,IAEIoV,EAAOj1K,EAAOk1K,sBAElBzD,EAASzxK,EAAO0xK,OAERjuM,EAAA,EAAMA,EAAA,KAASA,EAAnB,YAEAs7L,EAAKrsH,EAALjvE,EAAuB,GAEvBwxM,EAAKzD,KAAkB54B,EAAvBp1K,EACAyxM,EAAKzD,KAAkB54B,EAAvBhxK,EACAqtM,EAAAzD,KAAAzS,EAA0B9kK,EAC7Bg7K,EAAAzD,KAAAzS,EAAArsK,WAIO,IAAA,IAAAtU,EAAI,EAAAA,EAAQ,IAAAA,EACZ,IAAA,IAAK/N,EAAA,EAAAA,EAAA,IAALA,EAAuB,CACvB,IAAAud,EAAK2jL,EAAkB,EAAAnzL,EAAQ/N,EAC/BohM,EAAKE,KAAkB/jL,EACvB6jL,EAAKE,KAAkB/jL,EAAQ,EAC/B6jL,EAAKE,KAAkB/jL,EAAQ,EAC/B6jL,EAAKE,KAAkB/jL,EAAQ,EAClC6jL,EAAAE,KAAA/jL,EAAA,EACJ6jL,EAAAE,KAAA/jL,EAAA,IAID4iL,iBACW,SAAOziH,GAQd,iBANAl5E,EAAAk5E,EAAcgH,YAAlB//E,MAEI2+B,EAAIhL,EAARsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IAC1Bk7D,EAASx7D,EAATa,IACI46D,EAAIz7D,EAAOc,IACNkgC,EAAI,EAAAA,EAAS,IAAlBA,EAEI,IADA,IAAAC,EAAI//D,EAAO8/D,GACPE,EAAA,EAAQA,EAAK,IAAIA,EAAJ,CACjB,IAAAC,EAAUjgE,EAAAggE,GACVw8H,EAAUx8L,EAAA,EAAa,EAAb8/D,EAAaE,GAC1Bw8H,EAAA7tM,EAAAsxE,EAAAtxE,EAAAyJ,EAAA2nE,EAAAhtE,EAAAyI,EAAA8+F,EACJkiG,EAAAzpM,EAAAktE,EAAAtxE,EAAA4M,EAAAwkE,EAAAhtE,EAAA0I,EAAA8+F,4ECzIT,IAAAzhD,EAAiB/pD,EAAA,sDAGbwuC,UAAA,EAEAo/J,aALa,aAObqE,YAPa,EASZ5/G,WATY,SAAAlI,GAWb,OAAAA,EAXa0O,kDAcT,IAAAp0E,EAAA0lE,EAAA1gE,YAIQhF,KACHA,EAAAsqD,WAAAhlB,GACGA,EAAiB02I,kBAAmBh8K,GAEvC0lE,EAAAwI,UAAAznB,WAAAzmD,EAAAymD,UACJif,EAAAqI,yCAOD,GAAI/tE,GAAOyuE,IAAXA,EAAAE,SAAAF,EAAAC,WAAA,CAAA,IAEIpuD,EAAAolD,EAAAplD,KACAmpK,EAAYvoM,KAALuK,IAAe60B,EAAA9gC,OACtBkqM,EAAYxoM,KAALuK,IAAe60B,EAAA7gC,sBAEtBs0J,EAAOzzH,EAAA4T,QAAXw1J,EAEIjrM,EAAAuhB,EAAa+pD,MACb4pF,EAAUl1J,EAAAe,MACVk0J,EAAUj1J,EAAAgB,OACVguM,EAAMhE,EALV91C,EAMI+5C,EAAMhE,EANVh2C,iBAQIlnF,EAAAtrE,KAAOogJ,KAAAmsD,aAGXh/G,EAASglE,WAATvyJ,KAAAE,IAA+B,EAAAkrE,EAAA,EAAAE,EAAA,GAE9B,IAAA,IAAApxE,EAAA,EAAAA,GAAAoxE,IAAApxE,EACDoR,EAASpR,GAAAD,EAAT+F,KAAgBC,IAAKwyJ,EAAUv4J,EAAAquM,GAAAz1C,EAE9B,IAAA,IAAApzI,EAAA,EAAAA,GAAA0rD,IAAA1rD,2BAKD6tE,EAAW8kC,YAAUjnD,EAArBE,EAAA,EACAiiB,EAAW+oG,YAAYlrH,EAAvBE,EAAA,EA1DSiiB,EAAAE,SAAA,EA6DbF,EA7DaC,WA6DC,IACVq4G,aAAwB,SAAxB6F,EAAAzD,EAAA79J,EAAAghC,EAAAE,EAAAhgE,GAMI,IANJ,IAAoC5H,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,YAEtBm7D,EAAAz7D,EAAJc,IAAWjxC,OAAA,EAAGwa,OAAA,EACdpW,OAAK,EACDqW,OAAI,EACC+3L,EAAK,EAAAC,EAAVthI,EAAAqhI,EAAAC,IAAAD,EAAA,CACApuM,EAAAiN,EAASmhM,GAAApuM,EACLqW,EAAApJ,EAAImhM,EAAA,GAAJpuM,EACA,IAAA,IAAKsuM,EAAK,EAAAC,EAAVthI,EAAAqhI,EAAAC,IAAAD,WAEAl4L,EAAAnJ,EAAAqhM,EAAA,GAAA1yM,EAIAyxM,EAAAzD,GAAAhuM,EAAAyJ,EAAArF,EAAAyI,EAAA8+F,EACA8lG,EAAKzD,EAAa,GAAKhuM,EAAA4M,EAAAxI,EAAS0I,EAAT8+F,EAEvB6lG,EAAAzD,EAAA,GAAAxzL,EAAA/Q,EAAArF,EAAAyI,EAAA8+F,EACA8lG,EAAKzD,EAAa,GAAlBxzL,EAA4B5N,EAAIxI,EAAA0I,EAAR8+F,EAExB6lG,EAAAzD,EAAA,IAAAhuM,EAAAyJ,EAAAgR,EAAA5N,EAAA8+F,EACA8lG,EAAKzD,EAAa,IAAMhuM,EAAA4M,EAAA6N,EAAS3N,EAAT8+F,oBAGxB6lG,EAAAzD,EAAA,IAAAxzL,EAAA5N,EAAA6N,EAAA3N,EAAA8+F,EAEPoiG,GAAA,KAIDpzE,YACI,SAAWrwC,EAAK1oD,GADpB,IAEIsD,EAAAolD,EAAaplD,KACbwzB,EAAAxzB,EAAawzB,SACbz7C,EAAOioB,EAAA0wB,OAAWuyD,qBAEtB/2G,EAAAiiF,EAAA9hF,MAGIgrB,EAAAm8B,EAAe92B,EAAOgtK,cAF1BhtK,EAAAisK,YAGIE,EAAWxxK,EAAO4J,YAHtB,mBAKA2nK,EAAevxK,EAAAwxK,aAEfxxK,EAAA4qF,QAAA9zB,EAAA8kC,YAAA9kC,EAAA+oG,aACA,IAEIoV,EAAOj1K,EAAOk1K,sBAEdzD,EAAAzxK,EAAU0xK,OAEVx/H,EAAO6b,EAAO1gE,YAAYklD,SAC1BE,EAAAsb,EAAA1gE,YAAwBolD,GACxB3rE,EAAAinF,EAAA1gE,YAAyB+kD,MACzB0/H,EAAUvoM,KAAAuK,IAAA60B,EAAe9gC,OACzBkqM,EAAUxoM,KAAAuK,IAAA60B,EAAgB7gC,QAC1BguM,EAAMhE,EAAVhrM,EAAAe,MACIkuM,EAAMhE,EADVjrM,EAAAgB,sBAGI+sE,EAAAtrE,KAASogJ,KAAKmsD,GAElBniK,EAAKhL,EAAasW,aAElB/6C,KAAIkrM,aAAc6F,EAAAzD,EAAlB79J,EAAAghC,EAAAE,EAAAhgE,GAKI,IALJ,IAA0DypB,EAAAp6B,KAAcstM,aACpE4E,EAAUlyM,KAAdkyM,SAAsBP,EAAU3xM,KAAO2xM,YAAGQ,EAAU/3K,EAAUg4K,EAAiB,EAAPh4K,EACpEi4K,EAAJ,EAAIj4K,EAAOk4K,EAAX,EAAWl4K,EACXm4K,OAAS,EACLC,OAAQ,EACHV,EAAI,EAAAC,EAAYthI,EAAUqhI,EAAKC,IAApCD,EAAwD,CACpDU,EAAAntM,KAAQC,IAAK,EAALusM,EAAYC,4BAEpBS,EAAIltM,KAAAC,IAAA,EAAgBssM,EAAAI,GAEpB,IAAAS,EAAAnF,EAAA4E,EACIQ,EAASD,EAAA,EAETzkI,GAEA+iI,EAAA0B,GAAAlkI,EAAA,GACAwiI,EAAK2B,GAAcnkI,EAAA,GAEnBwiI,EAAA0B,EAAAN,GAAA5jI,EAAA,GACAwiI,EAAK2B,EAAcP,GAAW5jI,EAAG,IAAMA,EAAG,GAAKA,EAAG,IAAMgkI,EAExDxB,EAAA0B,EAAAL,GAAA7jI,EAAA,IAAAA,EAAA,GAAAA,EAAA,IAAAikI,EACAzB,EAAK2B,EAAcN,GAAW7jI,EAAA,GAXlCwiI,EAcK0B,EAAAJ,GAAAtB,EAAA0B,EAAAL,GACDrB,EAAA2B,EAAAL,GAAAtB,EAAA2B,EAAAP,KAGApB,EAAA0B,GAAAlkI,EAAA,GACAwiI,EAAK2B,GAAcnkI,EAAA,GAEnBwiI,EAAA0B,EAAAN,GAAA5jI,EAAA,IAAAA,EAAA,GAAAA,EAAA,IAAAgkI,EACAxB,EAAK2B,EAAcP,GAAW5jI,EAAG,GAEjCwiI,EAAA0B,EAAAL,GAAA7jI,EAAA,GACAwiI,EAAK2B,EAAcN,GAAW7jI,EAAA,IAAKA,EAAA,GAAAA,EAAA,IAAcikI,EAEpDzB,EAAA0B,EAAAJ,GAAAtB,EAAA0B,EAAAN,GACDpB,EAAA2B,EAAAL,GAAAtB,EAAA2B,EAAAN,IAGAX,EAAQnE,EAAaqE,GAAYn1L,EACjCi1L,EAAQnE,EAAaqE,EAAYQ,GAAW31L,EAC5Ci1L,EAAAnE,EAAAqE,EAAAS,GAAA51L,EACHi1L,EAAAnE,EAAAqE,EAAAU,GAAA71L,EACJ8wL,GAAAgF,GAMG,IADA,IAAA9yM,EAAKozF,EAAL+oG,YACKp8L,EAAA,EAAAA,EAAAC,EAAkBD,GAAA,EACvBguM,EAAKE,KAAkBJ,EACvBE,EAAKE,KAAkBJ,EAAS,EAChCE,EAAKE,KAAkBJ,EAAS,EAChCE,EAAKE,KAAkBJ,EAAS,EAChCE,EAAAE,KAAAJ,EAAA,EACHE,EAAAE,KAAAJ,EAAA,EACJA,GAAA,2ECzLL,IAAMhvL,EAAA3e,EAAA,sDAEAizM,EAANjzM,EAAA,eAAAizM,0BAEAtxK,EAAOzhC,GAAP0hC,MAAoBD,KAEZliC,EAAAE,QAAIgf,EAAO2qC,OAAXsjJ,iBACW,SAAOziH,GAKd,iBAHAl5E,EAAAk5E,EAAcgH,YAAlB//E,MAEI2+B,EAAIhL,EAAQsW,aACRx7C,EAAA,EAAQA,EAAA,EAAZA,IAAA,CACA,IAAA2tM,EAAKv8L,EAAApR,EAAc,GACtB4tM,EAAAx8L,EAAApR,GAViB8hC,EAAAwS,cAAAs5J,EAAAD,EAAAz9J,KAedyqF,YAAK,SAAArwC,EAAiB1oD,GACzBA,EAAAo1H,wCAGD,IAEIz6H,EAAAqF,EAAkBgtK,+BAElBd,EAAOvxK,EAAXwxK,sBAGAqF,EAAAluK,EAAA3I,EAAA+tD,EAAAgH,YAAApsD,EAAA0wB,OAAAuyD,MAGA,IAAA6lF,EAAKzxK,EAAA0xK,OACLD,EAAKE,KAAkBJ,EACvBE,EAAKE,KAAkBJ,EAAW,EAClCE,EAAKE,KAAkBJ,EAAW,EAClCE,EAAKE,KAAkBJ,EAAW,EACrCE,EAAAE,KAAAJ,EAAA,EACFE,EAnCHE,KAAAJ,EAAA,0GCJA,IAAMhvL,EAAA3e,EAAA,gDAEAizM,EAANjzM,EAAA,eAAAizM,0CAGAC,EAAAvxK,EAAoByL,SAEZ3tC,EAAAE,QAAIgf,EAAO2qC,OAAXsjJ,iBACI,SAAoBziH,GAMpB,IAPJ,IAEIplD,EAAOolD,EAAAplD,qBAEP9zB,EAAAiiF,EAAc9hF,MAEd2+B,EAAIhL,EAAQsW,aACRx7C,EAAA,EAAQgiB,EAAAqxE,EAAZ8kC,YAAAn4H,EAAAgiB,EAAAhiB,IAAA,CACA,IAAA2tM,EAASv8L,EAAApR,EAAWgiB,GACpB4rL,EAAKx8L,EAAApR,GACR8hC,EAAAvV,IAAA8mL,EAAA1F,EAAA5tM,EAAA4tM,EAAAxpM,EAAA,GAZiB29B,EAAAwS,cAAAs5J,EAAAyF,EAAAnjK,KAiBlByqF,YAAK,SAAUrwC,EAAA1oD,GACX,IAAAmtC,EAAAub,EAAA1gE,YAAAmlD,SACH,GAAAA,EAAA,CAKAntC,EAAAo1H,wCAGD,IAEIz6H,EAAAqF,EAAkBgtK,+BAElBd,EAAOvxK,EAAXwxK,sBAGAqF,EAAAluK,EAAA3I,EAAA+tD,EAAAgH,YAAApsD,EAAA0wB,OAAAuyD,MAKC,IAFD,IAAA6lF,EAASzxK,EAAO0xK,OACZE,EAAKp/H,EAALo/H,UACHnuM,EAAA,EAAAgiB,EAAAmsL,EAAAluM,OAAAD,EAAAgiB,EAAAhiB,IACJguM,EAAAE,KAAAJ,EAAAK,EAAAnuM,sGC7CL,IAAM8e,EAAA3e,EAAA,yDAEN0rM,EAAoB1rM,EAAM,eAAA0rM,eAElBjsM,EAAAE,QAAWgf,EAAK2qC,OAAhBkxE,YACI,SAAaz0G,EAAO0b,GADxB,IAEIsD,EAAAhf,EAASgf,KACTjoB,EAAAioB,EAAa0wB,OAAKuyD,uBAElB90B,EAAAntE,EAAeorE,YAEnB48G,EAAA3xK,EAAqB2xK,8BAErBrC,EAAA3mK,EAAA3I,EAAA82D,EAAAp2E,GAIC,IADG,IAAA+wL,EAAKzxK,EAAA0xK,OACRjuM,EAAA,EAAAA,EAAAqzF,EAAAglE,WAAAr4J,IACJguM,EAAAE,EAAAluM,GAAA8tM,EAAA9tM,6GClBL,IAAM8e,EAAA3e,EAAU,kDAEhB2hC,EAAOzhC,GAAP0hC,MAAoBD,KAEZliC,EAAAE,QAAIgf,EAAA2qC,OACJkxE,YAAS,WAER,IADG,IAAA24E,KACHtzM,EAAA,EAAAA,EAAA,EAAAA,IACDszM,EAAOntM,KAAU27B,EAAQyL,UACrB,OAAA,SACW+8C,EAAO1oD,GADlB,IAEIxwB,EAAAk5E,EAAagH,YAFjB//E,MAGI2zB,EAAAolD,EAAcplD,qBAEdgL,EAAShL,EAAAsW,aAETjf,EAAAqF,EAAegtK,cACfb,EAAWxxK,EAAO4J,YAHtB,mBAKA2nK,EAAevxK,EAAfwxK,aAEAxxK,EAAA4qF,QAAA,EAAA,GACA,IAEIqqF,EAAOj1K,EAAOk1K,sBAEdzD,EAAAzxK,EAAQ0xK,OACZyD,EAAStgM,EAAA,GACTugM,EAASvgM,EAAA,GACT0wB,EAAKvV,IAAI+mL,EAAW,GAAI5B,EAAM3xM,EAAG2xM,EAAMvtM,EAAG,GAC1C29B,EAAKvV,IAAI+mL,EAAW,GAAI3B,EAAM5xM,EAAG2xM,EAAMvtM,EAAG,yBAE1C29B,EAAAvV,IAAA+mL,EAAA,GAAA3B,EAAA5xM,EAAA4xM,EAAAxtM,EAAA,GAII,IADA,IAAA6qE,EAAAsb,EAAAkK,aAAAxlB,GACIxpD,EAAA,EAASA,EAAA,EAAAA,IAAb,YAGAsc,EAAKwS,cAALi/J,EAAuBA,EAAvBrjK,GAEAshK,EAAKzD,KAAkBwF,EAAOxzM,aAE9ByxM,EAAAzD,KAAAwF,EAAA1pK,EAGA,IAAA8oK,EAAA,EAAKntL,gBAELgsL,EAAAzD,KAAA/+H,EAAA,EAAA2jI,YAOJ3E,EAAKE,KAAkBJ,EACvBE,EAAKE,KAAkBJ,EAAW,EAClCE,EAAKE,KAAkBJ,EAAW,EAClCE,EAAKE,KAAkBJ,EAAW,EAlDtCE,EAAAE,KAAAJ,EAAA,EALSE,EAAAE,KAAAJ,EAAA,GAEA,0HCJXx7G,EAAUnyF,EAAhB,gCAGAkzM,EAAAvxK,EAAoByL,SAEZ3tC,EAAAE,QAAIgf,EAAA2qC,OACAkxE,YAAK,SAAArwC,EAAiB1oD,GACzBA,EAAAo1H,wCAED,IAEI3jE,EAAW/I,EAAKgH,YAChBpsD,EAAAolD,EAAaplD,KACbwzB,EAAOxzB,EAAAwzB,yBAEPtnD,EAAAiiF,EAAS9hF,MAETgrB,EAAAm8B,EAAc92B,EAAWgtK,cAF7BhtK,EAAAisK,YAGIE,EAAexxK,EAAO4J,YAH1B,EAIIgyF,EAAW9kC,EAAO8kC,6BAElB21E,EAAWvxK,EAAOwxK,aAEtB9+H,EAAeqb,EAAA1gE,YAAaqlD,SAE5B1yC,EAAA4qF,QAAAgR,EAAA9kC,EAAA+oG,aAOI,IANJ,IAEIoV,EAAOj1K,EAAOk1K,sBAElBzD,EAASzxK,EAAO0xK,OAERjuM,EAAA,EAAMA,EAAA,KAASA,EAAnB,YAEAs7L,EAAKrsH,EAALjvE,EAAuB,GAEvBwxM,EAAKzD,KAAkB54B,EAAKp1K,EAC5ByxM,EAAKzD,KAAkB54B,EAAvBhxK,EACAqtM,EAAKzD,KAAkB54B,EAAvBtrI,EACA2nK,EAAAzD,KAAAzS,EAA0B9kK,EAC7Bg7K,EAAAzD,KAAAzS,EAAArsK,WAIO,IAAA,IAAAtU,EAAI,EAAAA,EAAQ,IAAAA,EACZ,IAAA,IAAK/N,EAAA,EAAAA,EAAA,IAALA,EAAuB,CACvB,IAAAud,EAAK2jL,EAAkB,EAAAnzL,EAAQ/N,EAC/BohM,EAAKE,KAAkB/jL,EACvB6jL,EAAKE,KAAkB/jL,EAAQ,EAC/B6jL,EAAKE,KAAkB/jL,EAAQ,EAC/B6jL,EAAKE,KAAkB/jL,EAAQ,EAClC6jL,EAAAE,KAAA/jL,EAAA,EACJ6jL,EAAAE,KAAA/jL,EAAA,IAID4iL,iBACW,SAAOziH,GAKd,iBAHAl5E,EAAAk5E,EAAcgH,YAAlB//E,MAEI2+B,EAAIhL,EAAOsW,aACN01B,EAAI,EAAAA,EAAS,IAAlBA,EAEI,IADA,IAAAC,EAAI//D,EAAO8/D,GACPE,EAAA,EAAQA,EAAK,IAAIA,EAAJ,YAEjBw8H,EAASx8L,EAAA,EAAT,EAAoB8/D,EAAQE,GAE/BtvC,EAAAvV,IAAA8mL,EAAAhiI,EAAAtxE,EAAAoxE,EAAAhtE,EAAA,GACJ29B,EAAAwS,cAAAs5J,EAAAyF,EAAAnjK,sFCtET,IAAMpxB,EAAA3e,EAAU,iDAEhB2hC,EAAOzhC,GAAP0hC,MAAoBD,KAEhBliC,EAAAE,QAFsBgf,EAAA2qC,OAGtBskJ,aAHsB,aAKtBqE,YAAA,EAEIzG,aAAS,WAER,IADG,IAAA2H,KACHtzM,EAAA,EAAAA,EAAA,EAAAA,IACDszM,EAAOntM,KAAU27B,EAAMyL,UACnB,OAAA,SAAOikK,EAAPzD,EAAA79J,EAAAghC,EAAAE,EAAAhgE,GAGI,IAHJ,IAAWrR,OAAA,EAAGwa,OAAA,EACdpW,OAAK,EACDqW,OAAI,EACC+3L,EAAK,EAAAC,EAAVthI,EAAAqhI,EAAAC,IAAAD,EAAA,CACApuM,EAAAiN,EAASmhM,GAAApuM,EACLqW,EAAApJ,EAAImhM,EAAA,GAAJpuM,EACA,IAAA,IAAKsuM,EAAK,EAAAC,EAAVthI,EAAAqhI,EAAAC,IAAAD,EAAA,UAEAl4L,EAAKnJ,EAAIqhM,EAAA,GAAT1yM,EAEA+hC,EAAKvV,IAAI+mL,EAAW,GAAIvzM,EAAGoE,EAA3B,GACA29B,EAAKvV,IAAI+mL,EAAW,GAAI/4L,EAAIpW,EAA5B,qBAEA29B,EAAKvV,IAAI+mL,EAAO,GAAhB/4L,EAAuBC,EAAM,GAEzB,IAAA,IAAKgL,EAAA,EAAAA,EAAL,EAAmBA,IAAA,CACnB,IAAI6tL,EAASC,EAAb9tL,GACAsc,EAAKwS,cAAA++J,EAAyBA,EAA9BnjK,GACA,IAAArV,EAAK,EAAArV,EACLgsL,EAAKzD,EAAelzK,GAApBw4K,EAAkCtzM,EACrCyxM,EAAAzD,EAAAlzK,EAAA,GAAAw4K,EAAAlvM,eAIR4pM,GAAA,MA5BI,mFCTjB,IAAMxjH,EAAApqF,EAAa,4CAGb+2F,EAAA3M,EAAA2M,SAEAs8G,EAAkBrzM,EAAQ,eAC1BszM,EAAAtzM,EAAyB,eACzBuzM,EAAAvzM,EAAsB,cACtBwzM,EAAyBxzM,EAAA,6CAEzByzM,EAAAzzM,EAAqB,aAErB0zM,EAAoB1zM,EAAQ,eAC5B2zM,EAAA3zM,EAA2B,eAC3B4zM,EAAA5zM,EAAwB,cACxB6zM,EAA2B7zM,EAAA,6CAEjC8zM,EAAA9zM,EAAA,aAIQssM,4BAEA,IAAI/zI,EAAO4xB,EAAWplD,KAAAwzB,SAElBw7I,EAAKx7I,EAAWm7I,EAAhBL,EACI,OAAAlpH,EAAOnhE,MACP,KAAAk3E,EAAAxC,OACJq2G,EAAKx7I,EAALo7I,EAAAL,EACI,MACA,KAAApzG,EAAAE,MACJ2zG,EAAKx7I,EAALq7I,EAAAL,EACI,MACI,KAAArzG,EAAO3J,OAGPw9G,EAJJ5pH,EAGKwW,YAAA5J,EAAAC,OACMz+B,EAAWs7I,EAAwBL,EAE9Cj7I,EAAAy7I,EAAAC,EAEA,MACA,KAAA/zG,EAAAG,KAjBR0zG,EAAAx7I,EAAAu7I,EAAAL,YA0BHhhH,iBAAA,SAAAtI,GA/BL,OAAAA,EAAAmO,iBAoCAlO,EAAO18C,WAAU4+J,gBCjFjB4H,kCAAA,GAAAC,kBAAA,IAAAC,YAAA,IAAAC,qBAAA,IAAAC,cAAA,IAAAC,cAAA,IAAAC,aAAA,IAAAC,kBAAA,IAAAC,YAAA,IAAAC,qBAAA,IAAAC,cAAA,IAAAC,cAAA,IAAAC,aAAA,MAAAC,KAAA,SAAA/0M,EAAAP,EAAAE,uBAGAuzM,EAASvxK,EAATyL,SA+FI3tC,EAAAE,SACA6rM,aA/FA,SACIzmK,EAAe3I,EAAO82D,EAD1Bp2E,iBAGI8wL,EAAcxxK,EAAA4J,YAAlB,kBAGA5J,EAAA4qF,QAAAgR,EAAA9kC,EAAA+oG,aASI,mBALA8V,EAAS31K,EAAK44K,WACEjlK,EAAIhL,EAAxBsW,aAAoChyC,EAAI0mC,EAAOC,IAAKxjC,EAAIujC,EAAOE,IAC3DxjC,EAAAsjC,EAAKK,IAAY1jC,EAAAqjC,EAAKM,IAC1Bk7D,EAASx7D,EAAOa,IACZ46D,EAAIz7D,EAAOc,IACNhxC,EAAA,EAAAA,EAAAm4H,EAAkBn4H,IAAA,CACvB,IAAAm1K,EAAK/jK,EAAApR,GACLwxM,EAAKzD,KAAkB54B,EAAKp1K,EAA5ByJ,EAAA2rK,EAAAhxK,EAAAyI,EAAA8+F,EACA8lG,EAAKzD,KAAkB54B,EAAKp1K,EAA5B4M,EAAAwoK,EAAAhxK,EAAA0I,EAAA8+F,EACA6lG,EAAAzD,KAAA54B,EAA0B3+I,EAC7Bg7K,EAAAzD,KAAA54B,EAAAlmJ,EACJijL,EAAAnE,KAAA9wL,IA2EG4uL,eAxEA,SACmB3mK,EAAO3I,EAAA82D,EAD1Bp2E,iBAGI8wL,EAAcxxK,EAAA4J,YAAlB,kBAGA5J,EAAA4qF,QAAAgR,EAAA9kC,EAAA+oG,aAQI,mBAJA8V,EAAS31K,EAAK44K,WAElBjlK,EAAahL,EAAGsW,aAEPx7C,EAAI,EAAAA,EAAAm4H,EAAmBn4H,IAA5B,CACA,IAAAm1K,EAAK/jK,EAAApR,GACL8hC,EAAKvV,IAAA8mL,EAALl+B,EAAuBp1K,EAAAo1K,EAAUhxK,EAAjC,GACA29B,EAAKwS,cAAL++J,EAAuBA,EAAvBnjK,GACAshK,EAAKzD,KAAkBsF,EAAUtzM,EACjCyxM,EAAKzD,KAAkBsF,EAAvBlvM,EACAqtM,EAAKzD,KAAkBsF,EAAvBxpK,EACA2nK,EAAAzD,KAAA54B,EAA0B3+I,EAC7Bg7K,EAAAzD,KAAA54B,EAAAlmJ,EACJijL,EAAAnE,KAAA9wL,IA6CD4vL,wBA1CI,SAC0B3nK,EAAA3I,EAD1B82D,EAAAp2E,iBAGI8wL,EAAcxxK,EAAA4J,YAAlB,kBAGA5J,EAAA4qF,QAAAgR,EAAA9kC,EAAA+oG,aAMI,mBAFJ8V,EAAA31K,EAAoB44K,WAEXn1M,EAAA,EAAAA,EAAAm4H,EAALn4H,IAAA,CACA,IAAAm1K,EAAK/jK,EAAApR,GACLwxM,EAAKzD,KAAkB54B,EAAKp1K,EAC5ByxM,EAAKzD,KAAkB54B,EAAKhxK,EAC5BqtM,EAAAzD,KAAA54B,EAA0B3+I,EAC7Bg7K,EAAAzD,KAAA54B,EAAAlmJ,EACJijL,EAAAnE,KAAA9wL,8BAGG,SAC0BioB,EAAP3I,EADnB82D,EAAAp2E,iBAGI8wL,EAAcxxK,EAAA4J,YAAlB,kBAGA5J,EAAA4qF,QAAAgR,EAAA9kC,EAAA+oG,aAMI,mBAFJ8V,EAAA31K,EAAoB44K,WAEXn1M,EAAA,EAAAA,EAAAm4H,EAALn4H,IAAA,CACA,IAAAm1K,EAAK/jK,EAAApR,GACLwxM,EAAKzD,KAAkB54B,EAAKp1K,EAC5ByxM,EAAKzD,KAAkB54B,EAAKhxK,EAC5BqtM,EAAKzD,KAAkB54B,EAAKtrI,EAC5B2nK,EAAAzD,KAAA54B,EAA0B3+I,EAC7Bg7K,EAAAzD,KAAA54B,EAAAlmJ,EACJijL,EAAAnE,KAAA9wL,UC9FKm4L,KAAM,SAAAj1M,EAAZP,EAAAE,OAEI+hC,wBAAgBA,IAEhBwzK,EAFsBh1M,GAEhBE,OACFb,KAAA,gBACAc,KAAA,SAAKohC,EAALs2F,GACAz3H,KAAK60M,UAAL,EACA70M,KAAK0lC,WAAL,EACA1lC,KAAK80M,YAAc,EACnB90M,KAAKytM,aAAe,qBAEpBztM,KAAKstM,aAAL,uBAGAttM,KAAK+0M,aAAc/0M,KAAAi4F,cACf2/B,OAOJ53H,KAAKg1M,IAAM,IAAI5zK,EAAIoG,aACfrG,EAASwqC,QACT8rD,EAAIr2F,EAAAy2F,cACA,IAHGzhF,YAIH,GAIRp2C,KAAKi1M,IAAL,IAAc7zK,EAAd4G,YAAA7G,EAAAwqC,QAAAvqC,EAAAo3F,iBAAAp3F,EAAAsG,aAAA,IAAA0O,YAAA,GAEAp2C,KAAKgxM,OAAA,sBAELhxM,KAAK00M,WAAY,KAEjB10M,KAAKk1M,UAAA/zK,oCAGLnhC,KAAKm1M,gBAAL,KAGJn1M,KAAAo1M,kBAEQC,WAAA,WACH,GAAA,IAAAr1M,KAAA0lC,YAAA1lC,KAAAqgM,OAAA,iEAMGiV,EAAJ,IAAA/yK,YAAAviC,KAAAwtM,OAAA1xK,OAAA,EAAA97B,KAAAytM,uBAGA5sM,OAAS,EAAA00M,YAGT10M,OAAK,EAALy0M,GAGJt1M,KAAAqgM,QA3DsB,IA6DlBmV,cAAI,SAAe99E,EAAKikE,6CAEpB8R,EAAaztM,KAAKytM,aAAtB9R,EAEI50J,EAAa/mC,KAAAgxM,OAAbjqK,WACA0uK,EAAOz1M,KAAawtM,OAAAhuM,OAChB,GAAAkmC,EAAKqB,GAAL0mK,EAAAgI,EAAA,CACA,KAAA1uK,EAAKrB,GAAL+vK,EAAAhI,2BAEAztM,KAAAm1M,iBAAkB,EAErBpuK,EAAA,EAAA/mC,KAAA01M,kFAQL11M,KAAKytM,cAAa9R,EAElB37L,KAAK0lC,WAALA,EAGJ1lC,KArFsBqgM,QAAA,GAuFd35E,QAAA,SAAKgR,EAALikE,GACA37L,KAAKk1M,UAAU/4K,UAAUn8B,OAC5BA,KAAAk1M,UAAA/6E,sCAKLn6H,KAAAw1M,cA9FsB99E,EA8FJikE,IAEdyZ,eAAK,WAhGap1M,KAAA21M,eAAA,GAmGtB31M,KAAA41M,eAnGsB,IAqGlBD,cAAS,SAAQE,GACb,IAAAC,OAAW,EACd91M,KAAAgxM,+CAIDhxM,KAAIgxM,OAAU,IAAInuK,aAAW7iC,KAAK01M,qEAElC,IAAIK,EAAA,IAAY5zK,WAAaniC,KAAA00M,WAAA54K,QAErB,GAAAg6K,GAAQD,EACX,IAAA,IAAAt2M,EAAA,EAAAgiB,EAAAu0L,EAAAt2M,OAAAD,EAAAgiB,EAAAhiB,IACJw2M,EAAAx2M,GAAAu2M,EAAAv2M,GAKLS,KAAAg1M,IAtHsBp9E,OAAA53H,KAsHPgxM,OAAAjqK,sCAGX,IAAAivK,EAAch2M,KAAIwtM,OAId,GAFJxtM,KAAIwtM,OAAA,IAAYjrK,YAAaviC,KAAAm1M,iBAEzBa,GAASH,EAER,IADG,IAAAI,EAAAj2M,KAAWwtM,OACdjuM,EAAA,EAAAgiB,EAAAy0L,EAAAx2M,OAAAD,EAAAgiB,EAAAhiB,IACJ02M,EAAA12M,GAAAy2M,EAAAz2M,GAKLS,KArIsBi1M,IAAAr9E,OAqIb53H,KAAAwtM,OAAAzmK,YAEL8Q,MAAA,WACA73C,KAAK60M,UAAL,EACA70M,KAAK0lC,WAAL,EACA1lC,KAAK80M,YAAc,EACnB90M,KAAKytM,aAAe,EACpBztM,KAAKk2M,YAAL,EA5IkBl2M,KAAAstM,aAAA,EA+ItBttM,KA/IsBqgM,QAAA,GAiJlB5lK,QAAK,WACRz6B,KAAAi1M,IAAAx6K,UAlJLz6B,KAAAg1M,IAAAv6K,uFCDA,IAAIm6K,EAAal1M,EAAA,iBAEby2M,EAASv2M,GAAAE,4BAETyB,QAAAqzM,EAEIwB,gBAAa,WAGT,IAFJ,IAAAzwK,EAAS3lC,KAAOm1M,gBAAhB,EACIr5K,EAAI97B,KAAAwtM,OACJjuM,EAAO,EAAPu3C,EAAgB,EAAAv3C,EAAhBomC,EAAApmC,IAAA,CACA,IAAA82M,EAAgB,EAAA92M,EAChBu8B,EAAOgb,KAASu/J,EAChBv6K,EAAOgb,KAASu/J,EAAU,EAC1Bv6K,EAAOgb,KAASu/J,EAAU,EAC1Bv6K,EAAOgb,KAASu/J,EAAU,EAC7Bv6K,EAAAgb,KAAAu/J,EAAA,aAfiB,IAAAf,EAAA,IAAA/yK,YAAAviC,KAAAwtM,OAAA1xK,OAAA,EAAA,EAAA6J,GAqBtB3lC,KAAAi1M,IArBsBp0M,OAAA,EAAAy0M,IAuBdD,WAAA,WACH,GAAA,IAAAr1M,KAAA0lC,YAAA1lC,KAAAqgM,OAAA,iEAMDrgM,KAAKg1M,IAAAn0M,OAAS,EAAd00M,GAGJv1M,KAAAqgM,QAjCsB,IAmClB+U,eAAK,WACLp1M,KAAK21M,eAAA,GACR31M,KAAA41M,gBArCL51M,KAAAo2M,4FCyBA,IAAMl1K,EAAAxhC,EAAsB,oBACtB+3H,EAAS/3H,EAAa,mBACtB42M,EAAiB7+E,EAAQ8+E,eACzBC,EAAA/+E,EAAsB++E,OACtB7K,EAAajsM,EAAQ,qBACrB+pD,EAAqB/pD,EAAA,kCACrBm6C,EAAan6C,EAAQ,uCAEvBk1M,EAAAl1M,EAAmB,iBAEjBoiE,EAAc,IAAApiE,EAAa,+BAAb,CAApB,iCAGI2pC,EAAJnI,EAAAmI,eAEMhF,sBAGNoyK,EAAIliH,aAEA,IAAA6hE,EAAA,SAAA3uH,EAAAivK,GACA12M,KAAK22M,aAAcD,iBAEnB12M,KAAK6rM,YAAUF,EAAfG,cAEA9rM,KAAK42M,SAAA,kBAEL52M,KAAK49E,YAAc,EAElB59E,KAFc62M,QAAf,IAAApiK,EAAA,yBAIA,IAECz0C,KAFiB82M,WAAlB,IAAAriK,EAAA,+BAIA,IAGAz0C,KAAKmrM,YAALnrM,KAAqB+2M,UAAK,OAALT,GACrBt2M,KAAKotM,YAALptM,KAAqB+2M,UAAK,OAALT,GACrBt2M,KAAKqrM,cAAerrM,KAAA+2M,UAApB,OAAAP,+CAEAx2M,KAAKm8B,QAAAn8B,KAALmrM,YAEAnrM,KAAKg3M,8CAELh3M,KAAKi3M,SAAO,EAEZj3M,KAAKykC,KAAAzkC,KAAAu6H,WAELv6H,KAAKs2J,cAAgB,4BAErBt2J,KAAAu2J,cAAA,6BAMAz3I,YAH8Bs3I,EAK1Bv+G,MAAA,WAEA73C,KAAA62M,QAAAh/J,QAKI,IAFJ,IAAAmM,EAAShkD,KAAO22M,aACZO,EAAAl3M,KAAAg3M,eACAz3M,EAAA,EAAUA,EAAA23M,EAAA13M,SAAVD,EAEA23M,EAAM33M,GAAAsxL,uBACTqmB,EAAA33M,GAAAyxL,eACDhtI,EAAK2xI,YAALuhB,EAAA33M,IAMC,IAAA,IAAAmmD,KAJD1lD,KAAK82M,WAAWj/J,mBAEhB73C,KAAKi3M,SAAW,EAEf5yK,EACDA,EAAAqhB,GAAe7N,QAEf73C,KAAAm8B,QAAAn8B,KAAAmrM,YAGAnrM,KAAKykC,KAAAzkC,KAALu6H,2BAEAv6H,KAAK49E,YAAL,EAEA59E,KAAKs2J,cAAgB,4BAErBt2J,KAAAu2J,cAAA,EAIJv2J,KAtC8B6rM,YAsCpBh0J,SACNsiF,OACI,WADJ,IAEIvsF,EAAA5tC,KAAc4tC,SACd9R,EAAA97B,KAAAm8B,QACA24K,EAAch5K,EAAAg5K,YAEdnZ,EADA7/J,EAAkB2xK,aAClBqH,EACH,GAAA90M,KAAA42M,SAAAhpK,KAAA+tJ,GAAA,GAAA,CAID,IAAAh7J,EAAAiN,EAAAjN,OAGGm5F,EAAA95H,KAAA62M,QAAehyM,MAClBi1H,EAAGV,cAASt9F,EAAZk5K,IACAl7E,EAAGssD,aAAStqJ,EAAZm5K,eAEAn7E,EAAAusD,OAAAsV,EAGA37L,KAAA6rM,YAAAsL,aAAAx2K,GAGA,IAAAyK,EAAMprC,KAAU82M,WAAKjyM,MACrB7E,KAAAg3M,eAAAtxM,KAAqB0lC,GACrBA,EAAM6tJ,QAAQj5L,KAAKi3M,WACnB7rK,EAAMwrB,aAAN52D,KAAA49E,YACAxyC,EAAMwzC,QAAA5+E,KAAAykC,qBAEN2G,EAAKwlJ,kBAAa92D,GAElB95H,KAAA22M,aAAAjhB,SAA0BtqJ,GAE1BtP,EAAO+4K,UAAP/4K,EAAqB4J,WAzEK5J,EAAAg5K,YAAAh5K,EAAA2xK,aA4E9B3xK,EA5E8Bo6K,YA4EpBp6K,EA5EoBwxK,oCA+E1B,IAAI1/J,EAACwpK,EAAoBxpK,SAExB,GAAAwpK,EAAAt9E,IAAAlsF,EAAA,CAID5tC,KAAA4tC,SAAAA,EAGA,IAAAjN,EAAA3gC,KAAA6rM,YAAAsL,aAAAvpK,EAAAjN,QAGAyK,EAAMprC,KAAU82M,WAAKjyM,MACrB7E,KAAAg3M,eAAAtxM,KAAqB0lC,GACrBA,EAAM6tJ,QAAQj5L,KAAKi3M,WACnB7rK,EAAMwrB,aAAN52D,KAAA49E,YACAxyC,EAAMwzC,QAAA5+E,KAAAykC,qBAEN2G,EAAKwlJ,kBAAawmB,EAAlBt9E,IAGJ95H,KAAA22M,aApG8BjhB,SAoGXtqJ,KAGXorH,YAAK,SAAL/wI,EAAAosE,EAAAjU,mEAEA59E,KAAKm6H,SAELn6H,KAAKykC,KAAAotD,EAAc3jD,SAAnBzoB,EAAAgf,KAAAzkC,KAAAu6H,WACHv6H,KAAA4tC,SAAAnoB,EAAA4sE,8BAKLR,EAjH8BqoC,YAAAz0G,EAiHbzlB,OAEb++L,UAAK,SAALt5K,EAAmBosE,EAAnBjU,GACA59E,KAAKm6H,SACLn6H,KAAK49E,YAAOA,4BAEZ59E,KAAAykC,KAAUotD,EAAS3jD,SAAnBzoB,EAAAgf,KAAAzkC,KAAAu6H,WAGJ1oC,EA1H8BwlH,SAAA5xL,EA0HhBzlB,OAEV6/E,MAAA,SAAA77B,GAYC,IAAA,IAAA0B,kBAVD1lD,KAAA42M,SAAW,EAEX/8J,EAAI9qC,OAAAi1C,GAEHyF,cAIDzpD,KAAKm6H,SAEJ91F,EACDA,EAAAqhB,GAAe2vJ,aAGnBr1M,KA5I8B42M,SAAA,GA8ItBG,UAAA,SAAAruL,EAAA4uL,GACHA,EAAAr4M,4BAID,IAAIymD,EAACh9B,EAAQ4uL,EAAAr4M,KACT68B,EAAIuI,EAASqhB,GACT,IAAA5pB,EAAA,CACH,GACQ,SAHTpT,EAIIoT,EAAS,IAAI84K,EAAW50M,KAAMs3M,OAE7B,CAAA,GAAA,SAAA5uL,SAGJ9oB,GAAA+6B,MAAA,4BAAAjS,EAAA,UAFGoT,EAAA,IAAAq6K,EAAAn2M,KAAAs3M,UA3JhB,OAAAx7K,sPCtDAsF,wBAAAA,IAGIm2K,EAAA33M,GAFgB43B,MAIhBivD,SAJgB,EAMhB+wH,MAAA,EAEAC,YARgB,EAUhBC,QAAA,iBAKA,SAAK/L,IAEL3rM,KAAK23M,UAAL,EAEA33M,KAAK43M,iDAML94L,YAHuB6sL,EAKnB9zJ,MAAA,WALmB73C,KAAA43M,WAAAp4M,OAAA,EASvBQ,KAAAkqL,MATuBqtB,EAAA9wH,UAWnB0wH,aAAI,SAASx2K,GACb,IACI+3D,EADA/3D,EAAei5J,aAAgB,eACZlhG,OACnB,GAAA14F,KAAKkqL,QAALqtB,EAAoB9wH,SAAO,CACvBzmF,KAAAkqL,MAAIqtB,EAAO9wH,SACX,IAAA,IAAIlnF,EAAK,EAAAA,EAAAm5F,EAAcl5F,SAAAD,EAAA,CACnB,IAAA2oL,EAAKxvF,EAAAn5F,GACR2oL,EAAAf,cACJe,EAAAS,8BAIL,IAAgBpxH,OAAA,EAAK5wC,OAAA,EAAaq9F,OAAA,EAAWkhE,OAAA,EACzClC,OAAU,EACVH,OAAA,sBAEAE,EAAA3hJ,EAAAswI,gBAEA1xK,KAAAkqL,QAAWqtB,EAAAG,SACXngJ,EAAAv3D,KAAS43M,WAAI53M,KAAb43M,WAAAp4M,OAAA,GACAmnB,EAAMya,EAAK+uI,cACX0S,EAAAzhJ,EAAAswI,gBALJwT,EAMIlhE,EAAAhkH,KAAA63M,gBAGA70B,EAAShjL,KAAL83M,gBAEA93M,KAAAkqL,QAAWqtB,EAAAC,OACXjgJ,EAAAv3D,KAAS43M,WAAA53M,KAAgB43M,WAAIp4M,OAApB,GACTmnB,EAAMya,EAAK6uI,cACX4S,EAAAtrH,EAAci9B,SAAdpzD,EAAAwwI,mBAAAxwI,EAAAuwI,gBALJuT,EAMIlhE,EAAAhkH,KAAA83M,eAGA90B,EAAYh/D,GACZhkH,KAAAkqL,QAAAqtB,EAAAE,cACAlgJ,EAAOv3D,KAAI43M,WAAA53M,KAAX43M,WAAAp4M,OAAA,GAEAmnB,EAAMya,EAAK6uI,cACX4S,EAAAtrH,EAAci9B,SAAdpzD,EAAAuwI,gBAAAvwI,EAAAwwI,mBAEHsT,EADGlhE,EAAAhkH,KAAA83M,eAEP90B,EAAAh/D,GAIG,IAAA,IAAAj/F,EAAK,EAAAA,EAAA2zE,EAAgBl5F,SAAWulB,EAAA,CAChC,IAAA+3K,EAAKpkG,EAAA3zE,GACR+3K,EAAA1U,gBAAAzhK,EAAAq9F,EAAAkhE,EAAArC,EAAAC,EAAAC,EAAAC,GACD8Z,EAAOpU,eAAP/hK,EAAAq9F,EAAAkhE,EAAArC,EAAAC,EAAAC,EAAAC,GAGJ,OA/DuBriJ,GAiEfo3K,SAAA,SAAWxgJ,GACdv3D,KAAA43M,WAAAp4M,OAAA,EAAAQ,KAAA23M,WACD/3M,GAAKyC,QAAL,IAAqBrC,KAArB23M,WAGJ33M,KAtEuB43M,WAsEdlyM,KAAA6xD,IAER3T,MAxEsB,WA0EvB5jD,KAAAkqL,MA1EuBqtB,EAAAC,OA4EtBvL,WA5EsB,WA8EvBjsM,KAAAkqL,MA9EuBqtB,EAAAE,aAgFtBO,WAhFsB,WAkFvBh4M,KAlFuBkqL,MAAAqtB,EAkFXG,SAEJO,SAAA,WACH,IAAAj4M,KAAA43M,WAAAp4M,QACDI,GAAKyC,QAAL,MAEIrC,KAAA43M,WAAAlvM,MAEC,IAHL1I,KAGK43M,WAAAp4M,OACDQ,KAAKkqL,MAAQqtB,EAAM9wH,SA3FJzmF,KAAAkqL,MAAAqtB,EAAAG,SAiGtBI,aAjGsB,WAmGvB,OAAA,GAnGuB93M,KAAA43M,WAmGHp4M,OAAA,GAEnB04M,iBArGsB,WAuGvB,OAAA,GAvGuBl4M,KAAA43M,WAuGNp4M,QAEbq4M,cAAS,WAER,IADG,IAAAvjM,EAAA,EACH/U,EAAA,EAAAA,EAAAS,KAAA43M,WAAAp4M,SAAAD,EACD+U,GAAA,GAAA/U,EAGJ,OAAA+U,GAEI6jM,eAAS,WAER,IADG,IAAA7jM,EAAA,EACH/U,EAAA,EAAAA,EAAAS,KAAA43M,WAAAp4M,OAAA,IAAAD,EACD+U,GAAA,GAAA/U,EApHR,OAAA+U,0BA2HAq3L,EAAA4L,MAAiBA,kEClJbn2K,wBAAiBA,iMAOrBo1K,EAAIv3M,KAAA,0MAOJs3M,EAAIt3M,KAAgB,oJAMpBm5M,EAAIn5M,KAAA,4JAMJo5M,EAAOp5M,KAAU,eAEbE,EAAAE,SACAm3M,OAAAA,EACAD,eAAAA,EAJJ6B,UAAAA,kEC1BA14M,EAAI,qBAEJ,IAAI44M,EAAA,8DAEJC,EAAA,4BAgBQt7J,KAAA,WAGC,IAFD,IAAA17B,EAAKrP,UAAW1S,OACZ8U,EAAS,GACZ/U,EAAA,EAAAA,EAAAgiB,EAAAhiB,IACD+U,GAAAA,GAAA,KAAAA,EAAA,GAAA,KAAApC,UAAA3S,IAAAknG,QAAA,aAAA,cAaAkc,QAAA,SAAc61F,GA3BU,IAAA1uE,EAAAwuE,EAAA56D,KAAA86D,qBAwCpBC,aAAI,SAAMC,GACV,GAAAA,EAAI,CAEP,IAAA5hK,EAAA4hK,EAAAhsH,YAAA,KACD,IAAA,IAAO51C,EAAP,OAAA4hK,EAAA5yF,UAAA,EAAAhvE,aAcAg7E,SAAI,SAAW0mF,EAAU71F,GACzB,IAAIthG,EAAMm3L,EAAA70L,QAAA,KACNtC,EAAA,IAASm3L,EAASA,EAAQ1yF,UAAQ,EAAAzkG,IACtC,IACI/M,EADC,sBACUopI,KAAO86D,EAAtB/xG,QAAA,WAAA,KACA,IAAInyF,EAAA,OAAW,KAEf,IAAAqkM,EAAArkM,EAAA,GAjEwB,OAAAquG,GAAA61F,EAAA1yF,UAAA0yF,EAAAh5M,OAAAmjH,EAAAnjH,QAAA6lH,gBAAA1C,EAAA0C,cAAAszF,EAAA7yF,UAAA,EAAA6yF,EAAAn5M,OAAAmjH,EAAAnjH,WA8ExBqyH,QAAA,SAAc2mF,GA9EU,IAAA1uE,EAAA8uE,EAAAl7D,KAAA86D,qBA4FxBK,cAAI,SAAgBL,EAAQ71F,GAC5BA,EAAIA,GAAJ,GACA,IAAIthG,EAAQm3L,EAAG70L,QAAA,KACXm1L,EAAU,GA/FU,OAgGpBz3L,EAAA,IACHy3L,EAAAN,EAAA1yF,UAAAzkG,GACDm3L,EAAQA,EAAQ1yF,UAAhB,EAAAzkG,KAEAA,EAAOm3L,EAAQ9rH,YAAa,MApGJ,EAAA8rH,EAAA71F,EAAAm2F,EAsG5BN,EAAA1yF,UAAA,EAAAzkG,GAAAshG,EAAAm2F,GAWIC,eAAY,SAAQP,EAAR1mF,EAAZknF,GACA,GAAA,IAAIlnF,EAAAnuG,QAAJ,KAAA,OAAA3jB,KAAA64M,cAAAL,EAAA1mF,GACA,IAAIzwG,EAAMm3L,EAAA70L,QAAiB,KACvBm1L,EAAJ,GACI9pK,EAAAgqK,EAAkBh5M,KAAA2iH,QAAU61F,GAA5B,GAOR,OANQn3L,EAAA,IACHy3L,EAAAN,EAAA1yF,UAAAzkG,GACDm3L,EAAQA,EAAQ1yF,UAAhB,EAAAzkG,IAxHwBA,GA0HxBA,EAAOm3L,EAAQ9rH,YAAa,OA1HJ,EAAA,EAAArrE,EAAA,EA4H5Bm3L,EAAA1yF,UAAA,EAAAzkG,GAAAywG,EAAA9iF,EAAA8pK,0BAII,IAAAG,EAAAv9K,EAAAk2C,OAAAl2C,GAGI,GAFJu9K,EAGSv9K,EACTA,EAAAA,EAAA+qE,QAAA8xG,EAAA,UArIwBU,EAAAz5M,SAAAk8B,EAAAl8B,kBA2I5B05M,IAAAt5M,GAAAi4B,IAAAmF,KAAAp9B,GAAAi4B,IAAAmiH,WAAA,KAAA,IAGCrd,SAAA,SAAAn/F,GA9IL,OAAAA,EAAAipE,QAAA,UAAA,yECMI,IAAA0yG,EAAA,SAAApwM,EAAAmD,EAAAC,EAAAC,EAAA6+F,EAAAC,GACAlrG,KAAK+I,EAAIA,EACT/I,KAAKkM,EAAIA,EACTlM,KAAKmM,EAALA,EACAnM,KAAKoM,EAALA,EANJpM,KAAAirG,GAAAA,aAwBCkuG,EAFDrsK,OAAA,SAAA/jC,EAAAmD,EAAAC,EAAAC,EAAA6+F,EAAAC,sCAoBCiuG,EAFDv5I,SAAA,8CAcCu5I,EAFD94M,MAAA,SAAA+G,oDAqBI+xM,EAAA/4E,OAAA,SAAA3rG,EAAA7E,EAAAvoB,GAAA,IAAwB0B,EAAI6mB,EAAG7mB,EAAGmD,EAAI0jB,EAAG1jB,EAAGC,EAAAyjB,EAAKzjB,EAAOC,EAAAwjB,EAAKxjB,EACzD6+F,EAAIr7E,EAAIq7E,GACRC,EAAIt7E,EAAIs7E,UACZz2E,EAAI1rB,EAAIA,EAAI1B,EAAG0B,EAAImD,EAAI7E,EAAG8E,EAC1BsoB,EAAIvoB,EAAInD,EAAI1B,EAAG6E,EAAIA,EAAI7E,EAAG+E,EAC1BqoB,EAAItoB,EAAJA,EAAS9E,EAAK0B,EAALqD,EAAY/E,EAAK8E,EAC1BsoB,EAAIroB,EAAJD,EAAS9E,EAAK6E,EAALE,EAAY/E,EAAK+E,EAC1BqoB,EAAAw2E,GAAOA,EAAP5jG,EAAA0B,EAAAmiG,EAAA7jG,EAAA8E,EAAA9E,EAAA4jG,GARJx2E,EAAAy2E,GAAAD,EAAA5jG,EAAA6E,EAAAg/F,EAAA7jG,EAAA+E,EAAA/E,EAAA6jG,MAsBIiuG,EAAAlhK,OAAA,SAAAxjB,EAAArtB,GAAA,IAAsB2B,EAAI3B,EAAE2B,EAAGmD,EAAI9E,EAAE8E,EACjCC,EAAA/E,EAAA+E,EACAC,EAAAhF,EAAKgF,EAAMo1J,EAAf,GAAAz4J,EAAAqD,EAAAF,EAAAC,GACI8+F,EAAI7jG,EAAA6jG,GACJC,EAAK9jG,EAAA8jG,UACTz2E,EAAI1rB,EAAIy4J,EAAAp1J,EACRqoB,EAAIvoB,GAAIs1J,EAARt1J,EACAuoB,EAAItoB,GAAKq1J,EAAAr1J,EACTsoB,EAAIroB,EAAJo1J,EAASz4J,EACT0rB,EAAAw2E,GAAOu2D,GAAPr1J,EAAA++F,EAAA9+F,EAAA6+F,GAVJx2E,EAAAy2E,GAAAs2D,GAAAt1J,EAAA++F,EAAAliG,EAAAmiG,MAyBIiuG,EAAYp5I,SAAZ,SAAAtrC,EAAAs0I,UACAt0I,EAAI1rB,EAAIggK,EAAIr5H,IACZjb,EAAIvoB,EAAI68J,EAAIp5H,IACZlb,EAAItoB,EAAJ48J,EAASj5H,IACTrb,EAAIroB,EAAJ28J,EAASh5H,IACTtb,EAAAw2E,GAAO89D,EAAPz4H,IAPJ7b,EAAAy2E,GAAA69D,EAAAx4H,OAwBI4oK,EAAUC,cAAW,SAAA3kL,EAAA8mC,EAAA89I,EAAAjyM,GACjB,IAAA9H,EAAAoE,cACI2C,IAAJe,GACAA,EAAIiyM,EAHR/5M,EAIOi8D,EAAAj8D,EACHoE,EAAI63D,EAAJ73D,IAEHpE,EAAAi8D,EACG73D,EAAI21M,GAER5kL,EAAAn1B,EAAO8H,EAAP2B,EAAAzJ,EAAA8H,EAAA+E,EAAAzI,EAAA0D,EAAA6jG,GAZJx2E,EAAA/wB,EAAA0D,EAAA8E,EAAA5M,EAAA8H,EAAAgF,EAAA1I,EAAA0D,EAAA8jG,MA4BIiuG,EAAAG,cAAwB,SAAc7kL,EAAKwa,EAA3C7nC,UACAqtB,EAAA9wB,MAAAyD,EAAA2B,EAAAkmC,EAAAtrC,MAAAyD,EAAA+E,EAAA8iC,EAAArrC,OAHJ6wB,EAAA7wB,OAAAwD,EAAA8E,EAAA+iC,EAAAtrC,MAAAyD,EAAAgF,EAAA6iC,EAAArrC,UAmBIu1M,EAASI,cAAT,SAAA9kL,EAAA7xB,EAAAwE,GACA,IAAIoyM,EAAK52M,EAAKtD,EACVm6M,EAAK72M,EAAKc,EACVg2M,EAAAF,EAAM52M,EAAAe,MACNg2M,EAAAF,EAAM72M,EAAAgB,OACNg2M,EAAMxyM,EAAE2B,EAAIywM,EAAKpyM,EAAE+E,EAAIstM,EAAKryM,EAAE6jG,GAC9B4uG,EAAMzyM,EAAE8E,EAAIstM,EAAKpyM,EAAEgF,EAAIqtM,EAAKryM,EAAE8jG,GAC9B4uG,EAAM1yM,EAAE2B,EAAI2wM,EAAKtyM,EAAE+E,EAAIstM,EAAKryM,EAAE6jG,GAC9B8uG,EAAM3yM,EAAE8E,EAAIwtM,EAAKtyM,EAAEgF,EAAIqtM,EAAKryM,EAAE8jG,GAC9B8uG,EAAM5yM,EAAE2B,EAAIywM,EAAKpyM,EAAE+E,EAAIwtM,EAAKvyM,EAAE6jG,GAC9BgvG,EAAM7yM,EAAE8E,EAAIstM,EAAKpyM,EAAEgF,EAAIutM,EAAKvyM,EAAE8jG,sBAE9BgvG,EAAA9yM,EAAO8E,EAAKwtM,EAAItyM,EAATgF,EAAcutM,EAAKvyM,EAAnB8jG,GAEPivG,EAAO90M,KAAKC,IAAIs0M,EAAKE,EAAKE,EAAKI,GAC/BrqI,EAAO1qE,KAAKE,IAAIq0M,EAAKE,EAAKE,EAAKI,uBAE/BpqI,EAAI3qE,KAARE,IAAAs0M,EAAAE,EAAAE,EAAAC,UAEAzlL,EAAIn1B,EAAA66M,EACJ1lL,EAAI/wB,EAAA22M,EACJ5lL,EAAA9wB,MAAAosE,EAAAoqI,EAvBJ1lL,EAAA7wB,OAAAosE,EAAAqqI,KAyCIlB,EAAQmB,aAAR,SAAAC,EAAAC,EAAAC,EAAAC,EAAA93M,EAAA+3M,GACA,IAAIr7M,EAAAsD,EAAQtD,EACRoE,EAAAd,EAASc,YAETE,EAAKhB,EAAAgB,OAELqnG,EAAK0vG,EAAkB5xM,EAAIzJ,EAAAq7M,EAA/BxuM,EAAAzI,EAAAi3M,EAAA1vG,GACIC,EAAKyvG,EAAkBzuM,EAAI5M,EAAAq7M,EAA/BvuM,EAAA1I,EAAAi3M,EAAAzvG,GACI0vG,EAAKD,EAAkB5xM,EAAIpF,EAC3B2V,EAAKqhM,EAAkBzuM,EAAIvI,UAE/BgW,EAAAghM,EAAAvuM,EAAAxI,EAEA42M,EAAOl7M,EAAI2rG,EACXuvG,EAAO92M,EAAIwnG,EACXuvG,EAAOn7M,EAAIs7M,EAAK3vG,EAChBwvG,EAAO/2M,EAAI4V,EAAK4xF,EAChBqvG,EAAOj7M,EAAIoa,EAAKuxF,EAChBsvG,EAAO72M,EAAIiW,EAAKuxF,EApBpBwvG,EAAAp7M,EAAAs7M,EAAAlhM,EAAAuxF,sEC1OA,IAAM55C,EAAK3xD,EAAQ,wBAAnB2xD,MACM1xD,EAAAD,EAAc,UACd2e,EAAA3e,EAAA,kBACAmuJ,EAAanuJ,EAAQ,oDAErBm6C,EAAan6C,EAAM,2BAEnB0xD,EAAAC,EAAeD,2BAEfwpE,EAAcvpE,EAAAupE,aAKpB94D,EAAS,IAAA+rF,EAAe,QAEhB,SAAAgtD,EAAA9tH,GACA,OAAAA,EAIH,iBAAAA,yBAHAntF,GAAAyC,QAAA,MACU,MASP,SAAAy4M,EAAAr2K,EAAoB3lB,GAChB,GAAAA,EAAI6jH,QACJ,IAAA,IAAIpjI,EAAK,EAAAA,EAAAklC,EAALxY,YAAqBzsB,SAAaD,EAAA,CAClC,IAAAkmB,EAAOgf,EAAPxY,YAAA1sB,GACH,GAAAkmB,EAAA3G,cAAAA,EACJ,OAAA2G,OAKG,IAAA,IAAIV,EAAA,EAAAA,EAAA0f,EAAgBxY,YAAazsB,SAAAulB,EAAA,CAC7B,IAAA+9K,EAAOr+J,EAAPxY,YAAAlH,GACH,GAAA+9K,aAAAhkL,EACJ,OAAAgkL,cAOD,SAAAiY,EAAgBt2K,EAAI3lB,EAAKkN,GACrB,GAAAlN,EAAI6jH,QACJ,IAAA,IAAIpjI,EAAK,EAAAA,EAAAklC,EAALxY,YAAqBzsB,SAAaD,EAAA,CAClC,IAAAkmB,EAAAgf,EAAWxY,YAAX1sB,GACHkmB,EAAA3G,cAAAA,GACJkN,EAAAtmB,KAAA+f,QAKG,IAAA,IAAI2kB,EAAA,EAAAA,EAAA3F,EAAgBxY,YAAazsB,SAAA4qC,EAAA,CAC7B,IAAA4wK,EAAAv2K,EAAWxY,YAAXme,GACH4wK,aAAAl8L,GACJkN,EAAAtmB,KAAAs1M,IAgDL,IAAAhqJ,EAASpxD,GAAGE,2BAEZyB,QAAA3B,GAAY0kD,gCAMR2S,aAEA0K,SAAA,EAQAs5I,OAAA,EASAhvL,eAQAqsC,QAAA,KAUQvM,cACHpjC,IAHS,WAAA,OAAA3oB,KAIL80D,UAAOsgF,GAAA,GAEJtpH,IAAA,SAAK/nB,GADTA,EAII/D,KAAK80D,WAAasgF,EAEzBp1I,KAAA80D,YAAAsgF,IAgBGn2I,MACH0pB,IAHC,WAAA,OAAA3oB,KAIGstB,OAEGxB,IAAA,SAAG/nB,GAxEP/D,KAAAstB,MAAAvpB,IA0FA4gD,MACHh8B,IAAA,WA3FG,OAAA3oB,KAAA4f,MA4GA8kB,UACH/b,IAAA,WA7GG,OAAA3oB,KAAAi3D,YA4HA8jD,eACHpyF,IAAA,WA7HG,OAAA3oB,KAAAi3D,UAAAz3D,SAiJAm4D,QACHhvC,IAHG,WAAA,OAAA3oB,KAIC2hE,SAED71C,IAAA,SAAS/nB,GAEL,GADAA,IAAKA,EACL/D,KAAI2hE,UAAS59D,EAAK,CAClB/D,KAAI2hE,QAAQ59D,EACR,IAAAY,EAAI3E,KAAA66C,QACJ,GAAAl2C,EACgBA,EAAe8zD,oBAElC74D,GAAA+e,SAAA0iC,eAAAwgB,aAAA7hE,KAAA+D,MAeLiB,mBACH2jB,IAAA,WAHc,OAAA3oB,KAAAy4D,sBAanB14D,KAAA,SAAKd,GACLe,KAAKstB,WAAMjnB,IAAApH,EAAmBA,EAAM,sCAEpCe,KAAG4f,IAA8CkiD,EAAgBoD,WAEjEtlE,GAAA+e,SAAAC,YAAAhf,GAAA+e,SAAAC,WAAAC,gBAAA7e,MASAA,KAAKo6D,qDAoBRqH,UA7NmB,gCAyOZD,UAAA,SAAAz9D,GACH,GAAA/D,KAAA66C,UAAA92C,EAAA,CAGO4nC,EAKJ,IAAAksB,EAAW73D,KAAX66C,QAkBI,GAdR76C,KAAK66C,QAAA92C,GAAL,KAEA/D,KAAIk7M,aAAOn3M,GAEHA,IAIJ/D,KAAAi7M,OAAMl3M,EAANk3M,OAAA,EACAz6J,EAAA2W,iBAAyBn3D,MACzB+D,EAAMkzD,UAAAvxD,KAAe1F,MACxB+D,EAAA2pB,MAAA3pB,EAAA2pB,mBAAA1tB,MACG+D,EAAAm3C,aAAWrB,EAAA6e,eAEPb,GACA,KAAAA,EAAI/C,UAAU1D,GAAc,CACxB,IAAA+vB,EAAUtpB,EAAQZ,UAAlBtzC,QAAA3jB,MACHokF,EAGDvsB,EAAKZ,UAAA92C,OAAoBghE,EAAzB,kBAzWE,sBA2WFnhF,KAAI43D,oBAAoBC,GAEvB,IAAAA,EAAAZ,UAAAz3D,SACJq4D,EAAA3c,cAAArB,EAAA6e,qBAIJ30D,GAnRe/D,KAAA43D,oBAAA,QAuSnBgnE,KAvSmB,SAAAH,oBAsTZ/5E,eAAO,SAAAC,GACP,IAAAA,SACH/kD,GAAA+8C,IAAA,qBAMA,IAFG,IAAA+jB,EAAI1gE,KAAei3D,UAEtB13D,EAAA,EAAAwuB,EAAA2yC,EAAAlhE,OAAAD,EAAAwuB,EAAAxuB,IACD,GAAOmhE,EAAPnhE,GAAAqgB,MAAA+kC,EAAA,OAAA+b,EAAAnhE,gBAcIsmG,eAAO,SAAA5mG,GACP,IAAAA,SACHW,GAAA+8C,IAAA,qBAMA,IAFG,IAAA+jB,EAAI1gE,KAAei3D,UAEtB13D,EAAA,EAAAwuB,EAAA2yC,EAAAlhE,OAAAD,EAAAwuB,EAAAxuB,IACD,GAAOmhE,EAAPnhE,GAAA+tB,QAAAruB,EAAA,OAAAyhE,EAAAnhE,gBAOAwhE,SAAI,SAAYJ,uBAMhB/gE,GAAAygB,SAAA,OAAAsgD,EAAA9lB,QAAA,yBAkBAiK,YAAM,SAAA6b,EAAgBw6I,GArXNx6I,EAAAh8D,OAAA3E,2BAoYZ4kD,gBAAO,WACV,OAFD5kD,KAGK66C,QACM76C,KAAP66C,QAAAoc,UAAAtzC,QAAA3jB,MAvYY,GAqZZurF,gBAAA,SAAAlqE,GACH,GAAArhB,KAAA66C,QAGG,GAAA76C,KAAA66C,QAAAia,UAAA8lE,EACHh7H,GAAAyC,QAAA,UADG,CAIJ,IAAI20D,EAAWh3D,KAAA66C,QAASoc,UACxB51C,GAAc,IAAVA,EAAJA,EAAwB21C,EAAAx3D,OAAA,EACpB,IAAA47M,EAASpkJ,EAAOrzC,QAAhB3jB,MACAqhB,IAAI+5L,IACApkJ,EAAA72C,OAASi7L,EAAT,GADJ/5L,EAGK21C,EAAAx3D,OACDw3D,EAAS72C,OAAKkB,EAAd,EAAArhB,MAEJg3D,EAAKtxD,KAAA1F,MAtaOA,KAAA82D,wBAAA92D,KAAA82D,uBAAAz1C,MAichBg6L,KAAA,SAAYC,EAAZC,GACA,IAEI72K,EAAQkwB,EAAAr1D,EAAAi8M,EAFRxqJ,EAAUpxD,GAAAk3G,UACVz1F,EAAQ,EAER87B,EAAQ6T,EAARyqJ,QAAAzqJ,EAAA0qJ,UACAv+J,IACHA,KACD6T,EAASyqJ,QAAT/1M,KAAAy3C,IAEA6T,EAAM0qJ,WAENv+J,EAAI39C,OAAS,EACb29C,EAAA,GAAAn9C,KACA,IAAA2E,EAAA,KAEI,IADA62M,GAAA,EACAn6L,GAGC,GADGuzC,EAAAzX,IADJ97B,GAiBC,IAZGm6L,GAAAF,EAGAA,EAAA1mJ,GACA4mJ,GAAAD,QAMJp+J,EAAI97B,GAAA,KAAJm6L,GAuBI,GAnBAA,GAAA,EAmBA92K,EAGI,GAAAA,IAFJnlC,GAGC49C,EAAA97B,GAAAqjB,EAAAnlC,GACD8hB,SAGI,GAAA1c,IACAw4C,EAAA97B,GAAA1c,EACA0c,IAEIm6L,GAAW,EACX72M,EAAIk2C,SAFRt7C,GAGImlC,EAAS//B,EAAOk2C,QAAhBoc,WAECtzC,QAAAhf,GACDA,EAAAA,EAAAk2C,UAGHl2C,EAAA,aAKApF,EAAA,GACJ,WA1CGq1D,EAAAqC,UAAWz3D,OAAK,GAChBmF,EAAAiwD,EACAlwB,EAAAkwB,EAAeqC,UACf13D,EAAA,EACH49C,EAAA97B,GAAAqjB,EAAAnlC,GACD8hB,MAII87B,EAAA97B,GAAAuzC,EACHvzC,IACDm6L,GAAA,GAlfQr+J,EAAA39C,OAAA,EAwhBpBwxD,EAxhBoB0qJ,iCA8iBZrsM,iBAAI,SAAY2xD,GAEhBhhE,KAAK66C,eACRx0C,IAAA26D,IAAAA,GAAA,GAjjBehhE,KAAA66C,QAAA2yD,YAAAxtG,KAAAghE,KAukBZwsC,YAAA,SAAA7sC,EAAAK,GACAhhE,KAAIi3D,UAAWtzC,QAAAg9C,IAAY,KAE1BK,QAAA36D,IAAA26D,IACDL,EAAAK,UA3kBYL,EAAAh8D,OAAA,OA+lBhBg3M,kBAAe,SAAK36I,GAGpB,IAAAt8B,EAAa1kC,KAAAi3D,eACE5wD,IAAX26D,IAAAA,GAAA,GACA,IAAA,IAAIzhE,EAAJmlC,EAAUllC,OAAA,EAAAD,GAAA,EAAAA,IAAA,CACN,IAAAklC,EAAAC,EAAAnlC,GACAklC,IAGAu8B,GAAAv8B,EAAAu8B,UAEPv8B,EAAA9/B,OAAA,+BAeD4sJ,UAAG,SAAA5sJ,GACC,IAAAg8D,EAAI3gE,KACA,EAAA,CACH,GAAA2gE,IAAAh8D,EACD,OAAQ,EAGZg8D,EAAAA,EAAA9lB,cAjoBgB8lB,aA2pBhBj7C,aAAI,SAAaqnE,GACb,IAAAjuE,EAAO+7L,EAAoB9tH,GAC9B,OAAAjuE,EACDg8L,EAAA96M,KAAA8e,SAiBAkuE,cAAmD,SAAnDD,GACA,IAAIjuE,EAAa+7L,EAAA9tH,GACb/gE,YACHlN,GACDi8L,EAAA/6M,KAAA8e,EAAAkN,MAkBAihE,uBAAiB,SAAAF,GACb,IAAAjuE,EAAO+7L,EAAmB9tH,GAC7B,OAAAjuE,EA/uBD,SAAA88L,EAAoBl3K,EAApB5lB,GACA,IAAA,IAAIvf,EAAA,EAAOA,EAAAmlC,EAAcllC,SAAMD,EAAA,CAC/B,IAAIklC,EAAMC,EAAAnlC,GACNkmB,EAAOq1L,EAAPr2K,EAAA3lB,GACH,GAFD2G,EAII,OAAOA,EACP,GAAIgf,EAAMwyB,UAAAz3D,OAAA,IACNimB,EAAAm2L,EAAAn3K,EAAAwyB,UAAAn4C,IAEP,OAAA2G,cAsuBDm2L,CAAA57M,KAAAi3D,UAAAn4C,SAiBAtQ,wBAAA,SAAAu+E,GACA,IAAIjuE,EAAa+7L,EAAA9tH,GACb/gE,YACAlN,IACHi8L,EAAA/6M,KAAA8e,EAAAkN,GApvBD,SAAA6vL,EAAWn3K,EAAX5lB,EAAAkN,GACA,IAAA,IAAAzsB,EAAA,EAAAA,EAAemlC,EAAMllC,SAAaD,EAAA,CAClC,IAAIklC,EAAKC,EAAUnlC,GACfw7M,EAAAt2K,EAAA3lB,EAAyBkN,GAC5ByY,EAAAwyB,UAAAz3D,OAAA,GACJq8M,EAAAp3K,EAAAwyB,UAAAn4C,EAAAkN,IAgvBG6vL,CAAA77M,KAAAi3D,UAAAn4C,EAAAkN,OAKA8vL,oBAAcnwK,EA2BV6/C,aAAG,SAAMuB,GAQT,IAAAjuE,EACA,GAAkB,iBAAbiuE,GAED,KADAjuE,EAAAT,EAAWqwE,eAAM3B,IAOpB,OALOntF,GAAAyC,QAAG,KAAQ0qF,GACdntF,GAAAm8M,WACDn8M,GAAOyC,QAAP,KAAA0qF,GAGH,SAEG,CACA,IAAAA,EAEJ,OADCntF,GAAAyC,QAAA,MACD,SAOA,GAAA,mBAAOyc,EAEP,OADHlf,GAAAyC,QAAA,MACO,KAEJ,IAAAgc,EAAAmrD,eAAA1qD,EAAAlf,GAAAw8E,kBACHx8E,GAAAyC,QAAA,WAYG,IAAA25M,EAAIl9L,EAAgB8uE,kBACpB,GAAAouH,IAAKh8M,KAAU0lB,aAAAs2L,KACXh8M,KAAAwrF,aAAAwwH,GAGP,OAAA,KAYD,IAAA3vL,EAAA,IAAiBvN,SACjBuN,EAAKoY,KAAAzkC,KACDA,KAAAisB,YAAUvmB,KAAA2mB,GAIbrsB,KAAAy4D,kEAcGwjJ,iBAAOtwK,EAwDPuwK,gBAAG,SAAH7vL,GACAA,GAIHA,aAAAzsB,GAAAw8E,YACG/vD,EAAWrsB,KAAA0lB,aAAA2G,IAEdA,GAj5BeA,EAAAoO,WA24Bf76B,GAAAyC,QAAA,OAiBG85M,qBAAWxwK,EAcX2hD,iBAAA,SAAAjhE,GACA,GAAAA,GAKA,KAAArsB,KAAI80D,UAAU1D,GAAA,CACV,IAAA7xD,EAAAS,KAAKisB,YAAYtI,QAAjB0I,IACK,IAAL9sB,EACIS,KAAAisB,YAAU9L,OAAO5gB,EAAA,GAKxB8sB,EAAAoY,OAAAzkC,MACJJ,GAAAyC,QAAA,YAbAzC,GAAAyC,QAAA,OAkBGo4B,QAAA,WACH76B,GAAA0kD,OAAAhiD,UAAAm4B,QAAAl4B,KAAAvC,QA/7BeA,KAAA23D,QAAA,IA+8BhBykJ,mBAAgB,WAEf,IADG,IAAA13K,EAAA1kC,KAAYi3D,UACf13D,EAAA,EAAAA,EAAAmlC,EAAAllC,SAAAD,EAj9BemlC,EAAAnlC,GAAAk7B,WAs9BpBygL,aAAA,SAt9BoBn3M,KAu9BpB2zD,iBAv9BoB,aAy9BpBiB,iBAAA,aACIP,gBAAI,aACJR,oBAAS,SAAkBC,GACvB,IAAAwkJ,EAAQr8M,KAAA66C,SACR76C,KAAI+rD,cAAWswJ,aAAAz8M,GAAAukD,OACXvkD,GAAA06B,KAAGwwB,sBAAH9qD,MA6CJ,IAAAs8M,EAAYt8M,KAAA2hE,YAAe06I,IAAmBA,EAAA5jJ,oBACjDz4D,KAAAy4D,qBAAA6jJ,GA5gCe18M,GAAA+e,SAAA0iC,eAAAwgB,aAAA7hE,KAAAs8M,IAihCZ16I,aAAA,SAAY2rB,GACfA,wCAIG,IAAAgvH,EAAav8M,KAAAs4D,QAObikJ,GAAAv8M,OAAAu8M,EAAA75L,MAAA65L,EAAAhkJ,2BAYJg1B,EAAO50B,sBAKP6jJ,qBAActmI,2BA0Bd,IAAA32E,EAAAwuB,EAGA/tB,KAAA80D,WAAA1D,EAGA,IAAIzsD,EAAC3E,KAAA66C,QACD4hK,EAAK93M,GAAoBA,EAAzBmwD,UAAA1D,EAMA,IAAA1sB,EAAA1kC,KAAAi3D,UACA,IAAA13D,EAAA,EAAAwuB,EAAY2W,EAAAllC,OAAZD,EAAAwuB,IAAAxuB,2BAMA,IAAAA,EAAA,EAAAwuB,EAAA/tB,KAAAisB,YAAAzsB,OAAAD,EAAAwuB,IAAAxuB,EAAA,CACUS,KAAAisB,YAAV1sB,uBAKA,IAAA6tF,EAAaptF,KAAAo6D,eACb,IAAA76D,EAAA,EAAAwuB,EAAUq/D,EAAiB5tF,OAA3BD,EAAAwuB,IAAAxuB,EAAA,CACH,IAAAW,EAAAktF,EAAA7tF,GACDW,GAAaA,EAAby6D,UAAA36D,MASI,GAPJotF,EAAA5tF,OAAA,EAGCQ,KAAA+rD,mDAIG0wJ,GAEI93M,EAAO,CACP,IAAA+3M,EAAe/3M,EAAOsyD,UAAKtzC,QAAZ3jB,MAClB2E,EAAAsyD,UAAA92C,OAAAu8L,EAAA,GACJ/3M,EAAA+oB,MAAA/oB,EAAA+oB,KAAA,gBAAA1tB,gBAODkhE,WAAIv1B,IASZqlB,EAAA8Q,YAAAA,iBAIA9Q,EAAS0qJ,SAAU,EAEf1qJ,EAAA1uD,UAAS+0D,kBAA0BrG,EAAA1uD,UAAY80D,cAanDpG,EAAG1uD,UAAWw1D,wBAAA9G,EAAA1uD,UAAAs1D,oBAQdj4D,EAAIg9M,eAAQ3rJ,qPCzwCZ,IAAAqrG,EAAA,KA6EiBl9J,EAAjBE,6BAfQ,SAAAijB,EAAAve,GACA,IAAA,IAAIwd,EAAO,EAAAgyB,EAAAjxB,EAAQ9iB,OAAS,EAAA8b,EAAAi4B,IAAA,EAAAhyB,GAAAgyB,EAAAj4B,EAAAiG,EAAAgyB,IAAA,EAAA,CACxB,IAAAqtC,EAAAt+D,EAAAhH,GACH,GAFDslE,EAGS78E,EAAOs4J,EACZ9oH,EAAIj4B,EAAI,MAEP,CAAA,KAAAslE,EAAA78E,EAAAs4J,GAGR,OAAA/gJ,EAFOiG,EAAAjG,EAAA,wCCtEZ,IAAIshM,EAAWl9M,EAAA,UAAmBm9M,cAE9BC,EAAU,mBAAdh5L,MAAA,IAEI4+C,GAAA,GAAU,GAAA,GAAA,IAAmCq6I,EAAOr6I,EAAY09D,OAAnB19D,EAAA,IAAAA,EAAA,IAAAA,EAAA,IAAAA,EAAA,IAAAA,EAAAA,EAAAA,GAA+Bs6I,EAAOD,EAAvFroL,IAAA,SAAAp1B,EAAAC,yBAEAq4C,OAAAqlK,UAGQ99M,EAAAE,QAAA,SAAA69M,GACH,GAAA,KAAAA,EAAA19M,OACD,OAAA09M,EAEAH,EAAa,GAAGG,EAAO,GACnBH,EAAU,GAAAG,EAAa,GACvB,IAAA,IAAI39M,EAAM,EAAA6sB,EAAA,EAAA7sB,EAAa,GAAAA,GAAO,EAAA,CAC9B,IAAA49M,EAAAP,EAAqBM,EAAQ32I,WAAShnE,IACtC69M,EAAAR,EAAqBM,EAAQ32I,WAAWhnE,EAAM,IAC9Cw9M,EAAaC,EAAQ5wL,MAAQ0wL,EAASK,GAAM,GAC/CJ,EAAAC,EAAA5wL,MAAA0wL,GAAA,EAAAK,IAAA,EAAAC,GAAA,GACDL,EAAOC,EAAa5wL,MAApB0wL,EAAA,GAAAM,4DCRIx9M,GAAA2mB,KAAApnB,EAAGE,QAAH,SAAAm+B,EAAA6/K,GACA,GAAO,MAAP7/K,EAEA,OADH59B,GAAAyC,QAAA,MACI,KAED,GAAAg7M,EAcOj5H,MAdK,CACR,IAAApgC,EAAIpkD,GAAJ+e,SAAYq5B,WACR,IAAAgM,EAKJ,OAAG,KAMPq5J,EAAAr5J,EAWA,IALJ,IAAIiuE,EAAAorF,mBAEJr0B,EAAAxrJ,EAAA1Z,MAAA,KAGQ1R,EAAAmsF,EAAiBnsF,EAAA42K,EAArBxpL,OAAA4S,IAAA,CACA,IAAAnT,EAAQ+pL,EAAR52K,GACAsyB,EAAKutF,EAAWh7D,UACZg7D,EAAI,KACJ,IAAA,IAAI7qH,EAAA,EAAA2mB,EAAA2W,EAAJllC,OAA4B4H,EAAA2mB,IAAA3mB,EAAA,CACxB,IAAAk2M,EAAQ54K,EAARt9B,GACA,GAAAk2M,EAAAr+M,OAAAA,EAAA,CACHgzH,EAAAqrF,EACJ,OAGA,IAAArrF,EACJ,OAAA,yCCrDL,IAAAsrF,EAAA,yGAKIC,EAAK,WACLx9M,KAAKy9M,iBACLz9M,KAAK09M,uBACL19M,KAAK09M,oBAAoBh4M,MAAM,QAAD,MAC9B1F,KAAK09M,oBAAoBh4M,MAAM,QAAD,MAC9B1F,KAAK09M,oBAAoBh4M,MAAM,SAAD,MAPlC1F,KAAA09M,oBAAAh4M,MAAA,UAAA,sDAYI83M,EAAOl7M,WACHwc,YAAK0+L,EACLt/G,MAAA,SAAAy/G,8BAEA39M,KAAI49M,UAIA,IAFJ,IAAAr/G,EAAO,EACH/+F,EAAIm+M,EAAgBn+M,OACpB++F,EAAI/+F,GAAmB,CACnB,IAAAq+M,EAAAF,EAAAh6L,QAAA,IAAA46E,GACA,GAAAs/G,EAAK,EACL79M,KAAA49M,OAAAl1M,MAHJ1I,KAIO89M,eAAAH,EAAA73F,UAAAvnB,IACHA,EAAK/+F,OAELQ,KAAI89M,eAAcH,EAAW73F,UAAXvnB,EAAlBs/G,IAEI,IAAAE,EAAAJ,EAAAh6L,QAAA,IAAA46E,IACc,IAAdw/G,EAEAA,EAAYF,EACT,MAAAF,EAAAj/G,OAAAm/G,EAAA,GACH79M,KAAK49M,OAAAl1M,MAET1I,KAAAg+M,YAAaL,EAAb73F,UAAA+3F,EAAA,EAAAE,IAGPx/G,EAAAw/G,EAAA,kEAWD,IAEIzvJ,EACA2vJ,EACAC,EACAC,EALAtnJ,KACAi4D,GAHJsvF,EAAAA,EAAAx9G,QAGAqxB,MAAA,uBAKI,GAAAnD,EAAA,CAGA,GAFAxgE,EAAGwgE,EAAA,GAEH,sCAAA,OAAAj4D,EAIM,OADJonJ,EAAAG,EAAAz6L,QAAA,KACI2qC,EAAI,IACA,IAAA,IAEAuI,EAAIr6C,MAHRyhM,GAEO,EACSG,EAAZt4F,UAAA,EAAAm4F,GAAAr9G,OAEJw9G,EAEA,MACA,IAAA,IAVNvnJ,EAAA5nB,KAAAlpB,SAAAq4L,UAgBIH,GAAW,IACXE,EAAAC,EAAAt4F,UAAAm4F,EAAA,GAAAr9G,OACHs9G,EAAAl+M,KAAAq+M,qBAAAF,GACDtnJ,EAAO3qC,MAAPgyL,KAMA,IADApvF,EAAAsvF,EAAUnsF,MAAU,kBACjBnD,EAAQ,GAAAtvH,OAAR,IACC8uD,EAAIwgE,EAAJ,GAAgBluB,QACX96C,WAAA,OAAoD,MAAzDwI,EAA8BA,EAAU9uD,OAAQ,GAGvD,OAFOq3D,EAAAynJ,WAAA,EACHt+M,KAAAu+M,mBAAA74M,MAAAosE,KAAA,GAAAxzB,OAAA8/C,SAAA,KACJvnC,EAKG,IADAi4D,EAAAsvF,EAAUnsF,MAAU,iCACjBnD,EAAQ,GAAAtvH,OAAR,IACC8uD,EAAAwgE,EAAS,GAAAluB,QACL96C,WAAJ,QAAA,MAAAwI,EAAAA,EAAA9uD,OAAA,GAAA,CAEA,IACAg/M,EAFA1vF,EAAIsvF,EAAAnsF,MAAJwsF,GAII,IADA,IAAAC,GAAA,EACA5vF,GAGAxgE,GADA8vJ,EAAAA,EAAAt4F,UAAAs4F,EAAAz6L,QAAAmrG,EAAA,MACoB/yB,OAAA,EAAU+yB,EAAA,GAAUtvH,QAKxCm/M,GAFAV,mCAA8Bt6L,QAAA,OAEZ,EAAA66L,EAAlBziH,OAAA,EAAAkiH,GAAAO,EAEAlwJ,wCAAYswJ,oBAERR,EAAII,EAAJ14F,UAAAm4F,GAAAr9G,OACI,QAAJtyC,GACAuI,EAAIimC,SAAS,EACT6hH,EAAA94J,SAAkB,OAAlB84J,EAAAA,EAAA74F,UAAA,EAAA64F,EAAAn/M,OAAA,IACoB,IAApBm/M,EAAAh7L,QAAW,MAFf+6L,GAGoB,EAChBC,EAAAA,EAAkB74F,UAAlB,EAAA64F,EAAAn/M,OAAA,IACkC,IAAlCm/M,EAAWh7L,QAAS,OACvB+6L,GAAA,EACGC,EAAMA,EAAV74F,UAAA,EAAA64F,EAAAn/M,OAAA,IAEAq3D,EAAI3+B,IAAAymL,GACe,WAAZrwJ,EACPuI,EAAIknC,YAAah4E,SAAS44L,GACP,UAAZrwJ,EACPuI,EAAIgnC,WAAa93E,SAAA44L,GACpB,UAAArwJ,gDAIAuI,EAAA3qC,OAAA,UAAAoiC,yDAYZ,OAJQowJ,GAAA7nJ,EAAAimC,4DASL,GADAgyB,EAAAsvF,EAAYnsF,MAAA,wBACR,CAEA,IAAA4sF,GAAqBriM,MAAA,UAAA7Y,MAAA,GACrB,GAFJy6M,EAAItvF,EAAW,GAAAhJ,UAAA,UAAAtmH,QAAAohG,OAEF,CACT,IAEI+9G,EAFAG,EAAJ,sEAGI,IAFJhwF,EAAOsvF,EAAQnsF,MAAA6sF,GAEXhwF,GAGAxgE,GADA8vJ,EAAAA,EAAAt4F,UAAAs4F,EAAAz6L,QAAAmrG,EAAA,MACoB/yB,OAAA,EAAU+yB,EAAA,GAAUtvH,QAKpCm/M,GAFAV,GADJO,EAAoBJ,EAAAt4F,UAAAx3D,EAAA9uD,QAAAohG,QACLj9E,QAAkB,OAC1B,EACQ66L,EAAXziH,OAAA,EAAAkiH,GAEMO,EAGVlwJ,wCAAYswJ,oBAERR,EAAII,EAAa14F,UAAAm4F,GAAqBr9G,OAC/B,UAFXtyC,EAGIuI,EAAA3qC,MAAAlsB,KAAAq+M,qBAAA/vJ,EAAA,IAAAqwJ,GACmB,UAAZrwJ,EACPuwJ,EAAqBriM,MAAQmiM,EAChC,UAAArwJ,yBAIAuI,EAAA3qC,OAAA,UAAAoiC,4CAIRwgE,EAAAsvF,EAAAnsF,MAAA6sF,eAOD,IADAhwF,EAAAsvF,EAAUnsF,MAAV,sBACAnD,EAAY,GAAAtvH,OAAU,EAAU,CAG1B,OAFN8uD,EAAOwgE,EAAA,GACLsvF,EAAAA,EAAAt4F,UAAAx3D,EAAA9uD,QAAAohG,OACItyC,EAAI,IACJ,IAAA,IACJuI,EAAA2oC,WAAA,EACI,MACA,IAAA,IACJ3oC,EAAAgmC,QAAA,EACI,MACA,IAAA,IATNhmC,EAAA0oC,MAAA,EAaC,GAAA,KAAA6+G,EACD,OAAWvnJ,EAEdqnJ,EAAAl+M,KAAAq+M,qBAAAD,uBAODC,qBAAA,SAAAU,GAKI,IAJJ,IAAI19L,EAAA,EACAw1C,KACJmoJ,EAAAD,EAAkB9sF,MAAAsrF,GACd0B,GAAI,EACJD,GAAI,CACJ,IAAA5pG,EAAa4pG,EAAb,GACAE,EAAc,GAGV,GAFJD,GAAG,EAEiB,OADhBF,EAAQA,EAAYj5F,UAAZ1Q,EAAR51G,QAAAohG,QACYlC,OAAI,IACZr9E,EAAA09L,EAAap7L,QAAA,IAAY,KACzB,IACHu7L,EAAAH,EAAAj5F,UAAA,EAAAzkG,GAAAu/E,OACDq+G,GAAA,GAEA59L,SACA,GAAe,MAAZ09L,EAAYrgH,OAAA,IACXr9E,EAAA09L,EAAap7L,QAAA,IAAY,KACzB,IACHu7L,EAAAH,EAAAj5F,UAAA,EAAAzkG,GAAAu/E,OACDq+G,GAAA,GAEA59L,QACA,CAEI,IAAA4wG,EAAA8sF,EAAa9sF,MAAb,YAEAitF,EAHJjtF,EAGiBA,EAAb,GAEI,WAKRgtF,MACH7pG,EAAAA,EAAA0Q,UAAA,EAAA1Q,EAAA51G,OAAA,GAAAohG,cAIJm+G,EAAAA,EAAAj5F,UAAAzkG,GAAAu/E,mDAQD,IAAI/pC,EAAK72D,KAALm/M,mBAAyBf,GAE5B,GAAM,IAFPp+M,KAEO49M,OAAAp+M,OACHQ,KAAG49M,OAAIl4M,KAAJmxD,OACC,CACH,GAAAA,EAAAynJ,WAAAznJ,EAAAimC,QACD,OAGI,IAAAsiH,EAAiBp/M,KAAA49M,OAAA59M,KAAA49M,OAAAp+M,OAAA,GACb,IAAA,IAAAkmD,KAAA05J,EACHvoJ,EAAAnR,KACJmR,EAAAnR,GAAA05J,EAAA15J,IA5Qc1lD,KAAA49M,OAAAl4M,KAAAmxD,KAmRfinJ,eAAA,SAAA/5M,GACH,KAAAA,IAIGA,EAAA/D,KAAKq/M,qBAAwBt7M,GADjC/D,KAEO49M,OAAAp+M,OAAA,EACHQ,KAAKu+M,mBAAmB74M,MAAMosE,KAAM/tE,EAApCu6C,MAAAt+C,KAAA49M,OAAA59M,KAAA49M,OAAAp+M,OAAA,KA1ReQ,KAAAu+M,mBAAA74M,MAAAosE,KAAA/tE,MAgSfs7M,qBAAU,SAAKp/D,GACf,IAAA,IAAI1gJ,EAAA,EAAQA,EAAAS,KAAK09M,oBAALl+M,SAAZD,EAAA,sCAEAwE,EAAU/D,KAAJ09M,oBAANn+M,GAAA,GAEJ0gJ,EAAAA,EAAAx5C,QAAA/gD,EAAA3hD,GArSR,OAAAk8I,0CCbIvgJ,EAAA,YAEJA,EAAQ,uLCHR,IAAA2e,EAAA3e,EAAA,kBAKIk6C,EAJJl6C,EAAA,6BAIsBk6C,KAElB0lK,EAAI,IAASjhM,EAAK26E,KAAL,KACbsmH,EAAI32L,IAAJ,WACI,IAAA8mB,EAAAzvC,KAAUm5F,cADd1pD,EAIImK,EAAA/T,KAAS+5B,SAAUnwB,GAEvBA,EAAAmK,EAAA/T,KAAAiH,YA6BA,IAAAyyK,EAAW,IAAAlhM,EAAK26E,KAAhB,IACAumH,EAAI52L,IAAM,WACN,IAAA4hB,EAAAvqC,KAASm5F,cACT5uD,GAFJA,EAIKjrC,EAAAirC,EAAA7mC,EAAA6mC,EAAAnB,EAAA,EACDmB,EAAA+I,EAAO,GAEX/I,EAAAqP,EAAArP,KAAAuC,YAKA3tC,EAAAE,SACAwmC,KAAAy5K,wFCyCJ,IAjGA,IAAAjhM,EAAA3e,EAAA,kBAOAC,GAEQg9M,eAAS,SAAO58M,EAAAy/M,EAA6BC,GAC7C,SAAI/8E,EAAIg9E,EAAAr8L,EAAA07G,EAAAC,GACJ,IAAAkD,EAAI59E,OAAQ26E,yBAAAygF,EAAAr8L,GACZ,GAAA6+G,EAECA,EAAAv5G,MAAA+2L,EAAA3gF,GAAAmD,EAAAv5G,KACGu5G,EAAAp2G,KAAAkzG,IAAgB0gF,EAAA1gF,GAApBkD,EAAAp2G,SACA,CACI,IAAA6zL,EAAID,EAAW3gF,GAQtB1gH,EAAAgR,OAAAqwL,EAAAr8L,EAAAs8L,EAAAD,EAAA1gF,KAKD,IAFJ,IAAA37G,EACIq8L,EAAA3/M,EAAAuC,UACI/C,EAAA,EAAAA,EAASigN,EAAYhgN,OAAZD,IAA4B,CAE5C,IAAAqgN,GADGv8L,EAAWm8L,EAAUjgN,IACxB,GAAA6/F,cAAA/7E,EAAA7a,MAAA,GACDk6H,EAAKg9E,EAALr8L,EAAiB,MAAjBu8L,EAAkC,MAAAA,GAE9B,IAAAv8L,KAAWo8L,EAAX,CACH,IAAApwL,EAAAowL,EAAAp8L,GA7BLq/G,EAAAg9E,EAAAr8L,EAAAgM,EAAA,GAAAA,EAAA,MAuCIwwL,QAAS,SAATvgN,UACAA,GAAS,EACTA,GAASA,GAAK,EACdA,GAASA,GAAK,EACdA,GAASA,GAAK,EACdA,GAAOA,GAAP,GAPJA,GAAAA,GAAA,OAmDAyuG,mBAAkB,mCAEY8uG,EAAA,IAAmBxpM,MAAnB,KAAuB9T,EAAA,EAAAA,EAAA,MAAAA,EACrDs9M,EAAgBt9M,GAAI,GAApB,IAEA,IAAAwlB,EAAA,EAAAA,EAAA,KAAAA,EACA83L,EAJgB,oEAIKt2I,WAArBxhD,IAAAA,EAEAplB,EAAAk9M,cAAAA,EAGIl9M,EAAA4lH,UAAY,SAAA7wF,EAAAgxB,EAAA3hD,EAAAmvH,GACR,IAAAjC,EAAIv8F,EAAMgxB,GACNurE,EACI59G,MAAA2P,QAAOiuG,GACPiC,GAFJjC,EAIKvrH,KAAAurH,EAAA,IACDA,EAAO,GAAKltH,GAGfktH,EAAAvrH,KAAA3B,GAIJ2wB,EAAAgxB,GAAAwtE,GAAAnvH,EAAAktH,IAAAA,EAAAltH,GAhBT2wB,EAAAgxB,GAAA3hD,GAwCQpE,EAAAoF,OAAI,SAAOhB,EAAA+7M,EAAXC,GACA,GAAAD,EAAgBC,EAAhB,CACA,IAAAj2E,EAAAg2E,EACHA,EAAAC,EACDA,EAAej2E,wBAgBlBnqI,EAFD+lF,QAAA,SAAA3hF,yBAeCpE,EAFDsqB,KAAA,SAAAlhB,EAAAmD,EAAAgO,qBAYCva,EAFDqgN,iBAAA,SAAAhqM,0BAYCrW,EAFDsgN,iBAAA,SAAAjqM,4FC1LI,SAAKuM,EAALD,GACHtiB,KAAAT,EAAA,eAID,IAAAouB,EAAApL,EAAgCjgB,UAE5BqrB,EAAAo7B,OAAI,SAAYhlD,GACZ,IAAAsd,EAAKrhB,KAALsiB,MAAAqB,QAAA5f,GACHsd,GAAA,GAJLrhB,KAAAmhF,SAAA9/D,2BASIrhB,KAAIsiB,MAAKnC,OAAQ5gB,EAAA,GAEhBA,GAAAS,KAAAT,KALLS,KAAAT,GASIouB,EAAA8sC,WAAA,SAAgB12D,GACZ,IAAAsd,EAAKrhB,KAAAsiB,MAAaqB,QAAlB5f,GACHsd,GAAA,GAJLrhB,KAAA0nB,aAAArG,IAQIsM,EAAAjG,aAAiB,SAAMnoB,GACvB,IAAE+iB,EAAMtiB,KAARsiB,2BAEAA,EAAI9iB,OAEHD,GAAAS,KAAAT,KAPLS,KAAAT,GAYCouB,EAFDjoB,KAAA,SAAA80B,6DC3CA,IAAGof,EAAAl6C,EAAc,eAASwhC,aAAA0Y,KAEtBh6C,GAAAsgN,YAAAtgN,GAAAE,OACAb,KAAA,gBAEIupB,YAEA9F,KAAA,KAIA6jC,MAAA,KAGA45J,OAAA,GAGA5nJ,MAAA,EAGI6Q,SAFK3gD,SAAA,EAfD+sC,cAAA,MAoCZr2D,EAAAE,SAEIm5D,eAAA,SAAA/zB,GACA,IAAA6zB,EAAQ7zB,EAAU6zB,QAIV,GAFRA,EAAK8Q,SAAL,GAEQ9Q,EAAI/R,aASR3mD,GAAKyC,QAAU,KAAfoiC,EAAAxlC,WAEHwlC,EAAA6zB,QAAA,MAKD,IAAIxD,EAAWrwB,EAAfqwB,UACIja,EAAQpW,EAAKoW,QACbj7B,EAAA6kB,EAAU7kB,IACV0N,EAAImX,EAAKnX,MACTq0C,EAASl9B,EAAAk9B,QACTriE,EAAAmlC,EAAQ4V,UAAZ/6C,EACIoE,EAAA+gC,EAAA4V,UAAe32C,EACf0uC,EAAA3N,EAAA2N,uBAEJguK,EAAA37K,EAAA27K,cAGIxgN,GAAA06B,KAAA2vB,YAAc,EAGdqO,EAAA/R,MAAA2iB,eAAAzkC,GAYJ7kC,GAAA06B,KAAA2vB,YAAA,EAGAxlB,EAAKqwB,UAALA,EACArwB,EAAKoW,QAAUA,EACfpW,EAAK7kB,IAALA,EACA6kB,EAAK6zB,QAAUA,EACf7zB,EAAKnX,MAAAA,EACLmX,EAAKk9B,QAAUA,EACfl9B,EAAK4V,UAAU/6C,EAAAA,EACfmlC,EAAK4V,UAAA32C,EAALA,EACAk2C,EAAKrP,KAAA2J,KAAAzP,EAAL2N,MAAqBA,GACxB3N,EAAA8wB,aAAAA,EAhEL9wB,EAAA27K,cAAAA,+CCrCA,IAAMv4M,EAAAnI,EAAc,0BAEhB2gN,EAAW3gN,EAAf,uBAGIywF,EAAS,GAETuQ,EAAA,KACAs2D,EAAS,YAEbspD,EAAS,8BA8FL,IAAAC,IAAgBA,EAAQx0L,QAAxB,kCAGUzsB,EAAAihN,EAAa78M,EAAG,gDAG1B9D,GAAAsnD,OAAUq3B,0CAGV3+E,GAAA06B,KAAIuxB,mBAAmB00J,GAEvB,IAAA9hK,EAAA,IAAc7+C,GAAA2jB,KAAd,cACAk7B,EAAIrG,QAAAqG,EAAYpG,QAAK,EACrBoG,EAAA95C,OAAA47M,EACA,IAAAC,EAAU/hK,EAAW+sC,aAArB5rF,GAAA0vF,OACAkxH,EAAU7vH,KAAA+P,eAEV8/G,EAAIlwH,WAAQH,EAEZ,IAAAvX,EAAM,IAAUh5E,GAAhB2jB,KAAA,eACAq1D,EAAMxgC,QAAN,EACAwgC,EAAMvgC,QAAS,EACfugC,EAAIt5E,EAAA,IACJs5E,EAAAj0E,OAAW47M,EACX,IAAAE,EAAA7nI,EAAkB4S,aAAlB5rF,GAAA0vF,OACAmxH,EAAWzwH,gBAAWpwF,GAAtB0vF,MAAAR,gBAAA5T,MACAulI,EAAW9vH,KAAA+P,eAEX+/G,EAASnwH,WAAAH,EAELmwH,GAFJ7hK,KAAA+hK,EAIH5nI,MAAA6nI,KAKGC,GAEA,IAAAj/J,EAAO7hD,GAAA+e,SAASuiC,YACnB81G,EAAA,MAAA2pD,SAAAj3L,MAAA+3B,6BAIG,SAAIm/J,IACA,IAAAn/J,EAAAD,YAAgBC,MADpB7hD,GAGK+e,SAAAoJ,WACDivI,EAAA,MAAgB2pD,SAASj3L,MAAI+3B,GAEjCu1G,EAAiB,MAAA2pD,SAASh3L,IAAM83B,8BAYhC,SAAAo/J,IACA,IAAAp/J,EAAOD,YAASC,MAChBu1G,EAAA,OAAgB2pD,SAASh3L,IAAI83B,GAC7Bu1G,EAAc,MAAA2pD,SAAS58M,MAAvBnE,GAAAuhC,SAAA65H,kCAEAhE,EAAW,IAAX2pD,SAAAx8L,MAAAs9B,GAEA,IAAAhD,EAAA,GACIm6B,EAAI,GACJ,IAAA,IAAKvgD,KAAA2+H,EAAS,YAEd8pD,EAAAH,SAAah8L,OAAO88B,GAEvBhD,GAAAqiK,EAAAt6E,KAAA,gCAIJ85E,EAAA7hK,KAAAmxC,OAAAnxC,mBAIO7+C,GAAAggD,SAAAzgD,EAAOE,SACVwgD,eAH0B,WAK3B,OAL2BkhK,GAOnB9gK,UAAA,WACI8gK,IACHR,iBAID3gN,GAAG+e,SAAS8P,IAAI7uB,GAAG8gD,SAAS4H,oBAAkB04J,GAC9CphN,GAAA+e,SAAW8P,IAAX7uB,GAAA8gD,SAAA8E,mBAAAo7J,GACHhhN,GAAA+e,SAAA8P,IAAA7uB,GAAA8gD,SAAAiI,iBAAAk4J,GAfsBE,GAAA,IAoBnB/gK,UAAA,WACA+gK,eAjMR,IAAIrgH,EAAJ,KAKAnmE,EAAaZ,SAASC,cAAA,oCAEtBW,EAAA+jB,MAAA16C,OAAA22B,EAAA32B,OAJa,IASb,IAAIqgJ,EAAA1pH,EAAJ4yF,WAAA,MACA82B,EAAItzD,KAAAR,EAAJ,WACA8zD,EAAIsmD,aAAY,yBAEhBtmD,EAAI6S,UAAJ,OAEA,IACIx3J,EADI,IAAA,EAGRgxF,EAAgBH,GAEZuQ,EAAA,IAAA9gG,GAAWsoE,YACXH,YACAk+H,UAAU,iBACVgb,aAAa3wH,EACbxoB,SAAAqoB,EALJ20G,8DAWApkG,EAAI54B,SAAcqoB,EAId,IAFJ,IAAA+wH,EAASxgH,EAAQ34B,WAAUo8H,kBAEnB5kM,EAAA,GAAQA,GAAI,IAAAA,IAAY,8BAEvBoE,EAAIsgJ,EAALk9D,YAAe5e,GAAc5+L,MAE7BrE,EAAAqE,SACHrE,EAxBG,EAyBAoE,GAAA4sF,EAzBA,GA2BJ2zD,EAAA2lD,SAAUrH,EAAAjjM,EAAAoE,GAENw9M,EAAA3hN,IACAglM,SAHM5gM,EAIN0gM,QAAM,EACFC,QADE,EAEF1hM,MACAtD,EAAAA,EACAoE,EAAAA,EAJEC,MAAAA,EAJVC,OAAA0sF,SA3BI,yBA6CRphD,EAAIolC,gBAAkB/5C,4BAGtBpR,EAAOulD,WAAcx/B,kCAMrB,IAAA8nH,EAAA,CAEIA,GACA7yI,OAASqiH,KAAM,kBAHVlhI,IAAA,EAAAC,IAAA,GAAA67M,QAAA,KAIL9sL,KAAOkyG,KAAE,kBAAF66E,MAAgC,GAAGD,QAAS,KACnDE,OAAQ96E,KAAE,aACV+6E,OAAQ/6E,KAAM,kBAAAlhI,IAAuB,EAAGC,IAAK,GAAA67M,QAAA,IAAoB5kM,MAAnD,QANlBzN,QAAAy3H,KAAA,gBAAAlhI,IAAA,EAAAC,IAAA,GAAA67M,QAAA,IAAA5kM,MAAA,2FAWI,IAAAilC,EAAAD,YAAWC,MACd,IAAA,IAAAppB,KAAA2+H,EACJA,EAAA3+H,GAAAsoL,SAAA,IAAAN,EAAAhoL,EAAA2+H,EAAA3+H,GAAAopB,IA8GW+/J,GAECjB,iBAID3gN,GAAG+e,SAASuP,GAAGtuB,GAAG8gD,SAAS4H,oBAAkB04J,GAC7CphN,GAAA+e,SAAWuP,GAAXtuB,GAAA8gD,SAAA8E,mBAAAo7J,GACHhhN,GAAA+e,SAAAuP,GAAAtuB,GAAA8gD,SAAAiI,iBAAAk4J,GACJE,GAAA,OCpPDU,yBADmB,IAAAC,iBAAA,MAAAC,KAAA,SAAAjiN,EAAAP,EAAAE,GAEnB,IAAAuiN,EAFmBhiN,GAAAE,OAGfb,KAAA,aACAc,KAAA,SAAAs4B,EAAay2B,EAAQrN,cAErBzhD,KAAKy4L,MAAL3pI,MAEA9uD,KAAK6hN,OAAA,EACL7hN,KAAKyU,OAAA,EACLzU,KAAK8hN,cAAgB,EACrB9hN,KAAK+hN,YAAc,EAXJ/hN,KAAAgiN,cAAA,sBAgBXx5L,YACIzkB,OACH4kB,IAHE,WAAA,OAAA3oB,KAAA6hN,QAMF/1L,IAAA,SAAA0C,GANExuB,KAAA6hN,OAAArzL,KAYHyzL,SAAA,SAAKzzL,EAAAizB,GACL,GAAAzhD,KAAEy4L,MAAK2oB,QAAP,uBAEAphN,KAAIgiN,cAEA,IAAA56M,EAAAq6C,EACAr6C,EAAApH,KAAKkiN,aAALliN,KAAAy4L,MAAA2oB,UACAphN,KAAK8hN,cAAL9hN,KAAA+hN,YAAA/hN,KAAAgiN,cACAhiN,KAAK+hN,YAAL,EACH/hN,KAAAkiN,YAAA96M,EACJpH,KAAAgiN,cAAA,KAKJr9L,OA1CkB,SAAA88B,GA4CnBzhD,KA5CmBiiN,SAAAjiN,KA4CV6hN,OAAApgK,IAEL0gK,MAAA,WA9Ce,IAAA3zL,EAAAxuB,KAAAy4L,MAAA2oB,QAAAphN,KAAA8hN,cAAA9hN,KAAA6hN,OAiDnB,OAjDmBx8M,KAAAqN,MAiDV,IAAA8b,GAAA,KAKR4zL,MAAA,WAtDL,OAAApiN,KAAAy4L,MAAA4oB,OAAArhN,KAAA6hN,OAAA7hN,KAAAy4L,MAAA4oB,OAAArhN,KAAAy4L,MAAA4pB,MAAAriN,KAAA6hN,OAAA7hN,KAAAy4L,MAAA4pB,8CCEA,IAAIT,EAAAliN,EAAiB,aAEnB2gN,EAFyBzgN,GAAAE,6BAIzByB,QAJyBqgN,EAMvB7hN,KAAA,SAAAs4B,EAAAy2B,EAAArN,GAMFzhD,KAZyB+mF,MAAAtlC,qBAevBzhD,KAAA+mF,MAAAtlC,mBAOAzhD,KAAA6hN,OAAApgK,EAAAzhD,KAAA+mF,MAOF/mF,KA7ByBiiN,SAAAjiN,KA6BlB6hN,SAELS,KAAA,WA/BuBtiN,KAAA2pB,MAkCzB3pB,KAlCyB0pB,SAoCvBvF,MAAI,SAAQs9B,GACZ,IAAAr6C,EAAKq6C,EACD2qD,EAAAhlG,EAAMpH,KAAK+mF,oBAIbqlB,GAFMpsG,KAAKy4L,MAAA2oB,SAAA,OAGXphN,KAAK6hN,OAAL,IAAA7hN,KAAAyU,OAAA23F,EACApsG,KAAKyU,OAAS,EACfzU,KAAA+mF,MAAA3/E,EACFpH,KAAAiiN,SAAAjiN,KAAA6hN,4ECnBCU,cAAA,8HACAC,gBAAA,mEACAC,kBAAA,6fACAC,kBAAA,kgCAEAC,sBAAc,EAEVhkH,aAAI,SAAAq6D,SACe,2CACE,mIAZb,8FAkBRp6D,eAAS,SAAWo6D,UAlBZA,EAAAA,EAAAzyF,WAAA,wHAuBRsmD,gBAAO,SAAUo3B,EAAOr0D,GAvBhB,IAAAgzH,EAAA3+D,EAAAk9D,YAAAvxH,yBA4BRwM,aAAI,SAAed,EAAnBmvG,EAAA3wG,EAAAqnH,GAEA,IAAG0B,KAEC,GAAA,IAAAvnH,EAAO97F,QAAPs6F,EAAA,SACH+oH,EAAAn9M,KAAA,MAKG,YAAA+kM,EAAI3wG,GAAWhoB,EAAgBtyE,OAAA,GAAW,CAYtC,IAVJ,IAAIsjN,EAAQhxI,EAAAtyE,QAAWs6F,EAAY2wG,GAAnC,EACIsY,EAAQjxI,EAAZiqB,OAAA+mH,GACIn/M,EAAA8mM,EAAJ0W,EAAA4B,OAEIC,EAAA,MAMAr/M,EAAWm2F,GAAXmpH,IAHJ,IAIIH,GAAUhpH,EAAYn2F,EACtBm/M,GAAmB,QACtBC,EAAAjxI,EAAAiqB,OAAA+mH,IAOO,IAHRG,EAAA,EAGQt/M,GAAIm2F,GAAYmpH,IAbxB,IAaQ,CACA,GAAAF,EAAA,CACA,IAAArlE,EAAQ19I,KAARuiN,cAAA7kE,KAAAqlE,GACHC,EAAAtlE,EAAAA,EAAA,GAAAl+I,OAAA,MAIDsjN,GAAmBE,QACtBD,EAAAjxI,EAAAiqB,OAAA+mH,IAKW,IADRA,GAAAE,KAEHF,EAAA,qBAIDxuM,kBAGQtU,KAAA2iN,sBACA3iN,KAAAwiN,gBAAqB5hI,KAAAsiI,GAAUH,KAGlB,QAFbzuM,EAAItU,KAAAyiN,kBAAgB/kE,KAAAylE,qBAEAL,EAApB,GAEHI,EAAApxI,EAAAiqB,OAAA+mH,GACJK,EAAArxI,EAAAiqB,OAAA,EAAA+mH,IAKG9iN,KAAIojN,mBAAoBxiI,KAAAsiI,KACpB5uM,EAAAtU,KAAA0iN,kBAAAhlE,KAAAylE,KACQA,IAAY7uM,EAAA,KACpBwuM,GAAQxuM,EAAA,GAAA9U,OACX0jN,EAAApxI,EAAAiqB,OAAA+mH,GACJK,EAAArxI,EAAAiqB,OAAA,EAAA+mH,IAMI,IAHLD,EAGKrjN,OACDqjN,EAAQn9M,KAAAy9M,IAEJA,EAAAA,EAAAviH,QACHphG,OAAA,GACJqjN,EAAAn9M,KAAAy9M,OAGJrxI,EAAAoxI,GAAAH,GAhHT,OAqHa,IAHLF,EAGKrjN,OACDqjN,EAAYn9M,KAAZosE,IAEIA,EAAAA,EAAA8uB,QACHphG,OAAA,GACJqjN,EAAAn9M,KAAAosE,GA1HT+wI,8BCEA,IAAA1zK,EAAAzvC,EAAA,yBAOQ2tE,6BAEAztE,GAAAygB,SAAUqb,EAAG,MAET,IAAAyyF,EAAIvuH,GAAI47B,OAAQuoF,OAAAroF,GACZ,OAAAyyF,EACAA,EAAA5yF,QAFJwc,GAKAA,EAAAx1C,KAAArC,EAAAiuH,GACQA,IAEHA,EAAE//F,KAFH,OAAA,WAGA2pB,GAAAA,EAAAx1C,KAAArC,EAAAiuH,IACHjuH,GAEAiuH,KAGDA,EAAG,IAAOh/E,GACNzT,IAAIA,EACA97B,GAAA47B,OAAAC,MAAOC,IAAMA,EAAGwT,QAAHi/E,GAAgB,SAAOlzF,EAAUiU,GACjD,GAAAjU,EACD,OAAQ8c,GAAAA,EAAAx1C,KAAArC,EAAR+6B,GAAA,IAAAykB,MAAA,kBAJJxQ,EAAA8lC,sBAOAj9B,GAAAA,EAAAx1C,KAAArC,EAAA,KAAAgvC,KA5BMi/E,IAkCNk1F,WAAI,SAAU3nL,EAAAiV,GACd,GAAAjV,GAAIiV,EAAA,CACJ,IAAIw9E,EAAA,IAAOh/E,EACPg/E,EAAA75C,gBADO3jC,GAEP,IAAAnW,GACAnC,GAAAqD,EACAA,IAAAA,EACAf,MAAA,KALJ6sC,QAAA2mD,EAOG7mD,UAAO,GA3CJ,OA6CT1nE,GAAA47B,OAAA64F,QAAA75F,GA7CS2zF,IAkDNt+C,gBAAA,SAAY3gC,EAAZ/gB,GACA+gB,EAAA3T,OACHpN,GAAAA,IAGG+gB,EAAAxT,IAKA97B,GAAA47B,OAAAC,MACAC,IAAAwT,EAAQxT,IAERE,OAAI,WACA,SAAIX,EAAA0V,GACAA,IAIHzB,EAAA3T,SACJ2T,EAAAxV,aAAAiX,IAGRxiB,GAAAA,EAAA8M,KAjBI9M,GAAAA,6GC5DL9P,EAAA3e,EAAS,kBAETgd,EAAA,WA2BQ,SAAAA,EAAAxC,EAAAyC,EAAAzQ,EAAAnD,GACA,iBAAAmR,IACAyC,EAAIzC,EAAEyC,EACNzQ,EAAIgO,EAAEhO,EACTnD,EAAAmR,EAAAnR,EACGmR,EAAAA,EAAJA,GAEAA,EAAIA,GAAK,EACTyC,EAAIA,GAAA,EACJzQ,EAAAA,GAAA,EACHnD,EAAA,iBAAAA,EAAAA,EAAA,IACE/I,KAAH0nH,MAAiB3+G,GAAA,KAAjB,IAAAmD,GAAA,KAAAyQ,GAAA,GAAAzC,gBAGAxa,EAAI,uBAAgB+kI,WAAA,WAAA/nH,GAAAxC,EAAA,EAAAyC,EAAA,EAAAzQ,EAAA,EAAAnD,EAAA,MAEhB,IAAAu6M,gMAyFJC,SAAS,IAAT,EAAsB,MAEd,IAAA,IAAAC,KAAOF,EACHjlM,EAAAsK,IAAAjM,EAAA8mM,EAAiB,SAAS3sD,GAC7B,OAFD,WAGD,OAAA,IAAcn6I,EAAdm6I,EAJH,GAAAA,EAAA,GAAAA,EAAA,GAAAA,EAAA,KAEyB,QAO7B,IAAAlpI,EAAAjR,EAAApa,iBAWIqrB,EAAAttB,MAAA,WACA,IAAAgV,EAAA,IAAAqH,SAHJrH,EAAAqyG,KAAA1nH,KAAA0nH,QAqBC/5F,EAFDyoC,OAAA,SAAAqtJ,iCAgBI91L,EAAA1D,KAAQ,SAARsiJ,EAAAroJ,EAAAuQ,GACAA,EAAIA,GAAS,IAAb/X,EACA,IAAIxC,EAAIla,KAAKka,EACTyC,EAAI3c,KAAK2c,EACTzQ,EAAIlM,KAAKkM,EACTnD,EAAI/I,KAAK+I,SACb0rB,EAAIva,EAAIA,GAAKqyJ,EAAGryJ,EAAIA,GAAKgK,EACzBuQ,EAAI9X,EAAIA,GAAK4vJ,EAAG5vJ,EAAIA,GAAKuH,EACzBuQ,EAAAvoB,EAAOA,GAAPqgK,EAAArgK,EAAAA,GAAAgY,EAVJuQ,EAAA1rB,EAAAA,GAAAwjK,EAAAxjK,EAAAA,GAAAmb,KA4BCyJ,EANDk5C,SAAA,iHAgBCl5C,EAFD+1L,KAAA,WAGA,OAAA,IAAA1jN,KAAA0nH,MAYI/5F,EAAAg2L,KAAA,SAAmBvnM,GAGvB,OAFIA,IAAOxc,GAAPD,KAAAoF,OAAAqX,EAAA,EAAA,KAHJpc,KAAA0nH,MAAA,WAAA1nH,KAAA0nH,KAAAtrG,KAAA,EAKApc,MAQC2tB,EAFDi2L,KAAA,WAGA,OAAA,MAAA5jN,KAAA0nH,OAAA,GAYI/5F,EAAAk2L,KAAA,SAAmBxnM,GAGvB,OAFIA,IAAOzc,GAAPD,KAAAoF,OAAAsX,EAAA,EAAA,KAHJrc,KAAA0nH,MAAA,WAAA1nH,KAAA0nH,KAAArrG,GAAA,KAAA,EAKArc,MAQC2tB,EAFDm2L,KAAA,WAGA,OAAA,SAAA9jN,KAAA0nH,OAAA,IAYI/5F,EAAAo2L,KAAA,SAAmBznM,GAGvB,OAFIA,IAAO1c,GAAPD,KAAAoF,OAAAuX,EAAA,EAAA,KAHJtc,KAAA0nH,MAAA,WAAA1nH,KAAA0nH,KAAAprG,GAAA,MAAA,EAKAtc,MAQC2tB,EAFDq2L,KAAA,WAGA,OAAA,WAAAhkN,KAAA0nH,QAAA,IAYI/5F,EAAAs2L,KAAA,SAAmB/0J,UACnBA,IAAOtvD,GAAPD,KAAAoF,OAAAmqD,EAAA,EAAA,KAHJlvD,KAAA0nH,MAAA,SAAA1nH,KAAA0nH,KAAAx4D,GAAA,KAAA,KAAA,QAQA7wC,EAAGgR,OAAO1B,EAAO,IAAKA,EAAM+1L,KAAM/1L,EAAMg2L,MAAM,GAC9CtlM,EAAGgR,OAAO1B,EAAO,IAAKA,EAAMi2L,KAAMj2L,EAAMk2L,MAAM,oCAE9CxlM,EAAAgR,OAAA1B,EAAA,IAAAA,EAAAq2L,KAAAr2L,EAAAs2L,MAAA,GAUQt2L,EAAA67E,MAAA,SAAO06G,GAMV,MACS,SARVA,EASW,SAAA,EACFlkN,KAAAka,GAAe,KADb,EAEFla,KAAA2c,GAAe,KAFb,EAGF3c,KAAAkM,GAAe,KAHpBlM,KAAA+I,EAAA,KAAAo9L,QAAA,GAAA,IAMC,QAAA+d,EACM,QAAiB,EAAXlkN,KAAKka,GAAlB,KAAA,EAAAla,KAAA2c,GAAA,KAAA,EAAA3c,KAAAkM,GAAA,IAjBR,IAAAlM,KAAAmkN,MAAAD,IAkCIv2L,EAAA0xE,QAAQ,SAAS+kH,GACjBA,EAAQ,IAAAA,EAASzgM,QAAU,KAAnBygM,EAARt+F,UAAA,GAAAs+F,EACA,IAAIlqM,EAAI6L,SAASq+L,EAAUroH,OAAO,EAAG,GAAI,KAAO,EAC5Cp/E,EAAIoJ,SAASq+L,EAAUroH,OAAO,EAAG,GAAI,KAAO,EAChD7vF,EAAK6Z,SAASq+L,EAAFroH,OAAmB,EAAG,GAAtB,KAAgC,EAC5ChzF,EAAOgd,SAAPq+L,EAAAroH,OAAA,EAAA,GAAA,KAAA,WAPJ/7F,KAAA0nH,MAAA3+G,GAAA,KAAA,IAAAmD,GAAA,KAAAyQ,GAAA,GAAAzC,QA4BIyT,EAAAw2L,MAAA,SAAAxtK,GACA,IAAKi1H,IAAiB,EAAT5rK,KAAAka,GAAS2sD,SAAA,KAAA,EAAA7mE,KAAA2c,GAAAkqD,SAAA,KAAA,EAAA7mE,KAAAkM,GAAA26D,SAAA,KAClBtnE,GAAM,EACF,GAAK,SAALo3C,EACI,IAAAp3C,EAAA,EAAIA,EAAJqsK,EAASpsK,SAATD,EACHqsK,EAAArsK,GAAAC,OAAA,IACJosK,EAAArsK,GAAAqsK,EAAArsK,GAAA,SAIG,GAAY,YAAZo3C,EACI,IAAAp3C,EAAA,EAAIA,EAAJqsK,EAASpsK,SAATD,EACH,IAAAqsK,EAAArsK,GAAAC,SACJosK,EAAArsK,GAAA,IAAAqsK,EAAArsK,SAID,GAAa,cAAPo3C,EAEE,IADJi1H,EAAAlmK,MAAY,EAAP1F,KAAO+I,GAAP89D,SAAsB,KACvBtnE,EAAA,EAAIA,EAAJqsK,EAASpsK,SAATD,EACH,IAAAqsK,EAAArsK,GAAAC,SACJosK,EAAArsK,GAAA,IAAAqsK,EAAArsK,uBAgBRouB,EAFD02L,WAAA,sCAmBI12L,EAAA22L,QAAA,SAAa/wK,EAAAhsC,EAAAinB,GACT,IAAAtU,EAAAyC,EAAIzQ,EACP,GACI,IAHL3E,EAII2S,EAAIyC,EAAAzQ,EAAJsiB,OAEC,GACI,IAHLA,EAIItU,EAAIyC,EAAAzQ,EAAJ,MACA,CACA,IAAIqnC,IAAJA,EAAA,GACAA,GAAA,EACAhsC,EAAIA,EACJinB,EAAIA,EACJ,IAAIjvB,EAAI8F,KAAK4xB,MAAbsc,GACI09F,EAAI19F,EAAAh0C,EACJiH,EAAIgoB,GAAK,EAAKjnB,GAClBmpB,EAAQlC,GAAR,EAAAjnB,EAAA0pI,GACI7pI,EAAAonB,GAAA,EAAAjnB,GAAA,EAAA0pI,IACI,OAAA1xI,GACA,KAAA,EACA2a,EAAIsU,EACJ7R,EAAAvV,MAEJ,MAEI,KAAA,EACA8S,EAAIwW,EACJ/T,EAAA6R,MAEJ,MAEI,KAAA,EACAtU,EAAI1T,EACJmW,EAAA6R,MAEJ,MAEI,KAAA,EACAtU,EAAI1T,EACJmW,EAAA+T,MAEJ,MAEI,KAAA,EACAxW,EAAI9S,EACJuV,EAAAnW,MAEJ,MAEI,KAAA,EACA0T,EAAIsU,EACJ7R,EAAAnW,EAnCR0F,EAAAwkB,UAyCRxW,GAAK,IACLyC,GAAK,IACLzQ,GAAA,IA9DJlM,KAAA0nH,MAAA1nH,KAAA+I,GAAA,KAAA,IAAAmD,GAAA,KAAAyQ,GAAA,GAAAzC,QA4EIyT,EAAA42L,MAAQ,WACR,IAAIrqM,EAAIla,KAAKka,EAAI,IACbyC,EAAA3c,KAAQ2c,EAAF,IACNzQ,EAAAlM,KAAMkM,EAAK,IACXs4M,GAAMjxK,EAAK,EAALhsC,EAAA,EAAAinB,EAAV,GACIjpB,EAAAF,KAAJE,IAAA2U,EAAAyC,EAAAzQ,GACI5G,EAAID,KAARC,IAAA4U,EAAAyC,EAAAzQ,GACI1H,EAAI,SACRggN,EAAIh2L,EAACjpB,EAEDi/M,EAAAj9M,EAAAhC,GAAQA,EAARD,GAAAC,EAAA,EACAi/M,EAAIj9M,GAGJ/C,EAAAe,EAAAD,EACek/M,EAAIjxK,EAAfr5B,IAAA3U,GAAoBoX,EAATzQ,GAAA1H,EAAAmY,IAAApX,EAAA,GAAA2G,EAAAgO,GAAA1V,EAAA,GAAA0V,EAAAyC,GAAAnY,EAClBggN,EAAAjxK,GAAA,EACMixK,EAAPjxK,EAAA,IAAAixK,EAAAjxK,GAAA,IANQixK,EAAMjxK,EAAK,KAWf5lB,EAAA7B,IAAA,SAAYtP,GADhBA,EAGKkrG,KACD1nH,KAAK0nH,KAAIlrG,EAATkrG,MAEA1nH,KAAKka,EAAIsC,EAAMtC,EACfla,KAAK2c,EAAIH,EAAMG,EAClB3c,KAAAkM,EAAAsQ,EAAAtQ,EATLlM,KAAA+I,EAAAyT,EAAAzT,MAphBA,GAqiBJnJ,GAAA8c,MAAAA,EAuBQ9c,GAAA4c,MAAA,SAAiBtC,EAAGyC,EAAAzQ,EAApBnD,GACA,MAAO,iBAAAmR,GACV,IAAAta,GAAA8c,OACgB2iF,QAAjBnlF,GAEC,iBAAAA,EACW,IAAGta,GAAA8c,MAAPxC,EAAmBA,EAAGA,EAA9ByC,EAAAzC,EAAAhO,EAAAgO,EAAAnR,wICrkBJrJ,EAAQ,gBACRA,EAAQ,UACRA,EAAQ,UACRA,EAAQ,UACRA,EAAQ,UACRA,EAAQ,sBAERA,EAAA,gOCRA,IAAM+hI,EAAU/hI,EAAQ,gBAClB2e,EAAA3e,EAAO,kBACPsgI,EAAOtgI,EAAb,uBAEAmmC,sCAAAA,KAkCI,SAAA4+K,EAAQ/0K,EAARC,EAAAC,EAAAC,EAAAO,EAAAC,EAAAC,EAAAC,EAAAgwH,EAAAC,EAAAC,EAAA0H,EAAAC,EAAAC,EAAAC,EAAAC,GACA,IAAEnhK,EAAMpH,KACRoH,EAAEsoC,IAAMA,EACRtoC,EAAEuoC,IAAMA,EACRvoC,EAAEwoC,IAAMA,EACRxoC,EAAEyoC,IAAMA,EACRzoC,EAAE0oC,IAAMM,EACRhpC,EAAE2oC,IAAMM,EACRjpC,EAAE4oC,IAAMM,EACRlpC,EAAE6oC,IAAMM,EACRnpC,EAAE8oC,IAAMqwH,EACRn5J,EAAE+oC,IAAMqwH,EACRp5J,EAAEgpC,IAAMqwH,EACRr5J,EAAEipC,IAAM83H,EACR/gK,EAAEkpC,IAAM83H,EACRhhK,EAAEmpC,IAAM83H,EACXjhK,EAAAopC,IAAA83H,EACElhK,EAAAqpC,IAAO83H,EAENlqJ,EAAAmE,OADgCiiM,EACxBhjF,GACRzB,EAAAyE,WAFgC,UAERggF,GACxB/0K,IAAK,EAAGC,IAAK,EAAGC,IAAK,EAAGC,IAAK,EAC7BC,IAAK,EAAGC,IAAK,EAAGC,IAAK,EAAGC,IAAK,0BAE9BK,IAAM,EAAAC,IAAK,EAAAC,IAAW,EAAAC,IAAA,IAErBpyB,EAAA21F,MAAAywG,EAAAniN,WAQIjC,MAAA,WAViB,IAAA+G,EAAApH,oHA2BjB8rB,IAAA,SAAUvkB,GACV,IAAEH,EAAMpH,YACRoH,EAAEsoC,IAAMnoC,EAAEmoC,IACVtoC,EAAEuoC,IAAMpoC,EAAEooC,IACVvoC,EAAEwoC,IAAMroC,EAAEqoC,IACVxoC,EAAEyoC,IAAMtoC,EAAEsoC,IACVzoC,EAAE0oC,IAAMvoC,EAAEuoC,IACV1oC,EAAE2oC,IAAMxoC,EAAEwoC,IACV3oC,EAAE4oC,IAAMzoC,EAAEyoC,IACV5oC,EAAE6oC,IAAM1oC,EAAE0oC,IACV7oC,EAAE8oC,IAAM3oC,EAAE2oC,IACV9oC,EAAE+oC,IAAM5oC,EAAE4oC,IACV/oC,EAAEgpC,IAAM7oC,EAAE6oC,IACVhpC,EAAEipC,IAAM9oC,EAAE8oC,IACVjpC,EAAEkpC,IAAM/oC,EAAE+oC,IACVlpC,EAAEmpC,IAAMhpC,EAAEgpC,IACVnpC,EAAAopC,IAAOjpC,EAAAipC,IA3CUppC,EAAAqpC,IAAAlpC,EAAAkpC,UAuDpB2lB,OAvDoB,SAAAqtJ,iCAoEpBiB,YApEoB,SAAAjB,4BA8EjB58I,SAAA,WA9EiB,IAAAz/D,EAAApH,sMA+FpB4/D,SA/FoB,oCAyGjB8gG,UAAO,SAAKjsI,UAzGKA,EAAAA,GAAA,IAAA70B,GAAA6kN,0BAoHjBxsK,OAAA,SAAYxjB,UApHKA,EAAAA,GAAA,IAAA70B,GAAA6kN,uBA+HjBljD,QAAA,SAAY9sI,UA/HKA,EAAAA,GAAA,IAAA70B,GAAA6kN,wBAyIpBjjD,YAzIoB,uCAoJjB38J,IAAA,SAAO4+M,EAAShvL,UApJCA,EAAAA,GAAA,IAAA70B,GAAA6kN,sBAgKjBhgN,IAAA,SAAOg/M,EAAKhvL,UAhKKA,EAAAA,GAAA,IAAA70B,GAAA6kN,2BA4KjBvgN,IAAA,SAAOu/M,EAAKhvL,UA5KKA,EAAAA,GAAA,IAAA70B,GAAA6kN,2BAwLjBE,UAAO,SAAKC,EAALnwL,UAxLUA,EAAAA,GAAA,IAAA70B,GAAA6kN,4BAoMjB3kJ,UAAO,SAAKtxC,EAAAiG,UApMKA,EAAAA,GAAA,IAAA70B,GAAA6kN,4BAgNjB/5K,MAAA,SAAYlc,EAAAiG,UAhNKA,EAAAA,GAAA,IAAA70B,GAAA6kN,wBA6NjB1iD,OAAA,SAAYC,EAAOsD,EAAK7wI,UA7NPA,EAAAA,GAAA,IAAA70B,GAAA6kN,2BAwOjB37C,eAAY,SAAAr0I,UAxOKA,EAAAA,GAAA,IAAA70B,GAAA+xC,+BAmPjB8qB,SAAA,SAAYhoC,UAnPKA,EAAAA,GAAA,IAAA70B,GAAA+xC,2BA8PjB+qB,YAAO,SAAKjoC,UA9PKA,EAAAA,GAAA,IAAA70B,GAAA8xC,4BA4QpB0I,QA5QoB,SAAA1pB,EAAAlC,EAAAjnB,iCAuRpB86J,SAAA,SAAA93H,GAvRL,OAAA1E,EAAAw8H,SAAAriK,KAAAuqC,MAkTC3qC,GAFDimC,KAAA,SAAA6J,EAAAC,EAAAC,EAAAC,EAAAO,EAAAC,EAAAC,EAAAC,EAAAgwH,EAAAC,EAAAC,EAAA0H,EAAAC,EAAAC,EAAAC,EAAAC,iMC9WA,IAAM9mC,EAAU/hI,EAAQ,sCAExBsgI,EAAAtgI,EAAA,uBAsBQ,SAAIgyC,EAAJpyC,EAAAoE,EAAA0lC,EAAAkK,GACAh0C,GAAA,iBAAAA,IACA8pC,EAAI9pC,EAAE8pC,EACN1lC,EAAIpE,EAAEoE,EAEV4vC,GADCh0C,EAAAA,EAAAA,GACDg0C,GAEAtzC,KAAKV,EAAIA,GAAK,EACdU,KAAK0D,EAAIA,GAAK,EACjB1D,KAAAopC,EAAAA,GAAA,EACDppC,KAAGszC,EAAOA,GAAM,gBAGhB0sF,EAAAyE,WAAA,UAAA/yF,GAAApyC,EAAA,EAAAoE,EAAA,EAAA0lC,EAAA,EAAAkK,EAAA,IAgBA,IAAA3lB,EAAA+jB,EAAApvC,UAQCqrB,EAFDttB,MAAA,sDAcIstB,EAAA7B,IAAS,SAATupI,UACAr1J,KAAKV,EAAI+1J,EAAS/1J,EAClBU,KAAK0D,EAAI2xJ,EAAS3xJ,EAClB1D,KAAAopC,EAAOisH,EAAPjsH,EALJppC,KAAAszC,EAAA+hH,EAAA/hH,QAiBC3lB,EAFDyoC,OAAA,SAAAqtJ,qEAaI91L,EAAA4uB,QAAA,SAAA9nB,UAFJ70B,GAAA0hC,MAAAiJ,KAAAgS,QAAA9nB,EAAAz0B,SAcI2tB,EAAAikB,UAAA,SAAAizK,UAFJjlN,GAAA0hC,MAAAiJ,KAAAqH,UAAA5xC,KAAA6kN,EAAAvlN,EAAAulN,EAAAnhN,EAAAmhN,EAAAz7K,SAeIzb,EAAG1D,KAAM,SAAWsiJ,EAAKroJ,EAAMuQ,UAC/BA,EAAAA,GAAA,IAAA70B,GAAA8xC,KAHJ9xC,GAAA0hC,MAAAiJ,KAAAsH,MAAApd,EAAAz0B,KAAAusK,EAAAroJ,MAkBCtkB,GAFD2qC,KAAA,SAAAjrC,EAAAoE,EAAA0lC,EAAAkK,iKCxIAj1B,EAAA3e,EAAA,kBAqBQ,SAAI+D,EAAJnE,EAAAoE,EAAA4vC,EAAAC,GACAj0C,GAAA,iBAAAA,IACAoE,EAAIpE,EAAEoE,EACN4vC,EAAIh0C,EAAEqE,MACT4vC,EAAAj0C,EAAAsE,OACDtE,EAAAA,EAAAA,GAEAU,KAAKV,EAAAA,GAAQ,EACbU,KAAK0D,EAAAA,GAAS,EACjB1D,KAAA2D,MAAA2vC,GAAA,EACDtzC,KAAG4D,OAAa2vC,GAAA,gBAGhB7zC,EAAA,uBAAA+kI,WAAA,UAAAhhI,GAAAnE,EAAA,EAAAoE,EAAA,EAAAC,MAAA,EAAAC,OAAA,IA0BIH,EAAAqhN,WAAY,SAAAt9C,EAAkBvjK,GAC9B,IAAI8gN,EAAQ1/M,KAAKC,IAAIkiK,EAAGloK,EAAG2E,EAAG3E,GAC1B0lN,EAAQ3/M,KAAKC,IAAIkiK,EAAG9jK,EAAGO,EAAGP,wCAEnB2B,KAAKE,IAATiiK,EAAgB9jK,EAAAO,EAAOP,OAKlC,IAAAiqB,EAAAlqB,EAAAnB,UAWCqrB,EAFDttB,MAAA,+DAqBCstB,EANDyoC,OAAA,SAAAqtJ,uFA4BI91L,EAAI1D,KAAI,SAARsiJ,EAAAroJ,EAAAuQ,GACAA,EAAIA,GAAS,IAAbhxB,EACA,IAAInE,EAAAU,KAAQV,EACRoE,EAAA1D,KAAS0D,EACTC,EAAQ3D,KAAC2D,MACTC,EAAS5D,KAAA4D,cACb6wB,EAAIn1B,EAAAA,GAAQitK,EAAAjtK,EAAQA,GAAI4kB,EACxBuQ,EAAI/wB,EAAAA,GAAS6oK,EAAA7oK,EAAAA,GAAUwgB,EACvBuQ,EAAA9wB,MAAAA,GAAA4oK,EAAA5oK,MAAAA,GAAAugB,EAVJuQ,EAAA7wB,OAAAA,GAAA2oK,EAAA3oK,OAAAA,GAAAsgB,KAeIyJ,EAAA7B,IAAS,SAATqlI,GACAnxJ,KAAKV,EAAA6xJ,EAAQ7xJ,EACbU,KAAK0D,EAAAytJ,EAASztJ,EAJlB1D,KAAA2D,MAAAwtJ,EAAAxtJ,4BAmBIgqB,EACIs3L,WAAa,SAASriN,GAD1B,IAEIsiN,EAAQllN,KAAKV,EAAIU,KAAK2D,MACtBwhN,EAAQnlN,KAAK0D,EAAI1D,KAAK4D,OAC1BwhN,EAASxiN,EAAQtD,EAAAsD,EAARe,MALb0hN,EAAAziN,EAAAc,EAAAd,EAAAgB,kDAsBI+pB,EAAoB23L,aAApB,SAAA7wL,EAAA8wL,GAAA,IAAoCC,EAAQxlN,KAAKV,EAAgBmmN,EAAQzlN,KAAK0D,EAC1EgiN,EAAQ1lN,KAAAV,EAAZU,KAAA2D,MAAqBgiN,EAAQ3lN,KAAA0D,EAA7B1D,KAAA4D,OAAsCgiN,EAAQL,EAAMjmN,EAAiBumN,EAAQN,EAAM7hN,EAC/EoiN,EAAIP,EAASjmN,EAATimN,EAAgB5hN,MACpBoiN,EAAIR,EAAS7hN,EAAT6hN,EAAgB3hN,cACxB6wB,EAAIn1B,EAAA+F,KAAQE,IAAKigN,EAAII,GACrBnxL,EAAI/wB,EAAA2B,KAASE,IAAAkgN,EAASI,GACtBpxL,EAAA9wB,MAAA0B,KAAAC,IAAAogN,EAAAI,GAAArxL,EAAAn1B,EAPJm1B,EAAA7wB,OAAAyB,KAAAC,IAAAqgN,EAAAI,GAAAtxL,EAAA/wB,KA2BCiqB,EALDk3D,SAAA,SAAAtpB,qFAuBC5tC,EALDq4L,aAAA,SAAApjN,sGAqBI+qB,EAAiBkzC,MAAK,SAAtBpsC,EAAA8wL,GAAA,IAA8BvsK,EAAKh5C,KAAKV,EAAO25C,EAAKj5C,KAAK0D,EACrD08J,EAAKpgK,KAAA2D,MAASsiN,EAAKjmN,KAAA4D,OAASu1C,EAAKosK,EAAMjmN,EAAO85C,EAAKmsK,EAAM7hN,EACzDyhK,EAAIogD,EAAK5hN,MACTuiN,EAAIX,EAAK3hN,cACb6wB,EAAIn1B,EAAA+F,KAAQC,IAAK0zC,EAAIG,GACrB1kB,EAAI/wB,EAAA2B,KAASC,IAAA2zC,EAAAG,GACb3kB,EAAA9wB,MAAA0B,KAAAE,IAAAyzC,EAAAonH,EAAAjnH,EAAAgsH,GAAA1wI,EAAAn1B,EAPJm1B,EAAA7wB,OAAAyB,KAAAE,IAAA0zC,EAAAgtK,EAAA7sK,EAAA8sK,GAAAzxL,EAAA/wB,KAmBIiqB,EAAIkmB,cAAJ,SAAApf,EAAAs0I,GACA,IAAIywC,EAAKx5M,KAAKV,EACVm6M,EAAKz5M,KAAK0D,EACVg2M,EAAAF,EAAUx5M,KAAJ2D,MACNg2M,EAAAF,EAAUz5M,KAAJ4D,OACNg2M,EAAM7wC,EAAIr5H,IAAM8pK,EAAKzwC,EAAIj5H,IAAM2pK,EAAK1wC,EAAIz4H,IACxCupK,EAAM9wC,EAAIp5H,IAAM6pK,EAAKzwC,EAAIh5H,IAAM0pK,EAAK1wC,EAAIx4H,IACxCupK,EAAM/wC,EAAIr5H,IAAMgqK,EAAK3wC,EAAIj5H,IAAM2pK,EAAK1wC,EAAIz4H,IACxCypK,EAAMhxC,EAAIp5H,IAAM+pK,EAAK3wC,EAAIh5H,IAAM0pK,EAAK1wC,EAAIx4H,IACxCypK,EAAMjxC,EAAIr5H,IAAM8pK,EAAKzwC,EAAIj5H,IAAM6pK,EAAK5wC,EAAIz4H,IACxC2pK,EAAMlxC,EAAIp5H,IAAM6pK,EAAKzwC,EAAIh5H,IAAM4pK,EAAK5wC,EAAIx4H,4BAExC2pK,EAAAnxC,EAAOp5H,IAAS+pK,EAAK3wC,EAAdh5H,IAAwB4pK,EAAnC5wC,EAAAx4H,IAEI4pK,EAAO90M,KAAKC,IAAIs0M,EAAKE,EAAKE,EAAKI,GAC/BrqI,EAAO1qE,KAAKE,IAAIq0M,EAAKE,EAAKE,EAAKI,uBAE/BpqI,EAAI3qE,KAARE,IAAAs0M,EAAAE,EAAAE,EAAAC,UAEAzlL,EAAIn1B,EAAA66M,EACJ1lL,EAAI/wB,EAAA22M,EACJ5lL,EAAA9wB,MAAAosE,EAAAoqI,EAvBJ1lL,EAAA7wB,OAAAosE,EAAAqqI,KAsCC1sL,EAHDk5C,SAAA,0HAYkCxoD,EAC9BgR,OAAA1B,EAAU,OAAO,WACb,OAAK3tB,KAALV,GACA,SAASyE,GAJjB/D,KAAA2D,OAAA3D,KAAAV,EAAAyE,aAekCsa,EAC9BgR,OAAA1B,EAAU,OAAO,WACb,OAAK3tB,KAAL0D,GACA,SAASK,GAJjB/D,KAAA4D,QAAA5D,KAAA0D,EAAAK,aAe+Csa,EAC3CgR,OAAA1B,EAAU,OAAO,WAAE,OAAK3tB,KAALV,EAAaU,KAAQ2D,OAF5C,SAAAI,yBAYgDsa,EAC5CgR,OAAA1B,EAAU,OAAO,WAAE,OAAK3tB,KAAL0D,EAAc1D,KAAA4D,QAFrC,SAAAG,0BAcKsa,EACDgR,OAAA1B,EAAU,SAAO,WACb,OAAA,IAAS/tB,GAAAyE,KAAUrE,KAAKV,EAAxB,GAAwBU,KAAQ2D,MAAhC3D,KAAA0D,EAAA,GAAA1D,KAAA4D,SACA,SAASG,GAPjB/D,KAAAV,EAAAyE,EAAAzE,EAAA,GAAAU,KAAA2D,kCAmBK0a,EACDgR,OAAA1B,EAAU,SAAO,WACb,OAAA,IAAS/tB,GAAAyE,KAATrE,KAAAV,EAAAU,KAAA0D,IACA,SAASK,GANjB/D,KAAAV,EAAAyE,EAAAzE,eAkBK+e,EACDgR,OAAA1B,EAAU,OAAO,WACb,OAAK,IAAL/tB,GAAay1D,KAAMr1D,KAAnB2D,MAAA3D,KAAA4D,SACA,SAAAG,GANR/D,KAAA2D,MAAAI,EAAAJ,6BAYA/D,GAAA6D,KAAAA,EAqBC7D,GAFDgD,KAAA,SAAAtD,EAAAoE,EAAA4vC,EAAAC,+JCrZAl1B,EAAA3e,EAAA,kBAsBQ,SAAA21D,EAAS1xD,EAAMC,GACfD,GAAA,iBAAcA,IACjBC,EAAAD,EAAAC,OACDD,EAAAA,EAAaA,OAEhB3D,KAAA2D,MAAAA,GAAA,EACD3D,KAAG4D,OAAaA,GAAhB,gBAGAlE,EAAA,uBAAA+kI,WAAA,UAAApvE,GAAA1xD,MAAA,EAAAC,OAAA,IAiBCya,EAFDsK,IAAA0sC,EAAA,OAAA,+BAMA,IAAA1nC,EAAA0nC,EAAA/yD,UAWCqrB,EAFDttB,MAAA,iDAkBCstB,EAJDyoC,OAAA,SAAAqtJ,2DA0BI91L,EAAI1D,KAAA,SAAasiJ,EAAjBroJ,EAAAuQ,GACAA,EAAIA,GAAS,IAAA4gC,EACb,IAAI1xD,EAAQ3D,KAAA2D,MACRC,EAAS5D,KAAA4D,cACb6wB,EAAA9wB,MAAAA,GAAA4oK,EAAA5oK,MAAAA,GAAAugB,EANJuQ,EAAA7wB,OAAAA,GAAA2oK,EAAA3oK,OAAAA,GAAAsgB,KAWIyJ,EAAA7B,IAAK,SAASqlI,GAFlBnxJ,KAAA2D,MAAAwtJ,EAAAxtJ,4BAgBCgqB,EAFDk5C,SAAA,4EAuBCjnE,GAFDqvC,KAAA,SAAAqE,EAAAC,qIChJA,IAAAl1B,EAAA3e,EAAA,gCASA2e,EAAAuiH,aAAY,eAAZa,GAEA,IAAI9zG,EAAA8zG,EAAWn/H,UA8DdqrB,EAFDk5C,SAAA,+FCvEA,IAAM46D,EAAU/hI,EAAQ,gBAClB2e,EAAA3e,EAAO,kBACPsgI,EAAOtgI,EAAQ,6DAErBC,EAAAD,EAAA,iBAoBQ,SAAI2E,EAAJ/E,EAAAoE,GACApE,GAAA,iBAAAA,IACHoE,EAAApE,EAAAoE,EACDpE,EAAAA,EAAAA,GAEHU,KAAAV,EAAAA,GAAA,EACDU,KAAG0D,EAAOA,GAAM,gBAGhBs8H,EAAAyE,WAAA,UAAApgI,GAAA/E,EAAA,EAAAoE,EAAA,IAUA,IAAAiqB,EAAAtpB,EAAA/B,UAQCqrB,EAFDttB,MAAA,wCAcIstB,EAAA7B,IAAS,SAATupI,UACAr1J,KAAAV,EAAO+1J,EAAP/1J,EAHJU,KAAA0D,EAAA2xJ,EAAA3xJ,QAeCiqB,EAFDyoC,OAAA,SAAAqtJ,yCAgBQ91L,EAAA+2L,YAAa,SAAYjB,EAArB0C,GAEP,OAAAnmN,KAAAV,EAAA6mN,GAAA1C,EAAAnkN,GAAAmkN,EAAAnkN,GAAAU,KAAAV,EAAA6mN,GACDnmN,KAAO0D,EAAPyiN,GAAA1C,EAAA//M,GAAA+/M,EAAA//M,GAAA1D,KAAA0D,EAAAyiN,GAcHx4L,EALDk5C,SAAA,mEAkBIl5C,EAAI1D,KAAI,SAARsiJ,EAAAroJ,EAAAuQ,GACAA,EAAIA,GAAS,IAAbpwB,EACA,IAAI/E,EAAIU,KAAKV,EACToE,EAAI1D,KAAK0D,SACb+wB,EAAAn1B,EAAOA,GAAPitK,EAAAjtK,EAAAA,GAAA4kB,EANJuQ,EAAA/wB,EAAAA,GAAA6oK,EAAA7oK,EAAAA,GAAAwgB,KA6BIyJ,EAAA5oB,OAAS,SAAY+6M,EAAQC,UAC7B//M,KAAAV,EAAOK,EAAPoF,OAAA/E,KAAAV,EAAAwgN,EAAAxgN,EAAAygN,EAAAzgN,GAHJU,KAAA0D,EAAA/D,EAAAoF,OAAA/E,KAAA0D,EAAAo8M,EAAAp8M,EAAAq8M,EAAAr8M,SAmBIiqB,EAAAy4L,QAAU,SAAV7vL,UACAv2B,KAAAV,GAAOi3B,EAAPj3B,EAHJU,KAAA0D,GAAA6yB,EAAA7yB,QAqBIiqB,EAAI9oB,IAAI,SAAS0xB,EAAjB9B,UACAA,EAAAA,GAAa,IAAIpwB,GACjB/E,EAAOU,KAAPV,EAAAi3B,EAAAj3B,EAJJm1B,EAAA/wB,EAAA1D,KAAA0D,EAAA6yB,EAAA7yB,KAoBIiqB,EAAA04L,QAAU,SAAV9vL,UACAv2B,KAAAV,GAAOi3B,EAAPj3B,EAHJU,KAAA0D,GAAA6yB,EAAA7yB,QAqBIiqB,EAAIlpB,IAAI,SAAS8xB,EAAjB9B,UACAA,EAAAA,GAAa,IAAIpwB,GACjB/E,EAAOU,KAAPV,EAAAi3B,EAAAj3B,EAJJm1B,EAAA/wB,EAAA1D,KAAA0D,EAAA6yB,EAAA7yB,KAoBIiqB,EAAA24L,QAAA,SAAAxrL,UACA96B,KAAAV,GAAOw7B,EAHX96B,KAAA0D,GAAAo3B,QAqBInN,EAAIzpB,IAAI,SAAR42B,EAAArG,UACAA,EAAAA,GAAa,IAAIpwB,GACjB/E,EAAOU,KAAPV,EAAAw7B,EAJJrG,EAAA/wB,EAAA1D,KAAA0D,EAAAo3B,KAoBInN,EAAA44L,UAAU,SAAVhwL,UACAv2B,KAAAV,GAAOi3B,EAAPj3B,EAHJU,KAAA0D,GAAA6yB,EAAA7yB,QAqBIiqB,EAAI+c,MAAI,SAASnU,EAAjB9B,UACAA,EAAAA,GAAa,IAAIpwB,GACjB/E,EAAOU,KAAPV,EAAAi3B,EAAAj3B,EAJJm1B,EAAA/wB,EAAA1D,KAAA0D,EAAA6yB,EAAA7yB,KAoBIiqB,EAAA64L,QAAA,SAAA1rL,UACA96B,KAAAV,GAAOw7B,EAHX96B,KAAA0D,GAAAo3B,QAqBInN,EAAIiwC,IAAI,SAAR9iC,EAAArG,UACAA,EAAAA,GAAa,IAAIpwB,GACjB/E,EAAOU,KAAPV,EAAAw7B,EAJJrG,EAAA/wB,EAAA1D,KAAA0D,EAAAo3B,KAmBInN,EAAA84L,QAAU,kBACVzmN,KAAAV,GAAOU,KAAPV,EAHJU,KAAA0D,GAAA1D,KAAA0D,QAmBIiqB,EAAI+4L,IAAK,SAATjyL,UACAA,EAAAA,GAAS,IAATpwB,GACA/E,GAAOU,KAAPV,EAJJm1B,EAAA/wB,GAAA1D,KAAA0D,KAmBCiqB,EAFDmoB,IAAA,SAAAvf,iCAgBC5I,EAFDioB,MAAA,SAAArf,iCAeC5I,EAFD8I,IAAA,0DAeC9I,EAFDg5L,OAAA,+CAgBIh5L,EAAIi5L,cACA,6CAEJ,GAAe,IAAXD,EAAgB,OAAA3mN,KAEnB,GAAA,IAAA2mN,cAID,IAAAE,EAAU,EAAVxhN,KAAAoI,KAAAk5M,oBAEA3mN,KAAA0D,GAAOmjN,QAoBPl5L,EAAI6H,UAAJ,SAAAf,UACAA,EAAAA,GAAa,IAAbpwB,GACI/E,EAAAU,KAAAV,EACJm1B,EAAA/wB,EAAO1D,KAAP0D,EALJ+wB,EAAAmyL,mBAiBIj5L,EAAI3X,MAAA,SAAiBugB,uBAEjBuwL,EAAAvwL,EAAiBowL,SAEjB,GAAA,IAAAI,GAAA,IAAAD,SACHngL,QAAAkI,KAAA,yCAID,IACAm4K,EADQhnN,KAAK81C,IAALvf,GACSlxB,KAAjBoI,KAAAs5M,EAAAD,UAZJE,EAAArnN,EAAAoF,OAAAiiN,GAAA,EAAA,iBAwBIr5L,EAAAs5L,UAAY,SAAL1wL,GAFX,IAAAvgB,EAAAhW,KAAAgW,MAAAugB,gCAeI5I,EAAIo0I,OAAS,SAAbmlD,EAAAzyL,UACAA,EAAAA,GAAa,IAAbpwB,GACA/E,EAAOU,KAAIV,EAJfm1B,EAAA/wB,EAAA1D,KAAA0D,mBAiBIiqB,EAAIw5L,WAAW,SAAfD,GACA,IAAI58M,EAAIjF,KAARiF,IAAA48M,GACAh9M,EAAS7E,KAAM6E,IAAIg9M,GACnB5nN,EAAAU,KAASV,SACTU,KAAAV,EAAO4K,EAAP5K,EAAAgL,EAAAtK,KAAA0D,EANJ1D,KAAA0D,EAAA4G,EAAAhL,EAAA4K,EAAAlK,KAAA0D,QAsBCiqB,EAFDy5L,QAAA,SAAA7wL,uCAaI5I,EAAAkmB,cAAU,SAAmBv4B,EAA7BmZ,GAFJA,EAAAA,GAAA,IAAApwB,kCAwBCga,EAFDsK,IAAAtkB,EAAA,MAAA,+BAaCga,EAFDsK,IAAAtkB,EAAA,OAAA,+BAaCga,EAFDsK,IAAAtkB,EAAA,KAAA,+BAaCga,EAFDsK,IAAAtkB,EAAA,QAAA,+BAMAzE,GAAAyE,KAAAA,EAoBCzE,GAFDqE,GAAA,SAAA3E,EAAAoE,sBAeA9D,GAAA4G,EAAO5G,GAAAqE,oKC/oBP,IAAMw9H,EAAU/hI,EAAQ,gBAClB2e,EAAA3e,EAAO,kBACPsgI,EAAOtgI,EAAQ,6DAErBC,EAAAD,EAAA,iBAqBQ,SAAIiyC,EAAJryC,EAAAoE,EAAA0lC,GACA9pC,GAAA,iBAAAA,IACA8pC,EAAI9pC,EAAE8pC,EACT1lC,EAAApE,EAAAoE,EACDpE,EAAAA,EAAAA,GAEAU,KAAKV,EAAIA,GAAK,EACjBU,KAAA0D,EAAAA,GAAA,EACD1D,KAAGopC,EAAOA,GAAM,gBAGhB42F,EAAAyE,WAAA,UAAA9yF,GAAAryC,EAAA,EAAAoE,EAAA,EAAA0lC,EAAA,IAaA,IAAAzb,EAAAgkB,EAAArvC,UAQCqrB,EAFDttB,MAAA,+CAcIstB,EAAA7B,IAAS,SAATupI,UACAr1J,KAAKV,EAAI+1J,EAAS/1J,EAClBU,KAAA0D,EAAO2xJ,EAAP3xJ,EAJJ1D,KAAAopC,EAAAisH,EAAAjsH,QAgBCzb,EAFDyoC,OAAA,SAAAqtJ,uDAiBQ91L,EAAA+2L,YAAa,SAAYjB,EAArB0C,GACA,OAAAnmN,KAAIV,EAAK6mN,GAAL1C,EAAqBnkN,GAArBmkN,EAAgCnkN,GAAAU,KAAWV,EAAK6mN,GAEvDnmN,KAAA0D,EAAAyiN,GAAA1C,EAAA//M,GAAA+/M,EAAA//M,GAAA1D,KAAA0D,EAAAyiN,GACJnmN,KAAAopC,EAAA+8K,GAAA1C,EAAAr6K,GAAAq6K,EAAAr6K,GAAAppC,KAAAopC,EAAA+8K,GAgBJx4L,EANDk5C,SAAA,0FAmBIl5C,EAAA1D,KAAU,SAAUsiJ,EAApBroJ,EAA8BuQ,UAC9BA,EAAAA,GAAA,IAAAkd,EAHJiI,EAAAvY,KAAApX,KAAAwK,EAAAz0B,KAAAusK,EAAAroJ,MAoBIyJ,EAAA5oB,OAAS,SAAY+6M,EAAQC,UAC7B//M,KAAKV,EAAIK,EAAKoF,OAAO/E,KAAKV,EAAGwgN,EAAcxgN,EAAGygN,EAAczgN,GAC5DU,KAAA0D,EAAO/D,EAAPoF,OAAA/E,KAAA0D,EAAAo8M,EAAAp8M,EAAAq8M,EAAAr8M,GAJJ1D,KAAAopC,EAAAzpC,EAAAoF,OAAA/E,KAAAopC,EAAA02K,EAAA12K,EAAA22K,EAAA32K,SAiBIzb,EAAAy4L,QAAU,SAAV7vL,UACAv2B,KAAKV,GAAKi3B,EAAOj3B,EACjBU,KAAA0D,GAAO6yB,EAAP7yB,EAJJ1D,KAAAopC,GAAA7S,EAAA6S,QAiBIzb,EAAI9oB,IAAI,SAAS0xB,EAAjB9B,UACAA,EAAAA,GAAa,IAAIkd,GACbryC,EAAIU,KAAKV,EAAIi3B,EAAOj3B,EACxBm1B,EAAA/wB,EAAO1D,KAAP0D,EAAA6yB,EAAA7yB,EALJ+wB,EAAA2U,EAAAppC,KAAAopC,EAAA7S,EAAA6S,KAkBIzb,EAAA04L,QAAU,SAAV9vL,UACAv2B,KAAKV,GAAKi3B,EAAOj3B,EACjBU,KAAA0D,GAAO6yB,EAAP7yB,EAJJ1D,KAAAopC,GAAA7S,EAAA6S,QAiBIzb,EAAIlpB,IAAI,SAAS8xB,EAAjB9B,UACAA,EAAAA,GAAa,IAAIkd,GACbryC,EAAIU,KAAKV,EAAIi3B,EAAOj3B,EACxBm1B,EAAA/wB,EAAO1D,KAAP0D,EAAA6yB,EAAA7yB,EALJ+wB,EAAA2U,EAAAppC,KAAAopC,EAAA7S,EAAA6S,KAkBIzb,EAAA24L,QAAA,SAAAxrL,UACA96B,KAAKV,GAAKw7B,EACV96B,KAAA0D,GAAOo3B,EAJX96B,KAAAopC,GAAAtO,QAiBInN,EAAIzpB,IAAI,SAAR42B,EAAArG,UACAA,EAAAA,GAAa,IAAIkd,GACbryC,EAAIU,KAAKV,EAAIw7B,EACjBrG,EAAA/wB,EAAO1D,KAAP0D,EAAAo3B,EALJrG,EAAA2U,EAAAppC,KAAAopC,EAAAtO,KAkBInN,EAAA44L,UAAU,SAAVhwL,UACAv2B,KAAKV,GAAKi3B,EAAOj3B,EACjBU,KAAA0D,GAAO6yB,EAAP7yB,EAJJ1D,KAAAopC,GAAA7S,EAAA6S,QAiBIzb,EAAI+c,MAAI,SAASnU,EAAjB9B,UACAA,EAAAA,GAAa,IAAIkd,GACbryC,EAAIU,KAAKV,EAAIi3B,EAAOj3B,EACxBm1B,EAAA/wB,EAAO1D,KAAP0D,EAAA6yB,EAAA7yB,EALJ+wB,EAAA2U,EAAAppC,KAAAopC,EAAA7S,EAAA6S,KAkBIzb,EAAA64L,QAAA,SAAA1rL,UACA96B,KAAKV,GAAKw7B,EACV96B,KAAA0D,GAAOo3B,EAJX96B,KAAAopC,GAAAtO,QAiBInN,EAAIiwC,IAAI,SAAR9iC,EAAArG,UACAA,EAAAA,GAAa,IAAIkd,GACbryC,EAAIU,KAAKV,EAAIw7B,EACjBrG,EAAA/wB,EAAO1D,KAAP0D,EAAAo3B,EALJrG,EAAA2U,EAAAppC,KAAAopC,EAAAtO,KAiBInN,EAAA84L,QAAU,kBACVzmN,KAAKV,GAAKU,KAAKV,EACfU,KAAA0D,GAAO1D,KAAP0D,EAJJ1D,KAAAopC,GAAAppC,KAAAopC,QAgBIzb,EAAI+4L,IAAK,SAATjyL,UACAA,EAAAA,GAAS,IAATkd,GACIryC,GAAKU,KAAKV,EACdm1B,EAAA/wB,GAAO1D,KAAP0D,EALJ+wB,EAAA2U,GAAAppC,KAAAopC,KAiBCzb,EAFDmoB,IAAA,SAAAvf,4CAcI5I,EAAAioB,MAAU,SAAWrf,EAAM9B,UAC3BA,EAAAA,GAAA,IAAAkd,EAHJiI,EAAAvY,KAAAuU,MAAAnhB,EAAAz0B,KAAAu2B,MAiBC5I,EAFD8I,IAAA,wEAYC9I,EAFDg5L,OAAA,6DAaIh5L,EAAAi5L,cAAA,kBAFJhtK,EAAAvY,KAAA7L,UAAAx1B,KAAAA,YAoBI2tB,EAAA6H,UAAU,SAAef,UACzBA,EAAAA,GAAA,IAAAkd,EAHJiI,EAAAvY,KAAA7L,UAAAf,EAAAz0B,SAeI2tB,EAAAkmB,cAAU,SAAmBv4B,EAA7BmZ,GAFJA,EAAAA,GAAA,IAAAkd,kCAqBC/xC,GAFDyW,GAAA,SAAA/W,EAAAoE,EAAA0lC,2LC3bIxpC,GAAJye,6BCDA3e,EAAA,4HCEA2nN,EAAA3nN,EAAA,gCAOI+pE,EAFyB7pE,GAAAE,+BAIzByB,QAAAgnB,EAEQC,YACAW,aAFSV,QAAA,KADLC,KAAA2+L,0HCJZ,IAAAC,EAFyB1nN,GAAAE,+BAIzByB,QAAA3B,GAAY2oB,kBAGRg/L,UAAA,GAKIvuF,UARIvwG,gCAgBR++L,cAAc5nN,GAAAgyE,QApBO61I,UAAA7nN,GAAAiyE,qCAwBhB/oD,2CAMLi+C,YAAIp7B,iFCjCZjsC,EAAI,uBAOAA,EAAQ,sBACRA,EAAQ,qBACRA,EAAQ,uCACRA,EAAQ,+BACRA,EAAQ,+CACXA,EAAA,iFAKDA,EAAK,ujBCyBLM,KAAA0nN,gBAAAA,EAUG1nN,KAAAqvH,iCAGCvwG,YAAAlf,GAAA+nN,SAQC14K,KAXmB,qCAoBhB2U,MAAA,WAEC,IADG,IAAAje,EAAK3lC,KAALqvH,MAAc7vH,OACjBD,EAAA,EAAAA,EAAAomC,IAAApmC,EACDS,KAAKqvH,MAAM9vH,GAAXk7B,+BAkBI+8B,IAAA,SAAAX,GACA,GAAAA,IAAA,IAAI72D,KAAAqvH,MAAA1rG,QAAJkzC,GAAA,CAEAA,EAAAxnD,kBAAA,GAGI,IAAAsoC,EAAQ33C,KAAR0nN,gBAAA7wJ,EAAAnxC,aAAA1lB,KAAA0nN,iBAAA,KACH/vK,GAAAA,EAAAimE,iBAhDW59G,KAAAqvH,MAAA3pH,KAAAmxD,KAmEhBluC,IAAA,WACI,IAAArV,EAAOtT,KAAPqvH,MAAA7vH,OAAA,EACH,GAFD8T,EAGK,EACD,OAAA,yBAIAtT,KAAAqvH,MAAA7vH,OAAA8T,EAGI,IAAAqkC,EAAQ33C,KAAM0nN,gBAAe7wJ,EAAAnxC,aAA7B1lB,KAAA0nN,iBAAA,KAIX,OAHQ/vK,GAAAA,EAAAmmE,OACDnmE,EAAAmmE,MAAAxxF,MAAAqrB,EAAAzlC,WAEP2kD,oDCpIL,IAAA+wJ,EAAA,oBAAAhlK,OAAAmrG,OAAAnrG,OAUAglK,EAAAhoN,GAAAgoN,EAAAhoN,OAGAgoN,EAAQ35E,IAAA25E,EAAR35E,QAEAvuI,EAAA,eAGAA,EAAQ,qBACRA,EAAQ,mBACRA,EAAM,oBACFA,EAAA,gDAKJA,EAAA,2CAUAA,EAAI,8BClEAmoN,YAAM,IAANC,2BAA8B,IAAAC,YAAA,IAAAC,iBAAA3hN,EAAA4hN,mBAAA,IAAAC,kBAAA,IAAAC,oBAAA,IAAAC,oBAAA,IAAAC,wBAAA,IAAAC,cAAA,MAAAC,KAAA,SAAA7oN,EAAAP,EAAAE,GAC1BgU,MAAA2P,UACH3P,MAFD2P,QAAA,SAAAsxI,GAGH,MAAA,mBAAAhwG,OAAAhiD,UAAAukE,SAAAtkE,KAAA+xJ,UCHGk0D,KAAK,SAAO9oN,EAAAP,EAAaE,GAiBzB,GAhBIgG,KAAA23J,OACA33J,KAAA23J,KAAI,SAAW19J,GAEd,OAAA,KADGA,GAAAA,IACHqT,MAAArT,GACUA,EAElBA,EAAA,EAAA,GAAA,IAIOsmB,OAAAwhH,YACHxhH,OAFDwhH,UAAA,SAAArjI,GAGH,MAAA,iBAAAA,GAAAk5M,SAAAl5M,IAAAsB,KAAA4xB,MAAAlzB,KAAAA,KAIO4iC,QAAcr6B,KAAO,CACzB,IAAAm8M,EAAA7lK,OAAepB,aAAiByK,KAC5By8J,EAAYpkK,OAASxX,OAAM,MAC9BnG,QAFDr6B,KAAA,SAAA8mF,GAGAs1H,EAAAt1H,GAAkBq1H,EAAUhnK,OAExB9a,QAAImgB,QAAA,SAAWssC,GACf,IAAAtsE,EAAe4hM,EAAUt1H,GAH7BxxF,EAAA6mN,EAAAhnK,MAAA36B,EAKH6f,QAAAgW,IAAAy2C,EAAA,KAAAxxF,EAAA,aC1BD+mN,KAAA,SAAAjpN,EAAAP,EAAAE,GAGQilD,OAAG+uG,SACN/uG,OAFD+uG,OAAA,SAAAnzJ,EAAAixJ,GAGHvxJ,GAAAye,GAAA21F,MAAA9zG,EAAAixJ,KAQO7sG,OAAIskK,4BACJtkK,OAAAskK,0BAAqB,SAAoB/xJ,GAGrC,IAFJ,IAAAgyJ,KACIC,EAAUxkK,OAAAkjE,oBAAV3wD,GAAAupE,OAAA97E,OAAAykK,sBAAAlyJ,IACAt3D,EAAA,EAAYA,EAAZupN,EAAmBtpN,SAAOD,EAAA,CAC7B,IAAAmmD,EAAAojK,EAAAvpN,GACDspN,EAAOnjK,GAAPpB,OAAA26E,yBAAApoE,EAAAnR,GAEP,OAAAmjK,SCrBGG,KAAO,SAAPtpN,EAAiBP,EAAaE,GAC1BuyE,OAAAtvE,UAAWwjD,aACX8rB,OAAAtvE,UAAYwjD,WAAY,SAAjBmjK,EAAAtyM,GAEd,OAJGA,EAAAA,GAAA,EAIH3W,KAAA0sF,YAAAu8H,EAAAtyM,KAAAA,IAIOi7D,OAAItvE,UAAOujD,WACP+rB,OAAAtvE,UAAAujD,SAAgB,SAAhBojK,EAAAtyM,SACH,IAAAA,GAAAA,EAAA3W,KAAAR,UACDmX,EAAY3W,KAAAR,QAEZmX,GAAOsyM,EAAAzpN,OANX,IAAAgsB,EAAAxrB,KAAA2jB,QAAAslM,EAAAtyM,GAQH,OAAA,IAAA6U,GAAAA,IAAA7U,SCfGuyM,KAAA,SAAgBxpN,EAAOP,EAAAE,GACoE,IAD3E8pN,EAEA7kK,OAAgB8kK,iBAAAjyC,wBAAA9jK,OAAA,SAAAjH,EAAAF,GAAEE,EAAA+qK,UAAcjrK,IAAG,SAAME,EAAAF,GAAvB,IAAA,IAAA1F,KAAA0F,EAFtCA,EAAAqzH,eAAA/4H,KAAA4F,EAAA5F,GAAA0F,EAAA1F,KAKIo8C,OAAAymK,UAAc,SAAAj9M,EAAAF,GAAyB,SAAAo9M,IACrCtpN,KAAA8e,YAAkB1S,EADJ+8M,EAAK/8M,EAAAF,GAGzBE,EAAA9J,UAAkB,OAAA4J,EAAAo4C,OAAiBxX,OAAU5gC,IAAGo9M,EAAAhnN,UAAA4J,EAAA5J,UAAA,IAAAgnN,IAEpC1mK,OAAA2mK,SAAIjlK,OAAJ+uG,QAAA,SAAAjsJ,GACA,IAAA,IAAKG,EAAAhI,EAAL,EAAA6S,EAAAF,UAAA1S,OAAAD,EAAA6S,EAAA7S,IAAA,IAAA,IAAAiH,KAAiBe,EAAA2K,UAAI3S,GACxB+kD,OAAAhiD,UAAAi9H,eAAAh9H,KAAAgF,EAAAf,KAAAY,EAAAZ,GAAAe,EAAAf,IAGT,OAAOY,GAEHw7C,OAAA4mK,OAAA,SAAAjiN,EAAA6kG,GAAiB,IAAAhlG,KAAjB,IAEI,IAAAZ,KAAAe,EAC4E+8C,OAAEhiD,UAAFi9H,eAC9Dh9H,KAAAgF,EAAVf,IAAA4lG,EAAAzoF,QAAAnd,GAAA,IAAAY,EAAAZ,GAAAe,EAAAf,IACR,GAAA,MAAAe,GAAA,mBAAA+8C,OAAAykK,sBAAA,CAAA,IAAAxpN,EAAA,EAAA,IAAAiH,EAAA89C,OAAAykK,sBAAAxhN,GAAAhI,EAAAiH,EAAAhH,OAAAD,IAPJ6sG,EAAAzoF,QAAAnd,EAAAjH,IAAA,IAAA6H,EAAAZ,EAAAjH,IAAAgI,EAAAf,EAAAjH,KASA,OAAO6H,GACHw7C,OAAA6mK,WAAsC,SAASC,EAAAxpN,EAAgBwlD,EAAO8gF,GAAtE,IAEsDp6H,EAFqED,EAA3H+F,UAAA1S,OACI0a,EAAA/N,EAAO,EAAAjM,EAAP,OAAmBsmI,EAAYA,EAAOliF,OAAQ26E,yBAA6B/+H,EAAQwlD,GAAR8gF,EAC1E,GACgB,iBAAdmjF,SAAP,mBAA4BA,QAAP3kF,SAArB9qH,EAAAyvM,QAAA3kF,SAAA0kF,EAAAxpN,EAAAwlD,EAAA8gF,QAAA,IAAA,IAAAjnI,EAAAmqN,EAAAlqN,OAAA,EAAAD,GAAA,EAAAA,KAJJ6M,EAAAs9M,EAAAnqN,MAAA2a,GAAA/N,EAAA,EAAAC,EAAA8N,GAAA/N,EAAA,EAAAC,EAAAlM,EAAAwlD,EAAAxrC,GAAA9N,EAAAlM,EAAAwlD,KAAAxrC,GAMA,OAAO/N,EAAP,GAAiB+N,GAAAoqC,OAAUglB,eAAVppE,EAAiCwlD,EAAAxrC,GAAAA,GACd0oC,OAAAgnK,QAAA,SAAkBC,EAAKC,GAAc,OAArE,SAAA5pN,EAAAwlD,GADJokK,EAAA5pN,EAAAwlD,EAAAmkK,KAKCjnK,OAFDmnK,WAAA,SAAAC,EAAAC,GAGA,GAAmB,iBAAZN,SAAyD,mBAA1BA,QAAeO,SAAW,OAAAP,QAAAO,SAAAF,EAAAC,IAExDrnK,OAAAunK,UAAS,SAAUC,EAAOC,EAAAC,EAAAC,GAAE,OAAA,IAAID,IAAAA,EAAAE,UAAA,SAAAC,EAAAC,GAAE,SAAAC,EAAK5mN,GAAyB,IAAarD,EAAA6pN,EAAAtpI,KAAAl9E,IAAY,MAAAqoG,GAAEs+G,EAAAt+G,IAC1D,SAAAw+G,EAAK7mN,GAA6B,IAAarD,EAAA6pN,EAAA,MAAAxmN,IAAY,MAAAqoG,GAAEs+G,EAAAt+G,IACL,SAAA1rG,EAAA4T,GAAwBA,EAAnDu2M,KAA0DJ,EAAWn2M,EAA3GvQ,OAAA,IAAAumN,EAAA,SAAAG,GAAuHA,EAAAn2M,EAAAvQ,SACzI+mN,KAAAH,EAAYC,GAL1BlqN,GAAA6pN,EAAAA,EAAAj+L,MAAA89L,EAAAC,QAAAppI,WAS2Cr+B,OAAAmoK,YAAI,SAAUX,EAAY17J,GAAc,IAA6BuiF,EAAGvtI,EAC/G0D,EAAsIuV,EADvDquM,GAAE53H,MAAU,EAAA63H,KAA3F,WAAA,GAAA,EAAA7jN,EAAA,GAAA,MAAAA,EAAA,GAAA,OAAAA,EAAA,IAAA8jN,QAAAC,QACoJ,OAApJxuM,GAAAskE,KAAAmqI,EAAA,GAAAC,MAAAD,EAAA,GAAAE,OAAAF,EAAA,IAAA,mBAAAG,SAAA5uM,EAAA4uM,OAAAnkM,UAAA,WACA,OAASpnB,OAAU2c,EAAsB,SAAAyuM,EAAAh5M,GAAsB,OAA5C,SAAAoc,GAA+C,OAG9D,SAAAg9L,GAAU,GAAAv6E,EAAA,MAAI,IAAAw6E,UAAA,mCACV,KAAAT,GACA,IACA,GAAA/5E,EAAQ,EAAGvtI,IAAX0D,EAAA1D,EAAA,EAAA8nN,EAAA,GAAA,SAAAA,EAAA,GAAA,QAAA,YAAApkN,EAAAA,EAAA7E,KAAAmB,EAAA8nN,EAAA,KAAAX,KAAA,OAAAzjN,EACoB,OAAhB1D,EAAA,EAAQ0D,IAAAokN,GAAA,EAAApkN,EAAArD,QAAQynN,EAAA,IAChB,KAAK,EAAL,KAAA,EAAQpkN,EAAEokN,EAAF,MACR,KAAK,EAAc,OAAXR,EAAE53H,SAASrvF,MAAiBynN,EAAI,GAAAX,MAAA,GACxC,KAAK,EAAGG,EAAA53H,QAAK1vF,EAAA8nN,EAAa,GAAEA,GAAK,GAAP,SAC1B,KAAA,EACIA,EAAIR,EAAEG,IAAIziN,MAAJsiN,EAAYE,KAAMxiN,MAAF,SAAoE,QAAkB,KAAAtB,GAAAA,EAAA4jN,EAAAE,MAAA1rN,OAAA,GAAA4H,EAAAA,EAAA5H,OAAA,MAAA,IAAAgsN,EAAA,IAAA,IAAAA,EAAA,IAAA,CACxGR,EAAA,EAAA,SAAkF,GAAA,IAAAQ,EAAA,MAAApkN,GAAAokN,EAAA,GAAApkN,EAAA,IAAAokN,EAAA,GAAApkN,EAAA,IAAA,CAClF4jN,EAAA53H,MAAUo4H,EAAV,GAAe,MAAkD,GAAA,IAAAA,EAAA,IAAAR,EAAA53H,MAAAhsF,EAAA,GAAA,CACjE4jN,EAAA53H,MAAOhsF,EAAF,GAAUA,EAAnBokN,EAAyB,MAA0C,GAAApkN,GAAA4jN,EAAA53H,MAAAhsF,EAAA,GAAA,CAC/D4jN,EAAE53H,MAAMhsF,EAAI,GAAN4jN,EAAAG,IAAAzlN,KAAA8lN,GAAA,MAVlBpkN,EAAA,IAAA4jN,EAAAG,IAAAziN,MAaKsiN,EAAKE,KAAKxiN,MAAA,SACL8iN,EAAK98J,EAAAnsD,KAAQ6nN,EAAAY,GAjBjB,MAAA5+G,GAiBoCo/G,GAAI,EAAJp/G,GAAA1oG,EAAA,EAAY,QACnDutI,EAAH7pI,EAAW,EAxBvB,GAAA,EAAAokN,EAAA,GAAA,MAAAA,EAAA,GAAA,OAAAznN,MAAAynN,EAAA,GAAAA,EAAA,QAAA,EAAAX,MAAA,GAGsEnqN,EAAA0R,EAAAoc,OA0BjDo0B,OAAA8oK,aAAa,SAAApwM,EAARjc,GAAtB,IAAA,IAAAmH,KAAA8U,EADJjc,EAAAkgI,eAAA/4H,KAAAnH,EAAAmH,GAAA8U,EAAA9U,KAKIo8C,OAAA+oK,SAAA,SAAA92K,GACA,IAAIv5B,EAAG,mBAAOiwM,QAAP12K,EAAA02K,OAAAnkM,UACP7nB,EAAO,EACH,OAAA+b,EAAMA,EAAA/Y,KAAAsyC,IAEFosC,KAAA,WAHR,OAIKpsC,GAAAt1C,GAAAs1C,EAAAr1C,SAAAq1C,OAAA,IAJL9wC,MAAA8wC,GAAAA,EAAAt1C,KAAAsrN,MAAAh2K,MASA+N,OAAAgpK,OAAQ,SAAA/2K,EAAAziC,GACR,IAAIkJ,EAAJ,mBAAeiwM,QAAf12K,EAAA02K,OAAAnkM,UAAA,IAAA9L,EAAA,OAAAu5B,EAAA,IAA+B36B,EAE3BkyF,EAFkB7sG,EAAA+b,EAAK/Y,KAA3BsyC,GACIg3H,KAC0D,IAA1D,WAAA,IAAAz5J,GAAAA,KAAA,MAAA8H,EAAA3a,EAAA0hF,QAAA4pI,MAEJh/C,EAAOnmK,KAAOwU,EAAAnW,OAHd,MAAA42B,GAKIyxE,GAAIzxE,MAAAA,GACA,QACH,IACazgB,IAAGA,EAAA2wM,OAAAvvM,EAAA/b,EAAA,SAAA+b,EAAA/Y,KAAAhD,GAAgB,QACpC,GAAA6sG,EAAA,MAAAA,EAAAzxE,iBAMGioB,OAAAipK,SAAQ,WADZ,IAEA,IAAOhgD,KAAPtsK,EAAA,EAAAA,EAAA2S,UAAA1S,OAAAD,IAHJssK,EAAAA,EAAAzrC,OAAAwrF,OAAA15M,UAAA3S,eAQCqjD,OAFDkpK,QAAA,SAAAt9L,kEAMIo0B,OAAAmpK,iBAAkB,SAAV3B,EAAyBC,EAAjCE,GAAA,IAAAgB,OAAAS,cAAA,MAAA,IAAAP,UAAA,wCAAA,IACAlsN,EADuDod,EAAI4tM,EAA3Dj+L,MAAA89L,EAAAC,OACoG35L,KAAc,OAAlHnxB,KAAA6rN,EAAA,QAAAA,EAAA,SAAAA,EAAA,UAAA7rN,EAAAgsN,OAAAS,eAAA,WACA,OAAShsN,MAAUT,EAAgC,SAAA6rN,EAAAh5M,GAAqCuK,EAAAvK,KAAE7S,EAAA6S,GAAK,SAAPoc,GAA2C,OAAhF,IAAAg8L,QAAA,SAAAzhN,EAAAmD,GAAtBwkB,EAAAhrB,MAAA0M,EAAAoc,EAAAzlB,EAAAmD,IAAA,GAAA4b,EAAA1V,EAAAoc,OACC,SAAA1G,EAAK1V,EAAAoc,GAAW,KAC2E,SAAAtU,GACzHA,EAAAnW,iBAAA+nN,QAAwBtB,QAAAC,QAAAvwM,EAAAnW,MAAAyqB,GAAAs8L,KAAAmB,EAAAvB,GAAAwB,EAAAx7L,EAAA,GAAA,GAAAxW,IAFmCxZ,CAAAic,EAAOvK,GAAAoc,IAAc,MAAA49E,GAAE8/G,EAAAx7L,EAAA,GAAA,GAAA07E,IAEhC,SAAA6/G,EAAAloN,GAClD+jB,EAAS,OAAO/jB,GAAkC,SAAA2mN,EAAA3mN,GAClD+jB,EAAS,QAAT/jB,GAAkF,SAAAmoN,EAAAj7E,EAAAziH,GATtFyiH,EAAAziH,GAAAkC,EAAA3M,QAAA2M,EAAAlxB,QAAAsoB,EAAA4I,EAAA,GAAA,GAAAA,EAAA,GAAA,MAcIkyB,OAAAupK,iBAAoB,SAASt3K,GAA6B,IAAAt1C,EAAAiH,EAAU,OAAGjH,KAAK6rN,EAAW,QAASA,EAAA,QAAY,SAAYh/G,GAAE,MAAAA,IAA1Hg/G,EAAA,UAAA7rN,EAAAgsN,OAAAnkM,UAAA,WACA,OAASpnB,MAAaT,EAAgC,SAAA6rN,EAAAh5M,EAAQ6+H,GAA9Bp8F,EAAAziC,KAAA7S,EAAA6S,GAAA,SAAAoc,GAA8G,OAAAhoB,GAAAA,IAAAzC,MAAA+nN,QAAAj3K,EAAAziC,GAAAoc,IAAAq8L,KAAA,WAAAz4M,GAAA6+H,EAAAA,EAAAziH,GAAAA,MAK9Io0B,OAAAwpK,cAAiB,SAAAv3K,GACjB,IAAA02K,OAAWS,cAAY,MAAO,IAAAP,UAAa,wCAH/C,IAAAnwM,EAAAu5B,EAAA02K,OAAAS,0HCZI,IAAApE,EAAA,oBAAAhlK,OAAAmrG,OAAAnrG,OACA,SAAAypK,EAAAptN,EAAAs/H,QAGC,IAAAqpF,EAAA3oN,KACJ2oN,EAAA3oN,GAAAs/H,GASD8tF,EAAA,YAAc,GAKVzE,EAAQ0E,UAARA,EACA1E,EAAQ1xI,SAARA,EACA0xI,EAAQj8K,WAASA,EACjBi8K,EAAQ2E,YAAWA,EACnB3E,EAAQxjI,QAASA,EACjBwjI,EAAQvjG,UAAAA,EACRujG,EAAQ/qE,QAAAA,EACR+qE,EAAQ4E,mBAAYC,EACpB7E,EAAQ8E,eAAaA,EACrB9E,EAAQx4J,WAAAA,EAdZw4J,EAgBK+E,YAAAA,EACD/E,EAAAgF,gBAAuBA","file":"cocos2d-js-min.bf1c0.js","sourcesContent":["\r\n// Based on https://github.com/substack/browser-pack/blob/master/prelude.js\r\n\r\n// modules are defined as an array\r\n// [ module function, map of requireuires ]\r\n//\r\n// map of requireuires is short require name -> numeric require\r\n//\r\n// anything defined in a previous bundle is accessed via the\r\n// orig method which is the requireuire for previous bundles\r\n\r\n(function outer (modules, cache, entry) {\r\n    function newRequire(name, jumped){\r\n        var module = cache[name];\r\n        if(!module) {\r\n            var moduleData = modules[name];\r\n            if(!moduleData) {\r\n                // this module is excluded from engine\r\n                return undefined;\r\n            }\r\n            var exports = {};\r\n            module = cache[name] = {exports: exports};\r\n            moduleData[0](function(x){\r\n                return newRequire(moduleData[1][x] || x);\r\n            },module,exports);\r\n        }\r\n        return module.exports;\r\n    }\r\n    for(var i=0;i<entry.length;i++) newRequire(entry[i]);\r\n\r\n    // Override the current require with this new one\r\n    return newRequire;\r\n})\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('../core/platform/CCClass');\r\nconst misc = require('../core/utils/misc');\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en Base class cc.Action for action classes.\r\n * !#zh Action \r\n * @class Action\r\n */\r\ncc.Action = cc.Class({\r\n    name: 'cc.Action',\r\n\r\n    //**************Public Functions***********\r\n\r\n    ctor:function () {\r\n        this.originalTarget = null;\r\n        this.target = null;\r\n        this.tag = cc.Action.TAG_INVALID;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * to copy object with deep copy.\r\n     * returns a clone of action.\r\n     * !#zh \r\n     * @method clone\r\n     * @return {Action}\r\n     */\r\n    clone:function () {\r\n        var action = new cc.Action();\r\n        action.originalTarget = null;\r\n        action.target = null;\r\n        action.tag = this.tag;\r\n        return action;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * return true if the action has finished.\r\n     * !#zh  true\r\n     * @method isDone\r\n     * @return {Boolean}\r\n     */\r\n    isDone:function () {\r\n        return true;\r\n    },\r\n\r\n    // called before the action start. It will also set the target.\r\n    startWithTarget:function (target) {\r\n        this.originalTarget = target;\r\n        this.target = target;\r\n    },\r\n\r\n    // called after the action has finished. It will set the 'target' to nil.\r\n    stop:function () {\r\n        this.target = null;\r\n    },\r\n\r\n    // called every frame with it's delta time. <br />\r\n    step:function (dt) {\r\n        cc.logID(1006);\r\n    },\r\n\r\n    // Called once per frame. Time is the number of seconds of a frame interval.\r\n    update:function (dt) {\r\n        cc.logID(1007);\r\n    },\r\n\r\n    /**\r\n     * !#en get the target.\r\n     * !#zh \r\n     * @method getTarget\r\n     * @return {Node}\r\n     */\r\n    getTarget:function () {\r\n        return this.target;\r\n    },\r\n\r\n    /**\r\n     * !#en The action will modify the target properties.\r\n     * !#zh \r\n     * @method setTarget\r\n     * @param {Node} target\r\n     */\r\n    setTarget:function (target) {\r\n        this.target = target;\r\n    },\r\n\r\n    /**\r\n     * !#en get the original target.\r\n     * !#zh \r\n     * @method getOriginalTarget\r\n     * @return {Node}\r\n     */\r\n    getOriginalTarget:function () {\r\n        return this.originalTarget;\r\n    },\r\n\r\n    // Set the original target, since target can be nil.\r\n    // Is the target that were used to run the action.\r\n    // Unless you are doing something complex, like cc.ActionManager, you should NOT call this method.\r\n    setOriginalTarget:function (originalTarget) {\r\n        this.originalTarget = originalTarget;\r\n    },\r\n\r\n    /**\r\n     * !#en get tag number.\r\n     * !#zh \r\n     * @method getTag\r\n     * @return {Number}\r\n     */\r\n    getTag:function () {\r\n        return this.tag;\r\n    },\r\n\r\n    /**\r\n     * !#en set tag number.\r\n     * !#zh \r\n     * @method setTag\r\n     * @param {Number} tag\r\n     */\r\n    setTag:function (tag) {\r\n        this.tag = tag;\r\n    },\r\n\r\n    // Currently JavaScript Bindigns (JSB), in some cases, needs to use retain and release. This is a bug in JSB,\r\n    // and the ugly workaround is to use retain/release. So, these 2 methods were added to be compatible with JSB.\r\n    // This is a hack, and should be removed once JSB fixes the retain/release bug.\r\n    retain:function () {\r\n    },\r\n\r\n    // Currently JavaScript Bindigns (JSB), in some cases, needs to use retain and release. This is a bug in JSB,\r\n    // and the ugly workaround is to use retain/release. So, these 2 methods were added to be compatible with JSB.\r\n    // This is a hack, and should be removed once JSB fixes the retain/release bug.\r\n    release:function () {\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Default Action tag.\r\n * !#zh \r\n * @property TAG_INVALID\r\n * @constant\r\n * @static\r\n * @type {Number}\r\n * @default -1\r\n */\r\ncc.Action.TAG_INVALID = -1;\r\n\r\n\r\n/**\r\n * !#en\r\n * Base class actions that do have a finite time duration. <br/>\r\n * Possible actions: <br/>\r\n * - An action with a duration of 0 seconds. <br/>\r\n * - An action with a duration of 35.5 seconds.\r\n *\r\n * Infinite time actions are valid\r\n * !#zh  duration \r\n * @class FiniteTimeAction\r\n * @extends Action\r\n */\r\ncc.FiniteTimeAction = cc.Class({\r\n    name: 'cc.FiniteTimeAction',\r\n    extends: cc.Action,\r\n\r\n    ctor:function () {\r\n        //! duration in seconds\r\n        this._duration = 0;\r\n    },\r\n\r\n    /**\r\n     * !#en get duration of the action. (seconds).\r\n     * !#zh \r\n     * @method getDuration\r\n     * @return {Number}\r\n     */\r\n    getDuration:function () {\r\n        return this._duration * (this._timesForRepeat || 1);\r\n    },\r\n\r\n    /**\r\n     * !#en set duration of the action. (seconds).\r\n     * !#zh \r\n     * @method setDuration\r\n     * @param {Number} duration\r\n     */\r\n    setDuration:function (duration) {\r\n        this._duration = duration;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns a reversed action. <br />\r\n     * For example: <br />\r\n     * - The action will be x coordinates of 0 move to 100. <br />\r\n     * - The reversed action will be x of 100 move to 0.\r\n     * - Will be rewritten\r\n     * !#zh \r\n     * @method reverse\r\n     * @return {Null}\r\n     */\r\n    reverse:function () {\r\n        cc.logID(1008);\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * to copy object with deep copy.\r\n     * returns a clone of action.\r\n     * !#zh \r\n     * @method clone\r\n     * @return {FiniteTimeAction}\r\n     */\r\n    clone:function () {\r\n        return new cc.FiniteTimeAction();\r\n    }\r\n});\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/*\r\n * Changes the speed of an action, making it take longer (speed > 1)\r\n * or less (speed < 1) time. <br/>\r\n * Useful to simulate 'slow motion' or 'fast forward' effect.\r\n *\r\n * @warning This action can't be Sequenceable because it is not an cc.IntervalAction\r\n * @class Speed\r\n * @extends Action\r\n *\r\n * @param {ActionInterval} action\r\n * @param {Number} speed\r\n */\r\ncc.Speed = cc.Class({\r\n    name: 'cc.Speed',\r\n    extends: cc.Action,\r\n\r\n    ctor:function (action, speed) {\r\n        this._speed = 0;\r\n        this._innerAction = null;\r\n\r\n\t\taction && this.initWithAction(action, speed);\r\n    },\r\n\r\n    /*\r\n     * Gets the current running speed. <br />\r\n     * Will get a percentage number, compared to the original speed.\r\n     *\r\n     * @method getSpeed\r\n     * @return {Number}\r\n     */\r\n    getSpeed:function () {\r\n        return this._speed;\r\n    },\r\n\r\n    /*\r\n     * alter the speed of the inner function in runtime.\r\n     * @method setSpeed\r\n     * @param {Number} speed\r\n     */\r\n    setSpeed:function (speed) {\r\n        this._speed = speed;\r\n    },\r\n\r\n    /*\r\n     * initializes the action.\r\n     * @method initWithAction\r\n     * @param {ActionInterval} action\r\n     * @param {Number} speed\r\n     * @return {Boolean}\r\n     */\r\n    initWithAction:function (action, speed) {\r\n        if (!action) {\r\n            cc.errorID(1021);\r\n            return false;\r\n        }\r\n\r\n        this._innerAction = action;\r\n        this._speed = speed;\r\n        return true;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.Speed();\r\n        action.initWithAction(this._innerAction.clone(), this._speed);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.Action.prototype.startWithTarget.call(this, target);\r\n        this._innerAction.startWithTarget(target);\r\n    },\r\n\r\n    stop:function () {\r\n        this._innerAction.stop();\r\n        cc.Action.prototype.stop.call(this);\r\n    },\r\n\r\n    step:function (dt) {\r\n        this._innerAction.step(dt * this._speed);\r\n    },\r\n\r\n    isDone:function () {\r\n        return this._innerAction.isDone();\r\n    },\r\n\r\n    reverse:function () {\r\n        return new cc.Speed(this._innerAction.reverse(), this._speed);\r\n    },\r\n\r\n    /*\r\n     * Set inner Action.\r\n     * @method setInnerAction\r\n     * @param {ActionInterval} action\r\n     */\r\n    setInnerAction:function (action) {\r\n        if (this._innerAction !== action) {\r\n            this._innerAction = action;\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Get inner Action.\r\n     * @method getInnerAction\r\n     * @return {ActionInterval}\r\n     */\r\n    getInnerAction:function () {\r\n        return this._innerAction;\r\n    }\r\n});\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en\r\n * Creates the speed action which changes the speed of an action, making it take longer (speed > 1)\r\n * or less (speed < 1) time. <br/>\r\n * Useful to simulate 'slow motion' or 'fast forward' effect.\r\n * !#zh \r\n * @warning This action can't be Sequenceable because it is not an cc.IntervalAction\r\n *\r\n * @method speed\r\n * @param {ActionInterval} action\r\n * @param {Number} speed\r\n * @return {Action}\r\n * @example\r\n * // change the target action speed;\r\n * var action = cc.scaleTo(0.2, 1, 0.6);\r\n * var newAction = cc.speed(action, 0.5);\r\n */\r\ncc.speed = function (action, speed) {\r\n    return new cc.Speed(action, speed);\r\n};\r\n\r\n/*\r\n * cc.Follow is a follow action which makes its target follows another node.\r\n *\r\n * @example\r\n * //example\r\n * //Instead of using cc.Camera as a \"follower\", use this action instead.\r\n * layer.runAction(cc.follow(hero));\r\n *\r\n * @property {Number}  leftBoundary - world leftBoundary.\r\n * @property {Number}  rightBoundary - world rightBoundary.\r\n * @property {Number}  topBoundary - world topBoundary.\r\n * @property {Number}  bottomBoundary - world bottomBoundary.\r\n *\r\n * @param {cc.Node} followedNode\r\n * @param {Rect} rect\r\n * @example\r\n * // creates the action with a set boundary\r\n * var followAction = new cc.Follow(node, cc.rect(0, 0, s.width * 2 - 100, s.height));\r\n * this.runAction(followAction);\r\n *\r\n * // creates the action with no boundary set\r\n * var followAction = new cc.Follow(node);\r\n * this.runAction(followAction);\r\n *\r\n * @class\r\n * @extends Action\r\n */\r\ncc.Follow = cc.Class({\r\n    name: 'cc.Follow',\r\n    extends: cc.Action,\r\n\r\n\t/*\r\n     * Constructor function, override it to extend the construction behavior, remember to call \"this._super()\" in the extended \"ctor\" function. <br />\r\n\t * creates the action with a set boundary. <br/>\r\n\t * creates the action with no boundary set.\r\n     * @param {cc.Node} followedNode\r\n     * @param {Rect} rect\r\n\t */\r\n    ctor:function (followedNode, rect) {\r\n        // node to follow\r\n        this._followedNode = null;\r\n        // whether camera should be limited to certain area\r\n        this._boundarySet = false;\r\n        // if screen size is bigger than the boundary - update not needed\r\n        this._boundaryFullyCovered = false;\r\n        // fast access to the screen dimensions\r\n        this._halfScreenSize = null;\r\n        this._fullScreenSize = null;\r\n\r\n        this.leftBoundary = 0.0;\r\n        this.rightBoundary = 0.0;\r\n        this.topBoundary = 0.0;\r\n        this.bottomBoundary = 0.0;\r\n        this._worldRect = cc.rect(0, 0, 0, 0);\r\n\r\n\t\tif(followedNode)\r\n\t\t\trect ? this.initWithTarget(followedNode, rect)\r\n\t\t\t\t : this.initWithTarget(followedNode);\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.Follow();\r\n        var locRect = this._worldRect;\r\n        var rect = new cc.Rect(locRect.x, locRect.y, locRect.width, locRect.height);\r\n        action.initWithTarget(this._followedNode, rect);\r\n        return action;\r\n    },\r\n\r\n    /*\r\n     * Get whether camera should be limited to certain area.\r\n     *\r\n     * @return {Boolean}\r\n     */\r\n    isBoundarySet:function () {\r\n        return this._boundarySet;\r\n    },\r\n\r\n    /*\r\n     * alter behavior - turn on/off boundary.\r\n     *\r\n     * @param {Boolean} value\r\n     */\r\n    setBoudarySet:function (value) {\r\n        this._boundarySet = value;\r\n    },\r\n\r\n    /*\r\n     * initializes the action with a set boundary.\r\n     *\r\n     * @param {cc.Node} followedNode\r\n     * @param {Rect} [rect=]\r\n     * @return {Boolean}\r\n     */\r\n    initWithTarget:function (followedNode, rect) {\r\n        if (!followedNode) {\r\n            cc.errorID(1022);\r\n            return false;\r\n        }\r\n\r\n        var _this = this;\r\n        rect = rect || cc.rect(0, 0, 0, 0);\r\n        _this._followedNode = followedNode;\r\n        _this._worldRect = rect;\r\n\r\n        _this._boundarySet = !(rect.width === 0 && rect.height === 0);\r\n\r\n        _this._boundaryFullyCovered = false;\r\n\r\n        var winSize = cc.winSize;\r\n        _this._fullScreenSize = cc.v2(winSize.width, winSize.height);\r\n        _this._halfScreenSize = _this._fullScreenSize.mul(0.5);\r\n\r\n        if (_this._boundarySet) {\r\n            _this.leftBoundary = -((rect.x + rect.width) - _this._fullScreenSize.x);\r\n            _this.rightBoundary = -rect.x;\r\n            _this.topBoundary = -rect.y;\r\n            _this.bottomBoundary = -((rect.y + rect.height) - _this._fullScreenSize.y);\r\n\r\n            if (_this.rightBoundary < _this.leftBoundary) {\r\n                // screen width is larger than world's boundary width\r\n                //set both in the middle of the world\r\n                _this.rightBoundary = _this.leftBoundary = (_this.leftBoundary + _this.rightBoundary) / 2;\r\n            }\r\n            if (_this.topBoundary < _this.bottomBoundary) {\r\n                // screen width is larger than world's boundary width\r\n                //set both in the middle of the world\r\n                _this.topBoundary = _this.bottomBoundary = (_this.topBoundary + _this.bottomBoundary) / 2;\r\n            }\r\n\r\n            if ((_this.topBoundary === _this.bottomBoundary) && (_this.leftBoundary === _this.rightBoundary))\r\n                _this._boundaryFullyCovered = true;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    step:function (dt) {\r\n        var targetWorldPos = this.target.convertToWorldSpaceAR(cc.Vec2.ZERO);\r\n        var followedWorldPos = this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO);\r\n        // compute the offset between followed and target node\r\n        var delta = targetWorldPos.sub(followedWorldPos);\r\n        var tempPos = this.target.parent.convertToNodeSpaceAR(delta.add(this._halfScreenSize));\r\n\r\n        if (this._boundarySet) {\r\n            // whole map fits inside a single screen, no need to modify the position - unless map boundaries are increased\r\n            if (this._boundaryFullyCovered)\r\n                return;\r\n\r\n\t        this.target.setPosition(misc.clampf(tempPos.x, this.leftBoundary, this.rightBoundary), misc.clampf(tempPos.y, this.bottomBoundary, this.topBoundary));\r\n        } else {\r\n            this.target.setPosition(tempPos.x, tempPos.y);\r\n        }\r\n    },\r\n\r\n    isDone:function () {\r\n        return ( !this._followedNode.activeInHierarchy );\r\n    },\r\n\r\n    stop:function () {\r\n        this.target = null;\r\n        cc.Action.prototype.stop.call(this);\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Create a follow action which makes its target follows another node.\r\n * !#zh \r\n * @method follow\r\n * @param {Node} followedNode\r\n * @param {Rect} rect\r\n * @return {Action|Null} returns the cc.Follow object on success\r\n * @example\r\n * // example\r\n * // creates the action with a set boundary\r\n * var followAction = cc.follow(targetNode, cc.rect(0, 0, screenWidth * 2 - 100, screenHeight));\r\n * node.runAction(followAction);\r\n *\r\n * // creates the action with no boundary set\r\n * var followAction = cc.follow(targetNode);\r\n * node.runAction(followAction);\r\n */\r\ncc.follow = function (followedNode, rect) {\r\n    return new cc.Follow(followedNode, rect);\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2008 Radu Gruian\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011 Vit Valentin\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n\r\n Orignal code by Radu Gruian: http://www.codeproject.com/Articles/30838/Overhauser-Catmull-Rom-Splines-for-Camera-Animatio.So\r\n\r\n Adapted to cocos2d-x by Vit Valentin\r\n\r\n Adapted from cocos2d-x to cocos2d-iphone by Ricardo Quesada\r\n ****************************************************************************/\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/*\r\n * Returns the Cardinal Spline position for a given set of control points, tension and time. <br />\r\n * CatmullRom Spline formula. <br />\r\n * s(-ttt + 2tt - t)P1 + s(-ttt + tt)P2 + (2ttt - 3tt + 1)P2 + s(ttt - 2tt + t)P3 + (-2ttt + 3tt)P3 + s(ttt - tt)P4\r\n *\r\n * @method cardinalSplineAt\r\n * @param {Vec2} p0\r\n * @param {Vec2} p1\r\n * @param {Vec2} p2\r\n * @param {Vec2} p3\r\n * @param {Number} tension\r\n * @param {Number} t\r\n * @return {Vec2}\r\n */\r\nfunction cardinalSplineAt (p0, p1, p2, p3, tension, t) {\r\n    var t2 = t * t;\r\n    var t3 = t2 * t;\r\n\r\n    /*\r\n     * Formula: s(-ttt + 2tt - t)P1 + s(-ttt + tt)P2 + (2ttt - 3tt + 1)P2 + s(ttt - 2tt + t)P3 + (-2ttt + 3tt)P3 + s(ttt - tt)P4\r\n     */\r\n    var s = (1 - tension) / 2;\r\n\r\n    var b1 = s * ((-t3 + (2 * t2)) - t);                      // s(-t3 + 2 t2 - t)P1\r\n    var b2 = s * (-t3 + t2) + (2 * t3 - 3 * t2 + 1);          // s(-t3 + t2)P2 + (2 t3 - 3 t2 + 1)P2\r\n    var b3 = s * (t3 - 2 * t2 + t) + (-2 * t3 + 3 * t2);      // s(t3 - 2 t2 + t)P3 + (-2 t3 + 3 t2)P3\r\n    var b4 = s * (t3 - t2);                                   // s(t3 - t2)P4\r\n\r\n    var x = (p0.x * b1 + p1.x * b2 + p2.x * b3 + p3.x * b4);\r\n    var y = (p0.y * b1 + p1.y * b2 + p2.y * b3 + p3.y * b4);\r\n    return cc.v2(x, y);\r\n};\r\n\r\n/*\r\n * returns a point from the array\r\n * @method getControlPointAt\r\n * @param {Array} controlPoints\r\n * @param {Number} pos\r\n * @return {Array}\r\n */\r\nfunction getControlPointAt (controlPoints, pos) {\r\n    var p = Math.min(controlPoints.length - 1, Math.max(pos, 0));\r\n    return controlPoints[p];\r\n};\r\n\r\nfunction reverseControlPoints (controlPoints) {\r\n    var newArray = [];\r\n    for (var i = controlPoints.length - 1; i >= 0; i--) {\r\n        newArray.push(cc.v2(controlPoints[i].x, controlPoints[i].y));\r\n    }\r\n    return newArray;\r\n}\r\n\r\nfunction cloneControlPoints (controlPoints) {\r\n    var newArray = [];\r\n    for (var i = 0; i < controlPoints.length; i++)\r\n        newArray.push(cc.v2(controlPoints[i].x, controlPoints[i].y));\r\n    return newArray;\r\n}\r\n\r\n\r\n/*\r\n * Cardinal Spline path. http://en.wikipedia.org/wiki/Cubic_Hermite_spline#Cardinal_spline\r\n * Absolute coordinates.\r\n *\r\n * @class CardinalSplineTo\r\n * @extends ActionInterval\r\n *\r\n * @param {Number} duration\r\n * @param {Array} points array of control points\r\n * @param {Number} tension\r\n *\r\n * @example\r\n * //create a cc.CardinalSplineTo\r\n * var action1 = cc.cardinalSplineTo(3, array, 0);\r\n */\r\ncc.CardinalSplineTo = cc.Class({\r\n    name: 'cc.CardinalSplineTo',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor: function (duration, points, tension) {\r\n        /* Array of control points */\r\n        this._points = [];\r\n        this._deltaT = 0;\r\n        this._tension = 0;\r\n        this._previousPosition = null;\r\n        this._accumulatedDiff = null;\r\n        tension !== undefined && cc.CardinalSplineTo.prototype.initWithDuration.call(this, duration, points, tension);\r\n    },\r\n\r\n    initWithDuration:function (duration, points, tension) {\r\n        if (!points || points.length === 0) {\r\n            cc.errorID(1024);\r\n            return false;\r\n        }\r\n\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            this.setPoints(points);\r\n            this._tension = tension;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.CardinalSplineTo();\r\n        action.initWithDuration(this._duration, cloneControlPoints(this._points), this._tension);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        // Issue #1441 from cocos2d-iphone\r\n        this._deltaT = 1 / (this._points.length - 1);\r\n        this._previousPosition = cc.v2(this.target.x, this.target.y);\r\n        this._accumulatedDiff = cc.v2(0, 0);\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        var p, lt;\r\n        var ps = this._points;\r\n        // eg.\r\n        // p..p..p..p..p..p..p\r\n        // 1..2..3..4..5..6..7\r\n        // want p to be 1, 2, 3, 4, 5, 6\r\n        if (dt === 1) {\r\n            p = ps.length - 1;\r\n            lt = 1;\r\n        } else {\r\n            var locDT = this._deltaT;\r\n            p = 0 | (dt / locDT);\r\n            lt = (dt - locDT * p) / locDT;\r\n        }\r\n\r\n        var newPos = cardinalSplineAt(\r\n            getControlPointAt(ps, p - 1),\r\n            getControlPointAt(ps, p - 0),\r\n            getControlPointAt(ps, p + 1),\r\n            getControlPointAt(ps, p + 2),\r\n            this._tension, lt);\r\n\r\n        if (cc.macro.ENABLE_STACKABLE_ACTIONS) {\r\n            var tempX, tempY;\r\n            tempX = this.target.x - this._previousPosition.x;\r\n            tempY = this.target.y - this._previousPosition.y;\r\n            if (tempX !== 0 || tempY !== 0) {\r\n                var locAccDiff = this._accumulatedDiff;\r\n                tempX = locAccDiff.x + tempX;\r\n                tempY = locAccDiff.y + tempY;\r\n                locAccDiff.x = tempX;\r\n                locAccDiff.y = tempY;\r\n                newPos.x += tempX;\r\n                newPos.y += tempY;\r\n            }\r\n        }\r\n        this.updatePosition(newPos);\r\n    },\r\n\r\n    reverse:function () {\r\n        var reversePoints = reverseControlPoints(this._points);\r\n        return cc.cardinalSplineTo(this._duration, reversePoints, this._tension);\r\n    },\r\n\r\n    /*\r\n     * update position of target\r\n     * @method updatePosition\r\n     * @param {Vec2} newPos\r\n     */\r\n    updatePosition:function (newPos) {\r\n        this.target.setPosition(newPos);\r\n        this._previousPosition = newPos;\r\n    },\r\n\r\n    /*\r\n     * Points getter\r\n     * @method getPoints\r\n     * @return {Array}\r\n     */\r\n    getPoints:function () {\r\n        return this._points;\r\n    },\r\n\r\n    /**\r\n     * Points setter\r\n     * @method setPoints\r\n     * @param {Array} points\r\n     */\r\n    setPoints:function (points) {\r\n        this._points = points;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Creates an action with a Cardinal Spline array of points and tension.\r\n * !#zh \r\n * @method cardinalSplineTo\r\n * @param {Number} duration\r\n * @param {Array} points array of control points\r\n * @param {Number} tension\r\n * @return {ActionInterval}\r\n *\r\n * @example\r\n * //create a cc.CardinalSplineTo\r\n * var action1 = cc.cardinalSplineTo(3, array, 0);\r\n */\r\ncc.cardinalSplineTo = function (duration, points, tension) {\r\n    return new cc.CardinalSplineTo(duration, points, tension);\r\n};\r\n\r\n/*\r\n * Cardinal Spline path. http://en.wikipedia.org/wiki/Cubic_Hermite_spline#Cardinal_spline\r\n * Relative coordinates.\r\n *\r\n * @class CardinalSplineBy\r\n * @extends CardinalSplineTo\r\n *\r\n * @param {Number} duration\r\n * @param {Array} points\r\n * @param {Number} tension\r\n *\r\n * @example\r\n * //create a cc.CardinalSplineBy\r\n * var action1 = cc.cardinalSplineBy(3, array, 0);\r\n */\r\ncc.CardinalSplineBy = cc.Class({\r\n    name: 'cc.CardinalSplineBy',\r\n    extends: cc.CardinalSplineTo,\r\n\r\n    ctor:function (duration, points, tension) {\r\n        this._startPosition = cc.v2(0, 0);\r\n        tension !== undefined && this.initWithDuration(duration, points, tension);\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.CardinalSplineTo.prototype.startWithTarget.call(this, target);\r\n        this._startPosition.x = target.x;\r\n        this._startPosition.y = target.y;\r\n    },\r\n\r\n    reverse:function () {\r\n        var copyConfig = this._points.slice();\r\n        var current;\r\n        //\r\n        // convert \"absolutes\" to \"diffs\"\r\n        //\r\n        var p = copyConfig[0];\r\n        for (var i = 1; i < copyConfig.length; ++i) {\r\n            current = copyConfig[i];\r\n            copyConfig[i] = current.sub(p);\r\n            p = current;\r\n        }\r\n\r\n        // convert to \"diffs\" to \"reverse absolute\"\r\n        var reverseArray = reverseControlPoints(copyConfig);\r\n\r\n        // 1st element (which should be 0,0) should be here too\r\n        p = reverseArray[ reverseArray.length - 1 ];\r\n        reverseArray.pop();\r\n\r\n        p.x = -p.x;\r\n        p.y = -p.y;\r\n\r\n        reverseArray.unshift(p);\r\n        for (var i = 1; i < reverseArray.length; ++i) {\r\n            current = reverseArray[i];\r\n            current.x = -current.x;\r\n            current.y = -current.y;\r\n            current.x += p.x;\r\n            current.y += p.y;\r\n            reverseArray[i] = current;\r\n            p = current;\r\n        }\r\n        return cc.cardinalSplineBy(this._duration, reverseArray, this._tension);\r\n    },\r\n\r\n    /**\r\n     * update position of target\r\n     * @method updatePosition\r\n     * @param {Vec2} newPos\r\n     */\r\n    updatePosition:function (newPos) {\r\n        var pos = this._startPosition;\r\n        var posX = newPos.x + pos.x;\r\n        var posY = newPos.y + pos.y;\r\n        this._previousPosition.x = posX;\r\n        this._previousPosition.y = posY;\r\n        this.target.setPosition(posX, posY);\r\n    },\r\n\r\n    clone:function () {\r\n        var a = new cc.CardinalSplineBy();\r\n        a.initWithDuration(this._duration, cloneControlPoints(this._points), this._tension);\r\n        return a;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Creates an action with a Cardinal Spline array of points and tension.\r\n * !#zh \r\n * @method cardinalSplineBy\r\n * @param {Number} duration\r\n * @param {Array} points\r\n * @param {Number} tension\r\n *\r\n * @return {ActionInterval}\r\n */\r\ncc.cardinalSplineBy = function (duration, points, tension) {\r\n    return new cc.CardinalSplineBy(duration, points, tension);\r\n};\r\n\r\n/*\r\n * An action that moves the target with a CatmullRom curve to a destination point.<br/>\r\n * A Catmull Rom is a Cardinal Spline with a tension of 0.5.  <br/>\r\n * http://en.wikipedia.org/wiki/Cubic_Hermite_spline#Catmull.E2.80.93Rom_spline\r\n * Absolute coordinates.\r\n *\r\n * @class CatmullRomTo\r\n * @extends CardinalSplineTo\r\n *\r\n * @param {Number} dt\r\n * @param {Array} points\r\n *\r\n * @example\r\n * var action1 = cc.catmullRomTo(3, array);\r\n */\r\ncc.CatmullRomTo = cc.Class({\r\n    name: 'cc.CatmullRomTo',\r\n    extends: cc.CardinalSplineTo,\r\n\r\n    ctor: function(dt, points) {\r\n        points && this.initWithDuration(dt, points);\r\n    },\r\n\r\n    initWithDuration:function (dt, points) {\r\n        return cc.CardinalSplineTo.prototype.initWithDuration.call(this, dt, points, 0.5);\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.CatmullRomTo();\r\n        action.initWithDuration(this._duration, cloneControlPoints(this._points));\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Creates an action with a Cardinal Spline array of points and tension.\r\n * !#zh  Catmull Rom \r\n * @method catmullRomTo\r\n * @param {Number} dt\r\n * @param {Array} points\r\n * @return {ActionInterval}\r\n *\r\n * @example\r\n * var action1 = cc.catmullRomTo(3, array);\r\n */\r\ncc.catmullRomTo = function (dt, points) {\r\n    return new cc.CatmullRomTo(dt, points);\r\n};\r\n\r\n/*\r\n * An action that moves the target with a CatmullRom curve by a certain distance.  <br/>\r\n * A Catmull Rom is a Cardinal Spline with a tension of 0.5.<br/>\r\n * http://en.wikipedia.org/wiki/Cubic_Hermite_spline#Catmull.E2.80.93Rom_spline\r\n * Relative coordinates.\r\n *\r\n * @class CatmullRomBy\r\n * @extends CardinalSplineBy\r\n *\r\n * @param {Number} dt\r\n * @param {Array} points\r\n *\r\n * @example\r\n * var action1 = cc.catmullRomBy(3, array);\r\n */\r\ncc.CatmullRomBy = cc.Class({\r\n    name: 'cc.CatmullRomBy',\r\n    extends: cc.CardinalSplineBy,\r\n\r\n    ctor: function(dt, points) {\r\n        points && this.initWithDuration(dt, points);\r\n    },\r\n\r\n    initWithDuration:function (dt, points) {\r\n        return cc.CardinalSplineTo.prototype.initWithDuration.call(this, dt, points, 0.5);\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.CatmullRomBy();\r\n        action.initWithDuration(this._duration, cloneControlPoints(this._points));\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Creates an action with a Cardinal Spline array of points and tension.\r\n * !#zh  Catmull Rom \r\n * @method catmullRomBy\r\n * @param {Number} dt\r\n * @param {Array} points\r\n * @return {ActionInterval}\r\n * @example\r\n * var action1 = cc.catmullRomBy(3, array);\r\n */\r\ncc.catmullRomBy = function (dt, points) {\r\n    return new cc.CatmullRomBy(dt, points);\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object with the rate parameter. <br />\r\n * From slow to fast.\r\n * !#zh  easeIn \r\n * @method easeIn\r\n * @param {Number} rate\r\n * @return {Object}\r\n * @example\r\n * action.easing(cc.easeIn(3.0));\r\n */\r\ncc.easeIn = function (rate) {\r\n    return {\r\n        _rate: rate,\r\n        easing: function (dt) {\r\n            return Math.pow(dt, this._rate);\r\n        },\r\n        reverse: function(){\r\n            return cc.easeIn(1 / this._rate);\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object with the rate parameter. <br />\r\n * From fast to slow.\r\n * !#zh  easeOut \r\n * @method easeOut\r\n * @param {Number} rate\r\n * @return {Object}\r\n * @example\r\n * action.easing(cc.easeOut(3.0));\r\n */\r\ncc.easeOut = function (rate) {\r\n    return {\r\n        _rate: rate,\r\n        easing: function (dt) {\r\n            return Math.pow(dt, 1 / this._rate);\r\n        },\r\n        reverse: function(){\r\n            return cc.easeOut(1 / this._rate);\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object with the rate parameter. <br />\r\n * Slow to fast then to slow.\r\n * !#zh  easeInOut \r\n * @method easeInOut\r\n * @param {Number} rate\r\n * @return {Object}\r\n *\r\n * @example\r\n * action.easing(cc.easeInOut(3.0));\r\n */\r\ncc.easeInOut = function (rate) {\r\n    return {\r\n        _rate: rate,\r\n        easing: function (dt) {\r\n            dt *= 2;\r\n            if (dt < 1)\r\n                return 0.5 * Math.pow(dt, this._rate);\r\n            else\r\n                return 1.0 - 0.5 * Math.pow(2 - dt, this._rate);\r\n        },\r\n        reverse: function(){\r\n            return cc.easeInOut(this._rate);\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object with the rate parameter. <br />\r\n * Reference easeInExpo: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeExponentialIn <br />\r\n * EaseExponentialIn <br />\r\n *  easeInExpohttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeExponentialIn\r\n * @return {Object}\r\n * @example\r\n * action.easing(cc.easeExponentialIn());\r\n */\r\nvar _easeExponentialInObj = {\r\n    easing: function(dt){\r\n        return dt === 0 ? 0 : Math.pow(2, 10 * (dt - 1));\r\n    },\r\n    reverse: function(){\r\n        return _easeExponentialOutObj;\r\n    }\r\n};\r\ncc.easeExponentialIn = function(){\r\n    return _easeExponentialInObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeOutExpo: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeExponentialOut <br />\r\n * EaseExponentialOut <br />\r\n *  easeOutExpohttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeExponentialOut\r\n * @return {Object}\r\n * @example\r\n * action.easing(cc.easeExponentialOut());\r\n */\r\nvar _easeExponentialOutObj = {\r\n    easing: function(dt){\r\n        return dt === 1 ? 1 : (-(Math.pow(2, -10 * dt)) + 1);\r\n    },\r\n    reverse: function(){\r\n        return _easeExponentialInObj;\r\n    }\r\n};\r\ncc.easeExponentialOut = function(){\r\n    return _easeExponentialOutObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates an EaseExponentialInOut action easing object. <br />\r\n * Reference easeInOutExpo: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeExponentialInOut <br />\r\n * EaseExponentialInOut <br />\r\n *  easeInOutExpohttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeExponentialInOut\r\n * @return {Object}\r\n * @example\r\n * action.easing(cc.easeExponentialInOut());\r\n */\r\nvar _easeExponentialInOutObj = {\r\n    easing: function(dt){\r\n        if( dt !== 1 && dt !== 0) {\r\n            dt *= 2;\r\n            if (dt < 1)\r\n                return 0.5 * Math.pow(2, 10 * (dt - 1));\r\n            else\r\n                return 0.5 * (-Math.pow(2, -10 * (dt - 1)) + 2);\r\n        }\r\n        return dt;\r\n    },\r\n    reverse: function(){\r\n        return _easeExponentialInOutObj;\r\n    }\r\n};\r\ncc.easeExponentialInOut = function(){\r\n    return _easeExponentialInOutObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates an EaseSineIn action. <br />\r\n * Reference easeInSine: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  EaseSineIn <br />\r\n * EaseSineIn <br />\r\n *  easeInSinehttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeSineIn\r\n * @return {Object}\r\n * @example\r\n * action.easing(cc.easeSineIn());\r\n */\r\nvar _easeSineInObj = {\r\n    easing: function(dt){\r\n        return (dt===0 || dt===1) ? dt : -1 * Math.cos(dt * Math.PI / 2) + 1;\r\n    },\r\n    reverse: function(){\r\n        return _easeSineOutObj;\r\n    }\r\n};\r\ncc.easeSineIn = function(){\r\n    return _easeSineInObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates an EaseSineOut action easing object. <br />\r\n * Reference easeOutSine: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  EaseSineOut <br />\r\n * EaseSineIn <br />\r\n *  easeOutSinehttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeSineOut\r\n * @return {Object}\r\n * @example\r\n * action.easing(cc.easeSineOut());\r\n */\r\nvar _easeSineOutObj = {\r\n    easing: function(dt){\r\n        return (dt===0 || dt===1) ? dt : Math.sin(dt * Math.PI / 2);\r\n    },\r\n    reverse: function(){\r\n        return _easeSineInObj;\r\n    }\r\n};\r\ncc.easeSineOut = function(){\r\n    return _easeSineOutObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInOutSine: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeSineInOut <br />\r\n * EaseSineIn <br />\r\n *  easeInOutSinehttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeSineInOut\r\n * @return {Object}\r\n * @example\r\n * action.easing(cc.easeSineInOut());\r\n */\r\nvar _easeSineInOutObj = {\r\n    easing: function(dt){\r\n        return (dt === 0 || dt === 1) ? dt : -0.5 * (Math.cos(Math.PI * dt) - 1);\r\n    },\r\n    reverse: function(){\r\n        return _easeSineInOutObj;\r\n    }\r\n};\r\ncc.easeSineInOut = function(){\r\n    return _easeSineInOutObj;\r\n};\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object with the period in radians (default is 0.3). <br />\r\n * Reference easeInElastic: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeElasticIn <br />\r\n * EaseElasticIn <br />\r\n *  easeInElastichttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeElasticIn\r\n * @param {Number} period\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeElasticIn(3.0));\r\n */\r\n//default ease elastic in object (period = 0.3)\r\nvar _easeElasticInObj = {\r\n    easing:function(dt){\r\n        if (dt === 0 || dt === 1)\r\n            return dt;\r\n        dt = dt - 1;\r\n        return -Math.pow(2, 10 * dt) * Math.sin((dt - (0.3 / 4)) * Math.PI * 2 / 0.3);\r\n    },\r\n     reverse:function(){\r\n         return _easeElasticOutObj;\r\n     }\r\n };\r\ncc.easeElasticIn = function (period) {\r\n    if(period && period !== 0.3){\r\n        return {\r\n            _period: period,\r\n            easing: function (dt) {\r\n                if (dt === 0 || dt === 1)\r\n                    return dt;\r\n                dt = dt - 1;\r\n                return -Math.pow(2, 10 * dt) * Math.sin((dt - (this._period / 4)) * Math.PI * 2 / this._period);\r\n            },\r\n            reverse:function () {\r\n                return cc.easeElasticOut(this._period);\r\n            }\r\n        };\r\n    }\r\n    return _easeElasticInObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object with the period in radians (default is 0.3). <br />\r\n * Reference easeOutElastic: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeElasticOut <br />\r\n * EaseElasticOut <br />\r\n *  easeOutElastichttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeElasticOut\r\n * @param {Number} period\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeElasticOut(3.0));\r\n */\r\n//default ease elastic out object (period = 0.3)\r\nvar _easeElasticOutObj = {\r\n    easing: function (dt) {\r\n        return (dt === 0 || dt === 1) ? dt : Math.pow(2, -10 * dt) * Math.sin((dt - (0.3 / 4)) * Math.PI * 2 / 0.3) + 1;\r\n    },\r\n    reverse:function(){\r\n        return _easeElasticInObj;\r\n    }\r\n};\r\ncc.easeElasticOut = function (period) {\r\n    if(period && period !== 0.3){\r\n        return {\r\n            _period: period,\r\n            easing: function (dt) {\r\n                return (dt === 0 || dt === 1) ? dt : Math.pow(2, -10 * dt) * Math.sin((dt - (this._period / 4)) * Math.PI * 2 / this._period) + 1;\r\n            },\r\n            reverse:function(){\r\n                return cc.easeElasticIn(this._period);\r\n            }\r\n        };\r\n    }\r\n    return _easeElasticOutObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object with the period in radians (default is 0.3). <br />\r\n * Reference easeInOutElastic: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeElasticInOut <br />\r\n * EaseElasticInOut <br />\r\n *  easeInOutElastichttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeElasticInOut\r\n * @param {Number} period\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeElasticInOut(3.0));\r\n */\r\ncc.easeElasticInOut = function (period) {\r\n    period = period || 0.3;\r\n    return {\r\n        _period: period,\r\n        easing: function (dt) {\r\n            var newT = 0;\r\n            var locPeriod = this._period;\r\n            if (dt === 0 || dt === 1) {\r\n                newT = dt;\r\n            } else {\r\n                dt = dt * 2;\r\n                if (!locPeriod)\r\n                    locPeriod = this._period = 0.3 * 1.5;\r\n                var s = locPeriod / 4;\r\n                dt = dt - 1;\r\n                if (dt < 0)\r\n                    newT = -0.5 * Math.pow(2, 10 * dt) * Math.sin((dt - s) * Math.PI * 2 / locPeriod);\r\n                else\r\n                    newT = Math.pow(2, -10 * dt) * Math.sin((dt - s) * Math.PI * 2 / locPeriod) * 0.5 + 1;\r\n            }\r\n            return newT;\r\n        },\r\n        reverse: function(){\r\n            return cc.easeElasticInOut(this._period);\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\nfunction _bounceTime (time1) {\r\n    if (time1 < 1 / 2.75) {\r\n        return 7.5625 * time1 * time1;\r\n    } else if (time1 < 2 / 2.75) {\r\n        time1 -= 1.5 / 2.75;\r\n        return 7.5625 * time1 * time1 + 0.75;\r\n    } else if (time1 < 2.5 / 2.75) {\r\n        time1 -= 2.25 / 2.75;\r\n        return 7.5625 * time1 * time1 + 0.9375;\r\n    }\r\n\r\n    time1 -= 2.625 / 2.75;\r\n    return 7.5625 * time1 * time1 + 0.984375;\r\n};\r\n\r\nvar _easeBounceInObj = {\r\n    easing: function(dt){\r\n        return 1 - _bounceTime(1 - dt);\r\n    },\r\n    reverse: function(){\r\n        return _easeBounceOutObj;\r\n    }\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Eased bounce effect at the beginning.\r\n * !#zh\r\n *  easeBounceIn <br />\r\n * EaseBounceIn \r\n * @method easeBounceIn\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeBounceIn());\r\n */\r\ncc.easeBounceIn = function(){\r\n    return _easeBounceInObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Eased bounce effect at the ending.\r\n * !#zh\r\n *  easeBounceOut <br />\r\n * EaseBounceOut \r\n * @method easeBounceOut\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeBounceOut());\r\n */\r\nvar _easeBounceOutObj = {\r\n    easing: function(dt){\r\n        return _bounceTime(dt);\r\n    },\r\n    reverse:function () {\r\n        return _easeBounceInObj;\r\n    }\r\n};\r\ncc.easeBounceOut = function(){\r\n    return _easeBounceOutObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Eased bounce effect at the begining and ending.\r\n * !#zh\r\n *  easeBounceInOut <br />\r\n * EaseBounceInOut \r\n * @method easeBounceInOut\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeBounceInOut());\r\n */\r\nvar _easeBounceInOutObj = {\r\n    easing: function (time1) {\r\n        var newT;\r\n        if (time1 < 0.5) {\r\n            time1 = time1 * 2;\r\n            newT = (1 - _bounceTime(1 - time1)) * 0.5;\r\n        } else {\r\n            newT = _bounceTime(time1 * 2 - 1) * 0.5 + 0.5;\r\n        }\r\n        return newT;\r\n    },\r\n    reverse: function(){\r\n        return _easeBounceInOutObj;\r\n    }\r\n};\r\ncc.easeBounceInOut = function(){\r\n    return _easeBounceInOutObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * In the opposite direction to move slowly, and then accelerated to the right direction.\r\n * !#zh\r\n *  easeBackIn <br />\r\n * easeBackIn <br />\r\n * @method easeBackIn\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeBackIn());\r\n */\r\nvar _easeBackInObj = {\r\n    easing: function (time1) {\r\n        var overshoot = 1.70158;\r\n        return (time1===0 || time1===1) ? time1 : time1 * time1 * ((overshoot + 1) * time1 - overshoot);\r\n    },\r\n    reverse: function(){\r\n        return _easeBackOutObj;\r\n    }\r\n};\r\ncc.easeBackIn = function(){\r\n    return _easeBackInObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Fast moving more than the finish, and then slowly back to the finish.\r\n * !#zh\r\n *  easeBackOut <br />\r\n * easeBackOut \r\n * @method easeBackOut\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeBackOut());\r\n */\r\nvar _easeBackOutObj = {\r\n    easing: function (time1) {\r\n        var overshoot = 1.70158;\r\n        time1 = time1 - 1;\r\n        return time1 * time1 * ((overshoot + 1) * time1 + overshoot) + 1;\r\n    },\r\n    reverse: function(){\r\n        return _easeBackInObj;\r\n    }\r\n};\r\ncc.easeBackOut = function(){\r\n    return _easeBackOutObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Begining of cc.EaseBackIn. Ending of cc.EaseBackOut.\r\n * !#zh\r\n *  easeBackInOut <br />\r\n * @method easeBackInOut\r\n * @return {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeBackInOut());\r\n */\r\nvar _easeBackInOutObj = {\r\n    easing: function (time1) {\r\n        var overshoot = 1.70158 * 1.525;\r\n        time1 = time1 * 2;\r\n        if (time1 < 1) {\r\n            return (time1 * time1 * ((overshoot + 1) * time1 - overshoot)) / 2;\r\n        } else {\r\n            time1 = time1 - 2;\r\n            return (time1 * time1 * ((overshoot + 1) * time1 + overshoot)) / 2 + 1;\r\n        }\r\n    },\r\n    reverse: function(){\r\n        return _easeBackInOutObj;\r\n    }\r\n};\r\ncc.easeBackInOut = function(){\r\n    return _easeBackInOutObj;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Into the 4 reference point. <br />\r\n * To calculate the motion curve.\r\n * !#zh\r\n *  easeBezierAction <br />\r\n * EaseBezierAction \r\n * @method easeBezierAction\r\n * @param {Number} p0 The first bezier parameter\r\n * @param {Number} p1 The second bezier parameter\r\n * @param {Number} p2 The third bezier parameter\r\n * @param {Number} p3 The fourth bezier parameter\r\n * @returns {Object}\r\n * @example\r\n * // example\r\n * action.easing(cc.easeBezierAction(0.5, 0.5, 1.0, 1.0));\r\n */\r\ncc.easeBezierAction = function(a, b, c, d){\r\n    return {\r\n        easing: function(t){\r\n            return (Math.pow(1-t,3) * a + 3*t*(Math.pow(1-t,2))*b + 3*Math.pow(t,2)*(1-t)*c + Math.pow(t,3)*d);\r\n        },\r\n        reverse: function(){\r\n            return cc.easeBezierAction(d, c, b, a);\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInQuad: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuadraticActionIn <br />\r\n * EaseQuadraticIn<br />\r\n *  easeInQuadhttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuadraticActionIn\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeQuadraticActionIn());\r\n */\r\nvar _easeQuadraticActionIn = {\r\n    easing: function(time){\r\n        return Math.pow(time, 2);\r\n    },\r\n    reverse: function(){\r\n        return _easeQuadraticActionIn;\r\n    }\r\n};\r\ncc.easeQuadraticActionIn = function(){\r\n    return _easeQuadraticActionIn;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeOutQuad: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuadraticActionOut <br />\r\n * EaseQuadraticOut <br />\r\n *  easeOutQuadhttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuadraticActionOut\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeQuadraticActionOut());\r\n */\r\nvar _easeQuadraticActionOut = {\r\n    easing: function(time){\r\n        return -time*(time-2);\r\n    },\r\n    reverse: function(){\r\n        return _easeQuadraticActionOut;\r\n    }\r\n};\r\ncc.easeQuadraticActionOut = function(){\r\n    return _easeQuadraticActionOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInOutQuad: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuadraticActionInOut <br />\r\n * EaseQuadraticInOut <br />\r\n *  easeInOutQuadhttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuadraticActionInOut\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeQuadraticActionInOut());\r\n */\r\nvar _easeQuadraticActionInOut = {\r\n    easing: function(time){\r\n        var resultTime = time;\r\n        time *= 2;\r\n        if(time < 1){\r\n            resultTime = time * time * 0.5;\r\n        }else{\r\n            --time;\r\n            resultTime = -0.5 * ( time * ( time - 2 ) - 1)\r\n        }\r\n        return resultTime;\r\n    },\r\n    reverse: function(){\r\n        return _easeQuadraticActionInOut;\r\n    }\r\n};\r\ncc.easeQuadraticActionInOut = function(){\r\n    return _easeQuadraticActionInOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeIntQuart: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuarticActionIn <br />\r\n * EaseQuarticIn <br />\r\n *  easeIntQuarthttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuarticActionIn\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeQuarticActionIn());\r\n */\r\nvar _easeQuarticActionIn = {\r\n    easing: function(time){\r\n        return time * time * time * time;\r\n    },\r\n    reverse: function(){\r\n        return _easeQuarticActionIn;\r\n    }\r\n};\r\ncc.easeQuarticActionIn = function(){\r\n    return _easeQuarticActionIn;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeOutQuart: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuarticActionOut <br />\r\n * EaseQuarticOut <br />\r\n *  easeOutQuarthttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuarticActionOut\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.QuarticActionOut());\r\n */\r\nvar _easeQuarticActionOut = {\r\n    easing: function(time){\r\n        time -= 1;\r\n        return -(time * time * time * time - 1);\r\n    },\r\n    reverse: function(){\r\n        return _easeQuarticActionOut;\r\n    }\r\n};\r\ncc.easeQuarticActionOut = function(){\r\n    return _easeQuarticActionOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object.  <br />\r\n * Reference easeInOutQuart: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuarticActionInOut <br />\r\n * EaseQuarticInOut <br />\r\n *  easeInOutQuarthttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuarticActionInOut\r\n * @returns {Object}\r\n */\r\nvar _easeQuarticActionInOut = {\r\n    easing: function(time){\r\n        time = time*2;\r\n        if (time < 1)\r\n            return 0.5 * time * time * time * time;\r\n        time -= 2;\r\n        return -0.5 * (time * time * time * time - 2);\r\n    },\r\n    reverse: function(){\r\n        return _easeQuarticActionInOut;\r\n    }\r\n};\r\ncc.easeQuarticActionInOut = function(){\r\n    return _easeQuarticActionInOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInQuint: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuinticActionIn <br />\r\n * EaseQuinticIn <br />\r\n *  easeInQuinthttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuinticActionIn\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeQuinticActionIn());\r\n */\r\nvar _easeQuinticActionIn = {\r\n    easing: function(time){\r\n        return time * time * time * time * time;\r\n    },\r\n    reverse: function(){\r\n        return _easeQuinticActionIn;\r\n    }\r\n};\r\ncc.easeQuinticActionIn = function(){\r\n    return _easeQuinticActionIn;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeOutQuint: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuinticActionOut <br />\r\n * EaseQuinticOut \r\n *  easeOutQuinthttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuinticActionOut\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeQuadraticActionOut());\r\n */\r\nvar _easeQuinticActionOut = {\r\n    easing: function(time){\r\n        time -=1;\r\n        return (time * time * time * time * time + 1);\r\n    },\r\n    reverse: function(){\r\n        return _easeQuinticActionOut;\r\n    }\r\n};\r\ncc.easeQuinticActionOut = function(){\r\n    return _easeQuinticActionOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInOutQuint: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeQuinticActionInOut <br />\r\n * EaseQuinticInOut<br />\r\n *  easeInOutQuinthttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeQuinticActionInOut\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeQuinticActionInOut());\r\n */\r\nvar _easeQuinticActionInOut = {\r\n    easing: function(time){\r\n        time = time*2;\r\n        if (time < 1)\r\n            return 0.5 * time * time * time * time * time;\r\n        time -= 2;\r\n        return 0.5 * (time * time * time * time * time + 2);\r\n    },\r\n    reverse: function(){\r\n        return _easeQuinticActionInOut;\r\n    }\r\n};\r\ncc.easeQuinticActionInOut = function(){\r\n    return _easeQuinticActionInOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInCirc: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeCircleActionIn <br />\r\n * EaseCircleIn<br />\r\n *  easeInCirchttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeCircleActionIn\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeCircleActionIn());\r\n */\r\nvar _easeCircleActionIn = {\r\n    easing: function(time){\r\n        return -1 * (Math.sqrt(1 - time * time) - 1);\r\n    },\r\n    reverse: function(){\r\n        return _easeCircleActionIn;\r\n    }\r\n};\r\ncc.easeCircleActionIn = function(){\r\n    return _easeCircleActionIn;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeOutCirc: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeCircleActionOut <br />\r\n * EaseCircleOut<br />\r\n *  easeOutCirchttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeCircleActionOut\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * actioneasing(cc.easeCircleActionOut());\r\n */\r\nvar _easeCircleActionOut = {\r\n    easing: function(time){\r\n        time = time - 1;\r\n        return Math.sqrt(1 - time * time);\r\n    },\r\n    reverse: function(){\r\n        return _easeCircleActionOut;\r\n    }\r\n};\r\ncc.easeCircleActionOut = function(){\r\n    return _easeCircleActionOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInOutCirc: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeCircleActionInOut <br />\r\n * EaseCircleInOut <br />\r\n *  easeInOutCirchttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeCircleActionInOut\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeCircleActionInOut());\r\n */\r\nvar _easeCircleActionInOut = {\r\n    easing: function(time){\r\n        time = time * 2;\r\n        if (time < 1)\r\n            return -0.5 * (Math.sqrt(1 - time * time) - 1);\r\n        time -= 2;\r\n        return 0.5 * (Math.sqrt(1 - time * time) + 1);\r\n    },\r\n    reverse: function(){\r\n        return _easeCircleActionInOut;\r\n    }\r\n};\r\ncc.easeCircleActionInOut = function(){\r\n    return _easeCircleActionInOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInCubic: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeCubicActionIn <br />\r\n * EaseCubicIn <br />\r\n *  easeInCubichttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeCubicActionIn\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeCubicActionIn());\r\n */\r\nvar _easeCubicActionIn = {\r\n    easing: function(time){\r\n        return time * time * time;\r\n    },\r\n    reverse: function(){\r\n        return _easeCubicActionIn;\r\n    }\r\n};\r\ncc.easeCubicActionIn = function(){\r\n    return _easeCubicActionIn;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeOutCubic: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeCubicActionOut <br />\r\n * EaseCubicOut <br />\r\n *  easeOutCubichttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeCubicActionOut\r\n * @returns {Object}\r\n * @example\r\n * //example\r\n * action.easing(cc.easeCubicActionOut());\r\n */\r\nvar _easeCubicActionOut = {\r\n    easing: function(time){\r\n        time -= 1;\r\n        return (time * time * time + 1);\r\n    },\r\n    reverse: function(){\r\n        return _easeCubicActionOut;\r\n    }\r\n};\r\ncc.easeCubicActionOut = function(){\r\n    return _easeCubicActionOut;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Creates the action easing object. <br />\r\n * Reference easeInOutCubic: <br />\r\n * http://www.zhihu.com/question/21981571/answer/19925418\r\n * !#zh\r\n *  easeCubicActionInOut <br />\r\n * EaseCubicInOut<br />\r\n *  easeInOutCubichttp://www.zhihu.com/question/21981571/answer/19925418\r\n * @method easeCubicActionInOut\r\n * @returns {Object}\r\n */\r\nvar _easeCubicActionInOut = {\r\n    easing: function(time){\r\n        time = time*2;\r\n        if (time < 1)\r\n            return 0.5 * time * time * time;\r\n        time -= 2;\r\n        return 0.5 * (time * time * time + 2);\r\n    },\r\n    reverse: function(){\r\n        return _easeCubicActionInOut;\r\n    }\r\n};\r\ncc.easeCubicActionInOut = function(){\r\n    return _easeCubicActionInOut;\r\n};\r\n\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en Instant actions are immediate actions. They don't have a duration like the ActionInterval actions.\r\n * !#zh  FiniteTimeAction\r\n * @class ActionInstant\r\n * @extends FiniteTimeAction\r\n */\r\ncc.ActionInstant = cc.Class({\r\n    name: 'cc.ActionInstant',\r\n    extends: cc.FiniteTimeAction,\r\n    isDone:function () {\r\n        return true;\r\n    },\r\n\r\n    step:function (dt) {\r\n        this.update(1);\r\n    },\r\n\r\n    update:function (dt) {\r\n        //nothing\r\n    },\r\n\r\n    /**\r\n     * returns a reversed action. <br />\r\n     * For example: <br />\r\n     * - The action is x coordinates of 0 move to 100. <br />\r\n     * - The reversed action will be x of 100 move to 0.\r\n     * @returns {Action}\r\n     */\r\n    reverse:function(){\r\n        return this.clone();\r\n    },\r\n\r\n    clone:function(){\r\n        return new cc.ActionInstant();\r\n    }\r\n});\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/*\r\n * Show the node.\r\n * @class Show\r\n * @extends ActionInstant\r\n */\r\ncc.Show = cc.Class({\r\n    name: 'cc.Show',\r\n    extends: cc.ActionInstant,\r\n\r\n    update:function (dt) {\r\n        var _renderComps = this.target.getComponentsInChildren(cc.RenderComponent);\r\n        for (var i = 0; i < _renderComps.length; ++i) {\r\n            var render = _renderComps[i];\r\n            render.enabled = true;\r\n        }\r\n    },\r\n\r\n    reverse:function () {\r\n        return new cc.Hide();\r\n    },\r\n\r\n    clone:function(){\r\n        return new cc.Show();\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Show the Node.\r\n * !#zh \r\n * @method show\r\n * @return {ActionInstant}\r\n * @example\r\n * // example\r\n * var showAction = cc.show();\r\n */\r\ncc.show = function () {\r\n    return new cc.Show();\r\n};\r\n\r\n/*\r\n * Hide the node.\r\n * @class Hide\r\n * @extends ActionInstant\r\n */\r\ncc.Hide = cc.Class({\r\n    name: 'cc.Hide',\r\n    extends: cc.ActionInstant,\r\n\r\n    update:function (dt) {\r\n        var _renderComps = this.target.getComponentsInChildren(cc.RenderComponent);\r\n        for (var i = 0; i < _renderComps.length; ++i) {\r\n            var render = _renderComps[i];\r\n            render.enabled = false;\r\n        }\r\n    },\r\n\r\n    reverse:function () {\r\n        return new cc.Show();\r\n    },\r\n\r\n    clone:function(){\r\n        return new cc.Hide();\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Hide the node.\r\n * !#zh \r\n * @method hide\r\n * @return {ActionInstant}\r\n * @example\r\n * // example\r\n * var hideAction = cc.hide();\r\n */\r\ncc.hide = function () {\r\n    return new cc.Hide();\r\n};\r\n\r\n/*\r\n * Toggles the visibility of a node.\r\n * @class ToggleVisibility\r\n * @extends ActionInstant\r\n */\r\ncc.ToggleVisibility = cc.Class({\r\n    name: 'cc.ToggleVisibility',\r\n    extends: cc.ActionInstant,\r\n\r\n    update:function (dt) {\r\n        var _renderComps = this.target.getComponentsInChildren(cc.RenderComponent);\r\n        for (var i = 0; i < _renderComps.length; ++i) {\r\n            var render = _renderComps[i];\r\n            render.enabled = !render.enabled;\r\n        }\r\n    },\r\n\r\n    reverse:function () {\r\n        return new cc.ToggleVisibility();\r\n    },\r\n\r\n    clone:function(){\r\n        return new cc.ToggleVisibility();\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Toggles the visibility of a node.\r\n * !#zh \r\n * @method toggleVisibility\r\n * @return {ActionInstant}\r\n * @example\r\n * // example\r\n * var toggleVisibilityAction = cc.toggleVisibility();\r\n */\r\ncc.toggleVisibility = function () {\r\n    return new cc.ToggleVisibility();\r\n};\r\n\r\n/*\r\n * Delete self in the next frame.\r\n * @class RemoveSelf\r\n * @extends ActionInstant\r\n * @param {Boolean} [isNeedCleanUp=true]\r\n *\r\n * @example\r\n * // example\r\n * var removeSelfAction = new cc.RemoveSelf(false);\r\n */\r\ncc.RemoveSelf = cc.Class({\r\n    name: 'cc.RemoveSelf',\r\n    extends: cc.ActionInstant,\r\n\r\n    ctor:function(isNeedCleanUp){\r\n        this._isNeedCleanUp = true;\r\n\t    isNeedCleanUp !== undefined && this.init(isNeedCleanUp);\r\n    },\r\n\r\n    update:function(dt){\r\n        this.target.removeFromParent(this._isNeedCleanUp);\r\n    },\r\n\r\n    init:function(isNeedCleanUp){\r\n        this._isNeedCleanUp = isNeedCleanUp;\r\n        return true;\r\n    },\r\n\r\n    reverse:function(){\r\n        return new cc.RemoveSelf(this._isNeedCleanUp);\r\n    },\r\n\r\n    clone:function(){\r\n        return new cc.RemoveSelf(this._isNeedCleanUp);\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Create a RemoveSelf object with a flag indicate whether the target should be cleaned up while removing.\r\n * !#zh \r\n * @method removeSelf\r\n * @param {Boolean} [isNeedCleanUp = true]\r\n * @return {ActionInstant}\r\n *\r\n * @example\r\n * // example\r\n * var removeSelfAction = cc.removeSelf();\r\n */\r\ncc.removeSelf = function(isNeedCleanUp){\r\n    return new cc.RemoveSelf(isNeedCleanUp);\r\n};\r\n\r\n/*\r\n * Flips the sprite horizontally.\r\n * @class FlipX\r\n * @extends ActionInstant\r\n * @param {Boolean} flip Indicate whether the target should be flipped or not\r\n *\r\n * @example\r\n * var flipXAction = new cc.FlipX(true);\r\n */\r\ncc.FlipX = cc.Class({\r\n    name: 'cc.FlipX',\r\n    extends: cc.ActionInstant,\r\n\r\n    ctor:function(flip){\r\n        this._flippedX = false;\r\n\t\tflip !== undefined && this.initWithFlipX(flip);\r\n    },\r\n\r\n    /*\r\n     * initializes the action with a set flipX.\r\n     * @param {Boolean} flip\r\n     * @return {Boolean}\r\n     */\r\n    initWithFlipX:function (flip) {\r\n        this._flippedX = flip;\r\n        return true;\r\n    },\r\n\r\n    update:function (dt) {\r\n        this.target.scaleX = Math.abs(this.target.scaleX) * (this._flippedX ? -1 : 1);\r\n    },\r\n\r\n    reverse:function () {\r\n        return new cc.FlipX(!this._flippedX);\r\n    },\r\n\r\n    clone:function(){\r\n        var action = new cc.FlipX();\r\n        action.initWithFlipX(this._flippedX);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Create a FlipX action to flip or unflip the target.\r\n * !#zh X\r\n * @method flipX\r\n * @param {Boolean} flip Indicate whether the target should be flipped or not\r\n * @return {ActionInstant}\r\n * @example\r\n * var flipXAction = cc.flipX(true);\r\n */\r\ncc.flipX = function (flip) {\r\n    return new cc.FlipX(flip);\r\n};\r\n\r\n/*\r\n * Flips the sprite vertically\r\n * @class FlipY\r\n * @extends ActionInstant\r\n * @param {Boolean} flip\r\n * @example\r\n * var flipYAction = new cc.FlipY(true);\r\n */\r\ncc.FlipY = cc.Class({\r\n    name: 'cc.FlipY',\r\n    extends: cc.ActionInstant,\r\n\r\n    ctor: function(flip){\r\n        this._flippedY = false;\r\n\t\tflip !== undefined && this.initWithFlipY(flip);\r\n    },\r\n\r\n    /*\r\n     * initializes the action with a set flipY.\r\n     * @param {Boolean} flip\r\n     * @return {Boolean}\r\n     */\r\n    initWithFlipY:function (flip) {\r\n        this._flippedY = flip;\r\n        return true;\r\n    },\r\n\r\n    update:function (dt) {\r\n        this.target.scaleY = Math.abs(this.target.scaleY) * (this._flippedY ? -1 : 1);\r\n    },\r\n\r\n    reverse:function () {\r\n        return new cc.FlipY(!this._flippedY);\r\n    },\r\n\r\n    clone:function(){\r\n        var action = new cc.FlipY();\r\n        action.initWithFlipY(this._flippedY);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Create a FlipY action to flip or unflip the target.\r\n * !#zh Y\r\n * @method flipY\r\n * @param {Boolean} flip\r\n * @return {ActionInstant}\r\n * @example\r\n * var flipYAction = cc.flipY(true);\r\n */\r\ncc.flipY = function (flip) {\r\n    return new cc.FlipY(flip);\r\n};\r\n\r\n/*\r\n * Places the node in a certain position\r\n * @class Place\r\n * @extends ActionInstant\r\n * @param {Vec2|Number} pos\r\n * @param {Number} [y]\r\n * @example\r\n * var placeAction = new cc.Place(cc.v2(200, 200));\r\n * var placeAction = new cc.Place(200, 200);\r\n */\r\ncc.Place = cc.Class({\r\n    name: 'cc.Place',\r\n    extends: cc.ActionInstant,\r\n\r\n    ctor:function(pos, y){\r\n        this._x = 0;\r\n\t    this._y = 0;\r\n\r\n\t\tif (pos !== undefined) {\r\n\t\t\tif (pos.x !== undefined) {\r\n\t\t\t\ty = pos.y;\r\n\t\t\t\tpos = pos.x;\r\n\t\t\t}\r\n\t\t\tthis.initWithPosition(pos, y);\r\n\t\t}\r\n    },\r\n\r\n    /*\r\n     * Initializes a Place action with a position\r\n     * @param {number} x\r\n     * @param {number} y\r\n     * @return {Boolean}\r\n     */\r\n    initWithPosition: function (x, y) {\r\n        this._x = x;\r\n        this._y = y;\r\n        return true;\r\n    },\r\n\r\n    update:function (dt) {\r\n        this.target.setPosition(this._x, this._y);\r\n    },\r\n\r\n    clone:function(){\r\n        var action = new cc.Place();\r\n        action.initWithPosition(this._x, this._y);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Creates a Place action with a position.\r\n * !#zh \r\n * @method place\r\n * @param {Vec2|Number} pos\r\n * @param {Number} [y]\r\n * @return {ActionInstant}\r\n * @example\r\n * // example\r\n * var placeAction = cc.place(cc.v2(200, 200));\r\n * var placeAction = cc.place(200, 200);\r\n */\r\ncc.place = function (pos, y) {\r\n    return new cc.Place(pos, y);\r\n};\r\n\r\n\r\n/*\r\n * Calls a 'callback'.\r\n * @class CallFunc\r\n * @extends ActionInstant\r\n * @param {function} selector\r\n * @param {object} [selectorTarget=null]\r\n * @param {*} [data=null] data for function, it accepts all data types.\r\n * @example\r\n * // example\r\n * // CallFunc without data\r\n * var finish = new cc.CallFunc(this.removeSprite, this);\r\n *\r\n * // CallFunc with data\r\n * var finish = new cc.CallFunc(this.removeFromParentAndCleanup, this,  true);\r\n */\r\ncc.CallFunc = cc.Class({\r\n    name: 'cc.CallFunc',\r\n    extends: cc.ActionInstant,\r\n\r\n    /*\r\n     * Constructor function, override it to extend the construction behavior, remember to call \"this._super()\" in the extended \"ctor\" function. <br />\r\n\t * Creates a CallFunc action with the callback.\r\n\t * @param {function} selector\r\n\t * @param {object} [selectorTarget=null]\r\n\t * @param {*} [data=null] data for function, it accepts all data types.\r\n\t */\r\n    ctor:function(selector, selectorTarget, data){\r\n        this._selectorTarget = null;\r\n        this._function = null;\r\n        this._data = null;\r\n        this.initWithFunction(selector, selectorTarget, data);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action with a function or function and its target\r\n     * @param {function} selector\r\n     * @param {object|Null} selectorTarget\r\n     * @param {*|Null} [data] data for function, it accepts all data types.\r\n     * @return {Boolean}\r\n     */\r\n    initWithFunction:function (selector, selectorTarget, data) {\r\n        if (selector) {\r\n            this._function = selector;\r\n        }\r\n        if (selectorTarget) {\r\n            this._selectorTarget = selectorTarget;\r\n        }\r\n        if (data !== undefined) {\r\n            this._data = data;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    /*\r\n     * execute the function.\r\n     */\r\n    execute:function () {\r\n        if (this._function) {\r\n            this._function.call(this._selectorTarget, this.target, this._data);\r\n        }\r\n    },\r\n\r\n    update:function (dt) {\r\n        this.execute();\r\n    },\r\n\r\n    /*\r\n     * Get selectorTarget.\r\n     * @return {object}\r\n     */\r\n    getTargetCallback:function () {\r\n        return this._selectorTarget;\r\n    },\r\n\r\n    /*\r\n     * Set selectorTarget.\r\n     * @param {object} sel\r\n     */\r\n    setTargetCallback:function (sel) {\r\n        if (sel !== this._selectorTarget) {\r\n            if (this._selectorTarget)\r\n                this._selectorTarget = null;\r\n            this._selectorTarget = sel;\r\n        }\r\n    },\r\n\r\n    clone:function(){\r\n        var action = new cc.CallFunc();\r\n        action.initWithFunction(this._function, this._selectorTarget, this._data);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Creates the action with the callback.\r\n * !#zh \r\n * @method callFunc\r\n * @param {function} selector\r\n * @param {object} [selectorTarget=null]\r\n * @param {*} [data=null] - data for function, it accepts all data types.\r\n * @return {ActionInstant}\r\n * @example\r\n * // example\r\n * // CallFunc without data\r\n * var finish = cc.callFunc(this.removeSprite, this);\r\n *\r\n * // CallFunc with data\r\n * var finish = cc.callFunc(this.removeFromParentAndCleanup, this._grossini,  true);\r\n */\r\ncc.callFunc = function (selector, selectorTarget, data) {\r\n    return new cc.CallFunc(selector, selectorTarget, data);\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en\r\n * <p> An interval action is an action that takes place within a certain period of time. <br/>\r\n * It has an start time, and a finish time. The finish time is the parameter<br/>\r\n * duration plus the start time.</p>\r\n *\r\n * <p>These CCActionInterval actions have some interesting properties, like:<br/>\r\n * - They can run normally (default)  <br/>\r\n * - They can run reversed with the reverse method   <br/>\r\n * - They can run with the time altered with the Accelerate, AccelDeccel and Speed actions. </p>\r\n *\r\n * <p>For example, you can simulate a Ping Pong effect running the action normally and<br/>\r\n * then running it again in Reverse mode. </p>\r\n * !#zh  FiniteTimeAction\r\n * @class ActionInterval\r\n * @extends FiniteTimeAction\r\n * @param {Number} d duration in seconds\r\n */\r\ncc.ActionInterval = cc.Class({\r\n    name: 'cc.ActionInterval',\r\n    extends: cc.FiniteTimeAction,\r\n\r\n    ctor:function (d) {\r\n        this.MAX_VALUE = 2;\r\n        this._elapsed = 0;\r\n        this._firstTick = false;\r\n        this._easeList = null;\r\n        this._speed = 1;\r\n        this._timesForRepeat = 1;\r\n        this._repeatForever = false;\r\n        this._repeatMethod = false;//Compatible with repeat class, Discard after can be deleted\r\n        this._speedMethod = false;//Compatible with repeat class, Discard after can be deleted\r\n        d !== undefined && cc.ActionInterval.prototype.initWithDuration.call(this, d);\r\n    },\r\n\r\n    /*\r\n     * How many seconds had elapsed since the actions started to run.\r\n     * @return {Number}\r\n     */\r\n    getElapsed:function () {\r\n        return this._elapsed;\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} d duration in seconds\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (d) {\r\n        this._duration = (d === 0) ? cc.macro.FLT_EPSILON : d;\r\n        // prevent division by 0\r\n        // This comparison could be in step:, but it might decrease the performance\r\n        // by 3% in heavy based action games.\r\n        this._elapsed = 0;\r\n        this._firstTick = true;\r\n        return true;\r\n    },\r\n\r\n    isDone:function () {\r\n        return (this._elapsed >= this._duration);\r\n    },\r\n\r\n    _cloneDecoration: function(action){\r\n        action._repeatForever = this._repeatForever;\r\n        action._speed = this._speed;\r\n        action._timesForRepeat = this._timesForRepeat;\r\n        action._easeList = this._easeList;\r\n        action._speedMethod = this._speedMethod;\r\n        action._repeatMethod = this._repeatMethod;\r\n    },\r\n\r\n    _reverseEaseList: function(action){\r\n        if(this._easeList){\r\n            action._easeList = [];\r\n            for(var i=0; i<this._easeList.length; i++){\r\n                action._easeList.push(this._easeList[i].reverse());\r\n            }\r\n        }\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.ActionInterval(this._duration);\r\n        this._cloneDecoration(action);\r\n        return action;\r\n    },\r\n\r\n    /**\r\n     * !#en Implementation of ease motion.\r\n     * !#zh \r\n     * @method easing\r\n     * @param {Object} easeObj\r\n     * @returns {ActionInterval}\r\n     * @example\r\n     * action.easing(cc.easeIn(3.0));\r\n     */\r\n    easing: function (easeObj) {\r\n        if (this._easeList)\r\n            this._easeList.length = 0;\r\n        else\r\n            this._easeList = [];\r\n        for (var i = 0; i < arguments.length; i++)\r\n            this._easeList.push(arguments[i]);\r\n        return this;\r\n    },\r\n\r\n    _computeEaseTime: function (dt) {\r\n        var locList = this._easeList;\r\n        if ((!locList) || (locList.length === 0))\r\n            return dt;\r\n        for (var i = 0, n = locList.length; i < n; i++)\r\n            dt = locList[i].easing(dt);\r\n        return dt;\r\n    },\r\n\r\n    step:function (dt) {\r\n        if (this._firstTick) {\r\n            this._firstTick = false;\r\n            this._elapsed = 0;\r\n        } else\r\n            this._elapsed += dt;\r\n\r\n        //this.update((1 > (this._elapsed / this._duration)) ? this._elapsed / this._duration : 1);\r\n        //this.update(Math.max(0, Math.min(1, this._elapsed / Math.max(this._duration, cc.macro.FLT_EPSILON))));\r\n        var t = this._elapsed / (this._duration > 0.0000001192092896 ? this._duration : 0.0000001192092896);\r\n        t = (1 > t ? t : 1);\r\n        this.update(t > 0 ? t : 0);\r\n\r\n        //Compatible with repeat class, Discard after can be deleted (this._repeatMethod)\r\n        if(this._repeatMethod && this._timesForRepeat > 1 && this.isDone()){\r\n            if(!this._repeatForever){\r\n                this._timesForRepeat--;\r\n            }\r\n            //var diff = locInnerAction.getElapsed() - locInnerAction._duration;\r\n            this.startWithTarget(this.target);\r\n            // to prevent jerk. issue #390 ,1247\r\n            //this._innerAction.step(0);\r\n            //this._innerAction.step(diff);\r\n            this.step(this._elapsed - this._duration);\r\n\r\n        }\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.Action.prototype.startWithTarget.call(this, target);\r\n        this._elapsed = 0;\r\n        this._firstTick = true;\r\n    },\r\n\r\n    reverse:function () {\r\n        cc.logID(1010);\r\n        return null;\r\n    },\r\n\r\n    /*\r\n     * Set amplitude rate.\r\n     * @warning It should be overridden in subclass.\r\n     * @param {Number} amp\r\n     */\r\n    setAmplitudeRate:function (amp) {\r\n        // Abstract class needs implementation\r\n        cc.logID(1011);\r\n    },\r\n\r\n    /*\r\n     * Get amplitude rate.\r\n     * @warning It should be overridden in subclass.\r\n     * @return {Number} 0\r\n     */\r\n    getAmplitudeRate:function () {\r\n        // Abstract class needs implementation\r\n        cc.logID(1012);\r\n        return 0;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Changes the speed of an action, making it take longer (speed>1)\r\n     * or less (speed<1) time. <br/>\r\n     * Useful to simulate 'slow motion' or 'fast forward' effect.\r\n     * !#zh\r\n     * speed > 1<br/>\r\n     * speed < 1\r\n     * @param {Number} speed\r\n     * @returns {Action}\r\n     */\r\n    speed: function(speed){\r\n        if(speed <= 0){\r\n            cc.logID(1013);\r\n            return this;\r\n        }\r\n\r\n        this._speedMethod = true;//Compatible with repeat class, Discard after can be deleted\r\n        this._speed *= speed;\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * Get this action speed.\r\n     * @return {Number}\r\n     */\r\n    getSpeed: function(){\r\n        return this._speed;\r\n    },\r\n\r\n    /**\r\n     * Set this action speed.\r\n     * @param {Number} speed\r\n     * @returns {ActionInterval}\r\n     */\r\n    setSpeed: function(speed){\r\n        this._speed = speed;\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Repeats an action a number of times.\r\n     * To repeat an action forever use the CCRepeatForever action.\r\n     * !#zh  RepeatForever \r\n     * @method repeat\r\n     * @param {Number} times\r\n     * @returns {ActionInterval}\r\n     */\r\n    repeat: function(times){\r\n        times = Math.round(times);\r\n        if(isNaN(times) || times < 1){\r\n            cc.logID(1014);\r\n            return this;\r\n        }\r\n        this._repeatMethod = true;//Compatible with repeat class, Discard after can be deleted\r\n        this._timesForRepeat *= times;\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Repeats an action for ever.  <br/>\r\n     * To repeat the an action for a limited number of times use the Repeat action. <br/>\r\n     * !#zh  Repeat \r\n     * @method repeatForever\r\n     * @returns {ActionInterval}\r\n     */\r\n    repeatForever: function(){\r\n        this._repeatMethod = true;//Compatible with repeat class, Discard after can be deleted\r\n        this._timesForRepeat = this.MAX_VALUE;\r\n        this._repeatForever = true;\r\n        return this;\r\n    }\r\n});\r\n\r\ncc.actionInterval = function (d) {\r\n    return new cc.ActionInterval(d);\r\n};\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/*\r\n * Runs actions sequentially, one after another.\r\n * @class Sequence\r\n * @extends ActionInterval\r\n * @param {Array|FiniteTimeAction} tempArray\r\n * @example\r\n * // create sequence with actions\r\n * var seq = new cc.Sequence(act1, act2);\r\n *\r\n * // create sequence with array\r\n * var seq = new cc.Sequence(actArray);\r\n */\r\ncc.Sequence = cc.Class({\r\n    name: 'cc.Sequence',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (tempArray) {\r\n        this._actions = [];\r\n        this._split = null;\r\n        this._last = 0;\r\n        this._reversed = false;\r\n\r\n        var paramArray = (tempArray instanceof Array) ? tempArray : arguments;\r\n        if (paramArray.length === 1) {\r\n            cc.errorID(1019);\r\n            return;\r\n        }\r\n        var last = paramArray.length - 1;\r\n        if ((last >= 0) && (paramArray[last] == null))\r\n            cc.logID(1015);\r\n\r\n        if (last >= 0) {\r\n            var prev = paramArray[0], action1;\r\n            for (var i = 1; i < last; i++) {\r\n                if (paramArray[i]) {\r\n                    action1 = prev;\r\n                    prev = cc.Sequence._actionOneTwo(action1, paramArray[i]);\r\n                }\r\n            }\r\n            this.initWithTwoActions(prev, paramArray[last]);\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Initializes the action <br/>\r\n     * @param {FiniteTimeAction} actionOne\r\n     * @param {FiniteTimeAction} actionTwo\r\n     * @return {Boolean}\r\n     */\r\n    initWithTwoActions:function (actionOne, actionTwo) {\r\n        if (!actionOne || !actionTwo) {\r\n            cc.errorID(1025);\r\n            return false;\r\n        }\r\n\r\n        var durationOne = actionOne._duration, durationTwo = actionTwo._duration;\r\n        durationOne *= actionOne._repeatMethod ? actionOne._timesForRepeat : 1;\r\n        durationTwo *= actionTwo._repeatMethod ? actionTwo._timesForRepeat : 1;\r\n        var d = durationOne + durationTwo;\r\n        this.initWithDuration(d);\r\n\r\n        this._actions[0] = actionOne;\r\n        this._actions[1] = actionTwo;\r\n        return true;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.Sequence();\r\n        this._cloneDecoration(action);\r\n        action.initWithTwoActions(this._actions[0].clone(), this._actions[1].clone());\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._split = this._actions[0]._duration / this._duration;\r\n        this._split *= this._actions[0]._repeatMethod ? this._actions[0]._timesForRepeat : 1;\r\n        this._last = -1;\r\n    },\r\n\r\n    stop:function () {\r\n        // Issue #1305\r\n        if (this._last !== -1)\r\n            this._actions[this._last].stop();\r\n        cc.Action.prototype.stop.call(this);\r\n    },\r\n\r\n    update:function (dt) {\r\n        var new_t, found = 0;\r\n        var locSplit = this._split, locActions = this._actions, locLast = this._last, actionFound;\r\n\r\n        dt = this._computeEaseTime(dt);\r\n        if (dt < locSplit) {\r\n            // action[0]\r\n            new_t = (locSplit !== 0) ? dt / locSplit : 1;\r\n\r\n            if (found === 0 && locLast === 1 && this._reversed) {\r\n                // Reverse mode ?\r\n                // XXX: Bug. this case doesn't contemplate when _last==-1, found=0 and in \"reverse mode\"\r\n                // since it will require a hack to know if an action is on reverse mode or not.\r\n                // \"step\" should be overriden, and the \"reverseMode\" value propagated to inner Sequences.\r\n                locActions[1].update(0);\r\n                locActions[1].stop();\r\n            }\r\n        } else {\r\n            // action[1]\r\n            found = 1;\r\n            new_t = (locSplit === 1) ? 1 : (dt - locSplit) / (1 - locSplit);\r\n\r\n            if (locLast === -1) {\r\n                // action[0] was skipped, execute it.\r\n                locActions[0].startWithTarget(this.target);\r\n                locActions[0].update(1);\r\n                locActions[0].stop();\r\n            }\r\n            if (locLast === 0) {\r\n                // switching to action 1. stop action 0.\r\n                locActions[0].update(1);\r\n                locActions[0].stop();\r\n            }\r\n        }\r\n\r\n        actionFound = locActions[found];\r\n        // Last action found and it is done.\r\n        if (locLast === found && actionFound.isDone())\r\n            return;\r\n\r\n        // Last action not found\r\n        if (locLast !== found)\r\n            actionFound.startWithTarget(this.target);\r\n\r\n        new_t = new_t * actionFound._timesForRepeat;\r\n        actionFound.update(new_t > 1 ? new_t % 1 : new_t);\r\n        this._last = found;\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = cc.Sequence._actionOneTwo(this._actions[1].reverse(), this._actions[0].reverse());\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        action._reversed = true;\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Helper constructor to create an array of sequenceable actions\r\n * The created action will run actions sequentially, one after another.\r\n * !#zh \r\n * @method sequence\r\n * @param {FiniteTimeAction|FiniteTimeAction[]} actionOrActionArray\r\n * @param {FiniteTimeAction} ...tempArray\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * // create sequence with actions\r\n * var seq = cc.sequence(act1, act2);\r\n *\r\n * // create sequence with array\r\n * var seq = cc.sequence(actArray);\r\n */\r\n// todo: It should be use new\r\ncc.sequence = function (/*Multiple Arguments*/tempArray) {\r\n    var paramArray = (tempArray instanceof Array) ? tempArray : arguments;\r\n    if (paramArray.length === 1) {\r\n        cc.errorID(1019);\r\n        return null;\r\n    }\r\n    var last = paramArray.length - 1;\r\n    if ((last >= 0) && (paramArray[last] == null))\r\n        cc.logID(1015);\r\n\r\n    var result = null;\r\n    if (last >= 0) {\r\n        result = paramArray[0];\r\n        for (var i = 1; i <= last; i++) {\r\n            if (paramArray[i]) {\r\n                result = cc.Sequence._actionOneTwo(result, paramArray[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\ncc.Sequence._actionOneTwo = function (actionOne, actionTwo) {\r\n    var sequence = new cc.Sequence();\r\n    sequence.initWithTwoActions(actionOne, actionTwo);\r\n    return sequence;\r\n};\r\n\r\n/*\r\n * Repeats an action a number of times.\r\n * To repeat an action forever use the CCRepeatForever action.\r\n * @class Repeat\r\n * @extends ActionInterval\r\n * @param {FiniteTimeAction} action\r\n * @param {Number} times\r\n * @example\r\n * var rep = new cc.Repeat(cc.sequence(jump2, jump1), 5);\r\n */\r\ncc.Repeat = cc.Class({\r\n    name: 'cc.Repeat',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor: function (action, times) {\r\n        this._times = 0;\r\n        this._total = 0;\r\n        this._nextDt = 0;\r\n        this._actionInstant = false;\r\n        this._innerAction = null;\r\n\t\ttimes !== undefined && this.initWithAction(action, times);\r\n    },\r\n\r\n    /*\r\n     * @param {FiniteTimeAction} action\r\n     * @param {Number} times\r\n     * @return {Boolean}\r\n     */\r\n    initWithAction:function (action, times) {\r\n        var duration = action._duration * times;\r\n\r\n        if (this.initWithDuration(duration)) {\r\n            this._times = times;\r\n            this._innerAction = action;\r\n            if (action instanceof cc.ActionInstant){\r\n                this._actionInstant = true;\r\n                this._times -= 1;\r\n            }\r\n            this._total = 0;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.Repeat();\r\n        this._cloneDecoration(action);\r\n        action.initWithAction(this._innerAction.clone(), this._times);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        this._total = 0;\r\n        this._nextDt = this._innerAction._duration / this._duration;\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._innerAction.startWithTarget(target);\r\n    },\r\n\r\n    stop:function () {\r\n        this._innerAction.stop();\r\n        cc.Action.prototype.stop.call(this);\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        var locInnerAction = this._innerAction;\r\n        var locDuration = this._duration;\r\n        var locTimes = this._times;\r\n        var locNextDt = this._nextDt;\r\n\r\n        if (dt >= locNextDt) {\r\n            while (dt > locNextDt && this._total < locTimes) {\r\n                locInnerAction.update(1);\r\n                this._total++;\r\n                locInnerAction.stop();\r\n                locInnerAction.startWithTarget(this.target);\r\n                locNextDt += locInnerAction._duration / locDuration;\r\n                this._nextDt = locNextDt > 1 ? 1 : locNextDt;\r\n            }\r\n\r\n            // fix for issue #1288, incorrect end value of repeat\r\n            if (dt >= 1.0 && this._total < locTimes) {\r\n                // fix for cocos-creator/fireball/issues/4310\r\n                locInnerAction.update(1);\r\n                this._total++;\r\n            }\r\n\r\n            // don't set a instant action back or update it, it has no use because it has no duration\r\n            if (!this._actionInstant) {\r\n                if (this._total === locTimes) {\r\n                    locInnerAction.stop();\r\n                } else {\r\n                    // issue #390 prevent jerk, use right update\r\n                    locInnerAction.update(dt - (locNextDt - locInnerAction._duration / locDuration));\r\n                }\r\n            }\r\n        } else {\r\n            locInnerAction.update((dt * locTimes) % 1.0);\r\n        }\r\n    },\r\n\r\n    isDone:function () {\r\n        return this._total === this._times;\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.Repeat(this._innerAction.reverse(), this._times);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    },\r\n\r\n    /*\r\n     * Set inner Action.\r\n     * @param {FiniteTimeAction} action\r\n     */\r\n    setInnerAction:function (action) {\r\n        if (this._innerAction !== action) {\r\n            this._innerAction = action;\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Get inner Action.\r\n     * @return {FiniteTimeAction}\r\n     */\r\n    getInnerAction:function () {\r\n        return this._innerAction;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Creates a Repeat action. Times is an unsigned integer between 1 and pow(2,30)\r\n * !#zh  repeatForever \r\n * @method repeat\r\n * @param {FiniteTimeAction} action\r\n * @param {Number} times\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var rep = cc.repeat(cc.sequence(jump2, jump1), 5);\r\n */\r\ncc.repeat = function (action, times) {\r\n    return new cc.Repeat(action, times);\r\n};\r\n\r\n\r\n/*\r\n * Repeats an action for ever.  <br/>\r\n * To repeat the an action for a limited number of times use the Repeat action. <br/>\r\n * @warning This action can't be Sequenceable because it is not an IntervalAction\r\n * @class RepeatForever\r\n * @extends ActionInterval\r\n * @param {FiniteTimeAction} action\r\n * @example\r\n * var rep = new cc.RepeatForever(cc.sequence(jump2, jump1), 5);\r\n */\r\ncc.RepeatForever = cc.Class({\r\n    name: 'cc.RepeatForever',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (action) {\r\n        this._innerAction = null;\r\n\t\taction && this.initWithAction(action);\r\n    },\r\n\r\n    /*\r\n     * @param {ActionInterval} action\r\n     * @return {Boolean}\r\n     */\r\n    initWithAction:function (action) {\r\n        if (!action) {\r\n            cc.errorID(1026);\r\n            return false;\r\n        }\r\n\r\n        this._innerAction = action;\r\n        return true;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.RepeatForever();\r\n        this._cloneDecoration(action);\r\n        action.initWithAction(this._innerAction.clone());\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._innerAction.startWithTarget(target);\r\n    },\r\n\r\n    step:function (dt) {\r\n        var locInnerAction = this._innerAction;\r\n        locInnerAction.step(dt);\r\n        if (locInnerAction.isDone()) {\r\n            //var diff = locInnerAction.getElapsed() - locInnerAction._duration;\r\n            locInnerAction.startWithTarget(this.target);\r\n            // to prevent jerk. issue #390 ,1247\r\n            //this._innerAction.step(0);\r\n            //this._innerAction.step(diff);\r\n            locInnerAction.step(locInnerAction.getElapsed() - locInnerAction._duration);\r\n        }\r\n    },\r\n\r\n    isDone:function () {\r\n        return false;\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.RepeatForever(this._innerAction.reverse());\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    },\r\n\r\n    /*\r\n     * Set inner action.\r\n     * @param {ActionInterval} action\r\n     */\r\n    setInnerAction:function (action) {\r\n        if (this._innerAction !== action) {\r\n            this._innerAction = action;\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Get inner action.\r\n     * @return {ActionInterval}\r\n     */\r\n    getInnerAction:function () {\r\n        return this._innerAction;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Create a acton which repeat forever, as it runs forever, it can't be added into cc.sequence and cc.spawn.\r\n * !#zh  repeat  cc.sequence  cc.spawn \r\n * @method repeatForever\r\n * @param {FiniteTimeAction} action\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var repeat = cc.repeatForever(cc.rotateBy(1.0, 360));\r\n */\r\ncc.repeatForever = function (action) {\r\n    return new cc.RepeatForever(action);\r\n};\r\n\r\n\r\n/* \r\n * Spawn a new action immediately\r\n * @class Spawn\r\n * @extends ActionInterval\r\n */\r\ncc.Spawn = cc.Class({\r\n    name: 'cc.Spawn',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (tempArray) {\r\n        this._one = null;\r\n        this._two = null;\r\n\r\n\t\tvar paramArray = (tempArray instanceof Array) ? tempArray : arguments;\r\n        if (paramArray.length === 1) {\r\n            cc.errorID(1020);\r\n            return;\r\n        }\r\n\t\tvar last = paramArray.length - 1;\r\n\t\tif ((last >= 0) && (paramArray[last] == null))\r\n\t\t\tcc.logID(1015);\r\n\r\n        if (last >= 0) {\r\n            var prev = paramArray[0], action1;\r\n            for (var i = 1; i < last; i++) {\r\n                if (paramArray[i]) {\r\n                    action1 = prev;\r\n                    prev = cc.Spawn._actionOneTwo(action1, paramArray[i]);\r\n                }\r\n            }\r\n            this.initWithTwoActions(prev, paramArray[last]);\r\n        }\r\n    },\r\n\r\n    /* initializes the Spawn action with the 2 actions to spawn\r\n     * @param {FiniteTimeAction} action1\r\n     * @param {FiniteTimeAction} action2\r\n     * @return {Boolean}\r\n     */\r\n    initWithTwoActions:function (action1, action2) {\r\n        if (!action1 || !action2) {\r\n            cc.errorID(1027);\r\n            return false;\r\n        }\r\n\r\n        var ret = false;\r\n\r\n        var d1 = action1._duration;\r\n        var d2 = action2._duration;\r\n\r\n        if (this.initWithDuration(Math.max(d1, d2))) {\r\n            this._one = action1;\r\n            this._two = action2;\r\n\r\n            if (d1 > d2) {\r\n                this._two = cc.Sequence._actionOneTwo(action2, cc.delayTime(d1 - d2));\r\n            } else if (d1 < d2) {\r\n                this._one = cc.Sequence._actionOneTwo(action1, cc.delayTime(d2 - d1));\r\n            }\r\n\r\n            ret = true;\r\n        }\r\n        return ret;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.Spawn();\r\n        this._cloneDecoration(action);\r\n        action.initWithTwoActions(this._one.clone(), this._two.clone());\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._one.startWithTarget(target);\r\n        this._two.startWithTarget(target);\r\n    },\r\n\r\n    stop:function () {\r\n        this._one.stop();\r\n        this._two.stop();\r\n        cc.Action.prototype.stop.call(this);\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this._one)\r\n            this._one.update(dt);\r\n        if (this._two)\r\n            this._two.update(dt);\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = cc.Spawn._actionOneTwo(this._one.reverse(), this._two.reverse());\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Create a spawn action which runs several actions in parallel.\r\n * !#zh \r\n * @method spawn\r\n * @param {FiniteTimeAction|FiniteTimeAction[]} actionOrActionArray\r\n * @param {FiniteTimeAction} ...tempArray\r\n * @return {FiniteTimeAction}\r\n * @example\r\n * // example\r\n * var action = cc.spawn(cc.jumpBy(2, cc.v2(300, 0), 50, 4), cc.rotateBy(2, 720));\r\n * todo:It should be the direct use new\r\n */\r\ncc.spawn = function (/*Multiple Arguments*/tempArray) {\r\n    var paramArray = (tempArray instanceof Array) ? tempArray : arguments;\r\n    if (paramArray.length === 1) {\r\n        cc.errorID(1020);\r\n        return null;\r\n    }\r\n    if ((paramArray.length > 0) && (paramArray[paramArray.length - 1] == null))\r\n        cc.logID(1015);\r\n\r\n    var prev = paramArray[0];\r\n    for (var i = 1; i < paramArray.length; i++) {\r\n        if (paramArray[i] != null)\r\n            prev = cc.Spawn._actionOneTwo(prev, paramArray[i]);\r\n    }\r\n    return prev;\r\n};\r\n\r\ncc.Spawn._actionOneTwo = function (action1, action2) {\r\n    var pSpawn = new cc.Spawn();\r\n    pSpawn.initWithTwoActions(action1, action2);\r\n    return pSpawn;\r\n};\r\n\r\n\r\n/*\r\n * Rotates a Node object to a certain angle by modifying its angle property. <br/>\r\n * The direction will be decided by the shortest angle.\r\n * @class RotateTo\r\n * @extends ActionInterval\r\n * @param {Number} duration duration in seconds\r\n * @param {Number} dstAngle dstAngle in degrees.\r\n * @example\r\n * var rotateTo = new cc.RotateTo(2, 61.0);\r\n */\r\ncc.RotateTo = cc.Class({\r\n    name: 'cc.RotateTo',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, dstAngle) {\r\n        this._startAngle = 0;\r\n        this._dstAngle = 0;\r\n        this._angle = 0;\r\n        dstAngle !== undefined && this.initWithDuration(duration, dstAngle);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration\r\n     * @param {Number} dstAngle\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, dstAngle) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            this._dstAngle = dstAngle;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.RotateTo();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._dstAngle);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n\r\n        this._startAngle = target.angle % 360;\r\n        let angle = this._dstAngle - this._startAngle;\r\n        if (angle > 180) angle -= 360;\r\n        if (angle < -180) angle += 360;\r\n        this._angle = angle;\r\n    },\r\n\r\n    reverse:function () {\r\n        cc.logID(1016);\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this.target) {\r\n            this.target.angle = this._startAngle + this._angle * dt;\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Rotates a Node object to a certain angle by modifying its angle property. <br/>\r\n * The direction will be decided by the shortest angle.\r\n * !#zh  angle \r\n * @method rotateTo\r\n * @param {Number} duration duration in seconds\r\n * @param {Number} dstAngle dstAngle in degrees.\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var rotateTo = cc.rotateTo(2, 61.0);\r\n */\r\ncc.rotateTo = function (duration, dstAngle) {\r\n    return new cc.RotateTo(duration, dstAngle);\r\n};\r\n\r\n\r\n/*\r\n * Rotates a Node object clockwise a number of degrees by modifying its angle property.\r\n * Relative to its properties to modify.\r\n * @class RotateBy\r\n * @extends ActionInterval\r\n * @param {Number} duration duration in seconds\r\n * @param {Number} deltaAngle deltaAngle in degrees\r\n * @example\r\n * var actionBy = new cc.RotateBy(2, 360);\r\n */\r\ncc.RotateBy = cc.Class({\r\n    name: 'cc.RotateBy',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor: function (duration, deltaAngle) {\r\n        this._deltaAngle = cc.v3();\r\n        this._startAngle = 0;\r\n        deltaAngle !== undefined && this.initWithDuration(duration, deltaAngle);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration duration in seconds\r\n     * @param {Number} deltaAngle deltaAngle in degrees\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, deltaAngle) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            this._deltaAngle = deltaAngle;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.RotateBy();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._deltaAngle);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._startAngle = target.angle;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this.target) {\r\n            this.target.angle = this._startAngle + this._deltaAngle * dt;\r\n        }\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.RotateBy(this._duration, -this._deltaAngle);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Rotates a Node object clockwise a number of degrees by modifying its angle property.\r\n * Relative to its properties to modify.\r\n * !#zh \r\n * @method rotateBy\r\n * @param {Number} duration duration in seconds\r\n * @param {Number} deltaAngle deltaAngle in degrees\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var actionBy = cc.rotateBy(2, 360);\r\n */\r\ncc.rotateBy = function (duration, deltaAngle) {\r\n    return new cc.RotateBy(duration, deltaAngle);\r\n};\r\n\r\n\r\n/*\r\n * <p>\r\n * Moves a Node object x,y pixels by modifying its position property.                                  <br/>\r\n * x and y are relative to the position of the object.                                                     <br/>\r\n * Several MoveBy actions can be concurrently called, and the resulting                                  <br/>\r\n * movement will be the sum of individual movements.\r\n * </p>\r\n * @class MoveBy\r\n * @extends ActionInterval\r\n * @param {Number} duration duration in seconds\r\n * @param {Vec2|Number} deltaPos\r\n * @param {Number} [deltaY]\r\n * @example\r\n * var actionTo = cc.moveBy(2, cc.v2(windowSize.width - 40, windowSize.height - 40));\r\n */\r\ncc.MoveBy = cc.Class({\r\n    name: 'cc.MoveBy',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, deltaPos, deltaY) {\r\n        this._positionDelta = cc.v2(0, 0);\r\n        this._startPosition = cc.v2(0, 0);\r\n        this._previousPosition = cc.v2(0, 0);\r\n\r\n        deltaPos !== undefined && cc.MoveBy.prototype.initWithDuration.call(this, duration, deltaPos, deltaY);\t\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration duration in seconds\r\n     * @param {Vec2} position\r\n     * @param {Number} [y]\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, position, y) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n\t        if(position.x !== undefined) {\r\n\t\t        y = position.y;\r\n\t\t        position = position.x;\r\n\t        }\r\n\r\n            this._positionDelta.x = position;\r\n            this._positionDelta.y = y;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.MoveBy();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._positionDelta);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        var locPosX = target.x;\r\n        var locPosY = target.y;\r\n        this._previousPosition.x = locPosX;\r\n        this._previousPosition.y = locPosY;\r\n        this._startPosition.x = locPosX;\r\n        this._startPosition.y = locPosY;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this.target) {\r\n            var x = this._positionDelta.x * dt;\r\n            var y = this._positionDelta.y * dt;\r\n            var locStartPosition = this._startPosition;\r\n            if (cc.macro.ENABLE_STACKABLE_ACTIONS) {\r\n                var targetX = this.target.x;\r\n                var targetY = this.target.y;\r\n                var locPreviousPosition = this._previousPosition;\r\n\r\n                locStartPosition.x = locStartPosition.x + targetX - locPreviousPosition.x;\r\n                locStartPosition.y = locStartPosition.y + targetY - locPreviousPosition.y;\r\n                x = x + locStartPosition.x;\r\n                y = y + locStartPosition.y;\r\n\t            locPreviousPosition.x = x;\r\n\t            locPreviousPosition.y = y;\r\n\t            this.target.setPosition(x, y);\r\n            } else {\r\n                this.target.setPosition(locStartPosition.x + x, locStartPosition.y + y);\r\n            }\r\n        }\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.MoveBy(this._duration, cc.v2(-this._positionDelta.x, -this._positionDelta.y));\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Moves a Node object x,y pixels by modifying its position property.                                  <br/>\r\n * x and y are relative to the position of the object.                                                     <br/>\r\n * Several MoveBy actions can be concurrently called, and the resulting                                  <br/>\r\n * movement will be the sum of individual movements.\r\n * !#zh \r\n * @method moveBy\r\n * @param {Number} duration duration in seconds\r\n * @param {Vec2|Number} deltaPos\r\n * @param {Number} [deltaY]\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var actionTo = cc.moveBy(2, cc.v2(windowSize.width - 40, windowSize.height - 40));\r\n */\r\ncc.moveBy = function (duration, deltaPos, deltaY) {\r\n    return new cc.MoveBy(duration, deltaPos, deltaY);\r\n};\r\n\r\n\r\n/*\r\n * Moves a Node object to the position x,y. x and y are absolute coordinates by modifying its position property. <br/>\r\n * Several MoveTo actions can be concurrently called, and the resulting                                            <br/>\r\n * movement will be the sum of individual movements.\r\n * @class MoveTo\r\n * @extends MoveBy\r\n * @param {Number} duration duration in seconds\r\n * @param {Vec2|Number} position\r\n * @param {Number} [y]\r\n * @example\r\n * var actionBy = new cc.MoveTo(2, cc.v2(80, 80));\r\n */\r\ncc.MoveTo = cc.Class({\r\n    name: 'cc.MoveTo',\r\n    extends: cc.MoveBy,\r\n\r\n    ctor:function (duration, position, y) {\r\n        this._endPosition = cc.v2(0, 0);\r\n\t\tposition !== undefined && this.initWithDuration(duration, position, y);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration  duration in seconds\r\n     * @param {Vec2} position\r\n     * @param {Number} [y]\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, position, y) {\r\n        if (cc.MoveBy.prototype.initWithDuration.call(this, duration, position, y)) {\r\n\t        if(position.x !== undefined) {\r\n\t\t        y = position.y;\r\n\t\t        position = position.x;\r\n\t        }\r\n\r\n            this._endPosition.x = position;\r\n            this._endPosition.y = y;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.MoveTo();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._endPosition);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.MoveBy.prototype.startWithTarget.call(this, target);\r\n        this._positionDelta.x = this._endPosition.x - target.x;\r\n        this._positionDelta.y = this._endPosition.y - target.y;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Moves a Node object to the position x,y. x and y are absolute coordinates by modifying its position property. <br/>\r\n * Several MoveTo actions can be concurrently called, and the resulting                                            <br/>\r\n * movement will be the sum of individual movements.\r\n * !#zh \r\n * @method moveTo\r\n * @param {Number} duration duration in seconds\r\n * @param {Vec2|Number} position\r\n * @param {Number} [y]\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var actionBy = cc.moveTo(2, cc.v2(80, 80));\r\n */\r\ncc.moveTo = function (duration, position, y) {\r\n    return new cc.MoveTo(duration, position, y);\r\n};\r\n\r\n/*\r\n * Skews a Node object to given angles by modifying its skewX and skewY properties\r\n * @class SkewTo\r\n * @extends ActionInterval\r\n * @param {Number} t time in seconds\r\n * @param {Number} sx\r\n * @param {Number} sy\r\n * @example\r\n * var actionTo = new cc.SkewTo(2, 37.2, -37.2);\r\n */\r\ncc.SkewTo = cc.Class({\r\n    name: 'cc.SkewTo',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor: function (t, sx, sy) {\r\n        this._skewX = 0;\r\n        this._skewY = 0;\r\n        this._startSkewX = 0;\r\n        this._startSkewY = 0;\r\n        this._endSkewX = 0;\r\n        this._endSkewY = 0;\r\n        this._deltaX = 0;\r\n        this._deltaY = 0;\r\n        sy !== undefined && cc.SkewTo.prototype.initWithDuration.call(this, t, sx, sy);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} t time in seconds\r\n     * @param {Number} sx\r\n     * @param {Number} sy\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (t, sx, sy) {\r\n        var ret = false;\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, t)) {\r\n            this._endSkewX = sx;\r\n            this._endSkewY = sy;\r\n            ret = true;\r\n        }\r\n        return ret;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.SkewTo();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._endSkewX, this._endSkewY);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n\r\n        this._startSkewX = target.skewX % 180;\r\n        this._deltaX = this._endSkewX - this._startSkewX;\r\n        if (this._deltaX > 180)\r\n            this._deltaX -= 360;\r\n        if (this._deltaX < -180)\r\n            this._deltaX += 360;\r\n\r\n        this._startSkewY = target.skewY % 360;\r\n        this._deltaY = this._endSkewY - this._startSkewY;\r\n        if (this._deltaY > 180)\r\n            this._deltaY -= 360;\r\n        if (this._deltaY < -180)\r\n            this._deltaY += 360;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        this.target.skewX = this._startSkewX + this._deltaX * dt;\r\n        this.target.skewY = this._startSkewY + this._deltaY * dt;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Create a action which skews a Node object to given angles by modifying its skewX and skewY properties.\r\n * Changes to the specified value.\r\n * !#zh \r\n * @method skewTo\r\n * @param {Number} t time in seconds\r\n * @param {Number} sx\r\n * @param {Number} sy\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var actionTo = cc.skewTo(2, 37.2, -37.2);\r\n */\r\ncc.skewTo = function (t, sx, sy) {\r\n    return new cc.SkewTo(t, sx, sy);\r\n};\r\n\r\n/*\r\n * Skews a Node object by skewX and skewY degrees.\r\n * Relative to its property modification.\r\n * @class SkewBy\r\n * @extends SkewTo\r\n * @param {Number} t time in seconds\r\n * @param {Number} sx  skew in degrees for X axis\r\n * @param {Number} sy  skew in degrees for Y axis\r\n */\r\ncc.SkewBy = cc.Class({\r\n    name: 'cc.SkewBy',\r\n    extends: cc.SkewTo,\r\n\r\n\tctor: function(t, sx, sy) {\r\n\t\tsy !== undefined && this.initWithDuration(t, sx, sy);\r\n\t},\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} t time in seconds\r\n     * @param {Number} deltaSkewX  skew in degrees for X axis\r\n     * @param {Number} deltaSkewY  skew in degrees for Y axis\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (t, deltaSkewX, deltaSkewY) {\r\n        var ret = false;\r\n        if (cc.SkewTo.prototype.initWithDuration.call(this, t, deltaSkewX, deltaSkewY)) {\r\n            this._skewX = deltaSkewX;\r\n            this._skewY = deltaSkewY;\r\n            ret = true;\r\n        }\r\n        return ret;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.SkewBy();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._skewX, this._skewY);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.SkewTo.prototype.startWithTarget.call(this, target);\r\n        this._deltaX = this._skewX;\r\n        this._deltaY = this._skewY;\r\n        this._endSkewX = this._startSkewX + this._deltaX;\r\n        this._endSkewY = this._startSkewY + this._deltaY;\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.SkewBy(this._duration, -this._skewX, -this._skewY);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Skews a Node object by skewX and skewY degrees. <br />\r\n * Relative to its property modification.\r\n * !#zh \r\n * @method skewBy\r\n * @param {Number} t time in seconds\r\n * @param {Number} sx sx skew in degrees for X axis\r\n * @param {Number} sy sy skew in degrees for Y axis\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var actionBy = cc.skewBy(2, 0, -90);\r\n */\r\ncc.skewBy = function (t, sx, sy) {\r\n    return new cc.SkewBy(t, sx, sy);\r\n};\r\n\r\n\r\n/*\r\n * Moves a Node object simulating a parabolic jump movement by modifying its position property.\r\n * Relative to its movement.\r\n * @class JumpBy\r\n * @extends ActionInterval\r\n * @param {Number} duration\r\n * @param {Vec2|Number} position\r\n * @param {Number} [y]\r\n * @param {Number} height\r\n * @param {Number} jumps\r\n * @example\r\n * var actionBy = new cc.JumpBy(2, cc.v2(300, 0), 50, 4);\r\n * var actionBy = new cc.JumpBy(2, 300, 0, 50, 4);\r\n */\r\ncc.JumpBy = cc.Class({\r\n    name: 'cc.JumpBy',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, position, y, height, jumps) {\r\n        this._startPosition = cc.v2(0, 0);\r\n        this._previousPosition = cc.v2(0, 0);\r\n        this._delta = cc.v2(0, 0);\r\n        this._height = 0;\r\n        this._jumps = 0;\r\n\r\n        height !== undefined && cc.JumpBy.prototype.initWithDuration.call(this, duration, position, y, height, jumps);\r\n    },\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration\r\n     * @param {Vec2|Number} position\r\n     * @param {Number} [y]\r\n     * @param {Number} height\r\n     * @param {Number} jumps\r\n     * @return {Boolean}\r\n     * @example\r\n     * actionBy.initWithDuration(2, cc.v2(300, 0), 50, 4);\r\n     * actionBy.initWithDuration(2, 300, 0, 50, 4);\r\n     */\r\n    initWithDuration:function (duration, position, y, height, jumps) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n\t        if (jumps === undefined) {\r\n\t\t        jumps = height;\r\n\t\t        height = y;\r\n\t\t        y = position.y;\r\n\t\t        position = position.x;\r\n\t        }\r\n            this._delta.x = position;\r\n            this._delta.y = y;\r\n            this._height = height;\r\n            this._jumps = jumps;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.JumpBy();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._delta, this._height, this._jumps);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        var locPosX = target.x;\r\n        var locPosY = target.y;\r\n        this._previousPosition.x = locPosX;\r\n        this._previousPosition.y = locPosY;\r\n        this._startPosition.x = locPosX;\r\n        this._startPosition.y = locPosY;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this.target) {\r\n            var frac = dt * this._jumps % 1.0;\r\n            var y = this._height * 4 * frac * (1 - frac);\r\n            y += this._delta.y * dt;\r\n\r\n            var x = this._delta.x * dt;\r\n            var locStartPosition = this._startPosition;\r\n            if (cc.macro.ENABLE_STACKABLE_ACTIONS) {\r\n                var targetX = this.target.x;\r\n                var targetY = this.target.y;\r\n                var locPreviousPosition = this._previousPosition;\r\n\r\n                locStartPosition.x = locStartPosition.x + targetX - locPreviousPosition.x;\r\n                locStartPosition.y = locStartPosition.y + targetY - locPreviousPosition.y;\r\n                x = x + locStartPosition.x;\r\n                y = y + locStartPosition.y;\r\n\t            locPreviousPosition.x = x;\r\n\t            locPreviousPosition.y = y;\r\n\t            this.target.setPosition(x, y);\r\n            } else {\r\n                this.target.setPosition(locStartPosition.x + x, locStartPosition.y + y);\r\n            }\r\n        }\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.JumpBy(this._duration, cc.v2(-this._delta.x, -this._delta.y), this._height, this._jumps);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Moves a Node object simulating a parabolic jump movement by modifying it's position property.\r\n * Relative to its movement.\r\n * !#zh \r\n * @method jumpBy\r\n * @param {Number} duration\r\n * @param {Vec2|Number} position\r\n * @param {Number} [y]\r\n * @param {Number} [height]\r\n * @param {Number} [jumps]\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var actionBy = cc.jumpBy(2, cc.v2(300, 0), 50, 4);\r\n * var actionBy = cc.jumpBy(2, 300, 0, 50, 4);\r\n */\r\ncc.jumpBy = function (duration, position, y, height, jumps) {\r\n    return new cc.JumpBy(duration, position, y, height, jumps);\r\n};\r\n\r\n/*\r\n * Moves a Node object to a parabolic position simulating a jump movement by modifying it's position property. <br />\r\n * Jump to the specified location.\r\n * @class JumpTo\r\n * @extends JumpBy\r\n * @param {Number} duration\r\n * @param {Vec2|Number} position\r\n * @param {Number} [y]\r\n * @param {Number} [height]\r\n * @param {Number} [jumps]\r\n * @example\r\n * var actionTo = new cc.JumpTo(2, cc.v2(300, 0), 50, 4);\r\n * var actionTo = new cc.JumpTo(2, 300, 0, 50, 4);\r\n */\r\ncc.JumpTo = cc.Class({\r\n    name: 'cc.JumpTo',\r\n    extends: cc.JumpBy,\r\n\r\n    ctor:function (duration, position, y, height, jumps) {\r\n        this._endPosition = cc.v2(0, 0);\r\n        height !== undefined && this.initWithDuration(duration, position, y, height, jumps);\r\n    },\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration\r\n     * @param {Vec2|Number} position\r\n     * @param {Number} [y]\r\n     * @param {Number} height\r\n     * @param {Number} jumps\r\n     * @return {Boolean}\r\n     * @example\r\n     * actionTo.initWithDuration(2, cc.v2(300, 0), 50, 4);\r\n     * actionTo.initWithDuration(2, 300, 0, 50, 4);\r\n     */\r\n    initWithDuration:function (duration, position, y, height, jumps) {\r\n        if (cc.JumpBy.prototype.initWithDuration.call(this, duration, position, y, height, jumps)) {\r\n            if (jumps === undefined) {\r\n                y = position.y;\r\n                position = position.x;\r\n            }\r\n            this._endPosition.x = position;\r\n            this._endPosition.y = y;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.JumpBy.prototype.startWithTarget.call(this, target);\r\n        this._delta.x = this._endPosition.x - this._startPosition.x;\r\n        this._delta.y = this._endPosition.y - this._startPosition.y;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.JumpTo();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._endPosition, this._height, this._jumps);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Moves a Node object to a parabolic position simulating a jump movement by modifying its position property. <br />\r\n * Jump to the specified location.\r\n * !#zh \r\n * @method jumpTo\r\n * @param {Number} duration\r\n * @param {Vec2|Number} position\r\n * @param {Number} [y]\r\n * @param {Number} [height]\r\n * @param {Number} [jumps]\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var actionTo = cc.jumpTo(2, cc.v2(300, 300), 50, 4);\r\n * var actionTo = cc.jumpTo(2, 300, 300, 50, 4);\r\n */\r\ncc.jumpTo = function (duration, position, y, height, jumps) {\r\n    return new cc.JumpTo(duration, position, y, height, jumps);\r\n};\r\n\r\n/* An action that moves the target with a cubic Bezier curve by a certain distance.\r\n * Relative to its movement.\r\n * @class BezierBy\r\n * @extends ActionInterval\r\n * @param {Number} t - time in seconds\r\n * @param {Vec2[]} c - Array of points\r\n * @example\r\n * var bezier = [cc.v2(0, windowSize.height / 2), cc.v2(300, -windowSize.height / 2), cc.v2(300, 100)];\r\n * var bezierForward = new cc.BezierBy(3, bezier);\r\n */\r\nfunction bezierAt (a, b, c, d, t) {\r\n    return (Math.pow(1 - t, 3) * a +\r\n        3 * t * (Math.pow(1 - t, 2)) * b +\r\n        3 * Math.pow(t, 2) * (1 - t) * c +\r\n        Math.pow(t, 3) * d );\r\n};\r\ncc.BezierBy = cc.Class({\r\n    name: 'cc.BezierBy',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (t, c) {\r\n        this._config = [];\r\n        this._startPosition = cc.v2(0, 0);\r\n        this._previousPosition = cc.v2(0, 0);\r\n        c && cc.BezierBy.prototype.initWithDuration.call(this, t, c);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} t - time in seconds\r\n     * @param {Vec2[]} c - Array of points\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (t, c) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, t)) {\r\n            this._config = c;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.BezierBy();\r\n        this._cloneDecoration(action);\r\n        var newConfigs = [];\r\n        for (var i = 0; i < this._config.length; i++) {\r\n            var selConf = this._config[i];\r\n            newConfigs.push(cc.v2(selConf.x, selConf.y));\r\n        }\r\n        action.initWithDuration(this._duration, newConfigs);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        var locPosX = target.x;\r\n        var locPosY = target.y;\r\n        this._previousPosition.x = locPosX;\r\n        this._previousPosition.y = locPosY;\r\n        this._startPosition.x = locPosX;\r\n        this._startPosition.y = locPosY;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this.target) {\r\n            var locConfig = this._config;\r\n            var xa = 0;\r\n            var xb = locConfig[0].x;\r\n            var xc = locConfig[1].x;\r\n            var xd = locConfig[2].x;\r\n\r\n            var ya = 0;\r\n            var yb = locConfig[0].y;\r\n            var yc = locConfig[1].y;\r\n            var yd = locConfig[2].y;\r\n\r\n            var x = bezierAt(xa, xb, xc, xd, dt);\r\n            var y = bezierAt(ya, yb, yc, yd, dt);\r\n\r\n            var locStartPosition = this._startPosition;\r\n            if (cc.macro.ENABLE_STACKABLE_ACTIONS) {\r\n                var targetX = this.target.x;\r\n                var targetY = this.target.y;\r\n                var locPreviousPosition = this._previousPosition;\r\n\r\n                locStartPosition.x = locStartPosition.x + targetX - locPreviousPosition.x;\r\n                locStartPosition.y = locStartPosition.y + targetY - locPreviousPosition.y;\r\n                x = x + locStartPosition.x;\r\n                y = y + locStartPosition.y;\r\n\t            locPreviousPosition.x = x;\r\n\t            locPreviousPosition.y = y;\r\n\t            this.target.setPosition(x, y);\r\n            } else {\r\n                this.target.setPosition(locStartPosition.x + x, locStartPosition.y + y);\r\n            }\r\n        }\r\n    },\r\n\r\n    reverse:function () {\r\n        var locConfig = this._config;\r\n        var x0 = locConfig[0].x, y0 = locConfig[0].y;\r\n        var x1 = locConfig[1].x, y1 = locConfig[1].y;\r\n        var x2 = locConfig[2].x, y2 = locConfig[2].y;\r\n        var r = [\r\n            cc.v2(x1 - x2, y1 - y2),\r\n            cc.v2(x0 - x2, y0 - y2),\r\n            cc.v2(-x2, -y2) ];\r\n        var action = new cc.BezierBy(this._duration, r);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * An action that moves the target with a cubic Bezier curve by a certain distance.\r\n * Relative to its movement.\r\n * !#zh \r\n * @method bezierBy\r\n * @param {Number} t - time in seconds\r\n * @param {Vec2[]} c - Array of points\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var bezier = [cc.v2(0, windowSize.height / 2), cc.v2(300, -windowSize.height / 2), cc.v2(300, 100)];\r\n * var bezierForward = cc.bezierBy(3, bezier);\r\n */\r\ncc.bezierBy = function (t, c) {\r\n    return new cc.BezierBy(t, c);\r\n};\r\n\r\n\r\n/* An action that moves the target with a cubic Bezier curve to a destination point.\r\n * @class BezierTo\r\n * @extends BezierBy\r\n * @param {Number} t\r\n * @param {Vec2[]} c - Array of points\r\n * @example\r\n * var bezier = [cc.v2(0, windowSize.height / 2), cc.v2(300, -windowSize.height / 2), cc.v2(300, 100)];\r\n * var bezierTo = new cc.BezierTo(2, bezier);\r\n */\r\ncc.BezierTo = cc.Class({\r\n    name: 'cc.BezierTo',\r\n    extends: cc.BezierBy,\r\n\r\n    ctor:function (t, c) {\r\n        this._toConfig = [];\r\n\t\tc && this.initWithDuration(t, c);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} t time in seconds\r\n     * @param {Vec2[]} c - Array of points\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (t, c) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, t)) {\r\n            this._toConfig = c;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.BezierTo();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._toConfig);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.BezierBy.prototype.startWithTarget.call(this, target);\r\n        var locStartPos = this._startPosition;\r\n        var locToConfig = this._toConfig;\r\n        var locConfig = this._config;\r\n\r\n        locConfig[0] = locToConfig[0].sub(locStartPos);\r\n        locConfig[1] = locToConfig[1].sub(locStartPos);\r\n        locConfig[2] = locToConfig[2].sub(locStartPos);\r\n    }\r\n});\r\n/**\r\n * !#en An action that moves the target with a cubic Bezier curve to a destination point.\r\n * !#zh \r\n * @method bezierTo\r\n * @param {Number} t\r\n * @param {Vec2[]} c - Array of points\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var bezier = [cc.v2(0, windowSize.height / 2), cc.v2(300, -windowSize.height / 2), cc.v2(300, 100)];\r\n * var bezierTo = cc.bezierTo(2, bezier);\r\n */\r\ncc.bezierTo = function (t, c) {\r\n    return new cc.BezierTo(t, c);\r\n};\r\n\r\n\r\n/* Scales a Node object to a zoom factor by modifying it's scale property.\r\n * @warning This action doesn't support \"reverse\"\r\n * @class ScaleTo\r\n * @extends ActionInterval\r\n * @param {Number} duration\r\n * @param {Number} sx  scale parameter in X\r\n * @param {Number} [sy] scale parameter in Y, if Null equal to sx\r\n * @example\r\n * // It scales to 0.5 in both X and Y.\r\n * var actionTo = new cc.ScaleTo(2, 0.5);\r\n *\r\n * // It scales to 0.5 in x and 2 in Y\r\n * var actionTo = new cc.ScaleTo(2, 0.5, 2);\r\n */\r\ncc.ScaleTo = cc.Class({\r\n    name: 'cc.ScaleTo',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, sx, sy) {\r\n        this._scaleX = 1;\r\n        this._scaleY = 1;\r\n        this._startScaleX = 1;\r\n        this._startScaleY = 1;\r\n        this._endScaleX = 0;\r\n        this._endScaleY = 0;\r\n        this._deltaX = 0;\r\n        this._deltaY = 0;\r\n        sx !== undefined && cc.ScaleTo.prototype.initWithDuration.call(this, duration, sx, sy);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration\r\n     * @param {Number} sx\r\n     * @param {Number} [sy=]\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, sx, sy) { //function overload here\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            this._endScaleX = sx;\r\n            this._endScaleY = (sy != null) ? sy : sx;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.ScaleTo();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._endScaleX, this._endScaleY);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._startScaleX = target.scaleX;\r\n        this._startScaleY = target.scaleY;\r\n        this._deltaX = this._endScaleX - this._startScaleX;\r\n        this._deltaY = this._endScaleY - this._startScaleY;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this.target) {\r\n            this.target.scaleX = this._startScaleX + this._deltaX * dt;\r\n\t        this.target.scaleY = this._startScaleY + this._deltaY * dt;\r\n        }\r\n    }\r\n});\r\n/**\r\n * !#en Scales a Node object to a zoom factor by modifying it's scale property.\r\n * !#zh \r\n * @method scaleTo\r\n * @param {Number} duration\r\n * @param {Number} sx  scale parameter in X\r\n * @param {Number} [sy] scale parameter in Y, if Null equal to sx\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * // It scales to 0.5 in both X and Y.\r\n * var actionTo = cc.scaleTo(2, 0.5);\r\n *\r\n * // It scales to 0.5 in x and 2 in Y\r\n * var actionTo = cc.scaleTo(2, 0.5, 2);\r\n */\r\ncc.scaleTo = function (duration, sx, sy) { //function overload\r\n    return new cc.ScaleTo(duration, sx, sy);\r\n};\r\n\r\n\r\n/* Scales a Node object a zoom factor by modifying it's scale property.\r\n * Relative to its changes.\r\n * @class ScaleBy\r\n * @extends ScaleTo\r\n */\r\ncc.ScaleBy = cc.Class({\r\n    name: 'cc.ScaleBy',\r\n    extends: cc.ScaleTo,\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ScaleTo.prototype.startWithTarget.call(this, target);\r\n        this._deltaX = this._startScaleX * this._endScaleX - this._startScaleX;\r\n        this._deltaY = this._startScaleY * this._endScaleY - this._startScaleY;\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.ScaleBy(this._duration, 1 / this._endScaleX, 1 / this._endScaleY);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.ScaleBy();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._endScaleX, this._endScaleY);\r\n        return action;\r\n    }\r\n});\r\n/**\r\n * !#en\r\n * Scales a Node object a zoom factor by modifying it's scale property.\r\n * Relative to its changes.\r\n * !#zh \r\n * @method scaleBy\r\n * @param {Number} duration duration in seconds\r\n * @param {Number} sx sx  scale parameter in X\r\n * @param {Number|Null} [sy=] sy scale parameter in Y, if Null equal to sx\r\n * @return {ActionInterval}\r\n * @example\r\n * // example without sy, it scales by 2 both in X and Y\r\n * var actionBy = cc.scaleBy(2, 2);\r\n *\r\n * //example with sy, it scales by 0.25 in X and 4.5 in Y\r\n * var actionBy2 = cc.scaleBy(2, 0.25, 4.5);\r\n */\r\ncc.scaleBy = function (duration, sx, sy) {\r\n    return new cc.ScaleBy(duration, sx, sy);\r\n};\r\n\r\n/* Blinks a Node object by modifying it's visible property\r\n * @class Blink\r\n * @extends ActionInterval\r\n * @param {Number} duration  duration in seconds\r\n * @param {Number} blinks  blinks in times\r\n * @example\r\n * var action = new cc.Blink(2, 10);\r\n */\r\ncc.Blink = cc.Class({\r\n    name: 'cc.Blink',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, blinks) {\r\n        this._times = 0;\r\n        this._originalState = false;\r\n\t\tblinks !== undefined && this.initWithDuration(duration, blinks);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration duration in seconds\r\n     * @param {Number} blinks blinks in times\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, blinks) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            this._times = blinks;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.Blink();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._times);\r\n        return action;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this.target && !this.isDone()) {\r\n            var slice = 1.0 / this._times;\r\n            var m = dt % slice;\r\n            this.target.opacity = (m > (slice / 2)) ? 255 : 0;\r\n        }\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._originalState = target.opacity;\r\n    },\r\n\r\n    stop:function () {\r\n        this.target.opacity = this._originalState;\r\n        cc.ActionInterval.prototype.stop.call(this);\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.Blink(this._duration, this._times);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n/**\r\n * !#en Blinks a Node object by modifying it's visible property.\r\n * !#zh \r\n * @method blink\r\n * @param {Number} duration  duration in seconds\r\n * @param {Number} blinks blinks in times\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var action = cc.blink(2, 10);\r\n */\r\ncc.blink = function (duration, blinks) {\r\n    return new cc.Blink(duration, blinks);\r\n};\r\n\r\n/* Fades an object that implements the cc.RGBAProtocol protocol. It modifies the opacity from the current value to a custom one.\r\n * @warning This action doesn't support \"reverse\"\r\n * @class FadeTo\r\n * @extends ActionInterval\r\n * @param {Number} duration\r\n * @param {Number} opacity 0-255, 0 is transparent\r\n * @example\r\n * var action = new cc.FadeTo(1.0, 0);\r\n */\r\ncc.FadeTo = cc.Class({\r\n    name: 'cc.FadeTo',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, opacity) {\r\n        this._toOpacity = 0;\r\n        this._fromOpacity = 0;\r\n        opacity !== undefined && cc.FadeTo.prototype.initWithDuration.call(this, duration, opacity);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration  duration in seconds\r\n     * @param {Number} opacity\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, opacity) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            this._toOpacity = opacity;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.FadeTo();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._toOpacity);\r\n        return action;\r\n    },\r\n\r\n    update:function (time) {\r\n        time = this._computeEaseTime(time);\r\n        var fromOpacity = this._fromOpacity !== undefined ? this._fromOpacity : 255;\r\n        this.target.opacity = fromOpacity + (this._toOpacity - fromOpacity) * time;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._fromOpacity = target.opacity;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Fades an object that implements the cc.RGBAProtocol protocol.\r\n * It modifies the opacity from the current value to a custom one.\r\n * !#zh \r\n * @method fadeTo\r\n * @param {Number} duration\r\n * @param {Number} opacity 0-255, 0 is transparent\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var action = cc.fadeTo(1.0, 0);\r\n */\r\ncc.fadeTo = function (duration, opacity) {\r\n    return new cc.FadeTo(duration, opacity);\r\n};\r\n\r\n/* Fades In an object that implements the cc.RGBAProtocol protocol. It modifies the opacity from 0 to 255.<br/>\r\n * The \"reverse\" of this action is FadeOut\r\n * @class FadeIn\r\n * @extends FadeTo\r\n * @param {Number} duration duration in seconds\r\n */\r\ncc.FadeIn = cc.Class({\r\n    name: 'cc.FadeIn',\r\n    extends: cc.FadeTo,\r\n\r\n    ctor:function (duration) {\r\n        if (duration == null)\r\n            duration = 0;\r\n        this._reverseAction = null;\r\n        this.initWithDuration(duration, 255);\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.FadeOut();\r\n        action.initWithDuration(this._duration, 0);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.FadeIn();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._toOpacity);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        if(this._reverseAction)\r\n            this._toOpacity = this._reverseAction._fromOpacity;\r\n        cc.FadeTo.prototype.startWithTarget.call(this, target);\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Fades In an object that implements the cc.RGBAProtocol protocol. It modifies the opacity from 0 to 255.\r\n * !#zh \r\n * @method fadeIn\r\n * @param {Number} duration duration in seconds\r\n * @return {ActionInterval}\r\n * @example\r\n * //example\r\n * var action = cc.fadeIn(1.0);\r\n */\r\ncc.fadeIn = function (duration) {\r\n    return new cc.FadeIn(duration);\r\n};\r\n\r\n\r\n/* Fades Out an object that implements the cc.RGBAProtocol protocol. It modifies the opacity from 255 to 0.\r\n * The \"reverse\" of this action is FadeIn\r\n * @class FadeOut\r\n * @extends FadeTo\r\n * @param {Number} duration duration in seconds\r\n */\r\ncc.FadeOut = cc.Class({\r\n    name: 'cc.FadeOut',\r\n    extends: cc.FadeTo,\r\n\r\n    ctor:function (duration) {\r\n        if (duration == null)\r\n            duration = 0;\r\n        this._reverseAction = null;\r\n        this.initWithDuration(duration, 0);\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.FadeIn();\r\n        action._reverseAction = this;\r\n        action.initWithDuration(this._duration, 255);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.FadeOut();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._toOpacity);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Fades Out an object that implements the cc.RGBAProtocol protocol. It modifies the opacity from 255 to 0.\r\n * !#zh \r\n * @method fadeOut\r\n * @param {Number} d  duration in seconds\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var action = cc.fadeOut(1.0);\r\n */\r\ncc.fadeOut = function (d) {\r\n    return new cc.FadeOut(d);\r\n};\r\n\r\n/* Tints a Node that implements the cc.NodeRGB protocol from current tint to a custom one.\r\n * @warning This action doesn't support \"reverse\"\r\n * @class TintTo\r\n * @extends ActionInterval\r\n * @param {Number} duration\r\n * @param {Number} red 0-255\r\n * @param {Number} green  0-255\r\n * @param {Number} blue 0-255\r\n * @example\r\n * var action = new cc.TintTo(2, 255, 0, 255);\r\n */\r\ncc.TintTo = cc.Class({\r\n    name: 'cc.TintTo',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, red, green, blue) {\r\n        this._to = cc.color(0, 0, 0);\r\n        this._from = cc.color(0, 0, 0);\r\n\r\n        if (red instanceof cc.Color) {\r\n            blue = red.b;\r\n            green = red.g;\r\n            red = red.r;\r\n        }\r\n\r\n        blue !== undefined && this.initWithDuration(duration, red, green, blue);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration\r\n     * @param {Number} red 0-255\r\n     * @param {Number} green 0-255\r\n     * @param {Number} blue 0-255\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, red, green, blue) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            this._to = cc.color(red, green, blue);\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.TintTo();\r\n        this._cloneDecoration(action);\r\n        var locTo = this._to;\r\n        action.initWithDuration(this._duration, locTo.r, locTo.g, locTo.b);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n\r\n        this._from = this.target.color;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        var locFrom = this._from, locTo = this._to;\r\n        if (locFrom) {\r\n            this.target.color = cc.color(\r\n                    locFrom.r + (locTo.r - locFrom.r) * dt,\r\n                    locFrom.g + (locTo.g - locFrom.g) * dt,\r\n                    locFrom.b + (locTo.b - locFrom.b) * dt);\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Tints a Node that implements the cc.NodeRGB protocol from current tint to a custom one.\r\n * !#zh \r\n * @method tintTo\r\n * @param {Number} duration\r\n * @param {Number} red 0-255\r\n * @param {Number} green  0-255\r\n * @param {Number} blue 0-255\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var action = cc.tintTo(2, 255, 0, 255);\r\n */\r\ncc.tintTo = function (duration, red, green, blue) {\r\n    return new cc.TintTo(duration, red, green, blue);\r\n};\r\n\r\n\r\n/* Tints a Node that implements the cc.NodeRGB protocol from current tint to a custom one.\r\n * Relative to their own color change.\r\n * @class TintBy\r\n * @extends ActionInterval\r\n * @param {Number} duration  duration in seconds\r\n * @param {Number} deltaRed\r\n * @param {Number} deltaGreen\r\n * @param {Number} deltaBlue\r\n * @example\r\n * var action = new cc.TintBy(2, -127, -255, -127);\r\n */\r\ncc.TintBy = cc.Class({\r\n    name: 'cc.TintBy',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, deltaRed, deltaGreen, deltaBlue) {\r\n        this._deltaR = 0;\r\n        this._deltaG = 0;\r\n        this._deltaB = 0;\r\n        this._fromR = 0;\r\n        this._fromG = 0;\r\n        this._fromB = 0;\r\n\t\tdeltaBlue !== undefined && this.initWithDuration(duration, deltaRed, deltaGreen, deltaBlue);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration\r\n     * @param {Number} deltaRed 0-255\r\n     * @param {Number} deltaGreen 0-255\r\n     * @param {Number} deltaBlue 0-255\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, deltaRed, deltaGreen, deltaBlue) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            this._deltaR = deltaRed;\r\n            this._deltaG = deltaGreen;\r\n            this._deltaB = deltaBlue;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.TintBy();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._deltaR, this._deltaG, this._deltaB);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n\r\n        var color = target.color;\r\n        this._fromR = color.r;\r\n        this._fromG = color.g;\r\n        this._fromB = color.b;\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n\r\n        this.target.color = cc.color(this._fromR + this._deltaR * dt,\r\n                                    this._fromG + this._deltaG * dt,\r\n                                    this._fromB + this._deltaB * dt);\r\n    },\r\n\r\n    reverse:function () {\r\n        var action = new cc.TintBy(this._duration, -this._deltaR, -this._deltaG, -this._deltaB);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Tints a Node that implements the cc.NodeRGB protocol from current tint to a custom one.\r\n * Relative to their own color change.\r\n * !#zh \r\n * @method tintBy\r\n * @param {Number} duration  duration in seconds\r\n * @param {Number} deltaRed\r\n * @param {Number} deltaGreen\r\n * @param {Number} deltaBlue\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var action = cc.tintBy(2, -127, -255, -127);\r\n */\r\ncc.tintBy = function (duration, deltaRed, deltaGreen, deltaBlue) {\r\n    return new cc.TintBy(duration, deltaRed, deltaGreen, deltaBlue);\r\n};\r\n\r\n/* Delays the action a certain amount of seconds\r\n * @class DelayTime\r\n * @extends ActionInterval\r\n */\r\ncc.DelayTime = cc.Class({\r\n    name: 'cc.DelayTime',\r\n    extends: cc.ActionInterval,\r\n\r\n    update:function (dt) {},\r\n\r\n    reverse:function () {\r\n        var action = new cc.DelayTime(this._duration);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.DelayTime();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Delays the action a certain amount of seconds.\r\n * !#zh \r\n * @method delayTime\r\n * @param {Number} d duration in seconds\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var delay = cc.delayTime(1);\r\n */\r\ncc.delayTime = function (d) {\r\n    return new cc.DelayTime(d);\r\n};\r\n\r\n/*\r\n * <p>\r\n * Executes an action in reverse order, from time=duration to time=0                                     <br/>\r\n * @warning Use this action carefully. This action is not sequenceable.                                 <br/>\r\n * Use it as the default \"reversed\" method of your own actions, but using it outside the \"reversed\"      <br/>\r\n * scope is not recommended.\r\n * </p>\r\n * @class ReverseTime\r\n * @extends ActionInterval\r\n * @param {FiniteTimeAction} action\r\n * @example\r\n *  var reverse = new cc.ReverseTime(this);\r\n */\r\ncc.ReverseTime = cc.Class({\r\n    name: 'cc.ReverseTime',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (action) {\r\n        this._other = null;\r\n\t\taction && this.initWithAction(action);\r\n    },\r\n\r\n    /*\r\n     * @param {FiniteTimeAction} action\r\n     * @return {Boolean}\r\n     */\r\n    initWithAction:function (action) {\r\n        if (!action) {\r\n            cc.errorID(1028);\r\n            return false;\r\n        }\r\n        if (action === this._other) {\r\n            cc.errorID(1029);\r\n            return false;\r\n        }\r\n\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, action._duration)) {\r\n            // Don't leak if action is reused\r\n            this._other = action;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.ReverseTime();\r\n        this._cloneDecoration(action);\r\n        action.initWithAction(this._other.clone());\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._other.startWithTarget(target);\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this._other)\r\n            this._other.update(1 - dt);\r\n    },\r\n\r\n    reverse:function () {\r\n        return this._other.clone();\r\n    },\r\n\r\n    stop:function () {\r\n        this._other.stop();\r\n        cc.Action.prototype.stop.call(this);\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Executes an action in reverse order, from time=duration to time=0.\r\n * !#zh \r\n * @method reverseTime\r\n * @param {FiniteTimeAction} action\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n *  var reverse = cc.reverseTime(this);\r\n */\r\ncc.reverseTime = function (action) {\r\n    return new cc.ReverseTime(action);\r\n};\r\n\r\n/*\r\n * <p>\r\n * Overrides the target of an action so that it always runs on the target<br/>\r\n * specified at action creation rather than the one specified by runAction.\r\n * </p>\r\n * @class TargetedAction\r\n * @extends ActionInterval\r\n * @param {Node} target\r\n * @param {FiniteTimeAction} action\r\n */\r\ncc.TargetedAction = cc.Class({\r\n    name: 'cc.TargetedAction',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor: function (target, action) {\r\n        this._action = null;\r\n        this._forcedTarget = null;\r\n\t\taction && this.initWithTarget(target, action);\r\n    },\r\n\r\n    /*\r\n     * Init an action with the specified action and forced target\r\n     * @param {Node} target\r\n     * @param {FiniteTimeAction} action\r\n     * @return {Boolean}\r\n     */\r\n    initWithTarget:function (target, action) {\r\n        if (this.initWithDuration(action._duration)) {\r\n            this._forcedTarget = target;\r\n            this._action = action;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.TargetedAction();\r\n        this._cloneDecoration(action);\r\n        action.initWithTarget(this._forcedTarget, this._action.clone());\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._action.startWithTarget(this._forcedTarget);\r\n    },\r\n\r\n    stop:function () {\r\n        this._action.stop();\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        this._action.update(dt);\r\n    },\r\n\r\n    /*\r\n     * return the target that the action will be forced to run with\r\n     * @return {Node}\r\n     */\r\n    getForcedTarget:function () {\r\n        return this._forcedTarget;\r\n    },\r\n\r\n    /*\r\n     * set the target that the action will be forced to run with\r\n     * @param {Node} forcedTarget\r\n     */\r\n    setForcedTarget:function (forcedTarget) {\r\n        if (this._forcedTarget !== forcedTarget)\r\n            this._forcedTarget = forcedTarget;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en Create an action with the specified action and forced target.\r\n * !#zh \r\n * @method targetedAction\r\n * @param {Node} target\r\n * @param {FiniteTimeAction} action\r\n * @return {ActionInterval}\r\n */\r\ncc.targetedAction = function (target, action) {\r\n    return new cc.TargetedAction(target, action);\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('../core/platform/CCClass');\r\nvar js = require('../core/platform/js');\r\n\r\n/*\r\n * @class HashElement\r\n * @constructor\r\n * @private\r\n */\r\nvar HashElement = function () {\r\n    this.actions = [];\r\n    this.target = null; //ccobject\r\n    this.actionIndex = 0;\r\n    this.currentAction = null; //CCAction\r\n    this.paused = false;\r\n    this.lock = false;\r\n};\r\n\r\n/**\r\n * !#en\r\n * cc.ActionManager is a class that can manage actions.<br/>\r\n * Normally you won't need to use this class directly. 99% of the cases you will use the CCNode interface,\r\n * which uses this class's singleton object.\r\n * But there are some cases where you might need to use this class. <br/>\r\n * Examples:<br/>\r\n * - When you want to run an action where the target is different from a CCNode.<br/>\r\n * - When you want to pause / resume the actions<br/>\r\n * !#zh\r\n * cc.ActionManager <br/>\r\n * 99% CCNode <br/>\r\n *  <br/>\r\n * \r\n *  -  CCNode  <br/>\r\n *  - / <br/>\r\n * @class ActionManager\r\n * @example {@link cocos2d/core/CCActionManager/ActionManager.js}\r\n */\r\ncc.ActionManager = function () {\r\n    this._hashTargets = js.createMap(true);\r\n    this._arrayTargets = [];\r\n    this._currentTarget = null;\r\n    cc.director._scheduler && cc.director._scheduler.enableForTarget(this);\r\n};\r\ncc.ActionManager.prototype = {\r\n    constructor: cc.ActionManager,\r\n    _elementPool: [],\r\n\r\n    _searchElementByTarget:function (arr, target) {\r\n        for (var k = 0; k < arr.length; k++) {\r\n            if (target === arr[k].target)\r\n                return arr[k];\r\n        }\r\n        return null;\r\n    },\r\n\r\n    _getElement: function (target, paused) {\r\n        var element = this._elementPool.pop();\r\n        if (!element) {\r\n            element = new HashElement();\r\n        }\r\n        element.target = target;\r\n        element.paused = !!paused;\r\n        return element;\r\n    },\r\n\r\n    _putElement: function (element) {\r\n        element.actions.length = 0;\r\n        element.actionIndex = 0;\r\n        element.currentAction = null;\r\n        element.paused = false;\r\n        element.target = null;\r\n        element.lock = false;\r\n        this._elementPool.push(element);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Adds an action with a target.<br/>\r\n     * If the target is already present, then the action will be added to the existing target.\r\n     * If the target is not present, a new instance of this target will be created either paused or not, and the action will be added to the newly created target.\r\n     * When the target is paused, the queued actions won't be 'ticked'.\r\n     * !#zh\r\n     * <br/>\r\n     * <br/>\r\n     * <br/>\r\n     *  paused  true\r\n     *\r\n     * @method addAction\r\n     * @param {Action} action\r\n     * @param {Node} target\r\n     * @param {Boolean} paused\r\n     */\r\n    addAction:function (action, target, paused) {\r\n        if (!action || !target) {\r\n            cc.errorID(1000);\r\n            return;\r\n        }\r\n\r\n        //check if the action target already exists\r\n        var element = this._hashTargets[target._id];\r\n        //if doesn't exists, create a hashelement and push in mpTargets\r\n        if (!element) {\r\n            element = this._getElement(target, paused);\r\n            this._hashTargets[target._id] = element;\r\n            this._arrayTargets.push(element);\r\n        }\r\n        else if (!element.actions) {\r\n            element.actions = [];\r\n        }\r\n\r\n        element.actions.push(action);\r\n        action.startWithTarget(target);\r\n    },\r\n\r\n    /**\r\n     * !#en Removes all actions from all the targets.\r\n     * !#zh \r\n     * @method removeAllActions\r\n     */\r\n    removeAllActions:function () {\r\n        var locTargets = this._arrayTargets;\r\n        for (var i = 0; i < locTargets.length; i++) {\r\n            var element = locTargets[i];\r\n            if (element)\r\n                this._putElement(element);\r\n        }\r\n        this._arrayTargets.length = 0;\r\n        this._hashTargets = js.createMap(true);\r\n    },\r\n    /**\r\n     * !#en\r\n     * Removes all actions from a certain target. <br/>\r\n     * All the actions that belongs to the target will be removed.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method removeAllActionsFromTarget\r\n     * @param {Node} target\r\n     * @param {Boolean} forceDelete\r\n     */\r\n    removeAllActionsFromTarget:function (target, forceDelete) {\r\n        // explicit null handling\r\n        if (target == null)\r\n            return;\r\n        var element = this._hashTargets[target._id];\r\n        if (element) {\r\n            element.actions.length = 0;\r\n            this._deleteHashElement(element);\r\n        }\r\n    },\r\n    /**\r\n     * !#en Removes an action given an action reference.\r\n     * !#zh \r\n     * @method removeAction \r\n     * @param {Action} action\r\n     */\r\n    removeAction:function (action) {\r\n        // explicit null handling\r\n        if (action == null)\r\n            return;\r\n        var target = action.getOriginalTarget();\r\n        var element = this._hashTargets[target._id];\r\n\r\n        if (element) {\r\n            for (var i = 0; i < element.actions.length; i++) {\r\n                if (element.actions[i] === action) {\r\n                    element.actions.splice(i, 1);\r\n                    // update actionIndex in case we are in tick. looping over the actions\r\n                    if (element.actionIndex >= i)\r\n                        element.actionIndex--;\r\n                    break;\r\n                }\r\n            }\r\n        } else {\r\n            cc.logID(1001);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Removes an action given its tag and the target.\r\n     * !#zh \r\n     * @method removeActionByTag\r\n     * @param {Number} tag\r\n     * @param {Node} target\r\n     */\r\n    removeActionByTag:function (tag, target) {\r\n        if(tag === cc.Action.TAG_INVALID)\r\n            cc.logID(1002);\r\n\r\n        cc.assertID(target, 1003);\r\n\r\n        var element = this._hashTargets[target._id];\r\n\r\n        if (element) {\r\n            var limit = element.actions.length;\r\n            for (var i = 0; i < limit; ++i) {\r\n                var action = element.actions[i];\r\n                if (action && action.getTag() === tag && action.getOriginalTarget() === target) {\r\n                    this._removeActionAtIndex(i, element);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Gets an action given its tag an a target.\r\n     * !#zh \r\n     * @method getActionByTag\r\n     * @param {Number} tag\r\n     * @param {Node} target\r\n     * @return {Action|Null}  return the Action with the given tag on success\r\n     */\r\n    getActionByTag:function (tag, target) {\r\n        if(tag === cc.Action.TAG_INVALID)\r\n            cc.logID(1004);\r\n\r\n        var element = this._hashTargets[target._id];\r\n        if (element) {\r\n            if (element.actions != null) {\r\n                for (var i = 0; i < element.actions.length; ++i) {\r\n                    var action = element.actions[i];\r\n                    if (action && action.getTag() === tag)\r\n                        return action;\r\n                }\r\n            }\r\n            cc.logID(1005, tag);\r\n        }\r\n        return null;\r\n    },\r\n\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the numbers of actions that are running in a certain target. <br/>\r\n     * Composable actions are counted as 1 action. <br/>\r\n     * Example: <br/>\r\n     * - If you are running 1 Sequence of 7 actions, it will return 1. <br/>\r\n     * - If you are running 7 Sequences of 2 actions, it will return 7.\r\n     * !#zh\r\n     *  <br/>\r\n     * <br/>\r\n     * <br/>\r\n     *  -  7 Sequence 1<br/>\r\n     *  -  2 Sequence 5  7<br/>\r\n     *\r\n     * @method getNumberOfRunningActionsInTarget\r\n     * @param {Node} target\r\n     * @return {Number}\r\n     */\r\n    getNumberOfRunningActionsInTarget:function (target) {\r\n        var element = this._hashTargets[target._id];\r\n        if (element)\r\n            return (element.actions) ? element.actions.length : 0;\r\n\r\n        return 0;\r\n    },\r\n    /**\r\n     * !#en Pauses the target: all running actions and newly added actions will be paused.\r\n     * !#zh \r\n     * @method pauseTarget\r\n     * @param {Node} target\r\n     */\r\n    pauseTarget:function (target) {\r\n        var element = this._hashTargets[target._id];\r\n        if (element)\r\n            element.paused = true;\r\n    },\r\n    /**\r\n     * !#en Resumes the target. All queued actions will be resumed.\r\n     * !#zh \r\n     * @method resumeTarget\r\n     * @param {Node} target\r\n     */\r\n    resumeTarget:function (target) {\r\n        var element = this._hashTargets[target._id];\r\n        if (element)\r\n            element.paused = false;\r\n    },\r\n\r\n    /**\r\n     * !#en Pauses all running actions, returning a list of targets whose actions were paused.\r\n     * !#zh \r\n     * @method pauseAllRunningActions\r\n     * @return {Array}  a list of targets whose actions were paused.\r\n     */\r\n    pauseAllRunningActions:function(){\r\n        var idsWithActions = [];\r\n        var locTargets = this._arrayTargets;\r\n        for(var i = 0; i< locTargets.length; i++){\r\n            var element = locTargets[i];\r\n            if(element && !element.paused){\r\n                element.paused = true;\r\n                idsWithActions.push(element.target);\r\n            }\r\n        }\r\n        return idsWithActions;\r\n    },\r\n\r\n    /**\r\n     * !#en Resume a set of targets (convenience function to reverse a pauseAllRunningActions or pauseTargets call).\r\n     * !#zh  pauseAllRunningActions \r\n     * @method resumeTargets\r\n     * @param {Array} targetsToResume\r\n     */\r\n    resumeTargets:function(targetsToResume){\r\n        if (!targetsToResume)\r\n            return;\r\n\r\n        for (var i = 0; i< targetsToResume.length; i++) {\r\n            if(targetsToResume[i])\r\n                this.resumeTarget(targetsToResume[i]);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Pause a set of targets.\r\n     * !#zh \r\n     * @method pauseTargets\r\n     * @param {Array} targetsToPause\r\n     */\r\n    pauseTargets:function(targetsToPause){\r\n        if (!targetsToPause)\r\n            return;\r\n\r\n        for (var i = 0; i< targetsToPause.length; i++) {\r\n            if (targetsToPause[i])\r\n                this.pauseTarget(targetsToPause[i]);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * purges the shared action manager. It releases the retained instance. <br/>\r\n     * because it uses this, so it can not be static.\r\n     * !#zh\r\n     *  <br/>\r\n     *  this\r\n     * @method purgeSharedManager\r\n     */\r\n    purgeSharedManager:function () {\r\n        cc.director.getScheduler().unscheduleUpdate(this);\r\n    },\r\n\r\n    //protected\r\n    _removeActionAtIndex:function (index, element) {\r\n        var action = element.actions[index];\r\n\r\n        element.actions.splice(index, 1);\r\n\r\n        // update actionIndex in case we are in tick. looping over the actions\r\n        if (element.actionIndex >= index)\r\n            element.actionIndex--;\r\n\r\n        if (element.actions.length === 0) {\r\n            this._deleteHashElement(element);\r\n        }\r\n    },\r\n\r\n    _deleteHashElement:function (element) {\r\n        var ret = false;\r\n        if (element && !element.lock) {\r\n            if (this._hashTargets[element.target._id]) {\r\n                delete this._hashTargets[element.target._id];\r\n                var targets = this._arrayTargets;\r\n                for (var i = 0, l = targets.length; i < l; i++) {\r\n                    if (targets[i] === element) {\r\n                        targets.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                this._putElement(element);\r\n                ret = true;\r\n            }\r\n        }\r\n        return ret;\r\n    },\r\n\r\n    /**\r\n     * !#en The ActionManager update\r\n     * !#zh ActionManager \r\n     * @method update\r\n     * @param {Number} dt delta time in seconds\r\n     */\r\n    update:function (dt) {\r\n        var locTargets = this._arrayTargets , locCurrTarget;\r\n        for (var elt = 0; elt < locTargets.length; elt++) {\r\n            this._currentTarget = locTargets[elt];\r\n            locCurrTarget = this._currentTarget;\r\n            if (!locCurrTarget.paused && locCurrTarget.actions) {\r\n                locCurrTarget.lock = true;\r\n                // The 'actions' CCMutableArray may change while inside this loop.\r\n                for (locCurrTarget.actionIndex = 0; locCurrTarget.actionIndex < locCurrTarget.actions.length; locCurrTarget.actionIndex++) {\r\n                    locCurrTarget.currentAction = locCurrTarget.actions[locCurrTarget.actionIndex];\r\n                    if (!locCurrTarget.currentAction)\r\n                        continue;\r\n\r\n                    //use for speed\r\n                    locCurrTarget.currentAction.step(dt * ( locCurrTarget.currentAction._speedMethod ? locCurrTarget.currentAction._speed : 1 ) );\r\n                    \r\n                    if (locCurrTarget.currentAction && locCurrTarget.currentAction.isDone()) {\r\n                        locCurrTarget.currentAction.stop();\r\n                        var action = locCurrTarget.currentAction;\r\n                        // Make currentAction nil to prevent removeAction from salvaging it.\r\n                        locCurrTarget.currentAction = null;\r\n                        this.removeAction(action);\r\n                    }\r\n\r\n                    locCurrTarget.currentAction = null;\r\n                }\r\n                locCurrTarget.lock = false;\r\n            }\r\n            // only delete currentTarget if no actions were scheduled during the cycle (issue #481)\r\n            if (locCurrTarget.actions.length === 0) {\r\n                this._deleteHashElement(locCurrTarget) && elt--;\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nif (CC_TEST) {\r\n    cc.ActionManager.prototype.isTargetPaused_TEST = function (target) {\r\n        var element = this._hashTargets[target._id];\r\n        return element.paused;\r\n    };\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./CCActionManager');\r\nrequire('./CCAction');\r\nrequire('./CCActionInterval');\r\nrequire('./CCActionInstant');\r\nrequire('./CCActionEase');\r\nrequire('./CCActionCatmullRom');","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = cc.js;\r\nvar Playable = require('./playable');\r\nvar DynamicAnimCurve = require('./animation-curves').DynamicAnimCurve;\r\nvar quickFindIndex = require('./animation-curves').quickFindIndex;\r\nvar sampleMotionPaths = require('./motion-path-helper').sampleMotionPaths;\r\nvar EventAnimCurve = require('./animation-curves').EventAnimCurve;\r\nvar EventInfo = require('./animation-curves').EventInfo;\r\nvar WrapModeMask = require('./types').WrapModeMask;\r\nvar binarySearch = require('../core/utils/binary-search').binarySearchEpsilon;\r\n\r\n// The actual animator for Animation Component\r\n\r\nfunction AnimationAnimator (target, animation) {\r\n    Playable.call(this);\r\n    this.target = target;\r\n    this.animation = animation;\r\n\r\n    this._anims = new js.array.MutableForwardIterator([]);\r\n}\r\njs.extend(AnimationAnimator, Playable);\r\nvar p = AnimationAnimator.prototype;\r\n\r\np.playState = function (state, startTime) {\r\n    if (!state.clip) {\r\n        return;\r\n    }\r\n\r\n    if (!state.curveLoaded) {\r\n        initClipData(this.target, state);\r\n    }\r\n\r\n    state.animator = this;\r\n    state.play();\r\n\r\n    if (typeof startTime === 'number') {\r\n        state.setTime(startTime);\r\n    }\r\n\r\n    this.play();\r\n};\r\n\r\np.stopStatesExcept = function (state) {\r\n    var iterator = this._anims;\r\n    var array = iterator.array;\r\n    for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n        var anim = array[iterator.i];\r\n        if (anim === state) {\r\n            continue;\r\n        }\r\n\r\n        this.stopState(anim);\r\n    }\r\n};\r\n\r\np.addAnimation = function (anim) {\r\n    var index = this._anims.array.indexOf(anim);\r\n    if (index === -1) {\r\n        this._anims.push(anim);\r\n    }\r\n\r\n    anim._setEventTarget(this.animation);\r\n};\r\n\r\np.removeAnimation = function (anim) {\r\n    var index = this._anims.array.indexOf(anim);\r\n    if (index >= 0) {\r\n        this._anims.fastRemoveAt(index);\r\n\r\n        if (this._anims.array.length === 0) {\r\n            this.stop();\r\n        }\r\n    }\r\n    else {\r\n        cc.errorID(3908);\r\n    }\r\n\r\n    anim.animator = null;\r\n};\r\n\r\np.sample = function () {\r\n    var iterator = this._anims;\r\n    var array = iterator.array;\r\n    for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n        var anim = array[iterator.i];\r\n        anim.sample();\r\n    }\r\n};\r\n\r\np.stopState = function (state) {\r\n    if (state) {\r\n        state.stop();\r\n    }\r\n};\r\n\r\np.pauseState = function (state) {\r\n    if (state) {\r\n        state.pause();\r\n    }\r\n};\r\n\r\np.resumeState = function (state) {\r\n    if (state) {\r\n        state.resume();\r\n    }\r\n\r\n    if (this.isPaused) {\r\n        this.resume();\r\n    }\r\n};\r\n\r\np.setStateTime = function (state, time) {\r\n    if (time !== undefined) {\r\n        if (state) {\r\n            state.setTime(time);\r\n            state.sample();\r\n        }    \r\n    }\r\n    else {\r\n        time = state;\r\n\r\n        var array = this._anims.array;\r\n        for (var i = 0; i < array.length; ++i) {\r\n            var anim = array[i];\r\n            anim.setTime(time);\r\n            anim.sample();\r\n        }\r\n    }\r\n};\r\n\r\np.onStop = function () {\r\n    var iterator = this._anims;\r\n    var array = iterator.array;\r\n    for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n        var anim = array[iterator.i];\r\n        anim.stop();\r\n    }\r\n};\r\n\r\np.onPause = function () {\r\n    var array = this._anims.array;\r\n    for (var i = 0; i < array.length; ++i) {\r\n        var anim = array[i];\r\n        anim.pause();\r\n\r\n        // need to unbind animator to anim, or it maybe cannot be gc.\r\n        anim.animator = null;\r\n    }\r\n};\r\n\r\np.onResume = function () {\r\n    var array = this._anims.array;\r\n    for (var i = 0; i < array.length; ++i) {\r\n        var anim = array[i];\r\n        \r\n        // rebind animator to anim\r\n        anim.animator = this;\r\n\r\n        anim.resume();\r\n    }\r\n};\r\n\r\np._reloadClip = function (state) {\r\n    initClipData(this.target, state);\r\n};\r\n\r\n//  SampledAnimCurve \r\nfunction createBatchedProperty (propPath, firstDotIndex, mainValue, animValue) {\r\n    mainValue = mainValue.clone();\r\n    var nextValue = mainValue;\r\n    var leftIndex = firstDotIndex + 1;\r\n    var rightIndex = propPath.indexOf('.', leftIndex);\r\n\r\n    // scan property path\r\n    while (rightIndex !== -1) {\r\n        var nextName = propPath.slice(leftIndex, rightIndex);\r\n        nextValue = nextValue[nextName];\r\n        leftIndex = rightIndex + 1;\r\n        rightIndex = propPath.indexOf('.', leftIndex);\r\n    }\r\n    var lastPropName = propPath.slice(leftIndex);\r\n    nextValue[lastPropName] = animValue;\r\n\r\n    return mainValue;\r\n}\r\n\r\nif (CC_TEST) {\r\n    cc._Test.createBatchedProperty = createBatchedProperty;\r\n}\r\n\r\nfunction splitPropPath (propPath) {\r\n    var array = propPath.split('.');\r\n    array.shift();\r\n    //array = array.filter(function (item) { return !!item; });\r\n    return array.length > 0 ? array : null;\r\n}\r\n\r\n\r\nfunction initClipData (root, state) {\r\n    var clip = state.clip;\r\n\r\n    var curves = state.curves;\r\n    curves.length = 0;\r\n\r\n    state.duration = Number.parseFloat(clip.duration);\r\n    state.speed = Number.parseFloat(clip.speed);\r\n    state.wrapMode = Number.parseInt(clip.wrapMode);\r\n    state.frameRate = Number.parseFloat(clip.sample);\r\n\r\n    if ((state.wrapMode & WrapModeMask.Loop) === WrapModeMask.Loop) {\r\n        state.repeatCount = Infinity;\r\n    }\r\n    else {\r\n        state.repeatCount = 1;\r\n    }\r\n\r\n    // create curves\r\n\r\n    function checkMotionPath(motionPath) {\r\n        if (!Array.isArray(motionPath)) return false;\r\n\r\n        for (let i = 0, l = motionPath.length; i < l; i++) {\r\n            var controls = motionPath[i];\r\n\r\n            if (!Array.isArray(controls) || controls.length !== 6) return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    function createPropCurve (target, propPath, keyframes) {\r\n        var isMotionPathProp = (target instanceof cc.Node) \r\n            && (propPath === 'position') \r\n            && (keyframes[0] && Array.isArray(keyframes[0].value));\r\n        var motionPaths = [];\r\n        \r\n        var curve = new DynamicAnimCurve();\r\n\r\n        //  Component \r\n        curve.target = target;\r\n\r\n        var propName, propValue;\r\n        var dotIndex = propPath.indexOf('.');\r\n        var hasSubProp = dotIndex !== -1;\r\n        if (hasSubProp) {\r\n            propName = propPath.slice(0, dotIndex);\r\n            propValue = target[propName];\r\n\r\n            // if (!(propValue instanceof cc.ValueType)) {\r\n            //     cc.error('Only support sub animation property which is type cc.ValueType');\r\n            //     continue;\r\n            // }\r\n        }\r\n        else {\r\n            propName = propPath;\r\n        }\r\n\r\n        curve.prop = propName;\r\n\r\n        curve.subProps = splitPropPath(propPath);\r\n\r\n        // for each keyframes\r\n        for (let i = 0, l = keyframes.length; i < l; i++) {\r\n            var keyframe = keyframes[i];\r\n            var ratio = keyframe.frame / state.duration;\r\n            curve.ratios.push(ratio);\r\n\r\n            if (isMotionPathProp) {\r\n                var motionPath = keyframe.motionPath;\r\n\r\n                if (motionPath && !checkMotionPath(motionPath)) {\r\n                    cc.errorID(3904, target.name, propPath, i);\r\n                    motionPath = null;\r\n                }\r\n\r\n                motionPaths.push(motionPath);\r\n            }\r\n\r\n            var curveValue = keyframe.value;\r\n            //if (hasSubProp) {\r\n            //    curveValue = createBatchedProperty(propPath, dotIndex, propValue, curveValue);\r\n            //}\r\n            curve.values.push(curveValue);\r\n\r\n            var curveTypes = keyframe.curve;\r\n            if (curveTypes) {\r\n                if (typeof curveTypes === 'string') {\r\n                    curve.types.push(curveTypes);\r\n                    continue;\r\n                }\r\n                else if (Array.isArray(curveTypes)) {\r\n                    if (curveTypes[0] === curveTypes[1] &&\r\n                        curveTypes[2] === curveTypes[3]) {\r\n                        curve.types.push(DynamicAnimCurve.Linear);\r\n                    }\r\n                    else {\r\n                        curve.types.push(DynamicAnimCurve.Bezier(curveTypes));\r\n                    }\r\n                    continue;\r\n                }\r\n            }\r\n            curve.types.push(DynamicAnimCurve.Linear);\r\n        }\r\n\r\n        if (isMotionPathProp) {\r\n            sampleMotionPaths(motionPaths, curve, clip.duration, clip.sample);\r\n        }\r\n\r\n        // if every piece of ratios are the same, we can use the quick function to find frame index.\r\n        var ratios = curve.ratios;\r\n        var currRatioDif, lastRatioDif;\r\n        var canOptimize = true;\r\n        var EPSILON = 1e-6;\r\n        for (let i = 1, l = ratios.length; i < l; i++) {\r\n            currRatioDif = ratios[i] - ratios[i-1];\r\n            if (i === 1) {\r\n                lastRatioDif = currRatioDif;\r\n            }\r\n            else if (Math.abs(currRatioDif - lastRatioDif) > EPSILON) {\r\n                canOptimize = false;                \r\n                break;\r\n            }\r\n        }\r\n\r\n        curve._findFrameIndex = canOptimize ? quickFindIndex : binarySearch;\r\n\r\n        return curve;\r\n    }\r\n\r\n    function createTargetCurves (target, curveData) {\r\n        var propsData = curveData.props;\r\n        var compsData = curveData.comps;\r\n\r\n        if (propsData) {\r\n            for (var propPath in propsData) {\r\n                var data = propsData[propPath];\r\n                var curve = createPropCurve(target, propPath, data);\r\n\r\n                curves.push(curve);\r\n            }\r\n        }\r\n\r\n        if (compsData) {\r\n            for (var compName in compsData) {\r\n                var comp = target.getComponent(compName);\r\n\r\n                if (!comp) {\r\n                    continue;\r\n                }\r\n\r\n                var compData = compsData[compName];\r\n                for (var propPath in compData) {\r\n                    var data = compData[propPath];\r\n                    var curve = createPropCurve(comp, propPath, data);\r\n\r\n                    curves.push(curve);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // property curves\r\n\r\n    var curveData = clip.curveData;\r\n    var childrenCurveDatas = curveData.paths;\r\n\r\n    createTargetCurves(root, curveData);\r\n\r\n    for (var namePath in childrenCurveDatas) {\r\n        var target = cc.find(namePath, root);\r\n\r\n        if (!target) {\r\n            continue;\r\n        }\r\n\r\n        var childCurveDatas = childrenCurveDatas[namePath];\r\n        createTargetCurves(target, childCurveDatas);\r\n    }\r\n\r\n    // events curve\r\n\r\n    var events = clip.events;\r\n\r\n    if (!CC_EDITOR && events) {\r\n        var curve;\r\n\r\n        for (let i = 0, l = events.length; i < l; i++) {\r\n            if (!curve) {\r\n                curve = new EventAnimCurve();\r\n                curve.target = root;\r\n                curves.push(curve);\r\n            }\r\n\r\n            var eventData = events[i];\r\n            var ratio = eventData.frame / state.duration;\r\n\r\n            var eventInfo;\r\n            var index = binarySearch(curve.ratios, ratio);\r\n            if (index >= 0) {\r\n                eventInfo = curve.events[index];\r\n            }\r\n            else {\r\n                eventInfo = new EventInfo();\r\n                curve.ratios.push(ratio);\r\n                curve.events.push(eventInfo);\r\n            }\r\n\r\n            eventInfo.add(eventData.func, eventData.params);\r\n        }\r\n    }\r\n}\r\n\r\nif (CC_TEST) {\r\n    cc._Test.initClipData = initClipData;\r\n}\r\n\r\n\r\nmodule.exports = AnimationAnimator;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst WrapMode = require('./types').WrapMode;\r\n\r\n/**\r\n * !#en Class for animation data handling.\r\n * !#zh \r\n * @class AnimationClip\r\n * @extends Asset\r\n */\r\nvar AnimationClip = cc.Class({\r\n    name: 'cc.AnimationClip',\r\n    extends: cc.Asset,\r\n\r\n    properties: {\r\n        _duration: {\r\n            default: 0,\r\n            type: 'Float',\r\n        },\r\n\r\n        /**\r\n         * !#en Duration of this animation.\r\n         * !#zh \r\n         * @property duration\r\n         * @type {Number}\r\n         */\r\n        duration: {\r\n            get: function () { return this._duration; },\r\n        },\r\n\r\n        /**\r\n         * !#en FrameRate of this animation.\r\n         * !#zh \r\n         * @property sample\r\n         * @type {Number}\r\n         */\r\n        sample: {\r\n            default: 60,\r\n        },\r\n\r\n        /**\r\n         * !#en Speed of this animation.\r\n         * !#zh \r\n         * @property speed\r\n         * @type {Number}\r\n         */\r\n        speed: {\r\n            default: 1\r\n        },\r\n\r\n        /**\r\n         * !#en WrapMode of this animation.\r\n         * !#zh \r\n         * @property wrapMode\r\n         * @type {WrapMode}\r\n         */\r\n        wrapMode: {\r\n            default: WrapMode.Normal\r\n        },\r\n\r\n        /**\r\n         * !#en Curve data.\r\n         * !#zh \r\n         * @property curveData\r\n         * @type {Object}\r\n         * @example {@link cocos2d/core/animation-clip/curve-data.js}\r\n         */\r\n        curveData: {\r\n            default: {},\r\n            visible: false,\r\n        },\r\n\r\n        /**\r\n         * !#en Event data.\r\n         * !#zh \r\n         * @property events\r\n         * @type {Object[]}\r\n         * @example {@link cocos2d/core/animation-clip/event-data.js}\r\n         * @typescript events: {frame: number, func: string, params: string[]}[]\r\n         */\r\n        events: {\r\n            default: [],\r\n            visible: false,\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        /**\r\n         * !#en Crate clip with a set of sprite frames\r\n         * !#zh \r\n         * @method createWithSpriteFrames\r\n         * @param {[SpriteFrame]} spriteFrames\r\n         * @param {Number} sample\r\n         * @return {AnimationClip}\r\n         * @static\r\n         * @example\r\n         *\r\n         * var clip = cc.AnimationClip.createWithSpriteFrames(spriteFrames, 10);\r\n         *\r\n         */\r\n        createWithSpriteFrames: function (spriteFrames, sample) {\r\n            if (!Array.isArray(spriteFrames)) {\r\n                cc.errorID(3905);\r\n                return null;\r\n            }\r\n\r\n            var clip = new AnimationClip();\r\n            clip.sample = sample || clip.sample;\r\n\r\n            clip._duration = spriteFrames.length / clip.sample;\r\n\r\n            var frames = [];\r\n            var step = 1 / clip.sample;\r\n\r\n            for (var i = 0, l = spriteFrames.length; i < l; i++) {\r\n                frames[i] = { frame: (i * step), value: spriteFrames[i] };\r\n            }\r\n\r\n            clip.curveData = {\r\n                comps: {\r\n                    // component\r\n                    'cc.Sprite': {\r\n                        // component properties\r\n                        'spriteFrame': frames\r\n                    }\r\n                }\r\n            };\r\n\r\n            return clip;\r\n        }\r\n    }\r\n});\r\n\r\ncc.AnimationClip = module.exports = AnimationClip;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n\r\nvar bezierByTime = require('./bezier').bezierByTime;\r\n\r\nvar binarySearch = require('../core/utils/binary-search').binarySearchEpsilon;\r\nvar WrapModeMask = require('./types').WrapModeMask;\r\nvar WrappedInfo = require('./types').WrappedInfo;\r\n\r\n/**\r\n * Compute a new ratio by curve type\r\n * @param {Number} ratio - The origin ratio\r\n * @param {Array|String} type - If it's Array, then ratio will be computed with bezierByTime. If it's string, then ratio will be computed with cc.Easing function\r\n */\r\nfunction computeRatioByType (ratio, type) {\r\n    if (typeof type === 'string') {\r\n        var func = cc.Easing[type];\r\n        if (func) {\r\n            ratio = func(ratio);\r\n        }\r\n        else {\r\n            cc.errorID(3906, type);\r\n        }\r\n    }\r\n    else if (Array.isArray(type)) {\r\n        // bezier curve\r\n        ratio = bezierByTime(type, ratio);\r\n    }\r\n\r\n    return ratio;\r\n}\r\n\r\n//\r\n//  AnimationClip\r\n//  AnimCurve\r\n//\r\n// @class AnimCurve\r\n//\r\n//\r\nvar AnimCurve = cc.Class({\r\n    name: 'cc.AnimCurve',\r\n\r\n    //\r\n    // @method sample\r\n    // @param {number} time\r\n    // @param {number} ratio - The normalized time specified as a number between 0.0 and 1.0 inclusive.\r\n    // @param {AnimationState} state\r\n    //\r\n    sample: function (time, ratio, state) {},\r\n\r\n    onTimeChangedManually: undefined\r\n});\r\n\r\n/**\r\n *  index\r\n */\r\nfunction quickFindIndex (ratios, ratio) {\r\n    var length = ratios.length - 1;\r\n\r\n    if (length === 0) return 0;\r\n\r\n    var start = ratios[0];\r\n    if (ratio < start) return 0;\r\n\r\n    var end = ratios[length];\r\n    if (ratio > end) return length;\r\n\r\n    ratio = (ratio - start) / (end - start);\r\n\r\n    var eachLength = 1 / length;\r\n    var index = ratio / eachLength;\r\n    var floorIndex = index | 0;\r\n    var EPSILON = 1e-6;\r\n\r\n    if ((index - floorIndex) < EPSILON) {\r\n        return floorIndex;\r\n    }\r\n    else if ((floorIndex + 1 - index) < EPSILON) {\r\n        return floorIndex + 1;\r\n    }\r\n\r\n    return ~(floorIndex + 1);\r\n}\r\n\r\n//\r\n//\r\n// @class DynamicAnimCurve\r\n//\r\n// @extends AnimCurve\r\n//\r\nvar DynamicAnimCurve = cc.Class({\r\n    name: 'cc.DynamicAnimCurve',\r\n    extends: AnimCurve,\r\n\r\n    properties: {\r\n\r\n        // The object being animated.\r\n        // @property target\r\n        // @type {object}\r\n        target: null,\r\n\r\n        // The name of the property being animated.\r\n        // @property prop\r\n        // @type {string}\r\n        prop: '',\r\n\r\n        // The values of the keyframes. (y)\r\n        // @property values\r\n        // @type {any[]}\r\n        values: [],\r\n\r\n        // The keyframe ratio of the keyframe specified as a number between 0.0 and 1.0 inclusive. (x)\r\n        // @property ratios\r\n        // @type {number[]}\r\n        ratios: [],\r\n\r\n        // @property types\r\n        // @param {object[]}\r\n        // Each array item maybe type:\r\n        // - [x, x, x, x]: Four control points for bezier\r\n        // - null: linear\r\n        types: [],\r\n\r\n        // @property {string[]} subProps - The path of sub property being animated.\r\n        subProps: null\r\n    },\r\n\r\n    _findFrameIndex: binarySearch,\r\n\r\n    sample: function (time, ratio, state) {\r\n        var values = this.values;\r\n        var ratios = this.ratios;\r\n        var frameCount = ratios.length;\r\n\r\n        if (frameCount === 0) {\r\n            return;\r\n        }\r\n\r\n        // evaluate value\r\n        var value;\r\n        var index = this._findFrameIndex(ratios, ratio);\r\n\r\n        if (index < 0) {\r\n            index = ~index;\r\n\r\n            if (index <= 0) {\r\n                value = values[0];\r\n            }\r\n            else if (index >= frameCount) {\r\n                value = values[frameCount - 1];\r\n            }\r\n            else {\r\n                var fromVal = values[index - 1];\r\n\r\n                var isNumber = typeof fromVal === 'number';\r\n                var canLerp = fromVal && fromVal.lerp;\r\n\r\n                if (!isNumber && !canLerp) {\r\n                    value = fromVal;\r\n                }\r\n                else {\r\n                    var fromRatio = ratios[index - 1];\r\n                    var toRatio = ratios[index];\r\n                    var type = this.types[index - 1];\r\n                    var ratioBetweenFrames = (ratio - fromRatio) / (toRatio - fromRatio);\r\n\r\n                    if (type) {\r\n                        ratioBetweenFrames = computeRatioByType(ratioBetweenFrames, type);\r\n                    }\r\n\r\n                    // calculate value\r\n                    var toVal = values[index];\r\n\r\n                    // lerp\r\n                    if (isNumber) {\r\n                        value = fromVal + (toVal - fromVal) * ratioBetweenFrames;\r\n                    }\r\n                    else if (canLerp) {\r\n                        value = fromVal.lerp(toVal, ratioBetweenFrames);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            value = values[index];\r\n        }\r\n\r\n        var subProps = this.subProps;\r\n        if (subProps) {\r\n            // create batched value dynamically\r\n            var mainProp = this.target[this.prop];\r\n            var subProp = mainProp;\r\n\r\n            for (var i = 0; i < subProps.length - 1; i++) {\r\n                var subPropName = subProps[i];\r\n                if (subProp) {\r\n                    subProp = subProp[subPropName];\r\n                }\r\n                else {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            var propName = subProps[subProps.length - 1];\r\n\r\n            if (subProp) {\r\n                subProp[propName] = value;\r\n            }\r\n            else {\r\n                return;\r\n            }\r\n\r\n            value = mainProp;\r\n        }\r\n\r\n        // apply value\r\n        this.target[this.prop] = value;\r\n    }\r\n});\r\n\r\nDynamicAnimCurve.Linear = null;\r\nDynamicAnimCurve.Bezier = function (controlPoints) {\r\n    return controlPoints;\r\n};\r\n\r\n\r\n\r\n/**\r\n * Event information,\r\n * @class EventInfo\r\n *\r\n */\r\nvar EventInfo = function () {\r\n    this.events = [];\r\n};\r\n\r\n/**\r\n * @param {Function} [func] event function\r\n * @param {Object[]} [params] event params\r\n */\r\nEventInfo.prototype.add = function (func, params) {\r\n    this.events.push({\r\n        func: func || '',\r\n        params: params || []\r\n    });\r\n};\r\n\r\n\r\n/**\r\n *\r\n * @class EventAnimCurve\r\n *\r\n * @extends AnimCurve\r\n */\r\nvar EventAnimCurve = cc.Class({\r\n    name: 'cc.EventAnimCurve',\r\n    extends: AnimCurve,\r\n\r\n    properties: {\r\n        /**\r\n         * The object being animated.\r\n         * @property target\r\n         * @type {object}\r\n         */\r\n        target: null,\r\n\r\n        /** The keyframe ratio of the keyframe specified as a number between 0.0 and 1.0 inclusive. (x)\r\n         * @property ratios\r\n         * @type {number[]}\r\n         */\r\n        ratios: [],\r\n\r\n        /**\r\n         * @property events\r\n         * @type {EventInfo[]}\r\n         */\r\n        events: [],\r\n\r\n        _wrappedInfo: {\r\n            default: function () {\r\n                return new WrappedInfo();\r\n            }\r\n        },\r\n\r\n        _lastWrappedInfo: null,\r\n\r\n        _ignoreIndex: NaN\r\n    },\r\n\r\n    _wrapIterations: function (iterations) {\r\n        if (iterations - (iterations | 0) === 0) iterations -= 1;\r\n        return iterations | 0;\r\n    },\r\n\r\n    sample: function (time, ratio, state) {\r\n        var length = this.ratios.length;\r\n\r\n        var currentWrappedInfo = state.getWrappedInfo(state.time, this._wrappedInfo);\r\n        var direction = currentWrappedInfo.direction;\r\n        var currentIndex = binarySearch(this.ratios, currentWrappedInfo.ratio);\r\n        if (currentIndex < 0) {\r\n            currentIndex = ~currentIndex - 1;\r\n\r\n            // if direction is inverse, then increase index\r\n            if (direction < 0) currentIndex += 1;\r\n        }\r\n\r\n        if (this._ignoreIndex !== currentIndex) {\r\n            this._ignoreIndex = NaN;\r\n        }\r\n\r\n        currentWrappedInfo.frameIndex = currentIndex;\r\n\r\n        if (!this._lastWrappedInfo) {\r\n            this._fireEvent(currentIndex);\r\n            this._lastWrappedInfo = new WrappedInfo(currentWrappedInfo);\r\n            return;\r\n        }\r\n\r\n        var wrapMode = state.wrapMode;\r\n        var currentIterations = this._wrapIterations(currentWrappedInfo.iterations);\r\n\r\n        var lastWrappedInfo = this._lastWrappedInfo;\r\n        var lastIterations = this._wrapIterations(lastWrappedInfo.iterations);\r\n        var lastIndex = lastWrappedInfo.frameIndex;\r\n        var lastDirection = lastWrappedInfo.direction;\r\n\r\n        var interationsChanged = lastIterations !== -1 && currentIterations !== lastIterations;\r\n\r\n        if (lastIndex === currentIndex && interationsChanged && length === 1) {\r\n            this._fireEvent(0);\r\n        }\r\n        else if (lastIndex !== currentIndex || interationsChanged) {\r\n            direction = lastDirection;\r\n\r\n            do {\r\n                if (lastIndex !== currentIndex) {\r\n                    if (direction === -1 && lastIndex === 0 && currentIndex > 0) {\r\n                        if ((wrapMode & WrapModeMask.PingPong) === WrapModeMask.PingPong) {\r\n                            direction *= -1;\r\n                        }\r\n                        else {\r\n                            lastIndex = length;\r\n                        }\r\n\r\n                        lastIterations ++;\r\n                    }\r\n                    else if (direction === 1 && lastIndex === length - 1 && currentIndex < length - 1) {\r\n                        if ((wrapMode & WrapModeMask.PingPong) === WrapModeMask.PingPong) {\r\n                            direction *= -1;\r\n                        }\r\n                        else {\r\n                            lastIndex = -1;\r\n                        }\r\n\r\n                        lastIterations ++;\r\n                    }\r\n\r\n                    if (lastIndex === currentIndex) break;\r\n                    if (lastIterations > currentIterations) break;\r\n                }\r\n\r\n                lastIndex += direction;\r\n\r\n                cc.director.getAnimationManager().pushDelayEvent(this, '_fireEvent', [lastIndex]);\r\n            } while (lastIndex !== currentIndex && lastIndex > -1 && lastIndex < length);\r\n        }\r\n\r\n        this._lastWrappedInfo.set(currentWrappedInfo);\r\n    },\r\n\r\n    _fireEvent: function (index) {\r\n        if (index < 0 || index >= this.events.length || this._ignoreIndex === index) return;\r\n\r\n        var eventInfo = this.events[index];\r\n        var events = eventInfo.events;\r\n        \r\n        if ( !this.target.isValid ) { \r\n            return; \r\n        }\r\n        \r\n        var components = this.target._components;\r\n\r\n        for (var i = 0;  i < events.length; i++) {\r\n            var event = events[i];\r\n            var funcName = event.func;\r\n\r\n            for (var j = 0; j < components.length; j++) {\r\n                var component = components[j];\r\n                var func = component[funcName];\r\n\r\n                if (func) func.apply(component, event.params);\r\n            }\r\n        }\r\n    },\r\n\r\n    onTimeChangedManually: function (time, state) {\r\n        this._lastWrappedInfo = null;\r\n        this._ignoreIndex = NaN;\r\n\r\n        var info = state.getWrappedInfo(time, this._wrappedInfo);\r\n        var direction = info.direction;\r\n        var frameIndex = binarySearch(this.ratios, info.ratio);\r\n\r\n        // only ignore when time not on a frame index\r\n        if (frameIndex < 0) {\r\n            frameIndex = ~frameIndex - 1;\r\n\r\n            // if direction is inverse, then increase index\r\n            if (direction < 0) frameIndex += 1;\r\n\r\n            this._ignoreIndex = frameIndex;\r\n        }\r\n    }\r\n});\r\n\r\n\r\nif (CC_TEST) {\r\n    cc._Test.DynamicAnimCurve = DynamicAnimCurve;\r\n    cc._Test.EventAnimCurve = EventAnimCurve;\r\n    cc._Test.quickFindIndex = quickFindIndex;\r\n}\r\n\r\nmodule.exports = {\r\n    AnimCurve: AnimCurve,\r\n    DynamicAnimCurve: DynamicAnimCurve,\r\n    EventAnimCurve: EventAnimCurve,\r\n    EventInfo: EventInfo,\r\n    computeRatioByType: computeRatioByType,\r\n    quickFindIndex: quickFindIndex\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = cc.js;\r\n\r\nvar AnimationManager = cc.Class({\r\n    ctor: function () {\r\n        this._anims = new js.array.MutableForwardIterator([]);\r\n        this._delayEvents = [];\r\n\r\n        cc.director._scheduler && cc.director._scheduler.enableForTarget(this);\r\n    },\r\n\r\n    // for manager\r\n\r\n    update: function (dt) {\r\n        var iterator = this._anims;\r\n        var array = iterator.array;\r\n        for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n            var anim = array[iterator.i];\r\n            if (anim._isPlaying && !anim._isPaused) {\r\n                anim.update(dt);\r\n            }\r\n        }\r\n\r\n        var events = this._delayEvents;\r\n        for (let i = 0, l = events.length; i < l; i++) {\r\n            var event = events[i];\r\n            event.target[event.func].apply(event.target, event.args);\r\n        }\r\n        events.length = 0;\r\n    },\r\n\r\n    destruct: function () {},\r\n\r\n\r\n    /**\r\n     * @param {AnimationState} anim\r\n     */\r\n    addAnimation: function (anim) {\r\n        var index = this._anims.array.indexOf(anim);\r\n        if (index === -1) {\r\n            this._anims.push(anim);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @param {AnimationState} anim\r\n     */\r\n    removeAnimation: function (anim) {\r\n        var index = this._anims.array.indexOf(anim);\r\n        if (index >= 0) {\r\n            this._anims.fastRemoveAt(index);\r\n        }\r\n        else {\r\n            cc.errorID(3907);\r\n        }\r\n    },\r\n\r\n    pushDelayEvent: function (target, func, args) {\r\n        this._delayEvents.push({\r\n            target: target,\r\n            func: func,\r\n            args: args\r\n        });\r\n    }\r\n});\r\n\r\n\r\ncc.AnimationManager = module.exports = AnimationManager;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n\r\nvar js = cc.js;\r\nvar Playable = require('./playable');\r\n\r\nvar Types = require('./types');\r\nvar WrappedInfo = Types.WrappedInfo;\r\nvar WrapMode = Types.WrapMode;\r\nvar WrapModeMask = Types.WrapModeMask;\r\n\r\n/**\r\n * !#en\r\n * The AnimationState gives full control over animation playback process.\r\n * In most cases the Animation Component is sufficient and easier to use. Use the AnimationState if you need full control.\r\n * !#zh\r\n * AnimationState <br/>\r\n *    AnimationState\r\n * @class AnimationState\r\n * @extends Playable\r\n *\r\n */\r\n\r\n/**\r\n * @method constructor\r\n * @param {AnimationClip} clip\r\n * @param {String} [name]\r\n */\r\nfunction AnimationState (clip, name) {\r\n    Playable.call(this);\r\n    \r\n    // Mark whether the current frame is played.\r\n    // When set new time to animation state, we should ensure the frame at the specified time being played at next update.\r\n    this._currentFramePlayed = false;\r\n    \r\n    this._delay = 0;\r\n    this._delayTime = 0;\r\n\r\n    this._wrappedInfo = new WrappedInfo();\r\n    this._lastWrappedInfo = null;\r\n\r\n    this._process = process;\r\n\r\n    this._clip = clip;\r\n    this._name = name || (clip && clip.name);\r\n\r\n    /**\r\n     * @property animator\r\n     * @type {AnimationAnimator}\r\n     */\r\n    this.animator = null;\r\n\r\n    /**\r\n     * !#en The curves list.\r\n     * !#zh \r\n     * @property curves\r\n     * @type {Object[]}\r\n     */\r\n    this.curves = [];\r\n\r\n    // http://www.w3.org/TR/web-animations/#idl-def-AnimationTiming\r\n\r\n    /**\r\n     * !#en The start delay which represents the number of seconds from an animation's start time to the start of\r\n     * the active interval.\r\n     * !#zh \r\n     *\r\n     * @property delay\r\n     * @type {Number}\r\n     * @default 0\r\n     */\r\n    this.delay = 0;\r\n\r\n    /**\r\n     * !#en The animation's iteration count property.\r\n     *\r\n     * A real number greater than or equal to zero (including positive infinity) representing the number of times\r\n     * to repeat the animation node.\r\n     *\r\n     * Values less than zero and NaN values are treated as the value 1.0 for the purpose of timing model\r\n     * calculations.\r\n     *\r\n     * !#zh , normalize time  2.52\r\n     *\r\n     * @property repeatCount\r\n     * @type {Number}\r\n     * @default 1\r\n     */\r\n    this.repeatCount = 1;\r\n\r\n    /**\r\n     * !#en The iteration duration of this animation in seconds. (length)\r\n     * !#zh \r\n     *\r\n     * @property duration\r\n     * @type {Number}\r\n     * @readOnly\r\n     */\r\n    this.duration = 1;\r\n\r\n    /**\r\n     * !#en The animation's playback speed. 1 is normal playback speed.\r\n     * !#zh \r\n     * @property speed\r\n     * @type {Number}\r\n     * @default: 1.0\r\n     */\r\n    this.speed = 1;\r\n\r\n    /**\r\n     * !#en\r\n     * Wrapping mode of the playing animation.\r\n     * Notice : dynamic change wrapMode will reset time and repeatCount property\r\n     * !#zh\r\n     * \r\n     *  wrapMode  time  repeatCount\r\n     *\r\n     * @property wrapMode\r\n     * @type {WrapMode}\r\n     * @default: WrapMode.Normal\r\n     */\r\n    this.wrapMode = WrapMode.Normal;\r\n\r\n    /**\r\n     * !#en The current time of this animation in seconds.\r\n     * !#zh \r\n     * @property time\r\n     * @type {Number}\r\n     * @default 0\r\n     */\r\n    this.time = 0;\r\n\r\n    // Animation as event target\r\n    this._target = null;\r\n    this._lastframeEventOn = false;\r\n    this.emit = function () {\r\n        var args = new Array(arguments.length);\r\n        for (var i = 0, l = args.length; i < l; i++) {\r\n            args[i] = arguments[i];\r\n        }\r\n        cc.director.getAnimationManager().pushDelayEvent(this, '_emit', args);\r\n    };\r\n}\r\njs.extend(AnimationState, Playable);\r\n\r\nvar proto = AnimationState.prototype;\r\n\r\nproto._emit = function (type, state) {\r\n    if (this._target && this._target.isValid) {\r\n        this._target.emit(type, type, state);\r\n    }\r\n};\r\n\r\nproto.on = function (type, callback, target) {\r\n    if (this._target && this._target.isValid) {\r\n        if (type === 'lastframe') {\r\n            this._lastframeEventOn = true;\r\n        }\r\n        return this._target.on(type, callback, target);\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n};\r\n\r\nproto.once = function (type, callback, target) {\r\n    if (this._target && this._target.isValid) {\r\n        if (type === 'lastframe') {\r\n            this._lastframeEventOn = true;\r\n        }\r\n        let self = this;\r\n        return this._target.once(type, function (event) {\r\n            callback.call(target, event);\r\n            self._lastframeEventOn = false;\r\n        });\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n};\r\n\r\nproto.off = function (type, callback, target) {\r\n    if (this._target && this._target.isValid) {\r\n        if (type === 'lastframe') {\r\n            if (!this._target.hasEventListener(type)) {\r\n                this._lastframeEventOn = false;\r\n            }\r\n        }\r\n        this._target.off(type, callback, target);\r\n    }\r\n};\r\n\r\nproto._setEventTarget = function (target) {\r\n    this._target = target;\r\n};\r\n\r\nproto.onPlay = function () {\r\n    // replay\r\n    this.setTime(0);\r\n    this._delayTime = this._delay;\r\n    \r\n    cc.director.getAnimationManager().addAnimation(this);\r\n\r\n    if (this.animator) {\r\n        this.animator.addAnimation(this);\r\n    }\r\n    \r\n    this.emit('play', this);\r\n};\r\n\r\nproto.onStop = function () {\r\n    if (!this.isPaused) {\r\n        cc.director.getAnimationManager().removeAnimation(this);\r\n    }\r\n\r\n    if (this.animator) {\r\n        this.animator.removeAnimation(this);\r\n    }\r\n\r\n    this.emit('stop', this);\r\n};\r\n\r\nproto.onResume = function () {\r\n    cc.director.getAnimationManager().addAnimation(this);\r\n    this.emit('resume', this);\r\n};\r\n\r\nproto.onPause = function () {\r\n    cc.director.getAnimationManager().removeAnimation(this);\r\n    this.emit('pause', this);\r\n};\r\n\r\nproto.setTime = function (time) {\r\n    this._currentFramePlayed = false;\r\n    this.time = time || 0;\r\n\r\n    var curves = this.curves;\r\n    for (var i = 0, l = curves.length; i < l; i++) {\r\n        var curve = curves[i];\r\n        if (curve.onTimeChangedManually) {\r\n            curve.onTimeChangedManually(time, this);\r\n        }\r\n    }\r\n};\r\n\r\nfunction process () {\r\n    // sample\r\n    var info = this.sample();\r\n\r\n    if (this._lastframeEventOn) {\r\n        var lastInfo;\r\n        if (!this._lastWrappedInfo) {\r\n            lastInfo = this._lastWrappedInfo = new WrappedInfo(info);\r\n        } else {\r\n            lastInfo = this._lastWrappedInfo;\r\n        }\r\n\r\n        if (this.repeatCount > 1 && ((info.iterations | 0) > (lastInfo.iterations | 0))) {\r\n            this.emit('lastframe', this);\r\n        }\r\n\r\n        lastInfo.set(info);\r\n    }\r\n\r\n    if (info.stopped) {\r\n        this.stop();\r\n        this.emit('finished', this);\r\n    }\r\n}\r\n\r\nfunction simpleProcess () {\r\n    var time = this.time;\r\n    var duration = this.duration;\r\n\r\n    if (time > duration) {\r\n        time = time % duration;\r\n        if (time === 0) time = duration;\r\n    }\r\n    else if (time < 0) {\r\n        time = time % duration;\r\n        if (time !== 0) time += duration;\r\n    }\r\n\r\n    var ratio = time / duration;\r\n\r\n    var curves = this.curves;\r\n    for (var i = 0, len = curves.length; i < len; i++) {\r\n        var curve = curves[i];\r\n        curve.sample(time, ratio, this);\r\n    }\r\n\r\n    if (this._lastframeEventOn) {\r\n        if (this._lastIterations === undefined) {\r\n            this._lastIterations = ratio;\r\n        }\r\n\r\n        if ((this.time > 0 && this._lastIterations > ratio) || (this.time < 0 && this._lastIterations < ratio)) {\r\n            this.emit('lastframe', this);\r\n        }\r\n\r\n        this._lastIterations = ratio;\r\n    }\r\n}\r\n\r\nproto.update = function (delta) {\r\n    // calculate delay time\r\n\r\n    if (this._delayTime > 0) {\r\n        this._delayTime -= delta;\r\n        if (this._delayTime > 0) {\r\n            // still waiting\r\n            return;\r\n        }\r\n    }\r\n\r\n    // make first frame perfect\r\n\r\n    //var playPerfectFirstFrame = (this.time === 0);\r\n    if (this._currentFramePlayed) {\r\n        this.time += (delta * this.speed);\r\n    }\r\n    else {\r\n        this._currentFramePlayed = true;\r\n    }\r\n\r\n    this._process();\r\n};\r\n\r\nproto._needRevers = function (currentIterations) {\r\n    var wrapMode = this.wrapMode;\r\n    var needRevers = false;\r\n\r\n    if ((wrapMode & WrapModeMask.PingPong) === WrapModeMask.PingPong) {\r\n        var isEnd = currentIterations - (currentIterations | 0) === 0;\r\n        if (isEnd && (currentIterations > 0)) {\r\n            currentIterations -= 1;\r\n        }\r\n\r\n        var isOddIteration = currentIterations & 1;\r\n        if (isOddIteration) {\r\n            needRevers = !needRevers;\r\n        }\r\n    }\r\n    if ((wrapMode & WrapModeMask.Reverse) === WrapModeMask.Reverse) {\r\n        needRevers = !needRevers;\r\n    }\r\n    return needRevers;\r\n};\r\n\r\nproto.getWrappedInfo = function (time, info) {\r\n    info = info || new WrappedInfo();\r\n    \r\n    var stopped = false;\r\n    var duration = this.duration;\r\n    var repeatCount = this.repeatCount;\r\n\r\n    var currentIterations = time > 0 ? (time / duration) : -(time / duration);\r\n    if (currentIterations >= repeatCount) {\r\n        currentIterations = repeatCount;\r\n\r\n        stopped = true;\r\n        var tempRatio = repeatCount - (repeatCount | 0);\r\n        if (tempRatio === 0) {\r\n            tempRatio = 1;  // \r\n        }\r\n        time = tempRatio * duration * (time > 0 ? 1 : -1);\r\n    }\r\n\r\n    if (time > duration) {\r\n        var tempTime = time % duration;\r\n        time = tempTime === 0 ? duration : tempTime;\r\n    }\r\n    else if (time < 0) {\r\n        time = time % duration;\r\n        if (time !== 0 ) time += duration;\r\n    }\r\n\r\n    var needRevers = false;\r\n    var shouldWrap = this._wrapMode & WrapModeMask.ShouldWrap;\r\n    if (shouldWrap) {\r\n        needRevers = this._needRevers(currentIterations);\r\n    }\r\n\r\n    var direction = needRevers ? -1 : 1;\r\n    if (this.speed < 0) {\r\n        direction *= -1;\r\n    }\r\n\r\n    // calculate wrapped time\r\n    if (shouldWrap && needRevers) {\r\n        time = duration - time;\r\n    }\r\n\r\n    info.ratio = time / duration;\r\n    info.time = time;\r\n    info.direction = direction;\r\n    info.stopped = stopped;\r\n    info.iterations = currentIterations;\r\n\r\n    return info;\r\n};\r\n\r\nproto.sample = function () {\r\n    var info = this.getWrappedInfo(this.time, this._wrappedInfo);\r\n    var curves = this.curves;\r\n    for (var i = 0, len = curves.length; i < len; i++) {\r\n        var curve = curves[i];\r\n        curve.sample(info.time, info.ratio, this);\r\n    }\r\n\r\n    return info;\r\n};\r\n\r\n\r\n/**\r\n * !#en The clip that is being played by this animation state.\r\n * !#zh \r\n * @property clip\r\n * @type {AnimationClip}\r\n * @final\r\n */\r\njs.get(proto, 'clip', function () {\r\n    return this._clip;\r\n});\r\n\r\n/**\r\n * !#en The name of the playing animation.\r\n * !#zh \r\n * @property name\r\n * @type {String}\r\n * @readOnly\r\n */\r\njs.get(proto, 'name', function () {\r\n    return this._name;\r\n});\r\n\r\njs.obsolete(proto, 'AnimationState.length', 'duration');\r\n\r\njs.getset(proto, 'curveLoaded',\r\n    function () {\r\n        return this.curves.length > 0;\r\n    },\r\n    function () {\r\n        this.curves.length = 0;\r\n    }\r\n);\r\n\r\n\r\njs.getset(proto, 'wrapMode',\r\n    function () {\r\n        return this._wrapMode;\r\n    },\r\n    function (value) {\r\n        this._wrapMode = value;\r\n\r\n        if (CC_EDITOR) return;\r\n\r\n        // dynamic change wrapMode will need reset time to 0\r\n        this.time = 0;\r\n\r\n        if (value & WrapModeMask.Loop) {\r\n            this.repeatCount = Infinity;\r\n        }\r\n        else {\r\n            this.repeatCount = 1;\r\n        }\r\n        \r\n    }\r\n);\r\n\r\njs.getset(proto, 'repeatCount',\r\n    function () {\r\n        return this._repeatCount;\r\n    },\r\n    function (value) {\r\n        this._repeatCount = value;\r\n        \r\n        var shouldWrap = this._wrapMode & WrapModeMask.ShouldWrap;\r\n        var reverse = (this.wrapMode & WrapModeMask.Reverse) === WrapModeMask.Reverse;\r\n        if (value === Infinity && !shouldWrap && !reverse) {\r\n            this._process = simpleProcess;\r\n        }\r\n        else {\r\n            this._process = process;\r\n        }\r\n    }\r\n);\r\n\r\njs.getset(proto, 'delay', \r\n    function () {\r\n        return this._delay;\r\n    },\r\n    function (value) {\r\n        this._delayTime = this._delay = value;\r\n    }\r\n);\r\n\r\n\r\ncc.AnimationState = module.exports = AnimationState;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n//var bezier = (function () {\r\n//    function B1 (t) { return (t * t * t); }\r\n//    function B2 (t) { return (3 * t * t * (1 - t)); }\r\n//    function B3 (t) { return (3 * t * (1 - t) * (1 - t)); }\r\n//    function B4 (t) { return ((1 - t) * (1 - t) * (1 - t)); }\r\n//    function bezier (C1, C2, C3, C4, t) {\r\n//        return C1 * B1(t) + C2 * B2(t) + C3 * B3(t) + C4 * B4(t);\r\n//    }\r\n//\r\n//    //function bezier (C1, C2, C3, C4, t, out) {\r\n//    //    out.x = C1.x * B1(t) + C2.x * B2(t) + C3.x * B3(t) + C4.x * B4(t);\r\n//    //    out.y = C1.y * B1(t) + C2.y * B2(t) + C3.y * B3(t) + C4.y * B4(t);\r\n//    //}\r\n//\r\n//    return bezier;\r\n//})();\r\nfunction bezier (C1, C2, C3, C4, t) {\r\n   var t1 = 1 - t;\r\n   return C1 * t1 * t1 * t1 +\r\n          C2 * 3 * t1 * t1 * t +\r\n          C3 * 3 * t1 * t * t +\r\n          C4 * t * t * t;\r\n}\r\n//function bezier (c0, c1, c2, c3, t) {\r\n//    var cy = 3.0 * (c1);\r\n//    var by = 3.0 * (c3 - c1) - cy;\r\n//    var ay = 1 - cy - by;\r\n//    return (ay * t * t * t) + (by * t * t) + (cy * t);\r\n//}\r\n\r\n//var sin = Math.sin;\r\nvar cos = Math.cos,\r\n    acos = Math.acos,\r\n    max = Math.max,\r\n    //atan2 = Math.atan2,\r\n    pi = Math.PI,\r\n    tau = 2 * pi,\r\n    sqrt = Math.sqrt;\r\n\r\nfunction crt (v) {\r\n    if (v < 0) {\r\n        return -Math.pow(-v, 1 / 3);\r\n    }\r\n    else {\r\n        return Math.pow(v, 1 / 3);\r\n    }\r\n}\r\n\r\n//function align (curve, line) {\r\n//    var tx = line.p1.x,\r\n//        ty = line.p1.y,\r\n//        a = -atan2(line.p2.y-ty, line.p2.x-tx);\r\n//    curve = [{x:0, y:1}, {x: curve[0], y: 1-curve[1]}, {x: curve[2], y: 1-curve[3]}, {x:1, y:0}];\r\n//    return curve.map(function(v) {\r\n//        return {\r\n//            x: (v.x-tx)*cos(a) - (v.y-ty)*sin(a),\r\n//            y: (v.x-tx)*sin(a) + (v.y-ty)*cos(a)\r\n//        };\r\n//    });\r\n//}\r\n\r\n// Modified from http://jsbin.com/yibipofeqi/1/edit, optimized for animations.\r\n// The origin Cardano's algorithm is based on http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\r\nfunction cardano (curve, x) {\r\n    // align curve with the intersecting line:\r\n        //var line = {p1: {x: x, y: 0}, p2: {x: x, y: 1}};\r\n        //var aligned = align(curve, line);\r\n        //// and rewrite from [a(1-t)^3 + 3bt(1-t)^2 + 3c(1-t)t^2 + dt^3] form\r\n        //    pa = aligned[0].y,\r\n        //    pb = aligned[1].y,\r\n        //    pc = aligned[2].y,\r\n        //    pd = aligned[3].y;\r\n        ////// curve = [{x:0, y:1}, {x: curve[0], y: 1-curve[1]}, {x: curve[2], y: 1-curve[3]}, {x:1, y:0}];\r\n    var pa = x - 0;\r\n    var pb = x - curve[0];\r\n    var pc = x - curve[2];\r\n    var pd = x - 1;\r\n\r\n    // to [t^3 + at^2 + bt + c] form:\r\n    var pa3 = pa * 3;\r\n    var pb3 = pb * 3;\r\n    var pc3 = pc * 3;\r\n    var d = (-pa + pb3 - pc3 + pd),\r\n        rd = 1 / d,\r\n        r3 = 1 / 3,\r\n        a = (pa3 - 6 * pb + pc3) * rd,\r\n        a3 = a * r3,\r\n        b = (-pa3 + pb3) * rd,\r\n        c = pa * rd,\r\n    // then, determine p and q:\r\n        p = (3 * b - a * a) * r3,\r\n        p3 = p * r3,\r\n        q = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\r\n        q2 = q / 2,\r\n    // and determine the discriminant:\r\n        discriminant = q2 * q2 + p3 * p3 * p3,\r\n    // and some reserved variables\r\n        u1, v1, x1, x2, x3;\r\n\r\n    // If the discriminant is negative, use polar coordinates\r\n    // to get around square roots of negative numbers\r\n    if (discriminant < 0) {\r\n        var mp3 = -p * r3,\r\n            mp33 = mp3 * mp3 * mp3,\r\n            r = sqrt(mp33),\r\n        // compute cosphi corrected for IEEE float rounding:\r\n            t = -q / (2 * r),\r\n            cosphi = t < -1 ? -1 : t > 1 ? 1 : t,\r\n            phi = acos(cosphi),\r\n            crtr = crt(r),\r\n            t1 = 2 * crtr;\r\n        x1 = t1 * cos(phi * r3) - a3;\r\n        x2 = t1 * cos((phi + tau) * r3) - a3;\r\n        x3 = t1 * cos((phi + 2 * tau) * r3) - a3;\r\n\r\n        // choose best percentage\r\n        if (0 <= x1 && x1 <= 1) {\r\n            if (0 <= x2 && x2 <= 1) {\r\n                if (0 <= x3 && x3 <= 1) {\r\n                    return max(x1, x2, x3);\r\n                }\r\n                else {\r\n                    return max(x1, x2);\r\n                }\r\n            }\r\n            else if (0 <= x3 && x3 <= 1) {\r\n                return max(x1, x3);\r\n            }\r\n            else {\r\n                return x1;\r\n            }\r\n        }\r\n        else {\r\n            if (0 <= x2 && x2 <= 1) {\r\n                if (0 <= x3 && x3 <= 1) {\r\n                    return max(x2, x3);\r\n                }\r\n                else {\r\n                    return x2;\r\n                }\r\n            }\r\n            else {\r\n                return x3;\r\n            }\r\n        }\r\n    }\r\n    else if (discriminant === 0) {\r\n        u1 = q2 < 0 ? crt(-q2) : -crt(q2);\r\n        x1 = 2 * u1 - a3;\r\n        x2 = -u1 - a3;\r\n\r\n        // choose best percentage\r\n        if (0 <= x1 && x1 <= 1) {\r\n            if (0 <= x2 && x2 <= 1) {\r\n                return max(x1, x2);\r\n            }\r\n            else {\r\n                return x1;\r\n            }\r\n        }\r\n        else {\r\n            return x2;\r\n        }\r\n    }\r\n    // one real root, and two imaginary roots\r\n    else {\r\n        var sd = sqrt(discriminant);\r\n        u1 = crt(-q2 + sd);\r\n        v1 = crt(q2 + sd);\r\n        x1 = u1 - v1 - a3;\r\n        return x1;\r\n    }\r\n}\r\n\r\nfunction bezierByTime (controlPoints, x) {\r\n    var percent = cardano(controlPoints, x);    // t\r\n    var p0y = 0;                // a\r\n    var p1y = controlPoints[1]; // b\r\n    var p2y = controlPoints[3]; // c\r\n    var p3y = 1;                // d\r\n    var t1 = 1 - percent;\r\n    return p0y * t1 * t1 * t1 +\r\n           p1y * 3 * percent * t1 * t1 +\r\n           p2y * 3 * percent * percent * t1 +\r\n           p3y * percent * percent * percent;\r\n}\r\n\r\nif (CC_TEST) {\r\n    cc._Test.bezier = bezier;\r\n    cc._Test.bezierByTime = bezierByTime;\r\n}\r\n\r\nmodule.exports = {\r\n    bezier: bezier,\r\n    bezierByTime: bezierByTime\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar Easing = {\r\n    constant: function () { return 0; },\r\n    linear: function (k) { return k; },\r\n\r\n    // quad\r\n    //  Easing equation function for a quadratic (t^2)\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return: The correct value.\r\n\r\n    quadIn: function (k) { return k * k; },\r\n    quadOut: function (k) { return k * ( 2 - k ); },\r\n    quadInOut: function (k) {\r\n        if (( k *= 2 ) < 1) {\r\n            return 0.5 * k * k;\r\n        }\r\n        return -0.5 * ( --k * ( k - 2 ) - 1 );\r\n    },\r\n\r\n    // cubic\r\n    //  Easing equation function for a cubic (t^3)\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return: The correct value.\r\n\r\n    cubicIn: function (k) { return k * k * k; },\r\n    cubicOut: function (k) { return --k * k * k + 1; },\r\n    cubicInOut: function (k) {\r\n        if (( k *= 2 ) < 1) {\r\n            return 0.5 * k * k * k;\r\n        }\r\n        return 0.5 * ( ( k -= 2 ) * k * k + 2 );\r\n    },\r\n\r\n    // quart\r\n    //  Easing equation function for a quartic (t^4)\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return: The correct value.\r\n\r\n    quartIn: function (k) { return k * k * k * k; },\r\n    quartOut: function (k) { return 1 - ( --k * k * k * k ); },\r\n    quartInOut: function (k) {\r\n        if (( k *= 2 ) < 1) {\r\n            return 0.5 * k * k * k * k;\r\n        }\r\n        return -0.5 * ( ( k -= 2 ) * k * k * k - 2 );\r\n    },\r\n\r\n    // quint\r\n    //  Easing equation function for a quintic (t^5)\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return: The correct value.\r\n\r\n    quintIn: function (k) { return k * k * k * k * k; },\r\n    quintOut: function (k) { return --k * k * k * k * k + 1; },\r\n    quintInOut: function (k) {\r\n        if (( k *= 2 ) < 1) {\r\n            return 0.5 * k * k * k * k * k;\r\n        }\r\n        return 0.5 * ( ( k -= 2 ) * k * k * k * k + 2 );\r\n    },\r\n\r\n    // sine\r\n    //  Easing equation function for a sinusoidal (sin(t))\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return: The correct value.\r\n\r\n    sineIn: function (k) { return 1 - Math.cos(k * Math.PI / 2); },\r\n    sineOut: function (k) { return Math.sin(k * Math.PI / 2); },\r\n    sineInOut: function (k) { return 0.5 * ( 1 - Math.cos(Math.PI * k) ); },\r\n\r\n    // expo\r\n    //  Easing equation function for an exponential (2^t)\r\n    //  param t: Current time (in frames or seconds).\r\n    //  return: The correct value.\r\n\r\n    expoIn: function (k) { return k === 0 ? 0 : Math.pow(1024, k - 1); },\r\n    expoOut: function (k) { return k === 1 ? 1 : 1 - Math.pow(2, -10 * k); },\r\n    expoInOut: function (k) {\r\n        if (k === 0) {\r\n            return 0;\r\n        }\r\n        if (k === 1) {\r\n            return 1;\r\n        }\r\n        if (( k *= 2 ) < 1) {\r\n            return 0.5 * Math.pow(1024, k - 1);\r\n        }\r\n        return 0.5 * ( -Math.pow(2, -10 * ( k - 1 )) + 2 );\r\n    },\r\n\r\n    // circ\r\n    //  Easing equation function for a circular (sqrt(1-t^2))\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return:\tThe correct value.\r\n\r\n    circIn: function (k) { return 1 - Math.sqrt(1 - k * k); },\r\n    circOut: function (k) { return Math.sqrt(1 - ( --k * k )); },\r\n    circInOut: function (k) {\r\n        if (( k *= 2 ) < 1) {\r\n            return -0.5 * ( Math.sqrt(1 - k * k) - 1);\r\n        }\r\n        return 0.5 * ( Math.sqrt(1 - ( k -= 2) * k) + 1);\r\n    },\r\n\r\n    // elastic\r\n    //  Easing equation function for an elastic (exponentially decaying sine wave)\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return: The correct value.\r\n    //  recommand value: elastic (t)\r\n\r\n    elasticIn: function (k) {\r\n        var s, a = 0.1, p = 0.4;\r\n        if (k === 0) {\r\n            return 0;\r\n        }\r\n        if (k === 1) {\r\n            return 1;\r\n        }\r\n        if (!a || a < 1) {\r\n            a = 1;\r\n            s = p / 4;\r\n        }\r\n        else {\r\n            s = p * Math.asin(1 / a) / ( 2 * Math.PI );\r\n        }\r\n        return -( a * Math.pow(2, 10 * ( k -= 1 )) * Math.sin(( k - s ) * ( 2 * Math.PI ) / p) );\r\n    },\r\n    elasticOut: function (k) {\r\n        var s, a = 0.1, p = 0.4;\r\n        if (k === 0) {\r\n            return 0;\r\n        }\r\n        if (k === 1) {\r\n            return 1;\r\n        }\r\n        if (!a || a < 1) {\r\n            a = 1;\r\n            s = p / 4;\r\n        }\r\n        else {\r\n            s = p * Math.asin(1 / a) / ( 2 * Math.PI );\r\n        }\r\n        return ( a * Math.pow(2, -10 * k) * Math.sin(( k - s ) * ( 2 * Math.PI ) / p) + 1 );\r\n    },\r\n    elasticInOut: function (k) {\r\n        var s, a = 0.1, p = 0.4;\r\n        if (k === 0) {\r\n            return 0;\r\n        }\r\n        if (k === 1) {\r\n            return 1;\r\n        }\r\n        if (!a || a < 1) {\r\n            a = 1;\r\n            s = p / 4;\r\n        }\r\n        else {\r\n            s = p * Math.asin(1 / a) / ( 2 * Math.PI );\r\n        }\r\n        if (( k *= 2 ) < 1) {\r\n            return -0.5 *\r\n                   ( a * Math.pow(2, 10 * ( k -= 1 )) * Math.sin(( k - s ) * ( 2 * Math.PI ) / p) );\r\n        }\r\n        return a * Math.pow(2, -10 * ( k -= 1 )) * Math.sin(( k - s ) * ( 2 * Math.PI ) / p) * 0.5 + 1;\r\n    },\r\n\r\n    // back\r\n    //  Easing equation function for a back (overshooting cubic easing: (s+1)*t^3 - s*t^2)\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return: The correct value.\r\n\r\n    backIn: function (k) {\r\n        var s = 1.70158;\r\n        return k * k * ( ( s + 1 ) * k - s );\r\n    },\r\n    backOut: function (k) {\r\n        var s = 1.70158;\r\n        return --k * k * ( ( s + 1 ) * k + s ) + 1;\r\n    },\r\n    backInOut: function (k) {\r\n        var s = 1.70158 * 1.525;\r\n        if (( k *= 2 ) < 1) {\r\n            return 0.5 * ( k * k * ( ( s + 1 ) * k - s ) );\r\n        }\r\n        return 0.5 * ( ( k -= 2 ) * k * ( ( s + 1 ) * k + s ) + 2 );\r\n    },\r\n\r\n    // bounce\r\n    //  Easing equation function for a bounce (exponentially decaying parabolic bounce)\r\n    //  @param t: Current time (in frames or seconds).\r\n    //  @return: The correct value.\r\n\r\n    bounceOut: function (k) {\r\n        if (k < ( 1 / 2.75 )) {\r\n            return 7.5625 * k * k;\r\n        }\r\n        else if (k < ( 2 / 2.75 )) {\r\n            return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\r\n        }\r\n        else if (k < ( 2.5 / 2.75 )) {\r\n            return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\r\n        }\r\n        else {\r\n            return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\r\n        }\r\n    },\r\n\r\n    // smooth\r\n    // t<=0: 0 | 0<t<1: 3*t^2 - 2*t^3 | t>=1: 1\r\n    smooth: function (t) {\r\n        if (t <= 0) {\r\n            return 0;\r\n        }\r\n        if (t >= 1) {\r\n            return 1;\r\n        }\r\n        return t * t * (3 - 2 * t);\r\n    },\r\n\r\n    // fade\r\n    // t<=0: 0 | 0<t<1: 6*t^5 - 15*t^4 + 10*t^3 | t>=1: 1\r\n    fade: function (t) {\r\n        if (t <= 0) {\r\n            return 0;\r\n        }\r\n        if (t >= 1) {\r\n            return 1;\r\n        }\r\n        return t * t * t * (t * (t * 6 - 15) + 10);\r\n    },\r\n};\r\n\r\nfunction _makeOutIn (fnIn, fnOut) {\r\n    return function (k) {\r\n        if (k < 0.5) {\r\n            return fnOut(k * 2) / 2;\r\n        }\r\n        return fnIn(2 * k - 1) / 2 + 0.5;\r\n    };\r\n}\r\nEasing.quadOutIn = _makeOutIn(Easing.quadIn, Easing.quadOut);\r\nEasing.cubicOutIn = _makeOutIn(Easing.cubicIn, Easing.cubicOut);\r\nEasing.quartOutIn = _makeOutIn(Easing.quartIn, Easing.quartOut);\r\nEasing.quintOutIn = _makeOutIn(Easing.quintIn, Easing.quintOut);\r\nEasing.sineOutIn = _makeOutIn(Easing.sineIn, Easing.sineOut);\r\nEasing.expoOutIn = _makeOutIn(Easing.expoIn, Easing.expoOut);\r\nEasing.circOutIn = _makeOutIn(Easing.circIn, Easing.circOut);\r\nEasing.backOutIn = _makeOutIn(Easing.backIn, Easing.backOut);\r\nEasing.backOutIn = _makeOutIn(Easing.backIn, Easing.backOut);\r\nEasing.bounceIn = function (k) { return 1 - Easing.bounceOut(1 - k); };\r\nEasing.bounceInOut = function (k) {\r\n    if (k < 0.5) {\r\n        return Easing.bounceIn(k * 2) * 0.5;\r\n    }\r\n    return Easing.bounceOut(k * 2 - 1) * 0.5 + 0.5;\r\n};\r\nEasing.bounceOutIn = _makeOutIn(Easing.bounceIn, Easing.bounceOut);\r\n\r\ncc.Easing = module.exports = Easing;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./bezier');\r\nrequire('./easing');\r\nrequire('./types');\r\nrequire('./motion-path-helper');\r\nrequire('./animation-curves');\r\nrequire('./animation-clip');\r\nrequire('./animation-manager');\r\nrequire('./animation-state');\r\nrequire('./animation-animator');\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar DynamicAnimCurve = require('./animation-curves').DynamicAnimCurve;\r\nvar computeRatioByType = require('./animation-curves').computeRatioByType;\r\n\r\nvar bezier = require('./bezier').bezier;\r\nvar binarySearch = require('../core/utils/binary-search').binarySearchEpsilon;\r\n\r\nvar v2 = cc.v2;\r\n\r\nfunction Curve (points) {\r\n    this.points = points || [];\r\n    this.beziers = [];\r\n    this.ratios = [];\r\n    this.progresses = [];\r\n\r\n    this.length = 0;\r\n\r\n    this.computeBeziers();\r\n}\r\nCurve.prototype.computeBeziers = function () {\r\n    this.beziers.length = 0;\r\n    this.ratios.length = 0;\r\n    this.progresses.length = 0;\r\n    this.length = 0;\r\n\r\n    var bezier;\r\n\r\n    for (var i = 1; i < this.points.length; i++) {\r\n        var startPoint = this.points[i - 1];\r\n        var endPoint = this.points[i];\r\n        bezier = new Bezier();\r\n        bezier.start = startPoint.pos;\r\n        bezier.startCtrlPoint = startPoint.out;\r\n        bezier.end = endPoint.pos;\r\n        bezier.endCtrlPoint = endPoint.in;\r\n        this.beziers.push(bezier);\r\n\r\n        this.length += bezier.getLength();\r\n    }\r\n\r\n    var current = 0;\r\n    for (var i = 0; i < this.beziers.length; i++) {\r\n        bezier = this.beziers[i];\r\n        this.ratios[i] = bezier.getLength() / this.length;\r\n        this.progresses[i] = current = current + this.ratios[i];\r\n    }\r\n\r\n    return this.beziers;\r\n};\r\n\r\nfunction Bezier () {\r\n    this.start = v2();\r\n    this.end = v2();\r\n    this.startCtrlPoint = v2(); // cp0, cp1\r\n    this.endCtrlPoint = v2();   // cp2, cp3\r\n}\r\n\r\n// Get point at relative position in curve according to arc length\r\n// - u [0 .. 1]\r\nBezier.prototype.getPointAt = function ( u ) {\r\n    var t = this.getUtoTmapping( u );\r\n    return this.getPoint( t );\r\n};\r\n\r\n\r\n// Get point at time t\r\n//  - t [0 .. 1]\r\nBezier.prototype.getPoint = function ( t ) {\r\n    var x = bezier(this.start.x, this.startCtrlPoint.x, this.endCtrlPoint.x, this.end.x, t);\r\n    var y = bezier(this.start.y, this.startCtrlPoint.y, this.endCtrlPoint.y, this.end.y, t);\r\n\r\n    return new v2(x, y);\r\n};\r\n\r\n// Get total curve arc length\r\nBezier.prototype.getLength = function () {\r\n\r\n    var lengths = this.getLengths();\r\n    return lengths[ lengths.length - 1 ];\r\n\r\n};\r\n\r\n// Get list of cumulative segment lengths\r\nBezier.prototype.getLengths = function ( divisions ) {\r\n\r\n    if ( ! divisions ) divisions = (this.__arcLengthDivisions) ? (this.__arcLengthDivisions): 200;\r\n\r\n    if ( this.cacheArcLengths\r\n        && ( this.cacheArcLengths.length === divisions + 1 )) {\r\n\r\n        //console.log( \"cached\", this.cacheArcLengths );\r\n        return this.cacheArcLengths;\r\n\r\n    }\r\n\r\n    var cache = [];\r\n    var current, last = this.getPoint( 0 ), vector = v2();\r\n    var p, sum = 0;\r\n\r\n    cache.push( 0 );\r\n\r\n    for ( p = 1; p <= divisions; p ++ ) {\r\n\r\n        current = this.getPoint ( p / divisions );\r\n        vector.x = last.x - current.x;\r\n        vector.y = last.y - current.y;\r\n        sum += vector.mag();\r\n        cache.push( sum );\r\n        last = current;\r\n\r\n    }\r\n\r\n    this.cacheArcLengths = cache;\r\n\r\n    return cache; // { sums: cache, sum:sum }; Sum is in the last element.\r\n};\r\n\r\nBezier.prototype.getUtoTmapping = function ( u, distance ) {\r\n\r\n    var arcLengths = this.getLengths();\r\n\r\n    var i = 0, il = arcLengths.length;\r\n\r\n    var targetArcLength; // The targeted u distance value to get\r\n\r\n    if ( distance ) {\r\n        targetArcLength = distance;\r\n    } else {\r\n        targetArcLength = u * arcLengths[ il - 1 ];\r\n    }\r\n\r\n    //var time = Date.now();\r\n\r\n    // binary search for the index with largest value smaller than target u distance\r\n\r\n    var low = 0, high = il - 1, comparison;\r\n\r\n    while ( low <= high ) {\r\n\r\n        i = Math.floor( low + ( high - low ) / 2 ); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\r\n\r\n        comparison = arcLengths[ i ] - targetArcLength;\r\n\r\n        if ( comparison < 0 ) {\r\n\r\n            low = i + 1;\r\n            continue;\r\n\r\n        } else if ( comparison > 0 ) {\r\n\r\n            high = i - 1;\r\n            continue;\r\n\r\n        } else {\r\n\r\n            high = i;\r\n            break;\r\n\r\n            // DONE\r\n\r\n        }\r\n\r\n    }\r\n\r\n    i = high;\r\n\r\n    //console.log('b' , i, low, high, Date.now()- time);\r\n\r\n    if ( arcLengths[ i ] === targetArcLength ) {\r\n\r\n        var t = i / ( il - 1 );\r\n        return t;\r\n\r\n    }\r\n\r\n    // we could get finer grain at lengths, or use simple interpolatation between two points\r\n\r\n    var lengthBefore = arcLengths[ i ];\r\n    var lengthAfter = arcLengths[ i + 1 ];\r\n\r\n    var segmentLength = lengthAfter - lengthBefore;\r\n\r\n    // determine where we are between the 'before' and 'after' points\r\n\r\n    var segmentFraction = ( targetArcLength - lengthBefore ) / segmentLength;\r\n\r\n    // add that fractional amount to t\r\n\r\n    var t = ( i + segmentFraction ) / ( il -1 );\r\n\r\n    return t;\r\n};\r\n\r\n\r\nfunction sampleMotionPaths (motionPaths, data, duration, fps) {\r\n\r\n    function createControlPoints(array) {\r\n        if (array instanceof cc.Vec2) {\r\n            return {\r\n                in: array,\r\n                pos: array,\r\n                out: array\r\n            };\r\n        }\r\n        else if (Array.isArray(array) && array.length === 6) {\r\n            return {\r\n                in: v2(array[2], array[3]),\r\n                pos: v2(array[0], array[1]),\r\n                out: v2(array[4], array[5])\r\n            };\r\n        }\r\n\r\n        return {\r\n            in: cc.Vec2.ZERO,\r\n            pos: cc.Vec2.ZERO,\r\n            out: cc.Vec2.ZERO\r\n        };\r\n    }\r\n\r\n    var values = data.values;\r\n\r\n    if (motionPaths.length === 0 || values.length === 0) {\r\n        return;\r\n    }\r\n\r\n    values = values.map(function (value) {\r\n        return v2(value[0], value[1]);\r\n    });\r\n\r\n    if (values.length === 1) {\r\n        data.values = values;\r\n        return;\r\n    }\r\n\r\n    var types = data.types;\r\n    var ratios = data.ratios;\r\n\r\n    var newValues = data.values = [];\r\n    var newTypes = data.types = [];\r\n    var newRatios = data.ratios = [];\r\n\r\n    function addNewDatas (value, type, ratio) {\r\n        newValues.push(value);\r\n        newTypes.push(type);\r\n        newRatios.push(ratio);\r\n    }\r\n\r\n    // ensure every ratio section's length is the same\r\n    var startRatioOffset = 0;\r\n\r\n    var EPSILON = 1e-6;\r\n    var newType = DynamicAnimCurve.Linear;\r\n\r\n    // do not need to compute last path\r\n    for (var i = 0, l = motionPaths.length; i < l-1; i++) {\r\n        var motionPath = motionPaths[i];\r\n\r\n        var ratio = ratios[i];\r\n        var nextRatio = ratios[i + 1];\r\n        var betweenRatio = nextRatio - ratio;\r\n\r\n        var value = values[i];\r\n        var nextValue = values[i + 1];\r\n\r\n        var type = types[i];\r\n\r\n        var results = [];\r\n        var progress = startRatioOffset / betweenRatio;\r\n        var speed = 1 / (betweenRatio * duration * fps);\r\n        var finalProgress;\r\n\r\n        if (motionPath && motionPath.length > 0) {\r\n            var points = [];\r\n            points.push(createControlPoints(value));\r\n\r\n            for (var j = 0, l2 = motionPath.length; j < l2; j++) {\r\n                var controlPoints = createControlPoints(motionPath[j]);\r\n                points.push(controlPoints);\r\n            }\r\n\r\n            points.push(createControlPoints(nextValue));\r\n\r\n            // create Curve to compute beziers\r\n            var curve = new Curve(points);\r\n            curve.computeBeziers();\r\n\r\n            // sample beziers\r\n            var progresses = curve.progresses;\r\n\r\n            while ( 1 - progress > EPSILON) {\r\n                finalProgress = progress;\r\n\r\n                finalProgress = computeRatioByType(finalProgress, type);\r\n\r\n                var pos, bezier, normal, length;\r\n\r\n                if (finalProgress < 0) {\r\n                    bezier = curve.beziers[0];\r\n                    length =  (0 - finalProgress) * bezier.getLength();\r\n                    normal = bezier.start.sub(bezier.endCtrlPoint).normalize();\r\n                    pos = bezier.start.add(normal.mul(length));\r\n                }\r\n                else if (finalProgress > 1) {\r\n                    bezier = curve.beziers[curve.beziers.length - 1];\r\n                    length =  (finalProgress - 1) * bezier.getLength();\r\n                    normal = bezier.end.sub(bezier.startCtrlPoint).normalize();\r\n                    pos = bezier.end.add(normal.mul(length));\r\n                }\r\n                else {\r\n                    var bezierIndex = binarySearch(progresses, finalProgress);\r\n                    if (bezierIndex < 0) bezierIndex = ~bezierIndex;\r\n\r\n                    finalProgress -= bezierIndex > 0 ? progresses[bezierIndex - 1] : 0;\r\n                    finalProgress = finalProgress / curve.ratios[bezierIndex];\r\n\r\n                    pos = curve.beziers[bezierIndex].getPointAt(finalProgress);\r\n                }\r\n\r\n                results.push(pos);\r\n                progress += speed;\r\n            }\r\n\r\n        }\r\n        else {\r\n            while ( 1 - progress > EPSILON) {\r\n                finalProgress = progress;\r\n\r\n                finalProgress = computeRatioByType(finalProgress, type);\r\n\r\n                results.push(value.lerp(nextValue, finalProgress));\r\n\r\n                progress += speed;\r\n            }\r\n        }\r\n\r\n        newType = type === 'constant' ? type : DynamicAnimCurve.Linear;\r\n\r\n        for (var j = 0, l2 = results.length; j < l2; j++) {\r\n            var newRatio = ratio + startRatioOffset + speed * j * betweenRatio;\r\n            addNewDatas(results[j], newType, newRatio);\r\n        }\r\n\r\n        if (Math.abs(progress - 1) > EPSILON) // progress > 1\r\n            startRatioOffset = (progress - 1) * betweenRatio;\r\n        else\r\n            startRatioOffset = 0;\r\n    }\r\n\r\n    if (ratios[ratios.length - 1] !== newRatios[newRatios.length -1]) {\r\n        addNewDatas(values[values.length - 1], newType, ratios[ratios.length - 1]);\r\n    }\r\n}\r\n\r\nif (CC_TEST) {\r\n    cc._Test.sampleMotionPaths = sampleMotionPaths;\r\n}\r\n\r\nmodule.exports = {\r\n    sampleMotionPaths: sampleMotionPaths,\r\n    Curve: Curve,\r\n    Bezier: Bezier\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = cc.js;\r\nconst debug = require('../core/CCDebug');\r\n\r\n/**\r\n * @class Playable\r\n *\r\n */\r\nfunction Playable () {\r\n    this._isPlaying = false;\r\n    this._isPaused = false;\r\n    this._stepOnce = false;\r\n}\r\n\r\nvar prototype = Playable.prototype;\r\n\r\n/**\r\n * !#en Is playing or paused in play mode?\r\n * !#zh \r\n * @property isPlaying\r\n * @type {boolean}\r\n * @default false\r\n * @readOnly\r\n */\r\njs.get(prototype, 'isPlaying', function () {\r\n    return this._isPlaying;\r\n}, true);\r\n\r\n/**\r\n * !#en Is currently paused? This can be true even if in edit mode(isPlaying == false).\r\n * !#zh \r\n * @property isPaused\r\n * @type {boolean}\r\n * @default false\r\n * @readOnly\r\n */\r\njs.get(prototype, 'isPaused', function () {\r\n    return this._isPaused;\r\n}, true);\r\n\r\n// virtual\r\n\r\nvar virtual = function () {};\r\n/**\r\n * @method onPlay\r\n * @private\r\n */\r\nprototype.onPlay = virtual;\r\n/**\r\n * @method onPause\r\n * @private\r\n */\r\nprototype.onPause = virtual;\r\n/**\r\n * @method onResume\r\n * @private\r\n */\r\nprototype.onResume = virtual;\r\n/**\r\n * @method onStop\r\n * @private\r\n */\r\nprototype.onStop = virtual;\r\n/**\r\n * @method onError\r\n * @param {string} errorCode\r\n * @private\r\n */\r\nprototype.onError = virtual;\r\n\r\n// public\r\n\r\n/**\r\n * !#en Play this animation.\r\n * !#zh \r\n * @method play\r\n */\r\nprototype.play = function () {\r\n    if (this._isPlaying) {\r\n        if (this._isPaused) {\r\n            this._isPaused = false;\r\n            this.onResume();\r\n        }\r\n        else {\r\n            this.onError(debug.getError(3912));\r\n        }\r\n    }\r\n    else {\r\n        this._isPlaying = true;\r\n        this.onPlay();\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Stop this animation.\r\n * !#zh \r\n * @method stop\r\n */\r\nprototype.stop = function () {\r\n    if (this._isPlaying) {\r\n        this._isPlaying = false;\r\n        this.onStop();\r\n\r\n        // need reset pause flag after onStop\r\n        this._isPaused = false;\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Pause this animation.\r\n * !#zh \r\n * @method pause\r\n */\r\nprototype.pause = function () {\r\n    if (this._isPlaying && !this._isPaused) {\r\n        this._isPaused = true;\r\n        this.onPause();\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Resume this animation.\r\n * !#zh \r\n * @method resume\r\n */\r\nprototype.resume = function () {\r\n    if (this._isPlaying && this._isPaused) {\r\n        this._isPaused = false;\r\n        this.onResume();\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Perform a single frame step.\r\n * !#zh \r\n * @method step\r\n */\r\nprototype.step = function () {\r\n    this.pause();\r\n    this._stepOnce = true;\r\n    if (!this._isPlaying) {\r\n        this.play();\r\n    }\r\n};\r\n\r\nmodule.exports = Playable;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar WrapModeMask = {\r\n    Loop: 1 << 1,\r\n    ShouldWrap: 1 << 2,\r\n    // Reserved: 1 << 3,\r\n    PingPong: 1 << 4 | 1 << 1 | 1 << 2,  // Loop, ShouldWrap\r\n    Reverse: 1 << 5 | 1 << 2,      // ShouldWrap\r\n};\r\n\r\n/**\r\n * !#en Specifies how time is treated when it is outside of the keyframe range of an Animation.\r\n * !#zh \r\n * @enum WrapMode\r\n * @memberof cc\r\n */\r\nvar WrapMode = cc.Enum({\r\n\r\n    /**\r\n     * !#en Reads the default wrap mode set higher up.\r\n     * !#zh  Animation Component  AnimationClip  wrapMode\r\n     * @property {Number} Default\r\n     */\r\n    Default: 0,\r\n\r\n    /**\r\n     * !#en All iterations are played as specified.\r\n     * !#zh \r\n     * @property {Number} Normal\r\n     */\r\n    Normal: 1,\r\n\r\n    /**\r\n     * !#en All iterations are played in the reverse direction from the way they are specified.\r\n     * !#zh \r\n     * @property {Number} Reverse\r\n     */\r\n    Reverse: WrapModeMask.Reverse,\r\n\r\n    /**\r\n     * !#en When time reaches the end of the animation, time will continue at the beginning.\r\n     * !#zh \r\n     * @property {Number} Loop\r\n     */\r\n    Loop: WrapModeMask.Loop,\r\n\r\n    /**\r\n     * !#en All iterations are played in the reverse direction from the way they are specified.\r\n     * And when time reaches the start of the animation, time will continue at the ending.\r\n     * !#zh \r\n     * @property {Number} LoopReverse\r\n     */\r\n    LoopReverse: WrapModeMask.Loop | WrapModeMask.Reverse,\r\n\r\n    /**\r\n     * !#en Even iterations are played as specified, odd iterations are played in the reverse direction from the way they\r\n     * are specified.\r\n     * !#zh \r\n     * @property {Number} PingPong\r\n     */\r\n    PingPong: WrapModeMask.PingPong,\r\n\r\n    /**\r\n     * !#en Even iterations are played in the reverse direction from the way they are specified, odd iterations are played\r\n     * as specified.\r\n     * !#zh  PingPong\r\n     * @property {Number} PingPongReverse\r\n     */\r\n    PingPongReverse: WrapModeMask.PingPong | WrapModeMask.Reverse\r\n});\r\n\r\ncc.WrapMode = WrapMode;\r\n\r\n// For internal\r\nfunction WrappedInfo (info) {\r\n    if (info) {\r\n        this.set(info);\r\n        return;\r\n    }\r\n\r\n    this.ratio = 0;\r\n    this.time = 0;\r\n    this.direction = 1;\r\n    this.stopped = true;\r\n    this.iterations = 0;\r\n    this.frameIndex = undefined;\r\n}\r\n\r\nWrappedInfo.prototype.set = function (info) {\r\n    this.ratio = info.ratio;\r\n    this.time = info.time;\r\n    this.direction = info.direction;\r\n    this.stopped = info.stopped;\r\n    this.iterations = info.iterations;\r\n    this.frameIndex = info.frameIndex;\r\n};\r\n\r\nmodule.exports = {\r\n    WrapModeMask,\r\n    WrapMode,\r\n    WrappedInfo\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst EventTarget = require('../core/event/event-target');\r\nconst sys = require('../core/platform/CCSys');\r\nconst LoadMode = require('../core/assets/CCAudioClip').LoadMode;\r\n\r\nlet touchBinded = false;\r\nlet touchPlayList = [\r\n    //{ instance: Audio, offset: 0, audio: audio }\r\n];\r\n\r\nlet Audio = function (src) {\r\n    EventTarget.call(this);\r\n\r\n    this._src = src;\r\n    this._element = null;\r\n    this.id = 0;\r\n\r\n    this._volume = 1;\r\n    this._loop = false;\r\n    this._nextTime = 0;  // playback position to set\r\n\r\n    this._state = Audio.State.INITIALZING;\r\n\r\n    this._onended = function () {\r\n        this.emit('ended');\r\n    }.bind(this);\r\n};\r\n\r\ncc.js.extend(Audio, EventTarget);\r\n\r\n/**\r\n * !#en Audio state.\r\n * !#zh \r\n * @enum audioEngine.AudioState\r\n * @memberof cc\r\n */\r\n// TODO - At present, the state is mixed with two states of users and systems, and it is best to split into two types. A \"loading\" should also be added to the system state.\r\nAudio.State = {\r\n    /**\r\n     * @property {Number} ERROR\r\n     */\r\n    ERROR : -1,\r\n    /**\r\n     * @property {Number} INITIALZING\r\n     */\r\n    INITIALZING: 0,\r\n    /**\r\n     * @property {Number} PLAYING\r\n     */\r\n    PLAYING: 1,\r\n    /**\r\n     * @property {Number} PAUSED\r\n     */\r\n    PAUSED: 2,\r\n    /**\r\n     * @property {Number} STOPPED\r\n     */\r\n    STOPPED: 3,\r\n};\r\n\r\n(function (proto) {\r\n\r\n    proto._bindEnded = function (callback) {\r\n        callback = callback || this._onended;\r\n        let elem = this._element;\r\n        if (this._src && (elem instanceof HTMLAudioElement)) {\r\n            elem.addEventListener('ended', callback);\r\n        } else {\r\n            elem.onended = callback;\r\n        }\r\n    };\r\n\r\n    proto._unbindEnded = function () {\r\n        let elem = this._element;\r\n        if (elem instanceof HTMLAudioElement) {\r\n            elem.removeEventListener('ended', this._onended);\r\n        } else if (elem) {\r\n            elem.onended = null;\r\n        }\r\n    };\r\n\r\n    // proto.mount = function (elem) {\r\n    //     if (CC_DEBUG) {\r\n    //         cc.warn('Audio.mount(value) is deprecated. Please use Audio._onLoaded().');\r\n    //     }\r\n    // };\r\n\r\n    proto._onLoaded = function () {\r\n        let elem = this._src._nativeAsset;\r\n        if (elem instanceof HTMLAudioElement) {\r\n            // Reuse dom audio element\r\n            if (!this._element) {\r\n                this._element = document.createElement('audio');\r\n            }\r\n            this._element.src = elem.src;\r\n        }\r\n        else {\r\n            this._element = new WebAudioElement(elem, this);\r\n        }\r\n\r\n        this.setVolume(this._volume);\r\n        this.setLoop(this._loop);\r\n        if (this._nextTime !== 0) {\r\n            this.setCurrentTime(this._nextTime);\r\n        }\r\n        if (this._state === Audio.State.PLAYING) {\r\n            this.play();\r\n        }\r\n        else {\r\n            this._state = Audio.State.INITIALZING;\r\n        }\r\n    };\r\n\r\n    proto.play = function () {\r\n        // marked as playing so it will playOnLoad\r\n        this._state = Audio.State.PLAYING;\r\n\r\n        if (!this._element) {\r\n            return;\r\n        }\r\n\r\n        this._bindEnded();\r\n        this._element.play();\r\n\r\n        if (!CC_QQPLAY && !CC_WECHATGAME) {\r\n            if (this._src && this._src.loadMode === LoadMode.DOM_AUDIO &&\r\n                this._element.paused) {\r\n                touchPlayList.push({ instance: this, offset: 0, audio: this._element });\r\n            }\r\n\r\n            if (touchBinded) return;\r\n            touchBinded = true;\r\n\r\n            // Listen to the touchstart body event and play the audio when necessary.\r\n            cc.game.canvas.addEventListener('touchstart', function () {\r\n                let item;\r\n                while (item = touchPlayList.pop()) {\r\n                    item.audio.play(item.offset);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    proto.destroy = function () {\r\n        if (CC_WECHATGAME || CC_QQPLAY) {\r\n            this._element && this._element.destroy();\r\n        }\r\n        this._element = null;\r\n    };\r\n\r\n    proto.pause = function () {\r\n        if (!this._element || this._state !== Audio.State.PLAYING) return;\r\n        this._unbindEnded();\r\n        this._element.pause();\r\n        this._state = Audio.State.PAUSED;\r\n    };\r\n\r\n    proto.resume = function () {\r\n        if (!this._element || this._state !== Audio.State.PAUSED) return;\r\n        this._bindEnded();\r\n        this._element.play();\r\n        this._state = Audio.State.PLAYING;\r\n    };\r\n\r\n    proto.stop = function () {\r\n        if (!this._element) return;\r\n        this._element.pause();\r\n        try {\r\n            this._element.currentTime = 0;\r\n        } catch (error) {}\r\n        // remove touchPlayList\r\n        for (let i = 0; i < touchPlayList.length; i++) {\r\n            if (touchPlayList[i].instance === this) {\r\n                touchPlayList.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n        this._unbindEnded();\r\n        this.emit('stop');\r\n        this._state = Audio.State.STOPPED;\r\n    };\r\n\r\n    proto.setLoop = function (loop) {\r\n        this._loop = loop;\r\n        if (this._element) {\r\n            this._element.loop = loop;\r\n        }\r\n    };\r\n    proto.getLoop = function () {\r\n        return this._loop;\r\n    };\r\n\r\n    proto.setVolume = function (num) {\r\n        this._volume = num;\r\n        if (this._element) {\r\n            this._element.volume = num;\r\n        }\r\n    };\r\n    proto.getVolume = function () {\r\n        return this._volume;\r\n    };\r\n\r\n    proto.setCurrentTime = function (num) {\r\n        if (this._element) {\r\n            this._nextTime = 0;\r\n        }\r\n        else {\r\n            this._nextTime = num;\r\n            return;\r\n        }\r\n\r\n        if (!(CC_QQPLAY || CC_WECHATGAME)) {\r\n            this._unbindEnded();\r\n            this._bindEnded(function () {\r\n                this._bindEnded();\r\n            }.bind(this));\r\n        }\r\n        try {\r\n            this._element.currentTime = num;\r\n        }\r\n        catch (err) {\r\n            let _element = this._element;\r\n            if (_element.addEventListener) {\r\n                let func = function () {\r\n                    _element.removeEventListener('loadedmetadata', func);\r\n                    _element.currentTime = num;\r\n                };\r\n                _element.addEventListener('loadedmetadata', func);\r\n            }\r\n        }\r\n    };\r\n    proto.getCurrentTime = function () {\r\n        return this._element ? this._element.currentTime : 0;\r\n    };\r\n\r\n    proto.getDuration = function () {\r\n        return this._element ? this._element.duration : 0;\r\n    };\r\n\r\n    proto.getState = function () {\r\n        if (!CC_WECHATGAME && !CC_QQPLAY) {\r\n            let elem = this._element;\r\n            if (elem && Audio.State.PLAYING === this._state && elem.paused) {\r\n                this._state = Audio.State.PAUSED;\r\n            }\r\n        }\r\n        return this._state;\r\n    };\r\n\r\n    proto.__defineGetter__('src', function () {\r\n        return this._src;\r\n    });\r\n    proto.__defineSetter__('src', function (clip) {\r\n        this._unbindEnded();\r\n        if (clip) {\r\n            this._src = clip;\r\n            if (clip.loaded) {\r\n                this._onLoaded();\r\n            }\r\n            else {\r\n                let self = this;\r\n                clip.once('load', function () {\r\n                    if (clip === self._src) {\r\n                        self._onLoaded();\r\n                    }\r\n                });\r\n                cc.loader.load({\r\n                    url: clip.nativeUrl,\r\n                    // For audio, we should skip loader otherwise it will load a new audioClip.\r\n                    skips: ['Loader'],\r\n                },\r\n                function (err, audioNativeAsset) {\r\n                    if (err) {\r\n                        cc.error(err);\r\n                        return;\r\n                    }\r\n                    if (!clip.loaded) {\r\n                        clip._nativeAsset = audioNativeAsset;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this._src = null;\r\n            if (this._element instanceof HTMLAudioElement) {\r\n                this._element.src = '';\r\n            }\r\n            else {\r\n                this._element = null;\r\n            }\r\n            this._state = Audio.State.INITIALZING;\r\n        }\r\n        return clip;\r\n    });\r\n\r\n    proto.__defineGetter__('paused', function () {\r\n        return this._element ? this._element.paused : true;\r\n    });\r\n\r\n    // setFinishCallback\r\n\r\n})(Audio.prototype);\r\n\r\n// Encapsulated WebAudio interface\r\nlet WebAudioElement = function (buffer, audio) {\r\n    this._audio = audio;\r\n    this._context = sys.__audioSupport.context;\r\n    this._buffer = buffer;\r\n\r\n    this._gainObj = this._context['createGain']();\r\n    this._volume = 1;\r\n    // https://www.chromestatus.com/features/5287995770929152\r\n    if (this._gainObj['gain'].setTargetAtTime) {\r\n        this._gainObj['gain'].setTargetAtTime(this._volume, this._context.currentTime, 0.01);\r\n    } else {\r\n        this._gainObj['gain'].value = 1;\r\n    }\r\n    this._gainObj['connect'](this._context['destination']);\r\n\r\n    this._loop = false;\r\n    // The time stamp on the audio time axis when the recording begins to play.\r\n    this._startTime = -1;\r\n    // Record the currently playing 'Source'\r\n    this._currentSource = null;\r\n    // Record the time has been played\r\n    this.playedLength = 0;\r\n\r\n    this._currextTimer = null;\r\n\r\n    this._endCallback = function () {\r\n        if (this.onended) {\r\n            this.onended(this);\r\n        }\r\n    }.bind(this);\r\n};\r\n\r\n(function (proto) {\r\n    proto.play = function (offset) {\r\n        // If repeat play, you need to stop before an audio\r\n        if (this._currentSource && !this.paused) {\r\n            this._currentSource.onended = null;\r\n            this._currentSource.stop(0);\r\n            this.playedLength = 0;\r\n        }\r\n\r\n        let audio = this._context[\"createBufferSource\"]();\r\n        audio.buffer = this._buffer;\r\n        audio[\"connect\"](this._gainObj);\r\n        audio.loop = this._loop;\r\n\r\n        this._startTime = this._context.currentTime;\r\n        offset = offset || this.playedLength;\r\n        if (offset) {\r\n            this._startTime -= offset;\r\n        }\r\n        let duration = this._buffer.duration;\r\n\r\n        let startTime = offset;\r\n        let endTime;\r\n        if (this._loop) {\r\n            if (audio.start)\r\n                audio.start(0, startTime);\r\n            else if (audio[\"notoGrainOn\"])\r\n                audio[\"noteGrainOn\"](0, startTime);\r\n            else\r\n                audio[\"noteOn\"](0, startTime);\r\n        } else {\r\n            endTime = duration - offset;\r\n            if (audio.start)\r\n                audio.start(0, startTime, endTime);\r\n            else if (audio[\"notoGrainOn\"])\r\n                audio[\"noteGrainOn\"](0, startTime, endTime);\r\n            else\r\n                audio[\"noteOn\"](0, startTime, endTime);\r\n        }\r\n\r\n        this._currentSource = audio;\r\n\r\n        audio.onended = this._endCallback;\r\n\r\n        // If the current audio context time stamp is 0 and audio context state is suspended\r\n        // There may be a need to touch events before you can actually start playing audio\r\n        if ((!audio.context.state || audio.context.state === \"suspended\") && this._context.currentTime === 0) {\r\n            let self = this;\r\n            clearTimeout(this._currextTimer);\r\n            this._currextTimer = setTimeout(function () {\r\n                if (!(CC_QQPLAY || CC_WECHATGAME) && self._context.currentTime === 0) {\r\n                    touchPlayList.push({\r\n                        instance: self._audio,\r\n                        offset: offset,\r\n                        audio: self\r\n                    });\r\n                }\r\n            }, 10);\r\n        }\r\n    };\r\n\r\n    proto.pause = function () {\r\n        clearTimeout(this._currextTimer);\r\n        if (this.paused) return;\r\n        // Record the time the current has been played\r\n        this.playedLength = this._context.currentTime - this._startTime;\r\n        // If more than the duration of the audio, Need to take the remainder\r\n        this.playedLength %= this._buffer.duration;\r\n        let audio = this._currentSource;\r\n        this._currentSource = null;\r\n        this._startTime = -1;\r\n        if (audio)\r\n            audio.stop(0);\r\n    };\r\n\r\n    proto.__defineGetter__('paused', function () {\r\n        // If the current audio is a loop, paused is false\r\n        if (this._currentSource && this._currentSource.loop)\r\n            return false;\r\n\r\n        // startTime default is -1\r\n        if (this._startTime === -1)\r\n            return true;\r\n\r\n        // Current time -  Start playing time > Audio duration\r\n        return this._context.currentTime - this._startTime > this._buffer.duration;\r\n    });\r\n\r\n    proto.__defineGetter__('loop', function () { return this._loop; });\r\n    proto.__defineSetter__('loop', function (bool) {\r\n        if (this._currentSource)\r\n            this._currentSource.loop = bool;\r\n\r\n        return this._loop = bool;\r\n    });\r\n\r\n    proto.__defineGetter__('volume', function () {\r\n        return this._volume;\r\n    });\r\n    proto.__defineSetter__('volume', function (num) {\r\n        this._volume = num;\r\n        if (this._gainObj['gain'].setTargetAtTime) {\r\n            this._gainObj['gain'].setTargetAtTime(this._volume, this._context.currentTime, 0.01);\r\n        } else {\r\n            this._volume['gain'].value = num;\r\n        }\r\n        if (sys.os === sys.OS_IOS && !this.paused && this._currentSource) {\r\n            // IOS must be stop webAudio\r\n            this._currentSource.onended = null;\r\n            this.pause();\r\n            this.play();\r\n        }\r\n        return num;\r\n    });\r\n\r\n    proto.__defineGetter__('currentTime', function () {\r\n        if (this.paused) {\r\n            return this.playedLength;\r\n        }\r\n        // Record the time the current has been played\r\n        this.playedLength = this._context.currentTime - this._startTime;\r\n        // If more than the duration of the audio, Need to take the remainder\r\n        this.playedLength %= this._buffer.duration;\r\n        return this.playedLength;\r\n    });\r\n    proto.__defineSetter__('currentTime', function (num) {\r\n        if (!this.paused) {\r\n            this.pause();\r\n            this.playedLength = num;\r\n            this.play();\r\n        } else {\r\n            this.playedLength = num;\r\n        }\r\n        return num;\r\n    });\r\n\r\n    proto.__defineGetter__('duration', function () {\r\n        return this._buffer.duration;\r\n    });\r\n\r\n})(WebAudioElement.prototype);\r\n\r\nmodule.exports = cc.Audio = Audio;\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Audio = require('./CCAudio');\r\nconst AudioClip = require('../core/assets/CCAudioClip');\r\nconst js = cc.js;\r\n\r\nlet _instanceId = 0;\r\nlet _id2audio = js.createMap(true);\r\nlet _url2id = {};\r\nlet _audioPool = [];\r\n\r\nlet recycleAudio = function (audio) {\r\n    audio._finishCallback = null;\r\n    if (_audioPool.length < 32) {\r\n        audio.off('ended');\r\n        audio.off('stop');\r\n        audio.src = null;\r\n        _audioPool.push(audio);\r\n    }\r\n    else {\r\n        audio.destroy();\r\n    }\r\n};\r\n\r\nlet getAudioFromPath = function (path) {\r\n    var id = _instanceId++;\r\n    var list = _url2id[path];\r\n    if (!list) {\r\n        list = _url2id[path] = [];\r\n    }\r\n    if (audioEngine._maxAudioInstance <= list.length) {\r\n        var oldId = list.shift();\r\n        var oldAudio = getAudioFromId(oldId);\r\n        // Stop will recycle audio automatically by event callback\r\n        oldAudio.stop();\r\n    }\r\n\r\n    var audio = _audioPool.pop() || new Audio();\r\n    var callback = function () {\r\n        var audioInList = getAudioFromId(this.id);\r\n        if (audioInList) {\r\n            delete _id2audio[this.id];\r\n            var index = list.indexOf(this.id);\r\n            cc.js.array.fastRemoveAt(list, index);\r\n        }\r\n        recycleAudio(this);\r\n    };\r\n\r\n    audio.on('ended', function () {\r\n        if (this._finishCallback) {\r\n            this._finishCallback();\r\n        }\r\n        callback.call(this);\r\n    }, audio);\r\n\r\n    audio.on('stop', callback, audio);\r\n    audio.id = id;\r\n    _id2audio[id] = audio;\r\n    list.push(id);\r\n\r\n    return audio;\r\n};\r\n\r\nlet getAudioFromId = function (id) {\r\n    return _id2audio[id];\r\n};\r\n\r\nlet handleVolume  = function (volume) {\r\n    if (!volume) {\r\n        // set default volume as 1\r\n        volume = 1;\r\n    }\r\n    else if (typeof volume === 'string') {\r\n        volume = Number.parseFloat(volume);\r\n    }\r\n    return volume;\r\n};\r\n\r\n/**\r\n * !#en cc.audioEngine is the singleton object, it provide simple audio APIs.\r\n * !#zh\r\n * cc.audioengine<br/>\r\n *  audioID audioID <br/>\r\n *  cc.audioEngine.uncache(filePath);  <br/>\r\n * <br/>\r\n *  Android <br/>\r\n *  WebAudio<br/>\r\n * \r\n * @class audioEngine\r\n * @static\r\n */\r\nvar audioEngine = {\r\n\r\n    AudioState: Audio.State,\r\n\r\n    _maxWebAudioSize: 2097152, // 2048kb * 1024\r\n    _maxAudioInstance: 24,\r\n\r\n    _id2audio: _id2audio,\r\n\r\n    /**\r\n     * !#en Play audio.\r\n     * !#zh \r\n     * @method play\r\n     * @param {AudioClip} clip - The audio clip to play.\r\n     * @param {Boolean} loop - Whether the music loop or not.\r\n     * @param {Number} volume - Volume size.\r\n     * @return {Number} audioId\r\n     * @example\r\n     * cc.loader.loadRes(url, cc.AudioClip, function (err, clip) {\r\n     *     var audioID = cc.audioEngine.play(clip, false, 0.5);\r\n     * });\r\n     */\r\n    play: function (clip, loop, volume/*, profile*/) {\r\n        var path = clip;\r\n        var audio;\r\n        if (typeof clip === 'string') {\r\n            // backward compatibility since 1.10\r\n            cc.warnID(8401, 'cc.audioEngine', 'cc.AudioClip', 'AudioClip', 'cc.AudioClip', 'audio');\r\n            path = clip;\r\n            // load clip\r\n            audio = getAudioFromPath(path);\r\n            AudioClip._loadByUrl(path, function (err, clip) {\r\n                if (clip) {\r\n                    audio.src = clip;\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            if (!clip) {\r\n                return;\r\n            }\r\n            path = clip.nativeUrl;\r\n            audio = getAudioFromPath(path);\r\n            audio.src = clip;\r\n        }\r\n\r\n        audio.setLoop(loop || false);\r\n        volume = handleVolume(volume);\r\n        audio.setVolume(volume);\r\n        audio.play();\r\n\r\n        return audio.id;\r\n    },\r\n\r\n    /**\r\n     * !#en Set audio loop.\r\n     * !#zh \r\n     * @method setLoop\r\n     * @param {Number} audioID - audio id.\r\n     * @param {Boolean} loop - Whether cycle.\r\n     * @example\r\n     * cc.audioEngine.setLoop(id, true);\r\n     */\r\n    setLoop: function (audioID, loop) {\r\n        var audio = getAudioFromId(audioID);\r\n        if (!audio || !audio.setLoop)\r\n            return;\r\n        audio.setLoop(loop);\r\n    },\r\n\r\n    /**\r\n     * !#en Get audio cycle state.\r\n     * !#zh \r\n     * @method isLoop\r\n     * @param {Number} audioID - audio id.\r\n     * @return {Boolean} Whether cycle.\r\n     * @example\r\n     * cc.audioEngine.isLoop(id);\r\n     */\r\n    isLoop: function (audioID) {\r\n        var audio = getAudioFromId(audioID);\r\n        if (!audio || !audio.getLoop)\r\n            return false;\r\n        return audio.getLoop();\r\n    },\r\n\r\n    /**\r\n     * !#en Set the volume of audio.\r\n     * !#zh 0.0 ~ 1.0\r\n     * @method setVolume\r\n     * @param {Number} audioID - audio id.\r\n     * @param {Number} volume - Volume must be in 0.0~1.0 .\r\n     * @example\r\n     * cc.audioEngine.setVolume(id, 0.5);\r\n     */\r\n    setVolume: function (audioID, volume) {\r\n        var audio = getAudioFromId(audioID);\r\n        if (audio) {\r\n            audio.setVolume(volume);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en The volume of the music max value is 1.0,the min value is 0.0 .\r\n     * !#zh 0.0 ~ 1.0\r\n     * @method getVolume\r\n     * @param {Number} audioID - audio id.\r\n     * @return {Number}\r\n     * @example\r\n     * var volume = cc.audioEngine.getVolume(id);\r\n     */\r\n    getVolume: function (audioID) {\r\n        var audio = getAudioFromId(audioID);\r\n        return audio ? audio.getVolume() : 1;\r\n    },\r\n\r\n    /**\r\n     * !#en Set current time\r\n     * !#zh \r\n     * @method setCurrentTime\r\n     * @param {Number} audioID - audio id.\r\n     * @param {Number} sec - current time.\r\n     * @return {Boolean}\r\n     * @example\r\n     * cc.audioEngine.setCurrentTime(id, 2);\r\n     */\r\n    setCurrentTime: function (audioID, sec) {\r\n        var audio = getAudioFromId(audioID);\r\n        if (audio) {\r\n            audio.setCurrentTime(sec);\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Get current time\r\n     * !#zh \r\n     * @method getCurrentTime\r\n     * @param {Number} audioID - audio id.\r\n     * @return {Number} audio current time.\r\n     * @example\r\n     * var time = cc.audioEngine.getCurrentTime(id);\r\n     */\r\n    getCurrentTime: function (audioID) {\r\n        var audio = getAudioFromId(audioID);\r\n        return audio ? audio.getCurrentTime() : 0;\r\n    },\r\n\r\n    /**\r\n     * !#en Get audio duration\r\n     * !#zh \r\n     * @method getDuration\r\n     * @param {Number} audioID - audio id.\r\n     * @return {Number} audio duration.\r\n     * @example\r\n     * var time = cc.audioEngine.getDuration(id);\r\n     */\r\n    getDuration: function (audioID) {\r\n        var audio = getAudioFromId(audioID);\r\n        return audio ? audio.getDuration() : 0;\r\n    },\r\n\r\n    /**\r\n     * !#en Get audio state\r\n     * !#zh \r\n     * @method getState\r\n     * @param {Number} audioID - audio id.\r\n     * @return {audioEngine.AudioState} audio duration.\r\n     * @example\r\n     * var state = cc.audioEngine.getState(id);\r\n     */\r\n    getState: function (audioID) {\r\n        var audio = getAudioFromId(audioID);\r\n        return audio ? audio.getState() : this.AudioState.ERROR;\r\n    },\r\n\r\n    /**\r\n     * !#en Set Audio finish callback\r\n     * !#zh \r\n     * @method setFinishCallback\r\n     * @param {Number} audioID - audio id.\r\n     * @param {Function} callback - loaded callback.\r\n     * @example\r\n     * cc.audioEngine.setFinishCallback(id, function () {});\r\n     */\r\n    setFinishCallback: function (audioID, callback) {\r\n        var audio = getAudioFromId(audioID);\r\n        if (!audio)\r\n            return;\r\n        audio._finishCallback = callback;\r\n    },\r\n\r\n    /**\r\n     * !#en Pause playing audio.\r\n     * !#zh \r\n     * @method pause\r\n     * @param {Number} audioID - The return value of function play.\r\n     * @example\r\n     * cc.audioEngine.pause(audioID);\r\n     */\r\n    pause: function (audioID) {\r\n        var audio = getAudioFromId(audioID);\r\n        if (audio) {\r\n            audio.pause();\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    },\r\n\r\n    _pauseIDCache: [],\r\n    /**\r\n     * !#en Pause all playing audio\r\n     * !#zh \r\n     * @method pauseAll\r\n     * @example\r\n     * cc.audioEngine.pauseAll();\r\n     */\r\n    pauseAll: function () {\r\n        for (var id in _id2audio) {\r\n            var audio = _id2audio[id];\r\n            var state = audio.getState();\r\n            if (state === Audio.State.PLAYING) {\r\n                this._pauseIDCache.push(id);\r\n                audio.pause();\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Resume playing audio.\r\n     * !#zh \r\n     * @method resume\r\n     * @param {Number} audioID - The return value of function play.\r\n     * @example\r\n     * cc.audioEngine.resume(audioID);\r\n     */\r\n    resume: function (audioID) {\r\n        var audio = getAudioFromId(audioID);\r\n        if (audio) {\r\n            audio.resume();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Resume all playing audio.\r\n     * !#zh \r\n     * @method resumeAll\r\n     * @example\r\n     * cc.audioEngine.resumeAll();\r\n     */\r\n    resumeAll: function () {\r\n        for (var i = 0; i < this._pauseIDCache.length; ++i) {\r\n            var id = this._pauseIDCache[i];\r\n            var audio = getAudioFromId(id);\r\n            if (audio)\r\n                audio.resume();\r\n        }\r\n        this._pauseIDCache.length = 0;\r\n    },\r\n\r\n    /**\r\n     * !#en Stop playing audio.\r\n     * !#zh \r\n     * @method stop\r\n     * @param {Number} audioID - The return value of function play.\r\n     * @example\r\n     * cc.audioEngine.stop(audioID);\r\n     */\r\n    stop: function (audioID) {\r\n        var audio = getAudioFromId(audioID);\r\n        if (audio) {\r\n            // Stop will recycle audio automatically by event callback\r\n            audio.stop();\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Stop all playing audio.\r\n     * !#zh \r\n     * @method stopAll\r\n     * @example\r\n     * cc.audioEngine.stopAll();\r\n     */\r\n    stopAll: function () {\r\n        for (var id in _id2audio) {\r\n            var audio = _id2audio[id];\r\n            if (audio) {\r\n                // Stop will recycle audio automatically by event callback\r\n                audio.stop();\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Set up an audio can generate a few examples.\r\n     * !#zh \r\n     * @method setMaxAudioInstance\r\n     * @param {Number} num - a number of instances to be created from within an audio\r\n     * @example\r\n     * cc.audioEngine.setMaxAudioInstance(20);\r\n     */\r\n    setMaxAudioInstance: function (num) {\r\n        this._maxAudioInstance = num;\r\n    },\r\n\r\n    /**\r\n     * !#en Getting audio can produce several examples.\r\n     * !#zh \r\n     * @method getMaxAudioInstance\r\n     * @return {Number} a - number of instances to be created from within an audio\r\n     * @example\r\n     * cc.audioEngine.getMaxAudioInstance();\r\n     */\r\n    getMaxAudioInstance: function () {\r\n        return this._maxAudioInstance;\r\n    },\r\n\r\n    /**\r\n     * !#en Unload the preloaded audio from internal buffer.\r\n     * !#zh \r\n     * @method uncache\r\n     * @param {AudioClip} clip\r\n     * @example\r\n     * cc.audioEngine.uncache(filePath);\r\n     */\r\n    uncache: function (clip) {\r\n        var filePath = clip;\r\n        if (typeof clip === 'string') {\r\n            // backward compatibility since 1.10\r\n            cc.warnID(8401, 'cc.audioEngine', 'cc.AudioClip', 'AudioClip', 'cc.AudioClip', 'audio');\r\n            filePath = clip;\r\n        }\r\n        else {\r\n            if (!clip) {\r\n                return;\r\n            }\r\n            filePath = clip.nativeUrl;\r\n        }\r\n\r\n        var list = _url2id[filePath];\r\n        if (!list) return;\r\n        while (list.length > 0) {\r\n            var id = list.pop();\r\n            var audio = _id2audio[id];\r\n            if (audio) {\r\n                // Stop will recycle audio automatically by event callback\r\n                audio.stop();\r\n                delete _id2audio[id];\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Unload all audio from internal buffer.\r\n     * !#zh \r\n     * @method uncacheAll\r\n     * @example\r\n     * cc.audioEngine.uncacheAll();\r\n     */\r\n    uncacheAll: function () {\r\n        this.stopAll();\r\n        let audio;\r\n        for (let id in _id2audio) {\r\n            audio = _id2audio[id];\r\n            if (audio) {\r\n                audio.destroy();\r\n            }\r\n        }\r\n        while (audio = _audioPool.pop()) {\r\n            audio.destroy();\r\n        }\r\n        _id2audio = js.createMap(true);\r\n        _url2id = {};\r\n    },\r\n\r\n    /**\r\n     * !#en Gets an audio profile by name.\r\n     *\r\n     * @param profileName A name of audio profile.\r\n     * @return The audio profile.\r\n     */\r\n    getProfile: function (profileName) {},\r\n\r\n    /**\r\n     * !#en Preload audio file.\r\n     * !#zh \r\n     * @method preload\r\n     * @param {String} filePath - The file path of an audio.\r\n     * @param {Function} [callback] - The callback of an audio.\r\n     * @example\r\n     * cc.audioEngine.preload(path);\r\n     * @deprecated `cc.audioEngine.preload` is deprecated, use `cc.loader.loadRes(url, cc.AudioClip)` instead please.\r\n     */\r\n    preload: function (filePath, callback) {\r\n        if (CC_DEBUG) {\r\n            cc.warn('`cc.audioEngine.preload` is deprecated, use `cc.loader.loadRes(url, cc.AudioClip)` instead please.');\r\n        }\r\n\r\n        cc.loader.load(filePath, callback && function (error) {\r\n            if (!error) {\r\n                callback();\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * !#en Set a size, the unit is KB. Over this size is directly resolved into DOM nodes.\r\n     * !#zh  KB  dom \r\n     * @method setMaxWebAudioSize\r\n     * @param {Number} kb - The file path of an audio.\r\n     * @example\r\n     * cc.audioEngine.setMaxWebAudioSize(300);\r\n     */\r\n    // Because webAudio takes up too much memorySo allow users to manually choose\r\n    setMaxWebAudioSize: function (kb) {\r\n        this._maxWebAudioSize = kb * 1024;\r\n    },\r\n\r\n    _breakCache: null,\r\n    _break: function () {\r\n        this._breakCache = [];\r\n        for (var id in _id2audio) {\r\n            var audio = _id2audio[id];\r\n            var state = audio.getState();\r\n            if (state === Audio.State.PLAYING) {\r\n                this._breakCache.push(id);\r\n                audio.pause();\r\n            }\r\n        }\r\n    },\r\n\r\n    _restore: function () {\r\n        if (!this._breakCache) return;\r\n\r\n        while (this._breakCache.length > 0) {\r\n            var id = this._breakCache.pop();\r\n            var audio = getAudioFromId(id);\r\n            if (audio && audio.resume)\r\n                audio.resume();\r\n        }\r\n        this._breakCache = null;\r\n    },\r\n\r\n    ///////////////////////////////\r\n    // Classification of interface\r\n\r\n    _music: {\r\n        id: -1,\r\n        loop: false,\r\n        volume: 1,\r\n    },\r\n\r\n    _effect: {\r\n        volume: 1,\r\n        pauseCache: [],\r\n    },\r\n\r\n    /**\r\n     * !#en Play background music\r\n     * !#zh \r\n     * @method playMusic\r\n     * @param {AudioClip} clip - The audio clip to play.\r\n     * @param {Boolean} loop - Whether the music loop or not.\r\n     * @return {Number} audioId\r\n     * @example\r\n     * cc.loader.loadRes(url, cc.AudioClip, function (err, clip) {\r\n     *     var audioID = cc.audioEngine.playMusic(clip, false);\r\n     * });\r\n     */\r\n    playMusic: function (clip, loop) {\r\n        var music = this._music;\r\n        this.stop(music.id);\r\n        music.id = this.play(clip, loop, music.volume);\r\n        music.loop = loop;\r\n        return music.id;\r\n    },\r\n\r\n    /**\r\n     * !#en Stop background music.\r\n     * !#zh \r\n     * @method stopMusic\r\n     * @example\r\n     * cc.audioEngine.stopMusic();\r\n     */\r\n    stopMusic: function () {\r\n        this.stop(this._music.id);\r\n    },\r\n\r\n    /**\r\n     * !#en Pause the background music.\r\n     * !#zh \r\n     * @method pauseMusic\r\n     * @example\r\n     * cc.audioEngine.pauseMusic();\r\n     */\r\n    pauseMusic: function () {\r\n        this.pause(this._music.id);\r\n        return this._music.id;\r\n    },\r\n\r\n    /**\r\n     * !#en Resume playing background music.\r\n     * !#zh \r\n     * @method resumeMusic\r\n     * @example\r\n     * cc.audioEngine.resumeMusic();\r\n     */\r\n    resumeMusic: function () {\r\n        this.resume(this._music.id);\r\n        return this._music.id;\r\n    },\r\n\r\n    /**\r\n     * !#en Get the volume(0.0 ~ 1.0).\r\n     * !#zh 0.0 ~ 1.0\r\n     * @method getMusicVolume\r\n     * @return {Number}\r\n     * @example\r\n     * var volume = cc.audioEngine.getMusicVolume();\r\n     */\r\n    getMusicVolume: function () {\r\n        return this._music.volume;\r\n    },\r\n\r\n    /**\r\n     * !#en Set the background music volume.\r\n     * !#zh 0.0 ~ 1.0\r\n     * @method setMusicVolume\r\n     * @param {Number} volume - Volume must be in 0.0~1.0.\r\n     * @example\r\n     * cc.audioEngine.setMusicVolume(0.5);\r\n     */\r\n    setMusicVolume: function (volume) {\r\n        volume = handleVolume(volume);\r\n        var music = this._music;\r\n        music.volume = volume;\r\n        this.setVolume(music.id, music.volume);\r\n        return music.volume;\r\n    },\r\n\r\n    /**\r\n     * !#en Background music playing state\r\n     * !#zh \r\n     * @method isMusicPlaying\r\n     * @return {Boolean}\r\n     * @example\r\n     * cc.audioEngine.isMusicPlaying();\r\n     */\r\n    isMusicPlaying: function () {\r\n        return this.getState(this._music.id) === this.AudioState.PLAYING;\r\n    },\r\n\r\n    /**\r\n     * !#en Play effect audio.\r\n     * !#zh \r\n     * @method playEffect\r\n     * @param {AudioClip} clip - The audio clip to play.\r\n     * @param {Boolean} loop - Whether the music loop or not.\r\n     * @return {Number} audioId\r\n     * @example\r\n     * cc.loader.loadRes(url, cc.AudioClip, function (err, clip) {\r\n     *     var audioID = cc.audioEngine.playEffect(clip, false);\r\n     * });\r\n     */\r\n    playEffect: function (clip, loop) {\r\n        return this.play(clip, loop || false, this._effect.volume);\r\n    },\r\n\r\n    /**\r\n     * !#en Set the volume of effect audio.\r\n     * !#zh 0.0 ~ 1.0\r\n     * @method setEffectsVolume\r\n     * @param {Number} volume - Volume must be in 0.0~1.0.\r\n     * @example\r\n     * cc.audioEngine.setEffectsVolume(0.5);\r\n     */\r\n    setEffectsVolume: function (volume) {\r\n        volume = handleVolume(volume);\r\n        var musicId = this._music.id;\r\n        this._effect.volume = volume;\r\n        for (var id in _id2audio) {\r\n            var audio = _id2audio[id];\r\n            if (!audio || audio.id === musicId) continue;\r\n            audioEngine.setVolume(id, volume);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en The volume of the effect audio max value is 1.0,the min value is 0.0 .\r\n     * !#zh 0.0 ~ 1.0\r\n     * @method getEffectsVolume\r\n     * @return {Number}\r\n     * @example\r\n     * var volume = cc.audioEngine.getEffectsVolume();\r\n     */\r\n    getEffectsVolume: function () {\r\n        return this._effect.volume;\r\n    },\r\n\r\n    /**\r\n     * !#en Pause effect audio.\r\n     * !#zh \r\n     * @method pauseEffect\r\n     * @param {Number} audioID - audio id.\r\n     * @example\r\n     * cc.audioEngine.pauseEffect(audioID);\r\n     */\r\n    pauseEffect: function (audioID) {\r\n        return this.pause(audioID);\r\n    },\r\n\r\n    /**\r\n     * !#en Stop playing all the sound effects.\r\n     * !#zh \r\n     * @method pauseAllEffects\r\n     * @example\r\n     * cc.audioEngine.pauseAllEffects();\r\n     */\r\n    pauseAllEffects: function () {\r\n        var musicId = this._music.id;\r\n        var effect = this._effect;\r\n        effect.pauseCache.length = 0;\r\n\r\n        for (var id in _id2audio) {\r\n            var audio = _id2audio[id];\r\n            if (!audio || audio.id === musicId) continue;\r\n            var state = audio.getState();\r\n            if (state === this.AudioState.PLAYING) {\r\n                effect.pauseCache.push(id);\r\n                audio.pause();\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Resume effect audio.\r\n     * !#zh \r\n     * @method resumeEffect\r\n     * @param {Number} audioID - The return value of function play.\r\n     * @example\r\n     * cc.audioEngine.resumeEffect(audioID);\r\n     */\r\n    resumeEffect: function (id) {\r\n        this.resume(id);\r\n    },\r\n\r\n    /**\r\n     * !#en Resume all effect audio.\r\n     * !#zh \r\n     * @method resumeAllEffects\r\n     * @example\r\n     * cc.audioEngine.resumeAllEffects();\r\n     */\r\n    resumeAllEffects: function () {\r\n        var pauseIDCache = this._effect.pauseCache;\r\n        for (var i = 0; i < pauseIDCache.length; ++i) {\r\n            var id = pauseIDCache[i];\r\n            var audio = _id2audio[id];\r\n            if (audio)\r\n                audio.resume();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Stop playing the effect audio.\r\n     * !#zh \r\n     * @method stopEffect\r\n     * @param {Number} audioID - audio id.\r\n     * @example\r\n     * cc.audioEngine.stopEffect(id);\r\n     */\r\n    stopEffect: function (audioID) {\r\n        return this.stop(audioID);\r\n    },\r\n\r\n    /**\r\n     * !#en Stop playing all the effects.\r\n     * !#zh \r\n     * @method stopAllEffects\r\n     * @example\r\n     * cc.audioEngine.stopAllEffects();\r\n     */\r\n    stopAllEffects: function () {\r\n        var musicId = this._music.id;\r\n        for (var id in _id2audio) {\r\n            var audio = _id2audio[id];\r\n            if (!audio || audio.id === musicId) continue;\r\n            var state = audio.getState();\r\n            if (state === audioEngine.AudioState.PLAYING) {\r\n                audio.stop();\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nmodule.exports = cc.audioEngine = audioEngine;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst BufferAsset = require('../assets/CCBufferAsset');\r\n\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst renderer = require('../renderer');\r\nconst gfx = renderEngine.gfx;\r\nconst vec3 = cc.vmath.vec3;\r\n\r\nconst _type2size = {\r\n    SCALAR: 1,\r\n    VEC2: 2,\r\n    VEC3: 3,\r\n    VEC4: 4,\r\n    MAT2: 4,\r\n    MAT3: 9,\r\n    MAT4: 16,\r\n};\r\n\r\nconst _compType2Array = {\r\n    5120: Int8Array,\r\n    5121: Uint8Array,\r\n    5122: Int16Array,\r\n    5123: Uint16Array,\r\n    5124: Int32Array,\r\n    5125: Uint32Array,\r\n    5126: Float32Array,\r\n};\r\n\r\nconst _gltfAttribMap = {\r\n    POSITION: gfx.ATTR_POSITION,\r\n    NORMAL: gfx.ATTR_NORMAL,\r\n    TANGENT: gfx.ATTR_TANGENT,\r\n    COLOR_0: gfx.ATTR_COLOR0,\r\n    TEXCOORD_0: gfx.ATTR_UV0,\r\n    TEXCOORD_1: gfx.ATTR_UV1,\r\n    TEXCOORD_2: gfx.ATTR_UV2,\r\n    TEXCOORD_3: gfx.ATTR_UV3,\r\n    JOINTS_0: gfx.ATTR_JOINTS,\r\n    WEIGHTS_0: gfx.ATTR_WEIGHTS\r\n};\r\n\r\nlet Model = cc.Class({\r\n    name: 'cc.Model',\r\n    extends: cc.Asset,\r\n\r\n    ctor () {\r\n        this._nodesInited = false;\r\n    },\r\n\r\n    properties: {\r\n        _buffers: [BufferAsset],\r\n\r\n        _gltf: {\r\n            default: {}\r\n        }\r\n    },\r\n\r\n    _initNodes () {\r\n        if (this._nodesInited) return;\r\n        this._nodesInited = true;\r\n\r\n        let nodes = this._gltf.nodes;\r\n        for (let i = 0; i < nodes.length; i++) {\r\n            let node = nodes[i];\r\n\r\n            node.path = node.parent ? node.parent.path + '/' + node.name : '';\r\n\r\n            let children = node.children;\r\n            if (children) {\r\n                for (let j = 0; j < children.length; j++) {\r\n                    let child = nodes[children[j]];\r\n                    child.parent = node;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    initSkeleton (skeleton) {\r\n        this._initNodes();\r\n\r\n        let gltf = this._gltf;\r\n        let buffers = this._buffers;\r\n        let skinID = skeleton._skinID;\r\n        if (skinID >= gltf.skins.length) {\r\n            return null;\r\n        }\r\n\r\n        let gltfSkin = gltf.skins[skinID];\r\n\r\n        // extract bindposes mat4 data\r\n        let accessor = gltf.accessors[gltfSkin.inverseBindMatrices];\r\n        let bufView = gltf.bufferViews[accessor.bufferView];\r\n        let bin = buffers[bufView.buffer]._buffer;\r\n        let data = new Float32Array(bin, bufView.byteOffset + accessor.byteOffset, accessor.count * 16);\r\n        let bindposes = new Array(accessor.count);\r\n\r\n        for (let i = 0; i < accessor.count; ++i) {\r\n            bindposes[i] = cc.vmath.mat4.new(\r\n                data[16 * i + 0], data[16 * i + 1], data[16 * i + 2], data[16 * i + 3],\r\n                data[16 * i + 4], data[16 * i + 5], data[16 * i + 6], data[16 * i + 7],\r\n                data[16 * i + 8], data[16 * i + 9], data[16 * i + 10], data[16 * i + 11],\r\n                data[16 * i + 12], data[16 * i + 13], data[16 * i + 14], data[16 * i + 15]\r\n            );\r\n        }\r\n\r\n        let jointIndices = gltfSkin.joints;\r\n        let jointPaths = skeleton.jointPaths;\r\n        jointPaths.length = 0;\r\n        let nodes = this._gltf.nodes;\r\n        for (let i = 0; i < jointIndices.length; i++) {\r\n            let node = nodes[jointIndices[i]];\r\n            jointPaths.push(node.path);\r\n        }\r\n        skeleton.jointPaths = jointPaths;\r\n        skeleton.bindposes = bindposes;\r\n    },\r\n\r\n    _createVB (gltf, accessors, primitive) {\r\n        // create vertex-format\r\n        let vfmt = [];\r\n        let vcount = 0;\r\n\r\n        let byteOffset = 10e7, maxByteOffset = 0;\r\n        let bufferViewIndex = -1;\r\n        let attributes = primitive.attributes;\r\n        for (let gltfAttribName in attributes) {\r\n            const gfxAttribName = _gltfAttribMap[gltfAttribName];\r\n            if (gfxAttribName === undefined) {\r\n                console.error(`Found unacceptable GlTf attribute ${gltfAttribName}.`);\r\n                return;\r\n            }\r\n            let acc = accessors[attributes[gltfAttribName]];\r\n            vcount = Math.max(acc.count, vcount);\r\n\r\n            let vbView = gltf.bufferViews[acc.bufferView];\r\n            bufferViewIndex = vbView.buffer;\r\n            vfmt.push({\r\n                name: gfxAttribName, type: acc.componentType, num: _type2size[acc.type],\r\n                byteLength: vbView.byteLength, byteOffset: vbView.byteOffset\r\n            });\r\n\r\n            byteOffset = Math.min(byteOffset, vbView.byteOffset);\r\n            maxByteOffset = Math.max(maxByteOffset, vbView.byteOffset + vbView.byteLength);\r\n        }\r\n\r\n        let gfxVFmt = new gfx.VertexFormat(vfmt);\r\n        let els = gfxVFmt._elements;\r\n        for (let i = 0; i < els.length; i++) {\r\n            let el = els[i];\r\n            el.offset = vfmt[i].byteOffset - byteOffset;\r\n            el.stride = el.bytes;\r\n        }\r\n\r\n        let bin = this._buffers[bufferViewIndex]._buffer;\r\n\r\n        // create vertex-buffer\r\n        let vbData = new Uint8Array(bin, byteOffset, maxByteOffset - byteOffset);\r\n        let vb = new gfx.VertexBuffer(\r\n            renderer.device,\r\n            gfxVFmt,\r\n            gfx.USAGE_STATIC,\r\n            vbData,\r\n            vcount\r\n        );\r\n\r\n        return {\r\n            buffer: vb,\r\n            data: vbData\r\n        };\r\n    },\r\n\r\n    _createIB (gltf, accessors, primitive) {\r\n        let ibAcc = accessors[primitive.indices];\r\n        let ibView = gltf.bufferViews[ibAcc.bufferView];\r\n        let bin = this._buffers[ibView.buffer]._buffer;\r\n        let ibData = new Uint16Array(bin, ibView.byteOffset, ibView.byteLength / 2);\r\n        let ibBuffer = new gfx.IndexBuffer(\r\n            renderer.device,\r\n            ibAcc.componentType,\r\n            gfx.USAGE_STATIC,\r\n            ibData,\r\n            ibAcc.count\r\n        );\r\n\r\n        return {\r\n            buffer: ibBuffer,\r\n            data: ibData\r\n        }\r\n    },\r\n\r\n    _createArray (gltf, accessorID) {\r\n        let acc = gltf.accessors[accessorID];\r\n        let bufView = gltf.bufferViews[acc.bufferView];\r\n        let bin = this._buffers[bufView.buffer]._buffer;\r\n\r\n        let num = _type2size[acc.type];\r\n        let typedArray = _compType2Array[acc.componentType];\r\n        let result = new typedArray(bin, bufView.byteOffset + acc.byteOffset, acc.count * num);\r\n\r\n        return result;\r\n    },\r\n\r\n    initMesh (meshAsset) {\r\n        const index = meshAsset._meshID;\r\n\r\n        const gltf = this._gltf;\r\n        const gltfMesh = gltf.meshes[index];\r\n        const accessors = gltf.accessors;\r\n\r\n        // create index-buffer\r\n        let length = gltfMesh.primitives.length;\r\n        meshAsset._ibs.length = length;\r\n        meshAsset._vbs.length = length;\r\n        meshAsset._subMeshes.length = length;\r\n        vec3.set(meshAsset._minPos, Infinity, Infinity, Infinity);\r\n        vec3.set(meshAsset._maxPos, -Infinity, -Infinity, -Infinity);\r\n        for (let i = 0; i < length; ++i) {\r\n            let primitive = gltfMesh.primitives[i];\r\n\r\n            if (primitive.indices === undefined) continue;\r\n\r\n            let vb = this._createVB(gltf, accessors, primitive);\r\n            let ib = this._createIB(gltf, accessors, primitive);\r\n\r\n            if (primitive.attributes.POSITION) {\r\n                let gltfAccessor = accessors[primitive.attributes.POSITION];\r\n                let minPos = meshAsset._minPos, maxPos = meshAsset._maxPos,\r\n                    min = gltfAccessor.min, max = gltfAccessor.max;\r\n                minPos.x = Math.min(minPos.x, min[0]);\r\n                minPos.y = Math.min(minPos.y, min[1]);\r\n                minPos.z = Math.min(minPos.z, min[2]);\r\n                maxPos.x = Math.max(maxPos.x, max[0]);\r\n                maxPos.y = Math.max(maxPos.y, max[1]);\r\n                maxPos.z = Math.max(maxPos.z, max[2]);\r\n            }\r\n\r\n            meshAsset._subMeshes[i] = new renderEngine.InputAssembler(vb.buffer, ib.buffer);\r\n            meshAsset._vbs[i] = vb;\r\n            meshAsset._ibs[i] = ib;\r\n        }\r\n    },\r\n\r\n    initAnimationClip (clip) {\r\n        this._initNodes();\r\n\r\n        let gltf = this._gltf;\r\n        let gltfAnimation = gltf.animations[clip._animationID];\r\n\r\n        clip.wrapMode = cc.WrapMode.Loop;\r\n        let duration = 0;\r\n\r\n        let curveData = clip.curveData;\r\n        let paths = curveData.paths = {};\r\n\r\n        let nodes = gltf.nodes;\r\n\r\n        let samplers = gltfAnimation.samplers;\r\n        let channels = gltfAnimation.channels;\r\n        for (let i = 0; i < channels.length; ++i) {\r\n            let gltfChannel = channels[i];\r\n            let sampler = samplers[gltfChannel.sampler];\r\n\r\n            let inputArray = this._createArray(gltf, sampler.input);\r\n            let outputArray = this._createArray(gltf, sampler.output);\r\n\r\n            let target = gltfChannel.target;\r\n            let node = nodes[target.node];\r\n\r\n            let path = node.path;\r\n\r\n            let curves;\r\n            if (path === '') {\r\n                curves = curveData;\r\n            }\r\n            else {\r\n                if (!paths[path]) {\r\n                    paths[path] = {};\r\n                }\r\n                curves = paths[path];\r\n            }\r\n\r\n            if (!curves.props) {\r\n                curves.props = {};\r\n            }\r\n\r\n            let frames = [];\r\n            for (let frameIdx = 0; frameIdx < inputArray.length; frameIdx++) {\r\n                let frame = inputArray[frameIdx];\r\n                if (frame > duration) {\r\n                    duration = frame;\r\n                }\r\n                frames.push({ frame: frame });\r\n            }\r\n            if (target.path === 'translation') {\r\n                for (let frameIdx = 0; frameIdx < inputArray.length; frameIdx++) {\r\n                    let i = frameIdx * 3;\r\n                    frames[frameIdx].value = cc.v3(outputArray[i], outputArray[i + 1], outputArray[i + 2]);\r\n                }\r\n                curves.props.position = frames;\r\n            }\r\n            else if (target.path === 'rotation') {\r\n                for (let frameIdx = 0; frameIdx < inputArray.length; frameIdx++) {\r\n                    let i = frameIdx * 4;\r\n                    frames[frameIdx].value = cc.quat(outputArray[i], outputArray[i + 1], outputArray[i + 2], outputArray[i + 3]);\r\n                }\r\n                curves.props.quat = frames;\r\n            }\r\n            else if (target.path === 'scale') {\r\n                for (let frameIdx = 0; frameIdx < inputArray.length; frameIdx++) {\r\n                    let i = frameIdx * 3;\r\n                    frames[frameIdx].value = cc.v3(outputArray[i], outputArray[i + 1], outputArray[i + 2]);\r\n                }\r\n                curves.props.scale = frames;\r\n            }\r\n        }\r\n\r\n        for (let i = 1; i < nodes.length; i++) {\r\n            let node = nodes[i];\r\n            if (paths[node.path]) continue;\r\n\r\n            let curves = paths[node.path] = { props: {} };\r\n            let props = curves.props;\r\n\r\n            let rotation = node.rotation;\r\n            if (rotation) {\r\n                props.quat = [{\r\n                    frame: 0,\r\n                    value: cc.quat(rotation[0], rotation[1], rotation[2], rotation[3])\r\n                }];\r\n            }\r\n\r\n            let scale = node.scale;\r\n            if (scale) {\r\n                props.scale = [{\r\n                    frame: 0,\r\n                    value: cc.v3(scale[0], scale[1], scale[2])\r\n                }];\r\n            }\r\n\r\n            let translation = node.translation;\r\n            if (translation) {\r\n                props.position = [{\r\n                    frame: 0,\r\n                    value: cc.v3(translation[0], translation[1], translation[2])\r\n                }];\r\n            }\r\n        }\r\n\r\n        clip._duration = duration;\r\n    }\r\n});\r\n\r\ncc.Model = module.exports = Model;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Model = require('./CCModel');\r\n\r\nlet ModelMeshResource = cc.Class({\r\n    name: 'ModelMeshResource',\r\n\r\n    ctor () {\r\n        this._subMeshes = [];\r\n        this._ibs = [];\r\n        this._vbs = [];\r\n        this._inited = false;\r\n        this._minPos = cc.v3();\r\n        this._maxPos = cc.v3();\r\n    },\r\n\r\n    properties: {\r\n        _meshID: -1,\r\n        _model: {\r\n            type: Model,\r\n            default: null\r\n        },\r\n\r\n        meshID: {\r\n            get () {\r\n                return this._meshID;\r\n            },\r\n            set (val) {\r\n                this._meshID = val;\r\n            }\r\n        },\r\n\r\n        model: {\r\n            get () {\r\n                return this._model;\r\n            },\r\n            set (val) {\r\n                this._model = val;\r\n            }\r\n        }\r\n    },\r\n\r\n    flush (mesh) {\r\n        if (!this._inited) {\r\n            this._inited = true;\r\n            this.model.initMesh(this);\r\n        }\r\n\r\n        mesh._vbs = this._vbs;\r\n        mesh._ibs = this._ibs;\r\n        mesh._subMeshes = this._subMeshes;\r\n        mesh._minPos = this._minPos;\r\n        mesh._maxPos = this._maxPos;\r\n    }\r\n});\r\n\r\nmodule.exports = ModelMeshResource;\r\n","\r\nlet Skeleton = cc.Class({\r\n    name: 'cc.Skeleton',\r\n    extends: cc.Asset,\r\n\r\n    ctor () {\r\n        this.jointPaths = [];\r\n        this.bindposes = [];\r\n    },\r\n\r\n    properties: {\r\n        _modelSetter: {\r\n            set: function (model) {\r\n                if (CC_EDITOR && Editor.isBuilder) {\r\n                    // just building\r\n                    return;\r\n                }\r\n                this._initWithModel(model);\r\n            }\r\n        },\r\n    },\r\n\r\n    _initWithModel (model) {\r\n        if (!model) return;\r\n        this._model = model;\r\n        this._model.initSkeleton(this);\r\n    },\r\n\r\n    _serialize: CC_EDITOR && function (exporting) {\r\n        let modelUuid = this._modelUuid;\r\n        if (exporting) {\r\n            modelUuid = Editor.Utils.UuidUtils.compressUuid(modelUuid, true);\r\n        }\r\n        return {\r\n            modelUuid: modelUuid,\r\n            skinID: this._skinID,\r\n        };\r\n    },\r\n\r\n    _deserialize (data, handle) {\r\n        this._modelUuid = data.modelUuid;\r\n        this._skinID = data.skinID;\r\n\r\n        if (this._modelUuid) {\r\n            handle.result.push(this, '_modelSetter', this._modelUuid);\r\n        }\r\n    }\r\n});\r\n\r\ncc.Skeleton = module.exports = Skeleton;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Animation = require('../components/CCAnimation');\r\nconst Model = require('./CCModel');\r\nconst SkeletonAnimationClip = require('./CCSkeletonAnimationClip');\r\nconst AnimationClip = require('../../animation/animation-clip');\r\n\r\n/**\r\n * @module cc\r\n */\r\n/**\r\n * !#en .\r\n * !#zh \r\n * @class SkeletonAnimation\r\n * @extends Animation\r\n */\r\nlet SkeletonAnimation = cc.Class({\r\n    name: 'cc.SkeletonAnimation',\r\n    extends: Animation,\r\n\r\n    editor: CC_EDITOR && {\r\n        inspector: 'packages://inspector/inspectors/comps/skeleton-animation.js',\r\n        menu: 'i18n:MAIN_MENU.component.others/Skeleton Animation',\r\n    },\r\n\r\n    properties: {\r\n        _model: Model,\r\n\r\n        _defaultClip: {\r\n            override: true,\r\n            default: null,\r\n            type: SkeletonAnimationClip,\r\n        },\r\n\r\n        _clips: {\r\n            override: true,\r\n            default: [],\r\n            type: [SkeletonAnimationClip],\r\n            visible: true,\r\n        },\r\n\r\n        defaultClip: {\r\n            override: true,\r\n            get () {\r\n                return this._defaultClip;\r\n            },\r\n            set (v) {\r\n                this._defaultClip = v;\r\n            },\r\n            type: SkeletonAnimationClip,\r\n        },\r\n\r\n        model: {\r\n            get () {\r\n                return this._model;\r\n            },\r\n            set (val) {\r\n                this._model = val;\r\n            },\r\n            type: Model\r\n        },\r\n    },\r\n\r\n    getAnimationState (name) {\r\n        let state = this._super(name);\r\n        let clip = state.clip;\r\n        clip.init();\r\n        return state;\r\n    },\r\n\r\n    searchClips: CC_EDITOR && function () {\r\n        this._clips.length = 0;\r\n        let self = this;\r\n        Editor.assetdb.queryPathByUuid(this._model._uuid, function (err, modelPath) {\r\n            if (err) return console.error(err);\r\n            \r\n            const Path = require('fire-path');\r\n            let queryPath = Path.relative(Editor.remote.Project.path, modelPath);\r\n            queryPath = Path.join(Path.dirname(queryPath), Path.basenameNoExt(queryPath));\r\n            queryPath = `db://${queryPath}*/*.sac`;\r\n\r\n            Editor.assetdb.queryAssets(queryPath, null, function (err, results) {\r\n                if (results) {\r\n                    for (let i = 0; i < results.length; i++) {\r\n                        let clip = new SkeletonAnimationClip();\r\n                        clip._uuid = results[i].uuid;\r\n                        self._clips.push(clip);\r\n                    }\r\n                    self._defaultClip = self._clips[0];\r\n                }\r\n            });\r\n        });\r\n    }\r\n});\r\n\r\ncc.SkeletonAnimation = module.exports = SkeletonAnimation;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Model = require('./CCModel');\r\nconst AnimationClip = require('../../animation/animation-clip');\r\n\r\n /**\r\n * @module cc\r\n */\r\n/**\r\n * !#en SkeletonAnimationClip Asset.\r\n * !#zh \r\n * @class SkeletonAnimationClip\r\n * @extends AnimationClip\r\n */\r\nvar SkeletonAnimationClip = cc.Class({\r\n    name: 'cc.SkeletonAnimationClip',\r\n    extends: AnimationClip,\r\n\r\n    properties: {\r\n        _modelSetter: {\r\n            set: function (model) {\r\n                this._model = model;\r\n            }\r\n        },\r\n\r\n        model: {\r\n            get () {\r\n                return this._model;\r\n            },\r\n\r\n            type: Model\r\n        }\r\n    },\r\n\r\n    ctor () {\r\n        this._modelUuid = '';\r\n        this._animationID = -1;\r\n        this._model = null;\r\n        this._inited = false;\r\n    },\r\n\r\n    init () {\r\n        if (this._inited) return;\r\n        this._inited = true;\r\n        this._model.initAnimationClip(this);\r\n    },\r\n\r\n    _serialize: CC_EDITOR && function (exporting) {\r\n        let modelUuid = this._modelUuid;\r\n        if (exporting) {\r\n            modelUuid = Editor.Utils.UuidUtils.compressUuid(modelUuid, true);\r\n        }\r\n        return {\r\n            modelUuid: modelUuid,\r\n            animationID: this._animationID,\r\n            name: this._name,\r\n        }\r\n    },\r\n\r\n    _deserialize (data, handle) {\r\n        this._modelUuid = data.modelUuid;\r\n        this._animationID = data.animationID;\r\n        this._name = data.name;\r\n\r\n        if (this._modelUuid) {\r\n            handle.result.push(this, '_modelSetter', this._modelUuid);\r\n        }\r\n    }\r\n});\r\n\r\ncc.SkeletonAnimationClip = module.exports = SkeletonAnimationClip;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Skeleton = require('./CCSkeleton');\r\nconst MeshRenderer = require('../mesh/CCMeshRenderer');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst mat4 = cc.vmath.mat4;\r\n\r\nlet _m4_tmp = mat4.create();\r\n\r\nlet SkinnedMeshRenderer = cc.Class({\r\n    name: 'cc.SkinnedMeshRenderer',\r\n    extends: MeshRenderer,\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.mesh/Skinned Mesh Renderer',\r\n    },\r\n\r\n    ctor () {\r\n        this._jointsTextureData = null;\r\n        this._jointsTexture = null;\r\n        this._joints = [];\r\n        this._matrices = [];\r\n\r\n        this._assembler = MeshRenderer._assembler;\r\n    },\r\n\r\n    properties: {\r\n        _skeleton: Skeleton,\r\n        _rootBone: cc.Node,\r\n\r\n        skeleton: {\r\n            get () {\r\n                return this._skeleton;\r\n            },\r\n            set (val) {\r\n                this._skeleton = val;\r\n                this._initJoints();\r\n                this._initJointsTexture();\r\n                this.activeMaterials(true);\r\n            },\r\n            type: Skeleton\r\n        },\r\n\r\n        rootBone: {\r\n            get () {\r\n                return this._rootBone;\r\n            },\r\n            set (val) {\r\n                this._rootBone = val;\r\n                this._initJoints();\r\n            },\r\n            type: cc.Node\r\n        }\r\n    },\r\n\r\n    _createMaterial () {\r\n        let material = new renderEngine.MeshMaterial();\r\n        material.color = cc.Color.WHITE;\r\n        material._mainTech._passes[0].setDepth(true, true);\r\n        material.useModel = false;\r\n        material.useSkinning = true;\r\n\r\n        if (this._jointsTexture) {\r\n            material.useJointsTexture = true;\r\n            material.jointsTexture = this._jointsTexture;\r\n            material.jointsTextureSize = this._jointsTexture.width;\r\n        }\r\n        else {\r\n            material.useJointsTexture = false;\r\n            material.jointMatrices = this._jointsTextureData;\r\n        }\r\n\r\n        return material;\r\n    },\r\n\r\n    activeMaterials (force) {\r\n        if (!this._jointsTextureData) {\r\n            this.disableRender();\r\n            return;\r\n        }\r\n\r\n        this._super(force);\r\n    },\r\n\r\n    __preload () {\r\n        this._initJoints();\r\n        this._initJointsTexture();\r\n    },\r\n\r\n    _initJoints () {\r\n        let joints = this._joints;\r\n        joints.length = 0;\r\n\r\n        if (!this.skeleton || !this.rootBone) return;\r\n\r\n        let jointPaths = this.skeleton.jointPaths;\r\n        let rootBone = this.rootBone;\r\n        let matrices = this._matrices;\r\n        matrices.length = 0;\r\n        for (let i = 0; i < jointPaths.length; i++) {\r\n            let bone = cc.find(jointPaths[i], rootBone);\r\n            if (!bone) {\r\n                cc.warn('Can not find joint in root bone [%s] with path [%s]', rootBone.name, jointPaths[i]);\r\n            }\r\n            joints.push(bone);\r\n            matrices.push(mat4.create());\r\n        }\r\n\r\n        this.updateMatrices();\r\n    },\r\n\r\n    _initJointsTexture () {\r\n        if (!this._skeleton) return;\r\n\r\n        let jointCount = this._joints.length;\r\n\r\n        let ALLOW_FLOAT_TEXTURE = !!cc.renderer.device.ext('OES_texture_float');\r\n        if (ALLOW_FLOAT_TEXTURE) {\r\n            // set jointsTexture\r\n            let size;\r\n            if (jointCount > 256) {\r\n                size = 64;\r\n            } else if (jointCount > 64) {\r\n                size = 32;\r\n            } else if (jointCount > 16) {\r\n                size = 16;\r\n            } else {\r\n                size = 8;\r\n            }\r\n\r\n            this._jointsTextureData = new Float32Array(size * size * 4);\r\n\r\n            let texture = this._jointsTexture || new cc.Texture2D();\r\n            texture.initWithData(this._jointsTextureData, cc.Texture2D.PixelFormat.RGBA32F, size, size);\r\n\r\n            this._jointsTexture = texture;\r\n        }\r\n        else {\r\n            this._jointsTextureData = new Float32Array(jointCount * 16);\r\n        }\r\n    },\r\n\r\n    _setJointsTextureData (iMatrix, matrix) {\r\n        let arr = this._jointsTextureData;\r\n        arr[16 * iMatrix + 0] = matrix.m00;\r\n        arr[16 * iMatrix + 1] = matrix.m01;\r\n        arr[16 * iMatrix + 2] = matrix.m02;\r\n        arr[16 * iMatrix + 3] = matrix.m03;\r\n        arr[16 * iMatrix + 4] = matrix.m04;\r\n        arr[16 * iMatrix + 5] = matrix.m05;\r\n        arr[16 * iMatrix + 6] = matrix.m06;\r\n        arr[16 * iMatrix + 7] = matrix.m07;\r\n        arr[16 * iMatrix + 8] = matrix.m08;\r\n        arr[16 * iMatrix + 9] = matrix.m09;\r\n        arr[16 * iMatrix + 10] = matrix.m10;\r\n        arr[16 * iMatrix + 11] = matrix.m11;\r\n        arr[16 * iMatrix + 12] = matrix.m12;\r\n        arr[16 * iMatrix + 13] = matrix.m13;\r\n        arr[16 * iMatrix + 14] = matrix.m14;\r\n        arr[16 * iMatrix + 15] = matrix.m15;\r\n    },\r\n\r\n    _commitJointsData () {\r\n        if (this._jointsTexture) {\r\n            this._jointsTexture.update({ image: this._jointsTextureData });\r\n        }\r\n    },\r\n\r\n    updateMatrices () {\r\n        for (let i = 0; i < this._joints.length; ++i) {\r\n            let joint = this._joints[i];\r\n            if (!joint || !joint.activeInHierarchy) continue;\r\n            joint.getWorldMatrix(this._matrices[i]);\r\n        }\r\n    },\r\n\r\n    update () {\r\n        if (!this.skeleton || !this.rootBone) return;\r\n        const bindposes = this.skeleton.bindposes;\r\n        const matrices = this._matrices;\r\n\r\n        this.updateMatrices();\r\n\r\n        for (let i = 0; i < bindposes.length; ++i) {\r\n            let bindpose = bindposes[i];\r\n            let worldMatrix = matrices[i];\r\n\r\n            mat4.multiply(_m4_tmp, worldMatrix, bindpose);\r\n            this._setJointsTextureData(i, _m4_tmp);\r\n        }\r\n\r\n        this._commitJointsData();\r\n    }\r\n});\r\n\r\ncc.SkinnedMeshRenderer = module.exports = SkinnedMeshRenderer;\r\n","\r\nconst quat = cc.vmath.quat;\r\nlet _quat_tmp = cc.quat();\r\nlet _vec3_tmp = cc.v3();\r\n\r\n/*\r\n * Rotates a Node object to a certain angle by modifying its quaternion property. <br/>\r\n * The direction will be decided by the shortest angle.\r\n * @class Rotate3DTo\r\n * @extends ActionInterval\r\n * @param {Number} duration duration in seconds\r\n * @param {Number|Vec3} dstAngleX dstAngleX in degrees.\r\n * @param {Number} [dstAngleY] dstAngleY in degrees.\r\n * @param {Number} [dstAngleZ] dstAngleZ in degrees.\r\n * @example\r\n * var rotate3DTo = new cc.Rotate3DTo(2, cc.v3(0, 180, 0));\r\n */\r\ncc.Rotate3DTo = cc.Class({\r\n    name: 'cc.Rotate3DTo',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor:function (duration, dstAngleX, dstAngleY, dstAngleZ) {\r\n        this._startQuat = cc.quat();\r\n        this._dstQuat = cc.quat();\r\n\r\n\t\tdstAngleX !== undefined && this.initWithDuration(duration, dstAngleX, dstAngleY, dstAngleZ);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration\r\n     * @param {Number|Vec3|Quat} dstAngleX\r\n     * @param {Number} dstAngleY\r\n     * @param {Number} dstAngleZ\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, dstAngleX, dstAngleY, dstAngleZ) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            let dstQuat = this._dstQuat;\r\n            if (dstAngleX instanceof cc.Quat) {\r\n                dstQuat.set(dstAngleX);\r\n            }\r\n            else {\r\n                if (dstAngleX instanceof cc.Vec3) {\r\n                    dstAngleY = dstAngleX.y;\r\n                    dstAngleZ = dstAngleX.z;\r\n                    dstAngleX = dstAngleX.x;\r\n                }\r\n                else {\r\n                    dstAngleY = dstAngleY || 0;\r\n                    dstAngleZ = dstAngleZ || 0;\r\n                }\r\n                cc.vmath.quat.fromEuler(dstQuat, dstAngleX, dstAngleY, dstAngleZ);\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.Rotate3DTo();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._dstQuat);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._startQuat.set(target.quat);\r\n    },\r\n\r\n    reverse:function () {\r\n        cc.logID(1016);\r\n    },\r\n\r\n    update:function (dt) {\r\n        dt = this._computeEaseTime(dt);\r\n        if (this.target) {\r\n            quat.slerp(_quat_tmp, this._startQuat, this._dstQuat, dt);\r\n            this.target.setRotation(_quat_tmp);\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Rotates a Node object to a certain angle by modifying its quternion property. <br/>\r\n * The direction will be decided by the shortest angle.\r\n * !#zh  quternion \r\n * @method rotate3DTo\r\n * @param {Number} duration duration in seconds\r\n * @param {Number|Vec3|Quat} dstAngleX dstAngleX in degrees.\r\n * @param {Number} [dstAngleY] dstAngleY in degrees.\r\n * @param {Number} [dstAngleZ] dstAngleZ in degrees.\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var rotate3DTo = cc.rotate3DTo(2, cc.v3(0, 180, 0));\r\n */\r\ncc.rotate3DTo = function (duration, dstAngleX, dstAngleY, dstAngleZ) {\r\n    return new cc.Rotate3DTo(duration, dstAngleX, dstAngleY, dstAngleZ);\r\n};\r\n\r\n\r\n/*\r\n * Rotates a Node object counter clockwise a number of degrees by modifying its quaternion property.\r\n * Relative to its properties to modify.\r\n * @class Rotate3DBy\r\n * @extends ActionInterval\r\n * @param {Number} duration duration in seconds\r\n * @param {Number|Vec3} deltaAngleX deltaAngleX in degrees\r\n * @param {Number} [deltaAngleY] deltaAngleY in degrees\r\n * @param {Number} [deltaAngleZ] deltaAngleZ in degrees\r\n * @example\r\n * var actionBy = new cc.Rotate3DBy(2, cc.v3(0, 360, 0));\r\n */\r\ncc.Rotate3DBy = cc.Class({\r\n    name: 'cc.Rotate3DBy',\r\n    extends: cc.ActionInterval,\r\n\r\n    ctor: function (duration, deltaAngleX, deltaAngleY, deltaAngleZ) {\r\n        this._angle = cc.v3();\r\n        this._quat = cc.quat();\r\n        this._lastDt = 0;\r\n\t\tdeltaAngleX !== undefined && this.initWithDuration(duration, deltaAngleX, deltaAngleY, deltaAngleZ);\r\n    },\r\n\r\n    /*\r\n     * Initializes the action.\r\n     * @param {Number} duration duration in seconds\r\n     * @param {Number|Vec3} deltaAngleX deltaAngleX in degrees\r\n     * @param {Number} [deltaAngleY=] deltaAngleY in degrees\r\n     * @param {Number} [deltaAngleZ=] deltaAngleZ in degrees\r\n     * @return {Boolean}\r\n     */\r\n    initWithDuration:function (duration, deltaAngleX, deltaAngleY, deltaAngleZ) {\r\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\r\n            if (deltaAngleX instanceof cc.Vec3) {\r\n                deltaAngleY = deltaAngleX.y;\r\n                deltaAngleZ = deltaAngleX.z;\r\n                deltaAngleX = deltaAngleX.x;\r\n            }\r\n            else {\r\n                deltaAngleY = deltaAngleY || 0;\r\n                deltaAngleZ = deltaAngleZ || 0;\r\n            }\r\n            cc.vmath.vec3.set(this._angle, deltaAngleX, deltaAngleY, deltaAngleZ);\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    clone:function () {\r\n        var action = new cc.Rotate3DBy();\r\n        this._cloneDecoration(action);\r\n        action.initWithDuration(this._duration, this._angle);\r\n        return action;\r\n    },\r\n\r\n    startWithTarget:function (target) {\r\n        cc.ActionInterval.prototype.startWithTarget.call(this, target);\r\n        this._quat.set(target.quat);\r\n        this._lastDt = 0;\r\n    },\r\n\r\n    update: (function(){\r\n        let RAD = Math.PI / 180;\r\n        return function (dt) {\r\n            dt = this._computeEaseTime(dt);\r\n            if (this.target) {\r\n                let angle = this._angle;\r\n                let dstQuat = this._quat;\r\n                let delta = dt - this._lastDt;\r\n                let angleX = angle.x, angleY = angle.y, angleZ = angle.z;\r\n                if (angleX) quat.rotateX(dstQuat, dstQuat, angleX * RAD * delta);\r\n                if (angleY) quat.rotateY(dstQuat, dstQuat, angleY * RAD * delta);\r\n                if (angleZ) quat.rotateZ(dstQuat, dstQuat, angleZ * RAD * delta);\r\n                this.target.setRotation(dstQuat);\r\n                \r\n                this._lastDt = dt;\r\n            }\r\n        }\r\n    })(),\r\n\r\n    reverse:function () {\r\n        let angle = this._angle;\r\n        _vec3_tmp.x = -angle.x;\r\n        _vec3_tmp.y = -angle.y;\r\n        _vec3_tmp.z = -angle.z;\r\n        var action = new cc.Rotate3DBy(this._duration, _vec3_tmp);\r\n        this._cloneDecoration(action);\r\n        this._reverseEaseList(action);\r\n        return action;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Rotates a Node object counter clockwise a number of degrees by modifying its quaternion property.\r\n * Relative to its properties to modify.\r\n * !#zh  3D \r\n * @method rotate3DBy\r\n * @param {Number} duration duration in seconds\r\n * @param {Number|Vec3} deltaAngleX deltaAngleX in degrees\r\n * @param {Number} [deltaAngleY] deltaAngleY in degrees\r\n * @param {Number} [deltaAngleZ] deltaAngleZ in degrees\r\n * @return {ActionInterval}\r\n * @example\r\n * // example\r\n * var actionBy = cc.rotate3DBy(2, cc.v3(0, 360, 0));\r\n */\r\ncc.rotate3DBy = function (duration, deltaAngleX, deltaAngleY, deltaAngleZ) {\r\n    return new cc.Rotate3DBy(duration, deltaAngleX, deltaAngleY, deltaAngleZ);\r\n};\r\n\r\n","let vec3 = cc.vmath.vec3;\r\nlet mat3 = cc.vmath.mat3;\r\n\r\nlet _v3_tmp = vec3.create();\r\nlet _v3_tmp2 = vec3.create();\r\nlet _m3_tmp = mat3.create();\r\n\r\n// https://zeuxcg.org/2010/10/17/aabb-from-obb-with-component-wise-abs/\r\nlet transform_extent_m4 = function (out, extent, m4) {\r\n    _m3_tmp.m00 = Math.abs(m4.m00); _m3_tmp.m01 = Math.abs(m4.m01); _m3_tmp.m02 = Math.abs(m4.m02);\r\n    _m3_tmp.m03 = Math.abs(m4.m04); _m3_tmp.m04 = Math.abs(m4.m05); _m3_tmp.m05 = Math.abs(m4.m06);\r\n    _m3_tmp.m06 = Math.abs(m4.m08); _m3_tmp.m07 = Math.abs(m4.m09); _m3_tmp.m08 = Math.abs(m4.m10);\r\n    vec3.transformMat3(out, extent, _m3_tmp);\r\n};\r\n\r\n/**\r\n * @class geomUtils.Aabb\r\n * @param {Number} px \r\n * @param {Number} py \r\n * @param {Number} pz \r\n * @param {Number} w \r\n * @param {Number} h \r\n * @param {Number} l \r\n */\r\nfunction aabb(px, py, pz, w, h, l) {\r\n    this.center = vec3.create(px, py, pz);\r\n    this.halfExtents = vec3.create(w, h, l);\r\n}\r\n\r\nlet proto = aabb.prototype;\r\n\r\n/**\r\n * Get the bounding points of this shape\r\n * @method getBoundary\r\n * @param {vec3} minPos\r\n * @param {vec3} maxPos\r\n */\r\nproto.getBoundary = function (minPos, maxPos) {\r\n    vec3.sub(minPos, this.center, this.halfExtents);\r\n    vec3.add(maxPos, this.center, this.halfExtents);\r\n}\r\n\r\n/**\r\n * Transform this shape\r\n * @method transform\r\n * @param {mat4} m the transform matrix\r\n * @param {vec3} pos the position part of the transform\r\n * @param {quat} rot the rotation part of the transform\r\n * @param {vec3} scale the scale part of the transform\r\n * @param {geomUtils.Aabb} [out] the target shape\r\n */\r\nproto.transform = function (m, pos, rot, scale, out) {\r\n    if (!out) out = this;\r\n    vec3.transformMat4(out.center, this.center, m);\r\n    transform_extent_m4(out.halfExtents, this.halfExtents, m);\r\n}\r\n\r\n\r\n/**\r\n * create a new aabb\r\n * @method create\r\n * @param {number} px X coordinates for aabb's original point\r\n * @param {number} py Y coordinates for aabb's original point\r\n * @param {number} pz Z coordinates for aabb's original point\r\n * @param {number} w the half of aabb width\r\n * @param {number} h the half of aabb height\r\n * @param {number} l the half of aabb length\r\n * @return {geomUtils.Aabb}\r\n */\r\naabb.create = function (px, py, pz, w, h, l) {\r\n    return new aabb(px, py, pz, w, h, l);\r\n}\r\n\r\n/**\r\n * clone a new aabb\r\n * @method clone\r\n * @param {geomUtils.Aabb} a the source aabb\r\n * @return {geomUtils.Aabb}\r\n */\r\naabb.clone = function (a) {\r\n    return new aabb(a.center.x, a.center.y, a.center.z,\r\n        a.halfExtents.x, a.halfExtents.y, a.halfExtents.z);\r\n}\r\n\r\n/**\r\n * copy the values from one aabb to another\r\n * @method copy\r\n * @param {geomUtils.Aabb} out the receiving aabb\r\n * @param {geomUtils.Aabb} a the source aabb\r\n * @return {geomUtils.Aabb}\r\n */\r\naabb.copy = function (out, a) {\r\n    vec3.copy(out.center, a.center);\r\n    vec3.copy(out.halfExtents, a.halfExtents);\r\n\r\n    return out;\r\n}\r\n\r\n/**\r\n * create a new aabb from two corner points\r\n * @method fromPoints\r\n * @param {geomUtils.Aabb} out the receiving aabb\r\n * @param {vec3} minPos lower corner position of the aabb\r\n * @param {vec3} maxPos upper corner position of the aabb\r\n * @return {geomUtils.Aabb}\r\n */\r\naabb.fromPoints = function (out, minPos, maxPos) {\r\n    vec3.scale(out.center, vec3.add(_v3_tmp, minPos, maxPos), 0.5);\r\n    vec3.scale(out.halfExtents, vec3.sub(_v3_tmp2, maxPos, minPos), 0.5);\r\n    return out;\r\n}\r\n\r\n/**\r\n * Set the components of a aabb to the given values\r\n * @method set\r\n * @param {geomUtils.Aabb} out the receiving aabb\r\n * @param {number} px X coordinates for aabb's original point\r\n * @param {number} py Y coordinates for aabb's original point\r\n * @param {number} pz Z coordinates for aabb's original point\r\n * @param {number} w the half of aabb width\r\n * @param {number} h the half of aabb height\r\n * @param {number} l the half of aabb length\r\n * @return {geomUtils.Aabb} out\r\n */\r\naabb.set = function (out, px, py, pz, w, h, l) {\r\n    vec3.set(out.center, px, py, pz);\r\n    vec3.set(out.halfExtents, w, h, l);\r\n    return out;\r\n}\r\n\r\nmodule.exports = aabb;\r\n","\r\ncc.geomUtils = {\r\n    Triangle: require('./triangle'),\r\n    Aabb: require('./aabb'),\r\n    Ray: require('./ray'),\r\n    intersect: require('./intersect')\r\n};\r\n","\r\nconst renderEngine = require('../../renderer/render-engine');\r\nconst RecyclePool = renderEngine.RecyclePool;\r\nconst aabb = require('./aabb');\r\nconst ray = require('./ray');\r\nconst triangle = require('./triangle');\r\n\r\nconst mat4 = cc.vmath.mat4;\r\nconst vec3 = cc.vmath.vec3;\r\n\r\n/**\r\n * !#en 3D intersection helper class\r\n * !#zh  3D \r\n * @class geomUtils.intersect\r\n * @static\r\n */\r\nlet intersect = {};\r\n\r\n/** \r\n * !#en\r\n * Check whether ray intersect with a 3d aabb\r\n * !#zh\r\n *  3D \r\n * @method rayAabb\r\n * @param {geomUtils.Ray} ray\r\n * @param {geomUtils.Aabb} aabb\r\n * @return Number\r\n*/\r\nintersect.rayAabb = (function () {\r\n    let min = vec3.create();\r\n    let max = vec3.create();\r\n    return function (ray, aabb) {\r\n        let o = ray.o, d = ray.d;\r\n        let ix = 1 / d.x, iy = 1 / d.y, iz = 1 / d.z;\r\n        vec3.sub(min, aabb.center, aabb.halfExtents);\r\n        vec3.add(max, aabb.center, aabb.halfExtents);\r\n        let t1 = (min.x - o.x) * ix;\r\n        let t2 = (max.x - o.x) * ix;\r\n        let t3 = (min.y - o.y) * iy;\r\n        let t4 = (max.y - o.y) * iy;\r\n        let t5 = (min.z - o.z) * iz;\r\n        let t6 = (max.z - o.z) * iz;\r\n        let tmin = Math.max(Math.max(Math.min(t1, t2), Math.min(t3, t4)), Math.min(t5, t6));\r\n        let tmax = Math.min(Math.min(Math.max(t1, t2), Math.max(t3, t4)), Math.max(t5, t6));\r\n        if (tmax < 0 || tmin > tmax) return 0;\r\n        return tmin;\r\n    };\r\n})();\r\n\r\n/** \r\n * !#en\r\n * Check whether ray intersect with a 3D triangle\r\n * !#zh\r\n *  3D \r\n * @method rayTriangle\r\n * @param {geomUtils.Ray} ray\r\n * @param {geomUtils.Triangle} triangle\r\n*/\r\nintersect.rayTriangle = (function () {\r\n    let ab = vec3.create(0, 0, 0);\r\n    let ac = vec3.create(0, 0, 0);\r\n    let pvec = vec3.create(0, 0, 0);\r\n    let tvec = vec3.create(0, 0, 0);\r\n    let qvec = vec3.create(0, 0, 0);\r\n\r\n    return function (ray, triangle) {\r\n        vec3.sub(ab, triangle.b, triangle.a);\r\n        vec3.sub(ac, triangle.c, triangle.a);\r\n\r\n        vec3.cross(pvec, ray.d, ac);\r\n        let det = vec3.dot(ab, pvec);\r\n\r\n        if (det <= 0) {\r\n            return 0;\r\n        }\r\n\r\n        vec3.sub(tvec, ray.o, triangle.a);\r\n        let u = vec3.dot(tvec, pvec);\r\n        if (u < 0 || u > det) {\r\n            return 0;\r\n        }\r\n\r\n        vec3.cross(qvec, tvec, ab);\r\n        let v = vec3.dot(ray.d, qvec);\r\n        if (v < 0 || u + v > det) {\r\n            return 0;\r\n        }\r\n\r\n        let t = vec3.dot(ac, qvec) / det;\r\n        if (t < 0) return 0;\r\n        return t;\r\n    };\r\n})();\r\n\r\n\r\nintersect.rayMesh = (function () {\r\n    const gfx = renderEngine.gfx;\r\n\r\n    let tri = triangle.create();\r\n    let minDist = Infinity;\r\n\r\n    const _compType2fn = {\r\n        5120: 'getInt8',\r\n        5121: 'getUint8',\r\n        5122: 'getInt16',\r\n        5123: 'getUint16',\r\n        5124: 'getInt32',\r\n        5125: 'getUint32',\r\n        5126: 'getFloat32',\r\n    };\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView#Endianness\r\n    const littleEndian = (function () {\r\n        let buffer = new ArrayBuffer(2);\r\n        new DataView(buffer).setInt16(0, 256, true);\r\n        // Int16Array uses the platform's endianness.\r\n        return new Int16Array(buffer)[0] === 256;\r\n    })();\r\n\r\n    return function (ray, mesh) {\r\n        minDist = Infinity;\r\n        let subMeshes = mesh._subMeshes;\r\n        for (let i = 0; i < subMeshes.length; i++) {\r\n            if (subMeshes[i]._primitiveType !== gfx.PT_TRIANGLES) continue;\r\n\r\n            let vb = (mesh._vbs[i] || mesh._vbs[0]);\r\n            let vbData = vb.data;\r\n            let dv = new DataView(vbData.buffer, vbData.byteOffset, vbData.byteLength);\r\n            let ib = mesh._ibs[i].data;\r\n\r\n            let format = vb.buffer._format;\r\n            let fmt = format.element(gfx.ATTR_POSITION);\r\n            let offset = fmt.offset, stride = fmt.stride;\r\n            let fn = _compType2fn[fmt.type];\r\n            for (let i = 0; i < ib.length; i += 3) {\r\n                let idx = ib[i] * stride + offset;\r\n                vec3.set(tri.a, dv[fn]([idx], littleEndian), dv[fn]([idx + 4], littleEndian), dv[fn]([idx + 8], littleEndian));\r\n                idx = ib[i + 1] * stride + offset;\r\n                vec3.set(tri.b, dv[fn]([idx], littleEndian), dv[fn]([idx + 4], littleEndian), dv[fn]([idx + 8], littleEndian));\r\n                idx = ib[i + 2] * stride + offset;\r\n                vec3.set(tri.c, dv[fn]([idx], littleEndian), dv[fn]([idx + 4], littleEndian), dv[fn]([idx + 8], littleEndian));\r\n\r\n                let dist = intersect.rayTriangle(ray, tri);\r\n                if (dist > 0 && dist < minDist) {\r\n                    minDist = dist;\r\n                }\r\n            }\r\n        }\r\n        return minDist;\r\n    };\r\n})();\r\n\r\n\r\n/** \r\n * !#en\r\n * Check whether ray intersect with nodes\r\n * !#zh\r\n * \r\n * @method raycast\r\n * @param {Node} root - If root is null, then traversal nodes from scene node\r\n * @param {geomUtils.Ray} worldRay\r\n * @param {Function} handler\r\n * @param {Function} filter\r\n * @return [{node, distance}]\r\n*/\r\nintersect.raycast = (function () {\r\n    function traversal (node, cb) {\r\n        var children = node.children;\r\n\r\n        for (var i = children.length - 1; i >= 0; i--) {\r\n            var child = children[i];\r\n            traversal(child, cb);\r\n        }\r\n\r\n        cb(node);\r\n    }\r\n\r\n    function cmp (a, b) {\r\n        return a.distance - b.distance;\r\n    }\r\n\r\n    function transformMat4Normal (out, a, m) {\r\n        let x = a.x, y = a.y, z = a.z,\r\n            rhw = m.m03 * x + m.m07 * y + m.m11 * z;\r\n        rhw = rhw ? 1 / rhw : 1;\r\n        out.x = (m.m00 * x + m.m04 * y + m.m08 * z) * rhw;\r\n        out.y = (m.m01 * x + m.m05 * y + m.m09 * z) * rhw;\r\n        out.z = (m.m02 * x + m.m06 * y + m.m10 * z) * rhw;\r\n        return out;\r\n    }\r\n\r\n    let resultsPool = new RecyclePool(function () {\r\n        return {\r\n            distance: 0,\r\n            node: null\r\n        }\r\n    }, 1);\r\n\r\n    let results = [];\r\n\r\n    // temp variable\r\n    let nodeAabb = aabb.create();\r\n    let minPos = vec3.create();\r\n    let maxPos = vec3.create();\r\n\r\n    let modelRay = ray.create();\r\n    let m4_1 = mat4.create();\r\n    let m4_2 = mat4.create();\r\n    let d = vec3.create();\r\n\r\n    function distanceValid (distance) {\r\n        return distance > 0 && distance < Infinity;\r\n    }\r\n\r\n    return function (root, worldRay, handler, filter) {\r\n        resultsPool.reset();\r\n        results.length = 0;\r\n\r\n        root = root || cc.director.getScene();\r\n        traversal(root, function (node) {\r\n            if (filter && !filter(node)) return;\r\n\r\n            // transform world ray to model ray\r\n            mat4.invert(m4_2, node.getWorldMatrix(m4_1));\r\n            vec3.transformMat4(modelRay.o, worldRay.o, m4_2);\r\n            vec3.normalize(modelRay.d, transformMat4Normal(modelRay.d, worldRay.d, m4_2));\r\n\r\n            // raycast with bounding box\r\n            let distance = Infinity;\r\n            let component = node._renderComponent;\r\n            if (component && component._boundingBox) {\r\n                distance = intersect.rayAabb(modelRay, component._boundingBox);\r\n            }\r\n            else if (node.width && node.height) {\r\n                vec3.set(minPos, -node.width * node.anchorX, -node.height * node.anchorY, node.z);\r\n                vec3.set(maxPos, node.width * (1 - node.anchorX), node.height * (1 - node.anchorY), node.z);\r\n                aabb.fromPoints(nodeAabb, minPos, maxPos);\r\n                distance = intersect.rayAabb(modelRay, nodeAabb);\r\n            }\r\n\r\n            if (!distanceValid(distance)) return;\r\n\r\n            if (handler) {\r\n                distance = handler(modelRay, node, distance);\r\n            }\r\n\r\n            if (distanceValid(distance)) {\r\n                vec3.set(d, distance, 0, 0);\r\n                transformMat4Normal(d, d, m4_1);\r\n                let res = resultsPool.add();\r\n                res.node = node;\r\n                res.distance = cc.vmath.vec3.length(d);\r\n                results.push(res);\r\n            }\r\n        });\r\n\r\n        results.sort(cmp);\r\n        return results;\r\n    }\r\n})();\r\n\r\nmodule.exports = intersect;\r\n","const vec3 = cc.vmath.vec3;\r\n\r\n/**\r\n * @class geomUtils.Ray\r\n * @param {Number} ox \r\n * @param {Number} oy \r\n * @param {Number} oz \r\n * @param {Number} dx \r\n * @param {Number} dy \r\n * @param {Number} dz \r\n */\r\nfunction ray(ox, oy, oz, dx, dy, dz) {\r\n    this.o = vec3.new(ox, oy, oz);\r\n    this.d = vec3.new(dx, dy, dz);\r\n}\r\n\r\n/**\r\n * create a new ray\r\n * @method create\r\n * @param {Number} ox origin X component\r\n * @param {Number} oy origin Y component\r\n * @param {Number} oz origin Z component\r\n * @param {Number} dx dir X component\r\n * @param {Number} dy dir Y component\r\n * @param {Number} dz dir Z component\r\n * @return {geomUtils.Ray}\r\n */\r\nray.create = function (ox, oy, oz, dx, dy, dz) {\r\n    return new ray(ox, oy, oz, dx, dy, dz);\r\n}\r\n\r\n/**\r\n * Creates a new ray initialized with values from an existing ray\r\n * @method clone\r\n * @param {geomUtils.Ray} a ray to clone\r\n * @returns {geomUtils.Ray} a new ray\r\n */\r\nray.clone = function (a) {\r\n    return new ray(\r\n        a.o.x, a.o.y, a.o.z,\r\n        a.d.x, a.d.y, a.d.z\r\n    );\r\n}\r\n\r\n/**\r\n * Copy the values from one ray to another\r\n * @method copy\r\n * @param {geomUtils.Ray} out the receiving ray\r\n * @param {geomUtils.Ray} a the source ray\r\n * @returns {geomUtils.Ray} out\r\n */\r\nray.copy = function (out, a) {\r\n    out.o.x = a.o.x;\r\n    out.o.y = a.o.y;\r\n    out.o.z = a.o.z;\r\n    out.d.x = a.d.x;\r\n    out.d.y = a.d.y;\r\n    out.d.z = a.d.z;\r\n\r\n    return out;\r\n}\r\n\r\n/**\r\n * Set the components of a vec3 to the given values\r\n * @method set\r\n * @param {vec3} out the receiving vector\r\n * @param {Number} ox origin X component\r\n * @param {Number} oy origin Y component\r\n * @param {Number} oz origin Z component\r\n * @param {Number} dx dir X component\r\n * @param {Number} dy dir Y component\r\n * @param {Number} dz dir Z component\r\n * @returns {vec3} out\r\n */\r\nray.set = function (out, ox, oy, oz, dx, dy, dz) {\r\n    out.o.x = ox;\r\n    out.o.y = oy;\r\n    out.o.z = oz;\r\n    out.d.x = dx;\r\n    out.d.y = dy;\r\n    out.d.z = dz;\r\n\r\n    return out;\r\n}\r\n\r\n/**\r\n * create ray from 2 points\r\n * @method fromPoints\r\n * @param {geomUtils.Ray} out the receiving plane\r\n * @param {vec3} origin\r\n * @param {vec3} lookAt\r\n * @returns {geomUtils.Ray} out\r\n */\r\nray.fromPoints = function (out, origin, lookAt) {\r\n    vec3.copy(out.o, origin);\r\n    vec3.normalize(out.d, vec3.sub(out.d, lookAt, origin));\r\n\r\n    return out;\r\n}\r\n\r\nmodule.exports = ray;\r\n","const vec3 = cc.vmath.vec3;\r\n\r\n/**\r\n * @class geomUtils.Triangle\r\n * @param {Number} ax \r\n * @param {Number} ay \r\n * @param {Number} az \r\n * @param {Number} bx \r\n * @param {Number} by \r\n * @param {Number} bz \r\n * @param {Number} cx \r\n * @param {Number} cy \r\n * @param {Number} cz \r\n */\r\nfunction triangle(ax, ay, az, bx, by, bz, cx, cy, cz) {\r\n    this.a = vec3.create(ax, ay, az);\r\n    this.b = vec3.create(bx, by, bz);\r\n    this.c = vec3.create(cx, cy, cz);\r\n}\r\n\r\n/**\r\n * create a new triangle\r\n * @method create\r\n * @param {number} ax\r\n * @param {number} ay\r\n * @param {number} az\r\n * @param {number} bx\r\n * @param {number} by\r\n * @param {number} bz\r\n * @param {number} cx\r\n * @param {number} cy\r\n * @param {number} cz\r\n * @return {geomUtils.Triangle}\r\n */\r\ntriangle.create = function (ax, ay, az, bx, by, bz, cx, cy, cz) {\r\n    return new triangle(ax, ay, az, bx, by, bz, cx, cy, cz);\r\n}\r\n\r\n/**\r\n * clone a new triangle\r\n * @method clone\r\n * @param {geomUtils.Triangle} t the source plane\r\n * @return {geomUtils.Triangle}\r\n */\r\ntriangle.clone = function (t) {\r\n    return new triangle(\r\n        t.a.x, t.a.y, t.a.z,\r\n        t.b.x, t.b.y, t.b.z,\r\n        t.c.x, t.c.y, t.c.z\r\n    );\r\n}\r\n\r\n/**\r\n * copy the values from one triangle to another\r\n * @method copy\r\n * @param {geomUtils.Triangle} out the receiving triangle\r\n * @param {geomUtils.Triangle} t the source triangle\r\n * @return {geomUtils.Triangle}\r\n */\r\ntriangle.copy = function (out, t) {\r\n    vec3.copy(out.a, t.a);\r\n    vec3.copy(out.b, t.b);\r\n    vec3.copy(out.c, t.c);\r\n\r\n    return out;\r\n}\r\n\r\n/**\r\n * Create a triangle from three points\r\n * @method fromPoints\r\n * @param {geomUtils.Triangle} out the receiving triangle\r\n * @param {vec3} a\r\n * @param {vec3} b\r\n * @param {vec3} c\r\n * @return {geomUtils.Triangle}\r\n */\r\ntriangle.fromPoints = function (out, a, b, c) {\r\n    vec3.copy(out.a, a);\r\n    vec3.copy(out.b, b);\r\n    vec3.copy(out.c, c);\r\n    return out;\r\n}\r\n\r\n/**\r\n * Set the components of a triangle to the given values\r\n *\r\n * @method set\r\n * @param {geomUtils.Triangle} out the receiving plane\r\n * @param {number} ax X component of a\r\n * @param {number} ay Y component of a\r\n * @param {number} az Z component of a\r\n * @param {number} bx X component of b\r\n * @param {number} by Y component of b\r\n * @param {number} bz Z component of b\r\n * @param {number} cx X component of c\r\n * @param {number} cy Y component of c\r\n * @param {number} cz Z component of c\r\n * @return {plane}\r\n */\r\ntriangle.set = function (out, ax, ay, az, bx, by, bz, cx, cy, cz) {\r\n    out.a.x = ax;\r\n    out.a.y = ay;\r\n    out.a.z = az;\r\n\r\n    out.b.x = bx;\r\n    out.b.y = by;\r\n    out.b.z = bz;\r\n\r\n    out.c.x = cx;\r\n    out.c.y = cy;\r\n    out.c.z = cz;\r\n\r\n    return out;\r\n}\r\n\r\nmodule.exports = triangle;\r\n","\r\nif (!CC_TEST && (!CC_EDITOR || !Editor.isMainProcess)) {\r\n    require('./polyfill-3d');\r\n    require('./geom-utils');\r\n}\r\n\r\nrequire('./CCModel');\r\nrequire('./CCSkeleton');\r\nrequire('./CCSkeletonAnimationClip');\r\nrequire('./CCModelMeshResource');\r\nrequire('./actions');\r\n\r\nif (!CC_EDITOR || !Editor.isMainProcess) {\r\n    require('./CCSkeletonAnimation');\r\n    require('./CCSkinnedMeshRenderer');\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n\r\nconst Node = require('../CCNode');\r\nconst EventType = Node.EventType;\r\nconst DirtyFlag = Node._LocalDirtyFlag;\r\nconst math = require('../renderer/render-engine').math;\r\nconst RenderFlow = require('../renderer/render-flow');\r\n\r\n// ====== Node transform polyfills ======\r\nconst ONE_DEGREE = Math.PI / 180;\r\n\r\nconst POSITION_ON = 1 << 0;\r\nconst SCALE_ON = 1 << 1;\r\nconst ERR_INVALID_NUMBER = CC_EDITOR && 'The %s is invalid';\r\n\r\nfunction _updateLocalMatrix3d () {\r\n    if (this._localMatDirty) {\r\n        // Update transform\r\n        let t = this._matrix;\r\n        math.mat4.fromRTS(t, this._quat, this._position, this._scale);\r\n\r\n        // skew\r\n        if (this._skewX || this._skewY) {\r\n            let a = t.m00, b = t.m01, c = t.m04, d = t.m05;\r\n            let skx = Math.tan(this._skewX * ONE_DEGREE);\r\n            let sky = Math.tan(this._skewY * ONE_DEGREE);\r\n            if (skx === Infinity)\r\n                skx = 99999999;\r\n            if (sky === Infinity)\r\n                sky = 99999999;\r\n            t.m00 = a + c * sky;\r\n            t.m01 = b + d * sky;\r\n            t.m04 = c + a * skx;\r\n            t.m05 = d + b * skx;\r\n        }\r\n        this._localMatDirty = 0;\r\n        // Register dirty status of world matrix so that it can be recalculated\r\n        this._worldMatDirty = true;\r\n    }\r\n}\r\n\r\nfunction _calculWorldMatrix3d () {\r\n    // Avoid as much function call as possible\r\n    if (this._localMatDirty) {\r\n        this._updateLocalMatrix();\r\n    }\r\n\r\n    if (this._parent) {\r\n        let parentMat = this._parent._worldMatrix;\r\n        math.mat4.mul(this._worldMatrix, parentMat, this._matrix);\r\n    }\r\n    else {\r\n        math.mat4.copy(this._worldMatrix, this._matrix);\r\n    }\r\n    this._worldMatDirty = false;\r\n}\r\n\r\n\r\nfunction setPosition (newPosOrX, y, z) {\r\n    let x;\r\n    if (y === undefined) {\r\n        x = newPosOrX.x;\r\n        y = newPosOrX.y;\r\n        z = newPosOrX.z || 0;\r\n    }\r\n    else {\r\n        x = newPosOrX;\r\n        z = z || 0\r\n    }\r\n\r\n    let pos = this._position;\r\n    if (pos.x === x && pos.y === y && pos.z === z) {\r\n        return;\r\n    }\r\n\r\n    if (CC_EDITOR) {\r\n        var oldPosition = new cc.Vec3(pos);\r\n    }\r\n\r\n    pos.x = x;\r\n    pos.y = y;\r\n    pos.z = z;\r\n    this.setLocalDirty(DirtyFlag.POSITION);\r\n    this._renderFlag |= RenderFlow.FLAG_WORLD_TRANSFORM;\r\n\r\n    // fast check event\r\n    if (this._eventMask & POSITION_ON) {\r\n        if (CC_EDITOR) {\r\n            this.emit(EventType.POSITION_CHANGED, oldPosition);\r\n        }\r\n        else {\r\n            this.emit(EventType.POSITION_CHANGED);\r\n        }\r\n    }\r\n}\r\n\r\nfunction setScale (x, y, z) {\r\n    if (x && typeof x !== 'number') {\r\n        y = x.y;\r\n        z = x.z || 1;\r\n        x = x.x;\r\n    }\r\n    else if (x !== undefined && y === undefined) {\r\n        y = x;\r\n        z = x;\r\n    }\r\n    else if (z === undefined) {\r\n        z = 1;\r\n    }\r\n    if (this._scale.x !== x || this._scale.y !== y || this._scale.z !== z) {\r\n        this._scale.x = x;\r\n        this._scale.y = y;\r\n        this._scale.z = z;\r\n        this.setLocalDirty(DirtyFlag.SCALE);\r\n        this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n        if (this._eventMask & SCALE_ON) {\r\n            this.emit(EventType.SCALE_CHANGED);\r\n        }\r\n    }\r\n}\r\n\r\nfunction _update3DFunction () {\r\n    if (this._is3DNode) {\r\n        this._updateLocalMatrix = _updateLocalMatrix3d;\r\n        this._calculWorldMatrix = _calculWorldMatrix3d;\r\n        this._mulMat = cc.vmath.mat4.mul;\r\n    }\r\n    else {\r\n        this._updateLocalMatrix = _updateLocalMatrix2d;\r\n        this._calculWorldMatrix = _calculWorldMatrix2d;\r\n        this._mulMat = _mulMat2d;\r\n    }\r\n    if (this._renderComponent && this._renderComponent._on3DNodeChanged) {\r\n        this._renderComponent._on3DNodeChanged();\r\n    }\r\n    this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n    this._localMatDirty = DirtyFlag.ALL;\r\n}\r\n\r\nfunction _upgrade_1x_to_2x () {\r\n    if (this._is3DNode) {\r\n        this._update3DFunction();\r\n    }\r\n\r\n    _upgrade_1x_to_2x_2d.call(this);\r\n}\r\n\r\n\r\nlet proto = cc.Node.prototype;\r\nconst _updateLocalMatrix2d = proto._updateLocalMatrix;\r\nconst _calculWorldMatrix2d = proto._calculWorldMatrix;\r\nconst _upgrade_1x_to_2x_2d = proto._upgrade_1x_to_2x;\r\nconst _mulMat2d = proto._mulMat;\r\n\r\nproto.setPosition = setPosition;\r\nproto.setScale = setScale;\r\n\r\nproto._upgrade_1x_to_2x = _upgrade_1x_to_2x;\r\nproto._update3DFunction = _update3DFunction;\r\n\r\ncc.js.getset(proto, 'position', proto.getPosition, setPosition, false, true);\r\n\r\ncc.js.getset(proto, 'is3DNode', function () {\r\n    return this._is3DNode;\r\n}, function (v) {\r\n    if (this._is3DNode === v) return;\r\n    this._is3DNode = v;\r\n    this._update3DFunction();\r\n});\r\n\r\ncc.js.getset(proto, 'scaleZ', function () {\r\n    return this._scale.z;\r\n}, function (v) {\r\n    if (this._scale.z !== v) {\r\n        this._scale.z = v;\r\n        this.setLocalDirty(DirtyFlag.SCALE);\r\n        this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n        if (this._eventMask & SCALE_ON) {\r\n            this.emit(EventType.SCALE_CHANGED);\r\n        }\r\n    }\r\n});\r\n\r\ncc.js.getset(proto, 'z', function () {\r\n    return this._position.z;\r\n}, function (value) {\r\n    let localPosition = this._position;\r\n    if (value !== localPosition.z) {\r\n        if (!CC_EDITOR || isFinite(value)) {\r\n            localPosition.z = value;\r\n            this.setLocalDirty(DirtyFlag.POSITION);\r\n            this._renderFlag |= RenderFlow.FLAG_WORLD_TRANSFORM;\r\n            // fast check event\r\n            if (this._eventMask & POSITION_ON) {\r\n                this.emit(EventType.POSITION_CHANGED);\r\n            }\r\n        }\r\n        else {\r\n            cc.error(ERR_INVALID_NUMBER, 'new z');\r\n        }\r\n    }\r\n});\r\n\r\ncc.js.getset(proto, 'eulerAngles', function () {\r\n    if (CC_EDITOR) {\r\n        return this._eulerAngles;\r\n    }\r\n    else {\r\n        return this._quat.toEuler(cc.v3());\r\n    }\r\n}, function (v) {\r\n    if (CC_EDITOR) {\r\n        this._eulerAngles.set(v);\r\n    }\r\n\r\n    this._quat.fromEuler(v);\r\n    this.setLocalDirty(DirtyFlag.ROTATION);\r\n    this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n});\r\n\r\n// This property is used for Mesh Skeleton Animation\r\n// Should be rememoved when node.rotation upgrade to quaternion value\r\ncc.js.getset(proto, 'quat', function () {\r\n    return this._quat;\r\n}, proto.setRotation);\r\n","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst debugInfos = require('../../DebugInfos') || {};\r\nconst ERROR_MAP_URL = 'https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md';\r\n\r\n// the html element displays log in web page (DebugMode.INFO_FOR_WEB_PAGE)\r\nlet logList;\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\ncc.log = cc.warn = cc.error = cc.assert = console.log;\r\n\r\nlet resetDebugSetting = function (mode) {\r\n    // reset\r\n    cc.log = cc.warn = cc.error = cc.assert = function () {};\r\n\r\n    if (mode === DebugMode.NONE)\r\n        return;\r\n\r\n    if (mode > DebugMode.ERROR) {\r\n        //log to web page\r\n\r\n        function logToWebPage (msg) {\r\n            if (!cc.game.canvas)\r\n                return;\r\n\r\n            if (!logList) {\r\n                var logDiv = document.createElement(\"Div\");\r\n                logDiv.setAttribute(\"id\", \"logInfoDiv\");\r\n                logDiv.setAttribute(\"width\", \"200\");\r\n                logDiv.setAttribute(\"height\", cc.game.canvas.height);\r\n                var logDivStyle = logDiv.style;\r\n                logDivStyle.zIndex = \"99999\";\r\n                logDivStyle.position = \"absolute\";\r\n                logDivStyle.top = logDivStyle.left = \"0\";\r\n\r\n                logList = document.createElement(\"textarea\");\r\n                logList.setAttribute(\"rows\", \"20\");\r\n                logList.setAttribute(\"cols\", \"30\");\r\n                logList.setAttribute(\"disabled\", \"true\");\r\n                var logListStyle = logList.style;\r\n                logListStyle.backgroundColor = \"transparent\";\r\n                logListStyle.borderBottom = \"1px solid #cccccc\";\r\n                logListStyle.borderTopWidth = logListStyle.borderLeftWidth = logListStyle.borderRightWidth = \"0px\";\r\n                logListStyle.borderTopStyle = logListStyle.borderLeftStyle = logListStyle.borderRightStyle = \"none\";\r\n                logListStyle.padding = \"0px\";\r\n                logListStyle.margin = 0;\r\n\r\n                logDiv.appendChild(logList);\r\n                cc.game.canvas.parentNode.appendChild(logDiv);\r\n            }\r\n\r\n            logList.value = logList.value + msg + \"\\r\\n\";\r\n            logList.scrollTop = logList.scrollHeight;\r\n        }\r\n\r\n        cc.error = function () {\r\n            logToWebPage(\"ERROR :  \" + cc.js.formatStr.apply(null, arguments));\r\n        };\r\n        cc.assert = function (cond, msg) {\r\n            'use strict';\r\n            if (!cond && msg) {\r\n                msg = cc.js.formatStr.apply(null, cc.js.shiftArguments.apply(null, arguments));\r\n                logToWebPage(\"ASSERT: \" + msg);\r\n            }\r\n        };\r\n        if (mode !== DebugMode.ERROR_FOR_WEB_PAGE) {\r\n            cc.warn = function () {\r\n                logToWebPage(\"WARN :  \" + cc.js.formatStr.apply(null, arguments));\r\n            };\r\n        }\r\n        if (mode === DebugMode.INFO_FOR_WEB_PAGE) {\r\n            cc.log = function () {\r\n                logToWebPage(cc.js.formatStr.apply(null, arguments));\r\n            };\r\n        }\r\n    }\r\n    else if (console && console.log.apply) {//console is null when user doesn't open dev tool on IE9\r\n        //log to console\r\n\r\n        // For JSB\r\n        if (!console.error) console.error = console.log;\r\n        if (!console.warn) console.warn = console.log;\r\n\r\n        /**\r\n         * !#en\r\n         * Outputs an error message to the Cocos Creator Console (editor) or Web Console (runtime).<br/>\r\n         * - In Cocos Creator, error is red.<br/>\r\n         * - In Chrome, error have a red icon along with red message text.<br/>\r\n         * !#zh\r\n         *  Cocos Creator  Console  Console <br/>\r\n         * -  Cocos Creator <br/>\r\n         * -  Chrome <br/>\r\n         *\r\n         * @method error\r\n         * @param {any} msg - A JavaScript string containing zero or more substitution strings.\r\n         * @param {any} ...subst - JavaScript objects with which to replace substitution strings within msg. This gives you additional control over the format of the output.\r\n         */\r\n        if (CC_EDITOR) {\r\n            cc.error = Editor.error;\r\n        }\r\n        else if (console.error.bind) {\r\n            // use bind to avoid pollute call stacks\r\n            cc.error = console.error.bind(console);\r\n        }\r\n        else {\r\n            cc.error = CC_JSB ? console.error : function () {\r\n                return console.error.apply(console, arguments);\r\n            };\r\n        }\r\n        cc.assert = function (cond, msg) {\r\n            if (!cond) {\r\n                if (msg) {\r\n                    msg = cc.js.formatStr.apply(null, cc.js.shiftArguments.apply(null, arguments));\r\n                }\r\n                if (CC_DEV) {\r\n                    debugger;\r\n                }\r\n                if (CC_TEST) {\r\n                    ok(false, msg);\r\n                }\r\n                else {\r\n                    throw new Error(msg);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (mode !== DebugMode.ERROR) {\r\n        /**\r\n         * !#en\r\n         * Outputs a warning message to the Cocos Creator Console (editor) or Web Console (runtime).\r\n         * - In Cocos Creator, warning is yellow.\r\n         * - In Chrome, warning have a yellow warning icon with the message text.\r\n         * !#zh\r\n         *  Cocos Creator  Console  Web  Console <br/>\r\n         * -  Cocos Creator <br/>\r\n         * -  Chrome <br/>\r\n         * @method warn\r\n         * @param {any} msg - A JavaScript string containing zero or more substitution strings.\r\n         * @param {any} ...subst - JavaScript objects with which to replace substitution strings within msg. This gives you additional control over the format of the output.\r\n         */\r\n        if (CC_EDITOR) {\r\n            cc.warn = Editor.warn;\r\n        }\r\n        else if (console.warn.bind) {\r\n            // use bind to avoid pollute call stacks\r\n            cc.warn = console.warn.bind(console);\r\n        }\r\n        else {\r\n            cc.warn = CC_JSB ? console.warn : function () {\r\n                return console.warn.apply(console, arguments);\r\n            };\r\n        }\r\n    }\r\n    if (CC_EDITOR) {\r\n        cc.log = Editor.log;\r\n    }\r\n    else if (mode === DebugMode.INFO) {\r\n        /**\r\n         * !#en Outputs a message to the Cocos Creator Console (editor) or Web Console (runtime).\r\n         * !#zh  Cocos Creator  Console  Web  Console \r\n         * @method log\r\n         * @param {String|any} msg - A JavaScript string containing zero or more substitution strings.\r\n         * @param {any} ...subst - JavaScript objects with which to replace substitution strings within msg. This gives you additional control over the format of the output.\r\n         */\r\n        if (CC_JSB) {\r\n            if (scriptEngineType === \"JavaScriptCore\") {\r\n                // console.log has to use `console` as its context for iOS 8~9. Therefore, apply it.\r\n                cc.log = function () {\r\n                    return console.log.apply(console, arguments);\r\n                };\r\n            } else {\r\n                cc.log = console.log;\r\n            }\r\n        }\r\n        else if (console.log.bind) {\r\n            // use bind to avoid pollute call stacks\r\n            cc.log = console.log.bind(console);\r\n        }\r\n        else {\r\n            cc.log = function () {\r\n                return console.log.apply(console, arguments);\r\n            };\r\n        }\r\n    }\r\n};\r\n\r\ncc._throw = CC_EDITOR ? Editor.error : function (error) {\r\n    var stack = error.stack;\r\n    if (stack) {\r\n        cc.error(CC_JSB ? (error + '\\n' + stack) : stack);\r\n    }\r\n    else {\r\n        cc.error(error);\r\n    }\r\n};\r\n\r\nfunction getTypedFormatter (type) {\r\n    return function () {\r\n        var id = arguments[0];\r\n        var msg = CC_DEBUG ? (debugInfos[id] || 'unknown id') : `${type} ${id}, please go to ${ERROR_MAP_URL}#${id} to see details.`;\r\n        if (arguments.length === 1) {\r\n            return msg;\r\n        }\r\n        else if (arguments.length === 2) {\r\n            return CC_DEBUG ? cc.js.formatStr(msg, arguments[1]) :\r\n                msg + ' Arguments: ' + arguments[1];\r\n        }\r\n        else {\r\n            var argsArray = cc.js.shiftArguments.apply(null, arguments);\r\n            return CC_DEBUG ? cc.js.formatStr.apply(null, [msg].concat(argsArray)) :\r\n                msg + ' Arguments: ' + argsArray.join(', ');\r\n        }\r\n    };\r\n}\r\n\r\nvar logFormatter = getTypedFormatter('Log');\r\ncc.logID = function () {\r\n    cc.log(logFormatter.apply(null, arguments));\r\n};\r\n\r\nvar warnFormatter = getTypedFormatter('Warning');\r\ncc.warnID = function () {\r\n    cc.warn(warnFormatter.apply(null, arguments));\r\n};\r\n\r\nvar errorFormatter = getTypedFormatter('Error');\r\ncc.errorID = function () {\r\n    cc.error(errorFormatter.apply(null, arguments));\r\n};\r\n\r\nvar assertFormatter = getTypedFormatter('Assert');\r\ncc.assertID = function (cond) {\r\n    'use strict';\r\n    if (cond) {\r\n        return;\r\n    }\r\n    cc.assert(false, assertFormatter.apply(null, cc.js.shiftArguments.apply(null, arguments)));\r\n};\r\n\r\n/**\r\n* !#en Enum for debug modes.\r\n* !#zh \r\n* @enum debug.DebugMode\r\n* @memberof cc\r\n */\r\nvar DebugMode = cc.Enum({\r\n    /**\r\n     * !#en The debug mode none.\r\n     * !#zh \r\n     * @property NONE\r\n     * @type {Number}\r\n     * @static\r\n     */\r\n    NONE: 0,\r\n    /**\r\n     * !#en The debug mode info.\r\n     * !#zh  console \r\n     * @property INFO\r\n     * @type {Number}\r\n     * @static\r\n     */\r\n    INFO: 1,\r\n    /**\r\n     * !#en The debug mode warn.\r\n     * !#zh  console  warn  error\r\n     * @property WARN\r\n     * @type {Number}\r\n     * @static\r\n     */\r\n    WARN: 2,\r\n    /**\r\n     * !#en The debug mode error.\r\n     * !#zh  console  error \r\n     * @property ERROR\r\n     * @type {Number}\r\n     * @static\r\n     */\r\n    ERROR: 3,\r\n    /**\r\n     * !#en The debug mode info for web page.\r\n     * !#zh  WEB \r\n     * @property INFO_FOR_WEB_PAGE\r\n     * @type {Number}\r\n     * @static\r\n     */\r\n    INFO_FOR_WEB_PAGE: 4,\r\n    /**\r\n     * !#en The debug mode warn for web page.\r\n     * !#zh  WEB  warn  error\r\n     * @property WARN_FOR_WEB_PAGE\r\n     * @type {Number}\r\n     * @static\r\n     */\r\n    WARN_FOR_WEB_PAGE: 5,\r\n    /**\r\n     * !#en The debug mode error for web page.\r\n     * !#zh  WEB  error \r\n     * @property ERROR_FOR_WEB_PAGE\r\n     * @type {Number}\r\n     * @static\r\n     */\r\n    ERROR_FOR_WEB_PAGE: 6\r\n});\r\n/**\r\n * !#en An object to boot the game.\r\n * !#zh \r\n * @class debug\r\n * @main\r\n * @static\r\n */\r\nmodule.exports = cc.debug = {\r\n    DebugMode: DebugMode,\r\n\r\n    _resetDebugSetting: resetDebugSetting,\r\n\r\n    /**\r\n     * !#en Gets error message with the error id and possible parameters.\r\n     * !#zh  error id \r\n     * @method getError\r\n     * @param {id} errorId\r\n     * @param {any} [param]\r\n     * @return {String}\r\n     */\r\n    getError: getTypedFormatter('ERROR'),\r\n\r\n    /**\r\n     * !#en Returns whether or not to display the FPS informations.\r\n     * !#zh  FPS \r\n     * @method isDisplayStats\r\n     * @return {Boolean}\r\n     */\r\n    isDisplayStats: function () {\r\n        return cc.profiler ? cc.profiler.isShowingStats() : false;\r\n    },\r\n\r\n    /**\r\n     * !#en Sets whether display the FPS on the bottom-left corner.\r\n     * !#zh  FPS\r\n     * @method setDisplayStats\r\n     * @param {Boolean} displayStats\r\n     */\r\n    setDisplayStats: function (displayStats) {\r\n        if (cc.profiler) {\r\n            displayStats ? cc.profiler.showStats() : cc.profiler.hideStats();\r\n            cc.game.config.showFPS = !!displayStats;\r\n        }\r\n    },\r\n}","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst EventTarget = require('./event/event-target');\r\nconst AutoReleaseUtils = require('./load-pipeline/auto-release-utils');\r\nconst ComponentScheduler = require('./component-scheduler');\r\nconst NodeActivator = require('./node-activator');\r\nconst Obj = require('./platform/CCObject');\r\nconst game = require('./CCGame');\r\nconst renderer = require('./renderer');\r\nconst eventManager = require('./event-manager');\r\nconst Scheduler = require('./CCScheduler');\r\n\r\n//----------------------------------------------------------------------------------------------------------------------\r\n\r\n/**\r\n * !#en\r\n * <p>\r\n *    ATTENTION: USE cc.director INSTEAD OF cc.Director.<br/>\r\n *    cc.director is a singleton object which manage your game's logic flow.<br/>\r\n *    Since the cc.director is a singleton, you don't need to call any constructor or create functions,<br/>\r\n *    the standard way to use it is by calling:<br/>\r\n *      - cc.director.methodName(); <br/>\r\n *\r\n *    It creates and handle the main Window and manages how and when to execute the Scenes.<br/>\r\n *    <br/>\r\n *    The cc.director is also responsible for:<br/>\r\n *      - initializing the OpenGL context<br/>\r\n *      - setting the OpenGL pixel format (default on is RGB565)<br/>\r\n *      - setting the OpenGL buffer depth (default on is 0-bit)<br/>\r\n *      - setting the color for clear screen (default one is BLACK)<br/>\r\n *      - setting the projection (default one is 3D)<br/>\r\n *      - setting the orientation (default one is Portrait)<br/>\r\n *      <br/>\r\n *    <br/>\r\n *    The cc.director also sets the default OpenGL context:<br/>\r\n *      - GL_TEXTURE_2D is enabled<br/>\r\n *      - GL_VERTEX_ARRAY is enabled<br/>\r\n *      - GL_COLOR_ARRAY is enabled<br/>\r\n *      - GL_TEXTURE_COORD_ARRAY is enabled<br/>\r\n * </p>\r\n * <p>\r\n *   cc.director also synchronizes timers with the refresh rate of the display.<br/>\r\n *   Features and Limitations:<br/>\r\n *      - Scheduled timers & drawing are synchronizes with the refresh rate of the display<br/>\r\n *      - Only supports animation intervals of 1/60 1/30 & 1/15<br/>\r\n * </p>\r\n *\r\n * !#zh\r\n * <p>\r\n *      cc.director  cc.Director<br/>\r\n *     cc.director <br/>\r\n *      cc.director <br/>\r\n *     <br/>\r\n *       - cc.director.methodName();\r\n *     <br/>\r\n *     <br/>\r\n *     <br/>\r\n *     cc.director <br/>\r\n *      -  OpenGL <br/>\r\n *      - OpenGL( RGB565)<br/>\r\n *      - OpenGL ( 0-bit)<br/>\r\n *      -  ( )<br/>\r\n *      -  ( 3D)<br/>\r\n *      -  ( Portrait)<br/>\r\n *    <br/>\r\n *    cc.director  OpenGL  <br/>\r\n *      - GL_TEXTURE_2D   <br/>\r\n *      - GL_VERTEX_ARRAY <br/>\r\n *      - GL_COLOR_ARRAY  <br/>\r\n *      - GL_TEXTURE_COORD_ARRAY <br/>\r\n * </p>\r\n * <p>\r\n *   cc.director \r\n *   <br/>\r\n *   : <br/>\r\n *      -  & <br/>\r\n *      -  1/60 1/30 & 1/15<br/>\r\n * </p>\r\n *\r\n * @class Director\r\n * @extends EventTarget\r\n */\r\ncc.Director = function () {\r\n    EventTarget.call(this);\r\n\r\n    this.invalid = false;\r\n    // paused?\r\n    this._paused = false;\r\n    // purge?\r\n    this._purgeDirectorInNextLoop = false;\r\n\r\n    this._winSizeInPoints = null;\r\n\r\n    // scenes\r\n    this._loadingScene = '';\r\n    this._scene = null;\r\n\r\n    // FPS\r\n    this._totalFrames = 0;\r\n    this._lastUpdate = 0;\r\n    this._deltaTime = 0.0;\r\n\r\n    // Scheduler for user registration update\r\n    this._scheduler = null;\r\n    // Scheduler for life-cycle methods in component\r\n    this._compScheduler = null;\r\n    // Node activator\r\n    this._nodeActivator = null;\r\n    // Action manager\r\n    this._actionManager = null;\r\n\r\n    var self = this;\r\n    game.on(game.EVENT_SHOW, function () {\r\n        self._lastUpdate = performance.now();\r\n    });\r\n\r\n    game.once(game.EVENT_ENGINE_INITED, this.init, this);\r\n};\r\n\r\ncc.Director.prototype = {\r\n    constructor: cc.Director,\r\n    init: function () {\r\n        this._totalFrames = 0;\r\n        this._lastUpdate = performance.now();\r\n        this._paused = false;\r\n        this._purgeDirectorInNextLoop = false;\r\n        this._winSizeInPoints = cc.size(0, 0);\r\n        this._scheduler = new Scheduler();\r\n\r\n        if (cc.ActionManager) {\r\n            this._actionManager = new cc.ActionManager();\r\n            this._scheduler.scheduleUpdate(this._actionManager, Scheduler.PRIORITY_SYSTEM, false);\r\n        } else {\r\n            this._actionManager = null;\r\n        }\r\n\r\n        this.sharedInit();\r\n        return true;\r\n    },\r\n\r\n    /*\r\n     * Manage all init process shared between the web engine and jsb engine.\r\n     * All platform independent init process should be occupied here.\r\n     */\r\n    sharedInit: function () {\r\n        this._compScheduler = new ComponentScheduler();\r\n        this._nodeActivator = new NodeActivator();\r\n\r\n        // Event manager\r\n        if (eventManager) {\r\n            eventManager.setEnabled(true);\r\n        }\r\n\r\n        // Animation manager\r\n        if (cc.AnimationManager) {\r\n            this._animationManager = new cc.AnimationManager();\r\n            this._scheduler.scheduleUpdate(this._animationManager, Scheduler.PRIORITY_SYSTEM, false);\r\n        }\r\n        else {\r\n            this._animationManager = null;\r\n        }\r\n\r\n        // collision manager\r\n        if (cc.CollisionManager) {\r\n            this._collisionManager = new cc.CollisionManager();\r\n            this._scheduler.scheduleUpdate(this._collisionManager, Scheduler.PRIORITY_SYSTEM, false);\r\n        }\r\n        else {\r\n            this._collisionManager = null;\r\n        }\r\n\r\n        // physics manager\r\n        if (cc.PhysicsManager) {\r\n            this._physicsManager = new cc.PhysicsManager();\r\n            this._scheduler.scheduleUpdate(this._physicsManager, Scheduler.PRIORITY_SYSTEM, false);\r\n        }\r\n        else {\r\n            this._physicsManager = null;\r\n        }\r\n\r\n        // WidgetManager\r\n        if (cc._widgetManager) {\r\n            cc._widgetManager.init(this);\r\n        }\r\n\r\n        cc.loader.init(this);\r\n    },\r\n\r\n    /**\r\n     * calculates delta time since last time it was called\r\n     */\r\n    calculateDeltaTime: function () {\r\n        var now = performance.now();\r\n\r\n        this._deltaTime = (now - this._lastUpdate) / 1000;\r\n        if (CC_DEBUG && (this._deltaTime > 1))\r\n            this._deltaTime = 1 / 60.0;\r\n\r\n        this._lastUpdate = now;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Converts a view coordinate to an WebGL coordinate<br/>\r\n     * Useful to convert (multi) touches coordinates to the current layout (portrait or landscape)<br/>\r\n     * Implementation can be found in CCDirectorWebGL.\r\n     * !#zh  WebGL View \r\n     * @method convertToGL\r\n     * @param {Vec2} uiPoint\r\n     * @return {Vec2}\r\n     * @deprecated since v2.0\r\n     */\r\n    convertToGL: function (uiPoint) {\r\n        var container = game.container;\r\n        var view = cc.view;\r\n        var box = container.getBoundingClientRect();\r\n        var left = box.left + window.pageXOffset - container.clientLeft;\r\n        var top = box.top + window.pageYOffset - container.clientTop;\r\n        var x = view._devicePixelRatio * (uiPoint.x - left);\r\n        var y = view._devicePixelRatio * (top + box.height - uiPoint.y);\r\n        return view._isRotated ? cc.v2(view._viewportRect.width - y, x) : cc.v2(x, y);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Converts an OpenGL coordinate to a view coordinate<br/>\r\n     * Useful to convert node points to window points for calls such as glScissor<br/>\r\n     * Implementation can be found in CCDirectorWebGL.\r\n     * !#zh  WebGL View \r\n     * @method convertToUI\r\n     * @param {Vec2} glPoint\r\n     * @return {Vec2}\r\n     * @deprecated since v2.0\r\n     */\r\n    convertToUI: function (glPoint) {\r\n        var container = game.container;\r\n        var view = cc.view;\r\n        var box = container.getBoundingClientRect();\r\n        var left = box.left + window.pageXOffset - container.clientLeft;\r\n        var top = box.top + window.pageYOffset - container.clientTop;\r\n        var uiPoint = cc.v2(0, 0);\r\n        if (view._isRotated) {\r\n            uiPoint.x = left + glPoint.y / view._devicePixelRatio;\r\n            uiPoint.y = top + box.height - (view._viewportRect.width - glPoint.x) / view._devicePixelRatio;\r\n        }\r\n        else {\r\n            uiPoint.x = left + glPoint.x * view._devicePixelRatio;\r\n            uiPoint.y = top + box.height - glPoint.y * view._devicePixelRatio;\r\n        }\r\n        return uiPoint;\r\n    },\r\n\r\n    /**\r\n     * End the life of director in the next frame\r\n     * @method end\r\n     */\r\n    end: function () {\r\n        this._purgeDirectorInNextLoop = true;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the size of the WebGL view in points.<br/>\r\n     * It takes into account any possible rotation (device orientation) of the window.\r\n     * !#zh \r\n     * @method getWinSize\r\n     * @return {Size}\r\n     * @deprecated since v2.0\r\n     */\r\n    getWinSize: function () {\r\n        return cc.size(cc.winSize);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the size of the OpenGL view in pixels.<br/>\r\n     * It takes into account any possible rotation (device orientation) of the window.<br/>\r\n     * On Mac winSize and winSizeInPixels return the same value.\r\n     * (The pixel here refers to the resource resolution. If you want to get the physics resolution of device, you need to use cc.view.getFrameSize())\r\n     * !#zh\r\n     * \r\n     *  cc.view.getFrameSize()\r\n     * @method getWinSizeInPixels\r\n     * @return {Size}\r\n     * @deprecated since v2.0\r\n     */\r\n    getWinSizeInPixels: function () {\r\n        return cc.size(cc.winSize);\r\n    },\r\n\r\n    /**\r\n     * !#en Pause the director's ticker, only involve the game logic execution.\r\n     * It won't pause the rendering process nor the event manager.\r\n     * If you want to pause the entier game including rendering, audio and event, \r\n     * please use {{#crossLink \"Game.pause\"}}cc.game.pause{{/crossLink}}\r\n     * !#zh  UI \r\n     *  {{#crossLink \"Game.pause\"}}cc.game.pause{{/crossLink}}\r\n     * @method pause\r\n     */\r\n    pause: function () {\r\n        if (this._paused)\r\n            return;\r\n        this._paused = true;\r\n    },\r\n\r\n    /**\r\n     * Removes cached all cocos2d cached data.\r\n     * @deprecated since v2.0\r\n     */\r\n    purgeCachedData: function () {\r\n        cc.loader.releaseAll();\r\n    },\r\n\r\n    /**\r\n     * Purge the cc.director itself, including unschedule all schedule, remove all event listeners, clean up and exit the running scene, stops all animations, clear cached data.\r\n     */\r\n    purgeDirector: function () {\r\n        //cleanup scheduler\r\n        this._scheduler.unscheduleAll();\r\n        this._compScheduler.unscheduleAll();\r\n\r\n        this._nodeActivator.reset();\r\n\r\n        // Disable event dispatching\r\n        if (eventManager)\r\n            eventManager.setEnabled(false);\r\n\r\n        cc.renderer.clear();\r\n\r\n        if (!CC_EDITOR) {\r\n            if (cc.isValid(this._scene)) {\r\n                this._scene.destroy();\r\n            }\r\n            this._scene = null;\r\n        }\r\n\r\n        this.stopAnimation();\r\n\r\n        // Clear all caches\r\n        cc.loader.releaseAll();\r\n    },\r\n\r\n    /**\r\n     * Reset the cc.director, can be used to restart the director after purge\r\n     */\r\n    reset: function () {\r\n        this.purgeDirector();\r\n\r\n        if (eventManager)\r\n            eventManager.setEnabled(true);\r\n\r\n        // Action manager\r\n        if (this._actionManager){\r\n            this._scheduler.scheduleUpdate(this._actionManager, cc.Scheduler.PRIORITY_SYSTEM, false);\r\n        }\r\n\r\n        // Animation manager\r\n        if (this._animationManager) {\r\n            this._scheduler.scheduleUpdate(this._animationManager, cc.Scheduler.PRIORITY_SYSTEM, false);\r\n        }\r\n\r\n        // Collider manager\r\n        if (this._collisionManager) {\r\n            this._scheduler.scheduleUpdate(this._collisionManager, cc.Scheduler.PRIORITY_SYSTEM, false);\r\n        }\r\n\r\n        // Physics manager\r\n        if (this._physicsManager) {\r\n            this._scheduler.scheduleUpdate(this._physicsManager, cc.Scheduler.PRIORITY_SYSTEM, false);\r\n        }\r\n\r\n        this.startAnimation();\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Run a scene. Replaces the running scene with a new one or enter the first scene.<br/>\r\n     * The new scene will be launched immediately.\r\n     * !#zh \r\n     * @method runSceneImmediate\r\n     * @param {Scene} scene - The need run scene.\r\n     * @param {Function} [onBeforeLoadScene] - The function invoked at the scene before loading.\r\n     * @param {Function} [onLaunched] - The function invoked at the scene after launch.\r\n     */\r\n    runSceneImmediate: function (scene, onBeforeLoadScene, onLaunched) {\r\n        cc.assertID(scene instanceof cc.Scene, 1216);\r\n\r\n        CC_BUILD && CC_DEBUG && console.time('InitScene');\r\n        scene._load();  // ensure scene initialized\r\n        CC_BUILD && CC_DEBUG && console.timeEnd('InitScene');\r\n\r\n        // Re-attach or replace persist nodes\r\n        CC_BUILD && CC_DEBUG && console.time('AttachPersist');\r\n        var persistNodeList = Object.keys(game._persistRootNodes).map(function (x) {\r\n            return game._persistRootNodes[x];\r\n        });\r\n        for (let i = 0; i < persistNodeList.length; i++) {\r\n            let node = persistNodeList[i];\r\n            var existNode = scene.getChildByUuid(node.uuid);\r\n            if (existNode) {\r\n                // scene also contains the persist node, select the old one\r\n                var index = existNode.getSiblingIndex();\r\n                existNode._destroyImmediate();\r\n                scene.insertChild(node, index);\r\n            }\r\n            else {\r\n                node.parent = scene;\r\n            }\r\n        }\r\n        CC_BUILD && CC_DEBUG && console.timeEnd('AttachPersist');\r\n\r\n        var oldScene = this._scene;\r\n        if (!CC_EDITOR) {\r\n            // auto release assets\r\n            CC_BUILD && CC_DEBUG && console.time('AutoRelease');\r\n            var autoReleaseAssets = oldScene && oldScene.autoReleaseAssets && oldScene.dependAssets;\r\n            AutoReleaseUtils.autoRelease(autoReleaseAssets, scene.dependAssets, persistNodeList);\r\n            CC_BUILD && CC_DEBUG && console.timeEnd('AutoRelease');\r\n        }\r\n\r\n        // unload scene\r\n        CC_BUILD && CC_DEBUG && console.time('Destroy');\r\n        if (cc.isValid(oldScene)) {\r\n            oldScene.destroy();\r\n        }\r\n\r\n        this._scene = null;\r\n\r\n        // purge destroyed nodes belongs to old scene\r\n        Obj._deferredDestroy();\r\n        CC_BUILD && CC_DEBUG && console.timeEnd('Destroy');\r\n\r\n        if (onBeforeLoadScene) {\r\n            onBeforeLoadScene();\r\n        }\r\n        this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH, scene);\r\n\r\n        // Run an Entity Scene\r\n        this._scene = scene;\r\n\r\n        CC_BUILD && CC_DEBUG && console.time('Activate');\r\n        scene._activate();\r\n        CC_BUILD && CC_DEBUG && console.timeEnd('Activate');\r\n\r\n        //start scene\r\n        this.startAnimation();\r\n\r\n        if (onLaunched) {\r\n            onLaunched(null, scene);\r\n        }\r\n        this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH, scene);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Run a scene. Replaces the running scene with a new one or enter the first scene.\r\n     * The new scene will be launched at the end of the current frame.\r\n     * !#zh \r\n     * @method runScene\r\n     * @param {Scene} scene - The need run scene.\r\n     * @param {Function} [onBeforeLoadScene] - The function invoked at the scene before loading.\r\n     * @param {Function} [onLaunched] - The function invoked at the scene after launch.\r\n     * @private\r\n     */\r\n    runScene: function (scene, onBeforeLoadScene, onLaunched) {\r\n        cc.assertID(scene, 1205);\r\n        cc.assertID(scene instanceof cc.Scene, 1216);\r\n\r\n        // ensure scene initialized\r\n        scene._load();\r\n\r\n        // Delay run / replace scene to the end of the frame\r\n        this.once(cc.Director.EVENT_AFTER_UPDATE, function () {\r\n            this.runSceneImmediate(scene, onBeforeLoadScene, onLaunched);\r\n        }, this);\r\n    },\r\n\r\n    //  @Scene loading section\r\n\r\n    _getSceneUuid: function (key) {\r\n        var scenes = game._sceneInfos;\r\n        if (typeof key === 'string') {\r\n            if (!key.endsWith('.fire')) {\r\n                key += '.fire';\r\n            }\r\n            if (key[0] !== '/' && !key.startsWith('db://')) {\r\n                key = '/' + key;    // \r\n            }\r\n            // search scene\r\n            for (var i = 0; i < scenes.length; i++) {\r\n                var info = scenes[i];\r\n                if (info.url.endsWith(key)) {\r\n                    return info;\r\n                }\r\n            }\r\n        }\r\n        else if (typeof key === 'number') {\r\n            if (0 <= key && key < scenes.length) {\r\n                return scenes[key];\r\n            }\r\n            else {\r\n                cc.errorID(1206, key);\r\n            }\r\n        }\r\n        else {\r\n            cc.errorID(1207, key);\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * !#en Loads the scene by its name.\r\n     * !#zh \r\n     *\r\n     * @method loadScene\r\n     * @param {String} sceneName - The name of the scene to load.\r\n     * @param {Function} [onLaunched] - callback, will be called after scene launched.\r\n     * @return {Boolean} if error, return false\r\n     */\r\n    loadScene: function (sceneName, onLaunched, _onUnloaded) {\r\n        if (this._loadingScene) {\r\n            cc.errorID(1208, sceneName, this._loadingScene);\r\n            return false;\r\n        }\r\n        var info = this._getSceneUuid(sceneName);\r\n        if (info) {\r\n            var uuid = info.uuid;\r\n            this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING, sceneName);\r\n            this._loadingScene = sceneName;\r\n            this._loadSceneByUuid(uuid, onLaunched, _onUnloaded);\r\n            return true;\r\n        }\r\n        else {\r\n            cc.errorID(1209, sceneName);\r\n            return false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Preloads the scene to reduces loading time. You can call this method at any time you want.\r\n     * After calling this method, you still need to launch the scene by `cc.director.loadScene`.\r\n     * It will be totally fine to call `cc.director.loadScene` at any time even if the preloading is not\r\n     * yet finished, the scene will be launched after loaded automatically.\r\n     * !#zh \r\n     *  `cc.director.loadScene` \r\n     *  `cc.director.loadScene`\r\n     *\r\n     * @method preloadScene\r\n     * @param {String} sceneName - The name of the scene to preload.\r\n     * @param {Function} [onProgress] - callback, will be called when the load progression change.\r\n     * @param {Number} onProgress.completedCount - The number of the items that are already completed\r\n     * @param {Number} onProgress.totalCount - The total number of the items\r\n     * @param {Object} onProgress.item - The latest item which flow out the pipeline\r\n     * @param {Function} [onLoaded] - callback, will be called after scene loaded.\r\n     * @param {Error} onLoaded.error - null or the error object.\r\n     */\r\n    preloadScene: function (sceneName, onProgress, onLoaded) {\r\n        if (onLoaded === undefined) {\r\n            onLoaded = onProgress;\r\n            onProgress = null;\r\n        }\r\n\r\n        var info = this._getSceneUuid(sceneName);\r\n        if (info) {\r\n            this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING, sceneName);\r\n            cc.loader.load({ uuid: info.uuid, type: 'uuid' }, \r\n                onProgress,    \r\n                function (error, asset) {\r\n                    if (error) {\r\n                        cc.errorID(1210, sceneName, error.message);\r\n                    }\r\n                    if (onLoaded) {\r\n                        onLoaded(error, asset);\r\n                    }\r\n                });       \r\n        }\r\n        else {\r\n            var error = 'Can not preload the scene \"' + sceneName + '\" because it is not in the build settings.';\r\n            onLoaded(new Error(error));\r\n            cc.error('preloadScene: ' + error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Loads the scene by its uuid.\r\n     * @method _loadSceneByUuid\r\n     * @param {String} uuid - the uuid of the scene asset to load\r\n     * @param {Function} [onLaunched]\r\n     * @param {Function} [onUnloaded]\r\n     * @param {Boolean} [dontRunScene] - Just download and initialize the scene but will not launch it,\r\n     *                                   only take effect in the Editor.\r\n     * @private\r\n     */\r\n    _loadSceneByUuid: function (uuid, onLaunched, onUnloaded, dontRunScene) {\r\n        if (CC_EDITOR) {\r\n            if (typeof onLaunched === 'boolean') {\r\n                dontRunScene = onLaunched;\r\n                onLaunched = null;\r\n            }\r\n            if (typeof onUnloaded === 'boolean') {\r\n                dontRunScene = onUnloaded;\r\n                onUnloaded = null;\r\n            }\r\n        }\r\n        //cc.AssetLibrary.unloadAsset(uuid);     // force reload\r\n        console.time('LoadScene ' + uuid);\r\n        cc.AssetLibrary.loadAsset(uuid, function (error, sceneAsset) {\r\n            console.timeEnd('LoadScene ' + uuid);\r\n            var self = cc.director;\r\n            self._loadingScene = '';\r\n            if (error) {\r\n                error = 'Failed to load scene: ' + error;\r\n                cc.error(error);\r\n            }\r\n            else {\r\n                if (sceneAsset instanceof cc.SceneAsset) {\r\n                    var scene = sceneAsset.scene;\r\n                    scene._id = sceneAsset._uuid;\r\n                    scene._name = sceneAsset._name;\r\n                    if (CC_EDITOR) {\r\n                        if (!dontRunScene) {\r\n                            self.runSceneImmediate(scene, onUnloaded, onLaunched);\r\n                        }\r\n                        else {\r\n                            scene._load();\r\n                            if (onLaunched) {\r\n                                onLaunched(null, scene);\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        self.runSceneImmediate(scene, onUnloaded, onLaunched);\r\n                    }\r\n                    return;\r\n                }\r\n                else {\r\n                    error = 'The asset ' + uuid + ' is not a scene';\r\n                    cc.error(error);\r\n                }\r\n            }\r\n            if (onLaunched) {\r\n                onLaunched(error);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * !#en Resume game logic execution after pause, if the current scene is not paused, nothing will happen.\r\n     * !#zh \r\n     * @method resume\r\n     */\r\n    resume: function () {\r\n        if (!this._paused) {\r\n            return;\r\n        }\r\n\r\n        this._lastUpdate = performance.now();\r\n        if (!this._lastUpdate) {\r\n            cc.logID(1200);\r\n        }\r\n\r\n        this._paused = false;\r\n        this._deltaTime = 0;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Enables or disables WebGL depth test.<br/>\r\n     * Implementation can be found in CCDirectorCanvas.js/CCDirectorWebGL.js\r\n     * !#zh / Canvas \r\n     * @method setDepthTest\r\n     * @param {Boolean} on\r\n     * @deprecated since v2.0\r\n     */\r\n    setDepthTest: function (value) {\r\n        if (!cc.Camera.main) {\r\n            return;\r\n        }\r\n        cc.Camera.main.depth = !!value;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Set color for clear screen.<br/>\r\n     * (Implementation can be found in CCDirectorCanvas.js/CCDirectorWebGL.js)\r\n     * !#zh\r\n     * <br/>\r\n     *  cc.macro.ENABLE_TRANSPARENT_CANVAS\r\n     * @method setClearColor\r\n     * @param {Color} clearColor\r\n     * @deprecated since v2.0\r\n     */\r\n    setClearColor: function (clearColor) {\r\n        if (!cc.Camera.main) {\r\n            return;\r\n        }\r\n        cc.Camera.main.backgroundColor = clearColor;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns current logic Scene.\r\n     * !#zh \r\n     * @method getRunningScene\r\n     * @private\r\n     * @return {Scene}\r\n     * @deprecated since v2.0\r\n     */\r\n    getRunningScene: function () {\r\n        return this._scene;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns current logic Scene.\r\n     * !#zh \r\n     * @method getScene\r\n     * @return {Scene}\r\n     * @example\r\n     *  // This will help you to get the Canvas node in scene\r\n     *  cc.director.getScene().getChildByName('Canvas');\r\n     */\r\n    getScene: function () {\r\n        return this._scene;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the FPS value. Please use {{#crossLink \"Game.setFrameRate\"}}cc.game.setFrameRate{{/crossLink}} to control animation interval.\r\n     * !#zh  {{#crossLink \"Game.setFrameRate\"}}cc.game.setFrameRate{{/crossLink}} \r\n     * @method getAnimationInterval\r\n     * @deprecated since v2.0\r\n     * @return {Number}\r\n     */\r\n    getAnimationInterval: function () {\r\n        return 1000 / game.getFrameRate();\r\n    },\r\n\r\n    /**\r\n     * Sets animation interval, this doesn't control the main loop.\r\n     * To control the game's frame rate overall, please use {{#crossLink \"Game.setFrameRate\"}}cc.game.setFrameRate{{/crossLink}}\r\n     * @method setAnimationInterval\r\n     * @deprecated since v2.0\r\n     * @param {Number} value - The animation interval desired.\r\n     */\r\n    setAnimationInterval: function (value) {\r\n        game.setFrameRate(Math.round(1000 / value));\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the delta time since last frame.\r\n     * !#zh \r\n     * @method getDeltaTime\r\n     * @return {Number}\r\n     */\r\n    getDeltaTime: function () {\r\n        return this._deltaTime;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns how many frames were called since the director started.\r\n     * !#zh  director \r\n     * @method getTotalFrames\r\n     * @return {Number}\r\n     */\r\n    getTotalFrames: function () {\r\n        return this._totalFrames;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns whether or not the Director is paused.\r\n     * !#zh \r\n     * @method isPaused\r\n     * @return {Boolean}\r\n     */\r\n    isPaused: function () {\r\n        return this._paused;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the cc.Scheduler associated with this director.\r\n     * !#zh  director  cc.Scheduler\r\n     * @method getScheduler\r\n     * @return {Scheduler}\r\n     */\r\n    getScheduler: function () {\r\n        return this._scheduler;\r\n    },\r\n\r\n    /**\r\n     * !#en Sets the cc.Scheduler associated with this director.\r\n     * !#zh  director  cc.Scheduler\r\n     * @method setScheduler\r\n     * @param {Scheduler} scheduler\r\n     */\r\n    setScheduler: function (scheduler) {\r\n        if (this._scheduler !== scheduler) {\r\n            this._scheduler = scheduler;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the cc.ActionManager associated with this director.\r\n     * !#zh  director  cc.ActionManager\r\n     * @method getActionManager\r\n     * @return {ActionManager}\r\n     */\r\n    getActionManager: function () {\r\n        return this._actionManager;\r\n    },\r\n    /**\r\n     * !#en Sets the cc.ActionManager associated with this director.\r\n     * !#zh  director  cc.ActionManager\r\n     * @method setActionManager\r\n     * @param {ActionManager} actionManager\r\n     */\r\n    setActionManager: function (actionManager) {\r\n        if (this._actionManager !== actionManager) {\r\n            if (this._actionManager) {\r\n                this._scheduler.unscheduleUpdate(this._actionManager);\r\n            }\r\n            this._actionManager = actionManager;\r\n            this._scheduler.scheduleUpdate(this._actionManager, cc.Scheduler.PRIORITY_SYSTEM, false);\r\n        }\r\n    },\r\n\r\n    /* \r\n     * !#en Returns the cc.AnimationManager associated with this director.\r\n     * !#zh  director  cc.AnimationManager\r\n     * @method getAnimationManager\r\n     * @return {AnimationManager}\r\n     */\r\n    getAnimationManager: function () {\r\n        return this._animationManager;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the cc.CollisionManager associated with this director.\r\n     * !#zh  director  cc.CollisionManager \r\n     * @method getCollisionManager\r\n     * @return {CollisionManager}\r\n     */\r\n    getCollisionManager: function () {\r\n        return this._collisionManager;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the cc.PhysicsManager associated with this director.\r\n     * !#zh  director  cc.PhysicsManager \r\n     * @method getPhysicsManager\r\n     * @return {PhysicsManager}\r\n     */\r\n    getPhysicsManager: function () {\r\n        return this._physicsManager;\r\n    },\r\n\r\n    // Loop management\r\n    /*\r\n     * Starts Animation\r\n     */\r\n    startAnimation: function () {\r\n        this.invalid = false;\r\n        this._lastUpdate = performance.now();\r\n    },\r\n\r\n    /*\r\n     * Stops animation\r\n     */\r\n    stopAnimation: function () {\r\n        this.invalid = true;\r\n    },\r\n\r\n    /*\r\n     * Run main loop of director\r\n     */\r\n    mainLoop: CC_EDITOR ? function (deltaTime, updateAnimate) {\r\n        this._deltaTime = deltaTime;\r\n\r\n        // Update\r\n        if (!this._paused) {\r\n            this.emit(cc.Director.EVENT_BEFORE_UPDATE);\r\n\r\n            this._compScheduler.startPhase();\r\n            this._compScheduler.updatePhase(deltaTime);\r\n\r\n            if (updateAnimate) {\r\n                this._scheduler.update(deltaTime);\r\n            }\r\n\r\n            this._compScheduler.lateUpdatePhase(deltaTime);\r\n\r\n            this.emit(cc.Director.EVENT_AFTER_UPDATE);\r\n        }\r\n\r\n        // Render\r\n        this.emit(cc.Director.EVENT_BEFORE_DRAW);\r\n        renderer.render(this._scene);\r\n        \r\n        // After draw\r\n        this.emit(cc.Director.EVENT_AFTER_DRAW);\r\n\r\n        this._totalFrames++;\r\n\r\n    } : function () {\r\n        if (this._purgeDirectorInNextLoop) {\r\n            this._purgeDirectorInNextLoop = false;\r\n            this.purgeDirector();\r\n        }\r\n        else if (!this.invalid) {\r\n            // calculate \"global\" dt\r\n            this.calculateDeltaTime();\r\n\r\n            // Update\r\n            if (!this._paused) {\r\n                this.emit(cc.Director.EVENT_BEFORE_UPDATE);\r\n                // Call start for new added components\r\n                this._compScheduler.startPhase();\r\n                // Update for components\r\n                this._compScheduler.updatePhase(this._deltaTime);\r\n                // Engine update with scheduler\r\n                this._scheduler.update(this._deltaTime);\r\n                // Late update for components\r\n                this._compScheduler.lateUpdatePhase(this._deltaTime);\r\n                // User can use this event to do things after update\r\n                this.emit(cc.Director.EVENT_AFTER_UPDATE);\r\n                // Destroy entities that have been removed recently\r\n                Obj._deferredDestroy();\r\n            }\r\n\r\n            // Render\r\n            this.emit(cc.Director.EVENT_BEFORE_DRAW);\r\n            renderer.render(this._scene);\r\n\r\n            // After draw\r\n            this.emit(cc.Director.EVENT_AFTER_DRAW);\r\n\r\n            eventManager.frameUpdateListeners();\r\n            this._totalFrames++;\r\n        }\r\n    },\r\n\r\n    __fastOn: function (type, callback, target) {\r\n        this.add(type, callback, target);\r\n    },\r\n\r\n    __fastOff: function (type, callback, target) {\r\n        this.remove(type, callback, target);\r\n    },\r\n};\r\n\r\n// Event target\r\ncc.js.addon(cc.Director.prototype, EventTarget.prototype);\r\n\r\n/**\r\n * !#en The event projection changed of cc.Director. This event will not get triggered since v2.0\r\n * !#zh cc.Director  v2.0 \r\n * @property {String} EVENT_PROJECTION_CHANGED\r\n * @readonly\r\n * @static\r\n * @deprecated since v2.0\r\n */\r\ncc.Director.EVENT_PROJECTION_CHANGED = \"director_projection_changed\";\r\n\r\n/**\r\n * !#en The event which will be triggered before loading a new scene.\r\n * !#zh \r\n * @event cc.Director.EVENT_BEFORE_SCENE_LOADING\r\n * @param {String} sceneName - The loading scene name\r\n */\r\n/**\r\n * !#en The event which will be triggered before loading a new scene.\r\n * !#zh \r\n * @property {String} EVENT_BEFORE_SCENE_LOADING\r\n * @readonly\r\n * @static\r\n */\r\ncc.Director.EVENT_BEFORE_SCENE_LOADING = \"director_before_scene_loading\";\r\n\r\n/*\r\n * !#en The event which will be triggered before launching a new scene.\r\n * !#zh \r\n * @event cc.Director.EVENT_BEFORE_SCENE_LAUNCH\r\n * @param {String} sceneName - New scene which will be launched\r\n */\r\n/**\r\n * !#en The event which will be triggered before launching a new scene.\r\n * !#zh \r\n * @property {String} EVENT_BEFORE_SCENE_LAUNCH\r\n * @readonly\r\n * @static\r\n */\r\ncc.Director.EVENT_BEFORE_SCENE_LAUNCH = \"director_before_scene_launch\";\r\n\r\n/**\r\n * !#en The event which will be triggered after launching a new scene.\r\n * !#zh \r\n * @event cc.Director.EVENT_AFTER_SCENE_LAUNCH\r\n * @param {String} sceneName - New scene which is launched\r\n */\r\n/**\r\n * !#en The event which will be triggered after launching a new scene.\r\n * !#zh \r\n * @property {String} EVENT_AFTER_SCENE_LAUNCH\r\n * @readonly\r\n * @static\r\n */\r\ncc.Director.EVENT_AFTER_SCENE_LAUNCH = \"director_after_scene_launch\";\r\n\r\n/**\r\n * !#en The event which will be triggered at the beginning of every frame.\r\n * !#zh \r\n * @event cc.Director.EVENT_BEFORE_UPDATE\r\n */\r\n/**\r\n * !#en The event which will be triggered at the beginning of every frame.\r\n * !#zh \r\n * @property {String} EVENT_BEFORE_UPDATE\r\n * @readonly\r\n * @static\r\n */\r\ncc.Director.EVENT_BEFORE_UPDATE = \"director_before_update\";\r\n\r\n/**\r\n * !#en The event which will be triggered after engine and components update logic.\r\n * !#zh  update \r\n * @event cc.Director.EVENT_AFTER_UPDATE\r\n */\r\n/**\r\n * !#en The event which will be triggered after engine and components update logic.\r\n * !#zh  update \r\n * @property {String} EVENT_AFTER_UPDATE\r\n * @readonly\r\n * @static\r\n */\r\ncc.Director.EVENT_AFTER_UPDATE = \"director_after_update\";\r\n\r\n/**\r\n * !#en The event is deprecated since v2.0, please use cc.Director.EVENT_BEFORE_DRAW instead\r\n * !#zh  v2.0  cc.Director.EVENT_BEFORE_DRAW\r\n * @property {String} EVENT_BEFORE_VISIT\r\n * @readonly\r\n * @deprecated since v2.0\r\n * @static\r\n */\r\ncc.Director.EVENT_BEFORE_VISIT = \"director_before_draw\";\r\n\r\n/**\r\n * !#en The event is deprecated since v2.0, please use cc.Director.EVENT_BEFORE_DRAW instead\r\n * !#zh  v2.0  cc.Director.EVENT_BEFORE_DRAW\r\n * @property {String} EVENT_AFTER_VISIT\r\n * @readonly\r\n * @deprecated since v2.0\r\n * @static\r\n */\r\ncc.Director.EVENT_AFTER_VISIT = \"director_before_draw\";\r\n\r\n/**\r\n * !#en The event which will be triggered before the rendering process.\r\n * !#zh \r\n * @event cc.Director.EVENT_BEFORE_DRAW\r\n */\r\n/**\r\n * !#en The event which will be triggered before the rendering process.\r\n * !#zh \r\n * @property {String} EVENT_BEFORE_DRAW\r\n * @readonly\r\n * @static\r\n */\r\ncc.Director.EVENT_BEFORE_DRAW = \"director_before_draw\";\r\n\r\n/**\r\n * !#en The event which will be triggered after the rendering process.\r\n * !#zh \r\n * @event cc.Director.EVENT_AFTER_DRAW\r\n */\r\n/**\r\n * !#en The event which will be triggered after the rendering process.\r\n * !#zh \r\n * @property {String} EVENT_AFTER_DRAW\r\n * @readonly\r\n * @static\r\n */\r\ncc.Director.EVENT_AFTER_DRAW = \"director_after_draw\";\r\n\r\n//Possible OpenGL projections used by director\r\n\r\n/**\r\n * Constant for 2D projection (orthogonal projection)\r\n * @property {Number} PROJECTION_2D\r\n * @default 0\r\n * @readonly\r\n * @static\r\n * @deprecated since v2.0\r\n */\r\ncc.Director.PROJECTION_2D = 0;\r\n\r\n/**\r\n * Constant for 3D projection with a fovy=60, znear=0.5f and zfar=1500.\r\n * @property {Number} PROJECTION_3D\r\n * @default 1\r\n * @readonly\r\n * @static\r\n * @deprecated since v2.0\r\n */\r\ncc.Director.PROJECTION_3D = 1;\r\n\r\n/**\r\n * Constant for custom projection, if cc.Director's projection set to it, it calls \"updateProjection\" on the projection delegate.\r\n * @property {Number} PROJECTION_CUSTOM\r\n * @default 3\r\n * @readonly\r\n * @static\r\n * @deprecated since v2.0\r\n */\r\ncc.Director.PROJECTION_CUSTOM = 3;\r\n\r\n/**\r\n * Constant for default projection of cc.Director, default projection is 2D projection\r\n * @property {Number} PROJECTION_DEFAULT\r\n * @default cc.Director.PROJECTION_2D\r\n * @readonly\r\n * @static\r\n * @deprecated since v2.0\r\n */\r\ncc.Director.PROJECTION_DEFAULT = cc.Director.PROJECTION_2D;\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en Director\r\n * !#zh \r\n * @property director\r\n * @type {Director}\r\n */\r\ncc.director = new cc.Director();\r\n\r\nmodule.exports = cc.director;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar EventTarget = require('./event/event-target');\r\nrequire('../audio/CCAudioEngine');\r\nconst debug = require('./CCDebug');\r\nconst renderer = require('./renderer/index.js');\r\nconst inputManager = CC_QQPLAY ? require('./platform/BKInputManager') : require('./platform/CCInputManager');\r\nconst dynamicAtlasManager = require('../core/renderer/utils/dynamic-atlas/manager');\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en An object to boot the game.\r\n * !#zh \r\n * @class Game\r\n * @extends EventTarget\r\n */\r\nvar game = {\r\n    /**\r\n     * !#en Event triggered when game hide to background.\r\n     * Please note that this event is not 100% guaranteed to be fired on Web platform,\r\n     * on native platforms, it corresponds to enter background event, os status bar or notification center may not trigger this event.\r\n     * !#zh \r\n     *  WEB  100% \r\n     * \r\n     * @property EVENT_HIDE\r\n     * @type {String}\r\n     * @example\r\n     * cc.game.on(cc.game.EVENT_HIDE, function () {\r\n     *     cc.audioEngine.pauseMusic();\r\n     *     cc.audioEngine.pauseAllEffects();\r\n     * });\r\n     */\r\n    EVENT_HIDE: \"game_on_hide\",\r\n\r\n    /**\r\n     * Event triggered when game back to foreground\r\n     * Please note that this event is not 100% guaranteed to be fired on Web platform,\r\n     * on native platforms, it corresponds to enter foreground event.\r\n     * !#zh \r\n     *  WEB  100% \r\n     * \r\n     * @property EVENT_SHOW\r\n     * @constant\r\n     * @type {String}\r\n     */\r\n    EVENT_SHOW: \"game_on_show\",\r\n\r\n    /**\r\n     * Event triggered after game inited, at this point all engine objects and game scripts are loaded\r\n     * @property EVENT_GAME_INITED\r\n     * @constant\r\n     * @type {String}\r\n     */\r\n    EVENT_GAME_INITED: \"game_inited\",\r\n\r\n    /**\r\n     * Event triggered after engine inited, at this point you will be able to use all engine classes. \r\n     * It was defined as EVENT_RENDERER_INITED in cocos creator v1.x and renamed in v2.0\r\n     * @property EVENT_ENGINE_INITED\r\n     * @constant\r\n     * @type {String}\r\n     */\r\n    EVENT_ENGINE_INITED: \"engine_inited\",\r\n    // deprecated\r\n    EVENT_RENDERER_INITED: \"engine_inited\",\r\n\r\n    /**\r\n     * Web Canvas 2d API as renderer backend\r\n     * @property RENDER_TYPE_CANVAS\r\n     * @constant\r\n     * @type {Number}\r\n     */\r\n    RENDER_TYPE_CANVAS: 0,\r\n    /**\r\n     * WebGL API as renderer backend\r\n     * @property RENDER_TYPE_WEBGL\r\n     * @constant\r\n     * @type {Number}\r\n     */\r\n    RENDER_TYPE_WEBGL: 1,\r\n    /**\r\n     * OpenGL API as renderer backend\r\n     * @property RENDER_TYPE_OPENGL\r\n     * @constant\r\n     * @type {Number}\r\n     */\r\n    RENDER_TYPE_OPENGL: 2,\r\n\r\n    _persistRootNodes: {},\r\n\r\n    // states\r\n    _paused: true,//whether the game is paused\r\n    _configLoaded: false,//whether config loaded\r\n    _isCloning: false,    // deserializing or instantiating\r\n    _prepared: false, //whether the engine has prepared\r\n    _rendererInitialized: false,\r\n\r\n    _renderContext: null,\r\n\r\n    _intervalId: null,//interval target of main\r\n\r\n    _lastTime: null,\r\n    _frameTime: null,\r\n\r\n    // Scenes list\r\n    _sceneInfos: [],\r\n\r\n    /**\r\n     * !#en The outer frame of the game canvas, parent of game container.\r\n     * !#zh container \r\n     * @property frame\r\n     * @type {Object}\r\n     */\r\n    frame: null,\r\n    /**\r\n     * !#en The container of game canvas.\r\n     * !#zh \r\n     * @property container\r\n     * @type {HTMLDivElement}\r\n     */\r\n    container: null,\r\n    /**\r\n     * !#en The canvas of the game.\r\n     * !#zh \r\n     * @property canvas\r\n     * @type {HTMLCanvasElement}\r\n     */\r\n    canvas: null,\r\n\r\n    /**\r\n     * !#en The renderer backend of the game.\r\n     * !#zh \r\n     * @property renderType\r\n     * @type {Number}\r\n     */\r\n    renderType: -1,\r\n\r\n    /**\r\n     * !#en\r\n     * The current game configuration, including:<br/>\r\n     * 1. debugMode<br/>\r\n     *      \"debugMode\" possible values :<br/>\r\n     *      0 - No message will be printed.                                                      <br/>\r\n     *      1 - cc.error, cc.assert, cc.warn, cc.log will print in console.                      <br/>\r\n     *      2 - cc.error, cc.assert, cc.warn will print in console.                              <br/>\r\n     *      3 - cc.error, cc.assert will print in console.                                       <br/>\r\n     *      4 - cc.error, cc.assert, cc.warn, cc.log will print on canvas, available only on web.<br/>\r\n     *      5 - cc.error, cc.assert, cc.warn will print on canvas, available only on web.        <br/>\r\n     *      6 - cc.error, cc.assert will print on canvas, available only on web.                 <br/>\r\n     * 2. showFPS<br/>\r\n     *      Left bottom corner fps information will show when \"showFPS\" equals true, otherwise it will be hide.<br/>\r\n     * 3. exposeClassName<br/>\r\n     *      Expose class name to chrome debug tools, the class intantiate performance is a little bit slower when exposed.<br/>\r\n     * 4. frameRate<br/>\r\n     *      \"frameRate\" set the wanted frame rate for your game, but the real fps depends on your game implementation and the running environment.<br/>\r\n     * 5. id<br/>\r\n     *      \"gameCanvas\" sets the id of your canvas element on the web page, it's useful only on web.<br/>\r\n     * 6. renderMode<br/>\r\n     *      \"renderMode\" sets the renderer type, only useful on web :<br/>\r\n     *      0 - Automatically chosen by engine<br/>\r\n     *      1 - Forced to use canvas renderer<br/>\r\n     *      2 - Forced to use WebGL renderer, but this will be ignored on mobile browsers<br/>\r\n     * 7. scenes<br/>\r\n     *      \"scenes\" include available scenes in the current bundle.<br/>\r\n     *<br/>\r\n     * Please DO NOT modify this object directly, it won't have any effect.<br/>\r\n     * !#zh\r\n     *                                                                   <br/>\r\n     * 1. debugModedebug                                 <br/>\r\n     *      \"debugMode\"                                                    <br/>\r\n     *          0 -                                                        <br/>\r\n     *          1 - cc.errorcc.assertcc.warncc.log  console                   <br/>\r\n     *          2 - cc.errorcc.assertcc.warn  console                           <br/>\r\n     *          3 - cc.errorcc.assert  console                                    <br/>\r\n     *          4 - cc.errorcc.assertcc.warncc.log  canvas  web  <br/>\r\n     *          5 - cc.errorcc.assertcc.warn  canvas  web          <br/>\r\n     *          6 - cc.errorcc.assert  canvas  web                   <br/>\r\n     * 2. showFPS FPS                                                            <br/>\r\n     *       showFPS  true  fps               <br/>\r\n     * 3. exposeClassName                                                           <br/>\r\n     *       Chrome DevTools  <br/>\r\n     * 4. frameRate ()                                                              <br/>\r\n     *      frameRate FPS      <br/>\r\n     * 5. id                                                                            <br/>\r\n     *      \"gameCanvas\" Web  Canvas Element ID web                          <br/>\r\n     * 6. renderMode                                                         <br/>\r\n     *      renderMode  web                               <br/>\r\n     *          0 -                                                      <br/>\r\n     *          1 -  canvas \r\n     *          2 -  WebGL  Android      <br/>\r\n     * 7. scenes                                                                         <br/>\r\n     *      scenes                                                    <br/>\r\n     * <br/>\r\n     * \r\n     * @property config\r\n     * @type {Object}\r\n     */\r\n    config: null,\r\n\r\n    /**\r\n     * !#en Callback when the scripts of engine have been load.\r\n     * !#zh \r\n     * @method onStart\r\n     * @type {Function}\r\n     */\r\n    onStart: null,\r\n\r\n//@Public Methods\r\n\r\n//  @Game play control\r\n    /**\r\n     * !#en Set frame rate of game.\r\n     * !#zh \r\n     * @method setFrameRate\r\n     * @param {Number} frameRate\r\n     */\r\n    setFrameRate: function (frameRate) {\r\n        var config = this.config;\r\n        config.frameRate = frameRate;\r\n        if (this._intervalId)\r\n            window.cancelAnimFrame(this._intervalId);\r\n        this._intervalId = 0;\r\n        this._paused = true;\r\n        this._setAnimFrame();\r\n        this._runMainLoop();\r\n    },\r\n\r\n    /**\r\n     * !#en Get frame rate set for the game, it doesn't represent the real frame rate.\r\n     * !#zh \r\n     * @method getFrameRate\r\n     * @return {Number} frame rate\r\n     */\r\n    getFrameRate: function () {\r\n        return this.config.frameRate;\r\n    },\r\n\r\n    /**\r\n     * !#en Run the game frame by frame.\r\n     * !#zh \r\n     * @method step\r\n     */\r\n    step: function () {\r\n        cc.director.mainLoop();\r\n    },\r\n\r\n    /**\r\n     * !#en Pause the game main loop. This will pause:\r\n     * game logic execution, rendering process, event manager, background music and all audio effects.\r\n     * This is different with cc.director.pause which only pause the game logic execution.\r\n     * !#zh  cc.director.pause \r\n     * @method pause\r\n     */\r\n    pause: function () {\r\n        if (this._paused) return;\r\n        this._paused = true;\r\n        // Pause audio engine\r\n        if (cc.audioEngine) {\r\n            cc.audioEngine._break();\r\n        }\r\n        // Pause main loop\r\n        if (this._intervalId)\r\n            window.cancelAnimFrame(this._intervalId);\r\n        this._intervalId = 0;\r\n    },\r\n\r\n    /**\r\n     * !#en Resume the game from pause. This will resume:\r\n     * game logic execution, rendering process, event manager, background music and all audio effects.\r\n     * !#zh \r\n     * @method resume\r\n     */\r\n    resume: function () {\r\n        if (!this._paused) return;\r\n        this._paused = false;\r\n        // Resume audio engine\r\n        if (cc.audioEngine) {\r\n            cc.audioEngine._restore();\r\n        }\r\n        // Resume main loop\r\n        this._runMainLoop();\r\n    },\r\n\r\n    /**\r\n     * !#en Check whether the game is paused.\r\n     * !#zh \r\n     * @method isPaused\r\n     * @return {Boolean}\r\n     */\r\n    isPaused: function () {\r\n        return this._paused;\r\n    },\r\n\r\n    /**\r\n     * !#en Restart game.\r\n     * !#zh \r\n     * @method restart\r\n     */\r\n    restart: function () {\r\n        cc.director.once(cc.Director.EVENT_AFTER_DRAW, function () {\r\n            for (var id in game._persistRootNodes) {\r\n                game.removePersistRootNode(game._persistRootNodes[id]);\r\n            }\r\n\r\n            // Clear scene\r\n            cc.director.getScene().destroy();\r\n            cc.Object._deferredDestroy();\r\n\r\n            cc.director.purgeDirector();\r\n\r\n            // Clean up audio\r\n            if (cc.audioEngine) {\r\n                cc.audioEngine.uncacheAll();\r\n            }\r\n\r\n            cc.director.reset();\r\n            game.onStart();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * !#en End game, it will close the game window\r\n     * !#zh \r\n     * @method end\r\n     */\r\n    end: function () {\r\n        close();\r\n    },\r\n\r\n//  @Game loading\r\n\r\n    _initEngine () {\r\n        if (this._rendererInitialized) {\r\n            return;\r\n        }\r\n\r\n        this._initRenderer();\r\n\r\n        if (!CC_EDITOR) {\r\n            this._initEvents();\r\n        }\r\n\r\n        this.emit(this.EVENT_ENGINE_INITED);\r\n    },\r\n\r\n    _prepareFinished (cb) {\r\n        this._prepared = true;\r\n\r\n        // Init engine\r\n        this._initEngine();\r\n        // Log engine version\r\n        console.log('Cocos Creator v' + cc.ENGINE_VERSION);\r\n\r\n        this._setAnimFrame();\r\n        this._runMainLoop();\r\n\r\n        this.emit(this.EVENT_GAME_INITED);\r\n\r\n        if (cb) cb();\r\n    },\r\n\r\n    eventTargetOn: EventTarget.prototype.on,\r\n    eventTargetOnce: EventTarget.prototype.once,\r\n\r\n    /**\r\n     * !#en\r\n     * Register an callback of a specific event type on the game object.\r\n     * This type of event should be triggered via `emit`.\r\n     * !#zh\r\n     *  game  `emit` \r\n     *\r\n     * @method on\r\n     * @param {String} type - A string representing the event type to listen for.\r\n     * @param {Function} callback - The callback that will be invoked when the event is dispatched.\r\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\r\n     * @param {any} [callback.arg1] arg1\r\n     * @param {any} [callback.arg2] arg2\r\n     * @param {any} [callback.arg3] arg3\r\n     * @param {any} [callback.arg4] arg4\r\n     * @param {any} [callback.arg5] arg5\r\n     * @param {Object} [target] - The target (this object) to invoke the callback, can be null\r\n     * @return {Function} - Just returns the incoming callback so you can save the anonymous function easier.\r\n     * @typescript\r\n     * on<T extends Function>(type: string, callback: T, target?: any, useCapture?: boolean): T\r\n     */\r\n    on (type, callback, target) {\r\n        // Make sure EVENT_ENGINE_INITED callbacks to be invoked\r\n        if (this._prepared && type === this.EVENT_ENGINE_INITED) {\r\n            callback.call(target);\r\n        }\r\n        else {\r\n            this.eventTargetOn(type, callback, target);\r\n        }\r\n    },\r\n    /**\r\n     * !#en\r\n     * Register an callback of a specific event type on the game object,\r\n     * the callback will remove itself after the first time it is triggered.\r\n     * !#zh\r\n     *  game \r\n     *\r\n     * @method once\r\n     * @param {String} type - A string representing the event type to listen for.\r\n     * @param {Function} callback - The callback that will be invoked when the event is dispatched.\r\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\r\n     * @param {any} [callback.arg1] arg1\r\n     * @param {any} [callback.arg2] arg2\r\n     * @param {any} [callback.arg3] arg3\r\n     * @param {any} [callback.arg4] arg4\r\n     * @param {any} [callback.arg5] arg5\r\n     * @param {Object} [target] - The target (this object) to invoke the callback, can be null\r\n     */\r\n    once (type, callback, target) {\r\n        // Make sure EVENT_ENGINE_INITED callbacks to be invoked\r\n        if (this._prepared && type === this.EVENT_ENGINE_INITED) {\r\n            callback.call(target);\r\n        }\r\n        else {\r\n            this.eventTargetOnce(type, callback, target);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Prepare game.\r\n     * !#zh \r\n     * @param {Function} cb\r\n     * @method prepare\r\n     */\r\n    prepare (cb) {\r\n        // Already prepared\r\n        if (this._prepared) {\r\n            if (cb) cb();\r\n            return;\r\n        }\r\n\r\n        // Load game scripts\r\n        let jsList = this.config.jsList;\r\n        if (jsList && jsList.length > 0) {\r\n            var self = this;\r\n            cc.loader.load(jsList, function (err) {\r\n                if (err) throw new Error(JSON.stringify(err));\r\n                self._prepareFinished(cb);\r\n            });\r\n        }\r\n        else {\r\n            this._prepareFinished(cb);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Run game with configuration object and onStart function.\r\n     * !#zh  onStart \r\n     * @method run\r\n     * @param {Object} config - Pass configuration object or onStart function\r\n     * @param {Function} onStart - function to be executed after game initialized\r\n     */\r\n    run: function (config, onStart) {\r\n        this._initConfig(config);\r\n        this.onStart = onStart;\r\n        this.prepare(game.onStart && game.onStart.bind(game));\r\n    },\r\n\r\n//  @ Persist root node section\r\n    /**\r\n     * !#en\r\n     * Add a persistent root node to the game, the persistent node won't be destroyed during scene transition.<br/>\r\n     * The target node must be placed in the root level of hierarchy, otherwise this API won't have any effect.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method addPersistRootNode\r\n     * @param {Node} node - The node to be made persistent\r\n     */\r\n    addPersistRootNode: function (node) {\r\n        if (!cc.Node.isNode(node) || !node.uuid) {\r\n            cc.warnID(3800);\r\n            return;\r\n        }\r\n        var id = node.uuid;\r\n        if (!this._persistRootNodes[id]) {\r\n            var scene = cc.director._scene;\r\n            if (cc.isValid(scene)) {\r\n                if (!node.parent) {\r\n                    node.parent = scene;\r\n                }\r\n                else if ( !(node.parent instanceof cc.Scene) ) {\r\n                    cc.warnID(3801);\r\n                    return;\r\n                }\r\n                else if (node.parent !== scene) {\r\n                    cc.warnID(3802);\r\n                    return;\r\n                }\r\n            }\r\n            this._persistRootNodes[id] = node;\r\n            node._persistNode = true;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Remove a persistent root node.\r\n     * !#zh \r\n     * @method removePersistRootNode\r\n     * @param {Node} node - The node to be removed from persistent node list\r\n     */\r\n    removePersistRootNode: function (node) {\r\n        var id = node.uuid || '';\r\n        if (node === this._persistRootNodes[id]) {\r\n            delete this._persistRootNodes[id];\r\n            node._persistNode = false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Check whether the node is a persistent root node.\r\n     * !#zh \r\n     * @method isPersistRootNode\r\n     * @param {Node} node - The node to be checked\r\n     * @return {Boolean}\r\n     */\r\n    isPersistRootNode: function (node) {\r\n        return node._persistNode;\r\n    },\r\n\r\n//@Private Methods\r\n\r\n//  @Time ticker section\r\n    _setAnimFrame: function () {\r\n        this._lastTime = new Date();\r\n        var frameRate = game.config.frameRate;\r\n        this._frameTime = 1000 / frameRate;\r\n\r\n        if (CC_JSB) {\r\n            jsb.setPreferredFramesPerSecond(frameRate);\r\n            window.requestAnimFrame = window.requestAnimationFrame;\r\n            window.cancelAnimFrame = window.cancelAnimationFrame;\r\n        }\r\n        else {\r\n            if (frameRate !== 60 && frameRate !== 30) {\r\n                window.requestAnimFrame = this._stTime;\r\n                window.cancelAnimFrame = this._ctTime;\r\n            }\r\n            else {\r\n                window.requestAnimFrame = window.requestAnimationFrame ||\r\n                window.webkitRequestAnimationFrame ||\r\n                window.mozRequestAnimationFrame ||\r\n                window.oRequestAnimationFrame ||\r\n                window.msRequestAnimationFrame ||\r\n                this._stTime;\r\n                window.cancelAnimFrame = window.cancelAnimationFrame ||\r\n                window.cancelRequestAnimationFrame ||\r\n                window.msCancelRequestAnimationFrame ||\r\n                window.mozCancelRequestAnimationFrame ||\r\n                window.oCancelRequestAnimationFrame ||\r\n                window.webkitCancelRequestAnimationFrame ||\r\n                window.msCancelAnimationFrame ||\r\n                window.mozCancelAnimationFrame ||\r\n                window.webkitCancelAnimationFrame ||\r\n                window.oCancelAnimationFrame ||\r\n                this._ctTime;\r\n            }\r\n        }\r\n    },\r\n    _stTime: function(callback){\r\n        var currTime = new Date().getTime();\r\n        var timeToCall = Math.max(0, game._frameTime - (currTime - game._lastTime));\r\n        var id = window.setTimeout(function() { callback(); },\r\n            timeToCall);\r\n        game._lastTime = currTime + timeToCall;\r\n        return id;\r\n    },\r\n    _ctTime: function(id){\r\n        window.clearTimeout(id);\r\n    },\r\n    //Run game.\r\n    _runMainLoop: function () {\r\n        var self = this, callback, config = self.config,\r\n            director = cc.director,\r\n            skip = true, frameRate = config.frameRate;\r\n\r\n        debug.setDisplayStats(config.showFPS);\r\n\r\n        callback = function () {\r\n            if (!self._paused) {\r\n                self._intervalId = window.requestAnimFrame(callback);\r\n                if (!CC_JSB && frameRate === 30) {\r\n                    if (skip = !skip) {\r\n                        return;\r\n                    }\r\n                }\r\n                director.mainLoop();\r\n            }\r\n        };\r\n\r\n        self._intervalId = window.requestAnimFrame(callback);\r\n        self._paused = false;\r\n    },\r\n\r\n//  @Game loading section\r\n    _initConfig (config) {\r\n        // Configs adjustment\r\n        if (typeof config.debugMode !== 'number') {\r\n            config.debugMode = 0;\r\n        }\r\n        config.exposeClassName = !!config.exposeClassName;\r\n        if (typeof config.frameRate !== 'number') {\r\n            config.frameRate = 60;\r\n        }\r\n        let renderMode = config.renderMode;\r\n        if (typeof renderMode !== 'number' || renderMode > 2 || renderMode < 0) {\r\n            config.renderMode = 0;\r\n        }\r\n        if (typeof config.registerSystemEvent !== 'boolean') {\r\n            config.registerSystemEvent = true;\r\n        }\r\n        config.showFPS = !!config.showFPS;\r\n\r\n        // Scene parser\r\n        this._sceneInfos = config.scenes || [];\r\n\r\n        // Collide Map and Group List\r\n        this.collisionMatrix = config.collisionMatrix || [];\r\n        this.groupList = config.groupList || [];\r\n\r\n        debug._resetDebugSetting(config.debugMode);\r\n\r\n        this.config = config;\r\n        this._configLoaded = true;\r\n    },\r\n\r\n    _determineRenderType () {\r\n        let config = this.config,\r\n            userRenderMode = parseInt(config.renderMode) || 0;\r\n    \r\n        // Determine RenderType\r\n        this.renderType = this.RENDER_TYPE_CANVAS;\r\n        let supportRender = false;\r\n    \r\n        if (userRenderMode === 0) {\r\n            if (cc.sys.capabilities['opengl']) {\r\n                this.renderType = this.RENDER_TYPE_WEBGL;\r\n                supportRender = true;\r\n            }\r\n            else if (cc.sys.capabilities['canvas']) {\r\n                this.renderType = this.RENDER_TYPE_CANVAS;\r\n                supportRender = true;\r\n            }\r\n        }\r\n        else if (userRenderMode === 1 && cc.sys.capabilities['canvas']) {\r\n            this.renderType = this.RENDER_TYPE_CANVAS;\r\n            supportRender = true;\r\n        }\r\n        else if (userRenderMode === 2 && cc.sys.capabilities['opengl']) {\r\n            this.renderType = this.RENDER_TYPE_WEBGL;\r\n            supportRender = true;\r\n        }\r\n    \r\n        if (!supportRender) {\r\n            throw new Error(debug.getError(3820, userRenderMode));\r\n        }\r\n    },\r\n\r\n    _initRenderer () {\r\n        // Avoid setup to be called twice.\r\n        if (this._rendererInitialized) return;\r\n\r\n        let el = this.config.id,\r\n            width, height,\r\n            localCanvas, localContainer;\r\n\r\n        if (CC_WECHATGAME || CC_JSB) {\r\n            this.container = localContainer = document.createElement(\"DIV\");\r\n            this.frame = localContainer.parentNode === document.body ? document.documentElement : localContainer.parentNode;\r\n            if (cc.sys.browserType === cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB) {\r\n                localCanvas = window.sharedCanvas || wx.getSharedCanvas();\r\n            }\r\n            else if (CC_JSB) {\r\n                localCanvas = window.__canvas;\r\n            }\r\n            else {\r\n                localCanvas = canvas;\r\n            }\r\n            this.canvas = localCanvas;\r\n        }\r\n        else if (CC_QQPLAY) {\r\n            this.container = cc.container = document.createElement(\"DIV\");\r\n            this.frame = document.documentElement;\r\n            this.canvas = localCanvas = canvas;\r\n        }\r\n        else {\r\n            var element = (el instanceof HTMLElement) ? el : (document.querySelector(el) || document.querySelector('#' + el));\r\n\r\n            if (element.tagName === \"CANVAS\") {\r\n                width = element.width;\r\n                height = element.height;\r\n\r\n                //it is already a canvas, we wrap it around with a div\r\n                this.canvas = localCanvas = element;\r\n                this.container = localContainer = document.createElement(\"DIV\");\r\n                if (localCanvas.parentNode)\r\n                    localCanvas.parentNode.insertBefore(localContainer, localCanvas);\r\n            } else {\r\n                //we must make a new canvas and place into this element\r\n                if (element.tagName !== \"DIV\") {\r\n                    cc.warnID(3819);\r\n                }\r\n                width = element.clientWidth;\r\n                height = element.clientHeight;\r\n                this.canvas = localCanvas = document.createElement(\"CANVAS\");\r\n                this.container = localContainer = document.createElement(\"DIV\");\r\n                element.appendChild(localContainer);\r\n            }\r\n            localContainer.setAttribute('id', 'Cocos2dGameContainer');\r\n            localContainer.appendChild(localCanvas);\r\n            this.frame = (localContainer.parentNode === document.body) ? document.documentElement : localContainer.parentNode;\r\n\r\n            function addClass (element, name) {\r\n                var hasClass = (' ' + element.className + ' ').indexOf(' ' + name + ' ') > -1;\r\n                if (!hasClass) {\r\n                    if (element.className) {\r\n                        element.className += \" \";\r\n                    }\r\n                    element.className += name;\r\n                }\r\n            }\r\n            addClass(localCanvas, \"gameCanvas\");\r\n            localCanvas.setAttribute(\"width\", width || 480);\r\n            localCanvas.setAttribute(\"height\", height || 320);\r\n            localCanvas.setAttribute(\"tabindex\", 99);\r\n        }\r\n\r\n        this._determineRenderType();\r\n        // WebGL context created successfully\r\n        if (this.renderType === this.RENDER_TYPE_WEBGL) {\r\n            var opts = {\r\n                'stencil': true,\r\n                // MSAA is causing serious performance dropdown on some browsers.\r\n                'antialias': cc.macro.ENABLE_WEBGL_ANTIALIAS,\r\n                'alpha': cc.macro.ENABLE_TRANSPARENT_CANVAS\r\n            };\r\n            if (CC_WECHATGAME || CC_QQPLAY) {\r\n                opts['preserveDrawingBuffer'] = true;\r\n            }\r\n            renderer.initWebGL(localCanvas, opts);\r\n            this._renderContext = renderer.device._gl;\r\n            \r\n            // Enable dynamic atlas manager by default\r\n            if (!cc.macro.CLEANUP_IMAGE_CACHE && dynamicAtlasManager) {\r\n                dynamicAtlasManager.enabled = true;\r\n            }\r\n            // Disable dynamicAtlasManager to fix rendering residue for transparent images on Chrome69.\r\n            if (cc.sys.browserType == cc.sys.BROWSER_TYPE_CHROME && parseFloat(cc.sys.browserVersion) >= 69.0) {\r\n                dynamicAtlasManager.enabled = false;\r\n            }\r\n        }\r\n        if (!this._renderContext) {\r\n            this.renderType = this.RENDER_TYPE_CANVAS;\r\n            // Could be ignored by module settings\r\n            renderer.initCanvas(localCanvas);\r\n            this._renderContext = renderer.device._ctx;\r\n        }\r\n\r\n        this.canvas.oncontextmenu = function () {\r\n            if (!cc._isContextMenuEnable) return false;\r\n        };\r\n\r\n        this._rendererInitialized = true;\r\n    },\r\n\r\n    _initEvents: function () {\r\n        var win = window, hiddenPropName;\r\n\r\n        // register system events\r\n        if (this.config.registerSystemEvent)\r\n            inputManager.registerSystemEvent(this.canvas);\r\n\r\n        if (typeof document.hidden !== 'undefined') {\r\n            hiddenPropName = \"hidden\";\r\n        } else if (typeof document.mozHidden !== 'undefined') {\r\n            hiddenPropName = \"mozHidden\";\r\n        } else if (typeof document.msHidden !== 'undefined') {\r\n            hiddenPropName = \"msHidden\";\r\n        } else if (typeof document.webkitHidden !== 'undefined') {\r\n            hiddenPropName = \"webkitHidden\";\r\n        }\r\n\r\n        var hidden = false;\r\n\r\n        function onHidden () {\r\n            if (!hidden) {\r\n                hidden = true;\r\n                game.emit(game.EVENT_HIDE);\r\n            }\r\n        }\r\n        // In order to adapt the most of platforms the onshow API.\r\n        function onShown (arg0, arg1, arg2, arg3, arg4) {\r\n            if (hidden) {\r\n                hidden = false;\r\n                game.emit(game.EVENT_SHOW, arg0, arg1, arg2, arg3, arg4);\r\n            }\r\n        }\r\n\r\n        if (hiddenPropName) {\r\n            var changeList = [\r\n                \"visibilitychange\",\r\n                \"mozvisibilitychange\",\r\n                \"msvisibilitychange\",\r\n                \"webkitvisibilitychange\",\r\n                \"qbrowserVisibilityChange\"\r\n            ];\r\n            for (var i = 0; i < changeList.length; i++) {\r\n                document.addEventListener(changeList[i], function (event) {\r\n                    var visible = document[hiddenPropName];\r\n                    // QQ App\r\n                    visible = visible || event[\"hidden\"];\r\n                    if (visible)\r\n                        onHidden();\r\n                    else\r\n                        onShown();\r\n                });\r\n            }\r\n        } else {\r\n            win.addEventListener(\"blur\", onHidden);\r\n            win.addEventListener(\"focus\", onShown);\r\n        }\r\n\r\n        if (navigator.userAgent.indexOf(\"MicroMessenger\") > -1) {\r\n            win.onfocus = onShown;\r\n        }\r\n\r\n        if (CC_WECHATGAME && cc.sys.browserType !== cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB) {\r\n            wx.onShow && wx.onShow(onShown);\r\n            wx.onHide && wx.onHide(onHidden);\r\n        }\r\n\r\n        if (\"onpageshow\" in window && \"onpagehide\" in window) {\r\n            win.addEventListener(\"pagehide\", onHidden);\r\n            win.addEventListener(\"pageshow\", onShown);\r\n            // Taobao UIWebKit\r\n            document.addEventListener(\"pagehide\", onHidden);\r\n            document.addEventListener(\"pageshow\", onShown);\r\n        }\r\n\r\n        this.on(game.EVENT_HIDE, function () {\r\n            game.pause();\r\n        });\r\n        this.on(game.EVENT_SHOW, function () {\r\n            game.resume();\r\n        });\r\n    }\r\n};\r\n\r\nEventTarget.call(game);\r\ncc.js.addon(game, EventTarget.prototype);\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en This is a Game instance.\r\n * !#zh  Game \r\n * @property game\r\n * @type Game\r\n */\r\ncc.game = module.exports = game;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n'use strict';\r\n\r\nconst BaseNode = require('./utils/base-node');\r\nconst PrefabHelper = require('./utils/prefab-helper');\r\nconst mathPools = require('./utils/math-pools');\r\nconst math = require('./renderer/render-engine').math;\r\nconst AffineTrans = require('./utils/affine-transform');\r\nconst eventManager = require('./event-manager');\r\nconst macro = require('./platform/CCMacro');\r\nconst misc = require('./utils/misc');\r\nconst js = require('./platform/js');\r\nconst Event = require('./event/event');\r\nconst EventTarget = require('./event/event-target');\r\nconst RenderFlow = require('./renderer/render-flow');\r\n\r\nconst Flags = cc.Object.Flags;\r\nconst Destroying = Flags.Destroying;\r\n\r\nconst ERR_INVALID_NUMBER = CC_EDITOR && 'The %s is invalid';\r\nconst ONE_DEGREE = Math.PI / 180;\r\n\r\nvar ActionManagerExist = !!cc.ActionManager;\r\nvar emptyFunc = function () {};\r\nvar _vec2a = cc.v2();\r\nvar _vec2b = cc.v2();\r\nvar _mat4_temp = math.mat4.create();\r\nvar _vec3_temp = math.vec3.create();\r\nvar _quat_temp = math.quat.create();\r\nvar _globalOrderOfArrival = 1;\r\nvar _cachedArray = new Array(16);\r\n_cachedArray.length = 0;\r\n\r\nconst POSITION_ON = 1 << 0;\r\nconst SCALE_ON = 1 << 1;\r\nconst ROTATION_ON = 1 << 2;\r\nconst SIZE_ON = 1 << 3;\r\nconst ANCHOR_ON = 1 << 4;\r\nconst COLOR_ON = 1 << 5;\r\n\r\n\r\nlet BuiltinGroupIndex = cc.Enum({\r\n    DEBUG: 31\r\n});\r\n\r\n/**\r\n * !#en Node's local dirty properties flag\r\n * !#zh Node  dirty \r\n * @enum Node._LocalDirtyFlag\r\n * @static\r\n * @private\r\n * @namespace Node\r\n */\r\nvar LocalDirtyFlag = cc.Enum({\r\n    /**\r\n     * !#en Flag for position dirty\r\n     * !#zh  dirty \r\n     * @property {Number} POSITION\r\n     * @static\r\n     */\r\n    POSITION: 1 << 0,\r\n    /**\r\n     * !#en Flag for scale dirty\r\n     * !#zh  dirty \r\n     * @property {Number} SCALE\r\n     * @static\r\n     */\r\n    SCALE: 1 << 1,\r\n    /**\r\n     * !#en Flag for rotation dirty\r\n     * !#zh  dirty \r\n     * @property {Number} ROTATION\r\n     * @static\r\n     */\r\n    ROTATION: 1 << 2,\r\n    /**\r\n     * !#en Flag for skew dirty\r\n     * !#zh skew dirty \r\n     * @property {Number} SKEW\r\n     * @static\r\n     */\r\n    SKEW: 1 << 3,\r\n    /**\r\n     * !#en Flag for position or rotation dirty\r\n     * !#zh  dirty \r\n     * @property {Number} RT\r\n     * @static\r\n     */\r\n    RT: 1 << 0 | 1 << 1 | 1 << 2,\r\n    /**\r\n     * !#en Flag for all dirty properties\r\n     * !#zh  dirty \r\n     * @property {Number} ALL\r\n     * @static\r\n     */\r\n    ALL: 0xffff,\r\n});\r\n\r\n/**\r\n * !#en The event type supported by Node\r\n * !#zh Node \r\n * @class Node.EventType\r\n * @static\r\n * @namespace Node\r\n */\r\nvar EventType = cc.Enum({\r\n    /**\r\n     * !#en The event type for touch start event, you can use its value directly: 'touchstart'\r\n     * !#zh \r\n     * @property {String} TOUCH_START\r\n     * @static\r\n     */\r\n    TOUCH_START: 'touchstart',\r\n    /**\r\n     * !#en The event type for touch move event, you can use its value directly: 'touchmove'\r\n     * !#zh \r\n     * @property {String} TOUCH_MOVE\r\n     * @static\r\n     */\r\n    TOUCH_MOVE: 'touchmove',\r\n    /**\r\n     * !#en The event type for touch end event, you can use its value directly: 'touchend'\r\n     * !#zh \r\n     * @property {String} TOUCH_END\r\n     * @static\r\n     */\r\n    TOUCH_END: 'touchend',\r\n    /**\r\n     * !#en The event type for touch end event, you can use its value directly: 'touchcancel'\r\n     * !#zh \r\n     * @property {String} TOUCH_CANCEL\r\n     * @static\r\n     */\r\n    TOUCH_CANCEL: 'touchcancel',\r\n\r\n    /**\r\n     * !#en The event type for mouse down events, you can use its value directly: 'mousedown'\r\n     * !#zh \r\n     * @property {String} MOUSE_DOWN\r\n     * @static\r\n     */\r\n    MOUSE_DOWN: 'mousedown',\r\n    /**\r\n     * !#en The event type for mouse move events, you can use its value directly: 'mousemove'\r\n     * !#zh \r\n     * @property {String} MOUSE_MOVE\r\n     * @static\r\n     */\r\n    MOUSE_MOVE: 'mousemove',\r\n    /**\r\n     * !#en The event type for mouse enter target events, you can use its value directly: 'mouseenter'\r\n     * !#zh \r\n     * @property {String} MOUSE_ENTER\r\n     * @static\r\n     */\r\n    MOUSE_ENTER: 'mouseenter',\r\n    /**\r\n     * !#en The event type for mouse leave target events, you can use its value directly: 'mouseleave'\r\n     * !#zh \r\n     * @property {String} MOUSE_LEAVE\r\n     * @static\r\n     */\r\n    MOUSE_LEAVE: 'mouseleave',\r\n    /**\r\n     * !#en The event type for mouse up events, you can use its value directly: 'mouseup'\r\n     * !#zh \r\n     * @property {String} MOUSE_UP\r\n     * @static\r\n     */\r\n    MOUSE_UP: 'mouseup',\r\n    /**\r\n     * !#en The event type for mouse wheel events, you can use its value directly: 'mousewheel'\r\n     * !#zh \r\n     * @property {String} MOUSE_WHEEL\r\n     * @static\r\n     */\r\n    MOUSE_WHEEL: 'mousewheel',\r\n\r\n    /**\r\n     * !#en The event type for position change events.\r\n     * Performance note, this event will be triggered every time corresponding properties being changed,\r\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\r\n     * !#zh \r\n     * \r\n     * @property {String} POSITION_CHANGED\r\n     * @static\r\n     */\r\n    POSITION_CHANGED: 'position-changed',\r\n    /**\r\n     * !#en The event type for rotation change events.\r\n     * Performance note, this event will be triggered every time corresponding properties being changed,\r\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\r\n     * !#zh \r\n     * \r\n     * @property {String} ROTATION_CHANGED\r\n     * @static\r\n     */\r\n    ROTATION_CHANGED: 'rotation-changed',\r\n    /**\r\n     * !#en The event type for scale change events.\r\n     * Performance note, this event will be triggered every time corresponding properties being changed,\r\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\r\n     * !#zh \r\n     * \r\n     * @property {String} SCALE_CHANGED\r\n     * @static\r\n     */\r\n    SCALE_CHANGED: 'scale-changed',\r\n    /**\r\n     * !#en The event type for size change events.\r\n     * Performance note, this event will be triggered every time corresponding properties being changed,\r\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\r\n     * !#zh \r\n     * \r\n     * @property {String} SIZE_CHANGED\r\n     * @static\r\n     */\r\n    SIZE_CHANGED: 'size-changed',\r\n    /**\r\n     * !#en The event type for anchor point change events.\r\n     * Performance note, this event will be triggered every time corresponding properties being changed,\r\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\r\n     * !#zh \r\n     * \r\n     * @property {String} ANCHOR_CHANGED\r\n     * @static\r\n     */\r\n    ANCHOR_CHANGED: 'anchor-changed',\r\n    /**\r\n    * !#en The event type for color change events.\r\n    * Performance note, this event will be triggered every time corresponding properties being changed,\r\n    * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\r\n    * !#zh \r\n    * \r\n    * @property {String} COLOR_CHANGED\r\n    * @static\r\n    */\r\n    COLOR_CHANGED: 'color-changed',\r\n    /**\r\n     * !#en The event type for new child added events.\r\n     * !#zh \r\n     * @property {String} CHILD_ADDED\r\n     * @static\r\n     */\r\n    CHILD_ADDED: 'child-added',\r\n    /**\r\n     * !#en The event type for child removed events.\r\n     * !#zh \r\n     * @property {String} CHILD_REMOVED\r\n     * @static\r\n     */\r\n    CHILD_REMOVED: 'child-removed',\r\n    /**\r\n     * !#en The event type for children reorder events.\r\n     * !#zh \r\n     * @property {String} CHILD_REORDER\r\n     * @static\r\n     */\r\n    CHILD_REORDER: 'child-reorder',\r\n    /**\r\n     * !#en The event type for node group changed events.\r\n     * !#zh \r\n     * @property {String} GROUP_CHANGED\r\n     * @static\r\n     */\r\n    GROUP_CHANGED: 'group-changed',\r\n});\r\n\r\nvar _touchEvents = [\r\n    EventType.TOUCH_START,\r\n    EventType.TOUCH_MOVE,\r\n    EventType.TOUCH_END,\r\n    EventType.TOUCH_CANCEL,\r\n];\r\nvar _mouseEvents = [\r\n    EventType.MOUSE_DOWN,\r\n    EventType.MOUSE_ENTER,\r\n    EventType.MOUSE_MOVE,\r\n    EventType.MOUSE_LEAVE,\r\n    EventType.MOUSE_UP,\r\n    EventType.MOUSE_WHEEL,\r\n];\r\n\r\nvar _currentHovered = null;\r\n\r\nvar _touchStartHandler = function (touch, event) {\r\n    var pos = touch.getLocation();\r\n    var node = this.owner;\r\n\r\n    if (node._hitTest(pos, this)) {\r\n        event.type = EventType.TOUCH_START;\r\n        event.touch = touch;\r\n        event.bubbles = true;\r\n        node.dispatchEvent(event);\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\nvar _touchMoveHandler = function (touch, event) {\r\n    var node = this.owner;\r\n    event.type = EventType.TOUCH_MOVE;\r\n    event.touch = touch;\r\n    event.bubbles = true;\r\n    node.dispatchEvent(event);\r\n};\r\nvar _touchEndHandler = function (touch, event) {\r\n    var pos = touch.getLocation();\r\n    var node = this.owner;\r\n\r\n    if (node._hitTest(pos, this)) {\r\n        event.type = EventType.TOUCH_END;\r\n    }\r\n    else {\r\n        event.type = EventType.TOUCH_CANCEL;\r\n    }\r\n    event.touch = touch;\r\n    event.bubbles = true;\r\n    node.dispatchEvent(event);\r\n};\r\nvar _touchCancelHandler = function (touch, event) {\r\n    var pos = touch.getLocation();\r\n    var node = this.owner;\r\n\r\n    event.type = EventType.TOUCH_CANCEL;\r\n    event.touch = touch;\r\n    event.bubbles = true;\r\n    node.dispatchEvent(event);\r\n};\r\n\r\nvar _mouseDownHandler = function (event) {\r\n    var pos = event.getLocation();\r\n    var node = this.owner;\r\n\r\n    if (node._hitTest(pos, this)) {\r\n        event.type = EventType.MOUSE_DOWN;\r\n        event.bubbles = true;\r\n        node.dispatchEvent(event);\r\n    }\r\n};\r\nvar _mouseMoveHandler = function (event) {\r\n    var pos = event.getLocation();\r\n    var node = this.owner;\r\n    var hit = node._hitTest(pos, this);\r\n    if (hit) {\r\n        if (!this._previousIn) {\r\n            // Fix issue when hover node switched, previous hovered node won't get MOUSE_LEAVE notification\r\n            if (_currentHovered && _currentHovered._mouseListener) {\r\n                event.type = EventType.MOUSE_LEAVE;\r\n                _currentHovered.dispatchEvent(event);\r\n                _currentHovered._mouseListener._previousIn = false;\r\n            }\r\n            _currentHovered = this.owner;\r\n            event.type = EventType.MOUSE_ENTER;\r\n            node.dispatchEvent(event);\r\n            this._previousIn = true;\r\n        }\r\n        event.type = EventType.MOUSE_MOVE;\r\n        event.bubbles = true;\r\n        node.dispatchEvent(event);\r\n    }\r\n    else if (this._previousIn) {\r\n        event.type = EventType.MOUSE_LEAVE;\r\n        node.dispatchEvent(event);\r\n        this._previousIn = false;\r\n        _currentHovered = null;\r\n    }\r\n    else {\r\n        // continue dispatching\r\n        return;\r\n    }\r\n\r\n    // Event processed, cleanup\r\n    event.stopPropagation();\r\n};\r\nvar _mouseUpHandler = function (event) {\r\n    var pos = event.getLocation();\r\n    var node = this.owner;\r\n\r\n    if (node._hitTest(pos, this)) {\r\n        event.type = EventType.MOUSE_UP;\r\n        event.bubbles = true;\r\n        node.dispatchEvent(event);\r\n        event.stopPropagation();\r\n    }\r\n};\r\nvar _mouseWheelHandler = function (event) {\r\n    var pos = event.getLocation();\r\n    var node = this.owner;\r\n\r\n    if (node._hitTest(pos, this)) {\r\n        event.type = EventType.MOUSE_WHEEL;\r\n        event.bubbles = true;\r\n        node.dispatchEvent(event);\r\n        event.stopPropagation();\r\n    }\r\n};\r\n\r\nfunction _searchMaskInParent (node) {\r\n    var Mask = cc.Mask;\r\n    if (Mask) {\r\n        var index = 0;\r\n        for (var curr = node; curr && cc.Node.isNode(curr); curr = curr._parent, ++index) {\r\n            if (curr.getComponent(Mask)) {\r\n                return {\r\n                    index: index,\r\n                    node: curr\r\n                };\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction _checkListeners (node, events) {\r\n    if (!(node._objFlags & Destroying)) {\r\n        var i = 0;\r\n        if (node._bubblingListeners) {\r\n            for (; i < events.length; ++i) {\r\n                if (node._bubblingListeners.hasEventListener(events[i])) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        if (node._capturingListeners) {\r\n            for (; i < events.length; ++i) {\r\n                if (node._capturingListeners.hasEventListener(events[i])) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction _doDispatchEvent (owner, event) {\r\n    var target, i;\r\n    event.target = owner;\r\n\r\n    // Event.CAPTURING_PHASE\r\n    _cachedArray.length = 0;\r\n    owner._getCapturingTargets(event.type, _cachedArray);\r\n    // capturing\r\n    event.eventPhase = 1;\r\n    for (i = _cachedArray.length - 1; i >= 0; --i) {\r\n        target = _cachedArray[i];\r\n        if (target._capturingListeners) {\r\n            event.currentTarget = target;\r\n            // fire event\r\n            target._capturingListeners.emit(event.type, event, _cachedArray);\r\n            // check if propagation stopped\r\n            if (event._propagationStopped) {\r\n                _cachedArray.length = 0;\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    _cachedArray.length = 0;\r\n\r\n    // Event.AT_TARGET\r\n    // checks if destroyed in capturing callbacks\r\n    event.eventPhase = 2;\r\n    event.currentTarget = owner;\r\n    if (owner._capturingListeners) {\r\n        owner._capturingListeners.emit(event.type, event);\r\n    }\r\n    if (!event._propagationImmediateStopped && owner._bubblingListeners) {\r\n        owner._bubblingListeners.emit(event.type, event);\r\n    }\r\n\r\n    if (!event._propagationStopped && event.bubbles) {\r\n        // Event.BUBBLING_PHASE\r\n        owner._getBubblingTargets(event.type, _cachedArray);\r\n        // propagate\r\n        event.eventPhase = 3;\r\n        for (i = 0; i < _cachedArray.length; ++i) {\r\n            target = _cachedArray[i];\r\n            if (target._bubblingListeners) {\r\n                event.currentTarget = target;\r\n                // fire event\r\n                target._bubblingListeners.emit(event.type, event);\r\n                // check if propagation stopped\r\n                if (event._propagationStopped) {\r\n                    _cachedArray.length = 0;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _cachedArray.length = 0;\r\n}\r\n\r\n/**\r\n * !#en\r\n * Class of all entities in Cocos Creator scenes.<br/>\r\n * For events supported by Node, please refer to {{#crossLink \"Node.EventType\"}}{{/crossLink}}\r\n * !#zh\r\n * Cocos Creator <br/>\r\n *  {{#crossLink \"Node.EventType\"}}{{/crossLink}}\r\n * @class Node\r\n * @extends _BaseNode\r\n */\r\nlet NodeDefines = {\r\n    name: 'cc.Node',\r\n    extends: BaseNode,\r\n\r\n    properties: {\r\n        // SERIALIZABLE\r\n        _opacity: 255,\r\n        _color: cc.Color.WHITE,\r\n        _contentSize: cc.Size,\r\n        _anchorPoint: cc.v2(0.5, 0.5),\r\n        _position: cc.Vec3,\r\n        _scale: cc.Vec3,\r\n        _quat: cc.Quat,\r\n        _skewX: 0.0,\r\n        _skewY: 0.0,\r\n        _localZOrder: {\r\n            default: 0,\r\n            serializable: false\r\n        },\r\n        _zIndex: 0,\r\n\r\n        _is3DNode: false,\r\n\r\n        // internal properties\r\n\r\n        /**\r\n         * !#en\r\n         * Group index of node.<br/>\r\n         * Which Group this node belongs to will resolve that this node's collision components can collide with which other collision componentns.<br/>\r\n         * !#zh\r\n         * <br/>\r\n         * <br/>\r\n         * @property groupIndex\r\n         * @type {Integer}\r\n         * @default 0\r\n         */\r\n        groupIndex: {\r\n            default: 0,\r\n            type: cc.Integer\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Group of node.<br/>\r\n         * Which Group this node belongs to will resolve that this node's collision components can collide with which other collision componentns.<br/>\r\n         * !#zh\r\n         * <br/>\r\n         * <br/>\r\n         * @property group\r\n         * @type {String}\r\n         */\r\n        group: {\r\n            get () {\r\n                return cc.game.groupList[this.groupIndex] || '';\r\n            },\r\n\r\n            set (value) {\r\n                this.groupIndex = cc.game.groupList.indexOf(value);\r\n                this.emit(EventType.GROUP_CHANGED, this);\r\n            }\r\n        },\r\n\r\n        //properties moved from base node begin\r\n\r\n        /**\r\n         * !#en The position (x, y) of the node in its parent's coordinates.\r\n         * !#zh x, y\r\n         * @property {Vec2} position\r\n         * @example\r\n         * cc.log(\"Node Position: \" + node.position);\r\n         */\r\n\r\n        /**\r\n         * !#en x axis position of node.\r\n         * !#zh  X \r\n         * @property x\r\n         * @type {Number}\r\n         * @example\r\n         * node.x = 100;\r\n         * cc.log(\"Node Position X: \" + node.x);\r\n         */\r\n        x: {\r\n            get () {\r\n                return this._position.x;\r\n            },\r\n            set (value) {\r\n                var localPosition = this._position;\r\n                if (value !== localPosition.x) {\r\n                    if (!CC_EDITOR || isFinite(value)) {\r\n                        if (CC_EDITOR) {\r\n                            var oldValue = localPosition.x;\r\n                        }\r\n\r\n                        localPosition.x = value;\r\n                        this.setLocalDirty(LocalDirtyFlag.POSITION);\r\n                        this._renderFlag |= RenderFlow.FLAG_WORLD_TRANSFORM;\r\n                        \r\n                        // fast check event\r\n                        if (this._eventMask & POSITION_ON) {\r\n                            // send event\r\n                            if (CC_EDITOR) {\r\n                                this.emit(EventType.POSITION_CHANGED, new cc.Vec3(oldValue, localPosition.y, localPosition.z));\r\n                            }\r\n                            else {\r\n                                this.emit(EventType.POSITION_CHANGED);\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        cc.error(ERR_INVALID_NUMBER, 'new x');\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en y axis position of node.\r\n         * !#zh  Y \r\n         * @property y\r\n         * @type {Number}\r\n         * @example\r\n         * node.y = 100;\r\n         * cc.log(\"Node Position Y: \" + node.y);\r\n         */\r\n        y: {\r\n            get () {\r\n                return this._position.y;\r\n            },\r\n            set (value) {\r\n                var localPosition = this._position;\r\n                if (value !== localPosition.y) {\r\n                    if (!CC_EDITOR || isFinite(value)) {\r\n                        if (CC_EDITOR) {\r\n                            var oldValue = localPosition.y;\r\n                        }\r\n\r\n                        localPosition.y = value;\r\n                        this.setLocalDirty(LocalDirtyFlag.POSITION);\r\n                        this._renderFlag |= RenderFlow.FLAG_WORLD_TRANSFORM;\r\n\r\n                        // fast check event\r\n                        if (this._eventMask & POSITION_ON) {\r\n                            // send event\r\n                            if (CC_EDITOR) {\r\n                                this.emit(EventType.POSITION_CHANGED, new cc.Vec3(localPosition.x, oldValue, localPosition.z));\r\n                            }\r\n                            else {\r\n                                this.emit(EventType.POSITION_CHANGED);\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        cc.error(ERR_INVALID_NUMBER, 'new y');\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en z axis position of node.\r\n         * !#zh  Z \r\n         * @property z\r\n         * @type {Number}\r\n         */\r\n\r\n        /**\r\n         * !#en Rotation of node.\r\n         * !#zh \r\n         * @property rotation\r\n         * @type {Number}\r\n         * @deprecated since v2.1\r\n         * @example\r\n         * node.rotation = 90;\r\n         * cc.log(\"Node Rotation: \" + node.rotation);\r\n         */\r\n        rotation: {\r\n            get () {\r\n                return -this.angle;\r\n            },\r\n            set (value) {\r\n                this.angle = -value;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Angle of node, the positive value is anti-clockwise direction.\r\n         * !#zh\r\n         * \r\n         * @property angle\r\n         * @type {Number}\r\n         */\r\n        angle: {\r\n            get () {\r\n                return this._eulerAngles.z;\r\n            },\r\n            set (value) {\r\n                math.vec3.set(this._eulerAngles, 0, 0, value);\r\n                this._fromEuler();\r\n                this.setLocalDirty(LocalDirtyFlag.ROTATION);\r\n                this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n                if (this._eventMask & ROTATION_ON) {\r\n                    this.emit(EventType.ROTATION_CHANGED);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The rotation as Euler angles in degrees, used in 2.5D project.\r\n         * !#zh  2.5D \r\n         * @property eulerAngles\r\n         * @type {Vec3}\r\n         */\r\n\r\n        /**\r\n         * !#en Rotation on x axis.\r\n         * !#zh  X \r\n         * @property rotationX\r\n         * @type {Number}\r\n         * @example\r\n         * @deprecated since v2.1\r\n         * node.rotationX = 45;\r\n         * cc.log(\"Node Rotation X: \" + node.rotationX);\r\n         */\r\n        rotationX: {\r\n            get () {\r\n                return this._eulerAngles.x;\r\n            },\r\n            set (value) {\r\n                if (this._eulerAngles.x !== value) {\r\n                    this._eulerAngles.x = value;\r\n                    // Update quaternion from rotation\r\n                    if (this._eulerAngles.x === this._eulerAngles.y) {\r\n                        math.quat.fromEuler(this._quat, 0, 0, -value);\r\n                    }\r\n                    else {\r\n                        math.quat.fromEuler(this._quat, value, this._eulerAngles.y, 0);\r\n                    }\r\n                    this.setLocalDirty(LocalDirtyFlag.ROTATION);\r\n                    this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n                    if (this._eventMask & ROTATION_ON) {\r\n                        this.emit(EventType.ROTATION_CHANGED);\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en Rotation on y axis.\r\n         * !#zh  Y \r\n         * @property rotationY\r\n         * @type {Number}\r\n         * @example\r\n         * @deprecated since v2.1\r\n         * node.rotationY = 45;\r\n         * cc.log(\"Node Rotation Y: \" + node.rotationY);\r\n         */\r\n        rotationY: {\r\n            get () {\r\n                return this._eulerAngles.y;\r\n            },\r\n            set (value) {\r\n                if (this._eulerAngles.y !== value) {\r\n                    this._eulerAngles.y = value;\r\n                    // Update quaternion from rotation\r\n                    if (this._eulerAngles.x === this._eulerAngles.y) {\r\n                        math.quat.fromEuler(this._quat, 0, 0, -value);\r\n                    }\r\n                    else {\r\n                        math.quat.fromEuler(this._quat, this._eulerAngles.x, value, 0);\r\n                    }\r\n                    this.setLocalDirty(LocalDirtyFlag.ROTATION);\r\n                    this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n                    if (this._eventMask & ROTATION_ON) {\r\n                        this.emit(EventType.ROTATION_CHANGED);\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en The local scale relative to the parent.\r\n         * !#zh \r\n         * @property scale\r\n         * @type {Number}\r\n         * @example\r\n         * node.scale = 1;\r\n         */\r\n        scale: {\r\n            get () {\r\n                return this._scale.x;\r\n            },\r\n            set (v) {\r\n                this.setScale(v);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Scale on x axis.\r\n         * !#zh  X \r\n         * @property scaleX\r\n         * @type {Number}\r\n         * @example\r\n         * node.scaleX = 0.5;\r\n         * cc.log(\"Node Scale X: \" + node.scaleX);\r\n         */\r\n        scaleX: {\r\n            get () {\r\n                return this._scale.x;\r\n            },\r\n            set (value) {\r\n                if (this._scale.x !== value) {\r\n                    this._scale.x = value;\r\n                    this.setLocalDirty(LocalDirtyFlag.SCALE);\r\n                    this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n                    if (this._eventMask & SCALE_ON) {\r\n                        this.emit(EventType.SCALE_CHANGED);\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en Scale on y axis.\r\n         * !#zh  Y \r\n         * @property scaleY\r\n         * @type {Number}\r\n         * @example\r\n         * node.scaleY = 0.5;\r\n         * cc.log(\"Node Scale Y: \" + node.scaleY);\r\n         */\r\n        scaleY: {\r\n            get () {\r\n                return this._scale.y;\r\n            },\r\n            set (value) {\r\n                if (this._scale.y !== value) {\r\n                    this._scale.y = value;\r\n                    this.setLocalDirty(LocalDirtyFlag.SCALE);\r\n                    this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n                    if (this._eventMask & SCALE_ON) {\r\n                        this.emit(EventType.SCALE_CHANGED);\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en Scale on z axis.\r\n         * !#zh  Z \r\n         * @property scaleZ\r\n         * @type {Number}\r\n         */\r\n\r\n        /**\r\n         * !#en Skew x\r\n         * !#zh  X \r\n         * @property skewX\r\n         * @type {Number}\r\n         * @example\r\n         * node.skewX = 0;\r\n         * cc.log(\"Node SkewX: \" + node.skewX);\r\n         */\r\n        skewX: {\r\n            get () {\r\n                return this._skewX;\r\n            },\r\n            set (value) {\r\n                this._skewX = value;\r\n                this.setLocalDirty(LocalDirtyFlag.SKEW);\r\n                this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Skew y\r\n         * !#zh  Y \r\n         * @property skewY\r\n         * @type {Number}\r\n         * @example\r\n         * node.skewY = 0;\r\n         * cc.log(\"Node SkewY: \" + node.skewY);\r\n         */\r\n        skewY: {\r\n            get () {\r\n                return this._skewY;\r\n            },\r\n            set (value) {\r\n                this._skewY = value;\r\n                this.setLocalDirty(LocalDirtyFlag.SKEW);\r\n                this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Opacity of node, default value is 255.\r\n         * !#zh  255\r\n         * @property opacity\r\n         * @type {Number}\r\n         * @example\r\n         * node.opacity = 255;\r\n         */\r\n        opacity: {\r\n            get () {\r\n                return this._opacity;\r\n            },\r\n            set (value) {\r\n                if (this._opacity !== value) {\r\n                    this._opacity = value;\r\n                    this._renderFlag |= RenderFlow.FLAG_OPACITY | RenderFlow.FLAG_COLOR;\r\n                }\r\n            },\r\n            range: [0, 255]\r\n        },\r\n\r\n        /**\r\n         * !#en Color of node, default value is white: (255, 255, 255).\r\n         * !#zh 255255255\r\n         * @property color\r\n         * @type {Color}\r\n         * @example\r\n         * node.color = new cc.Color(255, 255, 255);\r\n         */\r\n        color: {\r\n            get () {\r\n                return this._color.clone()\r\n            },\r\n            set (value) {\r\n                if (!this._color.equals(value)) {\r\n                    this._color.set(value);\r\n                    if (CC_DEV && value.a !== 255) {\r\n                        cc.warnID(1626);\r\n                    }\r\n                    \r\n                    if (this._renderComponent) {\r\n                        this._renderFlag |= RenderFlow.FLAG_COLOR;\r\n                    }\r\n\r\n                    if (this._eventMask & COLOR_ON) {\r\n                        this.emit(EventType.COLOR_CHANGED, value);\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en Anchor point's position on x axis.\r\n         * !#zh  X \r\n         * @property anchorX\r\n         * @type {Number}\r\n         * @example\r\n         * node.anchorX = 0;\r\n         */\r\n        anchorX: {\r\n            get () {\r\n                return this._anchorPoint.x;\r\n            },\r\n            set (value) {\r\n                var anchorPoint = this._anchorPoint;\r\n                if (anchorPoint.x !== value) {\r\n                    anchorPoint.x = value;\r\n                    if (this._eventMask & ANCHOR_ON) {\r\n                        this.emit(EventType.ANCHOR_CHANGED);\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en Anchor point's position on y axis.\r\n         * !#zh  Y \r\n         * @property anchorY\r\n         * @type {Number}\r\n         * @example\r\n         * node.anchorY = 0;\r\n         */\r\n        anchorY: {\r\n            get () {\r\n                return this._anchorPoint.y;\r\n            },\r\n            set (value) {\r\n                var anchorPoint = this._anchorPoint;\r\n                if (anchorPoint.y !== value) {\r\n                    anchorPoint.y = value;\r\n                    if (this._eventMask & ANCHOR_ON) {\r\n                        this.emit(EventType.ANCHOR_CHANGED);\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en Width of node.\r\n         * !#zh \r\n         * @property width\r\n         * @type {Number}\r\n         * @example\r\n         * node.width = 100;\r\n         */\r\n        width: {\r\n            get () {\r\n                return this._contentSize.width;\r\n            },\r\n            set (value) {\r\n                if (value !== this._contentSize.width) {\r\n                    if (CC_EDITOR) {\r\n                        var clone = cc.size(this._contentSize.width, this._contentSize.height);\r\n                    }\r\n                    this._contentSize.width = value;\r\n                    if (this._eventMask & SIZE_ON) {\r\n                        if (CC_EDITOR) {\r\n                            this.emit(EventType.SIZE_CHANGED, clone);\r\n                        }\r\n                        else {\r\n                            this.emit(EventType.SIZE_CHANGED);\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en Height of node.\r\n         * !#zh \r\n         * @property height\r\n         * @type {Number}\r\n         * @example\r\n         * node.height = 100;\r\n         */\r\n        height: {\r\n            get () {\r\n                return this._contentSize.height;\r\n            },\r\n            set (value) {\r\n                if (value !== this._contentSize.height) {\r\n                    if (CC_EDITOR) {\r\n                        var clone = cc.size(this._contentSize.width, this._contentSize.height);\r\n                    }\r\n                    this._contentSize.height = value;\r\n                    if (this._eventMask & SIZE_ON) {\r\n                        if (CC_EDITOR) {\r\n                            this.emit(EventType.SIZE_CHANGED, clone);\r\n                        }\r\n                        else {\r\n                            this.emit(EventType.SIZE_CHANGED);\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en zIndex is the 'key' used to sort the node relative to its siblings.<br/>\r\n         * The value of zIndex should be in the range between cc.macro.MIN_ZINDEX and cc.macro.MAX_ZINDEX.<br/>\r\n         * The Node's parent will sort all its children based on the zIndex value and the arrival order.<br/>\r\n         * Nodes with greater zIndex will be sorted after nodes with smaller zIndex.<br/>\r\n         * If two nodes have the same zIndex, then the node that was added first to the children's array will be in front of the other node in the array.<br/>\r\n         * Node's order in children list will affect its rendering order. Parent is always rendering before all children.\r\n         * !#zh zIndex <br/>\r\n         * zIndex  cc.macro.MIN_ZINDEX  cc.macro.MAX_ZINDEX \r\n         *  zIndex  zIndex  zIndex <br/>\r\n         *  children \r\n         * @property zIndex\r\n         * @type {Number}\r\n         * @example\r\n         * node.zIndex = 1;\r\n         * cc.log(\"Node zIndex: \" + node.zIndex);\r\n         */\r\n        zIndex: {\r\n            get () {\r\n                return this._zIndex;\r\n            },\r\n            set (value) {\r\n                if (value > macro.MAX_ZINDEX) {\r\n                    cc.warnID(1636);\r\n                    value = macro.MAX_ZINDEX;\r\n                }\r\n                else if (value < macro.MIN_ZINDEX) {\r\n                    cc.warnID(1637);\r\n                    value = macro.MIN_ZINDEX;\r\n                }\r\n\r\n                if (this._zIndex !== value) {\r\n                    this._zIndex = value;\r\n                    this._localZOrder = (this._localZOrder & 0x0000ffff) | (value << 16);\r\n\r\n                    if (this._parent) {\r\n                        this._parent._delaySort();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n    },\r\n\r\n    /**\r\n     * @method constructor\r\n     * @param {String} [name]\r\n     */\r\n    ctor () {\r\n        this._reorderChildDirty = false;\r\n        \r\n        // cache component\r\n        this._widget = null;\r\n        // fast render component access\r\n        this._renderComponent = null;\r\n        // Event listeners\r\n        this._capturingListeners = null;\r\n        this._bubblingListeners = null;\r\n        // Touch event listener\r\n        this._touchListener = null;\r\n        // Mouse event listener\r\n        this._mouseListener = null;\r\n\r\n        // default scale\r\n        this._scale.x = 1;\r\n        this._scale.y = 1;\r\n        this._scale.z = 1;\r\n\r\n        this._matrix = mathPools.mat4.get();\r\n        this._worldMatrix = mathPools.mat4.get();\r\n        this._localMatDirty = LocalDirtyFlag.ALL;\r\n        this._worldMatDirty = true;\r\n\r\n        this._eventMask = 0;\r\n        this._cullingMask = 1 << this.groupIndex;\r\n\r\n        this._eulerAngles = cc.v3();\r\n    },\r\n\r\n    statics: {\r\n        EventType,\r\n        _LocalDirtyFlag: LocalDirtyFlag,\r\n        // is node but not scene\r\n        isNode (obj) {\r\n            return obj instanceof Node && (obj.constructor === Node || !(obj instanceof cc.Scene));\r\n        },\r\n\r\n        BuiltinGroupIndex\r\n    },\r\n\r\n    // OVERRIDES\r\n\r\n    _onSiblingIndexChanged (index) {\r\n        // update rendering scene graph, sort them by arrivalOrder\r\n        var parent = this._parent;\r\n        var siblings = parent._children;\r\n        var i = 0, len = siblings.length, sibling;\r\n        for (; i < len; i++) {\r\n            sibling = siblings[i];\r\n            sibling._updateOrderOfArrival();\r\n            eventManager._setDirtyForNode(sibling);\r\n        }\r\n        parent._delaySort();\r\n    },\r\n\r\n    _onPreDestroy () {\r\n        var destroyByParent = this._onPreDestroyBase();\r\n\r\n        // Actions\r\n        if (ActionManagerExist) {\r\n            cc.director.getActionManager().removeAllActionsFromTarget(this);\r\n        }\r\n\r\n        // Remove Node.currentHovered\r\n        if (_currentHovered === this) {\r\n            _currentHovered = null;\r\n        }\r\n\r\n        // Remove all event listeners if necessary\r\n        if (this._touchListener || this._mouseListener) {\r\n            eventManager.removeListeners(this);\r\n            if (this._touchListener) {\r\n                this._touchListener.owner = null;\r\n                this._touchListener.mask = null;\r\n                this._touchListener = null;\r\n            }\r\n            if (this._mouseListener) {\r\n                this._mouseListener.owner = null;\r\n                this._mouseListener.mask = null;\r\n                this._mouseListener = null;\r\n            }\r\n        }\r\n\r\n        // Recycle math objects\r\n        mathPools.mat4.put(this._matrix);\r\n        mathPools.mat4.put(this._worldMatrix);\r\n        this._matrix = this._worldMatrix = null;\r\n\r\n        if (this._reorderChildDirty) {\r\n            cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE, this.sortAllChildren, this);\r\n        }\r\n\r\n        if (!destroyByParent) {\r\n            // simulate some destruct logic to make undo system work correctly\r\n            if (CC_EDITOR) {\r\n                // ensure this node can reattach to scene by undo system\r\n                this._parent = null;\r\n            }\r\n        }\r\n    },\r\n\r\n    _onPostActivated (active) {\r\n        var actionManager = ActionManagerExist ? cc.director.getActionManager() : null;\r\n        if (active) {\r\n            // Refresh transform\r\n            this._renderFlag |= RenderFlow.FLAG_WORLD_TRANSFORM;\r\n            // ActionManager & EventManager\r\n            actionManager && actionManager.resumeTarget(this);\r\n            eventManager.resumeTarget(this);\r\n            if (this._touchListener) {\r\n                var mask = this._touchListener.mask = _searchMaskInParent(this);\r\n                if (this._mouseListener) {\r\n                    this._mouseListener.mask = mask;\r\n                }\r\n            }\r\n            else if (this._mouseListener) {\r\n                this._mouseListener.mask = _searchMaskInParent(this);\r\n            }\r\n        }\r\n        else {\r\n            // deactivate\r\n            actionManager && actionManager.pauseTarget(this);\r\n            eventManager.pauseTarget(this);\r\n        }\r\n    },\r\n\r\n    _onHierarchyChanged (oldParent) {\r\n        this._updateOrderOfArrival();\r\n        if (this._parent) {\r\n            this._parent._delaySort();\r\n        }\r\n        this._renderFlag |= RenderFlow.FLAG_WORLD_TRANSFORM;\r\n        this._onHierarchyChangedBase(oldParent);\r\n        if (cc._widgetManager) {\r\n            cc._widgetManager._nodesOrderDirty = true;\r\n        }\r\n    },\r\n\r\n    // INTERNAL\r\n\r\n    _toEuler () {\r\n        if (this.is3DNode) {\r\n            this._quat.toEuler(this._eulerAngles);\r\n        }\r\n        else {\r\n            let z = Math.asin(this._quat.z) / ONE_DEGREE * 2;\r\n            math.vec3.set(this._eulerAngles, 0, 0, z);\r\n        }\r\n    },\r\n    _fromEuler () {\r\n        if (this.is3DNode) {\r\n            this._quat.fromEuler(this._eulerAngles);\r\n        }\r\n        else {\r\n            math.quat.fromEuler(this._quat, 0, 0, this._eulerAngles.z);\r\n        }\r\n    },\r\n\r\n    _upgrade_1x_to_2x () {\r\n        // Upgrade scaleX, scaleY from v1.x\r\n        // TODO: remove in future version, 3.0 ?\r\n        if (this._scaleX !== undefined) {\r\n            this._scale.x = this._scaleX;\r\n            this._scaleX = undefined;\r\n        }\r\n        if (this._scaleY !== undefined) {\r\n            this._scale.y = this._scaleY;\r\n            this._scaleY = undefined;\r\n        }\r\n\r\n        if (this._localZOrder !== 0) {\r\n            this._zIndex = (this._localZOrder & 0xffff0000) >> 16;\r\n        }\r\n\r\n        // TODO: remove _rotationX & _rotationY in future version, 3.0 ?\r\n        // Update quaternion from rotation, when upgrade from 1.x to 2.0\r\n        // If rotation x & y is 0 in old version, then update rotation from default quaternion is ok too\r\n        let quat = this._quat;\r\n        if ((this._rotationX || this._rotationY) && \r\n            (quat.x === 0 && quat.y === 0 && quat.z === 0 && quat.w === 1)) {\r\n            if (this._rotationX === this._rotationY) {\r\n                math.quat.fromEuler(quat, 0, 0, -this._rotationX);\r\n            }\r\n            else {\r\n                math.quat.fromEuler(quat, this._rotationX, this._rotationY, 0);\r\n            }\r\n            this._rotationX = this._rotationY = undefined;\r\n        }\r\n        \r\n        this._toEuler();\r\n\r\n        // Upgrade from 2.0.0 preview 4 & earlier versions\r\n        // TODO: Remove after final version\r\n        if (this._color.a < 255 && this._opacity === 255) {\r\n            this._opacity = this._color.a;\r\n            this._color.a = 255;\r\n        }\r\n    },\r\n\r\n    /*\r\n     * The initializer for Node which will be called before all components onLoad\r\n     */\r\n    _onBatchCreated () {\r\n        this._upgrade_1x_to_2x();\r\n\r\n        this._updateOrderOfArrival();\r\n\r\n        let prefabInfo = this._prefab;\r\n        if (prefabInfo && prefabInfo.sync && prefabInfo.root === this) {\r\n            if (CC_DEV) {\r\n                // TODO - remove all usage of _synced\r\n                cc.assert(!prefabInfo._synced, 'prefab should not synced');\r\n            }\r\n            PrefabHelper.syncWithPrefab(this);\r\n        }\r\n\r\n        if (!this._activeInHierarchy) {\r\n            // deactivate ActionManager and EventManager by default\r\n            if (ActionManagerExist) {\r\n                cc.director.getActionManager().pauseTarget(this);\r\n            }\r\n            eventManager.pauseTarget(this);\r\n        }\r\n\r\n        let children = this._children;\r\n        for (let i = 0, len = children.length; i < len; i++) {\r\n            children[i]._onBatchCreated();\r\n        }\r\n\r\n        if (children.length > 0) {\r\n            this._renderFlag |= RenderFlow.FLAG_CHILDREN;\r\n        }\r\n    },\r\n\r\n    // the same as _onBatchCreated but untouch prefab\r\n    _onBatchRestored () {\r\n        this._upgrade_1x_to_2x();\r\n\r\n        if (!this._activeInHierarchy) {\r\n            // deactivate ActionManager and EventManager by default\r\n\r\n            // ActionManager may not be inited in the editor worker.\r\n            let manager = cc.director.getActionManager();\r\n            manager && manager.pauseTarget(this);\r\n\r\n            eventManager.pauseTarget(this);\r\n        }\r\n\r\n        var children = this._children;\r\n        for (var i = 0, len = children.length; i < len; i++) {\r\n            children[i]._onBatchRestored();\r\n        }\r\n\r\n        if (children.length > 0) {\r\n            this._renderFlag |= RenderFlow.FLAG_CHILDREN;\r\n        }\r\n    },\r\n\r\n    // EVENT TARGET\r\n\r\n    _checknSetupSysEvent (type) {\r\n        let newAdded = false;\r\n        let forDispatch = false;\r\n        if (_touchEvents.indexOf(type) !== -1) {\r\n            if (!this._touchListener) {\r\n                this._touchListener = cc.EventListener.create({\r\n                    event: cc.EventListener.TOUCH_ONE_BY_ONE,\r\n                    swallowTouches: true,\r\n                    owner: this,\r\n                    mask: _searchMaskInParent(this),\r\n                    onTouchBegan: _touchStartHandler,\r\n                    onTouchMoved: _touchMoveHandler,\r\n                    onTouchEnded: _touchEndHandler,\r\n                    onTouchCancelled: _touchCancelHandler\r\n                });\r\n                eventManager.addListener(this._touchListener, this);\r\n                newAdded = true;\r\n            }\r\n            forDispatch = true;\r\n        }\r\n        else if (_mouseEvents.indexOf(type) !== -1) {\r\n            if (!this._mouseListener) {\r\n                this._mouseListener = cc.EventListener.create({\r\n                    event: cc.EventListener.MOUSE,\r\n                    _previousIn: false,\r\n                    owner: this,\r\n                    mask: _searchMaskInParent(this),\r\n                    onMouseDown: _mouseDownHandler,\r\n                    onMouseMove: _mouseMoveHandler,\r\n                    onMouseUp: _mouseUpHandler,\r\n                    onMouseScroll: _mouseWheelHandler,\r\n                });\r\n                eventManager.addListener(this._mouseListener, this);\r\n                newAdded = true;\r\n            }\r\n            forDispatch = true;\r\n        }\r\n        if (newAdded && !this._activeInHierarchy) {\r\n            cc.director.getScheduler().schedule(function () {\r\n                if (!this._activeInHierarchy) {\r\n                    eventManager.pauseTarget(this);\r\n                }\r\n            }, this, 0, 0, 0, false);\r\n        }\r\n        return forDispatch;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Register a callback of a specific event type on Node.<br/>\r\n     * Use this method to register touch or mouse event permit propagation based on scene graph,<br/>\r\n     * These kinds of event are triggered with dispatchEvent, the dispatch process has three steps:<br/>\r\n     * 1. Capturing phase: dispatch in capture targets (`_getCapturingTargets`), e.g. parents in node tree, from root to the real target<br/>\r\n     * 2. At target phase: dispatch to the listeners of the real target<br/>\r\n     * 3. Bubbling phase: dispatch in bubble targets (`_getBubblingTargets`), e.g. parents in node tree, from the real target to root<br/>\r\n     * In any moment of the dispatching process, it can be stopped via `event.stopPropagation()` or `event.stopPropagationImmidiate()`.<br/>\r\n     * It's the recommended way to register touch/mouse event for Node,<br/>\r\n     * please do not use cc.eventManager directly for Node.<br/>\r\n     * You can also register custom event and use `emit` to trigger custom event on Node.<br/>\r\n     * For such events, there won't be capturing and bubbling phase, your event will be dispatched directly to its listeners registered on the same node.<br/>\r\n     * You can also pass event callback parameters with `emit` by passing parameters after `type`.\r\n     * !#zh\r\n     *  target  this <br/>\r\n     *  dispatchEvent <br/>\r\n     * 1.  `_getCapturingTargets` <br/>\r\n     * 2. <br/>\r\n     * 3.  `_getBubblingTargets` <br/>\r\n     *  stopPropagation <br/>\r\n     *  cc.eventManager<br/>\r\n     *  emit <br/>\r\n     *  emit  type \r\n     * @method on\r\n     * @param {String|Node.EventType} type - A string representing the event type to listen for.<br>See {{#crossLink \"Node/EventTyupe/POSITION_CHANGED\"}}Node Events{{/crossLink}} for all builtin events.\r\n     * @param {Function} callback - The callback that will be invoked when the event is dispatched. The callback is ignored if it is a duplicate (the callbacks are unique).\r\n     * @param {Event|any} [callback.event] event or first argument when emit\r\n     * @param {any} [callback.arg2] arg2\r\n     * @param {any} [callback.arg3] arg3\r\n     * @param {any} [callback.arg4] arg4\r\n     * @param {any} [callback.arg5] arg5\r\n     * @param {Object} [target] - The target (this object) to invoke the callback, can be null\r\n     * @param {Boolean} [useCapture=false] - When set to true, the listener will be triggered at capturing phase which is ahead of the final target emit, otherwise it will be triggered during bubbling phase.\r\n     * @return {Function} - Just returns the incoming callback so you can save the anonymous function easier.\r\n     * @typescript\r\n     * on<T extends Function>(type: string, callback: T, target?: any, useCapture?: boolean): T\r\n     * @example\r\n     * this.node.on(cc.Node.EventType.TOUCH_START, this.memberFunction, this);  // if \"this\" is component and the \"memberFunction\" declared in CCClass.\r\n     * node.on(cc.Node.EventType.TOUCH_START, callback, this);\r\n     * node.on(cc.Node.EventType.TOUCH_MOVE, callback, this);\r\n     * node.on(cc.Node.EventType.TOUCH_END, callback, this);\r\n     * node.on(cc.Node.EventType.TOUCH_CANCEL, callback, this);\r\n     * node.on(cc.Node.EventType.ANCHOR_CHANGED, callback);\r\n     * node.on(cc.Node.EventType.COLOR_CHANGED, callback);\r\n     */\r\n    on (type, callback, target, useCapture) {\r\n        let forDispatch = this._checknSetupSysEvent(type);\r\n        if (forDispatch) {\r\n            return this._onDispatch(type, callback, target, useCapture);\r\n        }\r\n        else {\r\n            switch (type) {\r\n                case EventType.POSITION_CHANGED:\r\n                this._eventMask |= POSITION_ON;\r\n                break;\r\n                case EventType.SCALE_CHANGED:\r\n                this._eventMask |= SCALE_ON;\r\n                break;\r\n                case EventType.ROTATION_CHANGED:\r\n                this._eventMask |= ROTATION_ON;\r\n                break;\r\n                case EventType.SIZE_CHANGED:\r\n                this._eventMask |= SIZE_ON;\r\n                break;\r\n                case EventType.ANCHOR_CHANGED:\r\n                this._eventMask |= ANCHOR_ON;\r\n                break;\r\n                case EventType.COLOR_CHANGED:\r\n                this._eventMask |= COLOR_ON;\r\n                break;\r\n            }\r\n            if (!this._bubblingListeners) {\r\n                this._bubblingListeners = new EventTarget();\r\n            }\r\n            return this._bubblingListeners.on(type, callback, target);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Register an callback of a specific event type on the Node,\r\n     * the callback will remove itself after the first time it is triggered.\r\n     * !#zh\r\n     * \r\n     *\r\n     * @method once\r\n     * @param {String} type - A string representing the event type to listen for.\r\n     * @param {Function} callback - The callback that will be invoked when the event is dispatched.\r\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\r\n     * @param {Event|any} [callback.event] event or first argument when emit\r\n     * @param {any} [callback.arg2] arg2\r\n     * @param {any} [callback.arg3] arg3\r\n     * @param {any} [callback.arg4] arg4\r\n     * @param {any} [callback.arg5] arg5\r\n     * @param {Object} [target] - The target (this object) to invoke the callback, can be null\r\n     * @typescript\r\n     * once<T extends Function>(type: string, callback: T, target?: any, useCapture?: boolean): T\r\n     * @example\r\n     * node.once(cc.Node.EventType.ANCHOR_CHANGED, callback);\r\n     */\r\n    once (type, callback, target, useCapture) {\r\n        let forDispatch = this._checknSetupSysEvent(type);\r\n        let eventType_hasOnceListener = '__ONCE_FLAG:' + type;\r\n\r\n        let listeners = null;\r\n        if (forDispatch && useCapture) {\r\n            listeners = this._capturingListeners = this._capturingListeners || new EventTarget();\r\n        }\r\n        else {\r\n            listeners = this._bubblingListeners = this._bubblingListeners || new EventTarget();\r\n        }\r\n\r\n        let hasOnceListener = listeners.hasEventListener(eventType_hasOnceListener, callback, target);\r\n        if (!hasOnceListener) {\r\n            let self = this;\r\n            let onceWrapper = function (arg1, arg2, arg3, arg4, arg5) {\r\n                self.off(type, onceWrapper, target);\r\n                listeners.remove(eventType_hasOnceListener, callback, target);\r\n                callback.call(this, arg1, arg2, arg3, arg4, arg5);\r\n            };\r\n            this.on(type, onceWrapper, target);\r\n            listeners.add(eventType_hasOnceListener, callback, target);\r\n        }\r\n    },\r\n\r\n    _onDispatch (type, callback, target, useCapture) {\r\n        // Accept also patameters like: (type, callback, useCapture)\r\n        if (typeof target === 'boolean') {\r\n            useCapture = target;\r\n            target = undefined;\r\n        }\r\n        else useCapture = !!useCapture;\r\n        if (!callback) {\r\n            cc.errorID(6800);\r\n            return;\r\n        }\r\n\r\n        var listeners = null;\r\n        if (useCapture) {\r\n            listeners = this._capturingListeners = this._capturingListeners || new EventTarget();\r\n        }\r\n        else {\r\n            listeners = this._bubblingListeners = this._bubblingListeners || new EventTarget();\r\n        }\r\n\r\n        if ( !listeners.hasEventListener(type, callback, target) ) {\r\n            listeners.add(type, callback, target);\r\n\r\n            if (target && target.__eventTargets)\r\n                target.__eventTargets.push(this);\r\n        }\r\n\r\n        return callback;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Removes the callback previously registered with the same type, callback, target and or useCapture.\r\n     * This method is merely an alias to removeEventListener.\r\n     * !#zh  useCapture \r\n     * @method off\r\n     * @param {String} type - A string representing the event type being removed.\r\n     * @param {Function} [callback] - The callback to remove.\r\n     * @param {Object} [target] - The target (this object) to invoke the callback, if it's not given, only callback without target will be removed\r\n     * @param {Boolean} [useCapture=false] - When set to true, the listener will be triggered at capturing phase which is ahead of the final target emit, otherwise it will be triggered during bubbling phase.\r\n     * @example\r\n     * this.node.off(cc.Node.EventType.TOUCH_START, this.memberFunction, this);\r\n     * node.off(cc.Node.EventType.TOUCH_START, callback, this.node);\r\n     * node.off(cc.Node.EventType.ANCHOR_CHANGED, callback, this);\r\n     */\r\n    off (type, callback, target, useCapture) {\r\n        let touchEvent = _touchEvents.indexOf(type) !== -1;\r\n        let mouseEvent = !touchEvent && _mouseEvents.indexOf(type) !== -1;\r\n        if (touchEvent || mouseEvent) {\r\n            this._offDispatch(type, callback, target, useCapture);\r\n\r\n            if (touchEvent) {\r\n                if (this._touchListener && !_checkListeners(this, _touchEvents)) {\r\n                    eventManager.removeListener(this._touchListener);\r\n                    this._touchListener = null;\r\n                }\r\n            }\r\n            else if (mouseEvent) {\r\n                if (this._mouseListener && !_checkListeners(this, _mouseEvents)) {\r\n                    eventManager.removeListener(this._mouseListener);\r\n                    this._mouseListener = null;\r\n                }\r\n            }\r\n        }\r\n        else if (this._bubblingListeners) {\r\n            this._bubblingListeners.off(type, callback, target);\r\n\r\n            var hasListeners = this._bubblingListeners.hasEventListener(type);\r\n            // All listener removed\r\n            if (!hasListeners) {\r\n                switch (type) {\r\n                    case EventType.POSITION_CHANGED:\r\n                    this._eventMask &= ~POSITION_ON;\r\n                    break;\r\n                    case EventType.SCALE_CHANGED:\r\n                    this._eventMask &= ~SCALE_ON;\r\n                    break;\r\n                    case EventType.ROTATION_CHANGED:\r\n                    this._eventMask &= ~ROTATION_ON;\r\n                    break;\r\n                    case EventType.SIZE_CHANGED:\r\n                    this._eventMask &= ~SIZE_ON;\r\n                    break;\r\n                    case EventType.ANCHOR_CHANGED:\r\n                    this._eventMask &= ~ANCHOR_ON;\r\n                    break;\r\n                    case EventType.COLOR_CHANGED:\r\n                    this._eventMask &= ~COLOR_ON;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    _offDispatch (type, callback, target, useCapture) {\r\n        // Accept also patameters like: (type, callback, useCapture)\r\n        if (typeof target === 'boolean') {\r\n            useCapture = target;\r\n            target = undefined;\r\n        }\r\n        else useCapture = !!useCapture;\r\n        if (!callback) {\r\n            this._capturingListeners && this._capturingListeners.removeAll(type);\r\n            this._bubblingListeners && this._bubblingListeners.removeAll(type);\r\n        }\r\n        else {\r\n            var listeners = useCapture ? this._capturingListeners : this._bubblingListeners;\r\n            if (listeners) {\r\n                listeners.remove(type, callback, target);\r\n    \r\n                if (target && target.__eventTargets) {\r\n                    js.array.fastRemove(target.__eventTargets, this);\r\n                }\r\n            }\r\n            \r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Removes all callbacks previously registered with the same target.\r\n     * !#zh \r\n     * @method targetOff\r\n     * @param {Object} target - The target to be searched for all related callbacks\r\n     * @example\r\n     * node.targetOff(target);\r\n     */\r\n    targetOff (target) {\r\n        let listeners = this._bubblingListeners;\r\n        if (listeners) {\r\n            listeners.targetOff(target);\r\n\r\n            // Check for event mask reset\r\n            if ((this._eventMask & POSITION_ON) && !listeners.hasEventListener(EventType.POSITION_CHANGED)) {\r\n                this._eventMask &= ~POSITION_ON;\r\n            }\r\n            if ((this._eventMask & SCALE_ON) && !listeners.hasEventListener(EventType.SCALE_CHANGED)) {\r\n                this._eventMask &= ~SCALE_ON;\r\n            }\r\n            if ((this._eventMask & ROTATION_ON) && !listeners.hasEventListener(EventType.ROTATION_CHANGED)) {\r\n                this._eventMask &= ~ROTATION_ON;\r\n            }\r\n            if ((this._eventMask & SIZE_ON) && !listeners.hasEventListener(EventType.SIZE_CHANGED)) {\r\n                this._eventMask &= ~SIZE_ON;\r\n            }\r\n            if ((this._eventMask & ANCHOR_ON) && !listeners.hasEventListener(EventType.ANCHOR_CHANGED)) {\r\n                this._eventMask &= ~ANCHOR_ON;\r\n            }\r\n            if ((this._eventMask & COLOR_ON) && !listeners.hasEventListener(EventType.COLOR_CHANGED)) {\r\n                this._eventMask &= ~COLOR_ON;\r\n            }\r\n        }\r\n        if (this._capturingListeners) {\r\n            this._capturingListeners.targetOff(target);\r\n        }\r\n\r\n        if (this._touchListener && !_checkListeners(this, _touchEvents)) {\r\n            eventManager.removeListener(this._touchListener);\r\n            this._touchListener = null;\r\n        }\r\n        if (this._mouseListener && !_checkListeners(this, _mouseEvents)) {\r\n            eventManager.removeListener(this._mouseListener);\r\n            this._mouseListener = null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Checks whether the EventTarget object has any callback registered for a specific type of event.\r\n     * !#zh \r\n     * @method hasEventListener\r\n     * @param {String} type - The type of event.\r\n     * @return {Boolean} True if a callback of the specified type is registered; false otherwise.\r\n     */\r\n    hasEventListener (type) {\r\n        let has = false;\r\n        if (this._bubblingListeners) {\r\n            has = this._bubblingListeners.hasEventListener(type);\r\n        }\r\n        if (!has && this._capturingListeners) {\r\n            has = this._capturingListeners.hasEventListener(type);\r\n        }\r\n        return has;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Trigger an event directly with the event name and necessary arguments.\r\n     * !#zh\r\n     * \r\n     *\r\n     * @method emit\r\n     * @param {String} type - event type\r\n     * @param {*} [arg1] - First argument in callback\r\n     * @param {*} [arg2] - Second argument in callback\r\n     * @param {*} [arg3] - Third argument in callback\r\n     * @param {*} [arg4] - Fourth argument in callback\r\n     * @param {*} [arg5] - Fifth argument in callback\r\n     * @example\r\n     * \r\n     * eventTarget.emit('fire', event);\r\n     * eventTarget.emit('fire', message, emitter);\r\n     */\r\n    emit (type, arg1, arg2, arg3, arg4, arg5) {\r\n        if (this._bubblingListeners) {\r\n            this._bubblingListeners.emit(type, arg1, arg2, arg3, arg4, arg5);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Dispatches an event into the event flow.\r\n     * The event target is the EventTarget object upon which the dispatchEvent() method is called.\r\n     * !#zh \r\n     *\r\n     * @method dispatchEvent\r\n     * @param {Event} event - The Event object that is dispatched into the event flow\r\n     */\r\n    dispatchEvent (event) {\r\n        _doDispatchEvent(this, event);\r\n        _cachedArray.length = 0;\r\n    },\r\n\r\n    /**\r\n     * !#en Pause node related system events registered with the current Node. Node system events includes touch and mouse events.\r\n     * If recursive is set to true, then this API will pause the node system events for the node and all nodes in its sub node tree.\r\n     * Reference: http://docs.cocos2d-x.org/editors_and_tools/creator-chapters/scripting/internal-events/\r\n     * !#zh \r\n     *  recursive  true API \r\n     * https://www.cocos.com/docs/creator/scripting/internal-events.html\r\n     * @method pauseSystemEvents\r\n     * @param {Boolean} recursive - Whether to pause node system events on the sub node tree.\r\n     * @example\r\n     * node.pauseSystemEvents(true);\r\n     */\r\n    pauseSystemEvents (recursive) {\r\n        eventManager.pauseTarget(this, recursive);\r\n    },\r\n\r\n    /**\r\n     * !#en Resume node related system events registered with the current Node. Node system events includes touch and mouse events.\r\n     * If recursive is set to true, then this API will resume the node system events for the node and all nodes in its sub node tree.\r\n     * Reference: http://docs.cocos2d-x.org/editors_and_tools/creator-chapters/scripting/internal-events/\r\n     * !#zh \r\n     *  recursive  true API \r\n     * https://www.cocos.com/docs/creator/scripting/internal-events.html\r\n     * @method resumeSystemEvents\r\n     * @param {Boolean} recursive - Whether to resume node system events on the sub node tree.\r\n     * @example\r\n     * node.resumeSystemEvents(true);\r\n     */\r\n    resumeSystemEvents (recursive) {\r\n        eventManager.resumeTarget(this, recursive);\r\n    },\r\n\r\n    _hitTest (point, listener) {\r\n        let w = this._contentSize.width,\r\n            h = this._contentSize.height,\r\n            cameraPt = _vec2a,\r\n            testPt = _vec2b;\r\n        \r\n        let camera = cc.Camera.findCamera(this);\r\n        if (camera) {\r\n            camera.getCameraToWorldPoint(point, cameraPt);\r\n        }\r\n        else {\r\n            cameraPt.set(point);\r\n        }\r\n\r\n        this._updateWorldMatrix();\r\n        math.mat4.invert(_mat4_temp, this._worldMatrix);\r\n        math.vec2.transformMat4(testPt, cameraPt, _mat4_temp);\r\n        testPt.x += this._anchorPoint.x * w;\r\n        testPt.y += this._anchorPoint.y * h;\r\n\r\n        if (testPt.x >= 0 && testPt.y >= 0 && testPt.x <= w && testPt.y <= h) {\r\n            if (listener && listener.mask) {\r\n                var mask = listener.mask;\r\n                var parent = this;\r\n                for (var i = 0; parent && i < mask.index; ++i, parent = parent.parent) {\r\n                }\r\n                // find mask parent, should hit test it\r\n                if (parent === mask.node) {\r\n                    var comp = parent.getComponent(cc.Mask);\r\n                    return (comp && comp.enabledInHierarchy) ? comp._hitTest(cameraPt) : true;\r\n                }\r\n                // mask parent no longer exists\r\n                else {\r\n                    listener.mask = null;\r\n                    return true;\r\n                }\r\n            }\r\n            else {\r\n                return true;\r\n            }\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get all the targets listening to the supplied type of event in the target's capturing phase.\r\n     * The capturing phase comprises the journey from the root to the last node BEFORE the event target's node.\r\n     * The result should save in the array parameter, and MUST SORT from child nodes to parent nodes.\r\n     *\r\n     * Subclasses can override this method to make event propagable.\r\n     * @method _getCapturingTargets\r\n     * @private\r\n     * @param {String} type - the event type\r\n     * @param {Array} array - the array to receive targets\r\n     * @example {@link cocos2d/core/event/_getCapturingTargets.js}\r\n     */\r\n    _getCapturingTargets (type, array) {\r\n        var parent = this.parent;\r\n        while (parent) {\r\n            if (parent._capturingListeners && parent._capturingListeners.hasEventListener(type)) {\r\n                array.push(parent);\r\n            }\r\n            parent = parent.parent;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Get all the targets listening to the supplied type of event in the target's bubbling phase.\r\n     * The bubbling phase comprises any SUBSEQUENT nodes encountered on the return trip to the root of the tree.\r\n     * The result should save in the array parameter, and MUST SORT from child nodes to parent nodes.\r\n     *\r\n     * Subclasses can override this method to make event propagable.\r\n     * @method _getBubblingTargets\r\n     * @private\r\n     * @param {String} type - the event type\r\n     * @param {Array} array - the array to receive targets\r\n     */\r\n    _getBubblingTargets (type, array) {\r\n        var parent = this.parent;\r\n        while (parent) {\r\n            if (parent._bubblingListeners && parent._bubblingListeners.hasEventListener(type)) {\r\n                array.push(parent);\r\n            }\r\n            parent = parent.parent;\r\n        }\r\n    },\r\n\r\n// ACTIONS\r\n    /**\r\n     * !#en\r\n     * Executes an action, and returns the action that is executed.<br/>\r\n     * The node becomes the action's target. Refer to cc.Action's getTarget() <br/>\r\n     * Calling runAction while the node is not active won't have any effect. <br/>\r\n     * NoteYou shouldn't modify the action after runAction, that won't take any effect.<br/>\r\n     * if you want to modify, when you define action plus.\r\n     * !#zh\r\n     * <br/>\r\n     *  runAction <br/>\r\n     *  runAction  action \r\n     * @method runAction\r\n     * @param {Action} action\r\n     * @return {Action} An Action pointer\r\n     * @example\r\n     * var action = cc.scaleTo(0.2, 1, 0.6);\r\n     * node.runAction(action);\r\n     * node.runAction(action).repeatForever(); // fail\r\n     * node.runAction(action.repeatForever()); // right\r\n     */\r\n    runAction: ActionManagerExist ? function (action) {\r\n        if (!this.active)\r\n            return;\r\n        cc.assertID(action, 1618);\r\n\r\n        cc.director.getActionManager().addAction(action, this, false);\r\n        return action;\r\n    } : emptyFunc,\r\n\r\n    /**\r\n     * !#en Pause all actions running on the current node. Equals to `cc.director.getActionManager().pauseTarget(node)`.\r\n     * !#zh  `cc.director.getActionManager().pauseTarget(node);` \r\n     * @method pauseAllActions\r\n     * @example\r\n     * node.pauseAllActions();\r\n     */\r\n    pauseAllActions: ActionManagerExist ? function () {\r\n        cc.director.getActionManager().pauseTarget(this);\r\n    } : emptyFunc,\r\n\r\n    /**\r\n     * !#en Resume all paused actions on the current node. Equals to `cc.director.getActionManager().resumeTarget(node)`.\r\n     * !#zh  `cc.director.getActionManager().resumeTarget(node);` \r\n     * @method resumeAllActions\r\n     * @example\r\n     * node.resumeAllActions();\r\n     */\r\n    resumeAllActions: ActionManagerExist ? function () {\r\n        cc.director.getActionManager().resumeTarget(this);\r\n    } : emptyFunc,\r\n\r\n    /**\r\n     * !#en Stops and removes all actions from the running action list .\r\n     * !#zh \r\n     * @method stopAllActions\r\n     * @example\r\n     * node.stopAllActions();\r\n     */\r\n    stopAllActions: ActionManagerExist ? function () {\r\n        cc.director.getActionManager().removeAllActionsFromTarget(this);\r\n    } : emptyFunc,\r\n\r\n    /**\r\n     * !#en Stops and removes an action from the running action list.\r\n     * !#zh \r\n     * @method stopAction\r\n     * @param {Action} action An action object to be removed.\r\n     * @example\r\n     * var action = cc.scaleTo(0.2, 1, 0.6);\r\n     * node.stopAction(action);\r\n     */\r\n    stopAction: ActionManagerExist ? function (action) {\r\n        cc.director.getActionManager().removeAction(action);\r\n    } : emptyFunc,\r\n\r\n    /**\r\n     * !#en Removes an action from the running action list by its tag.\r\n     * !#zh \r\n     * @method stopActionByTag\r\n     * @param {Number} tag A tag that indicates the action to be removed.\r\n     * @example\r\n     * node.stopAction(1);\r\n     */\r\n    stopActionByTag: ActionManagerExist ? function (tag) {\r\n        if (tag === cc.Action.TAG_INVALID) {\r\n            cc.logID(1612);\r\n            return;\r\n        }\r\n        cc.director.getActionManager().removeActionByTag(tag, this);\r\n    } : emptyFunc,\r\n\r\n    /**\r\n     * !#en Returns an action from the running action list by its tag.\r\n     * !#zh \r\n     * @method getActionByTag\r\n     * @see cc.Action#getTag and cc.Action#setTag\r\n     * @param {Number} tag\r\n     * @return {Action} The action object with the given tag.\r\n     * @example\r\n     * var action = node.getActionByTag(1);\r\n     */\r\n    getActionByTag: ActionManagerExist ? function (tag) {\r\n        if (tag === cc.Action.TAG_INVALID) {\r\n            cc.logID(1613);\r\n            return null;\r\n        }\r\n        return cc.director.getActionManager().getActionByTag(tag, this);\r\n    } : function () {\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the numbers of actions that are running plus the ones that are schedule to run (actions in actionsToAdd and actions arrays).<br/>\r\n     *    Composable actions are counted as 1 action. Example:<br/>\r\n     *    If you are running 1 Sequence of 7 actions, it will return 1. <br/>\r\n     *    If you are running 7 Sequences of 2 actions, it will return 7.</p>\r\n     * !#zh\r\n     * <br/>\r\n     * <br/>\r\n     * -  7  1  Sequence 1<br/>\r\n     * -  2  7  Sequence 7<br/>\r\n     *\r\n     * @method getNumberOfRunningActions\r\n     * @return {Number} The number of actions that are running plus the ones that are schedule to run\r\n     * @example\r\n     * var count = node.getNumberOfRunningActions();\r\n     * cc.log(\"Running Action Count: \" + count);\r\n     */\r\n    getNumberOfRunningActions: ActionManagerExist ? function () {\r\n        return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this);\r\n    } : function () {\r\n        return 0;\r\n    },\r\n\r\n\r\n// TRANSFORM RELATED\r\n    /**\r\n     * !#en \r\n     * Returns a copy of the position (x, y, z) of the node in its parent's coordinates.\r\n     * You can pass a cc.Vec2 or cc.Vec3 as the argument to receive the return values.\r\n     * !#zh \r\n     * x, y, z\r\n     *  cc.Vec2  cc.Vec3 \r\n     * @method getPosition\r\n     * @param {Vec2|Vec3} [out] - The return value to receive position\r\n     * @return {Vec2|Vec3} The position (x, y, z) of the node in its parent's coordinates\r\n     * @example\r\n     * cc.log(\"Node Position: \" + node.getPosition());\r\n     */\r\n    getPosition (out) {\r\n        out = out || cc.v3();\r\n        return out.set(this._position);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the position (x, y, z) of the node in its parent's coordinates.<br/>\r\n     * Usually we use cc.v2(x, y) to compose cc.Vec2 object,<br/>\r\n     * and passing two numbers (x, y) is more efficient than passing cc.Vec2 object.\r\n     * For 3D node we can use cc.v3(x, y, z) to compose cc.Vec3 object,<br/>\r\n     * and passing three numbers (x, y, z) is more efficient than passing cc.Vec3 object.\r\n     * !#zh\r\n     * <br/>\r\n     * <br/>\r\n     * 1.  2  x, y<br/>\r\n     * 2.  cc.v2(x, y)  cc.Vec2 \r\n     * 3.  3D  3  x, y, z<br/>\r\n     * 4.  3D  cc.v3(x, y, z)  cc.Vec3 \r\n     * @method setPosition\r\n     * @param {Vec2|Vec3|Number} newPosOrX - X coordinate for position or the position (x, y, z) of the node in coordinates\r\n     * @param {Number} [y] - Y coordinate for position\r\n     * @param {Number} [z] - Z coordinate for position\r\n     */\r\n    setPosition (newPosOrX, y) {\r\n        var x;\r\n        if (y === undefined) {\r\n            x = newPosOrX.x;\r\n            y = newPosOrX.y;\r\n        }\r\n        else {\r\n            x = newPosOrX;\r\n        }\r\n\r\n        var locPosition = this._position;\r\n        if (locPosition.x === x && locPosition.y === y) {\r\n            return;\r\n        }\r\n\r\n        if (CC_EDITOR) {\r\n            var oldPosition = new cc.Vec3(locPosition);\r\n        }\r\n        if (!CC_EDITOR || isFinite(x)) {\r\n            locPosition.x = x;\r\n        }\r\n        else {\r\n            return cc.error(ERR_INVALID_NUMBER, 'x of new position');\r\n        }\r\n        if (!CC_EDITOR || isFinite(y)) {\r\n            locPosition.y = y;\r\n        }\r\n        else {\t\r\n            return cc.error(ERR_INVALID_NUMBER, 'y of new position');\r\n        }\r\n        this.setLocalDirty(LocalDirtyFlag.POSITION);\r\n        this._renderFlag |= RenderFlow.FLAG_WORLD_TRANSFORM;\r\n\r\n        // fast check event\r\n        if (this._eventMask & POSITION_ON) {\r\n            // send event\r\n            if (CC_EDITOR) {\r\n                this.emit(EventType.POSITION_CHANGED, oldPosition);\r\n            }\r\n            else {\r\n                this.emit(EventType.POSITION_CHANGED);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the scale factor of the node.\r\n     * Need pass a cc.Vec2 or cc.Vec3 as the argument to receive the return values.\r\n     * !#zh  cc.Vec2  cc.Vec3 \r\n     * @method getScale\r\n     * @param {Vec2|Vec3} out\r\n     * @return {Vec2|Vec3} The scale factor\r\n     * @example\r\n     * cc.log(\"Node Scale: \" + node.getScale(cc.v3()));\r\n     */\r\n    getScale (out) {\r\n        if (out !== undefined) {\r\n            return out.set(this._scale);\r\n        }\r\n        else {\r\n            cc.warnID(1400, 'cc.Node.getScale', 'cc.Node.scale or cc.Node.getScale(cc.Vec3)');\r\n            return this._scale.x;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en \r\n     * Sets the scale of axis in local coordinates of the node.\r\n     * You can operate 2 axis in 2D node, and 3 axis in 3D node.\r\n     * !#zh \r\n     * \r\n     * 2D  3D \r\n     * @method setScale\r\n     * @param {Number|Vec2|Vec3} x - scaleX or scale object\r\n     * @param {Number} [y]\r\n     * @param {Number} [z]\r\n     * @example\r\n     * node.setScale(cc.v2(2, 2));\r\n     * node.setScale(cc.v3(2, 2, 2)); // for 3D node\r\n     * node.setScale(2);\r\n     */\r\n    setScale (x, y) {\r\n        if (x && typeof x !== 'number') {\r\n            y = x.y;\r\n            x = x.x;\r\n        }\r\n        else if (y === undefined) {\r\n            y = x;\r\n        }\r\n        if (this._scale.x !== x || this._scale.y !== y) {\r\n            this._scale.x = x;\r\n            this._scale.y = y;\r\n            this.setLocalDirty(LocalDirtyFlag.SCALE);\r\n            this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n            if (this._eventMask & SCALE_ON) {\r\n                this.emit(EventType.SCALE_CHANGED);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en \r\n     * Get rotation of node (in quaternion). \r\n     * Need pass a cc.Quat as the argument to receive the return values.\r\n     * !#zh \r\n     *  quaternion  cc.Quat \r\n     * @method getRotation\r\n     * @param {Quat} out\r\n     * @return {Quat} Quaternion object represents the rotation\r\n     */\r\n    getRotation (out) {\r\n        if (out instanceof cc.Quat) {\r\n            return out.set(this._quat);\r\n        }\r\n        else {\r\n            cc.warnID(1400, 'cc.Node.getRotation', 'cc.Node.angle or cc.Node.getRotation(cc.Quat)');\r\n            return -this.angle;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Set rotation of node (in quaternion).\r\n     * !#zh  quaternion \r\n     * @method setRotation\r\n     * @param {cc.Quat|Number} quat Quaternion object represents the rotation or the x value of quaternion\t\r\n     * @param {Number} y y value of quternion\t\r\n     * @param {Number} z z value of quternion\t\r\n     * @param {Number} w w value of quternion\r\n     */\r\n    setRotation (quat, y, z, w) {\r\n        if (typeof quat === 'number' && y === undefined) {\r\n            cc.warnID(1400, 'cc.Node.setRotation(Number)', 'cc.Node.angle or cc.Node.setRotation(quat)')\r\n            this.angle = -quat;\r\n        }\r\n        else {\r\n            let x = quat;\r\n            if (y === undefined) {\r\n                x = quat.x;\r\n                y = quat.y;\r\n                z = quat.z;\r\n                w = quat.w;\r\n            }\r\n\r\n            let old = this._quat;\r\n            if (old.x !== x || old.y !== y || old.z !== z || old.w !== w) {\r\n                old.x = x;\r\n                old.y = y;\r\n                old.z = z;\r\n                old.w = w;\r\n                this.setLocalDirty(LocalDirtyFlag.ROTATION);\r\n                this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n\r\n                if (this._eventMask & ROTATION_ON) {\r\n                    this.emit(EventType.ROTATION_CHANGED);\r\n                }\r\n\r\n                if (CC_EDITOR) {\r\n                    this._toEuler();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns a copy the untransformed size of the node. <br/>\r\n     * The contentSize remains the same no matter the node is scaled or rotated.<br/>\r\n     * All nodes has a size. Layer and Scene has the same size of the screen by default. <br/>\r\n     * !#zh \r\n     * @method getContentSize\r\n     * @return {Size} The untransformed size of the node.\r\n     * @example\r\n     * cc.log(\"Content Size: \" + node.getContentSize());\r\n     */\r\n    getContentSize () {\r\n        return cc.size(this._contentSize.width, this._contentSize.height);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the untransformed size of the node.<br/>\r\n     * The contentSize remains the same no matter the node is scaled or rotated.<br/>\r\n     * All nodes has a size. Layer and Scene has the same size of the screen.\r\n     * !#zh \r\n     * @method setContentSize\r\n     * @param {Size|Number} size - The untransformed size of the node or The untransformed size's width of the node.\r\n     * @param {Number} [height] - The untransformed size's height of the node.\r\n     * @example\r\n     * node.setContentSize(cc.size(100, 100));\r\n     * node.setContentSize(100, 100);\r\n     */\r\n    setContentSize (size, height) {\r\n        var locContentSize = this._contentSize;\r\n        var clone;\r\n        if (height === undefined) {\r\n            if ((size.width === locContentSize.width) && (size.height === locContentSize.height))\r\n                return;\r\n            if (CC_EDITOR) {\r\n                clone = cc.size(locContentSize.width, locContentSize.height);\r\n            }\r\n            locContentSize.width = size.width;\r\n            locContentSize.height = size.height;\r\n        } else {\r\n            if ((size === locContentSize.width) && (height === locContentSize.height))\r\n                return;\r\n            if (CC_EDITOR) {\r\n                clone = cc.size(locContentSize.width, locContentSize.height);\r\n            }\r\n            locContentSize.width = size;\r\n            locContentSize.height = height;\r\n        }\r\n        if (this._eventMask & SIZE_ON) {\r\n            if (CC_EDITOR) {\r\n                this.emit(EventType.SIZE_CHANGED, clone);\r\n            }\r\n            else {\r\n                this.emit(EventType.SIZE_CHANGED);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns a copy of the anchor point.<br/>\r\n     * Anchor point is the point around which all transformations and positioning manipulations take place.<br/>\r\n     * It's like a pin in the node where it is \"attached\" to its parent. <br/>\r\n     * The anchorPoint is normalized, like a percentage. (0,0) means the bottom-left corner and (1,1) means the top-right corner. <br/>\r\n     * But you can use values higher than (1,1) and lower than (0,0) too.  <br/>\r\n     * The default anchor point is (0.5,0.5), so it starts at the center of the node.\r\n     * !#zh\r\n     * <br/>\r\n     * <br/>\r\n     * (00) (11) <br/>\r\n     * 1100<br/>\r\n     * 0.50.5<br/>\r\n     * Creator \r\n     * @method getAnchorPoint\r\n     * @return {Vec2} The anchor point of node.\r\n     * @example\r\n     * cc.log(\"Node AnchorPoint: \" + node.getAnchorPoint());\r\n     */\r\n    getAnchorPoint () {\r\n        return cc.v2(this._anchorPoint);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the anchor point in percent. <br/>\r\n     * anchor point is the point around which all transformations and positioning manipulations take place. <br/>\r\n     * It's like a pin in the node where it is \"attached\" to its parent. <br/>\r\n     * The anchorPoint is normalized, like a percentage. (0,0) means the bottom-left corner and (1,1) means the top-right corner.<br/>\r\n     * But you can use values higher than (1,1) and lower than (0,0) too.<br/>\r\n     * The default anchor point is (0.5,0.5), so it starts at the center of the node.\r\n     * !#zh\r\n     * <br/>\r\n     * <br/>\r\n     * (00) (11) <br/>\r\n     * 1100<br/>\r\n     * 0.50.5<br/>\r\n     * Creator \r\n     * @method setAnchorPoint\r\n     * @param {Vec2|Number} point - The anchor point of node or The x axis anchor of node.\r\n     * @param {Number} [y] - The y axis anchor of node.\r\n     * @example\r\n     * node.setAnchorPoint(cc.v2(1, 1));\r\n     * node.setAnchorPoint(1, 1);\r\n     */\r\n    setAnchorPoint (point, y) {\r\n        var locAnchorPoint = this._anchorPoint;\r\n        if (y === undefined) {\r\n            if ((point.x === locAnchorPoint.x) && (point.y === locAnchorPoint.y))\r\n                return;\r\n            locAnchorPoint.x = point.x;\r\n            locAnchorPoint.y = point.y;\r\n        } else {\r\n            if ((point === locAnchorPoint.x) && (y === locAnchorPoint.y))\r\n                return;\r\n            locAnchorPoint.x = point;\r\n            locAnchorPoint.y = y;\r\n        }\r\n        this.setLocalDirty(LocalDirtyFlag.POSITION);\r\n        if (this._eventMask & ANCHOR_ON) {\r\n            this.emit(EventType.ANCHOR_CHANGED);\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Transforms position from world space to local space.\r\n     * @method _invTransformPoint\r\n     * @param {Vec3} out\r\n     * @param {Vec3} vec3\r\n     */\r\n    _invTransformPoint (out, pos) {\r\n        if (this._parent) {\r\n            this._parent._invTransformPoint(out, pos);\r\n        } else {\r\n            math.vec3.copy(out, pos);\r\n        }\r\n\r\n        // out = parent_inv_pos - pos\r\n        math.vec3.sub(out, out, this._position);\r\n\r\n        // out = inv(rot) * out\r\n        math.quat.conjugate(_quat_temp, this._quat);\r\n        math.vec3.transformQuat(out, out, _quat_temp);\r\n\r\n        // out = (1/scale) * out\r\n        math.vec3.inverseSafe(_vec3_temp, this._scale);\r\n        math.vec3.mul(out, out, _vec3_temp);\r\n\r\n        return out;\r\n    },\r\n    \r\n    /*\r\n     * Calculate and return world position.\r\n     * This is not a public API yet, its usage could be updated\r\n     * @method getWorldPosition\r\n     * @param {Vec3} out\r\n     * @return {Vec3}\r\n     */\r\n    getWorldPosition (out) {\r\n        math.vec3.copy(out, this._position);\r\n        let curr = this._parent;\r\n        while (curr) {\r\n            // out = parent_scale * pos\r\n            math.vec3.mul(out, out, curr._scale);\r\n            // out = parent_quat * out\r\n            math.vec3.transformQuat(out, out, curr._quat);\r\n            // out = out + pos\r\n            math.vec3.add(out, out, curr._position);\r\n            curr = curr._parent;\r\n        }\r\n        return out;\r\n    },\r\n\r\n    /*\r\n     * Set world position.\r\n     * This is not a public API yet, its usage could be updated\r\n     * @method setWorldPosition\r\n     * @param {Vec3} pos\r\n     */\r\n    setWorldPosition (pos) {\r\n        if (CC_EDITOR) {\r\n            var oldPosition = new cc.Vec3(this._position);\r\n        }\r\n        // NOTE: this is faster than invert world matrix and transform the point\r\n        if (this._parent) {\r\n            this._parent._invTransformPoint(this._position, pos);\r\n        }\r\n        else {\r\n            math.vec3.copy(this._position, pos);\r\n        }\r\n        this.setLocalDirty(LocalDirtyFlag.POSITION);\r\n\r\n        // fast check event\r\n        if (this._eventMask & POSITION_ON) {\r\n            // send event\r\n            if (CC_EDITOR) {\r\n                this.emit(EventType.POSITION_CHANGED, oldPosition);\r\n            }\r\n            else {\r\n                this.emit(EventType.POSITION_CHANGED);\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Calculate and return world rotation\r\n     * This is not a public API yet, its usage could be updated\r\n     * @method getWorldRotation\r\n     * @param {Quat} out\r\n     * @return {Quat}\r\n     */\r\n    getWorldRotation (out) {\r\n        math.quat.copy(out, this._quat);\r\n        let curr = this._parent;\r\n        while (curr) {\r\n            math.quat.mul(out, curr._quat, out);\r\n            curr = curr._parent;\r\n        }\r\n        return out;\r\n    },\r\n\r\n    /*\r\n     * Set world rotation with quaternion\r\n     * This is not a public API yet, its usage could be updated\r\n     * @method setWorldRotation\r\n     * @param {Quat} rot\r\n     */\r\n    setWorldRotation (quat) {\r\n        if (this._parent) {\r\n            this._parent.getWorldRotation(this._quat);\r\n            math.quat.conjugate(this._quat, this._quat);\r\n            math.quat.mul(this._quat, this._quat, quat);\r\n        }\r\n        else {\r\n            math.quat.copy(this._quat, quat);\r\n        }\r\n        this._toEuler();\r\n        this.setLocalDirty(LocalDirtyFlag.ROTATION);\r\n    },\r\n\r\n    /*\r\n     * Calculate and return world scale\r\n     * This is not a public API yet, its usage could be updated\r\n     * @method getWorldScale\r\n     * @param {Vec3} out\r\n     * @return {Vec3}\r\n     */\r\n    getWorldScale (out) {\r\n        math.vec3.copy(out, this._scale);\r\n        let curr = this._parent;\r\n        while (curr) {\r\n            math.vec3.mul(out, out, curr._scale);\r\n            curr = curr._parent;\r\n        }\r\n        return out;\r\n    },\r\n\r\n    /*\r\n     * Set world scale with vec3\r\n     * This is not a public API yet, its usage could be updated\r\n     * @method setWorldScale\r\n     * @param {Vec3} scale\r\n     */\r\n    setWorldScale (scale) {\r\n        if (this._parent) {\r\n            this._parent.getWorldScale(this._scale);\r\n            math.vec3.div(this._scale, scale, this._scale);\r\n        }\r\n        else {\r\n            math.vec3.copy(this._scale, scale);\r\n        }\r\n        this.setLocalDirty(LocalDirtyFlag.SCALE);\r\n    },\r\n\r\n    getWorldRT (out) {\r\n        let opos = _vec3_temp;\r\n        let orot = _quat_temp;\r\n        math.vec3.copy(opos, this._position);\r\n        math.quat.copy(orot, this._quat);\r\n\r\n        let curr = this._parent;\r\n        while (curr) {\r\n            // opos = parent_lscale * lpos\r\n            math.vec3.mul(opos, opos, curr._scale);\r\n            // opos = parent_lrot * opos\r\n            math.vec3.transformQuat(opos, opos, curr._quat);\r\n            // opos = opos + lpos\r\n            math.vec3.add(opos, opos, curr._position);\r\n            // orot = lrot * orot\r\n            math.quat.mul(orot, curr._quat, orot);\r\n            curr = curr._parent;\r\n        }\r\n        math.mat4.fromRT(out, orot, opos);\r\n        return out;\r\n    },\r\n\r\n    /**\r\n     * !#en Set rotation by lookAt target point, normally used by Camera Node\r\n     * !#zh  rotation Camera Node \r\n     * @method lookAt\r\n     * @param {Vec3} pos\r\n     * @param {Vec3} [up] - default is (0,1,0)\r\n     */\r\n    lookAt (pos, up) {\r\n        this.getWorldPosition(_vec3_temp);\r\n        math.vec3.sub(_vec3_temp, _vec3_temp, pos); // NOTE: we use -z for view-dir\r\n        math.vec3.normalize(_vec3_temp, _vec3_temp);\r\n        math.quat.fromViewUp(_quat_temp, _vec3_temp, up);\r\n    \r\n        this.setWorldRotation(_quat_temp);\r\n    },\r\n\r\n    _updateLocalMatrix () {\r\n        let dirtyFlag = this._localMatDirty;\r\n        if (!dirtyFlag) return;\r\n\r\n        // Update transform\r\n        let t = this._matrix;\r\n        //math.mat4.fromRTS(t, this._quat, this._position, this._scale);\r\n\r\n        if (dirtyFlag & (LocalDirtyFlag.RT | LocalDirtyFlag.SKEW)) {\r\n            let rotation = -this._eulerAngles.z;\r\n            let hasSkew = this._skewX || this._skewY;\r\n            let sx = this._scale.x, sy = this._scale.y;\r\n\r\n            if (rotation || hasSkew) {\r\n                let a = 1, b = 0, c = 0, d = 1;\r\n                // rotation\r\n                if (rotation) {\r\n                    let rotationRadians = rotation * ONE_DEGREE;\r\n                    c = Math.sin(rotationRadians);\r\n                    d = Math.cos(rotationRadians);\r\n                    a = d;\r\n                    b = -c;\r\n                }\r\n                // scale\r\n                t.m00 = a *= sx;\r\n                t.m01 = b *= sx;\r\n                t.m04 = c *= sy;\r\n                t.m05 = d *= sy;\r\n                // skew\r\n                if (hasSkew) {\r\n                    let a = t.m00, b = t.m01, c = t.m04, d = t.m05;\r\n                    let skx = Math.tan(this._skewX * ONE_DEGREE);\r\n                    let sky = Math.tan(this._skewY * ONE_DEGREE);\r\n                    if (skx === Infinity)\r\n                        skx = 99999999;\r\n                    if (sky === Infinity)\r\n                        sky = 99999999;\r\n                    t.m00 = a + c * sky;\r\n                    t.m01 = b + d * sky;\r\n                    t.m04 = c + a * skx;\r\n                    t.m05 = d + b * skx;\r\n                }\r\n            }\r\n            else {\r\n                t.m00 = sx;\r\n                t.m01 = 0;\r\n                t.m04 = 0;\r\n                t.m05 = sy;\r\n            }\r\n        }\r\n\r\n        // position\r\n        t.m12 = this._position.x;\r\n        t.m13 = this._position.y;\r\n        \r\n        this._localMatDirty = 0;\r\n        // Register dirty status of world matrix so that it can be recalculated\r\n        this._worldMatDirty = true;\r\n    },\r\n\r\n    _calculWorldMatrix () {\r\n        // Avoid as much function call as possible\r\n        if (this._localMatDirty) {\r\n            this._updateLocalMatrix();\r\n        }\r\n        \r\n        // Assume parent world matrix is correct\r\n        let parent = this._parent;\r\n        if (parent) {\r\n            this._mulMat(this._worldMatrix, parent._worldMatrix, this._matrix);\r\n        }\r\n        else {\r\n            math.mat4.copy(this._worldMatrix, this._matrix);\r\n        }\r\n        this._worldMatDirty = false;\r\n    },\r\n\r\n    _mulMat (out, a, b) {\r\n        let aa=a.m00, ab=a.m01, ac=a.m04, ad=a.m05, atx=a.m12, aty=a.m13;\r\n        let ba=b.m00, bb=b.m01, bc=b.m04, bd=b.m05, btx=b.m12, bty=b.m13;\r\n        if (ab !== 0 || ac !== 0) {\r\n            out.m00 = ba * aa + bb * ac;\r\n            out.m01 = ba * ab + bb * ad;\r\n            out.m04 = bc * aa + bd * ac;\r\n            out.m05 = bc * ab + bd * ad;\r\n            out.m12 = aa * btx + ac * bty + atx;\r\n            out.m13 = ab * btx + ad * bty + aty;\r\n        }\r\n        else {\r\n            out.m00 = ba * aa;\r\n            out.m01 = bb * ad;\r\n            out.m04 = bc * aa;\r\n            out.m05 = bd * ad;\r\n            out.m12 = aa * btx + atx;\r\n            out.m13 = ad * bty + aty;\r\n        }\r\n    },\r\n\r\n    _updateWorldMatrix () {\r\n        if (this._parent) {\r\n            this._parent._updateWorldMatrix();\r\n        }\r\n        if (this._worldMatDirty) {\r\n            this._calculWorldMatrix();\r\n            // Sync dirty to children\r\n            let children = this._children;\r\n            for (let i = 0, l = children.length; i < l; i++) {\r\n                children[i]._worldMatDirty = true;\r\n            }\r\n        }\r\n    },\r\n\r\n    setLocalDirty (flag) {\r\n        this._localMatDirty = this._localMatDirty | flag;\r\n        this._worldMatDirty = true;\r\n    },\r\n\r\n    setWorldDirty () {\r\n        this._worldMatDirty = true;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Get the local transform matrix (4x4), based on parent node coordinates\r\n     * !#zh \r\n     * @method getLocalMatrix\r\n     * @param {Mat4} out The matrix object to be filled with data\r\n     * @return {Mat4} Same as the out matrix object\r\n     * @example\r\n     * let mat4 = cc.mat4();\r\n     * node.getLocalMatrix(mat4);\r\n     */\r\n    getLocalMatrix (out) {\r\n        this._updateLocalMatrix();\r\n        return math.mat4.copy(out, this._matrix);\r\n    },\r\n    \r\n    /**\r\n     * !#en\r\n     * Get the world transform matrix (4x4)\r\n     * !#zh \r\n     * @method getWorldMatrix\r\n     * @param {Mat4} out The matrix object to be filled with data\r\n     * @return {Mat4} Same as the out matrix object\r\n     * @example\r\n     * let mat4 = cc.mat4();\r\n     * node.getWorldMatrix(mat4);\r\n     */\r\n    getWorldMatrix (out) {\r\n        this._updateWorldMatrix();\r\n        return math.mat4.copy(out, this._worldMatrix);\r\n    },\r\n\r\n    /**\r\n     * !#en Converts a Point to node (local) space coordinates then add the anchor point position.\r\n     * So the return position will be related to the left bottom corner of the node's bounding box.\r\n     * This equals to the API behavior of cocos2d-x, you probably want to use convertToNodeSpaceAR instead\r\n     * !#zh  () <br/>\r\n     * <br/>\r\n     *  API  cocos2d-x  convertToNodeSpaceAR\r\n     * @method convertToNodeSpace\r\n     * @param {Vec2} worldPoint\r\n     * @return {Vec2}\r\n     * @example\r\n     * var newVec2 = node.convertToNodeSpace(cc.v2(100, 100));\r\n     */\r\n    convertToNodeSpace (worldPoint) {\r\n        this._updateWorldMatrix();\r\n        math.mat4.invert(_mat4_temp, this._worldMatrix);\r\n        let out = new cc.Vec2();\r\n        math.vec2.transformMat4(out, worldPoint, _mat4_temp);\r\n        out.x += this._anchorPoint.x * this._contentSize.width;\r\n        out.y += this._anchorPoint.y * this._contentSize.height;\r\n        return out;\r\n    },\r\n\r\n    /**\r\n     * !#en Converts a Point related to the left bottom corner of the node's bounding box to world space coordinates.\r\n     * This equals to the API behavior of cocos2d-x, you probably want to use convertToWorldSpaceAR instead\r\n     * !#zh \r\n     *  API  cocos2d-x  convertToWorldSpaceAR\r\n     * @method convertToWorldSpace\r\n     * @param {Vec2} nodePoint\r\n     * @return {Vec2}\r\n     * @example\r\n     * var newVec2 = node.convertToWorldSpace(cc.v2(100, 100));\r\n     */\r\n    convertToWorldSpace (nodePoint) {\r\n        this._updateWorldMatrix();\r\n        let out = new cc.Vec2(\r\n            nodePoint.x - this._anchorPoint.x * this._contentSize.width,\r\n            nodePoint.y - this._anchorPoint.y * this._contentSize.height\r\n        );\r\n        return math.vec2.transformMat4(out, out, this._worldMatrix);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Converts a Point to node (local) space coordinates in which the anchor point is the origin position.\r\n     * !#zh\r\n     *  () \r\n     * @method convertToNodeSpaceAR\r\n     * @param {Vec2} worldPoint\r\n     * @return {Vec2}\r\n     * @example\r\n     * var newVec2 = node.convertToNodeSpaceAR(cc.v2(100, 100));\r\n     */\r\n    convertToNodeSpaceAR (worldPoint) {\r\n        this._updateWorldMatrix();\r\n        math.mat4.invert(_mat4_temp, this._worldMatrix);\r\n        let out = new cc.Vec2();\r\n        return math.vec2.transformMat4(out, worldPoint, _mat4_temp);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Converts a Point in node coordinates to world space coordinates.\r\n     * !#zh\r\n     * \r\n     * @method convertToWorldSpaceAR\r\n     * @param {Vec2} nodePoint\r\n     * @return {Vec2}\r\n     * @example\r\n     * var newVec2 = node.convertToWorldSpaceAR(cc.v2(100, 100));\r\n     */\r\n    convertToWorldSpaceAR (nodePoint) {\r\n        this._updateWorldMatrix();\r\n        let out = new cc.Vec2();\r\n        return math.vec2.transformMat4(out, nodePoint, this._worldMatrix);\r\n    },\r\n\r\n// OLD TRANSFORM ACCESS APIs\r\n    /**\r\n     * !#en\r\n     * Returns the matrix that transform the node's (local) space coordinates into the parent's space coordinates.<br/>\r\n     * The matrix is in Pixels.\r\n     * !#zh \r\n     * @method getNodeToParentTransform\r\n     * @deprecated since v2.0\r\n     * @param {AffineTransform} [out] The affine transform object to be filled with data\r\n     * @return {AffineTransform} Same as the out affine transform object\r\n     * @example\r\n     * let affineTransform = cc.AffineTransform.create();\r\n     * node.getNodeToParentTransform(affineTransform);\r\n     */\r\n    getNodeToParentTransform (out) {\r\n        if (!out) {\r\n            out = AffineTrans.identity();\r\n        }\r\n        this._updateLocalMatrix();\r\n               \r\n        var contentSize = this._contentSize;\r\n        _vec3_temp.x = -this._anchorPoint.x * contentSize.width;\r\n        _vec3_temp.y = -this._anchorPoint.y * contentSize.height;\r\n\r\n        math.mat4.copy(_mat4_temp, this._matrix);\r\n        math.mat4.translate(_mat4_temp, _mat4_temp, _vec3_temp);\r\n        return AffineTrans.fromMat4(out, _mat4_temp);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the matrix that transform the node's (local) space coordinates into the parent's space coordinates.<br/>\r\n     * The matrix is in Pixels.<br/>\r\n     * This method is AR (Anchor Relative).\r\n     * !#zh\r\n     * <br/>\r\n     * <br/>\r\n     * \r\n     * @method getNodeToParentTransformAR\r\n     * @deprecated since v2.0\r\n     * @param {AffineTransform} [out] The affine transform object to be filled with data\r\n     * @return {AffineTransform} Same as the out affine transform object\r\n     * @example\r\n     * let affineTransform = cc.AffineTransform.create();\r\n     * node.getNodeToParentTransformAR(affineTransform);\r\n     */\r\n    getNodeToParentTransformAR (out) {\r\n        if (!out) {\r\n            out = AffineTrans.identity();\r\n        }\r\n        this._updateLocalMatrix();\r\n        return AffineTrans.fromMat4(out, this._matrix);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the world affine transform matrix. The matrix is in Pixels.\r\n     * !#zh \r\n     * @method getNodeToWorldTransform\r\n     * @deprecated since v2.0\r\n     * @param {AffineTransform} [out] The affine transform object to be filled with data\r\n     * @return {AffineTransform} Same as the out affine transform object\r\n     * @example\r\n     * let affineTransform = cc.AffineTransform.create();\r\n     * node.getNodeToWorldTransform(affineTransform);\r\n     */\r\n    getNodeToWorldTransform (out) {\r\n        if (!out) {\r\n            out = AffineTrans.identity();\r\n        }\r\n        this._updateWorldMatrix();\r\n        \r\n        var contentSize = this._contentSize;\r\n        _vec3_temp.x = -this._anchorPoint.x * contentSize.width;\r\n        _vec3_temp.y = -this._anchorPoint.y * contentSize.height;\r\n\r\n        math.mat4.copy(_mat4_temp, this._worldMatrix);\r\n        math.mat4.translate(_mat4_temp, _mat4_temp, _vec3_temp);\r\n\r\n        return AffineTrans.fromMat4(out, _mat4_temp);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the world affine transform matrix. The matrix is in Pixels.<br/>\r\n     * This method is AR (Anchor Relative).\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method getNodeToWorldTransformAR\r\n     * @deprecated since v2.0\r\n     * @param {AffineTransform} [out] The affine transform object to be filled with data\r\n     * @return {AffineTransform} Same as the out affine transform object\r\n     * @example\r\n     * let affineTransform = cc.AffineTransform.create();\r\n     * node.getNodeToWorldTransformAR(affineTransform);\r\n     */\r\n    getNodeToWorldTransformAR (out) {\r\n        if (!out) {\r\n            out = AffineTrans.identity();\r\n        }\r\n        this._updateWorldMatrix();\r\n        return AffineTrans.fromMat4(out, this._worldMatrix);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the matrix that transform parent's space coordinates to the node's (local) space coordinates.<br/>\r\n     * The matrix is in Pixels. The returned transform is readonly and cannot be changed.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method getParentToNodeTransform\r\n     * @deprecated since v2.0\r\n     * @param {AffineTransform} [out] The affine transform object to be filled with data\r\n     * @return {AffineTransform} Same as the out affine transform object\r\n     * @example\r\n     * let affineTransform = cc.AffineTransform.create();\r\n     * node.getParentToNodeTransform(affineTransform);\r\n     */\r\n    getParentToNodeTransform (out) {\r\n        if (!out) {\r\n            out = AffineTrans.identity();\r\n        }\r\n        this._updateLocalMatrix();\r\n        math.mat4.invert(_mat4_temp, this._matrix);\r\n        return AffineTrans.fromMat4(out, _mat4_temp);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the inverse world affine transform matrix. The matrix is in Pixels.\r\n     * !#en \r\n     * @method getWorldToNodeTransform\r\n     * @deprecated since v2.0\r\n     * @param {AffineTransform} [out] The affine transform object to be filled with data\r\n     * @return {AffineTransform} Same as the out affine transform object\r\n     * @example\r\n     * let affineTransform = cc.AffineTransform.create();\r\n     * node.getWorldToNodeTransform(affineTransform);\r\n     */\r\n    getWorldToNodeTransform (out) {\r\n        if (!out) {\r\n            out = AffineTrans.identity();\r\n        }\r\n        this._updateWorldMatrix();\r\n        math.mat4.invert(_mat4_temp, this._worldMatrix);\r\n        return AffineTrans.fromMat4(out, _mat4_temp);\r\n    },\r\n\r\n    /**\r\n     * !#en convenience methods which take a cc.Touch instead of cc.Vec2.\r\n     * !#zh \r\n     * @method convertTouchToNodeSpace\r\n     * @deprecated since v2.0\r\n     * @param {Touch} touch - The touch object\r\n     * @return {Vec2}\r\n     * @example\r\n     * var newVec2 = node.convertTouchToNodeSpace(touch);\r\n     */\r\n    convertTouchToNodeSpace (touch) {\r\n        return this.convertToNodeSpace(touch.getLocation());\r\n    },\r\n\r\n    /**\r\n     * !#en converts a cc.Touch (world coordinates) into a local coordinate. This method is AR (Anchor Relative).\r\n     * !#zh  cc.Touch\r\n     * @method convertTouchToNodeSpaceAR\r\n     * @deprecated since v2.0\r\n     * @param {Touch} touch - The touch object\r\n     * @return {Vec2}\r\n     * @example\r\n     * var newVec2 = node.convertTouchToNodeSpaceAR(touch);\r\n     */\r\n    convertTouchToNodeSpaceAR (touch) {\r\n        return this.convertToNodeSpaceAR(touch.getLocation());\r\n    },\r\n    \r\n    /**\r\n     * !#en\r\n     * Returns a \"local\" axis aligned bounding box of the node. <br/>\r\n     * The returned box is relative only to its parent.\r\n     * !#zh \r\n     * @method getBoundingBox\r\n     * @return {Rect} The calculated bounding box of the node\r\n     * @example\r\n     * var boundingBox = node.getBoundingBox();\r\n     */\r\n    getBoundingBox () {\r\n        this._updateLocalMatrix();\r\n        let width = this._contentSize.width;\r\n        let height = this._contentSize.height;\r\n        let rect = cc.rect(\r\n            -this._anchorPoint.x * width, \r\n            -this._anchorPoint.y * height, \r\n            width, \r\n            height);\r\n        return rect.transformMat4(rect, this._matrix);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns a \"world\" axis aligned bounding box of the node.<br/>\r\n     * The bounding box contains self and active children's world bounding box.\r\n     * !#zh\r\n     * AABB<br/>\r\n     * \r\n     * @method getBoundingBoxToWorld\r\n     * @return {Rect}\r\n     * @example\r\n     * var newRect = node.getBoundingBoxToWorld();\r\n     */\r\n    getBoundingBoxToWorld () {\r\n        if (this._parent) {\r\n            this._parent._updateWorldMatrix();\r\n            return this._getBoundingBoxTo(this._parent._worldMatrix);\r\n        }\r\n        else {\r\n            return this.getBoundingBox();\r\n        }\r\n    },\r\n\r\n    _getBoundingBoxTo (parentMat) {\r\n        this._updateLocalMatrix();\r\n        let width = this._contentSize.width;\r\n        let height = this._contentSize.height;\r\n        let rect = cc.rect(\r\n            -this._anchorPoint.x * width, \r\n            -this._anchorPoint.y * height, \r\n            width, \r\n            height);\r\n\r\n        var parentMat = math.mat4.mul(this._worldMatrix, parentMat, this._matrix);\r\n        rect.transformMat4(rect, parentMat);\r\n\r\n        //query child's BoundingBox\r\n        if (!this._children)\r\n            return rect;\r\n\r\n        var locChildren = this._children;\r\n        for (var i = 0; i < locChildren.length; i++) {\r\n            var child = locChildren[i];\r\n            if (child && child.active) {\r\n                var childRect = child._getBoundingBoxTo(parentMat);\r\n                if (childRect)\r\n                    rect.union(rect, childRect);\r\n            }\r\n        }\r\n        return rect;\r\n    },\r\n\r\n    _updateOrderOfArrival () {\r\n        var arrivalOrder = ++_globalOrderOfArrival;\r\n        this._localZOrder = (this._localZOrder & 0xffff0000) | arrivalOrder;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Adds a child to the node with z order and name.\r\n     * !#zh\r\n     *   Z \r\n     * @method addChild\r\n     * @param {Node} child - A child node\r\n     * @param {Number} [zIndex] - Z order for drawing priority. Please refer to zIndex property\r\n     * @param {String} [name] - A name to identify the node easily. Please refer to name property\r\n     * @example\r\n     * node.addChild(newNode, 1, \"node\");\r\n     */\r\n    addChild (child, zIndex, name) {\r\n        if (CC_DEV && !cc.Node.isNode(child)) {\r\n            return cc.errorID(1634, cc.js.getClassName(child));\r\n        }\r\n        cc.assertID(child, 1606);\r\n        cc.assertID(child._parent === null, 1605);\r\n\r\n        // invokes the parent setter\r\n        child.parent = this;\r\n\r\n        if (zIndex !== undefined) {\r\n            child.zIndex = zIndex;\r\n        }\r\n        if (name !== undefined) {\r\n            child.name = name;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Stops all running actions and schedulers.\r\n     * !#zh \r\n     * @method cleanup\r\n     * @example\r\n     * node.cleanup();\r\n     */\r\n    cleanup () {\r\n        // actions\r\n        ActionManagerExist && cc.director.getActionManager().removeAllActionsFromTarget(this);\r\n        // event\r\n        eventManager.removeListeners(this);\r\n\r\n        // children\r\n        var i, len = this._children.length, node;\r\n        for (i = 0; i < len; ++i) {\r\n            node = this._children[i];\r\n            if (node)\r\n                node.cleanup();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Sorts the children array depends on children's zIndex and arrivalOrder,\r\n     * normally you won't need to invoke this function.\r\n     * !#zh  zIndex  arrivalOrder \r\n     *\r\n     * @method sortAllChildren\r\n     */\r\n    sortAllChildren () {\r\n        if (this._reorderChildDirty) {\r\n            this._reorderChildDirty = false;\r\n            var _children = this._children;\r\n            if (_children.length > 1) {\r\n                // insertion sort\r\n                var len = _children.length, i, j, child;\r\n                for (i = 1; i < len; i++) {\r\n                    child = _children[i];\r\n                    j = i - 1;\r\n\r\n                    //continue moving element downwards while zOrder is smaller or when zOrder is the same but mutatedIndex is smaller\r\n                    while (j >= 0) {\r\n                        if (child._localZOrder < _children[j]._localZOrder) {\r\n                            _children[j + 1] = _children[j];\r\n                        } else {\r\n                            break;\r\n                        }\r\n                        j--;\r\n                    }\r\n                    _children[j + 1] = child;\r\n                }\r\n                this.emit(EventType.CHILD_REORDER, this);\r\n            }\r\n            cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE, this.sortAllChildren, this);\r\n        }\r\n    },\r\n\r\n    _delaySort () {\r\n        if (!this._reorderChildDirty) {\r\n            this._reorderChildDirty = true;\r\n            cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE, this.sortAllChildren, this);\r\n        }\r\n    },\r\n\r\n    _restoreProperties: CC_EDITOR && function () {\r\n        /*\r\n         * TODO: Refine this code after completing undo/redo 2.0.\r\n         * The node will be destroyed when deleting in the editor,\r\n         * but it will be reserved and reused for undo.\r\n        */\r\n        if (!this._matrix) {\r\n            this._matrix = mathPools.mat4.get();\r\n        }\r\n        if (!this._worldMatrix) {\r\n            this._worldMatrix = mathPools.mat4.get();\r\n        }\r\n\r\n        this._localMatDirty = LocalDirtyFlag.ALL;\r\n        this._worldMatDirty = true;\r\n\r\n        this._toEuler();\r\n\r\n        this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n        if (this._renderComponent) {\r\n            if (this._renderComponent.enabled) {\r\n                this._renderFlag |= RenderFlow.FLAG_COLOR;\r\n                this._renderComponent.markForUpdateRenderData(true);\r\n            }\r\n            else {\r\n                this._renderComponent.disableRender();\r\n            }\r\n        }\r\n\r\n        if (this._children.length > 0) {\r\n            this._renderFlag |= RenderFlow.FLAG_CHILDREN;\r\n        }\r\n    },\r\n\r\n    onRestore: CC_EDITOR && function () {\r\n        this._onRestoreBase();\r\n\r\n        this._restoreProperties();\r\n\r\n        var actionManager = cc.director.getActionManager();\r\n        if (this._activeInHierarchy) {\r\n            actionManager && actionManager.resumeTarget(this);\r\n            eventManager.resumeTarget(this);\r\n        }\r\n        else {\r\n            actionManager && actionManager.pauseTarget(this);\r\n            eventManager.pauseTarget(this);\r\n        }\r\n    },\r\n};\r\n\r\nif (CC_EDITOR) {\r\n    // deprecated, only used to import old data in editor\r\n    js.mixin(NodeDefines.properties, {\r\n        _scaleX: {\r\n            default: undefined,\r\n            type: cc.Float,\r\n            editorOnly: true\r\n        },\r\n        _scaleY: {\r\n            default: undefined,\r\n            type: cc.Float,\r\n            editorOnly: true\r\n        },\r\n        _rotationX: {\r\n            default: undefined,\r\n            type: cc.Float,\r\n            editorOnly: true\r\n        },\r\n        _rotationY: {\r\n            default: undefined,\r\n            type: cc.Float,\r\n            editorOnly: true\r\n        },\r\n    });\r\n}\r\n\r\nlet Node = cc.Class(NodeDefines);\r\n\r\n// 3D Node Property\r\n\r\n/**\r\n * !en\r\n * Switch 2D/3D node. The 2D nodes will run faster.\r\n * !zh\r\n *  2D/3D 2D \r\n * @property {Boolean} is3DNode\r\n * @default false\r\n*/\r\n\r\n// Node Event\r\n\r\n/**\r\n * @event position-changed\r\n * @param {Vec2} oldPos - The old position, but this parameter is only available in editor!\r\n */\r\n/**\r\n * @event size-changed\r\n * @param {Size} oldSize - The old size, but this parameter is only available in editor!\r\n */\r\n/**\r\n * @event anchor-changed\r\n */\r\n/**\r\n * @event child-added\r\n * @param {Node} child - child which have been added\r\n */\r\n/**\r\n * @event child-removed\r\n * @param {Node} child - child which have been removed\r\n */\r\n/**\r\n * @event child-reorder\r\n * @param {Node} node - node whose children have been reordered\r\n */\r\n/**\r\n * @event group-changed\r\n * @param {Node} node - node whose group has changed\r\n */\r\n\r\n// Deprecated APIs\r\n\r\n/**\r\n * !#en\r\n * Returns the displayed opacity of Node,\r\n * the difference between displayed opacity and opacity is that displayed opacity is calculated based on opacity and parent node's opacity when cascade opacity enabled.\r\n * !#zh\r\n * \r\n * \r\n * \r\n *\r\n * @method getDisplayedOpacity\r\n * @returns {number} displayed opacity\r\n * @deprecated since v2.0, please use opacity property, cascade opacity is removed\r\n */\r\n\r\n/**\r\n * !#en\r\n * Returns the displayed color of Node,\r\n * the difference between displayed color and color is that displayed color is calculated based on color and parent node's color when cascade color enabled.\r\n * !#zh\r\n * \r\n * \r\n * \r\n *\r\n * @method getDisplayedColor\r\n * @returns {Color}\r\n * @deprecated since v2.0, please use color property, cascade color is removed\r\n */\r\n\r\n/**\r\n * !#en Cascade opacity is removed from v2.0\r\n * Indicate whether node's opacity value affect its child nodes, default value is true.\r\n * !#zh  v2.0 \r\n *  true\r\n * @property cascadeOpacity\r\n * @deprecated since v2.0\r\n * @type {Boolean}\r\n */\r\n\r\n/**\r\n * !#en Cascade opacity is removed from v2.0\r\n * Returns whether node's opacity value affect its child nodes.\r\n * !#zh  v2.0 \r\n * \r\n * @method isCascadeOpacityEnabled\r\n * @deprecated since v2.0\r\n * @returns {Boolean}\r\n */\r\n\r\n/**\r\n * !#en Cascade opacity is removed from v2.0\r\n * Enable or disable cascade opacity, if cascade enabled, child nodes' opacity will be the multiplication of parent opacity and its own opacity.\r\n * !#zh  v2.0 \r\n * \r\n * @method setCascadeOpacityEnabled\r\n * @deprecated since v2.0\r\n * @param {Boolean} cascadeOpacityEnabled\r\n */\r\n\r\n/**\r\n * !#en Opacity modify RGB have been removed since v2.0\r\n * Set whether color should be changed with the opacity value,\r\n * useless in ccsg.Node, but this function is override in some class to have such behavior.\r\n * !#zh \r\n * RGB\r\n * @method setOpacityModifyRGB\r\n * @deprecated since v2.0\r\n * @param {Boolean} opacityValue\r\n */\r\n\r\n/**\r\n * !#en Opacity modify RGB have been removed since v2.0\r\n * Get whether color should be changed with the opacity value.\r\n * !#zh \r\n * RGB\r\n * @method isOpacityModifyRGB\r\n * @deprecated since v2.0\r\n * @return {Boolean}\r\n */\r\n\r\n\r\nlet _p = Node.prototype;\r\njs.getset(_p, 'position', _p.getPosition, _p.setPosition, false, true);\r\n\r\ncc.Node = module.exports = Node;\r\n","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n'use strict';\r\n\r\nconst Node = require('./CCNode');\r\nconst RenderFlow = require('./renderer/render-flow');\r\nconst math = require('./renderer/render-engine').math;\r\n\r\nconst LocalDirtyFlag = Node._LocalDirtyFlag;\r\nconst POSITION_ON = 1 << 0;\r\n\r\nlet _vec3_temp = math.vec3.create();\r\n\r\n/**\r\n * !#en\r\n * Class of private entities in Cocos Creator scenes.<br/>\r\n * The PrivateNode is hidden in editor, and completely transparent to users.<br/>\r\n * It's normally used as Node's private content created by components in parent node.<br/>\r\n * So in theory private nodes are not children, they are part of the parent node.<br/>\r\n * Private node have two important characteristics:<br/>\r\n * 1. It has the minimum z index and cannot be modified, because they can't be displayed over real children.<br/>\r\n * 2. The positioning of private nodes is also special, they will consider the left bottom corner of the parent node's bounding box as the origin of local coordinates.<br/>\r\n *    In this way, they can be easily kept inside the bounding box.<br/>\r\n * Currently, it's used by RichText component and TileMap component.\r\n * !#zh\r\n * Cocos Creator <br/>\r\n * <br/>\r\n * <br/>\r\n * <br/>\r\n * 1.  Z <br/>\r\n * 2. <br/>\r\n * RichText  TileMap \r\n * @class PrivateNode\r\n * @constructor\r\n * @param {String} name\r\n * @extends Node\r\n */\r\nlet PrivateNode = cc.Class({\r\n    name: 'cc.PrivateNode',\r\n    extends: Node,\r\n\r\n    properties: {\r\n        x: {\r\n            get () {\r\n                return this._originPos.x;\r\n            },\r\n            set (value) {\r\n                var localPosition = this._originPos;\r\n                if (value !== localPosition.x) {\r\n                    localPosition.x = value;\r\n                    this._posDirty(true);\r\n                }\r\n            },\r\n            override: true\r\n        },\r\n        y: {\r\n            get () {\r\n                return this._originPos.y;\r\n            },\r\n            set (value) {\r\n                var localPosition = this._originPos;\r\n                if (value !== localPosition.y) {\r\n                    localPosition.y = value;\r\n                    this._posDirty(true);\r\n                }\r\n            },\r\n            override: true\r\n        },\r\n        zIndex: {\r\n            get () {\r\n                return cc.macro.MIN_ZINDEX;\r\n            },\r\n            set () {\r\n                cc.warnID(1638);\r\n            },\r\n            override: true\r\n        },\r\n    },\r\n\r\n    /**\r\n     * @method constructor\r\n     * @param {String} [name]\r\n     */\r\n    ctor (name) {\r\n        this._localZOrder = cc.macro.MIN_ZINDEX << 16;\r\n        this._originPos = cc.v2();\r\n    },\r\n\r\n    _posDirty (sendEvent) {\r\n        this.setLocalDirty(LocalDirtyFlag.POSITION);\r\n        this._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n        if (sendEvent === true && (this._eventMask & POSITION_ON)) {\r\n            this.emit(Node.EventType.POSITION_CHANGED);\r\n        }\r\n    },\r\n\r\n    _updateLocalMatrix() {\r\n        if (!this._localMatDirty) return;\r\n\r\n        let parent = this.parent;\r\n        if (parent) {\r\n            // Position correction for transform calculation\r\n            this._position.x = this._originPos.x - (parent._anchorPoint.x - 0.5) * parent._contentSize.width;\r\n            this._position.y = this._originPos.y - (parent._anchorPoint.y - 0.5) * parent._contentSize.height;\r\n        }\r\n\r\n        this._super();\r\n    },\r\n\r\n    getPosition () {\r\n        return new cc.Vec2(this._originPos);\r\n    },\r\n\r\n    setPosition (x, y) {\r\n        if (y === undefined) {\r\n            x = x.x;\r\n            y = x.y;\r\n        }\r\n\r\n        let pos = this._originPos;\r\n        if (pos.x === x && pos.y === y) {\r\n            return;\r\n        }\r\n        pos.x = x;\r\n        pos.y = y;\r\n        this._posDirty(true);\r\n    },\r\n\r\n    setParent(value) {\r\n        let oldParent = this._parent;\r\n        this._super(value);\r\n        if (oldParent !== value) {\r\n            if (oldParent) {\r\n                oldParent.off(Node.EventType.ANCHOR_CHANGED, this._posDirty, this);\r\n            }\r\n            if (value) {\r\n                value.on(Node.EventType.ANCHOR_CHANGED, this._posDirty, this);\r\n            }\r\n        }\r\n    },\r\n\r\n    // do not update order of arrival\r\n    _updateOrderOfArrival() {},\r\n});\r\n\r\ncc.js.getset(PrivateNode.prototype, \"parent\", PrivateNode.prototype.getParent, PrivateNode.prototype.setParent);\r\ncc.js.getset(PrivateNode.prototype, \"position\", PrivateNode.prototype.getPosition, PrivateNode.prototype.setPosition);\r\n\r\ncc.PrivateNode = module.exports = PrivateNode;\r\n","/****************************************************************************\r\n Copyright (c) 2015-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar NIL = function () {};\r\n\r\n/**\r\n * !#en\r\n * cc.Scene is a subclass of cc.Node that is used only as an abstract concept.<br/>\r\n * cc.Scene and cc.Node are almost identical with the difference that users can not modify cc.Scene manually.\r\n * !#zh\r\n * cc.Scene  cc.Node <br/>\r\n * cc.Scene  cc.Node  cc.Scene\r\n * @class Scene\r\n * @extends Node\r\n */\r\ncc.Scene = cc.Class({\r\n    name: 'cc.Scene',\r\n    extends: require('./CCNode'),\r\n\r\n    properties: {\r\n        _is3DNode: {\r\n            default: true,\r\n            override: true\r\n        },\r\n\r\n        /**\r\n         * !#en Indicates whether all (directly or indirectly) static referenced assets of this scene are releasable by default after scene unloading.\r\n         * !#zh \r\n         * @property {Boolean} autoReleaseAssets\r\n         * @default false\r\n         */\r\n        autoReleaseAssets: {\r\n            default: undefined,\r\n            type: cc.Boolean\r\n        },\r\n\r\n    },\r\n\r\n    ctor: function () {\r\n        this._anchorPoint.x = 0.0;\r\n        this._anchorPoint.y = 0.0;\r\n\r\n        this._activeInHierarchy = false;\r\n        this._inited = !cc.game._isCloning;\r\n\r\n        if (CC_EDITOR) {\r\n            this._prefabSyncedInLiveReload = false;\r\n        }\r\n\r\n        // cache all depend assets for auto release\r\n        this.dependAssets = null;\r\n    },\r\n\r\n    destroy: function () {\r\n        if (cc.Object.prototype.destroy.call(this)) {\r\n            var children = this._children;\r\n            for (var i = 0; i < children.length; ++i) {\r\n                children[i].active = false;\r\n            }\r\n        }\r\n        this._active = false;\r\n        this._activeInHierarchy = false;\r\n    },\r\n\r\n    _onHierarchyChanged: NIL,\r\n    _instantiate : null,\r\n\r\n    _load: function () {\r\n        if (!this._inited) {\r\n            if (CC_TEST) {\r\n                cc.assert(!this._activeInHierarchy, 'Should deactivate ActionManager and EventManager by default');\r\n            }\r\n            if (CC_EDITOR && this._prefabSyncedInLiveReload) {\r\n                this._onBatchRestored();\r\n            }\r\n            else {\r\n                this._onBatchCreated();\r\n            }\r\n            this._inited = true;\r\n        }\r\n    },\r\n\r\n    _activate: function (active) {\r\n        active = (active !== false);\r\n        if (CC_EDITOR || CC_TEST) {\r\n            // register all nodes to editor\r\n            this._registerIfAttached(active);\r\n        }\r\n        cc.director._nodeActivator.activateNode(this, active);\r\n    }\r\n});\r\n\r\nmodule.exports = cc.Scene;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * @module cc\r\n */\r\nconst js = require('./platform/js');\r\nconst IdGenerater = require('./platform/id-generater');\r\nconst MAX_POOL_SIZE = 20;\r\n\r\nvar idGenerater = new IdGenerater('Scheduler');\r\n\r\n//data structures\r\n/*\r\n * A list double-linked list used for \"updates with priority\"\r\n * @class ListEntry\r\n * @param {Object} target not retained (retained by hashUpdateEntry)\r\n * @param {Number} priority\r\n * @param {Boolean} paused\r\n * @param {Boolean} markedForDeletion selector will no longer be called and entry will be removed at end of the next tick\r\n */\r\nvar ListEntry = function (target, priority, paused, markedForDeletion) {\r\n    this.target = target;\r\n    this.priority = priority;\r\n    this.paused = paused;\r\n    this.markedForDeletion = markedForDeletion;\r\n};\r\n\r\nvar _listEntries = [];\r\nListEntry.get = function (target, priority, paused, markedForDeletion) {\r\n    var result = _listEntries.pop();\r\n    if (result) {\r\n        result.target = target;\r\n        result.priority = priority;\r\n        result.paused = paused;\r\n        result.markedForDeletion = markedForDeletion;\r\n    }\r\n    else {\r\n        result = new ListEntry(target, priority, paused, markedForDeletion);\r\n    }\r\n    return result;\r\n};\r\nListEntry.put = function (entry) {\r\n    if (_listEntries.length < MAX_POOL_SIZE) {\r\n        entry.target = null;\r\n        _listEntries.push(entry);\r\n    }\r\n};\r\n\r\n/*\r\n * A update entry list\r\n * @class HashUpdateEntry\r\n * @param {Array} list Which list does it belong to ?\r\n * @param {ListEntry} entry entry in the list\r\n * @param {Object} target hash key (retained)\r\n * @param {function} callback\r\n */\r\nvar HashUpdateEntry = function (list, entry, target, callback) {\r\n    this.list = list;\r\n    this.entry = entry;\r\n    this.target = target;\r\n    this.callback = callback;\r\n};\r\nvar _hashUpdateEntries = [];\r\nHashUpdateEntry.get = function (list, entry, target, callback) {\r\n    var result = _hashUpdateEntries.pop();\r\n    if (result) {\r\n        result.list = list;\r\n        result.entry = entry;\r\n        result.target = target;\r\n        result.callback = callback;\r\n    }\r\n    else {\r\n        result = new HashUpdateEntry(list, entry, target, callback);\r\n    }\r\n    return result;\r\n};\r\nHashUpdateEntry.put = function (entry) {\r\n    if (_hashUpdateEntries.length < MAX_POOL_SIZE) {\r\n        entry.list = entry.entry = entry.target = entry.callback = null;\r\n        _hashUpdateEntries.push(entry);\r\n    }\r\n};\r\n\r\n//\r\n/*\r\n * Hash Element used for \"selectors with interval\"\r\n * @class HashTimerEntry\r\n * @param {Array} timers\r\n * @param {Object} target  hash key (retained)\r\n * @param {Number} timerIndex\r\n * @param {Timer} currentTimer\r\n * @param {Boolean} currentTimerSalvaged\r\n * @param {Boolean} paused\r\n */\r\nvar HashTimerEntry = function (timers, target, timerIndex, currentTimer, currentTimerSalvaged, paused) {\r\n    var _t = this;\r\n    _t.timers = timers;\r\n    _t.target = target;\r\n    _t.timerIndex = timerIndex;\r\n    _t.currentTimer = currentTimer;\r\n    _t.currentTimerSalvaged = currentTimerSalvaged;\r\n    _t.paused = paused;\r\n};\r\nvar _hashTimerEntries = [];\r\nHashTimerEntry.get = function (timers, target, timerIndex, currentTimer, currentTimerSalvaged, paused) {\r\n    var result = _hashTimerEntries.pop();\r\n    if (result) {\r\n        result.timers = timers;\r\n        result.target = target;\r\n        result.timerIndex = timerIndex;\r\n        result.currentTimer = currentTimer;\r\n        result.currentTimerSalvaged = currentTimerSalvaged;\r\n        result.paused = paused;\r\n    }\r\n    else {\r\n        result = new HashTimerEntry(timers, target, timerIndex, currentTimer, currentTimerSalvaged, paused);\r\n    }\r\n    return result;\r\n};\r\nHashTimerEntry.put = function (entry) {\r\n    if (_hashTimerEntries.length < MAX_POOL_SIZE) {\r\n        entry.timers = entry.target = entry.currentTimer = null;\r\n        _hashTimerEntries.push(entry);\r\n    }\r\n};\r\n\r\n/*\r\n * Light weight timer\r\n * @extends cc.Class\r\n */\r\nfunction CallbackTimer () {\r\n    this._lock = false;\r\n    this._scheduler = null;\r\n    this._elapsed = -1;\r\n    this._runForever = false;\r\n    this._useDelay = false;\r\n    this._timesExecuted = 0;\r\n    this._repeat = 0;\r\n    this._delay = 0;\r\n    this._interval = 0;\r\n\r\n    this._target = null;\r\n    this._callback = null;\r\n}\r\n\r\nvar proto = CallbackTimer.prototype;\r\n\r\nproto.initWithCallback = function (scheduler, callback, target, seconds, repeat, delay) {\r\n    this._lock = false;\r\n    this._scheduler = scheduler;\r\n    this._target = target;\r\n    this._callback = callback;\r\n\r\n    this._elapsed = -1;\r\n    this._interval = seconds;\r\n    this._delay = delay;\r\n    this._useDelay = (this._delay > 0);\r\n    this._repeat = repeat;\r\n    this._runForever = (this._repeat === cc.macro.REPEAT_FOREVER);\r\n    return true;\r\n};\r\n/**\r\n * @return {Number} returns interval of timer\r\n */\r\nproto.getInterval = function(){return this._interval;};\r\n/**\r\n * @param {Number} interval set interval in seconds\r\n */\r\nproto.setInterval = function(interval){this._interval = interval;};\r\n\r\n/**\r\n * triggers the timer\r\n * @param {Number} dt delta time\r\n */\r\nproto.update = function (dt) {\r\n    if (this._elapsed === -1) {\r\n        this._elapsed = 0;\r\n        this._timesExecuted = 0;\r\n    } else {\r\n        this._elapsed += dt;\r\n        if (this._runForever && !this._useDelay) {//standard timer usage\r\n            if (this._elapsed >= this._interval) {\r\n                this.trigger();\r\n                this._elapsed = 0;\r\n            }\r\n        } else {//advanced usage\r\n            if (this._useDelay) {\r\n                if (this._elapsed >= this._delay) {\r\n                    this.trigger();\r\n\r\n                    this._elapsed -= this._delay;\r\n                    this._timesExecuted += 1;\r\n                    this._useDelay = false;\r\n                }\r\n            } else {\r\n                if (this._elapsed >= this._interval) {\r\n                    this.trigger();\r\n\r\n                    this._elapsed = 0;\r\n                    this._timesExecuted += 1;\r\n                }\r\n            }\r\n\r\n            if (this._callback && !this._runForever && this._timesExecuted > this._repeat)\r\n                this.cancel();\r\n        }\r\n    }\r\n};\r\n\r\nproto.getCallback = function(){\r\n    return this._callback;\r\n};\r\n\r\nproto.trigger = function () {\r\n    if (this._target && this._callback) {\r\n        this._lock = true;\r\n        this._callback.call(this._target, this._elapsed);\r\n        this._lock = false;\r\n    }\r\n};\r\n\r\nproto.cancel = function () {\r\n    //override\r\n    this._scheduler.unschedule(this._callback, this._target);\r\n};\r\n\r\nvar _timers = [];\r\nCallbackTimer.get = function () {\r\n    return _timers.pop() || new CallbackTimer();\r\n};\r\nCallbackTimer.put = function (timer) {\r\n    if (_timers.length < MAX_POOL_SIZE && !timer._lock) {\r\n        timer._scheduler = timer._target = timer._callback = null;\r\n        _timers.push(timer);\r\n    }\r\n};\r\n\r\n/**\r\n * !#en\r\n * Scheduler is responsible of triggering the scheduled callbacks.<br/>\r\n * You should not use NSTimer. Instead use this class.<br/>\r\n * <br/>\r\n * There are 2 different types of callbacks (selectors):<br/>\r\n *     - update callback: the 'update' callback will be called every frame. You can customize the priority.<br/>\r\n *     - custom callback: A custom callback will be called every frame, or with a custom interval of time<br/>\r\n * <br/>\r\n * The 'custom selectors' should be avoided when possible. It is faster,\r\n * and consumes less memory to use the 'update callback'. *\r\n * !#zh\r\n * Scheduler <br/>\r\n *  cc.director.getScheduler() <br/>\r\n * <br/>\r\n *     - update <br/>\r\n *     - <br/>\r\n *  update  update \r\n *\r\n * @class Scheduler\r\n */\r\ncc.Scheduler = function () {\r\n    this._timeScale = 1.0;\r\n    this._updatesNegList = [];  // list of priority < 0\r\n    this._updates0List = [];    // list of priority == 0\r\n    this._updatesPosList = [];  // list of priority > 0\r\n    this._hashForUpdates = js.createMap(true);  // hash used to fetch quickly the list entries for pause, delete, etc\r\n    this._hashForTimers = js.createMap(true);   // Used for \"selectors with interval\"\r\n    this._currentTarget = null;\r\n    this._currentTargetSalvaged = false;\r\n    this._updateHashLocked = false; // If true unschedule will not remove anything from a hash. Elements will only be marked for deletion.\r\n\r\n    this._arrayForTimers = [];  // Speed up indexing\r\n    //this._arrayForUpdates = [];   // Speed up indexing\r\n};\r\n\r\ncc.Scheduler.prototype = {\r\n    constructor: cc.Scheduler,\r\n    //-----------------------private method----------------------\r\n\r\n    _removeHashElement: function (element) {\r\n        delete this._hashForTimers[element.target._id];\r\n        var arr = this._arrayForTimers;\r\n        for (var i = 0, l = arr.length; i < l; i++) {\r\n            if (arr[i] === element) {\r\n                arr.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n        HashTimerEntry.put(element);\r\n    },\r\n\r\n    _removeUpdateFromHash: function (entry) {\r\n        var targetId = entry.target._id;\r\n        var self = this, element = self._hashForUpdates[targetId];\r\n        if (element) {\r\n            // Remove list entry from list\r\n            var list = element.list, listEntry = element.entry;\r\n            for (var i = 0, l = list.length; i < l; i++) {\r\n                if (list[i] === listEntry) {\r\n                    list.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n\r\n            delete self._hashForUpdates[targetId];\r\n            ListEntry.put(listEntry);\r\n            HashUpdateEntry.put(element);\r\n        }\r\n    },\r\n\r\n    _priorityIn: function (ppList, listElement, priority) {\r\n        for (var i = 0; i < ppList.length; i++){\r\n            if (priority < ppList[i].priority) {\r\n                ppList.splice(i, 0, listElement);\r\n                return;\r\n            }\r\n        }\r\n        ppList.push(listElement);\r\n    },\r\n\r\n    _appendIn: function (ppList, listElement) {\r\n        ppList.push(listElement);\r\n    },\r\n\r\n    //-----------------------public method-------------------------\r\n    /**\r\n     * !en This method should be called for any target which needs to schedule tasks, and this method should be called before any scheduler API usage.\r\n     * This method will add a `_id` property if it doesn't exist.\r\n     * !zh  Scheduler  Scheduler API \r\n     *  `_id` \r\n     * @method enableForTarget\r\n     * @param {Object} target\r\n     */\r\n    enableForTarget: function (target) {\r\n        if (!target._id) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n            }\r\n            else {\r\n                target._id = idGenerater.getNewId();\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Modifies the time of all scheduled callbacks.<br/>\r\n     * You can use this property to create a 'slow motion' or 'fast forward' effect.<br/>\r\n     * Default is 1.0. To create a 'slow motion' effect, use values below 1.0.<br/>\r\n     * To create a 'fast forward' effect, use values higher than 1.0.<br/>\r\n     * NoteIt will affect EVERY scheduled selector / action.\r\n     * !#zh\r\n     * <br/>\r\n     *  slow motion  fast forward <br/>\r\n     *  1.0 slow motion , 1.0<br/>\r\n     *  fast forward  1.0<br/>\r\n     *  Scheduler \r\n     * @method setTimeScale\r\n     * @param {Number} timeScale\r\n     */\r\n    setTimeScale: function (timeScale) {\r\n        this._timeScale = timeScale;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns time scale of scheduler.\r\n     * !#zh \r\n     * @method getTimeScale\r\n     * @return {Number}\r\n     */\r\n    getTimeScale: function () {\r\n        return this._timeScale;\r\n    },\r\n\r\n    /**\r\n     * !#en 'update' the scheduler. (You should NEVER call this method, unless you know what you are doing.)\r\n     * !#zh update ()\r\n     * @method update\r\n     * @param {Number} dt delta time\r\n     */\r\n    update: function (dt) {\r\n        this._updateHashLocked = true;\r\n        if(this._timeScale !== 1)\r\n            dt *= this._timeScale;\r\n\r\n        var i, list, len, entry;\r\n\r\n        for(i=0,list=this._updatesNegList, len = list.length; i<len; i++){\r\n            entry = list[i];\r\n            if (!entry.paused && !entry.markedForDeletion)\r\n                entry.target.update(dt);\r\n        }\r\n\r\n        for(i=0, list=this._updates0List, len=list.length; i<len; i++){\r\n            entry = list[i];\r\n            if (!entry.paused && !entry.markedForDeletion)\r\n                entry.target.update(dt);\r\n        }\r\n\r\n        for(i=0, list=this._updatesPosList, len=list.length; i<len; i++){\r\n            entry = list[i];\r\n            if (!entry.paused && !entry.markedForDeletion)\r\n                entry.target.update(dt);\r\n        }\r\n\r\n        // Iterate over all the custom selectors\r\n        var elt, arr = this._arrayForTimers;\r\n        for(i=0; i<arr.length; i++){\r\n            elt = arr[i];\r\n            this._currentTarget = elt;\r\n            this._currentTargetSalvaged = false;\r\n\r\n            if (!elt.paused){\r\n                // The 'timers' array may change while inside this loop\r\n                for (elt.timerIndex = 0; elt.timerIndex < elt.timers.length; ++(elt.timerIndex)){\r\n                    elt.currentTimer = elt.timers[elt.timerIndex];\r\n                    elt.currentTimerSalvaged = false;\r\n\r\n                    elt.currentTimer.update(dt);\r\n                    elt.currentTimer = null;\r\n                }\r\n            }\r\n\r\n            // only delete currentTarget if no actions were scheduled during the cycle (issue #481)\r\n            if (this._currentTargetSalvaged && this._currentTarget.timers.length === 0) {\r\n                this._removeHashElement(this._currentTarget);\r\n                --i;\r\n            }\r\n        }\r\n\r\n        // delete all updates that are marked for deletion\r\n        // updates with priority < 0\r\n        for(i=0,list=this._updatesNegList; i<list.length; ){\r\n            entry = list[i];\r\n            if(entry.markedForDeletion)\r\n                this._removeUpdateFromHash(entry);\r\n            else\r\n                i++;\r\n        }\r\n\r\n        for(i=0, list=this._updates0List; i<list.length; ){\r\n            entry = list[i];\r\n            if (entry.markedForDeletion)\r\n                this._removeUpdateFromHash(entry);\r\n            else\r\n                i++;\r\n        }\r\n\r\n        for(i=0, list=this._updatesPosList; i<list.length; ){\r\n            entry = list[i];\r\n            if (entry.markedForDeletion)\r\n                this._removeUpdateFromHash(entry);\r\n            else\r\n                i++;\r\n        }\r\n\r\n        this._updateHashLocked = false;\r\n        this._currentTarget = null;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * <p>\r\n     *   The scheduled method will be called every 'interval' seconds.<br/>\r\n     *   If paused is YES, then it won't be called until it is resumed.<br/>\r\n     *   If 'interval' is 0, it will be called every frame, but if so, it recommended to use 'scheduleUpdateForTarget:' instead.<br/>\r\n     *   If the callback function is already scheduled, then only the interval parameter will be updated without re-scheduling it again.<br/>\r\n     *   repeat let the action be repeated repeat + 1 times, use cc.macro.REPEAT_FOREVER to let the action run continuously<br/>\r\n     *   delay is the amount of time the action will wait before it'll start<br/>\r\n     * </p>\r\n     * !#zh\r\n     * <br/>\r\n     *  paused  true resume <br/>\r\n     * <br/>\r\n     *  interval  0\r\n     *  scheduleUpdateForTarget <br/>\r\n     * <br/>\r\n     * repeat  repeat + 1  cc.macro.REPEAT_FOREVER\r\n     * <br/>\r\n     * delay \r\n     * @method schedule\r\n     * @param {Function} callback\r\n     * @param {Object} target\r\n     * @param {Number} interval\r\n     * @param {Number} [repeat=cc.macro.REPEAT_FOREVER]\r\n     * @param {Number} [delay=0]\r\n     * @param {Boolean} paused\r\n     * @example {@link cocos2d/core/CCScheduler/schedule.js}\r\n     * @typescript\r\n     * schedule(callback: Function, target: any, interval: number, repeat: number, delay: number, paused?: boolean): void\r\n     * schedule(callback: Function, target: any, interval: number, paused?: boolean): void\r\n     */\r\n    schedule: function (callback, target, interval, repeat, delay, paused) {\r\n        'use strict';\r\n        if (typeof callback !== 'function') {\r\n            var tmp = callback;\r\n            callback = target;\r\n            target = tmp;\r\n        }\r\n        //selector, target, interval, repeat, delay, paused\r\n        //selector, target, interval, paused\r\n        if (arguments.length === 4 || arguments.length === 5) {\r\n            paused = !!repeat;\r\n            repeat = cc.macro.REPEAT_FOREVER;\r\n            delay = 0;\r\n        }\r\n\r\n        cc.assertID(target, 1502);\r\n\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n        var element = this._hashForTimers[targetId];\r\n        if (!element) {\r\n            // Is this the 1st element ? Then set the pause level to all the callback_fns of this target\r\n            element = HashTimerEntry.get(null, target, 0, null, null, paused);\r\n            this._arrayForTimers.push(element);\r\n            this._hashForTimers[targetId] = element;\r\n        } else if (element.paused !== paused) {\r\n            cc.warnID(1511);\r\n        }\r\n\r\n        var timer, i;\r\n        if (element.timers == null) {\r\n            element.timers = [];\r\n        }\r\n        else {\r\n            for (i = 0; i < element.timers.length; ++i) {\r\n                timer = element.timers[i];\r\n                if (timer && callback === timer._callback) {\r\n                    cc.logID(1507, timer.getInterval(), interval);\r\n                    timer._interval = interval;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        timer = CallbackTimer.get();\r\n        timer.initWithCallback(this, callback, target, interval, repeat, delay);\r\n        element.timers.push(timer);\r\n\r\n        if (this._currentTarget === element && this._currentTargetSalvaged) {\r\n            this._currentTargetSalvaged = false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Schedules the update callback for a given target,\r\n     * During every frame after schedule started, the \"update\" function of target will be invoked.\r\n     * !#zh\r\n     *  update \r\n     * update  \"update\" \r\n     * \r\n     * @method scheduleUpdate\r\n     * @param {Object} target\r\n     * @param {Number} priority\r\n     * @param {Boolean} paused\r\n     */\r\n    scheduleUpdate: function(target, priority, paused) {\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n        var hashElement = this._hashForUpdates[targetId];\r\n        if (hashElement && hashElement.entry){\r\n            // check if priority has changed\r\n            if (hashElement.entry.priority !== priority){\r\n                if (this._updateHashLocked){\r\n                    cc.logID(1506);\r\n                    hashElement.entry.markedForDeletion = false;\r\n                    hashElement.entry.paused = paused;\r\n                    return;\r\n                }else{\r\n                    // will be added again outside if (hashElement).\r\n                    this.unscheduleUpdate(target);\r\n                }\r\n            }else{\r\n                hashElement.entry.markedForDeletion = false;\r\n                hashElement.entry.paused = paused;\r\n                return;\r\n            }\r\n        }\r\n\r\n        var listElement = ListEntry.get(target, priority, paused, false);\r\n        var ppList;\r\n\r\n        // most of the updates are going to be 0, that's way there\r\n        // is an special list for updates with priority 0\r\n        if (priority === 0) {\r\n            ppList = this._updates0List;\r\n            this._appendIn(ppList, listElement);\r\n        }\r\n        else {\r\n            ppList = priority < 0 ? this._updatesNegList : this._updatesPosList;\r\n            this._priorityIn(ppList, listElement, priority);\r\n        }\r\n\r\n        //update hash entry for quick access\r\n        this._hashForUpdates[targetId] = HashUpdateEntry.get(ppList, listElement, target, null);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Unschedules a callback for a callback and a given target.\r\n     * If you want to unschedule the \"update\", use `unscheduleUpdate()`\r\n     * !#zh\r\n     * \r\n     *  update  unscheduleUpdate()\r\n     * @method unschedule\r\n     * @param {Function} callback The callback to be unscheduled\r\n     * @param {Object} target The target bound to the callback.\r\n     */\r\n    unschedule: function (callback, target) {\r\n        //callback, target\r\n\r\n        // explicity handle nil arguments when removing an object\r\n        if (!target || !callback)\r\n            return;\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n\r\n        var self = this, element = self._hashForTimers[targetId];\r\n        if (element) {\r\n            var timers = element.timers;\r\n            for(var i = 0, li = timers.length; i < li; i++){\r\n                var timer = timers[i];\r\n                if (callback === timer._callback) {\r\n                    if ((timer === element.currentTimer) && (!element.currentTimerSalvaged)) {\r\n                        element.currentTimerSalvaged = true;\r\n                    }\r\n                    timers.splice(i, 1);\r\n                    CallbackTimer.put(timer);\r\n                    //update timerIndex in case we are in tick;, looping over the actions\r\n                    if (element.timerIndex >= i) {\r\n                        element.timerIndex--;\r\n                    }\r\n\r\n                    if (timers.length === 0) {\r\n                        if (self._currentTarget === element) {\r\n                            self._currentTargetSalvaged = true;\r\n                        } else {\r\n                            self._removeHashElement(element);\r\n                        }\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /** \r\n     * !#en Unschedules the update callback for a given target.\r\n     * !#zh  update \r\n     * @method unscheduleUpdate\r\n     * @param {Object} target The target to be unscheduled.\r\n     */\r\n    unscheduleUpdate: function (target) {\r\n        if (!target)\r\n            return;\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n\r\n        var element = this._hashForUpdates[targetId];\r\n        if (element) {\r\n            if (this._updateHashLocked) {\r\n                element.entry.markedForDeletion = true;\r\n            } else {\r\n                this._removeUpdateFromHash(element.entry);\r\n            }\r\n        }\r\n    },\r\n\r\n    /** \r\n     * !#en\r\n     * Unschedules all scheduled callbacks for a given target.\r\n     * This also includes the \"update\" callback.\r\n     * !#zh  update \r\n     * @method unscheduleAllForTarget\r\n     * @param {Object} target The target to be unscheduled.\r\n     */\r\n    unscheduleAllForTarget: function (target) {\r\n        // explicit nullptr handling\r\n        if (!target){\r\n            return;\r\n        }\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n\r\n        // Custom Selectors\r\n        var element = this._hashForTimers[targetId];\r\n        if (element) {\r\n            var timers = element.timers;\r\n            if (timers.indexOf(element.currentTimer) > -1 && \r\n                (!element.currentTimerSalvaged)) {\r\n                element.currentTimerSalvaged = true;\r\n            }\r\n            for (var i = 0, l = timers.length; i < l; i++) {\r\n                CallbackTimer.put(timers[i]);\r\n            }\r\n            timers.length = 0;\r\n\r\n            if (this._currentTarget === element){\r\n                this._currentTargetSalvaged = true;\r\n            }else{\r\n                this._removeHashElement(element);\r\n            }\r\n        }\r\n\r\n        // update selector\r\n        this.unscheduleUpdate(target);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Unschedules all scheduled callbacks from all targets including the system callbacks.<br/>\r\n     * You should NEVER call this method, unless you know what you are doing.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method unscheduleAll\r\n     */\r\n    unscheduleAll: function(){\r\n        this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Unschedules all callbacks from all targets with a minimum priority.<br/>\r\n     * You should only call this with `PRIORITY_NON_SYSTEM_MIN` or higher.\r\n     * !#zh\r\n     * <br/>\r\n     *  PRIORITY_NON_SYSTEM_MIN \r\n     * @method unscheduleAllWithMinPriority\r\n     * @param {Number} minPriority The minimum priority of selector to be unscheduled. Which means, all selectors which\r\n     *        priority is higher than minPriority will be unscheduled.\r\n     */\r\n    unscheduleAllWithMinPriority: function(minPriority){\r\n        // Custom Selectors\r\n        var i, element, arr = this._arrayForTimers;\r\n        for(i=arr.length-1; i>=0; i--){\r\n            element = arr[i];\r\n            this.unscheduleAllForTarget(element.target);\r\n        }\r\n\r\n        // Updates selectors\r\n        var entry;\r\n        var temp_length = 0;\r\n        if(minPriority < 0){\r\n            for(i=0; i<this._updatesNegList.length; ){\r\n                temp_length = this._updatesNegList.length;\r\n                entry = this._updatesNegList[i];\r\n                if(entry && entry.priority >= minPriority)\r\n                    this.unscheduleUpdate(entry.target);\r\n                if (temp_length == this._updatesNegList.length)\r\n                    i++;\r\n            }\r\n        }\r\n\r\n        if(minPriority <= 0){\r\n            for(i=0; i<this._updates0List.length; ){\r\n                temp_length = this._updates0List.length;\r\n                entry = this._updates0List[i];\r\n                if (entry)\r\n                    this.unscheduleUpdate(entry.target);\r\n                if (temp_length == this._updates0List.length)\r\n                    i++;\r\n            }\r\n        }\r\n\r\n        for(i=0; i<this._updatesPosList.length; ){\r\n            temp_length = this._updatesPosList.length;\r\n            entry = this._updatesPosList[i];\r\n            if(entry && entry.priority >= minPriority)\r\n                this.unscheduleUpdate(entry.target);\r\n            if (temp_length == this._updatesPosList.length)\r\n                i++;\r\n        }\r\n    },\r\n\r\n    /** \r\n     * !#en Checks whether a callback for a given target is scheduled.\r\n     * !#zh \r\n     * @method isScheduled\r\n     * @param {Function} callback The callback to check.\r\n     * @param {Object} target The target of the callback.\r\n     * @return {Boolean} True if the specified callback is invoked, false if not.\r\n     */\r\n    isScheduled: function(callback, target){\r\n        //key, target\r\n        //selector, target\r\n        cc.assertID(callback, 1508);\r\n        cc.assertID(target, 1509);\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n        \r\n        var element = this._hashForTimers[targetId];\r\n\r\n        if (!element) {\r\n            return false;\r\n        }\r\n\r\n        if (element.timers == null){\r\n            return false;\r\n        }\r\n        else {\r\n            var timers = element.timers;\r\n            for (var i = 0; i < timers.length; ++i) {\r\n                var timer =  timers[i];\r\n\r\n                if (callback === timer._callback){\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Pause all selectors from all targets.<br/>\r\n     * You should NEVER call this method, unless you know what you are doing.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method pauseAllTargets\r\n     */\r\n    pauseAllTargets: function () {\r\n        return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Pause all selectors from all targets with a minimum priority. <br/>\r\n     * You should only call this with kCCPriorityNonSystemMin or higher.\r\n     * !#zh\r\n     * <br/>\r\n     *  PRIORITY_NON_SYSTEM_MIN \r\n     * @method pauseAllTargetsWithMinPriority\r\n     * @param {Number} minPriority\r\n     */\r\n    pauseAllTargetsWithMinPriority: function (minPriority) {\r\n        var idsWithSelectors = [];\r\n\r\n        var self = this, element, locArrayForTimers = self._arrayForTimers;\r\n        var i, li;\r\n        // Custom Selectors\r\n        for(i = 0, li = locArrayForTimers.length; i < li; i++){\r\n            element = locArrayForTimers[i];\r\n            if (element) {\r\n                element.paused = true;\r\n                idsWithSelectors.push(element.target);\r\n            }\r\n        }\r\n\r\n        var entry;\r\n        if(minPriority < 0){\r\n            for(i=0; i<this._updatesNegList.length; i++){\r\n                entry = this._updatesNegList[i];\r\n                if (entry) {\r\n                    if(entry.priority >= minPriority){\r\n                        entry.paused = true;\r\n                        idsWithSelectors.push(entry.target);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if(minPriority <= 0){\r\n            for(i=0; i<this._updates0List.length; i++){\r\n                entry = this._updates0List[i];\r\n                if (entry) {\r\n                    entry.paused = true;\r\n                    idsWithSelectors.push(entry.target);\r\n                }\r\n            }\r\n        }\r\n\r\n        for(i=0; i<this._updatesPosList.length; i++){\r\n            entry = this._updatesPosList[i];\r\n            if (entry) {\r\n                if(entry.priority >= minPriority){\r\n                    entry.paused = true;\r\n                    idsWithSelectors.push(entry.target);\r\n                }\r\n            }\r\n        }\r\n\r\n        return idsWithSelectors;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Resume selectors on a set of targets.<br/>\r\n     * This can be useful for undoing a call to pauseAllCallbacks.\r\n     * !#zh\r\n     * <br/>\r\n     *  pauseAllCallbacks \r\n     * @method resumeTargets\r\n     * @param {Array} targetsToResume\r\n     */\r\n    resumeTargets: function (targetsToResume) {\r\n        if (!targetsToResume)\r\n            return;\r\n\r\n        for (var i = 0; i < targetsToResume.length; i++) {\r\n            this.resumeTarget(targetsToResume[i]);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Pauses the target.<br/>\r\n     * All scheduled selectors/update for a given target won't be 'ticked' until the target is resumed.<br/>\r\n     * If the target is not present, nothing happens.\r\n     * !#zh\r\n     * <br/>\r\n     * <br/>\r\n     * \r\n     * @method pauseTarget\r\n     * @param {Object} target\r\n     */\r\n    pauseTarget: function (target) {\r\n        cc.assertID(target, 1503);\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n\r\n        //customer selectors\r\n        var self = this, \r\n            element = self._hashForTimers[targetId];\r\n        if (element) {\r\n            element.paused = true;\r\n        }\r\n\r\n        //update callback\r\n        var elementUpdate = self._hashForUpdates[targetId];\r\n        if (elementUpdate) {\r\n            elementUpdate.entry.paused = true;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Resumes the target.<br/>\r\n     * The 'target' will be unpaused, so all schedule selectors/update will be 'ticked' again.<br/>\r\n     * If the target is not present, nothing happens.\r\n     * !#zh\r\n     * <br/>\r\n     * <br/>\r\n     * \r\n     * @method resumeTarget\r\n     * @param {Object} target\r\n     */\r\n    resumeTarget: function (target) {\r\n        cc.assertID(target, 1504);\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n\r\n        // custom selectors\r\n        var self = this,\r\n            element = self._hashForTimers[targetId];\r\n        if (element) {\r\n            element.paused = false;\r\n        }\r\n\r\n        //update callback\r\n        var elementUpdate = self._hashForUpdates[targetId];\r\n        if (elementUpdate) {\r\n            elementUpdate.entry.paused = false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Returns whether or not the target is paused.\r\n     * !#zh \r\n     * @method isTargetPaused\r\n     * @param {Object} target\r\n     * @return {Boolean}\r\n     */\r\n    isTargetPaused: function (target) {\r\n        cc.assertID(target, 1505);\r\n        var targetId = target._id;\r\n        if (!targetId) {\r\n            if (target.__instanceId) {\r\n                cc.warnID(1513);\r\n                targetId = target._id = target.__instanceId;\r\n            }\r\n            else {\r\n                cc.errorID(1510);\r\n            }\r\n        }\r\n\r\n        // Custom selectors\r\n        var element = this._hashForTimers[targetId];\r\n        if (element) {\r\n            return element.paused;\r\n        }\r\n        var elementUpdate = this._hashForUpdates[targetId];\r\n        if (elementUpdate) {\r\n            return elementUpdate.entry.paused;\r\n        }\r\n        return false;\r\n    },\r\n};\r\n\r\n/**\r\n * !#en Priority level reserved for system services.\r\n * !#zh \r\n * @property PRIORITY_SYSTEM\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.Scheduler.PRIORITY_SYSTEM = 1 << 31;\r\n\r\n/**\r\n * !#en Minimum priority level for user scheduling.\r\n * !#zh \r\n * @property PRIORITY_NON_SYSTEM\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.Scheduler.PRIORITY_NON_SYSTEM = cc.Scheduler.PRIORITY_SYSTEM + 1;\r\n\r\nmodule.exports = cc.Scheduler;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar RawAsset = require('./CCRawAsset');\r\n\r\n/**\r\n * !#en\r\n * Base class for handling assets used in Creator.<br/>\r\n *\r\n * You may want to override:<br/>\r\n * - createNode<br/>\r\n * - getset functions of _nativeAsset<br/>\r\n * - cc.Object._serialize<br/>\r\n * - cc.Object._deserialize<br/>\r\n * !#zh\r\n * Creator <br/>\r\n *\r\n * <br/>\r\n * - createNode <br/>\r\n * - _nativeAsset  getset <br/>\r\n * - cc.Object._serialize<br/>\r\n * - cc.Object._deserialize<br/>\r\n *\r\n * @class Asset\r\n * @extends RawAsset\r\n */\r\ncc.Asset = cc.Class({\r\n    name: 'cc.Asset', extends: RawAsset,\r\n\r\n    ctor () {\r\n        /**\r\n         * !#en\r\n         * Whether the asset is loaded or not\r\n         * !#zh\r\n         * \r\n         *\r\n         * @property loaded\r\n         * @type {Boolean}\r\n         */\r\n        this.loaded = true;\r\n    },\r\n\r\n    properties: {\r\n        /**\r\n         * !#en\r\n         * Returns the url of this asset's native object, if none it will returns an empty string.\r\n         * !#zh\r\n         *  URL\r\n         * @property nativeUrl\r\n         * @type {String}\r\n         * @readOnly\r\n         */\r\n        nativeUrl: {\r\n            get: function () {\r\n                if (this._native) {\r\n                    var name = this._native;\r\n                    if (name.charCodeAt(0) === 47) {    // '/'\r\n                        // remove library tag\r\n                        // not imported in library, just created on-the-fly\r\n                        return name.slice(1);\r\n                    }\r\n                    if (cc.AssetLibrary) {\r\n                        var base = cc.AssetLibrary.getLibUrlNoExt(this._uuid, true);\r\n                        if (name.charCodeAt(0) === 46) {  // '.'\r\n                            // imported in dir where json exist\r\n                            return base + name;\r\n                        }\r\n                        else {\r\n                            // imported in an independent dir\r\n                            return base + '/' + name;\r\n                        }\r\n                    }\r\n                    else {\r\n                        cc.errorID(6400);\r\n                    }\r\n                }\r\n                return '';\r\n            },\r\n            visible: false\r\n        },\r\n\r\n        /**\r\n         * Serializable url for native asset.\r\n         * @property {String} _native\r\n         * @default undefined\r\n         * @private\r\n         */\r\n        _native: \"\",\r\n\r\n        /**\r\n         * The underlying native asset of this asset if one is available.\r\n         * This property can be used to access additional details or functionality releated to the asset.\r\n         * This property will be initialized by the loader if `_native` is available.\r\n         * @property {Object} _nativeAsset\r\n         * @default null\r\n         * @private\r\n         */\r\n        _nativeAsset: {\r\n            get () {},\r\n            set (obj) {}\r\n        },\r\n    },\r\n\r\n    statics: {\r\n        /**\r\n         *  AssetDB \r\n         *\r\n         * @method deserialize\r\n         * @param {String} data\r\n         * @return {Asset}\r\n         * @static\r\n         * @private\r\n         */\r\n        deserialize: CC_EDITOR && function (data) {\r\n            return cc.deserialize(data);\r\n        },\r\n\r\n        /**\r\n         * !#en Indicates whether its dependent raw assets can support deferred load if the owner scene (or prefab) is marked as `asyncLoadAssets`.\r\n         * !#zh  Prefab  `asyncLoadAssets` RawAsset\r\n         *\r\n         * @property {Boolean} preventDeferredLoadDependents\r\n         * @default false\r\n         * @static\r\n         */\r\n        preventDeferredLoadDependents: false,\r\n\r\n        /**\r\n         * !#en Indicates whether its native object should be preloaded from native url.\r\n         * !#zh \r\n         *\r\n         * @property {Boolean} preventPreloadNativeObject\r\n         * @default false\r\n         * @static\r\n         */\r\n        preventPreloadNativeObject: false\r\n    },\r\n\r\n    /**\r\n     * Returns the asset's url.\r\n     *\r\n     * The `Asset` object overrides the `toString()` method of the `Object` object.\r\n     * For `Asset` objects, the toString() method returns a string representation of the object.\r\n     * JavaScript calls the toString() method automatically when an asset is to be represented as a text value or when a texture is referred to in a string concatenation.\r\n     *\r\n     * @method toString\r\n     * @return {String}\r\n     */\r\n    toString () {\r\n        return this.nativeUrl;\r\n    },\r\n\r\n    /**\r\n     *  AssetDB \r\n     *\r\n     * @method serialize\r\n     * @return {String}\r\n     * @private\r\n     */\r\n    serialize: CC_EDITOR && function () {\r\n        return Editor.serialize(this);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Create a new node using this asset in the scene.<br/>\r\n     * If this type of asset dont have its corresponding node type, this method should be null.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     *\r\n     * @method createNode\r\n     * @param {Function} callback\r\n     * @param {String} callback.error - null or the error info\r\n     * @param {Object} callback.node - the created node or null\r\n     */\r\n    createNode: null,\r\n\r\n    /**\r\n     * Set native file name for this asset.\r\n     * @seealso nativeUrl\r\n     *\r\n     * @method _setRawAsset\r\n     * @param {String} filename\r\n     * @param {Boolean} [inLibrary=true]\r\n     * @private\r\n     */\r\n    _setRawAsset: function (filename, inLibrary) {\r\n        if (inLibrary !== false) {\r\n            this._native = filename || undefined;\r\n        }\r\n        else {\r\n            this._native = '/' + filename;  // simply use '/' to tag location where is not in the library\r\n        }\r\n    }\r\n});\r\n\r\nmodule.exports = cc.Asset;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Asset = require('./CCAsset');\r\nconst EventTarget = require('../event/event-target');\r\n\r\nvar LoadMode = cc.Enum({\r\n    WEB_AUDIO: 0,\r\n    DOM_AUDIO: 1,\r\n});\r\n\r\n/**\r\n * !#en Class for audio data handling.\r\n * !#zh \r\n * @class AudioClip\r\n * @extends Asset\r\n * @uses EventTarget\r\n */\r\nvar AudioClip = cc.Class({\r\n    name: 'cc.AudioClip',\r\n    extends: Asset,\r\n    mixins: [EventTarget],\r\n\r\n    ctor () {\r\n        this.loaded = false;\r\n\r\n        // the web audio buffer or <audio> element\r\n        this._audio = null;\r\n    },\r\n\r\n    properties: {\r\n        loadMode: {\r\n            default: LoadMode.WEB_AUDIO,\r\n            type: LoadMode\r\n        },\r\n        _nativeAsset: {\r\n            get () {\r\n                return this._audio;\r\n            },\r\n            set (value) {\r\n                this._audio = value;\r\n                if (value) {\r\n                    this.loaded = true;\r\n                    this.emit('load');\r\n                }\r\n            },\r\n            override: true\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        LoadMode: LoadMode,\r\n        _loadByUrl: function (url, callback) {\r\n            var item = cc.loader.getItem(url) || cc.loader.getItem(url + '?useDom=1');\r\n            if (!item || !item.complete) {\r\n                cc.loader.load(url, function (error, downloadUrl) {\r\n                    if (error) {\r\n                        return callback(error);\r\n                    }\r\n                    item = cc.loader.getItem(url) || cc.loader.getItem(url + '?useDom=1');\r\n                    callback(null, item.content);\r\n                });\r\n            }\r\n            else {\r\n                if (item._owner instanceof AudioClip) {\r\n                    // preloaded and retained by audio clip\r\n                    callback(null, item._owner);\r\n                }\r\n                else {\r\n                    callback(null, item.content);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    destroy () {\r\n        cc.audioEngine.uncache(this);\r\n        this._super();\r\n    }\r\n});\r\n\r\n/**\r\n * !#zh\r\n * \r\n * !#en\r\n * This event is emitted when the asset is loaded\r\n *\r\n * @event load\r\n */\r\n\r\ncc.AudioClip = AudioClip;\r\nmodule.exports = AudioClip;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * @module cc\r\n */\r\n/**\r\n * !#en Class for BitmapFont handling.\r\n * !#zh \r\n * @class BitmapFont\r\n * @extends Font\r\n *\r\n */\r\nvar BitmapFont = cc.Class({\r\n    name: 'cc.BitmapFont',\r\n    extends: cc.Font,\r\n\r\n    properties: {\r\n        fntDataStr: {\r\n            default: ''\r\n        },\r\n\r\n        spriteFrame: {\r\n            default: null,\r\n            type: cc.SpriteFrame\r\n        },\r\n\r\n        fontSize: {\r\n            default: -1\r\n        },\r\n        // BitmapFont \r\n        _fntConfig: null\r\n    }\r\n});\r\n\r\ncc.BitmapFont = BitmapFont;\r\nmodule.exports = BitmapFont;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * @class BufferAsset\r\n * @extends Asset\r\n */\r\nvar BufferAsset = cc.Class({\r\n    name: 'cc.BufferAsset',\r\n    extends: cc.Asset,\r\n\r\n    ctor () {\r\n        this._buffer = null;\r\n    },\r\n\r\n    properties: {\r\n        _nativeAsset: {\r\n            get () {\r\n                return this._buffer;\r\n            },\r\n            set (bin) {\r\n                this._buffer = bin.buffer || bin;\r\n            },\r\n            override: true\r\n        },\r\n    }\r\n});\r\n\r\ncc.BufferAsset = module.exports = BufferAsset;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en Class for Font handling.\r\n * !#zh \r\n * @class Font\r\n * @extends Asset\r\n */\r\nvar Font = cc.Class({\r\n    name: 'cc.Font',\r\n    extends: cc.Asset\r\n});\r\n\r\ncc.Font = module.exports = Font;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en\r\n * Class for JSON file. When the JSON file is loaded, this object is returned.\r\n * The parsed JSON object can be accessed through the `json` attribute in it.<br>\r\n * If you want to get the original JSON text, you should modify the extname to `.txt`\r\n * so that it is loaded as a `TextAsset` instead of a `JsonAsset`.\r\n *\r\n * !#zh\r\n * JSON JSON  `json`  JSON <br>\r\n *  JSON  `.txt` `TextAsset`  `JsonAsset`\r\n *\r\n * @class JsonAsset\r\n * @extends Asset\r\n */\r\nvar JsonAsset = cc.Class({\r\n    name: 'cc.JsonAsset',\r\n    extends: cc.Asset,\r\n    properties: {\r\n        /**\r\n         * @property {Object} json - The loaded JSON object.\r\n         */\r\n        json: null,\r\n    },\r\n});\r\n\r\nmodule.exports = cc.JsonAsset = JsonAsset;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * @module cc\r\n */\r\n/**\r\n * !#en Class for LabelAtlas handling.\r\n * !#zh \r\n * @class LabelAtlas\r\n * @extends BitmapFont\r\n *\r\n */\r\nvar LabelAtlas = cc.Class({\r\n    name: 'cc.LabelAtlas',\r\n    extends: cc.BitmapFont\r\n});\r\n\r\ncc.LabelAtlas = LabelAtlas;\r\nmodule.exports = LabelAtlas;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#zh\r\n * Prefab  {{#crossLink \"Prefab.optimizationPolicy\"}}cc.Prefab#optimizationPolicy{{/crossLink}} \r\n * !#en\r\n * An enumeration used with the {{#crossLink \"Prefab.optimizationPolicy\"}}cc.Prefab#optimizationPolicy{{/crossLink}}\r\n * to specify how to optimize the instantiate operation.\r\n *\r\n * @enum Prefab.OptimizationPolicy\r\n * @since 1.10.0\r\n */\r\nvar OptimizationPolicy = cc.Enum({\r\n    /**\r\n     * !#zh\r\n     *  SINGLE_INSTANCE MULTI_INSTANCE\r\n     * !#en\r\n     * The optimization policy is automatically chosen based on the number of instantiations.\r\n     * When you first create an instance, the behavior is the same as SINGLE_INSTANCE. MULTI_INSTANCE will be automatically used after multiple creation.\r\n     * @property {Number} AUTO\r\n     */\r\n    AUTO: 0,\r\n    /**\r\n     * !#zh\r\n     * <br>\r\n     *  prefab  prefab \r\n     * !#en\r\n     * Optimize for single instance creation.<br>\r\n     * This option skips code generation for this prefab.\r\n     * When this prefab will usually create only one instances, please select this option.\r\n     * @property {Number} SINGLE_INSTANCE\r\n     */\r\n    SINGLE_INSTANCE: 1,\r\n    /**\r\n     * !#zh\r\n     * <br>\r\n     *  prefab  prefab  prefab \r\n     * !#en\r\n     * Optimize for creating instances multiple times.<br>\r\n     * This option enables code generation for this prefab.\r\n     * When this prefab will usually create multiple instances, please select this option.\r\n     * It is also recommended to select this option if the prefab instance in the scene has Auto Sync enabled and there are multiple instances in the scene.\r\n     * @property {Number} MULTI_INSTANCE\r\n     */\r\n    MULTI_INSTANCE: 2,\r\n});\r\n\r\n/**\r\n * !#en Class for prefab handling.\r\n * !#zh \r\n * @class Prefab\r\n * @extends Asset\r\n */\r\nvar Prefab = cc.Class({\r\n    name: 'cc.Prefab',\r\n    extends: cc.Asset,\r\n    ctor () {\r\n        /**\r\n         * Cache function to optimize instance creaton.\r\n         * @property {Function} _createFunction\r\n         * @private\r\n         */\r\n        this._createFunction = null;\r\n\r\n        this._instantiatedTimes = 0;\r\n    },\r\n\r\n    properties: {\r\n        /**\r\n         * @property {Node} data - the main cc.Node in the prefab\r\n         */\r\n        data: null,\r\n\r\n        /**\r\n         * !#zh\r\n         *  prefab  prefab \r\n         * !#en\r\n         * Indicates the optimization policy for instantiating this prefab.\r\n         * Set to a suitable value based on usage, can optimize the time it takes to instantiate this prefab.\r\n         *\r\n         * @property {Prefab.OptimizationPolicy} optimizationPolicy\r\n         * @default Prefab.OptimizationPolicy.AUTO\r\n         * @since 1.10.0\r\n         * @example\r\n         * prefab.optimizationPolicy = cc.Prefab.OptimizationPolicy.MULTI_INSTANCE;\r\n         */\r\n        optimizationPolicy: OptimizationPolicy.AUTO,\r\n\r\n        /**\r\n         * !#en Indicates the raw assets of this prefab can be load after prefab loaded.\r\n         * !#zh  Prefab  Prefab \r\n         * @property {Boolean} asyncLoadAssets\r\n         * @default false\r\n         */\r\n        asyncLoadAssets: false,\r\n\r\n        /**\r\n         * @property {Boolean} readonly\r\n         * @default false\r\n         */\r\n        readonly: {\r\n            default: false,\r\n            editorOnly: true\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        OptimizationPolicy,\r\n        OptimizationPolicyThreshold: 3,\r\n    },\r\n\r\n    createNode: CC_EDITOR && function (cb) {\r\n        var node = cc.instantiate(this);\r\n        node.name = this.name;\r\n        cb(null, node);\r\n    },\r\n\r\n    /**\r\n     * Dynamically translation prefab data into minimized code.<br/>\r\n     * This method will be called automatically before the first time the prefab being instantiated,\r\n     * but you can re-call to refresh the create function once you modified the original prefab data in script.\r\n     * @method compileCreateFunction\r\n     */\r\n    compileCreateFunction: function () {\r\n        var jit = require('../platform/instantiate-jit');\r\n        this._createFunction = jit.compile(this.data);\r\n    },\r\n\r\n    // just instantiate, will not initialize the Node, this will be called during Node's initialization.\r\n    // @param {Node} [rootToRedirect] - specify an instantiated prefabRoot that all references to prefabRoot in prefab\r\n    //                                  will redirect to\r\n    _doInstantiate: function (rootToRedirect) {\r\n        if (this.data._prefab) {\r\n            // prefab asset is always synced\r\n            this.data._prefab._synced = true;\r\n        }\r\n        else {\r\n            // temp guard code\r\n            cc.warnID(3700);\r\n        }\r\n        if (!this._createFunction) {\r\n            this.compileCreateFunction();\r\n        }\r\n        return this._createFunction(rootToRedirect);  // this.data._instantiate();\r\n    },\r\n\r\n    _instantiate: function () {\r\n        var node, useJit = false;\r\n        if (CC_SUPPORT_JIT) {\r\n            if (this.optimizationPolicy === OptimizationPolicy.SINGLE_INSTANCE) {\r\n                useJit = false;\r\n            }\r\n            else if (this.optimizationPolicy === OptimizationPolicy.MULTI_INSTANCE) {\r\n                useJit = true;\r\n            }\r\n            else {\r\n                // auto\r\n                useJit = (this._instantiatedTimes + 1) >= Prefab.OptimizationPolicyThreshold;\r\n            }\r\n        }\r\n        if (useJit) {\r\n            // instantiate node\r\n            node = this._doInstantiate();\r\n            // initialize node\r\n            this.data._instantiate(node);\r\n        }\r\n        else {\r\n            // prefab asset is always synced\r\n            this.data._prefab._synced = true;\r\n            // instantiate node\r\n            node = this.data._instantiate();\r\n        }\r\n        ++this._instantiatedTimes;\r\n\r\n        // link prefab in editor\r\n        if (CC_EDITOR || CC_TEST) {\r\n            var PrefabUtils = Editor.require('scene://utils/prefab');\r\n            // This operation is not necessary, but some old prefab asset may not contain complete data.\r\n            PrefabUtils.linkPrefab(this, node);\r\n        }\r\n        return node;\r\n    }\r\n});\r\n\r\ncc.Prefab = module.exports = Prefab;\r\ncc.js.obsolete(cc, 'cc._Prefab', 'Prefab');\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar CCObject = require('../platform/CCObject');\r\nvar js = require('../platform/js');\r\n\r\n/**\r\n * !#en\r\n * The base class for registering asset types.\r\n * !#zh\r\n * \r\n *\r\n * @class RawAsset\r\n * @extends Object\r\n */\r\ncc.RawAsset = cc.Class({\r\n    name: 'cc.RawAsset', extends: CCObject,\r\n\r\n    ctor: function () {\r\n        /**\r\n         * @property _uuid\r\n         * @type {String}\r\n         * @private\r\n         */\r\n        Object.defineProperty(this, '_uuid', {\r\n            value: '',\r\n            writable: true,\r\n            // enumerable is false by default, to avoid uuid being assigned to empty string during destroy\r\n        });\r\n    },\r\n});\r\n\r\n/**\r\n * @method isRawAssetType\r\n * @param {Function} ctor\r\n * @returns {Boolean}\r\n * @static\r\n * @private\r\n */\r\njs.value(cc.RawAsset, 'isRawAssetType', function (ctor) {\r\n    return js.isChildClassOf(ctor, cc.RawAsset) && !js.isChildClassOf(ctor, cc.Asset);\r\n});\r\n\r\n // TODO - DELME after 2.1\r\njs.value(cc.RawAsset, 'wasRawAssetType', function (ctor) {\r\n    return ctor === cc.Texture2D ||\r\n           ctor === cc.AudioClip ||\r\n           ctor === cc.ParticleAsset ||\r\n           ctor === cc.Asset;           // since 1.10, all raw asset will import as cc.Asset\r\n});\r\n\r\nmodule.exports = cc.RawAsset;\r\n","const renderer = require('../renderer');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst gfx = renderEngine.gfx;\r\nconst Texture2D = require('./CCTexture2D');\r\n\r\n/**\r\n * Render textures are textures that can be rendered to.\r\n * @class RenderTexture\r\n * @extends Texture2D\r\n */\r\nlet RenderTexture = cc.Class({\r\n    name: 'cc.RenderTexture',\r\n    extends: Texture2D,\r\n\r\n    ctor () {\r\n        this._framebuffer = null;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Init the render texture with size.\r\n     * !#zh\r\n     *  render texture \r\n     * @param {Number} [width] \r\n     * @param {Number} [height]\r\n     * @param {Number} [depthStencilFormat]\r\n     * @method initWithSize\r\n     */\r\n    initWithSize (width, height, depthStencilFormat) {\r\n        this.width = Math.floor(width || cc.visibleRect.width);\r\n        this.height = Math.floor(height || cc.visibleRect.height);\r\n\r\n        let opts = {};\r\n        opts.format = this._format;\r\n        opts.width = width;\r\n        opts.height = height;\r\n        opts.images = undefined;\r\n        opts.wrapS = this._wrapS;\r\n        opts.wrapT = this._wrapT;\r\n        opts.premultiplyAlpha = this._premultiplyAlpha;\r\n        opts.minFilter = Texture2D._FilterIndex[this._minFilter];\r\n        opts.magFilter = Texture2D._FilterIndex[this._magFilter];\r\n\r\n        if (!this._texture) {\r\n            this._texture = new renderer.Texture2D(renderer.device, opts);\r\n        }\r\n        else {\r\n            this._texture.update(opts);\r\n        }\r\n\r\n        opts = {\r\n            colors: [ this._texture ],\r\n        };\r\n        if (depthStencilFormat) {\r\n            let depthStencilBuffer = new gfx.RenderBuffer(renderer.device, depthStencilFormat, width, height);\r\n            if (depthStencilFormat === gfx.RB_FMT_D24S8) {\r\n                opts.depth = opts.stencil = depthStencilBuffer;\r\n            }\r\n            else if (depthStencilFormat === gfx.RB_FMT_S8) {\r\n                opts.stencil = depthStencilBuffer;\r\n            }\r\n            else if (depthStencilFormat === gl.RB_FMT_D16) {\r\n                opts.depth = depthStencilBuffer;\r\n            }\r\n        }\r\n\r\n        if (this._framebuffer) {\r\n            this._framebuffer.destroy();\r\n        }\r\n        this._framebuffer = new renderEngine.gfx.FrameBuffer(renderer.device, width, height, opts);\r\n\r\n        this.loaded = true;\r\n        this.emit(\"load\");\r\n    },\r\n\r\n    /**\r\n     * !#en Draw a texture to the specified position\r\n     * !#zh \r\n     * @param {Texture2D} texture \r\n     * @param {Number} x \r\n     * @param {Number} y \r\n     */\r\n    drawTextureAt (texture, x, y) {\r\n        if (!texture._image) return;\r\n\r\n        this._texture.updateSubImage({\r\n            x, y,\r\n            image: texture._image,\r\n            width: texture.width,\r\n            height: texture.height,\r\n            level: 0,\r\n            flipY: false,\r\n            premultiplyAlpha: texture._premultiplyAlpha\r\n        })\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Get pixels from render texture, the pixels data stores in a RGBA Uint8Array.\r\n     * It will return a new (width * height * 4) length Uint8Array by default\r\n     * You can specify a data to store the pixels to reuse the data, \r\n     * you and can specify other params to specify the texture region to read.\r\n     * !#zh\r\n     *  render texture  RGBA  Uint8Array \r\n     *   x  x 4  Uint8Array\r\n     *  data \r\n     * @method readPixels\r\n     * @param {Uint8Array} [data]\r\n     * @param {Number} [x] \r\n     * @param {Number} [y] \r\n     * @param {Number} [w] \r\n     * @param {Number} [h] \r\n     * @return {Uint8Array}\r\n     */\r\n    readPixels (data, x, y, w, h) {\r\n        if (!this._framebuffer || !this._texture) return data;\r\n\r\n        x = x || 0;\r\n        y = y || 0;\r\n        let width = w || this.width;\r\n        let height = h || this.height\r\n        data = data  || new Uint8Array(width * height * 4);\r\n\r\n        let gl = renderer._forward._device._gl;\r\n        let oldFBO = gl.getParameter(gl.FRAMEBUFFER_BINDING);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._framebuffer._glID);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this._texture._glID, 0);\r\n        gl.readPixels(x, y, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, oldFBO);\r\n\r\n        return data;\r\n    },\r\n\r\n    destroy () {\r\n        this._super();\r\n        if (this._framebuffer) {\r\n            this._framebuffer.destroy();\r\n        }\r\n    }\r\n});\r\n\r\ncc.RenderTexture = module.exports = RenderTexture;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en Class for scene handling.\r\n * !#zh \r\n * @class SceneAsset\r\n * @extends Asset\r\n *\r\n */\r\nvar Scene = cc.Class({\r\n    name: 'cc.SceneAsset',\r\n    extends: cc.Asset,\r\n\r\n    properties: {\r\n\r\n        /**\r\n         * @property {Scene} scene\r\n         * @default null\r\n         */\r\n        scene: null,\r\n\r\n        /**\r\n         * !#en Indicates the raw assets of this scene can be load after scene launched.\r\n         * !#zh \r\n         * @property {Boolean} asyncLoadAssets\r\n         * @default false\r\n         */\r\n        asyncLoadAssets: undefined,\r\n\r\n        //// backup prefab assets in editor\r\n        //// {string} assetUuid: {cc.Node} rootInPrefab\r\n        //_prefabDatas: {\r\n        //    default: null,\r\n        //    editorOnly: true\r\n        //}\r\n    },\r\n});\r\n\r\ncc.SceneAsset = Scene;\r\nmodule.exports = Scene;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en Class for script handling.\r\n * !#zh Script \r\n * @class _Script\r\n * @extends Asset\r\n *\r\n * @private\r\n */\r\nvar Script = cc.Class({\r\n    name: 'cc.Script',\r\n    extends: cc.Asset,\r\n});\r\n\r\ncc._Script = Script;\r\n\r\n/**\r\n * !#en Class for JavaScript handling.\r\n * !#zh JavaScript \r\n * @class _JavaScript\r\n * @extends Asset\r\n * @private\r\n *\r\n */\r\nvar JavaScript = cc.Class({\r\n    name: 'cc.JavaScript',\r\n    extends: Script,\r\n});\r\n\r\ncc._JavaScript = JavaScript;\r\n\r\n/**\r\n * !#en Class for coffeescript handling.\r\n * !#zh CoffeeScript \r\n * @class CoffeeScript\r\n * @extends Asset\r\n *\r\n */\r\nvar CoffeeScript = cc.Class({\r\n    name: 'cc.CoffeeScript',\r\n    extends: Script,\r\n});\r\n\r\ncc._CoffeeScript = CoffeeScript;\r\n\r\n/**\r\n * !#en Class for TypeScript handling.\r\n * !#zh TypeScript \r\n * @class TypeScript\r\n * @extends Asset\r\n *\r\n */\r\nvar TypeScript = cc.Class({\r\n    name: 'cc.TypeScript',\r\n    extends: Script,\r\n});\r\n\r\ncc._TypeScript = TypeScript;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en Class for sprite atlas handling.\r\n * !#zh \r\n * @class SpriteAtlas\r\n * @extends Asset\r\n */\r\nvar SpriteAtlas = cc.Class({\r\n    name: 'cc.SpriteAtlas',\r\n    extends: cc.Asset,\r\n    properties: {\r\n        _spriteFrames: {\r\n            default: {}\r\n        },\r\n    },\r\n\r\n    /**\r\n     * Returns the texture of the sprite atlas\r\n     * @method getTexture\r\n     * @returns {Texture2D}\r\n     */\r\n    getTexture: function () {\r\n        var keys = Object.keys(this._spriteFrames);\r\n        if (keys.length > 0) {\r\n            var spriteFrame = this._spriteFrames[keys[0]];\r\n            return spriteFrame ? spriteFrame.getTexture() : null;\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the sprite frame correspond to the given key in sprite atlas.\r\n     * @method getSpriteFrame\r\n     * @param {String} key\r\n     * @returns {SpriteFrame}\r\n     */\r\n    getSpriteFrame: function (key) {\r\n        let sf = this._spriteFrames[key];\r\n        if (!sf) {\r\n            return null;\r\n        } \r\n        if (!sf.name) {\r\n            sf.name = key;\r\n        }\r\n        return sf;\r\n    },\r\n\r\n    /**\r\n     * Returns the sprite frames in sprite atlas.\r\n     * @method getSpriteFrames\r\n     * @returns {[SpriteFrame]}\r\n     */\r\n    getSpriteFrames: function () {\r\n        var frames = [];\r\n        var spriteFrames = this._spriteFrames;\r\n\r\n        for (var key in spriteFrames) {\r\n            frames.push(this.getSpriteFrame(key));\r\n        }\r\n\r\n        return frames;\r\n    }\r\n});\r\n\r\ncc.SpriteAtlas = SpriteAtlas;\r\nmodule.exports =  SpriteAtlas;\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst EventTarget = require(\"../event/event-target\");\r\nconst textureUtil = require('../utils/texture-util');\r\n\r\nconst INSET_LEFT = 0;\r\nconst INSET_TOP = 1;\r\nconst INSET_RIGHT = 2;\r\nconst INSET_BOTTOM = 3;\r\n\r\nlet temp_uvs = [{u: 0, v: 0}, {u: 0, v: 0}, {u: 0, v: 0}, {u: 0, v: 0}];\r\n\r\n/**\r\n * !#en\r\n * A cc.SpriteFrame has:<br/>\r\n *  - texture: A cc.Texture2D that will be used by render components<br/>\r\n *  - rectangle: A rectangle of the texture\r\n *\r\n * !#zh\r\n *  SpriteFrame <br/>\r\n *  -  Texture2D <br/>\r\n *  - \r\n *\r\n * @class SpriteFrame\r\n * @extends Asset\r\n * @uses EventTarget\r\n * @example\r\n * // load a cc.SpriteFrame with image path (Recommend)\r\n * var self = this;\r\n * var url = \"test assets/PurpleMonster\";\r\n * cc.loader.loadRes(url, cc.SpriteFrame, function (err, spriteFrame) {\r\n *  var node = new cc.Node(\"New Sprite\");\r\n *  var sprite = node.addComponent(cc.Sprite);\r\n *  sprite.spriteFrame = spriteFrame;\r\n *  node.parent = self.node\r\n * });\r\n */\r\nlet SpriteFrame = cc.Class(/** @lends cc.SpriteFrame# */{\r\n    name: 'cc.SpriteFrame',\r\n    extends: require('../assets/CCAsset'),\r\n    mixins: [EventTarget],\r\n\r\n    properties: {\r\n        // Use this property to set texture when loading dependency\r\n        _textureSetter: {\r\n            set: function (texture) {\r\n                if (texture) {\r\n                    if (CC_EDITOR && Editor.isBuilder) {\r\n                        // just building\r\n                        this._texture = texture;\r\n                        return;\r\n                    }\r\n                    if (this._texture !== texture) {\r\n                        this._refreshTexture(texture);\r\n                    }\r\n                    this._textureFilename = texture.url;\r\n                }\r\n            }\r\n        },\r\n\r\n        // _textureFilename: {\r\n        //     get () {\r\n        //         return (this._texture && this._texture.url) || \"\";\r\n        //     },\r\n        //     set (url) {\r\n        //         let texture = cc.textureCache.addImage(url);\r\n        //         this._refreshTexture(texture);\r\n        //     }\r\n        // },\r\n\r\n        /**\r\n         * !#en Top border of the sprite\r\n         * !#zh sprite \r\n         * @property insetTop\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        insetTop: {\r\n            get: function () {\r\n                return this._capInsets[INSET_TOP];\r\n            },\r\n            set: function (value) {\r\n                this._capInsets[INSET_TOP] = value;\r\n                if (this._texture) {\r\n                    this._calculateSlicedUV();\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Bottom border of the sprite\r\n         * !#zh sprite \r\n         * @property insetBottom\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        insetBottom: {\r\n            get: function () {\r\n                return this._capInsets[INSET_BOTTOM];\r\n            },\r\n            set: function (value) {\r\n                this._capInsets[INSET_BOTTOM] = value;\r\n                if (this._texture) {\r\n                    this._calculateSlicedUV();\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Left border of the sprite\r\n         * !#zh sprite \r\n         * @property insetLeft\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        insetLeft: {\r\n            get: function () {\r\n                return this._capInsets[INSET_LEFT];\r\n            },\r\n            set: function (value) {\r\n                this._capInsets[INSET_LEFT] = value;\r\n                if (this._texture) {\r\n                    this._calculateSlicedUV();\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Right border of the sprite\r\n         * !#zh sprite \r\n         * @property insetRight\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        insetRight: {\r\n            get: function () {\r\n                return this._capInsets[INSET_RIGHT];\r\n            },\r\n            set: function (value) {\r\n                this._capInsets[INSET_RIGHT] = value;\r\n                if (this._texture) {\r\n                    this._calculateSlicedUV();\r\n                }\r\n            }\r\n        },\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Constructor of SpriteFrame class.\r\n     * !#zh\r\n     * SpriteFrame \r\n     * @method constructor\r\n     * @param {String|Texture2D} [filename]\r\n     * @param {Rect} [rect]\r\n     * @param {Boolean} [rotated] - Whether the frame is rotated in the texture\r\n     * @param {Vec2} [offset] - The offset of the frame in the texture\r\n     * @param {Size} [originalSize] - The size of the frame in the texture\r\n     */\r\n    ctor: function () {\r\n        // Init EventTarget data\r\n        EventTarget.call(this);\r\n\r\n        let filename = arguments[0];\r\n        let rect = arguments[1];\r\n        let rotated = arguments[2];\r\n        let offset = arguments[3];\r\n        let originalSize = arguments[4];\r\n\r\n        // the location of the sprite on rendering texture\r\n        this._rect = null;\r\n\r\n        // for trimming\r\n        this._offset = null;\r\n\r\n        // for trimming\r\n        this._originalSize = null;\r\n\r\n        this._rotated = false;\r\n\r\n        this.vertices = null;\r\n\r\n        this._capInsets = [0, 0, 0, 0];\r\n\r\n        this.uv = [];\r\n        this.uvSliced = [];\r\n\r\n        this._texture = null;\r\n        this._textureFilename = '';\r\n\r\n        // store original info before packed to dynamic atlas\r\n        this._original = null;\r\n\r\n        if (CC_EDITOR) {\r\n            // Atlas asset uuid\r\n            this._atlasUuid = '';\r\n        }\r\n\r\n        if (filename !== undefined) {\r\n            this.setTexture(filename, rect, rotated, offset, originalSize);\r\n        } else {\r\n            //todo log Error\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Returns whether the texture have been loaded\r\n     * !#zh \r\n     * @method textureLoaded\r\n     * @returns {boolean}\r\n     */\r\n    textureLoaded: function () {\r\n        return this._texture && this._texture.loaded;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns whether the sprite frame is rotated in the texture.\r\n     * !#zh  SpriteFrame \r\n     * @method isRotated\r\n     * @return {Boolean}\r\n     */\r\n    isRotated: function () {\r\n        return this._rotated;\r\n    },\r\n\r\n    /**\r\n     * !#en Set whether the sprite frame is rotated in the texture.\r\n     * !#zh  SpriteFrame \r\n     * @method setRotated\r\n     * @param {Boolean} bRotated\r\n     */\r\n    setRotated: function (bRotated) {\r\n        this._rotated = bRotated;\r\n        if (this._texture)\r\n            this._calculateUV();\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the rect of the sprite frame in the texture.\r\n     * !#zh  SpriteFrame \r\n     * @method getRect\r\n     * @return {Rect}\r\n     */\r\n    getRect: function () {\r\n        return cc.rect(this._rect);\r\n    },\r\n\r\n    /**\r\n     * !#en Sets the rect of the sprite frame in the texture.\r\n     * !#zh  SpriteFrame \r\n     * @method setRect\r\n     * @param {Rect} rect\r\n     */\r\n    setRect: function (rect) {\r\n        this._rect = rect;\r\n        if (this._texture)\r\n            this._calculateUV();\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the original size of the trimmed image.\r\n     * !#zh \r\n     * @method getOriginalSize\r\n     * @return {Size}\r\n     */\r\n    getOriginalSize: function () {\r\n        return cc.size(this._originalSize);\r\n    },\r\n\r\n    /**\r\n     * !#en Sets the original size of the trimmed image.\r\n     * !#zh \r\n     * @method setOriginalSize\r\n     * @param {Size} size\r\n     */\r\n    setOriginalSize: function (size) {\r\n        if (!this._originalSize) {\r\n            this._originalSize = cc.size(size);\r\n        } else {\r\n            this._originalSize.width = size.width;\r\n            this._originalSize.height = size.height;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the texture of the frame.\r\n     * !#zh \r\n     * @method getTexture\r\n     * @return {Texture2D}\r\n     */\r\n    getTexture: function () {\r\n        return this._texture;\r\n    },\r\n\r\n    _textureLoadedCallback () {\r\n        let self = this;\r\n        let texture = this._texture;\r\n        if (!texture) {\r\n            // clearTexture called while loading texture...\r\n            return;\r\n        }\r\n        let w = texture.width, h = texture.height;\r\n\r\n        if (self._rotated && cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            // TODO: rotate texture for canvas\r\n            // self._texture = _ccsg.Sprite.CanvasRenderCmd._createRotatedTexture(texture, self.getRect());\r\n            self._rotated = false;\r\n            w = self._texture.width;\r\n            h = self._texture.height;\r\n            self._rect = cc.rect(0, 0, w, h);\r\n        }\r\n\r\n        if (self._rect) {\r\n            self._checkRect(self._texture);\r\n        }\r\n        else {\r\n            self._rect = cc.rect(0, 0, w, h);\r\n        }\r\n\r\n        if (!self._originalSize) {\r\n            self.setOriginalSize(cc.size(w, h));\r\n        }\r\n\r\n        if (!self._offset) {\r\n            self.setOffset(cc.v2(0, 0));\r\n        }\r\n\r\n        self._calculateUV();\r\n\r\n        // dispatch 'load' event of cc.SpriteFrame\r\n        self.emit(\"load\");\r\n    },\r\n\r\n    /*\r\n     * !#en Sets the texture of the frame.\r\n     * !#zh \r\n     * @method _refreshTexture\r\n     * @param {Texture2D} texture\r\n     */\r\n    _refreshTexture: function (texture) {\r\n        this._texture = texture;\r\n        if (texture.loaded) {\r\n            this._textureLoadedCallback();\r\n        }\r\n        else {\r\n            texture.once('load', this._textureLoadedCallback, this);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the offset of the frame in the texture.\r\n     * !#zh \r\n     * @method getOffset\r\n     * @return {Vec2}\r\n     */\r\n    getOffset: function () {\r\n        return cc.v2(this._offset);\r\n    },\r\n\r\n    /**\r\n     * !#en Sets the offset of the frame in the texture.\r\n     * !#zh \r\n     * @method setOffset\r\n     * @param {Vec2} offsets\r\n     */\r\n    setOffset: function (offsets) {\r\n        this._offset = cc.v2(offsets);\r\n    },\r\n\r\n    /**\r\n     * !#en Clone the sprite frame.\r\n     * !#zh  SpriteFrame\r\n     * @method clone\r\n     * @return {SpriteFrame}\r\n     */\r\n    clone: function () {\r\n        return new SpriteFrame(this._texture || this._textureFilename, this._rect, this._rotated, this._offset, this._originalSize);\r\n    },\r\n\r\n    /**\r\n     * !#en Set SpriteFrame with Texture, rect, rotated, offset and originalSize.<br/>\r\n     * !#zh  Texturerectrotatedoffset  originalSize  SpriteFrame\r\n     * @method setTexture\r\n     * @param {String|Texture2D} textureOrTextureFile\r\n     * @param {Rect} [rect=null]\r\n     * @param {Boolean} [rotated=false]\r\n     * @param {Vec2} [offset=cc.v2(0,0)]\r\n     * @param {Size} [originalSize=rect.size]\r\n     * @return {Boolean}\r\n     */\r\n    setTexture: function (textureOrTextureFile, rect, rotated, offset, originalSize) {\r\n        if (rect) {\r\n            this._rect = rect;\r\n        }\r\n        else {\r\n            this._rect = null;\r\n        }\r\n\r\n        if (offset) {\r\n            this.setOffset(offset);\r\n        }\r\n        else {\r\n            this._offset = null;\r\n        }\r\n\r\n        if (originalSize) {\r\n            this.setOriginalSize(originalSize);\r\n        }\r\n        else {\r\n            this._originalSize = null;\r\n        }\r\n\r\n        this._rotated = rotated || false;\r\n\r\n        // loading texture\r\n        let texture = textureOrTextureFile;\r\n        if (typeof texture === 'string' && texture) {\r\n            this._textureFilename = texture;\r\n            this._loadTexture();\r\n        }\r\n        if (texture instanceof cc.Texture2D && this._texture !== texture) {\r\n            this._refreshTexture(texture);\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    _loadTexture: function () {\r\n        if (this._textureFilename) {\r\n            let texture = textureUtil.loadImage(this._textureFilename);\r\n            this._refreshTexture(texture);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en If a loading scene (or prefab) is marked as `asyncLoadAssets`, all the textures of the SpriteFrame which\r\n     * associated by user's custom Components in the scene, will not preload automatically.\r\n     * These textures will be load when Sprite component is going to render the SpriteFrames.\r\n     * You can call this method if you want to load the texture early.\r\n     * !#zh  Prefab  `asyncLoadAssets`  SpriteFrame \r\n     *  Sprite  SpriteFrame \r\n     *\r\n     * @method ensureLoadTexture\r\n     * @example\r\n     * if (spriteFrame.textureLoaded()) {\r\n     *     this._onSpriteFrameLoaded();\r\n     * }\r\n     * else {\r\n     *     spriteFrame.once('load', this._onSpriteFrameLoaded, this);\r\n     *     spriteFrame.ensureLoadTexture();\r\n     * }\r\n     */\r\n    ensureLoadTexture: function () {\r\n        if (this._texture) {\r\n            if (!this._texture.loaded) {\r\n                // load exists texture\r\n                this._refreshTexture(this._texture);\r\n                textureUtil.postLoadTexture(this._texture);\r\n            }\r\n        }\r\n        else if (this._textureFilename) {\r\n            // load new texture\r\n            this._loadTexture();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * If you do not need to use the SpriteFrame temporarily, you can call this method so that its texture could be garbage collected. Then when you need to render the SpriteFrame, you should call `ensureLoadTexture` manually to reload texture.\r\n     * !#zh\r\n     *  SpriteFrame  GC SpriteFrame  `ensureLoadTexture` \r\n     *\r\n     * @method clearTexture\r\n     * @example\r\n     * spriteFrame.clearTexture();\r\n     * // when you need the SpriteFrame again...\r\n     * spriteFrame.once('load', onSpriteFrameLoaded);\r\n     * spriteFrame.ensureLoadTexture();\r\n     */\r\n    clearTexture: function () {\r\n        this._texture = null;   // TODO - release texture\r\n    },\r\n\r\n    _checkRect: function (texture) {\r\n        let rect = this._rect;\r\n        let maxX = rect.x, maxY = rect.y;\r\n        if (this._rotated) {\r\n            maxX += rect.height;\r\n            maxY += rect.width;\r\n        }\r\n        else {\r\n            maxX += rect.width;\r\n            maxY += rect.height;\r\n        }\r\n        if (maxX > texture.width) {\r\n            cc.errorID(3300, texture.url + '/' + this.name, maxX, texture.width);\r\n        }\r\n        if (maxY > texture.height) {\r\n            cc.errorID(3400, texture.url + '/' + this.name, maxY, texture.height);\r\n        }\r\n    },\r\n\r\n    _calculateSlicedUV () {\r\n        let rect = this._rect;\r\n        let atlasWidth = this._texture.width;\r\n        let atlasHeight = this._texture.height;\r\n        let leftWidth = this._capInsets[INSET_LEFT];\r\n        let rightWidth = this._capInsets[INSET_RIGHT];\r\n        let centerWidth = rect.width - leftWidth - rightWidth;\r\n        let topHeight = this._capInsets[INSET_TOP];\r\n        let bottomHeight = this._capInsets[INSET_BOTTOM];\r\n        let centerHeight = rect.height - topHeight - bottomHeight;\r\n\r\n        let uvSliced = this.uvSliced;\r\n        uvSliced.length = 0;\r\n        if (this._rotated) {\r\n            temp_uvs[0].u = (rect.x) / atlasWidth;\r\n            temp_uvs[1].u = (rect.x + bottomHeight) / atlasWidth;\r\n            temp_uvs[2].u = (rect.x + bottomHeight + centerHeight) / atlasWidth;\r\n            temp_uvs[3].u = (rect.x + rect.height) / atlasWidth;\r\n            temp_uvs[3].v = (rect.y) / atlasHeight;\r\n            temp_uvs[2].v = (rect.y + leftWidth) / atlasHeight;\r\n            temp_uvs[1].v = (rect.y + leftWidth + centerWidth) / atlasHeight;\r\n            temp_uvs[0].v = (rect.y + rect.width) / atlasHeight;\r\n\r\n            for (let row = 0; row < 4; ++row) {\r\n                let rowD = temp_uvs[row];\r\n                for (let col = 0; col < 4; ++col) {\r\n                    let colD = temp_uvs[3 - col];\r\n                    uvSliced.push({\r\n                        u: rowD.u,\r\n                        v: colD.v\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            temp_uvs[0].u = (rect.x) / atlasWidth;\r\n            temp_uvs[1].u = (rect.x + leftWidth) / atlasWidth;\r\n            temp_uvs[2].u = (rect.x + leftWidth + centerWidth) / atlasWidth;\r\n            temp_uvs[3].u = (rect.x + rect.width) / atlasWidth;\r\n            temp_uvs[3].v = (rect.y) / atlasHeight;\r\n            temp_uvs[2].v = (rect.y + topHeight) / atlasHeight;\r\n            temp_uvs[1].v = (rect.y + topHeight + centerHeight) / atlasHeight;\r\n            temp_uvs[0].v = (rect.y + rect.height) / atlasHeight;\r\n\r\n            for (let row = 0; row < 4; ++row) {\r\n                let rowD = temp_uvs[row];\r\n                for (let col = 0; col < 4; ++col) {\r\n                    let colD = temp_uvs[col];\r\n                    uvSliced.push({\r\n                        u: colD.u,\r\n                        v: rowD.v\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    _calculateUV () {\r\n        let rect = this._rect,\r\n            texture = this._texture,\r\n            uv = this.uv,\r\n            texw = texture.width,\r\n            texh = texture.height;\r\n\r\n        if (this._rotated) {\r\n            let l = texw === 0 ? 0 : rect.x / texw;\r\n            let r = texw === 0 ? 0 : (rect.x + rect.height) / texw;\r\n            let b = texh === 0 ? 0 : (rect.y + rect.width) / texh;\r\n            let t = texh === 0 ? 0 : rect.y / texh;\r\n            uv[0] = l;\r\n            uv[1] = t;\r\n            uv[2] = l;\r\n            uv[3] = b;\r\n            uv[4] = r;\r\n            uv[5] = t;\r\n            uv[6] = r;\r\n            uv[7] = b;\r\n        }\r\n        else {\r\n            let l = texw === 0 ? 0 : rect.x / texw;\r\n            let r = texw === 0 ? 0 : (rect.x + rect.width) / texw;\r\n            let b = texh === 0 ? 0 : (rect.y + rect.height) / texh;\r\n            let t = texh === 0 ? 0 : rect.y / texh;\r\n            uv[0] = l;\r\n            uv[1] = b;\r\n            uv[2] = r;\r\n            uv[3] = b;\r\n            uv[4] = l;\r\n            uv[5] = t;\r\n            uv[6] = r;\r\n            uv[7] = t;\r\n        }\r\n\r\n        let vertices = this.vertices;\r\n        if (vertices) {\r\n            vertices.nu.length = 0;\r\n            vertices.nv.length = 0;\r\n            for (let i = 0; i < vertices.u.length; i++) {\r\n                vertices.nu[i] = vertices.u[i]/texw;\r\n                vertices.nv[i] = vertices.v[i]/texh;\r\n            }\r\n        }\r\n\r\n        this._calculateSlicedUV();\r\n    },\r\n\r\n    // SERIALIZATION\r\n\r\n    _serialize: CC_EDITOR && function (exporting) {\r\n        let rect = this._rect;\r\n        let offset = this._offset;\r\n        let size = this._originalSize;\r\n        let uuid;\r\n        let texture = this._texture;\r\n        if (texture) {\r\n            uuid = texture._uuid;\r\n        }\r\n        if (!uuid) {\r\n            let url = this._textureFilename;\r\n            if (url) {\r\n                uuid = Editor.Utils.UuidCache.urlToUuid(url);\r\n            }\r\n        }\r\n        if (uuid && exporting) {\r\n            uuid = Editor.Utils.UuidUtils.compressUuid(uuid, true);\r\n        }\r\n\r\n        let vertices;\r\n        if (this.vertices) {\r\n            vertices = {\r\n                triangles: this.vertices.triangles,\r\n                x: this.vertices.x,\r\n                y: this.vertices.y,\r\n                u: this.vertices.u,\r\n                v: this.vertices.v\r\n            };\r\n        }\r\n\r\n        return {\r\n            name: this._name,\r\n            texture: uuid || undefined,\r\n            atlas: exporting ? undefined : this._atlasUuid,  // strip from json if exporting\r\n            rect: rect ? [rect.x, rect.y, rect.width, rect.height] : undefined,\r\n            offset: offset ? [offset.x, offset.y] : undefined,\r\n            originalSize: size ? [size.width, size.height] : undefined,\r\n            rotated: this._rotated ? 1 : undefined,\r\n            capInsets: this._capInsets,\r\n            vertices: vertices\r\n        };\r\n    },\r\n\r\n    _deserialize: function (data, handle) {\r\n        let rect = data.rect;\r\n        if (rect) {\r\n            this._rect = new cc.Rect(rect[0], rect[1], rect[2], rect[3]);\r\n        }\r\n        if (data.offset) {\r\n            this.setOffset(new cc.Vec2(data.offset[0], data.offset[1]));\r\n        }\r\n        if (data.originalSize) {\r\n            this.setOriginalSize(new cc.Size(data.originalSize[0], data.originalSize[1]));\r\n        }\r\n        this._rotated = data.rotated === 1;\r\n        this._name = data.name;\r\n\r\n        let capInsets = data.capInsets;\r\n        if (capInsets) {\r\n            this._capInsets[INSET_LEFT] = capInsets[INSET_LEFT];\r\n            this._capInsets[INSET_TOP] = capInsets[INSET_TOP];\r\n            this._capInsets[INSET_RIGHT] = capInsets[INSET_RIGHT];\r\n            this._capInsets[INSET_BOTTOM] = capInsets[INSET_BOTTOM];\r\n        }\r\n\r\n        if (CC_EDITOR) {\r\n            this._atlasUuid = data.atlas;\r\n        }\r\n\r\n        this.vertices = data.vertices;\r\n        if (this.vertices) {\r\n            // initialize normal uv arrays\r\n            this.vertices.nu = [];\r\n            this.vertices.nv = [];\r\n        }\r\n\r\n        // load texture via _textureSetter\r\n        let textureUuid = data.texture;\r\n        if (textureUuid) {\r\n            handle.result.push(this, '_textureSetter', textureUuid);\r\n        }\r\n    }\r\n});\r\n\r\nlet proto = SpriteFrame.prototype;\r\n\r\nproto.copyWithZone = proto.clone;\r\nproto.copy = proto.clone;\r\nproto.initWithTexture = proto.setTexture;\r\n\r\ncc.SpriteFrame = SpriteFrame;\r\n\r\nmodule.exports = SpriteFrame;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Font = require('./CCFont');\r\n\r\n/**\r\n * @module cc\r\n */\r\n/**\r\n * !#en Class for TTFFont handling.\r\n * !#zh TTF \r\n * @class TTFFont\r\n * @extends Font\r\n *\r\n */\r\nvar TTFFont = cc.Class({\r\n    name: 'cc.TTFFont',\r\n    extends: Font,\r\n\r\n    properties: {\r\n        _fontFamily: null,\r\n        _nativeAsset: {\r\n            type: cc.String,\r\n            get () {\r\n                return this._fontFamily;\r\n            },\r\n            set (value) {\r\n                this._fontFamily = value || 'Arial';\r\n            },\r\n            override: true\r\n        }\r\n    }\r\n});\r\n\r\ncc.TTFFont = module.exports = TTFFont;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en Class for text file.\r\n * !#zh \r\n * @class TextAsset\r\n * @extends Asset\r\n */\r\nvar TextAsset = cc.Class({\r\n    name: 'cc.TextAsset',\r\n    extends: cc.Asset,\r\n    properties: {\r\n        /**\r\n         * @property {String} text - The text contents of the resource.\r\n         */\r\n        text: \"\",\r\n    },\r\n\r\n    toString () {\r\n        return this.text;\r\n    },\r\n});\r\n\r\nmodule.exports = cc.TextAsset = TextAsset;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst EventTarget = require('../event/event-target');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst renderer = require('../renderer');\r\nrequire('../platform/CCClass');\r\nconst gfx = renderEngine.gfx;\r\n\r\nconst GL_NEAREST = 9728;                // gl.NEAREST\r\nconst GL_LINEAR = 9729;                 // gl.LINEAR\r\nconst GL_REPEAT = 10497;                // gl.REPEAT\r\nconst GL_CLAMP_TO_EDGE = 33071;         // gl.CLAMP_TO_EDGE\r\nconst GL_MIRRORED_REPEAT = 33648;       // gl.MIRRORED_REPEAT\r\n\r\nconst CHAR_CODE_0 = 48;    // '0'\r\nconst CHAR_CODE_1 = 49;    // '1'\r\n\r\nvar idGenerater = new (require('../platform/id-generater'))('Tex');\r\n\r\n/**\r\n * <p>\r\n * This class allows to easily create OpenGL or Canvas 2D textures from images, text or raw data.                                    <br/>\r\n * The created cc.Texture2D object will always have power-of-two dimensions.                                                <br/>\r\n * Depending on how you create the cc.Texture2D object, the actual image area of the texture might be smaller than the texture dimensions <br/>\r\n *  i.e. \"contentSize\" != (pixelsWide, pixelsHigh) and (maxS, maxT) != (1.0, 1.0).                                           <br/>\r\n * Be aware that the content of the generated textures will be upside-down! </p>\r\n\r\n * @class Texture2D\r\n * @uses EventTarget\r\n * @extends Asset\r\n */\r\n\r\n/**\r\n * The texture pixel format, default value is RGBA8888, \r\n * you should note that textures loaded by normal image files (png, jpg) can only support RGBA8888 format,\r\n * other formats are supported by compressed file types or raw data.\r\n * @enum Texture2D.PixelFormat\r\n */\r\nconst PixelFormat = cc.Enum({\r\n    /**\r\n     * 16-bit texture without Alpha channel\r\n     * @property RGB565\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGB565: gfx.TEXTURE_FMT_R5_G6_B5,\r\n    /**\r\n     * 16-bit textures: RGB5A1\r\n     * @property RGB5A1\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGB5A1: gfx.TEXTURE_FMT_R5_G5_B5_A1,\r\n    /**\r\n     * 16-bit textures: RGBA4444\r\n     * @property RGBA4444\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGBA4444: gfx.TEXTURE_FMT_R4_G4_B4_A4,\r\n    /**\r\n     * 24-bit texture: RGB888\r\n     * @property RGB888\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGB888: gfx.TEXTURE_FMT_RGB8,\r\n    /**\r\n     * 32-bit texture: RGBA8888\r\n     * @property RGBA8888\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGBA8888: gfx.TEXTURE_FMT_RGBA8,\r\n    /**\r\n     * 32-bit float texture: RGBA32F\r\n     * @property RGBA32F\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGBA32F: gfx.TEXTURE_FMT_RGBA32F,\r\n    /**\r\n     * 8-bit textures used as masks\r\n     * @property A8\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    A8: gfx.TEXTURE_FMT_A8,\r\n    /**\r\n     * 8-bit intensity texture\r\n     * @property I8\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    I8: gfx.TEXTURE_FMT_L8,\r\n    /**\r\n     * 16-bit textures used as masks\r\n     * @property AI88\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    AI8: gfx.TEXTURE_FMT_L8_A8,\r\n\r\n    /**\r\n     * rgb 2 bpp pvrtc\r\n     * @property RGB_PVRTC_2BPPV1\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGB_PVRTC_2BPPV1: gfx.TEXTURE_FMT_RGB_PVRTC_2BPPV1,\r\n    /**\r\n     * rgba 2 bpp pvrtc\r\n     * @property RGBA_PVRTC_2BPPV1\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGBA_PVRTC_2BPPV1: gfx.TEXTURE_FMT_RGBA_PVRTC_2BPPV1,\r\n    /**\r\n     * rgb 4 bpp pvrtc\r\n     * @property RGB_PVRTC_4BPPV1\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGB_PVRTC_4BPPV1: gfx.TEXTURE_FMT_RGB_PVRTC_4BPPV1,\r\n    /**\r\n     * rgba 4 bpp pvrtc\r\n     * @property RGBA_PVRTC_4BPPV1\r\n     * @readonly\r\n     * @type {Number}\r\n     */\r\n    RGBA_PVRTC_4BPPV1: gfx.TEXTURE_FMT_RGBA_PVRTC_4BPPV1,\r\n});\r\n\r\n/**\r\n * The texture wrap mode\r\n * @enum Texture2D.WrapMode\r\n */\r\nconst WrapMode = cc.Enum({\r\n    /**\r\n     * The constant variable equals gl.REPEAT for texture\r\n     * @property REPEAT\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    REPEAT: GL_REPEAT,\r\n    /**\r\n     * The constant variable equals gl.CLAMP_TO_EDGE for texture\r\n     * @property CLAMP_TO_EDGE\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    CLAMP_TO_EDGE: GL_CLAMP_TO_EDGE,\r\n    /**\r\n     * The constant variable equals gl.MIRRORED_REPEAT for texture\r\n     * @property MIRRORED_REPEAT\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    MIRRORED_REPEAT: GL_MIRRORED_REPEAT\r\n});\r\n\r\n/**\r\n * The texture filter mode\r\n * @enum Texture2D.Filter\r\n */\r\nconst Filter = cc.Enum({\r\n    /**\r\n     * The constant variable equals gl.LINEAR for texture\r\n     * @property LINEAR\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    LINEAR: GL_LINEAR,\r\n    /**\r\n     * The constant variable equals gl.NEAREST for texture\r\n     * @property NEAREST\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    NEAREST: GL_NEAREST\r\n});\r\n\r\nconst FilterIndex = {\r\n    9728: 0, // GL_NEAREST\r\n    9729: 1, // GL_LINEAR\r\n};\r\n\r\nlet _images = [];\r\nlet _sharedOpts = {\r\n    width: undefined,\r\n    height: undefined,\r\n    minFilter: undefined,\r\n    magFilter: undefined,\r\n    wrapS: undefined,\r\n    wrapT: undefined,\r\n    format: undefined,\r\n    mipmap: undefined,\r\n    images: undefined,\r\n    image: undefined,\r\n    flipY: undefined,\r\n    premultiplyAlpha: undefined\r\n};\r\nfunction _getSharedOptions () {\r\n    for (var key in _sharedOpts) {\r\n        _sharedOpts[key] = undefined;\r\n    }\r\n    _images.length = 0;\r\n    _sharedOpts.images = _images;\r\n    _sharedOpts.flipY = false;\r\n    return _sharedOpts;\r\n}\r\n\r\n/**\r\n * This class allows to easily create OpenGL or Canvas 2D textures from images or raw data.\r\n *\r\n * @class Texture2D\r\n * @uses EventTarget\r\n * @extends Asset\r\n */\r\nvar Texture2D = cc.Class({\r\n    name: 'cc.Texture2D',\r\n    extends: require('../assets/CCAsset'),\r\n    mixins: [EventTarget],\r\n\r\n    properties: {\r\n        _nativeAsset: {\r\n            get () {\r\n                // maybe returned to pool in webgl\r\n                return this._image;\r\n            },\r\n            set (data) {\r\n                if (data._compressed && data._data) {\r\n                    this.initWithData(data._data, this._format, data.width, data.height);\r\n                }\r\n                else {\r\n                    this.initWithElement(data);\r\n                }\r\n            },\r\n            override: true\r\n        },\r\n        _hasMipmap: false,\r\n        _format: PixelFormat.RGBA8888,\r\n        _premultiplyAlpha: false,\r\n        _flipY: false,\r\n        _minFilter: Filter.LINEAR,\r\n        _magFilter: Filter.LINEAR,\r\n        _wrapS: WrapMode.CLAMP_TO_EDGE,\r\n        _wrapT: WrapMode.CLAMP_TO_EDGE\r\n    },\r\n\r\n    statics: {\r\n        PixelFormat: PixelFormat,\r\n        WrapMode: WrapMode,\r\n        Filter: Filter,\r\n        _FilterIndex: FilterIndex,\r\n\r\n        // predefined most common extnames\r\n        extnames: ['.png', '.jpg', '.jpeg', '.bmp', '.webp', '.pvr', '.etc'],\r\n\r\n        _isCompressed (texture) {\r\n            return texture._format >= PixelFormat.RGB_PVRTC_2BPPV1 && texture._format <= PixelFormat.RGBA_PVRTC_4BPPV1;\r\n        }\r\n    },\r\n\r\n    ctor () {\r\n        // Id for generate hash in material\r\n        this._id = idGenerater.getNewId();\r\n        \r\n        /**\r\n         * !#en\r\n         * The url of the texture, this could be empty if the texture wasn't created via a file.\r\n         * !#zh\r\n         *  url\r\n         * @property url\r\n         * @type {String}\r\n         * @readonly\r\n         */\r\n        // TODO - use nativeUrl directly\r\n        this.url = \"\";\r\n\r\n        /**\r\n         * !#en\r\n         * Whether the texture is loaded or not\r\n         * !#zh\r\n         * \r\n         * @property loaded\r\n         * @type {Boolean}\r\n         */\r\n        this.loaded = false;\r\n        /**\r\n         * !#en\r\n         * Texture width in pixel\r\n         * !#zh\r\n         * \r\n         * @property width\r\n         * @type {Number}\r\n         */\r\n        this.width = 0;\r\n        /**\r\n         * !#en\r\n         * Texture height in pixel\r\n         * !#zh\r\n         * \r\n         * @property height\r\n         * @type {Number}\r\n         */\r\n        this.height = 0;\r\n\r\n        this._texture = null;\r\n        \r\n        if (CC_EDITOR) {\r\n            this._exportedExts = null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Get renderer texture implementation object\r\n     * extended from renderEngine.TextureAsset\r\n     * !#zh  \r\n     * @method getImpl\r\n     */\r\n    getImpl () {\r\n        return this._texture;\r\n    },\r\n\r\n    getId () {\r\n        return this._id;\r\n    },\r\n\r\n    toString () {\r\n        return this.url || '';\r\n    },\r\n\r\n    /**\r\n     * Update texture options, not available in Canvas render mode.\r\n     * image, format, premultiplyAlpha can not be updated in native.\r\n     * @method update\r\n     * @param {Object} options\r\n     * @param {DOMImageElement} options.image\r\n     * @param {Boolean} options.mipmap\r\n     * @param {PixelFormat} options.format\r\n     * @param {Filter} options.minFilter\r\n     * @param {Filter} options.magFilter\r\n     * @param {WrapMode} options.wrapS\r\n     * @param {WrapMode} options.wrapT\r\n     * @param {Boolean} options.premultiplyAlpha\r\n     */\r\n    update (options) {\r\n        if (options) {\r\n            let updateImg = false;\r\n            if (options.width !== undefined) {\r\n                this.width = options.width;\r\n            }\r\n            if (options.height !== undefined) {\r\n                this.height = options.height;\r\n            }\r\n            if (options.minFilter !== undefined) {\r\n                this._minFilter = options.minFilter;\r\n                options.minFilter = FilterIndex[options.minFilter];\r\n            }\r\n            if (options.magFilter !== undefined) {\r\n                this._magFilter = options.magFilter;\r\n                options.magFilter = FilterIndex[options.magFilter];\r\n            }\r\n            if (options.wrapS !== undefined) {\r\n                this._wrapS = options.wrapS;\r\n            }\r\n            if (options.wrapT !== undefined) {\r\n                this._wrapT = options.wrapT;\r\n            }\r\n            if (options.format !== undefined) {\r\n                this._format = options.format;\r\n            }\r\n            if (options.flipY !== undefined) {\r\n                this._flipY = options.flipY;\r\n                updateImg = true;\r\n            }\r\n            if (options.premultiplyAlpha !== undefined) {\r\n                this._premultiplyAlpha = options.premultiplyAlpha;\r\n                updateImg = true;\r\n            }\r\n            if (options.mipmap !== undefined) {\r\n                this._hasMipmap = options.mipmap;\r\n            }\r\n\r\n            if (updateImg && this._image) {\r\n                options.image = this._image;\r\n            }\r\n            if (options.images && options.images.length > 0) {\r\n                this._image = options.images[0];\r\n            }\r\n            else if (options.image !== undefined) {\r\n                this._image = options.image;\r\n                if (!options.images) {\r\n                    _images.length = 0;\r\n                    options.images = _images;\r\n                }\r\n                // webgl texture 2d uses images\r\n                options.images.push(options.image);\r\n            }\r\n\r\n            if (options.images && options.images.length > 0) {\r\n                this._texture.update(options);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Init with HTML element.\r\n     * !#zh  HTML Image  Canvas \r\n     * @method initWithElement\r\n     * @param {HTMLImageElement|HTMLCanvasElement} element\r\n     * @example\r\n     * var img = new Image();\r\n     * img.src = dataURL;\r\n     * texture.initWithElement(img);\r\n     */\r\n    initWithElement (element) {\r\n        if (!element)\r\n            return;\r\n        this._image = element;\r\n        if (CC_WECHATGAME || CC_QQPLAY || element.complete || element instanceof HTMLCanvasElement) {\r\n            this.handleLoadedTexture();\r\n        }\r\n        else {\r\n            var self = this;\r\n            element.addEventListener('load', function () {\r\n                self.handleLoadedTexture();\r\n            });\r\n            element.addEventListener('error', function (err) {\r\n                cc.warnID(3119, err.message);\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Intializes with a texture2d with data in Uint8Array.\r\n     * !#zh  Unit8Array raw data\r\n     * @method initWithData\r\n     * @param {TypedArray} data\r\n     * @param {Number} pixelFormat\r\n     * @param {Number} pixelsWidth\r\n     * @param {Number} pixelsHeight\r\n     * @return {Boolean}\r\n     */\r\n    initWithData (data, pixelFormat, pixelsWidth, pixelsHeight) {\r\n        var opts = _getSharedOptions();\r\n        opts.image = data;\r\n        // webgl texture 2d uses images\r\n        opts.images = [opts.image];\r\n        opts.hasMipmap = this._hasMipmap;\r\n        opts.premultiplyAlpha = this._premultiplyAlpha;\r\n        opts.flipY = this._flipY;\r\n        opts.minFilter = FilterIndex[this._minFilter];\r\n        opts.magFilter = FilterIndex[this._magFilter];\r\n        opts.wrapS = this._wrapS;\r\n        opts.wrapT = this._wrapT;\r\n        opts.format = pixelFormat;\r\n        opts.width = pixelsWidth;\r\n        opts.height = pixelsHeight;\r\n        if (!this._texture) {\r\n            this._texture = new renderer.Texture2D(renderer.device, opts);\r\n        }\r\n        else {\r\n            this._texture.update(opts);\r\n        }\r\n        this.width = pixelsWidth;\r\n        this.height = pixelsHeight;\r\n        this.loaded = true;\r\n        this.emit(\"load\");\r\n        return true;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * HTMLElement Object getter, available only on web.\r\n     * !#zh  HTML Image  Canvas  Web \r\n     * @method getHtmlElementObj\r\n     * @return {HTMLImageElement|HTMLCanvasElement}\r\n     */\r\n    getHtmlElementObj () {\r\n        return this._image;\r\n    },\r\n    \r\n    /**\r\n     * !#en\r\n     * Destory this texture and immediately release its video memory. (Inherit from cc.Object.destroy)<br>\r\n     * After destroy, this object is not usable any more.\r\n     * You can use cc.isValid(obj) to check whether the object is destroyed before accessing it.\r\n     * !#zh\r\n     *  cc.Object.destroy<br/>\r\n     *  cc.isValid(obj) \r\n     * @method destroy\r\n     * @return {Boolean} inherit from the CCObject\r\n     */\r\n    destroy () {\r\n        this._image = null;\r\n        this._texture && this._texture.destroy();\r\n        // TODO cc.textureUtil ?\r\n        // cc.textureCache.removeTextureForKey(this.url);  // item.rawUrl || item.url\r\n        this._super();\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Pixel format of the texture.\r\n     * !#zh \r\n     * @method getPixelFormat\r\n     * @return {Number}\r\n     */\r\n    getPixelFormat () {\r\n        //support only in WebGl rendering mode\r\n        return this._format;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Whether or not the texture has their Alpha premultiplied.\r\n     * !#zh  GPU \r\n     * @method hasPremultipliedAlpha\r\n     * @return {Boolean}\r\n     */\r\n    hasPremultipliedAlpha () {\r\n        return this._premultiplyAlpha || false;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Whether or not use mipmap.\r\n     * !#zh  GPU  mipmap\r\n     * @method hasMipmap\r\n     * @return {Boolean}\r\n     */\r\n    hasMipmap () {\r\n        return this._hasMipmap || false;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Handler of texture loaded event.\r\n     * Since v2.0, you don't need to invoke this function, it will be invoked automatically after texture loaded.\r\n     * !#zh v2.0 \r\n     * @method handleLoadedTexture\r\n     * @param {Boolean} [premultiplied]\r\n     */\r\n    handleLoadedTexture () {\r\n        if (!this._image || !this._image.width || !this._image.height)\r\n            return;\r\n        \r\n        this.width = this._image.width;\r\n        this.height = this._image.height;\r\n        let opts = _getSharedOptions();\r\n        opts.image = this._image;\r\n        // webgl texture 2d uses images\r\n        opts.images = [opts.image];\r\n        opts.width = this.width;\r\n        opts.height = this.height;\r\n        opts.hasMipmap = this._hasMipmap;\r\n        opts.format = this._format;\r\n        opts.premultiplyAlpha = this._premultiplyAlpha;\r\n        opts.flipY = this._flipY;\r\n        opts.minFilter = FilterIndex[this._minFilter];\r\n        opts.magFilter = FilterIndex[this._magFilter];\r\n        opts.wrapS = this._wrapS;\r\n        opts.wrapT = this._wrapT;\r\n        \r\n        if (!this._texture) {\r\n            this._texture = new renderer.Texture2D(renderer.device, opts);\r\n        }\r\n        else {\r\n            this._texture.update(opts);\r\n        }\r\n\r\n        //dispatch load event to listener.\r\n        this.loaded = true;\r\n        this.emit(\"load\");\r\n\r\n        if (cc.macro.CLEANUP_IMAGE_CACHE && this._image instanceof HTMLImageElement) {\r\n            // wechat game platform will cache image parsed data, \r\n            // so image will consume much more memory than web, releasing it\r\n            this._image.src = \"\";\r\n            // Release image in loader cache\r\n            cc.loader.removeItem(this._image.id);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Description of cc.Texture2D.\r\n     * !#zh cc.Texture2D \r\n     * @method description\r\n     * @returns {String}\r\n     */\r\n    description () {\r\n        return \"<cc.Texture2D | Name = \" + this.url + \" | Dimensions = \" + this.width + \" x \" + this.height + \">\";\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Release texture, please use destroy instead.\r\n     * !#zh  destroy \r\n     * @method releaseTexture\r\n     * @deprecated since v2.0\r\n     */\r\n    releaseTexture () {\r\n        this._image = null;\r\n        this._texture && this._texture.destroy();\r\n    },\r\n\r\n    /**\r\n     * !#en Sets the wrap s and wrap t options. <br/>\r\n     * If the texture size is NPOT (non power of 2), then in can only use gl.CLAMP_TO_EDGE in gl.TEXTURE_WRAP_{S,T}.\r\n     * !#zh \r\n     *  NPOTnon power of 2 Texture2D.WrapMode.CLAMP_TO_EDGE\r\n     * @method setTexParameters\r\n     * @param {Texture2D.WrapMode} wrapS\r\n     * @param {Texture2D.WrapMode} wrapT\r\n     */\r\n    setWrapMode (wrapS, wrapT) {\r\n        if (this._wrapS !== wrapS || this._wrapT !== wrapT) {\r\n            var opts = _getSharedOptions();\r\n            opts.wrapS = wrapS;\r\n            opts.wrapT = wrapT;\r\n            this.update(opts);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Sets the minFilter and magFilter options\r\n     * !#zh \r\n     * @method setFilters\r\n     * @param {Texture2D.Filter} minFilter\r\n     * @param {Texture2D.Filter} magFilter\r\n     */\r\n    setFilters (minFilter, magFilter) {\r\n        if (this._minFilter !== minFilter || this._magFilter !== magFilter) {\r\n            var opts = _getSharedOptions();\r\n            opts.minFilter = minFilter;\r\n            opts.magFilter = magFilter;\r\n            this.update(opts);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the flipY options\r\n     * !#zh \r\n     * @method setFlipY\r\n     * @param {Boolean} flipY\r\n     */\r\n    setFlipY (flipY) {\r\n        if (this._flipY !== flipY) {\r\n            var opts = _getSharedOptions();\r\n            opts.flipY = flipY;\r\n            this.update(opts);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the premultiply alpha options\r\n     * !#zh \r\n     * @method setPremultiplyAlpha\r\n     * @param {Boolean} premultiply\r\n     */\r\n    setPremultiplyAlpha (premultiply) {\r\n        if (this._premultiplyAlpha !== premultiply) {\r\n            var opts = _getSharedOptions();\r\n            opts.premultiplyAlpha = premultiply;\r\n            this.update(opts);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * !#en\r\n     * Sets whether generate mipmaps for the texture\r\n     * !#zh  mipmaps\r\n     * @method setMipmap\r\n     * @param {Boolean} mipmap\r\n     */\r\n    setMipmap (mipmap) {\r\n        if (this._hasMipmap !== mipmap) {\r\n            var opts = _getSharedOptions();\r\n            opts.hasMipmap = mipmap;\r\n            this.update(opts);\r\n        }\r\n    },\r\n\r\n    // SERIALIZATION\r\n\r\n    _serialize: (CC_EDITOR || CC_TEST) && function () {\r\n        let extId = \"\";\r\n        let exportedExts = this._exportedExts;\r\n        if (!exportedExts && this._native) {\r\n            exportedExts = [this._native];\r\n        }\r\n        if (exportedExts) {\r\n            let exts = [];\r\n            for (let i = 0; i < exportedExts.length; i++) {\r\n                let extId = \"\";\r\n                let ext = exportedExts[i]\r\n                if (ext) {\r\n                    // ext@format\r\n                    let extFormat = ext.split('@');\r\n                    extId = Texture2D.extnames.indexOf(extFormat[0]);\r\n                    if (extId < 0) {\r\n                        extId = ext;\r\n                    }\r\n                    if (extFormat[1]) {\r\n                        extId += '@' + extFormat[1];\r\n                    }\r\n                }\r\n                exts.push(extId);\r\n            }\r\n            extId = exts.join('_');\r\n        }\r\n        let asset = \"\" + extId + \",\" + \r\n                    this._minFilter + \",\" + this._magFilter + \",\" + \r\n                    this._wrapS + \",\" + this._wrapT + \",\" + \r\n                    (this._premultiplyAlpha ? 1 : 0);\r\n        return asset;\r\n    },\r\n\r\n    _deserialize: function (data, handle) {\r\n        let fields = data.split(',');\r\n        // decode extname\r\n        var extIdStr = fields[0];\r\n        if (extIdStr) {\r\n            let extIds = extIdStr.split('_');\r\n\r\n            let extId = 999;\r\n            let ext = '';\r\n            let format = this._format;\r\n            let SupportTextureFormats = cc.macro.SUPPORT_TEXTURE_FORMATS;\r\n            for (let i = 0; i < extIds.length; i++) {\r\n                let extFormat = extIds[i].split('@');\r\n                let tmpExt = extFormat[0];\r\n                tmpExt = tmpExt.charCodeAt(0) - CHAR_CODE_0;\r\n                tmpExt = Texture2D.extnames[tmpExt] || extFormat;\r\n\r\n                let index = SupportTextureFormats.indexOf(tmpExt);\r\n                if (index !== -1 && index < extId) {\r\n                    extId = index;\r\n                    ext = tmpExt;\r\n                    format = extFormat[1] ? parseInt(extFormat[1]) : this._format;\r\n                }\r\n            }\r\n\r\n            if (ext) {\r\n                this._setRawAsset(ext);\r\n                this._format = format;\r\n            }\r\n\r\n            // preset uuid to get correct nativeUrl\r\n            let loadingItem = handle.customEnv;\r\n            let uuid = loadingItem && loadingItem.uuid;\r\n            if (uuid) {\r\n                this._uuid = uuid;\r\n                var url = this.nativeUrl;\r\n                this.url = url;\r\n            }\r\n        }\r\n        if (fields.length === 6) {\r\n            // decode filters\r\n            this._minFilter = parseInt(fields[1]);\r\n            this._magFilter = parseInt(fields[2]);\r\n            // decode wraps\r\n            this._wrapS = parseInt(fields[3]);\r\n            this._wrapT = parseInt(fields[4]);\r\n            // decode premultiply alpha\r\n            this._premultiplyAlpha = fields[5].charCodeAt(0) === CHAR_CODE_1;\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * !#zh\r\n * \r\n * !#en\r\n * This event is emitted when the asset is loaded\r\n *\r\n * @event load\r\n */\r\n\r\ncc.Texture2D = module.exports = Texture2D;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./CCRawAsset');\r\nrequire('./CCAsset');\r\nrequire('./CCFont');\r\nrequire('./CCPrefab');\r\nrequire('./CCAudioClip');\r\nrequire('./CCScripts');\r\nrequire('./CCSceneAsset');\r\nrequire('./CCSpriteFrame');\r\nrequire('./CCTexture2D');\r\nrequire('./CCRenderTexture');\r\nrequire('./CCTTFFont');\r\nrequire('./CCSpriteAtlas');\r\nrequire('./CCBitmapFont');\r\nrequire('./CCLabelAtlas');\r\nrequire('./CCTextAsset');\r\nrequire('./CCJsonAsset');\r\nrequire('./CCBufferAsset');","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar Event = require('../CCNode').EventType;\r\n\r\nvar TOP     = 1 << 0;\r\nvar MID     = 1 << 1;   // vertical center\r\nvar BOT     = 1 << 2;\r\nvar LEFT    = 1 << 3;\r\nvar CENTER  = 1 << 4;   // horizontal center\r\nvar RIGHT   = 1 << 5;\r\nvar HORIZONTAL = LEFT | CENTER | RIGHT;\r\nvar VERTICAL = TOP | MID | BOT;\r\n\r\nvar AlignMode = cc.Enum({\r\n    ONCE: 0,\r\n    ON_WINDOW_RESIZE: 1,\r\n    ALWAYS: 2,\r\n});\r\n\r\n// returns a readonly size of the node\r\nfunction getReadonlyNodeSize (parent) {\r\n    if (parent instanceof cc.Scene) {\r\n        return CC_EDITOR ? cc.engine.getDesignResolutionSize() : cc.visibleRect;\r\n    }\r\n    else {\r\n        return parent._contentSize;\r\n    }\r\n}\r\n\r\nfunction computeInverseTransForTarget (widgetNode, target, out_inverseTranslate, out_inverseScale) {\r\n    var scaleX = widgetNode._parent._scale.x;\r\n    var scaleY = widgetNode._parent._scale.y;\r\n    var translateX = 0;\r\n    var translateY = 0;\r\n    for (var node = widgetNode._parent;;) {\r\n        var pos = node._position;\r\n        translateX += pos.x;\r\n        translateY += pos.y;\r\n        node = node._parent;    // loop increment\r\n        if (!node) {\r\n            // ERROR: widgetNode should be child of target\r\n            out_inverseTranslate.x = out_inverseTranslate.y = 0;\r\n            out_inverseScale.x = out_inverseScale.y = 1;\r\n            return;\r\n        }\r\n        if (node !== target) {\r\n            var sx = node._scale.x;\r\n            var sy = node._scale.y;\r\n            translateX *= sx;\r\n            translateY *= sy;\r\n            scaleX *= sx;\r\n            scaleY *= sy;\r\n        }\r\n        else {\r\n            break;\r\n        }\r\n    }\r\n    out_inverseScale.x = scaleX !== 0 ? (1 / scaleX) : 1;\r\n    out_inverseScale.y = scaleY !== 0 ? (1 / scaleY) : 1;\r\n    out_inverseTranslate.x = -translateX;\r\n    out_inverseTranslate.y = -translateY;\r\n}\r\n\r\nvar tInverseTranslate = cc.Vec2.ZERO;\r\nvar tInverseScale = cc.Vec2.ONE;\r\n\r\n// align to borders by adjusting node's position and size (ignore rotation)\r\nfunction align (node, widget) {\r\n    var hasTarget = widget._target;\r\n    var target;\r\n    var inverseTranslate, inverseScale;\r\n    if (hasTarget) {\r\n        target = hasTarget;\r\n        inverseTranslate = tInverseTranslate;\r\n        inverseScale = tInverseScale;\r\n        computeInverseTransForTarget(node, target, inverseTranslate, inverseScale);\r\n    }\r\n    else {\r\n        target = node._parent;\r\n    }\r\n    var targetSize = getReadonlyNodeSize(target);\r\n    var targetAnchor = target._anchorPoint;\r\n\r\n    var isRoot = !CC_EDITOR && target instanceof cc.Scene;\r\n    var x = node._position.x, y = node._position.y;\r\n    var anchor = node._anchorPoint;\r\n\r\n    if (widget._alignFlags & HORIZONTAL) {\r\n\r\n        var localLeft, localRight, targetWidth = targetSize.width;\r\n        if (isRoot) {\r\n            localLeft = cc.visibleRect.left.x;\r\n            localRight = cc.visibleRect.right.x;\r\n        }\r\n        else {\r\n            localLeft = -targetAnchor.x * targetWidth;\r\n            localRight = localLeft + targetWidth;\r\n        }\r\n\r\n        // adjust borders according to offsets\r\n        localLeft += widget._isAbsLeft ? widget._left : widget._left * targetWidth;\r\n        localRight -= widget._isAbsRight ? widget._right : widget._right * targetWidth;\r\n\r\n        if (hasTarget) {\r\n            localLeft += inverseTranslate.x;\r\n            localLeft *= inverseScale.x;\r\n            localRight += inverseTranslate.x;\r\n            localRight *= inverseScale.x;\r\n        }\r\n\r\n        var width, anchorX = anchor.x, scaleX = node._scale.x;\r\n        if (scaleX < 0) {\r\n            anchorX = 1.0 - anchorX;\r\n            scaleX = -scaleX;\r\n        }\r\n        if (widget.isStretchWidth) {\r\n            width = localRight - localLeft;\r\n            if (scaleX !== 0) {\r\n                node.width = width / scaleX;\r\n            }\r\n            x = localLeft + anchorX * width;\r\n        }\r\n        else {\r\n            width = node.width * scaleX;\r\n            if (widget.isAlignHorizontalCenter) {\r\n                var localHorizontalCenter = widget._isAbsHorizontalCenter ? widget._horizontalCenter : widget._horizontalCenter * targetWidth;\r\n                var targetCenter = (0.5 - targetAnchor.x) * targetSize.width;\r\n                if (hasTarget) {\r\n                    localHorizontalCenter *= inverseScale.x;\r\n                    targetCenter += inverseTranslate.x;\r\n                    targetCenter *= inverseScale.x;\r\n                }\r\n                x = targetCenter + (anchorX - 0.5) * width + localHorizontalCenter;\r\n            }\r\n            else if (widget.isAlignLeft) {\r\n                x = localLeft + anchorX * width;\r\n            }\r\n            else {\r\n                x = localRight + (anchorX - 1) * width;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (widget._alignFlags & VERTICAL) {\r\n\r\n        var localTop, localBottom, targetHeight = targetSize.height;\r\n        if (isRoot) {\r\n            localBottom = cc.visibleRect.bottom.y;\r\n            localTop = cc.visibleRect.top.y;\r\n        }\r\n        else {\r\n            localBottom = -targetAnchor.y * targetHeight;\r\n            localTop = localBottom + targetHeight;\r\n        }\r\n\r\n        // adjust borders according to offsets\r\n        localBottom += widget._isAbsBottom ? widget._bottom : widget._bottom * targetHeight;\r\n        localTop -= widget._isAbsTop ? widget._top : widget._top * targetHeight;\r\n\r\n        if (hasTarget) {\r\n            // transform\r\n            localBottom += inverseTranslate.y;\r\n            localBottom *= inverseScale.y;\r\n            localTop += inverseTranslate.y;\r\n            localTop *= inverseScale.y;\r\n        }\r\n\r\n        var height, anchorY = anchor.y, scaleY = node._scale.y;\r\n        if (scaleY < 0) {\r\n            anchorY = 1.0 - anchorY;\r\n            scaleY = -scaleY;\r\n        }\r\n        if (widget.isStretchHeight) {\r\n            height = localTop - localBottom;\r\n            if (scaleY !== 0) {\r\n                node.height = height / scaleY;\r\n            }\r\n            y = localBottom + anchorY * height;\r\n        }\r\n        else {\r\n            height = node.height * scaleY;\r\n            if (widget.isAlignVerticalCenter) {\r\n                var localVerticalCenter = widget._isAbsVerticalCenter ? widget._verticalCenter : widget._verticalCenter * targetHeight;\r\n                var targetMiddle = (0.5 - targetAnchor.y) * targetSize.height;\r\n                if (hasTarget) {\r\n                    localVerticalCenter *= inverseScale.y;\r\n                    targetMiddle += inverseTranslate.y;\r\n                    targetMiddle *= inverseScale.y;\r\n                }\r\n                y = targetMiddle + (anchorY - 0.5) * height + localVerticalCenter;\r\n            }\r\n            else if (widget.isAlignBottom) {\r\n                y = localBottom + anchorY * height;\r\n            }\r\n            else {\r\n                y = localTop + (anchorY - 1) * height;\r\n            }\r\n        }\r\n    }\r\n\r\n    node.setPosition(x, y);\r\n}\r\n\r\nfunction visitNode (node) {\r\n    var widget = node._widget;\r\n    if (widget) {\r\n        if (CC_DEV) {\r\n            widget._validateTargetInDEV();\r\n        }\r\n        align(node, widget);\r\n        if ((!CC_EDITOR || animationState.animatedSinceLastFrame) && widget.alignMode !== AlignMode.ALWAYS) {\r\n            widget.enabled = false;\r\n        }\r\n        else {\r\n            activeWidgets.push(widget);\r\n        }\r\n    }\r\n    var children = node._children;\r\n    for (var i = 0; i < children.length; i++) {\r\n        var child = children[i];\r\n        if (child._active) {\r\n            visitNode(child);\r\n        }\r\n    }\r\n}\r\n\r\nif (CC_EDITOR) {\r\n    var animationState = {\r\n        previewing: false,\r\n        time: 0,\r\n        animatedSinceLastFrame: false,\r\n    };\r\n}\r\n\r\nfunction refreshScene () {\r\n    // check animation editor\r\n    if (CC_EDITOR && !Editor.isBuilder) {\r\n        var AnimUtils = Editor.require('scene://utils/animation');\r\n        var EditMode = Editor.require('scene://edit-mode');\r\n        if (AnimUtils && EditMode) {\r\n            var nowPreviewing = (EditMode.curMode().name === 'animation' && !!AnimUtils.Cache.animation);\r\n            if (nowPreviewing !== animationState.previewing) {\r\n                animationState.previewing = nowPreviewing;\r\n                if (nowPreviewing) {\r\n                    animationState.animatedSinceLastFrame = true;\r\n                    let component = cc.engine.getInstanceById(AnimUtils.Cache.component);\r\n                    if (component) {\r\n                        let animation = component.getAnimationState(AnimUtils.Cache.animation);\r\n                        animationState.time = animation.time;\r\n                    }\r\n                }\r\n                else {\r\n                    animationState.animatedSinceLastFrame = false;\r\n                }\r\n            }\r\n            else if (nowPreviewing) {\r\n                let component = cc.engine.getInstanceById(AnimUtils.Cache.component);\r\n                if (component) {\r\n                    let animation = component.getAnimationState(AnimUtils.Cache.animation);\r\n                    if (animationState.time !== animation.time) {\r\n                        animationState.animatedSinceLastFrame = true;\r\n                        animationState.time = AnimUtils.Cache.animation.time;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    var scene = cc.director.getScene();\r\n    if (scene) {\r\n        widgetManager.isAligning = true;\r\n        if (widgetManager._nodesOrderDirty) {\r\n            activeWidgets.length = 0;\r\n            visitNode(scene);\r\n            widgetManager._nodesOrderDirty = false;\r\n        }\r\n        else {\r\n            var i, widget, iterator = widgetManager._activeWidgetsIterator;\r\n            var AnimUtils;\r\n            if (CC_EDITOR &&\r\n                (AnimUtils = Editor.require('scene://utils/animation')) &&\r\n                AnimUtils.Cache.animation) {\r\n                var editingNode = cc.engine.getInstanceById(AnimUtils.Cache.rNode);\r\n                if (editingNode) {\r\n                    for (i = activeWidgets.length - 1; i >= 0; i--) {\r\n                        widget = activeWidgets[i];\r\n                        var node = widget.node;\r\n                        if (widget.alignMode !== AlignMode.ALWAYS &&\r\n                            animationState.animatedSinceLastFrame &&\r\n                            node.isChildOf(editingNode)\r\n                        ) {\r\n                            // widget contains in activeWidgets should aligned at least once\r\n                            widget.enabled = false;\r\n                        }\r\n                        else {\r\n                            align(node, widget);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                // loop reversely will not help to prevent out of sync\r\n                // because user may remove more than one item during a step.\r\n                for (iterator.i = 0; iterator.i < activeWidgets.length; ++iterator.i) {\r\n                    widget = activeWidgets[iterator.i];\r\n                    align(widget.node, widget);\r\n                }\r\n            }\r\n        }\r\n        widgetManager.isAligning = false;\r\n    }\r\n\r\n    // check animation editor\r\n    if (CC_EDITOR) {\r\n        animationState.animatedSinceLastFrame = false;\r\n    }\r\n}\r\n\r\nvar adjustWidgetToAllowMovingInEditor = CC_EDITOR && function (oldPos) {\r\n    if (widgetManager.isAligning) {\r\n        return;\r\n    }\r\n    var newPos = this.node.position;\r\n    var delta = newPos.sub(oldPos);\r\n\r\n    var target = this.node._parent;\r\n    var inverseScale = cc.Vec2.ONE;\r\n\r\n    if (this._target) {\r\n        target = this._target;\r\n        computeInverseTransForTarget(this.node, target, new cc.Vec2(), inverseScale);\r\n    }\r\n\r\n    var targetSize = getReadonlyNodeSize(target);\r\n    var deltaInPercent;\r\n    if (targetSize.width !== 0 && targetSize.height !== 0) {\r\n        deltaInPercent = new cc.Vec2(delta.x / targetSize.width, delta.y / targetSize.height);\r\n    }\r\n    else {\r\n        deltaInPercent = cc.Vec2.ZERO;\r\n    }\r\n\r\n    if (this.isAlignTop) {\r\n        this.top -= (this.isAbsoluteTop ? delta.y : deltaInPercent.y) * inverseScale.y;\r\n    }\r\n    if (this.isAlignBottom) {\r\n        this.bottom += (this.isAbsoluteBottom ? delta.y : deltaInPercent.y) * inverseScale.y;\r\n    }\r\n    if (this.isAlignLeft) {\r\n        this.left += (this.isAbsoluteLeft ? delta.x : deltaInPercent.x) * inverseScale.x;\r\n    }\r\n    if (this.isAlignRight) {\r\n        this.right -= (this.isAbsoluteRight ? delta.x : deltaInPercent.x) * inverseScale.x;\r\n    }\r\n    if (this.isAlignHorizontalCenter) {\r\n        this.horizontalCenter += (this.isAbsoluteHorizontalCenter ? delta.x : deltaInPercent.x) * inverseScale.x;\r\n    }\r\n    if (this.isAlignVerticalCenter) {\r\n        this.verticalCenter += (this.isAbsoluteVerticalCenter ? delta.y : deltaInPercent.y) * inverseScale.y;\r\n    }\r\n};\r\n\r\nvar adjustWidgetToAllowResizingInEditor = CC_EDITOR && function (oldSize) {\r\n    if (widgetManager.isAligning) {\r\n        return;\r\n    }\r\n    var newSize = this.node.getContentSize();\r\n    var delta = cc.v2(newSize.width - oldSize.width, newSize.height - oldSize.height);\r\n\r\n    var target = this.node._parent;\r\n    var inverseScale = cc.Vec2.ONE;\r\n    if (this._target) {\r\n        target = this._target;\r\n        computeInverseTransForTarget(this.node, target, new cc.Vec2(), inverseScale);\r\n    }\r\n\r\n    var targetSize = getReadonlyNodeSize(target);\r\n    var deltaInPercent;\r\n    if (targetSize.width !== 0 && targetSize.height !== 0) {\r\n        deltaInPercent = new cc.Vec2(delta.x / targetSize.width, delta.y / targetSize.height);\r\n    }\r\n    else {\r\n        deltaInPercent = cc.Vec2.ZERO;\r\n    }\r\n\r\n    var anchor = this.node._anchorPoint;\r\n\r\n    if (this.isAlignTop) {\r\n        this.top -= (this.isAbsoluteTop ? delta.y : deltaInPercent.y) * (1 - anchor.y) * inverseScale.y;\r\n    }\r\n    if (this.isAlignBottom) {\r\n        this.bottom -= (this.isAbsoluteBottom ? delta.y : deltaInPercent.y) * anchor.y * inverseScale.y;\r\n    }\r\n    if (this.isAlignLeft) {\r\n        this.left -= (this.isAbsoluteLeft ? delta.x : deltaInPercent.x) * anchor.x * inverseScale.x;\r\n    }\r\n    if (this.isAlignRight) {\r\n        this.right -= (this.isAbsoluteRight ? delta.x : deltaInPercent.x) * (1 - anchor.x) * inverseScale.x;\r\n    }\r\n};\r\n\r\nvar activeWidgets = [];\r\n\r\n// updateAlignment from scene to node recursively\r\nfunction updateAlignment (node) {\r\n    var parent = node._parent;\r\n    if (cc.Node.isNode(parent)) {\r\n        updateAlignment(parent);\r\n    }\r\n    var widget = node._widget ||\r\n                 node.getComponent(cc.Widget);  // node._widget will be null when widget is disabled\r\n    if (widget && parent) {\r\n        align(node, widget);\r\n    }\r\n}\r\n\r\nvar widgetManager = cc._widgetManager = module.exports = {\r\n    _AlignFlags: {\r\n        TOP: TOP,\r\n        MID: MID,       // vertical center\r\n        BOT: BOT,\r\n        LEFT: LEFT,\r\n        CENTER: CENTER, // horizontal center\r\n        RIGHT: RIGHT\r\n    },\r\n    isAligning: false,\r\n    _nodesOrderDirty: false,\r\n    _activeWidgetsIterator: new cc.js.array.MutableForwardIterator(activeWidgets),\r\n\r\n    init: function (director) {\r\n        director.on(cc.Director.EVENT_AFTER_UPDATE, refreshScene);\r\n\r\n        if (CC_EDITOR && cc.engine) {\r\n            cc.engine.on('design-resolution-changed', this.onResized.bind(this));\r\n        }\r\n        else {\r\n            if (cc.sys.isMobile) {\r\n                window.addEventListener('resize', this.onResized.bind(this));\r\n            }\r\n            else {\r\n                cc.view.on('canvas-resize', this.onResized, this);\r\n            }\r\n        }\r\n    },\r\n    add: function (widget) {\r\n        widget.node._widget = widget;\r\n        this._nodesOrderDirty = true;\r\n        if (CC_EDITOR && !cc.engine.isPlaying) {\r\n            widget.node.on(Event.POSITION_CHANGED, adjustWidgetToAllowMovingInEditor, widget);\r\n            widget.node.on(Event.SIZE_CHANGED, adjustWidgetToAllowResizingInEditor, widget);\r\n        }\r\n    },\r\n    remove: function (widget) {\r\n        widget.node._widget = null;\r\n        this._activeWidgetsIterator.remove(widget);\r\n        if (CC_EDITOR && !cc.engine.isPlaying) {\r\n            widget.node.off(Event.POSITION_CHANGED, adjustWidgetToAllowMovingInEditor, widget);\r\n            widget.node.off(Event.SIZE_CHANGED, adjustWidgetToAllowResizingInEditor, widget);\r\n        }\r\n    },\r\n    onResized () {\r\n        var scene = cc.director.getScene();\r\n        if (scene) {\r\n            this.refreshWidgetOnResized(scene);\r\n        }\r\n    },\r\n    refreshWidgetOnResized (node) {\r\n        var widget = cc.Node.isNode(node) && node.getComponent(cc.Widget);\r\n        if (widget) {\r\n            if (widget.alignMode === AlignMode.ON_WINDOW_RESIZE) {\r\n                widget.enabled = true;\r\n            }\r\n        }\r\n\r\n        var children = node._children;\r\n        for (var i = 0; i < children.length; i++) {\r\n            var child = children[i];\r\n            this.refreshWidgetOnResized(child);\r\n        }\r\n    },\r\n    updateAlignment: updateAlignment,\r\n    AlignMode: AlignMode,\r\n};\r\n\r\nif (CC_EDITOR) {\r\n    module.exports._computeInverseTransForTarget = computeInverseTransForTarget;\r\n    module.exports._getReadonlyNodeSize = getReadonlyNodeSize;\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst AffineTrans = require('../utils/affine-transform');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst renderer = require('../renderer/index');\r\nconst game = require('../CCGame');\r\nconst ray = require('../3d/geom-utils/ray');\r\n\r\nconst mat4 = cc.vmath.mat4;\r\nconst vec2 = cc.vmath.vec2;\r\nconst vec3 = cc.vmath.vec3;\r\n\r\nlet _mat4_temp_1 = mat4.create();\r\nlet _mat4_temp_2 = mat4.create();\r\n\r\nlet _v3_temp_1 = vec3.create();\r\nlet _v3_temp_2 = vec3.create();\r\nlet _v3_temp_3 = vec3.create();\r\n\r\nlet _cameras = [];\r\n\r\nlet _debugCamera = null;\r\n\r\nfunction repositionDebugCamera () {\r\n    if (!_debugCamera) return;\r\n\r\n    let node = _debugCamera._node;\r\n    let canvas = cc.game.canvas;\r\n    node.z = canvas.height / 1.1566;\r\n    node.x = canvas.width / 2;\r\n    node.y = canvas.height / 2;\r\n}\r\n\r\n/**\r\n * !#en Values for Camera.clearFlags, determining what to clear when rendering a Camera.\r\n * !#zh \r\n * @enum Camera.ClearFlags\r\n */\r\nlet ClearFlags = cc.Enum({\r\n    /**\r\n     * @property COLOR\r\n     */\r\n    COLOR: 1,\r\n    /**\r\n     * @property DEPTH\r\n     */\r\n    DEPTH: 2,\r\n    /**\r\n     * @property STENCIL\r\n     */\r\n    STENCIL: 4,\r\n});\r\n\r\n/**\r\n * !#en\r\n * Camera is usefull when making reel game or other games which need scroll screen.\r\n * Using camera will be more efficient than moving node to scroll screen.\r\n * Camera \r\n * !#zh\r\n * \r\n * @class Camera\r\n * @extends Component\r\n */\r\nlet Camera = cc.Class({\r\n    name: 'cc.Camera',\r\n    extends: cc.Component,\r\n\r\n    ctor () {\r\n        if (game.renderType !== game.RENDER_TYPE_CANVAS) {\r\n            let camera = new renderEngine.Camera();\r\n\r\n            camera.setStages([\r\n                'transparent'\r\n            ]);\r\n\r\n            let view = new renderEngine.View();\r\n            camera.view = view;\r\n            camera.dirty = true;\r\n\r\n            this._inited = false;\r\n            this._camera = camera;\r\n        }\r\n        else {\r\n            this._inited = true;\r\n        }\r\n    },\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.others/Camera',\r\n        inspector: 'packages://inspector/inspectors/comps/camera.js',\r\n        executeInEditMode: false\r\n    },\r\n\r\n    properties: {\r\n        _cullingMask: 0xffffffff,\r\n        _clearFlags: ClearFlags.DEPTH | ClearFlags.STENCIL,\r\n        _backgroundColor: cc.color(0, 0, 0, 255),\r\n        _depth: 0,\r\n        _zoomRatio: 1,\r\n        _targetTexture: null,\r\n        _fov: 60,\r\n        _orthoSize: 10,\r\n        _nearClip: 0.1,\r\n        _farClip: 4096,\r\n        _ortho: true,\r\n        _rect: cc.rect(0, 0, 1, 1),\r\n\r\n        /**\r\n         * !#en\r\n         * The camera zoom ratio.\r\n         * !#zh\r\n         * \r\n         * @property {Number} zoomRatio\r\n         */\r\n        zoomRatio: {\r\n            get () {\r\n                return this._zoomRatio;\r\n            },\r\n            set (value) {\r\n                this._zoomRatio = value;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Field of view. The width of the Cameras view angle, measured in degrees along the local Y axis.\r\n         * !#zh\r\n         * \r\n         * @property {Number} fov\r\n         * @default 60\r\n         */\r\n        fov: {\r\n            get () {\r\n                return this._fov;\r\n            },\r\n            set (v) {\r\n                this._fov = v;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The viewport size of the Camera when set to orthographic projection.\r\n         * !#zh\r\n         * \r\n         * @property {Number} orthoSize\r\n         * @default 10\r\n         */\r\n        orthoSize: {\r\n            get () {\r\n                return this._orthoSize;\r\n            },\r\n            set (v) {\r\n                this._orthoSize = v;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The near clipping plane.\r\n         * !#zh\r\n         * \r\n         * @property {Number} nearClip\r\n         * @default 0.1\r\n         */\r\n        nearClip: {\r\n            get () {\r\n                return this._nearClip;\r\n            },\r\n            set (v) {\r\n                this._nearClip = v;\r\n                this._updateClippingpPlanes();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The far clipping plane.\r\n         * !#zh\r\n         * \r\n         * @property {Number} farClip\r\n         * @default 4096\r\n         */\r\n        farClip: {\r\n            get () {\r\n                return this._farClip;\r\n            },\r\n            set (v) {\r\n                this._farClip = v;\r\n                this._updateClippingpPlanes();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Is the camera orthographic (true) or perspective (false)?\r\n         * !#zh\r\n         * \r\n         * @property {Boolean} ortho\r\n         * @default false\r\n         */\r\n        ortho: {\r\n            get () {\r\n                return this._ortho;\r\n            },\r\n            set (v) {\r\n                this._ortho = v;\r\n                this._updateProjection();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Four values (0-1) that indicate where on the screen this camera view will be drawn.\r\n         * !#zh\r\n         *  0-1\r\n         * @property {Rect} rect\r\n         * @default cc.rect(0,0,1,1)\r\n         */\r\n        rect: {\r\n            get () {\r\n                return this._rect;\r\n            },\r\n            set (v) {\r\n                this._rect = v;\r\n                this._updateRect();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * This is used to render parts of the scene selectively.\r\n         * !#zh\r\n         * \r\n         * @property {Number} cullingMask\r\n         */\r\n        cullingMask: {\r\n            get () {\r\n                return this._cullingMask;\r\n            },\r\n            set (value) {\r\n                this._cullingMask = value;\r\n                this._updateCameraMask();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Determining what to clear when camera rendering.\r\n         * !#zh\r\n         * \r\n         * @property {Camera.ClearFlags} clearFlags\r\n         */\r\n        clearFlags: {\r\n            get () {\r\n                return this._clearFlags;\r\n            },\r\n            set (value) {\r\n                this._clearFlags = value;\r\n                if (this._camera) {\r\n                    this._camera.setClearFlags(value);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The color with which the screen will be cleared.\r\n         * !#zh\r\n         * \r\n         * @property {Color} backgroundColor\r\n         */\r\n        backgroundColor: {\r\n            get () {\r\n                return this._backgroundColor;\r\n            },\r\n            set (value) {\r\n                this._backgroundColor = value;\r\n                this._updateBackgroundColor();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Camera's depth in the camera rendering order.\r\n         * !#zh\r\n         * \r\n         * @property {Number} depth\r\n         */\r\n        depth: {\r\n            get () {\r\n                return this._depth;\r\n            },\r\n            set (value) {\r\n                this._depth = value;\r\n                if (this._camera) {\r\n                    this._camera._sortDepth = value;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Destination render texture.\r\n         * Usually cameras render directly to screen, but for some effects it is useful to make a camera render into a texture.\r\n         * !#zh\r\n         *  RenderTexture\r\n         *  RenderTexture  RenderTexture \r\n         * @property {RenderTexture} targetTexture\r\n         */\r\n        targetTexture: {\r\n            get () {\r\n                return this._targetTexture;\r\n            },\r\n            set (value) {\r\n                this._targetTexture = value;\r\n                this._updateTargetTexture();\r\n            }\r\n        },\r\n\r\n        _is3D: {\r\n            get () {\r\n                return this.node._is3DNode;\r\n            }\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        /**\r\n         * !#en\r\n         * The first enabled camera.\r\n         * !#zh\r\n         * \r\n         * @property {Camera} main\r\n         * @static\r\n         */\r\n        main: null,\r\n\r\n        /**\r\n         * !#en\r\n         * All enabled cameras.\r\n         * !#zh\r\n         * \r\n         * @property {[Camera]} cameras\r\n         * @static\r\n         */\r\n        cameras: _cameras,\r\n\r\n        ClearFlags: ClearFlags,\r\n\r\n        /**\r\n         * !#en\r\n         * Get the first camera which the node belong to.\r\n         * !#zh\r\n         * \r\n         * @method findCamera\r\n         * @param {Node} node \r\n         * @return {Camera}\r\n         * @static\r\n         */\r\n        findCamera (node) {\r\n            for (let i = 0, l = _cameras.length; i < l; i++) {\r\n                let camera = _cameras[i];\r\n                if (camera.containsNode(node)) {\r\n                    return camera;\r\n                }\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        _setupDebugCamera () {\r\n            if (_debugCamera) return;\r\n            if (game.renderType === game.RENDER_TYPE_CANVAS) return;\r\n            let camera = new renderEngine.Camera();\r\n            _debugCamera = camera;\r\n\r\n            camera.setStages([\r\n                'transparent'\r\n            ]);\r\n\r\n            camera.setFov(Math.PI * 60 / 180);\r\n            camera.setNear(0.1);\r\n            camera.setFar(4096);\r\n\r\n            let view = new renderEngine.View();\r\n            camera.view = view;\r\n            camera.dirty = true;\r\n\r\n            camera._cullingMask = camera.view._cullingMask = 1 << cc.Node.BuiltinGroupIndex.DEBUG;\r\n            camera._sortDepth = cc.macro.MAX_ZINDEX;\r\n            camera.setClearFlags(0);\r\n            camera.setColor(0, 0, 0, 0);\r\n\r\n            let node = new cc.Node();\r\n            camera.setNode(node);\r\n\r\n            repositionDebugCamera();\r\n            cc.view.on('design-resolution-changed', repositionDebugCamera);\r\n\r\n            renderer.scene.addCamera(camera);\r\n        }\r\n    },\r\n\r\n    _updateCameraMask () {\r\n        if (this._camera) {\r\n            let mask = this._cullingMask & (~(1 << cc.Node.BuiltinGroupIndex.DEBUG));\r\n            this._camera._cullingMask = mask;\r\n            this._camera.view._cullingMask = mask;\r\n        }\r\n    },\r\n\r\n    _updateBackgroundColor () {\r\n        if (!this._camera) return;\r\n\r\n        let color = this._backgroundColor;\r\n        this._camera.setColor(\r\n            color.r / 255,\r\n            color.g / 255,\r\n            color.b / 255,\r\n            color.a / 255,\r\n        );\r\n    },\r\n\r\n    _updateTargetTexture () {\r\n        if (!this._camera) return;\r\n\r\n        let texture = this._targetTexture;\r\n        this._camera._framebuffer = texture ? texture._framebuffer : null;\r\n    },\r\n\r\n    _updateClippingpPlanes () {\r\n        if (!this._camera) return;\r\n        this._camera.setNear(this._nearClip);\r\n        this._camera.setFar(this._farClip);\r\n    },\r\n\r\n    _updateProjection () {\r\n        if (!this._camera) return;\r\n        let type = this._ortho ? 1 : 0;\r\n        this._camera.setType(type);\r\n    },\r\n\r\n    _updateRect () {\r\n        if (!this._camera) return;\r\n        this._camera.setRect(this._rect);\r\n    },\r\n\r\n    _init () {\r\n        if (this._inited) return;\r\n        this._inited = true;\r\n\r\n        let camera = this._camera;\r\n        if (!camera) return;\r\n        camera.setNode(this.node);\r\n        camera.setClearFlags(this._clearFlags);\r\n        camera._sortDepth = this._depth;\r\n        this._updateBackgroundColor();\r\n        this._updateCameraMask();\r\n        this._updateTargetTexture();\r\n        this._updateClippingpPlanes();\r\n        this._updateProjection();\r\n    },\r\n\r\n    onLoad () {\r\n        this._init();\r\n    },\r\n\r\n    onEnable () {\r\n        if (game.renderType !== game.RENDER_TYPE_CANVAS) {\r\n            cc.director.on(cc.Director.EVENT_BEFORE_DRAW, this.beforeDraw, this);\r\n            renderer.scene.addCamera(this._camera);\r\n        }\r\n        _cameras.push(this);\r\n    },\r\n\r\n    onDisable () {\r\n        if (game.renderType !== game.RENDER_TYPE_CANVAS) {\r\n            cc.director.off(cc.Director.EVENT_BEFORE_DRAW, this.beforeDraw, this);\r\n            renderer.scene.removeCamera(this._camera);\r\n        }\r\n        cc.js.array.remove(_cameras, this);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the matrix that transform the node's (local) space coordinates into the camera's space coordinates.\r\n     * !#zh\r\n     * \r\n     * @method getNodeToCameraTransform\r\n     * @param {Node} node - the node which should transform\r\n     * @return {AffineTransform}\r\n     */\r\n    getNodeToCameraTransform (node) {\r\n        let out = AffineTrans.identity();\r\n        node.getWorldMatrix(_mat4_temp_2);\r\n        if (this.containsNode(node)) {\r\n            this.getWorldToCameraMatrix(_mat4_temp_1);\r\n            mat4.mul(_mat4_temp_2, _mat4_temp_2, _mat4_temp_1);\r\n        }\r\n        AffineTrans.fromMat4(out, _mat4_temp_2);\r\n        return out;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Conver a camera coordinates point to world coordinates.\r\n     * !#zh\r\n     * \r\n     * @method getCameraToWorldPoint\r\n     * @param {Vec2} point - the point which should transform\r\n     * @param {Vec2} out - the point to receive the result\r\n     * @return {Vec2}\r\n     */\r\n    getCameraToWorldPoint (point, out) {\r\n        out = out || cc.v2();\r\n        this.getCameraToWorldMatrix(_mat4_temp_1);\r\n        vec2.transformMat4(out, point, _mat4_temp_1);\r\n        return out;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Conver a world coordinates point to camera coordinates.\r\n     * !#zh\r\n     * \r\n     * @method getWorldToCameraPoint\r\n     * @param {Vec2} point \r\n     * @param {Vec2} out - the point to receive the result\r\n     * @return {Vec2}\r\n     */\r\n    getWorldToCameraPoint (point, out) {\r\n        out = out || cc.v2();\r\n        this.getWorldToCameraMatrix(_mat4_temp_1);\r\n        vec2.transformMat4(out, point, _mat4_temp_1);\r\n        return out;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Get the camera to world matrix\r\n     * !#zh\r\n     * \r\n     * @method getCameraToWorldMatrix\r\n     * @param {Mat4} out - the matrix to receive the result\r\n     * @return {Mat4}\r\n     */\r\n    getCameraToWorldMatrix (out) {\r\n        this.getWorldToCameraMatrix(out);\r\n        mat4.invert(out, out);\r\n        return out;\r\n    },\r\n\r\n\r\n    /**\r\n     * !#en\r\n     * Get the world to camera matrix\r\n     * !#zh\r\n     * \r\n     * @method getWorldToCameraMatrix\r\n     * @param {Mat4} out - the matrix to receive the result\r\n     * @return {Mat4}\r\n     */\r\n    getWorldToCameraMatrix (out) {\r\n        this.node.getWorldRT(_mat4_temp_1);\r\n\r\n        let zoomRatio = this.zoomRatio;\r\n        _mat4_temp_1.m00 *= zoomRatio;\r\n        _mat4_temp_1.m01 *= zoomRatio;\r\n        _mat4_temp_1.m04 *= zoomRatio;\r\n        _mat4_temp_1.m05 *= zoomRatio;\r\n\r\n        let m12 = _mat4_temp_1.m12;\r\n        let m13 = _mat4_temp_1.m13;\r\n\r\n        let center = cc.visibleRect.center;\r\n        _mat4_temp_1.m12 = center.x - (_mat4_temp_1.m00 * m12 + _mat4_temp_1.m04 * m13);\r\n        _mat4_temp_1.m13 = center.y - (_mat4_temp_1.m01 * m12 + _mat4_temp_1.m05 * m13);\r\n\r\n        if (out !== _mat4_temp_1) {\r\n            mat4.copy(out, _mat4_temp_1);\r\n        }\r\n        return out;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Get a ray from screen position\r\n     * !#zh\r\n     * \r\n     * @method getRay\r\n     * @param {Vec2} screenPos\r\n     * @return {Ray}\r\n     */\r\n    getRay (screenPos) {\r\n        if (!ray) return screenPos;\r\n        \r\n        vec3.set(_v3_temp_3, screenPos.x, screenPos.y, 1);\r\n        this._camera.screenToWorld(_v3_temp_2, _v3_temp_3, cc.visibleRect.width, cc.visibleRect.height);\r\n\r\n        if (this.ortho) {\r\n            vec3.set(_v3_temp_3, screenPos.x, screenPos.y, -1);\r\n            this._camera.screenToWorld(_v3_temp_1, _v3_temp_3, cc.visibleRect.width, cc.visibleRect.height);\r\n        }\r\n        else {\r\n            this.node.getWorldPosition(_v3_temp_1);\r\n        }\r\n\r\n        return ray.fromPoints(ray.create(), _v3_temp_1, _v3_temp_2);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Check whether the node is in the camera.\r\n     * !#zh\r\n     * \r\n     * @method containsNode\r\n     * @param {Node} node - the node which need to check\r\n     * @return {Boolean}\r\n     */\r\n    containsNode (node) {\r\n        return node._cullingMask & this.cullingMask;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Render the camera manually.\r\n     * !#zh\r\n     * \r\n     * @method render\r\n     * @param {Node} root \r\n     */\r\n    render (root) {\r\n        root = root || cc.director.getScene();\r\n        if (!root) return null;\r\n\r\n        // force update node world matrix\r\n        this.node.getWorldMatrix(_mat4_temp_1);\r\n        this.beforeDraw();\r\n        renderer._walker.visit(root);\r\n        renderer._forward.renderCamera(this._camera, renderer.scene);\r\n    },\r\n\r\n    _layout () {\r\n        let height = cc.game.canvas.height / cc.view._scaleY;\r\n\r\n        let targetTexture = this._targetTexture;\r\n        if (targetTexture) {\r\n            height = targetTexture.height;\r\n        }\r\n\r\n        let fov = this._fov * cc.macro.RAD;\r\n        this.node.z = height / (Math.tan(fov / 2) * 2);\r\n\r\n        fov = Math.atan(Math.tan(fov / 2) / this.zoomRatio) * 2;\r\n        this._camera.setFov(fov);\r\n        this._camera.setOrthoHeight(height / 2 / this.zoomRatio);\r\n    },\r\n\r\n    beforeDraw () {\r\n        if (!this._camera) return;\r\n\r\n        if (!this.node._is3DNode) {\r\n            this._layout();\r\n        }\r\n        else {\r\n            this._camera.setFov(this._fov * cc.macro.RAD);\r\n            this._camera.setOrthoHeight(this._orthoSize);\r\n        }\r\n\r\n        this._camera.dirty = true;\r\n    }\r\n});\r\n\r\nmodule.exports = cc.Camera = Camera;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./platform/CCClass');\r\nvar Flags = require('./platform/CCObject').Flags;\r\nvar jsArray = require('./platform/js').array;\r\n\r\nvar IsStartCalled = Flags.IsStartCalled;\r\nvar IsOnEnableCalled = Flags.IsOnEnableCalled;\r\nvar IsEditorOnEnableCalled = Flags.IsEditorOnEnableCalled;\r\n\r\nvar callerFunctor = CC_EDITOR && require('./utils/misc').tryCatchFunctor_EDITOR;\r\nvar callOnEnableInTryCatch = CC_EDITOR && callerFunctor('onEnable');\r\nvar callStartInTryCatch = CC_EDITOR && callerFunctor('start', null, 'target._objFlags |= ' + IsStartCalled);\r\nvar callUpdateInTryCatch = CC_EDITOR && callerFunctor('update', 'dt');\r\nvar callLateUpdateInTryCatch = CC_EDITOR && callerFunctor('lateUpdate', 'dt');\r\nvar callOnDisableInTryCatch = CC_EDITOR && callerFunctor('onDisable');\r\n\r\nvar callStart = CC_SUPPORT_JIT ? 'c.start();c._objFlags|=' + IsStartCalled : function (c) {\r\n    c.start();\r\n    c._objFlags |= IsStartCalled;\r\n};\r\nvar callUpdate = CC_SUPPORT_JIT ? 'c.update(dt)' : function (c, dt) {\r\n    c.update(dt);\r\n};\r\nvar callLateUpdate = CC_SUPPORT_JIT ? 'c.lateUpdate(dt)' : function (c, dt) {\r\n    c.lateUpdate(dt);\r\n};\r\n\r\nfunction sortedIndex (array, comp) {\r\n    var order = comp.constructor._executionOrder;\r\n    var id = comp._id;\r\n    for (var l = 0, h = array.length - 1, m = h >>> 1;\r\n         l <= h;\r\n         m = (l + h) >>> 1\r\n    ) {\r\n        var test = array[m];\r\n        var testOrder = test.constructor._executionOrder;\r\n        if (testOrder > order) {\r\n            h = m - 1;\r\n        }\r\n        else if (testOrder < order) {\r\n            l = m + 1;\r\n        }\r\n        else {\r\n            var testId = test._id;\r\n            if (testId > id) {\r\n                h = m - 1;\r\n            }\r\n            else if (testId < id) {\r\n                l = m + 1;\r\n            }\r\n            else {\r\n                return m;\r\n            }\r\n        }\r\n    }\r\n    return ~l;\r\n}\r\n\r\n// remove disabled and not invoked component from array\r\nfunction stableRemoveInactive (iterator, flagToClear) {\r\n    var array = iterator.array;\r\n    var next = iterator.i + 1;\r\n    while (next < array.length) {\r\n        var comp = array[next];\r\n        if (comp._enabled && comp.node._activeInHierarchy) {\r\n            ++next;\r\n        }\r\n        else {\r\n            iterator.removeAt(next);\r\n            if (flagToClear) {\r\n                comp._objFlags &= ~flagToClear;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// This class contains some queues used to invoke life-cycle methods by script execution order\r\nvar LifeCycleInvoker = cc.Class({\r\n    __ctor__ (invokeFunc) {\r\n        var Iterator = jsArray.MutableForwardIterator;\r\n        // components which priority === 0 (default)\r\n        this._zero = new Iterator([]);\r\n        // components which priority < 0\r\n        this._neg = new Iterator([]);\r\n        // components which priority > 0\r\n        this._pos = new Iterator([]);\r\n\r\n        if (CC_TEST) {\r\n            cc.assert(typeof invokeFunc === 'function', 'invokeFunc must be type function');\r\n        }\r\n        this._invoke = invokeFunc;\r\n    },\r\n    statics: {\r\n        stableRemoveInactive\r\n    },\r\n    add: null,\r\n    remove: null,\r\n    invoke: null,\r\n});\r\n\r\nfunction compareOrder (a, b) {\r\n    return a.constructor._executionOrder - b.constructor._executionOrder;\r\n}\r\n\r\n// for onLoad: sort once all components registered, invoke once\r\nvar OneOffInvoker = cc.Class({\r\n    extends: LifeCycleInvoker,\r\n    add (comp) {\r\n        var order = comp.constructor._executionOrder;\r\n        (order === 0 ? this._zero : (order < 0 ? this._neg : this._pos)).array.push(comp);\r\n    },\r\n    remove (comp) {\r\n        var order = comp.constructor._executionOrder;\r\n        (order === 0 ? this._zero : (order < 0 ? this._neg : this._pos)).fastRemove(comp);\r\n    },\r\n    cancelInactive (flagToClear) {\r\n        stableRemoveInactive(this._zero, flagToClear);\r\n        stableRemoveInactive(this._neg, flagToClear);\r\n        stableRemoveInactive(this._pos, flagToClear);\r\n    },\r\n    invoke () {\r\n        var compsNeg = this._neg;\r\n        if (compsNeg.array.length > 0) {\r\n            compsNeg.array.sort(compareOrder);\r\n            this._invoke(compsNeg);\r\n            compsNeg.array.length = 0;\r\n        }\r\n\r\n        this._invoke(this._zero);\r\n        this._zero.array.length = 0;\r\n\r\n        var compsPos = this._pos;\r\n        if (compsPos.array.length > 0) {\r\n            compsPos.array.sort(compareOrder);\r\n            this._invoke(compsPos);\r\n            compsPos.array.length = 0;\r\n        }\r\n    },\r\n});\r\n\r\n// for update: sort every time new component registered, invoke many times\r\nvar ReusableInvoker = cc.Class({\r\n    extends: LifeCycleInvoker,\r\n    add (comp) {\r\n        var order = comp.constructor._executionOrder;\r\n        if (order === 0) {\r\n            this._zero.array.push(comp);\r\n        }\r\n        else {\r\n            var array = order < 0 ? this._neg.array : this._pos.array;\r\n            var i = sortedIndex(array, comp);\r\n            if (i < 0) {\r\n                array.splice(~i, 0, comp);\r\n            }\r\n            else if (CC_DEV) {\r\n                cc.error('component already added');\r\n            }\r\n        }\r\n    },\r\n    remove (comp) {\r\n        var order = comp.constructor._executionOrder;\r\n        if (order === 0) {\r\n            this._zero.fastRemove(comp);\r\n        }\r\n        else {\r\n            var iterator = order < 0 ? this._neg : this._pos;\r\n            var i = sortedIndex(iterator.array, comp);\r\n            if (i >= 0) {\r\n                iterator.removeAt(i);\r\n            }\r\n        }\r\n    },\r\n    invoke (dt) {\r\n        if (this._neg.array.length > 0) {\r\n            this._invoke(this._neg, dt);\r\n        }\r\n\r\n        this._invoke(this._zero, dt);\r\n\r\n        if (this._pos.array.length > 0) {\r\n            this._invoke(this._pos, dt);\r\n        }\r\n    },\r\n});\r\n\r\nfunction enableInEditor (comp) {\r\n    if (!(comp._objFlags & IsEditorOnEnableCalled)) {\r\n        cc.engine.emit('component-enabled', comp.uuid);\r\n        comp._objFlags |= IsEditorOnEnableCalled;\r\n    }\r\n}\r\n\r\nfunction createInvokeImpl (funcOrCode, useDt) {\r\n    if (typeof funcOrCode === 'function') {\r\n        if (useDt) {\r\n            return function (iterator, dt) {\r\n                var array = iterator.array;\r\n                for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n                    var comp = array[iterator.i];\r\n                    funcOrCode(comp, dt);\r\n                }\r\n            };\r\n        }\r\n        else {\r\n            return function (iterator) {\r\n                var array = iterator.array;\r\n                for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n                    var comp = array[iterator.i];\r\n                    funcOrCode(comp);\r\n                }\r\n            };\r\n        }\r\n    }\r\n    else {\r\n        // function (it) {\r\n        //     var a = it.array;\r\n        //     for (it.i = 0; it.i < a.length; ++it.i) {\r\n        //         var comp = a[it.i];\r\n        //         // ...\r\n        //     }\r\n        // }\r\n        var body = 'var a=it.array;' +\r\n                   'for(it.i=0;it.i<a.length;++it.i){' +\r\n                   'var c=a[it.i];' +\r\n                   funcOrCode +\r\n                   '}';\r\n        if (useDt) {\r\n            return Function('it', 'dt', body);\r\n        }\r\n        else {\r\n            return Function('it', body);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * The Manager for Component's life-cycle methods.\r\n */\r\nfunction ctor () {\r\n    // invokers\r\n    this.startInvoker = new OneOffInvoker(createInvokeImpl(\r\n        CC_EDITOR ? callStartInTryCatch : callStart));\r\n    this.updateInvoker = new ReusableInvoker(createInvokeImpl(\r\n        CC_EDITOR ? callUpdateInTryCatch : callUpdate, true));\r\n    this.lateUpdateInvoker = new ReusableInvoker(createInvokeImpl(\r\n        CC_EDITOR ? callLateUpdateInTryCatch : callLateUpdate, true));\r\n\r\n    // components deferred to next frame\r\n    this.scheduleInNextFrame = [];\r\n\r\n    // during a loop\r\n    this._updating = false;\r\n}\r\nvar ComponentScheduler = cc.Class({\r\n    ctor: ctor,\r\n    unscheduleAll: ctor,\r\n\r\n    statics: {\r\n        LifeCycleInvoker,\r\n        OneOffInvoker,\r\n        createInvokeImpl,\r\n        invokeOnEnable: CC_EDITOR ? function (iterator) {\r\n            var compScheduler = cc.director._compScheduler;\r\n            var array = iterator.array;\r\n            for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n                let comp = array[iterator.i];\r\n                if (comp._enabled) {\r\n                    callOnEnableInTryCatch(comp);\r\n                    var deactivatedDuringOnEnable = !comp.node._activeInHierarchy;\r\n                    if (!deactivatedDuringOnEnable) {\r\n                        compScheduler._onEnabled(comp);\r\n                    }\r\n                }\r\n            }\r\n        } : function (iterator) {\r\n            var compScheduler = cc.director._compScheduler;\r\n            var array = iterator.array;\r\n            for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n                let comp = array[iterator.i];\r\n                if (comp._enabled) {\r\n                    comp.onEnable();\r\n                    var deactivatedDuringOnEnable = !comp.node._activeInHierarchy;\r\n                    if (!deactivatedDuringOnEnable) {\r\n                        compScheduler._onEnabled(comp);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    _onEnabled (comp) {\r\n        cc.director.getScheduler().resumeTarget(comp);\r\n        comp._objFlags |= IsOnEnableCalled;\r\n\r\n        // schedule\r\n        if (this._updating) {\r\n            this.scheduleInNextFrame.push(comp);\r\n        }\r\n        else {\r\n            this._scheduleImmediate(comp);\r\n        }\r\n    },\r\n\r\n    _onDisabled (comp) {\r\n        cc.director.getScheduler().pauseTarget(comp);\r\n        comp._objFlags &= ~IsOnEnableCalled;\r\n\r\n        // cancel schedule task\r\n        var index = this.scheduleInNextFrame.indexOf(comp);\r\n        if (index >= 0) {\r\n            jsArray.fastRemoveAt(this.scheduleInNextFrame, index);\r\n            return;\r\n        }\r\n\r\n        // unschedule\r\n        if (comp.start && !(comp._objFlags & IsStartCalled)) {\r\n            this.startInvoker.remove(comp);\r\n        }\r\n        if (comp.update) {\r\n            this.updateInvoker.remove(comp);\r\n        }\r\n        if (comp.lateUpdate) {\r\n            this.lateUpdateInvoker.remove(comp);\r\n        }\r\n    },\r\n\r\n    enableComp: CC_EDITOR ? function (comp, invoker) {\r\n        if (cc.engine.isPlaying || comp.constructor._executeInEditMode) {\r\n            if (!(comp._objFlags & IsOnEnableCalled)) {\r\n                if (comp.onEnable) {\r\n                    if (invoker) {\r\n                        invoker.add(comp);\r\n                        enableInEditor(comp);\r\n                        return;\r\n                    }\r\n                    else {\r\n                        callOnEnableInTryCatch(comp);\r\n\r\n                        var deactivatedDuringOnEnable = !comp.node._activeInHierarchy;\r\n                        if (deactivatedDuringOnEnable) {\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n                this._onEnabled(comp);\r\n            }\r\n        }\r\n        enableInEditor(comp);\r\n    } : function (comp, invoker) {\r\n        if (!(comp._objFlags & IsOnEnableCalled)) {\r\n            if (comp.onEnable) {\r\n                if (invoker) {\r\n                    invoker.add(comp);\r\n                    return;\r\n                }\r\n                else {\r\n                    comp.onEnable();\r\n\r\n                    var deactivatedDuringOnEnable = !comp.node._activeInHierarchy;\r\n                    if (deactivatedDuringOnEnable) {\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this._onEnabled(comp);\r\n        }\r\n    },\r\n\r\n    disableComp: CC_EDITOR ? function (comp) {\r\n        if (cc.engine.isPlaying || comp.constructor._executeInEditMode) {\r\n            if (comp._objFlags & IsOnEnableCalled) {\r\n                if (comp.onDisable) {\r\n                    callOnDisableInTryCatch(comp);\r\n                }\r\n                this._onDisabled(comp);\r\n            }\r\n        }\r\n        if (comp._objFlags & IsEditorOnEnableCalled) {\r\n            cc.engine.emit('component-disabled', comp.uuid);\r\n            comp._objFlags &= ~IsEditorOnEnableCalled;\r\n        }\r\n    } : function (comp) {\r\n        if (comp._objFlags & IsOnEnableCalled) {\r\n            if (comp.onDisable) {\r\n                comp.onDisable();\r\n            }\r\n            this._onDisabled(comp);\r\n        }\r\n    },\r\n\r\n    _scheduleImmediate (comp) {\r\n        if (comp.start && !(comp._objFlags & IsStartCalled)) {\r\n            this.startInvoker.add(comp);\r\n        }\r\n        if (comp.update) {\r\n            this.updateInvoker.add(comp);\r\n        }\r\n        if (comp.lateUpdate) {\r\n            this.lateUpdateInvoker.add(comp);\r\n        }\r\n    },\r\n\r\n    _deferredSchedule () {\r\n        var comps = this.scheduleInNextFrame;\r\n        for (var i = 0, len = comps.length; i < len; i++) {\r\n            var comp = comps[i];\r\n            this._scheduleImmediate(comp);\r\n        }\r\n        comps.length = 0;\r\n    },\r\n\r\n    startPhase () {\r\n        // Start of this frame\r\n        this._updating = true;\r\n\r\n        if (this.scheduleInNextFrame.length > 0) {\r\n            this._deferredSchedule();\r\n        }\r\n\r\n        // call start\r\n        this.startInvoker.invoke();\r\n        // if (CC_PREVIEW) {\r\n        //     try {\r\n        //         this.startInvoker.invoke();\r\n        //     }\r\n        //     catch (e) {\r\n        //         // prevent start from getting into infinite loop\r\n        //         this.startInvoker._neg.array.length = 0;\r\n        //         this.startInvoker._zero.array.length = 0;\r\n        //         this.startInvoker._pos.array.length = 0;\r\n        //         throw e;\r\n        //     }\r\n        // }\r\n        // else {\r\n        //     this.startInvoker.invoke();\r\n        // }\r\n    },\r\n\r\n    updatePhase (dt) {\r\n        this.updateInvoker.invoke(dt);\r\n    },\r\n\r\n    lateUpdatePhase (dt) {\r\n        this.lateUpdateInvoker.invoke(dt);\r\n\r\n        // End of this frame\r\n        this._updating = false;\r\n    }\r\n});\r\n\r\nmodule.exports = ComponentScheduler;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst AnimationAnimator = require('../../animation/animation-animator');\r\nconst AnimationClip = require('../../animation/animation-clip');\r\nconst EventTarget = require('../event/event-target');\r\nconst js = require('../platform/js');\r\n\r\nfunction equalClips (clip1, clip2) {\r\n    if (clip1 === clip2) {\r\n        return true;\r\n    }\r\n\r\n    return clip1 && clip2 && (clip1.name === clip2.name || clip1._uuid === clip2._uuid);\r\n}\r\n\r\n/**\r\n * !#en The event type supported by Animation\r\n * !#zh Animation \r\n * @class Animation.EventType\r\n * @static\r\n * @namespace Animationd\r\n */\r\nlet EventType = cc.Enum({\r\n    /**\r\n     * !#en Emit when begin playing animation\r\n     * !#zh \r\n     * @property {String} PLAY\r\n     * @static\r\n     */\r\n    PLAY: 'play',\r\n    /**\r\n     * !#en Emit when stop playing animation\r\n     * !#zh \r\n     * @property {String} STOP\r\n     * @static\r\n     */\r\n    STOP: 'stop',\r\n    /**\r\n     * !#en Emit when pause animation\r\n     * !#zh \r\n     * @property {String} PAUSE   \r\n     * @static\r\n     */\r\n    PAUSE: 'pause',\r\n    /**\r\n     * !#en Emit when resume animation\r\n     * !#zh \r\n     * @property {String} RESUME\r\n     * @static\r\n     */\r\n    RESUME: 'resume',\r\n    /**\r\n     * !#en If animation repeat count is larger than 1, emit when animation play to the last frame\r\n     * !#zh  1\r\n     * @property {String} LASTFRAME\r\n     * @static\r\n     */\r\n    LASTFRAME: 'lastframe',\r\n    /**\r\n     * !#en Emit when finish playing animation\r\n     * !#zh \r\n     * @property {String} FINISHED\r\n     * @static\r\n     */\r\n    FINISHED: 'finished'\r\n});\r\n\r\n/**\r\n * !#en The animation component is used to play back animations.\r\n *   \r\n * Animation provide several events to register\r\n *  - play : Emit when begin playing animation\r\n *  - stop : Emit when stop playing animation\r\n *  - pause : Emit when pause animation\r\n *  - resume : Emit when resume animation\r\n *  - lastframe : If animation repeat count is larger than 1, emit when animation play to the last frame\r\n *  - finished : Emit when finish playing animation\r\n *\r\n * !#zh Animation \r\n *   \r\n * Animation \r\n *  - play : \r\n *  - stop : \r\n *  - pause : \r\n *  - resume : \r\n *  - lastframe :  1\r\n *  - finished : \r\n * \r\n * @class Animation\r\n * @extends Component\r\n * @uses EventTarget\r\n */\r\nlet Animation = cc.Class({\r\n    name: 'cc.Animation',\r\n    extends: require('./CCComponent'),\r\n    mixins: [EventTarget],\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.others/Animation',\r\n        help: 'i18n:COMPONENT.help_url.animation',\r\n        executeInEditMode: true,\r\n    },\r\n\r\n    statics: {\r\n        EventType\r\n    },\r\n\r\n    ctor: function () {\r\n        cc.EventTarget.call(this);\r\n\r\n        // The actual implement for Animation\r\n        this._animator = null;\r\n\r\n        this._nameToState = js.createMap(true);\r\n        this._didInit = false;\r\n\r\n        this._currentClip = null;\r\n    },\r\n\r\n    properties: {\r\n\r\n        _defaultClip: {\r\n            default: null,\r\n            type: AnimationClip,\r\n        },\r\n\r\n        /**\r\n         * !#en Animation will play the default clip when start game.\r\n         * !#zh  play() \r\n         * @property defaultClip\r\n         * @type {AnimationClip}\r\n         */\r\n        defaultClip: {\r\n            type: AnimationClip,\r\n            get: function () {\r\n                return this._defaultClip;\r\n            },\r\n            set: function (value) {\r\n                if (!CC_EDITOR || (cc.engine && cc.engine.isPlaying)) {\r\n                    return;\r\n                }\r\n\r\n                this._defaultClip = value;\r\n\r\n                if (!value) {\r\n                    return;\r\n                }\r\n\r\n                let clips = this._clips;\r\n\r\n                for (let i = 0, l = clips.length; i < l; i++) {\r\n                    if (equalClips(value, clips[i])) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                this.addClip(value);\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.animation.default_clip'\r\n        },\r\n\r\n        /**\r\n         * !#en Current played clip.\r\n         * !#zh \r\n         * @property currentClip\r\n         * @type {AnimationClip}\r\n         */\r\n        currentClip: {\r\n            get: function () {\r\n                return this._currentClip;\r\n            },\r\n            set: function (value) {\r\n                this._currentClip = value;\r\n            },\r\n            type: AnimationClip,\r\n            visible: false\r\n        },\r\n\r\n        /**\r\n         * !#en All the clips used in this animation.\r\n         * !#zh  AnimationClip \r\n         * @property _clips\r\n         * @type {AnimationClip[]}\r\n         * @private\r\n         */\r\n        _clips: {\r\n            default: [],\r\n            type: [AnimationClip],\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.animation.clips',\r\n            visible: true\r\n        },\r\n\r\n        /**\r\n         * !#en Whether the animation should auto play the default clip when start game.\r\n         * !#zh \r\n         * @property playOnLoad\r\n         * @type {Boolean}\r\n         * @default true\r\n         */\r\n        playOnLoad: {\r\n            default: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.animation.play_on_load'\r\n        }\r\n    },\r\n\r\n    start: function () {\r\n        if (!CC_EDITOR && this.playOnLoad && this._defaultClip) {\r\n            let isPlaying = this._animator && this._animator.isPlaying;\r\n            if (!isPlaying) {\r\n                let state = this.getAnimationState(this._defaultClip.name);\r\n                this._animator.playState(state);\r\n            }\r\n        }\r\n    },\r\n\r\n    onEnable: function () {\r\n        if (this._animator) {\r\n            this._animator.resume();\r\n        }\r\n    },\r\n\r\n    onDisable: function () {\r\n        if (this._animator) {\r\n            this._animator.pause();\r\n        }\r\n    },\r\n\r\n    onDestroy: function () {\r\n        this.stop();\r\n    },\r\n\r\n    ///////////////////////////////////////////////////////////////////////////////\r\n    // Public Methods\r\n    ///////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     * !#en Get all the clips used in this animation.\r\n     * !#zh \r\n     * @method getClips\r\n     * @return {AnimationClip[]}\r\n     */\r\n    getClips: function () {\r\n        return this._clips;\r\n    },\r\n\r\n    /**\r\n     * !#en Plays an animation and stop other animations.\r\n     * !#zh \r\n     * @method play\r\n     * @param {String} [name] - The name of animation to play. If no name is supplied then the default animation will be played.\r\n     * @param {Number} [startTime] - play an animation from startTime\r\n     * @return {AnimationState} - The AnimationState of playing animation. In cases where the animation can't be played (ie, there is no default animation or no animation with the specified name), the function will return null.\r\n     * @example\r\n     * var animCtrl = this.node.getComponent(cc.Animation);\r\n     * animCtrl.play(\"linear\");\r\n     */\r\n    play: function (name, startTime) {\r\n        let state = this.playAdditive(name, startTime);\r\n        this._animator.stopStatesExcept(state);\r\n        return state;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Plays an additive animation, it will not stop other animations.\r\n     * If there are other animations playing, then will play several animations at the same time.\r\n     * !#zh \r\n     * @method playAdditive\r\n     * @param {String} [name] - The name of animation to play. If no name is supplied then the default animation will be played.\r\n     * @param {Number} [startTime] - play an animation from startTime\r\n     * @return {AnimationState} - The AnimationState of playing animation. In cases where the animation can't be played (ie, there is no default animation or no animation with the specified name), the function will return null.\r\n     * @example\r\n     * // linear_1 and linear_2 at the same time playing.\r\n     * var animCtrl = this.node.getComponent(cc.Animation);\r\n     * animCtrl.playAdditive(\"linear_1\");\r\n     * animCtrl.playAdditive(\"linear_2\");\r\n     */\r\n    playAdditive: function (name, startTime) {\r\n        this._init();\r\n        let state = this.getAnimationState(name || (this._defaultClip && this._defaultClip.name));\r\n\r\n        if (state) {\r\n            this.enabled = true;\r\n\r\n            let animator = this._animator;\r\n            if (animator.isPlaying && state.isPlaying) {\r\n                if (state.isPaused) {\r\n                    animator.resumeState(state);\r\n                }\r\n                else {\r\n                    animator.stopState(state);\r\n                    animator.playState(state, startTime);\r\n                }\r\n            }\r\n            else {\r\n                animator.playState(state, startTime);\r\n            }\r\n\r\n            // Animation cannot be played when the component is not enabledInHierarchy.\r\n            // That would cause an error for the animation lost the reference after destroying the node.\r\n            // If users play the animation when the component is not enabledInHierarchy,\r\n            // we pause the animator here so that it will automatically resume the animation when users enable the component.\r\n            if (!this.enabledInHierarchy) {\r\n                animator.pause();\r\n            }\r\n\r\n            this.currentClip = state.clip;\r\n        }\r\n        return state;\r\n    },\r\n\r\n    /**\r\n     * !#en Stops an animation named name. If no name is supplied then stops all playing animations that were started with this Animation. <br/>\r\n     * Stopping an animation also Rewinds it to the Start.\r\n     * !#zh \r\n     * @method stop\r\n     * @param {String} [name] - The animation to stop, if not supplied then stops all playing animations.\r\n     */\r\n    stop: function (name) {\r\n        if (!this._didInit) {\r\n            return;\r\n        }\r\n        if (name) {\r\n            let state = this._nameToState[name];\r\n            if (state) {\r\n                this._animator.stopState(state);\r\n            }\r\n        }\r\n        else {\r\n            this._animator.stop();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Pauses an animation named name. If no name is supplied then pauses all playing animations that were started with this Animation.\r\n     * !#zh \r\n     * @method pause\r\n     * @param {String} [name] - The animation to pauses, if not supplied then pauses all playing animations.\r\n     */\r\n    pause: function (name) {\r\n        if (!this._didInit) {\r\n            return;\r\n        }\r\n        if (name) {\r\n            let state = this._nameToState[name];\r\n            if (state) {\r\n                this._animator.pauseState(state);\r\n            }\r\n        }\r\n        else {\r\n            this.enabled = false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Resumes an animation named name. If no name is supplied then resumes all paused animations that were started with this Animation.\r\n     * !#zh \r\n     * @method resume\r\n     * @param {String} [name] - The animation to resumes, if not supplied then resumes all paused animations.\r\n     */\r\n    resume: function (name) {\r\n        if (!this._didInit) {\r\n            return;\r\n        }\r\n        if (name) {\r\n            let state = this._nameToState[name];\r\n            if (state) {\r\n                this._animator.resumeState(state);\r\n            }\r\n        }\r\n        else {\r\n            this.enabled = true;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Make an animation named name go to the specified time. If no name is supplied then make all animations go to the specified time.\r\n     * !#zh \r\n     * @method setCurrentTime\r\n     * @param {Number} [time] - The time to go to\r\n     * @param {String} [name] - Specified animation name, if not supplied then make all animations go to the time.\r\n     */\r\n    setCurrentTime: function (time, name) {\r\n        this._init();\r\n        if (name) {\r\n            let state = this._nameToState[name];\r\n            if (state) {\r\n                this._animator.setStateTime(state, time);\r\n            }\r\n        }\r\n        else {\r\n            this._animator.setStateTime(time);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the animation state named name. If no animation with the specified name, the function will return null.\r\n     * !#zh  null\r\n     * @method getAnimationState\r\n     * @param {String} name\r\n     * @return {AnimationState}\r\n     */\r\n    getAnimationState: function (name) {\r\n        this._init();\r\n        let state = this._nameToState[name];\r\n\r\n        if (CC_EDITOR && (!state || !cc.js.array.contains(this._clips, state.clip))) {\r\n            this._didInit = false;\r\n\r\n            if (this.animator) {\r\n                this.animator.stop();\r\n            }\r\n\r\n            this._init();\r\n            state = this._nameToState[name];\r\n        }\r\n\r\n        if (state && !state.curveLoaded) {\r\n            this._animator._reloadClip(state);\r\n        }\r\n\r\n        return state || null;\r\n    },\r\n\r\n    /**\r\n     * !#en Adds a clip to the animation with name newName. If a clip with that name already exists it will be replaced with the new clip.\r\n     * !#zh \r\n     * @method addClip\r\n     * @param {AnimationClip} clip - the clip to add\r\n     * @param {String} [newName]\r\n     * @return {AnimationState} - The AnimationState which gives full control over the animation clip.\r\n     */\r\n    addClip: function (clip, newName) {\r\n        if (!clip) {\r\n            cc.warnID(3900);\r\n            return;\r\n        }\r\n        this._init();\r\n\r\n        // add clip\r\n        if (!cc.js.array.contains(this._clips, clip)) {\r\n            this._clips.push(clip);\r\n        }\r\n\r\n        // replace same name clip\r\n        newName = newName || clip.name;\r\n        let oldState = this._nameToState[newName];\r\n        if (oldState) {\r\n            if (oldState.clip === clip) {\r\n                return oldState;\r\n            }\r\n            else {\r\n                var index = this._clips.indexOf(oldState.clip);\r\n                if (index !== -1) {\r\n                    this._clips.splice(index, 1);\r\n                }\r\n            }\r\n        }\r\n\r\n        // replace state\r\n        let newState = new cc.AnimationState(clip, newName);\r\n        this._nameToState[newName] = newState;\r\n        return newState;\r\n    },\r\n\r\n    /**\r\n     * !#en \r\n     * Remove clip from the animation list. This will remove the clip and any animation states based on it.\r\n     * If there are animation states depand on the clip are playing or clip is defaultClip, it will not delete the clip.\r\n     * But if force is true, then will always remove the clip and any animation states based on it. If clip is defaultClip, defaultClip will be reset to null\r\n     * !#zh\r\n     * <br/>\r\n     *  clip  AnimationState  clip  defaultClip  clip \r\n     *  force  true clip  defaultClipdefaultClip  null\r\n     * @method removeClip\r\n     * @param {AnimationClip} clip\r\n     * @param {Boolean} [force=false] - If force is true, then will always remove the clip and any animation states based on it.\r\n     */\r\n    removeClip: function (clip, force) {\r\n        if (!clip) {\r\n            cc.warnID(3901);\r\n            return;\r\n        }\r\n        this._init();\r\n\r\n        let state;\r\n        for (let name in this._nameToState) {\r\n            state = this._nameToState[name];\r\n            let stateClip = state.clip;\r\n            if (stateClip === clip) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (clip === this._defaultClip) {\r\n            if (force) this._defaultClip = null;\r\n            else {\r\n                if (!CC_TEST) cc.warnID(3902);\r\n                return;\r\n            } \r\n        }\r\n\r\n        if (state && state.isPlaying) {\r\n            if (force) this.stop(state.name);\r\n            else {\r\n                if (!CC_TEST) cc.warnID(3903);\r\n                return;\r\n            }\r\n        }\r\n\r\n        this._clips = this._clips.filter(function (item) {\r\n            return item !== clip;\r\n        });\r\n\r\n        if (state) {\r\n            delete this._nameToState[state.name];    \r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Samples animations at the current state.<br/>\r\n     * This is useful when you explicitly want to set up some animation state, and sample it once.\r\n     * !#zh \r\n     * @method sample\r\n     * @param {String} name\r\n     */\r\n    sample: function (name) {\r\n        this._init();\r\n\r\n        if (name) {\r\n            let state = this._nameToState[name];\r\n            if (state) {\r\n                state.sample();\r\n            }\r\n        }\r\n        else {\r\n            this._animator.sample();\r\n        }\r\n    },\r\n\r\n\r\n    /**\r\n     * !#en \r\n     * Register animation event callback.\r\n     * The event arguments will provide the AnimationState which emit the event.\r\n     * When play an animation, will auto register the event callback to the AnimationState, and unregister the event callback from the AnimationState when animation stopped.\r\n     * !#zh\r\n     * \r\n     *  AnimationState\r\n     *  AnimationState  AnimationState \r\n     * @method on\r\n     * @param {String} type - A string representing the event type to listen for.\r\n     * @param {Function} callback - The callback that will be invoked when the event is dispatched.\r\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\r\n     * @param {cc.AnimationState} state \r\n     * @param {Object} [target] - The target (this object) to invoke the callback, can be null\r\n     * @param {Boolean} [useCapture=false] - When set to true, the capture argument prevents callback\r\n     *                              from being invoked when the event's eventPhase attribute value is BUBBLING_PHASE.\r\n     *                              When false, callback will NOT be invoked when event's eventPhase attribute value is CAPTURING_PHASE.\r\n     *                              Either way, callback will be invoked when event's eventPhase attribute value is AT_TARGET.\r\n     *\r\n     * @return {Function} - Just returns the incoming callback so you can save the anonymous function easier.\r\n     * @typescript\r\n     * on(type: string, callback: (event: Event.EventCustom) => void, target?: any, useCapture?: boolean): (event: Event.EventCustom) => void\r\n     * on<T>(type: string, callback: (event: T) => void, target?: any, useCapture?: boolean): (event: T) => void\r\n     * @example\r\n     * onPlay: function (type, state) {\r\n     *     // callback\r\n     * }\r\n     * \r\n     * // register event to all animation\r\n     * animation.on('play', this.onPlay, this);\r\n     */\r\n    on: function (type, callback, target, useCapture) {\r\n        this._init();\r\n\r\n        let ret = this._EventTargetOn(type, callback, target, useCapture);\r\n        \r\n        if (type === 'lastframe') {\r\n            let array = this._animator._anims.array;\r\n            for (let i = 0; i < array.length; ++i) {\r\n                let state = array[i];\r\n                state._lastframeEventOn = true;\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    },\r\n\r\n\r\n    /**\r\n     * !#en\r\n     * Unregister animation event callback.\r\n     * !#zh\r\n     * \r\n     * @method off\r\n     * @param {String} type - A string representing the event type being removed.\r\n     * @param {Function} [callback] - The callback to remove.\r\n     * @param {Object} [target] - The target (this object) to invoke the callback, if it's not given, only callback without target will be removed\r\n     * @param {Boolean} [useCapture=false] - Specifies whether the callback being removed was registered as a capturing callback or not.\r\n     *                              If not specified, useCapture defaults to false. If a callback was registered twice,\r\n     *                              one with capture and one without, each must be removed separately. Removal of a capturing callback\r\n     *                              does not affect a non-capturing version of the same listener, and vice versa.\r\n     *\r\n     * @example\r\n     * // unregister event to all animation\r\n     * animation.off('play', this.onPlay, this);\r\n     */\r\n    off: function (type, callback, target, useCapture) {\r\n        this._init();\r\n\r\n        if (type === 'lastframe') {\r\n            let nameToState = this._nameToState;\r\n            for (let name in nameToState) {\r\n                let state = nameToState[name];\r\n                state._lastframeEventOn = false;\r\n            }\r\n        }\r\n\r\n        this._EventTargetOff(type, callback, target, useCapture);\r\n    },\r\n\r\n    ///////////////////////////////////////////////////////////////////////////////\r\n    // Internal Methods\r\n    ///////////////////////////////////////////////////////////////////////////////\r\n\r\n    // Dont forget to call _init before every actual process in public methods.\r\n    // Just invoking _init by onLoad is not enough because onLoad is called only if the entity is active.\r\n\r\n    _init: function () {\r\n        if (this._didInit) {\r\n            return;\r\n        }\r\n        this._didInit = true;\r\n        this._animator = new AnimationAnimator(this.node, this);\r\n        this._createStates();\r\n    },\r\n\r\n    _createStates: function() {\r\n        this._nameToState = js.createMap(true);\r\n        \r\n        // create animation states\r\n        let state = null;\r\n        let defaultClipState = false;\r\n        for (let i = 0; i < this._clips.length; ++i) {\r\n            let clip = this._clips[i];\r\n            if (clip) {\r\n                state = new cc.AnimationState(clip);\r\n\r\n                if (CC_EDITOR) {\r\n                    this._animator._reloadClip(state);\r\n                }\r\n\r\n                this._nameToState[state.name] = state;\r\n                if (equalClips(this._defaultClip, clip)) {\r\n                    defaultClipState = state;\r\n                }\r\n            }\r\n        }\r\n        if (this._defaultClip && !defaultClipState) {\r\n            state = new cc.AnimationState(this._defaultClip);\r\n\r\n            if (CC_EDITOR) {\r\n                this._animator._reloadClip(state);\r\n            }\r\n\r\n            this._nameToState[state.name] = state;\r\n        }\r\n    }\r\n});\r\n\r\nAnimation.prototype._EventTargetOn = EventTarget.prototype.on;\r\nAnimation.prototype._EventTargetOff = EventTarget.prototype.off;\r\n\r\ncc.Animation = module.exports = Animation;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst misc = require('../utils/misc');\r\nconst Component = require('./CCComponent');\r\nconst AudioClip = require('../assets/CCAudioClip');\r\n\r\n/**\r\n * !#en Audio Source.\r\n * !#zh \r\n * @class AudioSource\r\n * @extends Component\r\n */\r\nvar AudioSource = cc.Class({\r\n    name: 'cc.AudioSource',\r\n    extends: Component,\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.others/AudioSource',\r\n        help: 'i18n:COMPONENT.help_url.audiosource',\r\n    },\r\n\r\n    ctor: function () {\r\n        // We can't require Audio here because jsb Audio is implemented outside the engine,\r\n        // it can only take effect rely on overwriting cc.Audio\r\n        this.audio = new cc.Audio();\r\n    },\r\n\r\n    properties: {\r\n        _clip: {\r\n            default: null,\r\n            type: AudioClip\r\n        },\r\n        _volume: 1,\r\n        _mute: false,\r\n        _loop: false,\r\n        _pausedFlag: {\r\n            default: false,\r\n            serializable: false\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Is the audio source playing (Read Only). <br/>\r\n         * Note: isPlaying is not supported for Native platforms.\r\n         * !#zh\r\n         * <br/>\r\n         * Native  isPlaying\r\n         * @property isPlaying\r\n         * @type {Boolean}\r\n         * @readOnly\r\n         * @default false\r\n         */\r\n        isPlaying: {\r\n            get: function () {\r\n                var state = this.audio.getState();\r\n                return state === cc.Audio.State.PLAYING;\r\n            },\r\n            visible: false\r\n        },\r\n\r\n        /**\r\n         * !#en The clip of the audio source to play.\r\n         * !#zh \r\n         * @property clip\r\n         * @type {AudioClip}\r\n         * @default 1\r\n         */\r\n        clip: {\r\n            get: function () {\r\n                return this._clip;\r\n            },\r\n            set: function (value) {\r\n                if (typeof value === 'string') {\r\n                    // backward compatibility since 1.10\r\n                    cc.warnID(8401, 'cc.AudioSource', 'cc.AudioClip', 'AudioClip', 'cc.AudioClip', 'audio');\r\n                    let self = this;\r\n                    AudioClip._loadByUrl(value, function (err, clip) {\r\n                        if (clip) {\r\n                            self.clip = clip;\r\n                        }\r\n                    });\r\n                    return;\r\n                }\r\n\r\n                if (value === this._clip) {\r\n                    return;\r\n                }\r\n                this._clip = value;\r\n                this.audio.stop();\r\n                if (this.preload) {\r\n                    this.audio.src = this._clip;\r\n                }\r\n            },\r\n            type: AudioClip,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.audio.clip',\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en The volume of the audio source.\r\n         * !#zh 0.0 ~ 1.0\r\n         * @property volume\r\n         * @type {Number}\r\n         * @default 1\r\n         */\r\n        volume: {\r\n            get: function () {\r\n                return this._volume;\r\n            },\r\n            set: function (value) {\r\n                value = misc.clamp01(value);\r\n                this._volume = value;\r\n                if (!this._mute) {\r\n                    this.audio.setVolume(value);\r\n                }\r\n                return value;\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.audio.volume'\r\n        },\r\n\r\n        /**\r\n         * !#en Is the audio source mute?\r\n         * !#zh Mute  0\r\n         * @property mute\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        mute: {\r\n            get: function () {\r\n                return this._mute;\r\n            },\r\n            set: function (value) {\r\n                this._mute = value;\r\n                this.audio.setVolume(value ? 0 : this._volume);\r\n                return value;\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.audio.mute',\r\n        },\r\n\r\n        /**\r\n         * !#en Is the audio source looping?\r\n         * !#zh \r\n         * @property loop\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        loop: {\r\n            get: function () {\r\n                return this._loop;\r\n            },\r\n            set: function (value) {\r\n                this._loop = value;\r\n                this.audio.setLoop(value);\r\n                return value;\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.audio.loop'\r\n        },\r\n\r\n        /**\r\n         * !#en If set to true, the audio source will automatically start playing on onEnable.\r\n         * !#zh  true onEnable \r\n         * @property playOnLoad\r\n         * @type {Boolean}\r\n         * @default true\r\n         */\r\n        playOnLoad: {\r\n            default: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.audio.play_on_load',\r\n            animatable: false\r\n        },\r\n\r\n        preload: {\r\n            default: false,\r\n            animatable: false\r\n        }\r\n    },\r\n\r\n    _ensureDataLoaded () {\r\n        if (this.audio.src !== this._clip) {\r\n            this.audio.src = this._clip;\r\n        }\r\n    },\r\n\r\n    _pausedCallback: function () {\r\n        var state = this.audio.getState();\r\n        if (state === cc.Audio.State.PLAYING) {\r\n            this.audio.pause();\r\n            this._pausedFlag = true;\r\n        }\r\n    },\r\n\r\n    _restoreCallback: function () {\r\n        if (this._pausedFlag) {\r\n            this.audio.resume();\r\n        }\r\n        this._pausedFlag = false;\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.audio.setVolume(this._mute ? 0 : this._volume);\r\n        this.audio.setLoop(this._loop);\r\n    },\r\n\r\n    onEnable: function () {\r\n        if (this.preload) {\r\n            this.audio.src = this._clip;\r\n        }\r\n        if (this.playOnLoad) {\r\n            this.play();\r\n        }\r\n        cc.game.on(cc.game.EVENT_HIDE, this._pausedCallback, this);\r\n        cc.game.on(cc.game.EVENT_SHOW, this._restoreCallback, this);\r\n    },\r\n\r\n    onDisable: function () {\r\n        this.stop();\r\n        cc.game.off(cc.game.EVENT_HIDE, this._pausedCallback, this);\r\n        cc.game.off(cc.game.EVENT_SHOW, this._restoreCallback, this);\r\n    },\r\n\r\n    onDestroy: function () {\r\n        this.stop();\r\n        this.audio.destroy();\r\n        cc.audioEngine.uncache(this._clip);\r\n    },\r\n\r\n    /**\r\n     * !#en Plays the clip.\r\n     * !#zh \r\n     * @method play\r\n     */\r\n    play: function () {\r\n        if ( !this._clip ) return;\r\n\r\n        var audio = this.audio;\r\n        if (this._clip.loaded) {\r\n            audio.stop();\r\n        }\r\n        this._ensureDataLoaded();\r\n        audio.setCurrentTime(0);\r\n        audio.play();\r\n    },\r\n\r\n    /**\r\n     * !#en Stops the clip.\r\n     * !#zh \r\n     * @method stop\r\n     */\r\n    stop: function () {\r\n        this.audio.stop();\r\n    },\r\n\r\n    /**\r\n     * !#en Pause the clip.\r\n     * !#zh \r\n     * @method pause\r\n     */\r\n    pause: function () {\r\n        this.audio.pause();\r\n    },\r\n\r\n    /**\r\n     * !#en Resume the clip.\r\n     * !#zh \r\n     * @method resume\r\n     */\r\n    resume: function () {\r\n        this._ensureDataLoaded();\r\n        this.audio.resume();\r\n    },\r\n\r\n    /**\r\n     * !#en Rewind playing music.\r\n     * !#zh \r\n     * @method rewind\r\n     */\r\n    rewind: function(){\r\n        this.audio.setCurrentTime(0);\r\n    },\r\n\r\n    /**\r\n     * !#en Get current time\r\n     * !#zh \r\n     * @method getCurrentTime\r\n     * @return {Number}\r\n     */\r\n    getCurrentTime: function () {\r\n        return this.audio.getCurrentTime();\r\n    },\r\n\r\n    /**\r\n     * !#en Set current time\r\n     * !#zh \r\n     * @method setCurrentTime\r\n     * @param {Number} time\r\n     * @return {Number}\r\n     */\r\n    setCurrentTime: function (time) {\r\n        this.audio.setCurrentTime(time);\r\n        return time;\r\n    },\r\n\r\n    /**\r\n     * !#en Get audio duration\r\n     * !#zh \r\n     * @method getDuration\r\n     * @return {Number}\r\n     */\r\n    getDuration: function () {\r\n        return this.audio.getDuration();\r\n    }\r\n\r\n});\r\n\r\ncc.AudioSource = module.exports = AudioSource;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst BlockEvents = ['touchstart', 'touchmove', 'touchend',\r\n                     'mousedown', 'mousemove', 'mouseup',\r\n                     'mouseenter', 'mouseleave', 'mousewheel'];\r\n\r\nfunction stopPropagation (event) {\r\n    event.stopPropagation();\r\n}\r\n\r\n/**\r\n * !#en\r\n * This component will block all input events (mouse and touch) within the bounding box of the node, preventing the input from penetrating into the underlying node, typically for the background of the top UI.<br>\r\n * This component does not have any API interface and can be added directly to the scene to take effect.\r\n * !#zh\r\n *  bounding box  UI <br>\r\n *  API \r\n *\r\n * @class BlockInputEvents\r\n * @extends Component\r\n */\r\nconst BlockInputEvents = cc.Class({\r\n    name: 'cc.BlockInputEvents',\r\n    extends: require('./CCComponent'),\r\n    editor: {\r\n        menu: 'i18n:MAIN_MENU.component.ui/Block Input Events',\r\n        inspector: 'packages://inspector/inspectors/comps/block-input-events.js',\r\n        help: 'i18n:COMPONENT.help_url.block_input_events',\r\n    },\r\n\r\n    onEnable () {\r\n        for (var i = 0; i < BlockEvents.length; i++) {\r\n            // supply the 'this' parameter so that the callback could be added and removed correctly,\r\n            // even if the same component is added more than once to a Node.\r\n            this.node.on(BlockEvents[i], stopPropagation, this);\r\n        }\r\n    },\r\n    onDisable () {\r\n        for (var i = 0; i < BlockEvents.length; i++) {\r\n            this.node.off(BlockEvents[i], stopPropagation, this);\r\n        }\r\n    }\r\n});\r\n\r\ncc.BlockInputEvents = module.exports = BlockInputEvents;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Component = require('./CCComponent');\r\nconst misc = require('../utils/misc');\r\n\r\n/**\r\n * !#en Enum for transition type.\r\n * !#zh \r\n * @enum Button.Transition\r\n */\r\nlet Transition = cc.Enum({\r\n    /**\r\n     * !#en The none type.\r\n     * !#zh \r\n     * @property {Number} NONE\r\n     */\r\n    NONE: 0,\r\n\r\n    /**\r\n     * !#en The color type.\r\n     * !#zh \r\n     * @property {Number} COLOR\r\n     */\r\n    COLOR: 1,\r\n\r\n    /**\r\n     * !#en The sprite type.\r\n     * !#zh \r\n     * @property {Number} SPRITE\r\n     */\r\n    SPRITE: 2,\r\n    /**\r\n     * !#en The scale type\r\n     * !#zh \r\n     * @property {Number} SCALE\r\n     */\r\n    SCALE: 3\r\n});\r\n\r\nconst State = cc.Enum({\r\n    NORMAL: 0,\r\n    HOVER: 1,\r\n    PRESSED: 2,\r\n    DISABLED: 3,\r\n});\r\n\r\n/**\r\n * !#en\r\n * Button has 4 Transition types<br/>\r\n * When Button state changed:<br/>\r\n *  If Transition type is Button.Transition.NONE, Button will do nothing<br/>\r\n *  If Transition type is Button.Transition.COLOR, Button will change target's color<br/>\r\n *  If Transition type is Button.Transition.SPRITE, Button will change target Sprite's sprite<br/>\r\n *  If Transition type is Button.Transition.SCALE, Button will change target node's scale<br/>\r\n *\r\n * Button will trigger 5 events:<br/>\r\n *  Button.EVENT_TOUCH_DOWN<br/>\r\n *  Button.EVENT_TOUCH_UP<br/>\r\n *  Button.EVENT_HOVER_IN<br/>\r\n *  Button.EVENT_HOVER_MOVE<br/>\r\n *  Button.EVENT_HOVER_OUT<br/>\r\n *\r\n * !#zh\r\n * ,<br/>\r\n *\r\n *  Transition <br/>\r\n *   -Button.Transition.NONE   // <br/>\r\n *   -Button.Transition.COLOR  // <br/>\r\n *   -Button.Transition.SPRITE // <br/>\r\n *   -Button.Transition.SCALE // <br/>\r\n *\r\n *  Node <br/>\r\n *   // <br/>\r\n *   -cc.Node.EventType.TOUCH_START  // <br/>\r\n *   -cc.Node.EventType.TOUCH_Move   // <br/>\r\n *   -cc.Node.EventType.TOUCH_END    // <br/>\r\n *   -cc.Node.EventType.TOUCH_CANCEL // <br/>\r\n *   //  PC <br/>\r\n *   -cc.Node.EventType.MOUSE_DOWN  // <br/>\r\n *   -cc.Node.EventType.MOUSE_MOVE  // <br/>\r\n *   -cc.Node.EventType.MOUSE_ENTER // <br/>\r\n *   -cc.Node.EventType.MOUSE_LEAVE // <br/>\r\n *   -cc.Node.EventType.MOUSE_UP    // <br/>\r\n *   -cc.Node.EventType.MOUSE_WHEEL // <br/>\r\n *\r\n * @class Button\r\n * @extends Component\r\n * @example\r\n *\r\n * // Add an event to the button.\r\n * button.node.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n *     cc.log(\"This is a callback after the trigger event\");\r\n * });\r\n\r\n * // You could also add a click event\r\n * //Note: In this way, you can't get the touch event info, so use it wisely.\r\n * button.node.on('click', function (button) {\r\n *    //The event is a custom event, you could get the Button component via first argument\r\n * })\r\n *\r\n */\r\nlet Button = cc.Class({\r\n    name: 'cc.Button',\r\n    extends: Component,\r\n\r\n    ctor () {\r\n        this._pressed = false;\r\n        this._hovered = false;\r\n        this._fromColor = null;\r\n        this._toColor = null;\r\n        this._time = 0;\r\n        this._transitionFinished = true;\r\n        this._fromScale = 1.0;\r\n        this._toScale = 1.0;\r\n        this._originalScale = 1.0;\r\n\r\n        this._sprite = null;\r\n    },\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.ui/Button',\r\n        help: 'i18n:COMPONENT.help_url.button',\r\n        inspector: 'packages://inspector/inspectors/comps/button.js',\r\n        executeInEditMode: true\r\n    },\r\n\r\n    properties: {\r\n        /**\r\n         * !#en\r\n         * Whether the Button is disabled.\r\n         * If true, the Button will trigger event and do transition.\r\n         * !#zh\r\n         *  false\r\n         * @property {Boolean} interactable\r\n         * @default true\r\n         */\r\n        interactable: {\r\n            default: true,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.interactable',\r\n            notify () {\r\n                this._updateState();\r\n\r\n                if (!this.interactable) {\r\n                    this._resetState();\r\n                }\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        _resizeToTarget: {\r\n            animatable: false,\r\n            set (value) {\r\n                if (value) {\r\n                    this._resizeNodeToTargetNode();\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en When this flag is true, Button target sprite will turn gray when interactable is false.\r\n         * !#zh  true button  interactable  false  shader  button  target  sprite \r\n         * @property {Boolean} enableAutoGrayEffect\r\n         */\r\n        enableAutoGrayEffect: {\r\n            default: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.auto_gray_effect',\r\n            notify () {\r\n                this._updateDisabledState();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Transition type\r\n         * !#zh \r\n         * @property {Button.Transition} transition\r\n         * @default Button.Transition.Node\r\n         */\r\n        transition: {\r\n            default: Transition.NONE,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.transition',\r\n            type: Transition,\r\n            animatable: false,\r\n            notify (oldValue) {\r\n                this._updateTransition(oldValue);\r\n            },\r\n            formerlySerializedAs: 'transition'\r\n        },\r\n\r\n        // color transition\r\n\r\n        /**\r\n         * !#en Normal state color.\r\n         * !#zh \r\n         * @property {Color} normalColor\r\n         */\r\n        normalColor: {\r\n            default: cc.color(214, 214, 214),\r\n            displayName: 'Normal',\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.normal_color',\r\n            notify () {\r\n                if (this.transition === Transition.Color && this._getButtonState() === State.NORMAL) {\r\n                    this._getTarget().opacity = this.normalColor.a;\r\n                }\r\n                this._updateState();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Pressed state color\r\n         * !#zh \r\n         * @property {Color} pressedColor\r\n         */\r\n        pressedColor: {\r\n            default: cc.color(211, 211, 211),\r\n            displayName: 'Pressed',\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.pressed_color',\r\n            notify () {\r\n                if (this.transition === Transition.Color && this._getButtonState() === State.PRESSED) {\r\n                    this._getTarget().opacity = this.pressedColor.a;\r\n                }\r\n                this._updateState();\r\n            },\r\n            formerlySerializedAs: 'pressedColor'\r\n        },\r\n\r\n        /**\r\n         * !#en Hover state color\r\n         * !#zh \r\n         * @property {Color} hoverColor\r\n         */\r\n        hoverColor: {\r\n            default: cc.Color.WHITE,\r\n            displayName: 'Hover',\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.hover_color',\r\n            notify () {\r\n                if (this.transition === Transition.Color && this._getButtonState() === State.HOVER) {\r\n                    this._getTarget().opacity = this.hoverColor.a;\r\n                }\r\n                this._updateState();\r\n            },\r\n            formerlySerializedAs: 'hoverColor'\r\n        },\r\n\r\n        /**\r\n         * !#en Disabled state color\r\n         * !#zh \r\n         * @property {Color} disabledColor\r\n         */\r\n        disabledColor: {\r\n            default: cc.color(124, 124, 124),\r\n            displayName: 'Disabled',\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.disabled_color',\r\n            notify () {\r\n                if (this.transition === Transition.Color && this._getButtonState() === State.DISABLED) {\r\n                    this._getTarget().opacity = this.disabledColor.a;\r\n                }\r\n                this._updateState();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Color and Scale transition duration\r\n         * !#zh \r\n         * @property {Number} duration\r\n         */\r\n        duration: {\r\n            default: 0.1,\r\n            range: [0, 10],\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.duration',\r\n        },\r\n\r\n        /**\r\n         * !#en  When user press the button, the button will zoom to a scale.\r\n         * The final scale of the button  equals (button original scale * zoomScale)\r\n         * !#zh  Button  scale * zoomScale\r\n         * @property {Number} zoomScale\r\n         */\r\n        zoomScale: {\r\n            default: 1.2,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.zoom_scale'\r\n        },\r\n\r\n        // sprite transition\r\n        /**\r\n         * !#en Normal state sprite\r\n         * !#zh  Sprite \r\n         * @property {SpriteFrame} normalSprite\r\n         */\r\n        normalSprite: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n            displayName: 'Normal',\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.normal_sprite',\r\n            notify () {\r\n                this._updateState();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Pressed state sprite\r\n         * !#zh  Sprite \r\n         * @property {SpriteFrame} pressedSprite\r\n         */\r\n        pressedSprite: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n            displayName: 'Pressed',\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.pressed_sprite',\r\n            formerlySerializedAs: 'pressedSprite',\r\n            notify () {\r\n                this._updateState();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Hover state sprite\r\n         * !#zh  Sprite \r\n         * @property {SpriteFrame} hoverSprite\r\n         */\r\n        hoverSprite: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n            displayName: 'Hover',\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.hover_sprite',\r\n            formerlySerializedAs: 'hoverSprite',\r\n            notify () {\r\n                this._updateState();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Disabled state sprite\r\n         * !#zh  Sprite \r\n         * @property {SpriteFrame} disabledSprite\r\n         */\r\n        disabledSprite: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n            displayName: 'Disabled',\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.disabled_sprite',\r\n            notify () {\r\n                this._updateState();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Transition target.\r\n         * When Button state changed:\r\n         *  If Transition type is Button.Transition.NONE, Button will do nothing\r\n         *  If Transition type is Button.Transition.COLOR, Button will change target's color\r\n         *  If Transition type is Button.Transition.SPRITE, Button will change target Sprite's sprite\r\n         * !#zh\r\n         * \r\n         * \r\n         * - Transition type  Button.Transition.NONE\r\n         * - Transition type  Button.Transition.COLOR\r\n         * - Transition type  Button.Transition.Sprite Sprite  Sprite \r\n         * @property {Node} target\r\n         */\r\n        target: {\r\n            default: null,\r\n            type: cc.Node,\r\n            tooltip: CC_DEV && \"i18n:COMPONENT.button.target\",\r\n            notify () {\r\n                this._applyTarget();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en If Button is clicked, it will trigger event's handler\r\n         * !#zh \r\n         * @property {Component.EventHandler[]} clickEvents\r\n         */\r\n        clickEvents: {\r\n            default: [],\r\n            type: cc.Component.EventHandler,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.button.click_events',\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        Transition: Transition,\r\n    },\r\n\r\n    __preload () {\r\n        this._applyTarget();\r\n        this._updateState();\r\n    },\r\n\r\n    _resetState () {\r\n        this._pressed = false;\r\n        this._hovered = false;\r\n        // // Restore button status\r\n        let target = this._getTarget();\r\n        let transition = this.transition;\r\n        if (transition === Transition.COLOR && this.interactable) {\r\n            this._setTargetColor(this.normalColor);\r\n        } else if (transition === Transition.SCALE) {\r\n            target.scale = this._originalScale;\r\n        }\r\n        this._transitionFinished = true;\r\n    },\r\n\r\n    onEnable () {\r\n        // check sprite frames\r\n        if (this.normalSprite) {\r\n            this.normalSprite.ensureLoadTexture();\r\n        }\r\n        if (this.hoverSprite) {\r\n            this.hoverSprite.ensureLoadTexture();\r\n        }\r\n        if (this.pressedSprite) {\r\n            this.pressedSprite.ensureLoadTexture();\r\n        }\r\n        if (this.disabledSprite) {\r\n            this.disabledSprite.ensureLoadTexture();\r\n        }\r\n        //\r\n        if (!CC_EDITOR) {\r\n            this._registerEvent();\r\n        } else {\r\n            this.node.on('spriteframe-changed', function (comp) {\r\n                if (this.transition === Transition.SPRITE) {\r\n                    this._setCurrentStateSprite(comp.spriteFrame);\r\n                }\r\n            }.bind(this));\r\n            this.node.on('color-changed', function (color) {\r\n                if (this.transition === Transition.COLOR) {\r\n                    this._setCurrentStateColor(color);\r\n                }\r\n            }.bind(this));\r\n        }\r\n    },\r\n\r\n    _getTarget () {\r\n        return this.target ? this.target : this.node;\r\n    },\r\n\r\n    _setTargetColor(color) {\r\n        let target = this._getTarget();\r\n        target.color = color;\r\n        target.opacity = color.a;\r\n    },\r\n\r\n    _getStateColor (state) {\r\n        switch (state) {\r\n            case State.NORMAL:\r\n                return this.normalColor;\r\n            case State.HOVER:\r\n                return this.hoverColor;\r\n            case State.PRESSED:\r\n                return this.pressedColor;\r\n            case State.DISABLED:\r\n                return this.disabledColor;\r\n        }\r\n    },\r\n\r\n    _getStateSprite (state) {\r\n        switch (state) {\r\n            case State.NORMAL:\r\n                return this.normalSprite;\r\n            case State.HOVER:\r\n                return this.hoverSprite;\r\n            case State.PRESSED:\r\n                return this.pressedSprite;\r\n            case State.DISABLED:\r\n                return this.disabledSprite;\r\n        }\r\n    },\r\n\r\n    _setCurrentStateColor (color) {\r\n        switch ( this._getButtonState() ) {\r\n            case State.NORMAL:\r\n                this.normalColor = color;\r\n                break;\r\n            case State.HOVER:\r\n                this.hoverColor = color;\r\n                break;\r\n            case State.PRESSED:\r\n                this.pressedColor = color;\r\n                break;\r\n            case State.DISABLED:\r\n                this.disabledColor = color;\r\n                break;\r\n        }\r\n    },\r\n\r\n    _setCurrentStateSprite (spriteFrame) {\r\n        switch ( this._getButtonState() ) {\r\n            case State.NORMAL:\r\n                this.normalSprite = spriteFrame;\r\n                break;\r\n            case State.HOVER:\r\n                this.hoverSprite = spriteFrame;\r\n                break;\r\n            case State.PRESSED:\r\n                this.pressedSprite = spriteFrame;\r\n                break;\r\n            case State.DISABLED:\r\n                this.disabledSprite = spriteFrame;\r\n                break;\r\n        }\r\n    },\r\n\r\n    onDisable () {\r\n        this._resetState();\r\n\r\n        if (!CC_EDITOR) {\r\n            this.node.off(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this);\r\n            this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\r\n            this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this);\r\n            this.node.off(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancel, this);\r\n\r\n            this.node.off(cc.Node.EventType.MOUSE_ENTER, this._onMouseMoveIn, this);\r\n            this.node.off(cc.Node.EventType.MOUSE_LEAVE, this._onMouseMoveOut, this);\r\n        } else {\r\n            this.node.off('spriteframe-changed');\r\n        }\r\n    },\r\n\r\n    update (dt) {\r\n        let target = this._getTarget();\r\n        if (this._transitionFinished) return;\r\n        if (this.transition !== Transition.COLOR && this.transition !== Transition.SCALE) return;\r\n\r\n        this.time += dt;\r\n        let ratio = 1.0;\r\n        if (this.duration > 0) {\r\n            ratio = this.time / this.duration;\r\n        }\r\n\r\n        if (ratio >= 1) {\r\n            ratio = 1;\r\n            this._transitionFinished = true;\r\n        }\r\n\r\n        if (this.transition === Transition.COLOR) {\r\n            let color = this._fromColor.lerp(this._toColor, ratio);\r\n            this._setTargetColor(color);\r\n        } else if (this.transition === Transition.SCALE) {\r\n            target.scale = misc.lerp(this._fromScale, this._toScale, ratio);\r\n        }\r\n\r\n    },\r\n\r\n    _registerEvent () {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancel, this);\r\n\r\n        this.node.on(cc.Node.EventType.MOUSE_ENTER, this._onMouseMoveIn, this);\r\n        this.node.on(cc.Node.EventType.MOUSE_LEAVE, this._onMouseMoveOut, this);\r\n    },\r\n\r\n    _getTargetSprite (target) {\r\n        let sprite = null;\r\n        if (target) {\r\n            sprite = target.getComponent(cc.Sprite);\r\n        }\r\n        return sprite;\r\n    },\r\n\r\n    _applyTarget () {\r\n        let target = this._getTarget();\r\n        this._sprite = this._getTargetSprite(target);\r\n        this._originalScale = target.scale;\r\n    },\r\n\r\n    // touch event handler\r\n    _onTouchBegan (event) {\r\n        if (!this.interactable || !this.enabledInHierarchy) return;\r\n\r\n        this._pressed = true;\r\n        this._updateState();\r\n        event.stopPropagation();\r\n    },\r\n\r\n    _onTouchMove (event) {\r\n        if (!this.interactable || !this.enabledInHierarchy || !this._pressed) return;\r\n        // mobile phone will not emit _onMouseMoveOut,\r\n        // so we have to do hit test when touch moving\r\n        let touch = event.touch;\r\n        let hit = this.node._hitTest(touch.getLocation());\r\n        let target = this._getTarget();\r\n\r\n        if (this.transition === Transition.SCALE) {\r\n            if (hit) {\r\n                this._fromScale = this._originalScale;\r\n                this._toScale = this._originalScale * this.zoomScale;\r\n                this._transitionFinished = false;\r\n            } else {\r\n                this.time = 0;\r\n                this._transitionFinished = true;\r\n                target.scale = this._originalScale;\r\n            }\r\n        } else {\r\n            let state;\r\n            if (hit) {\r\n                state = State.PRESSED;\r\n            } else {\r\n                state = State.NORMAL;\r\n            }\r\n            this._applyTransition(state);\r\n        }\r\n        event.stopPropagation();\r\n    },\r\n\r\n    _onTouchEnded (event) {\r\n        if (!this.interactable || !this.enabledInHierarchy) return;\r\n\r\n        if (this._pressed) {\r\n            cc.Component.EventHandler.emitEvents(this.clickEvents, event);\r\n            this.node.emit('click', this);\r\n        }\r\n        this._pressed = false;\r\n        this._updateState();\r\n        event.stopPropagation();\r\n    },\r\n\r\n    _onTouchCancel () {\r\n        if (!this.interactable || !this.enabledInHierarchy) return;\r\n\r\n        this._pressed = false;\r\n        this._updateState();\r\n    },\r\n\r\n    _onMouseMoveIn () {\r\n        if (this._pressed || !this.interactable || !this.enabledInHierarchy) return;\r\n        if (this.transition === Transition.SPRITE && !this.hoverSprite) return;\r\n\r\n        if (!this._hovered) {\r\n            this._hovered = true;\r\n            this._updateState();\r\n        }\r\n    },\r\n\r\n    _onMouseMoveOut () {\r\n        if (this._hovered) {\r\n            this._hovered = false;\r\n            this._updateState();\r\n        }\r\n    },\r\n\r\n    // state handler\r\n    _updateState () {\r\n        let state = this._getButtonState();\r\n        this._applyTransition(state);\r\n        this._updateDisabledState();\r\n    },\r\n\r\n    _getButtonState () {\r\n        let state;\r\n        if (!this.interactable) {\r\n            state = State.DISABLED;\r\n        }\r\n        else if (this._pressed) {\r\n            state = State.PRESSED;\r\n        }\r\n        else if (this._hovered) {\r\n            state = State.HOVER;\r\n        }\r\n        else {\r\n            state = State.NORMAL;\r\n        }\r\n        return state;\r\n    },\r\n\r\n    _updateColorTransitionImmediately (state) {\r\n        let color = this._getStateColor(state);\r\n        this._setTargetColor(color);\r\n    },\r\n\r\n    _updateColorTransition (state) {\r\n        if (CC_EDITOR || state === State.DISABLED) {\r\n            this._updateColorTransitionImmediately(state);\r\n        }\r\n        else {\r\n            let target = this._getTarget();\r\n            let color = this._getStateColor(state);\r\n            this._fromColor = target.color.clone();\r\n            this._toColor = color;\r\n            this.time = 0;\r\n            this._transitionFinished = false;\r\n        }\r\n    },\r\n\r\n    _updateSpriteTransition (state) {\r\n        let sprite = this._getStateSprite(state);\r\n        if (this._sprite && sprite) {\r\n            this._sprite.spriteFrame = sprite;\r\n        }\r\n    },\r\n\r\n    _updateScaleTransition (state) {\r\n        if (state === State.PRESSED) {\r\n            this._zoomUp();\r\n        } else {\r\n            this._zoomBack();\r\n        }\r\n    },\r\n\r\n    _zoomUp () {\r\n        this._fromScale = this._originalScale;\r\n        this._toScale = this._originalScale * this.zoomScale;\r\n        this.time = 0;\r\n        this._transitionFinished = false;\r\n    },\r\n\r\n    _zoomBack () {\r\n        let target = this._getTarget();\r\n        this._fromScale = target.scale;\r\n        this._toScale = this._originalScale;\r\n        this.time = 0;\r\n        this._transitionFinished = false;\r\n    },\r\n\r\n    _updateTransition (oldTransition) {\r\n        // Reset to normal data when change transition.\r\n        if (oldTransition === Transition.COLOR) {\r\n            this._updateColorTransitionImmediately(State.NORMAL);\r\n        }\r\n        else if (oldTransition === Transition.SPRITE) {\r\n            this._updateSpriteTransition(State.NORMAL);\r\n        }\r\n        this._updateState();\r\n    },\r\n\r\n    _applyTransition (state) {\r\n        let transition = this.transition;\r\n        if (transition === Transition.COLOR) {\r\n            this._updateColorTransition(state);\r\n        } else if (transition === Transition.SPRITE) {\r\n            this._updateSpriteTransition(state);\r\n        } else if (transition === Transition.SCALE) {\r\n            this._updateScaleTransition(state);\r\n        }\r\n    },\r\n\r\n    _resizeNodeToTargetNode: CC_EDITOR && function () {\r\n        this.node.setContentSize(this._getTarget().getContentSize());\r\n    },\r\n\r\n    _updateDisabledState () {\r\n        if (this._sprite) {\r\n            if (this.enableAutoGrayEffect) {\r\n                if (!(this.transition === Transition.SPRITE && this.disabledSprite)) {\r\n                    if (!this.interactable) {\r\n                        this._sprite.setState(cc.Sprite.State.GRAY);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this._sprite.setState(cc.Sprite.State.NORMAL);\r\n        }\r\n    }\r\n});\r\n\r\ncc.Button = module.exports = Button;\r\n\r\n/**\r\n * !#en\r\n * Note: This event is emitted from the node to which the component belongs.\r\n * !#zh\r\n *  Node  node.on \r\n * @event click\r\n * @param {Event.EventCustom} event\r\n * @param {Button} button - The Button component.\r\n */\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar Camera = require('../camera/CCCamera');\r\nvar Component = require('./CCComponent');\r\n\r\n/**\r\n * !#zh:  UI \r\n *  anchorPoint  (0.5, 0.5)\r\n *\r\n * @class Canvas\r\n * @extends Component\r\n */\r\nvar Canvas = cc.Class({\r\n    name: 'cc.Canvas',\r\n    extends: Component,\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.ui/Canvas',\r\n        help: 'i18n:COMPONENT.help_url.canvas',\r\n        executeInEditMode: true,\r\n        disallowMultiple: true,\r\n    },\r\n\r\n    resetInEditor: CC_EDITOR && function () {\r\n        _Scene._applyCanvasPreferences(this);\r\n    },\r\n\r\n    statics: {\r\n        /**\r\n         * !#en Current active canvas, the scene should only have one active canvas at the same time.\r\n         * !#zh \r\n         * @property {Canvas} instance\r\n         * @static\r\n         */\r\n        instance: null\r\n    },\r\n\r\n    properties: {\r\n\r\n        /**\r\n         * !#en The desigin resolution for current scene.\r\n         * !#zh \r\n         * @property {Size} designResolution\r\n         * @default new cc.Size(960, 640)\r\n         */\r\n        _designResolution: cc.size(960, 640),\r\n        designResolution: {\r\n            get: function () {\r\n                return cc.size(this._designResolution);\r\n            },\r\n            set: function (value) {\r\n                this._designResolution.width = value.width;\r\n                this._designResolution.height = value.height;\r\n                this.applySettings();\r\n                this.alignWithScreen();\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.canvas.design_resolution'\r\n        },\r\n\r\n        _fitWidth: false,\r\n        _fitHeight: true,\r\n\r\n        /**\r\n         * !#en TODO\r\n         * !#zh: \r\n         * @property {Boolean} fitHeight\r\n         * @default false\r\n         */\r\n        fitHeight: {\r\n            get: function () {\r\n                return this._fitHeight;\r\n            },\r\n            set: function (value) {\r\n                if (this._fitHeight !== value) {\r\n                    this._fitHeight = value;\r\n                    this.applySettings();\r\n                    this.alignWithScreen();\r\n                }\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.canvas.fit_height'\r\n        },\r\n\r\n        /**\r\n         * !#en TODO\r\n         * !#zh: \r\n         * @property {Boolean} fitWidth\r\n         * @default false\r\n         */\r\n        fitWidth: {\r\n            get: function () {\r\n                return this._fitWidth;\r\n            },\r\n            set: function (value) {\r\n                if (this._fitWidth !== value) {\r\n                    this._fitWidth = value;\r\n                    this.applySettings();\r\n                    this.alignWithScreen();\r\n                }\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.canvas.fit_width'\r\n        }\r\n    },\r\n\r\n    ctor: function () {\r\n        this._thisOnResized = this.alignWithScreen.bind(this);\r\n    },\r\n\r\n    __preload: function () {\r\n        if (CC_DEV) {\r\n            var Flags = cc.Object.Flags;\r\n            this._objFlags |= (Flags.IsPositionLocked | Flags.IsAnchorLocked | Flags.IsSizeLocked);\r\n        }\r\n\r\n        if (Canvas.instance) {\r\n            return cc.errorID(6700,\r\n                this.node.name, Canvas.instance.node.name);\r\n        }\r\n        Canvas.instance = this;\r\n\r\n        if (CC_EDITOR) {\r\n            cc.engine.on('design-resolution-changed', this._thisOnResized);\r\n        }\r\n        else {\r\n            if (cc.sys.isMobile) {\r\n                window.addEventListener('resize', this._thisOnResized);\r\n            }\r\n            else {\r\n                cc.view.on('canvas-resize', this._thisOnResized);\r\n            }\r\n        }\r\n\r\n        this.applySettings();\r\n        this.alignWithScreen();\r\n\r\n        // Camera could be removed in canvas render mode\r\n        let cameraNode = cc.find('Main Camera', this.node);\r\n        if (!cameraNode) {\r\n            cameraNode = new cc.Node('Main Camera');\r\n            cameraNode.parent = this.node;\r\n            cameraNode.setSiblingIndex(0);\r\n        }\r\n        let camera = cameraNode.getComponent(Camera);\r\n        if (!camera) {\r\n            camera = cameraNode.addComponent(Camera);\r\n\r\n            let ClearFlags = Camera.ClearFlags;\r\n            camera.clearFlags = ClearFlags.COLOR | ClearFlags.DEPTH | ClearFlags.STENCIL;\r\n            camera.depth = -1;\r\n        }\r\n        Camera.main = camera;\r\n    },\r\n\r\n    onDestroy: function () {\r\n        if (CC_EDITOR) {\r\n            cc.engine.off('design-resolution-changed', this._thisOnResized);\r\n        }\r\n        else {\r\n            if (cc.sys.isMobile) {\r\n                window.removeEventListener('resize', this._thisOnResized);\r\n            }\r\n            else {\r\n                cc.view.off('canvas-resize', this._thisOnResized);\r\n            }\r\n        }\r\n\r\n        if (Canvas.instance === this) {\r\n            Canvas.instance = null;\r\n        }\r\n    },\r\n\r\n    //\r\n\r\n    alignWithScreen: function () {\r\n        var designSize, nodeSize;\r\n        if (CC_EDITOR) {\r\n            nodeSize = designSize = cc.engine.getDesignResolutionSize();\r\n            this.node.setPosition(designSize.width * 0.5, designSize.height * 0.5);\r\n        }\r\n        else {\r\n            var canvasSize = nodeSize = cc.visibleRect;\r\n            designSize = cc.view.getDesignResolutionSize();\r\n            var clipTopRight = !this.fitHeight && !this.fitWidth;\r\n            var offsetX = 0;\r\n            var offsetY = 0;\r\n            if (clipTopRight) {\r\n                // offset the canvas to make it in the center of screen\r\n                offsetX = (designSize.width - canvasSize.width) * 0.5;\r\n                offsetY = (designSize.height - canvasSize.height) * 0.5;\r\n            }\r\n            this.node.setPosition(canvasSize.width * 0.5 + offsetX, canvasSize.height * 0.5 + offsetY);\r\n        }\r\n        this.node.width = nodeSize.width;\r\n        this.node.height = nodeSize.height;\r\n    },\r\n\r\n    applySettings: function () {\r\n        var ResolutionPolicy = cc.ResolutionPolicy;\r\n        var policy;\r\n\r\n        if (this.fitHeight && this.fitWidth) {\r\n            policy = ResolutionPolicy.SHOW_ALL;\r\n        }\r\n        else if (!this.fitHeight && !this.fitWidth) {\r\n            policy = ResolutionPolicy.NO_BORDER;\r\n        }\r\n        else if (this.fitWidth) {\r\n            policy = ResolutionPolicy.FIXED_WIDTH;\r\n        }\r\n        else {      // fitHeight\r\n            policy = ResolutionPolicy.FIXED_HEIGHT;\r\n        }\r\n\r\n        var designRes = this._designResolution;\r\n        if (CC_EDITOR) {\r\n            cc.engine.setDesignResolutionSize(designRes.width, designRes.height);\r\n        }\r\n        else {\r\n            cc.view.setDesignResolutionSize(designRes.width, designRes.height, policy);\r\n        }\r\n    }\r\n});\r\n\r\n\r\ncc.Canvas = module.exports = Canvas;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar CCObject = require('../platform/CCObject');\r\nvar js = require('../platform/js');\r\nvar idGenerater = new (require('../platform/id-generater'))('Comp');\r\n\r\nvar IsOnEnableCalled = CCObject.Flags.IsOnEnableCalled;\r\nvar IsOnLoadCalled = CCObject.Flags.IsOnLoadCalled;\r\n\r\n/**\r\n * !#en\r\n * Base class for everything attached to Node(Entity).<br/>\r\n * <br/>\r\n * NOTE: Not allowed to use construction parameters for Component's subclasses,\r\n *       because Component is created by the engine.\r\n * !#zh\r\n * <br/>\r\n * <br/>\r\n * \r\n *\r\n * @class Component\r\n * @extends Object\r\n */\r\nvar Component = cc.Class({\r\n    name: 'cc.Component',\r\n    extends: CCObject,\r\n\r\n    ctor: CC_EDITOR ? function () {\r\n        if (window._Scene && _Scene.AssetsWatcher) {\r\n            _Scene.AssetsWatcher.initComponent(this);\r\n        }\r\n        this._id = Editor.Utils.UuidUtils.uuid();\r\n\r\n        /**\r\n         * Register all related EventTargets,\r\n         * all event callbacks will be removed in _onPreDestroy\r\n         * @property {Array} __eventTargets\r\n         * @private\r\n         */\r\n        this.__eventTargets = [];\r\n    } : function () {\r\n        this._id = idGenerater.getNewId();\r\n\r\n        this.__eventTargets = [];\r\n    },\r\n\r\n    properties: {\r\n        /**\r\n         * !#en The node this component is attached to. A component is always attached to a node.\r\n         * !#zh \r\n         * @property node\r\n         * @type {Node}\r\n         * @example\r\n         * cc.log(comp.node);\r\n         */\r\n        node: {\r\n            default: null,\r\n            visible: false\r\n        },\r\n\r\n        name: {\r\n            get () {\r\n                if (this._name) {\r\n                    return this._name;\r\n                }\r\n                var className = cc.js.getClassName(this);\r\n                var trimLeft = className.lastIndexOf('.');\r\n                if (trimLeft >= 0) {\r\n                    className = className.slice(trimLeft + 1);\r\n                }\r\n                return this.node.name + '<' + className + '>';\r\n            },\r\n            set (value) {\r\n                this._name = value;\r\n            },\r\n            visible: false\r\n        },\r\n\r\n        /**\r\n         * !#en The uuid for editor.\r\n         * !#zh  uuid\r\n         * @property uuid\r\n         * @type {String}\r\n         * @readOnly\r\n         * @example\r\n         * cc.log(comp.uuid);\r\n         */\r\n        uuid: {\r\n            get () {\r\n                return this._id;\r\n            },\r\n            visible: false\r\n        },\r\n\r\n        __scriptAsset: CC_EDITOR && {\r\n            get () {},\r\n            //set (value) {\r\n            //    if (this.__scriptUuid !== value) {\r\n            //        if (value && Editor.Utils.UuidUtils.isUuid(value._uuid)) {\r\n            //            var classId = Editor.Utils.UuidUtils.compressUuid(value._uuid);\r\n            //            var NewComp = cc.js._getClassById(classId);\r\n            //            if (js.isChildClassOf(NewComp, cc.Component)) {\r\n            //                cc.warn('Sorry, replacing component script is not yet implemented.');\r\n            //                //Editor.Ipc.sendToWins('reload:window-scripts', Editor._Sandbox.compiled);\r\n            //            }\r\n            //            else {\r\n            //                cc.error('Can not find a component in the script which uuid is \"%s\".', value._uuid);\r\n            //            }\r\n            //        }\r\n            //        else {\r\n            //            cc.error('Invalid Script');\r\n            //        }\r\n            //    }\r\n            //},\r\n            displayName: 'Script',\r\n            type: cc._Script,\r\n            tooltip: CC_DEV && 'i18n:INSPECTOR.component.script'\r\n        },\r\n\r\n        /**\r\n         * @property _enabled\r\n         * @type {Boolean}\r\n         * @private\r\n         */\r\n        _enabled: true,\r\n\r\n        /**\r\n         * !#en indicates whether this component is enabled or not.\r\n         * !#zh \r\n         * @property enabled\r\n         * @type {Boolean}\r\n         * @default true\r\n         * @example\r\n         * comp.enabled = true;\r\n         * cc.log(comp.enabled);\r\n         */\r\n        enabled: {\r\n            get () {\r\n                return this._enabled;\r\n            },\r\n            set (value) {\r\n                if (this._enabled !== value) {\r\n                    this._enabled = value;\r\n                    if (this.node._activeInHierarchy) {\r\n                        var compScheduler = cc.director._compScheduler;\r\n                        if (value) {\r\n                            compScheduler.enableComp(this);\r\n                        }\r\n                        else {\r\n                            compScheduler.disableComp(this);\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            visible: false\r\n        },\r\n\r\n        /**\r\n         * !#en indicates whether this component is enabled and its node is also active in the hierarchy.\r\n         * !#zh \r\n         * @property enabledInHierarchy\r\n         * @type {Boolean}\r\n         * @readOnly\r\n         * @example\r\n         * cc.log(comp.enabledInHierarchy);\r\n         */\r\n        enabledInHierarchy: {\r\n            get () {\r\n                return (this._objFlags & IsOnEnableCalled) > 0;\r\n            },\r\n            visible: false\r\n        },\r\n\r\n        /**\r\n         * !#en Returns a value which used to indicate the onLoad get called or not.\r\n         * !#zh  onLoad  0  0 \r\n         * @property _isOnLoadCalled\r\n         * @type {Number}\r\n         * @readOnly\r\n         * @example\r\n         * cc.log(this._isOnLoadCalled > 0);\r\n         */\r\n        _isOnLoadCalled: {\r\n            get () {\r\n                return this._objFlags & IsOnLoadCalled;\r\n            }\r\n        },\r\n    },\r\n\r\n    // LIFECYCLE METHODS\r\n\r\n    // Fireball provides lifecycle methods that you can specify to hook into this process.\r\n    // We provide Pre methods, which are called right before something happens, and Post methods which are called right after something happens.\r\n\r\n    /**\r\n     * !#en Update is called every frame, if the Component is enabled.<br/>\r\n     * This is a lifecycle method. It may not be implemented in the super class. You can only call its super class method inside it. It should not be called manually elsewhere.\r\n     * !#zh  update<br/>\r\n     * \r\n     * @method update\r\n     * @param {Number} dt - the delta time in seconds it took to complete the last frame\r\n     * @protected\r\n     */\r\n    update: null,\r\n\r\n    /**\r\n     * !#en LateUpdate is called every frame, if the Component is enabled.<br/>\r\n     * This is a lifecycle method. It may not be implemented in the super class. You can only call its super class method inside it. It should not be called manually elsewhere.\r\n     * !#zh  LateUpdate<br/>\r\n     * \r\n     * @method lateUpdate\r\n     * @protected\r\n     */\r\n    lateUpdate: null,\r\n\r\n    /**\r\n     * `__preload` is called before every onLoad.\r\n     * It is used to initialize the builtin components internally,\r\n     * to avoid checking whether onLoad is called before every public method calls.\r\n     * This method should be removed if script priority is supported.\r\n     *\r\n     * @method __preload\r\n     * @private\r\n     */\r\n    __preload: null,\r\n\r\n    /**\r\n     * !#en\r\n     * When attaching to an active node or its node first activated.\r\n     * onLoad is always called before any start functions, this allows you to order initialization of scripts.<br/>\r\n     * This is a lifecycle method. It may not be implemented in the super class. You can only call its super class method inside it. It should not be called manually elsewhere.\r\n     * !#zh\r\n     * onLoad  start <br/>\r\n     * \r\n     * @method onLoad\r\n     * @protected\r\n     */\r\n    onLoad: null,\r\n\r\n    /**\r\n     * !#en\r\n     * Called before all scripts' update if the Component is enabled the first time.\r\n     * Usually used to initialize some logic which need to be called after all components' `onload` methods called.<br/>\r\n     * This is a lifecycle method. It may not be implemented in the super class. You can only call its super class method inside it. It should not be called manually elsewhere.\r\n     * !#zh\r\n     *  update  onLoad <br/>\r\n     * \r\n     * @method start\r\n     * @protected\r\n     */\r\n    start: null,\r\n\r\n    /**\r\n     * !#en Called when this component becomes enabled and its node is active.<br/>\r\n     * This is a lifecycle method. It may not be implemented in the super class. You can only call its super class method inside it. It should not be called manually elsewhere.\r\n     * !#zh <br/>\r\n     * \r\n     * @method onEnable\r\n     * @protected\r\n     */\r\n    onEnable: null,\r\n\r\n    /**\r\n     * !#en Called when this component becomes disabled or its node becomes inactive.<br/>\r\n     * This is a lifecycle method. It may not be implemented in the super class. You can only call its super class method inside it. It should not be called manually elsewhere.\r\n     * !#zh <br/>\r\n     * \r\n     * @method onDisable\r\n     * @protected\r\n     */\r\n    onDisable: null,\r\n\r\n    /**\r\n     * !#en Called when this component will be destroyed.<br/>\r\n     * This is a lifecycle method. It may not be implemented in the super class. You can only call its super class method inside it. It should not be called manually elsewhere.\r\n     * !#zh <br/>\r\n     * \r\n     * @method onDestroy\r\n     * @protected\r\n     */\r\n    onDestroy: null,\r\n\r\n    /**\r\n     * @method onFocusInEditor\r\n     * @protected\r\n     */\r\n    onFocusInEditor: null,\r\n    /**\r\n     * @method onLostFocusInEditor\r\n     * @protected\r\n     */\r\n    onLostFocusInEditor: null,\r\n    /**\r\n     * !#en Called to initialize the component or nodes properties when adding the component the first time or when the Reset command is used. This function is only called in editor.\r\n     * !#zh  Reset \r\n     * @method resetInEditor\r\n     * @protected\r\n     */\r\n    resetInEditor: null,\r\n\r\n    // PUBLIC\r\n\r\n    /**\r\n     * !#en Adds a component class to the node. You can also add component to node by passing in the name of the script.\r\n     * !#zh \r\n     *\r\n     * @method addComponent\r\n     * @param {Function|String} typeOrClassName - the constructor or the class name of the component to add\r\n     * @return {Component} - the newly added component\r\n     * @example\r\n     * var sprite = node.addComponent(cc.Sprite);\r\n     * var test = node.addComponent(\"Test\");\r\n     * @typescript\r\n     * addComponent<T extends Component>(type: {new(): T}): T\r\n     * addComponent(className: string): any\r\n     */\r\n    addComponent (typeOrClassName) {\r\n        return this.node.addComponent(typeOrClassName);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the component of supplied type if the node has one attached, null if it doesn't.<br/>\r\n     * You can also get component in the node by passing in the name of the script.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     *\r\n     * @method getComponent\r\n     * @param {Function|String} typeOrClassName\r\n     * @return {Component}\r\n     * @example\r\n     * // get sprite component.\r\n     * var sprite = node.getComponent(cc.Sprite);\r\n     * // get custom test calss.\r\n     * var test = node.getComponent(\"Test\");\r\n     * @typescript\r\n     * getComponent<T extends Component>(type: {prototype: T}): T\r\n     * getComponent(className: string): any\r\n     */\r\n    getComponent (typeOrClassName) {\r\n        return this.node.getComponent(typeOrClassName);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns all components of supplied Type in the node.\r\n     * !#zh \r\n     *\r\n     * @method getComponents\r\n     * @param {Function|String} typeOrClassName\r\n     * @return {Component[]}\r\n     * @example\r\n     * var sprites = node.getComponents(cc.Sprite);\r\n     * var tests = node.getComponents(\"Test\");\r\n     * @typescript\r\n     * getComponents<T extends Component>(type: {prototype: T}): T[]\r\n     * getComponents(className: string): any[]\r\n     */\r\n    getComponents (typeOrClassName) {\r\n        return this.node.getComponents(typeOrClassName);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the component of supplied type in any of its children using depth first search.\r\n     * !#zh \r\n     *\r\n     * @method getComponentInChildren\r\n     * @param {Function|String} typeOrClassName\r\n     * @returns {Component}\r\n     * @example\r\n     * var sprite = node.getComponentInChildren(cc.Sprite);\r\n     * var Test = node.getComponentInChildren(\"Test\");\r\n     * @typescript\r\n     * getComponentInChildren<T extends Component>(type: {prototype: T}): T\r\n     * getComponentInChildren(className: string): any\r\n     */\r\n    getComponentInChildren (typeOrClassName) {\r\n        return this.node.getComponentInChildren(typeOrClassName);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the components of supplied type in self or any of its children using depth first search.\r\n     * !#zh \r\n     *\r\n     * @method getComponentsInChildren\r\n     * @param {Function|String} typeOrClassName\r\n     * @returns {Component[]}\r\n     * @example\r\n     * var sprites = node.getComponentsInChildren(cc.Sprite);\r\n     * var tests = node.getComponentsInChildren(\"Test\");\r\n     * @typescript\r\n     * getComponentsInChildren<T extends Component>(type: {prototype: T}): T[]\r\n     * getComponentsInChildren(className: string): any[]\r\n     */\r\n    getComponentsInChildren (typeOrClassName) {\r\n        return this.node.getComponentsInChildren(typeOrClassName);\r\n    },\r\n\r\n    // VIRTUAL\r\n\r\n    /**\r\n     * !#en\r\n     * If the component's bounding box is different from the node's, you can implement this method to supply\r\n     * a custom axis aligned bounding box (AABB), so the editor's scene view can perform hit test properly.\r\n     * !#zh\r\n     * AABB\r\n     * \r\n     *\r\n     * @method _getLocalBounds\r\n     * @param {Rect} out_rect - the Rect to receive the bounding box\r\n     */\r\n    _getLocalBounds: null,\r\n\r\n    /**\r\n     * !#en\r\n     * onRestore is called after the user clicks the Reset item in the Inspector's context menu or performs\r\n     * an undo operation on this component.<br/>\r\n     * <br/>\r\n     * If the component contains the \"internal state\", short for \"temporary member variables which not included<br/>\r\n     * in its CCClass properties\", then you may need to implement this function.<br/>\r\n     * <br/>\r\n     * The editor will call the getset accessors of your component to record/restore the component's state<br/>\r\n     * for undo/redo operation. However, in extreme cases, it may not works well. Then you should implement<br/>\r\n     * this function to manually synchronize your component's \"internal states\" with its public properties.<br/>\r\n     * Once you implement this function, all the getset accessors of your component will not be called when<br/>\r\n     * the user performs an undo/redo operation. Which means that only the properties with default value<br/>\r\n     * will be recorded or restored by editor.<br/>\r\n     * <br/>\r\n     * Similarly, the editor may failed to reset your component correctly in extreme cases. Then if you need<br/>\r\n     * to support the reset menu, you should manually synchronize your component's \"internal states\" with its<br/>\r\n     * properties in this function. Once you implement this function, all the getset accessors of your component<br/>\r\n     * will not be called during reset operation. Which means that only the properties with default value<br/>\r\n     * will be reset by editor.\r\n     *\r\n     * This function is only called in editor mode.\r\n     * !#zh\r\n     * onRestore  Reset <br/>\r\n     * <br/>\r\n     *  CCClass <br/>\r\n     * <br/>\r\n     * / get set \r\n     * <br/>\r\n     * \r\n     *  get set \r\n     * <br/>\r\n     * <br/>\r\n     * <br/>\r\n     * <br/>\r\n     *  get set \r\n     * \r\n     * <br/>\r\n     * \r\n     * @method onRestore\r\n     */\r\n    onRestore: null,\r\n\r\n    // OVERRIDE\r\n\r\n    destroy () {\r\n        if (CC_EDITOR) {\r\n            var depend = this.node._getDependComponent(this);\r\n            if (depend) {\r\n                return cc.errorID(3626,\r\n                    cc.js.getClassName(this), cc.js.getClassName(depend));\r\n            }\r\n        }\r\n        if (this._super()) {\r\n            if (this._enabled && this.node._activeInHierarchy) {\r\n                cc.director._compScheduler.disableComp(this);\r\n            }\r\n        }\r\n    },\r\n\r\n    _onPreDestroy () {\r\n        // Schedules\r\n        this.unscheduleAllCallbacks();\r\n\r\n        // Remove all listeners\r\n        var eventTargets = this.__eventTargets;\r\n        for (var i = 0, l = eventTargets.length; i < l; ++i) {\r\n            var target = eventTargets[i];\r\n            target && target.targetOff(this);\r\n        }\r\n        eventTargets.length = 0;\r\n\r\n        //\r\n        if (CC_EDITOR && !CC_TEST) {\r\n            _Scene.AssetsWatcher.stop(this);\r\n        }\r\n\r\n        // onDestroy\r\n        cc.director._nodeActivator.destroyComp(this);\r\n\r\n        // do remove component\r\n        this.node._removeComponent(this);\r\n    },\r\n\r\n    _instantiate (cloned) {\r\n        if (!cloned) {\r\n            cloned = cc.instantiate._clone(this, this);\r\n        }\r\n        cloned.node = null;\r\n        return cloned;\r\n    },\r\n\r\n// Scheduler\r\n\r\n    /**\r\n     * !#en\r\n     * Schedules a custom selector.<br/>\r\n     * If the selector is already scheduled, then the interval parameter will be updated without scheduling it again.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method schedule\r\n     * @param {function} callback The callback function\r\n     * @param {Number} [interval=0]  Tick interval in seconds. 0 means tick every frame.\r\n     * @param {Number} [repeat=cc.macro.REPEAT_FOREVER]    The selector will be executed (repeat + 1) times, you can use cc.macro.REPEAT_FOREVER for tick infinitely.\r\n     * @param {Number} [delay=0]     The amount of time that the first tick will wait before execution.\r\n     * @example\r\n     * var timeCallback = function (dt) {\r\n     *   cc.log(\"time: \" + dt);\r\n     * }\r\n     * this.schedule(timeCallback, 1);\r\n     */\r\n    schedule (callback, interval, repeat, delay) {\r\n        cc.assertID(callback, 1619);\r\n        cc.assertID(interval >= 0, 1620);\r\n\r\n        interval = interval || 0;\r\n        repeat = isNaN(repeat) ? cc.macro.REPEAT_FOREVER : repeat;\r\n        delay = delay || 0;\r\n\r\n        var scheduler = cc.director.getScheduler();\r\n\r\n        // should not use enabledInHierarchy to judge whether paused,\r\n        // because enabledInHierarchy is assigned after onEnable.\r\n        // Actually, if not yet scheduled, resumeTarget/pauseTarget has no effect on component,\r\n        // therefore there is no way to guarantee the paused state other than isTargetPaused.\r\n        var paused = scheduler.isTargetPaused(this);\r\n\r\n        scheduler.schedule(callback, this, interval, repeat, delay, paused);\r\n    },\r\n\r\n    /**\r\n     * !#en Schedules a callback function that runs only once, with a delay of 0 or larger.\r\n     * !#zh  0 \r\n     * @method scheduleOnce\r\n     * @see cc.Node#schedule\r\n     * @param {function} callback  A function wrapped as a selector\r\n     * @param {Number} [delay=0]  The amount of time that the first tick will wait before execution.\r\n     * @example\r\n     * var timeCallback = function (dt) {\r\n     *   cc.log(\"time: \" + dt);\r\n     * }\r\n     * this.scheduleOnce(timeCallback, 2);\r\n     */\r\n    scheduleOnce (callback, delay) {\r\n        this.schedule(callback, 0, 0, delay);\r\n    },\r\n\r\n    /**\r\n     * !#en Unschedules a custom callback function.\r\n     * !#zh \r\n     * @method unschedule\r\n     * @see cc.Node#schedule\r\n     * @param {function} callback_fn  A function wrapped as a selector\r\n     * @example\r\n     * this.unschedule(_callback);\r\n     */\r\n    unschedule (callback_fn) {\r\n        if (!callback_fn)\r\n            return;\r\n\r\n        cc.director.getScheduler().unschedule(callback_fn, this);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * unschedule all scheduled callback functions: custom callback functions, and the 'update' callback function.<br/>\r\n     * Actions are not affected by this method.\r\n     * !#zh  'update' \r\n     * @method unscheduleAllCallbacks\r\n     * @example\r\n     * this.unscheduleAllCallbacks();\r\n     */\r\n    unscheduleAllCallbacks () {\r\n        cc.director.getScheduler().unscheduleAllForTarget(this);\r\n    },\r\n});\r\n\r\nComponent._requireComponent = null;\r\nComponent._executionOrder = 0;\r\n\r\nif (CC_EDITOR || CC_TEST) {\r\n\r\n    // INHERITABLE STATIC MEMBERS\r\n\r\n    Component._executeInEditMode = false;\r\n    Component._playOnFocus = false;\r\n    Component._disallowMultiple = null;\r\n    Component._help = '';\r\n\r\n    // NON-INHERITED STATIC MEMBERS\r\n    // (TypeScript 2.3 will still inherit them, so always check hasOwnProperty before using)\r\n\r\n    js.value(Component, '_inspector', '', true);\r\n    js.value(Component, '_icon', '', true);\r\n\r\n    // COMPONENT HELPERS\r\n\r\n    cc._componentMenuItems = [];\r\n\r\n    Component._addMenuItem = function (cls, path, priority) {\r\n        cc._componentMenuItems.push({\r\n            component: cls,\r\n            menuPath: path,\r\n            priority: priority\r\n        });\r\n    };\r\n}\r\n\r\n// we make this non-enumerable, to prevent inherited by sub classes.\r\njs.value(Component, '_registerEditorProps', function (cls, props) {\r\n    var reqComp = props.requireComponent;\r\n    if (reqComp) {\r\n        cls._requireComponent = reqComp;\r\n    }\r\n    var order = props.executionOrder;\r\n    if (order && typeof order === 'number') {\r\n        cls._executionOrder = order;\r\n    }\r\n    if (CC_EDITOR || CC_TEST) {\r\n        var name = cc.js.getClassName(cls);\r\n        for (var key in props) {\r\n            var val = props[key];\r\n            switch (key) {\r\n                case 'executeInEditMode':\r\n                    cls._executeInEditMode = !!val;\r\n                    break;\r\n\r\n                case 'playOnFocus':\r\n                    if (val) {\r\n                        var willExecuteInEditMode = ('executeInEditMode' in props) ? props.executeInEditMode : cls._executeInEditMode;\r\n                        if (willExecuteInEditMode) {\r\n                            cls._playOnFocus = true;\r\n                        }\r\n                        else {\r\n                            cc.warnID(3601, name);\r\n                        }\r\n                    }\r\n                    break;\r\n\r\n                case 'inspector':\r\n                    js.value(cls, '_inspector', val, true);\r\n                    break;\r\n\r\n                case 'icon':\r\n                    js.value(cls, '_icon', val, true);\r\n                    break;\r\n\r\n                case 'menu':\r\n                    Component._addMenuItem(cls, val, props.menuPriority);\r\n                    break;\r\n\r\n                case 'disallowMultiple':\r\n                    cls._disallowMultiple = cls;\r\n                    break;\r\n\r\n                case 'requireComponent':\r\n                case 'executionOrder':\r\n                    // skip here\r\n                    break;\r\n\r\n                case 'help':\r\n                    cls._help = val;\r\n                    break;\r\n\r\n                default:\r\n                    cc.warnID(3602, key, name);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\nComponent.prototype.__scriptUuid = '';\r\n\r\ncc.Component = module.exports = Component;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en\r\n * Component will register a event to target component's handler.\r\n * And it will trigger the handler when a certain event occurs.\r\n *\r\n * !@zh\r\n * EventHandler \r\n * \r\n *  emit \r\n * @class Component.EventHandler\r\n * @example\r\n * // Create new EventHandler\r\n * var eventHandler = new cc.Component.EventHandler();\r\n * eventHandler.target = newTarget;\r\n * eventHandler.component = \"MainMenu\";\r\n * eventHandler.handler = \"OnClick\";\r\n * eventHandler.customEventData = \"my data\";\r\n */\r\ncc.Component.EventHandler = cc.Class({\r\n    name: 'cc.ClickEvent',\r\n    properties: {\r\n        /**\r\n         * !#en Event target\r\n         * !#zh \r\n         * @property target\r\n         * @type {Node}\r\n         * @default null\r\n         */\r\n        target: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        /**\r\n         * !#en Component name\r\n         * !#zh \r\n         * @property component\r\n         * @type {String}\r\n         * @default ''\r\n         */\r\n        // only for deserializing old project component field\r\n        component: '',\r\n        _componentId: '',\r\n        _componentName: {\r\n            get () {\r\n                this._genCompIdIfNeeded();\r\n\r\n                return this._compId2Name(this._componentId);\r\n            },\r\n            set (value) {\r\n                this._componentId = this._compName2Id(value);\r\n            },\r\n        },\r\n        /**\r\n         * !#en Event handler\r\n         * !#zh \r\n         * @property handler\r\n         * @type {String}\r\n         * @default ''\r\n         */\r\n        handler: {\r\n            default: '',\r\n        },\r\n\r\n        /**\r\n         * !#en Custom Event Data\r\n         * !#zh \r\n         * @property customEventData\r\n         * @default ''\r\n         * @type {String}\r\n         */\r\n        customEventData: {\r\n            default: ''\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        /**\r\n         * @method emitEvents\r\n         * @param {Component.EventHandler[]} events\r\n         * @param {any} ...params\r\n         * @static\r\n         */\r\n        emitEvents: function(events) {\r\n            'use strict';\r\n            let args;\r\n            if (arguments.length > 0) {\r\n                args = new Array(arguments.length - 1);\r\n                for (let i = 0, l = args.length; i < l; i++) {\r\n                    args[i] = arguments[i+1];\r\n                }\r\n            }\r\n            for (let i = 0, l = events.length; i < l; i++) {\r\n                var event = events[i];\r\n                if (!(event instanceof cc.Component.EventHandler)) continue;\r\n\r\n                event.emit(args);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Emit event with params\r\n     * !#zh  handler \r\n     * @method emit\r\n     * @param {Array} params\r\n     * @example\r\n     * // Call Function\r\n     * var eventHandler = new cc.Component.EventHandler();\r\n     * eventHandler.target = newTarget;\r\n     * eventHandler.component = \"MainMenu\";\r\n     * eventHandler.handler = \"OnClick\"\r\n     * eventHandler.emit([\"param1\", \"param2\", ....]);\r\n     */\r\n    emit: function(params) {\r\n        var target = this.target;\r\n        if (!cc.isValid(target)) return;\r\n\r\n        this._genCompIdIfNeeded();\r\n        var compType = cc.js._getClassById(this._componentId);\r\n        \r\n        var comp = target.getComponent(compType);\r\n        if (!cc.isValid(comp)) return;\r\n\r\n        var handler = comp[this.handler];\r\n        if (typeof(handler) !== 'function') return;\r\n\r\n        if (this.customEventData != null && this.customEventData !== '') {\r\n            params = params.slice();\r\n            params.push(this.customEventData);\r\n        }\r\n\r\n        handler.apply(comp, params);\r\n    },\r\n\r\n    _compName2Id (compName) {\r\n        let comp = cc.js.getClassByName(compName);\r\n        return cc.js._getClassId(comp);\r\n    },\r\n\r\n    _compId2Name (compId) {\r\n        let comp = cc.js._getClassById(compId);\r\n        return cc.js.getClassName(comp);\r\n    },\r\n\r\n    // to be deprecated in the future\r\n    _genCompIdIfNeeded () {\r\n        if (!this._componentId) {\r\n            this._componentName = this.component;\r\n            this.component = '';\r\n        }\r\n    },\r\n});\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst macro = require('../platform/CCMacro');\r\nconst RenderComponent = require('./CCRenderComponent');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst RenderFlow = require('../renderer/render-flow');\r\nconst SpriteMaterial = renderEngine.SpriteMaterial;\r\n\r\n/**\r\n * !#en Enum for text alignment.\r\n * !#zh \r\n * @enum Label.HorizontalAlign\r\n */\r\n/**\r\n * !#en Alignment left for text.\r\n * !#zh \r\n * @property {Number} LEFT\r\n */\r\n/**\r\n * !#en Alignment center for text.\r\n * !#zh \r\n * @property {Number} CENTER\r\n */\r\n/**\r\n * !#en Alignment right for text.\r\n * !#zh \r\n * @property {Number} RIGHT\r\n */\r\nconst HorizontalAlign = macro.TextAlignment;\r\n\r\n/**\r\n * !#en Enum for vertical text alignment.\r\n * !#zh \r\n * @enum Label.VerticalAlign\r\n */\r\n/**\r\n * !#en Vertical alignment top for text.\r\n * !#zh \r\n * @property {Number} TOP\r\n */\r\n/**\r\n * !#en Vertical alignment center for text.\r\n * !#zh \r\n * @property {Number} CENTER\r\n */\r\n/**\r\n * !#en Vertical alignment bottom for text.\r\n * !#zh \r\n * @property {Number} BOTTOM\r\n */\r\nconst VerticalAlign = macro.VerticalTextAlignment;\r\n\r\n/**\r\n * !#en Enum for Overflow.\r\n * !#zh Overflow \r\n * @enum Label.Overflow\r\n */\r\n/**\r\n * !#en NONE.\r\n * !#zh \r\n * @property {Number} NONE\r\n */\r\n/**\r\n * !#en In CLAMP mode, when label content goes out of the bounding box, it will be clipped.\r\n * !#zh CLAMP \r\n * @property {Number} CLAMP\r\n */\r\n/**\r\n * !#en In SHRINK mode, the font size will change dynamically to adapt the content size.\r\n * !#zh SHRINK \r\n * @property {Number} SHRINK\r\n */\r\n/**\r\n * !#en In RESIZE_HEIGHT mode, you can only change the width of label and the height is changed automatically.\r\n * !#zh  RESIZE_HEIGHT \r\n * @property {Number} RESIZE_HEIGHT\r\n */\r\nconst Overflow = cc.Enum({\r\n    NONE: 0,\r\n    CLAMP: 1,\r\n    SHRINK: 2,\r\n    RESIZE_HEIGHT: 3\r\n});\r\n\r\n/**\r\n * !#en Enum for font type.\r\n * !#zh Type \r\n * @enum Label.Type\r\n */\r\n/**\r\n * !#en The TTF font type.\r\n * !#zh TTF\r\n * @property {Number} TTF\r\n */\r\n/**\r\n * !#en The bitmap font type.\r\n * !#zh \r\n * @property {Number} BMFont\r\n */\r\n/**\r\n * !#en The system font type.\r\n * !#zh \r\n * @property {Number} SystemFont\r\n */\r\n\r\n/**\r\n * !#en The Label Component.\r\n * !#zh \r\n * @class Label\r\n * @extends RenderComponent\r\n */\r\nlet Label = cc.Class({\r\n    name: 'cc.Label',\r\n    extends: RenderComponent,\r\n\r\n    ctor () {\r\n        if (CC_EDITOR) {\r\n            this._userDefinedFont = null;\r\n        }\r\n\r\n        this._actualFontSize = 0;\r\n        this._assemblerData = null;\r\n\r\n        this._ttfTexture = null;\r\n    },\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.renderers/Label',\r\n        help: 'i18n:COMPONENT.help_url.label',\r\n        inspector: 'packages://inspector/inspectors/comps/label.js',\r\n    },\r\n\r\n    properties: {\r\n        _useOriginalSize: true,\r\n        \r\n        /**\r\n         * !#en Content string of label.\r\n         * !#zh \r\n         * @property {String} string\r\n         */\r\n        _string: {\r\n            default: '',\r\n            formerlySerializedAs: '_N$string',\r\n        },\r\n        string: {\r\n            get () {\r\n                return this._string;\r\n            },\r\n            set (value) {\r\n                let oldValue = this._string;\r\n                this._string = value.toString();\r\n\r\n                if (this.string !== oldValue) {\r\n                    this._updateRenderData();\r\n                }\r\n\r\n                this._checkStringEmpty();\r\n            },\r\n            multiline: true,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.string'\r\n        },\r\n\r\n        /**\r\n         * !#en Horizontal Alignment of label.\r\n         * !#zh \r\n         * @property {Label.HorizontalAlign} horizontalAlign\r\n         */\r\n        horizontalAlign: {\r\n            default: HorizontalAlign.LEFT,\r\n            type: HorizontalAlign,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.horizontal_align',\r\n            notify  (oldValue) {\r\n                if (this.horizontalAlign === oldValue) return;\r\n                this._updateRenderData();\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en Vertical Alignment of label.\r\n         * !#zh \r\n         * @property {Label.VerticalAlign} verticalAlign\r\n         */\r\n        verticalAlign: {\r\n            default: VerticalAlign.TOP,\r\n            type: VerticalAlign,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.vertical_align',\r\n            notify (oldValue) {\r\n                if (this.verticalAlign === oldValue) return;\r\n                this._updateRenderData();\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n\r\n        /**\r\n         * !#en The actual rendering font size in shrink mode\r\n         * !#zh SHRINK \r\n         * @property {Number} actualFontSize\r\n         */\r\n        actualFontSize: {\r\n            displayName: 'Actual Font Size',\r\n            animatable: false,\r\n            readonly: true,\r\n            get () {\r\n                return this._actualFontSize;\r\n            }\r\n        },\r\n\r\n        _fontSize: 40,\r\n        /**\r\n         * !#en Font size of label.\r\n         * !#zh \r\n         * @property {Number} fontSize\r\n         */\r\n        fontSize: {\r\n            get () {\r\n                return this._fontSize;\r\n            },\r\n            set (value) {\r\n                if (this._fontSize === value) return;\r\n\r\n                this._fontSize = value;\r\n                this._updateRenderData();\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.font_size',\r\n        },\r\n\r\n        /**\r\n         * !#en Font family of label, only take effect when useSystemFont property is true.\r\n         * !#zh ,  useSystemFont  true \r\n         * @property {String} fontFamily\r\n         */\r\n        fontFamily: {\r\n            default: \"Arial\",\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.font_family',\r\n            notify (oldValue) {\r\n                if (this.fontFamily === oldValue) return;\r\n                this._updateRenderData();\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        _lineHeight: 40,\r\n        /**\r\n         * !#en Line Height of label.\r\n         * !#zh \r\n         * @property {Number} lineHeight\r\n         */\r\n        lineHeight: {\r\n            get () {\r\n                return this._lineHeight;\r\n            },\r\n            set (value) {\r\n                if (this._lineHeight === value) return;\r\n                this._lineHeight = value;\r\n                this._updateRenderData();\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.line_height',\r\n        },\r\n        /**\r\n         * !#en Overflow of label.\r\n         * !#zh \r\n         * @property {Label.Overflow} overflow\r\n         */\r\n        overflow: {\r\n            default: Overflow.NONE,\r\n            type: Overflow,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.overflow',\r\n            notify (oldValue) {\r\n                if (this.overflow === oldValue) return;\r\n                this._updateRenderData();\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        _enableWrapText: true,\r\n        /**\r\n         * !#en Whether auto wrap label when string width is large than label width.\r\n         * !#zh \r\n         * @property {Boolean} enableWrapText\r\n         */\r\n        enableWrapText: {\r\n            get () {\r\n                return this._enableWrapText;\r\n            },\r\n            set (value) {\r\n                if (this._enableWrapText === value) return;\r\n\r\n                this._enableWrapText = value;\r\n                this._updateRenderData();\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.wrap',\r\n        },\r\n\r\n        //  file \r\n        _N$file: null,\r\n\r\n        /**\r\n         * !#en The font of label.\r\n         * !#zh \r\n         * @property {Font} font\r\n         */\r\n        font: {\r\n            get () {\r\n                return this._N$file;\r\n            },\r\n            set (value) {\r\n                if (this.font === value) return;\r\n                \r\n                //if delete the font, we should change isSystemFontUsed to true\r\n                if (!value) {\r\n                    this._isSystemFontUsed = true;\r\n                }\r\n\r\n                if (CC_EDITOR && value) {\r\n                    this._userDefinedFont = value;\r\n                }\r\n\r\n                this._N$file = value;\r\n                if (value && this._isSystemFontUsed)\r\n                    this._isSystemFontUsed = false;\r\n\r\n                if ( typeof value === 'string' ) {\r\n                    cc.warnID(4000);\r\n                }\r\n\r\n                if (this._renderData) {\r\n                    this.destroyRenderData(this._renderData);\r\n                    this._renderData = null;    \r\n                }\r\n                this._fontAtlas = null;\r\n                this._updateAssembler();\r\n                this._applyFontTexture(true);\r\n                this._updateRenderData();\r\n            },\r\n            type: cc.Font,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.font',\r\n            animatable: false\r\n        },\r\n\r\n        _isSystemFontUsed: true,\r\n\r\n        /**\r\n         * !#en Whether use system font name or not.\r\n         * !#zh \r\n         * @property {Boolean} isSystemFontUsed\r\n         */\r\n        useSystemFont: {\r\n            get () {\r\n                return this._isSystemFontUsed;\r\n            },\r\n            set (value) {\r\n                if (this._isSystemFontUsed === value) return;\r\n                \r\n                this.destroyRenderData(this._renderData);\r\n                this._renderData = null;\r\n\r\n                if (CC_EDITOR) {\r\n                    if (!value && this._isSystemFontUsed && this._userDefinedFont) {\r\n                        this.font = this._userDefinedFont;\r\n                        this.spacingX = this._spacingX;\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                this._isSystemFontUsed = !!value;\r\n                if (value) {\r\n                    this.font = null;\r\n                    this._updateAssembler();\r\n                    this._updateRenderData();\r\n                    this._checkStringEmpty();\r\n                }\r\n                else if (!this._userDefinedFont) {\r\n                    this.disableRender();\r\n                }\r\n\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.label.system_font',\r\n        },\r\n\r\n        _bmFontOriginalSize: {\r\n            displayName: 'BMFont Original Size',\r\n            get () {\r\n                if (this._N$file instanceof cc.BitmapFont) {\r\n                    return this._N$file.fontSize;\r\n                }\r\n                else {\r\n                    return -1;\r\n                }\r\n            },\r\n            visible: true,\r\n            animatable: false\r\n        },\r\n\r\n        _spacingX: 0,\r\n        spacingX: {\r\n            get () {\r\n                return this._spacingX;\r\n            },\r\n            set (value) {\r\n                this._spacingX = value;\r\n                this._updateRenderData();\r\n            }\r\n        },\r\n\r\n        _isBold: {\r\n            default: false,\r\n            serializable: false,\r\n        },\r\n        _isItalic: {\r\n            default: false,\r\n            serializable: false,\r\n        },\r\n        _isUnderline: {\r\n            default: false,\r\n            serializable: false,\r\n        },\r\n    },\r\n\r\n    statics: {\r\n        HorizontalAlign: HorizontalAlign,\r\n        VerticalAlign: VerticalAlign,\r\n        Overflow: Overflow,\r\n    },\r\n\r\n    onEnable () {\r\n        this._super();\r\n\r\n        // TODO: Hack for barbarians\r\n        if (!this.font && !this._isSystemFontUsed) {\r\n            this.useSystemFont = true;\r\n        }\r\n        // Reapply default font family if necessary\r\n        if (this.useSystemFont && !this.fontFamily) {\r\n            this.fontFamily = 'Arial';\r\n        }\r\n\r\n        // Keep track of Node size\r\n        this.node.on(cc.Node.EventType.SIZE_CHANGED, this._updateRenderData, this);\r\n        this.node.on(cc.Node.EventType.ANCHOR_CHANGED, this._updateRenderData, this);\r\n\r\n        this._checkStringEmpty();\r\n        this._updateRenderData(true);\r\n    },\r\n\r\n    onDisable () {\r\n        this._super();\r\n        this.node.off(cc.Node.EventType.SIZE_CHANGED, this._updateRenderData, this);\r\n        this.node.off(cc.Node.EventType.ANCHOR_CHANGED, this._updateRenderData, this);\r\n    },\r\n\r\n    onDestroy () {\r\n        this._assembler._resetAssemblerData && this._assembler._resetAssemblerData(this._assemblerData);\r\n        this._assemblerData = null;\r\n        if (this._ttfTexture) {\r\n            this._ttfTexture.destroy();\r\n            this._ttfTexture = null;\r\n        }\r\n        this._super();\r\n    },\r\n\r\n    _canRender () {\r\n        let result = this._super();\r\n        let font = this.font;\r\n        if (font instanceof cc.BitmapFont) {\r\n            let spriteFrame = font.spriteFrame;\r\n            // cannot be activated if texture not loaded yet\r\n            if (!spriteFrame || !spriteFrame.textureLoaded()) {\r\n                result = false;\r\n            }\r\n        }\r\n        return result;\r\n    },\r\n\r\n    _checkStringEmpty () {\r\n        this.markForRender(!!this.string);\r\n    },\r\n\r\n    _on3DNodeChanged () {\r\n        this._updateAssembler();\r\n    },\r\n\r\n    _updateAssembler () {\r\n        let assembler = Label._assembler.getAssembler(this);\r\n\r\n        if (this._assembler !== assembler) {\r\n            this._assembler = assembler;\r\n            this._renderData = null;\r\n        }\r\n\r\n        if (!this._renderData) {\r\n            this._renderData = this._assembler.createData(this);\r\n            this.markForUpdateRenderData(true);\r\n        }\r\n    },\r\n\r\n    _applyFontTexture (force) {\r\n        let font = this.font;\r\n        if (font instanceof cc.BitmapFont) {\r\n            let spriteFrame = font.spriteFrame;\r\n            let self = this;\r\n            let onBMFontTextureLoaded = function () {\r\n                // TODO: old texture in material have been released by loader\r\n                self._texture = spriteFrame._texture;\r\n                self._activateMaterial(force);\r\n\r\n                if (CC_EDITOR || force) {\r\n                    this._assembler && this._assembler.updateRenderData(this);\r\n                }\r\n            };\r\n            // cannot be activated if texture not loaded yet\r\n            if (spriteFrame && spriteFrame.textureLoaded()) {\r\n                onBMFontTextureLoaded();\r\n            }\r\n            else {\r\n                this.disableRender();\r\n\r\n                if (spriteFrame) {\r\n                    spriteFrame.once('load', onBMFontTextureLoaded, this);\r\n                    spriteFrame.ensureLoadTexture();\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (!this._ttfTexture) {\r\n                this._ttfTexture = new cc.Texture2D();\r\n                // TTF texture in web will blend with canvas or body background color\r\n                if (!CC_JSB) {\r\n                    this._ttfTexture.setPremultiplyAlpha(true);\r\n                }\r\n                this._assemblerData = this._assembler._getAssemblerData();\r\n                this._ttfTexture.initWithElement(this._assemblerData.canvas);\r\n            }\r\n            this._texture = this._ttfTexture;\r\n            this._activateMaterial(force);\r\n\r\n            if (CC_EDITOR || force) {\r\n                this._assembler && this._assembler.updateRenderData(this);\r\n            }\r\n        }\r\n    },\r\n\r\n    _activateMaterial (force) {\r\n        let material = this._material;\r\n        if (material && !force) {\r\n            return;\r\n        }\r\n\r\n        // Canvas\r\n        if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            this._texture.url = this.uuid + '_texture';\r\n        }\r\n        // WebGL\r\n        else {\r\n            if (!material) {\r\n                material = new SpriteMaterial();\r\n            }\r\n            // Setup blend function for premultiplied ttf label texture\r\n            if (this._texture === this._ttfTexture) {\r\n                this._srcBlendFactor = cc.macro.BlendFactor.ONE;\r\n            }\r\n            else {\r\n                this._srcBlendFactor = cc.macro.BlendFactor.SRC_ALPHA;\r\n            }\r\n            material.texture = this._texture;\r\n            // For batch rendering, do not use uniform color.\r\n            material.useColor = false;\r\n            this._updateMaterial(material);\r\n        }\r\n\r\n        this.markForUpdateRenderData(true);\r\n        this.markForRender(true);\r\n    },\r\n\r\n    _updateColor () {\r\n        let font = this.font;\r\n        if (font instanceof cc.BitmapFont) {\r\n            this._super();\r\n        }\r\n        else {\r\n            this._updateRenderData();\r\n            this.node._renderFlag &= ~RenderFlow.FLAG_COLOR;\r\n        }\r\n    },\r\n\r\n    _updateRenderData (force) {\r\n        let renderData = this._renderData;\r\n        if (renderData) {\r\n            renderData.vertDirty = true;\r\n            renderData.uvDirty = true;\r\n            this.markForUpdateRenderData(true);\r\n        }\r\n\r\n        if (CC_EDITOR || force) {\r\n            this._updateAssembler();\r\n            this._applyFontTexture(force);\r\n        }\r\n    },\r\n\r\n    _enableBold (enabled) {\r\n        this._isBold = !!enabled;\r\n    },\r\n\r\n    _enableItalics (enabled) {\r\n        this._isItalic = !!enabled;\r\n    },\r\n\r\n    _enableUnderline (enabled) {\r\n        this._isUnderline = !!enabled;\r\n    },\r\n });\r\n\r\n cc.Label = module.exports = Label;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en Outline effect used to change the display, only used for TTF font\r\n * !#zh ,,\r\n * @class LabelOutline\r\n * @extends Component\r\n * @example\r\n *  // Create a new node and add label components.\r\n *  var node = new cc.Node(\"New Label\");\r\n *  var label = node.addComponent(cc.Label);\r\n *  var outline = node.addComponent(cc.LabelOutline);\r\n *  node.parent = this.node;\r\n */\r\n\r\nlet LabelOutline = cc.Class({\r\n    name: 'cc.LabelOutline',\r\n    extends: require('./CCComponent'),\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.renderers/LabelOutline',\r\n        executeInEditMode: true,\r\n        requireComponent: cc.Label,\r\n    },\r\n\r\n    properties: {\r\n        _color: cc.color(255,255,255,255),\r\n        _width: 1,\r\n\r\n        /**\r\n         * !#en Change the outline color\r\n         * !#zh \r\n         * @property color\r\n         * @type {Color}\r\n         * @example\r\n         * outline.color = new cc.Color(0.5, 0.3, 0.7, 1.0);;\r\n         */\r\n        color: {\r\n            get: function () {\r\n                return this._color;\r\n            },\r\n            set: function (value) {\r\n                this._color = cc.color(value);\r\n                this._updateRenderData();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Change the outline width\r\n         * !#zh \r\n         * @property width\r\n         * @type {Number}\r\n         * @example\r\n         * outline.width = 3;\r\n         */\r\n        width: {\r\n            get: function () {\r\n                return this._width;\r\n            },\r\n            set: function (value) {\r\n                this._width = value;\r\n                this._updateRenderData();\r\n            }\r\n        }\r\n    },\r\n\r\n    onEnable () {\r\n        this._updateRenderData()\r\n    },\r\n\r\n    onDisable () {\r\n        this._updateRenderData()\r\n    },\r\n\r\n    _updateRenderData () {\r\n        let label = this.node.getComponent(cc.Label);\r\n        if (label) {\r\n            label._updateRenderData();\r\n        }\r\n    }\r\n\r\n});\r\n\r\ncc.LabelOutline = module.exports = LabelOutline;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst misc = require('../utils/misc');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst math = renderEngine.math;\r\nconst StencilMaterial = renderEngine.StencilMaterial;\r\nconst RenderComponent = require('./CCRenderComponent');\r\nconst RenderFlow = require('../renderer/render-flow');\r\nconst Graphics = require('../graphics/graphics');\r\nconst Node = require('../CCNode');\r\n\r\nlet _vec2_temp = cc.v2();\r\nlet _mat4_temp = math.mat4.create();\r\n\r\nlet _circlepoints =[];\r\nfunction _calculateCircle (center, radius, segements) {\r\n    _circlepoints.length = 0;\r\n    let anglePerStep = Math.PI * 2 / segements;\r\n    for (let step = 0; step < segements; ++step) {\r\n        _circlepoints.push(cc.v2(radius.x * Math.cos(anglePerStep * step) + center.x,\r\n            radius.y * Math.sin(anglePerStep * step) + center.y));\r\n    }\r\n\r\n    return _circlepoints;\r\n}\r\n\r\n/**\r\n * !#en the type for mask.\r\n * !#zh \r\n * @enum Mask.Type\r\n */\r\nlet MaskType = cc.Enum({\r\n    /**\r\n     * !#en Rect mask.\r\n     * !#zh \r\n     * @property {Number} RECT\r\n     */\r\n    RECT: 0,\r\n    /**\r\n     * !#en Ellipse Mask.\r\n     * !#zh \r\n     * @property {Number} ELLIPSE\r\n     */\r\n    ELLIPSE: 1,\r\n    /**\r\n     * !#en Image Stencil Mask.\r\n     * !#zh \r\n     * @property {Number} IMAGE_STENCIL\r\n     */\r\n    IMAGE_STENCIL: 2,\r\n});\r\n\r\nconst SEGEMENTS_MIN = 3;\r\nconst SEGEMENTS_MAX = 10000;\r\n\r\n/**\r\n * !#en The Mask Component\r\n * !#zh \r\n * @class Mask\r\n * @extends RenderComponent\r\n */\r\nlet Mask = cc.Class({\r\n    name: 'cc.Mask',\r\n    extends: RenderComponent,\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.renderers/Mask',\r\n        help: 'i18n:COMPONENT.help_url.mask',\r\n        inspector: 'packages://inspector/inspectors/comps/mask.js'\r\n    },\r\n\r\n    ctor () {\r\n        this._graphics = null;\r\n        this._clearGraphics = null;\r\n    },\r\n\r\n    properties: {\r\n        _spriteFrame: {\r\n            default: null,\r\n            type: cc.SpriteFrame\r\n        },\r\n\r\n        /**\r\n         * !#en The mask type.\r\n         * !#zh \r\n         * @property type\r\n         * @type {Mask.Type}\r\n         * @example\r\n         * mask.type = cc.Mask.Type.RECT;\r\n         */\r\n        _type: MaskType.RECT,\r\n        type: {\r\n            get: function () {\r\n                return this._type;\r\n            },\r\n            set: function (value) {\r\n                this._type = value;\r\n                if (this._type !== MaskType.IMAGE_STENCIL) {\r\n                    this.spriteFrame = null;\r\n                    this.alphaThreshold = 0;\r\n                    this._updateGraphics();\r\n                }\r\n                if (this._renderData) {\r\n                    this.destroyRenderData(this._renderData);\r\n                    this._renderData = null;\r\n                }\r\n                this._activateMaterial();\r\n            },\r\n            type: MaskType,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.mask.type',\r\n        },\r\n\r\n        /**\r\n         * !#en The mask image\r\n         * !#zh \r\n         * @property spriteFrame\r\n         * @type {SpriteFrame}\r\n         * @default null\r\n         * @example\r\n         * mask.spriteFrame = newSpriteFrame;\r\n         */\r\n        spriteFrame: {\r\n            type: cc.SpriteFrame,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.mask.spriteFrame',\r\n            get: function () {\r\n                return this._spriteFrame;\r\n            },\r\n            set: function (value) {\r\n                let lastSprite = this._spriteFrame;\r\n                if (CC_EDITOR) {\r\n                    if ((lastSprite && lastSprite._uuid) === (value && value._uuid)) {\r\n                        return;\r\n                    }\r\n                }\r\n                else {\r\n                    if (lastSprite === value) {\r\n                        return;\r\n                    }\r\n                }\r\n                this._spriteFrame = value;\r\n                this._applySpriteFrame(lastSprite);\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The alpha threshold.(Not supported Canvas Mode) <br/>\r\n         * The content is drawn only where the stencil have pixel with alpha greater than the alphaThreshold. <br/>\r\n         * Should be a float between 0 and 1. <br/>\r\n         * This default to 0 (so alpha test is disabled).\r\n         * When it's set to 1, the stencil will discard all pixels, nothing will be shown,\r\n         * In previous version, it act as if the alpha test is disabled, which is incorrect.\r\n         * !#zh\r\n         * Alpha  Canvas <br/>\r\n         *  alpha  alphaThreshold <br/>\r\n         *  0 ~ 1  0 alpha \r\n         *  1  1  0\r\n         * @property alphaThreshold\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        alphaThreshold: {\r\n            default: 0,\r\n            type: cc.Float,\r\n            range: [0, 1, 0.1],\r\n            slide: true,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.mask.alphaThreshold',\r\n            notify: function () {\r\n                if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n                    cc.warnID(4201);\r\n                    return;\r\n                }\r\n                if (this._material) {\r\n                    this._material.alphaThreshold = this.alphaThreshold;\r\n                    this._material.updateHash();\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Reverse mask (Not supported Canvas Mode)\r\n         * !#zh  Canvas \r\n         * @property inverted\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        inverted: {\r\n            default: false,\r\n            type: cc.Boolean,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.mask.inverted',\r\n            notify: function () {\r\n                if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n                    cc.warnID(4202);\r\n                    return;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * TODO: remove segments, not supported by graphics\r\n         * !#en The segements for ellipse mask.\r\n         * !#zh \r\n         * @property segements\r\n         * @type {Number}\r\n         * @default 64\r\n         */\r\n        _segments: 64,\r\n        segements: {\r\n            get: function () {\r\n                return this._segments;\r\n            },\r\n            set: function (value) {\r\n                this._segments = misc.clampf(value, SEGEMENTS_MIN, SEGEMENTS_MAX);\r\n                this._updateGraphics();\r\n            },\r\n            type: cc.Integer,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.mask.segements',\r\n        },\r\n\r\n        _resizeToTarget: {\r\n            animatable: false,\r\n            set: function (value) {\r\n                if(value) {\r\n                    this._resizeNodeToTargetNode();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        Type: MaskType,\r\n    },\r\n\r\n    onLoad () {\r\n        this._createGraphics();\r\n    },\r\n\r\n    onRestore () {\r\n        this._createGraphics();\r\n        if (this._type !== MaskType.IMAGE_STENCIL) {\r\n            this._updateGraphics();\r\n        }\r\n    },\r\n\r\n    onEnable () {\r\n        this._super();\r\n        if (this._type === MaskType.IMAGE_STENCIL) {\r\n            if (!this._spriteFrame || !this._spriteFrame.textureLoaded()) {\r\n                // Do not render when sprite frame is not ready\r\n                this.markForRender(false);\r\n                if (this._spriteFrame) {\r\n                    this._spriteFrame.once('load', this._onTextureLoaded, this);\r\n                    this._spriteFrame.ensureLoadTexture();\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._updateGraphics();\r\n        }\r\n\r\n        this.node.on(cc.Node.EventType.POSITION_CHANGED, this._updateGraphics, this);\r\n        this.node.on(cc.Node.EventType.ROTATION_CHANGED, this._updateGraphics, this);\r\n        this.node.on(cc.Node.EventType.SCALE_CHANGED, this._updateGraphics, this);\r\n        this.node.on(cc.Node.EventType.SIZE_CHANGED, this._updateGraphics, this);\r\n        this.node.on(cc.Node.EventType.ANCHOR_CHANGED, this._updateGraphics, this);\r\n\r\n        this.node._renderFlag |= RenderFlow.FLAG_POST_RENDER;\r\n        this._activateMaterial();\r\n    },\r\n\r\n    onDisable () {\r\n        this._super();\r\n\r\n        this.node.off(cc.Node.EventType.POSITION_CHANGED, this._updateGraphics, this);\r\n        this.node.off(cc.Node.EventType.ROTATION_CHANGED, this._updateGraphics, this);\r\n        this.node.off(cc.Node.EventType.SCALE_CHANGED, this._updateGraphics, this);\r\n        this.node.off(cc.Node.EventType.SIZE_CHANGED, this._updateGraphics, this);\r\n        this.node.off(cc.Node.EventType.ANCHOR_CHANGED, this._updateGraphics, this);\r\n\r\n        this.node._renderFlag &= ~RenderFlow.FLAG_POST_RENDER;\r\n    },\r\n\r\n    onDestroy () {\r\n        this._super();\r\n        this._removeGraphics();\r\n    },\r\n\r\n    _resizeNodeToTargetNode: CC_EDITOR && function () {\r\n        if(this.spriteFrame) {\r\n            let rect = this.spriteFrame.getRect();\r\n            this.node.setContentSize(rect.width, rect.height);\r\n        }\r\n    },\r\n\r\n    _onTextureLoaded () {\r\n        // Mark render data dirty\r\n        if (this._renderData) {\r\n            this._renderData.uvDirty = true;\r\n            this._renderData.vertDirty = true;\r\n            this.markForUpdateRenderData(true);\r\n        }\r\n        // Reactivate material\r\n        if (this.enabledInHierarchy) {\r\n            this._activateMaterial();\r\n        }\r\n    },\r\n\r\n    _applySpriteFrame (oldFrame) {\r\n        if (oldFrame && oldFrame.off) {\r\n            oldFrame.off('load', this._onTextureLoaded, this);\r\n        }\r\n        let spriteFrame = this._spriteFrame;\r\n        if (spriteFrame) {\r\n            if (spriteFrame.textureLoaded()) {\r\n                this._onTextureLoaded(null);\r\n            }\r\n            else {\r\n                spriteFrame.once('load', this._onTextureLoaded, this);\r\n                spriteFrame.ensureLoadTexture();\r\n            }\r\n        }\r\n    },\r\n\r\n    _activateMaterial () {\r\n        // cannot be activated if texture not loaded yet\r\n        if (this._type === MaskType.IMAGE_STENCIL && (!this.spriteFrame || !this.spriteFrame.textureLoaded())) {\r\n            this.markForRender(false);\r\n            return;\r\n        }\r\n\r\n        // WebGL\r\n        if (cc.game.renderType !== cc.game.RENDER_TYPE_CANVAS) {\r\n            // Init material\r\n            if (!this._material) {\r\n                this._material = new StencilMaterial();\r\n            }\r\n\r\n            // Reset material\r\n            if (this._type === MaskType.IMAGE_STENCIL) {\r\n                let texture = this.spriteFrame.getTexture();\r\n                this._material.useModel = false;\r\n                this._material.useTexture = true;\r\n                this._material.useColor = true;\r\n                this._material.texture = texture;\r\n                this._material.alphaThreshold = this.alphaThreshold;\r\n            }\r\n            else {\r\n                this._material.useModel = true;\r\n                this._material.useTexture = false;\r\n                this._material.useColor = false;\r\n            }\r\n        }\r\n\r\n        this.markForRender(true);\r\n    },\r\n\r\n    _createGraphics () {\r\n        if (!this._graphics) {\r\n            this._graphics = new Graphics();\r\n            this._graphics.node = this.node;\r\n            this._graphics.lineWidth = 0;\r\n            this._graphics.strokeColor = cc.color(0, 0, 0, 0);\r\n        }\r\n\r\n        if (!this._clearGraphics) {\r\n            this._clearGraphics = new Graphics();\r\n            this._clearGraphics.node = new Node();\r\n            this._clearGraphics._activateMaterial();\r\n            this._clearGraphics.lineWidth = 0;\r\n            this._clearGraphics.rect(0, 0, cc.visibleRect.width, cc.visibleRect.height);\r\n            this._clearGraphics.fill();\r\n        }\r\n    },\r\n\r\n    _updateGraphics () {\r\n        let node = this.node;\r\n        let graphics = this._graphics;\r\n        // Share render data with graphics content\r\n        graphics.clear(false);\r\n        let width = node._contentSize.width;\r\n        let height = node._contentSize.height;\r\n        let x = -width * node._anchorPoint.x;\r\n        let y = -height * node._anchorPoint.y;\r\n        if (this._type === MaskType.RECT) {\r\n            graphics.rect(x, y, width, height);\r\n        }\r\n        else if (this._type === MaskType.ELLIPSE) {\r\n            let center = cc.v2(x + width / 2, y + height / 2);\r\n            let radius = {\r\n                x: width / 2,\r\n                y: height / 2\r\n            };\r\n            let points = _calculateCircle(center, radius, this._segments);\r\n            for (let i = 0; i < points.length; ++i) {\r\n                let point = points[i];\r\n                if (i === 0) {\r\n                    graphics.moveTo(point.x, point.y);\r\n                }\r\n                else {\r\n                    graphics.lineTo(point.x, point.y);\r\n                }\r\n            }\r\n            graphics.close();\r\n        }\r\n        if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            graphics.stroke();\r\n        }\r\n        else {\r\n            graphics.fill();\r\n        }\r\n    },\r\n\r\n    _removeGraphics () {\r\n        if (this._graphics) {\r\n            this._graphics.destroy();\r\n        }\r\n\r\n        if (this._clearGraphics) {\r\n            this._clearGraphics.destroy();\r\n        }\r\n    },\r\n\r\n    _hitTest (cameraPt) {\r\n        let node = this.node;\r\n        let size = node.getContentSize(),\r\n            w = size.width,\r\n            h = size.height,\r\n            testPt = _vec2_temp;\r\n        \r\n        node._updateWorldMatrix();\r\n        math.mat4.invert(_mat4_temp, node._worldMatrix);\r\n        math.vec2.transformMat4(testPt, cameraPt, _mat4_temp);\r\n        testPt.x += node._anchorPoint.x * w;\r\n        testPt.y += node._anchorPoint.y * h;\r\n\r\n        if (this.type === MaskType.RECT || this.type === MaskType.IMAGE_STENCIL) {\r\n            return testPt.x >= 0 && testPt.y >= 0 && testPt.x <= w && testPt.y <= h;\r\n        }\r\n        else if (this.type === MaskType.ELLIPSE) {\r\n            let rx = w / 2, ry = h / 2;\r\n            let px = testPt.x - 0.5 * w, py = testPt.y - 0.5 * h;\r\n            return px * px / (rx * rx) + py * py / (ry * ry) < 1;\r\n        }\r\n    },\r\n\r\n    markForUpdateRenderData (enable) {\r\n        if (enable && this.enabledInHierarchy) {\r\n            this.node._renderFlag |= RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n        }\r\n        else if (!enable) {\r\n            this.node._renderFlag &= ~RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n        }\r\n    },\r\n\r\n    markForRender (enable) {\r\n        if (enable && this.enabledInHierarchy) {\r\n            this.node._renderFlag |= (RenderFlow.FLAG_RENDER | RenderFlow.FLAG_UPDATE_RENDER_DATA | \r\n                                      RenderFlow.FLAG_POST_RENDER);\r\n        }\r\n        else if (!enable) {\r\n            this.node._renderFlag &= ~(RenderFlow.FLAG_RENDER | RenderFlow.FLAG_POST_RENDER);\r\n        }\r\n    },\r\n\r\n    disableRender () {\r\n        this.node._renderFlag &= ~(RenderFlow.FLAG_RENDER | RenderFlow.FLAG_UPDATE_RENDER_DATA | \r\n                                   RenderFlow.FLAG_POST_RENDER);\r\n    },\r\n});\r\n\r\ncc.Mask = module.exports = Mask;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst misc = require('../utils/misc');\r\nconst Component = require('./CCComponent');\r\n\r\n/**\r\n * !#en Enum for ProgressBar mode\r\n * !#zh \r\n * @enum ProgressBar.Mode\r\n */\r\nvar Mode = cc.Enum({\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} HORIZONTAL\r\n     */\r\n    HORIZONTAL: 0,\r\n\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} VERTICAL\r\n     */\r\n    VERTICAL: 1,\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} FILLED\r\n     */\r\n    FILLED: 2,\r\n});\r\n\r\n/**\r\n * !#en\r\n * Visual indicator of progress in some operation.\r\n * Displays a bar to the user representing how far the operation has progressed.\r\n * !#zh\r\n * \r\n * @class ProgressBar\r\n * @extends Component\r\n * @example\r\n * // update progressBar\r\n * update: function (dt) {\r\n *     var progress = progressBar.progress;\r\n *     if (progress > 0) {\r\n *         progress += dt;\r\n *     }\r\n *     else {\r\n *         progress = 1;\r\n *     }\r\n *     progressBar.progress = progress;\r\n * }\r\n *\r\n */\r\nvar ProgressBar = cc.Class({\r\n    name: 'cc.ProgressBar',\r\n    extends: Component,\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.ui/ProgressBar',\r\n        help: 'i18n:COMPONENT.help_url.progressbar',\r\n    },\r\n\r\n    _initBarSprite: function() {\r\n        if (this.barSprite) {\r\n            var entity = this.barSprite.node;\r\n            if (!entity) return;\r\n\r\n            var nodeSize = this.node.getContentSize();\r\n            var nodeAnchor = this.node.getAnchorPoint();\r\n\r\n            var entitySize = entity.getContentSize();\r\n\r\n            if(entity.parent === this.node){\r\n                this.node.setContentSize(entitySize);\r\n            }\r\n\r\n            if (this.barSprite.fillType === cc.Sprite.FillType.RADIAL) {\r\n                this.mode = Mode.FILLED;\r\n            }\r\n\r\n            var barSpriteSize = entity.getContentSize();\r\n            if (this.mode === Mode.HORIZONTAL) {\r\n                this.totalLength = barSpriteSize.width;\r\n            }\r\n            else if(this.mode === Mode.VERTICAL) {\r\n                this.totalLength = barSpriteSize.height;\r\n            }\r\n            else {\r\n                this.totalLength = this.barSprite.fillRange;\r\n            }\r\n\r\n            if(entity.parent === this.node){\r\n                var x = - nodeSize.width * nodeAnchor.x;\r\n                var y = 0;\r\n                entity.setPosition(cc.v2(x, y));\r\n            }\r\n        }\r\n    },\r\n\r\n    _updateBarStatus: function() {\r\n        if (this.barSprite) {\r\n            var entity = this.barSprite.node;\r\n\r\n            if (!entity) return;\r\n\r\n            var entityAnchorPoint = entity.getAnchorPoint();\r\n            var entitySize = entity.getContentSize();\r\n            var entityPosition = entity.getPosition();\r\n\r\n            var anchorPoint = cc.v2(0, 0.5);\r\n            var progress = misc.clamp01(this.progress);\r\n            var actualLenth = this.totalLength * progress;\r\n            var finalContentSize;\r\n            var totalWidth;\r\n            var totalHeight;\r\n            switch (this.mode) {\r\n                case Mode.HORIZONTAL:\r\n                    if (this.reverse) {\r\n                        anchorPoint = cc.v2(1, 0.5);\r\n                    }\r\n                    finalContentSize = cc.size(actualLenth, entitySize.height);\r\n                    totalWidth = this.totalLength;\r\n                    totalHeight = entitySize.height;\r\n                    break;\r\n                case Mode.VERTICAL:\r\n                    if (this.reverse) {\r\n                        anchorPoint = cc.v2(0.5, 1);\r\n                    } else {\r\n                        anchorPoint = cc.v2(0.5, 0);\r\n                    }\r\n                    finalContentSize = cc.size(entitySize.width, actualLenth);\r\n                    totalWidth = entitySize.width;\r\n                    totalHeight = this.totalLength;\r\n                    break;\r\n            }\r\n\r\n            //handling filled mode\r\n            if (this.mode === Mode.FILLED) {\r\n                if (this.barSprite.type !== cc.Sprite.Type.FILLED) {\r\n                    cc.warn('ProgressBar FILLED mode only works when barSprite\\'s Type is FILLED!');\r\n                } else {\r\n                    if (this.reverse) {\r\n                        actualLenth = actualLenth * -1;\r\n                    }\r\n                    this.barSprite.fillRange = actualLenth;\r\n                }\r\n            } else {\r\n                if (this.barSprite.type !== cc.Sprite.Type.FILLED) {\r\n\r\n                    var anchorOffsetX = anchorPoint.x - entityAnchorPoint.x;\r\n                    var anchorOffsetY = anchorPoint.y - entityAnchorPoint.y;\r\n                    var finalPosition = cc.v2(totalWidth * anchorOffsetX, totalHeight * anchorOffsetY);\r\n\r\n                    entity.setPosition(entityPosition.x + finalPosition.x, entityPosition.y + finalPosition.y);\r\n\r\n                    entity.setAnchorPoint(anchorPoint);\r\n                    entity.setContentSize(finalContentSize);\r\n                } else {\r\n                    cc.warn('ProgressBar non-FILLED mode only works when barSprite\\'s Type is non-FILLED!');\r\n                }\r\n            }\r\n\r\n\r\n\r\n        }\r\n    },\r\n\r\n    properties: {\r\n        /**\r\n         * !#en The targeted Sprite which will be changed progressively.\r\n         * !#zh  Sprite \r\n         * @property {Sprite} barSprite\r\n         */\r\n        barSprite: {\r\n            default: null,\r\n            type: cc.Sprite,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.progress.bar_sprite',\r\n            notify: function() {\r\n                this._initBarSprite();\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en The progress mode, there are two modes supported now: horizontal and vertical.\r\n         * !#zh \r\n         * @property {ProgressBar.Mode} mode\r\n         */\r\n        mode: {\r\n            default: Mode.HORIZONTAL,\r\n            type: Mode,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.progress.mode',\r\n            notify: function() {\r\n                if (this.barSprite) {\r\n                    var entity = this.barSprite.node;\r\n                    if (!entity) return;\r\n\r\n                    var entitySize = entity.getContentSize();\r\n                    if (this.mode === Mode.HORIZONTAL) {\r\n                        this.totalLength = entitySize.width;\r\n                    } else if (this.mode === Mode.VERTICAL) {\r\n                        this.totalLength = entitySize.height;\r\n                    } else if (this.mode === Mode.FILLED) {\r\n                        this.totalLength = this.barSprite.fillRange;\r\n                    }\r\n                }\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        _N$totalLength: 1,\r\n        /**\r\n         * !#en The total width or height of the bar sprite.\r\n         * !#zh \r\n         * @property {Number} totalLength\r\n         */\r\n        totalLength: {\r\n            range: [0, Number.MAX_VALUE],\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.progress.total_length',\r\n            get: function () {\r\n                return this._N$totalLength;\r\n            },\r\n            set: function(value) {\r\n                if (this.mode === Mode.FILLED) {\r\n                    value = misc.clamp01(value);\r\n                }\r\n                this._N$totalLength = value;\r\n                this._updateBarStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The current progress of the bar sprite. The valid value is between 0-1.\r\n         * !#zh  0-1 \r\n         * @property {Number} progress\r\n         */\r\n        progress: {\r\n            default: 1,\r\n            type: 'Float',\r\n            range: [0, 1, 0.1],\r\n            slide: true,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.progress.progress',\r\n            notify: function() {\r\n                this._updateBarStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Whether reverse the progress direction of the bar sprite.\r\n         * !#zh \r\n         * @property {Boolean} reverse\r\n         */\r\n        reverse: {\r\n            default: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.progress.reverse',\r\n            notify: function() {\r\n                if (this.barSprite) {\r\n                    this.barSprite.fillStart = 1 - this.barSprite.fillStart;\r\n                }\r\n                this._updateBarStatus();\r\n            },\r\n            animatable: false\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        Mode: Mode\r\n    }\r\n});\r\n\r\n\r\ncc.ProgressBar = module.exports = ProgressBar;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Component = require('./CCComponent');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst RenderFlow = require('../renderer/render-flow');\r\nconst BlendFactor = require('../platform/CCMacro').BlendFactor;\r\nconst RenderData = renderEngine.RenderData;\r\nconst gfx = renderEngine.gfx;\r\n\r\n/**\r\n * !#en\r\n * Base class for components which supports rendering features.\r\n * !#zh\r\n * \r\n *\r\n * @class RenderComponent\r\n * @extends Component\r\n */\r\nlet RenderComponent = cc.Class({\r\n    name: 'RenderComponent',\r\n    extends: Component,\r\n\r\n    editor: CC_EDITOR && {\r\n        executeInEditMode: true,\r\n        disallowMultiple: true\r\n    },\r\n\r\n    properties: {\r\n        _srcBlendFactor: BlendFactor.SRC_ALPHA,\r\n        _dstBlendFactor: BlendFactor.ONE_MINUS_SRC_ALPHA,\r\n\r\n          /**\r\n         * !#en specify the source Blend Factor, this will generate a custom material object, please pay attention to the memory cost.\r\n         * !#zh \r\n         * @property srcBlendFactor\r\n         * @type {macro.BlendFactor}\r\n         * @example\r\n         * sprite.srcBlendFactor = cc.macro.BlendFactor.ONE;\r\n         */\r\n        srcBlendFactor: {\r\n            get: function() {\r\n                return this._srcBlendFactor;\r\n            },\r\n            set: function(value) {\r\n                if (this._srcBlendFactor === value) return;\r\n                this._srcBlendFactor = value;\r\n                this._updateBlendFunc(true);\r\n            },\r\n            animatable: false,\r\n            type:BlendFactor,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.src_blend_factor'\r\n        },\r\n\r\n        /**\r\n         * !#en specify the destination Blend Factor.\r\n         * !#zh \r\n         * @property dstBlendFactor\r\n         * @type {macro.BlendFactor}\r\n         * @example\r\n         * sprite.dstBlendFactor = cc.macro.BlendFactor.ONE;\r\n         */\r\n        dstBlendFactor: {\r\n            get: function() {\r\n                return this._dstBlendFactor;\r\n            },\r\n            set: function(value) {\r\n                if (this._dstBlendFactor === value) return;\r\n                this._dstBlendFactor = value;\r\n                this._updateBlendFunc(true);\r\n            },\r\n            animatable: false,\r\n            type: BlendFactor,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.dst_blend_factor'\r\n        },\r\n    },\r\n    \r\n    ctor () {\r\n        this._material = null;\r\n        this._renderData = null;\r\n        this.__allocedDatas = [];\r\n        this._vertexFormat = null;\r\n        this._toPostHandle = false;\r\n        this._assembler = this.constructor._assembler;\r\n        this._postAssembler = this.constructor._postAssembler;\r\n    },\r\n\r\n    onEnable () {\r\n        if (this.node._renderComponent) {\r\n            this.node._renderComponent.enabled = false;\r\n        }\r\n        this.node._renderComponent = this;\r\n        this.node._renderFlag |= RenderFlow.FLAG_RENDER | RenderFlow.FLAG_UPDATE_RENDER_DATA | RenderFlow.FLAG_COLOR;\r\n    },\r\n\r\n    onDisable () {\r\n        this.node._renderComponent = null;\r\n        this.disableRender();\r\n    },\r\n\r\n    onDestroy () {\r\n        for (let i = 0, l = this.__allocedDatas.length; i < l; i++) {\r\n            RenderData.free(this.__allocedDatas[i]);\r\n        }\r\n        this.__allocedDatas.length = 0;\r\n        this._material = null;\r\n        this._renderData = null;\r\n    },\r\n    \r\n    _canRender () {\r\n        // When the node is activated, it will execute onEnable and the renderflag will also be reset.\r\n        return this._enabled && this.node._activeInHierarchy;\r\n    },\r\n\r\n    markForUpdateRenderData (enable) {\r\n        if (enable && this._canRender()) {\r\n            this.node._renderFlag |= RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n        }\r\n        else if (!enable) {\r\n            this.node._renderFlag &= ~RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n        }\r\n    },\r\n\r\n    markForRender (enable) {\r\n        if (enable && this._canRender()) {\r\n            this.node._renderFlag |= RenderFlow.FLAG_RENDER;\r\n        }\r\n        else if (!enable) {\r\n            this.node._renderFlag &= ~RenderFlow.FLAG_RENDER;\r\n        }\r\n    },\r\n\r\n    markForCustomIARender (enable) {\r\n        if (enable && this._canRender()) {\r\n            this.node._renderFlag |= RenderFlow.FLAG_CUSTOM_IA_RENDER;\r\n        }\r\n        else if (!enable) {\r\n            this.node._renderFlag &= ~RenderFlow.FLAG_CUSTOM_IA_RENDER;\r\n        }\r\n    },\r\n\r\n    disableRender () {\r\n        this.node._renderFlag &= ~(RenderFlow.FLAG_RENDER | RenderFlow.FLAG_CUSTOM_IA_RENDER | RenderFlow.FLAG_UPDATE_RENDER_DATA | RenderFlow.FLAG_COLOR);\r\n    },\r\n\r\n    requestRenderData () {\r\n        let data = RenderData.alloc();\r\n        this.__allocedDatas.push(data);\r\n        return data;\r\n    },\r\n\r\n    destroyRenderData (data) {\r\n        let index = this.__allocedDatas.indexOf(data);\r\n        if (index !== -1) {\r\n            this.__allocedDatas.splice(index, 1);\r\n            RenderData.free(data);\r\n        }\r\n    },\r\n\r\n    _updateColor () {\r\n        let material = this._material;\r\n        if (material) {\r\n            // For batch rendering, update the color only when useColor is set to true.\r\n            if (material.useColor) {\r\n                material.color = this.node.color;\r\n                material.updateHash();\r\n            }\r\n\r\n            // reset flag when set color to material successfully\r\n            this.node._renderFlag &= ~RenderFlow.FLAG_COLOR;\r\n        }\r\n    },\r\n\r\n    getMaterial () {\r\n        return this._material;\r\n    },\r\n\r\n    _updateMaterial (material) {\r\n        this._material = material;\r\n\r\n        this._updateBlendFunc();\r\n        material.updateHash();\r\n    },\r\n        \r\n    _updateBlendFunc: function (updateHash) {\r\n        if (!this._material) {\r\n            return;\r\n        }\r\n\r\n        var pass = this._material._mainTech.passes[0];\r\n        pass.setBlend(\r\n            gfx.BLEND_FUNC_ADD,\r\n            this._srcBlendFactor, this._dstBlendFactor,\r\n            gfx.BLEND_FUNC_ADD,\r\n            this._srcBlendFactor, this._dstBlendFactor\r\n        );\r\n\r\n        if (updateHash) {\r\n            this._material.updateHash();\r\n        }\r\n    },\r\n});\r\nRenderComponent._assembler = null;\r\nRenderComponent._postAssembler = null;\r\n\r\ncc.RenderComponent = module.exports = RenderComponent;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../platform/js');\r\nconst macro = require('../platform/CCMacro');\r\nconst textUtils = require('../utils/text-utils');\r\nconst HtmlTextParser = require('../utils/html-text-parser');\r\nconst _htmlTextParser = new HtmlTextParser();\r\n\r\nconst HorizontalAlign = macro.TextAlignment;\r\nconst VerticalAlign = macro.VerticalTextAlignment;\r\nconst RichTextChildName = \"RICHTEXT_CHILD\";\r\nconst RichTextChildImageName = \"RICHTEXT_Image_CHILD\";\r\n\r\n// Returns a function, that, as long as it continues to be invoked, will not\r\n// be triggered. The function will be called after it stops being called for\r\n// N milliseconds. If `immediate` is passed, trigger the function on the\r\n// leading edge, instead of the trailing.\r\nfunction debounce(func, wait, immediate) {\r\n    let timeout;\r\n    return function () {\r\n        let context = this;\r\n        let later = function () {\r\n            timeout = null;\r\n            if (!immediate) func.apply(context, arguments);\r\n        };\r\n        let callNow = immediate && !timeout;\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n        if (callNow) func.apply(context, arguments);\r\n    };\r\n}\r\n\r\n/**\r\n * RichText pool\r\n */\r\nlet pool = new js.Pool(function (node) {\r\n    if (CC_EDITOR) {\r\n        return false;\r\n    }\r\n    if (CC_DEV) {\r\n        cc.assert(!node._parent, 'Recycling node\\'s parent should be null!');\r\n    }\r\n    if (!cc.isValid(node)) {\r\n        return false;\r\n    }\r\n    else if (node.getComponent(cc.LabelOutline)) {\r\n        return false;\r\n    }\r\n    return true;\r\n}, 20);\r\n\r\npool.get = function (string, fontAsset, fontSize) {\r\n    let labelNode = this._get();\r\n    if (!labelNode) {\r\n        labelNode = new cc.PrivateNode(RichTextChildName);\r\n    }\r\n    let labelComponent = labelNode.getComponent(cc.Label);\r\n    if (!labelComponent) {\r\n        labelComponent = labelNode.addComponent(cc.Label);\r\n    }\r\n\r\n    labelNode.setPosition(0, 0);\r\n    labelNode.setAnchorPoint(0.5, 0.5);\r\n    labelNode.setContentSize(128, 128);\r\n    labelNode.skewX = 0;\r\n\r\n    if (typeof string !== 'string') {\r\n        string = '' + string;\r\n    }\r\n    let isAsset = fontAsset instanceof cc.Font;\r\n    if (isAsset) {\r\n        labelComponent.font = fontAsset;\r\n    } else {\r\n        labelComponent.fontFamily = \"Arial\";\r\n    }\r\n    labelComponent.string = string;\r\n    labelComponent.horizontalAlign = HorizontalAlign.LEFT;\r\n    labelComponent.verticalAlign = VerticalAlign.TOP;\r\n    labelComponent.fontSize = fontSize || 40;\r\n    labelComponent.overflow = 0;\r\n    labelComponent.enableWrapText = true;\r\n    labelComponent.lineHeight = 40;\r\n    labelComponent._enableBold(false);\r\n    labelComponent._enableItalics(false);\r\n    labelComponent._enableUnderline(false);\r\n\r\n    return labelNode;\r\n};\r\n\r\n/**\r\n * !#en The RichText Component.\r\n * !#zh \r\n * @class RichText\r\n * @extends Component\r\n */\r\nlet RichText = cc.Class({\r\n    name: 'cc.RichText',\r\n    extends: cc.Component,\r\n\r\n    ctor: function () {\r\n        this._textArray = null;\r\n        this._labelSegments = [];\r\n        this._labelSegmentsCache = [];\r\n        this._linesWidth = [];\r\n\r\n        if (CC_EDITOR) {\r\n            this._updateRichTextStatus = debounce(this._updateRichText, 200);\r\n        }\r\n        else {\r\n            this._updateRichTextStatus = this._updateRichText;\r\n        }\r\n    },\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.renderers/RichText',\r\n        help: 'i18n:COMPONENT.help_url.richtext',\r\n        executeInEditMode: true\r\n    },\r\n\r\n    properties: {\r\n        /**\r\n         * !#en Content string of RichText.\r\n         * !#zh \r\n         * @property {String} string\r\n         */\r\n        string: {\r\n            default: '<color=#00ff00>Rich</c><color=#0fffff>Text</color>',\r\n            multiline: true,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.richtext.string',\r\n            notify: function () {\r\n                this._updateRichTextStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Horizontal Alignment of each line in RichText.\r\n         * !#zh \r\n         * @property {macro.TextAlignment} horizontalAlign\r\n         */\r\n        horizontalAlign: {\r\n            default: HorizontalAlign.LEFT,\r\n            type: HorizontalAlign,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.richtext.horizontal_align',\r\n            animatable: false,\r\n            notify: function (oldValue) {\r\n                if (this.horizontalAlign === oldValue) return;\r\n\r\n                this._layoutDirty = true;\r\n                this._updateRichTextStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Font size of RichText.\r\n         * !#zh \r\n         * @property {Number} fontSize\r\n         */\r\n        fontSize: {\r\n            default: 40,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.richtext.font_size',\r\n            notify: function (oldValue) {\r\n                if (this.fontSize === oldValue) return;\r\n\r\n                this._layoutDirty = true;\r\n                this._updateRichTextStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Custom TTF font of RichText\r\n         * !#zh  \r\n         * @property {cc.TTFFont} font\r\n         */\r\n        font: {\r\n            default: null,\r\n            type: cc.TTFFont,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.richtext.font',\r\n            notify: function (oldValue) {\r\n                if (this.font === oldValue) return;\r\n\r\n                this._layoutDirty = true;\r\n                if (this.font) {\r\n                    this._onTTFLoaded();\r\n                }\r\n                this._updateRichTextStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The maximize width of the RichText\r\n         * !#zh \r\n         * @property {Number} maxWidth\r\n         */\r\n        maxWidth: {\r\n            default: 0,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.richtext.max_width',\r\n            notify: function (oldValue) {\r\n                if (this.maxWidth === oldValue) return;\r\n\r\n                this._layoutDirty = true;\r\n                this._updateRichTextStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Line Height of RichText.\r\n         * !#zh \r\n         * @property {Number} lineHeight\r\n         */\r\n        lineHeight: {\r\n            default: 40,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.richtext.line_height',\r\n            notify: function (oldValue) {\r\n                if (this.lineHeight === oldValue) return;\r\n\r\n                this._layoutDirty = true;\r\n                this._updateRichTextStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The image atlas for the img tag. For each src value in the img tag, there should be a valid spriteFrame in the image atlas.\r\n         * !#zh  img  src  imageAtlas  spriteFrame img tag \r\n         * @property {SpriteAtlas} imageAtlas\r\n         */\r\n        imageAtlas: {\r\n            default: null,\r\n            type: cc.SpriteAtlas,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.richtext.image_atlas',\r\n            notify: function (oldValue) {\r\n                if (this.imageAtlas === oldValue) return;\r\n\r\n                this._layoutDirty = true;\r\n                this._updateRichTextStatus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Once checked, the RichText will block all input events (mouse and touch) within\r\n         * the bounding box of the node, preventing the input from penetrating into the underlying node.\r\n         * !#zh\r\n         * RichText \r\n         * @property {Boolean} handleTouchEvent\r\n         * @default true\r\n         */\r\n        handleTouchEvent: {\r\n            default: true,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.richtext.handleTouchEvent',\r\n            notify: function (oldValue) {\r\n                if (this.handleTouchEvent === oldValue) return;\r\n                if (this.enabledInHierarchy) {\r\n                    this.handleTouchEvent ? this._addEventListeners() : this._removeEventListeners();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        HorizontalAlign: HorizontalAlign,\r\n        VerticalAlign: VerticalAlign\r\n    },\r\n\r\n    onEnable () {\r\n        if (this.handleTouchEvent) {\r\n            this._addEventListeners();\r\n        }\r\n        this._updateRichText();\r\n        this._activateChildren(true);\r\n    },\r\n\r\n    onDisable () {\r\n        if (this.handleTouchEvent) {\r\n            this._removeEventListeners();\r\n        }\r\n        this._activateChildren(false);\r\n    },\r\n\r\n    start () {\r\n        this._onTTFLoaded();\r\n    },\r\n\r\n    _addEventListeners () {\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this);\r\n    },\r\n\r\n    _removeEventListeners () {\r\n        this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this);\r\n    },\r\n\r\n    _updateLabelSegmentTextAttributes () {\r\n        this._labelSegments.forEach(function (item) {\r\n            this._applyTextAttribute(item);\r\n        }.bind(this));\r\n    },\r\n\r\n    _createFontLabel (string) {\r\n        return pool.get(string, this.font, this.fontSize);\r\n    },\r\n\r\n    _onTTFLoaded () {\r\n        if (this.font instanceof cc.TTFFont) {\r\n            if (this.font._nativeAsset) {\r\n                this._layoutDirty = true;\r\n                this._updateRichText();\r\n            }\r\n            else {\r\n                let self = this;\r\n                cc.loader.load(this.font.nativeUrl, function (err, fontFamily) {\r\n                    self._layoutDirty = true;\r\n                    self._updateRichText();\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this._layoutDirty = true;\r\n            this._updateRichText();\r\n        }\r\n    },\r\n\r\n    _measureText (styleIndex, string) {\r\n        let self = this;\r\n        let func = function (string) {\r\n            let label;\r\n            if (self._labelSegmentsCache.length === 0) {\r\n                label = self._createFontLabel(string);\r\n                self._labelSegmentsCache.push(label);\r\n            }\r\n            else {\r\n                label = self._labelSegmentsCache[0];\r\n                label.getComponent(cc.Label).string = string;\r\n            }\r\n            label._styleIndex = styleIndex;\r\n            self._applyTextAttribute(label);\r\n            let labelSize = label.getContentSize();\r\n            return labelSize.width;\r\n        };\r\n        if (string) {\r\n            return func(string);\r\n        }\r\n        else {\r\n            return func;\r\n        }\r\n    },\r\n\r\n    _onTouchEnded (event) {\r\n        let components = this.node.getComponents(cc.Component);\r\n\r\n        for (let i = 0; i < this._labelSegments.length; ++i) {\r\n            let labelSegment = this._labelSegments[i];\r\n            let clickHandler = labelSegment._clickHandler;\r\n            let clickParam = labelSegment._clickParam;\r\n            if (clickHandler && this._containsTouchLocation(labelSegment, event.touch.getLocation())) {\r\n                components.forEach(function (component) {\r\n                    if (component.enabledInHierarchy && component[clickHandler]) {\r\n                        component[clickHandler](event, clickParam);\r\n                    }\r\n                });\r\n                event.stopPropagation();\r\n            }\r\n        }\r\n    },\r\n\r\n    _containsTouchLocation (label, point) {\r\n        let myRect = label.getBoundingBoxToWorld();\r\n        return myRect.contains(point);\r\n    },\r\n\r\n    _resetState () {\r\n        let children = this.node.children;\r\n        for (let i = children.length - 1; i >= 0; i--) {\r\n            let child = children[i];\r\n            if (child.name === RichTextChildName || child.name === RichTextChildImageName) {\r\n                if (child.parent === this.node) {\r\n                    child.parent = null;\r\n                }\r\n                else {\r\n                    // In case child.parent !== this.node, child cannot be removed from children\r\n                    children.splice(i, 1);\r\n                }\r\n                if (child.name === RichTextChildName) {\r\n                    pool.put(child);\r\n                }\r\n            }\r\n        }\r\n\r\n        this._labelSegments.length = 0;\r\n        this._labelSegmentsCache.length = 0;\r\n        this._linesWidth.length = 0;\r\n        this._lineOffsetX = 0;\r\n        this._lineCount = 1;\r\n        this._labelWidth = 0;\r\n        this._labelHeight = 0;\r\n        this._layoutDirty = true;\r\n    },\r\n\r\n    onRestore: CC_EDITOR && function () {\r\n        // TODO: refine undo/redo system\r\n        // Because undo/redo will not call onEnable/onDisable,\r\n        // we need call onEnable/onDisable manually to active/disactive children nodes.\r\n        if (this.enabledInHierarchy) {\r\n            this.onEnable();\r\n        }\r\n        else {\r\n            this.onDisable();\r\n        }\r\n    },\r\n\r\n    _activateChildren (active) {\r\n        for (let i = this.node.children.length - 1; i >= 0; i--) {\r\n            let child = this.node.children[i];\r\n            if (child.name === RichTextChildName || child.name === RichTextChildImageName) {\r\n                child.active = active;\r\n            }\r\n        }\r\n    },\r\n\r\n    _addLabelSegment (stringToken, styleIndex) {\r\n        let labelSegment;\r\n        if (this._labelSegmentsCache.length === 0) {\r\n            labelSegment = this._createFontLabel(stringToken);\r\n        }\r\n        else {\r\n            labelSegment = this._labelSegmentsCache.pop();\r\n            labelSegment.getComponent(cc.Label).string = stringToken;\r\n        }\r\n        labelSegment._styleIndex = styleIndex;\r\n        labelSegment._lineCount = this._lineCount;\r\n        labelSegment.active = this.node.active;\r\n\r\n        labelSegment.setAnchorPoint(0, 0);\r\n        this._applyTextAttribute(labelSegment);\r\n\r\n        this.node.addChild(labelSegment);\r\n        this._labelSegments.push(labelSegment);\r\n\r\n        return labelSegment;\r\n    },\r\n\r\n    _updateRichTextWithMaxWidth (labelString, labelWidth, styleIndex) {\r\n        let fragmentWidth = labelWidth;\r\n        let labelSegment;\r\n\r\n        if (this._lineOffsetX > 0 && fragmentWidth + this._lineOffsetX > this.maxWidth) {\r\n            //concat previous line\r\n            let checkStartIndex = 0;\r\n            while (this._lineOffsetX <= this.maxWidth) {\r\n                let checkEndIndex = this._getFirstWordLen(labelString,\r\n                    checkStartIndex,\r\n                    labelString.length);\r\n                let checkString = labelString.substr(checkStartIndex, checkEndIndex);\r\n                let checkStringWidth = this._measureText(styleIndex, checkString);\r\n\r\n                if (this._lineOffsetX + checkStringWidth <= this.maxWidth) {\r\n                    this._lineOffsetX += checkStringWidth;\r\n                    checkStartIndex += checkEndIndex;\r\n                }\r\n                else {\r\n\r\n                    if (checkStartIndex > 0) {\r\n                        let remainingString = labelString.substr(0, checkStartIndex);\r\n                        this._addLabelSegment(remainingString, styleIndex);\r\n                        labelString = labelString.substr(checkStartIndex, labelString.length);\r\n                        fragmentWidth = this._measureText(styleIndex, labelString);\r\n                    }\r\n                    this._updateLineInfo();\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (fragmentWidth > this.maxWidth) {\r\n            let fragments = textUtils.fragmentText(labelString,\r\n                fragmentWidth,\r\n                this.maxWidth,\r\n                this._measureText(styleIndex));\r\n            for (let k = 0; k < fragments.length; ++k) {\r\n                let splitString = fragments[k];\r\n                labelSegment = this._addLabelSegment(splitString, styleIndex);\r\n                let labelSize = labelSegment.getContentSize();\r\n                this._lineOffsetX += labelSize.width;\r\n                if (fragments.length > 1 && k < fragments.length - 1) {\r\n                    this._updateLineInfo();\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._lineOffsetX += fragmentWidth;\r\n            this._addLabelSegment(labelString, styleIndex);\r\n        }\r\n    },\r\n\r\n    _isLastComponentCR (stringToken) {\r\n        return stringToken.length - 1 === stringToken.lastIndexOf(\"\\n\");\r\n    },\r\n\r\n    _updateLineInfo () {\r\n        this._linesWidth.push(this._lineOffsetX);\r\n        this._lineOffsetX = 0;\r\n        this._lineCount++;\r\n    },\r\n\r\n    _needsUpdateTextLayout (newTextArray) {\r\n        if (this._layoutDirty || !this._textArray || !newTextArray) {\r\n            return true;\r\n        }\r\n\r\n        if (this._textArray.length !== newTextArray.length) {\r\n            return true;\r\n        }\r\n\r\n        for (let i = 0; i < this._textArray.length; ++i) {\r\n            let oldItem = this._textArray[i];\r\n            let newItem = newTextArray[i];\r\n            if (oldItem.text !== newItem.text) {\r\n                return true;\r\n            }\r\n            else {\r\n                if (oldItem.style) {\r\n                    if (newItem.style) {\r\n                        if (!!newItem.style.outline !== !!oldItem.style.outline) {\r\n                            return true;\r\n                        }\r\n                        if (oldItem.style.size !== newItem.style.size\r\n                            || oldItem.style.italic !== newItem.style.italic\r\n                            || oldItem.style.isImage !== newItem.style.isImage) {\r\n                            return true;\r\n                        }\r\n                        if (oldItem.style.isImage === newItem.style.isImage) {\r\n                            if (oldItem.style.src !== newItem.style.src) {\r\n                                return true;\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (oldItem.style.size || oldItem.style.italic || oldItem.style.isImage || oldItem.style.outline) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    if (newItem.style) {\r\n                        if (newItem.style.size || newItem.style.italic || newItem.style.isImage || newItem.style.outline) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    _addRichTextImageElement (richTextElement) {\r\n        let spriteFrameName = richTextElement.style.src;\r\n        let spriteFrame = this.imageAtlas.getSpriteFrame(spriteFrameName);\r\n        if (spriteFrame) {\r\n            let spriteNode = new cc.PrivateNode(RichTextChildImageName);\r\n            let spriteComponent = spriteNode.addComponent(cc.Sprite);\r\n            spriteNode.setAnchorPoint(0, 0);\r\n            spriteComponent.type = cc.Sprite.Type.SLICED;\r\n            spriteComponent.sizeMode = cc.Sprite.SizeMode.CUSTOM;\r\n            this.node.addChild(spriteNode);\r\n            this._labelSegments.push(spriteNode);\r\n\r\n            let spriteRect = spriteFrame.getRect();\r\n            let scaleFactor = 1;\r\n            let spriteWidth = spriteRect.width;\r\n            let spriteHeight = spriteRect.height;\r\n            let expectWidth = richTextElement.style.imageWidth;\r\n            let expectHeight = richTextElement.style.imageHeight;\r\n\r\n            //follow the original rule, expectHeight must less then lineHeight\r\n            if (expectHeight > 0 && expectHeight < this.lineHeight) {\r\n                scaleFactor = expectHeight / spriteHeight;\r\n                spriteWidth = spriteWidth * scaleFactor;\r\n                spriteHeight = spriteHeight * scaleFactor;\r\n            }\r\n            else {\r\n                scaleFactor = this.lineHeight / spriteHeight;\r\n                spriteWidth = spriteWidth * scaleFactor;\r\n                spriteHeight = spriteHeight * scaleFactor;\r\n            }\r\n\r\n            if (expectWidth > 0) spriteWidth = expectWidth;\r\n\r\n            if (this.maxWidth > 0) {\r\n                if (this._lineOffsetX + spriteWidth > this.maxWidth) {\r\n                    this._updateLineInfo();\r\n                }\r\n                this._lineOffsetX += spriteWidth;\r\n\r\n            }\r\n            else {\r\n                this._lineOffsetX += spriteWidth;\r\n                if (this._lineOffsetX > this._labelWidth) {\r\n                    this._labelWidth = this._lineOffsetX;\r\n                }\r\n            }\r\n            spriteComponent.spriteFrame = spriteFrame;\r\n            spriteNode.setContentSize(spriteWidth, spriteHeight);\r\n            spriteNode._lineCount = this._lineCount;\r\n\r\n            if (richTextElement.style.event) {\r\n                if (richTextElement.style.event.click) {\r\n                    spriteNode._clickHandler = richTextElement.style.event.click;\r\n                }\r\n                if (richTextElement.style.event.param) {\r\n                    spriteNode._clickParam = richTextElement.style.event.param;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            cc.warnID(4400);\r\n        }\r\n    },\r\n\r\n    _updateRichText () {\r\n        if (!this.enabled) return;\r\n\r\n        let newTextArray = _htmlTextParser.parse(this.string);\r\n        if (!this._needsUpdateTextLayout(newTextArray)) {\r\n            this._textArray = newTextArray;\r\n            this._updateLabelSegmentTextAttributes();\r\n            return;\r\n        }\r\n\r\n        this._textArray = newTextArray;\r\n        this._resetState();\r\n\r\n        let lastEmptyLine = false;\r\n        let label;\r\n        let labelSize;\r\n\r\n        for (let i = 0; i < this._textArray.length; ++i) {\r\n            let richTextElement = this._textArray[i];\r\n            let text = richTextElement.text;\r\n            //handle <br/> <img /> tag\r\n            if (text === \"\") {\r\n                if (richTextElement.style && richTextElement.style.newline) {\r\n                    this._updateLineInfo();\r\n                    continue;\r\n                }\r\n                if (richTextElement.style && richTextElement.style.isImage && this.imageAtlas) {\r\n                    this._addRichTextImageElement(richTextElement);\r\n                    continue;\r\n                }\r\n            }\r\n            let multilineTexts = text.split(\"\\n\");\r\n\r\n            for (let j = 0; j < multilineTexts.length; ++j) {\r\n                let labelString = multilineTexts[j];\r\n                if (labelString === \"\") {\r\n                    //for continues \\n\r\n                    if (this._isLastComponentCR(text)\r\n                        && j === multilineTexts.length - 1) {\r\n                        continue;\r\n                    }\r\n                    this._updateLineInfo();\r\n                    lastEmptyLine = true;\r\n                    continue;\r\n                }\r\n                lastEmptyLine = false;\r\n\r\n                if (this.maxWidth > 0) {\r\n                    let labelWidth = this._measureText(i, labelString);\r\n                    this._updateRichTextWithMaxWidth(labelString, labelWidth, i);\r\n\r\n                    if (multilineTexts.length > 1 && j < multilineTexts.length - 1) {\r\n                        this._updateLineInfo();\r\n                    }\r\n                }\r\n                else {\r\n                    label = this._addLabelSegment(labelString, i);\r\n                    labelSize = label.getContentSize();\r\n\r\n                    this._lineOffsetX += labelSize.width;\r\n                    if (this._lineOffsetX > this._labelWidth) {\r\n                        this._labelWidth = this._lineOffsetX;\r\n                    }\r\n\r\n                    if (multilineTexts.length > 1 && j < multilineTexts.length - 1) {\r\n                        this._updateLineInfo();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (!lastEmptyLine) {\r\n            this._linesWidth.push(this._lineOffsetX);\r\n        }\r\n\r\n        if (this.maxWidth > 0) {\r\n            this._labelWidth = this.maxWidth;\r\n        }\r\n        this._labelHeight = this._lineCount * this.lineHeight;\r\n\r\n        // trigger \"size-changed\" event\r\n        this.node.setContentSize(this._labelWidth, this._labelHeight);\r\n\r\n        this._updateRichTextPosition();\r\n        this._layoutDirty = false;\r\n    },\r\n\r\n    _getFirstWordLen (text, startIndex, textLen) {\r\n        let character = text.charAt(startIndex);\r\n        if (textUtils.isUnicodeCJK(character)\r\n            || textUtils.isUnicodeSpace(character)) {\r\n            return 1;\r\n        }\r\n\r\n        let len = 1;\r\n        for (let index = startIndex + 1; index < textLen; ++index) {\r\n            character = text.charAt(index);\r\n            if (textUtils.isUnicodeSpace(character)\r\n                || textUtils.isUnicodeCJK(character)) {\r\n                break;\r\n            }\r\n            len++;\r\n        }\r\n\r\n        return len;\r\n    },\r\n\r\n    _updateRichTextPosition () {\r\n        let nextTokenX = 0;\r\n        let nextLineIndex = 1;\r\n        let totalLineCount = this._lineCount;\r\n        for (let i = 0; i < this._labelSegments.length; ++i) {\r\n            let label = this._labelSegments[i];\r\n            let lineCount = label._lineCount;\r\n            if (lineCount > nextLineIndex) {\r\n                nextTokenX = 0;\r\n                nextLineIndex = lineCount;\r\n            }\r\n            let lineOffsetX = 0;\r\n            // let nodeAnchorXOffset = (0.5 - this.node.anchorX) * this._labelWidth;\r\n            switch (this.horizontalAlign) {\r\n                case HorizontalAlign.LEFT:\r\n                    lineOffsetX = - this._labelWidth / 2;\r\n                    break;\r\n                case HorizontalAlign.CENTER:\r\n                    lineOffsetX = - this._linesWidth[lineCount - 1] / 2;\r\n                    break;\r\n                case HorizontalAlign.RIGHT:\r\n                    lineOffsetX = this._labelWidth / 2 - this._linesWidth[lineCount - 1];\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            label.x = nextTokenX + lineOffsetX;\r\n\r\n            let labelSize = label.getContentSize();\r\n\r\n            label.y = this.lineHeight * (totalLineCount - lineCount) - this._labelHeight / 2;\r\n\r\n            if (lineCount === nextLineIndex) {\r\n                nextTokenX += labelSize.width;\r\n            }\r\n        }\r\n    },\r\n\r\n    _convertLiteralColorValue (color) {\r\n        let colorValue = color.toUpperCase();\r\n        if (cc.Color[colorValue]) {\r\n            return cc.Color[colorValue];\r\n        }\r\n        else {\r\n            let out = cc.color();\r\n            return out.fromHEX(color);\r\n        }\r\n    },\r\n\r\n    _applyTextAttribute (labelNode) {\r\n        let labelComponent = labelNode.getComponent(cc.Label);\r\n        if (!labelComponent) {\r\n            return;\r\n        }\r\n\r\n        let index = labelNode._styleIndex;\r\n        labelComponent.lineHeight = this.lineHeight;\r\n        labelComponent.horizontalAlign = HorizontalAlign.LEFT;\r\n        labelComponent.verticalAlign = VerticalAlign.CENTER;\r\n\r\n        let textStyle = null;\r\n        if (this._textArray[index]) {\r\n            textStyle = this._textArray[index].style;\r\n        }\r\n\r\n        if (textStyle && textStyle.color) {\r\n            labelNode.color = this._convertLiteralColorValue(textStyle.color);\r\n        }else {\r\n            labelNode.color = this._convertLiteralColorValue(\"white\");\r\n        }\r\n\r\n        labelComponent._enableBold(textStyle && textStyle.bold);\r\n\r\n        labelComponent._enableItalics(textStyle && textStyle.italic);\r\n        //TODO: temporary implementation, the italic effect should be implemented in the internal of label-assembler.\r\n        if (textStyle && textStyle.italic) {\r\n            labelNode.skewX = 12;\r\n        }\r\n\r\n        labelComponent._enableUnderline(textStyle && textStyle.underline);\r\n\r\n        if (textStyle && textStyle.outline) {\r\n            let labelOutlineComponent = labelNode.getComponent(cc.LabelOutline);\r\n            if (!labelOutlineComponent) {\r\n                labelOutlineComponent = labelNode.addComponent(cc.LabelOutline);\r\n            }\r\n            labelOutlineComponent.color = this._convertLiteralColorValue(textStyle.outline.color);\r\n            labelOutlineComponent.width = textStyle.outline.width;\r\n        }\r\n\r\n        if (textStyle && textStyle.size) {\r\n            labelComponent.fontSize = textStyle.size;\r\n        }\r\n        else {\r\n            labelComponent.fontSize = this.fontSize;\r\n        }\r\n\r\n        labelComponent._updateRenderData(true);\r\n\r\n        if (textStyle && textStyle.event) {\r\n            if (textStyle.event.click) {\r\n                labelNode._clickHandler = textStyle.event.click;\r\n            }\r\n            if (textStyle.event.param) {\r\n                labelNode._clickParam = textStyle.event.param;\r\n            }\r\n        }\r\n    },\r\n\r\n    onDestroy () {\r\n        for (let i = 0; i < this._labelSegments.length; ++i) {\r\n            this._labelSegments[i].removeFromParent();\r\n            pool.put(this._labelSegments[i]);\r\n        }\r\n    },\r\n});\r\n\r\ncc.RichText = module.exports = RichText;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst misc = require('../utils/misc');\r\nconst NodeEvent = require('../CCNode').EventType;\r\nconst RenderComponent = require('./CCRenderComponent');\r\nconst RenderFlow = require('../renderer/render-flow');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst SpriteMaterial = renderEngine.SpriteMaterial;\r\nconst GraySpriteMaterial = renderEngine.GraySpriteMaterial;\r\n\r\n/**\r\n * !#en Enum for sprite type.\r\n * !#zh Sprite \r\n * @enum Sprite.Type\r\n */\r\nvar SpriteType = cc.Enum({\r\n    /**\r\n     * !#en The simple type.\r\n     * !#zh \r\n     * @property {Number} SIMPLE\r\n     */\r\n    SIMPLE: 0,\r\n    /**\r\n     * !#en The sliced type.\r\n     * !#zh \r\n     * @property {Number} SLICED\r\n     */\r\n    SLICED: 1,\r\n    /**\r\n     * !#en The tiled type.\r\n     * !#zh \r\n     * @property {Number} TILED\r\n     */\r\n    TILED: 2,\r\n    /**\r\n     * !#en The filled type.\r\n     * !#zh \r\n     * @property {Number} FILLED\r\n     */\r\n    FILLED: 3,\r\n    /**\r\n     * !#en The mesh type.\r\n     * !#zh  Mesh \r\n     * @property {Number} MESH\r\n     */\r\n    MESH: 4\r\n});\r\n\r\n/**\r\n * !#en Enum for fill type.\r\n * !#zh \r\n * @enum Sprite.FillType\r\n */\r\nvar FillType = cc.Enum({\r\n    /**\r\n     * !#en The horizontal fill.\r\n     * !#zh \r\n     * @property {Number} HORIZONTAL\r\n     */\r\n    HORIZONTAL: 0,\r\n    /**\r\n     * !#en The vertical fill.\r\n     * !#zh \r\n     * @property {Number} VERTICAL\r\n     */\r\n    VERTICAL: 1,\r\n    /**\r\n     * !#en The radial fill.\r\n     * !#zh \r\n     * @property {Number} RADIAL\r\n     */\r\n    RADIAL:2,\r\n});\r\n\r\n/**\r\n * !#en Sprite Size can track trimmed size, raw size or none.\r\n * !#zh \r\n * @enum Sprite.SizeMode\r\n */\r\nvar SizeMode = cc.Enum({\r\n    /**\r\n     * !#en Use the customized node size.\r\n     * !#zh \r\n     * @property {Number} CUSTOM\r\n     */\r\n    CUSTOM: 0,\r\n    /**\r\n     * !#en Match the trimmed size of the sprite frame automatically.\r\n     * !#zh \r\n     * @property {Number} TRIMMED\r\n     */\r\n    TRIMMED: 1,\r\n    /**\r\n     * !#en Match the raw size of the sprite frame automatically.\r\n     * !#zh \r\n     * @property {Number} RAW\r\n     */\r\n    RAW: 2\r\n});\r\n/**\r\n * !#en Sprite state can choice the normal or grayscale.\r\n * !#zh \r\n * @enum Sprite.State\r\n */\r\nvar State = cc.Enum({\r\n    /**\r\n     * !#en The normal state\r\n     * !#zh \r\n     * @property {Number} NORMAL\r\n     */\r\n    NORMAL: 0,\r\n    /**\r\n     * !#en The gray state, all color will be modified to grayscale value.\r\n     * !#zh \r\n     * @property {Number} GRAY\r\n     */\r\n    GRAY: 1\r\n});\r\n\r\n/**\r\n * !#en Renders a sprite in the scene.\r\n * !#zh \r\n * @class Sprite\r\n * @extends RenderComponent\r\n * @example\r\n *  // Create a new node and add sprite components.\r\n *  var node = new cc.Node(\"New Sprite\");\r\n *  var sprite = node.addComponent(cc.Sprite);\r\n *  node.parent = this.node;\r\n */\r\nvar Sprite = cc.Class({\r\n    name: 'cc.Sprite',\r\n    extends: RenderComponent,\r\n\r\n    ctor () {\r\n        this._assembler = null;\r\n        this._graySpriteMaterial = null;\r\n        this._spriteMaterial = null;\r\n    },\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.renderers/Sprite',\r\n        help: 'i18n:COMPONENT.help_url.sprite',\r\n        inspector: 'packages://inspector/inspectors/comps/sprite.js',\r\n    },\r\n\r\n    properties: {\r\n        _spriteFrame: {\r\n            default: null,\r\n            type: cc.SpriteFrame\r\n        },\r\n        _type: SpriteType.SIMPLE,\r\n        _sizeMode: SizeMode.TRIMMED,\r\n        _fillType: 0,\r\n        _fillCenter: cc.v2(0,0),\r\n        _fillStart: 0,\r\n        _fillRange: 0,\r\n        _isTrimmedMode: true,\r\n        _state: 0,\r\n        _atlas: {\r\n            default: null,\r\n            type: cc.SpriteAtlas,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.atlas',\r\n            editorOnly: true,\r\n            visible: true,\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en The sprite frame of the sprite.\r\n         * !#zh \r\n         * @property spriteFrame\r\n         * @type {SpriteFrame}\r\n         * @example\r\n         * sprite.spriteFrame = newSpriteFrame;\r\n         */\r\n        spriteFrame: {\r\n            get: function () {\r\n                return this._spriteFrame;\r\n            },\r\n            set: function (value, force) {\r\n                var lastSprite = this._spriteFrame;\r\n                if (CC_EDITOR) {\r\n                    if (!force && ((lastSprite && lastSprite._uuid) === (value && value._uuid))) {\r\n                        return;\r\n                    }\r\n                }\r\n                else {\r\n                    if (lastSprite === value) {\r\n                        return;\r\n                    }\r\n                }\r\n                this._spriteFrame = value;\r\n                // render & update render data flag will be triggered while applying new sprite frame\r\n                this.markForUpdateRenderData(false);\r\n                this._applySpriteFrame(lastSprite);\r\n                if (CC_EDITOR) {\r\n                    this.node.emit('spriteframe-changed', this);\r\n                }\r\n            },\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        /**\r\n         * !#en The sprite render type.\r\n         * !#zh \r\n         * @property type\r\n         * @type {Sprite.Type}\r\n         * @example\r\n         * sprite.type = cc.Sprite.Type.SIMPLE;\r\n         */\r\n        type: {\r\n            get: function () {\r\n                return this._type;\r\n            },\r\n            set: function (value) {\r\n                if (this._type !== value) {\r\n                    this.destroyRenderData(this._renderData);\r\n                    this._renderData = null;\r\n                    this._type = value;\r\n                    this._updateAssembler();\r\n                }\r\n            },\r\n            type: SpriteType,\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.type',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The fill type, This will only have any effect if the \"type\" is set to cc.Sprite.Type.FILLED.\r\n         * !#zh\r\n         *  cc.Sprite.Type.FILLED \r\n         * @property fillType\r\n         * @type {Sprite.FillType}\r\n         * @example\r\n         * sprite.fillType = cc.Sprite.FillType.HORIZONTAL;\r\n         */\r\n        fillType : {\r\n            get: function () {\r\n                return this._fillType;\r\n            },\r\n            set: function(value) {\r\n                if (value !== this._fillType) {\r\n                    if (value === FillType.RADIAL || this._fillType === FillType.RADIAL) {\r\n                        this.destroyRenderData(this._renderData);\r\n                        this._renderData = null;\r\n                    }\r\n                    else if (this._renderData) {\r\n                        this.markForUpdateRenderData(true);\r\n                    }\r\n                    this._fillType = value;\r\n                    this._updateAssembler();\r\n                }\r\n            },\r\n            type: FillType,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.fill_type'\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The fill Center, This will only have any effect if the \"type\" is set to cc.Sprite.Type.FILLED.\r\n         * !#zh\r\n         *  cc.Sprite.Type.FILLED \r\n         * @property fillCenter\r\n         * @type {Vec2}\r\n         * @example\r\n         * sprite.fillCenter = new cc.Vec2(0, 0);\r\n         */\r\n        fillCenter: {\r\n            get: function() {\r\n                return this._fillCenter;\r\n            },\r\n            set: function(value) {\r\n                this._fillCenter.x = value.x;\r\n                this._fillCenter.y = value.y;\r\n                if (this._type === SpriteType.FILLED && this._renderData) {\r\n                    this.markForUpdateRenderData(true);\r\n                }\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.fill_center',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The fill Start, This will only have any effect if the \"type\" is set to cc.Sprite.Type.FILLED.\r\n         * !#zh\r\n         *  cc.Sprite.Type.FILLED \r\n         * @property fillStart\r\n         * @type {Number}\r\n         * @example\r\n         * // -1 To 1 between the numbers\r\n         * sprite.fillStart = 0.5;\r\n         */\r\n        fillStart: {\r\n            get: function() {\r\n                return this._fillStart;\r\n            },\r\n            set: function(value) {\r\n                this._fillStart = misc.clampf(value, -1, 1);\r\n                if (this._type === SpriteType.FILLED && this._renderData) {\r\n                    this.markForUpdateRenderData(true);\r\n                }\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.fill_start'\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The fill Range, This will only have any effect if the \"type\" is set to cc.Sprite.Type.FILLED.\r\n         * !#zh\r\n         *  cc.Sprite.Type.FILLED \r\n         * @property fillRange\r\n         * @type {Number}\r\n         * @example\r\n         * // -1 To 1 between the numbers\r\n         * sprite.fillRange = 1;\r\n         */\r\n        fillRange: {\r\n            get: function() {\r\n                return this._fillRange;\r\n            },\r\n            set: function(value) {\r\n                this._fillRange = misc.clampf(value, -1, 1);\r\n                if (this._type === SpriteType.FILLED && this._renderData) {\r\n                    this.markForUpdateRenderData(true);\r\n                }\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.fill_range'\r\n        },\r\n        /**\r\n         * !#en specify the frame is trimmed or not.\r\n         * !#zh \r\n         * @property trim\r\n         * @type {Boolean}\r\n         * @example\r\n         * sprite.trim = true;\r\n         */\r\n        trim: {\r\n            get: function () {\r\n                return this._isTrimmedMode;\r\n            },\r\n            set: function (value) {\r\n                if (this._isTrimmedMode !== value) {\r\n                    this._isTrimmedMode = value;\r\n                    if ((this._type === SpriteType.SIMPLE || this._type === SpriteType.MESH) && \r\n                        this._renderData) {\r\n                        this.markForUpdateRenderData(true);\r\n                    }\r\n                }\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.trim'\r\n        },\r\n\r\n      \r\n        /**\r\n         * !#en specify the size tracing mode.\r\n         * !#zh \r\n         * @property sizeMode\r\n         * @type {Sprite.SizeMode}\r\n         * @example\r\n         * sprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;\r\n         */\r\n        sizeMode: {\r\n            get: function () {\r\n                return this._sizeMode;\r\n            },\r\n            set: function (value) {\r\n                this._sizeMode = value;\r\n                if (value !== SizeMode.CUSTOM) {\r\n                    this._applySpriteSize();\r\n                }\r\n            },\r\n            animatable: false,\r\n            type: SizeMode,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.sprite.size_mode'\r\n        }\r\n    },\r\n\r\n    statics: {\r\n        FillType: FillType,\r\n        Type: SpriteType,\r\n        SizeMode: SizeMode,\r\n        State: State,\r\n    },\r\n\r\n    setVisible: function (visible) {\r\n        this.enabled = visible;\r\n    },\r\n\r\n    /**\r\n     * Change the state of sprite.\r\n     * @method setState\r\n     * @see `Sprite.State`\r\n     * @param state {Sprite.State} NORMAL or GRAY State.\r\n     */\r\n    setState: function (state) {\r\n        if (this._state === state) return;\r\n        this._state = state;\r\n        this._activateMaterial();\r\n    },\r\n\r\n    /**\r\n     * Gets the current state.\r\n     * @method getState\r\n     * @see `Sprite.State`\r\n     * @return {Sprite.State}\r\n     */\r\n    getState: function () {\r\n        return this._state;\r\n    },\r\n\r\n    onEnable: function () {\r\n        this._super();\r\n\r\n        if (!this._spriteFrame || !this._spriteFrame.textureLoaded()) {\r\n            // Do not render when sprite frame is not ready\r\n            this.disableRender();\r\n            if (this._spriteFrame) {\r\n                this._spriteFrame.once('load', this._onTextureLoaded, this);\r\n                this._spriteFrame.ensureLoadTexture();\r\n            }\r\n        }\r\n        \r\n        this._updateAssembler();\r\n        this._activateMaterial();\r\n\r\n        this.node.on(NodeEvent.SIZE_CHANGED, this._onNodeSizeDirty, this);\r\n        this.node.on(NodeEvent.ANCHOR_CHANGED, this._onNodeSizeDirty, this);\r\n    },\r\n\r\n    onDisable: function () {\r\n        this._super();\r\n\r\n        this.node.off(NodeEvent.SIZE_CHANGED, this._onNodeSizeDirty, this);\r\n        this.node.off(NodeEvent.ANCHOR_CHANGED, this._onNodeSizeDirty, this);\r\n    },\r\n\r\n    _onNodeSizeDirty () {\r\n        if (!this._renderData) return;\r\n        this.markForUpdateRenderData(true);\r\n    },\r\n\r\n    _on3DNodeChanged () {\r\n        this._updateAssembler();\r\n    },\r\n\r\n    _updateAssembler: function () {\r\n        let assembler = Sprite._assembler.getAssembler(this);\r\n        \r\n        if (this._assembler !== assembler) {\r\n            this._assembler = assembler;\r\n            this._renderData = null;\r\n        }\r\n\r\n        if (!this._renderData) {\r\n            this._renderData = this._assembler.createData(this);\r\n            this._renderData.material = this._material;\r\n            this.markForUpdateRenderData(true);\r\n        }\r\n    },\r\n\r\n    _activateMaterial: function () {\r\n        let spriteFrame = this._spriteFrame;\r\n\r\n        // WebGL\r\n        if (cc.game.renderType !== cc.game.RENDER_TYPE_CANVAS) {\r\n            // Get material\r\n            let material;\r\n            if (this._state === State.GRAY) {\r\n                if (!this._graySpriteMaterial) {\r\n                    this._graySpriteMaterial = new GraySpriteMaterial();\r\n                }\r\n                material = this._graySpriteMaterial;\r\n            }\r\n            else {\r\n                if (!this._spriteMaterial) {\r\n                    this._spriteMaterial = new SpriteMaterial();\r\n                }\r\n                material = this._spriteMaterial;\r\n            }\r\n            // For batch rendering, do not use uniform color.\r\n            material.useColor = false;\r\n            // Set texture\r\n            if (spriteFrame && spriteFrame.textureLoaded()) {\r\n                let texture = spriteFrame.getTexture();\r\n                if (material.texture !== texture) {\r\n                    material.texture = texture;\r\n                    this._updateMaterial(material);\r\n                }\r\n                else if (material !== this._material) {\r\n                    this._updateMaterial(material);\r\n                }\r\n                if (this._renderData) {\r\n                    this._renderData.material = material;\r\n                }\r\n\r\n                this.node._renderFlag |= RenderFlow.FLAG_COLOR;\r\n                this.markForUpdateRenderData(true);\r\n                this.markForRender(true);\r\n            }\r\n            else {\r\n                this.disableRender();\r\n            }\r\n        }\r\n        else {\r\n            this.markForUpdateRenderData(true);\r\n            this.markForRender(true);\r\n        }\r\n    },\r\n\r\n    _applyAtlas: CC_EDITOR && function (spriteFrame) {\r\n        // Set atlas\r\n        if (spriteFrame && spriteFrame._atlasUuid) {\r\n            var self = this;\r\n            cc.AssetLibrary.loadAsset(spriteFrame._atlasUuid, function (err, asset) {\r\n                self._atlas = asset;\r\n            });\r\n        } else {\r\n            this._atlas = null;\r\n        }\r\n    },\r\n\r\n    _canRender () {\r\n        if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            if (!this._enabled) return false;\r\n        }\r\n        else {\r\n            if (!this._enabled || !this._material || !this.node._activeInHierarchy) return false;\r\n        }\r\n\r\n        let spriteFrame = this._spriteFrame;\r\n        if (!spriteFrame || !spriteFrame.textureLoaded()) {\r\n            return false;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    markForUpdateRenderData (enable) {\r\n        if (enable && this._canRender()) {\r\n            this.node._renderFlag |= RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n            \r\n            let renderData = this._renderData;\r\n            if (renderData) {\r\n                renderData.uvDirty = true;\r\n                renderData.vertDirty = true;\r\n            }\r\n        }\r\n        else if (!enable) {\r\n            this.node._renderFlag &= ~RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n        }\r\n    },\r\n\r\n    _applySpriteSize: function () {\r\n        if (this._spriteFrame) {\r\n            if (SizeMode.RAW === this._sizeMode) {\r\n                var size = this._spriteFrame.getOriginalSize();\r\n                this.node.setContentSize(size);\r\n            } else if (SizeMode.TRIMMED === this._sizeMode) {\r\n                var rect = this._spriteFrame.getRect();\r\n                this.node.setContentSize(rect.width, rect.height);\r\n            }\r\n            \r\n            this._activateMaterial();\r\n        }\r\n    },\r\n\r\n    _onTextureLoaded: function () {\r\n        if (!this.isValid) {\r\n            return;\r\n        }\r\n\r\n        this._applySpriteSize();\r\n    },\r\n\r\n    _applySpriteFrame: function (oldFrame) {\r\n        if (oldFrame && oldFrame.off) {\r\n            oldFrame.off('load', this._onTextureLoaded, this);\r\n        }\r\n\r\n        var spriteFrame = this._spriteFrame;\r\n        if (!spriteFrame || (this._material && this._material._texture) !== (spriteFrame && spriteFrame._texture)) {\r\n            // disable render flow until texture is loaded\r\n            this.markForRender(false);\r\n        }\r\n\r\n        if (spriteFrame) {\r\n            if (!oldFrame || spriteFrame._texture !== oldFrame._texture) {\r\n                if (spriteFrame.textureLoaded()) {\r\n                    this._onTextureLoaded(null);\r\n                }\r\n                else {\r\n                    spriteFrame.once('load', this._onTextureLoaded, this);\r\n                    spriteFrame.ensureLoadTexture();\r\n                }\r\n            }\r\n            else {\r\n                this._applySpriteSize();\r\n            }\r\n        }\r\n\r\n        if (CC_EDITOR) {\r\n            // Set atlas\r\n            this._applyAtlas(spriteFrame);\r\n        }\r\n    },\r\n\r\n    _resized: CC_EDITOR && function () {\r\n        if (this._spriteFrame) {\r\n            var actualSize = this.node.getContentSize();\r\n            var expectedW = actualSize.width;\r\n            var expectedH = actualSize.height;\r\n            if (this._sizeMode === SizeMode.RAW) {\r\n                var size = this._spriteFrame.getOriginalSize();\r\n                expectedW = size.width;\r\n                expectedH = size.height;\r\n            } else if (this._sizeMode === SizeMode.TRIMMED) {\r\n                var rect = this._spriteFrame.getRect();\r\n                expectedW = rect.width;\r\n                expectedH = rect.height;\r\n\r\n            }\r\n\r\n            if (expectedW !== actualSize.width || expectedH !== actualSize.height) {\r\n                this._sizeMode = SizeMode.CUSTOM;\r\n            }\r\n        }\r\n    },\r\n});\r\n\r\nif (CC_EDITOR) {\r\n    // override __preload\r\n    Sprite.prototype.__superPreload = cc.Component.prototype.__preload;\r\n    Sprite.prototype.__preload = function () {\r\n        if (this.__superPreload) this.__superPreload();\r\n        this.node.on(NodeEvent.SIZE_CHANGED, this._resized, this);\r\n    };\r\n    // override onDestroy\r\n    Sprite.prototype.__superOnDestroy = cc.Component.prototype.onDestroy;\r\n    Sprite.prototype.onDestroy = function () {\r\n        if (this.__superOnDestroy) this.__superOnDestroy();\r\n        this.node.off(NodeEvent.SIZE_CHANGED, this._resized, this);\r\n    };\r\n}\r\n\r\ncc.Sprite = module.exports = Sprite;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar WidgetManager = require('../base-ui/CCWidgetManager');\r\n\r\n/**\r\n * !#en Enum for Widget's alignment mode, indicating when the widget should refresh.\r\n * !#zh Widget  Widget \r\n * @enum Widget.AlignMode\r\n */\r\n/**\r\n * !#en\r\n * Only align once when the Widget is enabled for the first time.\r\n * This will allow the script or animation to continue controlling the current node.\r\n * It will only be aligned once before the end of frame when onEnable is called,\r\n * then immediately disables the Widget.\r\n * !#zh\r\n *  Widget \r\n *  onEnable  Widget\r\n * @property {Number} ONCE\r\n */\r\n/**\r\n * !#en Align first from the beginning as ONCE, and then realign it every time the window is resized.\r\n * !#zh  ONCE \r\n * @property {Number} ON_WINDOW_RESIZE\r\n */\r\n/**\r\n * !#en Keep aligning all the way.\r\n * !#zh \r\n * @property {Number} ALWAYS\r\n */\r\nvar AlignMode = WidgetManager.AlignMode;\r\n\r\nvar AlignFlags = WidgetManager._AlignFlags;\r\nvar TOP     = AlignFlags.TOP;\r\nvar MID     = AlignFlags.MID;\r\nvar BOT     = AlignFlags.BOT;\r\nvar LEFT    = AlignFlags.LEFT;\r\nvar CENTER  = AlignFlags.CENTER;\r\nvar RIGHT   = AlignFlags.RIGHT;\r\nvar TOP_BOT = TOP | BOT;\r\nvar LEFT_RIGHT = LEFT | RIGHT;\r\n\r\n/**\r\n * !#en\r\n * Stores and manipulate the anchoring based on its parent.\r\n * Widget are used for GUI but can also be used for other things.\r\n * Widget will adjust current node's position and size automatically, but the results after adjustment can not be obtained until the next frame unless you call {{#crossLink \"Widget/updateAlignment:method\"}}{{/crossLink}} manually.\r\n * !#zh\r\n * Widget Widget  UI \r\n * Widget  {{#crossLink \"Widget/updateAlignment:method\"}}{{/crossLink}}\r\n *\r\n * @class Widget\r\n * @extends Component\r\n */\r\nvar Widget = cc.Class({\r\n    name: 'cc.Widget', extends: require('./CCComponent'),\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.ui/Widget',\r\n        help: 'i18n:COMPONENT.help_url.widget',\r\n        inspector: 'packages://inspector/inspectors/comps/ccwidget.js',\r\n        executeInEditMode: true,\r\n        disallowMultiple: true,\r\n    },\r\n\r\n    properties: {\r\n\r\n        /**\r\n         * !#en Specifies an alignment target that can only be one of the parent nodes of the current node.\r\n         * The default value is null, and when null, indicates the current parent.\r\n         * !#zh \r\n         * @property {Node} target\r\n         * @default null\r\n         */\r\n        target: {\r\n            get: function () {\r\n                return this._target;\r\n            },\r\n            set: function (value) {\r\n                this._target = value;\r\n                if (CC_EDITOR && !cc.engine._isPlaying && this.node._parent) {\r\n                    // adjust the offsets to keep the size and position unchanged after target chagned\r\n                    WidgetManager.updateOffsetsToStayPut(this);\r\n                }\r\n            },\r\n            type: cc.Node,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.target',\r\n        },\r\n\r\n        // ENABLE ALIGN ?\r\n\r\n        /**\r\n         * !#en Whether to align the top.\r\n         * !#zh \r\n         * @property isAlignTop\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        isAlignTop: {\r\n            get: function () {\r\n                return (this._alignFlags & TOP) > 0;\r\n            },\r\n            set: function (value) {\r\n                this._setAlign(TOP, value);\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.align_top',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Vertically aligns the midpoint, This will open the other vertical alignment options cancel.\r\n         * !#zh\r\n         * \r\n         * @property isAlignVerticalCenter\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        isAlignVerticalCenter: {\r\n            get: function () {\r\n                return (this._alignFlags & MID) > 0;\r\n            },\r\n            set: function (value) {\r\n                if (value) {\r\n                    this.isAlignTop = false;\r\n                    this.isAlignBottom = false;\r\n                    this._alignFlags |= MID;\r\n                }\r\n                else {\r\n                    this._alignFlags &= ~MID;\r\n                }\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.align_v_center',\r\n        },\r\n\r\n        /**\r\n         * !#en Whether to align the bottom.\r\n         * !#zh \r\n         * @property isAlignBottom\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        isAlignBottom: {\r\n            get: function () {\r\n                return (this._alignFlags & BOT) > 0;\r\n            },\r\n            set: function (value) {\r\n                this._setAlign(BOT, value);\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.align_bottom',\r\n        },\r\n\r\n        /**\r\n         * !#en Whether to align the left.\r\n         * !#zh \r\n         * @property isAlignLeft\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        isAlignLeft: {\r\n            get: function () {\r\n                return (this._alignFlags & LEFT) > 0;\r\n            },\r\n            set: function (value) {\r\n                this._setAlign(LEFT, value);\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.align_left',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Horizontal aligns the midpoint. This will open the other horizontal alignment options canceled.\r\n         * !#zh\r\n         * \r\n         * @property isAlignHorizontalCenter\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        isAlignHorizontalCenter: {\r\n            get: function () {\r\n                return (this._alignFlags & CENTER) > 0;\r\n            },\r\n            set: function (value) {\r\n                if (value) {\r\n                    this.isAlignLeft = false;\r\n                    this.isAlignRight = false;\r\n                    this._alignFlags |= CENTER;\r\n                }\r\n                else {\r\n                    this._alignFlags &= ~CENTER;\r\n                }\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.align_h_center',\r\n        },\r\n\r\n        /**\r\n         * !#en Whether to align the right.\r\n         * !#zh \r\n         * @property isAlignRight\r\n         * @type {Boolean}\r\n         * @default false\r\n         */\r\n        isAlignRight: {\r\n            get: function () {\r\n                return (this._alignFlags & RIGHT) > 0;\r\n            },\r\n            set: function (value) {\r\n                this._setAlign(RIGHT, value);\r\n            },\r\n            animatable: false,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.align_right',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Whether the stretched horizontally, when enable the left and right alignment will be stretched horizontally,\r\n         * the width setting is invalid (read only).\r\n         * !#zh\r\n         * \r\n         * @property isStretchWidth\r\n         * @type {Boolean}\r\n         * @default false\r\n         * @readOnly\r\n         */\r\n        isStretchWidth: {\r\n            get: function () {\r\n                return (this._alignFlags & LEFT_RIGHT) === LEFT_RIGHT;\r\n            },\r\n            visible: false\r\n        },\r\n        /**\r\n         * !#en\r\n         * Whether the stretched vertically, when enable the left and right alignment will be stretched vertically,\r\n         * then height setting is invalid (read only)\r\n         * !#zh\r\n         * \r\n         * @property isStretchHeight\r\n         * @type {Boolean}\r\n         * @default false\r\n         * @readOnly\r\n         */\r\n        isStretchHeight: {\r\n            get: function () {\r\n                return (this._alignFlags & TOP_BOT) === TOP_BOT;\r\n            },\r\n            visible: false\r\n        },\r\n\r\n        // ALIGN MARGINS\r\n\r\n        /**\r\n         * !#en\r\n         * The margins between the top of this node and the top of parent node,\r\n         * the value can be negative, Only available in 'isAlignTop' open.\r\n         * !#zh\r\n         *  isAlignTop \r\n         * @property top\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        top: {\r\n            get: function () {\r\n                return this._top;\r\n            },\r\n            set: function (value) {\r\n                this._top = value;\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.top',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The margins between the bottom of this node and the bottom of parent node,\r\n         * the value can be negative, Only available in 'isAlignBottom' open.\r\n         * !#zh\r\n         *  isAlignBottom \r\n         * @property bottom\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        bottom: {\r\n            get: function () {\r\n                return this._bottom;\r\n            },\r\n            set: function (value) {\r\n                this._bottom = value;\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.bottom',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The margins between the left of this node and the left of parent node,\r\n         * the value can be negative, Only available in 'isAlignLeft' open.\r\n         * !#zh\r\n         *  isAlignLeft \r\n         * @property left\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        left: {\r\n            get: function () {\r\n                return this._left;\r\n            },\r\n            set: function (value) {\r\n                this._left = value;\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.left',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The margins between the right of this node and the right of parent node,\r\n         * the value can be negative, Only available in 'isAlignRight' open.\r\n         * !#zh\r\n         *  isAlignRight \r\n         * @property right\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        right: {\r\n            get: function () {\r\n                return this._right;\r\n            },\r\n            set: function (value) {\r\n                this._right = value;\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.right',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Horizontal aligns the midpoint offset value,\r\n         * the value can be negative, Only available in 'isAlignHorizontalCenter' open.\r\n         * !#zh  isAlignHorizontalCenter \r\n         * @property horizontalCenter\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        horizontalCenter: {\r\n            get: function () {\r\n                return this._horizontalCenter;\r\n            },\r\n            set: function (value) {\r\n                this._horizontalCenter = value;\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.horizontal_center',\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * Vertical aligns the midpoint offset value,\r\n         * the value can be negative, Only available in 'isAlignVerticalCenter' open.\r\n         * !#zh  isAlignVerticalCenter \r\n         * @property verticalCenter\r\n         * @type {Number}\r\n         * @default 0\r\n         */\r\n        verticalCenter: {\r\n            get: function () {\r\n                return this._verticalCenter;\r\n            },\r\n            set: function (value) {\r\n                this._verticalCenter = value;\r\n            },\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.widget.vertical_center',\r\n        },\r\n\r\n        // PARCENTAGE OR ABSOLUTE\r\n\r\n        /**\r\n         * !#en If true, horizontalCenter is pixel margin, otherwise is percentage (0 - 1) margin.\r\n         * !#zh  true\"horizontalCenter\" 0  1\r\n         * @property isAbsoluteHorizontalCenter\r\n         * @type {Boolean}\r\n         * @default true\r\n         */\r\n        isAbsoluteHorizontalCenter: {\r\n            get: function () {\r\n                return this._isAbsHorizontalCenter;\r\n            },\r\n            set: function (value) {\r\n                this._isAbsHorizontalCenter = value;\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en If true, verticalCenter is pixel margin, otherwise is percentage (0 - 1) margin.\r\n         * !#zh  true\"verticalCenter\" 0  1\r\n         * @property isAbsoluteVerticalCenter\r\n         * @type {Boolean}\r\n         * @default true\r\n         */\r\n        isAbsoluteVerticalCenter: {\r\n            get: function () {\r\n                return this._isAbsVerticalCenter;\r\n            },\r\n            set: function (value) {\r\n                this._isAbsVerticalCenter = value;\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * If true, top is pixel margin, otherwise is percentage (0 - 1) margin relative to the parent's height.\r\n         * !#zh\r\n         *  true\"top\" 0  1\r\n         * @property isAbsoluteTop\r\n         * @type {Boolean}\r\n         * @default true\r\n         */\r\n        isAbsoluteTop: {\r\n            get: function () {\r\n                return this._isAbsTop;\r\n            },\r\n            set: function (value) {\r\n                this._isAbsTop = value;\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * If true, bottom is pixel margin, otherwise is percentage (0 - 1) margin relative to the parent's height.\r\n         * !#zh\r\n         *  true\"bottom\" 0  1\r\n         * @property isAbsoluteBottom\r\n         * @type {Boolean}\r\n         * @default true\r\n         */\r\n        isAbsoluteBottom: {\r\n            get: function () {\r\n                return this._isAbsBottom;\r\n            },\r\n            set: function (value) {\r\n                this._isAbsBottom = value;\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * If true, left is pixel margin, otherwise is percentage (0 - 1) margin relative to the parent's width.\r\n         * !#zh\r\n         *  true\"left\" 0  1\r\n         * @property isAbsoluteLeft\r\n         * @type {Boolean}\r\n         * @default true\r\n         */\r\n        isAbsoluteLeft: {\r\n            get: function () {\r\n                return this._isAbsLeft;\r\n            },\r\n            set: function (value) {\r\n                this._isAbsLeft = value;\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * If true, right is pixel margin, otherwise is percentage (0 - 1) margin relative to the parent's width.\r\n         * !#zh\r\n         *  true\"right\" 0  1\r\n         * @property isAbsoluteRight\r\n         * @type {Boolean}\r\n         * @default true\r\n         */\r\n        isAbsoluteRight: {\r\n            get: function () {\r\n                return this._isAbsRight;\r\n            },\r\n            set: function (value) {\r\n                this._isAbsRight = value;\r\n            },\r\n            animatable: false\r\n        },\r\n\r\n        /**\r\n         * !#en Specifies the alignment mode of the Widget, which determines when the widget should refresh.\r\n         * !#zh  Widget  Widget \r\n         * @property {Widget.AlignMode} alignMode\r\n         * @example\r\n         * widget.alignMode = cc.Widget.AlignMode.ON_WINDOW_RESIZE;\r\n         */\r\n        alignMode: {\r\n           default: AlignMode.ON_WINDOW_RESIZE,\r\n           type: AlignMode,\r\n           tooltip: CC_DEV && 'i18n:COMPONENT.widget.align_mode',\r\n        },\r\n\r\n        //\r\n\r\n        _wasAlignOnce: {\r\n            default: undefined,\r\n            formerlySerializedAs: 'isAlignOnce',\r\n        },\r\n\r\n        _target: null,\r\n\r\n        /**\r\n         * !#zh:  AlignFlags \r\n         *\r\n         * @property _alignFlags\r\n         * @type {Number}\r\n         * @default 0\r\n         * @private\r\n         */\r\n        _alignFlags: 0,\r\n\r\n        _left: 0,\r\n        _right: 0,\r\n        _top: 0,\r\n        _bottom: 0,\r\n        _verticalCenter: 0,\r\n        _horizontalCenter: 0,\r\n        _isAbsLeft: true,\r\n        _isAbsRight: true,\r\n        _isAbsTop: true,\r\n        _isAbsBottom: true,\r\n        _isAbsHorizontalCenter: true,\r\n        _isAbsVerticalCenter: true,\r\n\r\n        // original size before align\r\n        _originalWidth: 0,\r\n        _originalHeight: 0\r\n    },\r\n\r\n    statics: {\r\n        AlignMode: AlignMode,\r\n    },\r\n\r\n    onLoad: function () {\r\n        if (this._wasAlignOnce !== undefined) {\r\n            // migrate for old version\r\n            this.alignMode = this._wasAlignOnce ? AlignMode.ONCE : AlignMode.ALWAYS;\r\n            this._wasAlignOnce = undefined;\r\n        }\r\n    },\r\n\r\n    onEnable: function () {\r\n        WidgetManager.add(this);\r\n    },\r\n\r\n    onDisable: function () {\r\n        WidgetManager.remove(this);\r\n    },\r\n\r\n    _validateTargetInDEV: CC_DEV && function () {\r\n        var target = this._target;\r\n        if (target) {\r\n            var isParent = this.node !== target && this.node.isChildOf(target);\r\n            if (!isParent) {\r\n                cc.errorID(6500);\r\n                this._target = null;\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    _setAlign: function (flag, isAlign) {\r\n        var current = (this._alignFlags & flag) > 0;\r\n        if (isAlign === current) {\r\n            return;\r\n        }\r\n        var isHorizontal = (flag & LEFT_RIGHT) > 0;\r\n        if (isAlign) {\r\n            this._alignFlags |= flag;\r\n\r\n            if (isHorizontal) {\r\n                this.isAlignHorizontalCenter = false;\r\n                if (this.isStretchWidth) {\r\n                    // become stretch\r\n                    this._originalWidth = this.node.width;\r\n                    // test check conflict\r\n                    if (CC_EDITOR && !cc.engine.isPlaying) {\r\n                        _Scene.DetectConflict.checkConflict_Widget(this);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this.isAlignVerticalCenter = false;\r\n                if (this.isStretchHeight) {\r\n                    // become stretch\r\n                    this._originalHeight = this.node.height;\r\n                    // test check conflict\r\n                    if (CC_EDITOR && !cc.engine.isPlaying) {\r\n                        _Scene.DetectConflict.checkConflict_Widget(this);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (CC_EDITOR && !cc.engine._isPlaying && this.node._parent) {\r\n                // adjust the offsets to keep the size and position unchanged after alignment chagned\r\n                WidgetManager.updateOffsetsToStayPut(this, flag);\r\n            }\r\n        }\r\n        else {\r\n            if (isHorizontal) {\r\n                if (this.isStretchWidth) {\r\n                    // will cancel stretch\r\n                    this.node.width = this._originalWidth;\r\n                }\r\n            }\r\n            else {\r\n                if (this.isStretchHeight) {\r\n                    // will cancel stretch\r\n                    this.node.height = this._originalHeight;\r\n                }\r\n            }\r\n\r\n            this._alignFlags &= ~flag;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Immediately perform the widget alignment. You need to manually call this method only if\r\n     * you need to get the latest results after the alignment before the end of current frame.\r\n     * !#zh\r\n     *  widget \r\n     *  widget \r\n     *\r\n     * @method updateAlignment\r\n     *\r\n     * @example\r\n     * widget.top = 10;       // change top margin\r\n     * cc.log(widget.node.y); // not yet changed\r\n     * widget.updateAlignment();\r\n     * cc.log(widget.node.y); // changed\r\n     */\r\n    updateAlignment: function () {\r\n        WidgetManager.updateAlignment(this.node);\r\n    },\r\n});\r\n\r\n/**\r\n * !#en\r\n * When turned on, it will only be aligned once at the end of the onEnable frame,\r\n * then immediately disables the current component.\r\n * This will allow the script or animation to continue controlling the current node.\r\n * Note: It will still be aligned at the frame when onEnable is called.\r\n * !#zh\r\n *  onEnable \r\n * \r\n * onEnable \r\n * @property {Boolean} isAlignOnce\r\n * @default false\r\n * @deprecated\r\n */\r\nObject.defineProperty(Widget.prototype, 'isAlignOnce', {\r\n    get () {\r\n        if (CC_DEBUG) {\r\n            cc.warn('`widget.isAlignOnce` is deprecated, use `widget.alignMode === cc.Widget.AlignMode.ONCE` instead please.');\r\n        }\r\n        return this.alignMode === AlignMode.ONCE;\r\n    },\r\n    set (value) {\r\n        if (CC_DEBUG) {\r\n            cc.warn('`widget.isAlignOnce` is deprecated, use `widget.alignMode = cc.Widget.AlignMode.*` instead please.');\r\n        }\r\n        this.alignMode = value ? AlignMode.ONCE : AlignMode.ALWAYS;\r\n    }\r\n});\r\n\r\n\r\ncc.Widget = module.exports = Widget;\r\n","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Component = require('./CCComponent');\r\n\r\nlet WXSubContextView;\r\n\r\nif (!CC_EDITOR && !CC_WECHATGAME) {\r\n    WXSubContextView = cc.Class({\r\n        name: 'cc.WXSubContextView',\r\n        extends: Component,\r\n    })\r\n}\r\nelse {\r\n    /**\r\n     * !#en WXSubContextView is a view component which controls open data context viewport in Wechat game platform.<br/>\r\n     * The component's node size decide the viewport of the sub context content in main context, \r\n     * the entire sub context texture will be scaled to the node's bounding box area.<br/>\r\n     * This component provides multiple important features:<br/>\r\n     * 1. Sub context could use its own resolution size and policy.<br/>\r\n     * 2. Sub context could be minized to smallest size it needed.<br/>\r\n     * 3. Resolution of sub context content could be increased.<br/>\r\n     * 4. User touch input is transformed to the correct viewport.<br/>\r\n     * 5. Texture update is handled by this component. User don't need to worry.<br/>\r\n     * One important thing to be noted, whenever the node's bounding box change, \r\n     * you need to manually reset the viewport of sub context using updateSubContextViewport.\r\n     * !#zh WXSubContextView <br/>\r\n     * <br/>\r\n     * <br/>\r\n     * 1. <br/>\r\n     * 2. <br/>\r\n     * 3. <br/>\r\n     * 4. <br/>\r\n     * 5. <br/>\r\n     *  `updateSubContextViewport` \r\n     * @class WXSubContextView\r\n     * @extends Component\r\n     */\r\n    WXSubContextView = cc.Class({\r\n        name: 'cc.WXSubContextView',\r\n        extends: Component,\r\n\r\n        editor: CC_EDITOR && {\r\n            menu: 'i18n:MAIN_MENU.component.others/WXSubContextView',\r\n            help: 'i18n:COMPONENT.help_url.wx_subcontext_view'\r\n        },\r\n\r\n        ctor () {\r\n            this._sprite = null;\r\n            this._tex = new cc.Texture2D();\r\n            this._context = null;\r\n        },\r\n\r\n        onLoad () {\r\n            // Setup subcontext canvas size\r\n            if (wx.getOpenDataContext) {\r\n                this._context = wx.getOpenDataContext();\r\n                let sharedCanvas = this._context.canvas;\r\n                if (sharedCanvas) {\r\n                    sharedCanvas.width = this.node.width;\r\n                    sharedCanvas.height = this.node.height;\r\n                }\r\n                this._tex.setPremultiplyAlpha(true);\r\n                this._tex.initWithElement(sharedCanvas);\r\n\r\n                this._sprite = this.node.getComponent(cc.Sprite);\r\n                if (!this._sprite) {\r\n                    this._sprite = this.node.addComponent(cc.Sprite);\r\n                    this._sprite.srcBlendFactor = cc.macro.BlendFactor.ONE;\r\n                }\r\n                this._sprite.spriteFrame = new cc.SpriteFrame(this._tex);\r\n            }\r\n            else {\r\n                this.enabled = false;\r\n            }\r\n        },\r\n\r\n        onEnable () {\r\n            this.updateSubContextViewport();\r\n        },\r\n\r\n        update () {\r\n            if (!this._tex || !this._context) {\r\n                return;\r\n            }\r\n            this._tex.initWithElement(this._context.canvas);\r\n            this._sprite._activateMaterial();\r\n        },\r\n\r\n        /**\r\n         * !#en Update the sub context viewport manually, it should be called whenever the node's bounding box changes.\r\n         * !#zh  viewport\r\n         * @method updateSubContextViewport\r\n         */\r\n        updateSubContextViewport () {\r\n            if (this._context) {\r\n                let box = this.node.getBoundingBoxToWorld();\r\n                let sx = cc.view._scaleX;\r\n                let sy = cc.view._scaleY;\r\n                this._context.postMessage({\r\n                    fromEngine: true,\r\n                    event: 'viewport',\r\n                    x: box.x * sx + cc.view._viewportRect.x,\r\n                    y: box.y * sy + cc.view._viewportRect.y,\r\n                    width: box.width * sx,\r\n                    height: box.height * sy\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n}\r\n\r\ncc.WXSubContextView = module.exports = WXSubContextView;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst macro = require('../../platform/CCMacro');\r\nconst EditBoxImpl = require('../editbox/CCEditBoxImpl');\r\nconst Label = require('../CCLabel');\r\nconst Types = require('./types');\r\nconst InputMode = Types.InputMode;\r\nconst InputFlag = Types.InputFlag;\r\nconst KeyboardReturnType = Types.KeyboardReturnType;\r\n\r\nconst LEFT_PADDING = 2;\r\n\r\nfunction capitalize (string) {\r\n    return string.replace(/(?:^|\\s)\\S/g, function(a) { return a.toUpperCase(); });\r\n}\r\n\r\nfunction capitalizeFirstLetter (string) {\r\n    return string.charAt(0).toUpperCase() + string.slice(1);\r\n}\r\n\r\n\r\n/**\r\n * !#en cc.EditBox is a component for inputing text, you can use it to gather small amounts of text from users.\r\n * !#zh EditBox \r\n * @class EditBox\r\n * @extends Component\r\n */\r\nlet EditBox = cc.Class({\r\n    name: 'cc.EditBox',\r\n    extends: cc.Component,\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.ui/EditBox',\r\n        inspector: 'packages://inspector/inspectors/comps/cceditbox.js',\r\n        help: 'i18n:COMPONENT.help_url.editbox',\r\n        executeInEditMode: true,\r\n    },\r\n\r\n    properties: {\r\n        _useOriginalSize: true,\r\n        _string: '',\r\n        /**\r\n         * !#en Input string of EditBox.\r\n         * !#zh \r\n         * @property {String} string\r\n         */\r\n        string: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.string',\r\n            get () {\r\n                return this._string;\r\n            },\r\n            set(value) {\r\n                if (this.maxLength >= 0 && value.length >= this.maxLength) {\r\n                    value = value.slice(0, this.maxLength);\r\n                }\r\n\r\n                this._string = value;\r\n                if (this._impl) {\r\n                    this._updateString(value);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The background image of EditBox.\r\n         * !#zh \r\n         * @property {SpriteFrame} backgroundImage\r\n         */\r\n        backgroundImage: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.backgroundImage',\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n            notify () {\r\n                this._createBackgroundSprite();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The return key type of EditBox.\r\n         * Note: it is meaningless for web platforms and desktop platforms.\r\n         * !#zh\r\n         * \r\n         *  web  desktop \r\n         * @property {EditBox.KeyboardReturnType} returnType\r\n         * @default KeyboardReturnType.DEFAULT\r\n         */\r\n        returnType: {\r\n            default: KeyboardReturnType.DEFAULT,\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.returnType',\r\n            displayName: 'KeyboardReturnType',\r\n            type: KeyboardReturnType,\r\n            notify () {\r\n                if (this._impl) {\r\n                    this._impl.returnType = this.returnType;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Set the input flags that are to be applied to the EditBox.\r\n         * !#zh \r\n         * @property {EditBox.InputFlag} inputFlag\r\n         * @default InputFlag.DEFAULT\r\n         */\r\n        inputFlag: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.input_flag',\r\n            default: InputFlag.DEFAULT,\r\n            type: InputFlag,\r\n            notify () {\r\n                if (this._impl) {\r\n                    this._impl.setInputFlag(this.inputFlag);\r\n                    this._updateString(this._string);\r\n                }\r\n            }\r\n        },\r\n        /**\r\n         * !#en\r\n         * Set the input mode of the edit box.\r\n         * If you pass ANY, it will create a multiline EditBox.\r\n         * !#zh\r\n         * : ANY\r\n         * @property {EditBox.InputMode} inputMode\r\n         * @default InputMode.ANY\r\n         */\r\n        inputMode: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.input_mode',\r\n            default: InputMode.ANY,\r\n            type: InputMode,\r\n            notify () {\r\n                if (this._impl) {\r\n                    this._impl.setInputMode(this.inputMode);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Font size of the input text.\r\n         * !#zh \r\n         * @property {Number} fontSize\r\n         */\r\n        fontSize: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.font_size',\r\n            default: 20,\r\n            notify () {\r\n                if (this._textLabel) {\r\n                    this._textLabel.fontSize = this.fontSize;\r\n                }\r\n                if (this._impl) {\r\n                    this._impl.setFontSize(this.fontSize);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Change the lineHeight of displayed text.\r\n         * !#zh \r\n         * @property {Number} lineHeight\r\n         */\r\n        lineHeight: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.line_height',\r\n            default: 40,\r\n            notify () {\r\n                if (this._textLabel) {\r\n                    this._textLabel.lineHeight = this.lineHeight;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Font color of the input text.\r\n         * !#zh \r\n         * @property {Color} fontColor\r\n         */\r\n        fontColor: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.font_color',\r\n            default: cc.Color.WHITE,\r\n            notify () {\r\n                if (this._textLabel) {\r\n                    this._textLabel.node.opacity = this.fontColor.a;\r\n                    this._textLabel.node.color = this.fontColor;\r\n                }\r\n                if (this._impl) {\r\n                    this._impl.setFontColor(this.fontColor);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The display text of placeholder.\r\n         * !#zh \r\n         * @property {String} placeholder\r\n         */\r\n        placeholder: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.placeholder',\r\n            default: 'Enter text here...',\r\n            notify () {\r\n                if (this._placeholderLabel) {\r\n                    this._placeholderLabel.string = this.placeholder;\r\n                }\r\n                if (this._impl) {\r\n                    this._impl.setPlaceholderText(this.placeholder);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The font size of placeholder.\r\n         * !#zh \r\n         * @property {Number} placeholderFontSize\r\n         */\r\n        placeholderFontSize: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.placeholder_font_size',\r\n            default: 20,\r\n            notify () {\r\n                if (this._placeholderLabel) {\r\n                    this._placeholderLabel.fontSize = this.placeholderFontSize;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The font color of placeholder.\r\n         * !#zh \r\n         * @property {Color} placeholderFontColor\r\n         */\r\n        placeholderFontColor: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.placeholder_font_color',\r\n            default: cc.Color.GRAY,\r\n            notify () {\r\n                if (this._placeholderLabel) {\r\n                    this._placeholderLabel.node.color = this.placeholderFontColor;\r\n                    this._placeholderLabel.node.opacity = this.placeholderFontColor.a;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The maximize input length of EditBox.\r\n         * - If pass a value less than 0, it won't limit the input number of characters.\r\n         * - If pass 0, it doesn't allow input any characters.\r\n         * !#zh \r\n         * -  0 \r\n         * -  0\r\n         * @property {Number} maxLength\r\n         */\r\n        maxLength: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.max_length',\r\n            default: 20,\r\n            notify () {\r\n                if (this._impl) {\r\n                    this._impl.setMaxLength(this.maxLength);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The input is always visible and be on top of the game view (only useful on Web).\r\n         * !zh  Web \r\n         * Note: only available on Web at the moment.\r\n         * @property {Boolean} stayOnTop\r\n         */\r\n        stayOnTop: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.stay_on_top',\r\n            default: false,\r\n            notify () {\r\n                if (this._impl) {\r\n                    this._updateStayOnTop();\r\n                }\r\n            }\r\n        },\r\n\r\n        _tabIndex: 0,\r\n\r\n        /**\r\n         * !#en Set the tabIndex of the DOM input element (only useful on Web).\r\n         * !#zh  DOM  tabIndex Web \r\n         * @property {Number} tabIndex\r\n         */\r\n        tabIndex: {\r\n            tooltip: CC_DEV && 'i18n:COMPONENT.editbox.tab_index',\r\n            get () {\r\n                return this._tabIndex;\r\n            },\r\n            set (value) {\r\n                this._tabIndex = value;\r\n                if (this._impl) {\r\n                    this._impl.setTabIndex(value);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en The event handler to be called when EditBox began to edit text.\r\n         * !#zh \r\n         * @property {Component.EventHandler[]} editingDidBegan\r\n         */\r\n        editingDidBegan: {\r\n            default: [],\r\n            type: cc.Component.EventHandler,\r\n        },\r\n\r\n        /**\r\n         * !#en The event handler to be called when EditBox text changes.\r\n         * !#zh \r\n         * @property {Component.EventHandler[]} textChanged\r\n         */\r\n        textChanged: {\r\n            default: [],\r\n            type: cc.Component.EventHandler,\r\n        },\r\n\r\n        /**\r\n         * !#en The event handler to be called when EditBox edit ends.\r\n         * !#zh \r\n         * @property {Component.EventHandler[]} editingDidEnded\r\n         */\r\n        editingDidEnded: {\r\n            default: [],\r\n            type: cc.Component.EventHandler,\r\n        },\r\n\r\n        /**\r\n         * !#en The event handler to be called when return key is pressed. Windows is not supported.\r\n         * !#zh  windows \r\n         * @property {Component.EventHandler[]} editingReturn\r\n         */\r\n        editingReturn: {\r\n            default: [],\r\n            type: cc.Component.EventHandler\r\n        }\r\n\r\n    },\r\n\r\n    statics: {\r\n        _EditBoxImpl: EditBoxImpl,\r\n        KeyboardReturnType: KeyboardReturnType,\r\n        InputFlag: InputFlag,\r\n        InputMode: InputMode\r\n    },\r\n\r\n    _init () {\r\n        this._createBackgroundSprite();\r\n        this._createLabels();\r\n        this.node.on(cc.Node.EventType.SIZE_CHANGED, this._resizeChildNodes, this);\r\n\r\n        let impl = this._impl = new EditBoxImpl();\r\n\r\n        impl.setDelegate(this);\r\n        impl.setNode(this.node);\r\n        impl.setInputMode(this.inputMode);\r\n        impl.setMaxLength(this.maxLength);\r\n        impl.setInputFlag(this.inputFlag);\r\n        impl.setReturnType(this.returnType);\r\n        impl.setTabIndex(this.tabIndex);\r\n        impl.setFontColor(this.fontColor);\r\n        impl.setFontSize(this.fontSize);\r\n        impl.setPlaceholderText(this.placeholder);\r\n\r\n        this._updateStayOnTop();\r\n        this._updateString(this.string);\r\n        this._syncSize();\r\n    },\r\n\r\n    _updateStayOnTop () {\r\n        if (this.stayOnTop) {\r\n            this._hideLabels();\r\n        }\r\n        else {\r\n            this._showLabels();\r\n        }\r\n        this._impl.stayOnTop(this.stayOnTop);\r\n    },\r\n\r\n    _syncSize () {\r\n        let size = this.node.getContentSize();\r\n        \r\n        this._background.node.setAnchorPoint(this.node.getAnchorPoint());\r\n        this._background.node.setContentSize(size);\r\n\r\n        this._updateLabelPosition(size);\r\n        this._impl.setSize(size.width, size.height);\r\n    },\r\n\r\n    _updateLabelPosition (size) {\r\n        let node = this.node;\r\n        let offx = -node.anchorX * node.width;\r\n        let offy = -node.anchorY * node.height;\r\n\r\n        let placeholderLabel = this._placeholderLabel;\r\n        let textLabel = this._textLabel;\r\n\r\n        textLabel.node.setContentSize(size.width - LEFT_PADDING, size.height);\r\n        placeholderLabel.node.setContentSize(size.width - LEFT_PADDING, size.height);\r\n        placeholderLabel.lineHeight = size.height;\r\n\r\n        placeholderLabel.node.setPosition(offx + LEFT_PADDING, offy + size.height);\r\n        textLabel.node.setPosition(offx + LEFT_PADDING, offy + size.height);\r\n\r\n        if (this.inputMode === InputMode.ANY){\r\n            placeholderLabel.verticalAlign = macro.VerticalTextAlignment.TOP;\r\n            placeholderLabel.enableWrapText = true;\r\n            textLabel.verticalAlign = macro.VerticalTextAlignment.TOP;\r\n            textLabel.enableWrapText = true;\r\n        }\r\n        else {\r\n            placeholderLabel.verticalAlign = macro.VerticalTextAlignment.CENTER;\r\n            placeholderLabel.enableWrapText = false;\r\n            textLabel.verticalAlign = macro.VerticalTextAlignment.CENTER;\r\n            textLabel.enableWrapText = false;\r\n        }\r\n    },\r\n\r\n    _createBackgroundSprite () {\r\n        let background = this._background;\r\n        if (!background) {\r\n            let node = this.node.getChildByName('BACKGROUND_SPRITE');\r\n            if (!node) {\r\n                node = new cc.Node('BACKGROUND_SPRITE');\r\n            }\r\n            \r\n            background = node.getComponent(cc.Sprite);\r\n            if (!background) {\r\n                background = node.addComponent(cc.Sprite);\r\n            }\r\n            background.type = cc.Sprite.Type.SLICED;\r\n\r\n            node.parent = this.node;\r\n            this._background = background;\r\n        }\r\n        background.spriteFrame = this.backgroundImage;\r\n    },\r\n\r\n    _createLabels () {\r\n        if (!this._textLabel) {\r\n            let node = this.node.getChildByName('TEXT_LABEL');\r\n            if (!node) {\r\n                node = new cc.Node('TEXT_LABEL');\r\n            }\r\n            node.color = this.fontColor;\r\n            node.parent = this.node;\r\n            node.setAnchorPoint(0, 1);\r\n\r\n            let textLabel = node.getComponent(Label);\r\n            if (!textLabel) {\r\n                textLabel = node.addComponent(Label);\r\n            }\r\n            textLabel.overflow = Label.Overflow.CLAMP;\r\n            textLabel.fontSize = this.fontSize;\r\n            textLabel.lineHeight = this.lineHeight;\r\n            this._textLabel = textLabel;\r\n        }\r\n\r\n        if (!this._placeholderLabel) {\r\n            let node = this.node.getChildByName('PLACEHOLDER_LABEL');\r\n            if (!node) {\r\n                node = new cc.Node('PLACEHOLDER_LABEL');\r\n            }\r\n            node.color = this.placeholderFontColor;\r\n            node.parent = this.node;\r\n            node.setAnchorPoint(0, 1);\r\n\r\n            let placeholderLabel = node.getComponent(Label);\r\n            if (!placeholderLabel) {\r\n                placeholderLabel = node.addComponent(Label);\r\n            }\r\n            placeholderLabel.overflow = Label.Overflow.CLAMP;\r\n            placeholderLabel.fontSize = this.placeholderFontSize;\r\n            placeholderLabel.string = this.placeholder;\r\n            this._placeholderLabel = placeholderLabel;\r\n        }\r\n    },\r\n\r\n    _resizeChildNodes () {\r\n        let textLabelNode = this._textLabel.node,\r\n            placeholderLabelNode = this._placeholderLabel.node,\r\n            backgroundNode = this._background.node;\r\n            \r\n        textLabelNode.x = -this.node.width/2;\r\n        textLabelNode.y = this.node.height/2;\r\n        textLabelNode.width = this.node.width;\r\n        textLabelNode.height = this.node.height;\r\n        \r\n        placeholderLabelNode.x = -this.node.width/2;\r\n        placeholderLabelNode.y = this.node.height/2;\r\n        placeholderLabelNode.width = this.node.width;\r\n        placeholderLabelNode.height = this.node.height;            \r\n        \r\n        backgroundNode.width = this.node.width;\r\n        backgroundNode.height = this.node.height;\r\n    },\r\n\r\n    _showLabels () {\r\n        let displayText = this._textLabel.string;\r\n        this._textLabel.node.active = displayText !== '';\r\n        this._placeholderLabel.node.active = displayText === '';\r\n    },\r\n\r\n    _hideLabels () {\r\n        this._textLabel.node.active = false;\r\n        this._placeholderLabel.node.active = false;\r\n    },\r\n\r\n    _updateString (text) {\r\n        let textLabel = this._textLabel;\r\n        // Not inited yet\r\n        if (!textLabel) {\r\n            return;\r\n        }\r\n\r\n        let displayText = text;\r\n        if (displayText) {\r\n            displayText = this._updateLabelStringStyle(displayText);\r\n        }\r\n\r\n        textLabel.string = displayText;\r\n        this._impl.setString(text);\r\n        if (!this._impl._editing && !this.stayOnTop) {\r\n            this._showLabels();\r\n        }\r\n    },\r\n\r\n    _updateLabelStringStyle (text, ignorePassword) {\r\n        let inputFlag = this.inputFlag;\r\n        if (!ignorePassword && inputFlag === InputFlag.PASSWORD) {\r\n            let passwordString = '';\r\n            let len = text.length;\r\n            for (let i = 0; i < len; ++i) {\r\n                passwordString += '\\u25CF';\r\n            }\r\n            text = passwordString;\r\n        } \r\n        else if (inputFlag === InputFlag.INITIAL_CAPS_ALL_CHARACTERS) {\r\n            text = text.toUpperCase();\r\n        }\r\n        else if (inputFlag === InputFlag.INITIAL_CAPS_WORD) {\r\n            text = capitalize(text);\r\n        }\r\n        else if (inputFlag === InputFlag.INITIAL_CAPS_SENTENCE) {\r\n            text = capitalizeFirstLetter(text);\r\n        }\r\n\r\n        return text;\r\n    },\r\n\r\n    editBoxEditingDidBegan () {\r\n        this._hideLabels();\r\n        cc.Component.EventHandler.emitEvents(this.editingDidBegan, this);\r\n        this.node.emit('editing-did-began', this);\r\n    },\r\n\r\n    editBoxEditingDidEnded () {\r\n        if (!this.stayOnTop) {\r\n            this._showLabels();\r\n        }\r\n        cc.Component.EventHandler.emitEvents(this.editingDidEnded, this);\r\n        this.node.emit('editing-did-ended', this);\r\n    },\r\n\r\n    editBoxTextChanged (text) {\r\n        text = this._updateLabelStringStyle(text, true);\r\n        this.string = text;\r\n        cc.Component.EventHandler.emitEvents(this.textChanged, text, this);\r\n        this.node.emit('text-changed', this);\r\n    },\r\n\r\n    editBoxEditingReturn() {\r\n        cc.Component.EventHandler.emitEvents(this.editingReturn, this);\r\n        this.node.emit('editing-return', this);\r\n    },\r\n\r\n    onDestroy () {\r\n        this._impl.clear();\r\n    },\r\n\r\n    onEnable () {\r\n        this._impl && this._impl.onEnable();\r\n    },\r\n\r\n    onDisable () {\r\n        this._impl && this._impl.onDisable();\r\n    },\r\n\r\n    __preload () {\r\n        if (!CC_EDITOR) {\r\n            this._registerEvent();\r\n        }\r\n        this._init();\r\n    },\r\n\r\n    _registerEvent () {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this);\r\n    },\r\n\r\n    _onTouchBegan (event) {\r\n        if (this._impl) {\r\n            this._impl._onTouchBegan(event.touch);\r\n        }\r\n        event.stopPropagation();\r\n    },\r\n\r\n    _onTouchCancel (event) {\r\n        if (this._impl) {\r\n            this._impl._onTouchCancel();\r\n        }\r\n        event.stopPropagation();\r\n    },\r\n\r\n    _onTouchEnded (event) {\r\n        if (this._impl) {\r\n            this._impl._onTouchEnded();\r\n        }\r\n        event.stopPropagation();\r\n    },\r\n\r\n    /**\r\n     * !#en Let the EditBox get focus\r\n     * !#zh  EditBox \r\n     * @method setFocus\r\n     */\r\n    setFocus () {\r\n        if(this._impl) {\r\n            this._impl.setFocus();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Determine whether EditBox is getting focus or not.\r\n     * !#zh  EditBox \r\n     * Note: only available on Web at the moment.\r\n     * @method isFocused\r\n     */\r\n    isFocused () {\r\n        let isFocused = false;\r\n        if (this._impl) {\r\n            isFocused = this._impl.isFocused();\r\n        }\r\n        return isFocused;\r\n    },\r\n\r\n    update () {\r\n        if (this._impl) {\r\n            this._impl.update();\r\n        }\r\n    }\r\n\r\n});\r\n\r\ncc.EditBox = module.exports = EditBox;\r\n\r\n/**\r\n * !#en\r\n * Note: This event is emitted from the node to which the component belongs.\r\n * !#zh\r\n *  Node  node.on \r\n * @event editing-did-began\r\n * @param {Event.EventCustom} event\r\n * @param {EditBox} editbox - The EditBox component.\r\n */\r\n\r\n/**\r\n * !#en\r\n * Note: This event is emitted from the node to which the component belongs.\r\n * !#zh\r\n *  Node  node.on \r\n * @event editing-did-ended\r\n * @param {Event.EventCustom} event\r\n * @param {EditBox} editbox - The EditBox component.\r\n */\r\n\r\n/**\r\n * !#en\r\n * Note: This event is emitted from the node to which the component belongs.\r\n * !#zh\r\n *  Node  node.on \r\n * @event text-changed\r\n * @param {Event.EventCustom} event\r\n * @param {EditBox} editbox - The EditBox component.\r\n */\r\n\r\n/**\r\n * !#en\r\n * Note: This event is emitted from the node to which the component belongs.\r\n * !#zh\r\n *  Node  node.on \r\n * @event editing-return\r\n * @param {Event.EventCustom} event\r\n * @param {EditBox} editbox - The EditBox component.\r\n */\r\n\r\n/**\r\n * !#en if you don't need the EditBox and it isn't in any running Scene, you should\r\n * call the destroy method on this component or the associated node explicitly.\r\n * Otherwise, the created DOM element won't be removed from web page.\r\n * !#zh\r\n *  EditBox destroy\r\n *  DOM  Web \r\n * @example\r\n * editbox.node.parent = null;  // or  editbox.node.removeFromParent(false);\r\n * // when you don't need editbox anymore\r\n * editbox.node.destroy();\r\n * @method destroy\r\n * @return {Boolean} whether it is the first time the destroy being called\r\n */\r\n","/****************************************************************************\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2012 James Chen\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst utils = require('../../platform/utils');\r\nconst macro = require('../../platform/CCMacro');\r\nconst Types = require('./types');\r\nconst InputMode = Types.InputMode;\r\nconst InputFlag = Types.InputFlag;\r\nconst KeyboardReturnType = Types.KeyboardReturnType;\r\n\r\n// https://segmentfault.com/q/1010000002914610\r\nlet SCROLLY = 40;\r\nlet LEFT_PADDING = 2;\r\nlet DELAY_TIME = 400;\r\nlet FOCUS_DELAY_UC = 400;\r\nlet FOCUS_DELAY_FIREFOX = 0;\r\n\r\nlet math = cc.vmath;\r\nlet _matrix = math.mat4.create();\r\nlet _matrix_temp = math.mat4.create();\r\nlet _vec3 = cc.v3();\r\n\r\nlet _currentEditBoxImpl = null;\r\n\r\n// polyfill\r\nlet polyfill = {\r\n    zoomInvalid: false\r\n};\r\n\r\nif (cc.sys.OS_ANDROID === cc.sys.os &&\r\n    (cc.sys.browserType === cc.sys.BROWSER_TYPE_SOUGOU ||\r\n    cc.sys.browserType === cc.sys.BROWSER_TYPE_360)) {\r\n    polyfill.zoomInvalid = true;\r\n}\r\n\r\nfunction getKeyboardReturnType (type) {\r\n    switch (type) {\r\n        case KeyboardReturnType.DEFAULT:\r\n        case KeyboardReturnType.DONE:\r\n            return 'done';\r\n        case KeyboardReturnType.SEND:\r\n            return 'send';\r\n        case KeyboardReturnType.SEARCH:\r\n            return 'search';\r\n        case KeyboardReturnType.GO:\r\n            return 'go';\r\n        case KeyboardReturnType.NEXT:\r\n            return 'next';\r\n    }\r\n    return 'done';\r\n}\r\n\r\nlet EditBoxImpl = cc.Class({\r\n    ctor () {\r\n        this._delegate = null;\r\n        this._inputMode = -1;\r\n        this._inputFlag = -1;\r\n        this._returnType = KeyboardReturnType.DEFAULT;\r\n        this._maxLength = 50;\r\n        this._text = '';\r\n        this._placeholderText = '';\r\n        this._alwaysOnTop = false;\r\n        this._size = cc.size();\r\n        this._node = null;\r\n        this._editing = false;\r\n        \r\n        this.__eventListeners = {};\r\n        this.__fullscreen = false;\r\n        this.__autoResize = false;\r\n        this.__rotateScreen = false;\r\n        this.__orientationChanged = null;\r\n    },\r\n\r\n    onEnable () {\r\n        if (!this._edTxt) {\r\n            return;\r\n        }\r\n        if (this._alwaysOnTop) {\r\n            this._edTxt.style.display = '';\r\n        } \r\n        else {\r\n            this._edTxt.style.display = 'none';\r\n        }\r\n    },\r\n\r\n    onDisable () {\r\n        if (!this._edTxt) {\r\n            return;\r\n        }\r\n        this._edTxt.style.display = 'none';\r\n    },\r\n\r\n    setTabIndex (index) {\r\n        if (this._edTxt) {\r\n            this._edTxt.tabIndex = index;\r\n        }\r\n    },\r\n\r\n    setFocus () {\r\n        this._beginEditing();\r\n    },\r\n\r\n    isFocused() {\r\n        if (this._edTxt) {\r\n            return document.activeElement === this._edTxt;\r\n        }\r\n        cc.warnID(4700);\r\n        return false;\r\n    },\r\n\r\n    stayOnTop (flag) {\r\n        if(this._alwaysOnTop === flag || !this._edTxt) return;\r\n\r\n        this._alwaysOnTop = flag;\r\n        \r\n        if (flag) {\r\n            this._edTxt.style.display = '';\r\n        } else {\r\n            this._edTxt.style.display = 'none';\r\n        }\r\n    },\r\n\r\n    setMaxLength (maxLength) {\r\n        if (!isNaN(maxLength)) {\r\n            if(maxLength < 0) {\r\n                //we can't set Number.MAX_VALUE to input's maxLength property\r\n                //so we use a magic number here, it should works at most use cases.\r\n                maxLength = 65535;\r\n            }\r\n            this._maxLength = maxLength;\r\n            this._edTxt && (this._edTxt.maxLength = maxLength);\r\n        }\r\n    },\r\n\r\n    setString (text) {\r\n        this._text = text;\r\n        this._edTxt && (this._edTxt.value = text);\r\n    },\r\n\r\n    getString () {\r\n        return this._text;\r\n    },\r\n\r\n    setPlaceholderText (text) {\r\n        this._placeholderText = text;\r\n    },\r\n\r\n    getPlaceholderText () {\r\n        return this._placeholderText;\r\n    },\r\n\r\n    setDelegate (delegate) {\r\n        this._delegate = delegate;\r\n    },\r\n\r\n    setInputMode (inputMode) {\r\n        if (this._inputMode === inputMode) return;\r\n\r\n        this._inputMode = inputMode;\r\n        this.createInput();\r\n    \r\n        this._updateDomInputType();\r\n        this._updateSize(this._size.width, this._size.height);\r\n    },\r\n\r\n    setInputFlag (inputFlag) {\r\n        if (this._inputFlag === inputFlag) return;\r\n\r\n        this._inputFlag = inputFlag;\r\n        this._updateDomInputType();\r\n\r\n        let textTransform = 'none';\r\n\r\n        if (inputFlag === InputFlag.INITIAL_CAPS_ALL_CHARACTERS) {\r\n            textTransform = 'uppercase';\r\n        }\r\n        else if (inputFlag === InputFlag.INITIAL_CAPS_WORD) {\r\n            textTransform = 'capitalize';\r\n        }\r\n\r\n        if (this._edTxt) {\r\n            this._edTxt.style.textTransform = textTransform;\r\n            this._edTxt.value = this._text;\r\n        }\r\n    },\r\n\r\n    setReturnType (returnType) {\r\n        this._returnType = returnType;\r\n        this._updateDomInputType();\r\n    },\r\n\r\n    setFontSize (fontSize) {\r\n        this._edFontSize = fontSize || this._edFontSize;\r\n        this._edTxt && (this._edTxt.style.fontSize = this._edFontSize + 'px');\r\n    },\r\n    \r\n    setFontColor (color) {\r\n        this._textColor = color;\r\n        this._edTxt && (this._edTxt.style.color = color.toCSS('rgba'));\r\n    },\r\n    \r\n    setSize (width, height) {\r\n        this._size.width = width;\r\n        this._size.height = height;\r\n        this._updateSize(width, height);\r\n    },\r\n\r\n    setNode (node) {\r\n        this._node = node;\r\n    },\r\n\r\n    update () {\r\n        // TODO: find better way to update matrix\r\n        // if (this._editing) {\r\n            this._updateMatrix();\r\n        // }\r\n    },\r\n\r\n    clear () {\r\n        this._node = null;\r\n        this.setDelegate(null);\r\n        this.removeDom();\r\n        if (this.__orientationChanged) {\r\n            window.removeEventListener('orientationchange', this.__orientationChanged);\r\n            this.__orientationChanged = null;\r\n        }\r\n    },\r\n\r\n    _onTouchBegan (touch) {\r\n        \r\n    },\r\n\r\n    _onTouchEnded () {\r\n        this._beginEditing();\r\n    },\r\n\r\n    _beginEditing () {\r\n        if (cc.sys.isMobile && !this._editing) {\r\n            // Pre adaptation\r\n            this._beginEditingOnMobile();\r\n        }\r\n\r\n        if (this._edTxt) {\r\n            this._edTxt.style.display = '';\r\n\r\n            let self = this;\r\n            function startFocus () {\r\n                self._edTxt.focus();\r\n            }\r\n\r\n            if (cc.sys.browserType === cc.sys.BROWSER_TYPE_UC) {\r\n                setTimeout(startFocus, FOCUS_DELAY_UC);\r\n            }\r\n            else if (cc.sys.browserType === cc.sys.BROWSER_TYPE_FIREFOX) {\r\n                setTimeout(startFocus, FOCUS_DELAY_FIREFOX);\r\n            }\r\n            else {\r\n                startFocus();\r\n            }\r\n        }\r\n    \r\n        this._editing = true;\r\n    },\r\n    \r\n    _endEditing () {\r\n        let self = this;\r\n        let hideDomInputAndShowLabel = function () {\r\n            if (!self._alwaysOnTop && self._edTxt) {\r\n                self._edTxt.style.display = 'none';\r\n            }\r\n            if (self._delegate && self._delegate.editBoxEditingDidEnded) {\r\n                self._delegate.editBoxEditingDidEnded();\r\n            }\r\n        };\r\n        if (this._editing) {\r\n            if (cc.sys.isMobile) {\r\n                // Delay end editing adaptation to ensure virtual keyboard is disapeared\r\n                setTimeout(function () {\r\n                    self._endEditingOnMobile();\r\n                    hideDomInputAndShowLabel();\r\n                }, DELAY_TIME);\r\n            }\r\n            else {\r\n                hideDomInputAndShowLabel();\r\n            }\r\n        }\r\n        this._editing = false;\r\n    },\r\n    \r\n    _updateDomInputType () {\r\n        let inputMode = this._inputMode;\r\n        let edTxt = this._edTxt;\r\n        if (!edTxt) return;\r\n    \r\n        if (this._inputFlag === InputFlag.PASSWORD) {\r\n            edTxt.type = 'password';\r\n            return;\r\n        }\r\n    \r\n        let type = edTxt.type;\r\n        if (inputMode === InputMode.EMAIL_ADDR) {\r\n            type = 'email';\r\n        } else if(inputMode === InputMode.NUMERIC || inputMode === InputMode.DECIMAL) {\r\n            type = 'number';\r\n        } else if(inputMode === InputMode.PHONE_NUMBER) {\r\n            type = 'number';\r\n            edTxt.pattern = '[0-9]*';\r\n        } else if(inputMode === InputMode.URL) {\r\n            type = 'url';\r\n        } else {\r\n            type = 'text';\r\n    \r\n            if (this._returnType === KeyboardReturnType.SEARCH) {\r\n                type = 'search';\r\n            }\r\n        }\r\n    \r\n        edTxt.type = type;\r\n    },\r\n    \r\n    _updateSize (newWidth, newHeight) {\r\n        let edTxt = this._edTxt;\r\n        if (!edTxt) return;\r\n    \r\n        edTxt.style.width = newWidth + 'px';\r\n        edTxt.style.height = newHeight + 'px';\r\n    },\r\n\r\n    _updateMatrix () {\r\n        if (!this._edTxt) return;\r\n\r\n        let camera;\r\n        // can't find camera in editor\r\n        if (CC_EDITOR) {\r\n            camera = cc.Camera.main;\r\n        }\r\n        else {\r\n            camera = cc.Camera.findCamera(this._node);\r\n        }\r\n        if (!camera) return;\r\n    \r\n        let node = this._node, \r\n            scaleX = cc.view._scaleX, scaleY = cc.view._scaleY,\r\n            viewport = cc.view._viewportRect,\r\n            dpr = cc.view._devicePixelRatio;\r\n    \r\n        node.getWorldMatrix(_matrix);\r\n        let contentSize = node._contentSize;\r\n        _vec3.x = -node._anchorPoint.x * contentSize.width;\r\n        _vec3.y = -node._anchorPoint.y * contentSize.height;\r\n    \r\n        math.mat4.translate(_matrix, _matrix, _vec3);\r\n        \r\n        camera.getWorldToCameraMatrix(_matrix_temp);\r\n        math.mat4.mul(_matrix_temp, _matrix_temp, _matrix);\r\n    \r\n        scaleX /= dpr;\r\n        scaleY /= dpr;\r\n    \r\n        let container = cc.game.container;\r\n        let a = _matrix_temp.m00 * scaleX, b = _matrix.m01, c = _matrix.m04, d = _matrix_temp.m05 * scaleY;\r\n    \r\n        let offsetX = container && container.style.paddingLeft && parseInt(container.style.paddingLeft);\r\n        offsetX += viewport.x / dpr;\r\n        let offsetY = container && container.style.paddingBottom && parseInt(container.style.paddingBottom);\r\n        offsetY += viewport.y / dpr;\r\n        let tx = _matrix_temp.m12 * scaleX + offsetX, ty = _matrix_temp.m13 * scaleY + offsetY;\r\n    \r\n        if (polyfill.zoomInvalid) {\r\n            this._updateSize(this._size.width * a, this._size.height * d);\r\n            a = 1;\r\n            d = 1;\r\n        }\r\n    \r\n        let matrix = \"matrix(\" + a + \",\" + -b + \",\" + -c + \",\" + d + \",\" + tx + \",\" + -ty + \")\";\r\n        this._edTxt.style['transform'] = matrix;\r\n        this._edTxt.style['-webkit-transform'] = matrix;\r\n        this._edTxt.style['transform-origin'] = '0px 100% 0px';\r\n        this._edTxt.style['-webkit-transform-origin'] = '0px 100% 0px';\r\n    },\r\n\r\n    _adjustEditBoxPosition () {\r\n        this._node.getWorldMatrix(_matrix);\r\n        let y = _matrix.m13;\r\n        let windowHeight = cc.visibleRect.height;\r\n        let windowWidth = cc.visibleRect.width;\r\n        let factor = 0.5;\r\n        if (windowWidth > windowHeight) {\r\n            factor = 0.7;\r\n        }\r\n        setTimeout(function() {\r\n            if (window.scrollY < SCROLLY && y < windowHeight * factor) {\r\n                let scrollOffset = windowHeight * factor - y - window.scrollY;\r\n                if (scrollOffset < 35) scrollOffset = 35;\r\n                if (scrollOffset > 320) scrollOffset = 320;\r\n                window.scrollTo(0, scrollOffset);\r\n            }\r\n        }, DELAY_TIME);\r\n    }\r\n});\r\n\r\nlet _p = EditBoxImpl.prototype;\r\n\r\n_p.createInput = function() {\r\n    if (this._inputMode === InputMode.ANY) {\r\n        this._createDomTextArea();\r\n    }\r\n    else {\r\n        this._createDomInput();\r\n    }\r\n};\r\n\r\n// Called before editbox focus to register cc.view status\r\n_p._beginEditingOnMobile = function () {\r\n    let self = this;\r\n    if (!this.__orientationChanged) {\r\n        this.__orientationChanged = function () {\r\n            self._adjustEditBoxPosition();\r\n        };\r\n        window.addEventListener('orientationchange', this.__orientationChanged);\r\n    }\r\n\r\n    if (cc.view.isAutoFullScreenEnabled()) {\r\n        this.__fullscreen = true;\r\n        cc.view.enableAutoFullScreen(false);\r\n        cc.screen.exitFullScreen();\r\n    } else {\r\n        this.__fullscreen = false;\r\n    }\r\n    this.__autoResize = cc.view._resizeWithBrowserSize;\r\n    cc.view.resizeWithBrowserSize(false);\r\n    _currentEditBoxImpl = this;\r\n};\r\n\r\n// Called after keyboard disappeared to readapte the game view\r\n_p._endEditingOnMobile = function () {\r\n    if (this.__rotateScreen) {\r\n        cc.game.container.style['-webkit-transform'] = 'rotate(90deg)';\r\n        cc.game.container.style.transform = 'rotate(90deg)';\r\n\r\n        let view = cc.view;\r\n        let width = view._originalDesignResolutionSize.width;\r\n        let height = view._originalDesignResolutionSize.height;\r\n        if (width > 0) {\r\n            view.setDesignResolutionSize(width, height, view._resolutionPolicy);\r\n        }\r\n        this.__rotateScreen = false;\r\n    }\r\n\r\n    if (this.__orientationChanged) {\r\n        window.removeEventListener('orientationchange', this.__orientationChanged);\r\n        this.__orientationChanged = null;\r\n    }\r\n\r\n    if(this.__fullscreen) {\r\n        cc.view.enableAutoFullScreen(true);\r\n    }\r\n\r\n    // In case focus on editBox A from editBox B\r\n    // A disable resizeWithBrowserSize\r\n    // whilte B enable resizeWithBrowserSize\r\n    // Only _currentEditBoxImpl can enable resizeWithBrowserSize\r\n    if (this.__autoResize && _currentEditBoxImpl === this) {\r\n        cc.view.resizeWithBrowserSize(true);\r\n    }\r\n};\r\n\r\nfunction _inputValueHandle (input, editBoxImpl) {\r\n    if (input.value.length > editBoxImpl._maxLength) {\r\n        input.value = input.value.slice(0, editBoxImpl._maxLength);\r\n    }\r\n    if (editBoxImpl._delegate && editBoxImpl._delegate.editBoxTextChanged) {\r\n        if (editBoxImpl._text !== input.value) {\r\n            editBoxImpl._text = input.value;\r\n            editBoxImpl._delegate.editBoxTextChanged(editBoxImpl._text);\r\n        }\r\n    }\r\n}\r\n\r\nfunction registerInputEventListener (tmpEdTxt, editBoxImpl, isTextarea) {\r\n    let inputLock = false;\r\n    let blurWhenComposition = false;\r\n    let cbs = editBoxImpl.__eventListeners;\r\n    cbs.compositionstart = function () {\r\n        inputLock = true;\r\n    };\r\n    tmpEdTxt.addEventListener('compositionstart', cbs.compositionstart);\r\n\r\n    cbs.compositionend = function () {\r\n        inputLock = false;\r\n        if (blurWhenComposition) {\r\n            // restore input value when composition not complete and blur input\r\n            this.value = editBoxImpl._text;\r\n            blurWhenComposition = false;\r\n        }\r\n        _inputValueHandle(this, editBoxImpl);\r\n    };\r\n    tmpEdTxt.addEventListener('compositionend', cbs.compositionend);\r\n\r\n    cbs.input = function () {\r\n        if (inputLock) {\r\n            return;\r\n        }\r\n        _inputValueHandle(this, editBoxImpl);\r\n    };\r\n    tmpEdTxt.addEventListener('input', cbs.input);\r\n\r\n    cbs.focus = function () {\r\n        this.style.fontSize = editBoxImpl._edFontSize + 'px';\r\n        this.style.color = editBoxImpl._textColor.toCSS('rgba');\r\n        // When stayOnTop, input will swallow touch event\r\n        if (editBoxImpl._alwaysOnTop) {\r\n            editBoxImpl._editing = true;\r\n        }\r\n\r\n        if (cc.sys.isMobile) {\r\n            editBoxImpl._beginEditingOnMobile();\r\n        }\r\n\r\n        if (editBoxImpl._delegate && editBoxImpl._delegate.editBoxEditingDidBegan) {\r\n            editBoxImpl._delegate.editBoxEditingDidBegan();\r\n        }\r\n\r\n    };\r\n    tmpEdTxt.addEventListener('focus', cbs.focus);\r\n\r\n    cbs.keypress = function (e) {\r\n        if (e.keyCode === macro.KEY.enter) {\r\n            e.stopPropagation();\r\n\r\n            if (editBoxImpl._delegate && editBoxImpl._delegate.editBoxEditingReturn) {\r\n                editBoxImpl._delegate.editBoxEditingReturn();\r\n            }\r\n            if (!isTextarea) {\r\n                editBoxImpl._text = this.value;\r\n                editBoxImpl._endEditing();\r\n                cc.game.canvas.focus();\r\n            }\r\n        }\r\n    };\r\n    tmpEdTxt.addEventListener('keypress', cbs.keypress);\r\n\r\n    cbs.blur = function () {\r\n        if (inputLock) {\r\n            blurWhenComposition = true;\r\n        }\r\n        else {\r\n            editBoxImpl._text = this.value;\r\n        }\r\n        editBoxImpl._endEditing();\r\n    };\r\n    tmpEdTxt.addEventListener('blur', cbs.blur);\r\n\r\n    editBoxImpl._addDomToGameContainer();\r\n}\r\n\r\n_p._createDomInput = function () {\r\n    this.removeDom();\r\n\r\n    let tmpEdTxt = this._edTxt = document.createElement('input');\r\n    tmpEdTxt.type = 'text';\r\n    tmpEdTxt.style.fontSize = this._edFontSize + 'px';\r\n    tmpEdTxt.style.color = '#000000';\r\n    tmpEdTxt.style.border = 0;\r\n    tmpEdTxt.style.background = 'transparent';\r\n    tmpEdTxt.style.width = '100%';\r\n    tmpEdTxt.style.height = '100%';\r\n    tmpEdTxt.style.active = 0;\r\n    tmpEdTxt.style.outline = 'medium';\r\n    tmpEdTxt.style.padding = '0';\r\n    tmpEdTxt.style.textTransform = 'uppercase';\r\n    tmpEdTxt.style.display = 'none';\r\n    tmpEdTxt.style.position = \"absolute\";\r\n    tmpEdTxt.style.bottom = \"0px\";\r\n    tmpEdTxt.style.left = LEFT_PADDING + \"px\";\r\n    tmpEdTxt.style['-moz-appearance'] = 'textfield';\r\n    tmpEdTxt.style.className = \"cocosEditBox\";\r\n    tmpEdTxt.style.fontFamily = 'Arial';\r\n\r\n    registerInputEventListener(tmpEdTxt, this);\r\n\r\n    return tmpEdTxt;\r\n};\r\n\r\n_p._createDomTextArea = function () {\r\n    this.removeDom();\r\n\r\n    let tmpEdTxt = this._edTxt = document.createElement('textarea');\r\n    tmpEdTxt.type = 'text';\r\n    tmpEdTxt.style.fontSize = this._edFontSize + 'px';\r\n    tmpEdTxt.style.color = '#000000';\r\n    tmpEdTxt.style.border = 0;\r\n    tmpEdTxt.style.background = 'transparent';\r\n    tmpEdTxt.style.width = '100%';\r\n    tmpEdTxt.style.height = '100%';\r\n    tmpEdTxt.style.active = 0;\r\n    tmpEdTxt.style.outline = 'medium';\r\n    tmpEdTxt.style.padding = '0';\r\n    tmpEdTxt.style.resize = 'none';\r\n    tmpEdTxt.style.textTransform = 'uppercase';\r\n    tmpEdTxt.style.overflow_y = 'scroll';\r\n    tmpEdTxt.style.display = 'none';\r\n    tmpEdTxt.style.position = \"absolute\";\r\n    tmpEdTxt.style.bottom = \"0px\";\r\n    tmpEdTxt.style.left = LEFT_PADDING + \"px\";\r\n    tmpEdTxt.style.className = \"cocosEditBox\";\r\n    tmpEdTxt.style.fontFamily = 'Arial';\r\n\r\n    registerInputEventListener(tmpEdTxt, this, true);\r\n\r\n    return tmpEdTxt;\r\n};\r\n\r\n_p._addDomToGameContainer = function () {\r\n    cc.game.container.appendChild(this._edTxt);\r\n};\r\n\r\n_p.removeDom = function () {\r\n    let edTxt = this._edTxt;\r\n    if (edTxt) {\r\n        // Remove listeners \r\n        let cbs = this.__eventListeners;\r\n        edTxt.removeEventListener('compositionstart', cbs.compositionstart);\r\n        edTxt.removeEventListener('compositionend', cbs.compositionend);\r\n        edTxt.removeEventListener('input', cbs.input);\r\n        edTxt.removeEventListener('focus', cbs.focus);\r\n        edTxt.removeEventListener('keypress', cbs.keypress);\r\n        edTxt.removeEventListener('blur', cbs.blur);\r\n        cbs.compositionstart = null;\r\n        cbs.compositionend = null;\r\n        cbs.input = null;\r\n        cbs.focus = null;\r\n        cbs.keypress = null;\r\n        cbs.blur = null;\r\n\r\n        let hasChild = utils.contains(cc.game.container, edTxt);\r\n        if (hasChild) {\r\n            cc.game.container.removeChild(edTxt);\r\n        }\r\n    }\r\n    this._edTxt = null;\r\n};\r\n\r\nmodule.exports = EditBoxImpl;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n/**\r\n * !#en Enum for keyboard return types\r\n * !#zh \r\n * @readonly\r\n * @enum EditBox.KeyboardReturnType\r\n */\r\nlet KeyboardReturnType = cc.Enum({\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} DEFAULT\r\n     */\r\n    DEFAULT: 0,\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} DONE\r\n     */\r\n    DONE: 1,\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} SEND\r\n     */\r\n    SEND: 2,\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} SEARCH\r\n     */\r\n    SEARCH: 3,\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} GO\r\n     */\r\n    GO: 4,\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} NEXT\r\n     */\r\n    NEXT: 5\r\n});\r\n\r\n/**\r\n * !#en The EditBox's InputMode defines the type of text that the user is allowed to enter.\r\n * !#zh \r\n * @readonly\r\n * @enum EditBox.InputMode\r\n */\r\nlet InputMode = cc.Enum({\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @property {Number} ANY\r\n     */\r\n    ANY: 0,\r\n    /**\r\n     * !#en The user is allowed to enter an e-mail address.\r\n     * !#zh \r\n     * @property {Number} EMAIL_ADDR\r\n     */\r\n    EMAIL_ADDR: 1,\r\n    /**\r\n     * !#en The user is allowed to enter an integer value.\r\n     * !#zh \r\n     * @property {Number} NUMERIC\r\n     */\r\n    NUMERIC: 2,\r\n    /**\r\n     * !#en The user is allowed to enter a phone number.\r\n     * !#zh \r\n     * @property {Number} PHONE_NUMBER\r\n     */\r\n    PHONE_NUMBER: 3,\r\n    /**\r\n     * !#en The user is allowed to enter a URL.\r\n     * !#zh  URL\r\n     * @property {Number} URL\r\n     */\r\n    URL: 4,\r\n    /**\r\n     * !#en\r\n     * The user is allowed to enter a real number value.\r\n     * This extends kEditBoxInputModeNumeric by allowing a decimal point.\r\n     * !#zh\r\n     * \r\n     * @property {Number} DECIMAL\r\n     */\r\n    DECIMAL: 5,\r\n    /**\r\n     * !#en The user is allowed to enter any text, except for line breaks.\r\n     * !#zh \r\n     * @property {Number} SINGLE_LINE\r\n     */\r\n    SINGLE_LINE: 6\r\n});\r\n\r\n/**\r\n * !#en Enum for the EditBox's input flags\r\n * !#zh \r\n * @readonly\r\n * @enum EditBox.InputFlag\r\n */\r\nlet InputFlag = cc.Enum({\r\n    /**\r\n     * !#en\r\n     * Indicates that the text entered is confidential data that should be\r\n     * obscured whenever possible. This implies EDIT_BOX_INPUT_FLAG_SENSITIVE.\r\n     * !#zh\r\n     *  EDIT_BOX_INPUT_FLAG_SENSITIVE\r\n     * @property {Number} PASSWORD\r\n     */\r\n    PASSWORD: 0,\r\n    /**\r\n     * !#en\r\n     * Indicates that the text entered is sensitive data that the\r\n     * implementation must never store into a dictionary or table for use\r\n     * in predictive, auto-completing, or other accelerated input schemes.\r\n     * A credit card number is an example of sensitive data.\r\n     * !#zh\r\n     * \r\n     * \r\n     * @property {Number} SENSITIVE\r\n     */\r\n    SENSITIVE: 1,\r\n    /**\r\n     * !#en\r\n     * This flag is a hint to the implementation that during text editing,\r\n     * the initial letter of each word should be capitalized.\r\n     * !#zh\r\n     *  \r\n     * @property {Number} INITIAL_CAPS_WORD\r\n     */\r\n    INITIAL_CAPS_WORD: 2,\r\n    /**\r\n     * !#en\r\n     * This flag is a hint to the implementation that during text editing,\r\n     * the initial letter of each sentence should be capitalized.\r\n     * !#zh\r\n     * \r\n     * @property {Number} INITIAL_CAPS_SENTENCE\r\n     */\r\n    INITIAL_CAPS_SENTENCE: 3,\r\n    /**\r\n     * !#en Capitalize all characters automatically.\r\n     * !#zh \r\n     * @property {Number} INITIAL_CAPS_ALL_CHARACTERS\r\n     */\r\n    INITIAL_CAPS_ALL_CHARACTERS: 4,\r\n    /**\r\n     * Don't do anything with the input text.\r\n     * @property {Number} DEFAULT\r\n     */\r\n    DEFAULT: 5\r\n});\r\n\r\nmodule.exports = {\r\n    KeyboardReturnType: KeyboardReturnType,\r\n    InputMode: InputMode,\r\n    InputFlag: InputFlag\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./CCComponent');\r\nrequire('./CCComponentEventHandler');\r\nrequire('./missing-script');\r\n\r\nvar components = [\r\n    require('./CCSprite'),\r\n    require('./CCWidget'),\r\n    require('./CCCanvas'),\r\n    require('./CCAudioSource'),\r\n    require('./CCAnimation'),\r\n    require('./CCButton'),\r\n    require('./CCLabel'),\r\n    require('./CCProgressBar'),\r\n    require('./CCMask'),\r\n    require('./CCScrollBar'),\r\n    require('./CCScrollView'),\r\n    require('./CCPageViewIndicator'),\r\n    require('./CCPageView'),\r\n    require('./CCSlider'),\r\n    require('./CCLayout'),\r\n    require('./editbox/CCEditBox'),\r\n    require('./CCLabelOutline'),\r\n    require('./CCRichText'),\r\n    require('./CCToggleContainer'),\r\n    require('./CCToggleGroup'),\r\n    require('./CCToggle'),\r\n    require('./CCBlockInputEvents'),\r\n    require('./CCMotionStreak'),\r\n    require('./WXSubContextView'),\r\n];\r\n\r\nmodule.exports = components;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = cc.js;\r\nvar BUILTIN_CLASSID_RE = require('../utils/misc').BUILTIN_CLASSID_RE;\r\n\r\n/*\r\n * A temp fallback to contain the original serialized data which can not be loaded.\r\n */\r\nvar MissingClass = cc.Class({\r\n    name: 'cc.MissingClass',\r\n    properties: {\r\n        // the serialized data for original object\r\n        _$erialized: {\r\n            default: null,\r\n            visible: false,\r\n            editorOnly: true\r\n        }\r\n    },\r\n});\r\n\r\n/*\r\n * A temp fallback to contain the original component which can not be loaded.\r\n */\r\nvar MissingScript = cc.Class({\r\n    name: 'cc.MissingScript', \r\n    extends: cc.Component,\r\n    editor: {\r\n        inspector: 'packages://inspector/inspectors/comps/missing-script.js',\r\n    },\r\n    properties: {\r\n        //_scriptUuid: {\r\n        //    get: function () {\r\n        //        var id = this._$erialized.__type__;\r\n        //        if (Editor.Utils.UuidUtils.isUuid(id)) {\r\n        //            return Editor.Utils.UuidUtils.decompressUuid(id);\r\n        //        }\r\n        //        return '';\r\n        //    },\r\n        //    set: function (value) {\r\n        //        if ( !sandbox.compiled ) {\r\n        //            cc.error('Scripts not yet compiled, please fix script errors and compile first.');\r\n        //            return;\r\n        //        }\r\n        //        if (value && Editor.Utils.UuidUtils.isUuid(value._uuid)) {\r\n        //            var classId = Editor.Utils.UuidUtils.compressUuid(value);\r\n        //            if (cc.js._getClassById(classId)) {\r\n        //                this._$erialized.__type__ = classId;\r\n        //                Editor.Ipc.sendToWins('reload:window-scripts', sandbox.compiled);\r\n        //            }\r\n        //            else {\r\n        //                cc.error('Can not find a component in the script which uuid is \"%s\".', value);\r\n        //            }\r\n        //        }\r\n        //        else {\r\n        //            cc.error('invalid script');\r\n        //        }\r\n        //    }\r\n        //},\r\n        compiled: {\r\n            default: false,\r\n            serializable: false\r\n        },\r\n        // the serialized data for original script object\r\n        _$erialized: {\r\n            default: null,\r\n            visible: false,\r\n            editorOnly: true\r\n        }\r\n    },\r\n    ctor: CC_EDITOR && function () {\r\n        this.compiled = _Scene.Sandbox.compiled;\r\n    },\r\n    statics: {\r\n        /*\r\n         * @param {string} id\r\n         * @return {function} constructor\r\n         */\r\n        safeFindClass: function (id, data) {\r\n            var cls = js._getClassById(id);\r\n            if (cls) {\r\n                return cls;\r\n            }\r\n            if (id) {\r\n                cc.deserialize.reportMissingClass(id);\r\n                return MissingScript.getMissingWrapper(id, data);\r\n            }\r\n            return null;\r\n        },\r\n        getMissingWrapper: function (id, data) {\r\n            if (data.node && (/^[0-9a-zA-Z+/]{23}$/.test(id) || BUILTIN_CLASSID_RE.test(id))) {\r\n                // is component\r\n                return MissingScript;\r\n            }\r\n            else {\r\n                return MissingClass;\r\n            }\r\n        }\r\n    },\r\n    onLoad: function () {\r\n        cc.warnID(4600, this.node.name);\r\n    }\r\n});\r\n\r\ncc._MissingScript = module.exports = MissingScript;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = cc.js;\r\n\r\nrequire('../event/event');\r\n\r\n/**\r\n * !#en The mouse event\r\n * !#zh \r\n * @class Event.EventMouse\r\n *\r\n * @extends Event\r\n * @param {Number} eventType - The mouse event type, UP, DOWN, MOVE, CANCELED\r\n * @param {Boolean} [bubbles=false] - A boolean indicating whether the event bubbles up through the tree or not\r\n */\r\nvar EventMouse = function (eventType, bubbles) {\r\n    cc.Event.call(this, cc.Event.MOUSE, bubbles);\r\n    this._eventType = eventType;\r\n    this._button = 0;\r\n    this._x = 0;\r\n    this._y = 0;\r\n    this._prevX = 0;\r\n    this._prevY = 0;\r\n    this._scrollX = 0;\r\n    this._scrollY = 0;\r\n};\r\n\r\njs.extend(EventMouse, cc.Event);\r\nvar proto = EventMouse.prototype;\r\n\r\n/**\r\n * !#en Sets scroll data.\r\n * !#zh \r\n * @method setScrollData\r\n * @param {Number} scrollX\r\n * @param {Number} scrollY\r\n */\r\nproto.setScrollData = function (scrollX, scrollY) {\r\n    this._scrollX = scrollX;\r\n    this._scrollY = scrollY;\r\n};\r\n\r\n/**\r\n * !#en Returns the x axis scroll value.\r\n * !#zh X\r\n * @method getScrollX\r\n * @returns {Number}\r\n */\r\nproto.getScrollX = function () {\r\n    return this._scrollX;\r\n};\r\n\r\n/**\r\n * !#en Returns the y axis scroll value.\r\n * !#zh  Y \r\n * @method getScrollY\r\n * @returns {Number}\r\n */\r\nproto.getScrollY = function () {\r\n    return this._scrollY;\r\n};\r\n\r\n/**\r\n * !#en Sets cursor location.\r\n * !#zh \r\n * @method setLocation\r\n * @param {Number} x\r\n * @param {Number} y\r\n */\r\nproto.setLocation = function (x, y) {\r\n    this._x = x;\r\n    this._y = y;\r\n};\r\n\r\n/**\r\n * !#en Returns cursor location.\r\n * !#zh  x  y \r\n * @method getLocation\r\n * @return {Vec2} location\r\n */\r\nproto.getLocation = function () {\r\n    return cc.v2(this._x, this._y);\r\n};\r\n\r\n/**\r\n * !#en Returns the current cursor location in screen coordinates.\r\n * !#zh  x  y \r\n * @method getLocationInView\r\n * @return {Vec2}\r\n */\r\nproto.getLocationInView = function() {\r\n    return cc.v2(this._x, cc.view._designResolutionSize.height - this._y);\r\n};\r\n\r\nproto._setPrevCursor = function (x, y) {\r\n    this._prevX = x;\r\n    this._prevY = y;\r\n};\r\n\r\n/**\r\n * !#en Returns the previous touch location.\r\n * !#zh  x  y \r\n * @method getPreviousLocation\r\n * @return {Vec2}\r\n */\r\nproto.getPreviousLocation = function () {\r\n    return cc.v2(this._prevX, this._prevY);\r\n};\r\n\r\n/**\r\n * !#en Returns the delta distance from the previous location to current location.\r\n * !#zh  x  y \r\n * @method getDelta\r\n * @return {Vec2}\r\n */\r\nproto.getDelta = function () {\r\n    return cc.v2(this._x - this._prevX, this._y - this._prevY);\r\n};\r\n\r\n/**\r\n * !#en Returns the X axis delta distance from the previous location to current location.\r\n * !#zh  X \r\n * @method getDeltaX\r\n * @return {Number}\r\n */\r\nproto.getDeltaX = function () {\r\n    return this._x - this._prevX;\r\n};\r\n\r\n/**\r\n * !#en Returns the Y axis delta distance from the previous location to current location.\r\n * !#zh  Y \r\n * @method getDeltaY\r\n * @return {Number}\r\n */\r\nproto.getDeltaY = function () {\r\n    return this._y - this._prevY;\r\n};\r\n\r\n/**\r\n * !#en Sets mouse button.\r\n * !#zh \r\n * @method setButton\r\n * @param {Number} button\r\n */\r\nproto.setButton = function (button) {\r\n    this._button = button;\r\n};\r\n\r\n/**\r\n * !#en Returns mouse button.\r\n * !#zh \r\n * @method getButton\r\n * @returns {Number}\r\n */\r\nproto.getButton = function () {\r\n    return this._button;\r\n};\r\n\r\n/**\r\n * !#en Returns location X axis data.\r\n * !#zh  X \r\n * @method getLocationX\r\n * @returns {Number}\r\n */\r\nproto.getLocationX = function () {\r\n    return this._x;\r\n};\r\n\r\n/**\r\n * !#en Returns location Y axis data.\r\n * !#zh  Y \r\n * @method getLocationY\r\n * @returns {Number}\r\n */\r\nproto.getLocationY = function () {\r\n    return this._y;\r\n};\r\n\r\n//Inner event types of MouseEvent\r\n/**\r\n * !#en The none event code of mouse event.\r\n * !#zh \r\n * @property NONE\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.NONE = 0;\r\n/**\r\n * !#en The event type code of mouse down event.\r\n * !#zh \r\n * @property DOWN\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.DOWN = 1;\r\n/**\r\n * !#en The event type code of mouse up event.\r\n * !#zh \r\n * @property UP\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.UP = 2;\r\n/**\r\n * !#en The event type code of mouse move event.\r\n * !#zh \r\n * @property MOVE\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.MOVE = 3;\r\n/**\r\n * !#en The event type code of mouse scroll event.\r\n * !#zh \r\n * @property SCROLL\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.SCROLL = 4;\r\n\r\n/**\r\n * !#en The tag of Mouse left button.\r\n * !#zh \r\n * @property BUTTON_LEFT\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.BUTTON_LEFT = 0;\r\n\r\n/**\r\n * !#en The tag of Mouse right button  (The right button number is 2 on browser).\r\n * !#zh \r\n * @property BUTTON_RIGHT\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.BUTTON_RIGHT = 2;\r\n\r\n/**\r\n * !#en The tag of Mouse middle button  (The right button number is 1 on browser).\r\n * !#zh \r\n * @property BUTTON_MIDDLE\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.BUTTON_MIDDLE = 1;\r\n\r\n/**\r\n * !#en The tag of Mouse button 4.\r\n * !#zh  4 \r\n * @property BUTTON_4\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.BUTTON_4 = 3;\r\n\r\n/**\r\n * !#en The tag of Mouse button 5.\r\n * !#zh  5 \r\n * @property BUTTON_5\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.BUTTON_5 = 4;\r\n\r\n/**\r\n * !#en The tag of Mouse button 6.\r\n * !#zh  6 \r\n * @property BUTTON_6\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.BUTTON_6 = 5;\r\n\r\n/**\r\n * !#en The tag of Mouse button 7.\r\n * !#zh  7 \r\n * @property BUTTON_7\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.BUTTON_7 = 6;\r\n\r\n/**\r\n * !#en The tag of Mouse button 8.\r\n * !#zh  8 \r\n * @property BUTTON_8\r\n * @static\r\n * @type {Number}\r\n */\r\nEventMouse.BUTTON_8 = 7;\r\n\r\n/**\r\n * !#en The touch event\r\n * !#zh \r\n * @class Event.EventTouch\r\n * @constructor\r\n * @extends Event\r\n */\r\n/**\r\n * @method constructor\r\n * @param {Array} touchArr - The array of the touches\r\n * @param {Boolean} bubbles - A boolean indicating whether the event bubbles up through the tree or not\r\n */\r\nvar EventTouch = function (touchArr, bubbles) {\r\n    cc.Event.call(this, cc.Event.TOUCH, bubbles);\r\n    this._eventCode = 0;\r\n    this._touches = touchArr || [];\r\n    /**\r\n     * !#en The current touch object\r\n     * !#zh \r\n     * @property touch\r\n     * @type {Touch}\r\n     */\r\n    this.touch = null;\r\n    // Actually duplicated, because of history issue, currentTouch was in the original design, touch was added in creator engine\r\n    // They should point to the same object\r\n    this.currentTouch = null;\r\n};\r\n\r\njs.extend(EventTouch, cc.Event);\r\nproto = EventTouch.prototype;\r\n\r\n/**\r\n * !#en Returns event code.\r\n * !#zh \r\n * @method getEventCode\r\n * @returns {Number}\r\n */\r\nproto.getEventCode = function () {\r\n    return this._eventCode;\r\n};\r\n\r\n/**\r\n * !#en Returns touches of event.\r\n * !#zh \r\n * @method getTouches\r\n * @returns {Array}\r\n */\r\nproto.getTouches = function () {\r\n    return this._touches;\r\n};\r\n\r\nproto._setEventCode = function (eventCode) {\r\n    this._eventCode = eventCode;\r\n};\r\n\r\nproto._setTouches = function (touches) {\r\n    this._touches = touches;\r\n};\r\n\r\n/**\r\n * !#en Sets touch location.\r\n * !#zh \r\n * @method setLocation\r\n * @param {Number} x\r\n * @param {Number} y\r\n */\r\nproto.setLocation = function (x, y) {\r\n    this.touch && this.touch.setTouchInfo(this.touch.getID(), x, y);\r\n};\r\n\r\n/**\r\n * !#en Returns touch location.\r\n * !#zh \r\n * @method getLocation\r\n * @return {Vec2} location\r\n */\r\nproto.getLocation = function () {\r\n    return this.touch ? this.touch.getLocation() : cc.v2();\r\n};\r\n\r\n/**\r\n * !#en Returns the current touch location in screen coordinates.\r\n * !#zh \r\n * @method getLocationInView\r\n * @return {Vec2}\r\n */\r\nproto.getLocationInView = function() {\r\n    return this.touch ? this.touch.getLocationInView() : cc.v2();\r\n};\r\n\r\n/**\r\n * !#en Returns the previous touch location.\r\n * !#zh  x  y \r\n * @method getPreviousLocation\r\n * @return {Vec2}\r\n */\r\nproto.getPreviousLocation = function () {\r\n    return this.touch ? this.touch.getPreviousLocation() : cc.v2();\r\n};\r\n\r\n/**\r\n * !#en Returns the start touch location.\r\n * !#zh  x  y \r\n * @method getStartLocation\r\n * @returns {Vec2}\r\n */\r\nproto.getStartLocation = function() {\r\n    return this.touch ? this.touch.getStartLocation() : cc.v2();\r\n};\r\n\r\n/**\r\n * !#en Returns the id of cc.Touch.\r\n * !#zh  ID\r\n * @method getID\r\n * @return {Number}\r\n */\r\nproto.getID = function () {\r\n    return this.touch ? this.touch.getID() : null;\r\n};\r\n\r\n/**\r\n * !#en Returns the delta distance from the previous location to current location.\r\n * !#zh  x  y \r\n * @method getDelta\r\n * @return {Vec2}\r\n */\r\nproto.getDelta = function () {\r\n    return this.touch ? this.touch.getDelta() : cc.v2();\r\n};\r\n\r\n/**\r\n * !#en Returns the X axis delta distance from the previous location to current location.\r\n * !#zh  x \r\n * @method getDeltaX\r\n * @return {Number}\r\n */\r\nproto.getDeltaX = function () {\r\n    return this.touch ? this.touch.getDelta().x : 0;\r\n};\r\n\r\n/**\r\n * !#en Returns the Y axis delta distance from the previous location to current location.\r\n * !#zh  y \r\n * @method getDeltaY\r\n * @return {Number}\r\n */\r\nproto.getDeltaY = function () {\r\n    return this.touch ? this.touch.getDelta().y : 0;\r\n};\r\n\r\n/**\r\n * !#en Returns location X axis data.\r\n * !#zh  X \r\n * @method getLocationX\r\n * @returns {Number}\r\n */\r\nproto.getLocationX = function () {\r\n    return this.touch ? this.touch.getLocationX() : 0;\r\n};\r\n\r\n/**\r\n * !#en Returns location Y axis data.\r\n * !#zh  Y \r\n * @method getLocationY\r\n * @returns {Number}\r\n */\r\nproto.getLocationY = function () {\r\n    return this.touch ? this.touch.getLocationY() : 0;\r\n};\r\n\r\n/**\r\n * !#en The maximum touch numbers\r\n * !#zh \r\n * @constant\r\n * @type {Number}\r\n */\r\nEventTouch.MAX_TOUCHES = 5;\r\n\r\n/**\r\n * !#en The event type code of touch began event.\r\n * !#zh \r\n * @constant\r\n * @type {Number}\r\n */\r\nEventTouch.BEGAN = 0;\r\n/**\r\n * !#en The event type code of touch moved event.\r\n * !#zh \r\n * @constant\r\n * @type {Number}\r\n */\r\nEventTouch.MOVED = 1;\r\n/**\r\n * !#en The event type code of touch ended event.\r\n * !#zh \r\n * @constant\r\n * @type {Number}\r\n */\r\nEventTouch.ENDED = 2;\r\n/**\r\n * !#en The event type code of touch cancelled event.\r\n * !#zh \r\n * @constant\r\n * @type {Number}\r\n */\r\nEventTouch.CANCELED = 3;\r\n\r\n/**\r\n * !#en The acceleration event\r\n * !#zh \r\n * @class Event.EventAcceleration\r\n * @extends Event\r\n *\r\n * @param {Object} acc - The acceleration\r\n * @param {Boolean} bubbles - A boolean indicating whether the event bubbles up through the tree or not\r\n */\r\nvar EventAcceleration = function (acc, bubbles) {\r\n    cc.Event.call(this, cc.Event.ACCELERATION, bubbles);\r\n    this.acc = acc;\r\n};\r\njs.extend(EventAcceleration, cc.Event);\r\n\r\n/**\r\n * !#en The keyboard event\r\n * !#zh \r\n * @class Event.EventKeyboard\r\n * @extends Event\r\n *\r\n * @param {Number} keyCode - The key code of which triggered this event\r\n * @param {Boolean} isPressed - A boolean indicating whether the key have been pressed\r\n * @param {Boolean} bubbles - A boolean indicating whether the event bubbles up through the tree or not\r\n */\r\nvar EventKeyboard = function (keyCode, isPressed, bubbles) {\r\n    cc.Event.call(this, cc.Event.KEYBOARD, bubbles);\r\n    /**\r\n     * !#en\r\n     * The keyCode read-only property represents a system and implementation dependent numerical code identifying the unmodified value of the pressed key.\r\n     * This is usually the decimal ASCII (RFC 20) or Windows 1252 code corresponding to the key.\r\n     * If the key can't be identified, this value is 0.\r\n     *\r\n     * !#zh\r\n     * keyCode \r\n     *  ASCII (RFC20)  Windows 1252 \r\n     *  0\r\n     *\r\n     * @property keyCode\r\n     * @type {Number}\r\n     */\r\n    this.keyCode = keyCode;\r\n    this.isPressed = isPressed;\r\n};\r\njs.extend(EventKeyboard, cc.Event);\r\n\r\ncc.Event.EventMouse = EventMouse;\r\ncc.Event.EventTouch = EventTouch;\r\ncc.Event.EventAcceleration = EventAcceleration;\r\ncc.Event.EventKeyboard = EventKeyboard;\r\n\r\nmodule.exports = cc.Event;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('../platform/js');\r\n\r\n/**\r\n * !#en\r\n * <p>\r\n *     The base class of event listener.                                                                        <br/>\r\n *     If you need custom listener which with different callback, you need to inherit this class.               <br/>\r\n *     For instance, you could refer to EventListenerAcceleration, EventListenerKeyboard,                       <br/>\r\n *      EventListenerTouchOneByOne, EventListenerCustom.\r\n * </p>\r\n *\r\n * !#zh\r\n * \r\n *  {{#crossLink \"EventListener/create:method\"}}cc.EventListener.create{{/crossLink}}\r\n *\r\n * @class EventListener\r\n */\r\n\r\n/**\r\n * Constructor\r\n * @method constructor\r\n * @param {Number} type\r\n * @param {Number} listenerID\r\n * @param {Number} callback\r\n */\r\ncc.EventListener = function (type, listenerID, callback) {\r\n    this._onEvent = callback;   // Event callback function\r\n    this._type = type || 0;     // Event listener type\r\n    this._listenerID = listenerID || \"\";    // Event listener ID\r\n    this._registered = false;   // Whether the listener has been added to dispatcher.\r\n\r\n    this._fixedPriority = 0;    // The higher the number, the higher the priority, 0 is for scene graph base priority.\r\n    this._node = null;          // scene graph based priority\r\n    this._target = null;\r\n    this._paused = true;        // Whether the listener is paused\r\n    this._isEnabled = true;     // Whether the listener is enabled\r\n};\r\n\r\ncc.EventListener.prototype = {\r\n    constructor: cc.EventListener,\r\n    /*\r\n     * <p>\r\n     *     Sets paused state for the listener\r\n     *     The paused state is only used for scene graph priority listeners.\r\n     *     `EventDispatcher::resumeAllEventListenersForTarget(node)` will set the paused state to `true`,\r\n     *     while `EventDispatcher::pauseAllEventListenersForTarget(node)` will set it to `false`.\r\n     *     @note 1) Fixed priority listeners will never get paused. If a fixed priority doesn't want to receive events,\r\n     *              call `setEnabled(false)` instead.\r\n     *            2) In `Node`'s onEnter and onExit, the `paused state` of the listeners which associated with that node will be automatically updated.\r\n     * </p>\r\n     * @param {Boolean} paused\r\n     * @private\r\n     */\r\n    _setPaused: function (paused) {\r\n        this._paused = paused;\r\n    },\r\n\r\n    /*\r\n     * Checks whether the listener is paused.\r\n     * @returns {Boolean}\r\n     * @private\r\n     */\r\n    _isPaused: function () {\r\n        return this._paused;\r\n    },\r\n\r\n    /*\r\n     * Marks the listener was registered by EventDispatcher.\r\n     * @param {Boolean} registered\r\n     * @private\r\n     */\r\n    _setRegistered: function (registered) {\r\n        this._registered = registered;\r\n    },\r\n\r\n    /*\r\n     * Checks whether the listener was registered by EventDispatcher\r\n     * @returns {Boolean}\r\n     * @private\r\n     */\r\n    _isRegistered: function () {\r\n        return this._registered;\r\n    },\r\n\r\n    /*\r\n     * Gets the type of this listener\r\n     * @note It's different from `EventType`, e.g. TouchEvent has two kinds of event listeners - EventListenerOneByOne, EventListenerAllAtOnce\r\n     * @returns {Number}\r\n     * @private\r\n     */\r\n    _getType: function () {\r\n        return this._type;\r\n    },\r\n\r\n    /*\r\n     *  Gets the listener ID of this listener\r\n     *  When event is being dispatched, listener ID is used as key for searching listeners according to event type.\r\n     * @returns {String}\r\n     * @private\r\n     */\r\n    _getListenerID: function () {\r\n        return this._listenerID;\r\n    },\r\n\r\n    /*\r\n     * Sets the fixed priority for this listener\r\n     *  @note This method is only used for `fixed priority listeners`, it needs to access a non-zero value. 0 is reserved for scene graph priority listeners\r\n     * @param {Number} fixedPriority\r\n     * @private\r\n     */\r\n    _setFixedPriority: function (fixedPriority) {\r\n        this._fixedPriority = fixedPriority;\r\n    },\r\n\r\n    /*\r\n     * Gets the fixed priority of this listener\r\n     * @returns {Number} 0 if it's a scene graph priority listener, non-zero for fixed priority listener\r\n     * @private\r\n     */\r\n    _getFixedPriority: function () {\r\n        return this._fixedPriority;\r\n    },\r\n\r\n    /*\r\n     * Sets scene graph priority for this listener\r\n     * @param {cc.Node} node\r\n     * @private\r\n     */\r\n    _setSceneGraphPriority: function (node) {\r\n        this._target = node;\r\n        this._node = node;\r\n    },\r\n\r\n    /*\r\n     * Gets scene graph priority of this listener\r\n     * @returns {cc.Node} if it's a fixed priority listener, non-null for scene graph priority listener\r\n     * @private\r\n     */\r\n    _getSceneGraphPriority: function () {\r\n        return this._node;\r\n    },\r\n\r\n    /**\r\n     * !#en Checks whether the listener is available.\r\n     * !#zh \r\n     * @method checkAvailable\r\n     * @returns {Boolean}\r\n     */\r\n    checkAvailable: function () {\r\n        return this._onEvent !== null;\r\n    },\r\n\r\n    /**\r\n     * !#en Clones the listener, its subclasses have to override this method.\r\n     * !#zh ,\r\n     * @method clone\r\n     * @returns {EventListener}\r\n     */\r\n    clone: function () {\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     *  !#en Enables or disables the listener\r\n     *  !#zh \r\n     *  @method setEnabled\r\n     *  @param {Boolean} enabled\r\n     *  @note Only listeners with `enabled` state will be able to receive events.\r\n     *          When an listener was initialized, it's enabled by default.\r\n     *          An event listener can receive events when it is enabled and is not paused.\r\n     *          paused state is always false when it is a fixed priority listener.\r\n     */\r\n    setEnabled: function(enabled){\r\n        this._isEnabled = enabled;\r\n    },\r\n\r\n    /**\r\n     * !#en Checks whether the listener is enabled\r\n     * !#zh \r\n     * @method isEnabled\r\n     * @returns {Boolean}\r\n     */\r\n    isEnabled: function(){\r\n        return this._isEnabled;\r\n    },\r\n\r\n    /*\r\n     * <p>Currently JavaScript Bindings (JSB), in some cases, needs to use retain and release. This is a bug in JSB,\r\n     * and the ugly workaround is to use retain/release. So, these 2 methods were added to be compatible with JSB.\r\n     * This is a hack, and should be removed once JSB fixes the retain/release bug<br/>\r\n     * You will need to retain an object if you created a listener and haven't added it any target node during the same frame.<br/>\r\n     * Otherwise, JSB's native autorelease pool will consider this object a useless one and release it directly,<br/>\r\n     * when you want to use it later, a \"Invalid Native Object\" error will be raised.<br/>\r\n     * The retain function can increase a reference count for the native object to avoid it being released,<br/>\r\n     * you need to manually invoke release function when you think this object is no longer needed, otherwise, there will be memory learks.<br/>\r\n     * retain and release function call should be paired in developer's game code.</p>\r\n     *\r\n     * @method retain\r\n     * @see cc.EventListener#release\r\n     */\r\n    retain:function () {\r\n    },\r\n    /*\r\n     * <p>Currently JavaScript Bindings (JSB), in some cases, needs to use retain and release. This is a bug in JSB,\r\n     * and the ugly workaround is to use retain/release. So, these 2 methods were added to be compatible with JSB.\r\n     * This is a hack, and should be removed once JSB fixes the retain/release bug<br/>\r\n     * You will need to retain an object if you created a listener and haven't added it any target node during the same frame.<br/>\r\n     * Otherwise, JSB's native autorelease pool will consider this object a useless one and release it directly,<br/>\r\n     * when you want to use it later, a \"Invalid Native Object\" error will be raised.<br/>\r\n     * The retain function can increase a reference count for the native object to avoid it being released,<br/>\r\n     * you need to manually invoke release function when you think this object is no longer needed, otherwise, there will be memory learks.<br/>\r\n     * retain and release function call should be paired in developer's game code.</p>\r\n     *\r\n     * @method release\r\n     * @see cc.EventListener#retain\r\n     */\r\n    release:function () {\r\n    }\r\n};\r\n\r\n// event listener type\r\n/**\r\n * !#en The type code of unknown event listener.\r\n * !#zh \r\n * @property UNKNOWN\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.EventListener.UNKNOWN = 0;\r\n/*\r\n * !#en The type code of one by one touch event listener.\r\n * !#zh \r\n * @property TOUCH_ONE_BY_ONE\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.EventListener.TOUCH_ONE_BY_ONE = 1;\r\n/*\r\n * !#en The type code of all at once touch event listener.\r\n * !#zh \r\n * @property TOUCH_ALL_AT_ONCE\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.EventListener.TOUCH_ALL_AT_ONCE = 2;\r\n/**\r\n * !#en The type code of keyboard event listener.\r\n * !#zh \r\n * @property KEYBOARD\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.EventListener.KEYBOARD = 3;\r\n/*\r\n * !#en The type code of mouse event listener.\r\n * !#zh \r\n * @property MOUSE\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.EventListener.MOUSE = 4;\r\n/**\r\n * !#en The type code of acceleration event listener.\r\n * !#zh \r\n * @property ACCELERATION\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.EventListener.ACCELERATION = 6;\r\n/*\r\n * !#en The type code of custom event listener.\r\n * !#zh \r\n * @property CUSTOM\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.EventListener.CUSTOM = 8;\r\n\r\nvar ListenerID = cc.EventListener.ListenerID = {\r\n    MOUSE: '__cc_mouse',\r\n    TOUCH_ONE_BY_ONE: '__cc_touch_one_by_one',\r\n    TOUCH_ALL_AT_ONCE: '__cc_touch_all_at_once',\r\n    KEYBOARD: '__cc_keyboard',\r\n    ACCELERATION: '__cc_acceleration',\r\n};\r\n\r\nvar Custom = function (listenerId, callback) {\r\n    this._onCustomEvent = callback;\r\n    cc.EventListener.call(this, cc.EventListener.CUSTOM, listenerId, this._callback);\r\n};\r\njs.extend(Custom, cc.EventListener);\r\njs.mixin(Custom.prototype, {\r\n    _onCustomEvent: null,\r\n    \r\n    _callback: function (event) {\r\n        if (this._onCustomEvent !== null)\r\n            this._onCustomEvent(event);\r\n    },\r\n\r\n    checkAvailable: function () {\r\n        return (cc.EventListener.prototype.checkAvailable.call(this) && this._onCustomEvent !== null);\r\n    },\r\n\r\n    clone: function () {\r\n        return new Custom(this._listenerID, this._onCustomEvent);\r\n    }\r\n});\r\n\r\nvar Mouse = function () {\r\n    cc.EventListener.call(this, cc.EventListener.MOUSE, ListenerID.MOUSE, this._callback);\r\n};\r\njs.extend(Mouse, cc.EventListener);\r\njs.mixin(Mouse.prototype, {\r\n    onMouseDown: null,\r\n    onMouseUp: null,\r\n    onMouseMove: null,\r\n    onMouseScroll: null,\r\n\r\n    _callback: function (event) {\r\n        var eventType = cc.Event.EventMouse;\r\n        switch (event._eventType) {\r\n            case eventType.DOWN:\r\n                if (this.onMouseDown)\r\n                    this.onMouseDown(event);\r\n                break;\r\n            case eventType.UP:\r\n                if (this.onMouseUp)\r\n                    this.onMouseUp(event);\r\n                break;\r\n            case eventType.MOVE:\r\n                if (this.onMouseMove)\r\n                    this.onMouseMove(event);\r\n                break;\r\n            case eventType.SCROLL:\r\n                if (this.onMouseScroll)\r\n                    this.onMouseScroll(event);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n\r\n    clone: function () {\r\n        var eventListener = new Mouse();\r\n        eventListener.onMouseDown = this.onMouseDown;\r\n        eventListener.onMouseUp = this.onMouseUp;\r\n        eventListener.onMouseMove = this.onMouseMove;\r\n        eventListener.onMouseScroll = this.onMouseScroll;\r\n        return eventListener;\r\n    },\r\n\r\n    checkAvailable: function () {\r\n        return true;\r\n    }\r\n});\r\n\r\nvar TouchOneByOne = function () {\r\n    cc.EventListener.call(this, cc.EventListener.TOUCH_ONE_BY_ONE, ListenerID.TOUCH_ONE_BY_ONE, null);\r\n    this._claimedTouches = [];\r\n};\r\njs.extend(TouchOneByOne, cc.EventListener);\r\njs.mixin(TouchOneByOne.prototype, {\r\n    constructor: TouchOneByOne,\r\n    _claimedTouches: null,\r\n    swallowTouches: false,\r\n    onTouchBegan: null,\r\n    onTouchMoved: null,\r\n    onTouchEnded: null,\r\n    onTouchCancelled: null,\r\n\r\n    setSwallowTouches: function (needSwallow) {\r\n        this.swallowTouches = needSwallow;\r\n    },\r\n\r\n    isSwallowTouches: function(){\r\n        return this.swallowTouches;\r\n    },\r\n\r\n    clone: function () {\r\n        var eventListener = new TouchOneByOne();\r\n        eventListener.onTouchBegan = this.onTouchBegan;\r\n        eventListener.onTouchMoved = this.onTouchMoved;\r\n        eventListener.onTouchEnded = this.onTouchEnded;\r\n        eventListener.onTouchCancelled = this.onTouchCancelled;\r\n        eventListener.swallowTouches = this.swallowTouches;\r\n        return eventListener;\r\n    },\r\n\r\n    checkAvailable: function () {\r\n        if(!this.onTouchBegan){\r\n            cc.logID(1801);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n});\r\n\r\nvar TouchAllAtOnce = function () {\r\n    cc.EventListener.call(this, cc.EventListener.TOUCH_ALL_AT_ONCE, ListenerID.TOUCH_ALL_AT_ONCE, null);\r\n};\r\njs.extend(TouchAllAtOnce, cc.EventListener);\r\njs.mixin(TouchAllAtOnce.prototype, {\r\n    constructor: TouchAllAtOnce,\r\n    onTouchesBegan: null,\r\n    onTouchesMoved: null,\r\n    onTouchesEnded: null,\r\n    onTouchesCancelled: null,\r\n\r\n    clone: function(){\r\n        var eventListener = new TouchAllAtOnce();\r\n        eventListener.onTouchesBegan = this.onTouchesBegan;\r\n        eventListener.onTouchesMoved = this.onTouchesMoved;\r\n        eventListener.onTouchesEnded = this.onTouchesEnded;\r\n        eventListener.onTouchesCancelled = this.onTouchesCancelled;\r\n        return eventListener;\r\n    },\r\n\r\n    checkAvailable: function(){\r\n        if (this.onTouchesBegan === null && this.onTouchesMoved === null\r\n            && this.onTouchesEnded === null && this.onTouchesCancelled === null) {\r\n            cc.logID(1802);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n});\r\n\r\n//Acceleration\r\nvar Acceleration = function (callback) {\r\n    this._onAccelerationEvent = callback;\r\n    cc.EventListener.call(this, cc.EventListener.ACCELERATION, ListenerID.ACCELERATION, this._callback);\r\n};\r\njs.extend(Acceleration, cc.EventListener);\r\njs.mixin(Acceleration.prototype, {\r\n    constructor: Acceleration,\r\n    _onAccelerationEvent: null,\r\n\r\n    _callback: function (event) {\r\n        this._onAccelerationEvent(event.acc, event);\r\n    },\r\n\r\n    checkAvailable: function () {\r\n        cc.assertID(this._onAccelerationEvent, 1803);\r\n\r\n        return true;\r\n    },\r\n\r\n    clone: function () {\r\n        return new Acceleration(this._onAccelerationEvent);\r\n    }\r\n});\r\n\r\n\r\n//Keyboard\r\nvar Keyboard = function () {\r\n    cc.EventListener.call(this, cc.EventListener.KEYBOARD, ListenerID.KEYBOARD, this._callback);\r\n};\r\njs.extend(Keyboard, cc.EventListener);\r\njs.mixin(Keyboard.prototype, {\r\n    constructor: Keyboard,\r\n    onKeyPressed: null,\r\n    onKeyReleased: null,\r\n\r\n    _callback: function (event) {\r\n        if (event.isPressed) {\r\n            if (this.onKeyPressed)\r\n                this.onKeyPressed(event.keyCode, event);\r\n        } else {\r\n            if (this.onKeyReleased)\r\n                this.onKeyReleased(event.keyCode, event);\r\n        }\r\n    },\r\n\r\n    clone: function () {\r\n        var eventListener = new Keyboard();\r\n        eventListener.onKeyPressed = this.onKeyPressed;\r\n        eventListener.onKeyReleased = this.onKeyReleased;\r\n        return eventListener;\r\n    },\r\n\r\n    checkAvailable: function () {\r\n        if (this.onKeyPressed === null && this.onKeyReleased === null) {\r\n            cc.logID(1800);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n});\r\n\r\n/**\r\n * !#en\r\n * Create a EventListener object with configuration including the event type, handlers and other parameters.\r\n * In handlers, this refer to the event listener object itself.\r\n * You can also pass custom parameters in the configuration object,\r\n * all custom parameters will be polyfilled into the event listener object and can be accessed in handlers.\r\n * !#zh  Event \r\n * @method create\r\n * @param {Object} argObj a json object\r\n * @returns {EventListener}\r\n * @static\r\n * @example {@link cocos2d/core/event-manager/CCEventListener/create.js}\r\n */\r\ncc.EventListener.create = function (argObj) {\r\n    cc.assertID(argObj&&argObj.event, 1900);\r\n\r\n    var listenerType = argObj.event;\r\n    delete argObj.event;\r\n\r\n    var listener = null;\r\n    if(listenerType === cc.EventListener.TOUCH_ONE_BY_ONE)\r\n        listener = new TouchOneByOne();\r\n    else if(listenerType === cc.EventListener.TOUCH_ALL_AT_ONCE)\r\n        listener = new TouchAllAtOnce();\r\n    else if(listenerType === cc.EventListener.MOUSE)\r\n        listener = new Mouse();\r\n    else if(listenerType === cc.EventListener.CUSTOM){\r\n        listener = new Custom(argObj.eventName, argObj.callback);\r\n        delete argObj.eventName;\r\n        delete argObj.callback;\r\n    } else if(listenerType === cc.EventListener.KEYBOARD)\r\n        listener = new Keyboard();\r\n    else if(listenerType === cc.EventListener.ACCELERATION){\r\n        listener = new Acceleration(argObj.callback);\r\n        delete argObj.callback;\r\n    }\r\n\r\n    for(var key in argObj) {\r\n        listener[key] = argObj[key];\r\n    }\r\n    return listener;\r\n};\r\n\r\nmodule.exports = cc.EventListener;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\nvar js = require('../platform/js');\r\nrequire('./CCEventListener');\r\nvar ListenerID = cc.EventListener.ListenerID;\r\n\r\nvar _EventListenerVector = function () {\r\n    this._fixedListeners = [];\r\n    this._sceneGraphListeners = [];\r\n    this.gt0Index = 0;\r\n};\r\n_EventListenerVector.prototype = {\r\n    constructor: _EventListenerVector,\r\n    size: function () {\r\n        return this._fixedListeners.length + this._sceneGraphListeners.length;\r\n    },\r\n\r\n    empty: function () {\r\n        return (this._fixedListeners.length === 0) && (this._sceneGraphListeners.length === 0);\r\n    },\r\n\r\n    push: function (listener) {\r\n        if (listener._getFixedPriority() === 0)\r\n            this._sceneGraphListeners.push(listener);\r\n        else\r\n            this._fixedListeners.push(listener);\r\n    },\r\n\r\n    clearSceneGraphListeners: function () {\r\n        this._sceneGraphListeners.length = 0;\r\n    },\r\n\r\n    clearFixedListeners: function () {\r\n        this._fixedListeners.length = 0;\r\n    },\r\n\r\n    clear: function () {\r\n        this._sceneGraphListeners.length = 0;\r\n        this._fixedListeners.length = 0;\r\n    },\r\n\r\n    getFixedPriorityListeners: function () {\r\n        return this._fixedListeners;\r\n    },\r\n\r\n    getSceneGraphPriorityListeners: function () {\r\n        return this._sceneGraphListeners;\r\n    }\r\n};\r\n\r\nvar __getListenerID = function (event) {\r\n    var eventType = cc.Event, type = event.type;\r\n    if (type === eventType.ACCELERATION)\r\n        return ListenerID.ACCELERATION;\r\n    if (type === eventType.KEYBOARD)\r\n        return ListenerID.KEYBOARD;\r\n    if (type.startsWith(eventType.MOUSE))\r\n        return ListenerID.MOUSE;\r\n    if (type.startsWith(eventType.TOUCH)){\r\n        // Touch listener is very special, it contains two kinds of listeners, EventListenerTouchOneByOne and EventListenerTouchAllAtOnce.\r\n        // return UNKNOWN instead.\r\n        cc.logID(2000);\r\n    }\r\n    return \"\";\r\n};\r\n\r\n/**\r\n * !#en\r\n * This class has been deprecated, please use cc.systemEvent or cc.EventTarget instead. See [Listen to and launch events](../../../manual/en/scripting/events.md) for details.<br>\r\n * <br>\r\n * cc.eventManager is a singleton object which manages event listener subscriptions and event dispatching.\r\n * The EventListener list is managed in such way so that event listeners can be added and removed\r\n * while events are being dispatched.\r\n *\r\n * !#zh\r\n *  cc.systemEvent  cc.EventTarget  [](../../../manual/zh/scripting/events.md)<br>\r\n * <br>\r\n * \r\n *\r\n * @class eventManager\r\n * @static\r\n * @example {@link cocos2d/core/event-manager/CCEventManager/addListener.js}\r\n * @deprecated\r\n */\r\nvar eventManager = {\r\n    //Priority dirty flag\r\n    DIRTY_NONE: 0,\r\n    DIRTY_FIXED_PRIORITY: 1 << 0,\r\n    DIRTY_SCENE_GRAPH_PRIORITY: 1 << 1,\r\n    DIRTY_ALL: 3,\r\n\r\n    _listenersMap: {},\r\n    _priorityDirtyFlagMap: {},\r\n    _nodeListenersMap: {},\r\n    _nodePriorityMap: js.createMap(true),\r\n    _globalZOrderNodeMap: [],\r\n    _toAddedListeners: [],\r\n    _toRemovedListeners: [],\r\n    _dirtyNodes: [],\r\n    _inDispatch: 0,\r\n    _isEnabled: false,\r\n    _nodePriorityIndex: 0,\r\n\r\n    _internalCustomListenerIDs:[],\r\n\r\n    _setDirtyForNode: function (node) {\r\n        // Mark the node dirty only when there is an event listener associated with it.\r\n        if (this._nodeListenersMap[node._id] !== undefined) {\r\n            this._dirtyNodes.push(node);\r\n        }\r\n        if (node.getChildren) {\r\n            var _children = node.getChildren();\r\n            for(var i = 0, len = _children ? _children.length : 0; i < len; i++)\r\n                this._setDirtyForNode(_children[i]);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Pauses all listeners which are associated the specified target.\r\n     * !#zh  node \r\n     * @method pauseTarget\r\n     * @param {Node} node\r\n     * @param {Boolean} [recursive=false]\r\n     */\r\n    pauseTarget: function (node, recursive) {\r\n        if (!(node instanceof cc._BaseNode)) {\r\n            cc.warnID(3506);\r\n            return;\r\n        }\r\n        var listeners = this._nodeListenersMap[node._id], i, len;\r\n        if (listeners) {\r\n            for (i = 0, len = listeners.length; i < len; i++)\r\n                listeners[i]._setPaused(true);\r\n        }\r\n        if (recursive === true) {\r\n            var locChildren = node.getChildren();\r\n            for (i = 0, len = locChildren ? locChildren.length : 0; i < len; i++)\r\n                this.pauseTarget(locChildren[i], true);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Resumes all listeners which are associated the specified target.\r\n     * !#zh  node \r\n     * @method resumeTarget\r\n     * @param {Node} node\r\n     * @param {Boolean} [recursive=false]\r\n     */\r\n    resumeTarget: function (node, recursive) {\r\n        if (!(node instanceof cc._BaseNode)) {\r\n            cc.warnID(3506);\r\n            return;\r\n        }\r\n        var listeners = this._nodeListenersMap[node._id], i, len;\r\n        if (listeners){\r\n            for ( i = 0, len = listeners.length; i < len; i++)\r\n                listeners[i]._setPaused(false);\r\n        }\r\n        this._setDirtyForNode(node);\r\n        if (recursive === true && node.getChildren) {\r\n            var locChildren = node.getChildren();\r\n            for (i = 0, len = locChildren ? locChildren.length : 0; i < len; i++)\r\n                this.resumeTarget(locChildren[i], true);\r\n        }\r\n    },\r\n\r\n    _addListener: function (listener) {\r\n        if (this._inDispatch === 0)\r\n            this._forceAddEventListener(listener);\r\n        else\r\n            this._toAddedListeners.push(listener);\r\n    },\r\n\r\n    _forceAddEventListener: function (listener) {\r\n        var listenerID = listener._getListenerID();\r\n        var listeners = this._listenersMap[listenerID];\r\n        if (!listeners) {\r\n            listeners = new _EventListenerVector();\r\n            this._listenersMap[listenerID] = listeners;\r\n        }\r\n        listeners.push(listener);\r\n\r\n        if (listener._getFixedPriority() === 0) {\r\n            this._setDirty(listenerID, this.DIRTY_SCENE_GRAPH_PRIORITY);\r\n\r\n            var node = listener._getSceneGraphPriority();\r\n            if (node === null)\r\n                cc.logID(3507);\r\n\r\n            this._associateNodeAndEventListener(node, listener);\r\n            if (node.activeInHierarchy)\r\n                this.resumeTarget(node);\r\n        } else\r\n            this._setDirty(listenerID, this.DIRTY_FIXED_PRIORITY);\r\n    },\r\n\r\n    _getListeners: function (listenerID) {\r\n        return this._listenersMap[listenerID];\r\n    },\r\n\r\n    _updateDirtyFlagForSceneGraph: function () {\r\n        if (this._dirtyNodes.length === 0)\r\n            return;\r\n\r\n        var locDirtyNodes = this._dirtyNodes, selListeners, selListener, locNodeListenersMap = this._nodeListenersMap;\r\n        for (var i = 0, len = locDirtyNodes.length; i < len; i++) {\r\n            selListeners = locNodeListenersMap[locDirtyNodes[i]._id];\r\n            if (selListeners) {\r\n                for (var j = 0, listenersLen = selListeners.length; j < listenersLen; j++) {\r\n                    selListener = selListeners[j];\r\n                    if (selListener)\r\n                        this._setDirty(selListener._getListenerID(), this.DIRTY_SCENE_GRAPH_PRIORITY);\r\n                }\r\n            }\r\n        }\r\n        this._dirtyNodes.length = 0;\r\n    },\r\n\r\n    _removeAllListenersInVector: function (listenerVector) {\r\n        if (!listenerVector)\r\n            return;\r\n        var selListener;\r\n        for (var i = 0; i < listenerVector.length;) {\r\n            selListener = listenerVector[i];\r\n            selListener._setRegistered(false);\r\n            if (selListener._getSceneGraphPriority() != null) {\r\n                this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(), selListener);\r\n                selListener._setSceneGraphPriority(null);   // NULL out the node pointer so we don't have any dangling pointers to destroyed nodes.\r\n            }\r\n\r\n            if (this._inDispatch === 0)\r\n                cc.js.array.remove(listenerVector, selListener);\r\n            else\r\n                ++i;\r\n        }\r\n    },\r\n\r\n    _removeListenersForListenerID: function (listenerID) {\r\n        var listeners = this._listenersMap[listenerID], i;\r\n        if (listeners) {\r\n            var fixedPriorityListeners = listeners.getFixedPriorityListeners();\r\n            var sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\r\n\r\n            this._removeAllListenersInVector(sceneGraphPriorityListeners);\r\n            this._removeAllListenersInVector(fixedPriorityListeners);\r\n\r\n            // Remove the dirty flag according the 'listenerID'.\r\n            // No need to check whether the dispatcher is dispatching event.\r\n            delete this._priorityDirtyFlagMap[listenerID];\r\n\r\n            if (!this._inDispatch) {\r\n                listeners.clear();\r\n                delete this._listenersMap[listenerID];\r\n            }\r\n        }\r\n\r\n        var locToAddedListeners = this._toAddedListeners, listener;\r\n        for (i = 0; i < locToAddedListeners.length;) {\r\n            listener = locToAddedListeners[i];\r\n            if (listener && listener._getListenerID() === listenerID)\r\n                cc.js.array.remove(locToAddedListeners, listener);\r\n            else\r\n                ++i;\r\n        }\r\n    },\r\n\r\n    _sortEventListeners: function (listenerID) {\r\n        var dirtyFlag = this.DIRTY_NONE, locFlagMap = this._priorityDirtyFlagMap;\r\n        if (locFlagMap[listenerID])\r\n            dirtyFlag = locFlagMap[listenerID];\r\n\r\n        if (dirtyFlag !== this.DIRTY_NONE) {\r\n            // Clear the dirty flag first, if `rootNode` is null, then set its dirty flag of scene graph priority\r\n            locFlagMap[listenerID] = this.DIRTY_NONE;\r\n\r\n            if (dirtyFlag & this.DIRTY_FIXED_PRIORITY)\r\n                this._sortListenersOfFixedPriority(listenerID);\r\n\r\n            if (dirtyFlag & this.DIRTY_SCENE_GRAPH_PRIORITY){\r\n                var rootEntity = cc.director.getScene();\r\n                if(rootEntity)\r\n                    this._sortListenersOfSceneGraphPriority(listenerID, rootEntity);\r\n            }\r\n        }\r\n    },\r\n\r\n    _sortListenersOfSceneGraphPriority: function (listenerID, rootNode) {\r\n        var listeners = this._getListeners(listenerID);\r\n        if (!listeners)\r\n            return;\r\n\r\n        var sceneGraphListener = listeners.getSceneGraphPriorityListeners();\r\n        if (!sceneGraphListener || sceneGraphListener.length === 0)\r\n            return;\r\n\r\n        // Reset priority index\r\n        this._nodePriorityIndex = 0;\r\n        this._nodePriorityMap = js.createMap(true);\r\n\r\n        this._visitTarget(rootNode, true);\r\n\r\n        // After sort: priority < 0, > 0\r\n        listeners.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes);\r\n    },\r\n\r\n    _sortEventListenersOfSceneGraphPriorityDes: function (l1, l2) {\r\n        var locNodePriorityMap = eventManager._nodePriorityMap,\r\n            node1 = l1._getSceneGraphPriority(),\r\n            node2 = l2._getSceneGraphPriority();\r\n        if (!l2 || !node2 || !locNodePriorityMap[node2._id])\r\n            return -1;\r\n        else if (!l1 || !node1 || !locNodePriorityMap[node1._id])\r\n            return 1;\r\n        return locNodePriorityMap[node2._id] - locNodePriorityMap[node1._id];\r\n    },\r\n\r\n    _sortListenersOfFixedPriority: function (listenerID) {\r\n        var listeners = this._listenersMap[listenerID];\r\n        if (!listeners)\r\n            return;\r\n\r\n        var fixedListeners = listeners.getFixedPriorityListeners();\r\n        if(!fixedListeners || fixedListeners.length === 0)\r\n            return;\r\n        // After sort: priority < 0, > 0\r\n        fixedListeners.sort(this._sortListenersOfFixedPriorityAsc);\r\n\r\n        // FIXME: Should use binary search\r\n        var index = 0;\r\n        for (var len = fixedListeners.length; index < len;) {\r\n            if (fixedListeners[index]._getFixedPriority() >= 0)\r\n                break;\r\n            ++index;\r\n        }\r\n        listeners.gt0Index = index;\r\n    },\r\n\r\n    _sortListenersOfFixedPriorityAsc: function (l1, l2) {\r\n        return l1._getFixedPriority() - l2._getFixedPriority();\r\n    },\r\n\r\n    _onUpdateListeners: function (listeners) {\r\n        var fixedPriorityListeners = listeners.getFixedPriorityListeners();\r\n        var sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\r\n        var i, selListener, idx, toRemovedListeners = this._toRemovedListeners;\r\n\r\n        if (sceneGraphPriorityListeners) {\r\n            for (i = 0; i < sceneGraphPriorityListeners.length;) {\r\n                selListener = sceneGraphPriorityListeners[i];\r\n                if (!selListener._isRegistered()) {\r\n                    cc.js.array.remove(sceneGraphPriorityListeners, selListener);\r\n                    // if item in toRemove list, remove it from the list\r\n                    idx = toRemovedListeners.indexOf(selListener);\r\n                    if(idx !== -1)\r\n                        toRemovedListeners.splice(idx, 1);\r\n                } else\r\n                    ++i;\r\n            }\r\n        }\r\n\r\n        if (fixedPriorityListeners) {\r\n            for (i = 0; i < fixedPriorityListeners.length;) {\r\n                selListener = fixedPriorityListeners[i];\r\n                if (!selListener._isRegistered()) {\r\n                    cc.js.array.remove(fixedPriorityListeners, selListener);\r\n                    // if item in toRemove list, remove it from the list\r\n                    idx = toRemovedListeners.indexOf(selListener);\r\n                    if(idx !== -1)\r\n                        toRemovedListeners.splice(idx, 1);\r\n                }\r\n                else\r\n                    ++i;\r\n            }\r\n        }\r\n\r\n        if (sceneGraphPriorityListeners && sceneGraphPriorityListeners.length === 0)\r\n            listeners.clearSceneGraphListeners();\r\n\r\n        if (fixedPriorityListeners && fixedPriorityListeners.length === 0)\r\n            listeners.clearFixedListeners();\r\n    },\r\n\r\n    frameUpdateListeners: function () {\r\n        var locListenersMap = this._listenersMap, locPriorityDirtyFlagMap = this._priorityDirtyFlagMap;\r\n        for (var selKey in locListenersMap) {\r\n            if (locListenersMap[selKey].empty()) {\r\n                delete locPriorityDirtyFlagMap[selKey];\r\n                delete locListenersMap[selKey];\r\n            }\r\n        }\r\n\r\n        var locToAddedListeners = this._toAddedListeners;\r\n        if (locToAddedListeners.length !== 0) {\r\n            for (var i = 0, len = locToAddedListeners.length; i < len; i++)\r\n                this._forceAddEventListener(locToAddedListeners[i]);\r\n            locToAddedListeners.length = 0;\r\n        }\r\n        if (this._toRemovedListeners.length !== 0) {\r\n            this._cleanToRemovedListeners();\r\n        }\r\n    },\r\n\r\n    _updateTouchListeners: function (event) {\r\n        var locInDispatch = this._inDispatch;\r\n        cc.assertID(locInDispatch > 0, 3508);\r\n\r\n        if (locInDispatch > 1)\r\n            return;\r\n\r\n        var listeners;\r\n        listeners = this._listenersMap[ListenerID.TOUCH_ONE_BY_ONE];\r\n        if (listeners) {\r\n            this._onUpdateListeners(listeners);\r\n        }\r\n        listeners = this._listenersMap[ListenerID.TOUCH_ALL_AT_ONCE];\r\n        if (listeners) {\r\n            this._onUpdateListeners(listeners);\r\n        }\r\n\r\n        cc.assertID(locInDispatch === 1, 3509);\r\n\r\n        var locToAddedListeners = this._toAddedListeners;\r\n        if (locToAddedListeners.length !== 0) {\r\n            for (var i = 0, len = locToAddedListeners.length; i < len; i++)\r\n                this._forceAddEventListener(locToAddedListeners[i]);\r\n            this._toAddedListeners.length = 0;\r\n        }\r\n\r\n        if (this._toRemovedListeners.length !== 0) {\r\n            this._cleanToRemovedListeners();\r\n        }\r\n    },\r\n\r\n    //Remove all listeners in _toRemoveListeners list and cleanup\r\n    _cleanToRemovedListeners: function () {\r\n        var toRemovedListeners = this._toRemovedListeners;\r\n        for (var i = 0; i < toRemovedListeners.length; i++) {\r\n            var selListener = toRemovedListeners[i];\r\n            var listeners = this._listenersMap[selListener._getListenerID()];\r\n            if (!listeners)\r\n                continue;\r\n\r\n            var idx, fixedPriorityListeners = listeners.getFixedPriorityListeners(),\r\n                sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\r\n\r\n            if (sceneGraphPriorityListeners) {\r\n                idx = sceneGraphPriorityListeners.indexOf(selListener);\r\n                if (idx !== -1) {\r\n                    sceneGraphPriorityListeners.splice(idx, 1);\r\n                }\r\n            }\r\n            if (fixedPriorityListeners) {\r\n                idx = fixedPriorityListeners.indexOf(selListener);\r\n                if (idx !== -1) {\r\n                    fixedPriorityListeners.splice(idx, 1);\r\n                }\r\n            }\r\n        }\r\n        toRemovedListeners.length = 0;\r\n    },\r\n\r\n    _onTouchEventCallback: function (listener, argsObj) {\r\n        // Skip if the listener was removed.\r\n        if (!listener._isRegistered())\r\n            return false;\r\n\r\n        var event = argsObj.event, selTouch = event.currentTouch;\r\n        event.currentTarget = listener._node;\r\n\r\n        var isClaimed = false, removedIdx;\r\n        var getCode = event.getEventCode(), EventTouch = cc.Event.EventTouch;\r\n        if (getCode === EventTouch.BEGAN) {\r\n            if (listener.onTouchBegan) {\r\n                isClaimed = listener.onTouchBegan(selTouch, event);\r\n                if (isClaimed && listener._registered)\r\n                    listener._claimedTouches.push(selTouch);\r\n            }\r\n        } else if (listener._claimedTouches.length > 0\r\n            && ((removedIdx = listener._claimedTouches.indexOf(selTouch)) !== -1)) {\r\n            isClaimed = true;\r\n            if (getCode === EventTouch.MOVED && listener.onTouchMoved) {\r\n                listener.onTouchMoved(selTouch, event);\r\n            } else if (getCode === EventTouch.ENDED) {\r\n                if (listener.onTouchEnded)\r\n                    listener.onTouchEnded(selTouch, event);\r\n                if (listener._registered)\r\n                    listener._claimedTouches.splice(removedIdx, 1);\r\n            } else if (getCode === EventTouch.CANCELLED) {\r\n                if (listener.onTouchCancelled)\r\n                    listener.onTouchCancelled(selTouch, event);\r\n                if (listener._registered)\r\n                    listener._claimedTouches.splice(removedIdx, 1);\r\n            }\r\n        }\r\n\r\n        // If the event was stopped, return directly.\r\n        if (event.isStopped()) {\r\n            eventManager._updateTouchListeners(event);\r\n            return true;\r\n        }\r\n\r\n        if (isClaimed && listener.swallowTouches) {\r\n            if (argsObj.needsMutableSet)\r\n                argsObj.touches.splice(selTouch, 1);\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    _dispatchTouchEvent: function (event) {\r\n        this._sortEventListeners(ListenerID.TOUCH_ONE_BY_ONE);\r\n        this._sortEventListeners(ListenerID.TOUCH_ALL_AT_ONCE);\r\n\r\n        var oneByOneListeners = this._getListeners(ListenerID.TOUCH_ONE_BY_ONE);\r\n        var allAtOnceListeners = this._getListeners(ListenerID.TOUCH_ALL_AT_ONCE);\r\n\r\n        // If there aren't any touch listeners, return directly.\r\n        if (null === oneByOneListeners && null === allAtOnceListeners)\r\n            return;\r\n\r\n        var originalTouches = event.getTouches(), mutableTouches = cc.js.array.copy(originalTouches);\r\n        var oneByOneArgsObj = {event: event, needsMutableSet: (oneByOneListeners && allAtOnceListeners), touches: mutableTouches, selTouch: null};\r\n\r\n        //\r\n        // process the target handlers 1st\r\n        //\r\n        if (oneByOneListeners) {\r\n            for (var i = 0; i < originalTouches.length; i++) {\r\n                event.currentTouch = originalTouches[i];\r\n                event._propagationStopped = event._propagationImmediateStopped = false;\r\n                this._dispatchEventToListeners(oneByOneListeners, this._onTouchEventCallback, oneByOneArgsObj);\r\n            }\r\n        }\r\n\r\n        //\r\n        // process standard handlers 2nd\r\n        //\r\n        if (allAtOnceListeners && mutableTouches.length > 0) {\r\n            this._dispatchEventToListeners(allAtOnceListeners, this._onTouchesEventCallback, {event: event, touches: mutableTouches});\r\n            if (event.isStopped())\r\n                return;\r\n        }\r\n        this._updateTouchListeners(event);\r\n    },\r\n\r\n    _onTouchesEventCallback: function (listener, callbackParams) {\r\n        // Skip if the listener was removed.\r\n        if (!listener._registered)\r\n            return false;\r\n\r\n        var EventTouch = cc.Event.EventTouch, event = callbackParams.event, touches = callbackParams.touches, getCode = event.getEventCode();\r\n        event.currentTarget = listener._node;\r\n        if (getCode === EventTouch.BEGAN && listener.onTouchesBegan)\r\n            listener.onTouchesBegan(touches, event);\r\n        else if (getCode === EventTouch.MOVED && listener.onTouchesMoved)\r\n            listener.onTouchesMoved(touches, event);\r\n        else if (getCode === EventTouch.ENDED && listener.onTouchesEnded)\r\n            listener.onTouchesEnded(touches, event);\r\n        else if (getCode === EventTouch.CANCELLED && listener.onTouchesCancelled)\r\n            listener.onTouchesCancelled(touches, event);\r\n\r\n        // If the event was stopped, return directly.\r\n        if (event.isStopped()) {\r\n            eventManager._updateTouchListeners(event);\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    _associateNodeAndEventListener: function (node, listener) {\r\n        var listeners = this._nodeListenersMap[node._id];\r\n        if (!listeners) {\r\n            listeners = [];\r\n            this._nodeListenersMap[node._id] = listeners;\r\n        }\r\n        listeners.push(listener);\r\n    },\r\n\r\n    _dissociateNodeAndEventListener: function (node, listener) {\r\n        var listeners = this._nodeListenersMap[node._id];\r\n        if (listeners) {\r\n            cc.js.array.remove(listeners, listener);\r\n            if (listeners.length === 0)\r\n                delete this._nodeListenersMap[node._id];\r\n        }\r\n    },\r\n\r\n    _dispatchEventToListeners: function (listeners, onEvent, eventOrArgs) {\r\n        var shouldStopPropagation = false;\r\n        var fixedPriorityListeners = listeners.getFixedPriorityListeners();\r\n        var sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\r\n\r\n        var i = 0, j, selListener;\r\n        if (fixedPriorityListeners) {  // priority < 0\r\n            if (fixedPriorityListeners.length !== 0) {\r\n                for (; i < listeners.gt0Index; ++i) {\r\n                    selListener = fixedPriorityListeners[i];\r\n                    if (selListener.isEnabled() && !selListener._isPaused() && selListener._isRegistered() && onEvent(selListener, eventOrArgs)) {\r\n                        shouldStopPropagation = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (sceneGraphPriorityListeners && !shouldStopPropagation) {    // priority == 0, scene graph priority\r\n            for (j = 0; j < sceneGraphPriorityListeners.length; j++) {\r\n                selListener = sceneGraphPriorityListeners[j];\r\n                if (selListener.isEnabled() && !selListener._isPaused() && selListener._isRegistered() && onEvent(selListener, eventOrArgs)) {\r\n                    shouldStopPropagation = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (fixedPriorityListeners && !shouldStopPropagation) {    // priority > 0\r\n            for (; i < fixedPriorityListeners.length; ++i) {\r\n                selListener = fixedPriorityListeners[i];\r\n                if (selListener.isEnabled() && !selListener._isPaused() && selListener._isRegistered() && onEvent(selListener, eventOrArgs)) {\r\n                    shouldStopPropagation = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    _setDirty: function (listenerID, flag) {\r\n        var locDirtyFlagMap = this._priorityDirtyFlagMap;\r\n        if (locDirtyFlagMap[listenerID] == null)\r\n            locDirtyFlagMap[listenerID] = flag;\r\n        else\r\n            locDirtyFlagMap[listenerID] = flag | locDirtyFlagMap[listenerID];\r\n    },\r\n\r\n    _visitTarget: function (node, isRootNode) {\r\n        // sortAllChildren is performed the next frame, but the event is executed immediately.\r\n        if (node._reorderChildDirty) {\r\n            node.sortAllChildren();\r\n        }\r\n        var children = node.getChildren(), i = 0;\r\n        var childrenCount = children.length, locGlobalZOrderNodeMap = this._globalZOrderNodeMap, locNodeListenersMap = this._nodeListenersMap;\r\n\r\n        if (childrenCount > 0) {\r\n            if (locNodeListenersMap[node._id] !== undefined) {\r\n                if (!locGlobalZOrderNodeMap)\r\n                    locGlobalZOrderNodeMap = [];\r\n                locGlobalZOrderNodeMap.push(node._id);\r\n            }\r\n\r\n            var child;\r\n            for (; i < childrenCount; i++) {\r\n                child = children[i];\r\n                if (child)\r\n                    this._visitTarget(child, false);\r\n            }\r\n        } else {\r\n            if (locNodeListenersMap[node._id] !== undefined) {\r\n                if (!locGlobalZOrderNodeMap)\r\n                    locGlobalZOrderNodeMap = [];\r\n                locGlobalZOrderNodeMap.push(node._id);\r\n            }\r\n        }\r\n\r\n        if (isRootNode) {\r\n            let locNodePriorityMap = this._nodePriorityMap;\r\n            for (let j = 0; j < locGlobalZOrderNodeMap.length; j++)\r\n                locNodePriorityMap[locGlobalZOrderNodeMap[j]] = ++this._nodePriorityIndex;\r\n            this._globalZOrderNodeMap.length = 0;\r\n        }\r\n    },\r\n\r\n    _sortNumberAsc: function (a, b) {\r\n        return a - b;\r\n    },\r\n\r\n    /**\r\n     * !#en Query whether the specified event listener id has been added.\r\n     * !#zh  ID \r\n     * @method hasEventListener\r\n     * @param {String|Number} listenerID - The listener id.\r\n     * @return {Boolean} true or false\r\n     */\r\n    hasEventListener: function (listenerID) {\r\n        return !!this._getListeners(listenerID);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * <p>\r\n     * Adds a event listener for a specified event.<br/>\r\n     * if the parameter \"nodeOrPriority\" is a node,\r\n     * it means to add a event listener for a specified event with the priority of scene graph.<br/>\r\n     * if the parameter \"nodeOrPriority\" is a Number,\r\n     * it means to add a event listener for a specified event with the fixed priority.<br/>\r\n     * </p>\r\n     * !#zh\r\n     * <br/>\r\n     *  nodeOrPriority  node <br/>\r\n     *  nodeOrPriority <br/>\r\n     *\r\n     * @method addListener\r\n     * @param {EventListener|Object} listener - The listener of a specified event or a object of some event parameters.\r\n     * @param {Node|Number} nodeOrPriority - The priority of the listener is based on the draw order of this node or fixedPriority The fixed priority of the listener.\r\n     * @note  The priority of scene graph will be fixed value 0. So the order of listener item in the vector will be ' <0, scene graph (0 priority), >0'.\r\n     *         A lower priority will be called before the ones that have a higher value. 0 priority is forbidden for fixed priority since it's used for scene graph based priority.\r\n     *         The listener must be a cc.EventListener object when adding a fixed priority listener, because we can't remove a fixed priority listener without the listener handler,\r\n     *         except calls removeAllListeners().\r\n     * @return {EventListener} Return the listener. Needed in order to remove the event from the dispatcher.\r\n     */\r\n    addListener: function (listener, nodeOrPriority) {\r\n        cc.assertID(listener && nodeOrPriority, 3503);\r\n        if (!(cc.js.isNumber(nodeOrPriority) || nodeOrPriority instanceof cc._BaseNode)) {\r\n            cc.warnID(3506);\r\n            return;\r\n        }\r\n        if (!(listener instanceof cc.EventListener)) {\r\n            cc.assertID(!cc.js.isNumber(nodeOrPriority), 3504);\r\n            listener = cc.EventListener.create(listener);\r\n        } else {\r\n            if (listener._isRegistered()) {\r\n                cc.logID(3505);\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (!listener.checkAvailable())\r\n            return;\r\n\r\n        if (cc.js.isNumber(nodeOrPriority)) {\r\n            if (nodeOrPriority === 0) {\r\n                cc.logID(3500);\r\n                return;\r\n            }\r\n\r\n            listener._setSceneGraphPriority(null);\r\n            listener._setFixedPriority(nodeOrPriority);\r\n            listener._setRegistered(true);\r\n            listener._setPaused(false);\r\n            this._addListener(listener);\r\n        } else {\r\n            listener._setSceneGraphPriority(nodeOrPriority);\r\n            listener._setFixedPriority(0);\r\n            listener._setRegistered(true);\r\n            this._addListener(listener);\r\n        }\r\n\r\n        return listener;\r\n    },\r\n\r\n    /*\r\n     * !#en Adds a Custom event listener. It will use a fixed priority of 1.\r\n     * !#zh \r\n     * @method addCustomListener\r\n     * @param {String} eventName\r\n     * @param {Function} callback\r\n     * @return {EventListener} the generated event. Needed in order to remove the event from the dispatcher\r\n     */\r\n    addCustomListener: function (eventName, callback) {\r\n        var listener = new cc.EventListener.create({\r\n            event: cc.EventListener.CUSTOM,\r\n            eventName: eventName, \r\n            callback: callback\r\n        });\r\n        this.addListener(listener, 1);\r\n        return listener;\r\n    },\r\n\r\n    /**\r\n     * !#en Remove a listener.\r\n     * !#zh \r\n     * @method removeListener\r\n     * @param {EventListener} listener - an event listener or a registered node target\r\n     * @example {@link cocos2d/core/event-manager/CCEventManager/removeListener.js}\r\n     */\r\n    removeListener: function (listener) {\r\n        if (listener == null)\r\n            return;\r\n\r\n        var isFound, locListener = this._listenersMap;\r\n        for (var selKey in locListener) {\r\n            var listeners = locListener[selKey];\r\n            var fixedPriorityListeners = listeners.getFixedPriorityListeners(), sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\r\n\r\n            isFound = this._removeListenerInVector(sceneGraphPriorityListeners, listener);\r\n            if (isFound){\r\n                // fixed #4160: Dirty flag need to be updated after listeners were removed.\r\n                this._setDirty(listener._getListenerID(), this.DIRTY_SCENE_GRAPH_PRIORITY);\r\n            }else{\r\n                isFound = this._removeListenerInVector(fixedPriorityListeners, listener);\r\n                if (isFound)\r\n                    this._setDirty(listener._getListenerID(), this.DIRTY_FIXED_PRIORITY);\r\n            }\r\n\r\n            if (listeners.empty()) {\r\n                delete this._priorityDirtyFlagMap[listener._getListenerID()];\r\n                delete locListener[selKey];\r\n            }\r\n\r\n            if (isFound)\r\n                break;\r\n        }\r\n\r\n        if (!isFound) {\r\n            var locToAddedListeners = this._toAddedListeners;\r\n            for (var i = 0, len = locToAddedListeners.length; i < len; i++) {\r\n                var selListener = locToAddedListeners[i];\r\n                if (selListener === listener) {\r\n                    cc.js.array.remove(locToAddedListeners, selListener);\r\n                    selListener._setRegistered(false);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    _removeListenerInCallback: function(listeners, callback){\r\n        if (listeners == null)\r\n            return false;\r\n\r\n        for (var i = 0, len = listeners.length; i < len; i++) {\r\n            var selListener = listeners[i];\r\n            if (selListener._onCustomEvent === callback || selListener._onEvent === callback) {\r\n                selListener._setRegistered(false);\r\n                if (selListener._getSceneGraphPriority() != null){\r\n                    this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(), selListener);\r\n                    selListener._setSceneGraphPriority(null);         // NULL out the node pointer so we don't have any dangling pointers to destroyed nodes.\r\n                }\r\n\r\n                if (this._inDispatch === 0)\r\n                    cc.js.array.remove(listeners, selListener);\r\n                else\r\n                    this._toRemovedListeners.push(selListener);\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    _removeListenerInVector: function (listeners, listener) {\r\n        if (listeners == null)\r\n            return false;\r\n\r\n        for (var i = 0, len = listeners.length; i < len; i++) {\r\n            var selListener = listeners[i];\r\n            if (selListener === listener) {\r\n                selListener._setRegistered(false);\r\n                if (selListener._getSceneGraphPriority() != null) {\r\n                    this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(), selListener);\r\n                    selListener._setSceneGraphPriority(null);         // NULL out the node pointer so we don't have any dangling pointers to destroyed nodes.\r\n                }\r\n\r\n                if (this._inDispatch === 0)\r\n                    cc.js.array.remove(listeners, selListener);\r\n                else\r\n                    this._toRemovedListeners.push(selListener);\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    /**\r\n     * !#en Removes all listeners with the same event listener type or removes all listeners of a node.\r\n     * !#zh\r\n     *  eventManager <br/>\r\n     * 1.  Node\r\n     *  recursive  true <br/>\r\n     * 2.  Number EventListener \r\n     * <br/>\r\n     *\r\n     *        <br/>\r\n     * cc.EventListener.UNKNOWN       <br/>\r\n     * cc.EventListener.KEYBOARD      <br/>\r\n     * cc.EventListener.ACCELERATION<br/>\r\n     *\r\n     * @method removeListeners\r\n     * @param {Number|Node} listenerType - listenerType or a node\r\n     * @param {Boolean} [recursive=false]\r\n     */\r\n    removeListeners: function (listenerType, recursive) {\r\n        var i, _t = this;\r\n        if (!(cc.js.isNumber(listenerType) || listenerType instanceof cc._BaseNode)) {\r\n            cc.warnID(3506);\r\n            return;\r\n        }\r\n        if (listenerType._id !== undefined) {\r\n            // Ensure the node is removed from these immediately also.\r\n            // Don't want any dangling pointers or the possibility of dealing with deleted objects..\r\n            delete _t._nodePriorityMap[listenerType._id];\r\n            cc.js.array.remove(_t._dirtyNodes, listenerType);\r\n            var listeners = _t._nodeListenersMap[listenerType._id], i;\r\n            if (listeners) {\r\n                var listenersCopy = cc.js.array.copy(listeners);\r\n                for (i = 0; i < listenersCopy.length; i++)\r\n                    _t.removeListener(listenersCopy[i]);\r\n                delete _t._nodeListenersMap[listenerType._id];\r\n            }\r\n\r\n            // Bug fix: ensure there are no references to the node in the list of listeners to be added.\r\n            // If we find any listeners associated with the destroyed node in this list then remove them.\r\n            // This is to catch the scenario where the node gets destroyed before it's listener\r\n            // is added into the event dispatcher fully. This could happen if a node registers a listener\r\n            // and gets destroyed while we are dispatching an event (touch etc.)\r\n            var locToAddedListeners = _t._toAddedListeners;\r\n            for (i = 0; i < locToAddedListeners.length; ) {\r\n                var listener = locToAddedListeners[i];\r\n                if (listener._getSceneGraphPriority() === listenerType) {\r\n                    listener._setSceneGraphPriority(null);                      // Ensure no dangling ptr to the target node.\r\n                    listener._setRegistered(false);\r\n                    locToAddedListeners.splice(i, 1);\r\n                } else\r\n                    ++i;\r\n            }\r\n\r\n            if (recursive === true) {\r\n                var locChildren = listenerType.getChildren(), len;\r\n                for (i = 0, len = locChildren.length; i< len; i++)\r\n                    _t.removeListeners(locChildren[i], true);\r\n            }\r\n        } else {\r\n            if (listenerType === cc.EventListener.TOUCH_ONE_BY_ONE)\r\n                _t._removeListenersForListenerID(ListenerID.TOUCH_ONE_BY_ONE);\r\n            else if (listenerType === cc.EventListener.TOUCH_ALL_AT_ONCE)\r\n                _t._removeListenersForListenerID(ListenerID.TOUCH_ALL_AT_ONCE);\r\n            else if (listenerType === cc.EventListener.MOUSE)\r\n                _t._removeListenersForListenerID(ListenerID.MOUSE);\r\n            else if (listenerType === cc.EventListener.ACCELERATION)\r\n                _t._removeListenersForListenerID(ListenerID.ACCELERATION);\r\n            else if (listenerType === cc.EventListener.KEYBOARD)\r\n                _t._removeListenersForListenerID(ListenerID.KEYBOARD);\r\n            else\r\n                cc.logID(3501);\r\n        }\r\n    },\r\n\r\n    /*\r\n     * !#en Removes all custom listeners with the same event name.\r\n     * !#zh \r\n     * @method removeCustomListeners\r\n     * @param {String} customEventName\r\n     */\r\n    removeCustomListeners: function (customEventName) {\r\n        this._removeListenersForListenerID(customEventName);\r\n    },\r\n\r\n    /**\r\n     * !#en Removes all listeners\r\n     * !#zh \r\n     * @method removeAllListeners\r\n     */\r\n    removeAllListeners: function () {\r\n        var locListeners = this._listenersMap, locInternalCustomEventIDs = this._internalCustomListenerIDs;\r\n        for (var selKey in locListeners){\r\n            if(locInternalCustomEventIDs.indexOf(selKey) === -1)\r\n                this._removeListenersForListenerID(selKey);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Sets listener's priority with fixed value.\r\n     * !#zh  FixedPriority \r\n     * @method setPriority\r\n     * @param {EventListener} listener\r\n     * @param {Number} fixedPriority\r\n     */\r\n    setPriority: function (listener, fixedPriority) {\r\n        if (listener == null)\r\n            return;\r\n\r\n        var locListeners = this._listenersMap;\r\n        for (var selKey in locListeners) {\r\n            var selListeners = locListeners[selKey];\r\n            var fixedPriorityListeners = selListeners.getFixedPriorityListeners();\r\n            if (fixedPriorityListeners) {\r\n                var found = fixedPriorityListeners.indexOf(listener);\r\n                if (found !== -1) {\r\n                    if(listener._getSceneGraphPriority() != null)\r\n                        cc.logID(3502);\r\n                    if (listener._getFixedPriority() !== fixedPriority) {\r\n                        listener._setFixedPriority(fixedPriority);\r\n                        this._setDirty(listener._getListenerID(), this.DIRTY_FIXED_PRIORITY);\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Whether to enable dispatching events\r\n     * !#zh \r\n     * @method setEnabled\r\n     * @param {Boolean} enabled\r\n     */\r\n    setEnabled: function (enabled) {\r\n        this._isEnabled = enabled;\r\n    },\r\n\r\n    /**\r\n     * !#en Checks whether dispatching events is enabled\r\n     * !#zh \r\n     * @method isEnabled\r\n     * @returns {Boolean}\r\n     */\r\n    isEnabled: function () {\r\n        return this._isEnabled;\r\n    },\r\n\r\n    /*\r\n     * !#en Dispatches the event, also removes all EventListeners marked for deletion from the event dispatcher list.\r\n     * !#zh \r\n     * @method dispatchEvent\r\n     * @param {Event} event\r\n     */\r\n    dispatchEvent: function (event) {\r\n        if (!this._isEnabled)\r\n            return;\r\n\r\n        this._updateDirtyFlagForSceneGraph();\r\n        this._inDispatch++;\r\n        if (!event || !event.getType) {\r\n            cc.errorID(3511);\r\n            return;\r\n        }\r\n        if (event.getType().startsWith(cc.Event.TOUCH)) {\r\n            this._dispatchTouchEvent(event);\r\n            this._inDispatch--;\r\n            return;\r\n        }\r\n\r\n        var listenerID = __getListenerID(event);\r\n        this._sortEventListeners(listenerID);\r\n        var selListeners = this._listenersMap[listenerID];\r\n        if (selListeners != null) {\r\n            this._dispatchEventToListeners(selListeners, this._onListenerCallback, event);\r\n            this._onUpdateListeners(selListeners);\r\n        }\r\n\r\n        this._inDispatch--;\r\n    },\r\n\r\n    _onListenerCallback: function(listener, event){\r\n        event.currentTarget = listener._target;\r\n        listener._onEvent(event);\r\n        return event.isStopped();\r\n    },\r\n\r\n    /*\r\n     * !#en Dispatches a Custom Event with a event name an optional user data\r\n     * !#zh \r\n     * @method dispatchCustomEvent\r\n     * @param {String} eventName\r\n     * @param {*} optionalUserData\r\n     */\r\n    dispatchCustomEvent: function (eventName, optionalUserData) {\r\n        var ev = new cc.Event.EventCustom(eventName);\r\n        ev.setUserData(optionalUserData);\r\n        this.dispatchEvent(ev);\r\n    }\r\n};\r\n\r\n\r\njs.get(cc, 'eventManager', function () {\r\n    cc.warnID(1405, 'cc.eventManager', 'cc.EventTarget or cc.systemEvent');\r\n    return eventManager;\r\n});\r\n\r\nmodule.exports = eventManager;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en The touch event class\r\n * !#zh \r\n * @class Touch\r\n *\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} id\r\n */\r\ncc.Touch = function (x, y, id) {\r\n    this._lastModified = 0;\r\n    this.setTouchInfo(id, x, y);\r\n};\r\ncc.Touch.prototype = {\r\n    constructor: cc.Touch,\r\n    /**\r\n     * !#en Returns the current touch location in OpenGL coordinates.\r\n     * !#zh \r\n     * @method getLocation\r\n     * @return {Vec2}\r\n     */\r\n    getLocation:function () {\r\n        return cc.v2(this._point.x, this._point.y);\r\n    },\r\n\r\n\t/**\r\n\t * !#en Returns X axis location value.\r\n     * !#zh  X \r\n     * @method getLocationX\r\n\t * @returns {Number}\r\n\t */\r\n\tgetLocationX: function () {\r\n\t\treturn this._point.x;\r\n\t},\r\n\r\n\t/**\r\n     * !#en Returns Y axis location value.\r\n     * !#zh  Y \r\n     * @method getLocationY\r\n\t * @returns {Number}\r\n\t */\r\n\tgetLocationY: function () {\r\n\t\treturn this._point.y;\r\n\t},\r\n\r\n    /**\r\n     * !#en Returns the previous touch location in OpenGL coordinates.\r\n     * !#zh  x  y \r\n     * @method getPreviousLocation\r\n     * @return {Vec2}\r\n     */\r\n    getPreviousLocation:function () {\r\n        return cc.v2(this._prevPoint.x, this._prevPoint.y);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the start touch location in OpenGL coordinates.\r\n     * !#zh  x  y \r\n     * @method getStartLocation\r\n     * @returns {Vec2}\r\n     */\r\n    getStartLocation: function() {\r\n        return cc.v2(this._startPoint.x, this._startPoint.y);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the delta distance from the previous touche to the current one in screen coordinates.\r\n     * !#zh  x  y \r\n     * @method getDelta\r\n     * @return {Vec2}\r\n     */\r\n    getDelta:function () {\r\n        return this._point.sub(this._prevPoint);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the current touch location in screen coordinates.\r\n     * !#zh  x  y \r\n     * @method getLocationInView\r\n     * @return {Vec2}\r\n     */\r\n    getLocationInView: function() {\r\n        return cc.v2(this._point.x, cc.view._designResolutionSize.height - this._point.y);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the previous touch location in screen coordinates.\r\n     * !#zh  x  y \r\n     * @method getPreviousLocationInView\r\n     * @return {Vec2}\r\n     */\r\n    getPreviousLocationInView: function(){\r\n        return cc.v2(this._prevPoint.x, cc.view._designResolutionSize.height - this._prevPoint.y);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the start touch location in screen coordinates.\r\n     * !#zh  x  y \r\n     * @method getStartLocationInView\r\n     * @return {Vec2}\r\n     */\r\n    getStartLocationInView: function(){\r\n        return cc.v2(this._startPoint.x, cc.view._designResolutionSize.height - this._startPoint.y);\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the id of cc.Touch.\r\n     * !#zh  ID\r\n     * @method getID\r\n     * @return {Number}\r\n     */\r\n    getID:function () {\r\n        return this._id;\r\n    },\r\n\r\n    /**\r\n     * !#en Sets information to touch.\r\n     * !#zh \r\n     * @method setTouchInfo\r\n     * @param {Number} id\r\n     * @param  {Number} x\r\n     * @param  {Number} y\r\n     */\r\n    setTouchInfo:function (id, x, y) {\r\n        this._prevPoint = this._point;\r\n        this._point = cc.v2(x || 0, y || 0);\r\n        this._id = id;\r\n        if(!this._startPointCaptured){\r\n            this._startPoint = cc.v2(this._point);\r\n            cc.view._convertPointWithScale(this._startPoint);\r\n            this._startPointCaptured = true;\r\n        }\r\n    },\r\n\r\n    _setPoint: function(x, y){\r\n        if(y === undefined){\r\n            this._point.x = x.x;\r\n            this._point.y = x.y;\r\n        }else{\r\n            this._point.x = x;\r\n            this._point.y = y;\r\n        }\r\n    },\r\n\r\n    _setPrevPoint:function (x, y) {\r\n        if(y === undefined)\r\n            this._prevPoint = cc.v2(x.x, x.y);\r\n        else\r\n            this._prevPoint = cc.v2(x || 0, y || 0);\r\n    }\r\n};","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./CCEvent');\r\nrequire('./CCTouch');\r\nrequire('./CCEventListener');\r\n\r\nvar eventManager = require('./CCEventManager');;\r\n\r\nmodule.exports = eventManager;\r\n\r\nif (CC_TEST) {\r\n    cc._Test.eventManager = eventManager;\r\n}\r\n\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = cc.js;\r\nvar CallbacksHandler = require('../platform/callbacks-invoker').CallbacksHandler;\r\n\r\n// Extends CallbacksHandler to handle and invoke event callbacks.\r\nfunction EventListeners () {\r\n    CallbacksHandler.call(this);\r\n}\r\njs.extend(EventListeners, CallbacksHandler);\r\n\r\nEventListeners.prototype.invoke = function (event, captureListeners) {\r\n    var key = event.type;\r\n    var list = this._callbackTable[key];\r\n    if (list) {\r\n        var rootInvoker = !list.isInvoking;\r\n        list.isInvoking = true;\r\n\r\n        var callbacks = list.callbacks;\r\n        var targets = list.targets;\r\n        for (var i = 0, len = callbacks.length; i < len; ++i) {\r\n            var callback = callbacks[i];\r\n            if (callback) {\r\n                var target = targets[i] || event.currentTarget;\r\n                callback.call(target, event, captureListeners);\r\n                if (event._propagationImmediateStopped) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (rootInvoker) {\r\n            list.isInvoking = false;\r\n            if (list.containCanceled) {\r\n                list.purgeCanceled();\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nmodule.exports = EventListeners;\r\nif (CC_TEST) {\r\n    cc._Test.EventListeners = EventListeners;\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../platform/js');\r\nconst CallbacksInvoker = require('../platform/callbacks-invoker');\r\n\r\nvar fastRemove = js.array.fastRemove;\r\n\r\n/**\r\n * !#en\r\n * EventTarget is an object to which an event is dispatched when something has occurred.\r\n * Entity are the most common event targets, but other objects can be event targets too.\r\n *\r\n * Event targets are an important part of the Fireball event model.\r\n * The event target serves as the focal point for how events flow through the scene graph.\r\n * When an event such as a mouse click or a keypress occurs, Fireball dispatches an event object\r\n * into the event flow from the root of the hierarchy. The event object then makes its way through\r\n * the scene graph until it reaches the event target, at which point it begins its return trip through\r\n * the scene graph. This round-trip journey to the event target is conceptually divided into three phases:\r\n * - The capture phase comprises the journey from the root to the last node before the event target's node\r\n * - The target phase comprises only the event target node\r\n * - The bubbling phase comprises any subsequent nodes encountered on the return trip to the root of the tree\r\n * See also: http://www.w3.org/TR/DOM-Level-3-Events/#event-flow\r\n *\r\n * Event targets can implement the following methods:\r\n *  - _getCapturingTargets\r\n *  - _getBubblingTargets\r\n *\r\n * !#zh\r\n * Node \r\n * <br/>\r\n *\r\n * @class EventTarget\r\n */\r\nfunction EventTarget () {\r\n    CallbacksInvoker.call(this);\r\n}\r\njs.extend(EventTarget, CallbacksInvoker);\r\n\r\nvar proto = EventTarget.prototype;\r\n\r\n/**\r\n * !#en Checks whether the EventTarget object has any callback registered for a specific type of event.\r\n * !#zh \r\n * @method hasEventListener\r\n * @param {String} type - The type of event.\r\n * @return {Boolean} True if a callback of the specified type is registered; false otherwise.\r\n */\r\n\r\n/**\r\n * !#en\r\n * Register an callback of a specific event type on the EventTarget.\r\n * This type of event should be triggered via `emit`.\r\n * !#zh\r\n *  `emit` \r\n *\r\n * @method on\r\n * @param {String} type - A string representing the event type to listen for.\r\n * @param {Function} callback - The callback that will be invoked when the event is dispatched.\r\n *                              The callback is ignored if it is a duplicate (the callbacks are unique).\r\n * @param {any} [callback.arg1] arg1\r\n * @param {any} [callback.arg2] arg2\r\n * @param {any} [callback.arg3] arg3\r\n * @param {any} [callback.arg4] arg4\r\n * @param {any} [callback.arg5] arg5\r\n * @param {Object} [target] - The target (this object) to invoke the callback, can be null\r\n * @return {Function} - Just returns the incoming callback so you can save the anonymous function easier.\r\n * @typescript\r\n * on<T extends Function>(type: string, callback: T, target?: any, useCapture?: boolean): T\r\n * @example\r\n * eventTarget.on('fire', function () {\r\n *     cc.log(\"fire in the hole\");\r\n * }, node);\r\n */\r\nproto.on = function (type, callback, target) {\r\n    if (!callback) {\r\n        cc.errorID(6800);\r\n        return;\r\n    }\r\n\r\n    if ( !this.hasEventListener(type, callback, target) ) {\r\n        this.add(type, callback, target);\r\n\r\n        if (target && target.__eventTargets)\r\n            target.__eventTargets.push(this);\r\n    }\r\n    return callback;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Removes the listeners previously registered with the same type, callback, target and or useCapture,\r\n * if only type is passed as parameter, all listeners registered with that type will be removed.\r\n * !#zh\r\n *  useCapture  type type \r\n *\r\n * @method off\r\n * @param {String} type - A string representing the event type being removed.\r\n * @param {Function} [callback] - The callback to remove.\r\n * @param {Object} [target] - The target (this object) to invoke the callback, if it's not given, only callback without target will be removed\r\n * @example\r\n * // register fire eventListener\r\n * var callback = eventTarget.on('fire', function () {\r\n *     cc.log(\"fire in the hole\");\r\n * }, target);\r\n * // remove fire event listener\r\n * eventTarget.off('fire', callback, target);\r\n * // remove all fire event listeners\r\n * eventTarget.off('fire');\r\n */\r\nproto.off = function (type, callback, target) {\r\n    if (!callback) {\r\n        this.removeAll(type);\r\n    }\r\n    else {\r\n        this.remove(type, callback, target);\r\n\r\n        if (target && target.__eventTargets) {\r\n            fastRemove(target.__eventTargets, this);\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Removes all callbacks previously registered with the same target (passed as parameter).\r\n * This is not for removing all listeners in the current event target,\r\n * and this is not for removing all listeners the target parameter have registered.\r\n * It's only for removing all listeners (callback and target couple) registered on the current event target by the target parameter.\r\n * !#zh  EventTarget target \r\n *  EventTarget  target \r\n *  target  EventTarget \r\n * @method targetOff\r\n * @param {Object} target - The target to be searched for all related listeners\r\n */\r\nproto.targetOff = proto.removeAll;\r\n\r\n/**\r\n * !#en\r\n * Register an callback of a specific event type on the EventTarget,\r\n * the callback will remove itself after the first time it is triggered.\r\n * !#zh\r\n * \r\n *\r\n * @method once\r\n * @param {String} type - A string representing the event type to listen for.\r\n * @param {Function} callback - The callback that will be invoked when the event is dispatched.\r\n *                              The callback is ignored if it is a duplicate (the callbacks are unique).\r\n * @param {any} [callback.arg1] arg1\r\n * @param {any} [callback.arg2] arg2\r\n * @param {any} [callback.arg3] arg3\r\n * @param {any} [callback.arg4] arg4\r\n * @param {any} [callback.arg5] arg5\r\n * @param {Object} [target] - The target (this object) to invoke the callback, can be null\r\n * @example\r\n * eventTarget.once('fire', function () {\r\n *     cc.log(\"this is the callback and will be invoked only once\");\r\n * }, node);\r\n */\r\nproto.once = function (type, callback, target) {\r\n    var eventType_hasOnceListener = '__ONCE_FLAG:' + type;\r\n    var hasOnceListener = this.hasEventListener(eventType_hasOnceListener, callback, target);\r\n    if (!hasOnceListener) {\r\n        var self = this;\r\n        var onceWrapper = function (arg1, arg2, arg3, arg4, arg5) {\r\n            self.off(type, onceWrapper, target);\r\n            self.remove(eventType_hasOnceListener, callback, target);\r\n            callback.call(this, arg1, arg2, arg3, arg4, arg5);\r\n        };\r\n        this.on(type, onceWrapper, target);\r\n        this.add(eventType_hasOnceListener, callback, target);\r\n    }\r\n};\r\n\r\n/**\r\n * !#en\r\n * Trigger an event directly with the event name and necessary arguments.\r\n * !#zh\r\n * \r\n *\r\n * @method emit\r\n * @param {String} type - event type\r\n * @param {*} [arg1] - First argument\r\n * @param {*} [arg2] - Second argument\r\n * @param {*} [arg3] - Third argument\r\n * @param {*} [arg4] - Fourth argument\r\n * @param {*} [arg5] - Fifth argument\r\n * @example\r\n * \r\n * eventTarget.emit('fire', event);\r\n * eventTarget.emit('fire', message, emitter);\r\n */\r\nproto.emit = CallbacksInvoker.prototype.invoke;\r\n\r\n/**\r\n * !#en\r\n * Send an event with the event object.\r\n * !#zh\r\n * \r\n *\r\n * @method dispatchEvent\r\n * @param {Event} event\r\n */\r\nproto.dispatchEvent = function (event) {\r\n    this.invoke(event.type, event);\r\n};\r\n\r\ncc.EventTarget = module.exports = EventTarget;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require(\"../platform/js\");\r\n\r\n/**\r\n * !#en Base class of all kinds of events.\r\n * !#zh \r\n * @class Event\r\n */\r\n\r\n/**\r\n * @method constructor\r\n * @param {String} type - The name of the event (case-sensitive), e.g. \"click\", \"fire\", or \"submit\"\r\n * @param {Boolean} bubbles - A boolean indicating whether the event bubbles up through the tree or not\r\n */\r\ncc.Event = function(type, bubbles) {\r\n    /**\r\n     * !#en The name of the event (case-sensitive), e.g. \"click\", \"fire\", or \"submit\".\r\n     * !#zh \r\n     * @property type\r\n     * @type {String}\r\n     */\r\n    this.type = type;\r\n\r\n    /**\r\n     * !#en Indicate whether the event bubbles up through the tree or not.\r\n     * !#zh \r\n     * @property bubbles\r\n     * @type {Boolean}\r\n     */\r\n    this.bubbles = !!bubbles;\r\n\r\n    /**\r\n     * !#en A reference to the target to which the event was originally dispatched.\r\n     * !#zh \r\n     * @property target\r\n     * @type {Object}\r\n     */\r\n    this.target = null;\r\n\r\n    /**\r\n     * !#en A reference to the currently registered target for the event.\r\n     * !#zh \r\n     * @property currentTarget\r\n     * @type {Object}\r\n     */\r\n    this.currentTarget = null;\r\n\r\n    /**\r\n     * !#en\r\n     * Indicates which phase of the event flow is currently being evaluated.\r\n     * Returns an integer value represented by 4 constants:\r\n     *  - Event.NONE = 0\r\n     *  - Event.CAPTURING_PHASE = 1\r\n     *  - Event.AT_TARGET = 2\r\n     *  - Event.BUBBLING_PHASE = 3\r\n     * The phases are explained in the [section 3.1, Event dispatch and DOM event flow]\r\n     * (http://www.w3.org/TR/DOM-Level-3-Events/#event-flow), of the DOM Level 3 Events specification.\r\n     * !#zh \r\n     * @property eventPhase\r\n     * @type {Number}\r\n     */\r\n    this.eventPhase = 0;\r\n\r\n    /*\r\n     * Indicates whether or not event.stopPropagation() has been called on the event.\r\n     * @property _propagationStopped\r\n     * @type {Boolean}\r\n     * @private\r\n     */\r\n    this._propagationStopped = false;\r\n\r\n    /*\r\n     * Indicates whether or not event.stopPropagationImmediate() has been called on the event.\r\n     * @property _propagationImmediateStopped\r\n     * @type {Boolean}\r\n     * @private\r\n     */\r\n    this._propagationImmediateStopped = false;\r\n};\r\ncc.Event.prototype = {\r\n    constructor: cc.Event,\r\n\r\n    /**\r\n     * !#en Reset the event for being stored in the object pool.\r\n     * !#zh \r\n     * @method unuse\r\n     * @returns {String}\r\n     */\r\n    unuse: function () {\r\n        this.type = cc.Event.NO_TYPE;\r\n        this.target = null;\r\n        this.currentTarget = null;\r\n        this.eventPhase = cc.Event.NONE;\r\n        this._propagationStopped = false;\r\n        this._propagationImmediateStopped = false;\r\n    },\r\n\r\n    /**\r\n     * !#en Reuse the event for being used again by the object pool.\r\n     * !#zh \r\n     * @method reuse\r\n     * @returns {String}\r\n     */\r\n    reuse: function (type, bubbles) {\r\n        this.type = type;\r\n        this.bubbles = bubbles || false;\r\n    },\r\n\r\n    /**\r\n     * !#en Stops propagation for current event.\r\n     * !#zh \r\n     * @method stopPropagation\r\n     */\r\n    stopPropagation: function () {\r\n        this._propagationStopped = true;\r\n    },\r\n\r\n    /**\r\n     * !#en Stops propagation for current event immediately,\r\n     * the event won't even be dispatched to the listeners attached in the current target.\r\n     * !#zh \r\n     * @method stopPropagationImmediate\r\n     */\r\n    stopPropagationImmediate: function () {\r\n        this._propagationImmediateStopped = true;\r\n    },\r\n\r\n    /**\r\n     * !#en Checks whether the event has been stopped.\r\n     * !#zh .\r\n     * @method isStopped\r\n     * @returns {Boolean}\r\n     */\r\n    isStopped: function () {\r\n        return this._propagationStopped || this._propagationImmediateStopped;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * <p>\r\n     *     Gets current target of the event                                                            <br/>\r\n     *     note: It only be available when the event listener is associated with node.                <br/>\r\n     *          It returns 0 when the listener is associated with fixed priority.\r\n     * </p>\r\n     * !#zh \r\n     * @method getCurrentTarget\r\n     * @returns {Node}  The target with which the event associates.\r\n     */\r\n    getCurrentTarget: function () {\r\n        return this.currentTarget;\r\n    },\r\n\r\n    /**\r\n     * !#en Gets the event type.\r\n     * !#zh \r\n     * @method getType\r\n     * @returns {String}\r\n     */\r\n    getType: function () {\r\n        return this.type;\r\n    }\r\n};\r\n\r\n//event type\r\n/**\r\n * !#en Code for event without type.\r\n * !#zh \r\n * @property NO_TYPE\r\n * @static\r\n * @type {string}\r\n */\r\ncc.Event.NO_TYPE = 'no_type';\r\n\r\n/**\r\n * !#en The type code of Touch event.\r\n * !#zh \r\n * @property TOUCH\r\n * @static\r\n * @type {String}\r\n */\r\ncc.Event.TOUCH = 'touch';\r\n/**\r\n * !#en The type code of Mouse event.\r\n * !#zh \r\n * @property MOUSE\r\n * @static\r\n * @type {String}\r\n */\r\ncc.Event.MOUSE = 'mouse';\r\n/**\r\n * !#en The type code of Keyboard event.\r\n * !#zh \r\n * @property KEYBOARD\r\n * @static\r\n * @type {String}\r\n */\r\ncc.Event.KEYBOARD = 'keyboard';\r\n/**\r\n * !#en The type code of Acceleration event.\r\n * !#zh \r\n * @property ACCELERATION\r\n * @static\r\n * @type {String}\r\n */\r\ncc.Event.ACCELERATION = 'acceleration';\r\n\r\n//event phase\r\n/**\r\n * !#en Events not currently dispatched are in this phase\r\n * !#zh \r\n * @property NONE\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.Event.NONE = 0;\r\n/**\r\n * !#en\r\n * The capturing phase comprises the journey from the root to the last node before the event target's node\r\n * see http://www.w3.org/TR/DOM-Level-3-Events/#event-flow\r\n * !#zh \r\n * @property CAPTURING_PHASE\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.Event.CAPTURING_PHASE = 1;\r\n/**\r\n * !#en\r\n * The target phase comprises only the event target node\r\n * see http://www.w3.org/TR/DOM-Level-3-Events/#event-flow\r\n * !#zh \r\n * @property AT_TARGET\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.Event.AT_TARGET = 2;\r\n/**\r\n * !#en\r\n * The bubbling phase comprises any subsequent nodes encountered on the return trip to the root of the hierarchy\r\n * see http://www.w3.org/TR/DOM-Level-3-Events/#event-flow\r\n * !#zh  \r\n * @property BUBBLING_PHASE\r\n * @type {Number}\r\n * @static\r\n */\r\ncc.Event.BUBBLING_PHASE = 3;\r\n\r\n/**\r\n * !#en The Custom event\r\n * !#zh \r\n * @class Event.EventCustom\r\n *\r\n * @extends Event\r\n */\r\n\r\n/**\r\n * @method constructor\r\n * @param {String} type - The name of the event (case-sensitive), e.g. \"click\", \"fire\", or \"submit\"\r\n * @param {Boolean} bubbles - A boolean indicating whether the event bubbles up through the tree or not\r\n */\r\nvar EventCustom = function (type, bubbles) {\r\n    cc.Event.call(this, type, bubbles);\r\n\r\n    /**\r\n     * !#en A reference to the detailed data of the event\r\n     * !#zh \r\n     * @property detail\r\n     * @type {Object}\r\n     */\r\n    this.detail = null;\r\n};\r\n\r\njs.extend(EventCustom, cc.Event);\r\n\r\nEventCustom.prototype.reset = EventCustom;\r\n\r\n/**\r\n * !#en Sets user data\r\n * !#zh \r\n * @method setUserData\r\n * @param {*} data\r\n */\r\nEventCustom.prototype.setUserData = function (data) {\r\n    this.detail = data;\r\n};\r\n\r\n/**\r\n * !#en Gets user data\r\n * !#zh \r\n * @method getUserData\r\n * @returns {*}\r\n */\r\nEventCustom.prototype.getUserData = function () {\r\n    return this.detail;\r\n};\r\n\r\n/**\r\n * !#en Gets event name\r\n * !#zh \r\n * @method getEventName\r\n * @returns {String}\r\n */\r\nEventCustom.prototype.getEventName = cc.Event.prototype.getType;\r\n\r\nvar MAX_POOL_SIZE = 10;\r\nvar _eventPool = new js.Pool(MAX_POOL_SIZE);\r\nEventCustom.put = function (event) {\r\n    _eventPool.put(event);\r\n};\r\nEventCustom.get = function (type, bubbles) {\r\n    var event = _eventPool._get();\r\n    if (event) {\r\n        event.reset(type, bubbles);\r\n    }\r\n    else {\r\n        event = new EventCustom(type, bubbles);\r\n    }\r\n    return event;\r\n};\r\n\r\ncc.Event.EventCustom = EventCustom;\r\n\r\nmodule.exports = cc.Event;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n \r\nrequire('./event');\r\nrequire('./event-listeners');\r\nrequire('./event-target');\r\nrequire('./system-event');\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar EventTarget = require('../event/event-target');\r\nvar eventManager = require('../event-manager');\r\nvar inputManger = require('../platform/CCInputManager');;\r\n\r\n/**\r\n * !#en The event type supported by SystemEvent\r\n * !#zh SystemEvent \r\n * @class SystemEvent.EventType\r\n * @static\r\n * @namespace SystemEvent\r\n */\r\nvar EventType = cc.Enum({\r\n    /**\r\n     * !#en The event type for press the key down event, you can use its value directly: 'keydown'\r\n     * !#zh \r\n     * @property KEY_DOWN\r\n     * @type {String}\r\n     * @static\r\n     */\r\n    KEY_DOWN: 'keydown',\r\n    /**\r\n     * !#en The event type for press the key up event, you can use its value directly: 'keyup'\r\n     * !#zh \r\n     * @property KEY_UP\r\n     * @type {String}\r\n     * @static\r\n     */\r\n    KEY_UP: 'keyup',\r\n    /**\r\n     * !#en The event type for press the devicemotion event, you can use its value directly: 'devicemotion'\r\n     * !#zh \r\n     * @property DEVICEMOTION\r\n     * @type {String}\r\n     * @static\r\n     */\r\n    DEVICEMOTION: 'devicemotion'\r\n\r\n});\r\n\r\n/**\r\n * !#en\r\n * The System event, it currently supports keyboard events and accelerometer events.<br>\r\n * You can get the SystemEvent instance with cc.systemEvent.<br>\r\n * example:\r\n * ```\r\n * cc.systemEvent.on(cc.SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\r\n * cc.systemEvent.off(cc.SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\r\n * ```\r\n * !#zh\r\n * <br>\r\n *  cc.systemEvent  SystemEvent <br>\r\n * \r\n * ```\r\n * cc.systemEvent.on(cc.SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\r\n * cc.systemEvent.off(cc.SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\r\n * ```\r\n * @class SystemEvent\r\n * @extends EventTarget\r\n */\r\n\r\nvar keyboardListener = null;\r\nvar accelerationListener = null;\r\nvar SystemEvent = cc.Class({\r\n    name: 'SystemEvent',\r\n    extends: EventTarget,\r\n\r\n    statics: {\r\n        EventType: EventType\r\n    },\r\n\r\n    /**\r\n     * !#en whether enable accelerometer event\r\n     * !#zh \r\n     * @method setAccelerometerEnabled\r\n     * @param {Boolean} isEnable\r\n     */\r\n    setAccelerometerEnabled: function (isEnable) {\r\n        inputManger.setAccelerometerEnabled(isEnable);\r\n    },\r\n\r\n    /**\r\n     * !#en set accelerometer interval value\r\n     * !#zh \r\n     * @method setAccelerometerInterval\r\n     * @param {Number} interval\r\n     */\r\n    setAccelerometerInterval: function(interval) {\r\n        inputManger.setAccelerometerInterval(interval);\r\n    },\r\n\r\n    on: function (type, callback, target) {\r\n        this._super(type, callback, target);\r\n\r\n        // Keyboard\r\n        if (type === EventType.KEY_DOWN || type === EventType.KEY_UP) {\r\n            if (!keyboardListener) {\r\n                keyboardListener = cc.EventListener.create({\r\n                    event: cc.EventListener.KEYBOARD,\r\n                    onKeyPressed: function (keyCode, event) {\r\n                        event.type = EventType.KEY_DOWN;\r\n                        cc.systemEvent.dispatchEvent(event);\r\n                    },\r\n                    onKeyReleased: function (keyCode, event) {\r\n                        event.type = EventType.KEY_UP;\r\n                        cc.systemEvent.dispatchEvent(event);\r\n                    }\r\n                });\r\n            }\r\n            if (!eventManager.hasEventListener(cc.EventListener.ListenerID.KEYBOARD)) {\r\n                eventManager.addListener(keyboardListener, 1);\r\n            }\r\n        }\r\n\r\n        // Acceleration\r\n        if (type === EventType.DEVICEMOTION) {\r\n            if (!accelerationListener) {\r\n                accelerationListener = cc.EventListener.create({\r\n                    event: cc.EventListener.ACCELERATION,\r\n                    callback: function (acc, event) {\r\n                        event.type = EventType.DEVICEMOTION;\r\n                        cc.systemEvent.dispatchEvent(event);\r\n                    }\r\n                });\r\n            }\r\n            if (!eventManager.hasEventListener(cc.EventListener.ListenerID.ACCELERATION)) {\r\n                eventManager.addListener(accelerationListener, 1);\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    off: function (type, callback, target) {\r\n        this._super(type, callback, target);\r\n\r\n        // Keyboard\r\n        if (keyboardListener && (type === EventType.KEY_DOWN || type === EventType.KEY_UP)) {\r\n            var hasKeyDownEventListener = this.hasEventListener(EventType.KEY_DOWN);\r\n            var hasKeyUpEventListener = this.hasEventListener(EventType.KEY_UP);\r\n            if (!hasKeyDownEventListener && !hasKeyUpEventListener) {\r\n                eventManager.removeListener(keyboardListener);\r\n            }\r\n        }\r\n\r\n        // Acceleration\r\n        if (accelerationListener && type === EventType.DEVICEMOTION) {\r\n            eventManager.removeListener(accelerationListener);\r\n        }\r\n    }\r\n\r\n});\r\n\r\ncc.SystemEvent = module.exports = SystemEvent;\r\nif (!CC_EDITOR) {\r\n/** \r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en The System event singleton for global usage\r\n * !#zh \r\n * @property systemEvent\r\n * @type {SystemEvent}\r\n */    \r\n    cc.systemEvent = new cc.SystemEvent();\r\n}","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n'use strict';\r\n\r\nrequire('./graphics');\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./platform');\r\nrequire('./assets');\r\n\r\nif (!CC_EDITOR || !Editor.isMainProcess) {\r\n    require('./CCNode');\r\n    require('./CCPrivateNode');\r\n    require('./CCScene');\r\n\r\n    require('./components');\r\n    require('./graphics');\r\n    require('./collider');\r\n    // CCIntersection can be used separately.\r\n    require('./collider/CCIntersection');\r\n    require('./physics');\r\n    require('./camera/CCCamera');\r\n}\r\n\r\nrequire('./mesh');\r\nrequire('./3d');\r\nrequire('./3d/polyfill-3d');\r\n\r\nrequire('./base-ui/CCWidgetManager');\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('../platform/js');\r\nvar Pipeline = require('./pipeline');\r\nvar LoadingItems = require('./loading-items');\r\nvar AssetLoader = require('./asset-loader');\r\nvar Downloader = require('./downloader');\r\nvar Loader = require('./loader');\r\nvar AssetTable = require('./asset-table');\r\nvar callInNextTick = require('../platform/utils').callInNextTick;\r\nvar AutoReleaseUtils = require('./auto-release-utils');\r\n// var pushToMap = require('../utils/misc').pushToMap;\r\nvar ReleasedAssetChecker = CC_DEBUG && require('./released-asset-checker');\r\n\r\nvar resources = new AssetTable();\r\n\r\nfunction getXMLHttpRequest () {\r\n    return window.XMLHttpRequest ? new window.XMLHttpRequest() : new ActiveXObject('MSXML2.XMLHTTP');\r\n}\r\n\r\nvar _info = {url: null, raw: false};\r\n\r\n// Convert a resources by finding its real url with uuid, otherwise we will use the uuid or raw url as its url\r\n// So we gurantee there will be url in result\r\nfunction getResWithUrl (res) {\r\n    var id, result, isUuid;\r\n    if (typeof res === 'object') {\r\n        result = res;\r\n        if (res.url) {\r\n            return result;\r\n        }\r\n        else {\r\n            id = res.uuid;\r\n        }\r\n    }\r\n    else {\r\n        result = {};\r\n        id = res;\r\n    }\r\n    isUuid = result.type ? result.type === 'uuid' : cc.AssetLibrary._uuidInSettings(id);\r\n    cc.AssetLibrary._getAssetInfoInRuntime(id, _info);\r\n    result.url = !isUuid ? id : _info.url;\r\n    if (_info.url && result.type === 'uuid' && _info.raw) {\r\n        result.type = null;\r\n        result.isRawAsset = true;\r\n    }\r\n    else if (!isUuid) {\r\n        result.isRawAsset = true;\r\n    }\r\n    return result;\r\n}\r\n\r\nvar _sharedResources = [];\r\nvar _sharedList = [];\r\n\r\n/**\r\n * Loader for resource loading process. It's a singleton object.\r\n * @class loader\r\n * @extends Pipeline\r\n * @static\r\n */\r\nfunction CCLoader () {\r\n    var assetLoader = new AssetLoader();\r\n    var downloader = new Downloader();\r\n    var loader = new Loader();\r\n\r\n    Pipeline.call(this, [\r\n        assetLoader,\r\n        downloader,\r\n        loader\r\n    ]);\r\n\r\n    /**\r\n     * The asset loader in cc.loader's pipeline, it's by default the first pipe.\r\n     * It's used to identify an asset's type, and determine how to download it.\r\n     * @property assetLoader\r\n     * @type {Object}\r\n     */\r\n    this.assetLoader = assetLoader;\r\n\r\n    /**\r\n     * The md5 pipe in cc.loader's pipeline, it could be absent if the project isn't build with md5 option.\r\n     * It's used to modify the url to the real downloadable url with md5 suffix.\r\n     * @property md5Pipe\r\n     * @type {Object}\r\n     */\r\n    this.md5Pipe = null;\r\n\r\n    /**\r\n     * The downloader in cc.loader's pipeline, it's by default the second pipe.\r\n     * It's used to download files with several handlers: pure text, image, script, audio, font, uuid.\r\n     * You can add your own download function with addDownloadHandlers\r\n     * @property downloader\r\n     * @type {Object}\r\n     */\r\n    this.downloader = downloader;\r\n\r\n    /**\r\n     * The loader in cc.loader's pipeline, it's by default the third pipe.\r\n     * It's used to parse downloaded content with several handlers: JSON, image, plist, fnt, uuid.\r\n     * You can add your own download function with addLoadHandlers\r\n     * @property loader\r\n     * @type {Object}\r\n     */\r\n    this.loader = loader;\r\n\r\n    this.onProgress = null;\r\n\r\n    // assets to release automatically\r\n    this._autoReleaseSetting = js.createMap(true);\r\n\r\n    if (CC_DEBUG) {\r\n        this._releasedAssetChecker_DEBUG = new ReleasedAssetChecker();\r\n    }\r\n}\r\njs.extend(CCLoader, Pipeline);\r\nvar proto = CCLoader.prototype;\r\n\r\nproto.init = function (director) {\r\n    if (CC_DEBUG) {\r\n        var self = this;\r\n        director.on(cc.Director.EVENT_AFTER_UPDATE, function () {\r\n            self._releasedAssetChecker_DEBUG.checkCouldRelease(self._cache);\r\n        });\r\n    }\r\n};\r\n\r\n/**\r\n * Gets a new XMLHttpRequest instance.\r\n * @method getXMLHttpRequest\r\n * @returns {XMLHttpRequest}\r\n */\r\nproto.getXMLHttpRequest = getXMLHttpRequest;\r\n\r\n/**\r\n * Add custom supported types handler or modify existing type handler for download process.\r\n * @example\r\n *  cc.loader.addDownloadHandlers({\r\n *      // This will match all url with `.scene` extension or all url with `scene` type\r\n *      'scene' : function (url, callback) {}\r\n *  });\r\n * @method addDownloadHandlers\r\n * @param {Object} extMap Custom supported types with corresponded handler\r\n */\r\nproto.addDownloadHandlers = function (extMap) {\r\n    this.downloader.addHandlers(extMap);\r\n};\r\n\r\n/**\r\n * Add custom supported types handler or modify existing type handler for load process.\r\n * @example\r\n *  cc.loader.addLoadHandlers({\r\n *      // This will match all url with `.scene` extension or all url with `scene` type\r\n *      'scene' : function (url, callback) {}\r\n *  });\r\n * @method addLoadHandlers\r\n * @param {Object} extMap Custom supported types with corresponded handler\r\n */\r\nproto.addLoadHandlers = function (extMap) {\r\n    this.loader.addHandlers(extMap);\r\n};\r\n\r\n/**\r\n * Load resources with a progression callback and a complete callback.\r\n * The progression callback is the same as Pipeline's {{#crossLink \"LoadingItems/onProgress:method\"}}onProgress{{/crossLink}}\r\n * The complete callback is almost the same as Pipeline's {{#crossLink \"LoadingItems/onComplete:method\"}}onComplete{{/crossLink}}\r\n * The only difference is when user pass a single url as resources, the complete callback will set its result directly as the second parameter.\r\n *\r\n * @example\r\n * cc.loader.load('a.png', function (err, tex) {\r\n *     cc.log('Result should be a texture: ' + (tex instanceof cc.Texture2D));\r\n * });\r\n *\r\n * cc.loader.load('http://example.com/a.png', function (err, tex) {\r\n *     cc.log('Should load a texture from external url: ' + (tex instanceof cc.Texture2D));\r\n * });\r\n *\r\n * cc.loader.load({url: 'http://example.com/getImageREST?file=a.png', type: 'png'}, function (err, tex) {\r\n *     cc.log('Should load a texture from RESTful API by specify the type: ' + (tex instanceof cc.Texture2D));\r\n * });\r\n *\r\n * cc.loader.load(['a.png', 'b.json'], function (errors, results) {\r\n *     if (errors) {\r\n *         for (var i = 0; i < errors.length; i++) {\r\n *             cc.log('Error url [' + errors[i] + ']: ' + results.getError(errors[i]));\r\n *         }\r\n *     }\r\n *     var aTex = results.getContent('a.png');\r\n *     var bJsonObj = results.getContent('b.json');\r\n * });\r\n *\r\n * @method load\r\n * @param {String|String[]|Object} resources - Url list in an array\r\n * @param {Function} [progressCallback] - Callback invoked when progression change\r\n * @param {Number} progressCallback.completedCount - The number of the items that are already completed\r\n * @param {Number} progressCallback.totalCount - The total number of the items\r\n * @param {Object} progressCallback.item - The latest item which flow out the pipeline\r\n * @param {Function} [completeCallback] - Callback invoked when all resources loaded\r\n * @typescript\r\n * load(resources: string|string[]|{uuid?: string, url?: string, type?: string}, completeCallback?: Function): void\r\n * load(resources: string|string[]|{uuid?: string, url?: string, type?: string}, progressCallback: (completedCount: number, totalCount: number, item: any) => void, completeCallback: Function|null): void\r\n */\r\nproto.load = function(resources, progressCallback, completeCallback) {\r\n    if (CC_DEV && !resources) {\r\n        return cc.error(\"[cc.loader.load] resources must be non-nil.\");\r\n    }\r\n\r\n    if (completeCallback === undefined) {\r\n        completeCallback = progressCallback;\r\n        progressCallback = this.onProgress || null;\r\n    }\r\n\r\n    var self = this;\r\n    var singleRes = false;\r\n    var res;\r\n    if (!(resources instanceof Array)) {\r\n        if (resources) {\r\n            singleRes = true;\r\n            resources = [resources];\r\n        } else { \r\n            resources = [];\r\n        }\r\n    }\r\n\r\n    _sharedResources.length = 0;\r\n    for (var i = 0; i < resources.length; ++i) {\r\n        var resource = resources[i];\r\n        // Backward compatibility\r\n        if (resource && resource.id) {\r\n            cc.warnID(4920, resource.id);\r\n            if (!resource.uuid && !resource.url) {\r\n                resource.url = resource.id;\r\n            }\r\n        }\r\n        res = getResWithUrl(resource);\r\n        if (!res.url && !res.uuid)\r\n            continue;\r\n        var item = this._cache[res.url];\r\n        _sharedResources.push(item || res);\r\n    }\r\n\r\n    var queue = LoadingItems.create(this, progressCallback, function (errors, items) {\r\n        callInNextTick(function () {\r\n            if (completeCallback) {\r\n                if (singleRes) {\r\n                    let id = res.url;\r\n                    completeCallback.call(self, items.getError(id), items.getContent(id));\r\n                }\r\n                else {\r\n                    completeCallback.call(self, errors, items);\r\n                }\r\n                completeCallback = null;\r\n            }\r\n\r\n            if (CC_EDITOR) {\r\n                for (let id in self._cache) {\r\n                    if (self._cache[id].complete) {\r\n                        self.removeItem(id);\r\n                    }\r\n                }\r\n            }\r\n            items.destroy();\r\n        });\r\n    });\r\n    LoadingItems.initQueueDeps(queue);\r\n    queue.append(_sharedResources);\r\n    _sharedResources.length = 0;\r\n};\r\n\r\nproto.flowInDeps = function (owner, urlList, callback) {\r\n    _sharedList.length = 0;\r\n    for (var i = 0; i < urlList.length; ++i) {\r\n        var res = getResWithUrl(urlList[i]);\r\n        if (!res.url && ! res.uuid)\r\n            continue;\r\n        var item = this._cache[res.url];\r\n        if (item) {\r\n            _sharedList.push(item);\r\n        }\r\n        else {\r\n            _sharedList.push(res);\r\n        }\r\n    }\r\n\r\n    var queue = LoadingItems.create(this, owner ? function (completedCount, totalCount, item) {\r\n        if (this._ownerQueue && this._ownerQueue.onProgress) {\r\n            this._ownerQueue._childOnProgress(item);\r\n        }\r\n    } : null, function (errors, items) {\r\n        callback(errors, items);\r\n        // Clear deps because it's already done\r\n        // Each item will only flowInDeps once, so it's still safe here\r\n        owner && owner.deps && (owner.deps.length = 0);\r\n        items.destroy();\r\n    });\r\n    if (owner) {\r\n        var ownerQueue = LoadingItems.getQueue(owner);\r\n        // Set the root ownerQueue, if no ownerQueue defined in ownerQueue, it's the root\r\n        queue._ownerQueue = ownerQueue._ownerQueue || ownerQueue;\r\n    }\r\n    var accepted = queue.append(_sharedList, owner);\r\n    _sharedList.length = 0;\r\n    return accepted;\r\n};\r\n\r\nproto._resources = resources;\r\nproto._getResUuid = function (url, type, quiet) {\r\n    if (!url) {\r\n        return null;\r\n    }\r\n    // Ignore parameter\r\n    var index = url.indexOf('?');\r\n    if (index !== -1)\r\n        url = url.substr(0, index);\r\n    var uuid = resources.getUuid(url, type);\r\n    if ( !uuid ) {\r\n        var extname = cc.path.extname(url);\r\n        if (extname) {\r\n            // strip extname\r\n            url = url.slice(0, - extname.length);\r\n            uuid = resources.getUuid(url, type);\r\n            if (uuid && !quiet) {\r\n                cc.warnID(4901, url, extname);\r\n            }\r\n        }\r\n    }\r\n    return uuid;\r\n};\r\n// Find the asset's reference id in loader, asset could be asset object, asset uuid or asset url\r\nproto._getReferenceKey = function (assetOrUrlOrUuid) {\r\n    var key;\r\n    if (typeof assetOrUrlOrUuid === 'object') {\r\n        key = assetOrUrlOrUuid._uuid || null;\r\n    }\r\n    else if (typeof assetOrUrlOrUuid === 'string') {\r\n        key = this._getResUuid(assetOrUrlOrUuid, null, true) || assetOrUrlOrUuid;\r\n    }\r\n    if (!key) {\r\n        cc.warnID(4800, assetOrUrlOrUuid);\r\n        return key;\r\n    }\r\n    cc.AssetLibrary._getAssetInfoInRuntime(key, _info);\r\n    return this._cache[_info.url] ? _info.url : key;\r\n};\r\n\r\nproto._urlNotFound = function (url, type, completeCallback) {\r\n    callInNextTick(function () {\r\n        url = cc.url.normalize(url);\r\n        var info = `${type ? js.getClassName(type) : 'Asset'} in \"resources/${url}\" does not exist.`;\r\n        if (completeCallback) {\r\n            completeCallback(new Error(info), []);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * @param {Function} [type]\r\n * @param {Function} [onProgress]\r\n * @param {Function} onComplete\r\n * @returns {Object} arguments\r\n * @returns {Function} arguments.type\r\n * @returns {Function} arguments.onProgress\r\n * @returns {Function} arguments.onComplete\r\n */\r\nproto._parseLoadResArgs = function (type, onProgress, onComplete) {\r\n    if (onComplete === undefined) {\r\n        var isValidType = (type instanceof Array) || js.isChildClassOf(type, cc.RawAsset);\r\n        if (onProgress) {\r\n            onComplete = onProgress;\r\n            if (isValidType) {\r\n                onProgress = this.onProgress || null;\r\n            }\r\n        }\r\n        else if (onProgress === undefined && !isValidType) {\r\n            onComplete = type;\r\n            onProgress = this.onProgress || null;\r\n            type = null;\r\n        }\r\n        if (onProgress !== undefined && !isValidType) {\r\n            onProgress = type;\r\n            type = null;\r\n        }\r\n    }\r\n    return {\r\n        type: type,\r\n        onProgress: onProgress,\r\n        onComplete: onComplete,\r\n    };\r\n};\r\n\r\n/**\r\n * Load resources from the \"resources\" folder inside the \"assets\" folder of your project.<br>\r\n * <br>\r\n * Note: All asset URLs in Creator use forward slashes, URLs using backslashes will not work.\r\n *\r\n * @method loadRes\r\n * @param {String} url - Url of the target resource.\r\n *                       The url is relative to the \"resources\" folder, extensions must be omitted.\r\n * @param {Function} [type] - Only asset of type will be loaded if this argument is supplied.\r\n * @param {Function} [progressCallback] - Callback invoked when progression change.\r\n * @param {Number} progressCallback.completedCount - The number of the items that are already completed.\r\n * @param {Number} progressCallback.totalCount - The total number of the items.\r\n * @param {Object} progressCallback.item - The latest item which flow out the pipeline.\r\n * @param {Function} [completeCallback] - Callback invoked when the resource loaded.\r\n * @param {Error} completeCallback.error - The error info or null if loaded successfully.\r\n * @param {Object} completeCallback.resource - The loaded resource if it can be found otherwise returns null.\r\n *\r\n * @example\r\n *\r\n * // load the prefab (project/assets/resources/misc/character/cocos) from resources folder\r\n * cc.loader.loadRes('misc/character/cocos', function (err, prefab) {\r\n *     if (err) {\r\n *         cc.error(err.message || err);\r\n *         return;\r\n *     }\r\n *     cc.log('Result should be a prefab: ' + (prefab instanceof cc.Prefab));\r\n * });\r\n *\r\n * // load the sprite frame of (project/assets/resources/imgs/cocos.png) from resources folder\r\n * cc.loader.loadRes('imgs/cocos', cc.SpriteFrame, function (err, spriteFrame) {\r\n *     if (err) {\r\n *         cc.error(err.message || err);\r\n *         return;\r\n *     }\r\n *     cc.log('Result should be a sprite frame: ' + (spriteFrame instanceof cc.SpriteFrame));\r\n * });\r\n * @typescript\r\n * loadRes(url: string, type: typeof cc.Asset, progressCallback: (completedCount: number, totalCount: number, item: any) => void, completeCallback: ((error: Error, resource: any) => void)|null): void\r\n * loadRes(url: string, type: typeof cc.Asset, completeCallback: (error: Error, resource: any) => void): void\r\n * loadRes(url: string, type: typeof cc.Asset): void\r\n * loadRes(url: string, progressCallback: (completedCount: number, totalCount: number, item: any) => void, completeCallback: ((error: Error, resource: any) => void)|null): void\r\n * loadRes(url: string, completeCallback: (error: Error, resource: any) => void): void\r\n * loadRes(url: string): void\r\n */\r\nproto.loadRes = function (url, type, progressCallback, completeCallback) {\r\n    var args = this._parseLoadResArgs(type, progressCallback, completeCallback);\r\n    type = args.type;\r\n    progressCallback = args.onProgress;\r\n    completeCallback = args.onComplete;\r\n    var self = this;\r\n    var uuid = self._getResUuid(url, type);\r\n    if (uuid) {\r\n        this.load(\r\n            {\r\n                type: 'uuid',\r\n                uuid: uuid\r\n            },\r\n            progressCallback,\r\n            function (err, asset) {\r\n                if (asset) {\r\n                    // should not release these assets, even if they are static referenced in the scene.\r\n                    self.setAutoReleaseRecursively(uuid, false);\r\n                }\r\n                if (completeCallback) {\r\n                    completeCallback(err, asset);\r\n                }\r\n            }\r\n        );\r\n    }\r\n    else {\r\n        self._urlNotFound(url, type, completeCallback);\r\n    }\r\n};\r\n\r\nproto._loadResUuids = function (uuids, progressCallback, completeCallback, urls) {\r\n    if (uuids.length > 0) {\r\n        var self = this;\r\n        var res = uuids.map(function (uuid) {\r\n            return {\r\n                type: 'uuid',\r\n                uuid: uuid\r\n            }\r\n        });\r\n        this.load(res, progressCallback, function (errors, items) {\r\n            if (completeCallback) {\r\n                var assetRes = [];\r\n                var urlRes = urls && [];\r\n                for (var i = 0; i < res.length; ++i) {\r\n                    var uuid = res[i].uuid;\r\n                    var id = this._getReferenceKey(uuid);\r\n                    var item = items.getContent(id);\r\n                    if (item) {\r\n                        // should not release these assets, even if they are static referenced in the scene.\r\n                        self.setAutoReleaseRecursively(uuid, false);\r\n                        assetRes.push(item);\r\n                        if (urlRes) {\r\n                            urlRes.push(urls[i]);\r\n                        }\r\n                    }\r\n                }\r\n                if (urls) {\r\n                    completeCallback(errors, assetRes, urlRes);\r\n                }\r\n                else {\r\n                    completeCallback(errors, assetRes);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        if (completeCallback) {\r\n            callInNextTick(function () {\r\n                if (urls) {\r\n                    completeCallback(null, [], []);\r\n                }\r\n                else {\r\n                    completeCallback(null, []);\r\n                }\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * This method is like {{#crossLink \"loader/loadRes:method\"}}{{/crossLink}} except that it accepts array of url.\r\n *\r\n * @method loadResArray\r\n * @param {String[]} urls - Array of URLs of the target resource.\r\n *                          The url is relative to the \"resources\" folder, extensions must be omitted.\r\n * @param {Function} [type] - Only asset of type will be loaded if this argument is supplied.\r\n * @param {Function} [progressCallback] - Callback invoked when progression change.\r\n * @param {Number} progressCallback.completedCount - The number of the items that are already completed.\r\n * @param {Number} progressCallback.totalCount - The total number of the items.\r\n * @param {Object} progressCallback.item - The latest item which flow out the pipeline.\r\n * @param {Function} [completeCallback] - A callback which is called when all assets have been loaded, or an error occurs.\r\n * @param {Error} completeCallback.error - If one of the asset failed, the complete callback is immediately called\r\n *                                         with the error. If all assets are loaded successfully, error will be null.\r\n * @param {Asset[]|Array} completeCallback.assets - An array of all loaded assets.\r\n *                                                     If nothing to load, assets will be an empty array.\r\n * @example\r\n *\r\n * // load the SpriteFrames from resources folder\r\n * var spriteFrames;\r\n * var urls = ['misc/characters/character_01', 'misc/weapons/weapons_01'];\r\n * cc.loader.loadResArray(urls, cc.SpriteFrame, function (err, assets) {\r\n *     if (err) {\r\n *         cc.error(err);\r\n *         return;\r\n *     }\r\n *     spriteFrames = assets;\r\n *     // ...\r\n * });\r\n * @typescript\r\n * loadResArray(url: string[], type: typeof cc.Asset, progressCallback: (completedCount: number, totalCount: number, item: any) => void, completeCallback: ((error: Error, resource: any[]) => void)|null): void\r\n * loadResArray(url: string[], type: typeof cc.Asset, completeCallback: (error: Error, resource: any[]) => void): void\r\n * loadResArray(url: string[], type: typeof cc.Asset): void\r\n * loadResArray(url: string[], progressCallback: (completedCount: number, totalCount: number, item: any) => void, completeCallback: ((error: Error, resource: any[]) => void)|null): void\r\n * loadResArray(url: string[], completeCallback: (error: Error, resource: any[]) => void): void\r\n * loadResArray(url: string[]): void\r\n * loadResArray(url: string[], type: typeof cc.Asset[]): void\r\n */\r\nproto.loadResArray = function (urls, type, progressCallback, completeCallback) {\r\n    var args = this._parseLoadResArgs(type, progressCallback, completeCallback);\r\n    type = args.type;\r\n    progressCallback = args.onProgress;\r\n    completeCallback = args.onComplete;\r\n\r\n    var uuids = [];\r\n    var isTypesArray = type instanceof Array;\r\n    for (var i = 0; i < urls.length; i++) {\r\n        var url = urls[i];\r\n        var assetType = isTypesArray ? type[i] : type;\r\n        var uuid = this._getResUuid(url, assetType);\r\n        if (uuid) {\r\n            uuids.push(uuid);\r\n        }\r\n        else {\r\n            this._urlNotFound(url, assetType, completeCallback);\r\n            return;\r\n        }\r\n    }\r\n    this._loadResUuids(uuids, progressCallback, completeCallback);\r\n};\r\n\r\n/**\r\n * Load all assets in a folder inside the \"assets/resources\" folder of your project.<br>\r\n * <br>\r\n * Note: All asset URLs in Creator use forward slashes, URLs using backslashes will not work.\r\n *\r\n * @method loadResDir\r\n * @param {String} url - Url of the target folder.\r\n *                       The url is relative to the \"resources\" folder, extensions must be omitted.\r\n * @param {Function} [type] - Only asset of type will be loaded if this argument is supplied.\r\n * @param {Function} [progressCallback] - Callback invoked when progression change.\r\n * @param {Number} progressCallback.completedCount - The number of the items that are already completed.\r\n * @param {Number} progressCallback.totalCount - The total number of the items.\r\n * @param {Object} progressCallback.item - The latest item which flow out the pipeline.\r\n * @param {Function} [completeCallback] - A callback which is called when all assets have been loaded, or an error occurs.\r\n * @param {Error} completeCallback.error - If one of the asset failed, the complete callback is immediately called\r\n *                                         with the error. If all assets are loaded successfully, error will be null.\r\n * @param {Asset[]|Array} completeCallback.assets - An array of all loaded assets.\r\n *                                             If nothing to load, assets will be an empty array.\r\n * @param {String[]} completeCallback.urls - An array that lists all the URLs of loaded assets.\r\n *\r\n * @example\r\n *\r\n * // load the texture (resources/imgs/cocos.png) and the corresponding sprite frame\r\n * cc.loader.loadResDir('imgs/cocos', function (err, assets) {\r\n *     if (err) {\r\n *         cc.error(err);\r\n *         return;\r\n *     }\r\n *     var texture = assets[0];\r\n *     var spriteFrame = assets[1];\r\n * });\r\n *\r\n * // load all textures in \"resources/imgs/\"\r\n * cc.loader.loadResDir('imgs', cc.Texture2D, function (err, textures) {\r\n *     var texture1 = textures[0];\r\n *     var texture2 = textures[1];\r\n * });\r\n *\r\n * // load all JSONs in \"resources/data/\"\r\n * cc.loader.loadResDir('data', function (err, objects, urls) {\r\n *     var data = objects[0];\r\n *     var url = urls[0];\r\n * });\r\n * @typescript\r\n * loadResDir(url: string, type: typeof cc.Asset, progressCallback: (completedCount: number, totalCount: number, item: any) => void, completeCallback: ((error: Error, resource: any[], urls: string[]) => void)|null): void\r\n * loadResDir(url: string, type: typeof cc.Asset, completeCallback: (error: Error, resource: any[], urls: string[]) => void): void\r\n * loadResDir(url: string, type: typeof cc.Asset): void\r\n * loadResDir(url: string, progressCallback: (completedCount: number, totalCount: number, item: any) => void, completeCallback: ((error: Error, resource: any[], urls: string[]) => void)|null): void\r\n * loadResDir(url: string, completeCallback: (error: Error, resource: any[], urls: string[]) => void): void\r\n * loadResDir(url: string): void\r\n */\r\nproto.loadResDir = function (url, type, progressCallback, completeCallback) {\r\n    var args = this._parseLoadResArgs(type, progressCallback, completeCallback);\r\n    type = args.type;\r\n    progressCallback = args.onProgress;\r\n    completeCallback = args.onComplete;\r\n\r\n    var urls = [];\r\n    var uuids = resources.getUuidArray(url, type, urls);\r\n    this._loadResUuids(uuids, progressCallback, function (errors, assetRes, urlRes) {\r\n        // The spriteFrame url in spriteAtlas will be removed after build project\r\n        // To show users the exact structure in asset panel, we need to return the spriteFrame assets in spriteAtlas\r\n        let assetResLength = assetRes.length;\r\n        for (let i = 0; i < assetResLength; ++i) {\r\n            if (assetRes[i] instanceof cc.SpriteAtlas) {\r\n                let spriteFrames = assetRes[i].getSpriteFrames();\r\n                for (let k in spriteFrames) {\r\n                    let sf = spriteFrames[k];\r\n                    assetRes.push(sf);\r\n                    if (urlRes) {\r\n                        urlRes.push(`${urlRes[i]}/${sf.name}`);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        completeCallback && completeCallback(errors, assetRes, urlRes);\r\n    }, urls);\r\n};\r\n\r\n/**\r\n * Get resource data by id. <br>\r\n * When you load resources with {{#crossLink \"loader/load:method\"}}{{/crossLink}} or {{#crossLink \"loader/loadRes:method\"}}{{/crossLink}},\r\n * the url will be the unique identity of the resource.\r\n * After loaded, you can acquire them by passing the url to this API.\r\n *\r\n * @method getRes\r\n * @param {String} url\r\n * @param {Function} [type] - Only asset of type will be returned if this argument is supplied.\r\n * @returns {*}\r\n */\r\nproto.getRes = function (url, type) {\r\n    var item = this._cache[url];\r\n    if (!item) {\r\n        var uuid = this._getResUuid(url, type, true);\r\n        if (uuid) {\r\n            var ref = this._getReferenceKey(uuid);\r\n            item = this._cache[ref];\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n    if (item && item.alias) {\r\n        item = item.alias;\r\n    }\r\n    return (item && item.complete) ? item.content : null;\r\n};\r\n\r\n/**\r\n * Get total resources count in loader.\r\n * @returns {Number}\r\n */\r\nproto.getResCount = function () {\r\n    return Object.keys(this._cache).length;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Get all resource dependencies of the loaded asset in an array, including itself.\r\n * The owner parameter accept the following types: 1. The asset itself; 2. The resource url; 3. The asset's uuid.<br>\r\n * The returned array stores the dependencies with their uuids, after retrieve dependencies,\r\n * you can release them, access dependent assets by passing the uuid to {{#crossLink \"loader/getRes:method\"}}{{/crossLink}}, or other stuffs you want.<br>\r\n * For release all dependencies of an asset, please refer to {{#crossLink \"loader/release:method\"}}{{/crossLink}}\r\n * Here is some examples:\r\n * !#zh\r\n * owner 1.  asset 2.  url3.  uuid<br>\r\n *  uuid uuid  loader  {{#crossLink \"loader/getRes:method\"}}{{/crossLink}} <br>\r\n *  {{#crossLink \"loader/release:method\"}}{{/crossLink}}\r\n *\r\n * @example\r\n * // Release all dependencies of a loaded prefab\r\n * var deps = cc.loader.getDependsRecursively(prefab);\r\n * cc.loader.release(deps);\r\n * // Retrieve all dependent textures\r\n * var deps = cc.loader.getDependsRecursively('prefabs/sample');\r\n * var textures = [];\r\n * for (var i = 0; i < deps.length; ++i) {\r\n *     var item = cc.loader.getRes(deps[i]);\r\n *     if (item instanceof cc.Texture2D) {\r\n *         textures.push(item);\r\n *     }\r\n * }\r\n *\r\n * @method getDependsRecursively\r\n * @param {Asset|RawAsset|String} owner - The owner asset or the resource url or the asset's uuid\r\n * @returns {Array}\r\n */\r\nproto.getDependsRecursively = function (owner) {\r\n    if (owner) {\r\n        var key = this._getReferenceKey(owner);\r\n        var assets = AutoReleaseUtils.getDependsRecursively(key);\r\n        assets.push(key);\r\n        return assets;\r\n    }\r\n    else {\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * !#en\r\n * Release the content of an asset or an array of assets by uuid.\r\n * Start from v1.3, this method will not only remove the cache of the asset in loader, but also clean up its content.\r\n * For example, if you release a texture, the texture asset and its gl texture data will be freed up.\r\n * In complexe project, you can use this function with {{#crossLink \"loader/getDependsRecursively:method\"}}{{/crossLink}} to free up memory in critical circumstances.\r\n * Notice, this method may cause the texture to be unusable, if there are still other nodes use the same texture, they may turn to black and report gl errors.\r\n * If you only want to remove the cache of an asset, please use {{#crossLink \"pipeline/removeItem:method\"}}{{/crossLink}}\r\n * !#zh\r\n *  id url\r\n *  v1.3  loader \r\n *  texture  texture  gl \r\n *  {{#crossLink \"loader/getDependsRecursively:method\"}}{{/crossLink}} \r\n *  GL \r\n *  {{#crossLink \"pipeline/removeItem:method\"}}{{/crossLink}}\r\n *\r\n * @example\r\n * // Release a texture which is no longer need\r\n * cc.loader.release(texture);\r\n * // Release all dependencies of a loaded prefab\r\n * var deps = cc.loader.getDependsRecursively('prefabs/sample');\r\n * cc.loader.release(deps);\r\n * // If there is no instance of this prefab in the scene, the prefab and its dependencies like textures, sprite frames, etc, will be freed up.\r\n * // If you have some other nodes share a texture in this prefab, you can skip it in two ways:\r\n * // 1. Forbid auto release a texture before release\r\n * cc.loader.setAutoRelease(texture2d, false);\r\n * // 2. Remove it from the dependencies array\r\n * var deps = cc.loader.getDependsRecursively('prefabs/sample');\r\n * var index = deps.indexOf(texture2d._uuid);\r\n * if (index !== -1)\r\n *     deps.splice(index, 1);\r\n * cc.loader.release(deps);\r\n *\r\n * @method release\r\n * @param {Asset|RawAsset|String|Array} asset\r\n */\r\nproto.release = function (asset) {\r\n    if (Array.isArray(asset)) {\r\n        for (let i = 0; i < asset.length; i++) {\r\n            var key = asset[i];\r\n            this.release(key);\r\n        }\r\n    }\r\n    else if (asset) {\r\n        var id = this._getReferenceKey(asset);\r\n        var item = this.getItem(id);\r\n        if (item) {\r\n            var removed = this.removeItem(id);\r\n            asset = item.content;\r\n            if (asset instanceof cc.Asset) {\r\n                let nativeUrl = asset.nativeUrl;\r\n                if (nativeUrl) {\r\n                    this.release(nativeUrl);  // uncache loading item of native asset\r\n                }\r\n                asset.destroy();\r\n            }\r\n            if (CC_DEBUG && removed) {\r\n                this._releasedAssetChecker_DEBUG.setReleased(item, id);\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Release the asset by its object. Refer to {{#crossLink \"loader/release:method\"}}{{/crossLink}} for detailed informations.\r\n * !#zh  {{#crossLink \"loader/release:method\"}}{{/crossLink}}\r\n *\r\n * @method releaseAsset\r\n * @param {Asset} asset\r\n */\r\nproto.releaseAsset = function (asset) {\r\n    var uuid = asset._uuid;\r\n    if (uuid) {\r\n        this.release(uuid);\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Release the asset loaded by {{#crossLink \"loader/loadRes:method\"}}{{/crossLink}}. Refer to {{#crossLink \"loader/release:method\"}}{{/crossLink}} for detailed informations.\r\n * !#zh  {{#crossLink \"loader/loadRes:method\"}}{{/crossLink}}  {{#crossLink \"loader/release:method\"}}{{/crossLink}}\r\n *\r\n * @method releaseRes\r\n * @param {String} url\r\n * @param {Function} [type] - Only asset of type will be released if this argument is supplied.\r\n */\r\nproto.releaseRes = function (url, type) {\r\n    var uuid = this._getResUuid(url, type);\r\n    if (uuid) {\r\n        this.release(uuid);\r\n    }\r\n    else {\r\n        cc.errorID(4914, url);\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Release the all assets loaded by {{#crossLink \"loader/loadResDir:method\"}}{{/crossLink}}. Refer to {{#crossLink \"loader/release:method\"}}{{/crossLink}} for detailed informations.\r\n * !#zh  {{#crossLink \"loader/loadResDir:method\"}}{{/crossLink}}  {{#crossLink \"loader/release:method\"}}{{/crossLink}}\r\n *\r\n * @method releaseResDir\r\n * @param {String} url\r\n * @param {Function} [type] - Only asset of type will be released if this argument is supplied.\r\n */\r\nproto.releaseResDir = function (url, type) {\r\n    var uuids = resources.getUuidArray(url, type);\r\n    for (var i = 0; i < uuids.length; i++) {\r\n        var uuid = uuids[i];\r\n        this.release(uuid);\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Resource all assets. Refer to {{#crossLink \"loader/release:method\"}}{{/crossLink}} for detailed informations.\r\n * !#zh  {{#crossLink \"loader/release:method\"}}{{/crossLink}}\r\n *\r\n * @method releaseAll\r\n */\r\nproto.releaseAll = function () {\r\n    for (var id in this._cache) {\r\n        this.release(id);\r\n    }\r\n};\r\n\r\n// AUTO RELEASE\r\n\r\n// override\r\nproto.removeItem = function (key) {\r\n    var removed = Pipeline.prototype.removeItem.call(this, key);\r\n    delete this._autoReleaseSetting[key];\r\n    return removed;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Indicates whether to release the asset when loading a new scene.<br>\r\n * By default, when loading a new scene, all assets in the previous scene will be released or preserved\r\n * according to whether the previous scene checked the \"Auto Release Assets\" option.\r\n * On the other hand, assets dynamically loaded by using `cc.loader.loadRes` or `cc.loader.loadResDir`\r\n * will not be affected by that option, remain not released by default.<br>\r\n * Use this API to change the default behavior on a single asset, to force preserve or release specified asset when scene switching.<br>\r\n * <br>\r\n * See: {{#crossLink \"loader/setAutoReleaseRecursively:method\"}}cc.loader.setAutoReleaseRecursively{{/crossLink}}, {{#crossLink \"loader/isAutoRelease:method\"}}cc.loader.isAutoRelease{{/crossLink}}\r\n * !#zh\r\n * <br>\r\n * Auto Release Assets\r\n *  `cc.loader.loadRes`  `cc.loader.loadResDir` <br>\r\n *  API <br>\r\n * <br>\r\n * {{#crossLink \"loader/setAutoReleaseRecursively:method\"}}cc.loader.setAutoReleaseRecursively{{/crossLink}}{{#crossLink \"loader/isAutoRelease:method\"}}cc.loader.isAutoRelease{{/crossLink}}\r\n *\r\n * @example\r\n * // auto release the texture event if \"Auto Release Assets\" disabled in current scene\r\n * cc.loader.setAutoRelease(texture2d, true);\r\n * // don't release the texture even if \"Auto Release Assets\" enabled in current scene\r\n * cc.loader.setAutoRelease(texture2d, false);\r\n * // first parameter can be url\r\n * cc.loader.setAutoRelease(audioUrl, false);\r\n *\r\n * @method setAutoRelease\r\n * @param {Asset|String} assetOrUrlOrUuid - asset object or the raw asset's url or uuid\r\n * @param {Boolean} autoRelease - indicates whether should release automatically\r\n */\r\nproto.setAutoRelease = function (assetOrUrlOrUuid, autoRelease) {\r\n    var key = this._getReferenceKey(assetOrUrlOrUuid);\r\n    if (key) {\r\n        this._autoReleaseSetting[key] = !!autoRelease;\r\n    }\r\n    else if (CC_DEV) {\r\n        cc.warnID(4902);\r\n    }\r\n};\r\n\r\n/**\r\n * !#en\r\n * Indicates whether to release the asset and its referenced other assets when loading a new scene.<br>\r\n * By default, when loading a new scene, all assets in the previous scene will be released or preserved\r\n * according to whether the previous scene checked the \"Auto Release Assets\" option.\r\n * On the other hand, assets dynamically loaded by using `cc.loader.loadRes` or `cc.loader.loadResDir`\r\n * will not be affected by that option, remain not released by default.<br>\r\n * Use this API to change the default behavior on the specified asset and its recursively referenced assets, to force preserve or release specified asset when scene switching.<br>\r\n * <br>\r\n * See: {{#crossLink \"loader/setAutoRelease:method\"}}cc.loader.setAutoRelease{{/crossLink}}, {{#crossLink \"loader/isAutoRelease:method\"}}cc.loader.isAutoRelease{{/crossLink}}\r\n * !#zh\r\n * <br>\r\n * Auto Release Assets\r\n *  `cc.loader.loadRes`  `cc.loader.loadResDir` <br>\r\n *  API <br>\r\n * <br>\r\n * {{#crossLink \"loader/setAutoRelease:method\"}}cc.loader.setAutoRelease{{/crossLink}}{{#crossLink \"loader/isAutoRelease:method\"}}cc.loader.isAutoRelease{{/crossLink}}\r\n *\r\n * @example\r\n * // auto release the SpriteFrame and its Texture event if \"Auto Release Assets\" disabled in current scene\r\n * cc.loader.setAutoReleaseRecursively(spriteFrame, true);\r\n * // don't release the SpriteFrame and its Texture even if \"Auto Release Assets\" enabled in current scene\r\n * cc.loader.setAutoReleaseRecursively(spriteFrame, false);\r\n * // don't release the Prefab and all the referenced assets\r\n * cc.loader.setAutoReleaseRecursively(prefab, false);\r\n *\r\n * @method setAutoReleaseRecursively\r\n * @param {Asset|String} assetOrUrlOrUuid - asset object or the raw asset's url or uuid\r\n * @param {Boolean} autoRelease - indicates whether should release automatically\r\n */\r\nproto.setAutoReleaseRecursively = function (assetOrUrlOrUuid, autoRelease) {\r\n    autoRelease = !!autoRelease;\r\n    var key = this._getReferenceKey(assetOrUrlOrUuid);\r\n    if (key) {\r\n        this._autoReleaseSetting[key] = autoRelease;\r\n\r\n        var depends = AutoReleaseUtils.getDependsRecursively(key);\r\n        for (var i = 0; i < depends.length; i++) {\r\n            var depend = depends[i];\r\n            this._autoReleaseSetting[depend] = autoRelease;\r\n        }\r\n    }\r\n    else if (CC_DEV) {\r\n        cc.warnID(4902);\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * !#en\r\n * Returns whether the asset is configured as auto released, despite how \"Auto Release Assets\" property is set on scene asset.<br>\r\n * <br>\r\n * See: {{#crossLink \"loader/setAutoRelease:method\"}}cc.loader.setAutoRelease{{/crossLink}}, {{#crossLink \"loader/setAutoReleaseRecursively:method\"}}cc.loader.setAutoReleaseRecursively{{/crossLink}}\r\n *\r\n * !#zh\r\n * Auto Release Assets<br>\r\n * <br>\r\n * {{#crossLink \"loader/setAutoRelease:method\"}}cc.loader.setAutoRelease{{/crossLink}}{{#crossLink \"loader/setAutoReleaseRecursively:method\"}}cc.loader.setAutoReleaseRecursively{{/crossLink}}\r\n * @method isAutoRelease\r\n * @param {Asset|String} assetOrUrl - asset object or the raw asset's url\r\n * @returns {Boolean}\r\n */\r\nproto.isAutoRelease = function (assetOrUrl) {\r\n    var key = this._getReferenceKey(assetOrUrl);\r\n    if (key) {\r\n        return !!this._autoReleaseSetting[key];\r\n    }\r\n    return false;\r\n};\r\n\r\ncc.loader = new CCLoader();\r\n\r\nif (CC_EDITOR) {\r\n    cc.loader.refreshUrl = function (uuid, oldUrl, newUrl) {\r\n        var item = this._cache[uuid];\r\n        if (item) {\r\n            item.url = newUrl;\r\n        }\r\n\r\n        item = this._cache[oldUrl];\r\n        if (item) {\r\n            item.id = newUrl;\r\n            item.url = newUrl;\r\n            this._cache[newUrl] = item;\r\n            delete this._cache[oldUrl];\r\n        }\r\n    };\r\n}\r\n\r\nmodule.exports = cc.loader;\r\n","/****************************************************************************\r\n Copyright (c) 2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('../utils/CCPath');\r\nconst debug = require('../CCDebug');\r\nconst Pipeline = require('./pipeline');\r\nconst LoadingItems = require('./loading-items');\r\n\r\nvar ID = 'AssetLoader';\r\n\r\nvar AssetLoader = function (extMap) {\r\n    this.id = ID;\r\n    this.async = true;\r\n    this.pipeline = null;\r\n};\r\nAssetLoader.ID = ID;\r\n\r\nvar reusedArray = [];\r\nAssetLoader.prototype.handle = function (item, callback) {\r\n    var uuid = item.uuid;\r\n    if (!uuid) {\r\n        return item.content || null;\r\n    }\r\n\r\n    var self = this;\r\n    cc.AssetLibrary.queryAssetInfo(uuid, function (error, url, isRawAsset) {\r\n        if (error) {\r\n            callback(error);\r\n        }\r\n        else {\r\n            item.url = item.rawUrl = url;\r\n            item.isRawAsset = isRawAsset;\r\n            if (isRawAsset) {\r\n                var ext = cc.path.extname(url).toLowerCase();\r\n                if (!ext) {\r\n                    callback(new Error(debug.getError(4931, uuid, url)));\r\n                    return;\r\n                }\r\n                ext = ext.substr(1);\r\n                var queue = LoadingItems.getQueue(item);\r\n                reusedArray[0] = {\r\n                    queueId: item.queueId,\r\n                    id: url,\r\n                    url: url,\r\n                    type: ext,\r\n                    error: null,\r\n                    alias: item,\r\n                    complete: true\r\n                };\r\n                if (CC_EDITOR) {\r\n                    self.pipeline._cache[url] = reusedArray[0];\r\n                }\r\n                queue.append(reusedArray);\r\n                // Dispatch to other raw type downloader\r\n                item.type = ext;\r\n                callback(null, item.content);\r\n            }\r\n            else {\r\n                item.type = 'uuid';\r\n                callback(null, item.content);\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nPipeline.AssetLoader = module.exports = AssetLoader;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar pushToMap = require('../utils/misc').pushToMap;\r\nvar js = require('../platform/js');\r\n\r\nfunction Entry (uuid, type) {\r\n    this.uuid = uuid;\r\n    this.type = type;\r\n}\r\n\r\n/*\r\n * !#en AssetTable is used to find asset's uuid by url.\r\n * !#zh AssetTable  uuid  url\r\n * @class AssetTable\r\n *\r\n */\r\n\r\nfunction AssetTable () {\r\n    this._pathToUuid = js.createMap(true);\r\n}\r\n\r\nfunction isMatchByWord (path, test) {\r\n    if (path.length > test.length) {\r\n        var nextAscii = path.charCodeAt(test.length);\r\n        return (nextAscii === 46 || nextAscii === 47); // '.' or '/'\r\n    }\r\n    return true;\r\n}\r\n\r\nvar proto = AssetTable.prototype;\r\n\r\nproto.getUuid = function (path, type) {\r\n    path = cc.url.normalize(path);\r\n    var item = this._pathToUuid[path];\r\n    if (item) {\r\n        if (Array.isArray(item)) {\r\n            if (type) {\r\n                for (var i = 0; i < item.length; i++) {\r\n                    var entry = item[i];\r\n                    if (js.isChildClassOf(entry.type, type)) {\r\n                        return entry.uuid;\r\n                    }\r\n                }\r\n                // not found\r\n                if (CC_DEBUG && js.isChildClassOf(type, cc.SpriteFrame)) {\r\n                    for (let i = 0; i < item.length; i++) {\r\n                        let entry = item[i];\r\n                        if (js.isChildClassOf(entry.type, cc.SpriteAtlas)) {\r\n                            // not support sprite frame in atlas\r\n                            cc.errorID(4932, path);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                return item[0].uuid;\r\n            }\r\n        }\r\n        else if (!type || js.isChildClassOf(item.type, type)) {\r\n            return item.uuid;\r\n        }\r\n        else if (CC_DEBUG && js.isChildClassOf(type, cc.SpriteFrame) && js.isChildClassOf(item.type, cc.SpriteAtlas)) {\r\n            // not support sprite frame in atlas\r\n            cc.errorID(4932, path);\r\n        }\r\n    }\r\n    return '';\r\n};\r\n\r\nproto.getUuidArray = function (path, type, out_urls) {\r\n    path = cc.url.normalize(path);\r\n    if (path[path.length - 1] === '/') {\r\n        path = path.slice(0, -1);\r\n    }\r\n    var path2uuid = this._pathToUuid;\r\n    var uuids = [];\r\n    var isChildClassOf = js.isChildClassOf;\r\n    var _foundAtlasUrl;\r\n    for (var p in path2uuid) {\r\n        if ((p.startsWith(path) && isMatchByWord(p, path)) || !path) {\r\n            var item = path2uuid[p];\r\n            if (Array.isArray(item)) {\r\n                for (var i = 0; i < item.length; i++) {\r\n                    var entry = item[i];\r\n                    if (!type || isChildClassOf(entry.type, type)) {\r\n                        uuids.push(entry.uuid);\r\n                        if (out_urls) {\r\n                            out_urls.push(p);\r\n                        }\r\n                    }\r\n                    else if (CC_DEBUG && entry.type === cc.SpriteAtlas) {\r\n                        _foundAtlasUrl = p;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (!type || isChildClassOf(item.type, type)) {\r\n                    uuids.push(item.uuid);\r\n                    if (out_urls) {\r\n                        out_urls.push(p);\r\n                    }\r\n                }\r\n                else if (CC_DEBUG && item.type === cc.SpriteAtlas) {\r\n                    _foundAtlasUrl = p;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (CC_DEBUG && uuids.length === 0 && _foundAtlasUrl && js.isChildClassOf(type, cc.SpriteFrame)) {\r\n        // not support sprite frame in atlas\r\n        cc.errorID(4932, _foundAtlasUrl);\r\n    }\r\n    return uuids;\r\n};\r\n\r\n// /**\r\n//  * !#en Returns all asset paths in the table.\r\n//  * !#zh \r\n//  * @method getAllPaths\r\n//  * @return {string[]}\r\n//  */\r\n// proto.getAllPaths = function () {\r\n//     return Object.keys(this._pathToUuid);\r\n// };\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh  keyuuid \r\n * @method add\r\n * @param {String} path - the path to load, should NOT include filename extensions.\r\n * @param {String} uuid\r\n * @param {Function} type\r\n * @param {Boolean} isMainAsset\r\n * @private\r\n */\r\nproto.add = function (path, uuid, type, isMainAsset) {\r\n    // remove extname\r\n    // (can not use path.slice because length of extname maybe 0)\r\n    path = path.substring(0, path.length - cc.path.extname(path).length);\r\n    var newEntry = new Entry(uuid, type);\r\n    pushToMap(this._pathToUuid, path, newEntry, isMainAsset);\r\n};\r\n\r\nproto._getInfo_DEBUG = CC_DEBUG && function (uuid, out_info) {\r\n    var path2uuid = this._pathToUuid;\r\n    var paths = Object.keys(path2uuid);\r\n    for (var p = 0; p < paths.length; ++p) {\r\n        var path = paths[p];\r\n        var item = path2uuid[path];\r\n        if (Array.isArray(item)) {\r\n            for (var i = 0; i < item.length; i++) {\r\n                var entry = item[i];\r\n                if (entry.uuid === uuid) {\r\n                    out_info.path = path;\r\n                    out_info.type = entry.type;\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        else if (item.uuid === uuid) {\r\n            out_info.path = path;\r\n            out_info.type = item.type;\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\n\r\nproto.reset = function () {\r\n    this._pathToUuid = js.createMap(true);\r\n};\r\n\r\n\r\nmodule.exports = AssetTable;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst sys = require('../platform/CCSys');\r\nconst debug = require('../CCDebug');\r\n\r\nvar __audioSupport = sys.__audioSupport;\r\nvar formatSupport = __audioSupport.format;\r\nvar context = __audioSupport.context;\r\n\r\nfunction loadDomAudio (item, callback) {\r\n    var dom = document.createElement('audio');\r\n    dom.src = item.url;\r\n\r\n    if (CC_WECHATGAME) {\r\n        callback(null, dom);\r\n        return;\r\n    }\r\n\r\n    var clearEvent = function () {\r\n        clearTimeout(timer);\r\n        dom.removeEventListener(\"canplaythrough\", success, false);\r\n        dom.removeEventListener(\"error\", failure, false);\r\n        if(__audioSupport.USE_LOADER_EVENT)\r\n            dom.removeEventListener(__audioSupport.USE_LOADER_EVENT, success, false);\r\n    };\r\n    var timer = setTimeout(function () {\r\n        if (dom.readyState === 0)\r\n            failure();\r\n        else\r\n            success();\r\n    }, 8000);\r\n    var success = function () {\r\n        clearEvent();\r\n        callback(null, dom);\r\n    };\r\n    var failure = function () {\r\n        clearEvent();\r\n        var message = 'load audio failure - ' + item.url;\r\n        cc.log(message);\r\n        callback(message);\r\n    };\r\n    dom.addEventListener(\"canplaythrough\", success, false);\r\n    dom.addEventListener(\"error\", failure, false);\r\n    if(__audioSupport.USE_LOADER_EVENT)\r\n        dom.addEventListener(__audioSupport.USE_LOADER_EVENT, success, false);\r\n}\r\n\r\nfunction loadWebAudio (item, callback) {\r\n    if (!context)\r\n        callback(new Error(debug.getError(4926)));\r\n\r\n    var request = cc.loader.getXMLHttpRequest();\r\n    request.open(\"GET\", item.url, true);\r\n    request.responseType = \"arraybuffer\";\r\n\r\n    // Our asynchronous callback\r\n    request.onload = function () {\r\n        context[\"decodeAudioData\"](request.response, function(buffer){\r\n            //success\r\n            callback(null, buffer);\r\n        }, function(){\r\n            //error\r\n            callback('decode error - ' + item.id, null);\r\n        });\r\n    };\r\n\r\n    request.onerror = function(){\r\n        callback('request error - ' + item.id, null);\r\n    };\r\n\r\n    request.send();\r\n}\r\n\r\nfunction downloadAudio (item, callback) {\r\n    if (formatSupport.length === 0) {\r\n        return new Error(debug.getError(4927));\r\n    }\r\n\r\n    var loader;\r\n    if (!__audioSupport.WEB_AUDIO) {\r\n        // If WebAudio is not supported, load using DOM mode\r\n        loader = loadDomAudio;\r\n    }\r\n    else {\r\n        var loadByDeserializedAudio = item._owner instanceof cc.AudioClip;\r\n        if (loadByDeserializedAudio) {\r\n            loader = (item._owner.loadMode === cc.AudioClip.LoadMode.WEB_AUDIO) ? loadWebAudio : loadDomAudio;\r\n        }\r\n        else {\r\n            loader = (item.urlParam && item.urlParam['useDom']) ? loadDomAudio : loadWebAudio;\r\n        }\r\n    }\r\n    loader(item, callback);\r\n}\r\n\r\nmodule.exports = downloadAudio;\r\n","/****************************************************************************\r\n Copyright (c) 2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('../platform/js');\r\n\r\nfunction parseDepends (key, parsed) {\r\n    var item = cc.loader.getItem(key);\r\n    if (item) {\r\n        var depends = item.dependKeys;\r\n        if (depends) {\r\n            for (var i = 0; i < depends.length; i++) {\r\n                var depend = depends[i];\r\n                if ( !parsed[depend] ) {\r\n                    parsed[depend] = true;\r\n                    parseDepends(depend, parsed);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction visitAsset (asset, excludeMap) {\r\n    // Skip assets generated programmatically or by user (e.g. label texture)\r\n    if (!asset._uuid) {\r\n        return;\r\n    }\r\n    var key = cc.loader._getReferenceKey(asset);\r\n    if ( !excludeMap[key] ) {\r\n        excludeMap[key] = true;\r\n        parseDepends(key, excludeMap);\r\n    }\r\n}\r\n\r\nfunction visitComponent (comp, excludeMap) {\r\n    var props = Object.getOwnPropertyNames(comp);\r\n    for (var i = 0; i < props.length; i++) {\r\n        var value = comp[props[i]];\r\n        if (typeof value === 'object' && value) {\r\n            if (Array.isArray(value)) {\r\n                for (let j = 0; j < value.length; j++) {\r\n                    let val = value[j];\r\n                    if (val instanceof cc.RawAsset) {\r\n                        visitAsset(val, excludeMap);\r\n                    }\r\n                }\r\n            }\r\n            else if (!value.constructor || value.constructor === Object) {\r\n                let keys = Object.getOwnPropertyNames(value);\r\n                for (let j = 0; j < keys.length; j++) {\r\n                    let val = value[keys[j]];\r\n                    if (val instanceof cc.RawAsset) {\r\n                        visitAsset(val, excludeMap);\r\n                    }\r\n                }\r\n            }\r\n            else if (value instanceof cc.RawAsset) {\r\n                visitAsset(value, excludeMap);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction visitNode (node, excludeMap) {\r\n    for (let i = 0; i < node._components.length; i++) {\r\n        visitComponent(node._components[i], excludeMap);\r\n    }\r\n    for (let i = 0; i < node._children.length; i++) {\r\n        visitNode(node._children[i], excludeMap);\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    // do auto release\r\n    autoRelease: function (oldSceneAssets, nextSceneAssets, persistNodes) {\r\n        var releaseSettings = cc.loader._autoReleaseSetting;\r\n        var excludeMap = js.createMap();\r\n\r\n        // collect next scene assets\r\n        if (nextSceneAssets) {\r\n            for (let i = 0; i < nextSceneAssets.length; i++) {\r\n                excludeMap[nextSceneAssets[i]] = true;\r\n            }\r\n        }\r\n\r\n        // collect assets used by persist nodes\r\n        for (let i = 0; i < persistNodes.length; i++) {\r\n            visitNode(persistNodes[i], excludeMap)\r\n        }\r\n\r\n        // remove ununsed scene assets\r\n        if (oldSceneAssets) {\r\n            for (let i = 0; i < oldSceneAssets.length; i++) {\r\n                let key = oldSceneAssets[i];\r\n                if (releaseSettings[key] !== false && !excludeMap[key]) {\r\n                    cc.loader.release(key);\r\n                }\r\n            }\r\n        }\r\n\r\n        // remove auto release assets\r\n        // (releasing asset will change _autoReleaseSetting, so don't use for-in)\r\n        var keys = Object.keys(releaseSettings);\r\n        for (let i = 0; i < keys.length; i++) {\r\n            let key = keys[i];\r\n            if (releaseSettings[key] === true && !excludeMap[key]) {\r\n                cc.loader.release(key);\r\n            }\r\n        }\r\n    },\r\n\r\n    // get dependencies not including self\r\n    getDependsRecursively: function (key) {\r\n        var depends = {};\r\n        parseDepends(key, depends);\r\n        return Object.keys(depends);\r\n    }\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nfunction downloadBinary (item, callback) {\r\n    var url = item.url;\r\n    var xhr = cc.loader.getXMLHttpRequest(),\r\n        errInfo = 'Load binary data failed: ' + url + '';\r\n    xhr.open('GET', url, true);\r\n    xhr.responseType = \"arraybuffer\";\r\n    xhr.onload = function () {\r\n        var arrayBuffer = xhr.response;\r\n        if (arrayBuffer) {\r\n            var result = new Uint8Array(arrayBuffer);\r\n            callback(null, result);\r\n        }\r\n        else {\r\n            callback({status:xhr.status, errorMessage:errInfo + '(no response)'});\r\n        }\r\n    };\r\n    xhr.onerror = function(){\r\n        callback({status:xhr.status, errorMessage:errInfo + '(error)'});\r\n    };\r\n    xhr.ontimeout = function(){\r\n        callback({status:xhr.status, errorMessage:errInfo + '(time out)'});\r\n    };\r\n    xhr.send(null);\r\n}\r\n\r\nmodule.exports = downloadBinary;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../platform/js');\r\nconst debug = require('../CCDebug');\r\nrequire('../utils/CCPath');\r\nconst Pipeline = require('./pipeline');\r\nconst PackDownloader = require('./pack-downloader');\r\n\r\nlet downloadBinary = require('./binary-downloader');\r\nlet downloadText = require('./text-downloader');\r\nlet urlAppendTimestamp = require('./utils').urlAppendTimestamp;\r\n\r\nvar downloadAudio;\r\nif (!CC_EDITOR || !Editor.isMainProcess) {\r\n    downloadAudio = require('./audio-downloader');\r\n}\r\nelse {\r\n    downloadAudio = null;\r\n}\r\n\r\nfunction skip () {\r\n    return null;\r\n}\r\n\r\nfunction downloadScript (item, callback, isAsync) {\r\n    var url = item.url,\r\n        d = document,\r\n        s = document.createElement('script');\r\n\r\n    if (window.location.protocol !== 'file:') {\r\n        s.crossOrigin = 'anonymous';\r\n    }\r\n\r\n    s.async = isAsync;\r\n    s.src = urlAppendTimestamp(url);\r\n    function loadHandler () {\r\n        s.parentNode.removeChild(s);\r\n        s.removeEventListener('load', loadHandler, false);\r\n        s.removeEventListener('error', errorHandler, false);\r\n        callback(null, url);\r\n    }\r\n    function errorHandler() {\r\n        s.parentNode.removeChild(s);\r\n        s.removeEventListener('load', loadHandler, false);\r\n        s.removeEventListener('error', errorHandler, false);\r\n        callback(new Error(debug.getError(4928, url)));\r\n    }\r\n    s.addEventListener('load', loadHandler, false);\r\n    s.addEventListener('error', errorHandler, false);\r\n    d.body.appendChild(s);\r\n}\r\n\r\nfunction downloadWebp (item, callback, isCrossOrigin, img) {\r\n    if (!cc.sys.capabilities.webp) {\r\n        return new Error(debug.getError(4929, item.url));\r\n    }\r\n    return downloadImage(item, callback, isCrossOrigin, img);\r\n}\r\n\r\nfunction downloadImage (item, callback, isCrossOrigin, img) {\r\n    if (isCrossOrigin === undefined) {\r\n        isCrossOrigin = true;\r\n    }\r\n\r\n    var url = urlAppendTimestamp(item.url);\r\n    img = img || new Image();\r\n    if (isCrossOrigin && window.location.protocol !== 'file:') {\r\n        img.crossOrigin = 'anonymous';\r\n    }\r\n    else {\r\n        img.crossOrigin = null;\r\n    }\r\n\r\n    if (img.complete && img.naturalWidth > 0 && img.src === url) {\r\n        return img;\r\n    }\r\n    else {\r\n        function loadCallback () {\r\n            img.removeEventListener('load', loadCallback);\r\n            img.removeEventListener('error', errorCallback);\r\n\r\n            img.id = item.id;\r\n            callback(null, img);\r\n        }\r\n        function errorCallback () {\r\n            img.removeEventListener('load', loadCallback);\r\n            img.removeEventListener('error', errorCallback);\r\n\r\n            // Retry without crossOrigin mark if crossOrigin loading fails\r\n            // Do not retry if protocol is https, even if the image is loaded, cross origin image isn't renderable.\r\n            if (window.location.protocol !== 'https:' && img.crossOrigin && img.crossOrigin.toLowerCase() === 'anonymous') {\r\n                downloadImage(item, callback, false, img);\r\n            }\r\n            else {\r\n                callback(new Error(debug.getError(4930, url)));\r\n            }\r\n        }\r\n\r\n        img.addEventListener('load', loadCallback);\r\n        img.addEventListener('error', errorCallback);\r\n        img.src = url;\r\n    }\r\n}\r\n\r\nfunction downloadUuid (item, callback) {\r\n    var result = PackDownloader.load(item, callback);\r\n    if (result === undefined) {\r\n        return this.extMap['json'](item, callback);\r\n    }\r\n    return result || undefined;\r\n}\r\n\r\n\r\nvar defaultMap = {\r\n    // JS\r\n    'js' : downloadScript,\r\n\r\n    // Images\r\n    'png' : downloadImage,\r\n    'jpg' : downloadImage,\r\n    'bmp' : downloadImage,\r\n    'jpeg' : downloadImage,\r\n    'gif' : downloadImage,\r\n    'ico' : downloadImage,\r\n    'tiff' : downloadImage,\r\n    'webp' : downloadWebp,\r\n    'image' : downloadImage,\r\n    'pvr': downloadBinary,\r\n    'etc': downloadBinary,\r\n\r\n    // Audio\r\n    'mp3' : downloadAudio,\r\n    'ogg' : downloadAudio,\r\n    'wav' : downloadAudio,\r\n    'm4a' : downloadAudio,\r\n\r\n    // Txt\r\n    'txt' : downloadText,\r\n    'xml' : downloadText,\r\n    'vsh' : downloadText,\r\n    'fsh' : downloadText,\r\n    'atlas' : downloadText,\r\n\r\n    'tmx' : downloadText,\r\n    'tsx' : downloadText,\r\n\r\n    'json' : downloadText,\r\n    'ExportJson' : downloadText,\r\n    'plist' : downloadText,\r\n\r\n    'fnt' : downloadText,\r\n\r\n    // Font\r\n    'font' : skip,\r\n    'eot' : skip,\r\n    'ttf' : skip,\r\n    'woff' : skip,\r\n    'svg' : skip,\r\n    'ttc' : skip,\r\n\r\n    // Deserializer\r\n    'uuid' : downloadUuid,\r\n\r\n    // Binary\r\n    'binary' : downloadBinary,\r\n    'bin': downloadBinary,\r\n\r\n    'default' : downloadText\r\n};\r\n\r\nvar ID = 'Downloader';\r\n\r\n/**\r\n * The downloader pipe, it can download several types of files:\r\n * 1. Text\r\n * 2. Image\r\n * 3. Script\r\n * 4. Audio\r\n * 5. Assets\r\n * All unknown type will be downloaded as plain text.\r\n * You can pass custom supported types in the constructor.\r\n * @class Pipeline.Downloader\r\n */\r\n/**\r\n * Constructor of Downloader, you can pass custom supported types.\r\n *\r\n * @method constructor\r\n * @param {Object} extMap Custom supported types with corresponded handler\r\n * @example\r\n *  var downloader = new Downloader({\r\n *      // This will match all url with `.scene` extension or all url with `scene` type\r\n *      'scene' : function (url, callback) {}\r\n *  });\r\n */\r\nvar Downloader = function (extMap) {\r\n    this.id = ID;\r\n    this.async = true;\r\n    this.pipeline = null;\r\n    this._curConcurrent = 0;\r\n    this._loadQueue = [];\r\n\r\n    this._subpackages = {};\r\n\r\n    this.extMap = js.mixin(extMap, defaultMap);\r\n};\r\nDownloader.ID = ID;\r\nDownloader.PackDownloader = PackDownloader;\r\n\r\n/**\r\n * Add custom supported types handler or modify existing type handler.\r\n * @method addHandlers\r\n * @param {Object} extMap Custom supported types with corresponded handler\r\n */\r\nDownloader.prototype.addHandlers = function (extMap) {\r\n    js.mixin(this.extMap, extMap);\r\n};\r\n\r\nDownloader.prototype._handleLoadQueue = function () {\r\n    while (this._curConcurrent < cc.macro.DOWNLOAD_MAX_CONCURRENT) {\r\n        var nextOne = this._loadQueue.shift();\r\n        if (!nextOne) {\r\n            break;\r\n        }\r\n        var syncRet = this.handle(nextOne.item, nextOne.callback);\r\n        if (syncRet !== undefined) {\r\n            if (syncRet instanceof Error) {\r\n                nextOne.callback(syncRet);\r\n            }\r\n            else {\r\n                nextOne.callback(null, syncRet);\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nDownloader.prototype.handle = function (item, callback) {\r\n    var self = this;\r\n    var downloadFunc = this.extMap[item.type] || this.extMap['default'];\r\n    var syncRet = undefined;\r\n    if (this._curConcurrent < cc.macro.DOWNLOAD_MAX_CONCURRENT) {\r\n        this._curConcurrent++;\r\n        syncRet = downloadFunc.call(this, item, function (err, result) {\r\n            self._curConcurrent = Math.max(0, self._curConcurrent - 1);\r\n            self._handleLoadQueue();\r\n            callback && callback(err, result);\r\n        });\r\n        if (syncRet !== undefined) {\r\n            this._curConcurrent = Math.max(0, this._curConcurrent - 1);\r\n            this._handleLoadQueue();\r\n            return syncRet;\r\n        }\r\n    }\r\n    else if (item.ignoreMaxConcurrency) {\r\n        syncRet = downloadFunc.call(this, item, callback);\r\n        if (syncRet !== undefined) {\r\n            return syncRet;\r\n        }\r\n    }\r\n    else {\r\n        this._loadQueue.push({\r\n            item: item,\r\n            callback: callback\r\n        });\r\n    }\r\n};\r\n\r\n/**\r\n * !#en\r\n * Load subpackage with name.\r\n * !#zh\r\n * \r\n * @method loadSubpackage\r\n * @param {String} name - Subpackage name\r\n * @param {Function} [completeCallback] -  Callback invoked when subpackage loaded\r\n * @param {Error} completeCallback.error - error information\r\n */\r\nDownloader.prototype.loadSubpackage = function (name, completeCallback) {\r\n    let pac = this._subpackages[name];\r\n    if (pac) {\r\n        if (pac.loaded) {\r\n            if (completeCallback) completeCallback();\r\n        }\r\n        else {\r\n            downloadScript({url: pac.path}, function (err) {\r\n                if (!err) {\r\n                    pac.loaded = true;\r\n                }\r\n                if (completeCallback) completeCallback(err);\r\n            });\r\n        }\r\n    }\r\n    else if (completeCallback) {\r\n        completeCallback(new Error(`Can't find subpackage ${name}`));\r\n    }\r\n};\r\n\r\nPipeline.Downloader = module.exports = Downloader;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst textUtils = require('../utils/text-utils');\r\n\r\nlet _canvasContext = null;\r\nlet _testString = \"BES bswy:->@\";\r\n\r\nlet _fontFaces = {};\r\nlet _intervalId = -1;\r\nlet _loadingFonts = [];\r\n// 60 seconds timeout\r\nlet _timeout = 60000;\r\n\r\nfunction _checkFontLoaded () {\r\n    let allFontsLoaded = true;\r\n    let now = Date.now();\r\n\r\n    for (let i = _loadingFonts.length - 1; i >= 0; i--) {\r\n        let fontLoadHandle = _loadingFonts[i];\r\n        let fontFamily = fontLoadHandle.fontFamilyName;\r\n        // load timeout\r\n        if (now - fontLoadHandle.startTime > _timeout) {\r\n            cc.warnID(4933, fontFamily);\r\n            fontLoadHandle.callback(null, fontFamily);\r\n            _loadingFonts.splice(i, 1);\r\n            continue;\r\n        }\r\n\r\n        let oldWidth = fontLoadHandle.refWidth;\r\n        _canvasContext.font = '40px ' + fontFamily;\r\n        let newWidth = textUtils.safeMeasureText(_canvasContext, _testString);\r\n        // loaded successfully\r\n        if (oldWidth !== newWidth) {\r\n            _loadingFonts.splice(i, 1);\r\n            fontLoadHandle.callback(null, fontFamily);\r\n        }\r\n        else {\r\n            allFontsLoaded = false;\r\n        }\r\n    }\r\n\r\n    if (allFontsLoaded) {\r\n        clearInterval(_intervalId);\r\n        _intervalId = -1;\r\n    }\r\n}\r\n\r\nvar fontLoader = {\r\n    loadFont: function (item, callback) {\r\n        let url = item.url;\r\n        let fontFamilyName = fontLoader._getFontFamily(url);\r\n\r\n        // Already loaded fonts\r\n        if (_fontFaces[fontFamilyName]) {\r\n            return fontFamilyName;\r\n        }\r\n\r\n        if (!_canvasContext) {\r\n            let labelCanvas = document.createElement('canvas');\r\n            labelCanvas.width = 100;\r\n            labelCanvas.height = 100;\r\n            _canvasContext = labelCanvas.getContext('2d');\r\n        }\r\n        \r\n        // Default width reference to test whether new font is loaded correctly\r\n        let fontDesc = '40px ' + fontFamilyName;\r\n        _canvasContext.font = fontDesc;\r\n        let refWidth = textUtils.safeMeasureText(_canvasContext, _testString);\r\n\r\n        // Setup font face style\r\n        let fontStyle = document.createElement(\"style\");\r\n        fontStyle.type = \"text/css\";\r\n        let fontStr = \"\";\r\n        if (isNaN(fontFamilyName - 0))\r\n            fontStr += \"@font-face { font-family:\" + fontFamilyName + \"; src:\";\r\n        else\r\n            fontStr += \"@font-face { font-family:'\" + fontFamilyName + \"'; src:\";\r\n        fontStr += \"url('\" + url + \"');\";\r\n        fontStyle.textContent = fontStr + \"}\";\r\n        document.body.appendChild(fontStyle);\r\n\r\n        // Preload font with div\r\n        let preloadDiv = document.createElement(\"div\");\r\n        let divStyle = preloadDiv.style;\r\n        divStyle.fontFamily = fontFamilyName;\r\n        preloadDiv.innerHTML = \".\";\r\n        divStyle.position = \"absolute\";\r\n        divStyle.left = \"-100px\";\r\n        divStyle.top = \"-100px\";\r\n        document.body.appendChild(preloadDiv);\r\n\r\n        // Save loading font\r\n        let fontLoadHandle = {\r\n            fontFamilyName,\r\n            refWidth,\r\n            callback,\r\n            startTime: Date.now()\r\n        }\r\n        _loadingFonts.push(fontLoadHandle);\r\n        _fontFaces[fontFamilyName] = fontStyle;\r\n\r\n        if (_intervalId === -1) {\r\n            _intervalId = setInterval(_checkFontLoaded, 100);\r\n        }\r\n    },\r\n\r\n    _getFontFamily: function (fontHandle) {\r\n        var ttfIndex = fontHandle.lastIndexOf(\".ttf\");\r\n        if (ttfIndex === -1) return fontHandle;\r\n\r\n        var slashPos = fontHandle.lastIndexOf(\"/\");\r\n        var fontFamilyName;\r\n        if (slashPos === -1) {\r\n            fontFamilyName = fontHandle.substring(0, ttfIndex) + \"_LABEL\";\r\n        } else {\r\n            fontFamilyName = fontHandle.substring(slashPos + 1, ttfIndex) + \"_LABEL\";\r\n        }\r\n        if (fontFamilyName.indexOf(' ') !== -1) {\r\n            fontFamilyName = '\"' + fontFamilyName + '\"';\r\n        }\r\n        return fontFamilyName;\r\n    }\r\n};\r\n\r\nmodule.exports = fontLoader","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./downloader');\r\nrequire('./loader');\r\n\r\nrequire('./loading-items');\r\nrequire('./pipeline');\r\n\r\nrequire('./CCLoader');\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../platform/js');\r\nconst plistParser = require('../platform/CCSAXParser').plistParser;\r\nconst Pipeline = require('./pipeline');\r\nconst Texture2D = require('../assets/CCTexture2D');\r\nconst loadUuid = require('./uuid-loader');\r\nconst fontLoader = require('./font-loader');\r\n\r\nfunction loadNothing () {\r\n    return null;\r\n}\r\n\r\nfunction loadJSON (item) {\r\n    if (typeof item.content !== 'string') {\r\n        return new Error('JSON Loader: Input item doesn\\'t contain string content');\r\n    }\r\n\r\n    try {\r\n        var result = JSON.parse(item.content);\r\n        return result;\r\n    }\r\n    catch (e) {\r\n        return new Error('JSON Loader: Parse json [' + item.id + '] failed : ' + e);\r\n    }\r\n}\r\n\r\nfunction loadImage (item) {\r\n    var loadByDeserializedAsset = (item._owner instanceof cc.Asset);\r\n    if (loadByDeserializedAsset) {\r\n        // already has cc.Asset\r\n        return null;\r\n    }\r\n\r\n    var image = item.content;\r\n    if (!CC_WECHATGAME && !CC_QQPLAY && cc.sys.platform !== cc.sys.FB_PLAYABLE_ADS && !(image instanceof Image)) {\r\n        return new Error('Image Loader: Input item doesn\\'t contain Image content');\r\n    } \r\n\r\n    // load cc.Texture2D\r\n    var rawUrl = item.rawUrl;\r\n    var tex = item.texture || new Texture2D();\r\n    tex._uuid = item.uuid;\r\n    tex.url = rawUrl;\r\n    tex._setRawAsset(rawUrl, false);\r\n    tex._nativeAsset = image;\r\n    return tex;\r\n}\r\n\r\n// If audio is loaded by url directly, than this loader will wrap it into a new cc.AudioClip object.\r\n// If audio is loaded by deserialized AudioClip, than this loader will be skipped.\r\nfunction loadAudioAsAsset (item, callback) {\r\n    var loadByDeserializedAsset = (item._owner instanceof cc.Asset);\r\n    if (loadByDeserializedAsset) {\r\n        // already has cc.Asset\r\n        return null;\r\n    }\r\n\r\n    var audioClip = new cc.AudioClip();\r\n    audioClip._setRawAsset(item.rawUrl, false);\r\n    audioClip._nativeAsset = item.content;\r\n    return audioClip;\r\n}\r\n\r\nfunction loadPlist (item) {\r\n    if (typeof item.content !== 'string') {\r\n        return new Error('Plist Loader: Input item doesn\\'t contain string content');\r\n    }\r\n    var result = plistParser.parse(item.content);\r\n    if (result) {\r\n        return result;\r\n    }\r\n    else {\r\n        return new Error('Plist Loader: Parse [' + item.id + '] failed');\r\n    }\r\n}\r\n\r\nfunction loadBinary (item) {\r\n    // Invoke custom handle\r\n    if (item.load) {\r\n        return item.load(item.content);\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\r\n\r\n//===============//\r\n// PVR constants //\r\n//===============//\r\n// https://github.com/toji/texture-tester/blob/master/js/webgl-texture-util.js#L424\r\nconst PVR_HEADER_LENGTH = 13; // The header length in 32 bit ints.\r\nconst PVR_MAGIC = 0x03525650; //0x50565203;\r\n\r\n// Offsets into the header array.\r\nconst PVR_HEADER_MAGIC = 0;\r\nconst PVR_HEADER_FORMAT = 2;\r\nconst PVR_HEADER_HEIGHT = 6;\r\nconst PVR_HEADER_WIDTH = 7;\r\nconst PVR_HEADER_MIPMAPCOUNT = 11;\r\nconst PVR_HEADER_METADATA = 12;\r\n\r\nfunction loadCompressedTex (item) {\r\n    // Get a view of the arrayBuffer that represents the DDS header.\r\n    let header = new Int32Array(item.content.buffer, 0, PVR_HEADER_LENGTH);\r\n\r\n    // Do some sanity checks to make sure this is a valid DDS file.\r\n    if(header[PVR_HEADER_MAGIC] != PVR_MAGIC) {\r\n      return new Error(\"Invalid magic number in PVR header\");\r\n    }\r\n\r\n    // Gather other basic metrics and a view of the raw the DXT data.\r\n    let width = header[PVR_HEADER_WIDTH];\r\n    let height = header[PVR_HEADER_HEIGHT];\r\n    let levels = header[PVR_HEADER_MIPMAPCOUNT];\r\n    let dataOffset = header[PVR_HEADER_METADATA] + 52;\r\n    let pvrtcData = new Uint8Array(item.content.buffer, dataOffset);\r\n\r\n    let pvrAsset = {\r\n        _data: pvrtcData,\r\n        _compressed: true,\r\n\r\n        width: width,\r\n        height: height,\r\n    };\r\n\r\n    return pvrAsset;\r\n}\r\n\r\nvar defaultMap = {\r\n    // Images\r\n    'png' : loadImage,\r\n    'jpg' : loadImage,\r\n    'bmp' : loadImage,\r\n    'jpeg' : loadImage,\r\n    'gif' : loadImage,\r\n    'ico' : loadImage,\r\n    'tiff' : loadImage,\r\n    'webp' : loadImage,\r\n    'image' : loadImage,\r\n    'pvr' : loadCompressedTex,\r\n    'etc' : loadCompressedTex,\r\n\r\n    // Audio\r\n    'mp3' : loadAudioAsAsset,\r\n    'ogg' : loadAudioAsAsset,\r\n    'wav' : loadAudioAsAsset,\r\n    'm4a' : loadAudioAsAsset,\r\n\r\n    // json\r\n    'json' : loadJSON,\r\n    'ExportJson' : loadJSON,\r\n\r\n    // plist\r\n    'plist' : loadPlist,\r\n\r\n    // asset\r\n    'uuid' : loadUuid,\r\n    'prefab' : loadUuid,\r\n    'fire' : loadUuid,\r\n    'scene' : loadUuid,\r\n\r\n    // binary\r\n    'binary' : loadBinary,\r\n\r\n    // Font\r\n    'font' : fontLoader.loadFont,\r\n    'eot' : fontLoader.loadFont,\r\n    'ttf' : fontLoader.loadFont,\r\n    'woff' : fontLoader.loadFont,\r\n    'svg' : fontLoader.loadFont,\r\n    'ttc' : fontLoader.loadFont,\r\n\r\n    'default' : loadNothing\r\n};\r\n\r\nvar ID = 'Loader';\r\n\r\n/**\r\n * The loader pipe, it can load several types of files:\r\n * 1. Images\r\n * 2. JSON\r\n * 3. Plist\r\n * 4. Audio\r\n * 5. Font\r\n * 6. Cocos Creator scene\r\n * It will not interfere with items of unknown type.\r\n * You can pass custom supported types in the constructor.\r\n * @class Pipeline.Loader\r\n */\r\n/**\r\n * Constructor of Loader, you can pass custom supported types.\r\n *\r\n * @method constructor\r\n * @param {Object} extMap Custom supported types with corresponded handler\r\n * @example\r\n *var loader = new Loader({\r\n *    // This will match all url with `.scene` extension or all url with `scene` type\r\n *    'scene' : function (url, callback) {}\r\n *});\r\n */\r\nvar Loader = function (extMap) {\r\n    this.id = ID;\r\n    this.async = true;\r\n    this.pipeline = null;\r\n\r\n    this.extMap = js.mixin(extMap, defaultMap);\r\n};\r\nLoader.ID = ID;\r\n\r\n/**\r\n * Add custom supported types handler or modify existing type handler.\r\n * @method addHandlers\r\n * @param {Object} extMap Custom supported types with corresponded handler\r\n */\r\nLoader.prototype.addHandlers = function (extMap) {\r\n    this.extMap = js.mixin(this.extMap, extMap);\r\n};\r\n\r\nLoader.prototype.handle = function (item, callback) {\r\n    var loadFunc = this.extMap[item.type] || this.extMap['default'];\r\n    return loadFunc.call(this, item, callback);\r\n};\r\n\r\nPipeline.Loader = module.exports = Loader;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar CallbacksInvoker = require('../platform/callbacks-invoker');\r\nrequire('../utils/CCPath');\r\nvar js = require('../platform/js');\r\n\r\nvar _qid = (0|(Math.random()*998));\r\nvar _queues = js.createMap(true);\r\nvar _pool = [];\r\nvar _POOL_MAX_LENGTH = 10;\r\n\r\nvar ItemState = {\r\n    WORKING: 1,\r\n    COMPLETE: 2,\r\n    ERROR: 3\r\n};\r\n\r\nvar _queueDeps = js.createMap(true);\r\n\r\nfunction isIdValid (id) {\r\n    var realId = id.url || id;\r\n    return (typeof realId === 'string');\r\n}\r\n\r\nfunction _parseUrlParam (url) {\r\n    if (!url) return undefined;\r\n    var split = url.split('?');\r\n    if (!split || !split[0] || !split[1]) {\r\n        return undefined;\r\n    }\r\n    var urlParam = {};\r\n    var queries = split[1].split('&');\r\n    queries.forEach(function (item) {\r\n        var itemSplit = item.split('=');\r\n        urlParam[itemSplit[0]] = itemSplit[1];\r\n    });\r\n    return urlParam;\r\n}\r\nfunction createItem (id, queueId) {\r\n    var url = (typeof id === 'object') ? id.url : id;\r\n    var result = {\r\n        queueId: queueId,\r\n        id: url,\r\n        url: url, // real download url, maybe changed\r\n        rawUrl: undefined, // url used in scripts\r\n        urlParam: _parseUrlParam(url),\r\n        type: \"\",\r\n        error: null,\r\n        content: null,\r\n        complete: false,\r\n        states: {},\r\n        deps: null\r\n    };\r\n\r\n    if (typeof id === 'object') {\r\n        js.mixin(result, id);\r\n        if (id.skips) {\r\n            for (var i = 0; i < id.skips.length; i++) {\r\n                var skip = id.skips[i];\r\n                result.states[skip] = ItemState.COMPLETE;\r\n            }\r\n        }\r\n    }\r\n    result.rawUrl = result.url;\r\n    if (url && !result.type) {\r\n        result.type = cc.path.extname(url).toLowerCase().substr(1);\r\n    }\r\n    return result;\r\n}\r\n\r\nvar checkedIds = [];\r\nfunction checkCircleReference(owner, item, recursiveCall) {\r\n    if (!owner || !item) {\r\n        return false;\r\n    }\r\n    var result = false;\r\n    checkedIds.push(item.id);\r\n    if (item.deps) {\r\n        var i, deps = item.deps, subDep;\r\n        for (i = 0; i < deps.length; i++) {\r\n            subDep = deps[i];\r\n            if (subDep.id === owner.id) {\r\n                result = true;\r\n                break;\r\n            }\r\n            else if (checkedIds.indexOf(subDep.id) >= 0) {\r\n                continue;\r\n            }\r\n            else if (subDep.deps && checkCircleReference(owner, subDep, true)) {\r\n                result = true;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    if (!recursiveCall) {\r\n        checkedIds.length = 0;\r\n    }\r\n    return result;\r\n}\r\n\r\n/**\r\n * !#en\r\n * LoadingItems is the queue of items which can flow them into the loading pipeline.<br/>\r\n * Please don't construct it directly, use {{#crossLink \"LoadingItems.create\"}}cc.LoadingItems.create{{/crossLink}} instead, because we use an internal pool to recycle the queues.<br/>\r\n * It hold a map of items, each entry in the map is a url to object key value pair.<br/>\r\n * Each item always contains the following property:<br/>\r\n * - id: The identification of the item, usually it's identical to url<br/>\r\n * - url: The url <br/>\r\n * - type: The type, it's the extension name of the url by default, could be specified manually too.<br/>\r\n * - error: The error happened in pipeline will be stored in this property.<br/>\r\n * - content: The content processed by the pipeline, the final result will also be stored in this property.<br/>\r\n * - complete: The flag indicate whether the item is completed by the pipeline.<br/>\r\n * - states: An object stores the states of each pipe the item go through, the state can be: Pipeline.ItemState.WORKING | Pipeline.ItemState.ERROR | Pipeline.ItemState.COMPLETE<br/>\r\n * <br/>\r\n * Item can hold other custom properties.<br/>\r\n * Each LoadingItems object will be destroyed for recycle after onComplete callback<br/>\r\n * So please don't hold its reference for later usage, you can copy properties in it though.\r\n * !#zh\r\n * LoadingItems <br/>\r\n *  new  {{#crossLink \"LoadingItems.create\"}}cc.LoadingItems.create{{/crossLink}} \r\n *  map  map  url  key <br/>\r\n * <br/>\r\n * - id url <br/>\r\n * - url <br/>\r\n * - type:  URL <br/>\r\n * - errorpipeline <br/>\r\n * - content: pipeline <br/>\r\n * - complete pipeline <br/>\r\n * - states Pipeline.ItemState.WORKING | Pipeline.ItemState.ERROR | Pipeline.ItemState.COMPLETE<br/>\r\n * <br/>\r\n * <br/>\r\n *  LoadingItems  onComplete \r\n *\r\n * @class LoadingItems\r\n * @extends CallbacksInvoker\r\n */\r\nvar LoadingItems = function (pipeline, urlList, onProgress, onComplete) {\r\n    CallbacksInvoker.call(this);\r\n\r\n    this._id = ++_qid;\r\n\r\n    _queues[this._id] = this;\r\n\r\n    this._pipeline = pipeline;\r\n\r\n    this._errorUrls = [];\r\n\r\n    this._appending = false;\r\n\r\n    this._ownerQueue = null;\r\n\r\n    /**\r\n     * !#en This is a callback which will be invoked while an item flow out the pipeline.\r\n     * You can pass the callback function in LoadingItems.create or set it later.\r\n     * !#zh  item \r\n     * @method onProgress\r\n     * @param {Number} completedCount The number of the items that are already completed.\r\n     * @param {Number} totalCount The total number of the items.\r\n     * @param {Object} item The latest item which flow out the pipeline.\r\n     * @example\r\n     *  loadingItems.onProgress = function (completedCount, totalCount, item) {\r\n     *      var progress = (100 * completedCount / totalCount).toFixed(2);\r\n     *      cc.log(progress + '%');\r\n     *  }\r\n     */\r\n    this.onProgress = onProgress;\r\n\r\n    /**\r\n     * !#en This is a callback which will be invoked while all items is completed,\r\n     * You can pass the callback function in LoadingItems.create or set it later.\r\n     * !#zh \r\n     * @method onComplete\r\n     * @param {Array} errors All errored urls will be stored in this array, if no error happened, then it will be null\r\n     * @param {LoadingItems} items All items.\r\n     * @example\r\n     *  loadingItems.onComplete = function (errors, items) {\r\n     *      if (error)\r\n     *          cc.log('Completed with ' + errors.length + ' errors');\r\n     *      else\r\n     *          cc.log('Completed ' + items.totalCount + ' items');\r\n     *  }\r\n     */\r\n    this.onComplete = onComplete;\r\n\r\n    /**\r\n     * !#en The map of all items.\r\n     * !#zh \r\n     * @property map\r\n     * @type {Object}\r\n     */\r\n    this.map = js.createMap(true);\r\n\r\n    /**\r\n     * !#en The map of completed items.\r\n     * !#zh \r\n     * @property completed\r\n     * @type {Object}\r\n     */\r\n    this.completed = {};\r\n\r\n    /**\r\n     * !#en Total count of all items.\r\n     * !#zh \r\n     * @property totalCount\r\n     * @type {Number}\r\n     */\r\n    this.totalCount = 0;\r\n\r\n    /**\r\n     * !#en Total count of completed items.\r\n     * !#zh \r\n     * @property completedCount\r\n     * @type {Number}\r\n     */\r\n    this.completedCount = 0;\r\n\r\n    /**\r\n     * !#en Activated or not.\r\n     * !#zh \r\n     * @property active\r\n     * @type {Boolean}\r\n     */\r\n    if (this._pipeline) {\r\n        this.active = true;\r\n    }\r\n    else {\r\n        this.active = false;\r\n    }\r\n\r\n    if (urlList) {\r\n        if (urlList.length > 0) {\r\n            this.append(urlList);\r\n        }\r\n        else {\r\n            this.allComplete();\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * !#en The item states of the LoadingItems, its value could be LoadingItems.ItemState.WORKING | LoadingItems.ItemState.COMPLETET | LoadingItems.ItemState.ERROR\r\n * !#zh LoadingItems  LoadingItems.ItemState.WORKING | LoadingItems.ItemState.COMPLETET | LoadingItems.ItemState.ERROR\r\n * @enum LoadingItems.ItemState\r\n */\r\n\r\n/**\r\n * @property {Number} WORKING\r\n */\r\n\r\n/**\r\n * @property {Number} COMPLETET\r\n */\r\n\r\n/**\r\n * @property {Number} ERROR\r\n */\r\n\r\nLoadingItems.ItemState = new cc.Enum(ItemState);\r\n\r\n/**\r\n * @class LoadingItems\r\n * @extends CallbacksInvoker\r\n*/\r\n\r\n/**\r\n * !#en The constructor function of LoadingItems, this will use recycled LoadingItems in the internal pool if possible.\r\n * You can pass onProgress and onComplete callbacks to visualize the loading process.\r\n * !#zh LoadingItems  LoadingItems \r\n *  onProgress  onComplete \r\n * @method create\r\n * @static\r\n * @param {Pipeline} pipeline The pipeline to process the queue.\r\n * @param {Array} urlList The items array.\r\n * @param {Function} onProgress The progression callback, refer to {{#crossLink \"LoadingItems.onProgress\"}}{{/crossLink}}\r\n * @param {Function} onComplete The completion callback, refer to {{#crossLink \"LoadingItems.onComplete\"}}{{/crossLink}}\r\n * @return {LoadingItems} The LoadingItems queue object\r\n * @example\r\n *  cc.LoadingItems.create(cc.loader, ['a.png', 'b.plist'], function (completedCount, totalCount, item) {\r\n *      var progress = (100 * completedCount / totalCount).toFixed(2);\r\n *      cc.log(progress + '%');\r\n *  }, function (errors, items) {\r\n *      if (errors) {\r\n *          for (var i = 0; i < errors.length; ++i) {\r\n *              cc.log('Error url: ' + errors[i] + ', error: ' + items.getError(errors[i]));\r\n *          }\r\n *      }\r\n *      else {\r\n *          var result_a = items.getContent('a.png');\r\n *          // ...\r\n *      }\r\n *  })\r\n */\r\nLoadingItems.create = function (pipeline, urlList, onProgress, onComplete) {\r\n    if (onProgress === undefined) {\r\n        if (typeof urlList === 'function') {\r\n            onComplete = urlList;\r\n            urlList = onProgress = null;\r\n        }\r\n    }\r\n    else if (onComplete === undefined) {\r\n        if (typeof urlList === 'function') {\r\n            onComplete = onProgress;\r\n            onProgress = urlList;\r\n            urlList = null;\r\n        }\r\n        else {\r\n            onComplete = onProgress;\r\n            onProgress = null;\r\n        }\r\n    }\r\n\r\n    var queue = _pool.pop();\r\n    if (queue) {\r\n        queue._pipeline = pipeline;\r\n        queue.onProgress = onProgress;\r\n        queue.onComplete = onComplete;\r\n        _queues[queue._id] = queue;\r\n        if (queue._pipeline) {\r\n            queue.active = true;\r\n        }\r\n        if (urlList) {\r\n            queue.append(urlList);\r\n        }\r\n    }\r\n    else {\r\n        queue = new LoadingItems(pipeline, urlList, onProgress, onComplete);\r\n    }\r\n\r\n    return queue;\r\n};\r\n\r\n/**\r\n * !#en Retrieve the LoadingItems queue object for an item.\r\n * !#zh  item  LoadingItems \r\n * @method getQueue\r\n * @static\r\n * @param {Object} item The item to query\r\n * @return {LoadingItems} The LoadingItems queue object\r\n */\r\nLoadingItems.getQueue = function (item) {\r\n    return item.queueId ? _queues[item.queueId] : null;\r\n};\r\n\r\n/**\r\n * !#en Complete an item in the LoadingItems queue, please do not call this method unless you know what's happening.\r\n * !#zh  LoadingItems  item \r\n * @method itemComplete\r\n * @static\r\n * @param {Object} item The item which has completed\r\n */\r\nLoadingItems.itemComplete = function (item) {\r\n    var queue = _queues[item.queueId];\r\n    if (queue) {\r\n        // console.log('----- Completed by pipeline ' + item.id + ', rest: ' + (queue.totalCount - queue.completedCount-1));\r\n        queue.itemComplete(item.id);\r\n    }\r\n};\r\n\r\nLoadingItems.initQueueDeps = function (queue) {\r\n    var dep = _queueDeps[queue._id];\r\n    if (!dep) {\r\n        dep = _queueDeps[queue._id] = {\r\n            completed: [],\r\n            deps: []\r\n        };\r\n    }\r\n    else {\r\n        dep.completed.length = 0;\r\n        dep.deps.length = 0;\r\n    }\r\n};\r\n\r\nLoadingItems.registerQueueDep = function (owner, depId) {\r\n    var queueId = owner.queueId || owner;\r\n    if (!queueId) {\r\n        return false;\r\n    }\r\n    var queueDepList = _queueDeps[queueId];\r\n    // Owner is root queue\r\n    if (queueDepList) {\r\n        if (queueDepList.deps.indexOf(depId) === -1) {\r\n            queueDepList.deps.push(depId);\r\n        }\r\n    }\r\n    // Owner is an item in the intermediate queue\r\n    else if (owner.id) {\r\n        for (var id in _queueDeps) {\r\n            var queue = _queueDeps[id];\r\n            // Found root queue\r\n            if (queue.deps.indexOf(owner.id) !== -1) {\r\n                if (queue.deps.indexOf(depId) === -1) {\r\n                    queue.deps.push(depId);\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nLoadingItems.finishDep = function (depId) {\r\n    for (var id in _queueDeps) {\r\n        var queue = _queueDeps[id];\r\n        // Found root queue\r\n        if (queue.deps.indexOf(depId) !== -1 && queue.completed.indexOf(depId) === -1) {\r\n            queue.completed.push(depId);\r\n        }\r\n    }\r\n};\r\n\r\nvar proto = LoadingItems.prototype;\r\njs.mixin(proto, CallbacksInvoker.prototype);\r\n\r\n/**\r\n * !#en Add urls to the LoadingItems queue.\r\n * !#zh  LoadingItems \r\n * @method append\r\n * @param {Array} urlList The url list to be appended, the url can be object or string\r\n * @return {Array} The accepted url list, some invalid items could be refused.\r\n */\r\nproto.append = function (urlList, owner) {\r\n    if (!this.active) {\r\n        return [];\r\n    }\r\n    if (owner && !owner.deps) {\r\n        owner.deps = [];\r\n    }\r\n\r\n    this._appending = true;\r\n    var accepted = [], i, url, item;\r\n    for (i = 0; i < urlList.length; ++i) {\r\n        url = urlList[i];\r\n\r\n        // Already queued in another items queue, url is actually the item\r\n        if (url.queueId && !this.map[url.id]) {\r\n            this.map[url.id] = url;\r\n            // Register item deps for circle reference check\r\n            owner && owner.deps.push(url);\r\n            // Queued and completed or Owner circle referenced by dependency\r\n            if (url.complete || checkCircleReference(owner, url)) {\r\n                this.totalCount++;\r\n                // console.log('----- Completed already or circle referenced ' + url.id + ', rest: ' + (this.totalCount - this.completedCount-1));\r\n                this.itemComplete(url.id);\r\n                continue;\r\n            }\r\n            // Not completed yet, should wait it\r\n            else {\r\n                var self = this;\r\n                var queue = _queues[url.queueId];\r\n                if (queue) {\r\n                    this.totalCount++;\r\n                    LoadingItems.registerQueueDep(owner || this._id, url.id);\r\n                    // console.log('+++++ Waited ' + url.id);\r\n                    queue.addListener(url.id, function (item) {\r\n                        // console.log('----- Completed by waiting ' + item.id + ', rest: ' + (self.totalCount - self.completedCount-1));\r\n                        self.itemComplete(item.id);\r\n                    });\r\n                }\r\n                continue;\r\n            }\r\n        }\r\n        // Queue new items\r\n        if (isIdValid(url)) {\r\n            item = createItem(url, this._id);\r\n            var key = item.id;\r\n            // No duplicated url\r\n            if (!this.map[key]) {\r\n                this.map[key] = item;\r\n                this.totalCount++;\r\n                // Register item deps for circle reference check\r\n                owner && owner.deps.push(item);\r\n                LoadingItems.registerQueueDep(owner || this._id, key);\r\n                accepted.push(item);\r\n                // console.log('+++++ Appended ' + item.id);\r\n            }\r\n        }\r\n    }\r\n    this._appending = false;\r\n\r\n    // Manually complete\r\n    if (this.completedCount === this.totalCount) {\r\n        // console.log('===== All Completed ');\r\n        this.allComplete();\r\n    }\r\n    else {\r\n        this._pipeline.flowIn(accepted);\r\n    }\r\n    return accepted;\r\n};\r\n\r\nproto._childOnProgress = function (item) {\r\n    if (this.onProgress) {\r\n        var dep = _queueDeps[this._id];\r\n        this.onProgress(dep ? dep.completed.length : this.completedCount, dep ? dep.deps.length : this.totalCount, item);\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Complete a LoadingItems queue, please do not call this method unless you know what's happening.\r\n * !#zh  LoadingItems \r\n * @method allComplete\r\n */\r\nproto.allComplete = function () {\r\n    var errors = this._errorUrls.length === 0 ? null : this._errorUrls;\r\n    if (this.onComplete) {\r\n        this.onComplete(errors, this);\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Check whether all items are completed.\r\n * !#zh \r\n * @method isCompleted\r\n * @return {Boolean}\r\n */\r\nproto.isCompleted = function () {\r\n    return this.completedCount >= this.totalCount;\r\n};\r\n\r\n/**\r\n * !#en Check whether an item is completed.\r\n * !#zh  id \r\n * @method isItemCompleted\r\n * @param {String} id The item's id.\r\n * @return {Boolean}\r\n */\r\nproto.isItemCompleted = function (id) {\r\n    return !!this.completed[id];\r\n};\r\n\r\n/**\r\n * !#en Check whether an item exists.\r\n * !#zh  id \r\n * @method exists\r\n * @param {String} id The item's id.\r\n * @return {Boolean}\r\n */\r\nproto.exists = function (id) {\r\n    return !!this.map[id];\r\n};\r\n\r\n/**\r\n * !#en Returns the content of an internal item.\r\n * !#zh  id \r\n * @method getContent\r\n * @param {String} id The item's id.\r\n * @return {Object}\r\n */\r\nproto.getContent = function (id) {\r\n    var item = this.map[id];\r\n    var ret = null;\r\n    if (item) {\r\n        if (item.content) {\r\n            ret = item.content;\r\n        }\r\n        else if (item.alias) {\r\n            ret = item.alias.content;\r\n        }\r\n    }\r\n\r\n    return ret;\r\n};\r\n\r\n/**\r\n * !#en Returns the error of an internal item.\r\n * !#zh  id \r\n * @method getError\r\n * @param {String} id The item's id.\r\n * @return {Object}\r\n */\r\nproto.getError = function (id) {\r\n    var item = this.map[id];\r\n    var ret = null;\r\n    if (item) {\r\n        if (item.error) {\r\n            ret = item.error;\r\n        } else if (item.alias) {\r\n            ret = item.alias.error;\r\n        }\r\n    }\r\n\r\n    return ret;\r\n};\r\n\r\n/**\r\n * !#en Add a listener for an item, the callback will be invoked when the item is completed.\r\n * !#zh  key \r\n * @method addListener\r\n * @param {String} key\r\n * @param {Function} callback - can be null\r\n * @param {Object} target - can be null\r\n * @return {Boolean} whether the key is new\r\n */\r\nproto.addListener = CallbacksInvoker.prototype.add;\r\n\r\n/**\r\n * !#en\r\n * Check if the specified key has any registered callback. \r\n * If a callback is also specified, it will only return true if the callback is registered.\r\n * !#zh\r\n * \r\n *  true\r\n * @method hasListener\r\n * @param {String} key\r\n * @param {Function} [callback]\r\n * @param {Object} [target]\r\n * @return {Boolean}\r\n */\r\nproto.hasListener = CallbacksInvoker.prototype.has;\r\n\r\n/**\r\n * !#en\r\n * Removes a listener. \r\n * It will only remove when key, callback, target all match correctly.\r\n * !#zh\r\n * \r\n *  key, callback, target \r\n * @method remove\r\n * @param {String} key\r\n * @param {Function} callback\r\n * @param {Object} target\r\n * @return {Boolean} removed\r\n */\r\nproto.removeListener = CallbacksInvoker.prototype.remove;\r\n\r\n/**\r\n * !#en\r\n * Removes all callbacks registered in a certain event\r\n * type or all callbacks registered with a certain target.\r\n * !#zh \r\n * @method removeAllListeners\r\n * @param {String|Object} key - The event key to be removed or the target to be removed\r\n */\r\nproto.removeAllListeners = CallbacksInvoker.prototype.removeAll;\r\n\r\n/**\r\n * !#en Remove an item, can only remove completed item, ongoing item can not be removed.\r\n * !#zh \r\n * @param {String} url\r\n */\r\nproto.removeItem = function (url) {\r\n    var item = this.map[url];\r\n    if (!item) return;\r\n\r\n    if (!this.completed[item.alias || url]) return;\r\n\r\n    delete this.completed[url];\r\n    delete this.map[url];\r\n    if (item.alias) {\r\n        delete this.completed[item.alias.id];\r\n        delete this.map[item.alias.id];\r\n    }\r\n\r\n    this.completedCount--;\r\n    this.totalCount--;\r\n};\r\n\r\n/**\r\n * !#en Complete an item in the LoadingItems queue, please do not call this method unless you know what's happening.\r\n * !#zh  LoadingItems  item \r\n * @method itemComplete\r\n * @param {String} id The item url\r\n */\r\nproto.itemComplete = function (id) {\r\n    var item = this.map[id];\r\n    if (!item) {\r\n        return;\r\n    }\r\n\r\n    // Register or unregister errors\r\n    var errorListId = this._errorUrls.indexOf(id);\r\n    if (item.error && errorListId === -1) {\r\n        this._errorUrls.push(id);\r\n    }\r\n    else if (!item.error && errorListId !== -1) {\r\n        this._errorUrls.splice(errorListId, 1);\r\n    }\r\n\r\n    this.completed[id] = item;\r\n    this.completedCount++;\r\n\r\n    LoadingItems.finishDep(item.id);\r\n    if (this.onProgress) {\r\n        var dep = _queueDeps[this._id];\r\n        this.onProgress(dep ? dep.completed.length : this.completedCount, dep ? dep.deps.length : this.totalCount, item);\r\n    }\r\n\r\n    this.invoke(id, item);\r\n    this.removeAll(id);\r\n\r\n    // All completed\r\n    if (!this._appending && this.completedCount >= this.totalCount) {\r\n        // console.log('===== All Completed ');\r\n        this.allComplete();\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Destroy the LoadingItems queue, the queue object won't be garbage collected, it will be recycled, so every after destroy is not reliable.\r\n * !#zh  LoadingItems \r\n * @method destroy\r\n */\r\nproto.destroy = function () {\r\n    this.active = false;\r\n    this._appending = false;\r\n    this._pipeline = null;\r\n    this._ownerQueue = null;\r\n    this._errorUrls.length = 0;\r\n    this.onProgress = null;\r\n    this.onComplete = null;\r\n\r\n    this.map = js.createMap(true);\r\n    this.completed = {};\r\n\r\n    this.totalCount = 0;\r\n    this.completedCount = 0;\r\n\r\n    // Reinitialize CallbacksInvoker, generate three new objects, could be improved\r\n    CallbacksInvoker.call(this);\r\n    \r\n    if (_queueDeps[this._id]) {\r\n        _queueDeps[this._id].completed.length = 0;\r\n        _queueDeps[this._id].deps.length = 0;\r\n    }\r\n    delete _queues[this._id];\r\n    delete _queueDeps[this._id];\r\n\r\n    if (_pool.indexOf(this) === -1 && _pool.length < _POOL_MAX_LENGTH) {\r\n        _pool.push(this);\r\n    }\r\n};\r\n\r\ncc.LoadingItems = module.exports = LoadingItems;\r\n","/****************************************************************************\r\n Copyright (c) 2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar Pipeline = require('./pipeline');\r\n\r\nconst ID = 'MD5Pipe';\r\nconst ExtnameRegex = /(\\.[^.\\n\\\\/]*)$/;\r\nconst UuidRegex = /.*[/\\\\][0-9a-fA-F]{2}[/\\\\]([0-9a-fA-F-]{8,})/;\r\n\r\nfunction getUuidFromURL (url) {\r\n    var matches = url.match(UuidRegex);\r\n    if (matches) {\r\n        return matches[1];\r\n    }\r\n    return \"\";\r\n}\r\n\r\nvar MD5Pipe = function (md5AssetsMap, md5NativeAssetsMap, libraryBase) {\r\n    this.id = ID;\r\n    this.async = false;\r\n    this.pipeline = null;\r\n    this.md5AssetsMap = md5AssetsMap;\r\n    this.md5NativeAssetsMap = md5NativeAssetsMap;\r\n    this.libraryBase = libraryBase;\r\n};\r\nMD5Pipe.ID = ID;\r\n\r\nMD5Pipe.prototype.handle = function(item) {\r\n    let hashPatchInFolder = false;\r\n    // HACK: explicitly use folder md5 for ttf files\r\n    if (item.type === 'ttf') {\r\n        hashPatchInFolder = true;\r\n    }\r\n    item.url = this.transformURL(item.url, hashPatchInFolder);\r\n    return item;\r\n};\r\n\r\nMD5Pipe.prototype.transformURL = function (url, hashPatchInFolder) {\r\n    var uuid = getUuidFromURL(url);\r\n    if (uuid) {\r\n        var isNativeAsset = !url.startsWith(this.libraryBase);\r\n        var map = isNativeAsset ? this.md5NativeAssetsMap : this.md5AssetsMap;\r\n        let hashValue = map[uuid];\r\n        if (hashValue) {\r\n            if (hashPatchInFolder) {\r\n                var dirname = cc.path.dirname(url);\r\n                var basename = cc.path.basename(url);\r\n                url = `${dirname}.${hashValue}/${basename}`;\r\n            } else {\r\n                var matched = false;\r\n                url = url.replace(ExtnameRegex, (function(match, p1) {\r\n                    matched = true;\r\n                    return \".\" + hashValue + p1;\r\n                }));\r\n                if (!matched) {\r\n                    url = url + \".\" + hashValue;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return url;\r\n};\r\n\r\n\r\nPipeline.MD5Pipe = module.exports = MD5Pipe;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar Unpackers = require('./unpackers');\r\nvar pushToMap = require('../utils/misc').pushToMap;\r\n\r\n// when more than one package contains the required asset,\r\n// choose to load from the package with the largest state value.\r\nvar PackState = {\r\n    Invalid: 0,\r\n    Removed: 1,\r\n    Downloading: 2,\r\n    Loaded: 3,\r\n};\r\n\r\nfunction UnpackerData () {\r\n    this.unpacker = null;\r\n    this.state = PackState.Invalid;\r\n}\r\n\r\n// {assetUuid: packUuid|[packUuid]}\r\n// If value is array of packUuid, then the first one will be prioritized for download,\r\n// so the smallest pack must be at the beginning of the array.\r\nvar uuidToPack = {};\r\n\r\n// {packUuid: assetIndices}\r\nvar packIndices = {};\r\n\r\n// {packUuid: UnpackerData}\r\n// We have to cache all packs in global because for now there's no operation context in loader.\r\nvar globalUnpackers = {};\r\n\r\n\r\nfunction error (uuid, packUuid) {\r\n    return new Error('Can not retrieve ' + uuid + ' from packer ' + packUuid);\r\n}\r\n\r\nmodule.exports = {\r\n    initPacks: function (packs) {\r\n        packIndices = packs;\r\n        for (var packUuid in packs) {\r\n            var uuids = packs[packUuid];\r\n            for (var i = 0; i < uuids.length; i++) {\r\n                var uuid = uuids[i];\r\n                // the smallest pack must be at the beginning of the array to download more first\r\n                var pushFront = uuids.length === 1;\r\n                pushToMap(uuidToPack, uuid, packUuid, pushFront);\r\n            }\r\n        }\r\n    },\r\n\r\n    _loadNewPack: function (uuid, packUuid, callback) {\r\n        var self = this;\r\n        var packUrl = cc.AssetLibrary.getLibUrlNoExt(packUuid) + '.json';\r\n        cc.loader.load({ url: packUrl, ignoreMaxConcurrency: true }, function (err, packJson) {\r\n            if (err) {\r\n                cc.errorID(4916, uuid);\r\n                return callback(err);\r\n            }\r\n            var res = self._doLoadNewPack(uuid, packUuid, packJson);\r\n            if (res) {\r\n                callback(null, res);\r\n            }\r\n            else {\r\n                callback(error(uuid, packUuid));\r\n            }\r\n        });\r\n    },\r\n\r\n    _doPreload (packUuid, packJson) {\r\n        var unpackerData = globalUnpackers[packUuid];\r\n        if (!unpackerData) {\r\n            unpackerData = globalUnpackers[packUuid] = new UnpackerData();\r\n            unpackerData.state = PackState.Downloading;\r\n        }\r\n        if (unpackerData.state !== PackState.Loaded) {\r\n            unpackerData.unpacker = new Unpackers.JsonUnpacker();\r\n            unpackerData.unpacker.load(packIndices[packUuid], packJson);\r\n            unpackerData.state = PackState.Loaded;\r\n        }\r\n    },\r\n\r\n    _doLoadNewPack: function (uuid, packUuid, packedJson) {\r\n        var unpackerData = globalUnpackers[packUuid];\r\n        // double check cache after load\r\n        if (unpackerData.state !== PackState.Loaded) {\r\n            // init unpacker\r\n            if (typeof packedJson === 'string') {\r\n                packedJson = JSON.parse(packedJson);\r\n            }\r\n            if (Array.isArray(packedJson)) {\r\n                unpackerData.unpacker = new Unpackers.JsonUnpacker();\r\n            }\r\n            else if (packedJson.type === Unpackers.TextureUnpacker.ID) {\r\n                unpackerData.unpacker = new Unpackers.TextureUnpacker();\r\n            }\r\n            unpackerData.unpacker.load(packIndices[packUuid], packedJson);\r\n            unpackerData.state = PackState.Loaded;\r\n        }\r\n\r\n        return unpackerData.unpacker.retrieve(uuid);\r\n    },\r\n\r\n    _selectLoadedPack: function (packUuids) {\r\n        var existsPackState = PackState.Invalid;\r\n        var existsPackUuid = '';\r\n        for (var i = 0; i < packUuids.length; i++) {\r\n            var packUuid = packUuids[i];\r\n            var unpackerData = globalUnpackers[packUuid];\r\n            if (unpackerData) {\r\n                var state = unpackerData.state;\r\n                if (state === PackState.Loaded) {\r\n                    return packUuid;\r\n                }\r\n                else if (state > existsPackState) {     // load from the package with the largest state value,\r\n                    existsPackState = state;\r\n                    existsPackUuid = packUuid;\r\n                }\r\n            }\r\n        }\r\n                                                        // otherwise the first one (smallest one) will be load\r\n        return existsPackState !== PackState.Invalid ? existsPackUuid : packUuids[0];\r\n    },\r\n\r\n    /**\r\n     * @returns {Object} When returns undefined, the requested item is not in any pack, when returns null, the item is in a loading pack, when item json exists, it will return the result directly.\r\n     */\r\n    load: function (item, callback) {\r\n        var uuid = item.uuid;\r\n        var packUuid = uuidToPack[uuid];\r\n        if (!packUuid) {\r\n            // Return undefined to let caller know it's not recognized.\r\n            // We don't use false here because changing return value type may cause jit fail, \r\n            // though return undefined may have the same issue.\r\n            return;\r\n        }\r\n\r\n        if (Array.isArray(packUuid)) {\r\n            packUuid = this._selectLoadedPack(packUuid);\r\n        }\r\n\r\n        var unpackerData = globalUnpackers[packUuid];\r\n        if (unpackerData && unpackerData.state === PackState.Loaded) {\r\n            // ensure async\r\n            var json = unpackerData.unpacker.retrieve(uuid);\r\n            if (json) {\r\n                return json;\r\n            }\r\n            else {\r\n                return error(uuid, packUuid);\r\n            }\r\n        }\r\n        else {\r\n            if (!unpackerData) {\r\n                if (!CC_TEST) {\r\n                    console.log('Create unpacker %s for %s', packUuid, uuid);\r\n                }\r\n                unpackerData = globalUnpackers[packUuid] = new UnpackerData();\r\n                unpackerData.state = PackState.Downloading;\r\n            }\r\n            this._loadNewPack(uuid, packUuid, callback);\r\n        }\r\n        // Return null to let caller know it's loading asynchronously\r\n        return null;\r\n    }\r\n};\r\n\r\nif (CC_TEST) {\r\n    cc._Test.PackDownloader = module.exports;\r\n    cc._Test.PackDownloader.reset = function () {\r\n        uuidToPack = {};\r\n        packIndices = {};\r\n        globalUnpackers = {};\r\n    };\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('../platform/js');\r\nvar LoadingItems = require('./loading-items');\r\nvar ItemState = LoadingItems.ItemState;\r\n\r\nfunction flow (pipe, item) {\r\n    var pipeId = pipe.id;\r\n    var itemState = item.states[pipeId];\r\n    var next = pipe.next;\r\n    var pipeline = pipe.pipeline;\r\n\r\n    if (item.error || itemState === ItemState.WORKING || itemState === ItemState.ERROR) {\r\n        return;\r\n    }\r\n    else if (itemState === ItemState.COMPLETE) {\r\n        if (next) {\r\n            flow(next, item);\r\n        }\r\n        else {\r\n            pipeline.flowOut(item);\r\n        }\r\n    }\r\n    else {\r\n        item.states[pipeId] = ItemState.WORKING;\r\n        // Pass async callback in case it's a async call\r\n        var result = pipe.handle(item, function (err, result) {\r\n            if (err) {\r\n                item.error = err;\r\n                item.states[pipeId] = ItemState.ERROR;\r\n                pipeline.flowOut(item);\r\n            }\r\n            else {\r\n                // Result can be null, then it means no result for this pipe\r\n                if (result) {\r\n                    item.content = result;\r\n                }\r\n                item.states[pipeId] = ItemState.COMPLETE;\r\n                if (next) {\r\n                    flow(next, item);\r\n                }\r\n                else {\r\n                    pipeline.flowOut(item);\r\n                }\r\n            }\r\n        });\r\n        // If result exists (not undefined, null is ok), then we go with sync call flow\r\n        if (result instanceof Error) {\r\n            item.error = result;\r\n            item.states[pipeId] = ItemState.ERROR;\r\n            pipeline.flowOut(item);\r\n        }\r\n        else if (result !== undefined) {\r\n            // Result can be null, then it means no result for this pipe\r\n            if (result !== null) {\r\n                item.content = result;\r\n            }\r\n            item.states[pipeId] = ItemState.COMPLETE;\r\n            if (next) {\r\n                flow(next, item);\r\n            }\r\n            else {\r\n                pipeline.flowOut(item);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * !#en\r\n * A pipeline describes a sequence of manipulations, each manipulation is called a pipe.<br/>\r\n * It's designed for loading process. so items should be urls, and the url will be the identity of each item during the process.<br/>\r\n * A list of items can flow in the pipeline and it will output the results of all pipes.<br/>\r\n * They flow in the pipeline like water in tubes, they go through pipe by pipe separately.<br/>\r\n * Finally all items will flow out the pipeline and the process is finished.\r\n *\r\n * !#zh\r\n * pipeline  pipe<br/>\r\n *  item  url url  item <br/>\r\n *  item  pipeline  pipe <br/>\r\n *  pipeline  pipe<br/>\r\n *  pipeline \r\n * @class Pipeline\r\n */\r\n/**\r\n * !#en\r\n * Constructor, pass an array of pipes to construct a new Pipeline,\r\n * the pipes will be chained in the given order.<br/>\r\n * A pipe is an object which must contain an `id` in string and a `handle` function,\r\n * the id must be unique in the pipeline.<br/>\r\n * It can also include `async` property to identify whether it's an asynchronous process.\r\n * !#zh\r\n *  pipe  pipelinepipes <br/>\r\n *  pipe  id  handle  pipeline  id <br/>\r\n *  async \r\n *\r\n * @method constructor\r\n * @param {Array} pipes\r\n * @example\r\n *  var pipeline = new Pipeline([\r\n *      {\r\n *          id: 'Downloader',\r\n *          handle: function (item, callback) {},\r\n *          async: true\r\n *      },\r\n *      {id: 'Parser', handle: function (item) {}, async: false}\r\n *  ]);\r\n */\r\nvar Pipeline = function (pipes) {\r\n    this._pipes = pipes;\r\n    this._cache = js.createMap(true);\r\n\r\n    for (var i = 0; i < pipes.length; ++i) {\r\n        var pipe = pipes[i];\r\n        // Must have handle and id, handle for flow, id for state flag\r\n        if (!pipe.handle || !pipe.id) {\r\n            continue;\r\n        }\r\n\r\n        pipe.pipeline = this;\r\n        pipe.next = i < pipes.length - 1 ? pipes[i+1] : null;\r\n    }\r\n};\r\n\r\nPipeline.ItemState = ItemState;\r\n\r\nvar proto = Pipeline.prototype;\r\n\r\n/**\r\n * !#en\r\n * Insert a new pipe at the given index of the pipeline. <br/>\r\n * A pipe must contain an `id` in string and a `handle` function, the id must be unique in the pipeline.\r\n * !#zh\r\n *  pipe<br/>\r\n *  pipe  id  handle  id  pipeline \r\n * @method insertPipe\r\n * @param {Object} pipe The pipe to be inserted\r\n * @param {Number} index The index to insert\r\n */\r\nproto.insertPipe = function (pipe, index) {\r\n    // Must have handle and id, handle for flow, id for state flag\r\n    if (!pipe.handle || !pipe.id || index > this._pipes.length) {\r\n        cc.warnID(4921);\r\n        return;\r\n    }\r\n\r\n    if (this._pipes.indexOf(pipe) > 0) {\r\n        cc.warnID(4922);\r\n        return;\r\n    }\r\n\r\n    pipe.pipeline = this;\r\n\r\n    var nextPipe = null;\r\n    if (index < this._pipes.length) {\r\n        nextPipe = this._pipes[index];\r\n    }\r\n\r\n    var previousPipe = null;\r\n    if (index > 0) {\r\n        previousPipe = this._pipes[index-1];\r\n    }\r\n\r\n    if (previousPipe) {\r\n        previousPipe.next = pipe;\r\n    }\r\n    pipe.next = nextPipe;\r\n\r\n    this._pipes.splice(index, 0, pipe);\r\n};\r\n\r\n/**\r\n * !en\r\n * Insert a pipe to the end of an existing pipe. The existing pipe must be a valid pipe in the pipeline.\r\n * !zh\r\n *  pipeline  pipe  pipe\r\n * @method insertPipeAfter\r\n * @param {Object} refPipe An existing pipe in the pipeline.\r\n * @param {Object} newPipe The pipe to be inserted.\r\n */\r\nproto.insertPipeAfter = function (refPipe, newPipe)  {\r\n    var index = this._pipes.indexOf(refPipe);\r\n    if (index < 0) {\r\n        return;\r\n    }\r\n    this.insertPipe(newPipe, index+1);\r\n};\r\n\r\n/**\r\n * !#en\r\n * Add a new pipe at the end of the pipeline. <br/>\r\n * A pipe must contain an `id` in string and a `handle` function, the id must be unique in the pipeline.\r\n * !#zh\r\n *  pipe  pipeline  <br/>\r\n *  pipe  id  handle  id  pipeline \r\n * @method appendPipe\r\n * @param {Object} pipe The pipe to be appended\r\n */\r\nproto.appendPipe = function (pipe) {\r\n    // Must have handle and id, handle for flow, id for state flag\r\n    if (!pipe.handle || !pipe.id) {\r\n        return;\r\n    }\r\n\r\n    pipe.pipeline = this;\r\n    pipe.next = null;\r\n    if (this._pipes.length > 0) {\r\n        this._pipes[this._pipes.length - 1].next = pipe;\r\n    }\r\n    this._pipes.push(pipe);\r\n};\r\n\r\n/**\r\n * !#en\r\n * Let new items flow into the pipeline. <br/>\r\n * Each item can be a simple url string or an object,\r\n * if it's an object, it must contain `id` property. <br/>\r\n * You can specify its type by `type` property, by default, the type is the extension name in url. <br/>\r\n * By adding a `skips` property including pipe ids, you can skip these pipe. <br/>\r\n * The object can contain any supplementary property as you want. <br/>\r\n * !#zh\r\n *  item  pipeline <br/>\r\n *  item  url ,\r\n *  id <br/>\r\n *  type  url <br/>\r\n *   skips  item  skips  pipe<br/>\r\n * \r\n * @method flowIn\r\n * @param {Array} items\r\n * @example\r\n *  pipeline.flowIn([\r\n *      'res/Background.png',\r\n *      {\r\n *          id: 'res/scene.json',\r\n *          type: 'scene',\r\n *          name: 'scene',\r\n *          skips: ['Downloader']\r\n *      }\r\n *  ]);\r\n */\r\nproto.flowIn = function (items) {\r\n    var i, pipe = this._pipes[0], item;\r\n    if (pipe) {\r\n        // Cache all items first, in case synchronous loading flow same item repeatly\r\n        for (i = 0; i < items.length; i++) {\r\n            item = items[i];\r\n            this._cache[item.id] = item;\r\n        }\r\n        for (i = 0; i < items.length; i++) {\r\n            item = items[i];\r\n            flow(pipe, item);\r\n        }\r\n    }\r\n    else {\r\n        for (i = 0; i < items.length; i++) {\r\n            this.flowOut(items[i]);\r\n        }\r\n    }\r\n};\r\n\r\n/*\r\n * !#en\r\n * Let new items flow into the pipeline and give a callback when the list of items are all completed. <br/>\r\n * This is for loading dependencies for an existing item in flow, usually used in a pipe logic. <br/>\r\n * For example, we have a loader for scene configuration file in JSON, the scene will only be fully loaded  <br/>\r\n * after all its dependencies are loaded, then you will need to use function to flow in all dependencies  <br/>\r\n * found in the configuration file, and finish the loader pipe only after all dependencies are loaded (in the callback).\r\n * !#zh\r\n *  items  pipeline  item <br/>\r\n *  API <br/>\r\n * <br/>\r\n *  JSON \r\n * @method flowInDeps\r\n * @deprecated since v1.3\r\n * @param {Array} urlList\r\n * @param {Function} callback\r\n * @return {Array} Items accepted by the pipeline\r\n */\r\nproto.flowInDeps = function (owner, urlList, callback) {\r\n    var deps = LoadingItems.create(this, function (errors, items) {\r\n        callback(errors, items);\r\n        items.destroy();\r\n    });\r\n    return deps.append(urlList, owner);\r\n};\r\n\r\nproto.flowOut = function (item) {\r\n    if (item.error) {\r\n        delete this._cache[item.id];\r\n    }\r\n    else if (!this._cache[item.id]) {\r\n        this._cache[item.id] = item;\r\n    }\r\n    item.complete = true;\r\n    LoadingItems.itemComplete(item);\r\n};\r\n\r\n/**\r\n * !#en\r\n * Copy the item states from one source item to all destination items. <br/>\r\n * It's quite useful when a pipe generate new items from one source item,<br/>\r\n * then you should flowIn these generated items into pipeline, <br/>\r\n * but you probably want them to skip all pipes the source item already go through,<br/>\r\n * you can achieve it with this API. <br/>\r\n * <br/>\r\n * For example, an unzip pipe will generate more items, but you won't want them to pass unzip or download pipe again.\r\n * !#zh\r\n *  item  item  pipe  pipe<br/>\r\n *  item  items <br/>\r\n *  pipeline item  pipe<br/>\r\n *  item  pipes<br/>\r\n *  API\r\n * @method copyItemStates\r\n * @param {Object} srcItem The source item\r\n * @param {Array|Object} dstItems A single destination item or an array of destination items\r\n */\r\nproto.copyItemStates = function (srcItem, dstItems) {\r\n    if (!(dstItems instanceof Array)) {\r\n        dstItems.states = srcItem.states;\r\n        return;\r\n    }\r\n    for (var i = 0; i < dstItems.length; ++i) {\r\n        dstItems[i].states = srcItem.states;\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Returns an item in pipeline.\r\n * !#zh  id  item\r\n * @method getItem\r\n * @param {Object} id The id of the item\r\n * @return {Object}\r\n */\r\nproto.getItem = function (id) {\r\n    var item = this._cache[id];\r\n\r\n    if (!item)\r\n        return item;\r\n\r\n    // downloader.js downloadUuid\r\n    if (item.alias)\r\n        item = item.alias;\r\n\r\n    return item;\r\n};\r\n\r\n/**\r\n * !#en Removes an completed item in pipeline.\r\n * It will only remove the cache in the pipeline or loader, its dependencies won't be released.\r\n * cc.loader provided another method to completely cleanup the resource and its dependencies,\r\n * please refer to {{#crossLink \"loader/release:method\"}}cc.loader.release{{/crossLink}}\r\n * !#zh  item\r\n *  pipeline  loader \r\n * cc.loader  {{#crossLink \"loader/release:method\"}}cc.loader.release{{/crossLink}}\r\n * @method removeItem\r\n * @param {Object} id The id of the item\r\n * @return {Boolean} succeed or not\r\n */\r\nproto.removeItem = function (id) {\r\n    var removed = this._cache[id];\r\n    if (removed && removed.complete) {\r\n        delete this._cache[id];\r\n    }\r\n    return removed;\r\n};\r\n\r\n/**\r\n * !#en Clear the current pipeline, this function will clean up the items.\r\n * !#zh  pipeline items\r\n * @method clear\r\n */\r\nproto.clear = function () {\r\n    for (var id in this._cache) {\r\n        var item = this._cache[id];\r\n        delete this._cache[id];\r\n        if (!item.complete) {\r\n            item.error = new Error('Canceled manually');\r\n            this.flowOut(item);\r\n        }\r\n    }\r\n};\r\n\r\ncc.Pipeline = module.exports = Pipeline;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar urlAppendTimestamp = require('./utils').urlAppendTimestamp;\r\n\r\nmodule.exports = function (item, callback) {\r\n    var url = item.url;\r\n    url = urlAppendTimestamp(url);\r\n\r\n    var xhr = cc.loader.getXMLHttpRequest(),\r\n        errInfo = 'Load text file failed: ' + url;\r\n    xhr.open('GET', url, true);\r\n    if (xhr.overrideMimeType) xhr.overrideMimeType('text\\/plain; charset=utf-8');\r\n    xhr.onload = function () {\r\n        if (xhr.readyState === 4) {\r\n            if (xhr.status === 200 || xhr.status === 0) {\r\n                callback(null, xhr.responseText);\r\n            }\r\n            else {\r\n                callback({status:xhr.status, errorMessage:errInfo + '(wrong status)'});\r\n            }\r\n        }\r\n        else {\r\n            callback({status:xhr.status, errorMessage:errInfo + '(wrong readyState)'});\r\n        }\r\n    };\r\n    xhr.onerror = function(){\r\n        callback({status:xhr.status, errorMessage:errInfo + '(error)'});\r\n    };\r\n    xhr.ontimeout = function(){\r\n        callback({status:xhr.status, errorMessage:errInfo + '(time out)'});\r\n    };\r\n    xhr.send(null);\r\n};","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar Texture2D = require('../assets/CCTexture2D');\r\nvar js = require('../platform/js');\r\n\r\nfunction JsonUnpacker () {\r\n    this.jsons = {};\r\n}\r\n\r\n/**\r\n * @param {String[]} indices\r\n * @param {Object[]} packedJson\r\n */\r\nJsonUnpacker.prototype.load = function (indices, packedJson) {\r\n    if (packedJson.length !== indices.length) {\r\n        cc.errorID(4915);\r\n    }\r\n    for (var i = 0; i < indices.length; i++) {\r\n        var key = indices[i];\r\n        var json = packedJson[i];\r\n        this.jsons[key] = json;\r\n    }\r\n};\r\n\r\nJsonUnpacker.prototype.retrieve = function (key) {\r\n    return this.jsons[key] || null;\r\n};\r\n\r\n\r\nfunction TextureUnpacker () {\r\n    this.contents = {};\r\n}\r\nTextureUnpacker.ID = js._getClassId(Texture2D);\r\n\r\n/**\r\n * @param {String[]} indices\r\n * @param {Object[]} packedJson\r\n */\r\nTextureUnpacker.prototype.load = function (indices, packedJson) {\r\n    var datas = packedJson.data.split('|');\r\n    if (datas.length !== indices.length) {\r\n        cc.errorID(4915);\r\n    }\r\n    for (var i = 0; i < indices.length; i++) {\r\n        this.contents[indices[i]] = datas[i];\r\n    }\r\n};\r\n\r\nTextureUnpacker.prototype.retrieve = function (key) {\r\n    var content = this.contents[key];\r\n    if (content) {\r\n        return {\r\n            __type__: TextureUnpacker.ID,\r\n            content: content\r\n        };\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n};\r\n\r\nif (CC_TEST) {\r\n    cc._Test.JsonUnpacker = JsonUnpacker;\r\n    cc._Test.TextureUnpacker = TextureUnpacker;\r\n}\r\n\r\nmodule.exports = {\r\n    JsonUnpacker,\r\n    TextureUnpacker,\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar _noCacheRex = /\\?/;\r\n\r\nmodule.exports = {\r\n    //isUrlCrossOrigin: function (url) {\r\n    //    if (!url) {\r\n    //        cc.log('invalid URL');\r\n    //        return false;\r\n    //    }\r\n    //    var startIndex = url.indexOf('://');\r\n    //    if (startIndex === -1)\r\n    //        return false;\r\n    //\r\n    //    var endIndex = url.indexOf('/', startIndex + 3);\r\n    //    var urlOrigin = (endIndex === -1) ? url : url.substring(0, endIndex);\r\n    //    return urlOrigin !== location.origin;\r\n    //},\r\n    urlAppendTimestamp: function (url) {\r\n        if (cc.game.config['noCache'] && typeof url === 'string') {\r\n            if (_noCacheRex.test(url))\r\n                url += '&_t=' + (new Date() - 0);\r\n            else\r\n                url += '?_t=' + (new Date() - 0);\r\n        }\r\n        return url;\r\n    }\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../platform/js');\r\nconst debug = require('../CCDebug');\r\nrequire('../platform/deserialize');\r\nconst LoadingItems = require('./loading-items');\r\n\r\nfunction isSceneObj (json) {\r\n    var SCENE_ID = 'cc.Scene';\r\n    var PREFAB_ID = 'cc.Prefab';\r\n    return json && (\r\n               (json[0] && json[0].__type__ === SCENE_ID) ||\r\n               (json[1] && json[1].__type__ === SCENE_ID) ||\r\n               (json[0] && json[0].__type__ === PREFAB_ID)\r\n           );\r\n}\r\n\r\nfunction parseDepends (item, asset, tdInfo, deferredLoadRawAssetsInRuntime) {\r\n    var uuidList = tdInfo.uuidList;\r\n    var objList = tdInfo.uuidObjList;\r\n    var propList = tdInfo.uuidPropList;\r\n    var stillUseUrl = tdInfo._stillUseUrl;\r\n    var depends;\r\n    var i, dependUuid;\r\n    // cache dependencies for auto release\r\n    var dependKeys = item.dependKeys = [];\r\n\r\n    if (deferredLoadRawAssetsInRuntime) {\r\n        depends = [];\r\n        // parse depends assets\r\n        for (i = 0; i < uuidList.length; i++) {\r\n            dependUuid = uuidList[i];\r\n            var obj = objList[i];\r\n            var prop = propList[i];\r\n            var info = cc.AssetLibrary._getAssetInfoInRuntime(dependUuid);\r\n            if (info.raw) {\r\n                // skip preloading raw assets\r\n                var url = info.url;\r\n                obj[prop] = url;\r\n                dependKeys.push(url);\r\n            }\r\n            else {\r\n                // declare depends assets\r\n                depends.push({\r\n                    type: 'uuid',\r\n                    uuid: dependUuid,\r\n                    deferredLoadRaw: true,\r\n                    _owner: obj,\r\n                    _ownerProp: prop,\r\n                    _stillUseUrl: stillUseUrl[i]\r\n                });\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        depends = new Array(uuidList.length);\r\n\r\n        // declare depends assets\r\n        for (i = 0; i < uuidList.length; i++) {\r\n            dependUuid = uuidList[i];\r\n            depends[i] = {\r\n                type: 'uuid',\r\n                uuid: dependUuid,\r\n                _owner: objList[i],\r\n                _ownerProp: propList[i],\r\n                _stillUseUrl: stillUseUrl[i]\r\n            };\r\n        }\r\n\r\n        // load native object (Image/Audio) as depends\r\n        if (asset._native && !asset.constructor.preventPreloadNativeObject) {\r\n            depends.push({\r\n                url: asset.nativeUrl,\r\n                _owner: asset,\r\n                _ownerProp: '_nativeAsset',\r\n            });\r\n        }\r\n    }\r\n\r\n    return depends;\r\n}\r\n\r\nfunction loadDepends (pipeline, item, asset, depends, callback) {\r\n    // Predefine content for dependencies usage\r\n    item.content = asset;\r\n    var dependKeys = item.dependKeys;\r\n    pipeline.flowInDeps(item, depends, function (errors, items) {\r\n        var item, missingAssetReporter;\r\n        var itemsMap = items.map;\r\n        for (var src in itemsMap) {\r\n            item = itemsMap[src];\r\n            if (item.uuid && item.content) {\r\n                item.content._uuid = item.uuid;\r\n            }\r\n        }\r\n        for (var i = 0; i < depends.length; i++) {\r\n            var dep = depends[i];\r\n            var dependSrc = dep.uuid;\r\n            var dependUrl = dep.url;\r\n            var dependObj = dep._owner;\r\n            var dependProp = dep._ownerProp;\r\n            item = itemsMap[dependUrl];\r\n            if (!item) {\r\n                continue;\r\n            }\r\n\r\n            var loadCallbackCtx = dep;\r\n            function loadCallback (item) {\r\n                var value = item.content;\r\n                if (this._stillUseUrl) {\r\n                    value = (value && cc.RawAsset.wasRawAssetType(value.constructor)) ? value.nativeUrl : item.rawUrl;\r\n                }\r\n                this._owner[this._ownerProp] = value;\r\n                if (item.uuid !== asset._uuid && dependKeys.indexOf(item.id) < 0) {\r\n                    dependKeys.push(item.id);\r\n                }\r\n            }\r\n\r\n            if (item.complete || item.content) {\r\n                if (item.error) {\r\n                    if (CC_EDITOR && item.error.errorCode === 'db.NOTFOUND') {\r\n                        if (!missingAssetReporter) {\r\n                            var MissingObjectReporter = Editor.require('app://editor/page/scene-utils/missing-object-reporter');\r\n                            missingAssetReporter = new MissingObjectReporter(asset);\r\n                        }\r\n                        missingAssetReporter.stashByOwner(dependObj, dependProp, Editor.serialize.asAsset(dependSrc));\r\n                    }\r\n                    else {\r\n                        cc._throw(item.error);\r\n                    }\r\n                }\r\n                else {\r\n                    loadCallback.call(loadCallbackCtx, item);\r\n                }\r\n            }\r\n            else {\r\n                // item was removed from cache, but ready in pipeline actually\r\n                var queue = LoadingItems.getQueue(item);\r\n                // Hack to get a better behavior\r\n                var list = queue._callbackTable[dependSrc];\r\n                if (list) {\r\n                    list.unshift(loadCallback, loadCallbackCtx);\r\n                }\r\n                else {\r\n                    queue.addListener(dependSrc, loadCallback, loadCallbackCtx);\r\n                }\r\n            }\r\n        }\r\n        // Emit dependency errors in runtime, but not in editor,\r\n        // because editor need to open the scene / prefab to let user fix missing asset issues\r\n        if (CC_EDITOR && missingAssetReporter) {\r\n            missingAssetReporter.reportByOwner();\r\n            callback(null, asset);\r\n        }\r\n        else {\r\n            callback(errors, asset);\r\n        }\r\n    });\r\n}\r\n\r\n// can deferred load raw assets in runtime\r\nfunction canDeferredLoad (asset, item, isScene) {\r\n    if (CC_EDITOR) {\r\n        return false;\r\n    }\r\n    var res = item.deferredLoadRaw;\r\n    if (res) {\r\n        // check if asset support deferred\r\n        if ((asset instanceof cc.Asset) && asset.constructor.preventDeferredLoadDependents) {\r\n            res = false;\r\n        }\r\n    }\r\n    else if (isScene) {\r\n        if (asset instanceof cc.SceneAsset || asset instanceof cc.Prefab) {\r\n            res = asset.asyncLoadAssets;\r\n            //if (res) {\r\n            //    cc.log('deferred load raw assets for ' + item.id);\r\n            //}\r\n        }\r\n    }\r\n    return res;\r\n}\r\n\r\nvar MissingClass;\r\n\r\nfunction loadUuid (item, callback) {\r\n    if (CC_EDITOR) {\r\n        MissingClass = MissingClass || Editor.require('app://editor/page/scene-utils/missing-class-reporter').MissingClass;\r\n    }\r\n\r\n    var json;\r\n    if (typeof item.content === 'string') {\r\n        try {\r\n            json = JSON.parse(item.content);\r\n        }\r\n        catch (e) {\r\n            return new Error(debug.getError(4923, item.id, e.stack));\r\n        }\r\n    }\r\n    else if (typeof item.content === 'object') {\r\n        json = item.content;\r\n    }\r\n    else {\r\n        return new Error(debug.getError(4924));\r\n    }\r\n\r\n    var classFinder;\r\n    var isScene = isSceneObj(json);\r\n    if (isScene) {\r\n        if (CC_EDITOR) {\r\n            MissingClass.hasMissingClass = false;\r\n            classFinder = function (type, data, owner, propName) {\r\n                var res = MissingClass.classFinder(type, data, owner, propName);\r\n                if (res) {\r\n                    return res;\r\n                }\r\n                return cc._MissingScript.getMissingWrapper(type, data);\r\n            };\r\n            classFinder.onDereferenced = MissingClass.classFinder.onDereferenced;\r\n        }\r\n        else {\r\n            classFinder = cc._MissingScript.safeFindClass;\r\n        }\r\n    }\r\n    else {\r\n        classFinder = function (id) {\r\n            var cls = js._getClassById(id);\r\n            if (cls) {\r\n                return cls;\r\n            }\r\n            cc.warnID(4903, id);\r\n            return Object;\r\n        };\r\n    }\r\n\r\n    var tdInfo = cc.deserialize.Details.pool.get();\r\n\r\n    var asset;\r\n    try {\r\n        asset = cc.deserialize(json, tdInfo, {\r\n            classFinder: classFinder,\r\n            target: item.existingAsset,\r\n            customEnv: item\r\n        });\r\n    }\r\n    catch (e) {\r\n        cc.deserialize.Details.pool.put(tdInfo);\r\n        var err = CC_JSB ? (e + '\\n' + e.stack) : e.stack;\r\n        return new Error(debug.getError(4925, item.id, err));\r\n    }\r\n\r\n    asset._uuid = item.uuid;\r\n\r\n    if (CC_EDITOR && isScene && MissingClass.hasMissingClass) {\r\n        MissingClass.reportMissingClass(asset);\r\n    }\r\n\r\n    var deferredLoad = canDeferredLoad(asset, item, isScene);\r\n    var depends = parseDepends(item, asset, tdInfo, deferredLoad);\r\n\r\n    cc.deserialize.Details.pool.put(tdInfo);\r\n\r\n    if (depends.length === 0) {\r\n        return callback(null, asset);\r\n    }\r\n    loadDepends(this.pipeline, item, asset, depends, callback);\r\n}\r\n\r\nmodule.exports = loadUuid;\r\nloadUuid.isSceneObj = isSceneObj;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst MeshResource = require('./CCMeshResource');\r\nconst renderer = require('../renderer');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst gfx = renderEngine.gfx;\r\n\r\nfunction applyColor (data, offset, value) {\r\n    data[offset] = value._val;\r\n}\r\n\r\nfunction applyVec2 (data, offset, value) {\r\n    data[offset] = value.x;\r\n    data[offset + 1] = value.y;\r\n}\r\n\r\nfunction applyVec3 (data, offset, value) {\r\n    data[offset] = value.x;\r\n    data[offset + 1] = value.y;\r\n    data[offset + 2] = value.z;\r\n}\r\n\r\n/**\r\n* @module cc\r\n*/\r\n/**\r\n * !#en Mesh Asset.\r\n * !#zh \r\n * @class Mesh\r\n * @extends Asset\r\n */\r\nlet Mesh = cc.Class({\r\n    name: 'cc.Mesh',\r\n    extends: cc.Asset,\r\n\r\n    properties: {\r\n        _resource: {\r\n            default: null,\r\n            type: MeshResource\r\n        },\r\n\r\n        /**\r\n         * !#en Get ir set the sub meshes.\r\n         * !#zh \r\n         * @property {[renderEngine.InputAssembler]} subMeshes\r\n         */\r\n        subMeshes: {\r\n            get () {\r\n                return this._subMeshes;\r\n            },\r\n            set (v) {\r\n                this._subMeshes = v;\r\n            }\r\n        }\r\n    },\r\n\r\n    ctor () {\r\n        this._subMeshes = [];\r\n\r\n        this._ibs = [];\r\n        this._vbs = [];\r\n\r\n        this._minPos = cc.v3();\r\n        this._maxPos = cc.v3();\r\n\r\n        this._resourceInited = false;\r\n    },\r\n\r\n    _initResource () {\r\n        if (this._resourceInited || !this._resource) return;\r\n        this._resourceInited = true;\r\n\r\n        this._resource.flush(this);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Init vertex buffer according to the vertex format.\r\n     * !#zh\r\n     * \r\n     * @method init\r\n     * @param {gfx.VertexFormat} vertexFormat - vertex format\r\n     * @param {Number} vertexCount - how much vertex should be create in this buffer.\r\n     * @param {Boolean} dynamic - whether or not to use dynamic buffer.\r\n     */\r\n    init (vertexFormat, vertexCount, dynamic) {\r\n        this.clear();\r\n\r\n        let data = new Uint8Array(vertexFormat._bytes * vertexCount);\r\n        let vb = new gfx.VertexBuffer(\r\n            renderer.device,\r\n            vertexFormat,\r\n            dynamic ? gfx.USAGE_STATIC : gfx.USAGE_DYNAMIC,\r\n            data,\r\n            vertexCount\r\n        );\r\n\r\n        this._vbs[0] = {\r\n            buffer: vb,\r\n            data: data,\r\n            dirty: true\r\n        };\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Set the vertex values.\r\n     * !#zh \r\n     * \r\n     * @method setVertices\r\n     * @param {String} name - the attribute name, e.g. gfx.ATTR_POSITION\r\n     * @param {[Vec2|Vec3|Color|Number]} values - the vertex values\r\n     * @param {Number} [index] \r\n     */\r\n    setVertices (name, values, index) {\r\n        index = index || 0;\r\n        let vb = this._vbs[index];\r\n\r\n        let buffer = vb.buffer;\r\n        let el = buffer._format._attr2el[name];\r\n        if (!el) {\r\n            return cc.warn(`Cannot find ${name} attribute in vertex defines.`);\r\n        }\r\n\r\n\r\n        // whether the values is expanded\r\n        let isFlatMode = typeof values[0] === 'number';\r\n        let elNum = el.num;\r\n\r\n        let reader = Float32Array;\r\n        let bytes = 4;\r\n        if (name === gfx.ATTR_COLOR) {\r\n            if (isFlatMode) {\r\n                reader = Float32Array;\r\n                bytes = 1;\r\n            }\r\n            else {\r\n                reader = Uint32Array;\r\n            }\r\n        }\r\n\r\n        let data = vb[reader.name];\r\n        if (!data) {\r\n            let vbData = vb.data;\r\n            data = vb[reader.name] = new reader(vbData.buffer, vbData.byteOffset, vbData.byteLength / bytes);\r\n        }\r\n\r\n        let stride = el.stride / bytes;\r\n        let offset = el.offset / bytes;\r\n\r\n        if (isFlatMode) {\r\n            for (let i = 0, l = (values.length / elNum); i < l; i++) {\r\n                let sOffset = i * elNum;\r\n                let dOffset = i * stride + offset;\r\n                for (let j = 0; j < elNum; j++) {\r\n                    data[dOffset + j] = values[sOffset + j];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            let applyFunc;\r\n            if (name === gfx.ATTR_COLOR) {\r\n                applyFunc = applyColor;\r\n            }\r\n            else {\r\n\r\n                if (elNum === 2) {\r\n                    applyFunc = applyVec2;\r\n                }\r\n                else {\r\n                    applyFunc = applyVec3;\r\n                }\r\n            }\r\n\r\n            for (let i = 0, l = values.length; i < l; i++) {\r\n                let v = values[i];\r\n                let vOffset = i * stride + offset;\r\n                applyFunc(data, vOffset, v);\r\n            }\r\n        }\r\n        vb.dirty = true;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Set the sub mesh indices.\r\n     * !#zh\r\n     * \r\n     * @method setIndices\r\n     * @param {[Number]} indices - the sub mesh indices.\r\n     * @param {Number} index - sub mesh index.\r\n     */\r\n    setIndices (indices, index) {\r\n        index = index || 0;\r\n\r\n        let data = new Uint16Array(indices);\r\n\r\n        let ib = this._ibs[index];\r\n        if (!ib) {\r\n            let buffer = new gfx.IndexBuffer(\r\n                renderer.device,\r\n                gfx.INDEX_FMT_UINT16,\r\n                gfx.USAGE_STATIC,\r\n                data,\r\n                data.length\r\n            );\r\n\r\n            this._ibs[index] = {\r\n                buffer: buffer,\r\n                data: data,\r\n                dirty: false\r\n            };\r\n\r\n            let vb = this._vbs[0];\r\n            this._subMeshes[index] = new renderEngine.InputAssembler(vb.buffer, buffer);\r\n        }\r\n        else {\r\n            ib.data = data;\r\n            ib.dirty = true\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Set the sub mesh primitive type.\r\n     * !#zh\r\n     * \r\n     * @method setPrimitiveType\r\n     * @param {Number} type \r\n     * @param {Number} index \r\n     */\r\n    setPrimitiveType (type, index) {\r\n        index = index || 0;\r\n        let subMesh = this._subMeshes[index];\r\n        if (!subMesh) {\r\n            cc.warn(`Do not have sub mesh at index ${index}`);\r\n            return;\r\n        }\r\n        this._subMeshes[index]._primitiveType = type;\r\n    },\r\n\r\n    /** \r\n     * !#en\r\n     * Clear the buffer data.\r\n     * !#zh\r\n     * \r\n     * @method clear\r\n    */\r\n    clear () {\r\n        this._subMeshes.length = 0;\r\n\r\n        let ibs = this._ibs;\r\n        for (let i = 0; i < ibs.length; i++) {\r\n            ibs[i].buffer.destroy();\r\n        }\r\n        ibs.length = 0;\r\n\r\n        let vbs = this._vbs;\r\n        for (let i = 0; i < vbs.length; i++) {\r\n            vbs[i].buffer.destroy();\r\n        }\r\n        vbs.length = 0;\r\n    },\r\n\r\n    destroy () {\r\n        this.clear();\r\n    },\r\n\r\n    _uploadData () {\r\n        let vbs = this._vbs;\r\n        for (let i = 0; i < vbs.length; i++) {\r\n            let vb = vbs[i];\r\n\r\n            if (vb.dirty) {\r\n                let buffer = vb.buffer, data = vb.data;\r\n                buffer._numVertices = data.length;\r\n                buffer._bytes = data.byteLength;\r\n                buffer.update(0, data);\r\n                vb.dirty = false;\r\n            }\r\n        }\r\n\r\n        let ibs = this._ibs;\r\n        for (let i = 0; i < ibs.length; i++) {\r\n            let ib = ibs[i];\r\n\r\n            if (ib.dirty) {\r\n                let buffer = ib.buffer, data = ib.data;\r\n                buffer._numIndices = data.length;\r\n                buffer._bytes = data.byteLength;\r\n                buffer.update(0, data);\r\n                ib.dirty = false;\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\ncc.Mesh = module.exports = Mesh;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst RenderComponent = require('../components/CCRenderComponent');\r\nconst Mesh = require('./CCMesh');\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst gfx = renderEngine.gfx;\r\nconst RenderFlow = require('../renderer/render-flow');\r\nconst aabb = require('../3d/geom-utils/aabb');\r\n\r\nlet MeshRenderer = cc.Class({\r\n    name: 'cc.MeshRenderer',\r\n    extends: RenderComponent,\r\n    \r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.mesh/MeshRenderer',\r\n    },\r\n\r\n    properties: {\r\n        _mesh: {\r\n            default: null,\r\n            type: Mesh\r\n        },\r\n\r\n        mesh: {\r\n            get () {\r\n                return this._mesh;\r\n            },\r\n            set (v) {\r\n                if (this._mesh === v) return;\r\n                this._mesh = v;\r\n                this.activeMaterials(true);\r\n                this.markForUpdateRenderData(true);\r\n                this.node._renderFlag |= RenderFlow.FLAG_TRANSFORM;\r\n            },\r\n            type: Mesh\r\n        },\r\n\r\n        textures: {\r\n            default: [],\r\n            type: cc.Texture2D\r\n        }\r\n    },\r\n\r\n    ctor () {\r\n        this._renderDatas = [];\r\n        this._materials = [];\r\n        this._boundingBox = null;\r\n    },\r\n\r\n    onEnable () {\r\n        this._super();\r\n        this.activeMaterials();\r\n    },\r\n\r\n    _createMaterial (subMesh) {\r\n        let material = new renderEngine.MeshMaterial();   \r\n        material.color = this.node.color;\r\n        material._mainTech._passes[0].setDepth(true, true);\r\n        material.useModel = true;\r\n\r\n        if (subMesh._vertexBuffer._format._attr2el[gfx.ATTR_COLOR]) {\r\n            material.useAttributeColor = true;\r\n        }\r\n\r\n        return material;\r\n    },\r\n\r\n    _updateColor () {\r\n        let materials = this._materials;\r\n        for (let i = 0; i < materials.length; i++) {\r\n            let material = materials[i];\r\n            material.color = this.node.color;\r\n            material.updateHash();\r\n        }\r\n        \r\n        this.node._renderFlag &= ~RenderFlow.FLAG_COLOR;\r\n    },\r\n\r\n    _reset () {\r\n        this._materials.length = 0;\r\n        this._material = null;\r\n    },\r\n\r\n    activeMaterials (force) {\r\n        let mesh = this._mesh;\r\n        // TODO: should init mesh when mesh loaded, need asset load event support\r\n        if (mesh) {\r\n            mesh._initResource();\r\n        }\r\n\r\n        if (!mesh || mesh.subMeshes.length === 0) {\r\n            this.disableRender();\r\n            return;\r\n        }\r\n\r\n        if (this._material && !force) {\r\n            return;\r\n        }\r\n\r\n        if (aabb) {\r\n            this._boundingBox = aabb.fromPoints(aabb.create(), mesh._minPos, mesh._maxPos);\r\n        }\r\n        \r\n        this._reset();\r\n\r\n        let subMeshes = mesh._subMeshes;\r\n        for (let i = 0; i < subMeshes.length; i++) {\r\n            let material = this._createMaterial(subMeshes[i]);\r\n            this._materials.push(material);\r\n        }\r\n        this._material = this._materials[0];\r\n        \r\n        this.markForUpdateRenderData(true);\r\n        this.markForRender(true);\r\n    }\r\n});\r\n\r\ncc.MeshRenderer = module.exports = MeshRenderer;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nlet MeshResource = cc.Class({\r\n    name: 'cc.MeshResource',\r\n    \r\n    flush (mesh) {\r\n\r\n    }\r\n});\r\n\r\nmodule.exports = MeshResource;\r\n","require('./CCMesh');\r\nif (!CC_EDITOR || !Editor.isMainProcess) {\r\n    require('./CCMeshRenderer');\r\n    require('./mesh-renderer');\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst MeshRenderer = require('./CCMeshRenderer');\r\n\r\nconst renderEngine = require('../renderer/render-engine');\r\nconst IARenderData = renderEngine.IARenderData;\r\nconst gfx = renderEngine.gfx;\r\nconst InputAssembler = renderEngine.InputAssembler;\r\n\r\nconst BLACK_COLOR = cc.Color.BLACK;\r\n\r\nlet meshRendererAssembler = {\r\n    useModel: true,\r\n    updateRenderData (comp) {\r\n        let renderDatas = comp._renderDatas;\r\n        renderDatas.length = 0;\r\n        if (!comp.mesh) return;\r\n        let submeshes = comp.mesh._subMeshes;\r\n        for (let i = 0; i < submeshes.length; i++) {\r\n            let data = new IARenderData();\r\n            data.material = comp._materials[i];\r\n            data.ia = submeshes[i];\r\n            renderDatas.push(data);\r\n        }\r\n    },\r\n\r\n    createWireFrameData (ia, oldIbData, material, renderer) {\r\n        let data = new IARenderData();\r\n        let m = material.clone();\r\n        m.color = BLACK_COLOR;\r\n        m.useTexture = false;\r\n        m._mainTech._passes[0].setDepth(true, true);\r\n        data.material = m;\r\n\r\n        let indices = [];\r\n        for (let i = 0; i < oldIbData.length; i+=3) {\r\n            let a = oldIbData[ i + 0 ];\r\n            let b = oldIbData[ i + 1 ];\r\n            let c = oldIbData[ i + 2 ];\r\n            indices.push(a, b, b, c, c, a);\r\n        }\r\n\r\n        let ibData = new Uint16Array(indices);\r\n        let ib = new gfx.IndexBuffer(\r\n            renderer._device,\r\n            gfx.INDEX_FMT_UINT16,\r\n            gfx.USAGE_STATIC,\r\n            ibData,\r\n            ibData.length\r\n        );\r\n\r\n        data.ia = new renderEngine.InputAssembler(ia._vertexBuffer, ib, gfx.PT_LINES);\r\n        return data;\r\n    },\r\n\r\n    fillBuffers (comp, renderer) {\r\n        if (!comp.mesh) return;\r\n\r\n        renderer._flush();\r\n\r\n        let renderDatas = comp._renderDatas;\r\n        let submeshes = comp.mesh._subMeshes;\r\n        if (cc.macro.SHOW_MESH_WIREFRAME) {\r\n            if (renderDatas.length === submeshes.length) {\r\n                let ibs = comp.mesh._ibs;\r\n                for (let i = 0; i < submeshes.length; i++) {\r\n                    let data = renderDatas[i];\r\n                    renderDatas.push( this.createWireFrameData(data.ia, ibs[i].data, data.material, renderer) );\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            renderDatas.length = submeshes.length;\r\n        }\r\n\r\n        let tmpMaterial = renderer.material;\r\n\r\n        let tmpNode = renderer.node;\r\n        renderer.node = comp._material.useModel ? comp.node : renderer._dummyNode;\r\n\r\n        comp.mesh._uploadData();\r\n\r\n        let textures = comp.textures;\r\n        let materials = comp._materials;\r\n        for (let i = 0; i < renderDatas.length; i++) {\r\n            let renderData = renderDatas[i];\r\n            let material = renderData.material;\r\n            if (textures[i]) {\r\n                material.texture = textures[i];\r\n            }\r\n            else {\r\n                material.useTexture = false;\r\n            }\r\n\r\n            renderer.material = material;\r\n            renderer._flushIA(renderData);\r\n        }\r\n\r\n        renderer.node = tmpNode;\r\n        renderer.material = tmpMaterial;\r\n    }\r\n};\r\n\r\nmodule.exports = MeshRenderer._assembler = meshRendererAssembler;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar CompScheduler = require('./component-scheduler');\r\nvar Flags = require('./platform/CCObject').Flags;\r\nvar js = require('./platform/js');\r\nvar callerFunctor = CC_EDITOR && require('./utils/misc').tryCatchFunctor_EDITOR;\r\n\r\nvar MAX_POOL_SIZE = 4;\r\n\r\nvar IsPreloadStarted = Flags.IsPreloadStarted;\r\nvar IsOnLoadStarted = Flags.IsOnLoadStarted;\r\nvar IsOnLoadCalled = Flags.IsOnLoadCalled;\r\nvar Deactivating = Flags.Deactivating;\r\n\r\nvar callPreloadInTryCatch = CC_EDITOR && callerFunctor('__preload');\r\nvar callOnLoadInTryCatch = CC_EDITOR && callerFunctor('onLoad', null,\r\n        'target._objFlags |= ' + IsOnLoadCalled + '; arg(target);', _onLoadInEditor);\r\nvar callOnDestroyInTryCatch = CC_EDITOR && callerFunctor('onDestroy');\r\nvar callResetInTryCatch = CC_EDITOR && callerFunctor('resetInEditor');\r\nvar callOnFocusInTryCatch = CC_EDITOR && callerFunctor('onFocusInEditor');\r\nvar callOnLostFocusInTryCatch = CC_EDITOR && callerFunctor('onLostFocusInEditor');\r\n\r\nvar callPreload = CC_SUPPORT_JIT ? 'c.__preload();' : function (c) { c.__preload(); };\r\nvar callOnLoad = CC_SUPPORT_JIT ? ('c.onLoad();c._objFlags|=' + IsOnLoadCalled) : function (c) {\r\n    c.onLoad();\r\n    c._objFlags |= IsOnLoadCalled;\r\n};\r\n\r\n// for __preload: use internally, no sort\r\nvar UnsortedInvoker = cc.Class({\r\n    extends: CompScheduler.LifeCycleInvoker,\r\n    add (comp) {\r\n        this._zero.array.push(comp);\r\n    },\r\n    remove (comp) {\r\n        this._zero.fastRemove(comp);\r\n    },\r\n    cancelInactive (flagToClear) {\r\n        CompScheduler.LifeCycleInvoker.stableRemoveInactive(this._zero, flagToClear);\r\n    },\r\n    invoke () {\r\n        this._invoke(this._zero);\r\n        this._zero.array.length = 0;\r\n    },\r\n});\r\n\r\nvar invokePreload = CompScheduler.createInvokeImpl(\r\n    CC_EDITOR ? callPreloadInTryCatch : callPreload\r\n);\r\nvar invokeOnLoad = CompScheduler.createInvokeImpl(\r\n    CC_EDITOR ? callOnLoadInTryCatch : callOnLoad\r\n);\r\n\r\nvar activateTasksPool = new js.Pool(MAX_POOL_SIZE);\r\nactivateTasksPool.get = function getActivateTask () {\r\n    var task = this._get() || {\r\n        preload: new UnsortedInvoker(invokePreload),\r\n        onLoad: new CompScheduler.OneOffInvoker(invokeOnLoad),\r\n        onEnable: new CompScheduler.OneOffInvoker(CompScheduler.invokeOnEnable)\r\n    };\r\n\r\n    // reset index to -1 so we can skip invoked component in cancelInactive\r\n    task.preload._zero.i = -1;\r\n    var invoker = task.onLoad;\r\n    invoker._zero.i = -1;\r\n    invoker._neg.i = -1;\r\n    invoker._pos.i = -1;\r\n    invoker = task.onEnable;\r\n    invoker._zero.i = -1;\r\n    invoker._neg.i = -1;\r\n    invoker._pos.i = -1;\r\n\r\n    return task;\r\n};\r\n\r\nfunction _componentCorrupted (node, comp, index) {\r\n    if (CC_DEV) {\r\n        cc.errorID(3817, node.name, index);\r\n        console.log('Corrupted component value:', comp);\r\n    }\r\n    if (comp) {\r\n        node._removeComponent(comp);\r\n    }\r\n    else {\r\n        js.array.removeAt(node._components, index);\r\n    }\r\n}\r\n\r\nfunction _onLoadInEditor (comp) {\r\n    if (comp.onLoad && !cc.engine._isPlaying) {\r\n        var focused = Editor.Selection.curActivate('node') === comp.node.uuid;\r\n        if (focused) {\r\n            comp.onFocusInEditor && callOnFocusInTryCatch(comp);\r\n        }\r\n        else {\r\n            comp.onLostFocusInEditor && callOnLostFocusInTryCatch(comp);\r\n        }\r\n    }\r\n    if ( !CC_TEST ) {\r\n        _Scene.AssetsWatcher.start(comp);\r\n    }\r\n}\r\n\r\n/**\r\n * The class used to perform activating and deactivating operations of node and component.\r\n */\r\nfunction ctor () {\r\n    // a stack of node's activating tasks\r\n    this._activatingStack = [];\r\n}\r\nvar NodeActivator = cc.Class({\r\n    ctor: ctor,\r\n    reset: ctor,\r\n\r\n    _activateNodeRecursively (node, preloadInvoker, onLoadInvoker, onEnableInvoker) {\r\n        if (node._objFlags & Deactivating) {\r\n            // en:\r\n            // Forbid reactive the same node during its deactivating procedure\r\n            // to avoid endless loop and simplify the implementation.\r\n            // zh:\r\n            //  -  - \r\n            // \r\n            cc.errorID(3816, node.name);\r\n            return;\r\n        }\r\n\r\n        node._activeInHierarchy = true;\r\n\r\n        // component maybe added during onEnable, and the onEnable of new component is already called\r\n        // so we should record the origin length\r\n        var originCount = node._components.length;\r\n        // activate components\r\n        for (let i = 0; i < originCount; ++i) {\r\n            let component = node._components[i];\r\n            if (component instanceof cc.Component) {\r\n                this.activateComp(component, preloadInvoker, onLoadInvoker, onEnableInvoker);\r\n            }\r\n            else {\r\n                _componentCorrupted(node, component, i);\r\n                --i;\r\n                --originCount;\r\n            }\r\n        }\r\n        // activate children recursively\r\n        for (let i = 0, len = node._children.length; i < len; ++i) {\r\n            let child = node._children[i];\r\n            if (child._active) {\r\n                this._activateNodeRecursively(child, preloadInvoker, onLoadInvoker, onEnableInvoker);\r\n            }\r\n        }\r\n\r\n        node._onPostActivated(true);\r\n    },\r\n\r\n    _deactivateNodeRecursively (node) {\r\n        if (CC_DEV) {\r\n            cc.assert(!(node._objFlags & Deactivating), 'node should not deactivating');\r\n            // ensures _activeInHierarchy is always changing when Deactivating flagged\r\n            cc.assert(node._activeInHierarchy, 'node should not deactivated');\r\n        }\r\n        node._objFlags |= Deactivating;\r\n        node._activeInHierarchy = false;\r\n\r\n        // component maybe added during onEnable, and the onEnable of new component is already called\r\n        // so we should record the origin length\r\n        var originCount = node._components.length;\r\n        for (let c = 0; c < originCount; ++c) {\r\n            let component = node._components[c];\r\n            if (component._enabled) {\r\n                cc.director._compScheduler.disableComp(component);\r\n\r\n                if (node._activeInHierarchy) {\r\n                    // reactivated from root\r\n                    node._objFlags &= ~Deactivating;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        for (let i = 0, len = node._children.length; i < len; ++i) {\r\n            let child = node._children[i];\r\n            if (child._activeInHierarchy) {\r\n                this._deactivateNodeRecursively(child);\r\n\r\n                if (node._activeInHierarchy) {\r\n                    // reactivated from root\r\n                    node._objFlags &= ~Deactivating;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        node._onPostActivated(false);\r\n        node._objFlags &= ~Deactivating;\r\n    },\r\n\r\n    activateNode (node, active) {\r\n        if (active) {\r\n            var task = activateTasksPool.get();\r\n            this._activatingStack.push(task);\r\n\r\n            this._activateNodeRecursively(node, task.preload, task.onLoad, task.onEnable);\r\n            task.preload.invoke();\r\n            task.onLoad.invoke();\r\n            task.onEnable.invoke();\r\n\r\n            this._activatingStack.pop();\r\n            activateTasksPool.put(task);\r\n        }\r\n        else {\r\n            this._deactivateNodeRecursively(node);\r\n\r\n            // remove children of this node from previous activating tasks to debounce\r\n            // (this is an inefficient operation but it ensures general case could be implemented in a efficient way)\r\n            var stack = this._activatingStack;\r\n            for (var i = 0; i < stack.length; i++) {\r\n                var lastTask = stack[i];\r\n                lastTask.preload.cancelInactive(IsPreloadStarted);\r\n                lastTask.onLoad.cancelInactive(IsOnLoadStarted);\r\n                lastTask.onEnable.cancelInactive();\r\n            }\r\n        }\r\n        node.emit('active-in-hierarchy-changed', node);\r\n    },\r\n\r\n    activateComp: CC_EDITOR ? function (comp, preloadInvoker, onLoadInvoker, onEnableInvoker) {\r\n        if (!cc.isValid(comp, true)) {\r\n            // destroyed before activating\r\n            return;\r\n        }\r\n        if (cc.engine._isPlaying || comp.constructor._executeInEditMode) {\r\n            if (!(comp._objFlags & IsPreloadStarted)) {\r\n                comp._objFlags |= IsPreloadStarted;\r\n                if (comp.__preload) {\r\n                    if (preloadInvoker) {\r\n                        preloadInvoker.add(comp);\r\n                    }\r\n                    else {\r\n                        callPreloadInTryCatch(comp);\r\n                    }\r\n                }\r\n            }\r\n            if (!(comp._objFlags & IsOnLoadStarted)) {\r\n                comp._objFlags |= IsOnLoadStarted;\r\n                if (comp.onLoad) {\r\n                    if (onLoadInvoker) {\r\n                        onLoadInvoker.add(comp);\r\n                    }\r\n                    else {\r\n                        callOnLoadInTryCatch(comp);\r\n                    }\r\n                }\r\n                else {\r\n                    comp._objFlags |= IsOnLoadCalled;\r\n                    _onLoadInEditor(comp);\r\n                }\r\n            }\r\n        }\r\n        if (comp._enabled) {\r\n            var deactivatedOnLoading = !comp.node._activeInHierarchy;\r\n            if (deactivatedOnLoading) {\r\n                return;\r\n            }\r\n            cc.director._compScheduler.enableComp(comp, onEnableInvoker);\r\n        }\r\n    } : function (comp, preloadInvoker, onLoadInvoker, onEnableInvoker) {\r\n        if (!cc.isValid(comp, true)) {\r\n            // destroyed before activating\r\n            return;\r\n        }\r\n        if (!(comp._objFlags & IsPreloadStarted)) {\r\n            comp._objFlags |= IsPreloadStarted;\r\n            if (comp.__preload) {\r\n                if (preloadInvoker) {\r\n                    preloadInvoker.add(comp);\r\n                }\r\n                else {\r\n                    comp.__preload();\r\n                }\r\n            }\r\n        }\r\n        if (!(comp._objFlags & IsOnLoadStarted)) {\r\n            comp._objFlags |= IsOnLoadStarted;\r\n            if (comp.onLoad) {\r\n                if (onLoadInvoker) {\r\n                    onLoadInvoker.add(comp);\r\n                }\r\n                else {\r\n                    comp.onLoad();\r\n                    comp._objFlags |= IsOnLoadCalled;\r\n                }\r\n            }\r\n            else {\r\n                comp._objFlags |= IsOnLoadCalled;\r\n            }\r\n        }\r\n        if (comp._enabled) {\r\n            var deactivatedOnLoading = !comp.node._activeInHierarchy;\r\n            if (deactivatedOnLoading) {\r\n                return;\r\n            }\r\n            cc.director._compScheduler.enableComp(comp, onEnableInvoker);\r\n        }\r\n    },\r\n\r\n    destroyComp: CC_EDITOR ? function (comp) {\r\n        // ensure onDisable called\r\n        cc.director._compScheduler.disableComp(comp);\r\n\r\n        if (comp.onDestroy && (comp._objFlags & IsOnLoadCalled)) {\r\n            if (cc.engine._isPlaying || comp.constructor._executeInEditMode) {\r\n                callOnDestroyInTryCatch(comp);\r\n            }\r\n        }\r\n    } : function (comp) {\r\n        // ensure onDisable called\r\n        cc.director._compScheduler.disableComp(comp);\r\n\r\n        if (comp.onDestroy && (comp._objFlags & IsOnLoadCalled)) {\r\n            comp.onDestroy();\r\n        }\r\n    },\r\n\r\n    resetComp: CC_EDITOR && function (comp) {\r\n        if (comp.resetInEditor) {\r\n            callResetInTryCatch(comp);\r\n        }\r\n    }\r\n});\r\n\r\nmodule.exports = NodeActivator;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar Asset = require('../assets/CCAsset');\r\nvar callInNextTick = require('./utils').callInNextTick;\r\nvar Loader = require('../load-pipeline/CCLoader');\r\nvar PackDownloader = require('../load-pipeline/pack-downloader');\r\nvar AutoReleaseUtils = require('../load-pipeline/auto-release-utils');\r\nvar decodeUuid = require('../utils/decode-uuid');\r\nvar MD5Pipe = require('../load-pipeline/md5-pipe');\r\nvar js = require('./js');\r\n\r\n/**\r\n * The asset library which managing loading/unloading assets in project.\r\n *\r\n * @class AssetLibrary\r\n * @static\r\n */\r\n\r\n// configs\r\n\r\nvar _libraryBase = '';\r\nvar _rawAssetsBase = '';     // The base dir for raw assets in runtime\r\nvar _uuidToRawAsset = js.createMap(true);\r\n\r\nfunction isScene (asset) {\r\n    return asset && (asset.constructor === cc.SceneAsset || asset instanceof cc.Scene);\r\n}\r\n\r\n// types\r\n\r\nfunction RawAssetEntry (url, type) {\r\n    this.url = url;\r\n    this.type = type;\r\n}\r\n\r\n// publics\r\n\r\nvar AssetLibrary = {\r\n    /**\r\n     * @callback loadCallback\r\n     * @param {String} error - null or the error info\r\n     * @param {Asset} data - the loaded asset or null\r\n     */\r\n\r\n    /**\r\n     * @method loadAsset\r\n     * @param {String} uuid\r\n     * @param {loadCallback} callback - the callback function once load finished\r\n     * @param {Object} options\r\n     * @param {Boolean} options.readMainCache - Default is true. If false, the asset and all its depends assets will reload and create new instances from library.\r\n     * @param {Boolean} options.writeMainCache - Default is true. If true, the result will cache to AssetLibrary, and MUST be unload by user manually.\r\n     * @param {Asset} options.existingAsset - load to existing asset, this argument is only available in editor\r\n     * @private\r\n     */\r\n    loadAsset: function (uuid, callback, options) {\r\n        if (typeof uuid !== 'string') {\r\n            return callInNextTick(callback, new Error('[AssetLibrary] uuid must be string'), null);\r\n        }\r\n        // var readMainCache = typeof (options && options.readMainCache) !== 'undefined' ? readMainCache : true;\r\n        // var writeMainCache = typeof (options && options.writeMainCache) !== 'undefined' ? writeMainCache : true;\r\n        var item = {\r\n            uuid: uuid,\r\n            type: 'uuid'\r\n        };\r\n        if (options && options.existingAsset) {\r\n            item.existingAsset = options.existingAsset;\r\n        }\r\n        Loader.load(item, function (error, asset) {\r\n            if (error || !asset) {\r\n                error = new Error('[AssetLibrary] loading JSON or dependencies failed: ' + (error ? error.message : 'Unknown error'));\r\n            }\r\n            else {\r\n                if (asset.constructor === cc.SceneAsset) {\r\n                    if (CC_EDITOR && !asset.scene) {\r\n                        Editor.error('Sorry, the scene data of \"%s\" is corrupted!', uuid);\r\n                    }\r\n                    else {\r\n                        var key = cc.loader._getReferenceKey(uuid);\r\n                        asset.scene.dependAssets = AutoReleaseUtils.getDependsRecursively(key);\r\n                    }\r\n                }\r\n                if (CC_EDITOR || isScene(asset)) {\r\n                    var id = cc.loader._getReferenceKey(uuid);\r\n                    Loader.removeItem(id);\r\n                }\r\n            }\r\n            if (callback) {\r\n                callback(error, asset);\r\n            }\r\n        });\r\n    },\r\n\r\n    getLibUrlNoExt: function (uuid, inRawAssetsDir) {\r\n        if (CC_BUILD) {\r\n            uuid = decodeUuid(uuid);\r\n        }\r\n        var base = (CC_BUILD && inRawAssetsDir) ? (_rawAssetsBase + 'assets/') : _libraryBase;\r\n        return base + uuid.slice(0, 2) + '/' + uuid;\r\n    },\r\n\r\n    _queryAssetInfoInEditor: function (uuid, callback) {\r\n        if (CC_EDITOR) {\r\n            Editor.Ipc.sendToMain('scene:query-asset-info-by-uuid', uuid, function (err, info) {\r\n                if (info) {\r\n                    Editor.Utils.UuidCache.cache(info.url, uuid);\r\n                    var ctor = Editor.assets[info.type];\r\n                    if (ctor) {\r\n                        var isRawAsset = !js.isChildClassOf(ctor, Asset);\r\n                        callback(null, info.url, isRawAsset, ctor);\r\n                    }\r\n                    else {\r\n                        callback(new Error('Can not find asset type ' + info.type));\r\n                    }\r\n                }\r\n                else {\r\n                    var error = new Error('Can not get asset url by uuid \"' + uuid + '\", the asset may be deleted.');\r\n                    error.errorCode = 'db.NOTFOUND';\r\n                    callback(error);\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    _getAssetInfoInRuntime: function (uuid, result) {\r\n        result = result || {url: null, raw: false};\r\n        var info = _uuidToRawAsset[uuid];\r\n        if (info && !js.isChildClassOf(info.type, cc.Asset)) {\r\n            // backward compatibility since 1.10\r\n            result.url = _rawAssetsBase + info.url;\r\n            result.raw = true;\r\n        }\r\n        else {\r\n            result.url = this.getLibUrlNoExt(uuid) + '.json';\r\n            result.raw = false;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    _uuidInSettings: function (uuid) {\r\n        return uuid in _uuidToRawAsset;\r\n    },\r\n\r\n    /**\r\n     * @method queryAssetInfo\r\n     * @param {String} uuid\r\n     * @param {Function} callback\r\n     * @param {Error} callback.error\r\n     * @param {String} callback.url - the url of raw asset or imported asset\r\n     * @param {Boolean} callback.raw - indicates whether the asset is raw asset\r\n     * @param {Function} callback.ctorInEditor - the actual type of asset, used in editor only\r\n     */\r\n    queryAssetInfo: function (uuid, callback) {\r\n        if (CC_EDITOR && !CC_TEST) {\r\n            this._queryAssetInfoInEditor(uuid, callback);\r\n        }\r\n        else {\r\n            var info = this._getAssetInfoInRuntime(uuid);\r\n            callback(null, info.url, info.raw);\r\n        }\r\n    },\r\n\r\n    // parse uuid out of url\r\n    parseUuidInEditor: function (url) {\r\n        if (CC_EDITOR) {\r\n            var uuid = '';\r\n            var isImported = url.startsWith(_libraryBase);\r\n            if (isImported) {\r\n                var dir = cc.path.dirname(url);\r\n                var dirBasename = cc.path.basename(dir);\r\n\r\n                var isAssetUrl = dirBasename.length === 2;\r\n                if (isAssetUrl) {\r\n                    uuid = cc.path.basename(url);\r\n                    var index = uuid.indexOf('.');\r\n                    if (index !== -1) {\r\n                        uuid = uuid.slice(0, index);\r\n                    }\r\n                }\r\n                else {\r\n                    // raw file url\r\n                    uuid = dirBasename;\r\n                }\r\n            }\r\n            // If url is not in the library, just return \"\"\r\n            return uuid;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @method loadJson\r\n     * @param {String} json\r\n     * @param {loadCallback} callback\r\n     * @return {LoadingHandle}\r\n     * @private\r\n     */\r\n    loadJson: function (json, callback) {\r\n        var randomUuid = '' + ((new Date()).getTime() + Math.random());\r\n        var item = {\r\n            uuid: randomUuid,\r\n            type: 'uuid',\r\n            content: json,\r\n            skips: [ Loader.assetLoader.id, Loader.downloader.id ]\r\n        };\r\n        Loader.load(item, function (error, asset) {\r\n            if (error) {\r\n                error = new Error('[AssetLibrary] loading JSON or dependencies failed: ' + error.message);\r\n            }\r\n            else {\r\n                if (asset.constructor === cc.SceneAsset) {\r\n                    var key = cc.loader._getReferenceKey(randomUuid);\r\n                    asset.scene.dependAssets = AutoReleaseUtils.getDependsRecursively(key);\r\n                }\r\n                if (CC_EDITOR || isScene(asset)) {\r\n                    var id = cc.loader._getReferenceKey(randomUuid);\r\n                    Loader.removeItem(id);\r\n                }\r\n            }\r\n            asset._uuid = '';\r\n            if (callback) {\r\n                callback(error, asset);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get the exists asset by uuid.\r\n     *\r\n     * @method getAssetByUuid\r\n     * @param {String} uuid\r\n     * @return {Asset} - the existing asset, if not loaded, just returns null.\r\n     * @private\r\n     */\r\n    getAssetByUuid: function (uuid) {\r\n        return AssetLibrary._uuidToAsset[uuid] || null;\r\n    },\r\n\r\n    /**\r\n     * init the asset library\r\n     *\r\n     * @method init\r\n     * @param {Object} options\r\n     * @param {String} options.libraryPath - \r\n     * @param {Object} options.mountPaths - mount point of actual urls for raw assets (only used in editor)\r\n     * @param {Object} [options.rawAssets] - uuid to raw asset's urls (only used in runtime)\r\n     * @param {String} [options.rawAssetsBase] - base of raw asset's urls (only used in runtime)\r\n     * @param {String} [options.packedAssets] - packed assets (only used in runtime)\r\n     */\r\n    init: function (options) {\r\n        if (CC_EDITOR && _libraryBase) {\r\n            cc.errorID(6402);\r\n            return;\r\n        }\r\n\r\n\r\n        //  url runtime  \"\\\" \r\n        //  url.format  windows  file://  ///  replace  URL\r\n        var libraryPath = options.libraryPath;\r\n        libraryPath = libraryPath.replace(/\\\\/g, '/');\r\n        _libraryBase = cc.path.stripSep(libraryPath) + '/';\r\n\r\n        _rawAssetsBase = options.rawAssetsBase;\r\n\r\n        var md5AssetsMap = options.md5AssetsMap;\r\n        if (md5AssetsMap && md5AssetsMap.import) {\r\n            // decode uuid\r\n            var i = 0, uuid = 0;\r\n            var md5ImportMap = js.createMap(true);\r\n            var md5Entries = md5AssetsMap.import;\r\n            for (i = 0; i < md5Entries.length; i += 2) {\r\n                uuid = decodeUuid(md5Entries[i]);\r\n                md5ImportMap[uuid] = md5Entries[i + 1];\r\n            }\r\n\r\n            var md5RawAssetsMap = js.createMap(true);\r\n            md5Entries = md5AssetsMap['raw-assets'];\r\n            for (i = 0; i < md5Entries.length; i += 2) {\r\n                uuid = decodeUuid(md5Entries[i]);\r\n                md5RawAssetsMap[uuid] = md5Entries[i + 1];\r\n            }\r\n\r\n            var md5Pipe = new MD5Pipe(md5ImportMap, md5RawAssetsMap, _libraryBase);\r\n            cc.loader.insertPipeAfter(cc.loader.assetLoader, md5Pipe);\r\n            cc.loader.md5Pipe = md5Pipe;\r\n        }\r\n\r\n        // init raw assets\r\n\r\n        var resources = Loader._resources;\r\n        resources.reset();\r\n        var rawAssets = options.rawAssets;\r\n        if (rawAssets) {\r\n            for (var mountPoint in rawAssets) {\r\n                var assets = rawAssets[mountPoint];\r\n                for (var uuid in assets) {\r\n                    var info = assets[uuid];\r\n                    var url = info[0];\r\n                    var typeId = info[1];\r\n                    var type = cc.js._getClassById(typeId);\r\n                    if (!type) {\r\n                        cc.error('Cannot get', typeId);\r\n                        continue;\r\n                    }\r\n                    // backward compatibility since 1.10\r\n                    _uuidToRawAsset[uuid] = new RawAssetEntry(mountPoint + '/' + url, type);\r\n                    // init resources\r\n                    if (mountPoint === 'assets') {\r\n                        var ext = cc.path.extname(url);\r\n                        if (ext) {\r\n                            // trim base dir and extname\r\n                            url = url.slice(0, - ext.length);\r\n                        }\r\n                        var isSubAsset = info[2] === 1;\r\n                        // register\r\n                        resources.add(url, uuid, type, !isSubAsset);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (options.packedAssets) {\r\n            PackDownloader.initPacks(options.packedAssets);\r\n        }\r\n\r\n        // init cc.url\r\n        cc.url._init((options.mountPaths && options.mountPaths.assets) || _rawAssetsBase + 'assets');\r\n    }\r\n};\r\n\r\n// unload asset if it is destoryed\r\n\r\n/**\r\n * !#en Caches uuid to all loaded assets in scenes.\r\n *\r\n * !#zh \r\n *\r\n * WeakMap unloadAsset \r\n *\r\n * \r\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap\r\n * https://github.com/TooTallNate/node-weak\r\n *\r\n * @property {object} _uuidToAsset\r\n * @private\r\n */\r\nAssetLibrary._uuidToAsset = {};\r\n\r\n//asset\r\n//if (CC_DEV && Asset.prototype._onPreDestroy) {\r\n//    cc.error('_onPreDestroy of Asset has already defined');\r\n//}\r\n//Asset.prototype._onPreDestroy = function () {\r\n//    if (AssetLibrary._uuidToAsset[this._uuid] === this) {\r\n//        AssetLibrary.unloadAsset(this);\r\n//    }\r\n//};\r\n\r\nmodule.exports = cc.AssetLibrary = AssetLibrary;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('./js');\r\nvar Enum = require('./CCEnum');\r\nvar utils = require('./utils');\r\nvar _isPlainEmptyObj_DEV = utils.isPlainEmptyObj_DEV;\r\nvar _cloneable_DEV = utils.cloneable_DEV;\r\nvar Attr = require('./attribute');\r\nvar DELIMETER = Attr.DELIMETER;\r\nvar getTypeChecker = Attr.getTypeChecker;\r\nvar preprocess = require('./preprocess-class');\r\nrequire('./requiring-frame');\r\n\r\nvar BUILTIN_ENTRIES = ['name', 'extends', 'mixins', 'ctor', '__ctor__', 'properties', 'statics', 'editor', '__ES6__'];\r\n\r\nvar INVALID_STATICS_DEV = CC_DEV && ['name', '__ctors__', '__props__', 'arguments', 'call', 'apply', 'caller',\r\n                       'length', 'prototype'];\r\n\r\nfunction pushUnique (array, item) {\r\n    if (array.indexOf(item) < 0) {\r\n        array.push(item);\r\n    }\r\n}\r\n\r\nvar deferredInitializer = {\r\n\r\n    // Configs for classes which needs deferred initialization\r\n    datas: null,\r\n\r\n    // register new class\r\n    // data - {cls: cls, cb: properties, mixins: options.mixins}\r\n    push: function (data) {\r\n        if (this.datas) {\r\n            this.datas.push(data);\r\n        }\r\n        else {\r\n            this.datas = [data];\r\n            // start a new timer to initialize\r\n            var self = this;\r\n            setTimeout(function () {\r\n                self.init();\r\n            }, 0);\r\n        }\r\n    },\r\n\r\n    init: function () {\r\n        var datas = this.datas;\r\n        if (datas) {\r\n            for (var i = 0; i < datas.length; ++i) {\r\n                var data = datas[i];\r\n                var cls = data.cls;\r\n                var properties = data.props;\r\n                if (typeof properties === 'function') {\r\n                    properties = properties();\r\n                }\r\n                var name = js.getClassName(cls);\r\n                if (properties) {\r\n                    declareProperties(cls, name, properties, cls.$super, data.mixins);\r\n                }\r\n                else {\r\n                    cc.errorID(3633, name);\r\n                }\r\n            }\r\n            this.datas = null;\r\n        }\r\n    }\r\n};\r\n\r\n// both getter and prop must register the name into __props__ array\r\nfunction appendProp (cls, name) {\r\n    if (CC_DEV) {\r\n        //if (!IDENTIFIER_RE.test(name)) {\r\n        //    cc.error('The property name \"' + name + '\" is not compliant with JavaScript naming standards');\r\n        //    return;\r\n        //}\r\n        if (name.indexOf('.') !== -1) {\r\n            cc.errorID(3634);\r\n            return;\r\n        }\r\n    }\r\n    pushUnique(cls.__props__, name);\r\n}\r\n\r\nvar tmpArray = [];\r\nfunction defineProp (cls, className, propName, val, es6) {\r\n    var defaultValue = val.default;\r\n\r\n    if (CC_DEV) {\r\n        if (!es6) {\r\n            // check default object value\r\n            if (typeof defaultValue === 'object' && defaultValue) {\r\n                if (Array.isArray(defaultValue)) {\r\n                    // check array empty\r\n                    if (defaultValue.length > 0) {\r\n                        cc.errorID(3635, className, propName, propName);\r\n                        return;\r\n                    }\r\n                }\r\n                else if (!_isPlainEmptyObj_DEV(defaultValue)) {\r\n                    // check cloneable\r\n                    if (!_cloneable_DEV(defaultValue)) {\r\n                        cc.errorID(3636, className, propName, propName);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // check base prototype to avoid name collision\r\n        if (CCClass.getInheritanceChain(cls)\r\n                   .some(function (x) { return x.prototype.hasOwnProperty(propName); }))\r\n        {\r\n            cc.errorID(3637, className, propName, className);\r\n            return;\r\n        }\r\n    }\r\n\r\n    // set default value\r\n    Attr.setClassAttr(cls, propName, 'default', defaultValue);\r\n\r\n    appendProp(cls, propName);\r\n\r\n    // apply attributes\r\n    var attrs = parseAttributes(cls, val, className, propName, false);    \r\n    if (attrs) {\r\n        var onAfterProp = tmpArray;\r\n        for (var i = 0; i < attrs.length; i++) {\r\n            var attr = attrs[i];\r\n            Attr.attr(cls, propName, attr);\r\n            // register callback\r\n            if (attr._onAfterProp) {\r\n                onAfterProp.push(attr._onAfterProp);\r\n            }\r\n        }\r\n        // call callback\r\n        for (var c = 0; c < onAfterProp.length; c++) {\r\n            onAfterProp[c](cls, propName);\r\n        }\r\n        tmpArray.length = 0;\r\n        attrs.length = 0;\r\n    }\r\n}\r\n\r\nfunction defineGetSet (cls, name, propName, val, es6) {\r\n    var getter = val.get;\r\n    var setter = val.set;\r\n    var proto = cls.prototype;\r\n    var d = Object.getOwnPropertyDescriptor(proto, propName);\r\n    var setterUndefined = !d;\r\n\r\n    if (getter) {\r\n        if (CC_DEV && !es6 && d && d.get) {\r\n            cc.errorID(3638, name, propName);\r\n            return;\r\n        }\r\n\r\n        var attrs = parseAttributes(cls, val, name, propName, true);\r\n        for (var i = 0; i < attrs.length; i++) {\r\n            Attr.attr(cls, propName, attrs[i]);\r\n        }\r\n        attrs.length = 0;\r\n\r\n        Attr.setClassAttr(cls, propName, 'serializable', false);\r\n\r\n        if (CC_DEV) {\r\n            //  visible  props asset watcher \r\n            appendProp(cls, propName);\r\n        }\r\n\r\n        if (!es6) {\r\n            js.get(proto, propName, getter, setterUndefined, setterUndefined);\r\n        }\r\n\r\n        if (CC_EDITOR || CC_DEV) {\r\n            Attr.setClassAttr(cls, propName, 'hasGetter', true); //  editor \r\n        }\r\n    }\r\n\r\n    if (setter) {\r\n        if (!es6) {\r\n            if (CC_DEV && d && d.set) {\r\n                return cc.errorID(3640, name, propName);\r\n            }\r\n            js.set(proto, propName, setter, setterUndefined, setterUndefined);\r\n        }\r\n        if (CC_EDITOR || CC_DEV) {\r\n            Attr.setClassAttr(cls, propName, 'hasSetter', true); //  editor \r\n        }\r\n    }\r\n}\r\n\r\nfunction getDefault (defaultVal) {\r\n    if (typeof defaultVal === 'function') {\r\n        if (CC_EDITOR) {\r\n            try {\r\n                return defaultVal();\r\n            }\r\n            catch (e) {\r\n                cc._throw(e);\r\n                return undefined;\r\n            }\r\n        }\r\n        else {\r\n            return defaultVal();\r\n        }\r\n    }\r\n    return defaultVal;\r\n}\r\n\r\nfunction mixinWithInherited (dest, src, filter) {\r\n    for (var prop in src) {\r\n        if (!dest.hasOwnProperty(prop) && (!filter || filter(prop))) {\r\n            Object.defineProperty(dest, prop, js.getPropertyDescriptor(src, prop));\r\n        }\r\n    }\r\n}\r\n\r\nfunction doDefine (className, baseClass, mixins, options) {\r\n    var shouldAddProtoCtor;\r\n    var __ctor__ = options.__ctor__;\r\n    var ctor = options.ctor;\r\n    var __es6__ = options.__ES6__;\r\n\r\n    if (CC_DEV) {\r\n        // check ctor\r\n        var ctorToUse = __ctor__ || ctor;\r\n        if (ctorToUse) {\r\n            if (CCClass._isCCClass(ctorToUse)) {\r\n                cc.errorID(3618, className);\r\n            }\r\n            else if (typeof ctorToUse !== 'function') {\r\n                cc.errorID(3619, className);\r\n            }\r\n            else {\r\n                if (baseClass && /\\bprototype.ctor\\b/.test(ctorToUse)) {\r\n                    if (__es6__) {\r\n                        cc.errorID(3651, className || \"\");\r\n                    }\r\n                    else {\r\n                        cc.warnID(3600, className || \"\");\r\n                        shouldAddProtoCtor = true;\r\n                    }\r\n                }\r\n            }\r\n            if (ctor) {\r\n                if (__ctor__) {\r\n                    cc.errorID(3649, className);\r\n                }\r\n                else {\r\n                    ctor = options.ctor = _validateCtor_DEV(ctor, baseClass, className, options);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    var ctors;\r\n    var fireClass;\r\n    if (__es6__) {\r\n        ctors = [ctor];\r\n        fireClass = ctor;\r\n    }\r\n    else {\r\n        ctors = __ctor__ ? [__ctor__] : _getAllCtors(baseClass, mixins, options);\r\n        fireClass = _createCtor(ctors, baseClass, className, options);\r\n\r\n        // extend - Create a new Class that inherits from this Class\r\n        js.value(fireClass, 'extend', function (options) {\r\n            options.extends = this;\r\n            return CCClass(options);\r\n        }, true);\r\n    }\r\n\r\n    js.value(fireClass, '__ctors__', ctors.length > 0 ? ctors : null, true);\r\n\r\n\r\n    var prototype = fireClass.prototype;\r\n    if (baseClass) {\r\n        if (!__es6__) {\r\n            js.extend(fireClass, baseClass);        //  __props__ \r\n            prototype = fireClass.prototype;        // get extended prototype\r\n        }\r\n        fireClass.$super = baseClass;\r\n        if (CC_DEV && shouldAddProtoCtor) {\r\n            prototype.ctor = function () {};\r\n        }\r\n    }\r\n\r\n    if (mixins) {\r\n        for (var m = mixins.length - 1; m >= 0; m--) {\r\n            var mixin = mixins[m];\r\n            mixinWithInherited(prototype, mixin.prototype);\r\n\r\n            // mixin statics (this will also copy editor attributes for component)\r\n            mixinWithInherited(fireClass, mixin, function (prop) {\r\n                return mixin.hasOwnProperty(prop) && (!CC_DEV || INVALID_STATICS_DEV.indexOf(prop) < 0);\r\n            });\r\n\r\n            // mixin attributes\r\n            if (CCClass._isCCClass(mixin)) {\r\n                mixinWithInherited(\r\n                    Attr.getClassAttrs(fireClass).constructor.prototype,\r\n                    Attr.getClassAttrs(mixin).constructor.prototype\r\n                );\r\n            }\r\n        }\r\n        // restore constuctor overridden by mixin\r\n        prototype.constructor = fireClass;\r\n    }\r\n\r\n    if (!__es6__) {\r\n        prototype.__initProps__ = compileProps;\r\n    }\r\n\r\n    js.setClassName(className, fireClass);\r\n    return fireClass;\r\n}\r\n\r\nfunction define (className, baseClass, mixins, options) {\r\n    var Component = cc.Component;\r\n    var frame = cc._RF.peek();\r\n    if (frame && js.isChildClassOf(baseClass, Component)) {\r\n        // project component\r\n        if (js.isChildClassOf(frame.cls, Component)) {\r\n            cc.errorID(3615);\r\n            return null;\r\n        }\r\n        if (CC_DEV && frame.uuid && className) {\r\n            cc.warnID(3616, className);\r\n        }\r\n        className = className || frame.script;\r\n    }\r\n\r\n    var cls = doDefine(className, baseClass, mixins, options);\r\n\r\n    if (frame) {\r\n        if (js.isChildClassOf(baseClass, Component)) {\r\n            var uuid = frame.uuid;\r\n            if (uuid) {\r\n                js._setClassId(uuid, cls);\r\n                if (CC_EDITOR) {\r\n                    Component._addMenuItem(cls, 'i18n:MAIN_MENU.component.scripts/' + className, -1);\r\n                    cls.prototype.__scriptUuid = Editor.Utils.UuidUtils.decompressUuid(uuid);\r\n                }\r\n            }\r\n            frame.cls = cls;\r\n        }\r\n        else if (!js.isChildClassOf(frame.cls, Component)) {\r\n            frame.cls = cls;\r\n        }\r\n    }\r\n    return cls;\r\n}\r\n\r\nfunction normalizeClassName_DEV (className) {\r\n    var DefaultName = 'CCClass';\r\n    if (className) {\r\n        className = className.replace(/^[^$A-Za-z_]/, '_').replace(/[^0-9A-Za-z_$]/g, '_');\r\n        try {\r\n            // validate name\r\n            Function('function ' + className + '(){}')();\r\n            return className;\r\n        }\r\n        catch (e) {\r\n            ;\r\n        }\r\n    }\r\n    return DefaultName;\r\n}\r\n\r\nfunction getNewValueTypeCodeJit (value) {\r\n    var clsName = js.getClassName(value);\r\n    var type = value.constructor;\r\n    var res = 'new ' + clsName + '(';\r\n    for (var i = 0; i < type.__props__.length; i++) {\r\n        var prop = type.__props__[i];\r\n        var propVal = value[prop];\r\n        if (CC_DEV && typeof propVal === 'object') {\r\n            cc.errorID(3641, clsName);\r\n            return 'new ' + clsName + '()';\r\n        }\r\n        res += propVal;\r\n        if (i < type.__props__.length - 1) {\r\n            res += ',';\r\n        }\r\n    }\r\n    return res + ')';\r\n}\r\n\r\n// TODO - move escapeForJS, IDENTIFIER_RE, getNewValueTypeCodeJit to misc.js or a new source file\r\n\r\n// convert a normal string including newlines, quotes and unicode characters into a string literal\r\n// ready to use in JavaScript source\r\nfunction escapeForJS (s) {\r\n    return JSON.stringify(s).\r\n        // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify\r\n        replace(/\\u2028/g, '\\\\u2028').\r\n        replace(/\\u2029/g, '\\\\u2029');\r\n}\r\n\r\nfunction getInitPropsJit (attrs, propList) {\r\n    // functions for generated code\r\n    var F = [];\r\n    var func = '';\r\n\r\n    for (var i = 0; i < propList.length; i++) {\r\n        var prop = propList[i];\r\n        var attrKey = prop + DELIMETER + 'default';\r\n        if (attrKey in attrs) {  // getter does not have default\r\n            var statement;\r\n            if (IDENTIFIER_RE.test(prop)) {\r\n                statement = 'this.' + prop + '=';\r\n            }\r\n            else {\r\n                statement = 'this[' + escapeForJS(prop) + ']=';\r\n            }\r\n            var expression;\r\n            var def = attrs[attrKey];\r\n            if (typeof def === 'object' && def) {\r\n                if (def instanceof cc.ValueType) {\r\n                    expression = getNewValueTypeCodeJit(def);\r\n                }\r\n                else if (Array.isArray(def)) {\r\n                    expression = '[]';\r\n                }\r\n                else {\r\n                    expression = '{}';\r\n                }\r\n            }\r\n            else if (typeof def === 'function') {\r\n                var index = F.length;\r\n                F.push(def);\r\n                expression = 'F[' + index + ']()';\r\n                if (CC_EDITOR) {\r\n                    func += 'try {\\n' + statement + expression + ';\\n}\\ncatch(e) {\\ncc._throw(e);\\n' + statement + 'undefined;\\n}\\n';\r\n                    continue;\r\n                }\r\n            }\r\n            else if (typeof def === 'string') {\r\n                expression = escapeForJS(def);\r\n            }\r\n            else {\r\n                // number, boolean, null, undefined\r\n                expression = def;\r\n            }\r\n            statement = statement + expression + ';\\n';\r\n            func += statement;\r\n        }\r\n    }\r\n\r\n    // if (CC_TEST && !isPhantomJS) {\r\n    //     console.log(func);\r\n    // }\r\n\r\n    var initProps;\r\n    if (F.length === 0) {\r\n        initProps = Function(func);\r\n    }\r\n    else {\r\n        initProps = Function('F', 'return (function(){\\n' + func + '})')(F);\r\n    }\r\n\r\n    return initProps;\r\n}\r\n\r\nfunction getInitProps (attrs, propList) {\r\n    var advancedProps = [];\r\n    var advancedValues = [];\r\n    var simpleProps = [];\r\n    var simpleValues = [];\r\n\r\n    for (var i = 0; i < propList.length; ++i) {\r\n        var prop = propList[i];\r\n        var attrKey = prop + DELIMETER + 'default';\r\n        if (attrKey in attrs) { // getter does not have default\r\n            var def = attrs[attrKey];\r\n            if ((typeof def === 'object' && def) || typeof def === 'function') {\r\n                advancedProps.push(prop);\r\n                advancedValues.push(def);\r\n            }\r\n            else {\r\n                // number, boolean, null, undefined, string\r\n                simpleProps.push(prop);\r\n                simpleValues.push(def);\r\n            }\r\n        }\r\n    }\r\n\r\n    return function () {\r\n        for (let i = 0; i < simpleProps.length; ++i) {\r\n            this[simpleProps[i]] = simpleValues[i];\r\n        }\r\n        for (let i = 0; i < advancedProps.length; i++) {\r\n            let prop = advancedProps[i];\r\n            var expression;\r\n            var def = advancedValues[i];\r\n            if (typeof def === 'object') {\r\n                if (def instanceof cc.ValueType) {\r\n                    expression = def.clone();\r\n                }\r\n                else if (Array.isArray(def)) {\r\n                    expression = [];\r\n                }\r\n                else {\r\n                    expression = {};\r\n                }\r\n            }\r\n            else {\r\n                // def is function\r\n                if (CC_EDITOR) {\r\n                    try {\r\n                        expression = def();\r\n                    }\r\n                    catch (err) {\r\n                        cc._throw(e);\r\n                        continue;\r\n                    }\r\n                }\r\n                else {\r\n                    expression = def();\r\n                }\r\n            }\r\n            this[prop] = expression;\r\n        }\r\n    };\r\n}\r\n\r\n// simple test variable name\r\nvar IDENTIFIER_RE = /^[A-Za-z_$][0-9A-Za-z_$]*$/;\r\nfunction compileProps (actualClass) {\r\n    // init deferred properties\r\n    var attrs = Attr.getClassAttrs(actualClass);\r\n    var propList = actualClass.__props__;\r\n    if (propList === null) {\r\n        deferredInitializer.init();\r\n        propList = actualClass.__props__;\r\n    }\r\n\r\n    // Overwite __initProps__ to avoid compile again.\r\n    var initProps = CC_SUPPORT_JIT ? getInitPropsJit(attrs, propList) : getInitProps(attrs, propList);\r\n    actualClass.prototype.__initProps__ = initProps;\r\n\r\n    // call instantiateProps immediately, no need to pass actualClass into it anymore\r\n    // (use call to manually bind `this` because `this` may not instanceof actualClass)\r\n    initProps.call(this);\r\n}\r\n\r\nvar _createCtor = CC_SUPPORT_JIT ? function (ctors, baseClass, className, options) {\r\n    var superCallBounded = baseClass && boundSuperCalls(baseClass, options, className);\r\n\r\n    var ctorName = CC_DEV ? normalizeClassName_DEV(className) : 'CCClass';\r\n    var body = 'return function ' + ctorName + '(){\\n';\r\n\r\n    if (superCallBounded) {\r\n        body += 'this._super=null;\\n';\r\n    }\r\n\r\n    // instantiate props\r\n    body += 'this.__initProps__(' + ctorName + ');\\n';\r\n\r\n    // call user constructors\r\n    var ctorLen = ctors.length;\r\n    if (ctorLen > 0) {\r\n        var useTryCatch = CC_DEV && ! (className && className.startsWith('cc.'));\r\n        if (useTryCatch) {\r\n            body += 'try{\\n';\r\n        }\r\n        var SNIPPET = '].apply(this,arguments);\\n';\r\n        if (ctorLen === 1) {\r\n            body += ctorName + '.__ctors__[0' + SNIPPET;\r\n        }\r\n        else {\r\n            body += 'var cs=' + ctorName + '.__ctors__;\\n';\r\n            for (var i = 0; i < ctorLen; i++) {\r\n                body += 'cs[' + i + SNIPPET;\r\n            }\r\n        }\r\n        if (useTryCatch) {\r\n            body += '}catch(e){\\n' +\r\n                        'cc._throw(e);\\n' +\r\n                    '}\\n';\r\n        }\r\n    }\r\n    body += '}';\r\n\r\n    return Function(body)();\r\n} : function (ctors, baseClass, className, options) {\r\n    var superCallBounded = baseClass && boundSuperCalls(baseClass, options, className);\r\n    var ctorLen = ctors.length;\r\n\r\n    var Class;\r\n\r\n    if (ctorLen > 0) {\r\n        if (superCallBounded) {\r\n            if (ctorLen === 2) {\r\n                // User Component\r\n                Class = function () {\r\n                    this._super = null;\r\n                    this.__initProps__(Class);\r\n                    ctors[0].apply(this, arguments);\r\n                    ctors[1].apply(this, arguments);\r\n                };\r\n            }\r\n            else {\r\n                Class = function () {\r\n                    this._super = null;\r\n                    this.__initProps__(Class);\r\n                    for (let i = 0; i < ctors.length; ++i) {\r\n                        ctors[i].apply(this, arguments);\r\n                    }\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            if (ctorLen === 3) {\r\n                // Node\r\n                Class = function () {\r\n                    this.__initProps__(Class);\r\n                    ctors[0].apply(this, arguments);\r\n                    ctors[1].apply(this, arguments);\r\n                    ctors[2].apply(this, arguments);\r\n                };\r\n            }\r\n            else {\r\n                Class = function () {\r\n                    this.__initProps__(Class);\r\n                    var ctors = Class.__ctors__;\r\n                    for (let i = 0; i < ctors.length; ++i) {\r\n                        ctors[i].apply(this, arguments);\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        Class = function () {\r\n            if (superCallBounded) {\r\n                this._super = null;\r\n            }\r\n            this.__initProps__(Class);\r\n        };\r\n    }\r\n    return Class;\r\n};\r\n\r\nfunction _validateCtor_DEV (ctor, baseClass, className, options) {\r\n    if (CC_EDITOR && baseClass) {\r\n        // check super call in constructor\r\n        var originCtor = ctor;\r\n        if (SuperCallReg.test(ctor)) {\r\n            if (options.__ES6__) {\r\n                cc.errorID(3651, className);\r\n            }\r\n            else {\r\n                cc.warnID(3600, className);\r\n                // suppresss super call\r\n                ctor = function () {\r\n                    this._super = function () {};\r\n                    var ret = originCtor.apply(this, arguments);\r\n                    this._super = null;\r\n                    return ret;\r\n                };\r\n            }\r\n        }\r\n    }\r\n\r\n    // check ctor\r\n    if (ctor.length > 0 && (!className || !className.startsWith('cc.'))) {\r\n        // To make a unified CCClass serialization process,\r\n        // we don't allow parameters for constructor when creating instances of CCClass.\r\n        // For advanced user, construct arguments can still get from 'arguments'.\r\n        cc.warnID(3617, className);\r\n    }\r\n\r\n    return ctor;\r\n}\r\n\r\nfunction _getAllCtors (baseClass, mixins, options) {\r\n    // get base user constructors\r\n    function getCtors (cls) {\r\n        if (CCClass._isCCClass(cls)) {\r\n            return cls.__ctors__ || [];\r\n        }\r\n        else {\r\n            return [cls];\r\n        }\r\n    }\r\n\r\n    var ctors = [];\r\n    // if (options.__ES6__) {\r\n    //     if (mixins) {\r\n    //         let baseOrMixins = getCtors(baseClass);\r\n    //         for (let b = 0; b < mixins.length; b++) {\r\n    //             let mixin = mixins[b];\r\n    //             if (mixin) {\r\n    //                 let baseCtors = getCtors(mixin);\r\n    //                 for (let c = 0; c < baseCtors.length; c++) {\r\n    //                     if (baseOrMixins.indexOf(baseCtors[c]) < 0) {\r\n    //                         pushUnique(ctors, baseCtors[c]);\r\n    //                     }\r\n    //                 }\r\n    //             }\r\n    //         }\r\n    //     }\r\n    // }\r\n    // else {\r\n    let baseOrMixins = [baseClass].concat(mixins);\r\n    for (let b = 0; b < baseOrMixins.length; b++) {\r\n        let baseOrMixin = baseOrMixins[b];\r\n        if (baseOrMixin) {\r\n            let baseCtors = getCtors(baseOrMixin);\r\n            for (let c = 0; c < baseCtors.length; c++) {\r\n                pushUnique(ctors, baseCtors[c]);\r\n            }\r\n        }\r\n    }\r\n    // }\r\n\r\n    // append subclass user constructors\r\n    var ctor = options.ctor;\r\n    if (ctor) {\r\n        ctors.push(ctor);\r\n    }\r\n\r\n    return ctors;\r\n}\r\n\r\nvar SuperCallReg = /xyz/.test(function(){xyz}) ? /\\b\\._super\\b/ : /.*/;\r\nvar SuperCallRegStrict = /xyz/.test(function(){xyz}) ? /this\\._super\\s*\\(/ : /(NONE){99}/;\r\nfunction boundSuperCalls (baseClass, options, className) {\r\n    var hasSuperCall = false;\r\n    for (var funcName in options) {\r\n        if (BUILTIN_ENTRIES.indexOf(funcName) >= 0) {\r\n            continue;\r\n        }\r\n        var func = options[funcName];\r\n        if (typeof func !== 'function') {\r\n            continue;\r\n        }\r\n        var pd = js.getPropertyDescriptor(baseClass.prototype, funcName);\r\n        if (pd) {\r\n            var superFunc = pd.value;\r\n            // ignore pd.get, assume that function defined by getter is just for warnings\r\n            if (typeof superFunc === 'function') {\r\n                if (SuperCallReg.test(func)) {\r\n                    hasSuperCall = true;\r\n                    // boundSuperCall\r\n                    options[funcName] = (function (superFunc, func) {\r\n                        return function () {\r\n                            var tmp = this._super;\r\n\r\n                            // Add a new ._super() method that is the same method but on the super-Class\r\n                            this._super = superFunc;\r\n\r\n                            var ret = func.apply(this, arguments);\r\n\r\n                            // The method only need to be bound temporarily, so we remove it when we're done executing\r\n                            this._super = tmp;\r\n\r\n                            return ret;\r\n                        };\r\n                    })(superFunc, func);\r\n                }\r\n                continue;\r\n            }\r\n        }\r\n        if (CC_DEV && SuperCallRegStrict.test(func)) {\r\n            cc.warnID(3620, className, funcName);\r\n        }\r\n    }\r\n    return hasSuperCall;\r\n}\r\n\r\nfunction declareProperties (cls, className, properties, baseClass, mixins, es6) {\r\n    cls.__props__ = [];\r\n\r\n    if (baseClass && baseClass.__props__) {\r\n        cls.__props__ = baseClass.__props__.slice();\r\n    }\r\n\r\n    if (mixins) {\r\n        for (var m = 0; m < mixins.length; ++m) {\r\n            var mixin = mixins[m];\r\n            if (mixin.__props__) {\r\n                cls.__props__ = cls.__props__.concat(mixin.__props__.filter(function (x) {\r\n                    return cls.__props__.indexOf(x) < 0;\r\n                }));\r\n            }\r\n        }\r\n    }\r\n\r\n    if (properties) {\r\n        // \r\n        preprocess.preprocessAttrs(properties, className, cls, es6);\r\n\r\n        for (var propName in properties) {\r\n            var val = properties[propName];\r\n            if ('default' in val) {\r\n                defineProp(cls, className, propName, val, es6);\r\n            }\r\n            else {\r\n                defineGetSet(cls, className, propName, val, es6);\r\n            }\r\n        }\r\n    }\r\n\r\n    var attrs = Attr.getClassAttrs(cls);\r\n    cls.__values__ = cls.__props__.filter(function (prop) {\r\n        return attrs[prop + DELIMETER + 'serializable'] !== false;\r\n    });\r\n}\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en Defines a CCClass using the given specification, please see [Class](/docs/editors_and_tools/creator-chapters/scripting/class.html) for details.\r\n * !#zh  CCClass[](/docs/creator/scripting/class.html)\r\n *\r\n * @method Class\r\n *\r\n * @param {Object} [options]\r\n * @param {String} [options.name] - The class name used for serialization.\r\n * @param {Function} [options.extends] - The base class.\r\n * @param {Function} [options.ctor] - The constructor.\r\n * @param {Function} [options.__ctor__] - The same as ctor, but less encapsulated.\r\n * @param {Object} [options.properties] - The property definitions.\r\n * @param {Object} [options.statics] - The static members.\r\n * @param {Function[]} [options.mixins]\r\n *\r\n * @param {Object} [options.editor] - attributes for Component listed below.\r\n * @param {Boolean} [options.editor.executeInEditMode=false] - Allows the current component to run in edit mode. By default, all components are executed only at runtime, meaning that they will not have their callback functions executed while the Editor is in edit mode.\r\n * @param {Function} [options.editor.requireComponent] - Automatically add required component as a dependency.\r\n * @param {String} [options.editor.menu] - The menu path to register a component to the editors \"Component\" menu. Eg. \"Rendering/Camera\".\r\n * @param {Number} [options.editor.executionOrder=0] - The execution order of lifecycle methods for Component. Those less than 0 will execute before while those greater than 0 will execute after. The order will only affect onLoad, onEnable, start, update and lateUpdate while onDisable and onDestroy will not be affected.\r\n * @param {Boolean} [options.editor.disallowMultiple] - If specified to a type, prevents Component of the same type (or subtype) to be added more than once to a Node.\r\n * @param {Boolean} [options.editor.playOnFocus=false] - This property is only available when executeInEditMode is set. If specified, the editor's scene view will keep updating this node in 60 fps when it is selected, otherwise, it will update only if necessary.\r\n * @param {String} [options.editor.inspector] - Customize the page url used by the current component to render in the Properties.\r\n * @param {String} [options.editor.icon] - Customize the icon that the current component displays in the editor.\r\n * @param {String} [options.editor.help] - The custom documentation URL\r\n *\r\n * @param {Function} [options.update] - lifecycle method for Component, see {{#crossLink \"Component/update:method\"}}{{/crossLink}}\r\n * @param {Function} [options.lateUpdate] - lifecycle method for Component, see {{#crossLink \"Component/lateUpdate:method\"}}{{/crossLink}}\r\n * @param {Function} [options.onLoad] - lifecycle method for Component, see {{#crossLink \"Component/onLoad:method\"}}{{/crossLink}}\r\n * @param {Function} [options.start] - lifecycle method for Component, see {{#crossLink \"Component/start:method\"}}{{/crossLink}}\r\n * @param {Function} [options.onEnable] - lifecycle method for Component, see {{#crossLink \"Component/onEnable:method\"}}{{/crossLink}}\r\n * @param {Function} [options.onDisable] - lifecycle method for Component, see {{#crossLink \"Component/onDisable:method\"}}{{/crossLink}}\r\n * @param {Function} [options.onDestroy] - lifecycle method for Component, see {{#crossLink \"Component/onDestroy:method\"}}{{/crossLink}}\r\n * @param {Function} [options.onFocusInEditor] - lifecycle method for Component, see {{#crossLink \"Component/onFocusInEditor:method\"}}{{/crossLink}}\r\n * @param {Function} [options.onLostFocusInEditor] - lifecycle method for Component, see {{#crossLink \"Component/onLostFocusInEditor:method\"}}{{/crossLink}}\r\n * @param {Function} [options.resetInEditor] - lifecycle method for Component, see {{#crossLink \"Component/resetInEditor:method\"}}{{/crossLink}}\r\n * @param {Function} [options.onRestore] - for Component only, see {{#crossLink \"Component/onRestore:method\"}}{{/crossLink}}\r\n * @param {Function} [options._getLocalBounds] - for Component only, see {{#crossLink \"Component/_getLocalBounds:method\"}}{{/crossLink}}\r\n *\r\n * @return {Function} - the created class\r\n *\r\n * @example\r\n\r\n // define base class\r\n var Node = cc.Class();\r\n\r\n // define sub class\r\n var Sprite = cc.Class({\r\n     name: 'Sprite',\r\n     extends: Node,\r\n\r\n     ctor: function () {\r\n         this.url = \"\";\r\n         this.id = 0;\r\n     },\r\n\r\n     statics: {\r\n         // define static members\r\n         count: 0,\r\n         getBounds: function (spriteList) {\r\n             // compute bounds...\r\n         }\r\n     },\r\n\r\n     properties {\r\n         width: {\r\n             default: 128,\r\n             type: 'Integer',\r\n             tooltip: 'The width of sprite'\r\n         },\r\n         height: 128,\r\n         size: {\r\n             get: function () {\r\n                 return cc.v2(this.width, this.height);\r\n             }\r\n         }\r\n     },\r\n\r\n     load: function () {\r\n         // load this.url...\r\n     };\r\n });\r\n\r\n // instantiate\r\n\r\n var obj = new Sprite();\r\n obj.url = 'sprite.png';\r\n obj.load();\r\n */\r\nfunction CCClass (options) {\r\n    options = options || {};\r\n\r\n    var name = options.name;\r\n    var base = options.extends/* || CCObject*/;\r\n    var mixins = options.mixins;\r\n\r\n    // create constructor\r\n    var cls = define(name, base, mixins, options);\r\n    if (!name) {\r\n        name = cc.js.getClassName(cls);\r\n    }\r\n\r\n    cls._sealed = true;\r\n    if (base) {\r\n        base._sealed = false;\r\n    }\r\n\r\n    // define Properties\r\n    var properties = options.properties;\r\n    if (typeof properties === 'function' ||\r\n        (base && base.__props__ === null) ||\r\n        (mixins && mixins.some(function (x) {\r\n            return x.__props__ === null;\r\n        }))\r\n    ) {\r\n        if (CC_DEV && options.__ES6__) {\r\n            cc.error('not yet implement deferred properties for ES6 Classes');\r\n        }\r\n        else {\r\n            deferredInitializer.push({cls: cls, props: properties, mixins: mixins});\r\n            cls.__props__ = cls.__values__ = null;\r\n        }\r\n    }\r\n    else {\r\n        declareProperties(cls, name, properties, base, options.mixins, options.__ES6__);\r\n    }\r\n\r\n    // define statics\r\n    var statics = options.statics;\r\n    if (statics) {\r\n        var staticPropName;\r\n        if (CC_DEV) {\r\n            for (staticPropName in statics) {\r\n                if (INVALID_STATICS_DEV.indexOf(staticPropName) !== -1) {\r\n                    cc.errorID(3642, name, staticPropName,\r\n                        staticPropName);\r\n                }\r\n            }\r\n        }\r\n        for (staticPropName in statics) {\r\n            cls[staticPropName] = statics[staticPropName];\r\n        }\r\n    }\r\n\r\n    // define functions\r\n    for (var funcName in options) {\r\n        if (BUILTIN_ENTRIES.indexOf(funcName) >= 0) {\r\n            continue;\r\n        }\r\n        var func = options[funcName];\r\n        if (!preprocess.validateMethodWithProps(func, funcName, name, cls, base)) {\r\n            continue;\r\n        }\r\n        // use value to redefine some super method defined as getter\r\n        js.value(cls.prototype, funcName, func, true, true);\r\n    }\r\n\r\n\r\n    var editor = options.editor;\r\n    if (editor) {\r\n        if (js.isChildClassOf(base, cc.Component)) {\r\n            cc.Component._registerEditorProps(cls, editor);\r\n        }\r\n        else if (CC_DEV) {\r\n            cc.warnID(3623, name);\r\n        }\r\n    }\r\n\r\n    return cls;\r\n}\r\n\r\n/**\r\n * Checks whether the constructor is created by cc.Class\r\n *\r\n * @method _isCCClass\r\n * @param {Function} constructor\r\n * @return {Boolean}\r\n * @private\r\n */\r\nCCClass._isCCClass = function (constructor) {\r\n    return constructor &&\r\n           constructor.hasOwnProperty('__ctors__');     // is not inherited __ctors__\r\n};\r\n\r\n//\r\n// Optimized define function only for internal classes\r\n//\r\n// @method _fastDefine\r\n// @param {String} className\r\n// @param {Function} constructor\r\n// @param {Object} serializableFields\r\n// @private\r\n//\r\nCCClass._fastDefine = function (className, constructor, serializableFields) {\r\n    js.setClassName(className, constructor);\r\n    //constructor.__ctors__ = constructor.__ctors__ || null;\r\n    var props = constructor.__props__ = constructor.__values__ = Object.keys(serializableFields);\r\n    var attrProtos = Attr.getClassAttrsProto(constructor);\r\n    for (var i = 0; i < props.length; i++) {\r\n        var key = props[i];\r\n        attrProtos[key + DELIMETER + 'visible'] = false;\r\n        attrProtos[key + DELIMETER + 'default'] = serializableFields[key];\r\n    }\r\n};\r\n\r\nCCClass.Attr = Attr;\r\nCCClass.attr = Attr.attr;\r\n\r\n/*\r\n * Return all super classes\r\n * @method getInheritanceChain\r\n * @param {Function} constructor\r\n * @return {Function[]}\r\n */\r\nCCClass.getInheritanceChain = function (klass) {\r\n    var chain = [];\r\n    for (;;) {\r\n        klass = js.getSuper(klass);\r\n        if (!klass) {\r\n            break;\r\n        }\r\n        if (klass !== Object) {\r\n            chain.push(klass);\r\n        }\r\n    }\r\n    return chain;\r\n};\r\n\r\nvar PrimitiveTypes = {\r\n    // Specify that the input value must be integer in Properties.\r\n    // Also used to indicates that the type of elements in array or the type of value in dictionary is integer.\r\n    Integer: 'Number',\r\n    // Indicates that the type of elements in array or the type of value in dictionary is double.\r\n    Float: 'Number',\r\n    Boolean: 'Boolean',\r\n    String: 'String',\r\n};\r\nvar tmpAttrs = [];\r\nfunction parseAttributes (cls, attrs, className, propName, usedInGetter) {\r\n    var ERR_Type = CC_DEV ? 'The %s of %s must be type %s' : '';\r\n\r\n    var attrsProto = null;\r\n    var attrsProtoKey = '';\r\n    function getAttrsProto () {\r\n        attrsProtoKey = propName + DELIMETER;\r\n        return attrsProto = Attr.getClassAttrsProto(cls);\r\n    }\r\n\r\n    tmpAttrs.length = 0;\r\n    var result = tmpAttrs;\r\n\r\n    var type = attrs.type;\r\n    if (type) {\r\n        var primitiveType = PrimitiveTypes[type];\r\n        if (primitiveType) {\r\n            result.push({\r\n                type: type,\r\n                _onAfterProp: getTypeChecker(primitiveType, 'cc.' + type)\r\n            });\r\n        }\r\n        else if (type === 'Object') {\r\n            if (CC_DEV) {\r\n                cc.errorID(3644, className, propName);\r\n            }\r\n        }\r\n        else {\r\n            if (type === Attr.ScriptUuid) {\r\n                var attr = Attr.ObjectType(cc.ScriptAsset);\r\n                attr.type = 'Script';\r\n                result.push(attr);\r\n            }\r\n            else {\r\n                if (typeof type === 'object') {\r\n                    if (Enum.isEnum(type)) {\r\n                        result.push({\r\n                            type: 'Enum',\r\n                            enumList: Enum.getList(type)\r\n                        });\r\n                    }\r\n                    else if (CC_DEV) {\r\n                        cc.errorID(3645, className, propName, type);\r\n                    }\r\n                }\r\n                else if (typeof type === 'function') {\r\n                    if (attrs.url) {\r\n                        result.push({\r\n                            type: 'Object',\r\n                            ctor: type,\r\n                            _onAfterProp: getTypeChecker('String', 'cc.String')\r\n                        });\r\n                    }\r\n                    else {\r\n                        result.push(attrs._short ? {\r\n                            type: 'Object',\r\n                            ctor: type\r\n                        } : Attr.ObjectType(type));\r\n                    }\r\n                }\r\n                else if (CC_DEV) {\r\n                    cc.errorID(3646, className, propName, type);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function parseSimpleAttr (attrName, expectType) {\r\n        if (attrName in attrs) {\r\n            var val = attrs[attrName];\r\n            if (typeof val === expectType) {\r\n                (attrsProto || getAttrsProto())[attrsProtoKey + attrName] = val;\r\n            }\r\n            else if (CC_DEV) {\r\n                cc.error(ERR_Type, attrName, className, propName, expectType);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (attrs.editorOnly) {\r\n        if (CC_DEV && usedInGetter) {\r\n            cc.errorID(3613, \"editorOnly\", name, propName);\r\n        }\r\n        else {\r\n            (attrsProto || getAttrsProto())[attrsProtoKey + 'editorOnly'] = true;\r\n        }\r\n    }\r\n    //parseSimpleAttr('preventDeferredLoad', 'boolean');\r\n    if (CC_DEV) {\r\n        parseSimpleAttr('displayName', 'string');\r\n        parseSimpleAttr('multiline', 'boolean');\r\n        if (attrs.readonly) {\r\n            (attrsProto || getAttrsProto())[attrsProtoKey + 'readonly'] = true;\r\n        }\r\n        parseSimpleAttr('tooltip', 'string');\r\n        parseSimpleAttr('slide', 'boolean');\r\n    }\r\n\r\n    if (attrs.url) {\r\n        (attrsProto || getAttrsProto())[attrsProtoKey + 'saveUrlAsAsset'] = true;\r\n    }\r\n    if (attrs.serializable === false) {\r\n        if (CC_DEV && usedInGetter) {\r\n            cc.errorID(3613, \"serializable\", name, propName);\r\n        }\r\n        else {\r\n            (attrsProto || getAttrsProto())[attrsProtoKey + 'serializable'] = false;\r\n        }\r\n    }\r\n    parseSimpleAttr('formerlySerializedAs', 'string');\r\n\r\n    if (CC_EDITOR) {\r\n        if ('animatable' in attrs && !attrs.animatable) {\r\n            (attrsProto || getAttrsProto())[attrsProtoKey + 'animatable'] = false;\r\n        }\r\n    }\r\n\r\n    if (CC_DEV) {\r\n        var visible = attrs.visible;\r\n        if (typeof visible !== 'undefined') {\r\n            if (!visible) {\r\n                (attrsProto || getAttrsProto())[attrsProtoKey + 'visible'] = false;\r\n            }\r\n            else if (typeof visible === 'function') {\r\n                (attrsProto || getAttrsProto())[attrsProtoKey + 'visible'] = visible;\r\n            }\r\n        }\r\n        else {\r\n            var startsWithUS = (propName.charCodeAt(0) === 95);\r\n            if (startsWithUS) {\r\n                (attrsProto || getAttrsProto())[attrsProtoKey + 'visible'] = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    var range = attrs.range;\r\n    if (range) {\r\n        if (Array.isArray(range)) {\r\n            if (range.length >= 2) {\r\n                (attrsProto || getAttrsProto())[attrsProtoKey + 'min'] = range[0];\r\n                attrsProto[attrsProtoKey + 'max'] = range[1];\r\n                if (range.length > 2) {\r\n                    attrsProto[attrsProtoKey + 'step'] = range[2];\r\n                }\r\n            }\r\n            else if (CC_DEV) {\r\n                cc.errorID(3647);\r\n            }\r\n        }\r\n        else if (CC_DEV) {\r\n            cc.error(ERR_Type, 'range', className, propName, 'array');\r\n        }\r\n    }\r\n    parseSimpleAttr('min', 'number');\r\n    parseSimpleAttr('max', 'number');\r\n    parseSimpleAttr('step', 'number');\r\n\r\n    return result;\r\n}\r\n\r\ncc.Class = CCClass;\r\n\r\nmodule.exports = {\r\n    isArray: function (defaultVal) {\r\n        defaultVal = getDefault(defaultVal);\r\n        return Array.isArray(defaultVal);\r\n    },\r\n    fastDefine: CCClass._fastDefine,\r\n    getNewValueTypeCode: CC_SUPPORT_JIT && getNewValueTypeCodeJit,\r\n    IDENTIFIER_RE,\r\n    escapeForJS,\r\n    getDefault: getDefault\r\n};\r\n\r\nif (CC_TEST) {\r\n    js.mixin(CCClass, module.exports);\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n// const FIX_BABEL6 = true;\r\n\r\n/**\r\n * !#en Some JavaScript decorators which can be accessed with \"cc._decorator\".\r\n * !#zh  JavaScript  \"cc._decorator\" \r\n *  API  JavaScript \r\n *\r\n * @submodule _decorator\r\n * @module _decorator\r\n * @main\r\n */\r\n\r\n// inspired by toddlxt (https://github.com/toddlxt/Creator-TypeScript-Boilerplate)\r\n\r\nrequire('./CCClass');\r\nconst Preprocess = require('./preprocess-class');\r\nconst js = require('./js');\r\nconst isPlainEmptyObj_DEV = CC_DEV && require('./utils').isPlainEmptyObj_DEV;\r\n\r\n// caches for class construction\r\nconst CACHE_KEY = '__ccclassCache__';\r\n\r\nfunction fNOP (ctor) {\r\n    return ctor;\r\n}\r\n\r\nfunction getSubDict (obj, key) {\r\n    return obj[key] || (obj[key] = {});\r\n}\r\n\r\nfunction checkCtorArgument (decorate) {\r\n    return function (target) {\r\n        if (typeof target === 'function') {\r\n            // no parameter, target is ctor\r\n            return decorate(target);\r\n        }\r\n        return function (ctor) {\r\n            return decorate(ctor, target);\r\n        };\r\n    };\r\n}\r\n\r\nfunction _checkNormalArgument (validator_DEV, decorate, decoratorName) {\r\n    return function (target) {\r\n        if (CC_DEV && validator_DEV(target, decoratorName) === false) {\r\n            return function () {\r\n                return fNOP;\r\n            };\r\n        }\r\n        return function (ctor) {\r\n            return decorate(ctor, target);\r\n        };\r\n    };\r\n}\r\n\r\nvar checkCompArgument = _checkNormalArgument.bind(null, CC_DEV && function (arg, decoratorName) {\r\n    if (!cc.Class._isCCClass(arg)) {\r\n        cc.error('The parameter for %s is missing.', decoratorName);\r\n        return false;\r\n    }\r\n});\r\n\r\nfunction _argumentChecker (type) {\r\n    return _checkNormalArgument.bind(null, CC_DEV && function (arg, decoratorName) {\r\n        if (arg instanceof cc.Component || arg === undefined) {\r\n            cc.error('The parameter for %s is missing.', decoratorName);\r\n            return false;\r\n        }\r\n        else if (typeof arg !== type) {\r\n            cc.error('The parameter for %s must be type %s.', decoratorName, type);\r\n            return false;\r\n        }\r\n    });\r\n}\r\nvar checkStringArgument = _argumentChecker('string');\r\nvar checkNumberArgument = _argumentChecker('number');\r\n// var checkBooleanArgument = _argumentChecker('boolean');\r\n\r\n\r\nfunction getClassCache (ctor, decoratorName) {\r\n    if (CC_DEV && cc.Class._isCCClass(ctor)) {\r\n        cc.error('`@%s` should be used after @ccclass for class \"%s\"', decoratorName, js.getClassName(ctor));\r\n        return null;\r\n    }\r\n    return getSubDict(ctor, CACHE_KEY);\r\n}\r\n\r\nfunction getDefaultFromInitializer (initializer) {\r\n    var value;\r\n    try {\r\n        value = initializer();\r\n    }\r\n    catch (e) {\r\n        // just lazy initialize by CCClass\r\n        return initializer;\r\n    }\r\n    if (typeof value !== 'object' || value === null) {\r\n        // string boolean number function undefined null\r\n        return value;\r\n    }\r\n    else {\r\n        // The default attribute will not be used in ES6 constructor actually,\r\n        // so we dont need to simplify into `{}` or `[]` or vec2 completely.\r\n        return initializer;\r\n    }\r\n}\r\n\r\n\r\nfunction extractActualDefaultValues (ctor) {\r\n    var dummyObj;\r\n    try {\r\n        dummyObj = new ctor();\r\n    }\r\n    catch (e) {\r\n        if (CC_DEV) {\r\n            cc.warnID(3652, js.getClassName(ctor), e);\r\n        }\r\n        return {};\r\n    }\r\n    return dummyObj;\r\n}\r\n\r\nfunction genProperty (ctor, properties, propName, options, desc, cache) {\r\n    var fullOptions;\r\n    if (options) {\r\n        fullOptions = CC_DEV ? Preprocess.getFullFormOfProperty(options, propName, js.getClassName(ctor)) :\r\n                               Preprocess.getFullFormOfProperty(options);\r\n        fullOptions = fullOptions || options;\r\n    }\r\n    var existsProperty = properties[propName];\r\n    var prop = js.mixin(existsProperty || {}, fullOptions || {});\r\n\r\n    var isGetset = desc && (desc.get || desc.set);\r\n    if (isGetset) {\r\n        // typescript or babel\r\n        if (CC_DEV && options && (options.get || options.set)) {\r\n            var errorProps = getSubDict(cache, 'errorProps');\r\n            if (!errorProps[propName]) {\r\n                errorProps[propName] = true;\r\n                cc.warnID(3655, propName, js.getClassName(ctor), propName, propName);\r\n            }\r\n        }\r\n        if (desc.get) {\r\n            prop.get = desc.get;\r\n        }\r\n        if (desc.set) {\r\n            prop.set = desc.set;\r\n        }\r\n    }\r\n    else {\r\n        if (CC_DEV && (prop.get || prop.set)) {\r\n            // @property({\r\n            //     get () { ... },\r\n            //     set (...) { ... },\r\n            // })\r\n            // value;\r\n            cc.errorID(3655, propName, js.getClassName(ctor), propName, propName);\r\n            return;\r\n        }\r\n        // member variables\r\n        var defaultValue = undefined;\r\n        var isDefaultValueSpecified = false;\r\n        if (desc) {\r\n            // babel\r\n            if (desc.initializer) {\r\n                // @property(...)\r\n                // value = null;\r\n                defaultValue = getDefaultFromInitializer(desc.initializer);\r\n                isDefaultValueSpecified = true;\r\n            }\r\n            else {\r\n                // @property(...)\r\n                // value;\r\n            }\r\n        }\r\n        else {\r\n            // typescript\r\n            var actualDefaultValues = cache.default || (cache.default = extractActualDefaultValues(ctor));\r\n            if (actualDefaultValues.hasOwnProperty(propName)) {\r\n                // @property(...)\r\n                // value = null;\r\n                defaultValue = actualDefaultValues[propName];\r\n                isDefaultValueSpecified = true;\r\n            }\r\n            else {\r\n                // @property(...)\r\n                // value;\r\n            }\r\n        }\r\n\r\n        if (CC_DEV) {\r\n            if (options && options.hasOwnProperty('default')) {\r\n                cc.warnID(3653, propName, js.getClassName(ctor));\r\n                // prop.default = options.default;\r\n            }\r\n            else if (!isDefaultValueSpecified) {\r\n                cc.warnID(3654, js.getClassName(ctor), propName);\r\n                // prop.default = fullOptions.hasOwnProperty('default') ? fullOptions.default : undefined;\r\n            }\r\n            if (cc.RawAsset.wasRawAssetType(prop.url) &&\r\n                prop._short &&\r\n                isDefaultValueSpecified &&\r\n                defaultValue == null\r\n            ) {\r\n                cc.warnID(3656, js.getClassName(ctor), propName);\r\n            }\r\n        }\r\n        prop.default = defaultValue;\r\n    }\r\n\r\n    properties[propName] = prop;\r\n}\r\n\r\n/**\r\n * !#en\r\n * Declare the standard [ES6 Class](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes)\r\n * as CCClass, please see [Class](../../../manual/en/scripting/class.html) for details.\r\n * !#zh\r\n *  [ES6 Class](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes)  CCClass[](../../../manual/zh/scripting/class.html)\r\n *\r\n * @method ccclass\r\n * @param {String} [name] - The class name used for serialization.\r\n * @example\r\n * const {ccclass} = cc._decorator;\r\n *\r\n * // define a CCClass, omit the name\r\n * &#64;ccclass\r\n * class NewScript extends cc.Component {\r\n *     // ...\r\n * }\r\n *\r\n * // define a CCClass with a name\r\n * &#64;ccclass('LoginData')\r\n * class LoginData {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * ccclass(name?: string): Function\r\n * ccclass(_class?: Function): void\r\n */\r\nvar ccclass = checkCtorArgument(function (ctor, name) {\r\n    // if (FIX_BABEL6) {\r\n    //     eval('if(typeof _classCallCheck===\"function\"){_classCallCheck=function(){};}');\r\n    // }\r\n    var base = js.getSuper(ctor);\r\n    if (base === Object) {\r\n        base = null;\r\n    }\r\n\r\n    var proto = {\r\n        name,\r\n        extends: base,\r\n        ctor,\r\n        __ES6__: true,\r\n    };\r\n    var cache = ctor[CACHE_KEY];\r\n    if (cache) {\r\n        var decoratedProto = cache.proto;\r\n        if (decoratedProto) {\r\n            // decoratedProto.properties = createProperties(ctor, decoratedProto.properties);\r\n            js.mixin(proto, decoratedProto);\r\n        }\r\n        ctor[CACHE_KEY] = undefined;\r\n    }\r\n\r\n    var res = cc.Class(proto);\r\n\r\n    // validate methods\r\n    if (CC_DEV) {\r\n        var propNames = Object.getOwnPropertyNames(ctor.prototype);\r\n        for (var i = 0; i < propNames.length; ++i) {\r\n            var prop = propNames[i];\r\n            if (prop !== 'constructor') {\r\n                var desc = Object.getOwnPropertyDescriptor(ctor.prototype, prop);\r\n                var func = desc && desc.value;\r\n                if (typeof func === 'function') {\r\n                    Preprocess.doValidateMethodWithProps_DEV(func, prop, js.getClassName(ctor), ctor, base);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return res;\r\n});\r\n\r\n/**\r\n * !#en\r\n * Declare property for [CCClass](../../../manual/en/scripting/reference/attributes.html).\r\n * !#zh\r\n *  [CCClass](../../../manual/zh/scripting/reference/attributes.html) \r\n *\r\n * @method property\r\n * @param {Object} [options] - an object with some property attributes\r\n * @param {Any} [options.type]\r\n * @param {Boolean|Function} [options.visible]\r\n * @param {String} [options.displayName]\r\n * @param {String} [options.tooltip]\r\n * @param {Boolean} [options.multiline]\r\n * @param {Boolean} [options.readonly]\r\n * @param {Number} [options.min]\r\n * @param {Number} [options.max]\r\n * @param {Number} [options.step]\r\n * @param {Number[]} [options.range]\r\n * @param {Boolean} [options.slide]\r\n * @param {Boolean} [options.serializable]\r\n * @param {Boolean} [options.editorOnly]\r\n * @param {Boolean} [options.override]\r\n * @param {Boolean} [options.animatable]\r\n * @param {String} [options.formerlySerializedAs]\r\n * @example\r\n * const {ccclass, property} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * class NewScript extends cc.Component {\r\n *     &#64;property({\r\n *         type: cc.Node\r\n *     })\r\n *     targetNode1 = null;\r\n *\r\n *     &#64;property(cc.Node)\r\n *     targetNode2 = null;\r\n *\r\n *     &#64;property(cc.Button)\r\n *     targetButton = null;\r\n *\r\n *     &#64;property\r\n *     _width = 100;\r\n *\r\n *     &#64;property\r\n *     get width () {\r\n *         return this._width;\r\n *     }\r\n *\r\n *     &#64;property\r\n *     set width (value) {\r\n *         this._width = value;\r\n *     }\r\n *\r\n *     &#64;property\r\n *     offset = new cc.Vec2(100, 100);\r\n *\r\n *     &#64;property(cc.Vec2)\r\n *     offsets = [];\r\n *\r\n *     &#64;property(cc.SpriteFrame)\r\n *     frame = null;\r\n * }\r\n *\r\n * // above is equivalent to ():\r\n *\r\n * var NewScript = cc.Class({\r\n *     properties: {\r\n *         targetNode1: {\r\n *             default: null,\r\n *             type: cc.Node\r\n *         },\r\n *\r\n *         targetNode2: {\r\n *             default: null,\r\n *             type: cc.Node\r\n *         },\r\n *\r\n *         targetButton: {\r\n *             default: null,\r\n *             type: cc.Button\r\n *         },\r\n *\r\n *         _width: 100,\r\n *\r\n *         width: {\r\n *             get () {\r\n *                 return this._width;\r\n *             },\r\n *             set (value) {\r\n *                 this._width = value;\r\n *             }\r\n *         },\r\n *\r\n *         offset: new cc.Vec2(100, 100)\r\n *\r\n *         offsets: {\r\n *             default: [],\r\n *             type: cc.Vec2\r\n *         }\r\n *\r\n *         frame: {\r\n *             default: null,\r\n *             type: cc.SpriteFrame\r\n *         },\r\n *     }\r\n * });\r\n * @typescript\r\n * property(options?: {type?: any; visible?: boolean|(() => boolean); displayName?: string; tooltip?: string; multiline?: boolean; readonly?: boolean; min?: number; max?: number; step?: number; range?: number[]; slide?: boolean; serializable?: boolean; formerlySerializedAs?: string; editorOnly?: boolean; override?: boolean; animatable?: boolean} | any[]|Function|cc.ValueType|number|string|boolean): Function\r\n * property(_target: Object, _key: any, _desc?: any): void\r\n */\r\nfunction property (ctorProtoOrOptions, propName, desc) {\r\n    var options = null;\r\n    function normalized (ctorProto, propName, desc) {\r\n        var cache = getClassCache(ctorProto.constructor);\r\n        if (cache) {\r\n            var ccclassProto = getSubDict(cache, 'proto');\r\n            var properties = getSubDict(ccclassProto, 'properties');\r\n            genProperty(ctorProto.constructor, properties, propName, options, desc, cache);\r\n        }\r\n    }\r\n    if (typeof propName === 'undefined') {\r\n        options = ctorProtoOrOptions;\r\n        return normalized;\r\n    }\r\n    else {\r\n        normalized(ctorProtoOrOptions, propName, desc);\r\n    }\r\n}\r\n\r\n// Editor Decorators\r\n\r\nfunction createEditorDecorator (argCheckFunc, editorPropName, staticValue) {\r\n    return argCheckFunc(function (ctor, decoratedValue) {\r\n        var cache = getClassCache(ctor, editorPropName);\r\n        if (cache) {\r\n            var value = (staticValue !== undefined) ? staticValue : decoratedValue;\r\n            var proto = getSubDict(cache, 'proto');\r\n            getSubDict(proto, 'editor')[editorPropName] = value;\r\n        }\r\n    }, editorPropName);\r\n}\r\n\r\nfunction createDummyDecorator (argCheckFunc) {\r\n    return argCheckFunc(fNOP);\r\n}\r\n\r\n/**\r\n * !#en\r\n * Makes a CCClass that inherit from component execute in edit mode.<br>\r\n * By default, all components are only executed in play mode,\r\n * which means they will not have their callback functions executed while the Editor is in edit mode.\r\n * !#zh\r\n *  Component  CCClass <br>\r\n *  Component \r\n *\r\n * @method executeInEditMode\r\n * @example\r\n * const {ccclass, executeInEditMode} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;executeInEditMode\r\n * class NewScript extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * executeInEditMode(): Function\r\n * executeInEditMode(_class: Function): void\r\n */\r\nvar executeInEditMode = (CC_DEV ? createEditorDecorator : createDummyDecorator)(checkCtorArgument, 'executeInEditMode', true);\r\n\r\n/**\r\n * !#en\r\n * Automatically add required component as a dependency for the CCClass that inherit from component.\r\n * !#zh\r\n *  CCClass \r\n *\r\n * @method requireComponent\r\n * @param {Component} requiredComponent\r\n * @example\r\n * const {ccclass, requireComponent} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;requireComponent(cc.Sprite)\r\n * class SpriteCtrl extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * requireComponent(requiredComponent: typeof cc.Component): Function\r\n */\r\nvar requireComponent = createEditorDecorator(checkCompArgument, 'requireComponent');\r\n\r\n/**\r\n * !#en\r\n * The menu path to register a component to the editors \"Component\" menu. Eg. \"Rendering/CameraCtrl\".\r\n * !#zh\r\n *  \"Rendering/CameraCtrl\"\r\n *\r\n * @method menu\r\n * @param {String} path - The path is the menu represented like a pathname.\r\n *                        For example the menu could be \"Rendering/CameraCtrl\".\r\n * @example\r\n * const {ccclass, menu} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;menu(\"Rendering/CameraCtrl\")\r\n * class NewScript extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * menu(path: string): Function\r\n */\r\nvar menu = (CC_DEV ? createEditorDecorator : createDummyDecorator)(checkStringArgument, 'menu');\r\n\r\n/**\r\n * !#en\r\n * The execution order of lifecycle methods for Component.\r\n * Those less than 0 will execute before while those greater than 0 will execute after.\r\n * The order will only affect onLoad, onEnable, start, update and lateUpdate while onDisable and onDestroy will not be affected.\r\n * !#zh\r\n *  0  0  onLoad, onEnable, start, update  lateUpdate onDisable  onDestroy \r\n *\r\n * @method executionOrder\r\n * @param {Number} order - The execution order of lifecycle methods for Component. Those less than 0 will execute before while those greater than 0 will execute after.\r\n * @example\r\n * const {ccclass, executionOrder} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;executionOrder(1)\r\n * class CameraCtrl extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * executionOrder(order: number): Function\r\n */\r\nvar executionOrder = createEditorDecorator(checkNumberArgument, 'executionOrder');\r\n\r\n/**\r\n * !#en\r\n * Prevents Component of the same type (or subtype) to be added more than once to a Node.\r\n * !#zh\r\n * \r\n *\r\n * @method disallowMultiple\r\n * @example\r\n * const {ccclass, disallowMultiple} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;disallowMultiple\r\n * class CameraCtrl extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * disallowMultiple(): Function\r\n * disallowMultiple(_class: Function): void\r\n */\r\nvar disallowMultiple = (CC_DEV ? createEditorDecorator : createDummyDecorator)(checkCtorArgument, 'disallowMultiple');\r\n\r\n/**\r\n * !#en\r\n * If specified, the editor's scene view will keep updating this node in 60 fps when it is selected, otherwise, it will update only if necessary.<br>\r\n * This property is only available if executeInEditMode is true.\r\n * !#zh\r\n *  \"executeInEditMode\" playOnFocus  60 FPS\r\n *\r\n * @method playOnFocus\r\n * @example\r\n * const {ccclass, playOnFocus, executeInEditMode} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;executeInEditMode\r\n * &#64;playOnFocus\r\n * class CameraCtrl extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * playOnFocus(): Function\r\n * playOnFocus(_class: Function): void\r\n */\r\nvar playOnFocus = (CC_DEV ? createEditorDecorator : createDummyDecorator)(checkCtorArgument, 'playOnFocus');\r\n\r\n/**\r\n * !#en\r\n * Specifying the url of the custom html to draw the component in **Properties**.\r\n * !#zh\r\n *  ****  url\r\n *\r\n * @method inspector\r\n * @param {String} url\r\n * @example\r\n * const {ccclass, inspector} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;inspector(\"packages://inspector/inspectors/comps/camera-ctrl.js\")\r\n * class NewScript extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * inspector(path: string): Function\r\n */\r\nvar inspector = (CC_DEV ? createEditorDecorator : createDummyDecorator)(checkStringArgument, 'inspector');\r\n\r\n/**\r\n * !#en\r\n * Specifying the url of the icon to display in the editor.\r\n * !#zh\r\n *  url\r\n *\r\n * @method icon\r\n * @param {String} url\r\n * @private\r\n * @example\r\n * const {ccclass, icon} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;icon(\"xxxx.png\")\r\n * class NewScript extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * icon(path: string): Function\r\n */\r\nvar icon = (CC_DEV ? createEditorDecorator : createDummyDecorator)(checkStringArgument, 'icon');\r\n\r\n/**\r\n * !#en\r\n * The custom documentation URL.\r\n * !#zh\r\n *  url **** \r\n *\r\n * @method help\r\n * @param {String} url\r\n * @example\r\n * const {ccclass, help} = cc._decorator;\r\n *\r\n * &#64;ccclass\r\n * &#64;help(\"app://docs/html/components/spine.html\")\r\n * class NewScript extends cc.Component {\r\n *     // ...\r\n * }\r\n * @typescript\r\n * help(path: string): Function\r\n */\r\nvar help = (CC_DEV ? createEditorDecorator : createDummyDecorator)(checkStringArgument, 'help');\r\n\r\n// Other Decorators\r\n\r\n/**\r\n * NOTE:<br>\r\n * The old mixins implemented in cc.Class(ES5) behaves exact the same as multiple inheritance.\r\n * But since ES6, class constructor can't be function-called and class methods become non-enumerable,\r\n * so we can not mix in ES6 Classes.<br>\r\n * See:<br>\r\n * [https://esdiscuss.org/topic/traits-are-now-impossible-in-es6-until-es7-since-rev32](https://esdiscuss.org/topic/traits-are-now-impossible-in-es6-until-es7-since-rev32)<br>\r\n * One possible solution (but IDE unfriendly):<br>\r\n * [http://justinfagnani.com/2015/12/21/real-mixins-with-javascript-classes](http://justinfagnani.com/2015/12/21/real-mixins-with-javascript-classes/)<br>\r\n * <br>\r\n * NOTE:<br>\r\n * You must manually call mixins constructor, this is different from cc.Class(ES5).\r\n *\r\n * @method mixins\r\n * @param {Function} ...ctor - constructors to mix, only support ES5 constructors or classes defined by using `cc.Class`,\r\n *                             not support ES6 Classes.\r\n * @example\r\n * const {ccclass, mixins} = cc._decorator;\r\n *\r\n * class Animal { ... }\r\n *\r\n * const Fly = cc.Class({\r\n *     constructor () { ... }\r\n * });\r\n *\r\n * &#64;ccclass\r\n * &#64;mixins(cc.EventTarget, Fly)\r\n * class Bird extends Animal {\r\n *     constructor () {\r\n *         super();\r\n *\r\n *         // You must manually call mixins constructor, this is different from cc.Class(ES5)\r\n *         cc.EventTarget.call(this);\r\n *         Fly.call(this);\r\n *     }\r\n *     // ...\r\n * }\r\n * @typescript\r\n * mixins(ctor: Function, ...rest: Function[]): Function\r\n */\r\nfunction mixins () {\r\n    var mixins = [];\r\n    for (var i = 0; i < arguments.length; i++) {\r\n        mixins[i] = arguments[i];\r\n    }\r\n    return function (ctor) {\r\n        var cache = getClassCache(ctor, 'mixins');\r\n        if (cache) {\r\n            getSubDict(cache, 'proto').mixins = mixins;\r\n        }\r\n    }\r\n}\r\n\r\ncc._decorator = module.exports = {\r\n    ccclass,\r\n    property,\r\n    executeInEditMode,\r\n    requireComponent,\r\n    menu,\r\n    executionOrder,\r\n    disallowMultiple,\r\n    playOnFocus,\r\n    inspector,\r\n    icon,\r\n    help,\r\n    mixins,\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('./js');\r\n\r\n// enum\r\n\r\n/**\r\n * !#en\r\n * Define an enum type. <br/>\r\n * If a enum item has a value of -1, it will be given an Integer number according to it's order in the list.<br/>\r\n * Otherwise it will use the value specified by user who writes the enum definition.\r\n *\r\n * !#zh\r\n * <br/>\r\n *  -1 + 1\r\n *\r\n * @method Enum\r\n * @param {object} obj - a JavaScript literal object containing enum names and values, or a TypeScript enum type\r\n * @return {object} the defined enum type\r\n * @example {@link cocos2d/core/platform/CCEnum/Enum.js}\r\n * @typescript Enum<T>(obj: T): T\r\n */\r\nfunction Enum (obj) {\r\n    if ('__enums__' in obj) {\r\n        return obj;\r\n    }\r\n    js.value(obj, '__enums__', null, true);\r\n\r\n    var lastIndex = -1;\r\n    var keys = Object.keys(obj);\r\n    for (var i = 0; i < keys.length; i++) {\r\n        var key = keys[i];\r\n        var val = obj[key];\r\n\r\n        if (val === -1) {\r\n            val = ++lastIndex;\r\n            obj[key] = val;\r\n        }\r\n        else {\r\n            if (typeof val === 'number') {\r\n                lastIndex = val;\r\n            }\r\n            else if (typeof val === 'string' && Number.isInteger(parseFloat(key))) {\r\n                continue;\r\n            }\r\n        }\r\n        var reverseKey = '' + val;\r\n        if (key !== reverseKey) {\r\n            if ((CC_EDITOR || CC_TEST) && reverseKey in obj && obj[reverseKey] !== key) {\r\n                cc.errorID(7100, reverseKey);\r\n                continue;\r\n            }\r\n            js.value(obj, reverseKey, key);\r\n        }\r\n    }\r\n    return obj;\r\n}\r\n\r\nEnum.isEnum = function (enumType) {\r\n    return enumType && enumType.hasOwnProperty('__enums__');\r\n};\r\n\r\n/**\r\n * @method getList\r\n * @param {Object} enumDef - the enum type defined from cc.Enum\r\n * @return {Object[]}\r\n * @private\r\n */\r\nEnum.getList = function (enumDef) {\r\n    if (enumDef.__enums__)\r\n        return enumDef.__enums__;\r\n\r\n    var enums = enumDef.__enums__ = [];\r\n    for (var name in enumDef) {\r\n        var value = enumDef[name];\r\n        if (Number.isInteger(value)) {\r\n            enums.push({ name, value });\r\n        }\r\n    }\r\n    enums.sort( function ( a, b ) { return a.value - b.value; } );\r\n    return enums;\r\n};\r\n\r\nif (CC_DEV) {\r\n    // check key order in object literal\r\n    var _TestEnum = Enum({\r\n        ZERO: -1,\r\n        ONE: -1,\r\n        TWO: -1,\r\n        THREE: -1\r\n    });\r\n    if (_TestEnum.ZERO !== 0 || _TestEnum.ONE !== 1 || _TestEnum.THREE !== 3) {\r\n        cc.errorID(7101);\r\n    }\r\n}\r\n\r\nmodule.exports = cc.Enum = Enum;\r\n","/****************************************************************************\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst eventManager = require('../event-manager');\r\nconst inputManager = require(\"./CCInputManager\");\r\n\r\nconst PORTRAIT = 0;\r\nconst LANDSCAPE_LEFT = -90;\r\nconst PORTRAIT_UPSIDE_DOWN = 180;\r\nconst LANDSCAPE_RIGHT = 90;\r\n\r\nlet _didAccelerateFun;\r\n\r\n/**\r\n * !#en the device accelerometer reports values for each axis in units of g-force.\r\n * !#zh \r\n * @class Acceleration\r\n * @method constructor\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} z\r\n * @param {Number} timestamp\r\n */\r\ncc.Acceleration = function (x, y, z, timestamp) {\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n    this.z = z || 0;\r\n    this.timestamp = timestamp || 0;\r\n};\r\n\r\n/**\r\n * whether enable accelerometer event\r\n * @method setAccelerometerEnabled\r\n * @param {Boolean} isEnable\r\n */\r\ninputManager.setAccelerometerEnabled = function (isEnable) {\r\n    let _t = this;\r\n    if(_t._accelEnabled === isEnable)\r\n        return;\r\n\r\n    _t._accelEnabled = isEnable;\r\n    let scheduler = cc.director.getScheduler();\r\n    scheduler.enableForTarget(_t);\r\n    if (_t._accelEnabled) {\r\n        _t._registerAccelerometerEvent();\r\n        _t._accelCurTime = 0;\r\n        scheduler.scheduleUpdate(_t);\r\n    } else {\r\n        _t._unregisterAccelerometerEvent();\r\n        _t._accelCurTime = 0;\r\n        scheduler.unscheduleUpdate(_t);\r\n    }\r\n\r\n    if (CC_JSB) {\r\n        jsb.device.setMotionEnabled(isEnable);\r\n    }\r\n};\r\n\r\n/**\r\n * set accelerometer interval value\r\n * @method setAccelerometerInterval\r\n * @param {Number} interval\r\n */\r\ninputManager.setAccelerometerInterval = function (interval) {\r\n    if (this._accelInterval !== interval) {\r\n        this._accelInterval = interval;\r\n\r\n        if (CC_JSB) {\r\n            jsb.device.setMotionInterval(interval);\r\n        }\r\n    }\r\n};\r\n\r\ninputManager._registerKeyboardEvent = function () {\r\n    cc.game.canvas.addEventListener(\"keydown\", function (e) {\r\n        eventManager.dispatchEvent(new cc.Event.EventKeyboard(e.keyCode, true));\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n    }, false);\r\n    cc.game.canvas.addEventListener(\"keyup\", function (e) {\r\n        eventManager.dispatchEvent(new cc.Event.EventKeyboard(e.keyCode, false));\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n    }, false);\r\n};\r\n\r\ninputManager._registerAccelerometerEvent = function () {\r\n    let w = window, _t = this;\r\n    _t._acceleration = new cc.Acceleration();\r\n    _t._accelDeviceEvent = w.DeviceMotionEvent || w.DeviceOrientationEvent;\r\n\r\n    //TODO fix DeviceMotionEvent bug on QQ Browser version 4.1 and below.\r\n    if (cc.sys.browserType === cc.sys.BROWSER_TYPE_MOBILE_QQ)\r\n        _t._accelDeviceEvent = window.DeviceOrientationEvent;\r\n\r\n    let _deviceEventType = (_t._accelDeviceEvent === w.DeviceMotionEvent) ? \"devicemotion\" : \"deviceorientation\";\r\n    let ua = navigator.userAgent;\r\n    if (/Android/.test(ua) || (/Adr/.test(ua) && cc.sys.browserType === cc.BROWSER_TYPE_UC)) {\r\n        _t._minus = -1;\r\n    }\r\n\r\n    _didAccelerateFun = _t.didAccelerate.bind(_t);\r\n    w.addEventListener(_deviceEventType, _didAccelerateFun, false);\r\n};\r\n\r\ninputManager._unregisterAccelerometerEvent = function () {\r\n    let w = window, _t = this;\r\n    let _deviceEventType = (_t._accelDeviceEvent === w.DeviceMotionEvent) ? \"devicemotion\" : \"deviceorientation\";\r\n    if (_didAccelerateFun) {\r\n        w.removeEventListener(_deviceEventType, _didAccelerateFun, false);\r\n    }\r\n};\r\n\r\ninputManager.didAccelerate = function (eventData) {\r\n    let _t = this, w = window;\r\n    if (!_t._accelEnabled)\r\n        return;\r\n\r\n    let mAcceleration = _t._acceleration;\r\n\r\n    let x, y, z;\r\n\r\n    if (_t._accelDeviceEvent === window.DeviceMotionEvent) {\r\n        let eventAcceleration = eventData[\"accelerationIncludingGravity\"];\r\n        x = _t._accelMinus * eventAcceleration.x * 0.1;\r\n        y = _t._accelMinus * eventAcceleration.y * 0.1;\r\n        z = eventAcceleration.z * 0.1;\r\n    } else {\r\n        x = (eventData[\"gamma\"] / 90) * 0.981;\r\n        y = -(eventData[\"beta\"] / 90) * 0.981;\r\n        z = (eventData[\"alpha\"] / 90) * 0.981;\r\n    }\r\n\r\n    if (cc.view._isRotated) {\r\n        let tmp = x;\r\n        x = -y;\r\n        y = tmp;\r\n    }\r\n    mAcceleration.x = x;\r\n    mAcceleration.y = y;\r\n    mAcceleration.z = z;\r\n\r\n    mAcceleration.timestamp = eventData.timeStamp || Date.now();\r\n\r\n    let tmpX = mAcceleration.x;\r\n    if (w.orientation === LANDSCAPE_RIGHT) {\r\n        mAcceleration.x = -mAcceleration.y;\r\n        mAcceleration.y = tmpX;\r\n    } else if (w.orientation === LANDSCAPE_LEFT) {\r\n        mAcceleration.x = mAcceleration.y;\r\n        mAcceleration.y = -tmpX;\r\n    } else if (w.orientation === PORTRAIT_UPSIDE_DOWN) {\r\n        mAcceleration.x = -mAcceleration.x;\r\n        mAcceleration.y = -mAcceleration.y;\r\n    }\r\n    // fix android acc values are opposite\r\n    if (cc.sys.os === cc.sys.OS_ANDROID &&\r\n        cc.sys.browserType !== cc.sys.BROWSER_TYPE_MOBILE_QQ) {\r\n        mAcceleration.x = -mAcceleration.x;\r\n        mAcceleration.y = -mAcceleration.y;\r\n    }\r\n};","/****************************************************************************\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst macro = require('./CCMacro');\r\nconst sys = require('./CCSys');\r\nconst eventManager = require('../event-manager');\r\n\r\nconst TOUCH_TIMEOUT = macro.TOUCH_TIMEOUT;\r\n\r\nlet _vec2 = cc.v2();\r\n\r\n/**\r\n *  This class manages all events of input. include: touch, mouse, accelerometer, keyboard\r\n */\r\nlet inputManager = {\r\n    _mousePressed: false,\r\n\r\n    _isRegisterEvent: false,\r\n\r\n    _preTouchPoint: cc.v2(0,0),\r\n    _prevMousePoint: cc.v2(0,0),\r\n\r\n    _preTouchPool: [],\r\n    _preTouchPoolPointer: 0,\r\n\r\n    _touches: [],\r\n    _touchesIntegerDict:{},\r\n\r\n    _indexBitsUsed: 0,\r\n    _maxTouches: 8,\r\n\r\n    _accelEnabled: false,\r\n    _accelInterval: 1/5,\r\n    _accelMinus: 1,\r\n    _accelCurTime: 0,\r\n    _acceleration: null,\r\n    _accelDeviceEvent: null,\r\n\r\n    _getUnUsedIndex () {\r\n        let temp = this._indexBitsUsed;\r\n        let now = cc.sys.now();\r\n\r\n        for (let i = 0; i < this._maxTouches; i++) {\r\n            if (!(temp & 0x00000001)) {\r\n                this._indexBitsUsed |= (1 << i);\r\n                return i;\r\n            }\r\n            else {\r\n                let touch = this._touches[i];\r\n                if (now - touch._lastModified > TOUCH_TIMEOUT) {\r\n                    this._removeUsedIndexBit(i);\r\n                    delete this._touchesIntegerDict[touch.getID()];\r\n                    return i;\r\n                }\r\n            }\r\n            temp >>= 1;\r\n        }\r\n\r\n        // all bits are used\r\n        return -1;\r\n    },\r\n\r\n    _removeUsedIndexBit (index) {\r\n        if (index < 0 || index >= this._maxTouches)\r\n            return;\r\n\r\n        let temp = 1 << index;\r\n        temp = ~temp;\r\n        this._indexBitsUsed &= temp;\r\n    },\r\n\r\n    _glView: null,\r\n\r\n    /**\r\n     * @method handleTouchesBegin\r\n     * @param {Array} touches\r\n     */\r\n    handleTouchesBegin (touches) {\r\n        let selTouch, index, curTouch, touchID,\r\n            handleTouches = [], locTouchIntDict = this._touchesIntegerDict,\r\n            now = sys.now();\r\n        for (let i = 0, len = touches.length; i < len; i ++) {\r\n            selTouch = touches[i];\r\n            touchID = selTouch.getID();\r\n            index = locTouchIntDict[touchID];\r\n\r\n            if (index == null) {\r\n                let unusedIndex = this._getUnUsedIndex();\r\n                if (unusedIndex === -1) {\r\n                    cc.logID(2300, unusedIndex);\r\n                    continue;\r\n                }\r\n                //curTouch = this._touches[unusedIndex] = selTouch;\r\n                curTouch = this._touches[unusedIndex] = new cc.Touch(selTouch._point.x, selTouch._point.y, selTouch.getID());\r\n                curTouch._lastModified = now;\r\n                curTouch._setPrevPoint(selTouch._prevPoint);\r\n                locTouchIntDict[touchID] = unusedIndex;\r\n                handleTouches.push(curTouch);\r\n            }\r\n        }\r\n        if (handleTouches.length > 0) {\r\n            this._glView._convertTouchesWithScale(handleTouches);\r\n            let touchEvent = new cc.Event.EventTouch(handleTouches);\r\n            touchEvent._eventCode = cc.Event.EventTouch.BEGAN;\r\n            eventManager.dispatchEvent(touchEvent);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @method handleTouchesMove\r\n     * @param {Array} touches\r\n     */\r\n    handleTouchesMove (touches) {\r\n        let selTouch, index, touchID,\r\n            handleTouches = [], locTouches = this._touches,\r\n            now = sys.now();\r\n        for (let i = 0, len = touches.length; i < len; i++) {\r\n            selTouch = touches[i];\r\n            touchID = selTouch.getID();\r\n            index = this._touchesIntegerDict[touchID];\r\n\r\n            if (index == null) {\r\n                //cc.log(\"if the index doesn't exist, it is an error\");\r\n                continue;\r\n            }\r\n            if (locTouches[index]) {\r\n                locTouches[index]._setPoint(selTouch._point);\r\n                locTouches[index]._setPrevPoint(selTouch._prevPoint);\r\n                locTouches[index]._lastModified = now;\r\n                handleTouches.push(locTouches[index]);\r\n            }\r\n        }\r\n        if (handleTouches.length > 0) {\r\n            this._glView._convertTouchesWithScale(handleTouches);\r\n            let touchEvent = new cc.Event.EventTouch(handleTouches);\r\n            touchEvent._eventCode = cc.Event.EventTouch.MOVED;\r\n            eventManager.dispatchEvent(touchEvent);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @method handleTouchesEnd\r\n     * @param {Array} touches\r\n     */\r\n    handleTouchesEnd (touches) {\r\n        let handleTouches = this.getSetOfTouchesEndOrCancel(touches);\r\n        if (handleTouches.length > 0) {\r\n            this._glView._convertTouchesWithScale(handleTouches);\r\n            let touchEvent = new cc.Event.EventTouch(handleTouches);\r\n            touchEvent._eventCode = cc.Event.EventTouch.ENDED;\r\n            eventManager.dispatchEvent(touchEvent);\r\n        }\r\n        this._preTouchPool.length = 0;\r\n    },\r\n\r\n    /**\r\n     * @method handleTouchesCancel\r\n     * @param {Array} touches\r\n     */\r\n    handleTouchesCancel (touches) {\r\n        let handleTouches = this.getSetOfTouchesEndOrCancel(touches);\r\n        if (handleTouches.length > 0) {\r\n            this._glView._convertTouchesWithScale(handleTouches);\r\n            let touchEvent = new cc.Event.EventTouch(handleTouches);\r\n            touchEvent._eventCode = cc.Event.EventTouch.CANCELLED;\r\n            eventManager.dispatchEvent(touchEvent);\r\n        }\r\n        this._preTouchPool.length = 0;\r\n    },\r\n\r\n    /**\r\n     * @method getSetOfTouchesEndOrCancel\r\n     * @param {Array} touches\r\n     * @returns {Array}\r\n     */\r\n    getSetOfTouchesEndOrCancel (touches) {\r\n        let selTouch, index, touchID, handleTouches = [], locTouches = this._touches, locTouchesIntDict = this._touchesIntegerDict;\r\n        for (let i = 0, len = touches.length; i< len; i ++) {\r\n            selTouch = touches[i];\r\n            touchID = selTouch.getID();\r\n            index = locTouchesIntDict[touchID];\r\n\r\n            if (index == null) {\r\n                continue;  //cc.log(\"if the index doesn't exist, it is an error\");\r\n            }\r\n            if (locTouches[index]) {\r\n                locTouches[index]._setPoint(selTouch._point);\r\n                locTouches[index]._setPrevPoint(selTouch._prevPoint);\r\n                handleTouches.push(locTouches[index]);\r\n                this._removeUsedIndexBit(index);\r\n                delete locTouchesIntDict[touchID];\r\n            }\r\n        }\r\n        return handleTouches;\r\n    },\r\n\r\n    /**\r\n     * @method getHTMLElementPosition\r\n     * @param {HTMLElement} element\r\n     * @return {Object}\r\n     */\r\n    getHTMLElementPosition (element) {\r\n        if (CC_WECHATGAME) {\r\n            return {\r\n                left: 0,\r\n                top: 0,\r\n                width: window.innerWidth,\r\n                height: window.innerHeight\r\n            };\r\n        }\r\n\r\n        let docElem = document.documentElement;\r\n        let leftOffset = window.pageXOffset - docElem.clientLeft;\r\n        let topOffset = window.pageYOffset - docElem.clientTop;\r\n        if (element.getBoundingClientRect) {\r\n            let box = element.getBoundingClientRect();\r\n            return {\r\n                left: box.left + leftOffset,\r\n                top: box.top + topOffset,\r\n                width: box.width,\r\n                height: box.height\r\n            };\r\n        }\r\n        else {\r\n            if (element instanceof HTMLCanvasElement) {\r\n                return {\r\n                    left: leftOffset,\r\n                    top: topOffset,\r\n                    width: element.width,\r\n                    height: element.height\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    left: leftOffset,\r\n                    top: topOffset,\r\n                    width: parseInt(element.style.width),\r\n                    height: parseInt(element.style.height)\r\n                };\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @method getPreTouch\r\n     * @param {Touch} touch\r\n     * @return {Touch}\r\n     */\r\n    getPreTouch (touch) {\r\n        let preTouch = null;\r\n        let locPreTouchPool = this._preTouchPool;\r\n        let id = touch.getID();\r\n        for (let i = locPreTouchPool.length - 1; i >= 0; i--) {\r\n            if (locPreTouchPool[i].getID() === id) {\r\n                preTouch = locPreTouchPool[i];\r\n                break;\r\n            }\r\n        }\r\n        if (!preTouch)\r\n            preTouch = touch;\r\n        return preTouch;\r\n    },\r\n\r\n    /**\r\n     * @method setPreTouch\r\n     * @param {Touch} touch\r\n     */\r\n    setPreTouch (touch) {\r\n        let find = false;\r\n        let locPreTouchPool = this._preTouchPool;\r\n        let id = touch.getID();\r\n        for (let i = locPreTouchPool.length - 1; i >= 0; i--) {\r\n            if (locPreTouchPool[i].getID() === id) {\r\n                locPreTouchPool[i] = touch;\r\n                find = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!find) {\r\n            if (locPreTouchPool.length <= 50) {\r\n                locPreTouchPool.push(touch);\r\n            } else {\r\n                locPreTouchPool[this._preTouchPoolPointer] = touch;\r\n                this._preTouchPoolPointer = (this._preTouchPoolPointer + 1) % 50;\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @method getTouchByXY\r\n     * @param {Number} tx\r\n     * @param {Number} ty\r\n     * @param {Vec2} pos\r\n     * @return {Touch}\r\n     */\r\n    getTouchByXY (tx, ty, pos) {\r\n        let locPreTouch = this._preTouchPoint;\r\n        let location = this._glView.convertToLocationInView(tx, ty, pos);\r\n        let touch = new cc.Touch(location.x,  location.y, 0);\r\n        touch._setPrevPoint(locPreTouch.x, locPreTouch.y);\r\n        locPreTouch.x = location.x;\r\n        locPreTouch.y = location.y;\r\n        return touch;\r\n    },\r\n\r\n    /**\r\n     * @method getMouseEvent\r\n     * @param {Vec2} location\r\n     * @param {Vec2} pos\r\n     * @param {Number} eventType\r\n     * @returns {Event.EventMouse}\r\n     */\r\n    getMouseEvent (location, pos, eventType) {\r\n        let locPreMouse = this._prevMousePoint;\r\n        let mouseEvent = new cc.Event.EventMouse(eventType);\r\n        mouseEvent._setPrevCursor(locPreMouse.x, locPreMouse.y);\r\n        locPreMouse.x = location.x;\r\n        locPreMouse.y = location.y;\r\n        this._glView._convertMouseToLocationInView(locPreMouse, pos);\r\n        mouseEvent.setLocation(locPreMouse.x, locPreMouse.y);\r\n        return mouseEvent;\r\n    },\r\n\r\n    /**\r\n     * @method getPointByEvent\r\n     * @param {Touch} event\r\n     * @param {Vec2} pos\r\n     * @return {Vec2}\r\n     */\r\n    getPointByEvent (event, pos) {\r\n        if (event.pageX != null)  //not avalable in <= IE8\r\n            return {x: event.pageX, y: event.pageY};\r\n\r\n        if (CC_WECHATGAME) {\r\n            pos.left = 0;\r\n            pos.top = 0;\r\n        }\r\n        else {\r\n            pos.left -= document.body.scrollLeft;\r\n            pos.top -= document.body.scrollTop;\r\n        }\r\n        return {x: event.clientX, y: event.clientY};\r\n    },\r\n\r\n    /**\r\n     * @method getTouchesByEvent\r\n     * @param {Touch} event\r\n     * @param {Vec2} pos\r\n     * @returns {Array}\r\n     */\r\n    getTouchesByEvent (event, pos) {\r\n        let touchArr = [], locView = this._glView;\r\n        let touch_event, touch, preLocation;\r\n        let locPreTouch = this._preTouchPoint;\r\n\r\n        let length = event.changedTouches.length;\r\n        for (let i = 0; i < length; i++) {\r\n            touch_event = event.changedTouches[i];\r\n            if (touch_event) {\r\n                let location;\r\n                if (sys.BROWSER_TYPE_FIREFOX === sys.browserType)\r\n                    location = locView.convertToLocationInView(touch_event.pageX, touch_event.pageY, pos, _vec2);\r\n                else\r\n                    location = locView.convertToLocationInView(touch_event.clientX, touch_event.clientY, pos, _vec2);\r\n                if (touch_event.identifier != null) {\r\n                    touch = new cc.Touch(location.x, location.y, touch_event.identifier);\r\n                    //use Touch Pool\r\n                    preLocation = this.getPreTouch(touch).getLocation();\r\n                    touch._setPrevPoint(preLocation.x, preLocation.y);\r\n                    this.setPreTouch(touch);\r\n                } else {\r\n                    touch = new cc.Touch(location.x, location.y);\r\n                    touch._setPrevPoint(locPreTouch.x, locPreTouch.y);\r\n                }\r\n                locPreTouch.x = location.x;\r\n                locPreTouch.y = location.y;\r\n                touchArr.push(touch);\r\n            }\r\n        }\r\n        return touchArr;\r\n    },\r\n\r\n    /**\r\n     * @method registerSystemEvent\r\n     * @param {HTMLElement} element\r\n     */\r\n    registerSystemEvent (element) {\r\n        if(this._isRegisterEvent) return;\r\n\r\n        this._glView = cc.view;\r\n        let selfPointer = this;\r\n\r\n        let prohibition = sys.isMobile;\r\n        let supportMouse = ('mouse' in sys.capabilities);\r\n        let supportTouches = ('touches' in sys.capabilities);\r\n\r\n        if (CC_WECHATGAME) {\r\n            prohibition = false;\r\n            supportTouches = true;\r\n            supportMouse = false;\r\n        }\r\n\r\n        if (supportMouse) {\r\n            //HACK\r\n            //  - At the same time to trigger the ontouch event and onmouse event\r\n            //  - The function will execute 2 times\r\n            //The known browser:\r\n            //  liebiao\r\n            //  miui\r\n            //  WECHAT\r\n            if (!prohibition) {\r\n                window.addEventListener('mousedown', function () {\r\n                    selfPointer._mousePressed = true;\r\n                }, false);\r\n\r\n                window.addEventListener('mouseup', function (event) {\r\n                    if (!selfPointer._mousePressed)\r\n                        return;\r\n                    \r\n                    selfPointer._mousePressed = false;\r\n\r\n                    let pos = selfPointer.getHTMLElementPosition(element);\r\n                    let location = selfPointer.getPointByEvent(event, pos);\r\n                    if (!cc.rect(pos.left, pos.top, pos.width, pos.height).contains(location)){\r\n                        selfPointer.handleTouchesEnd([selfPointer.getTouchByXY(location.x, location.y, pos)]);\r\n\r\n                        let mouseEvent = selfPointer.getMouseEvent(location,pos,cc.Event.EventMouse.UP);\r\n                        mouseEvent.setButton(event.button);\r\n                        eventManager.dispatchEvent(mouseEvent);\r\n                    }\r\n                }, false);\r\n            }\r\n\r\n            // register canvas mouse event\r\n            let EventMouse = cc.Event.EventMouse;\r\n            let _mouseEventsOnElement = [\r\n                !prohibition && [\"mousedown\", EventMouse.DOWN, function (event, mouseEvent, location, pos) {\r\n                    selfPointer._mousePressed = true;\r\n                    selfPointer.handleTouchesBegin([selfPointer.getTouchByXY(location.x, location.y, pos)]);\r\n                    element.focus();\r\n                }],\r\n                !prohibition && [\"mouseup\", EventMouse.UP, function (event, mouseEvent, location, pos) {\r\n                    selfPointer._mousePressed = false;\r\n                    selfPointer.handleTouchesEnd([selfPointer.getTouchByXY(location.x, location.y, pos)]);\r\n                }],\r\n                !prohibition && [\"mousemove\", EventMouse.MOVE, function (event, mouseEvent, location, pos) {\r\n                    selfPointer.handleTouchesMove([selfPointer.getTouchByXY(location.x, location.y, pos)]);\r\n                    if (!selfPointer._mousePressed) {\r\n                        mouseEvent.setButton(null);\r\n                    }\r\n                }],\r\n                [\"mousewheel\", EventMouse.SCROLL, function (event, mouseEvent) {\r\n                    mouseEvent.setScrollData(0, event.wheelDelta);\r\n                }],\r\n                /* firefox fix */\r\n                [\"DOMMouseScroll\", EventMouse.SCROLL, function (event, mouseEvent) {\r\n                    mouseEvent.setScrollData(0, event.detail * -120);\r\n                }]\r\n            ];\r\n            for (let i = 0; i < _mouseEventsOnElement.length; ++i) {\r\n                let entry = _mouseEventsOnElement[i];\r\n                if (entry) {\r\n                    let name = entry[0];\r\n                    let type = entry[1];\r\n                    let handler = entry[2];\r\n                    element.addEventListener(name, function (event) {\r\n                        let pos = selfPointer.getHTMLElementPosition(element);\r\n                        let location = selfPointer.getPointByEvent(event, pos);\r\n                        let mouseEvent = selfPointer.getMouseEvent(location, pos, type);\r\n                        mouseEvent.setButton(event.button);\r\n\r\n                        handler(event, mouseEvent, location, pos);\r\n\r\n                        eventManager.dispatchEvent(mouseEvent);\r\n                        event.stopPropagation();\r\n                        event.preventDefault();\r\n                    }, false);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (window.navigator.msPointerEnabled) {\r\n            let _pointerEventsMap = {\r\n                \"MSPointerDown\"     : selfPointer.handleTouchesBegin,\r\n                \"MSPointerMove\"     : selfPointer.handleTouchesMove,\r\n                \"MSPointerUp\"       : selfPointer.handleTouchesEnd,\r\n                \"MSPointerCancel\"   : selfPointer.handleTouchesCancel\r\n            };\r\n            for (let eventName in _pointerEventsMap) {\r\n                let touchEvent = _pointerEventsMap[eventName];\r\n                element.addEventListener(eventName, function (event){\r\n                    let pos = selfPointer.getHTMLElementPosition(element);\r\n                    pos.left -= document.documentElement.scrollLeft;\r\n                    pos.top -= document.documentElement.scrollTop;\r\n\r\n                    touchEvent.call(selfPointer, [selfPointer.getTouchByXY(event.clientX, event.clientY, pos)]);\r\n                    event.stopPropagation();\r\n                }, false);\r\n            }\r\n        }\r\n\r\n        //register touch event\r\n        if (supportTouches) {\r\n            let _touchEventsMap = {\r\n                \"touchstart\": function (touchesToHandle) {\r\n                    selfPointer.handleTouchesBegin(touchesToHandle);\r\n                    if (!CC_WECHATGAME) {\r\n                        element.focus();\r\n                    }\r\n                },\r\n                \"touchmove\": function (touchesToHandle) {\r\n                    selfPointer.handleTouchesMove(touchesToHandle);\r\n                },\r\n                \"touchend\": function (touchesToHandle) {\r\n                    selfPointer.handleTouchesEnd(touchesToHandle);\r\n                },\r\n                \"touchcancel\": function (touchesToHandle) {\r\n                    selfPointer.handleTouchesCancel(touchesToHandle);\r\n                }\r\n            };\r\n\r\n            let registerTouchEvent;\r\n            if (cc.sys.browserType === cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB) {\r\n                _touchEventsMap = {\r\n                    onTouchStart: _touchEventsMap.touchstart,\r\n                    onTouchMove: _touchEventsMap.touchmove,\r\n                    onTouchEnd: _touchEventsMap.touchend,\r\n                    onTouchCancel: _touchEventsMap.touchcancel,\r\n                };\r\n                registerTouchEvent = function(eventName) {\r\n                    let handler = _touchEventsMap[eventName];\r\n                    wx[eventName](function(event) {\r\n                        if (!event.changedTouches) return;\r\n                        let pos = selfPointer.getHTMLElementPosition(element);\r\n                        let body = document.body;\r\n                        pos.left -= body.scrollLeft || 0;\r\n                        pos.top -= body.scrollTop || 0;\r\n                        handler(selfPointer.getTouchesByEvent(event, pos));\r\n                    });\r\n                };\r\n            }\r\n            else {\r\n                registerTouchEvent = function(eventName) {\r\n                    let handler = _touchEventsMap[eventName];\r\n                    element.addEventListener(eventName, (function(event) {\r\n                        if (!event.changedTouches) return;\r\n                        let pos = selfPointer.getHTMLElementPosition(element);\r\n                        let body = document.body;\r\n                        pos.left -= body.scrollLeft || 0;\r\n                        pos.top -= body.scrollTop || 0;\r\n                        handler(selfPointer.getTouchesByEvent(event, pos));\r\n                        event.stopPropagation();\r\n                        event.preventDefault();\r\n                    }), false);\r\n                };\r\n            }\r\n            for (let eventName in _touchEventsMap) {\r\n                registerTouchEvent(eventName);\r\n            }\r\n        }\r\n\r\n        if (cc.sys.browserType !== cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB) {\r\n            //register keyboard event\r\n            this._registerKeyboardEvent();\r\n        }\r\n\r\n        this._isRegisterEvent = true;\r\n    },\r\n\r\n    _registerKeyboardEvent () {},\r\n\r\n    _registerAccelerometerEvent () {},\r\n\r\n    /**\r\n     * @method update\r\n     * @param {Number} dt\r\n     */\r\n    update (dt) {\r\n        if (this._accelCurTime > this._accelInterval) {\r\n            this._accelCurTime -= this._accelInterval;\r\n            eventManager.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration));\r\n        }\r\n        this._accelCurTime += dt;\r\n    }\r\n};\r\n\r\nmodule.exports = _cc.inputManager = inputManager;\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('./js');\r\n\r\n/**\r\n * Predefined constants\r\n * @class macro\r\n * @static\r\n */\r\ncc.macro = {\r\n    /**\r\n     * PI / 180\r\n     * @property RAD\r\n     * @type {Number}\r\n     */\r\n    RAD: Math.PI / 180,\r\n\r\n    /**\r\n     * One degree\r\n     * @property DEG\r\n     * @type {Number}\r\n     */\r\n    DEG: 180 / Math.PI,\r\n\r\n    /**\r\n     * @property REPEAT_FOREVER\r\n     * @type {Number}\r\n     */\r\n    REPEAT_FOREVER: (Number.MAX_VALUE - 1),\r\n\r\n    /**\r\n     * @property FLT_EPSILON\r\n     * @type {Number}\r\n     */\r\n    FLT_EPSILON: 0.0000001192092896,\r\n\r\n    /**\r\n     * Minimum z index value for node\r\n     * @property MIN_ZINDEX\r\n     * @type {Number}\r\n     */\r\n    MIN_ZINDEX: -Math.pow(2, 15),\r\n\r\n    /**\r\n     * Maximum z index value for node\r\n     * @property MAX_ZINDEX\r\n     * @type {Number}\r\n     */\r\n    MAX_ZINDEX: Math.pow(2, 15) - 1,\r\n\r\n    //some gl constant variable\r\n    /**\r\n     * @property ONE\r\n     * @type {Number}\r\n     */\r\n    ONE: 1,\r\n\r\n    /**\r\n     * @property ZERO\r\n     * @type {Number}\r\n     */\r\n    ZERO: 0,\r\n\r\n    /**\r\n     * @property SRC_ALPHA\r\n     * @type {Number}\r\n     */\r\n    SRC_ALPHA: 0x0302,\r\n\r\n    /**\r\n     * @property SRC_ALPHA_SATURATE\r\n     * @type {Number}\r\n     */\r\n    SRC_ALPHA_SATURATE: 0x308,\r\n\r\n    /**\r\n     * @property SRC_COLOR\r\n     * @type {Number}\r\n     */\r\n    SRC_COLOR: 0x300,\r\n\r\n    /**\r\n     * @property DST_ALPHA\r\n     * @type {Number}\r\n     */\r\n    DST_ALPHA: 0x304,\r\n\r\n    /**\r\n     * @property DST_COLOR\r\n     * @type {Number}\r\n     */\r\n    DST_COLOR: 0x306,\r\n\r\n    /**\r\n     * @property ONE_MINUS_SRC_ALPHA\r\n     * @type {Number}\r\n     */\r\n    ONE_MINUS_SRC_ALPHA: 0x0303,\r\n\r\n    /**\r\n     * @property ONE_MINUS_SRC_COLOR\r\n     * @type {Number}\r\n     */\r\n    ONE_MINUS_SRC_COLOR: 0x301,\r\n\r\n    /**\r\n     * @property ONE_MINUS_DST_ALPHA\r\n     * @type {Number}\r\n     */\r\n    ONE_MINUS_DST_ALPHA: 0x305,\r\n\r\n    /**\r\n     * @property ONE_MINUS_DST_COLOR\r\n     * @type {Number}\r\n     */\r\n    ONE_MINUS_DST_COLOR: 0x0307,\r\n\r\n    /**\r\n     * @property ONE_MINUS_CONSTANT_ALPHA\r\n     * @type {Number}\r\n     */\r\n    ONE_MINUS_CONSTANT_ALPHA: 0x8004,\r\n\r\n    /**\r\n     * @property ONE_MINUS_CONSTANT_COLOR\r\n     * @type {Number}\r\n     */\r\n    ONE_MINUS_CONSTANT_COLOR: 0x8002,\r\n\r\n    //Possible device orientations\r\n    /**\r\n     * Oriented vertically\r\n     * @property ORIENTATION_PORTRAIT\r\n     * @type {Number}\r\n     */\r\n    ORIENTATION_PORTRAIT: 1,\r\n\r\n    /**\r\n     * Oriented horizontally\r\n     * @property ORIENTATION_LANDSCAPE\r\n     * @type {Number}\r\n     */\r\n    ORIENTATION_LANDSCAPE: 2,\r\n\r\n    /**\r\n     * Oriented automatically\r\n     * @property ORIENTATION_AUTO\r\n     * @type {Number}\r\n     */\r\n    ORIENTATION_AUTO: 3,\r\n\r\n    DENSITYDPI_DEVICE: 'device-dpi',\r\n    DENSITYDPI_HIGH: 'high-dpi',\r\n    DENSITYDPI_MEDIUM: 'medium-dpi',\r\n    DENSITYDPI_LOW: 'low-dpi',\r\n\r\n    // General configurations\r\n\r\n    /**\r\n     * <p>\r\n     *   If enabled, the texture coordinates will be calculated by using this formula: <br/>\r\n     *      - texCoord.left = (rect.x*2+1) / (texture.wide*2);                  <br/>\r\n     *      - texCoord.right = texCoord.left + (rect.width*2-2)/(texture.wide*2); <br/>\r\n     *                                                                                 <br/>\r\n     *  The same for bottom and top.                                                   <br/>\r\n     *                                                                                 <br/>\r\n     *  This formula prevents artifacts by using 99% of the texture.                   <br/>\r\n     *  The \"correct\" way to prevent artifacts is by expand the texture's border with the same color by 1 pixel<br/>\r\n     *                                                                                  <br/>\r\n     *  Affected component:                                                                 <br/>\r\n     *      - cc.TMXLayer                                                       <br/>\r\n     *                                                                                  <br/>\r\n     *  Enabled by default. To disabled set it to 0. <br/>\r\n     *  To modify it, in Web engine please refer to CCMacro.js, in JSB please refer to CCConfig.h\r\n     * </p>\r\n     *\r\n     * @property {Number} FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX\r\n     */\r\n    FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX: true,\r\n\r\n    /**\r\n     * Position of the FPS (Default: 0,0 (bottom-left corner))<br/>\r\n     * To modify it, in Web engine please refer to CCMacro.js, in JSB please refer to CCConfig.h\r\n     * @property {Vec2} DIRECTOR_STATS_POSITION\r\n     */\r\n    DIRECTOR_STATS_POSITION: cc.v2(0, 0),\r\n\r\n    /**\r\n     * <p>\r\n     *    If enabled, actions that alter the position property (eg: CCMoveBy, CCJumpBy, CCBezierBy, etc..) will be stacked.                  <br/>\r\n     *    If you run 2 or more 'position' actions at the same time on a node, then end position will be the sum of all the positions.        <br/>\r\n     *    If disabled, only the last run action will take effect.\r\n     * </p>\r\n     * @property {Number} ENABLE_STACKABLE_ACTIONS\r\n     */\r\n    ENABLE_STACKABLE_ACTIONS: true,\r\n\r\n    /**\r\n     * !#en \r\n     * The timeout to determine whether a touch is no longer active and should be removed.\r\n     * The reason to add this timeout is due to an issue in X5 browser core, \r\n     * when X5 is presented in wechat on Android, if a touch is glissed from the bottom up, and leave the page area,\r\n     * no touch cancel event is triggered, and the touch will be considered active forever. \r\n     * After multiple times of this action, our maximum touches number will be reached and all new touches will be ignored.\r\n     * So this new mechanism can remove the touch that should be inactive if it's not updated during the last 5000 milliseconds.\r\n     * Though it might remove a real touch if it's just not moving for the last 5 seconds which is not easy with the sensibility of mobile touch screen.\r\n     * You can modify this value to have a better behavior if you find it's not enough.\r\n     * !#zh\r\n     * \r\n     *  X5  bug\r\n     *  touch cancel  touch end \r\n     * \r\n     * \r\n     * \r\n     *  5000 \r\n     * @property {Number} TOUCH_TIMEOUT\r\n     */\r\n    TOUCH_TIMEOUT: 5000,\r\n\r\n    /**\r\n     * !#en \r\n     * The maximum vertex count for a single batched draw call.\r\n     * !#zh\r\n     * \r\n     * @property {Number} BATCH_VERTEX_COUNT\r\n     */\r\n    BATCH_VERTEX_COUNT: 20000,\r\n\r\n    /**\r\n     * !#en \r\n     * Whether or not enabled tiled map auto culling. If you set the TiledMap skew or rotation, then need to manually disable this, otherwise, the rendering will be wrong.\r\n     * !#zh\r\n     *  skew, rotation \r\n     * @property {Boolean} ENABLE_TILEDMAP_CULLING\r\n     * @default true\r\n     */\r\n    ENABLE_TILEDMAP_CULLING: true,\r\n\r\n    /**\r\n     * !#en \r\n     * The max concurrent task number for the downloader\r\n     * !#zh\r\n     * \r\n     * @property {Number} DOWNLOAD_MAX_CONCURRENT\r\n     * @default 64\r\n     */\r\n    DOWNLOAD_MAX_CONCURRENT: 64,\r\n\r\n    /**\r\n     * !#en \r\n     * Boolean that indicates if the canvas contains an alpha channel, default sets to false for better performance.\r\n     * Though if you want to make your canvas background transparent and show other dom elements at the background, \r\n     * you can set it to true before `cc.game.run`.\r\n     * Web only.\r\n     * !#zh\r\n     *  Canvas  alpha  false\r\n     *  Canvas  DOM  `cc.game.run`  true\r\n     *  Web\r\n     * @property {Boolean} ENABLE_TRANSPARENT_CANVAS\r\n     * @default false\r\n     */\r\n    ENABLE_TRANSPARENT_CANVAS: false,\r\n\r\n    /**\r\n     * !#en\r\n     * Boolean that indicates if the WebGL context is created with `antialias` option turned on, default value is false.\r\n     * Set it to true could make your game graphics slightly smoother, like texture hard edges when rotated.\r\n     * Whether to use this really depend on your game design and targeted platform, \r\n     * device with retina display usually have good detail on graphics with or without this option, \r\n     * you probably don't want antialias if your game style is pixel art based.\r\n     * Also, it could have great performance impact with some browser / device using software MSAA.\r\n     * You can set it to true before `cc.game.run`.\r\n     * Web only.\r\n     * !#zh\r\n     *  WebGL Context  false\r\n     *  true \r\n     *  retina \r\n     * \r\n     *  `cc.game.run` \r\n     *  Web\r\n     * @property {Boolean} ENABLE_WEBGL_ANTIALIAS\r\n     * @default false\r\n     */\r\n    ENABLE_WEBGL_ANTIALIAS: false,\r\n\r\n    /**\r\n     * !#en\r\n     * Whether or not enable auto culling.\r\n     * This feature have been removed in v2.0 new renderer due to overall performance consumption.\r\n     * We have no plan currently to re-enable auto culling.\r\n     * If your game have more dynamic objects, we suggest to disable auto culling.\r\n     * If your game have more static objects, we suggest to enable auto culling.\r\n     * !#zh\r\n     * \r\n     *  v2.0 \r\n     * \r\n     * \r\n     * @property {Boolean} ENABLE_CULLING\r\n     * @deprecated since v2.0\r\n     * @default false\r\n     */\r\n    ENABLE_CULLING: false,\r\n\r\n    /**\r\n     * !#en\r\n     * Whether or not clear dom Image object cache after uploading to gl texture.\r\n     * Concretely, we are setting image.src to empty string to release the cache.\r\n     * Normally you don't need to enable this option, because on web the Image object doesn't consume too much memory.\r\n     * But on Wechat Game platform, the current version cache decoded data in Image object, which has high memory usage.\r\n     * So we enabled this option by default on Wechat, so that we can release Image cache immediately after uploaded to GPU.\r\n     * !#zh\r\n     *  GPU  DOM Image \r\n     *  image.src \r\n     *  web Image \r\n     * Image \r\n     *  GL  Image \r\n     * @property {Boolean} CLEANUP_IMAGE_CACHE\r\n     * @default false\r\n     */\r\n    CLEANUP_IMAGE_CACHE: false,\r\n\r\n    /**\r\n     * !#en\r\n     * Whether or not show mesh wire frame.\r\n     * !#zh\r\n     * \r\n     * @property {Boolean} SHOW_MESH_WIREFRAME\r\n     * @default false\r\n     */\r\n    SHOW_MESH_WIREFRAME: false,\r\n};\r\n\r\n\r\nlet SUPPORT_TEXTURE_FORMATS = ['.webp', '.jpg', '.jpeg', '.bmp', '.png'];\r\nif (cc.sys.isMobile) {\r\n    if (cc.sys.os === cc.sys.OS_IOS) {\r\n        SUPPORT_TEXTURE_FORMATS = ['.pvr'].concat(SUPPORT_TEXTURE_FORMATS);\r\n    }\r\n    // else if (cc.sys.os === cc.sys.OS_ANDROID) {\r\n    //     SUPPORT_TEXTURE_FORMATS = ['.etc'].join(SUPPORT_TEXTURE_FORMATS);\r\n    // }\r\n}\r\n\r\n/**\r\n * !en\r\n * The image format supported by the engine defaults, and the supported formats may differ in different build platforms and device types.\r\n * Currently all platform and device support ['.webp', '.jpg', '.jpeg', '.bmp', '.png'], The iOS mobile platform also supports the PVR format\r\n * !zh\r\n * \r\n *  ['.webp', '.jpg', '.jpeg', '.bmp', '.png'].  Ios  PVR \r\n * @property {[String]} SUPPORT_TEXTURE_FORMATS\r\n */\r\ncc.macro.SUPPORT_TEXTURE_FORMATS = SUPPORT_TEXTURE_FORMATS;\r\n\r\n\r\n/**\r\n * !#en Key map for keyboard event\r\n * !#zh \r\n * @enum macro.KEY\r\n * @example {@link cocos2d/core/platform/CCCommon/KEY.js}\r\n */\r\ncc.macro.KEY = {\r\n    /**\r\n     * !#en None\r\n     * !#zh \r\n     * @property none\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    none:0,\r\n\r\n    // android\r\n    /**\r\n     * !#en The back key\r\n     * !#zh \r\n     * @property back\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    back:6,\r\n    /**\r\n     * !#en The menu key\r\n     * !#zh \r\n     * @property menu\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    menu:18,\r\n\r\n    /**\r\n     * !#en The backspace key\r\n     * !#zh \r\n     * @property backspace\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    backspace:8,\r\n\r\n    /**\r\n     * !#en The tab key\r\n     * !#zh Tab \r\n     * @property tab\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    tab:9,\r\n\r\n    /**\r\n     * !#en The enter key\r\n     * !#zh \r\n     * @property enter\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    enter:13,\r\n\r\n    /**\r\n     * !#en The shift key\r\n     * !#zh Shift \r\n     * @property shift\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    shift:16, //should use shiftkey instead\r\n\r\n    /**\r\n     * !#en The ctrl key\r\n     * !#zh Ctrl \r\n     * @property ctrl\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    ctrl:17, //should use ctrlkey\r\n\r\n    /**\r\n     * !#en The alt key\r\n     * !#zh Alt \r\n     * @property alt\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    alt:18, //should use altkey\r\n\r\n    /**\r\n     * !#en The pause key\r\n     * !#zh \r\n     * @property pause\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    pause:19,\r\n\r\n    /**\r\n     * !#en The caps lock key\r\n     * !#zh \r\n     * @property capslock\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    capslock:20,\r\n\r\n    /**\r\n     * !#en The esc key\r\n     * !#zh ESC \r\n     * @property escape\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    escape:27,\r\n\r\n    /**\r\n     * !#en The space key\r\n     * !#zh \r\n     * @property space\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    space:32,\r\n\r\n    /**\r\n     * !#en The page up key\r\n     * !#zh \r\n     * @property pageup\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    pageup:33,\r\n\r\n    /**\r\n     * !#en The page down key\r\n     * !#zh \r\n     * @property pagedown\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    pagedown:34,\r\n\r\n    /**\r\n     * !#en The end key\r\n     * !#zh \r\n     * @property end\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    end:35,\r\n\r\n    /**\r\n     * !#en The home key\r\n     * !#zh \r\n     * @property home\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    home:36,\r\n\r\n    /**\r\n     * !#en The left key\r\n     * !#zh \r\n     * @property left\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    left:37,\r\n\r\n    /**\r\n     * !#en The up key\r\n     * !#zh \r\n     * @property up\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    up:38,\r\n\r\n    /**\r\n     * !#en The right key\r\n     * !#zh \r\n     * @property right\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    right:39,\r\n\r\n    /**\r\n     * !#en The down key\r\n     * !#zh \r\n     * @property down\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    down:40,\r\n\r\n    /**\r\n     * !#en The select key\r\n     * !#zh Select \r\n     * @property select\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    select:41,\r\n\r\n    /**\r\n     * !#en The insert key\r\n     * !#zh \r\n     * @property insert\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    insert:45,\r\n\r\n    /**\r\n     * !#en The Delete key\r\n     * !#zh \r\n     * @property Delete\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    Delete:46,\r\n\r\n    /**\r\n     * !#en The '0' key on the top of the alphanumeric keyboard.\r\n     * !#zh  0 \r\n     * @property 0\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    0:48,\r\n\r\n    /**\r\n     * !#en The '1' key on the top of the alphanumeric keyboard.\r\n     * !#zh  1 \r\n     * @property 1\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    1:49,\r\n\r\n    /**\r\n     * !#en The '2' key on the top of the alphanumeric keyboard.\r\n     * !#zh  2 \r\n     * @property 2\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    2:50,\r\n\r\n    /**\r\n     * !#en The '3' key on the top of the alphanumeric keyboard.\r\n     * !#zh  3 \r\n     * @property 3\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    3:51,\r\n\r\n    /**\r\n     * !#en The '4' key on the top of the alphanumeric keyboard.\r\n     * !#zh  4 \r\n     * @property 4\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    4:52,\r\n\r\n    /**\r\n     * !#en The '5' key on the top of the alphanumeric keyboard.\r\n     * !#zh  5 \r\n     * @property 5\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    5:53,\r\n\r\n    /**\r\n     * !#en The '6' key on the top of the alphanumeric keyboard.\r\n     * !#zh  6 \r\n     * @property 6\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    6:54,\r\n\r\n    /**\r\n     * !#en The '7' key on the top of the alphanumeric keyboard.\r\n     * !#zh  7 \r\n     * @property 7\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    7:55,\r\n\r\n    /**\r\n     * !#en The '8' key on the top of the alphanumeric keyboard.\r\n     * !#zh  8 \r\n     * @property 8\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    8:56,\r\n\r\n    /**\r\n     * !#en The '9' key on the top of the alphanumeric keyboard.\r\n     * !#zh  9 \r\n     * @property 9\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    9:57,\r\n\r\n    /**\r\n     * !#en The a key\r\n     * !#zh A \r\n     * @property a\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    a:65,\r\n\r\n    /**\r\n     * !#en The b key\r\n     * !#zh B \r\n     * @property b\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    b:66,\r\n\r\n    /**\r\n     * !#en The c key\r\n     * !#zh C \r\n     * @property c\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    c:67,\r\n\r\n    /**\r\n     * !#en The d key\r\n     * !#zh D \r\n     * @property d\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    d:68,\r\n\r\n    /**\r\n     * !#en The e key\r\n     * !#zh E \r\n     * @property e\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    e:69,\r\n\r\n    /**\r\n     * !#en The f key\r\n     * !#zh F \r\n     * @property f\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f:70,\r\n\r\n    /**\r\n     * !#en The g key\r\n     * !#zh G \r\n     * @property g\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    g:71,\r\n\r\n    /**\r\n     * !#en The h key\r\n     * !#zh H \r\n     * @property h\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    h:72,\r\n\r\n    /**\r\n     * !#en The i key\r\n     * !#zh I \r\n     * @property i\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    i:73,\r\n\r\n    /**\r\n     * !#en The j key\r\n     * !#zh J \r\n     * @property j\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    j:74,\r\n\r\n    /**\r\n     * !#en The k key\r\n     * !#zh K \r\n     * @property k\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    k:75,\r\n\r\n    /**\r\n     * !#en The l key\r\n     * !#zh L \r\n     * @property l\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    l:76,\r\n\r\n    /**\r\n     * !#en The m key\r\n     * !#zh M \r\n     * @property m\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    m:77,\r\n\r\n    /**\r\n     * !#en The n key\r\n     * !#zh N \r\n     * @property n\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    n:78,\r\n\r\n    /**\r\n     * !#en The o key\r\n     * !#zh O \r\n     * @property o\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    o:79,\r\n\r\n    /**\r\n     * !#en The p key\r\n     * !#zh P \r\n     * @property p\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    p:80,\r\n\r\n    /**\r\n     * !#en The q key\r\n     * !#zh Q \r\n     * @property q\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    q:81,\r\n\r\n    /**\r\n     * !#en The r key\r\n     * !#zh R \r\n     * @property r\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    r:82,\r\n\r\n    /**\r\n     * !#en The s key\r\n     * !#zh S \r\n     * @property s\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    s:83,\r\n\r\n    /**\r\n     * !#en The t key\r\n     * !#zh T \r\n     * @property t\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    t:84,\r\n\r\n    /**\r\n     * !#en The u key\r\n     * !#zh U \r\n     * @property u\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    u:85,\r\n\r\n    /**\r\n     * !#en The v key\r\n     * !#zh V \r\n     * @property v\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    v:86,\r\n\r\n    /**\r\n     * !#en The w key\r\n     * !#zh W \r\n     * @property w\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    w:87,\r\n\r\n    /**\r\n     * !#en The x key\r\n     * !#zh X \r\n     * @property x\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    x:88,\r\n\r\n    /**\r\n     * !#en The y key\r\n     * !#zh Y \r\n     * @property y\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    y:89,\r\n\r\n    /**\r\n     * !#en The z key\r\n     * !#zh Z \r\n     * @property z\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    z:90,\r\n\r\n    /**\r\n     * !#en The numeric keypad 0\r\n     * !#zh  0\r\n     * @property num0\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num0:96,\r\n\r\n    /**\r\n     * !#en The numeric keypad 1\r\n     * !#zh  1\r\n     * @property num1\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num1:97,\r\n\r\n    /**\r\n     * !#en The numeric keypad 2\r\n     * !#zh  2\r\n     * @property num2\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num2:98,\r\n\r\n    /**\r\n     * !#en The numeric keypad 3\r\n     * !#zh  3\r\n     * @property num3\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num3:99,\r\n\r\n    /**\r\n     * !#en The numeric keypad 4\r\n     * !#zh  4\r\n     * @property num4\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num4:100,\r\n\r\n    /**\r\n     * !#en The numeric keypad 5\r\n     * !#zh  5\r\n     * @property num5\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num5:101,\r\n\r\n    /**\r\n     * !#en The numeric keypad 6\r\n     * !#zh  6\r\n     * @property num6\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num6:102,\r\n\r\n    /**\r\n     * !#en The numeric keypad 7\r\n     * !#zh  7\r\n     * @property num7\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num7:103,\r\n\r\n    /**\r\n     * !#en The numeric keypad 8\r\n     * !#zh  8\r\n     * @property num8\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num8:104,\r\n\r\n    /**\r\n     * !#en The numeric keypad 9\r\n     * !#zh  9\r\n     * @property num9\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    num9:105,\r\n\r\n    /**\r\n     * !#en The numeric keypad '*'\r\n     * !#zh  *\r\n     * @property *\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    '*':106,\r\n\r\n    /**\r\n     * !#en The numeric keypad '+'\r\n     * !#zh  +\r\n     * @property +\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    '+':107,\r\n\r\n    /**\r\n     * !#en The numeric keypad '-'\r\n     * !#zh  -\r\n     * @property -\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    '-':109,\r\n\r\n    /**\r\n     * !#en The numeric keypad 'delete'\r\n     * !#zh \r\n     * @property numdel\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    'numdel':110,\r\n\r\n    /**\r\n     * !#en The numeric keypad '/'\r\n     * !#zh  /\r\n     * @property /\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    '/':111,\r\n\r\n    /**\r\n     * !#en The F1 function key\r\n     * !#zh F1 \r\n     * @property f1\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f1:112, //f1-f12 dont work on ie\r\n\r\n    /**\r\n     * !#en The F2 function key\r\n     * !#zh F2 \r\n     * @property f2\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f2:113,\r\n\r\n    /**\r\n     * !#en The F3 function key\r\n     * !#zh F3 \r\n     * @property f3\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f3:114,\r\n\r\n    /**\r\n     * !#en The F4 function key\r\n     * !#zh F4 \r\n     * @property f4\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f4:115,\r\n\r\n    /**\r\n     * !#en The F5 function key\r\n     * !#zh F5 \r\n     * @property f5\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f5:116,\r\n\r\n    /**\r\n     * !#en The F6 function key\r\n     * !#zh F6 \r\n     * @property f6\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f6:117,\r\n\r\n    /**\r\n     * !#en The F7 function key\r\n     * !#zh F7 \r\n     * @property f7\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f7:118,\r\n\r\n    /**\r\n     * !#en The F8 function key\r\n     * !#zh F8 \r\n     * @property f8\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f8:119,\r\n\r\n    /**\r\n     * !#en The F9 function key\r\n     * !#zh F9 \r\n     * @property f9\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f9:120,\r\n\r\n    /**\r\n     * !#en The F10 function key\r\n     * !#zh F10 \r\n     * @property f10\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f10:121,\r\n\r\n    /**\r\n     * !#en The F11 function key\r\n     * !#zh F11 \r\n     * @property f11\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f11:122,\r\n\r\n    /**\r\n     * !#en The F12 function key\r\n     * !#zh F12 \r\n     * @property f12\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    f12:123,\r\n\r\n    /**\r\n     * !#en The numlock key\r\n     * !#zh \r\n     * @property numlock\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    numlock:144,\r\n\r\n    /**\r\n     * !#en The scroll lock key\r\n     * !#zh \r\n     * @property scrolllock\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    scrolllock:145,\r\n\r\n    /**\r\n     * !#en The ';' key.\r\n     * !#zh \r\n     * @property ;\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    ';':186,\r\n\r\n    /**\r\n     * !#en The ';' key.\r\n     * !#zh \r\n     * @property semicolon\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    semicolon:186,\r\n\r\n    /**\r\n     * !#en The '=' key.\r\n     * !#zh \r\n     * @property equal\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    equal:187,\r\n\r\n    /**\r\n     * !#en The '=' key.\r\n     * !#zh \r\n     * @property =\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    '=':187,\r\n\r\n    /**\r\n     * !#en The ',' key.\r\n     * !#zh \r\n     * @property ,\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    ',':188,\r\n\r\n    /**\r\n     * !#en The ',' key.\r\n     * !#zh \r\n     * @property comma\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    comma:188,\r\n\r\n    /**\r\n     * !#en The dash '-' key.\r\n     * !#zh \r\n     * @property dash\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    dash:189,\r\n\r\n    /**\r\n     * !#en The '.' key.\r\n     * !#zh \r\n     * @property .\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    '.':190,\r\n\r\n    /**\r\n     * !#en The '.' key\r\n     * !#zh \r\n     * @property period\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    period:190,\r\n\r\n    /**\r\n     * !#en The forward slash key\r\n     * !#zh \r\n     * @property forwardslash\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    forwardslash:191,\r\n\r\n    /**\r\n     * !#en The grave key\r\n     * !#zh  `\r\n     * @property grave\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    grave:192,\r\n\r\n    /**\r\n     * !#en The '[' key\r\n     * !#zh  [\r\n     * @property [\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    '[':219,\r\n\r\n    /**\r\n     * !#en The '[' key\r\n     * !#zh  [\r\n     * @property openbracket\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    openbracket:219,\r\n\r\n    /**\r\n     * !#en The '\\' key\r\n     * !#zh \r\n     * @property backslash\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    backslash:220,\r\n\r\n    /**\r\n     * !#en The ']' key\r\n     * !#zh  ]\r\n     * @property ]\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    ']':221,\r\n\r\n    /**\r\n     * !#en The ']' key\r\n     * !#zh  ]\r\n     * @property closebracket\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    closebracket:221,\r\n\r\n    /**\r\n     * !#en The quote key\r\n     * !#zh \r\n     * @property quote\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    quote:222,\r\n\r\n    // gamepad controll\r\n\r\n    /**\r\n     * !#en The dpad left key\r\n     * !#zh  \r\n     * @property dpadLeft\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    dpadLeft:1000,\r\n\r\n    /**\r\n     * !#en The dpad right key\r\n     * !#zh  \r\n     * @property dpadRight\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    dpadRight:1001,\r\n\r\n    /**\r\n     * !#en The dpad up key\r\n     * !#zh  \r\n     * @property dpadUp\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    dpadUp:1003,\r\n\r\n    /**\r\n     * !#en The dpad down key\r\n     * !#zh  \r\n     * @property dpadDown\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    dpadDown:1004,\r\n\r\n    /**\r\n     * !#en The dpad center key\r\n     * !#zh  \r\n     * @property dpadCenter\r\n     * @type {Number}\r\n     * @readonly\r\n     */\r\n    dpadCenter:1005\r\n};\r\n\r\n/**\r\n * Image formats\r\n * @enum macro.ImageFormat\r\n */\r\ncc.macro.ImageFormat = cc.Enum({\r\n    /**\r\n     * Image Format:JPG\r\n     * @property JPG\r\n     * @type {Number}\r\n     */\r\n    JPG: 0,\r\n    /**\r\n     * Image Format:PNG\r\n     * @property PNG\r\n     * @type {Number}\r\n     */\r\n    PNG: 1,\r\n    /**\r\n     * Image Format:TIFF\r\n     * @property TIFF\r\n     * @type {Number}\r\n     */\r\n    TIFF: 2,\r\n    /**\r\n     * Image Format:WEBP\r\n     * @property WEBP\r\n     * @type {Number}\r\n     */\r\n    WEBP: 3,\r\n    /**\r\n     * Image Format:PVR\r\n     * @property PVR\r\n     * @type {Number}\r\n     */\r\n    PVR: 4,\r\n    /**\r\n     * Image Format:ETC\r\n     * @property ETC\r\n     * @type {Number}\r\n     */\r\n    ETC: 5,\r\n    /**\r\n     * Image Format:S3TC\r\n     * @property S3TC\r\n     * @type {Number}\r\n     */\r\n    S3TC: 6,\r\n    /**\r\n     * Image Format:ATITC\r\n     * @property ATITC\r\n     * @type {Number}\r\n     */\r\n    ATITC: 7,\r\n    /**\r\n     * Image Format:TGA\r\n     * @property TGA\r\n     * @type {Number}\r\n     */\r\n    TGA: 8,\r\n    /**\r\n     * Image Format:RAWDATA\r\n     * @property RAWDATA\r\n     * @type {Number}\r\n     */\r\n    RAWDATA: 9,\r\n    /**\r\n     * Image Format:UNKNOWN\r\n     * @property UNKNOWN\r\n     * @type {Number}\r\n     */\r\n    UNKNOWN: 10\r\n});\r\n\r\n/**\r\n * !#en\r\n * Enum for blend factor\r\n * Refer to: http://www.andersriggelsen.dk/glblendfunc.php\r\n * !#zh\r\n * \r\n * : http://www.andersriggelsen.dk/glblendfunc.php\r\n * @enum macro.BlendFactor\r\n */\r\ncc.macro.BlendFactor = cc.Enum({\r\n    /**\r\n     * !#en All use\r\n     * !#zh \r\n     * @property {Number} ONE\r\n     */\r\n    ONE:                    1,  //cc.macro.ONE\r\n    /**\r\n     * !#en Not all\r\n     * !#zh \r\n     * @property {Number} ZERO\r\n     */\r\n    ZERO:                   0,      //cc.ZERO\r\n    /**\r\n     * !#en Using the source alpha\r\n     * !#zh \r\n     * @property {Number} SRC_ALPHA\r\n     */\r\n    SRC_ALPHA:              0x302,  //cc.SRC_ALPHA\r\n    /**\r\n     * !#en Using the source color\r\n     * !#zh \r\n     * @property {Number} SRC_COLOR\r\n     */\r\n    SRC_COLOR:              0x300,  //cc.SRC_COLOR\r\n    /**\r\n     * !#en Using the target alpha\r\n     * !#zh \r\n     * @property {Number} DST_ALPHA\r\n     */\r\n    DST_ALPHA:              0x304,  //cc.DST_ALPHA\r\n    /**\r\n     * !#en Using the target color\r\n     * !#zh \r\n     * @property {Number} DST_COLOR\r\n     */\r\n    DST_COLOR:              0x306,  //cc.DST_COLOR\r\n    /**\r\n     * !#en Minus the source alpha\r\n     * !#zh \r\n     * @property {Number} ONE_MINUS_SRC_ALPHA\r\n     */\r\n    ONE_MINUS_SRC_ALPHA:    0x303,  //cc.ONE_MINUS_SRC_ALPHA\r\n    /**\r\n     * !#en Minus the source color\r\n     * !#zh \r\n     * @property {Number} ONE_MINUS_SRC_COLOR\r\n     */\r\n    ONE_MINUS_SRC_COLOR:    0x301,  //cc.ONE_MINUS_SRC_COLOR\r\n    /**\r\n     * !#en Minus the target alpha\r\n     * !#zh \r\n     * @property {Number} ONE_MINUS_DST_ALPHA\r\n     */\r\n    ONE_MINUS_DST_ALPHA:    0x305,  //cc.ONE_MINUS_DST_ALPHA\r\n    /**\r\n     * !#en Minus the target color\r\n     * !#zh \r\n     * @property {Number} ONE_MINUS_DST_COLOR\r\n     */\r\n    ONE_MINUS_DST_COLOR:    0x307,  //cc.ONE_MINUS_DST_COLOR\r\n});\r\n\r\n/**\r\n * @enum macro.TextAlignment\r\n */\r\ncc.macro.TextAlignment = cc.Enum({\r\n    /**\r\n     * @property {Number} LEFT\r\n     */\r\n    LEFT: 0,\r\n    /**\r\n     * @property {Number} CENTER\r\n     */\r\n    CENTER: 1,\r\n    /**\r\n     * @property {Number} RIGHT\r\n     */\r\n    RIGHT: 2\r\n});\r\n\r\n/**\r\n * @enum VerticalTextAlignment\r\n */\r\ncc.macro.VerticalTextAlignment = cc.Enum({\r\n    /**\r\n     * @property {Number} TOP\r\n     */\r\n    TOP: 0,\r\n    /**\r\n     * @property {Number} CENTER\r\n     */\r\n    CENTER: 1,\r\n    /**\r\n     * @property {Number} BOTTOM\r\n     */\r\n    BOTTOM: 2\r\n});\r\n\r\nmodule.exports = cc.macro;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('./js');\r\nvar CCClass = require('./CCClass');\r\n\r\n// definitions for CCObject.Flags\r\n\r\nvar Destroyed = 1 << 0;\r\nvar RealDestroyed = 1 << 1;\r\nvar ToDestroy = 1 << 2;\r\nvar DontSave = 1 << 3;\r\nvar EditorOnly = 1 << 4;\r\nvar Dirty = 1 << 5;\r\nvar DontDestroy = 1 << 6;\r\nvar Destroying = 1 << 7;\r\nvar Deactivating = 1 << 8;\r\nvar LockedInEditor = 1 << 9;\r\n//var HideInGame = 1 << 9;\r\n//var HideInEditor = 1 << 10;\r\n\r\nvar IsOnEnableCalled = 1 << 11;\r\nvar IsEditorOnEnableCalled = 1 << 12;\r\nvar IsPreloadStarted = 1 << 13;\r\nvar IsOnLoadCalled = 1 << 14;\r\nvar IsOnLoadStarted = 1 << 15;\r\nvar IsStartCalled = 1 << 16;\r\n\r\nvar IsRotationLocked = 1 << 17;\r\nvar IsScaleLocked = 1 << 18;\r\nvar IsAnchorLocked = 1 << 19;\r\nvar IsSizeLocked = 1 << 20;\r\nvar IsPositionLocked = 1 << 21;\r\n\r\n//var Hide = HideInGame | HideInEditor;\r\n// should not clone or serialize these flags\r\nvar PersistentMask = ~(ToDestroy | Dirty | Destroying | DontDestroy | Deactivating |\r\n                       IsPreloadStarted | IsOnLoadStarted | IsOnLoadCalled | IsStartCalled |\r\n                       IsOnEnableCalled | IsEditorOnEnableCalled |\r\n                       IsRotationLocked | IsScaleLocked | IsAnchorLocked | IsSizeLocked | IsPositionLocked\r\n                       /*RegisteredInEditor*/);\r\n\r\n/**\r\n * The base class of most of all the objects in Fireball.\r\n * @class Object\r\n *\r\n * @main\r\n * @private\r\n */\r\nfunction CCObject () {\r\n    /**\r\n     * @property {String} _name\r\n     * @default \"\"\r\n     * @private\r\n     */\r\n    this._name = '';\r\n\r\n    /**\r\n     * @property {Number} _objFlags\r\n     * @default 0\r\n     * @private\r\n     */\r\n    this._objFlags = 0;\r\n}\r\nCCClass.fastDefine('cc.Object', CCObject, { _name: '', _objFlags: 0 });\r\n\r\n/**\r\n * Bit mask that controls object states.\r\n * @enum Flags\r\n * @static\r\n * @private\r\n */\r\njs.value(CCObject, 'Flags', {\r\n\r\n    Destroyed,\r\n    //ToDestroy: ToDestroy,\r\n\r\n    /**\r\n     * !#en The object will not be saved.\r\n     * !#zh \r\n     * @property {Number} DontSave\r\n     */\r\n    DontSave,\r\n\r\n    /**\r\n     * !#en The object will not be saved when building a player.\r\n     * !#zh \r\n     * @property {Number} EditorOnly\r\n     */\r\n    EditorOnly,\r\n\r\n    Dirty,\r\n\r\n    /**\r\n     * !#en Dont destroy automatically when loading a new scene.\r\n     * !#zh \r\n     * @property DontDestroy\r\n     * @private\r\n     */\r\n    DontDestroy,\r\n\r\n    PersistentMask,\r\n\r\n    // FLAGS FOR ENGINE\r\n\r\n    Destroying,\r\n\r\n    /**\r\n     * !#en The node is deactivating.\r\n     * !#zh \r\n     * @property Deactivating\r\n     * @private\r\n     */\r\n    Deactivating,\r\n\r\n    /**\r\n     * !#en The lock node, when the node is locked, cannot be clicked in the scene.\r\n     * !#zh \r\n     * \r\n     * @property LockedInEditor\r\n     * @private\r\n     */\r\n    LockedInEditor,\r\n\r\n    ///**\r\n    // * !#en\r\n    // * Hide in game and hierarchy.\r\n    // * This flag is readonly, it can only be used as an argument of scene.addEntity() or Entity.createWithFlags().\r\n    // * !#zh\r\n    // * <br/>\r\n    // *  scene.addEntity()\r\n    // * @property {Number} HideInGame\r\n    // */\r\n    //HideInGame: HideInGame,\r\n\r\n    // FLAGS FOR EDITOR\r\n\r\n    ///**\r\n    // * !#en This flag is readonly, it can only be used as an argument of scene.addEntity() or Entity.createWithFlags().\r\n    // * !#zh  scene.addEntity()\r\n    // * @property {Number} HideInEditor\r\n    // */\r\n    //HideInEditor: HideInEditor,\r\n\r\n    ///**\r\n    // * !#en\r\n    // * Hide in game view, hierarchy, and scene view... etc.\r\n    // * This flag is readonly, it can only be used as an argument of scene.addEntity() or Entity.createWithFlags().\r\n    // * !#zh\r\n    // * ...\r\n    // *  scene.addEntity()\r\n    // * @property {Number} Hide\r\n    // */\r\n    //Hide: Hide,\r\n\r\n    //// UUID Registered in editor\r\n    //RegisteredInEditor: RegisteredInEditor,\r\n\r\n    // FLAGS FOR COMPONENT\r\n\r\n    IsPreloadStarted,\r\n    IsOnLoadStarted,\r\n    IsOnLoadCalled,\r\n    IsOnEnableCalled,\r\n    IsStartCalled,\r\n    IsEditorOnEnableCalled,\r\n\r\n    IsPositionLocked,\r\n    IsRotationLocked,\r\n    IsScaleLocked,\r\n    IsAnchorLocked,\r\n    IsSizeLocked,\r\n});\r\n\r\nvar objectsToDestroy = [];\r\n\r\nfunction deferredDestroy () {\r\n    var deleteCount = objectsToDestroy.length;\r\n    for (var i = 0; i < deleteCount; ++i) {\r\n        var obj = objectsToDestroy[i];\r\n        if (!(obj._objFlags & Destroyed)) {\r\n            obj._destroyImmediate();\r\n        }\r\n    }\r\n    // if we called b.destory() in a.onDestroy(), objectsToDestroy will be resized,\r\n    // but we only destroy the objects which called destory in this frame.\r\n    if (deleteCount === objectsToDestroy.length) {\r\n        objectsToDestroy.length = 0;\r\n    }\r\n    else {\r\n        objectsToDestroy.splice(0, deleteCount);\r\n    }\r\n\r\n    if (CC_EDITOR) {\r\n        deferredDestroyTimer = null;\r\n    }\r\n}\r\n\r\njs.value(CCObject, '_deferredDestroy', deferredDestroy);\r\n\r\nif (CC_EDITOR) {\r\n    js.value(CCObject, '_clearDeferredDestroyTimer', function () {\r\n        if (deferredDestroyTimer !== null) {\r\n            clearImmediate(deferredDestroyTimer);\r\n            deferredDestroyTimer = null;\r\n        }\r\n    });\r\n}\r\n\r\n// MEMBER\r\n\r\n/**\r\n * @class Object\r\n */\r\n\r\nvar prototype = CCObject.prototype;\r\n\r\n/**\r\n * !#en The name of the object.\r\n * !#zh \r\n * @property {String} name\r\n * @default \"\"\r\n * @example\r\n * obj.name = \"New Obj\";\r\n */\r\njs.getset(prototype, 'name',\r\n    function () {\r\n        return this._name;\r\n    },\r\n    function (value) {\r\n        this._name = value;\r\n    },\r\n    true\r\n);\r\n\r\n/**\r\n * !#en\r\n * Indicates whether the object is not yet destroyed. (It will not be available after being destroyed)<br>\r\n * When an object's `destroy` is called, it is actually destroyed after the end of this frame.\r\n * So `isValid` will return false from the next frame, while `isValid` in the current frame will still be true.\r\n * If you want to determine whether the current frame has called `destroy`, use `cc.isValid(obj, true)`,\r\n * but this is often caused by a particular logical requirements, which is not normally required.\r\n *\r\n * !#zh\r\n *  destroy <br>\r\n *  `destroy`  `isValid`  false `isValid`  true `destroy` `cc.isValid(obj, true)`\r\n *\r\n * @property {Boolean} isValid\r\n * @default true\r\n * @readOnly\r\n * @example\r\n * var node = new cc.Node();\r\n * cc.log(node.isValid);    // true\r\n * node.destroy();\r\n * cc.log(node.isValid);    // true, still valid in this frame\r\n * // after a frame...\r\n * cc.log(node.isValid);    // false, destroyed in the end of last frame\r\n */\r\njs.get(prototype, 'isValid', function () {\r\n    return !(this._objFlags & Destroyed);\r\n}, true);\r\n\r\nif (CC_EDITOR || CC_TEST) {\r\n    js.get(prototype, 'isRealValid', function () {\r\n        return !(this._objFlags & RealDestroyed);\r\n    });\r\n}\r\n\r\nvar deferredDestroyTimer = null;\r\n\r\n/**\r\n * !#en\r\n * Destroy this Object, and release all its own references to other objects.<br/>\r\n * Actual object destruction will delayed until before rendering.\r\n * From the next frame, this object is not usable any more.\r\n * You can use cc.isValid(obj) to check whether the object is destroyed before accessing it.\r\n * !#zh\r\n * <br/>\r\n * \r\n *  cc.isValid(obj) \r\n * @method destroy\r\n * @return {Boolean} whether it is the first time the destroy being called\r\n * @example\r\n * obj.destroy();\r\n */\r\nprototype.destroy = function () {\r\n    if (this._objFlags & Destroyed) {\r\n        cc.warnID(5000);\r\n        return false;\r\n    }\r\n    if (this._objFlags & ToDestroy) {\r\n        return false;\r\n    }\r\n    this._objFlags |= ToDestroy;\r\n    objectsToDestroy.push(this);\r\n\r\n    if (CC_EDITOR && deferredDestroyTimer === null && cc.engine && ! cc.engine._isUpdating) {\r\n        // auto destroy immediate in edit mode\r\n        deferredDestroyTimer = setImmediate(deferredDestroy);\r\n    }\r\n    return true;\r\n};\r\n\r\nif (CC_EDITOR || CC_TEST) {\r\n    /*\r\n     * !#en\r\n     * In fact, Object's \"destroy\" will not trigger the destruct operation in Firebal Editor.\r\n     * The destruct operation will be executed by Undo system later.\r\n     * !#zh\r\n     *  destroy \r\n     *  Undo ****\r\n     * @method realDestroyInEditor\r\n     * @private\r\n     */\r\n    prototype.realDestroyInEditor = function () {\r\n        if ( !(this._objFlags & Destroyed) ) {\r\n            cc.warnID(5001);\r\n            return;\r\n        }\r\n        if (this._objFlags & RealDestroyed) {\r\n            cc.warnID(5000);\r\n            return;\r\n        }\r\n        this._destruct();\r\n        this._objFlags |= RealDestroyed;\r\n    };\r\n}\r\n\r\nfunction compileDestruct (obj, ctor) {\r\n    var shouldSkipId = obj instanceof cc._BaseNode || obj instanceof cc.Component;\r\n    var idToSkip = shouldSkipId ? '_id' : null;\r\n\r\n    var key, propsToReset = {};\r\n    for (key in obj) {\r\n        if (obj.hasOwnProperty(key)) {\r\n            if (key === idToSkip) {\r\n                continue;\r\n            }\r\n            switch (typeof obj[key]) {\r\n                case 'string':\r\n                    propsToReset[key] = '';\r\n                    break;\r\n                case 'object':\r\n                case 'function':\r\n                    propsToReset[key] = null;\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    // Overwrite propsToReset according to Class\r\n    if (cc.Class._isCCClass(ctor)) {\r\n        var attrs = cc.Class.Attr.getClassAttrs(ctor);\r\n        var propList = ctor.__props__;\r\n        for (var i = 0; i < propList.length; i++) {\r\n            key = propList[i];\r\n            var attrKey = key + cc.Class.Attr.DELIMETER + 'default';\r\n            if (attrKey in attrs) {\r\n                if (shouldSkipId && key === '_id') {\r\n                    continue;\r\n                }\r\n                switch (typeof attrs[attrKey]) {\r\n                    case 'string':\r\n                        propsToReset[key] = '';\r\n                        break;\r\n                    case 'object':\r\n                    case 'function':\r\n                        propsToReset[key] = null;\r\n                        break;\r\n                    case 'undefined':\r\n                        propsToReset[key] = undefined;\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (CC_SUPPORT_JIT) {\r\n        // compile code\r\n        var func = '';\r\n        for (key in propsToReset) {\r\n            var statement;\r\n            if (CCClass.IDENTIFIER_RE.test(key)) {\r\n                statement = 'o.' + key + '=';\r\n            }\r\n            else {\r\n                statement = 'o[' + CCClass.escapeForJS(key) + ']=';\r\n            }\r\n            var val = propsToReset[key];\r\n            if (val === '') {\r\n                val = '\"\"';\r\n            }\r\n            func += (statement + val + ';\\n');\r\n        }\r\n        return Function('o', func);\r\n    }\r\n    else {\r\n        return function (o) {\r\n            for (var key in propsToReset) {\r\n                o[key] = propsToReset[key];\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Clear all references in the instance.\r\n *\r\n * NOTE: this method will not clear the getter or setter functions which defined in the instance of CCObject.\r\n *       You can override the _destruct method if you need, for example:\r\n *       _destruct: function () {\r\n *           for (var key in this) {\r\n *               if (this.hasOwnProperty(key)) {\r\n *                   switch (typeof this[key]) {\r\n *                       case 'string':\r\n *                           this[key] = '';\r\n *                           break;\r\n *                       case 'object':\r\n *                       case 'function':\r\n *                           this[key] = null;\r\n *                           break;\r\n *               }\r\n *           }\r\n *       }\r\n *\r\n * @method _destruct\r\n * @private\r\n */\r\nprototype._destruct = function () {\r\n    var ctor = this.constructor;\r\n    var destruct = ctor.__destruct__;\r\n    if (!destruct) {\r\n        destruct = compileDestruct(this, ctor);\r\n        js.value(ctor, '__destruct__', destruct, true);\r\n    }\r\n    destruct(this);\r\n};\r\n\r\n/**\r\n * Called before the object being destroyed.\r\n * @method _onPreDestroy\r\n * @private\r\n */\r\nprototype._onPreDestroy = null;\r\n\r\nprototype._destroyImmediate = function () {\r\n    if (this._objFlags & Destroyed) {\r\n        cc.errorID(5000);\r\n        return;\r\n    }\r\n    // engine internal callback\r\n    if (this._onPreDestroy) {\r\n        this._onPreDestroy();\r\n    }\r\n\r\n    if ((CC_TEST ? (/* make CC_EDITOR mockable*/ Function('return !CC_EDITOR'))() : !CC_EDITOR) || cc.engine._isPlaying) {\r\n        this._destruct();\r\n    }\r\n\r\n    this._objFlags |= Destroyed;\r\n};\r\n\r\nif (CC_EDITOR) {\r\n    /**\r\n     * The customized serialization for this object. (Editor Only)\r\n     * @method _serialize\r\n     * @param {Boolean} exporting\r\n     * @return {object} the serialized json data object\r\n     * @private\r\n     */\r\n    prototype._serialize = null;\r\n}\r\n\r\n/**\r\n * Init this object from the custom serialized data.\r\n * @method _deserialize\r\n * @param {Object} data - the serialized json data\r\n * @param {_Deserializer} ctx\r\n * @private\r\n */\r\nprototype._deserialize = null;\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en\r\n * Checks whether the object is non-nil and not yet destroyed.<br>\r\n * When an object's `destroy` is called, it is actually destroyed after the end of this frame.\r\n * So `isValid` will return false from the next frame, while `isValid` in the current frame will still be true.\r\n * If you want to determine whether the current frame has called `destroy`, use `cc.isValid(obj, true)`,\r\n * but this is often caused by a particular logical requirements, which is not normally required.\r\n *\r\n * !#zh\r\n *  null <br>\r\n *  `destroy`  `isValid`  false `isValid`  true `destroy` `cc.isValid(obj, true)`\r\n *\r\n * @method isValid\r\n * @param {any} value\r\n * @param {Boolean} [strictMode=false] - If true, Object called destroy() in this frame will also treated as invalid.\r\n * @return {Boolean} whether is valid\r\n * @example\r\n * var node = new cc.Node();\r\n * cc.log(cc.isValid(node));    // true\r\n * node.destroy();\r\n * cc.log(cc.isValid(node));    // true, still valid in this frame\r\n * // after a frame...\r\n * cc.log(cc.isValid(node));    // false, destroyed in the end of last frame\r\n */\r\ncc.isValid = function (value, strictMode) {\r\n    if (typeof value === 'object') {\r\n        return !!value && !(value._objFlags & (strictMode ? (Destroyed | ToDestroy) : Destroyed));\r\n    }\r\n    else {\r\n        return typeof value !== 'undefined';\r\n    }\r\n};\r\n\r\nif (CC_EDITOR || CC_TEST) {\r\n    js.value(CCObject, '_willDestroy', function (obj) {\r\n        return !(obj._objFlags & Destroyed) && (obj._objFlags & ToDestroy) > 0;\r\n    });\r\n    js.value(CCObject, '_cancelDestroy', function (obj) {\r\n        obj._objFlags &= ~ToDestroy;\r\n        js.array.fastRemove(objectsToDestroy, obj);\r\n    });\r\n}\r\n\r\ncc.Object = module.exports = CCObject;\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('../platform/js');\r\n\r\n/**\r\n * A SAX Parser\r\n * @class saxParser\r\n */\r\ncc.SAXParser = function () {\r\n    if (!(CC_EDITOR && Editor.isMainProcess) && window.DOMParser) {\r\n        this._isSupportDOMParser = true;\r\n        this._parser = new DOMParser();\r\n    } else {\r\n        this._isSupportDOMParser = false;\r\n        this._parser = null;\r\n    }\r\n};\r\ncc.SAXParser.prototype = {\r\n    constructor: cc.SAXParser,\r\n    /**\r\n     * @method parse\r\n     * @param {String} xmlTxt\r\n     * @return {Document}\r\n     */\r\n    parse : function(xmlTxt){\r\n        return this._parseXML(xmlTxt);\r\n    },\r\n\r\n    _parseXML: function (textxml) {\r\n        // get a reference to the requested corresponding xml file\r\n        var xmlDoc;\r\n        if (this._isSupportDOMParser) {\r\n            xmlDoc = this._parser.parseFromString(textxml, \"text/xml\");\r\n        } else {\r\n            // Internet Explorer (untested!)\r\n            xmlDoc = new ActiveXObject(\"Microsoft.XMLDOM\");\r\n            xmlDoc.async = \"false\";\r\n            xmlDoc.loadXML(textxml);\r\n        }\r\n        return xmlDoc;\r\n    }\r\n};\r\n\r\n/**\r\n *\r\n * cc.plistParser is a singleton object for parsing plist files\r\n * @class plistParser\r\n * @extends SAXParser\r\n */\r\ncc.PlistParser = function () {\r\n    cc.SAXParser.call(this);\r\n};\r\njs.extend(cc.PlistParser, cc.SAXParser);\r\njs.mixin(cc.PlistParser.prototype, {\r\n    /**\r\n     * parse a xml string as plist object.\r\n     * @param {String} xmlTxt - plist xml contents\r\n     * @return {*} plist object\r\n     */\r\n    parse : function (xmlTxt) {\r\n        var xmlDoc = this._parseXML(xmlTxt);\r\n        var plist = xmlDoc.documentElement;\r\n        if (plist.tagName !== 'plist') {\r\n            cc.warnID(5100);\r\n            return {};\r\n        }\r\n\r\n        // Get first real node\r\n        var node = null;\r\n        for (var i = 0, len = plist.childNodes.length; i < len; i++) {\r\n            node = plist.childNodes[i];\r\n            if (node.nodeType === 1)\r\n                break;\r\n        }\r\n        xmlDoc = null;\r\n        return this._parseNode(node);\r\n    },\r\n\r\n    _parseNode: function (node) {\r\n        var data = null, tagName = node.tagName;\r\n        if(tagName === \"dict\"){\r\n            data = this._parseDict(node);\r\n        }else if(tagName === \"array\"){\r\n            data = this._parseArray(node);\r\n        }else if(tagName === \"string\"){\r\n            if (node.childNodes.length === 1)\r\n                data = node.firstChild.nodeValue;\r\n            else {\r\n                //handle Firefox's 4KB nodeValue limit\r\n                data = \"\";\r\n                for (var i = 0; i < node.childNodes.length; i++)\r\n                    data += node.childNodes[i].nodeValue;\r\n            }\r\n        }else if(tagName === \"false\"){\r\n            data = false;\r\n        }else if(tagName === \"true\"){\r\n            data = true;\r\n        }else if(tagName === \"real\"){\r\n            data = parseFloat(node.firstChild.nodeValue);\r\n        }else if(tagName === \"integer\"){\r\n            data = parseInt(node.firstChild.nodeValue, 10);\r\n        }\r\n        return data;\r\n    },\r\n\r\n    _parseArray: function (node) {\r\n        var data = [];\r\n        for (var i = 0, len = node.childNodes.length; i < len; i++) {\r\n            var child = node.childNodes[i];\r\n            if (child.nodeType !== 1)\r\n                continue;\r\n            data.push(this._parseNode(child));\r\n        }\r\n        return data;\r\n    },\r\n\r\n    _parseDict: function (node) {\r\n        var data = {};\r\n        var key = null;\r\n        for (var i = 0, len = node.childNodes.length; i < len; i++) {\r\n            var child = node.childNodes[i];\r\n            if (child.nodeType !== 1)\r\n                continue;\r\n\r\n            // Grab the key, next noe should be the value\r\n            if (child.tagName === 'key')\r\n                key = child.firstChild.nodeValue;\r\n            else\r\n                data[key] = this._parseNode(child);                 // Parse the value node\r\n        }\r\n        return data;\r\n    }\r\n});\r\n\r\ncc.saxParser = new cc.SAXParser();\r\n/**\r\n * @type {PlistParser}\r\n * @name plistParser\r\n * A Plist Parser\r\n */\r\ncc.plistParser = new cc.PlistParser();\r\n\r\nmodule.exports = {\r\n    saxParser: cc.saxParser,\r\n    plistParser: cc.plistParser\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n \r\n http://www.cocos2d-x.org\r\n \r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n \r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n \r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * The fullscreen API provides an easy way for web content to be presented using the user's entire screen.\r\n * It's invalid on safari, QQbrowser and android browser\r\n * @class screen\r\n */\r\ncc.screen = /** @lends cc.screen# */{\r\n    _supportsFullScreen: false,\r\n    // the pre fullscreenchange function\r\n    _preOnFullScreenChange: null,\r\n    _touchEvent: \"\",\r\n    _fn: null,\r\n    // Function mapping for cross browser support\r\n    _fnMap: [\r\n        [\r\n            'requestFullscreen',\r\n            'exitFullscreen',\r\n            'fullscreenchange',\r\n            'fullscreenEnabled',\r\n            'fullscreenElement'\r\n        ],\r\n        [\r\n            'requestFullScreen',\r\n            'exitFullScreen',\r\n            'fullScreenchange',\r\n            'fullScreenEnabled',\r\n            'fullScreenElement'\r\n        ],\r\n        [\r\n            'webkitRequestFullScreen',\r\n            'webkitCancelFullScreen',\r\n            'webkitfullscreenchange',\r\n            'webkitIsFullScreen',\r\n            'webkitCurrentFullScreenElement'\r\n        ],\r\n        [\r\n            'mozRequestFullScreen',\r\n            'mozCancelFullScreen',\r\n            'mozfullscreenchange',\r\n            'mozFullScreen',\r\n            'mozFullScreenElement'\r\n        ],\r\n        [\r\n            'msRequestFullscreen',\r\n            'msExitFullscreen',\r\n            'MSFullscreenChange',\r\n            'msFullscreenEnabled',\r\n            'msFullscreenElement'\r\n        ]\r\n    ],\r\n    \r\n    /**\r\n     * initialize\r\n     * @method init\r\n     */\r\n    init: function () {\r\n        this._fn = {};\r\n        var i, l, val, map = this._fnMap, valL;\r\n        for (i = 0, l = map.length; i < l; i++) {\r\n            val = map[i];\r\n            if (val && (typeof document[val[1]] !== 'undefined')) {\r\n                for (i = 0, valL = val.length; i < valL; i++) {\r\n                    this._fn[map[0][i]] = val[i];\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        this._supportsFullScreen = (this._fn.requestFullscreen !== undefined);\r\n        this._touchEvent = ('ontouchstart' in window) ? 'touchstart' : 'mousedown';\r\n    },\r\n    \r\n    /**\r\n     * return true if it's full now.\r\n     * @method fullScreen\r\n     * @returns {Boolean}\r\n     */\r\n    fullScreen: function () {\r\n        if(!this._supportsFullScreen) return false;\r\n        else if( document[this._fn.fullscreenElement] === undefined || document[this._fn.fullscreenElement] === null )\r\n            return false;\r\n        else\r\n            return true;\r\n    },\r\n    \r\n    /**\r\n     * change the screen to full mode.\r\n     * @method requestFullScreen\r\n     * @param {Element} element\r\n     * @param {Function} onFullScreenChange\r\n     */\r\n    requestFullScreen: function (element, onFullScreenChange) {\r\n        if (element.tagName.toLowerCase() === \"video\") {\r\n            if (cc.sys.os === cc.sys.OS_IOS && cc.sys.isBrowser && element.readyState > 0) {\r\n                element.webkitEnterFullscreen && element.webkitEnterFullscreen();\r\n                return;\r\n            }\r\n            else {\r\n                element.setAttribute(\"x5-video-player-fullscreen\", \"true\");\r\n            }\r\n        }\r\n\r\n        if (!this._supportsFullScreen) {\r\n            return;\r\n        }\r\n\r\n        element = element || document.documentElement;\r\n\r\n        if (onFullScreenChange) {\r\n            var eventName = this._fn.fullscreenchange;\r\n            if (this._preOnFullScreenChange) {\r\n                document.removeEventListener(eventName, this._preOnFullScreenChange);\r\n            }\r\n            this._preOnFullScreenChange = onFullScreenChange;\r\n            document.addEventListener(eventName, onFullScreenChange, false);\r\n        }\r\n\r\n        return element[this._fn.requestFullscreen]();\r\n    },\r\n    \r\n    /**\r\n     * exit the full mode.\r\n     * @method exitFullScreen\r\n     * @return {Boolean}\r\n     */\r\n    exitFullScreen: function (element) {\r\n        if (element.tagName.toLowerCase() === \"video\") {\r\n            if (cc.sys.os === cc.sys.OS_IOS && cc.sys.isBrowser) {\r\n                element.webkitExitFullscreen && element.webkitExitFullscreen();\r\n                return;\r\n            }\r\n            else {\r\n                element.setAttribute(\"x5-video-player-fullscreen\", \"false\");\r\n            }\r\n        }\r\n        return this._supportsFullScreen ? document[this._fn.exitFullscreen]() : true;\r\n    },\r\n    \r\n    /**\r\n     * Automatically request full screen with a touch/click event\r\n     * @method autoFullScreen\r\n     * @param {Element} element\r\n     * @param {Function} onFullScreenChange\r\n     */\r\n    autoFullScreen: function (element, onFullScreenChange) {\r\n        element = element || document.body;\r\n        var touchTarget = cc.game.canvas || element;\r\n        var theScreen = this;\r\n        // Function bind will be too complicated here because we need the callback function's reference to remove the listener\r\n        function callback() {\r\n            touchTarget.removeEventListener(theScreen._touchEvent, callback);\r\n            theScreen.requestFullScreen(element, onFullScreenChange);\r\n        }\r\n        this.requestFullScreen(element, onFullScreenChange);\r\n        touchTarget.addEventListener(this._touchEvent, callback);\r\n    }\r\n};\r\ncc.screen.init();\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nfunction initSys () {\r\n    /**\r\n     * System variables\r\n     * @class sys\r\n     * @main\r\n     * @static\r\n     */\r\n    cc.sys = {};\r\n    var sys = cc.sys;\r\n\r\n    /**\r\n     * English language code\r\n     * @property {String} LANGUAGE_ENGLISH\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_ENGLISH = \"en\";\r\n\r\n    /**\r\n     * Chinese language code\r\n     * @property {String} LANGUAGE_CHINESE\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_CHINESE = \"zh\";\r\n\r\n    /**\r\n     * French language code\r\n     * @property {String} LANGUAGE_FRENCH\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_FRENCH = \"fr\";\r\n\r\n    /**\r\n     * Italian language code\r\n     * @property {String} LANGUAGE_ITALIAN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_ITALIAN = \"it\";\r\n\r\n    /**\r\n     * German language code\r\n     * @property {String} LANGUAGE_GERMAN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_GERMAN = \"de\";\r\n\r\n    /**\r\n     * Spanish language code\r\n     * @property {String} LANGUAGE_SPANISH\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_SPANISH = \"es\";\r\n\r\n    /**\r\n     * Spanish language code\r\n     * @property {String} LANGUAGE_DUTCH\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_DUTCH = \"du\";\r\n\r\n    /**\r\n     * Russian language code\r\n     * @property {String} LANGUAGE_RUSSIAN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_RUSSIAN = \"ru\";\r\n\r\n    /**\r\n     * Korean language code\r\n     * @property {String} LANGUAGE_KOREAN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_KOREAN = \"ko\";\r\n\r\n    /**\r\n     * Japanese language code\r\n     * @property {String} LANGUAGE_JAPANESE\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_JAPANESE = \"ja\";\r\n\r\n    /**\r\n     * Hungarian language code\r\n     * @property {String} LANGUAGE_HUNGARIAN\r\n     * @readonly\r\n     */\r\n    sys.LANGUAGE_HUNGARIAN = \"hu\";\r\n\r\n    /**\r\n     * Portuguese language code\r\n     * @property {String} LANGUAGE_PORTUGUESE\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_PORTUGUESE = \"pt\";\r\n\r\n    /**\r\n     * Arabic language code\r\n     * @property {String} LANGUAGE_ARABIC\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_ARABIC = \"ar\";\r\n\r\n    /**\r\n     * Norwegian language code\r\n     * @property {String} LANGUAGE_NORWEGIAN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_NORWEGIAN = \"no\";\r\n\r\n    /**\r\n     * Polish language code\r\n     * @property {String} LANGUAGE_POLISH\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_POLISH = \"pl\";\r\n\r\n    /**\r\n     * Turkish language code\r\n     * @property {String} LANGUAGE_TURKISH\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_TURKISH = \"tr\";\r\n\r\n    /**\r\n     * Ukrainian language code\r\n     * @property {String} LANGUAGE_UKRAINIAN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_UKRAINIAN = \"uk\";\r\n\r\n    /**\r\n     * Romanian language code\r\n     * @property {String} LANGUAGE_ROMANIAN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_ROMANIAN = \"ro\";\r\n\r\n    /**\r\n     * Bulgarian language code\r\n     * @property {String} LANGUAGE_BULGARIAN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_BULGARIAN = \"bg\";\r\n\r\n    /**\r\n     * Unknown language code\r\n     * @property {String} LANGUAGE_UNKNOWN\r\n     * @readOnly\r\n     */\r\n    sys.LANGUAGE_UNKNOWN = \"unknown\";\r\n\r\n    /**\r\n     * @property {String} OS_IOS\r\n     * @readOnly\r\n     */\r\n    sys.OS_IOS = \"iOS\";\r\n    /**\r\n     * @property {String} OS_ANDROID\r\n     * @readOnly\r\n     */\r\n    sys.OS_ANDROID = \"Android\";\r\n    /**\r\n     * @property {String} OS_WINDOWS\r\n     * @readOnly\r\n     */\r\n    sys.OS_WINDOWS = \"Windows\";\r\n    /**\r\n     * @property {String} OS_MARMALADE\r\n     * @readOnly\r\n     */\r\n    sys.OS_MARMALADE = \"Marmalade\";\r\n    /**\r\n     * @property {String} OS_LINUX\r\n     * @readOnly\r\n     */\r\n    sys.OS_LINUX = \"Linux\";\r\n    /**\r\n     * @property {String} OS_BADA\r\n     * @readOnly\r\n     */\r\n    sys.OS_BADA = \"Bada\";\r\n    /**\r\n     * @property {String} OS_BLACKBERRY\r\n     * @readOnly\r\n     */\r\n    sys.OS_BLACKBERRY = \"Blackberry\";\r\n    /**\r\n     * @property {String} OS_OSX\r\n     * @readOnly\r\n     */\r\n    sys.OS_OSX = \"OS X\";\r\n    /**\r\n     * @property {String} OS_WP8\r\n     * @readOnly\r\n     */\r\n    sys.OS_WP8 = \"WP8\";\r\n    /**\r\n     * @property {String} OS_WINRT\r\n     * @readOnly\r\n     */\r\n    sys.OS_WINRT = \"WINRT\";\r\n    /**\r\n     * @property {String} OS_UNKNOWN\r\n     * @readOnly\r\n     */\r\n    sys.OS_UNKNOWN = \"Unknown\";\r\n\r\n    /**\r\n     * @property {Number} UNKNOWN\r\n     * @readOnly\r\n     * @default -1\r\n     */\r\n    sys.UNKNOWN = -1;\r\n    /**\r\n     * @property {Number} WIN32\r\n     * @readOnly\r\n     * @default 0\r\n     */\r\n    sys.WIN32 = 0;\r\n    /**\r\n     * @property {Number} LINUX\r\n     * @readOnly\r\n     * @default 1\r\n     */\r\n    sys.LINUX = 1;\r\n    /**\r\n     * @property {Number} MACOS\r\n     * @readOnly\r\n     * @default 2\r\n     */\r\n    sys.MACOS = 2;\r\n    /**\r\n     * @property {Number} ANDROID\r\n     * @readOnly\r\n     * @default 3\r\n     */\r\n    sys.ANDROID = 3;\r\n    /**\r\n     * @property {Number} IPHONE\r\n     * @readOnly\r\n     * @default 4\r\n     */\r\n    sys.IPHONE = 4;\r\n    /**\r\n     * @property {Number} IPAD\r\n     * @readOnly\r\n     * @default 5\r\n     */\r\n    sys.IPAD = 5;\r\n    /**\r\n     * @property {Number} BLACKBERRY\r\n     * @readOnly\r\n     * @default 6\r\n     */\r\n    sys.BLACKBERRY = 6;\r\n    /**\r\n     * @property {Number} NACL\r\n     * @readOnly\r\n     * @default 7\r\n     */\r\n    sys.NACL = 7;\r\n    /**\r\n     * @property {Number} EMSCRIPTEN\r\n     * @readOnly\r\n     * @default 8\r\n     */\r\n    sys.EMSCRIPTEN = 8;\r\n    /**\r\n     * @property {Number} TIZEN\r\n     * @readOnly\r\n     * @default 9\r\n     */\r\n    sys.TIZEN = 9;\r\n    /**\r\n     * @property {Number} WINRT\r\n     * @readOnly\r\n     * @default 10\r\n     */\r\n    sys.WINRT = 10;\r\n    /**\r\n     * @property {Number} WP8\r\n     * @readOnly\r\n     * @default 11\r\n     */\r\n    sys.WP8 = 11;\r\n    /**\r\n     * @property {Number} MOBILE_BROWSER\r\n     * @readOnly\r\n     * @default 100\r\n     */\r\n    sys.MOBILE_BROWSER = 100;\r\n    /**\r\n     * @property {Number} DESKTOP_BROWSER\r\n     * @readOnly\r\n     * @default 101\r\n     */\r\n    sys.DESKTOP_BROWSER = 101;\r\n\r\n    /**\r\n     * Indicates whether executes in editor's window process (Electron's renderer context)\r\n     * @property {Number} EDITOR_PAGE\r\n     * @readOnly\r\n     * @default 102\r\n     */\r\n    sys.EDITOR_PAGE = 102;\r\n    /**\r\n     * Indicates whether executes in editor's main process (Electron's browser context)\r\n     * @property {Number} EDITOR_CORE\r\n     * @readOnly\r\n     * @default 103\r\n     */\r\n    sys.EDITOR_CORE = 103;\r\n    /**\r\n     * @property {Number} WECHAT_GAME\r\n     * @readOnly\r\n     * @default 104\r\n     */\r\n    sys.WECHAT_GAME = 104;\r\n    /**\r\n     * @property {Number} QQ_PLAY\r\n     * @readOnly\r\n     * @default 105\r\n     */\r\n    sys.QQ_PLAY = 105;\r\n    /**\r\n     * @property {Number} FB_PLAYABLE_ADS\r\n     * @readOnly\r\n     * @default 106\r\n     */\r\n    sys.FB_PLAYABLE_ADS = 106;\r\n    /**\r\n     * BROWSER_TYPE_WECHAT\r\n     * @property {String} BROWSER_TYPE_WECHAT\r\n     * @readOnly\r\n     * @default \"wechat\"\r\n     */\r\n    sys.BROWSER_TYPE_WECHAT = \"wechat\";\r\n    /**\r\n     * BROWSER_TYPE_WECHAT_GAME\r\n     * @property {String} BROWSER_TYPE_WECHAT_GAME\r\n     * @readOnly\r\n     * @default \"wechatgame\"\r\n     */\r\n    sys.BROWSER_TYPE_WECHAT_GAME = \"wechatgame\";\r\n    /**\r\n     * BROWSER_TYPE_WECHAT_GAME_SUB\r\n     * @property {String} BROWSER_TYPE_WECHAT_GAME_SUB\r\n     * @readOnly\r\n     * @default \"wechatgamesub\"\r\n     */\r\n    sys.BROWSER_TYPE_WECHAT_GAME_SUB = \"wechatgamesub\";\r\n    /**\r\n     * BROWSER_TYPE_QQ_PLAY\r\n     * @property {String} BROWSER_TYPE_QQ_PLAY\r\n     * @readOnly\r\n     * @default \"qqplay\"\r\n     */\r\n    sys.BROWSER_TYPE_QQ_PLAY = \"qqplay\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_ANDROID\r\n     * @readOnly\r\n     * @default \"androidbrowser\"\r\n     */\r\n    sys.BROWSER_TYPE_ANDROID = \"androidbrowser\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_IE\r\n     * @readOnly\r\n     * @default \"ie\"\r\n     */\r\n    sys.BROWSER_TYPE_IE = \"ie\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_QQ\r\n     * @readOnly\r\n     * @default \"qqbrowser\"\r\n     */\r\n    sys.BROWSER_TYPE_QQ = \"qqbrowser\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_MOBILE_QQ\r\n     * @readOnly\r\n     * @default \"mqqbrowser\"\r\n     */\r\n    sys.BROWSER_TYPE_MOBILE_QQ = \"mqqbrowser\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_UC\r\n     * @readOnly\r\n     * @default \"ucbrowser\"\r\n     */\r\n    sys.BROWSER_TYPE_UC = \"ucbrowser\";\r\n    /**\r\n     * uc third party integration.\r\n     * @property {String} BROWSER_TYPE_UCBS\r\n     * @readOnly\r\n     * @default \"ucbs\"\r\n     */\r\n    sys.BROWSER_TYPE_UCBS = \"ucbs\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_360\r\n     * @readOnly\r\n     * @default \"360browser\"\r\n     */\r\n    sys.BROWSER_TYPE_360 = \"360browser\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_BAIDU_APP\r\n     * @readOnly\r\n     * @default \"baiduboxapp\"\r\n     */\r\n    sys.BROWSER_TYPE_BAIDU_APP = \"baiduboxapp\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_BAIDU\r\n     * @readOnly\r\n     * @default \"baidubrowser\"\r\n     */\r\n    sys.BROWSER_TYPE_BAIDU = \"baidubrowser\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_MAXTHON\r\n     * @readOnly\r\n     * @default \"maxthon\"\r\n     */\r\n    sys.BROWSER_TYPE_MAXTHON = \"maxthon\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_OPERA\r\n     * @readOnly\r\n     * @default \"opera\"\r\n     */\r\n    sys.BROWSER_TYPE_OPERA = \"opera\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_OUPENG\r\n     * @readOnly\r\n     * @default \"oupeng\"\r\n     */\r\n    sys.BROWSER_TYPE_OUPENG = \"oupeng\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_MIUI\r\n     * @readOnly\r\n     * @default \"miuibrowser\"\r\n     */\r\n    sys.BROWSER_TYPE_MIUI = \"miuibrowser\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_FIREFOX\r\n     * @readOnly\r\n     * @default \"firefox\"\r\n     */\r\n    sys.BROWSER_TYPE_FIREFOX = \"firefox\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_SAFARI\r\n     * @readOnly\r\n     * @default \"safari\"\r\n     */\r\n    sys.BROWSER_TYPE_SAFARI = \"safari\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_CHROME\r\n     * @readOnly\r\n     * @default \"chrome\"\r\n     */\r\n    sys.BROWSER_TYPE_CHROME = \"chrome\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_LIEBAO\r\n     * @readOnly\r\n     * @default \"liebao\"\r\n     */\r\n    sys.BROWSER_TYPE_LIEBAO = \"liebao\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_QZONE\r\n     * @readOnly\r\n     * @default \"qzone\"\r\n     */\r\n    sys.BROWSER_TYPE_QZONE = \"qzone\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_SOUGOU\r\n     * @readOnly\r\n     * @default \"sogou\"\r\n     */\r\n    sys.BROWSER_TYPE_SOUGOU = \"sogou\";\r\n    /**\r\n     *\r\n     * @property {String} BROWSER_TYPE_UNKNOWN\r\n     * @readOnly\r\n     * @default \"unknown\"\r\n     */\r\n    sys.BROWSER_TYPE_UNKNOWN = \"unknown\";\r\n\r\n    /**\r\n     * Is native ? This is set to be true in jsb auto.\r\n     * @property {Boolean} isNative\r\n     */\r\n    sys.isNative = CC_JSB;\r\n\r\n\r\n    /**\r\n     * Is web browser ?\r\n     * @property {Boolean} isBrowser\r\n     */\r\n    sys.isBrowser = typeof window === 'object' && typeof document === 'object' && !CC_WECHATGAME && !CC_QQPLAY && !CC_JSB;\r\n\r\n    if (CC_EDITOR && Editor.isMainProcess) {\r\n        sys.isMobile = false;\r\n        sys.platform = sys.EDITOR_CORE;\r\n        sys.language = sys.LANGUAGE_UNKNOWN;\r\n        sys.os = ({\r\n            darwin: sys.OS_OSX,\r\n            win32: sys.OS_WINDOWS,\r\n            linux: sys.OS_LINUX\r\n        })[process.platform] || sys.OS_UNKNOWN;\r\n        sys.browserType = null;\r\n        sys.browserVersion = null;\r\n        sys.windowPixelResolution = {\r\n            width: 0,\r\n            height: 0\r\n        };\r\n        sys.__audioSupport = {};\r\n    }\r\n    else if (CC_JSB) {\r\n        var platform = sys.platform = __getPlatform();\r\n        sys.isMobile = (platform === sys.ANDROID ||\r\n                        platform === sys.IPAD ||\r\n                        platform === sys.IPHONE ||\r\n                        platform === sys.WP8 ||\r\n                        platform === sys.TIZEN ||\r\n                        platform === sys.BLACKBERRY);\r\n\r\n        sys.os = __getOS();\r\n        sys.language = __getCurrentLanguage();\r\n        sys.osVersion = __getOSVersion();\r\n        sys.osMainVersion = parseInt(sys.osVersion);\r\n        sys.browserType = null;\r\n        sys.browserVersion = null;\r\n\r\n        var w = window.innerWidth;\r\n        var h = window.innerHeight;\r\n        var ratio = window.devicePixelRatio || 1;\r\n        sys.windowPixelResolution = {\r\n            width: ratio * w,\r\n            height: ratio * h\r\n        };\r\n\r\n        sys.localStorage = window.localStorage;\r\n\r\n        var capabilities;\r\n        capabilities = sys.capabilities = {\r\n            \"canvas\": false,\r\n            \"opengl\": true,\r\n            \"webp\": true,\r\n        };\r\n\r\n       if (sys.isMobile) {\r\n            capabilities[\"accelerometer\"] = true;\r\n            capabilities[\"touches\"] = true;\r\n        } else {\r\n            // desktop\r\n            capabilities[\"keyboard\"] = true;\r\n            capabilities[\"mouse\"] = true;\r\n            capabilities[\"touches\"] = false;\r\n        }\r\n\r\n        sys.__audioSupport = {\r\n            ONLY_ONE: false,\r\n            WEB_AUDIO: false,\r\n            DELAY_CREATE_CTX: false,\r\n            format: ['.mp3']\r\n        };\r\n    }\r\n    else if (CC_WECHATGAME) {\r\n        var env = wx.getSystemInfoSync();\r\n        sys.isMobile = true;\r\n        sys.platform = sys.WECHAT_GAME;\r\n        sys.language = env.language.substr(0, 2);\r\n        var system = env.system.toLowerCase();\r\n        if (env.platform === \"android\") {\r\n            sys.os = sys.OS_ANDROID;\r\n        }\r\n        else if (env.platform === \"ios\") {\r\n            sys.os = sys.OS_IOS;\r\n        }\r\n        else if (env.platform === 'devtools') {\r\n            sys.isMobile = false;\r\n            if (system.indexOf('android') > -1) {\r\n                sys.os = sys.OS_ANDROID;\r\n            }\r\n            else if (system.indexOf('ios') > -1) {\r\n                sys.os = sys.OS_IOS;\r\n            }\r\n        }\r\n        // Adaptation to Android P\r\n        if (system === 'android p') {\r\n            system = 'android p 9.0';\r\n        }\r\n\r\n        var version = /[\\d\\.]+/.exec(system);\r\n        sys.osVersion = version ? version[0] : system;\r\n        sys.osMainVersion = parseInt(sys.osVersion);\r\n        // wechagame subdomain\r\n        if (!wx.getFileSystemManager) {\r\n            sys.browserType = sys.BROWSER_TYPE_WECHAT_GAME_SUB;\r\n        }\r\n        else {\r\n            sys.browserType = sys.BROWSER_TYPE_WECHAT_GAME;\r\n        }\r\n        sys.browserVersion = env.version;\r\n\r\n        var w = env.windowWidth;\r\n        var h = env.windowHeight;\r\n        var ratio = env.pixelRatio || 1;\r\n        sys.windowPixelResolution = {\r\n            width: ratio * w,\r\n            height: ratio * h\r\n        };\r\n\r\n        sys.localStorage = window.localStorage;\r\n\r\n        sys.capabilities = {\r\n            \"canvas\": true,\r\n            \"opengl\": (sys.browserType !== sys.BROWSER_TYPE_WECHAT_GAME_SUB),\r\n            \"webp\": false\r\n        };\r\n        sys.__audioSupport = {\r\n            ONLY_ONE: false,\r\n            WEB_AUDIO: false,\r\n            DELAY_CREATE_CTX: false,\r\n            format: ['.mp3']\r\n        };\r\n    }\r\n    else if (CC_QQPLAY) {\r\n        var env = window[\"BK\"][\"Director\"][\"queryDeviceInfo\"]();\r\n        sys.isMobile = true;\r\n        sys.platform = sys.QQ_PLAY;\r\n        sys.language = sys.LANGUAGE_UNKNOWN;\r\n        if (env.platform === \"android\") {\r\n            sys.os = sys.OS_ANDROID;\r\n        }\r\n        else if (env.platform === \"ios\") {\r\n            sys.os = sys.OS_IOS;\r\n        }\r\n        else {\r\n            sys.os = sys.OS_UNKNOWN;\r\n        }\r\n        sys.osVersion = env.version;\r\n        sys.osMainVersion = parseInt(sys.osVersion.split('.')[0]);\r\n        sys.browserType = sys.BROWSER_TYPE_QQ_PLAY;\r\n        sys.browserVersion = 0;\r\n\r\n        var w = env.screenWidth;\r\n        var h = env.screenHeight;\r\n        var ratio = env.pixelRatio || 1;\r\n\r\n        sys.windowPixelResolution = {\r\n            width: ratio * w,\r\n            height: ratio * h\r\n        };\r\n\r\n        sys.localStorage = window.localStorage;\r\n\r\n        sys.capabilities = {\r\n            \"canvas\": false,\r\n            \"opengl\": true,\r\n            \"webp\": false\r\n        };\r\n        sys.__audioSupport = {\r\n            ONLY_ONE: false,\r\n            WEB_AUDIO: false,\r\n            DELAY_CREATE_CTX: false,\r\n            format: ['.mp3']\r\n        };\r\n    }\r\n    else {\r\n        // browser or runtime\r\n        var win = window, nav = win.navigator, doc = document, docEle = doc.documentElement;\r\n        var ua = nav.userAgent.toLowerCase();\r\n\r\n        if (CC_EDITOR) {\r\n            sys.isMobile = false;\r\n            sys.platform = sys.EDITOR_PAGE;\r\n        }\r\n        else {\r\n            /**\r\n             * Indicate whether system is mobile system\r\n             * @property {Boolean} isMobile\r\n             */\r\n            sys.isMobile = /mobile|android|iphone|ipad/.test(ua);\r\n\r\n            /**\r\n             * Indicate the running platform\r\n             * @property {Number} platform\r\n             */\r\n            if (typeof FbPlayableAd !== \"undefined\") {\r\n                sys.platform = sys.FB_PLAYABLE_ADS;\r\n            }\r\n            else {\r\n                sys.platform = sys.isMobile ? sys.MOBILE_BROWSER : sys.DESKTOP_BROWSER;\r\n            }\r\n        }\r\n\r\n        var currLanguage = nav.language;\r\n        currLanguage = currLanguage ? currLanguage : nav.browserLanguage;\r\n        currLanguage = currLanguage ? currLanguage.split(\"-\")[0] : sys.LANGUAGE_ENGLISH;\r\n\r\n        /**\r\n         * Indicate the current language of the running system\r\n         * @property {String} language\r\n         */\r\n        sys.language = currLanguage;\r\n\r\n        // Get the os of system\r\n        var isAndroid = false, iOS = false, osVersion = '', osMainVersion = 0;\r\n        var uaResult = /android (\\d+(?:\\.\\d+)+)/i.exec(ua) || /android (\\d+(?:\\.\\d+)+)/i.exec(nav.platform);\r\n        if (uaResult) {\r\n            isAndroid = true;\r\n            osVersion = uaResult[1] || '';\r\n            osMainVersion = parseInt(osVersion) || 0;\r\n        }\r\n        uaResult = /(iPad|iPhone|iPod).*OS ((\\d+_?){2,3})/i.exec(ua);\r\n        if (uaResult) {\r\n            iOS = true;\r\n            osVersion = uaResult[2] || '';\r\n            osMainVersion = parseInt(osVersion) || 0;\r\n        }\r\n        else if (/(iPhone|iPad|iPod)/.exec(nav.platform)) {\r\n            iOS = true;\r\n            osVersion = '';\r\n            osMainVersion = 0;\r\n        }\r\n\r\n        var osName = sys.OS_UNKNOWN;\r\n        if (nav.appVersion.indexOf(\"Win\") !== -1) osName = sys.OS_WINDOWS;\r\n        else if (iOS) osName = sys.OS_IOS;\r\n        else if (nav.appVersion.indexOf(\"Mac\") !== -1) osName = sys.OS_OSX;\r\n        else if (nav.appVersion.indexOf(\"X11\") !== -1 && nav.appVersion.indexOf(\"Linux\") === -1) osName = sys.OS_UNIX;\r\n        else if (isAndroid) osName = sys.OS_ANDROID;\r\n        else if (nav.appVersion.indexOf(\"Linux\") !== -1 || ua.indexOf(\"ubuntu\") !== -1) osName = sys.OS_LINUX;\r\n\r\n        /**\r\n         * Indicate the running os name\r\n         * @property {String} os\r\n         */\r\n        sys.os = osName;\r\n        /**\r\n         * Indicate the running os version\r\n         * @property {String} osVersion\r\n         */\r\n        sys.osVersion = osVersion;\r\n        /**\r\n         * Indicate the running os main version\r\n         * @property {Number} osMainVersion\r\n         */\r\n        sys.osMainVersion = osMainVersion;\r\n\r\n        /**\r\n         * Indicate the running browser type\r\n         * @property {String} browserType\r\n         */\r\n        sys.browserType = sys.BROWSER_TYPE_UNKNOWN;\r\n        /* Determine the browser type */\r\n        (function(){\r\n            var typeReg1 = /mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i;\r\n            var typeReg2 = /qqbrowser|ucbrowser/i;\r\n            var typeReg3 = /chrome|safari|firefox|trident|opera|opr\\/|oupeng/i;\r\n            var browserTypes = typeReg1.exec(ua);\r\n            if(!browserTypes) browserTypes = typeReg2.exec(ua);\r\n            if(!browserTypes) browserTypes = typeReg3.exec(ua);\r\n\r\n            var browserType = browserTypes ? browserTypes[0].toLowerCase() : sys.BROWSER_TYPE_UNKNOWN;\r\n            if (CC_WECHATGAME)\r\n                browserType = sys.BROWSER_TYPE_WECHAT_GAME;\r\n            else if (CC_QQPLAY)\r\n                browserType = sys.BROWSER_TYPE_QQ_PLAY;\r\n            else if (browserType === 'micromessenger')\r\n                browserType = sys.BROWSER_TYPE_WECHAT;\r\n            else if (browserType === \"safari\" && isAndroid)\r\n                browserType = sys.BROWSER_TYPE_ANDROID;\r\n            else if (browserType === \"qq\" && ua.match(/android.*applewebkit/i))\r\n                browserType = sys.BROWSER_TYPE_ANDROID;\r\n            else if (browserType === \"trident\")\r\n                browserType = sys.BROWSER_TYPE_IE;\r\n            else if (browserType === \"360 aphone\")\r\n                browserType = sys.BROWSER_TYPE_360;\r\n            else if (browserType === \"mxbrowser\")\r\n                browserType = sys.BROWSER_TYPE_MAXTHON;\r\n            else if (browserType === \"opr/\")\r\n                browserType = sys.BROWSER_TYPE_OPERA;\r\n\r\n            sys.browserType = browserType;\r\n        })();\r\n\r\n        /**\r\n         * Indicate the running browser version\r\n         * @property {String} browserVersion\r\n         */\r\n        sys.browserVersion = \"\";\r\n        /* Determine the browser version number */\r\n        (function(){\r\n            var versionReg1 = /(mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\\/?([\\d.]+)/i;\r\n            var versionReg2 = /(qqbrowser|chrome|safari|firefox|trident|opera|opr\\/|oupeng)(mobile)?(browser)?\\/?([\\d.]+)/i;\r\n            var tmp = ua.match(versionReg1);\r\n            if(!tmp) tmp = ua.match(versionReg2);\r\n            sys.browserVersion = tmp ? tmp[4] : \"\";\r\n        })();\r\n\r\n        var w = window.innerWidth || document.documentElement.clientWidth;\r\n        var h = window.innerHeight || document.documentElement.clientHeight;\r\n        var ratio = window.devicePixelRatio || 1;\r\n\r\n        /**\r\n         * Indicate the real pixel resolution of the whole game window\r\n         * @property {Size} windowPixelResolution\r\n         */\r\n        sys.windowPixelResolution = {\r\n            width: ratio * w,\r\n            height: ratio * h\r\n        };\r\n\r\n        sys._checkWebGLRenderMode = function () {\r\n            if (cc.game.renderType !== cc.game.RENDER_TYPE_WEBGL)\r\n                throw new Error(\"This feature supports WebGL render mode only.\");\r\n        };\r\n\r\n        var _tmpCanvas1 = document.createElement(\"canvas\");\r\n\r\n        var create3DContext = function (canvas, opt_attribs, opt_contextType) {\r\n            if (opt_contextType) {\r\n                try {\r\n                    return canvas.getContext(opt_contextType, opt_attribs);\r\n                } catch (e) {\r\n                    return null;\r\n                }\r\n            }\r\n            else {\r\n                return create3DContext(canvas, opt_attribs, \"webgl\") ||\r\n                    create3DContext(canvas, opt_attribs, \"experimental-webgl\") ||\r\n                    create3DContext(canvas, opt_attribs, \"webkit-3d\") ||\r\n                    create3DContext(canvas, opt_attribs, \"moz-webgl\") ||\r\n                    null;\r\n            }\r\n        };\r\n\r\n        /**\r\n         * cc.sys.localStorage is a local storage component.\r\n         * @property {Object} localStorage\r\n         */\r\n        try {\r\n            var localStorage = sys.localStorage = win.localStorage;\r\n            localStorage.setItem(\"storage\", \"\");\r\n            localStorage.removeItem(\"storage\");\r\n            localStorage = null;\r\n        } catch (e) {\r\n            var warn = function () {\r\n                cc.warnID(5200);\r\n            };\r\n            sys.localStorage = {\r\n                getItem : warn,\r\n                setItem : warn,\r\n                removeItem : warn,\r\n                clear : warn\r\n            };\r\n        }\r\n\r\n        var _supportWebp = _tmpCanvas1.toDataURL('image/webp').startsWith('data:image/webp');\r\n        var _supportCanvas = !!_tmpCanvas1.getContext(\"2d\");\r\n        var _supportWebGL = false;\r\n        if (CC_TEST) {\r\n            _supportWebGL = false;\r\n        }\r\n        else if (sys.browserType === sys.BROWSER_TYPE_WECHAT_GAME) {\r\n            _supportWebGL = true;\r\n        }\r\n        else if (win.WebGLRenderingContext) {\r\n            _supportWebGL = true;\r\n        }\r\n\r\n        /**\r\n         * The capabilities of the current platform\r\n         * @property {Object} capabilities\r\n         */\r\n        var capabilities = sys.capabilities = {\r\n            \"canvas\": _supportCanvas,\r\n            \"opengl\": _supportWebGL,\r\n            \"webp\": _supportWebp,\r\n        };\r\n        if (docEle['ontouchstart'] !== undefined || doc['ontouchstart'] !== undefined || nav.msPointerEnabled)\r\n            capabilities[\"touches\"] = true;\r\n        if (docEle['onmouseup'] !== undefined)\r\n            capabilities[\"mouse\"] = true;\r\n        if (docEle['onkeyup'] !== undefined)\r\n            capabilities[\"keyboard\"] = true;\r\n        if (win.DeviceMotionEvent || win.DeviceOrientationEvent)\r\n            capabilities[\"accelerometer\"] = true;\r\n\r\n        var __audioSupport;\r\n\r\n        /**\r\n         * Audio support in the browser\r\n         *\r\n         * MULTI_CHANNEL        : Multiple audio while playing - If it doesn't, you can only play background music\r\n         * WEB_AUDIO            : Support for WebAudio - Support W3C WebAudio standards, all of the audio can be played\r\n         * AUTOPLAY             : Supports auto-play audio - if Dont support it, On a touch detecting background music canvas, and then replay\r\n         * REPLAY_AFTER_TOUCH   : The first music will fail, must be replay after touchstart\r\n         * USE_EMPTIED_EVENT    : Whether to use the emptied event to replace load callback\r\n         * DELAY_CREATE_CTX     : delay created the context object - only webAudio\r\n         * NEED_MANUAL_LOOP     : loop attribute failure, need to perform loop manually\r\n         *\r\n         * May be modifications for a few browser version\r\n         */\r\n        (function(){\r\n\r\n            var DEBUG = false;\r\n\r\n            var version = sys.browserVersion;\r\n\r\n            // check if browser supports Web Audio\r\n            // check Web Audio's context\r\n            var supportWebAudio = sys.browserType !== sys.BROWSER_TYPE_WECHAT_GAME &&\r\n                                !!(window.AudioContext || window.webkitAudioContext || window.mozAudioContext);\r\n\r\n            __audioSupport = { ONLY_ONE: false, WEB_AUDIO: supportWebAudio, DELAY_CREATE_CTX: false };\r\n\r\n            if (sys.os === sys.OS_IOS) {\r\n                // IOS no event that used to parse completed callback\r\n                // this time is not complete, can not play\r\n                //\r\n                __audioSupport.USE_LOADER_EVENT = 'loadedmetadata';\r\n            }\r\n\r\n            if (sys.browserType === sys.BROWSER_TYPE_FIREFOX) {\r\n                __audioSupport.DELAY_CREATE_CTX = true;\r\n                __audioSupport.USE_LOADER_EVENT = 'canplay';\r\n            }\r\n\r\n            if (sys.os === sys.OS_ANDROID) {\r\n                if (sys.browserType === sys.BROWSER_TYPE_UC) {\r\n                    __audioSupport.ONE_SOURCE = true;\r\n                }\r\n            }\r\n\r\n            if(DEBUG){\r\n                setTimeout(function(){\r\n                    cc.log('browse type: ' + sys.browserType);\r\n                    cc.log('browse version: ' + version);\r\n                    cc.log('MULTI_CHANNEL: ' + __audioSupport.MULTI_CHANNEL);\r\n                    cc.log('WEB_AUDIO: ' + __audioSupport.WEB_AUDIO);\r\n                    cc.log('AUTOPLAY: ' + __audioSupport.AUTOPLAY);\r\n                }, 0);\r\n            }\r\n        })();\r\n\r\n        try {\r\n            if (__audioSupport.WEB_AUDIO) {\r\n                __audioSupport.context = new (window.AudioContext || window.webkitAudioContext || window.mozAudioContext)();\r\n                if(__audioSupport.DELAY_CREATE_CTX) {\r\n                    setTimeout(function(){ __audioSupport.context = new (window.AudioContext || window.webkitAudioContext || window.mozAudioContext)(); }, 0);\r\n                }\r\n            }\r\n        } catch(error) {\r\n            __audioSupport.WEB_AUDIO = false;\r\n            cc.logID(5201);\r\n        }\r\n\r\n        var formatSupport = [];\r\n\r\n        (function(){\r\n            var audio = document.createElement('audio');\r\n            if(audio.canPlayType) {\r\n                var ogg = audio.canPlayType('audio/ogg; codecs=\"vorbis\"');\r\n                if (ogg) formatSupport.push('.ogg');\r\n                var mp3 = audio.canPlayType('audio/mpeg');\r\n                if (mp3) formatSupport.push('.mp3');\r\n                var wav = audio.canPlayType('audio/wav; codecs=\"1\"');\r\n                if (wav) formatSupport.push('.wav');\r\n                var mp4 = audio.canPlayType('audio/mp4');\r\n                if (mp4) formatSupport.push('.mp4');\r\n                var m4a = audio.canPlayType('audio/x-m4a');\r\n                if (m4a) formatSupport.push('.m4a');\r\n            }\r\n        })();\r\n        __audioSupport.format = formatSupport;\r\n\r\n        sys.__audioSupport = __audioSupport;\r\n    }\r\n\r\n    /**\r\n     * !#en\r\n     * Network type enumeration\r\n     * !#zh\r\n     * \r\n     *\r\n     * @enum NetworkType\r\n     */\r\n    sys.NetworkType = {\r\n        /**\r\n         * !#en\r\n         * Network is unreachable.\r\n         * !#zh\r\n         * \r\n         *\r\n         * @property {Number} NONE\r\n         */\r\n        NONE: 0,\r\n        /**\r\n         * !#en\r\n         * Network is reachable via WiFi or cable.\r\n         * !#zh\r\n         * \r\n         *\r\n         * @property {Number} LAN\r\n         */\r\n        LAN: 1,\r\n        /**\r\n         * !#en\r\n         * Network is reachable via Wireless Wide Area Network\r\n         * !#zh\r\n         * \r\n         *\r\n         * @property {Number} WWAN\r\n         */\r\n        WWAN: 2\r\n    };\r\n\r\n    /**\r\n     * @class sys\r\n     */\r\n\r\n    /**\r\n     * !#en\r\n     * Get the network type of current device, return cc.sys.NetworkType.LAN if failure.\r\n     * !#zh\r\n     * ,  cc.sys.NetworkType.LAN\r\n     *\r\n     * @method getNetworkType\r\n     * @return {NetworkType}\r\n     */\r\n    sys.getNetworkType = function() {\r\n        // TODO: need to implement this for mobile phones.\r\n        return sys.NetworkType.LAN;\r\n    };\r\n\r\n    /**\r\n     * !#en\r\n     * Get the battery level of current device, return 1.0 if failure.\r\n     * !#zh\r\n     *  1\r\n     *\r\n     * @method getBatteryLevel\r\n     * @return {Number} - 0.0 ~ 1.0\r\n     */\r\n    sys.getBatteryLevel = function() {\r\n        // TODO: need to implement this for mobile phones.\r\n        return 1.0;\r\n    };\r\n\r\n    /**\r\n     * Forces the garbage collection, only available in JSB\r\n     * @method garbageCollect\r\n     */\r\n    sys.garbageCollect = function () {\r\n        // N/A in web\r\n    };\r\n\r\n    /**\r\n     * Restart the JS VM, only available in JSB\r\n     * @method restartVM\r\n     */\r\n    sys.restartVM = function () {\r\n        // N/A in web\r\n    };\r\n\r\n    /**\r\n     * !#en\r\n     * Return the safe area rect. <br/>\r\n     * only available on the iOS native platform, otherwise it will return a rect with design resolution size.\r\n     * !#zh\r\n     *  iOS \r\n     * @method getSafeAreaRect\r\n     * @return {Rect}\r\n    */\r\n    sys.getSafeAreaRect = function () {\r\n        let visibleSize = cc.view.getVisibleSize();\r\n        return cc.rect(0, 0, visibleSize.width, visibleSize.height);\r\n    };\r\n\r\n    /**\r\n     * Check whether an object is valid,\r\n     * In web engine, it will return true if the object exist\r\n     * In native engine, it will return true if the JS object and the correspond native object are both valid\r\n     * @method isObjectValid\r\n     * @param {Object} obj\r\n     * @return {Boolean} Validity of the object\r\n     */\r\n    sys.isObjectValid = function (obj) {\r\n        if (obj) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Dump system informations\r\n     * @method dump\r\n     */\r\n    sys.dump = function () {\r\n        var self = this;\r\n        var str = \"\";\r\n        str += \"isMobile : \" + self.isMobile + \"\\r\\n\";\r\n        str += \"language : \" + self.language + \"\\r\\n\";\r\n        str += \"browserType : \" + self.browserType + \"\\r\\n\";\r\n        str += \"browserVersion : \" + self.browserVersion + \"\\r\\n\";\r\n        str += \"capabilities : \" + JSON.stringify(self.capabilities) + \"\\r\\n\";\r\n        str += \"os : \" + self.os + \"\\r\\n\";\r\n        str += \"osVersion : \" + self.osVersion + \"\\r\\n\";\r\n        str += \"platform : \" + self.platform + \"\\r\\n\";\r\n        str += \"Using \" + (cc.game.renderType === cc.game.RENDER_TYPE_WEBGL ? \"WEBGL\" : \"CANVAS\") + \" renderer.\" + \"\\r\\n\";\r\n        cc.log(str);\r\n    };\r\n\r\n    /**\r\n     * Open a url in browser\r\n     * @method openURL\r\n     * @param {String} url\r\n     */\r\n    sys.openURL = function (url) {\r\n        if (CC_JSB) {\r\n            jsb.openURL(url);\r\n        }\r\n        else {\r\n            window.open(url);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Get the number of milliseconds elapsed since 1 January 1970 00:00:00 UTC.\r\n     * @method now\r\n     * @return {Number}\r\n     */\r\n    sys.now = function () {\r\n        if (Date.now) {\r\n            return Date.now();\r\n        }\r\n        else {\r\n            return +(new Date);\r\n        }\r\n    };\r\n\r\n    return sys;\r\n}\r\n\r\nvar sys = cc && cc.sys ? cc.sys : initSys();\r\n\r\nmodule.exports = sys;\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst EventTarget = require('../event/event-target');\r\nconst js = require('../platform/js');\r\nconst renderer = require('../renderer');\r\nrequire('../platform/CCClass');\r\n\r\nvar __BrowserGetter = {\r\n    init: function(){\r\n        if (!CC_WECHATGAME && !CC_QQPLAY) {\r\n            this.html = document.getElementsByTagName(\"html\")[0];\r\n        }\r\n    },\r\n    availWidth: function(frame){\r\n        if (!frame || frame === this.html)\r\n            return window.innerWidth;\r\n        else\r\n            return frame.clientWidth;\r\n    },\r\n    availHeight: function(frame){\r\n        if (!frame || frame === this.html)\r\n            return window.innerHeight;\r\n        else\r\n            return frame.clientHeight;\r\n    },\r\n    meta: {\r\n        \"width\": \"device-width\"\r\n    },\r\n    adaptationType: cc.sys.browserType\r\n};\r\n\r\nif (cc.sys.os === cc.sys.OS_IOS) // All browsers are WebView\r\n    __BrowserGetter.adaptationType = cc.sys.BROWSER_TYPE_SAFARI;\r\n\r\nif (CC_WECHATGAME) {\r\n    if (cc.sys.browserType === cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB) {\r\n        __BrowserGetter.adaptationType = cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB;\r\n    }\r\n    else {\r\n        __BrowserGetter.adaptationType = cc.sys.BROWSER_TYPE_WECHAT_GAME;\r\n    }\r\n}\r\n\r\nif (CC_QQPLAY) {\r\n    __BrowserGetter.adaptationType = cc.sys.BROWSER_TYPE_QQ_PLAY;\r\n}\r\n\r\nswitch (__BrowserGetter.adaptationType) {\r\n    case cc.sys.BROWSER_TYPE_SAFARI:\r\n        __BrowserGetter.meta[\"minimal-ui\"] = \"true\";\r\n    case cc.sys.BROWSER_TYPE_SOUGOU:\r\n    case cc.sys.BROWSER_TYPE_UC:\r\n        __BrowserGetter.availWidth = function(frame){\r\n            return frame.clientWidth;\r\n        };\r\n        __BrowserGetter.availHeight = function(frame){\r\n            return frame.clientHeight;\r\n        };\r\n        break;\r\n    case cc.sys.BROWSER_TYPE_WECHAT_GAME:\r\n        __BrowserGetter.availWidth = function(){\r\n            return window.innerWidth;\r\n        };\r\n        __BrowserGetter.availHeight = function(){\r\n            return window.innerHeight;\r\n        };\r\n        break;\r\n    case cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB:\r\n        var sharedCanvas = window.sharedCanvas || wx.getSharedCanvas();\r\n        __BrowserGetter.availWidth = function(){\r\n            return sharedCanvas.width;\r\n        };\r\n        __BrowserGetter.availHeight = function(){\r\n            return sharedCanvas.height;\r\n        };\r\n        break;\r\n}\r\n\r\nvar _scissorRect = null;\r\n\r\n/**\r\n * cc.view is the singleton object which represents the game window.<br/>\r\n * It's main task include: <br/>\r\n *  - Apply the design resolution policy<br/>\r\n *  - Provide interaction with the window, like resize event on web, retina display support, etc...<br/>\r\n *  - Manage the game view port which can be different with the window<br/>\r\n *  - Manage the content scale and translation<br/>\r\n * <br/>\r\n * Since the cc.view is a singleton, you don't need to call any constructor or create functions,<br/>\r\n * the standard way to use it is by calling:<br/>\r\n *  - cc.view.methodName(); <br/>\r\n *\r\n * @class View\r\n */\r\nvar View = function () {\r\n    EventTarget.call(this);\r\n\r\n    var _t = this, _strategyer = cc.ContainerStrategy, _strategy = cc.ContentStrategy;\r\n\r\n    __BrowserGetter.init(this);\r\n\r\n    // Size of parent node that contains cc.game.container and cc.game.canvas\r\n    _t._frameSize = cc.size(0, 0);\r\n\r\n    // resolution size, it is the size appropriate for the app resources.\r\n    _t._designResolutionSize = cc.size(0, 0);\r\n    _t._originalDesignResolutionSize = cc.size(0, 0);\r\n    _t._scaleX = 1;\r\n    _t._scaleY = 1;\r\n    // Viewport is the container's rect related to content's coordinates in pixel\r\n    _t._viewportRect = cc.rect(0, 0, 0, 0);\r\n    // The visible rect in content's coordinate in point\r\n    _t._visibleRect = cc.rect(0, 0, 0, 0);\r\n    // Auto full screen disabled by default\r\n    _t._autoFullScreen = false;\r\n    // The device's pixel ratio (for retina displays)\r\n    _t._devicePixelRatio = 1;\r\n    // Retina disabled by default\r\n    _t._retinaEnabled = false;\r\n    // Custom callback for resize event\r\n    _t._resizeCallback = null;\r\n    _t._resizing = false;\r\n    _t._resizeWithBrowserSize = false;\r\n    _t._orientationChanging = true;\r\n    _t._isRotated = false;\r\n    _t._orientation = cc.macro.ORIENTATION_AUTO;\r\n    _t._isAdjustViewport = true;\r\n    _t._antiAliasEnabled = false;\r\n\r\n    // Setup system default resolution policies\r\n    _t._resolutionPolicy = null;\r\n    _t._rpExactFit = new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.EXACT_FIT);\r\n    _t._rpShowAll = new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.SHOW_ALL);\r\n    _t._rpNoBorder = new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.NO_BORDER);\r\n    _t._rpFixedHeight = new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.FIXED_HEIGHT);\r\n    _t._rpFixedWidth = new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.FIXED_WIDTH);\r\n\r\n    cc.game.once(cc.game.EVENT_ENGINE_INITED, this.init, this);\r\n};\r\n\r\ncc.js.extend(View, EventTarget);\r\n\r\n\r\ncc.js.mixin(View.prototype, {\r\n    init () {\r\n        this._initFrameSize();\r\n        this.enableAntiAlias(true);\r\n\r\n        var w = cc.game.canvas.width, h = cc.game.canvas.height;\r\n        this._designResolutionSize.width = w;\r\n        this._designResolutionSize.height = h;\r\n        this._originalDesignResolutionSize.width = w;\r\n        this._originalDesignResolutionSize.height = h;\r\n        this._viewportRect.width = w;\r\n        this._viewportRect.height = h;\r\n        this._visibleRect.width = w;\r\n        this._visibleRect.height = h;\r\n\r\n        cc.winSize.width = this._visibleRect.width;\r\n        cc.winSize.height = this._visibleRect.height;\r\n        cc.visibleRect && cc.visibleRect.init(this._visibleRect);\r\n    },\r\n\r\n    // Resize helper functions\r\n    _resizeEvent: function () {\r\n        var view;\r\n        if (this.setDesignResolutionSize) {\r\n            view = this;\r\n        } else {\r\n            view = cc.view;\r\n        }\r\n\r\n        // Check frame size changed or not\r\n        var prevFrameW = view._frameSize.width, prevFrameH = view._frameSize.height, prevRotated = view._isRotated;\r\n        if (cc.sys.isMobile) {\r\n            var containerStyle = cc.game.container.style,\r\n                margin = containerStyle.margin;\r\n            containerStyle.margin = '0';\r\n            containerStyle.display = 'none';\r\n            view._initFrameSize();\r\n            containerStyle.margin = margin;\r\n            containerStyle.display = 'block';\r\n        }\r\n        else {\r\n            view._initFrameSize();\r\n        }\r\n        if (view._isRotated === prevRotated && view._frameSize.width === prevFrameW && view._frameSize.height === prevFrameH)\r\n            return;\r\n\r\n        // Frame size changed, do resize works\r\n        var width = view._originalDesignResolutionSize.width;\r\n        var height = view._originalDesignResolutionSize.height;\r\n        view._resizing = true;\r\n        if (width > 0)\r\n            view.setDesignResolutionSize(width, height, view._resolutionPolicy);\r\n        view._resizing = false;\r\n\r\n        view.emit('canvas-resize');\r\n        if (view._resizeCallback) {\r\n            view._resizeCallback.call();\r\n        }\r\n    },\r\n\r\n    _orientationChange: function () {\r\n        cc.view._orientationChanging = true;\r\n        cc.view._resizeEvent();\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets view's target-densitydpi for android mobile browser. it can be set to:           <br/>\r\n     *   1. cc.macro.DENSITYDPI_DEVICE, value is \"device-dpi\"                                      <br/>\r\n     *   2. cc.macro.DENSITYDPI_HIGH, value is \"high-dpi\"  (default value)                         <br/>\r\n     *   3. cc.macro.DENSITYDPI_MEDIUM, value is \"medium-dpi\" (browser's default value)            <br/>\r\n     *   4. cc.macro.DENSITYDPI_LOW, value is \"low-dpi\"                                            <br/>\r\n     *   5. Custom value, e.g: \"480\"                                                         <br/>\r\n     * !#zh \r\n     *\r\n     * @method setTargetDensityDPI\r\n     * @param {String} densityDPI\r\n     * @deprecated since v2.0\r\n     */\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the current target-densitydpi value of cc.view.\r\n     * !#zh \r\n     * @method getTargetDensityDPI\r\n     * @returns {String}\r\n     * @deprecated since v2.0\r\n     */\r\n\r\n    /**\r\n     * !#en\r\n     * Sets whether resize canvas automatically when browser's size changed.<br/>\r\n     * Useful only on web.\r\n     * !#zh  canvas \r\n     *  Web \r\n     * @method resizeWithBrowserSize\r\n     * @param {Boolean} enabled - Whether enable automatic resize with browser's resize event\r\n     */\r\n    resizeWithBrowserSize: function (enabled) {\r\n        if (enabled) {\r\n            //enable\r\n            if (!this._resizeWithBrowserSize) {\r\n                this._resizeWithBrowserSize = true;\r\n                window.addEventListener('resize', this._resizeEvent);\r\n                window.addEventListener('orientationchange', this._orientationChange);\r\n            }\r\n        } else {\r\n            //disable\r\n            if (this._resizeWithBrowserSize) {\r\n                this._resizeWithBrowserSize = false;\r\n                window.removeEventListener('resize', this._resizeEvent);\r\n                window.removeEventListener('orientationchange', this._orientationChange);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the callback function for cc.view's resize action,<br/>\r\n     * this callback will be invoked before applying resolution policy, <br/>\r\n     * so you can do any additional modifications within the callback.<br/>\r\n     * Useful only on web.\r\n     * !#zh  cc.view \r\n     * \r\n     * \r\n     *  Web \r\n     * @method setResizeCallback\r\n     * @param {Function|Null} callback - The callback function\r\n     */\r\n    setResizeCallback: function (callback) {\r\n        if (typeof callback === 'function' || callback == null) {\r\n            this._resizeCallback = callback;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the orientation of the game, it can be landscape, portrait or auto.\r\n     * When set it to landscape or portrait, and screen w/h ratio doesn't fit, \r\n     * cc.view will automatically rotate the game canvas using CSS.\r\n     * Note that this function doesn't have any effect in native, \r\n     * in native, you need to set the application orientation in native project settings\r\n     * !#zh \r\n     * \r\n     * cc.view  CSS  canvas\r\n     *  native  native \r\n     * @method setOrientation\r\n     * @param {Number} orientation - Possible values: cc.macro.ORIENTATION_LANDSCAPE | cc.macro.ORIENTATION_PORTRAIT | cc.macro.ORIENTATION_AUTO\r\n     */\r\n    setOrientation: function (orientation) {\r\n        orientation = orientation & cc.macro.ORIENTATION_AUTO;\r\n        if (orientation && this._orientation !== orientation) {\r\n            this._orientation = orientation;\r\n            var designWidth = this._originalDesignResolutionSize.width;\r\n            var designHeight = this._originalDesignResolutionSize.height;\r\n            this.setDesignResolutionSize(designWidth, designHeight, this._resolutionPolicy);\r\n        }\r\n    },\r\n\r\n    _initFrameSize: function () {\r\n        var locFrameSize = this._frameSize;\r\n        var w = __BrowserGetter.availWidth(cc.game.frame);\r\n        var h = __BrowserGetter.availHeight(cc.game.frame);\r\n        var isLandscape = w >= h;\r\n\r\n        if (CC_EDITOR || !cc.sys.isMobile ||\r\n            (isLandscape && this._orientation & cc.macro.ORIENTATION_LANDSCAPE) || \r\n            (!isLandscape && this._orientation & cc.macro.ORIENTATION_PORTRAIT)) {\r\n            locFrameSize.width = w;\r\n            locFrameSize.height = h;\r\n            cc.game.container.style['-webkit-transform'] = 'rotate(0deg)';\r\n            cc.game.container.style.transform = 'rotate(0deg)';\r\n            this._isRotated = false;\r\n        }\r\n        else {\r\n            locFrameSize.width = h;\r\n            locFrameSize.height = w;\r\n            cc.game.container.style['-webkit-transform'] = 'rotate(90deg)';\r\n            cc.game.container.style.transform = 'rotate(90deg)';\r\n            cc.game.container.style['-webkit-transform-origin'] = '0px 0px 0px';\r\n            cc.game.container.style.transformOrigin = '0px 0px 0px';\r\n            this._isRotated = true;\r\n        }\r\n        if (this._orientationChanging) {\r\n            setTimeout(function () {\r\n                cc.view._orientationChanging = false;\r\n            }, 1000);\r\n        }\r\n    },\r\n\r\n    // hack\r\n    _adjustSizeKeepCanvasSize: function () {\r\n        var designWidth = this._originalDesignResolutionSize.width;\r\n        var designHeight = this._originalDesignResolutionSize.height;\r\n        if (designWidth > 0)\r\n            this.setDesignResolutionSize(designWidth, designHeight, this._resolutionPolicy);\r\n    },\r\n\r\n    _setViewportMeta: function (metas, overwrite) {\r\n        var vp = document.getElementById(\"cocosMetaElement\");\r\n        if(vp && overwrite){\r\n            document.head.removeChild(vp);\r\n        }\r\n\r\n        var elems = document.getElementsByName(\"viewport\"),\r\n            currentVP = elems ? elems[0] : null,\r\n            content, key, pattern;\r\n\r\n        content = currentVP ? currentVP.content : \"\";\r\n        vp = vp || document.createElement(\"meta\");\r\n        vp.id = \"cocosMetaElement\";\r\n        vp.name = \"viewport\";\r\n        vp.content = \"\";\r\n\r\n        for (key in metas) {\r\n            if (content.indexOf(key) == -1) {\r\n                content += \",\" + key + \"=\" + metas[key];\r\n            }\r\n            else if (overwrite) {\r\n                pattern = new RegExp(key+\"\\s*=\\s*[^,]+\");\r\n                content.replace(pattern, key + \"=\" + metas[key]);\r\n            }\r\n        }\r\n        if(/^,/.test(content))\r\n            content = content.substr(1);\r\n\r\n        vp.content = content;\r\n        // For adopting certain android devices which don't support second viewport\r\n        if (currentVP)\r\n            currentVP.content = content;\r\n\r\n        document.head.appendChild(vp);\r\n    },\r\n\r\n    _adjustViewportMeta: function () {\r\n        if (this._isAdjustViewport && !CC_JSB && !CC_WECHATGAME && !CC_QQPLAY) {\r\n            this._setViewportMeta(__BrowserGetter.meta, false);\r\n            this._isAdjustViewport = false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets whether the engine modify the \"viewport\" meta in your web page.<br/>\r\n     * It's enabled by default, we strongly suggest you not to disable it.<br/>\r\n     * And even when it's enabled, you can still set your own \"viewport\" meta, it won't be overridden<br/>\r\n     * Only useful on web\r\n     * !#zh  viewport meta \r\n     * \r\n     *  viewport meta\r\n     *  Web \r\n     * @method adjustViewportMeta\r\n     * @param {Boolean} enabled - Enable automatic modification to \"viewport\" meta\r\n     */\r\n    adjustViewportMeta: function (enabled) {\r\n        this._isAdjustViewport = enabled;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Retina support is enabled by default for Apple device but disabled for other devices,<br/>\r\n     * it takes effect only when you called setDesignResolutionPolicy<br/>\r\n     * Only useful on web\r\n     * !#zh  Apple  Retina \r\n     *  setDesignResolutionPolicy \r\n     *  Web \r\n     * @method enableRetina\r\n     * @param {Boolean} enabled - Enable or disable retina display\r\n     */\r\n    enableRetina: function(enabled) {\r\n        this._retinaEnabled = !!enabled;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Check whether retina display is enabled.<br/>\r\n     * Only useful on web\r\n     * !#zh  Retina \r\n     *  Web \r\n     * @method isRetinaEnabled\r\n     * @return {Boolean}\r\n     */\r\n    isRetinaEnabled: function() {\r\n        return this._retinaEnabled;\r\n    },\r\n\r\n    /**\r\n     * !#en Whether to Enable on anti-alias\r\n     * !#zh \r\n     * @method enableAntiAlias\r\n     * @param {Boolean} enabled - Enable or not anti-alias\r\n     */\r\n    enableAntiAlias: function (enabled) {\r\n        if (this._antiAliasEnabled === enabled) {\r\n            return;\r\n        }\r\n        this._antiAliasEnabled = enabled;\r\n        if(cc.game.renderType === cc.game.RENDER_TYPE_WEBGL) {\r\n            var cache = cc.loader._cache;\r\n            for (var key in cache) {\r\n                var item = cache[key];\r\n                var tex = item && item.content instanceof cc.Texture2D ? item.content : null;\r\n                if (tex) {\r\n                    var Filter = cc.Texture2D.Filter;\r\n                    if (enabled) {\r\n                        tex.setFilters(Filter.LINEAR, Filter.LINEAR);\r\n                    }\r\n                    else {\r\n                        tex.setFilters(Filter.NEAREST, Filter.NEAREST);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if(cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            var ctx = cc.game.canvas.getContext('2d');\r\n            ctx.imageSmoothingEnabled = enabled;\r\n            ctx.mozImageSmoothingEnabled = enabled;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Returns whether the current enable on anti-alias\r\n     * !#zh \r\n     * @method isAntiAliasEnabled\r\n     * @return {Boolean}\r\n     */\r\n    isAntiAliasEnabled: function () {\r\n        return this._antiAliasEnabled;\r\n    },\r\n    /**\r\n     * !#en\r\n     * If enabled, the application will try automatically to enter full screen mode on mobile devices<br/>\r\n     * You can pass true as parameter to enable it and disable it by passing false.<br/>\r\n     * Only useful on web\r\n     * !#zh \r\n     *  true  false \r\n     * @method enableAutoFullScreen\r\n     * @param {Boolean} enabled - Enable or disable auto full screen on mobile devices\r\n     */\r\n    enableAutoFullScreen: function(enabled) {\r\n        if (enabled && \r\n            enabled !== this._autoFullScreen && \r\n            cc.sys.isMobile && \r\n            cc.sys.browserType !== cc.sys.BROWSER_TYPE_WECHAT) {\r\n            // Automatically full screen when user touches on mobile version\r\n            this._autoFullScreen = true;\r\n            cc.screen.autoFullScreen(cc.game.frame);\r\n        }\r\n        else {\r\n            this._autoFullScreen = false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Check whether auto full screen is enabled.<br/>\r\n     * Only useful on web\r\n     * !#zh \r\n     *  Web \r\n     * @method isAutoFullScreenEnabled\r\n     * @return {Boolean} Auto full screen enabled or not\r\n     */\r\n    isAutoFullScreenEnabled: function() {\r\n        return this._autoFullScreen;\r\n    },\r\n\r\n    /*\r\n     * Not support on native.<br/>\r\n     * On web, it sets the size of the canvas.\r\n     * !#zh  native  Web  canvas \r\n     * @method setCanvasSize\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    setCanvasSize: function (width, height) {\r\n        var canvas = cc.game.canvas;\r\n        var container = cc.game.container;\r\n\r\n        canvas.width = width * this._devicePixelRatio;\r\n        canvas.height = height * this._devicePixelRatio;\r\n\r\n        canvas.style.width = width + 'px';\r\n        canvas.style.height = height + 'px';\r\n\r\n        container.style.width = width + 'px';\r\n        container.style.height = height + 'px';\r\n\r\n        this._resizeEvent();\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the canvas size of the view.<br/>\r\n     * On native platforms, it returns the screen size since the view is a fullscreen view.<br/>\r\n     * On web, it returns the size of the canvas element.\r\n     * !#zh  canvas \r\n     *  native \r\n     *  Web  canvas \r\n     * @method getCanvasSize\r\n     * @return {Size}\r\n     */\r\n    getCanvasSize: function () {\r\n        return cc.size(cc.game.canvas.width, cc.game.canvas.height);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the frame size of the view.<br/>\r\n     * On native platforms, it returns the screen size since the view is a fullscreen view.<br/>\r\n     * On web, it returns the size of the canvas's outer DOM element.\r\n     * !#zh \r\n     *  native \r\n     *  web  canvas  DOM \r\n     * @method getFrameSize\r\n     * @return {Size}\r\n     */\r\n    getFrameSize: function () {\r\n        return cc.size(this._frameSize.width, this._frameSize.height);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * On native, it sets the frame size of view.<br/>\r\n     * On web, it sets the size of the canvas's outer DOM element.\r\n     * !#zh  native \r\n     *  web  canvas  DOM \r\n     * @method setFrameSize\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    setFrameSize: function (width, height) {\r\n        this._frameSize.width = width;\r\n        this._frameSize.height = height;\r\n        cc.game.frame.style.width = width + \"px\";\r\n        cc.game.frame.style.height = height + \"px\";\r\n        this._resizeEvent();\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the visible area size of the view port.\r\n     * !#zh \r\n     * @method getVisibleSize\r\n     * @return {Size}\r\n     */\r\n    getVisibleSize: function () {\r\n        return cc.size(this._visibleRect.width,this._visibleRect.height);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the visible area size of the view port.\r\n     * !#zh \r\n     * @method getVisibleSizeInPixel\r\n     * @return {Size}\r\n     */\r\n    getVisibleSizeInPixel: function () {\r\n        return cc.size( this._visibleRect.width * this._scaleX,\r\n                        this._visibleRect.height * this._scaleY );\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the visible origin of the view port.\r\n     * !#zh \r\n     * @method getVisibleOrigin\r\n     * @return {Vec2}\r\n     */\r\n    getVisibleOrigin: function () {\r\n        return cc.v2(this._visibleRect.x,this._visibleRect.y);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the visible origin of the view port.\r\n     * !#zh \r\n     * @method getVisibleOriginInPixel\r\n     * @return {Vec2}\r\n     */\r\n    getVisibleOriginInPixel: function () {\r\n        return cc.v2(this._visibleRect.x * this._scaleX,\r\n                    this._visibleRect.y * this._scaleY);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the current resolution policy\r\n     * !#zh \r\n     * @see cc.ResolutionPolicy\r\n     * @method getResolutionPolicy\r\n     * @return {ResolutionPolicy}\r\n     */\r\n    getResolutionPolicy: function () {\r\n        return this._resolutionPolicy;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the current resolution policy\r\n     * !#zh \r\n     * @see cc.ResolutionPolicy\r\n     * @method setResolutionPolicy\r\n     * @param {ResolutionPolicy|Number} resolutionPolicy\r\n     */\r\n    setResolutionPolicy: function (resolutionPolicy) {\r\n        var _t = this;\r\n        if (resolutionPolicy instanceof cc.ResolutionPolicy) {\r\n            _t._resolutionPolicy = resolutionPolicy;\r\n        }\r\n        // Ensure compatibility with JSB\r\n        else {\r\n            var _locPolicy = cc.ResolutionPolicy;\r\n            if(resolutionPolicy === _locPolicy.EXACT_FIT)\r\n                _t._resolutionPolicy = _t._rpExactFit;\r\n            if(resolutionPolicy === _locPolicy.SHOW_ALL)\r\n                _t._resolutionPolicy = _t._rpShowAll;\r\n            if(resolutionPolicy === _locPolicy.NO_BORDER)\r\n                _t._resolutionPolicy = _t._rpNoBorder;\r\n            if(resolutionPolicy === _locPolicy.FIXED_HEIGHT)\r\n                _t._resolutionPolicy = _t._rpFixedHeight;\r\n            if(resolutionPolicy === _locPolicy.FIXED_WIDTH)\r\n                _t._resolutionPolicy = _t._rpFixedWidth;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the resolution policy with designed view size in points.<br/>\r\n     * The resolution policy include: <br/>\r\n     * [1] ResolutionExactFit       Fill screen by stretch-to-fit: if the design resolution ratio of width to height is different from the screen resolution ratio, your game view will be stretched.<br/>\r\n     * [2] ResolutionNoBorder       Full screen without black border: if the design resolution ratio of width to height is different from the screen resolution ratio, two areas of your game view will be cut.<br/>\r\n     * [3] ResolutionShowAll        Full screen with black border: if the design resolution ratio of width to height is different from the screen resolution ratio, two black borders will be shown.<br/>\r\n     * [4] ResolutionFixedHeight    Scale the content's height to screen's height and proportionally scale its width<br/>\r\n     * [5] ResolutionFixedWidth     Scale the content's width to screen's width and proportionally scale its height<br/>\r\n     * [cc.ResolutionPolicy]        [Web only feature] Custom resolution policy, constructed by cc.ResolutionPolicy<br/>\r\n     * !#zh \r\n     * @method setDesignResolutionSize\r\n     * @param {Number} width Design resolution width.\r\n     * @param {Number} height Design resolution height.\r\n     * @param {ResolutionPolicy|Number} resolutionPolicy The resolution policy desired\r\n     */\r\n    setDesignResolutionSize: function (width, height, resolutionPolicy) {\r\n        // Defensive code\r\n        if( !(width > 0 || height > 0) ){\r\n            cc.logID(2200);\r\n            return;\r\n        }\r\n\r\n        this.setResolutionPolicy(resolutionPolicy);\r\n        var policy = this._resolutionPolicy;\r\n        if (policy) {\r\n            policy.preApply(this);\r\n        }\r\n\r\n        // Reinit frame size\r\n        if (cc.sys.isMobile)\r\n            this._adjustViewportMeta();\r\n\r\n        // Permit to re-detect the orientation of device.\r\n        this._orientationChanging = true;\r\n        // If resizing, then frame size is already initialized, this logic should be improved\r\n        if (!this._resizing)\r\n            this._initFrameSize();\r\n\r\n        if (!policy) {\r\n            cc.logID(2201);\r\n            return;\r\n        }\r\n\r\n        this._originalDesignResolutionSize.width = this._designResolutionSize.width = width;\r\n        this._originalDesignResolutionSize.height = this._designResolutionSize.height = height;\r\n\r\n        var result = policy.apply(this, this._designResolutionSize);\r\n\r\n        if(result.scale && result.scale.length === 2){\r\n            this._scaleX = result.scale[0];\r\n            this._scaleY = result.scale[1];\r\n        }\r\n\r\n        if(result.viewport){\r\n            var vp = this._viewportRect,\r\n                vb = this._visibleRect,\r\n                rv = result.viewport;\r\n\r\n            vp.x = rv.x;\r\n            vp.y = rv.y;\r\n            vp.width = rv.width;\r\n            vp.height = rv.height;\r\n\r\n            vb.x = 0;\r\n            vb.y = 0;\r\n            vb.width = rv.width / this._scaleX;\r\n            vb.height = rv.height / this._scaleY;\r\n        }\r\n\r\n        policy.postApply(this);\r\n        cc.winSize.width = this._visibleRect.width;\r\n        cc.winSize.height = this._visibleRect.height;\r\n\r\n        cc.visibleRect && cc.visibleRect.init(this._visibleRect);\r\n\r\n        renderer.updateCameraViewport();\r\n        this.emit('design-resolution-changed');\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the designed size for the view.\r\n     * Default resolution size is the same as 'getFrameSize'.\r\n     * !#zh \r\n     *  `getFrameSize` \r\n     * @method getDesignResolutionSize\r\n     * @return {Size}\r\n     */\r\n    getDesignResolutionSize: function () {\r\n        return cc.size(this._designResolutionSize.width, this._designResolutionSize.height);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets the container to desired pixel resolution and fit the game content to it.\r\n     * This function is very useful for adaptation in mobile browsers.\r\n     * In some HD android devices, the resolution is very high, but its browser performance may not be very good.\r\n     * In this case, enabling retina display is very costy and not suggested, and if retina is disabled, the image may be blurry.\r\n     * But this API can be helpful to set a desired pixel resolution which is in between.\r\n     * This API will do the following:\r\n     *     1. Set viewport's width to the desired width in pixel\r\n     *     2. Set body width to the exact pixel resolution\r\n     *     3. The resolution policy will be reset with designed view size in points.\r\n     * !#zh container\r\n     * @method setRealPixelResolution\r\n     * @param {Number} width Design resolution width.\r\n     * @param {Number} height Design resolution height.\r\n     * @param {ResolutionPolicy|Number} resolutionPolicy The resolution policy desired\r\n     */\r\n    setRealPixelResolution: function (width, height, resolutionPolicy) {\r\n        if (!CC_JSB && !CC_WECHATGAME && !CC_QQPLAY) {\r\n            // Set viewport's width\r\n            this._setViewportMeta({\"width\": width}, true);\r\n\r\n            // Set body width to the exact pixel resolution\r\n            document.documentElement.style.width = width + \"px\";\r\n            document.body.style.width = width + \"px\";\r\n            document.body.style.left = \"0px\";\r\n            document.body.style.top = \"0px\";\r\n        }\r\n\r\n        // Reset the resolution size and policy\r\n        this.setDesignResolutionSize(width, height, resolutionPolicy);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets view port rectangle with points.\r\n     * !#zh \r\n     * @method setViewportInPoints\r\n     * @deprecated since v2.0\r\n     * @param {Number} x\r\n     * @param {Number} y\r\n     * @param {Number} w width\r\n     * @param {Number} h height\r\n     */\r\n    setViewportInPoints: function (x, y, w, h) {\r\n        var locScaleX = this._scaleX, locScaleY = this._scaleY;\r\n        cc.game._renderContext.viewport((x * locScaleX + this._viewportRect.x),\r\n            (y * locScaleY + this._viewportRect.y),\r\n            (w * locScaleX),\r\n            (h * locScaleY));\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Sets Scissor rectangle with points.\r\n     * !#zh  scissor \r\n     * @method setScissorInPoints\r\n     * @deprecated since v2.0\r\n     * @param {Number} x\r\n     * @param {Number} y\r\n     * @param {Number} w\r\n     * @param {Number} h\r\n     */\r\n    setScissorInPoints: function (x, y, w, h) {\r\n        let scaleX = this._scaleX, scaleY = this._scaleY;\r\n        let sx = Math.ceil(x * scaleX + this._viewportRect.x);\r\n        let sy = Math.ceil(y * scaleY + this._viewportRect.y);\r\n        let sw = Math.ceil(w * scaleX);\r\n        let sh = Math.ceil(h * scaleY);\r\n        let gl = cc.game._renderContext;\r\n\r\n        if (!_scissorRect) {\r\n            var boxArr = gl.getParameter(gl.SCISSOR_BOX);\r\n            _scissorRect = cc.rect(boxArr[0], boxArr[1], boxArr[2], boxArr[3]);\r\n        }\r\n\r\n        if (_scissorRect.x !== sx || _scissorRect.y !== sy || _scissorRect.width !== sw || _scissorRect.height !== sh) {\r\n            _scissorRect.x = sx;\r\n            _scissorRect.y = sy;\r\n            _scissorRect.width = sw;\r\n            _scissorRect.height = sh;\r\n            gl.scissor(sx, sy, sw, sh);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns whether GL_SCISSOR_TEST is enable\r\n     * !#zh  scissor \r\n     * @method isScissorEnabled\r\n     * @deprecated since v2.0\r\n     * @return {Boolean}\r\n     */\r\n    isScissorEnabled: function () {\r\n        return cc.game._renderContext.isEnabled(gl.SCISSOR_TEST);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the current scissor rectangle\r\n     * !#zh  scissor \r\n     * @method getScissorRect\r\n     * @deprecated since v2.0\r\n     * @return {Rect}\r\n     */\r\n    getScissorRect: function () {\r\n        if (!_scissorRect) {\r\n            var boxArr = gl.getParameter(gl.SCISSOR_BOX);\r\n            _scissorRect = cc.rect(boxArr[0], boxArr[1], boxArr[2], boxArr[3]);\r\n        }\r\n        var scaleXFactor = 1 / this._scaleX;\r\n        var scaleYFactor = 1 / this._scaleY;\r\n        return cc.rect(\r\n            (_scissorRect.x - this._viewportRect.x) * scaleXFactor,\r\n            (_scissorRect.y - this._viewportRect.y) * scaleYFactor,\r\n            _scissorRect.width * scaleXFactor,\r\n            _scissorRect.height * scaleYFactor\r\n        );\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the view port rectangle.\r\n     * !#zh \r\n     * @method getViewportRect\r\n     * @return {Rect}\r\n     */\r\n    getViewportRect: function () {\r\n        return this._viewportRect;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns scale factor of the horizontal direction (X axis).\r\n     * !#zh \r\n     * @method getScaleX\r\n     * @return {Number}\r\n     */\r\n    getScaleX: function () {\r\n        return this._scaleX;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns scale factor of the vertical direction (Y axis).\r\n     * !#zh \r\n     * @method getScaleY\r\n     * @return {Number}\r\n     */\r\n    getScaleY: function () {\r\n        return this._scaleY;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns device pixel ratio for retina display.\r\n     * !#zh \r\n     * @method getDevicePixelRatio\r\n     * @return {Number}\r\n     */\r\n    getDevicePixelRatio: function() {\r\n        return this._devicePixelRatio;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the real location in view for a translation based on a related position\r\n     * !#zh \r\n     * @method convertToLocationInView\r\n     * @param {Number} tx - The X axis translation\r\n     * @param {Number} ty - The Y axis translation\r\n     * @param {Object} relatedPos - The related position object including \"left\", \"top\", \"width\", \"height\" informations\r\n     * @return {Vec2}\r\n     */\r\n    convertToLocationInView: function (tx, ty, relatedPos, out) {\r\n        let result = out || cc.v2();\r\n        let x = this._devicePixelRatio * (tx - relatedPos.left);\r\n        let y = this._devicePixelRatio * (relatedPos.top + relatedPos.height - ty);\r\n        if (this._isRotated) {\r\n            result.x = cc.game.canvas.width - y;\r\n            result.y = x;\r\n        }\r\n        else {\r\n            result.x = x;\r\n            result.y = y;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    _convertMouseToLocationInView: function (in_out_point, relatedPos) {\r\n        var viewport = this._viewportRect, _t = this;\r\n        in_out_point.x = ((_t._devicePixelRatio * (in_out_point.x - relatedPos.left)) - viewport.x) / _t._scaleX;\r\n        in_out_point.y = (_t._devicePixelRatio * (relatedPos.top + relatedPos.height - in_out_point.y) - viewport.y) / _t._scaleY;\r\n    },\r\n\r\n    _convertPointWithScale: function (point) {\r\n        var viewport = this._viewportRect;\r\n        point.x = (point.x - viewport.x) / this._scaleX;\r\n        point.y = (point.y - viewport.y) / this._scaleY;\r\n    },\r\n\r\n    _convertTouchesWithScale: function (touches) {\r\n        var viewport = this._viewportRect, scaleX = this._scaleX, scaleY = this._scaleY,\r\n            selTouch, selPoint, selPrePoint;\r\n        for (var i = 0; i < touches.length; i++) {\r\n            selTouch = touches[i];\r\n            selPoint = selTouch._point;\r\n            selPrePoint = selTouch._prevPoint;\r\n\r\n            selPoint.x = (selPoint.x - viewport.x) / scaleX;\r\n            selPoint.y = (selPoint.y - viewport.y) / scaleY;\r\n            selPrePoint.x = (selPrePoint.x - viewport.x) / scaleX;\r\n            selPrePoint.y = (selPrePoint.y - viewport.y) / scaleY;\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * !en\r\n * Emit when design resolution changed.\r\n * !zh\r\n * \r\n * @event design-resolution-changed\r\n */\r\n /**\r\n * !en\r\n * Emit when canvas resize.\r\n * !zh\r\n * \r\n * @event canvas-resize\r\n */\r\n\r\n\r\n/**\r\n * <p>cc.game.containerStrategy class is the root strategy class of container's scale strategy,\r\n * it controls the behavior of how to scale the cc.game.container and cc.game.canvas object</p>\r\n *\r\n * @class ContainerStrategy\r\n */\r\ncc.ContainerStrategy = cc.Class({\r\n    name: \"ContainerStrategy\",\r\n    /**\r\n     * !#en\r\n     * Manipulation before appling the strategy\r\n     * !#zh \r\n     * @method preApply\r\n     * @param {View} view - The target view\r\n     */\r\n    preApply: function (view) {\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Function to apply this strategy\r\n     * !#zh \r\n     * @method apply\r\n     * @param {View} view\r\n     * @param {Size} designedResolution\r\n     */\r\n    apply: function (view, designedResolution) {\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Manipulation after applying the strategy\r\n     * !#zh \r\n     * @method postApply\r\n     * @param {View} view  The target view\r\n     */\r\n    postApply: function (view) {\r\n\r\n    },\r\n\r\n    _setupContainer: function (view, w, h) {\r\n        var locCanvas = cc.game.canvas, locContainer = cc.game.container;\r\n\r\n        if (!CC_WECHATGAME) {\r\n            if (cc.sys.os === cc.sys.OS_ANDROID) {\r\n                document.body.style.width = (view._isRotated ? h : w) + 'px';\r\n                document.body.style.height = (view._isRotated ? w : h) + 'px';\r\n            }\r\n            // Setup style\r\n            locContainer.style.width = locCanvas.style.width = w + 'px';\r\n            locContainer.style.height = locCanvas.style.height = h + 'px';\r\n        }\r\n        // Setup pixel ratio for retina display\r\n        var devicePixelRatio = view._devicePixelRatio = 1;\r\n        if (view.isRetinaEnabled())\r\n            devicePixelRatio = view._devicePixelRatio = Math.min(2, window.devicePixelRatio || 1);\r\n        // Setup canvas\r\n        locCanvas.width = w * devicePixelRatio;\r\n        locCanvas.height = h * devicePixelRatio;\r\n    },\r\n\r\n    _fixContainer: function () {\r\n        // Add container to document body\r\n        document.body.insertBefore(cc.game.container, document.body.firstChild);\r\n        // Set body's width height to window's size, and forbid overflow, so that game will be centered\r\n        var bs = document.body.style;\r\n        bs.width = window.innerWidth + \"px\";\r\n        bs.height = window.innerHeight + \"px\";\r\n        bs.overflow = \"hidden\";\r\n        // Body size solution doesn't work on all mobile browser so this is the aleternative: fixed container\r\n        var contStyle = cc.game.container.style;\r\n        contStyle.position = \"fixed\";\r\n        contStyle.left = contStyle.top = \"0px\";\r\n        // Reposition body\r\n        document.body.scrollTop = 0;\r\n    }\r\n});\r\n\r\n/**\r\n * <p>cc.ContentStrategy class is the root strategy class of content's scale strategy,\r\n * it controls the behavior of how to scale the scene and setup the viewport for the game</p>\r\n *\r\n * @class ContentStrategy\r\n */\r\ncc.ContentStrategy = cc.Class({\r\n    name: \"ContentStrategy\",\r\n\r\n    ctor: function () {\r\n        this._result = {\r\n            scale: [1, 1],\r\n            viewport: null\r\n        };\r\n    },\r\n\r\n    _buildResult: function (containerW, containerH, contentW, contentH, scaleX, scaleY) {\r\n        // Makes content fit better the canvas\r\n        Math.abs(containerW - contentW) < 2 && (contentW = containerW);\r\n        Math.abs(containerH - contentH) < 2 && (contentH = containerH);\r\n\r\n        var viewport = cc.rect((containerW - contentW) / 2, (containerH - contentH) / 2, contentW, contentH);\r\n\r\n        // Translate the content\r\n        if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS){\r\n            //TODO: modify something for setTransform\r\n            //cc.game._renderContext.translate(viewport.x, viewport.y + contentH);\r\n        }\r\n\r\n        this._result.scale = [scaleX, scaleY];\r\n        this._result.viewport = viewport;\r\n        return this._result;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Manipulation before applying the strategy\r\n     * !#zh \r\n     * @method preApply\r\n     * @param {View} view - The target view\r\n     */\r\n    preApply: function (view) {\r\n    },\r\n\r\n    /**\r\n     * !#en Function to apply this strategy\r\n     * The return value is {scale: [scaleX, scaleY], viewport: {cc.Rect}},\r\n     * The target view can then apply these value to itself, it's preferred not to modify directly its private variables\r\n     * !#zh \r\n     * @method apply\r\n     * @param {View} view\r\n     * @param {Size} designedResolution\r\n     * @return {Object} scaleAndViewportRect\r\n     */\r\n    apply: function (view, designedResolution) {\r\n        return {\"scale\": [1, 1]};\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Manipulation after applying the strategy\r\n     * !#zh \r\n     * @method postApply\r\n     * @param {View} view - The target view\r\n     */\r\n    postApply: function (view) {\r\n    }\r\n});\r\n\r\n(function () {\r\n\r\n// Container scale strategys\r\n    /**\r\n     * @class EqualToFrame\r\n     * @extends ContainerStrategy\r\n     */\r\n    var EqualToFrame = cc.Class({\r\n        name: \"EqualToFrame\",\r\n        extends: cc.ContainerStrategy,\r\n        apply: function (view) {\r\n            var frameH = view._frameSize.height, containerStyle = cc.game.container.style;\r\n            this._setupContainer(view, view._frameSize.width, view._frameSize.height);\r\n            // Setup container's margin and padding\r\n            if (view._isRotated) {\r\n                containerStyle.margin = '0 0 0 ' + frameH + 'px';\r\n            }\r\n            else {\r\n                containerStyle.margin = '0px';\r\n            }\r\n            containerStyle.padding = \"0px\";\r\n        }\r\n    });\r\n\r\n    /**\r\n     * @class ProportionalToFrame\r\n     * @extends ContainerStrategy\r\n     */\r\n    var ProportionalToFrame = cc.Class({\r\n        name: \"ProportionalToFrame\",\r\n        extends: cc.ContainerStrategy,\r\n        apply: function (view, designedResolution) {\r\n            var frameW = view._frameSize.width, frameH = view._frameSize.height, containerStyle = cc.game.container.style,\r\n                designW = designedResolution.width, designH = designedResolution.height,\r\n                scaleX = frameW / designW, scaleY = frameH / designH,\r\n                containerW, containerH;\r\n\r\n            scaleX < scaleY ? (containerW = frameW, containerH = designH * scaleX) : (containerW = designW * scaleY, containerH = frameH);\r\n\r\n            // Adjust container size with integer value\r\n            var offx = Math.round((frameW - containerW) / 2);\r\n            var offy = Math.round((frameH - containerH) / 2);\r\n            containerW = frameW - 2 * offx;\r\n            containerH = frameH - 2 * offy;\r\n\r\n            this._setupContainer(view, containerW, containerH);\r\n            if (!CC_EDITOR) {\r\n                // Setup container's margin and padding\r\n                if (view._isRotated) {\r\n                    containerStyle.margin = '0 0 0 ' + frameH + 'px';\r\n                }\r\n                else {\r\n                    containerStyle.margin = '0px';\r\n                }\r\n                containerStyle.paddingLeft = offx + \"px\";\r\n                containerStyle.paddingRight = offx + \"px\";\r\n                containerStyle.paddingTop = offy + \"px\";\r\n                containerStyle.paddingBottom = offy + \"px\";\r\n            }\r\n        }\r\n    });\r\n\r\n    /**\r\n     * @class EqualToWindow\r\n     * @extends EqualToFrame\r\n     */\r\n    var EqualToWindow = cc.Class({\r\n        name: \"EqualToWindow\",\r\n        extends: EqualToFrame,\r\n        preApply: function (view) {\r\n            this._super(view);\r\n            cc.game.frame = document.documentElement;\r\n        },\r\n\r\n        apply: function (view) {\r\n            this._super(view);\r\n            this._fixContainer();\r\n        }\r\n    });\r\n\r\n    /**\r\n     * @class ProportionalToWindow\r\n     * @extends ProportionalToFrame\r\n     */\r\n    var ProportionalToWindow = cc.Class({\r\n        name: \"ProportionalToWindow\",\r\n        extends: ProportionalToFrame,\r\n        preApply: function (view) {\r\n            this._super(view);\r\n            cc.game.frame = document.documentElement;\r\n        },\r\n\r\n        apply: function (view, designedResolution) {\r\n            this._super(view, designedResolution);\r\n            this._fixContainer();\r\n        }\r\n    });\r\n\r\n    /**\r\n     * @class OriginalContainer\r\n     * @extends ContainerStrategy\r\n     */\r\n    var OriginalContainer = cc.Class({\r\n        name: \"OriginalContainer\",\r\n        extends: cc.ContainerStrategy,\r\n        apply: function (view) {\r\n            this._setupContainer(view, cc.game.canvas.width, cc.game.canvas.height);\r\n        }\r\n    });\r\n\r\n// #NOT STABLE on Android# Alias: Strategy that makes the container's size equals to the window's size\r\n//    cc.ContainerStrategy.EQUAL_TO_WINDOW = new EqualToWindow();\r\n// #NOT STABLE on Android# Alias: Strategy that scale proportionally the container's size to window's size\r\n//    cc.ContainerStrategy.PROPORTION_TO_WINDOW = new ProportionalToWindow();\r\n// Alias: Strategy that makes the container's size equals to the frame's size\r\n    cc.ContainerStrategy.EQUAL_TO_FRAME = new EqualToFrame();\r\n// Alias: Strategy that scale proportionally the container's size to frame's size\r\n    cc.ContainerStrategy.PROPORTION_TO_FRAME = new ProportionalToFrame();\r\n// Alias: Strategy that keeps the original container's size\r\n    cc.ContainerStrategy.ORIGINAL_CONTAINER = new OriginalContainer();\r\n\r\n// Content scale strategys\r\n    var ExactFit = cc.Class({\r\n        name: \"ExactFit\",\r\n        extends: cc.ContentStrategy,\r\n        apply: function (view, designedResolution) {\r\n            var containerW = cc.game.canvas.width, containerH = cc.game.canvas.height,\r\n                scaleX = containerW / designedResolution.width, scaleY = containerH / designedResolution.height;\r\n\r\n            return this._buildResult(containerW, containerH, containerW, containerH, scaleX, scaleY);\r\n        }\r\n    });\r\n\r\n    var ShowAll = cc.Class({\r\n        name: \"ShowAll\",\r\n        extends: cc.ContentStrategy,\r\n        apply: function (view, designedResolution) {\r\n            var containerW = cc.game.canvas.width, containerH = cc.game.canvas.height,\r\n                designW = designedResolution.width, designH = designedResolution.height,\r\n                scaleX = containerW / designW, scaleY = containerH / designH, scale = 0,\r\n                contentW, contentH;\r\n\r\n            scaleX < scaleY ? (scale = scaleX, contentW = containerW, contentH = designH * scale)\r\n                : (scale = scaleY, contentW = designW * scale, contentH = containerH);\r\n\r\n            return this._buildResult(containerW, containerH, contentW, contentH, scale, scale);\r\n        }\r\n    });\r\n\r\n    var NoBorder = cc.Class({\r\n        name: \"NoBorder\",\r\n        extends: cc.ContentStrategy,\r\n        apply: function (view, designedResolution) {\r\n            var containerW = cc.game.canvas.width, containerH = cc.game.canvas.height,\r\n                designW = designedResolution.width, designH = designedResolution.height,\r\n                scaleX = containerW / designW, scaleY = containerH / designH, scale,\r\n                contentW, contentH;\r\n\r\n            scaleX < scaleY ? (scale = scaleY, contentW = designW * scale, contentH = containerH)\r\n                : (scale = scaleX, contentW = containerW, contentH = designH * scale);\r\n\r\n            return this._buildResult(containerW, containerH, contentW, contentH, scale, scale);\r\n        }\r\n    });\r\n\r\n    var FixedHeight = cc.Class({\r\n        name: \"FixedHeight\",\r\n        extends: cc.ContentStrategy,\r\n        apply: function (view, designedResolution) {\r\n            var containerW = cc.game.canvas.width, containerH = cc.game.canvas.height,\r\n                designH = designedResolution.height, scale = containerH / designH,\r\n                contentW = containerW, contentH = containerH;\r\n\r\n            return this._buildResult(containerW, containerH, contentW, contentH, scale, scale);\r\n        }\r\n    });\r\n\r\n    var FixedWidth = cc.Class({\r\n        name: \"FixedWidth\",\r\n        extends: cc.ContentStrategy,\r\n        apply: function (view, designedResolution) {\r\n            var containerW = cc.game.canvas.width, containerH = cc.game.canvas.height,\r\n                designW = designedResolution.width, scale = containerW / designW,\r\n                contentW = containerW, contentH = containerH;\r\n\r\n            return this._buildResult(containerW, containerH, contentW, contentH, scale, scale);\r\n        }\r\n    });\r\n\r\n// Alias: Strategy to scale the content's size to container's size, non proportional\r\n    cc.ContentStrategy.EXACT_FIT = new ExactFit();\r\n// Alias: Strategy to scale the content's size proportionally to maximum size and keeps the whole content area to be visible\r\n    cc.ContentStrategy.SHOW_ALL = new ShowAll();\r\n// Alias: Strategy to scale the content's size proportionally to fill the whole container area\r\n    cc.ContentStrategy.NO_BORDER = new NoBorder();\r\n// Alias: Strategy to scale the content's height to container's height and proportionally scale its width\r\n    cc.ContentStrategy.FIXED_HEIGHT = new FixedHeight();\r\n// Alias: Strategy to scale the content's width to container's width and proportionally scale its height\r\n    cc.ContentStrategy.FIXED_WIDTH = new FixedWidth();\r\n\r\n})();\r\n\r\n/**\r\n * <p>cc.ResolutionPolicy class is the root strategy class of scale strategy,\r\n * its main task is to maintain the compatibility with Cocos2d-x</p>\r\n *\r\n * @class ResolutionPolicy\r\n */\r\n/**\r\n * @method constructor\r\n * @param {ContainerStrategy} containerStg The container strategy\r\n * @param {ContentStrategy} contentStg The content strategy\r\n */\r\ncc.ResolutionPolicy = cc.Class({\r\n    name: \"cc.ResolutionPolicy\",\r\n    /**\r\n     * Constructor of cc.ResolutionPolicy\r\n     * @param {ContainerStrategy} containerStg\r\n     * @param {ContentStrategy} contentStg\r\n     */\r\n    ctor: function (containerStg, contentStg) {\r\n        this._containerStrategy = null;\r\n        this._contentStrategy = null;\r\n        this.setContainerStrategy(containerStg);\r\n        this.setContentStrategy(contentStg);\r\n    },\r\n\r\n    /**\r\n     * !#en Manipulation before applying the resolution policy\r\n     * !#zh \r\n     * @method preApply\r\n     * @param {View} view The target view\r\n     */\r\n    preApply: function (view) {\r\n        this._containerStrategy.preApply(view);\r\n        this._contentStrategy.preApply(view);\r\n    },\r\n\r\n    /**\r\n     * !#en Function to apply this resolution policy\r\n     * The return value is {scale: [scaleX, scaleY], viewport: {cc.Rect}},\r\n     * The target view can then apply these value to itself, it's preferred not to modify directly its private variables\r\n     * !#zh \r\n     * @method apply\r\n     * @param {View} view - The target view\r\n     * @param {Size} designedResolution - The user defined design resolution\r\n     * @return {Object} An object contains the scale X/Y values and the viewport rect\r\n     */\r\n    apply: function (view, designedResolution) {\r\n        this._containerStrategy.apply(view, designedResolution);\r\n        return this._contentStrategy.apply(view, designedResolution);\r\n    },\r\n\r\n    /**\r\n     * !#en Manipulation after appyling the strategy\r\n     * !#zh \r\n     * @method postApply\r\n     * @param {View} view - The target view\r\n     */\r\n    postApply: function (view) {\r\n        this._containerStrategy.postApply(view);\r\n        this._contentStrategy.postApply(view);\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Setup the container's scale strategy\r\n     * !#zh \r\n     * @method setContainerStrategy\r\n     * @param {ContainerStrategy} containerStg\r\n     */\r\n    setContainerStrategy: function (containerStg) {\r\n        if (containerStg instanceof cc.ContainerStrategy)\r\n            this._containerStrategy = containerStg;\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Setup the content's scale strategy\r\n     * !#zh \r\n     * @method setContentStrategy\r\n     * @param {ContentStrategy} contentStg\r\n     */\r\n    setContentStrategy: function (contentStg) {\r\n        if (contentStg instanceof cc.ContentStrategy)\r\n            this._contentStrategy = contentStg;\r\n    }\r\n});\r\n\r\njs.get(cc.ResolutionPolicy.prototype, \"canvasSize\", function () {\r\n    return cc.v2(cc.game.canvas.width, cc.game.canvas.height);\r\n});\r\n\r\n/**\r\n * The entire application is visible in the specified area without trying to preserve the original aspect ratio.<br/>\r\n * Distortion can occur, and the application may appear stretched or compressed.\r\n * @property {Number} EXACT_FIT\r\n * @readonly\r\n * @static\r\n */\r\ncc.ResolutionPolicy.EXACT_FIT = 0;\r\n\r\n/**\r\n * The entire application fills the specified area, without distortion but possibly with some cropping,<br/>\r\n * while maintaining the original aspect ratio of the application.\r\n * @property {Number} NO_BORDER\r\n * @readonly\r\n * @static\r\n */\r\ncc.ResolutionPolicy.NO_BORDER = 1;\r\n\r\n/**\r\n * The entire application is visible in the specified area without distortion while maintaining the original<br/>\r\n * aspect ratio of the application. Borders can appear on two sides of the application.\r\n * @property {Number} SHOW_ALL\r\n * @readonly\r\n * @static\r\n */\r\ncc.ResolutionPolicy.SHOW_ALL = 2;\r\n\r\n/**\r\n * The application takes the height of the design resolution size and modifies the width of the internal<br/>\r\n * canvas so that it fits the aspect ratio of the device<br/>\r\n * no distortion will occur however you must make sure your application works on different<br/>\r\n * aspect ratios\r\n * @property {Number} FIXED_HEIGHT\r\n * @readonly\r\n * @static\r\n */\r\ncc.ResolutionPolicy.FIXED_HEIGHT = 3;\r\n\r\n/**\r\n * The application takes the width of the design resolution size and modifies the height of the internal<br/>\r\n * canvas so that it fits the aspect ratio of the device<br/>\r\n * no distortion will occur however you must make sure your application works on different<br/>\r\n * aspect ratios\r\n * @property {Number} FIXED_WIDTH\r\n * @readonly\r\n * @static\r\n */\r\ncc.ResolutionPolicy.FIXED_WIDTH = 4;\r\n\r\n/**\r\n * Unknow policy\r\n * @property {Number} UNKNOWN\r\n * @readonly\r\n * @static\r\n */\r\ncc.ResolutionPolicy.UNKNOWN = 5;\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en cc.view is the shared view object.\r\n * !#zh cc.view \r\n * @property view\r\n * @static\r\n * @type {View}\r\n */\r\ncc.view = new View();\r\n\r\n/**\r\n * !#en cc.winSize is the alias object for the size of the current game window.\r\n * !#zh cc.winSize \r\n * @property winSize\r\n * @type Size\r\n */\r\ncc.winSize = cc.v2();\r\n\r\nmodule.exports = cc.view;\r\n","/****************************************************************************\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * cc.visibleRect is a singleton object which defines the actual visible rect of the current view,\r\n * it should represent the same rect as cc.view.getViewportRect()\r\n *\r\n * @class visibleRect\r\n */\r\ncc.visibleRect = {\r\n    topLeft:cc.v2(0,0),\r\n    topRight:cc.v2(0,0),\r\n    top:cc.v2(0,0),\r\n    bottomLeft:cc.v2(0,0),\r\n    bottomRight:cc.v2(0,0),\r\n    bottom:cc.v2(0,0),\r\n    center:cc.v2(0,0),\r\n    left:cc.v2(0,0),\r\n    right:cc.v2(0,0),\r\n    width:0,\r\n    height:0,\r\n\r\n    /**\r\n     * initialize\r\n     * @method init\r\n     * @param {Rect} visibleRect\r\n     */\r\n    init:function(visibleRect){\r\n\r\n        var w = this.width = visibleRect.width;\r\n        var h = this.height = visibleRect.height;\r\n        var l = visibleRect.x,\r\n            b = visibleRect.y,\r\n            t = b + h,\r\n            r = l + w;\r\n\r\n        //top\r\n        this.topLeft.x = l;\r\n        this.topLeft.y = t;\r\n        this.topRight.x = r;\r\n        this.topRight.y = t;\r\n        this.top.x = l + w/2;\r\n        this.top.y = t;\r\n\r\n        //bottom\r\n        this.bottomLeft.x = l;\r\n        this.bottomLeft.y = b;\r\n        this.bottomRight.x = r;\r\n        this.bottomRight.y = b;\r\n        this.bottom.x = l + w/2;\r\n        this.bottom.y = b;\r\n\r\n        //center\r\n        this.center.x = l + w/2;\r\n        this.center.y = b + h/2;\r\n\r\n        //left\r\n        this.left.x = l;\r\n        this.left.y = b + h/2;\r\n\r\n        //right\r\n        this.right.x = r;\r\n        this.right.y = b + h/2;\r\n    }\r\n};\r\n\r\n/**\r\n * Top left coordinate of the screen related to the game scene.\r\n * @property {Vec2} topLeft\r\n */\r\n\r\n/**\r\n * Top right coordinate of the screen related to the game scene.\r\n * @property {Vec2} topRight\r\n */\r\n\r\n/**\r\n * Top center coordinate of the screen related to the game scene.\r\n * @property {Vec2} top\r\n */\r\n\r\n/**\r\n * Bottom left coordinate of the screen related to the game scene.\r\n * @property {Vec2} bottomLeft\r\n */\r\n\r\n/**\r\n * Bottom right coordinate of the screen related to the game scene.\r\n * @property {Vec2} bottomRight\r\n */\r\n\r\n/**\r\n * Bottom center coordinate of the screen related to the game scene.\r\n * @property {Vec2} bottom\r\n */\r\n\r\n/**\r\n * Center coordinate of the screen related to the game scene.\r\n * @property {Vec2} center\r\n */\r\n\r\n/**\r\n * Left center coordinate of the screen related to the game scene.\r\n * @property {Vec2} left\r\n */\r\n\r\n/**\r\n * Right center coordinate of the screen related to the game scene.\r\n * @property {Vec2} right\r\n */\r\n\r\n/**\r\n * Width of the screen.\r\n * @property {Number} width\r\n */\r\n\r\n/**\r\n * Height of the screen.\r\n * @property {Number} height\r\n */\r\n\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('./js');\r\nvar isPlainEmptyObj = require('./utils').isPlainEmptyObj_DEV;\r\n\r\nconst DELIMETER = '$_$';\r\n\r\nfunction createAttrsSingle (owner, ownerCtor, superAttrs) {\r\n    var AttrsCtor;\r\n    if (CC_DEV && CC_SUPPORT_JIT) {\r\n        var ctorName = ownerCtor.name;\r\n        if (owner === ownerCtor) {\r\n            ctorName += '_ATTRS';\r\n        }\r\n        else {\r\n            ctorName += '_ATTRS_INSTANCE';\r\n        }\r\n        AttrsCtor = Function('return (function ' + ctorName + '(){});')();\r\n    }\r\n    else {\r\n        AttrsCtor = function () {};\r\n    }\r\n    if (superAttrs) {\r\n        js.extend(AttrsCtor, superAttrs.constructor);\r\n    }\r\n    var attrs = new AttrsCtor();\r\n    js.value(owner, '__attrs__', attrs);\r\n    return attrs;\r\n}\r\n\r\n// subclass should not have __attrs__\r\nfunction createAttrs (subclass) {\r\n    var superClass;\r\n    var chains = cc.Class.getInheritanceChain(subclass);\r\n    for (var i = chains.length - 1; i >= 0; i--) {\r\n        var cls = chains[i];\r\n        var attrs = cls.hasOwnProperty('__attrs__') && cls.__attrs__;\r\n        if (!attrs) {\r\n            superClass = chains[i + 1];\r\n            createAttrsSingle(cls, cls, superClass && superClass.__attrs__);\r\n        }\r\n    }\r\n    superClass = chains[0];\r\n    createAttrsSingle(subclass, subclass, superClass && superClass.__attrs__);\r\n    return subclass.__attrs__;\r\n}\r\n\r\n// /**\r\n//  * @class Class\r\n//  */\r\n\r\n//  *\r\n//  * Tag the class with any meta attributes, then return all current attributes assigned to it.\r\n//  * This function holds only the attributes, not their implementations.\r\n//  *\r\n//  * @method attr\r\n//  * @param {Function|Object} ctor - the class or instance. If instance, the attribute will be dynamic and only available for the specified instance.\r\n//  * @param {String} propName - the name of property or function, used to retrieve the attributes\r\n//  * @param {Object} [newAttrs] - the attribute table to mark, new attributes will merged with existed attributes. Attribute whose key starts with '_' will be ignored.\r\n//  * @static\r\n//  * @private\r\nfunction attr (ctor, propName, newAttrs) {\r\n    var attrs, setter, key;\r\n    if (typeof ctor === 'function') {\r\n        // attributes shared between instances\r\n        attrs = getClassAttrs(ctor);\r\n        setter = attrs.constructor.prototype;\r\n    }\r\n    else {\r\n        // attributes in instance\r\n        var instance = ctor;\r\n        attrs = instance.__attrs__;\r\n        if (!attrs) {\r\n            ctor = instance.constructor;\r\n            var clsAttrs = getClassAttrs(ctor);\r\n            attrs = createAttrsSingle(instance, ctor, clsAttrs);\r\n        }\r\n        setter = attrs;\r\n    }\r\n\r\n    if (typeof newAttrs === 'undefined') {\r\n        // get\r\n        var prefix = propName + DELIMETER;\r\n        var ret = {};\r\n        for (key in attrs) {\r\n            if (key.startsWith(prefix)) {\r\n                ret[key.slice(prefix.length)] = attrs[key];\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n    else {\r\n        // set\r\n        if (typeof newAttrs === 'object') {\r\n            for (key in newAttrs) {\r\n                if (key.charCodeAt(0) !== 95 /* _ */) {\r\n                    setter[propName + DELIMETER + key] = newAttrs[key];\r\n                }\r\n            }\r\n        }\r\n        else if (CC_DEV) {\r\n            cc.errorID(3629);\r\n        }\r\n    }\r\n}\r\n\r\n// returns a readonly meta object\r\nfunction getClassAttrs (ctor) {\r\n    return (ctor.hasOwnProperty('__attrs__') && ctor.__attrs__) || createAttrs(ctor);\r\n}\r\n\r\n// returns a writable meta object, used to set multi attributes\r\nfunction getClassAttrsProto (ctor) {\r\n    return getClassAttrs(ctor).constructor.prototype;\r\n}\r\n\r\nfunction setClassAttr (ctor, propName, key, value) {\r\n    var proto = getClassAttrsProto(ctor);\r\n    proto[propName + DELIMETER + key] = value;\r\n}\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * Specify that the input value must be integer in Inspector.\r\n * Also used to indicates that the elements in array should be type integer.\r\n * @property {string} Integer\r\n * @readonly\r\n * @example\r\n * // in cc.Class\r\n * member: {\r\n *     default: [],\r\n *     type: cc.Integer\r\n * }\r\n * // ES6 ccclass\r\n * @cc._decorator.property({\r\n *     type: cc.Integer\r\n * })\r\n * member = [];\r\n */\r\ncc.Integer = 'Integer';\r\n\r\n/**\r\n * Indicates that the elements in array should be type double.\r\n * @property {string} Float\r\n * @readonly\r\n * @example\r\n * // in cc.Class\r\n * member: {\r\n *     default: [],\r\n *     type: cc.Float\r\n * }\r\n * // ES6 ccclass\r\n * @cc._decorator.property({\r\n *     type: cc.Float\r\n * })\r\n * member = [];\r\n */\r\ncc.Float = 'Float';\r\n\r\nif (CC_EDITOR) {\r\n    js.get(cc, 'Number', function () {\r\n        cc.warnID(3603);\r\n        return cc.Float;\r\n    });\r\n}\r\n\r\n/**\r\n * Indicates that the elements in array should be type boolean.\r\n * @property {string} Boolean\r\n * @readonly\r\n * @example\r\n * // in cc.Class\r\n * member: {\r\n *     default: [],\r\n *     type: cc.Boolean\r\n * }\r\n * // ES6 ccclass\r\n * @cc._decorator.property({\r\n *     type: cc.Boolean\r\n * })\r\n * member = [];\r\n */\r\ncc.Boolean = 'Boolean';\r\n\r\n/**\r\n * Indicates that the elements in array should be type string.\r\n * @property {string} String\r\n * @readonly\r\n * @example\r\n * // in cc.Class\r\n * member: {\r\n *     default: [],\r\n *     type: cc.String\r\n * }\r\n * // ES6 ccclass\r\n * @cc._decorator.property({\r\n *     type: cc.String\r\n * })\r\n * member = [];\r\n */\r\ncc.String = 'String';\r\n\r\n/*\r\nBuiltinAttributes: {\r\n    default: defaultValue,\r\n    _canUsedInSetter: false, (default false) (NYI)\r\n}\r\nGetter or Setter: {\r\n    hasGetter: true,\r\n    hasSetter: true,\r\n}\r\nCallbacks: {\r\n    _onAfterProp: function (constructor, propName) {},\r\n    _onAfterGetter: function (constructor, propName) {}, (NYI)\r\n    _onAfterSetter: function (constructor, propName) {}, (NYI)\r\n}\r\n */\r\n\r\nfunction getTypeChecker (type, attrName) {\r\n    if (CC_DEV) {\r\n        return function (constructor, mainPropName) {\r\n            var propInfo = '\"' + js.getClassName(constructor) + '.' + mainPropName + '\"';\r\n            var mainPropAttrs = attr(constructor, mainPropName);\r\n            if (!mainPropAttrs.saveUrlAsAsset) {\r\n                var mainPropAttrsType = mainPropAttrs.type;\r\n                if (mainPropAttrsType === cc.Integer || mainPropAttrsType === cc.Float) {\r\n                    mainPropAttrsType = 'Number';\r\n                }\r\n                if (mainPropAttrsType !== type) {\r\n                    cc.warnID(3604, propInfo);\r\n                    return;\r\n                }\r\n            }\r\n            if (!mainPropAttrs.hasOwnProperty('default')) {\r\n                return;\r\n            }\r\n            var defaultVal = mainPropAttrs.default;\r\n            if (typeof defaultVal === 'undefined') {\r\n                return;\r\n            }\r\n            var isContainer = Array.isArray(defaultVal) || isPlainEmptyObj(defaultVal);\r\n            if (isContainer) {\r\n                return;\r\n            }\r\n            var defaultType = typeof defaultVal;\r\n            var type_lowerCase = type.toLowerCase();\r\n            if (defaultType === type_lowerCase) {\r\n                if (!mainPropAttrs.saveUrlAsAsset) {\r\n                    if (type_lowerCase === 'object') {\r\n                        if (defaultVal && !(defaultVal instanceof mainPropAttrs.ctor)) {\r\n                            cc.warnID(3605, propInfo, js.getClassName(mainPropAttrs.ctor));\r\n                        }\r\n                        else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    else if (type !== 'Number') {\r\n                        cc.warnID(3606, attrName, propInfo, type);\r\n                    }\r\n                }\r\n            }\r\n            else if (defaultType !== 'function') {\r\n                if (type === cc.String && defaultVal == null) {\r\n                    if (!js.isChildClassOf(mainPropAttrs.ctor, cc.RawAsset)) {\r\n                        cc.warnID(3607, propInfo);\r\n                    }\r\n                }\r\n                else if (mainPropAttrs.ctor === String && (defaultType === 'string' || defaultVal == null)) {\r\n                    mainPropAttrs.type = cc.String;\r\n                    cc.warnID(3608, propInfo);\r\n                }\r\n                else if (mainPropAttrs.ctor === Boolean && defaultType === 'boolean') {\r\n                    mainPropAttrs.type = cc.Boolean;\r\n                    cc.warnID(3609, propInfo);\r\n                }\r\n                else if (mainPropAttrs.ctor === Number && defaultType === 'number') {\r\n                    mainPropAttrs.type = cc.Float;\r\n                    cc.warnID(3610, propInfo);\r\n                }\r\n                else {\r\n                    cc.warnID(3611, attrName, propInfo, defaultType);\r\n                }\r\n            }\r\n            else {\r\n                return;\r\n            }\r\n            delete mainPropAttrs.type;\r\n        };\r\n    }\r\n}\r\n\r\nfunction ObjectType (typeCtor) {\r\n    return {\r\n        type: 'Object',\r\n        ctor: typeCtor,\r\n        _onAfterProp: CC_DEV && function (classCtor, mainPropName) {\r\n            getTypeChecker('Object', 'type')(classCtor, mainPropName);\r\n            // check ValueType\r\n            var defaultDef = getClassAttrs(classCtor)[mainPropName + DELIMETER + 'default'];\r\n            var defaultVal = require('./CCClass').getDefault(defaultDef);\r\n            if (!Array.isArray(defaultVal) && js.isChildClassOf(typeCtor, cc.ValueType)) {\r\n                var typename = js.getClassName(typeCtor);\r\n                var info = cc.js.formatStr('No need to specify the \"type\" of \"%s.%s\" because %s is a child class of ValueType.',\r\n                    js.getClassName(classCtor), mainPropName, typename);\r\n                if (defaultDef) {\r\n                    cc.log(info);\r\n                }\r\n                else {\r\n                    cc.warnID(3612, info, typename, js.getClassName(classCtor), mainPropName, typename);\r\n                }\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    attr: attr,\r\n    getClassAttrs: getClassAttrs,\r\n    getClassAttrsProto: getClassAttrsProto,\r\n    setClassAttr: setClassAttr,\r\n    DELIMETER: DELIMETER,\r\n    getTypeChecker: getTypeChecker,\r\n    ObjectType: ObjectType,\r\n    ScriptUuid: {},      // the value will be represented as a uuid string\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('./js');\r\nconst fastRemoveAt = js.array.fastRemoveAt;\r\n\r\nfunction CallbackList () {\r\n    this.callbacks = [];\r\n    this.targets = [];      // same length with callbacks, nullable\r\n    this.isInvoking = false;\r\n    this.containCanceled = false;\r\n}\r\nvar proto = CallbackList.prototype;\r\n\r\nproto.removeBy = function (array, value) {\r\n    var callbacks = this.callbacks;\r\n    var targets = this.targets;\r\n    for (var i = 0; i < array.length; ++i) {\r\n        if (array[i] === value) {\r\n            fastRemoveAt(callbacks, i);\r\n            fastRemoveAt(targets, i);\r\n            --i;\r\n        }\r\n    }\r\n};\r\n\r\nproto.cancel = function (index) {\r\n    this.callbacks[index] = this.targets[index] = null;\r\n    this.containCanceled = true;\r\n};\r\n\r\nproto.cancelAll = function () {\r\n    let callbacks = this.callbacks;\r\n    let targets = this.targets;\r\n    for (let i = 0; i < callbacks.length; i++) {\r\n        callbacks[i] = targets[i] = null;\r\n    }\r\n    this.containCanceled = true;\r\n};\r\n\r\n// filter all removed callbacks and compact array\r\nproto.purgeCanceled = function () {\r\n    this.removeBy(this.callbacks, null);\r\n    this.containCanceled = false;\r\n};\r\n\r\n\r\nconst MAX_SIZE = 16;\r\nconst callbackListPool = new js.Pool(function (list) {\r\n    list.callbacks.length = 0;\r\n    list.targets.length = 0;\r\n    list.isInvoking = false;\r\n    list.containCanceled = false;\r\n}, MAX_SIZE);\r\ncallbackListPool.get = function () {\r\n    return this._get() || new CallbackList();\r\n};\r\n\r\n/**\r\n * The CallbacksHandler is an abstract class that can register and unregister callbacks by key.\r\n * Subclasses should implement their own methods about how to invoke the callbacks.\r\n * @class _CallbacksHandler\r\n *\r\n * @private\r\n */\r\nfunction CallbacksHandler () {\r\n    this._callbackTable = js.createMap(true);\r\n}\r\nproto = CallbacksHandler.prototype;\r\n\r\n/**\r\n * @method add\r\n * @param {String} key\r\n * @param {Function} callback\r\n * @param {Object} [target] - can be null\r\n */\r\nproto.add = function (key, callback, target) {\r\n    var list = this._callbackTable[key];\r\n    if (!list) {\r\n        list = this._callbackTable[key] = callbackListPool.get();\r\n    }\r\n    list.callbacks.push(callback);\r\n    list.targets.push(target || null);\r\n};\r\n\r\n/**\r\n * Check if the specified key has any registered callback. If a callback is also specified,\r\n * it will only return true if the callback is registered.\r\n * @method hasEventListener\r\n * @param {String} key\r\n * @param {Function} [callback]\r\n * @param {Object} [target]\r\n * @return {Boolean}\r\n */\r\nproto.hasEventListener = function (key, callback, target) {\r\n    var list = this._callbackTable[key];\r\n    if (!list) {\r\n        return false;\r\n    }\r\n\r\n    // check any valid callback\r\n    var callbacks = list.callbacks;\r\n    if (!callback) {\r\n        // Make sure no cancelled callbacks\r\n        if (list.isInvoking) {\r\n            for (let i = 0; i < callbacks.length; i++) {\r\n                if (callbacks[i]) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n        else {\r\n            return callbacks.length > 0;\r\n        }\r\n    }\r\n\r\n    target = target || null;\r\n    var targets = list.targets;\r\n    for (let i = 0; i < callbacks.length; ++i) {\r\n        if (callbacks[i] === callback && targets[i] === target) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * Removes all callbacks registered in a certain event type or all callbacks registered with a certain target\r\n * @method removeAll\r\n * @param {String|Object} keyOrTarget - The event key to be removed or the target to be removed\r\n */\r\nproto.removeAll = function (keyOrTarget) {\r\n    if (typeof keyOrTarget === 'string') {\r\n        // remove by key\r\n        let list = this._callbackTable[keyOrTarget];\r\n        if (list) {\r\n            if (list.isInvoking) {\r\n                list.cancelAll();\r\n            }\r\n            else {\r\n                callbackListPool.put(list);\r\n                delete this._callbackTable[keyOrTarget];\r\n            }\r\n        }\r\n    }\r\n    else if (keyOrTarget) {\r\n        // remove by target\r\n        for (let key in this._callbackTable) {\r\n            let list = this._callbackTable[key];\r\n            if (list.isInvoking) {\r\n                let targets = list.targets;\r\n                for (let i = 0; i < targets.length; ++i) {\r\n                    if (targets[i] === keyOrTarget) {\r\n                        list.cancel(i);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                list.removeBy(list.targets, keyOrTarget);\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * @method remove\r\n * @param {String} key\r\n * @param {Function} callback\r\n * @param {Object} [target]\r\n */\r\nproto.remove = function (key, callback, target) {\r\n    var list = this._callbackTable[key];\r\n    if (list) {\r\n        target = target || null;\r\n        var callbacks = list.callbacks;\r\n        var targets = list.targets;\r\n        for (var i = 0; i < callbacks.length; ++i) {\r\n            if (callbacks[i] === callback && targets[i] === target) {\r\n                if (list.isInvoking) {\r\n                    list.cancel(i);\r\n                }\r\n                else {\r\n                    fastRemoveAt(callbacks, i);\r\n                    fastRemoveAt(targets, i);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * !#en The callbacks invoker to handle and invoke callbacks by key.\r\n * !#zh CallbacksInvoker  Key \r\n * @class CallbacksInvoker\r\n *\r\n * @extends _CallbacksHandler\r\n */\r\nvar CallbacksInvoker = function () {\r\n    CallbacksHandler.call(this);\r\n};\r\njs.extend(CallbacksInvoker, CallbacksHandler);\r\n\r\nif (CC_TEST) {\r\n    cc._Test.CallbacksInvoker = CallbacksInvoker;\r\n}\r\n\r\n/**\r\n * @method invoke\r\n * @param {String} key\r\n * @param {any} [p1]\r\n * @param {any} [p2]\r\n * @param {any} [p3]\r\n * @param {any} [p4]\r\n * @param {any} [p5]\r\n */\r\nCallbacksInvoker.prototype.invoke = function (key, p1, p2, p3, p4, p5) {\r\n    var list = this._callbackTable[key];\r\n    if (list) {\r\n        var rootInvoker = !list.isInvoking;\r\n        list.isInvoking = true;\r\n\r\n        var callbacks = list.callbacks;\r\n        var targets = list.targets;\r\n        for (var i = 0, len = callbacks.length; i < len; ++i) {\r\n            var callback = callbacks[i];\r\n            if (callback) {\r\n                var target = targets[i];\r\n                if (target) {\r\n                    callback.call(target, p1, p2, p3, p4, p5);\r\n                }\r\n                else {\r\n                    callback(p1, p2, p3, p4, p5);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (rootInvoker) {\r\n            list.isInvoking = false;\r\n            if (list.containCanceled) {\r\n                list.purgeCanceled();\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nCallbacksInvoker.CallbacksHandler = CallbacksHandler;\r\nmodule.exports = CallbacksInvoker;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nfunction deepFlatten (strList, array) {\r\n    for (var i = 0; i < array.length; i++) {\r\n        var item = array[i];\r\n        if (Array.isArray(item)) {\r\n            deepFlatten(strList, item);\r\n        }\r\n        // else if (item instanceof Declaration) {\r\n        //     strList.push(item.toString());\r\n        // }\r\n        else {\r\n            strList.push(item);\r\n        }\r\n    }\r\n}\r\n\r\nfunction flattenCodeArray (array) {\r\n    var separator = CC_DEV ? '\\n' : '';\r\n    var strList = [];\r\n    deepFlatten(strList, array);\r\n    return strList.join(separator);\r\n}\r\n\r\nmodule.exports = {\r\n    flattenCodeArray\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('./js');\r\nvar Attr = require('./attribute');\r\nvar CCClass = require('./CCClass');\r\nvar misc = require('../utils/misc');\r\n\r\n// HELPERS\r\n\r\n/**\r\n * !#en Contains information collected during deserialization\r\n * !#zh \r\n * @class Details\r\n *\r\n */\r\nvar Details = function () {\r\n    /**\r\n     * list of the depends assets' uuid\r\n     * @property {String[]} uuidList\r\n     */\r\n    this.uuidList = [];\r\n    /**\r\n     * the obj list whose field needs to load asset by uuid\r\n     * @property {Object[]} uuidObjList\r\n     */\r\n    this.uuidObjList = [];\r\n    /**\r\n     * the corresponding field name which referenced to the asset\r\n     * @property {String[]} uuidPropList\r\n     */\r\n    this.uuidPropList = [];\r\n\r\n    // TODO - DELME since 2.0\r\n    this._stillUseUrl = js.createMap(true);\r\n};\r\n/**\r\n * @method reset\r\n */\r\nDetails.prototype.reset = function () {\r\n    this.uuidList.length = 0;\r\n    this.uuidObjList.length = 0;\r\n    this.uuidPropList.length = 0;\r\n    js.clear(this._stillUseUrl);\r\n};\r\nif (CC_EDITOR || CC_TEST) {\r\n    Details.prototype.assignAssetsBy = function (getter) {\r\n        // ignore this._stillUseUrl\r\n        for (var i = 0, len = this.uuidList.length; i < len; i++) {\r\n            var uuid = this.uuidList[i];\r\n            var obj = this.uuidObjList[i];\r\n            var prop = this.uuidPropList[i];\r\n            obj[prop] = getter(uuid);\r\n        }\r\n    };\r\n}\r\n// /**\r\n//  * @method getUuidOf\r\n//  * @param {Object} obj\r\n//  * @param {String} propName\r\n//  * @return {String}\r\n//  */\r\n// Details.prototype.getUuidOf = function (obj, propName) {\r\n//     for (var i = 0; i < this.uuidObjList.length; i++) {\r\n//         if (this.uuidObjList[i] === obj && this.uuidPropList[i] === propName) {\r\n//             return this.uuidList[i];\r\n//         }\r\n//     }\r\n//     return \"\";\r\n// };\r\n/**\r\n * @method push\r\n * @param {Object} obj\r\n * @param {String} propName\r\n * @param {String} uuid\r\n */\r\nDetails.prototype.push = function (obj, propName, uuid, _stillUseUrl) {\r\n    if (_stillUseUrl) {\r\n        this._stillUseUrl[this.uuidList.length] = true;\r\n    }\r\n    this.uuidList.push(uuid);\r\n    this.uuidObjList.push(obj);\r\n    this.uuidPropList.push(propName);\r\n};\r\n\r\nDetails.pool = new js.Pool(function (obj) {\r\n    obj.reset();\r\n}, 10);\r\n\r\nDetails.pool.get = function () {\r\n    return this._get() || new Details();\r\n};\r\n\r\n// IMPLEMENT OF DESERIALIZATION\r\n\r\nvar _Deserializer = (function () {\r\n    function _Deserializer(result, target, classFinder, customEnv, ignoreEditorOnly) {\r\n        this.result = result;\r\n        this.customEnv = customEnv;\r\n        this.deserializedList = [];\r\n        this.deserializedData = null;\r\n        this._classFinder = classFinder;\r\n        if (CC_DEV) {\r\n            this._target = target;\r\n            this._ignoreEditorOnly = ignoreEditorOnly;\r\n        }\r\n        this._idList = [];\r\n        this._idObjList = [];\r\n        this._idPropList = [];\r\n    }\r\n\r\n    function _dereference (self) {\r\n        // \r\n        var deserializedList = self.deserializedList;\r\n        var idPropList = self._idPropList;\r\n        var idList = self._idList;\r\n        var idObjList = self._idObjList;\r\n        var onDereferenced = self._classFinder && self._classFinder.onDereferenced;\r\n        var i, propName, id;\r\n        if (CC_EDITOR && onDereferenced) {\r\n            for (i = 0; i < idList.length; i++) {\r\n                propName = idPropList[i];\r\n                id = idList[i];\r\n                idObjList[i][propName] = deserializedList[id];\r\n                onDereferenced(deserializedList, id, idObjList[i], propName);\r\n            }\r\n        }\r\n        else {\r\n            for (i = 0; i < idList.length; i++) {\r\n                propName = idPropList[i];\r\n                id = idList[i];\r\n                idObjList[i][propName] = deserializedList[id];\r\n            }\r\n        }\r\n    }\r\n\r\n    var prototype = _Deserializer.prototype;\r\n\r\n    prototype.deserialize = function (jsonObj) {\r\n        if (Array.isArray(jsonObj)) {\r\n            var jsonArray = jsonObj;\r\n            var refCount = jsonArray.length;\r\n            this.deserializedList.length = refCount;\r\n            // deserialize\r\n            for (var i = 0; i < refCount; i++) {\r\n                if (jsonArray[i]) {\r\n                    if (CC_EDITOR || CC_TEST) {\r\n                        var mainTarget = (i === 0 && this._target);\r\n                        this.deserializedList[i] = this._deserializeObject(jsonArray[i], false, mainTarget, this.deserializedList, '' + i);\r\n                    }\r\n                    else {\r\n                        this.deserializedList[i] = this._deserializeObject(jsonArray[i], false);\r\n                    }\r\n                }\r\n            }\r\n            this.deserializedData = refCount > 0 ? this.deserializedList[0] : [];\r\n\r\n            //// callback\r\n            //for (var j = 0; j < refCount; j++) {\r\n            //    if (referencedList[j].onAfterDeserialize) {\r\n            //        referencedList[j].onAfterDeserialize();\r\n            //    }\r\n            //}\r\n        }\r\n        else {\r\n            this.deserializedList.length = 1;\r\n            if (CC_EDITOR || CC_TEST) {\r\n                this.deserializedData = jsonObj ? this._deserializeObject(jsonObj, false, this._target, this.deserializedList, '0') : null;\r\n            }\r\n            else {\r\n                this.deserializedData = jsonObj ? this._deserializeObject(jsonObj, false) : null;\r\n            }\r\n            this.deserializedList[0] = this.deserializedData;\r\n\r\n            //// callback\r\n            //if (deserializedData.onAfterDeserialize) {\r\n            //    deserializedData.onAfterDeserialize();\r\n            //}\r\n        }\r\n\r\n        // dereference\r\n        _dereference(this);\r\n\r\n        return this.deserializedData;\r\n    };\r\n\r\n    ///**\r\n    // * @param {Object} serialized - The obj to deserialize, must be non-nil\r\n    // * @param {Boolean} _stillUseUrl\r\n    // * @param {Object} [target=null] - editor only\r\n    // * @param {Object} [owner] - debug only\r\n    // * @param {String} [propName] - debug only\r\n    // */\r\n    prototype._deserializeObject = function (serialized, _stillUseUrl, target, owner, propName) {\r\n        var prop;\r\n        var obj = null;     // the obj to return\r\n        var klass = null;\r\n        var type = serialized.__type__;\r\n        if (type) {\r\n\r\n            // Type Object (including CCClass)\r\n\r\n            klass = this._classFinder(type, serialized, owner, propName);\r\n            if (!klass) {\r\n                var notReported = this._classFinder === js._getClassById;\r\n                if (notReported) {\r\n                    cc.deserialize.reportMissingClass(type);\r\n                }\r\n                return null;\r\n            }\r\n\r\n            if ((CC_EDITOR || CC_TEST) && target) {\r\n                // use target\r\n                if ( !(target instanceof klass) ) {\r\n                    cc.warnID(5300, js.getClassName(target), klass);\r\n                }\r\n                obj = target;\r\n            }\r\n            else {\r\n                // instantiate a new object\r\n                obj = new klass();\r\n            }\r\n\r\n            if (obj._deserialize) {\r\n                obj._deserialize(serialized.content, this);\r\n                return obj;\r\n            }\r\n            if (cc.Class._isCCClass(klass)) {\r\n                _deserializeFireClass(this, obj, serialized, klass, target);\r\n            }\r\n            else {\r\n                this._deserializeTypedObject(obj, serialized, klass);\r\n            }\r\n        }\r\n        else if ( !Array.isArray(serialized) ) {\r\n\r\n            // embedded primitive javascript object\r\n\r\n            obj = ((CC_EDITOR || CC_TEST) && target) || {};\r\n            this._deserializePrimitiveObject(obj, serialized);\r\n        }\r\n        else {\r\n\r\n            // Array\r\n\r\n            if ((CC_EDITOR || CC_TEST) && target) {\r\n                target.length = serialized.length;\r\n                obj = target;\r\n            }\r\n            else {\r\n                obj = new Array(serialized.length);\r\n            }\r\n\r\n            for (var i = 0; i < serialized.length; i++) {\r\n                prop = serialized[i];\r\n                if (typeof prop === 'object' && prop) {\r\n                    if (CC_EDITOR || CC_TEST) {\r\n                        this._deserializeObjField(obj, prop, '' + i, target && obj, _stillUseUrl);\r\n                    }\r\n                    else {\r\n                        this._deserializeObjField(obj, prop, '' + i, null, _stillUseUrl);\r\n                    }\r\n                }\r\n                else {\r\n                    obj[i] = prop;\r\n                }\r\n            }\r\n        }\r\n        return obj;\r\n    };\r\n\r\n    //  _deserializeObject  id  uuid\r\n    prototype._deserializeObjField = function (obj, jsonObj, propName, target, _stillUseUrl) {\r\n        var id = jsonObj.__id__;\r\n        if (id === undefined) {\r\n            var uuid = jsonObj.__uuid__;\r\n            if (uuid) {\r\n                //if (ENABLE_TARGET) {\r\n                    // asset\r\n                    // uuidList  obj[propName] \r\n                    //\r\n                //    if (target && target[propName] && target[propName]._uuid === uuid) {\r\n                //        console.assert(obj[propName] === target[propName]);\r\n                //        return;\r\n                //    }\r\n                // }\r\n                this.result.push(obj, propName, uuid, _stillUseUrl);\r\n            }\r\n            else {\r\n                if (CC_EDITOR || CC_TEST) {\r\n                    obj[propName] = this._deserializeObject(jsonObj, _stillUseUrl, target && target[propName], obj, propName);\r\n                }\r\n                else {\r\n                    obj[propName] = this._deserializeObject(jsonObj, _stillUseUrl);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            var dObj = this.deserializedList[id];\r\n            if (dObj) {\r\n                obj[propName] = dObj;\r\n            }\r\n            else {\r\n                this._idList.push(id);\r\n                this._idObjList.push(obj);\r\n                this._idPropList.push(propName);\r\n            }\r\n        }\r\n    };\r\n\r\n    prototype._deserializePrimitiveObject = function (instance, serialized) {\r\n        var self = this;\r\n        for (var propName in serialized) {\r\n            if (serialized.hasOwnProperty(propName)) {\r\n                var prop = serialized[propName];\r\n                if (typeof prop !== 'object') {\r\n                    if (propName !== '__type__'/* && k != '__id__'*/) {\r\n                        instance[propName] = prop;\r\n                    }\r\n                }\r\n                else {\r\n                    if (prop) {\r\n                        if (CC_EDITOR || CC_TEST) {\r\n                            self._deserializeObjField(instance, prop, propName, self._target && instance);\r\n                        }\r\n                        else {\r\n                            self._deserializeObjField(instance, prop, propName);\r\n                        }\r\n                    }\r\n                    else {\r\n                        instance[propName] = null;\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n    };\r\n\r\n    // function _compileTypedObject (accessor, klass, ctorCode) {\r\n    //     if (klass === cc.Vec2) {\r\n    //         return `{` +\r\n    //                     `o${accessor}.x=prop.x||0;` +\r\n    //                     `o${accessor}.y=prop.y||0;` +\r\n    //                `}`;\r\n    //     }\r\n    //     else if (klass === cc.Color) {\r\n    //         return `{` +\r\n    //                    `o${accessor}.r=prop.r||0;` +\r\n    //                    `o${accessor}.g=prop.g||0;` +\r\n    //                    `o${accessor}.b=prop.b||0;` +\r\n    //                    `o${accessor}.a=(prop.a===undefined?255:prop.a);` +\r\n    //                `}`;\r\n    //     }\r\n    //     else if (klass === cc.Size) {\r\n    //         return `{` +\r\n    //                    `o${accessor}.width=prop.width||0;` +\r\n    //                    `o${accessor}.height=prop.height||0;` +\r\n    //                `}`;\r\n    //     }\r\n    //     else {\r\n    //         return `s._deserializeTypedObject(o${accessor},prop,${ctorCode});`;\r\n    //     }\r\n    // }\r\n\r\n    prototype._deserializeTypedObject = function (instance, serialized, klass) {\r\n        if (klass === cc.Vec2) {\r\n            instance.x = serialized.x || 0;\r\n            instance.y = serialized.y || 0;\r\n            return;\r\n        }\r\n        else if (klass === cc.Color) {\r\n            instance.r = serialized.r || 0;\r\n            instance.g = serialized.g || 0;\r\n            instance.b = serialized.b || 0;\r\n            var a = serialized.a;\r\n            instance.a = (a === undefined ? 255 : a);\r\n            return;\r\n        }\r\n        else if (klass === cc.Size) {\r\n            instance.width = serialized.width || 0;\r\n            instance.height = serialized.height || 0;\r\n            return;\r\n        }\r\n\r\n        var fastDefinedProps = klass.__props__;\r\n        if (!fastDefinedProps) {\r\n            fastDefinedProps = Object.keys(instance);    //  instance __type__ \r\n        }\r\n        for (var i = 0; i < fastDefinedProps.length; i++) {\r\n            var propName = fastDefinedProps[i];\r\n            var prop = serialized[propName];\r\n            if (prop !== undefined && serialized.hasOwnProperty(propName)) {\r\n                if (typeof prop !== 'object') {\r\n                    instance[propName] = prop;\r\n                }\r\n                else if (prop) {\r\n                    if (CC_EDITOR || CC_TEST) {\r\n                        this._deserializeObjField(instance, prop, propName, this._target && instance);\r\n                    }\r\n                    else {\r\n                        this._deserializeObjField(instance, prop, propName);\r\n                    }\r\n                }\r\n                else {\r\n                    instance[propName] = null;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    function compileObjectTypeJit (sources, defaultValue, accessorToSet, propNameLiteralToSet, assumeHavePropIfIsValue, stillUseUrl) {\r\n        if (defaultValue instanceof cc.ValueType) {\r\n            // fast case\r\n            if (!assumeHavePropIfIsValue) {\r\n                sources.push('if(prop){');\r\n            }\r\n            var ctorCode = js.getClassName(defaultValue);\r\n            sources.push(`s._deserializeTypedObject(o${accessorToSet},prop,${ctorCode});`);\r\n            if (!assumeHavePropIfIsValue) {\r\n                sources.push('}else o' + accessorToSet + '=null;');\r\n            }\r\n        }\r\n        else {\r\n            sources.push('if(prop){');\r\n                sources.push('s._deserializeObjField(o,prop,' +\r\n                                 propNameLiteralToSet +\r\n                                 ((CC_EDITOR || CC_TEST) ? ',t&&o,' : ',null,') +\r\n                                 !!stillUseUrl +\r\n                             ');');\r\n            sources.push('}else o' + accessorToSet + '=null;');\r\n        }\r\n    }\r\n\r\n    var compileDeserialize = CC_SUPPORT_JIT ? function (self, klass) {\r\n        var TYPE = Attr.DELIMETER + 'type';\r\n        var EDITOR_ONLY = Attr.DELIMETER + 'editorOnly';\r\n        var DEFAULT = Attr.DELIMETER + 'default';\r\n        var SAVE_URL_AS_ASSET = Attr.DELIMETER + 'saveUrlAsAsset';\r\n        var FORMERLY_SERIALIZED_AS = Attr.DELIMETER + 'formerlySerializedAs';\r\n        var attrs = Attr.getClassAttrs(klass);\r\n\r\n        var props = klass.__values__;\r\n        // self, obj, serializedData, klass, target\r\n        var sources = [\r\n            'var prop;'\r\n        ];\r\n        var fastMode = misc.BUILTIN_CLASSID_RE.test(js._getClassId(klass));\r\n        // sources.push('var vb,vn,vs,vo,vu,vf;');    // boolean, number, string, object, undefined, function\r\n        for (var p = 0; p < props.length; p++) {\r\n            var propName = props[p];\r\n            if ((CC_PREVIEW || (CC_EDITOR && self._ignoreEditorOnly)) && attrs[propName + EDITOR_ONLY]) {\r\n                continue;   // skip editor only if in preview\r\n            }\r\n\r\n            var accessorToSet, propNameLiteralToSet;\r\n            if (CCClass.IDENTIFIER_RE.test(propName)) {\r\n                propNameLiteralToSet = '\"' + propName + '\"';\r\n                accessorToSet = '.' + propName;\r\n            }\r\n            else {\r\n                propNameLiteralToSet = CCClass.escapeForJS(propName);\r\n                accessorToSet = '[' + propNameLiteralToSet + ']';\r\n            }\r\n\r\n            var accessorToGet = accessorToSet;\r\n            if (attrs[propName + FORMERLY_SERIALIZED_AS]) {\r\n                var propNameToRead = attrs[propName + FORMERLY_SERIALIZED_AS];\r\n                if (CCClass.IDENTIFIER_RE.test(propNameToRead)) {\r\n                    accessorToGet = '.' + propNameToRead;\r\n                }\r\n                else {\r\n                    accessorToGet = '[' + CCClass.escapeForJS(propNameToRead) + ']';\r\n                }\r\n            }\r\n\r\n            sources.push('prop=d' + accessorToGet + ';');\r\n            sources.push(`if(typeof ${CC_JSB ? '(prop)' : 'prop'}!==\"undefined\"){`);\r\n\r\n            var stillUseUrl = attrs[propName + SAVE_URL_AS_ASSET];\r\n            // function undefined object(null) string boolean number\r\n            var defaultValue = CCClass.getDefault(attrs[propName + DEFAULT]);\r\n            if (fastMode) {\r\n                var isPrimitiveType;\r\n                var userType = attrs[propName + TYPE];\r\n                if (defaultValue === undefined && userType) {\r\n                    isPrimitiveType = userType === cc.String ||\r\n                                      userType === cc.Integer ||\r\n                                      userType === cc.Float ||\r\n                                      userType === cc.Boolean;\r\n                }\r\n                else {\r\n                    var defaultType = typeof defaultValue;\r\n                    isPrimitiveType = (defaultType === 'string' && !stillUseUrl) ||\r\n                                      defaultType === 'number' ||\r\n                                      defaultType === 'boolean';\r\n                }\r\n\r\n                if (isPrimitiveType) {\r\n                    sources.push(`o${accessorToSet}=prop;`);\r\n                }\r\n                else {\r\n                    compileObjectTypeJit(sources, defaultValue, accessorToSet, propNameLiteralToSet, true, stillUseUrl);\r\n                }\r\n            }\r\n            else {\r\n                sources.push(`if(typeof ${CC_JSB ? '(prop)' : 'prop'}!==\"object\"){` +\r\n                                 'o' + accessorToSet + '=prop;' +\r\n                             '}else{');\r\n                compileObjectTypeJit(sources, defaultValue, accessorToSet, propNameLiteralToSet, false, stillUseUrl);\r\n                sources.push('}');\r\n            }\r\n            sources.push('}');\r\n        }\r\n        if (cc.js.isChildClassOf(klass, cc._BaseNode) || cc.js.isChildClassOf(klass, cc.Component)) {\r\n            if (CC_PREVIEW || (CC_EDITOR && self._ignoreEditorOnly)) {\r\n                var mayUsedInPersistRoot = js.isChildClassOf(klass, cc.Node);\r\n                if (mayUsedInPersistRoot) {\r\n                    sources.push('d._id&&(o._id=d._id);');\r\n                }\r\n            }\r\n            else {\r\n                sources.push('d._id&&(o._id=d._id);');\r\n            }\r\n        }\r\n        if (props[props.length - 1] === '_$erialized') {\r\n            // deep copy original serialized data\r\n            sources.push('o._$erialized=JSON.parse(JSON.stringify(d));');\r\n            // parse the serialized data as primitive javascript object, so its __id__ will be dereferenced\r\n            sources.push('s._deserializePrimitiveObject(o._$erialized,d);');\r\n        }\r\n        return Function('s', 'o', 'd', 'k', 't', sources.join(''));\r\n    } : function (self, klass) {\r\n        var fastMode = misc.BUILTIN_CLASSID_RE.test(js._getClassId(klass));\r\n        var shouldCopyId = cc.js.isChildClassOf(klass, cc._BaseNode) || cc.js.isChildClassOf(klass, cc.Component);\r\n        var shouldCopyRawData;\r\n\r\n        var simpleProps = [];\r\n        var simplePropsToRead = simpleProps;\r\n        var advancedProps = [];\r\n        var advancedPropsToRead = advancedProps;\r\n        var advancedPropsUseUrl = [];\r\n        var advancedPropsValueType = [];\r\n\r\n        (function () {\r\n            var props = klass.__values__;\r\n            shouldCopyRawData = props[props.length - 1] === '_$erialized';\r\n\r\n            var attrs = Attr.getClassAttrs(klass);\r\n            var TYPE = Attr.DELIMETER + 'type';\r\n            var DEFAULT = Attr.DELIMETER + 'default';\r\n            var SAVE_URL_AS_ASSET = Attr.DELIMETER + 'saveUrlAsAsset';\r\n            var FORMERLY_SERIALIZED_AS = Attr.DELIMETER + 'formerlySerializedAs';\r\n\r\n            for (var p = 0; p < props.length; p++) {\r\n                var propName = props[p];\r\n                var propNameToRead = propName;\r\n                if (attrs[propName + FORMERLY_SERIALIZED_AS]) {\r\n                    propNameToRead = attrs[propName + FORMERLY_SERIALIZED_AS];\r\n                }\r\n                var stillUseUrl = attrs[propName + SAVE_URL_AS_ASSET];\r\n                // function undefined object(null) string boolean number\r\n                var defaultValue = CCClass.getDefault(attrs[propName + DEFAULT]);\r\n                var isPrimitiveType = false;\r\n                if (fastMode) {\r\n                    var userType = attrs[propName + TYPE];\r\n                    if (defaultValue === undefined && userType) {\r\n                        isPrimitiveType = userType === cc.String ||\r\n                                          userType === cc.Integer ||\r\n                                          userType === cc.Float ||\r\n                                          userType === cc.Boolean;\r\n                    }\r\n                    else {\r\n                        var defaultType = typeof defaultValue;\r\n                        isPrimitiveType = (defaultType === 'string' && !stillUseUrl) ||\r\n                                          defaultType === 'number' ||\r\n                                          defaultType === 'boolean';\r\n                    }\r\n                }\r\n                if (fastMode && isPrimitiveType) {\r\n                    if (propNameToRead !== propName && simplePropsToRead === simpleProps) {\r\n                        simplePropsToRead = simpleProps.slice();\r\n                    }\r\n                    simpleProps.push(propName);\r\n                    if (simplePropsToRead !== simpleProps) {\r\n                        simplePropsToRead.push(propNameToRead);\r\n                    }\r\n                }\r\n                else {\r\n                    if (propNameToRead !== propName && advancedPropsToRead === advancedProps) {\r\n                        advancedPropsToRead = advancedProps.slice();\r\n                    }\r\n                    advancedProps.push(propName);\r\n                    if (advancedPropsToRead !== advancedProps) {\r\n                        advancedPropsToRead.push(propNameToRead);\r\n                    }\r\n                    advancedPropsUseUrl.push(stillUseUrl);\r\n                    advancedPropsValueType.push((defaultValue instanceof cc.ValueType) && defaultValue.constructor);\r\n                }\r\n            }\r\n        })();\r\n\r\n        return function (s, o, d, k, t) {\r\n            for (let i = 0; i < simpleProps.length; ++i) {\r\n                let prop = d[simplePropsToRead[i]];\r\n                if (prop !== undefined) {\r\n                    o[simpleProps[i]] = prop;\r\n                }\r\n            }\r\n            for (let i = 0; i < advancedProps.length; ++i) {\r\n                let propName = advancedProps[i];\r\n                var prop = d[advancedPropsToRead[i]];\r\n                if (prop === undefined) {\r\n                    continue;\r\n                }\r\n                if (!fastMode && typeof prop !== 'object') {\r\n                    o[propName] = prop;\r\n                }\r\n                else {\r\n                    // fastMode (so will not simpleProp) or object\r\n                    var valueTypeCtor = advancedPropsValueType[i];\r\n                    if (valueTypeCtor) {\r\n                        if (fastMode || prop) {\r\n                            s._deserializeTypedObject(o[propName], prop, valueTypeCtor);\r\n                        }\r\n                        else {\r\n                            o[propName] = null;\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (prop) {\r\n                            s._deserializeObjField(\r\n                                o,\r\n                                prop,\r\n                                propName,\r\n                                (CC_EDITOR || CC_TEST) ? (t && o) : null,\r\n                                advancedPropsUseUrl[i],\r\n                            );\r\n                        }\r\n                        else {\r\n                            o[propName] = null;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (shouldCopyId && d._id) {\r\n                o._id = d._id;\r\n            }\r\n            if (shouldCopyRawData) {\r\n                // deep copy original serialized data\r\n                o._$erialized = JSON.parse(JSON.stringify(d));\r\n                // parse the serialized data as primitive javascript object, so its __id__ will be dereferenced\r\n                s._deserializePrimitiveObject(o._$erialized, d);\r\n            }\r\n        }\r\n    };\r\n\r\n    function unlinkUnusedPrefab (self, serialized, obj) {\r\n        var uuid = serialized['asset'] && serialized['asset'].__uuid__;\r\n        if (uuid) {\r\n            var last = self.result.uuidList.length - 1;\r\n            if (self.result.uuidList[last] === uuid &&\r\n                self.result.uuidObjList[last] === obj &&\r\n                self.result.uuidPropList[last] === 'asset') {\r\n                self.result.uuidList.pop();\r\n                self.result.uuidObjList.pop();\r\n                self.result.uuidPropList.pop();\r\n            }\r\n            else {\r\n                var debugEnvOnlyInfo = 'Failed to skip prefab asset while deserializing PrefabInfo';\r\n                cc.warn(debugEnvOnlyInfo);\r\n            }\r\n        }\r\n    }\r\n\r\n    function _deserializeFireClass (self, obj, serialized, klass, target) {\r\n        var deserialize;\r\n        if (klass.hasOwnProperty('__deserialize__')) {\r\n            deserialize = klass.__deserialize__;\r\n        }\r\n        else {\r\n            deserialize = compileDeserialize(self, klass);\r\n            // if (CC_TEST && !isPhantomJS) {\r\n            //     cc.log(deserialize);\r\n            // }\r\n            js.value(klass, '__deserialize__', deserialize, true);\r\n        }\r\n        deserialize(self, obj, serialized, klass, target);\r\n        // if preview or build worker\r\n        if (CC_PREVIEW || (CC_EDITOR && self._ignoreEditorOnly)) {\r\n            if (klass === cc._PrefabInfo && !obj.sync) {\r\n                unlinkUnusedPrefab(self, serialized, obj);\r\n            }\r\n        }\r\n    }\r\n\r\n    _Deserializer.pool = new js.Pool(function (obj) {\r\n        obj.result = null;\r\n        obj.customEnv = null;\r\n        obj.deserializedList.length = 0;\r\n        obj.deserializedData = null;\r\n        obj._classFinder = null;\r\n        if (CC_DEV) {\r\n            obj._target = null;\r\n        }\r\n        obj._idList.length = 0;\r\n        obj._idObjList.length = 0;\r\n        obj._idPropList.length = 0;\r\n    }, 1);\r\n\r\n    _Deserializer.pool.get = function (result, target, classFinder, customEnv, ignoreEditorOnly) {\r\n        var cache = this._get();\r\n        if (cache) {\r\n            cache.result = result;\r\n            cache.customEnv = customEnv;\r\n            cache._classFinder = classFinder;\r\n            if (CC_DEV) {\r\n                cache._target = target;\r\n                cache._ignoreEditorOnly = ignoreEditorOnly;\r\n            }\r\n            return cache;\r\n        }\r\n        else {\r\n            return new _Deserializer(result, target, classFinder, customEnv, ignoreEditorOnly);\r\n        }\r\n    };\r\n\r\n    return _Deserializer;\r\n})();\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en Deserialize json to cc.Asset\r\n * !#zh  JSON \r\n *\r\n *  target  target  asset  uuid  target  asset \r\n *  uuid  result \r\n *\r\n * @method deserialize\r\n * @param {String|Object} data - the serialized cc.Asset json string or json object.\r\n * @param {Details} [details] - additional loading result\r\n * @param {Object} [options]\r\n * @return {object} the main data(asset)\r\n */\r\ncc.deserialize = function (data, details, options) {\r\n    options = options || {};\r\n    var classFinder = options.classFinder || js._getClassById;\r\n    //  createAssetRefs  url  { uuid: 'xxx' }\r\n    var createAssetRefs = options.createAssetRefs || cc.sys.platform === cc.sys.EDITOR_CORE;\r\n    var target = (CC_EDITOR || CC_TEST) && options.target;\r\n    var customEnv = options.customEnv;\r\n    var ignoreEditorOnly = options.ignoreEditorOnly;\r\n\r\n    if (CC_EDITOR && Buffer.isBuffer(data)) {\r\n        data = data.toString();\r\n    }\r\n\r\n    if (typeof data === 'string') {\r\n        data = JSON.parse(data);\r\n    }\r\n\r\n    //var oldJson = JSON.stringify(data, null, 2);\r\n\r\n    var tempDetails = !details;\r\n    details = details || Details.pool.get();\r\n    var deserializer = _Deserializer.pool.get(details, target, classFinder, customEnv, ignoreEditorOnly);\r\n\r\n    cc.game._isCloning = true;\r\n    var res = deserializer.deserialize(data);\r\n    cc.game._isCloning = false;\r\n\r\n    _Deserializer.pool.put(deserializer);\r\n    if (createAssetRefs) {\r\n        details.assignAssetsBy(Editor.serialize.asAsset);\r\n    }\r\n    if (tempDetails) {\r\n        Details.pool.put(details);\r\n    }\r\n\r\n    //var afterJson = JSON.stringify(data, null, 2);\r\n    //if (oldJson !== afterJson) {\r\n    //    throw new Error('JSON SHOULD not changed');\r\n    //}\r\n\r\n    return res;\r\n};\r\n\r\ncc.deserialize.Details = Details;\r\ncc.deserialize.reportMissingClass = function (id) {\r\n    if (CC_EDITOR && Editor.Utils.UuidUtils.isUuid(id)) {\r\n        id = Editor.Utils.UuidUtils.decompressUuid(id);\r\n        cc.warnID(5301, id);\r\n    }\r\n    else {\r\n        cc.warnID(5302, id);\r\n    }\r\n};","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n// ID generater for runtime\r\n\r\nvar NonUuidMark = '.';\r\n\r\n/*\r\n * @param {string} [category] - You can specify a unique category to avoid id collision with other instance of IdGenerater\r\n */\r\nfunction IdGenerater (category) {\r\n    // init with a random id to emphasize that the returns id should not be stored in persistence data\r\n    this.id = 0 | (Math.random() * 998);\r\n    \r\n    this.prefix = category ? (category + NonUuidMark) : '';\r\n}\r\n\r\n/*\r\n * @method getNewId\r\n * @return {string}\r\n */\r\nIdGenerater.prototype.getNewId = function () {\r\n    return this.prefix + (++this.id);\r\n};\r\n\r\n/*\r\n * The global id generater might have a conflict problem once every 365 days,\r\n * if the game runs at 60 FPS and each frame 4760273 counts of new id are requested.\r\n */\r\nIdGenerater.global = new IdGenerater('global');\r\n\r\nmodule.exports = IdGenerater;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./js');\r\nrequire('./CCClass');\r\nrequire('./CCClassDecorator');\r\nrequire('./CCEnum');\r\nrequire('./CCObject');\r\nrequire('./callbacks-invoker');\r\nrequire('./url');\r\nrequire('./deserialize');\r\nrequire('./instantiate');\r\nrequire('./instantiate-jit');\r\nrequire('./requiring-frame');\r\nrequire('./CCSys');\r\nrequire('./CCMacro');\r\n\r\nif (!(CC_EDITOR && Editor.isMainProcess)) {\r\n    require('./CCAssetLibrary');\r\n    require('./CCVisibleRect');\r\n}","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n// Some helper methods for compile instantiation code\r\n\r\nvar CCObject = require('./CCObject');\r\nvar Destroyed = CCObject.Flags.Destroyed;\r\nvar PersistentMask = CCObject.Flags.PersistentMask;\r\nvar Attr = require('./attribute');\r\nvar js = require('./js');\r\nvar CCClass = require('./CCClass');\r\nvar Compiler = require('./compiler');\r\n\r\nvar DEFAULT = Attr.DELIMETER + 'default';\r\nvar IDENTIFIER_RE = CCClass.IDENTIFIER_RE;\r\nvar escapeForJS = CCClass.escapeForJS;\r\n\r\nconst VAR = 'var ';\r\nconst LOCAL_OBJ = 'o';\r\nconst LOCAL_TEMP_OBJ = 't';\r\nconst LOCAL_ARRAY = 'a';\r\nconst LINE_INDEX_OF_NEW_OBJ = 0;\r\n\r\nconst DEFAULT_MODULE_CACHE = {\r\n    'cc.Node': 'cc.Node',\r\n    'cc.Sprite': 'cc.Sprite',\r\n    'cc.Label': 'cc.Label',\r\n    'cc.Button': 'cc.Button',\r\n    'cc.Widget': 'cc.Widget',\r\n    'cc.Animation': 'cc.Animation',\r\n    'cc.ClickEvent': false,\r\n    'cc.PrefabInfo': false\r\n};\r\n\r\n// HELPER CLASSES\r\n\r\n// ('foo', 'bar')\r\n// -> 'var foo = bar;'\r\nfunction Declaration (varName, expression) {\r\n    this.varName = varName;\r\n    this.expression = expression;\r\n}\r\nDeclaration.prototype.toString = function () {\r\n    return VAR + this.varName + '=' + this.expression + ';';\r\n};\r\n\r\n// ('a =', 'var b = x')\r\n// -> 'var b = a = x';\r\n// ('a =', 'x')\r\n// -> 'a = x';\r\nfunction mergeDeclaration (statement, expression) {\r\n    if (expression instanceof Declaration) {\r\n        return new Declaration(expression.varName, statement + expression.expression);\r\n    }\r\n    else {\r\n        return statement + expression;\r\n    }\r\n}\r\n\r\n// ('a', ['var b = x', 'b.foo = bar'])\r\n// -> 'var b = a = x;'\r\n// -> 'b.foo = bar;'\r\n// ('a', 'var b = x')\r\n// -> 'var b = a = x;'\r\n// ('a', 'x')\r\n// -> 'a = x;'\r\nfunction writeAssignment (codeArray, statement, expression) {\r\n    if (Array.isArray(expression)) {\r\n        expression[0] = mergeDeclaration(statement, expression[0]);\r\n        codeArray.push(expression);\r\n    }\r\n    else {\r\n        codeArray.push(mergeDeclaration(statement, expression) + ';');\r\n    }\r\n}\r\n\r\n// ('foo', 'bar')\r\n// -> 'targetExpression.foo = bar'\r\n// ('foo1', 'bar1')\r\n// ('foo2', 'bar2')\r\n// -> 't = targetExpression;'\r\n// -> 't.foo1 = bar1;'\r\n// -> 't.foo2 = bar2;'\r\nfunction Assignments (targetExpression) {\r\n    this._exps = [];\r\n    this._targetExp = targetExpression;\r\n}\r\nAssignments.prototype.append = function (key, expression) {\r\n    this._exps.push([key, expression]);\r\n};\r\nAssignments.prototype.writeCode = function (codeArray) {\r\n    var targetVar;\r\n    if (this._exps.length > 1) {\r\n        codeArray.push(LOCAL_TEMP_OBJ + '=' + this._targetExp + ';');\r\n        targetVar = LOCAL_TEMP_OBJ;\r\n    }\r\n    else if (this._exps.length === 1) {\r\n        targetVar = this._targetExp;\r\n    }\r\n    else {\r\n        return;\r\n    }\r\n    for (var i = 0; i < this._exps.length; i++) {\r\n        var pair = this._exps[i];\r\n        writeAssignment(codeArray, targetVar + getPropAccessor(pair[0]) + '=', pair[1]);\r\n    }\r\n};\r\n\r\nAssignments.pool = new js.Pool(function (obj) {\r\n                                obj._exps.length = 0;\r\n                                obj._targetExp = null;\r\n                            }, 1);\r\nAssignments.pool.get = function (targetExpression) {\r\n    var cache = this._get() || new Assignments();\r\n    cache._targetExp = targetExpression;\r\n    return cache;\r\n};\r\n\r\n// HELPER FUNCTIONS\r\n\r\nfunction equalsToDefault (def, value) {\r\n    if (typeof def === 'function') {\r\n        try {\r\n            def = def();\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n    if (def === value) {\r\n        return true;\r\n    }\r\n    if (def && value) {\r\n        if (def instanceof cc.ValueType && def.equals(value)) {\r\n            return true;\r\n        }\r\n        if ((Array.isArray(def) && Array.isArray(value)) ||\r\n            (def.constructor === Object && value.constructor === Object)\r\n        ) {\r\n            try {\r\n                return Array.isArray(def) && Array.isArray(value) && def.length === 0 && value.length === 0;\r\n            }\r\n            catch (e) {\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction getPropAccessor (key) {\r\n    return IDENTIFIER_RE.test(key) ? ('.' + key) : ('[' + escapeForJS(key) + ']');\r\n}\r\n\r\n//\r\n\r\n/*\r\n * Variables:\r\n * {Object[]} O - objs list\r\n * {Function[]} F - constructor list\r\n * {Node} [R] - specify an instantiated prefabRoot that all references to prefabRoot in prefab will redirect to\r\n * {Object} o - current creating object\r\n */\r\n\r\n/*\r\n * @param {Object} obj - the object to parse\r\n * @param {Node} [parent]\r\n */\r\nfunction Parser (obj, parent) {\r\n    this.parent = parent;\r\n\r\n    this.objsToClear_iN$t = [];   // used to reset _iN$t variable\r\n    this.codeArray = [];\r\n\r\n    // datas for generated code\r\n    this.objs = [];\r\n    this.funcs = [];\r\n\r\n    this.funcModuleCache = js.createMap();\r\n    js.mixin(this.funcModuleCache, DEFAULT_MODULE_CACHE);\r\n\r\n    // {String[]} - variable names for circular references,\r\n    //              not really global, just local variables shared between sub functions\r\n    this.globalVariables = [];\r\n    // incremental id for new global variables\r\n    this.globalVariableId = 0;\r\n    // incremental id for new local variables\r\n    this.localVariableId = 0;\r\n\r\n    // generate codeArray\r\n    //if (Array.isArray(obj)) {\r\n    //    this.codeArray.push(this.instantiateArray(obj));\r\n    //}\r\n    //else {\r\n        this.codeArray.push(VAR + LOCAL_OBJ + ',' + LOCAL_TEMP_OBJ + ';',\r\n                           'if(R){',\r\n                                LOCAL_OBJ + '=R;',\r\n                           '}else{',\r\n                                LOCAL_OBJ + '=R=new ' + this.getFuncModule(obj.constructor, true) + '();',\r\n                           '}');\r\n        obj._iN$t = { globalVar: 'R' };\r\n        this.objsToClear_iN$t.push(obj);\r\n        this.enumerateObject(this.codeArray, obj);\r\n    //}\r\n\r\n    // generate code\r\n    var globalVariablesDeclaration;\r\n    if (this.globalVariables.length > 0) {\r\n        globalVariablesDeclaration = VAR + this.globalVariables.join(',') + ';';\r\n    }\r\n    var code = Compiler.flattenCodeArray(['return (function(R){',\r\n                                    globalVariablesDeclaration || [],\r\n                                    this.codeArray,\r\n                                    'return o;',\r\n                                 '})']);\r\n\r\n    // generate method and bind with objs\r\n    this.result = Function('O', 'F', code)(this.objs, this.funcs);\r\n\r\n    // if (CC_TEST && !isPhantomJS) {\r\n    //     console.log(code);\r\n    // }\r\n\r\n    // cleanup\r\n    for (var i = 0, len = this.objsToClear_iN$t.length; i < len; ++i) {\r\n        this.objsToClear_iN$t[i]._iN$t = null;\r\n    }\r\n    this.objsToClear_iN$t.length = 0;\r\n}\r\n\r\nvar proto = Parser.prototype;\r\n\r\nproto.getFuncModule = function (func, usedInNew) {\r\n    var clsName = js.getClassName(func);\r\n    if (clsName) {\r\n        var cache = this.funcModuleCache[clsName];\r\n        if (cache) {\r\n            return cache;\r\n        }\r\n        else if (cache === undefined) {\r\n            var clsNameIsModule = clsName.indexOf('.') !== -1;\r\n            if (clsNameIsModule) {\r\n                try {\r\n                    // ensure is module\r\n                    clsNameIsModule = (func === Function('return ' + clsName)());\r\n                    if (clsNameIsModule) {\r\n                        this.funcModuleCache[clsName] = clsName;\r\n                        return clsName;\r\n                    }\r\n                }\r\n                catch (e) {}\r\n            }\r\n        }\r\n    }\r\n    var index = this.funcs.indexOf(func);\r\n    if (index < 0) {\r\n        index = this.funcs.length;\r\n        this.funcs.push(func);\r\n    }\r\n    var res = 'F[' + index + ']';\r\n    if (usedInNew) {\r\n        res = '(' + res + ')';\r\n    }\r\n    this.funcModuleCache[clsName] = res;\r\n    return res;\r\n};\r\n\r\nproto.getObjRef = function (obj) {\r\n    var index = this.objs.indexOf(obj);\r\n    if (index < 0) {\r\n        index = this.objs.length;\r\n        this.objs.push(obj);\r\n    }\r\n    return 'O[' + index + ']';\r\n};\r\n\r\nproto.setValueType = function (codeArray, defaultValue, srcValue, targetExpression) {\r\n    var assignments = Assignments.pool.get(targetExpression);\r\n    var fastDefinedProps = defaultValue.constructor.__props__;\r\n    if (!fastDefinedProps) {\r\n        fastDefinedProps = Object.keys(defaultValue);\r\n    }\r\n    for (var i = 0; i < fastDefinedProps.length; i++) {\r\n        var propName = fastDefinedProps[i];\r\n        var prop = srcValue[propName];\r\n        if (defaultValue[propName] === prop) {\r\n            continue;\r\n        }\r\n        var expression = this.enumerateField(srcValue, propName, prop);\r\n        assignments.append(propName, expression);\r\n    }\r\n    assignments.writeCode(codeArray);\r\n    Assignments.pool.put(assignments);\r\n};\r\n\r\nproto.enumerateCCClass = function (codeArray, obj, klass) {\r\n    var props = klass.__values__;\r\n    var attrs = Attr.getClassAttrs(klass);\r\n    for (var p = 0; p < props.length; p++) {\r\n        var key = props[p];\r\n        var val = obj[key];\r\n        var defaultValue = attrs[key + DEFAULT];\r\n        if (equalsToDefault(defaultValue, val)) {\r\n            continue;\r\n        }\r\n        if (typeof val === 'object' && val instanceof cc.ValueType) {\r\n            defaultValue = CCClass.getDefault(defaultValue);\r\n            if (defaultValue && defaultValue.constructor === val.constructor) {\r\n                // fast case\r\n                var targetExpression = LOCAL_OBJ + getPropAccessor(key);\r\n                this.setValueType(codeArray, defaultValue, val, targetExpression);\r\n                continue;\r\n            }\r\n        }\r\n        this.setObjProp(codeArray, obj, key, val);\r\n    }\r\n};\r\n\r\nproto.instantiateArray = function (value) {\r\n    if (value.length === 0) {\r\n        return '[]';\r\n    }\r\n\r\n    var arrayVar = LOCAL_ARRAY + (++this.localVariableId);\r\n    var declaration = new Declaration(arrayVar, 'new Array(' + value.length + ')');\r\n    var codeArray = [declaration];\r\n\r\n    // assign a _iN$t flag to indicate that this object has been parsed.\r\n    value._iN$t = {\r\n        globalVar: '',      // the name of declared global variable used to access this object\r\n        source: codeArray,  // the source code array for this object\r\n    };\r\n    this.objsToClear_iN$t.push(value);\r\n\r\n    for (var i = 0; i < value.length; ++i) {\r\n        var statement = arrayVar + '[' + i + ']=';\r\n        var expression = this.enumerateField(value, i, value[i]);\r\n        writeAssignment(codeArray, statement, expression);\r\n    }\r\n    return codeArray;\r\n};\r\n\r\nproto.enumerateField = function (obj, key, value) {\r\n    if (typeof value === 'object' && value) {\r\n        var _iN$t = value._iN$t;\r\n        if (_iN$t) {\r\n            // parsed\r\n            var globalVar = _iN$t.globalVar;\r\n            if (!globalVar) {\r\n                // declare a global var\r\n                globalVar = _iN$t.globalVar = 'v' + (++this.globalVariableId);\r\n                this.globalVariables.push(globalVar);\r\n                // insert assignment statement to assign to global var\r\n                var line = _iN$t.source[LINE_INDEX_OF_NEW_OBJ];\r\n                _iN$t.source[LINE_INDEX_OF_NEW_OBJ] = mergeDeclaration(globalVar + '=', line);\r\n                // if (typeof line ==='string' && line.startsWith(VAR)) {\r\n                //     // var o=xxx -> var o=global=xxx\r\n                //     var LEN_OF_VAR_O = 5;\r\n                //     _iN$t.source[LINE_INDEX_OF_NEW_OBJ] = line.slice(0, LEN_OF_VAR_O) + '=' + globalVar + line.slice(LEN_OF_VAR_O);\r\n                // }\r\n            }\r\n            return globalVar;\r\n        }\r\n        else if (Array.isArray(value)) {\r\n            return this.instantiateArray(value);\r\n        }\r\n        else {\r\n            return this.instantiateObj(value);\r\n        }\r\n    }\r\n    else if (typeof value === 'function') {\r\n        return this.getFuncModule(value);\r\n    }\r\n    else if (typeof value === 'string') {\r\n        return escapeForJS(value);\r\n    }\r\n    else {\r\n        if (key === '_objFlags' && (obj instanceof CCObject)) {\r\n            value &= PersistentMask;\r\n        }\r\n        return value;\r\n    }\r\n};\r\n\r\nproto.setObjProp = function (codeArray, obj, key, value) {\r\n    var statement = LOCAL_OBJ + getPropAccessor(key) + '=';\r\n    var expression = this.enumerateField(obj, key, value);\r\n    writeAssignment(codeArray, statement, expression);\r\n};\r\n\r\n// codeArray - the source code array for this object\r\nproto.enumerateObject = function (codeArray, obj) {\r\n    var klass = obj.constructor;\r\n    if (cc.Class._isCCClass(klass)) {\r\n        this.enumerateCCClass(codeArray, obj, klass);\r\n    }\r\n    else {\r\n        // primitive javascript object\r\n        for (var key in obj) {\r\n            if (!obj.hasOwnProperty(key) ||\r\n                (key.charCodeAt(0) === 95 && key.charCodeAt(1) === 95 &&   // starts with \"__\"\r\n                 key !== '__type__')\r\n            ) {\r\n                continue;\r\n            }\r\n            var value = obj[key];\r\n            if (typeof value === 'object' && value && value === obj._iN$t) {\r\n                continue;\r\n            }\r\n            this.setObjProp(codeArray, obj, key, value);\r\n        }\r\n    }\r\n};\r\n\r\nproto.instantiateObj = function (obj) {\r\n    if (obj instanceof cc.ValueType) {\r\n        return CCClass.getNewValueTypeCode(obj);\r\n    }\r\n    if (obj instanceof cc.Asset) {\r\n        // register to asset list and just return the reference.\r\n        return this.getObjRef(obj);\r\n    }\r\n    if (obj._objFlags & Destroyed) {\r\n        // the same as cc.isValid(obj)\r\n        return null;\r\n    }\r\n\r\n    var createCode;\r\n    var ctor = obj.constructor;\r\n    if (cc.Class._isCCClass(ctor)) {\r\n        if (this.parent) {\r\n            if (this.parent instanceof cc.Component) {\r\n                if (obj instanceof cc._BaseNode || obj instanceof cc.Component) {\r\n                    return this.getObjRef(obj);\r\n                }\r\n            }\r\n            else if (this.parent instanceof cc._BaseNode) {\r\n                if (obj instanceof cc._BaseNode) {\r\n                    if (!obj.isChildOf(this.parent)) {\r\n                        // should not clone other nodes if not descendant\r\n                        return this.getObjRef(obj);\r\n                    }\r\n                }\r\n                else if (obj instanceof cc.Component) {\r\n                    if (!obj.node.isChildOf(this.parent)) {\r\n                        // should not clone other component if not descendant\r\n                        return this.getObjRef(obj);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        createCode = new Declaration(LOCAL_OBJ, 'new ' + this.getFuncModule(ctor, true) + '()');\r\n    }\r\n    else if (ctor === Object) {\r\n        createCode = new Declaration(LOCAL_OBJ, '{}');\r\n    }\r\n    else if (!ctor) {\r\n        createCode = new Declaration(LOCAL_OBJ, 'Object.create(null)');\r\n    }\r\n    else {\r\n        // do not clone unknown type\r\n        return this.getObjRef(obj);\r\n    }\r\n\r\n    var codeArray = [createCode];\r\n\r\n    // assign a _iN$t flag to indicate that this object has been parsed.\r\n    obj._iN$t = {\r\n        globalVar: '',      // the name of declared global variable used to access this object\r\n        source: codeArray,  // the source code array for this object\r\n        //propName: '',     // the propName this object defined in its source code,\r\n        //                  // if defined, use LOCAL_OBJ.propName to access the obj, else just use o\r\n    };\r\n    this.objsToClear_iN$t.push(obj);\r\n\r\n    this.enumerateObject(codeArray, obj);\r\n    return ['(function(){',\r\n                codeArray,\r\n            'return o;})();'];\r\n};\r\n\r\n\r\nfunction compile (node) {\r\n    var root = (node instanceof cc._BaseNode) && node;\r\n    var parser = new Parser(node, root);\r\n    return parser.result;\r\n}\r\n\r\nmodule.exports = {\r\n    compile: compile,\r\n    equalsToDefault: equalsToDefault\r\n};\r\n\r\nif (CC_TEST) {\r\n    cc._Test.IntantiateJit = module.exports;\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar CCObject = require('./CCObject');\r\nvar CCValueType = require('../value-types/value-type');\r\nvar Destroyed = CCObject.Flags.Destroyed;\r\nvar PersistentMask = CCObject.Flags.PersistentMask;\r\nvar _isDomNode = require('./utils').isDomNode;\r\n\r\n/**\r\n * !#en Clones the object `original` and returns the clone, or instantiate a node from the Prefab.\r\n * !#zh  Prefab \r\n *\r\n * Instantiate function  dom Asset \r\n *\r\n * @method instantiate\r\n * @param {Prefab|Node|Object} original - An existing object that you want to make a copy of.\r\n * @return {Node|Object} the newly instantiated object\r\n * @typescript\r\n * instantiate(original: Prefab): Node\r\n * instantiate<T>(original: T): T\r\n * @example\r\n * // instantiate node from prefab\r\n * var scene = cc.director.getScene();\r\n * var node = cc.instantiate(prefabAsset);\r\n * node.parent = scene;\r\n * // clone node\r\n * var scene = cc.director.getScene();\r\n * var node = cc.instantiate(targetNode);\r\n * node.parent = scene;\r\n */\r\nfunction instantiate (original, internal_force) {\r\n    if (!internal_force) {\r\n        if (typeof original !== 'object' || Array.isArray(original)) {\r\n            if (CC_DEV) {\r\n                cc.errorID(6900);\r\n            }\r\n            return null;\r\n        }\r\n        if (!original) {\r\n            if (CC_DEV) {\r\n                cc.errorID(6901);\r\n            }\r\n            return null;\r\n        }\r\n        if (!cc.isValid(original)) {\r\n            if (CC_DEV) {\r\n                cc.errorID(6902);\r\n            }\r\n            return null;\r\n        }\r\n        if (CC_DEV && original instanceof cc.Component) {\r\n            cc.warn('Should not instantiate a single cc.Component directly, you must instantiate the entire node.');\r\n        }\r\n    }\r\n\r\n    var clone;\r\n    if (original instanceof CCObject) {\r\n        // Invoke _instantiate method if supplied.\r\n        // The _instantiate callback will be called only on the root object, its associated object will not be called.\r\n        // @callback associated\r\n        // @param {Object} [instantiated] - If supplied, _instantiate just need to initialize the instantiated object,\r\n        //                                  no need to create new object by itself.\r\n        // @returns {Object} - the instantiated object\r\n        if (original._instantiate) {\r\n            cc.game._isCloning = true;\r\n            clone = original._instantiate();\r\n            cc.game._isCloning = false;\r\n            return clone;\r\n        }\r\n        else if (original instanceof cc.Asset) {\r\n            // \r\n            if (CC_DEV) {\r\n                cc.errorID(6903);\r\n            }\r\n            return null;\r\n        }\r\n    }\r\n\r\n    cc.game._isCloning = true;\r\n    clone = doInstantiate(original);\r\n    cc.game._isCloning = false;\r\n    return clone;\r\n}\r\n\r\nvar objsToClearTmpVar = [];   // used to reset _iN$t variable\r\n\r\n///**\r\n// * Do instantiate object, the object to instantiate must be non-nil.\r\n// *  instantiate \r\n// * \r\n// * \r\n// *\r\n// * @param {Object} obj -  cc.instantiate \r\n// * @param {Node} [parent] - \r\n// * @return {Object}\r\n// * @private\r\n// */\r\nfunction doInstantiate (obj, parent) {\r\n    if (Array.isArray(obj)) {\r\n        if (CC_DEV) {\r\n            cc.errorID(6904);\r\n        }\r\n        return null;\r\n    }\r\n    if (_isDomNode && _isDomNode(obj)) {\r\n        if (CC_DEV) {\r\n            cc.errorID(6905);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    var clone;\r\n    if (obj._iN$t) {\r\n        // User can specify an existing object by assigning the \"_iN$t\" property.\r\n        // enumerateObject will always push obj to objsToClearTmpVar\r\n        clone = obj._iN$t;\r\n    }\r\n    else if (obj.constructor) {\r\n        var klass = obj.constructor;\r\n        clone = new klass();\r\n    }\r\n    else {\r\n        clone = Object.create(null);\r\n    }\r\n\r\n    enumerateObject(obj, clone, parent);\r\n\r\n    for (var i = 0, len = objsToClearTmpVar.length; i < len; ++i) {\r\n        objsToClearTmpVar[i]._iN$t = null;\r\n    }\r\n    objsToClearTmpVar.length = 0;\r\n\r\n    return clone;\r\n}\r\n\r\n// @param {Object} obj - The object to instantiate, typeof must be 'object' and should not be an array.\r\n\r\nfunction enumerateCCClass (klass, obj, clone, parent) {\r\n    var props = klass.__values__;\r\n    for (var p = 0; p < props.length; p++) {\r\n        var key = props[p];\r\n        var value = obj[key];\r\n        if (typeof value === 'object' && value) {\r\n            var initValue = clone[key];\r\n            if (initValue instanceof CCValueType &&\r\n                initValue.constructor === value.constructor) {\r\n                initValue.set(value);\r\n            }\r\n            else {\r\n                clone[key] = value._iN$t || instantiateObj(value, parent);\r\n            }\r\n        }\r\n        else {\r\n            clone[key] = value;\r\n        }\r\n    }\r\n}\r\n\r\nfunction enumerateObject (obj, clone, parent) {\r\n    // _iN$t\r\n    // _iN$t\r\n    obj._iN$t = clone;\r\n    objsToClearTmpVar.push(obj);\r\n    var klass = obj.constructor;\r\n    if (cc.Class._isCCClass(klass)) {\r\n        enumerateCCClass(klass, obj, clone, parent);\r\n    }\r\n    else {\r\n        // primitive javascript object\r\n        for (var key in obj) {\r\n            if (!obj.hasOwnProperty(key) ||\r\n                (key.charCodeAt(0) === 95 && key.charCodeAt(1) === 95 &&   // starts with \"__\"\r\n                 key !== '__type__')\r\n            ) {\r\n                continue;\r\n            }\r\n            var value = obj[key];\r\n            if (typeof value === 'object' && value) {\r\n                if (value === clone) {\r\n                    continue;   // value is obj._iN$t\r\n                }\r\n                clone[key] = value._iN$t || instantiateObj(value, parent);\r\n            }\r\n            else {\r\n                clone[key] = value;\r\n            }\r\n        }\r\n    }\r\n    if (obj instanceof CCObject) {\r\n        clone._objFlags &= PersistentMask;\r\n    }\r\n}\r\n\r\n/*\r\n * @param {Object|Array} obj - the original non-nil object, typeof must be 'object'\r\n * @return {Object|Array} - the original non-nil object, typeof must be 'object'\r\n */\r\nfunction instantiateObj (obj, parent) {\r\n    if (obj instanceof CCValueType) {\r\n        return obj.clone();\r\n    }\r\n    if (obj instanceof cc.Asset) {\r\n        // \r\n        return obj;\r\n    }\r\n    var clone;\r\n    if (Array.isArray(obj)) {\r\n        var len = obj.length;\r\n        clone = new Array(len);\r\n        obj._iN$t = clone;\r\n        for (var i = 0; i < len; ++i) {\r\n            var value = obj[i];\r\n            if (typeof value === 'object' && value) {\r\n                clone[i] = value._iN$t || instantiateObj(value, parent);\r\n            }\r\n            else {\r\n                clone[i] = value;\r\n            }\r\n        }\r\n        objsToClearTmpVar.push(obj);\r\n        return clone;\r\n    }\r\n    else if (obj._objFlags & Destroyed) {\r\n        // the same as cc.isValid(obj)\r\n        return null;\r\n    }\r\n\r\n    var ctor = obj.constructor;\r\n    if (cc.Class._isCCClass(ctor)) {\r\n        if (parent) {\r\n            if (parent instanceof cc.Component) {\r\n                if (obj instanceof cc._BaseNode || obj instanceof cc.Component) {\r\n                    return obj;\r\n                }\r\n            }\r\n            else if (parent instanceof cc._BaseNode) {\r\n                if (obj instanceof cc._BaseNode) {\r\n                    if (!obj.isChildOf(parent)) {\r\n                        // should not clone other nodes if not descendant\r\n                        return obj;\r\n                    }\r\n                }\r\n                else if (obj instanceof cc.Component) {\r\n                    if (!obj.node.isChildOf(parent)) {\r\n                        // should not clone other component if not descendant\r\n                        return obj;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        clone = new ctor();\r\n    }\r\n    else if (ctor === Object) {\r\n        clone = {};\r\n    }\r\n    else if (!ctor) {\r\n        clone = Object.create(null);\r\n    }\r\n    else {\r\n        // unknown type\r\n        return obj;\r\n    }\r\n    enumerateObject(obj, clone, parent);\r\n    return clone;\r\n}\r\n\r\ninstantiate._clone = doInstantiate;\r\ncc.instantiate = instantiate;\r\nmodule.exports = instantiate;\r\n","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst tempCIDGenerater = new (require('./id-generater'))('TmpCId.');\r\n\r\n\r\nfunction _getPropertyDescriptor (obj, name) {\r\n    while (obj) {\r\n        var pd = Object.getOwnPropertyDescriptor(obj, name);\r\n        if (pd) {\r\n            return pd;\r\n        }\r\n        obj = Object.getPrototypeOf(obj);\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction _copyprop(name, source, target) {\r\n    var pd = _getPropertyDescriptor(source, name);\r\n    Object.defineProperty(target, name, pd);\r\n}\r\n\r\n/**\r\n * This module provides some JavaScript utilities.\r\n * All members can be accessed with \"cc.js\".\r\n * @submodule js\r\n * @module js\r\n */\r\nvar js = {\r\n\r\n    /**\r\n     * Check the obj whether is number or not\r\n     * If a number is created by using 'new Number(10086)', the typeof it will be \"object\"...\r\n     * Then you can use this function if you care about this case.\r\n     * @method isNumber\r\n     * @param {*} obj\r\n     * @returns {Boolean}\r\n     */\r\n    isNumber: function(obj) {\r\n        return typeof obj === 'number' || obj instanceof Number;\r\n    },\r\n\r\n    /**\r\n     * Check the obj whether is string or not.\r\n     * If a string is created by using 'new String(\"blabla\")', the typeof it will be \"object\"...\r\n     * Then you can use this function if you care about this case.\r\n     * @method isString\r\n     * @param {*} obj\r\n     * @returns {Boolean}\r\n     */\r\n    isString: function(obj) {\r\n        return typeof obj === 'string' || obj instanceof String;\r\n    },\r\n\r\n    /**\r\n     * Copy all properties not defined in obj from arguments[1...n]\r\n     * @method addon\r\n     * @param {Object} obj object to extend its properties\r\n     * @param {Object} ...sourceObj source object to copy properties from\r\n     * @return {Object} the result obj\r\n     */\r\n    addon: function (obj) {\r\n        'use strict';\r\n        obj = obj || {};\r\n        for (var i = 1, length = arguments.length; i < length; i++) {\r\n            var source = arguments[i];\r\n            if (source) {\r\n                if (typeof source !== 'object') {\r\n                    cc.errorID(5402, source);\r\n                    continue;\r\n                }\r\n                for ( var name in source) {\r\n                    if ( !(name in obj) ) {\r\n                        _copyprop( name, source, obj);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return obj;\r\n    },\r\n\r\n    /**\r\n     * copy all properties from arguments[1...n] to obj\r\n     * @method mixin\r\n     * @param {Object} obj\r\n     * @param {Object} ...sourceObj\r\n     * @return {Object} the result obj\r\n     */\r\n    mixin: function (obj) {\r\n        'use strict';\r\n        obj = obj || {};\r\n        for (var i = 1, length = arguments.length; i < length; i++) {\r\n            var source = arguments[i];\r\n            if (source) {\r\n                if (typeof source !== 'object') {\r\n                    cc.errorID(5403, source);\r\n                    continue;\r\n                }\r\n                for ( var name in source) {\r\n                    _copyprop( name, source, obj);\r\n                }\r\n            }\r\n        }\r\n        return obj;\r\n    },\r\n\r\n    /**\r\n     * Derive the class from the supplied base class.\r\n     * Both classes are just native javascript constructors, not created by cc.Class, so\r\n     * usually you will want to inherit using {{#crossLink \"cc/Class:method\"}}cc.Class {{/crossLink}} instead.\r\n     * @method extend\r\n     * @param {Function} cls\r\n     * @param {Function} base - the baseclass to inherit\r\n     * @return {Function} the result class\r\n     */\r\n    extend: function (cls, base) {\r\n        if (CC_DEV) {\r\n            if (!base) {\r\n                cc.errorID(5404);\r\n                return;\r\n            }\r\n            if (!cls) {\r\n                cc.errorID(5405);\r\n                return;\r\n            }\r\n            if (Object.keys(cls.prototype).length > 0) {\r\n                cc.errorID(5406);\r\n            }\r\n        }\r\n        for (var p in base) if (base.hasOwnProperty(p)) cls[p] = base[p];\r\n        cls.prototype = Object.create(base.prototype, {\r\n            constructor: {\r\n                value: cls,\r\n                writable: true,\r\n                configurable: true\r\n            }\r\n        });\r\n        return cls;\r\n    },\r\n\r\n    /**\r\n     * Get super class\r\n     * @method getSuper\r\n     * @param {Function} ctor - the constructor of subclass\r\n     * @return {Function}\r\n     */\r\n    getSuper (ctor) {\r\n        var proto = ctor.prototype; // binded function do not have prototype\r\n        var dunderProto = proto && Object.getPrototypeOf(proto);\r\n        return dunderProto && dunderProto.constructor;\r\n    },\r\n\r\n    /**\r\n     * Checks whether subclass is child of superclass or equals to superclass\r\n     *\r\n     * @method isChildClassOf\r\n     * @param {Function} subclass\r\n     * @param {Function} superclass\r\n     * @return {Boolean}\r\n     */\r\n    isChildClassOf (subclass, superclass) {\r\n        if (subclass && superclass) {\r\n            if (typeof subclass !== 'function') {\r\n                return false;\r\n            }\r\n            if (typeof superclass !== 'function') {\r\n                if (CC_DEV) {\r\n                    cc.warnID(3625, superclass);\r\n                }\r\n                return false;\r\n            }\r\n            if (subclass === superclass) {\r\n                return true;\r\n            }\r\n            for (;;) {\r\n                subclass = js.getSuper(subclass);\r\n                if (!subclass) {\r\n                    return false;\r\n                }\r\n                if (subclass === superclass) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    /**\r\n     * Removes all enumerable properties from object\r\n     * @method clear\r\n     * @param {any} obj\r\n     */\r\n    clear: function (obj) {\r\n        var keys = Object.keys(obj);\r\n        for (var i = 0; i < keys.length; i++) {\r\n            delete obj[keys[i]];\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get property descriptor in object and all its ancestors\r\n     * @method getPropertyDescriptor\r\n     * @param {Object} obj\r\n     * @param {String} name\r\n     * @return {Object}\r\n     */\r\n    getPropertyDescriptor: _getPropertyDescriptor\r\n};\r\n\r\n\r\nvar tmpValueDesc = {\r\n    value: undefined,\r\n    enumerable: false,\r\n    writable: false,\r\n    configurable: true\r\n};\r\n\r\n/**\r\n * Define value, just help to call Object.defineProperty.<br>\r\n * The configurable will be true.\r\n * @method value\r\n * @param {Object} obj\r\n * @param {String} prop\r\n * @param {any} value\r\n * @param {Boolean} [writable=false]\r\n * @param {Boolean} [enumerable=false]\r\n */\r\njs.value = function (obj, prop, value, writable, enumerable) {\r\n    tmpValueDesc.value = value;\r\n    tmpValueDesc.writable = writable;\r\n    tmpValueDesc.enumerable = enumerable;\r\n    Object.defineProperty(obj, prop, tmpValueDesc);\r\n    tmpValueDesc.value = undefined;\r\n};\r\n\r\nvar tmpGetSetDesc = {\r\n    get: null,\r\n    set: null,\r\n    enumerable: false,\r\n};\r\n\r\n/**\r\n * Define get set accessor, just help to call Object.defineProperty(...)\r\n * @method getset\r\n * @param {Object} obj\r\n * @param {String} prop\r\n * @param {Function} getter\r\n * @param {Function} [setter=null]\r\n * @param {Boolean} [enumerable=false]\r\n * @param {Boolean} [configurable=false]\r\n */\r\njs.getset = function (obj, prop, getter, setter, enumerable, configurable) {\r\n    if (typeof setter !== 'function') {\r\n        enumerable = setter;\r\n        setter = undefined;\r\n    }\r\n    tmpGetSetDesc.get = getter;\r\n    tmpGetSetDesc.set = setter;\r\n    tmpGetSetDesc.enumerable = enumerable;\r\n    tmpGetSetDesc.configurable = configurable;\r\n    Object.defineProperty(obj, prop, tmpGetSetDesc);\r\n    tmpGetSetDesc.get = null;\r\n    tmpGetSetDesc.set = null;\r\n};\r\n\r\nvar tmpGetDesc = {\r\n    get: null,\r\n    enumerable: false,\r\n    configurable: false\r\n};\r\n\r\n/**\r\n * Define get accessor, just help to call Object.defineProperty(...)\r\n * @method get\r\n * @param {Object} obj\r\n * @param {String} prop\r\n * @param {Function} getter\r\n * @param {Boolean} [enumerable=false]\r\n * @param {Boolean} [configurable=false]\r\n */\r\njs.get = function (obj, prop, getter, enumerable, configurable) {\r\n    tmpGetDesc.get = getter;\r\n    tmpGetDesc.enumerable = enumerable;\r\n    tmpGetDesc.configurable = configurable;\r\n    Object.defineProperty(obj, prop, tmpGetDesc);\r\n    tmpGetDesc.get = null;\r\n};\r\n\r\nvar tmpSetDesc = {\r\n    set: null,\r\n    enumerable: false,\r\n    configurable: false\r\n};\r\n\r\n/**\r\n * Define set accessor, just help to call Object.defineProperty(...)\r\n * @method set\r\n * @param {Object} obj\r\n * @param {String} prop\r\n * @param {Function} setter\r\n * @param {Boolean} [enumerable=false]\r\n * @param {Boolean} [configurable=false]\r\n */\r\njs.set = function (obj, prop, setter, enumerable, configurable) {\r\n    tmpSetDesc.set = setter;\r\n    tmpSetDesc.enumerable = enumerable;\r\n    tmpSetDesc.configurable = configurable;\r\n    Object.defineProperty(obj, prop, tmpSetDesc);\r\n    tmpSetDesc.set = null;\r\n};\r\n\r\n/**\r\n * Get class name of the object, if object is just a {} (and which class named 'Object'), it will return \"\".\r\n * (modified from <a href=\"http://stackoverflow.com/questions/1249531/how-to-get-a-javascript-objects-class\">the code from this stackoverflow post</a>)\r\n * @method getClassName\r\n * @param {Object|Function} objOrCtor - instance or constructor\r\n * @return {String}\r\n */\r\njs.getClassName = function (objOrCtor) {\r\n    if (typeof objOrCtor === 'function') {\r\n        var prototype = objOrCtor.prototype;\r\n        if (prototype && prototype.hasOwnProperty('__classname__') && prototype.__classname__) {\r\n            return prototype.__classname__;\r\n        }\r\n        var retval = '';\r\n        //  for browsers which have name property in the constructor of the object, such as chrome\r\n        if (objOrCtor.name) {\r\n            retval = objOrCtor.name;\r\n        }\r\n        if (objOrCtor.toString) {\r\n            var arr, str = objOrCtor.toString();\r\n            if (str.charAt(0) === '[') {\r\n                // str is \"[object objectClass]\"\r\n                arr = str.match(/\\[\\w+\\s*(\\w+)\\]/);\r\n            }\r\n            else {\r\n                // str is function objectClass () {} for IE Firefox\r\n                arr = str.match(/function\\s*(\\w+)/);\r\n            }\r\n            if (arr && arr.length === 2) {\r\n                retval = arr[1];\r\n            }\r\n        }\r\n        return retval !== 'Object' ? retval : '';\r\n    }\r\n    else if (objOrCtor && objOrCtor.constructor) {\r\n        return js.getClassName(objOrCtor.constructor);\r\n    }\r\n    return '';\r\n};\r\n\r\nfunction isTempClassId (id) {\r\n    return typeof id !== 'string' || id.startsWith(tempCIDGenerater.prefix);\r\n}\r\n\r\n// id \r\n(function () {\r\n    var _idToClass = {};\r\n    var _nameToClass = {};\r\n\r\n    function setup (key, publicName, table) {\r\n        js.getset(js, publicName,\r\n            function () {\r\n                return Object.assign({}, table);\r\n            },\r\n            function (value) {\r\n                js.clear(table);\r\n                Object.assign(table, value);\r\n            }\r\n        );\r\n        return function (id, constructor) {\r\n            // deregister old\r\n            if (constructor.prototype.hasOwnProperty(key)) {\r\n                delete table[constructor.prototype[key]];\r\n            }\r\n            js.value(constructor.prototype, key, id);\r\n            // register class\r\n            if (id) {\r\n                var registered = table[id];\r\n                if (registered && registered !== constructor) {\r\n                    var error = 'A Class already exists with the same ' + key + ' : \"' + id + '\".';\r\n                    if (CC_TEST) {\r\n                        error += ' (This may be caused by error of unit test.) \\\r\nIf you dont need serialization, you can set class id to \"\". You can also call \\\r\ncc.js.unregisterClass to remove the id of unused class';\r\n                    }\r\n                    cc.error(error);\r\n                }\r\n                else {\r\n                    table[id] = constructor;\r\n                }\r\n                //if (id === \"\") {\r\n                //    console.trace(\"\", table === _nameToClass);\r\n                //}\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Register the class by specified id, if its classname is not defined, the class name will also be set.\r\n     * @method _setClassId\r\n     * @param {String} classId\r\n     * @param {Function} constructor\r\n     * @private\r\n     */\r\n    /**\r\n     * !#en All classes registered in the engine, indexed by ID.\r\n     * !#zh  ID \r\n     * @property _registeredClassIds\r\n     * @example\r\n     * // save all registered classes before loading scripts\r\n     * let builtinClassIds = cc.js._registeredClassIds;\r\n     * let builtinClassNames = cc.js._registeredClassNames;\r\n     * // load some scripts that contain CCClass\r\n     * ...\r\n     * // clear all loaded classes\r\n     * cc.js._registeredClassIds = builtinClassIds;\r\n     * cc.js._registeredClassNames = builtinClassNames;\r\n     */\r\n    js._setClassId = setup('__cid__', '_registeredClassIds', _idToClass);\r\n\r\n    /**\r\n     * !#en All classes registered in the engine, indexed by name.\r\n     * !#zh \r\n     * @property _registeredClassNames\r\n     * @example\r\n     * // save all registered classes before loading scripts\r\n     * let builtinClassIds = cc.js._registeredClassIds;\r\n     * let builtinClassNames = cc.js._registeredClassNames;\r\n     * // load some scripts that contain CCClass\r\n     * ...\r\n     * // clear all loaded classes\r\n     * cc.js._registeredClassIds = builtinClassIds;\r\n     * cc.js._registeredClassNames = builtinClassNames;\r\n     */\r\n    var doSetClassName = setup('__classname__', '_registeredClassNames', _nameToClass);\r\n\r\n    /**\r\n     * Register the class by specified name manually\r\n     * @method setClassName\r\n     * @param {String} className\r\n     * @param {Function} constructor\r\n     */\r\n    js.setClassName = function (className, constructor) {\r\n        doSetClassName(className, constructor);\r\n        // auto set class id\r\n        if (!constructor.prototype.hasOwnProperty('__cid__')) {\r\n            var id = className || tempCIDGenerater.getNewId();\r\n            if (id) {\r\n                js._setClassId(id, constructor);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Unregister a class from fireball.\r\n     *\r\n     * If you dont need a registered class anymore, you should unregister the class so that Fireball will not keep its reference anymore.\r\n     * Please note that its still your responsibility to free other references to the class.\r\n     *\r\n     * @method unregisterClass\r\n     * @param {Function} ...constructor - the class you will want to unregister, any number of classes can be added\r\n     */\r\n    js.unregisterClass = function () {\r\n        for (var i = 0; i < arguments.length; i++) {\r\n            var p = arguments[i].prototype;\r\n            var classId = p.__cid__;\r\n            if (classId) {\r\n                delete _idToClass[classId];\r\n            }\r\n            var classname = p.__classname__;\r\n            if (classname) {\r\n                delete _nameToClass[classname];\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Get the registered class by id\r\n     * @method _getClassById\r\n     * @param {String} classId\r\n     * @return {Function} constructor\r\n     * @private\r\n     */\r\n    js._getClassById = function (classId) {\r\n        return _idToClass[classId];\r\n    };\r\n\r\n    /**\r\n     * Get the registered class by name\r\n     * @method getClassByName\r\n     * @param {String} classname\r\n     * @return {Function} constructor\r\n     */\r\n    js.getClassByName = function (classname) {\r\n        return _nameToClass[classname];\r\n    };\r\n\r\n    /**\r\n     * Get class id of the object\r\n     * @method _getClassId\r\n     * @param {Object|Function} obj - instance or constructor\r\n     * @param {Boolean} [allowTempId=true] - can return temp id in editor\r\n     * @return {String}\r\n     * @private\r\n     */\r\n    js._getClassId = function (obj, allowTempId) {\r\n        allowTempId = (typeof allowTempId !== 'undefined' ? allowTempId: true);\r\n\r\n        var res;\r\n        if (typeof obj === 'function' && obj.prototype.hasOwnProperty('__cid__')) {\r\n            res = obj.prototype.__cid__;\r\n            if (!allowTempId && (CC_DEV || CC_EDITOR) && isTempClassId(res)) {\r\n                return '';\r\n            }\r\n            return res;\r\n        }\r\n        if (obj && obj.constructor) {\r\n            var prototype = obj.constructor.prototype;\r\n            if (prototype && prototype.hasOwnProperty('__cid__')) {\r\n                res = obj.__cid__;\r\n                if (!allowTempId && (CC_DEV || CC_EDITOR) && isTempClassId(res)) {\r\n                    return '';\r\n                }\r\n                return res;\r\n            }\r\n        }\r\n        return '';\r\n    };\r\n})();\r\n\r\n/**\r\n * Defines a polyfill field for obsoleted codes.\r\n * @method obsolete\r\n * @param {any} obj - YourObject or YourClass.prototype\r\n * @param {String} obsoleted - \"OldParam\" or \"YourClass.OldParam\"\r\n * @param {String} newExpr - \"NewParam\" or \"YourClass.NewParam\"\r\n * @param {Boolean} [writable=false]\r\n */\r\njs.obsolete = function (obj, obsoleted, newExpr, writable) {\r\n    var extractPropName = /([^.]+)$/;\r\n    var oldProp = extractPropName.exec(obsoleted)[0];\r\n    var newProp = extractPropName.exec(newExpr)[0];\r\n    function get () {\r\n        if (CC_DEV) {\r\n            cc.warnID(5400, obsoleted, newExpr);\r\n        }\r\n        return this[newProp];\r\n    }\r\n    if (writable) {\r\n        js.getset(obj, oldProp,\r\n            get,\r\n            function (value) {\r\n                if (CC_DEV) {\r\n                    cc.warnID(5401, obsoleted, newExpr);\r\n                }\r\n                this[newProp] = value;\r\n            }\r\n        );\r\n    }\r\n    else {\r\n        js.get(obj, oldProp, get);\r\n    }\r\n};\r\n\r\n/**\r\n * Defines all polyfill fields for obsoleted codes corresponding to the enumerable properties of props.\r\n * @method obsoletes\r\n * @param {any} obj - YourObject or YourClass.prototype\r\n * @param {any} objName - \"YourObject\" or \"YourClass\"\r\n * @param {Object} props\r\n * @param {Boolean} [writable=false]\r\n */\r\njs.obsoletes = function (obj, objName, props, writable) {\r\n    for (var obsoleted in props) {\r\n        var newName = props[obsoleted];\r\n        js.obsolete(obj, objName + '.' + obsoleted, newName, writable);\r\n    }\r\n};\r\n\r\nvar REGEXP_NUM_OR_STR = /(%d)|(%s)/;\r\nvar REGEXP_STR = /%s/;\r\n\r\n/**\r\n * A string tool to construct a string with format string.\r\n * @method formatStr\r\n * @param {String|any} msg - A JavaScript string containing zero or more substitution strings (%s).\r\n * @param {any} ...subst - JavaScript objects with which to replace substitution strings within msg. This gives you additional control over the format of the output.\r\n * @returns {String}\r\n * @example\r\n * cc.js.formatStr(\"a: %s, b: %s\", a, b);\r\n * cc.js.formatStr(a, b, c);\r\n */\r\njs.formatStr = function () {\r\n    var argLen = arguments.length;\r\n    if (argLen === 0) {\r\n        return '';\r\n    }\r\n    var msg = arguments[0];\r\n    if (argLen === 1) {\r\n        return '' + msg;\r\n    }\r\n\r\n    var hasSubstitution = typeof msg === 'string' && REGEXP_NUM_OR_STR.test(msg);\r\n    if (hasSubstitution) {\r\n        for (let i = 1; i < argLen; ++i) {\r\n            var arg = arguments[i];\r\n            var regExpToTest = typeof arg === 'number' ? REGEXP_NUM_OR_STR : REGEXP_STR;\r\n            if (regExpToTest.test(msg))\r\n                msg = msg.replace(regExpToTest, arg);\r\n            else\r\n                msg += ' ' + arg;\r\n        }\r\n    }\r\n    else {\r\n        for (let i = 1; i < argLen; ++i) {\r\n            msg += ' ' + arguments[i];\r\n        }\r\n    }\r\n    return msg;\r\n};\r\n\r\n// see https://github.com/petkaantonov/bluebird/issues/1389\r\njs.shiftArguments = function () {\r\n    var len = arguments.length - 1;\r\n    var args = new Array(len);\r\n    for(var i = 0; i < len; ++i) {\r\n        args[i] = arguments[i + 1];\r\n    }\r\n    return args;\r\n};\r\n\r\n/**\r\n * !#en\r\n * A simple wrapper of `Object.create(null)` which ensures the return object have no prototype (and thus no inherited members). So we can skip `hasOwnProperty` calls on property lookups. It is a worthwhile optimization than the `{}` literal when `hasOwnProperty` calls are necessary.\r\n * !#zh\r\n *  `Object.create(null)` `Object.create(null)`  prototype  `hasOwnProperty`  `hasOwnProperty`  `{}` \r\n *\r\n * @method createMap\r\n * @param {Boolean} [forceDictMode=false] - Apply the delete operator to newly created map object. This causes V8 to put the object in \"dictionary mode\" and disables creation of hidden classes which are very expensive for objects that are constantly changing shape.\r\n * @return {Object}\r\n */\r\njs.createMap = function (forceDictMode) {\r\n    var map = Object.create(null);\r\n    if (forceDictMode) {\r\n        const INVALID_IDENTIFIER_1 = '.';\r\n        const INVALID_IDENTIFIER_2 = '/';\r\n        map[INVALID_IDENTIFIER_1] = true;\r\n        map[INVALID_IDENTIFIER_2] = true;\r\n        delete map[INVALID_IDENTIFIER_1];\r\n        delete map[INVALID_IDENTIFIER_2];\r\n    }\r\n    return map;\r\n};\r\n\r\n/**\r\n * @class array\r\n * @static\r\n */\r\n\r\n/**\r\n * Removes the array item at the specified index.\r\n * @method removeAt\r\n * @param {any[]} array\r\n * @param {Number} index\r\n */\r\nfunction removeAt (array, index) {\r\n    array.splice(index, 1);\r\n}\r\n\r\n/**\r\n * Removes the array item at the specified index.\r\n * It's faster but the order of the array will be changed.\r\n * @method fastRemoveAt\r\n * @param {any[]} array\r\n * @param {Number} index\r\n */\r\nfunction fastRemoveAt (array, index) {\r\n    var length = array.length;\r\n    if (index < 0 || index >= length) {\r\n        return;\r\n    }\r\n    array[index] = array[length - 1];\r\n    array.length = length - 1;\r\n}\r\n\r\n/**\r\n * Removes the first occurrence of a specific object from the array.\r\n * @method remove\r\n * @param {any[]} array\r\n * @param {any} value\r\n * @return {Boolean}\r\n */\r\nfunction remove (array, value) {\r\n    var index = array.indexOf(value);\r\n    if (index >= 0) {\r\n        removeAt(array, index);\r\n        return true;\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Removes the first occurrence of a specific object from the array.\r\n * It's faster but the order of the array will be changed.\r\n * @method fastRemove\r\n * @param {any[]} array\r\n * @param {Number} value\r\n */\r\nfunction fastRemove (array, value) {\r\n    var index = array.indexOf(value);\r\n    if (index >= 0) {\r\n        array[index] = array[array.length - 1];\r\n        --array.length;\r\n    }\r\n}\r\n\r\n/**\r\n * Verify array's Type\r\n * @method verifyType\r\n * @param {array} array\r\n * @param {Function} type\r\n * @return {Boolean}\r\n */\r\nfunction verifyType (array, type) {\r\n    if (array && array.length > 0) {\r\n        for (var i = 0; i < array.length; i++) {\r\n            if (!(array[i] instanceof  type)) {\r\n                cc.logID(1300);\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\n/**\r\n * Removes from array all values in minusArr. For each Value in minusArr, the first matching instance in array will be removed.\r\n * @method removeArray\r\n * @param {Array} array Source Array\r\n * @param {Array} minusArr minus Array\r\n */\r\nfunction removeArray (array, minusArr) {\r\n    for (var i = 0, l = minusArr.length; i < l; i++) {\r\n        remove(array, minusArr[i]);\r\n    }\r\n}\r\n\r\n/**\r\n * Inserts some objects at index\r\n * @method appendObjectsAt\r\n * @param {Array} array\r\n * @param {Array} addObjs\r\n * @param {Number} index\r\n * @return {Array}\r\n */\r\nfunction appendObjectsAt (array, addObjs, index) {\r\n    array.splice.apply(array, [index, 0].concat(addObjs));\r\n    return array;\r\n}\r\n\r\n/**\r\n * Exact same function as Array.prototype.indexOf.<br>\r\n * HACK: ugliy hack for Baidu mobile browser compatibility, stupid Baidu guys modify Array.prototype.indexOf for all pages loaded, their version changes strict comparison to non-strict comparison, it also ignores the second parameter of the original API, and this will cause event handler enter infinite loop.<br>\r\n * Baidu developers, if you ever see this documentation, here is the standard: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf, Seriously!\r\n *\r\n * @method indexOf\r\n * @param {any} searchElement - Element to locate in the array.\r\n * @param {Number} [fromIndex=0] - The index to start the search at\r\n * @return {Number} - the first index at which a given element can be found in the array, or -1 if it is not present.\r\n */\r\nvar indexOf = Array.prototype.indexOf;\r\n\r\n/**\r\n * Determines whether the array contains a specific value.\r\n * @method contains\r\n * @param {any[]} array\r\n * @param {any} value\r\n * @return {Boolean}\r\n */\r\nfunction contains (array, value) {\r\n    return array.indexOf(value) >= 0;\r\n}\r\n\r\n/**\r\n * Copy an array's item to a new array (its performance is better than Array.slice)\r\n * @method copy\r\n * @param {Array} array\r\n * @return {Array}\r\n */\r\nfunction copy (array) {\r\n    var i, len = array.length, arr_clone = new Array(len);\r\n    for (i = 0; i < len; i += 1)\r\n        arr_clone[i] = array[i];\r\n    return arr_clone;\r\n}\r\n\r\njs.array = {\r\n    remove,\r\n    fastRemove,\r\n    removeAt,\r\n    fastRemoveAt,\r\n    contains,\r\n    verifyType,\r\n    removeArray,\r\n    appendObjectsAt,\r\n    copy,\r\n    indexOf,\r\n    MutableForwardIterator: require('../utils/mutable-forward-iterator')\r\n};\r\n\r\n// OBJECT POOL\r\n\r\n/**\r\n * !#en\r\n * A fixed-length object pool designed for general type.<br>\r\n * The implementation of this object pool is very simple,\r\n * it can helps you to improve your game performance for objects which need frequent release and recreate operations<br/>\r\n * !#zh\r\n * <br/>\r\n * \r\n * @class Pool\r\n * @example\r\n *\r\n *Example 1:\r\n *\r\n *function Details () {\r\n *    this.uuidList = [];\r\n *};\r\n *Details.prototype.reset = function () {\r\n *    this.uuidList.length = 0;\r\n *};\r\n *Details.pool = new js.Pool(function (obj) {\r\n *    obj.reset();\r\n *}, 5);\r\n *Details.pool.get = function () {\r\n *    return this._get() || new Details();\r\n *};\r\n *\r\n *var detail = Details.pool.get();\r\n *...\r\n *Details.pool.put(detail);\r\n *\r\n *Example 2:\r\n *\r\n *function Details (buffer) {\r\n *    this.uuidList = buffer;\r\n *};\r\n *...\r\n *Details.pool.get = function (buffer) {\r\n *    var cached = this._get();\r\n *    if (cached) {\r\n *        cached.uuidList = buffer;\r\n *        return cached;\r\n *    }\r\n *    else {\r\n *        return new Details(buffer);\r\n *    }\r\n *};\r\n *\r\n *var detail = Details.pool.get( [] );\r\n *...\r\n */\r\n/**\r\n * !#en\r\n * Constructor for creating an object pool for the specific object type.\r\n * You can pass a callback argument for process the cleanup logic when the object is recycled.\r\n * !#zh\r\n * \r\n * @method constructor\r\n * @param {Function} [cleanupFunc] - the callback method used to process the cleanup logic when the object is recycled.\r\n * @param {Object} cleanupFunc.obj\r\n * @param {Number} size - initializes the length of the array\r\n * @typescript\r\n * constructor(cleanupFunc: (obj: any) => void, size: number)\r\n * constructor(size: number)\r\n */\r\nfunction Pool (cleanupFunc, size) {\r\n    if (size === undefined) {\r\n        size = cleanupFunc;\r\n        cleanupFunc = null;\r\n    }\r\n    this.get = null;\r\n    this.count = 0;\r\n    this._pool = new Array(size);\r\n    this._cleanup = cleanupFunc;\r\n}\r\n\r\n/**\r\n * !#en\r\n * Get and initialize an object from pool. This method defaults to null and requires the user to implement it.\r\n * !#zh\r\n * \r\n * @method get\r\n * @param {any} ...params - parameters to used to initialize the object\r\n * @returns {Object}\r\n */\r\n\r\n/**\r\n * !#en\r\n * The current number of available objects, the default is 0, it will gradually increase with the recycle of the object,\r\n * the maximum will not exceed the size specified when the constructor is called.\r\n * !#zh\r\n *  0 size\r\n * @property {Number} count\r\n * @default 0\r\n */\r\n\r\n/**\r\n * !#en\r\n * Get an object from pool, if no available object in the pool, null will be returned.\r\n * !#zh\r\n * \r\n * @method _get\r\n * @returns {Object|null}\r\n */\r\nPool.prototype._get = function () {\r\n    if (this.count > 0) {\r\n        --this.count;\r\n        var cache = this._pool[this.count];\r\n        this._pool[this.count] = null;\r\n        return cache;\r\n    }\r\n    return null;\r\n};\r\n\r\n/**\r\n * !#en Put an object into the pool.\r\n * !#zh \r\n * @method put\r\n */\r\nPool.prototype.put = function (obj) {\r\n    var pool = this._pool;\r\n    if (this.count < pool.length) {\r\n        if (this._cleanup && this._cleanup(obj) === false) {\r\n            return;\r\n        }\r\n        pool[this.count] = obj;\r\n        ++this.count;\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Resize the pool.\r\n * !#zh \r\n * @method resize\r\n */\r\nPool.prototype.resize = function (length) {\r\n    if (length >= 0) {\r\n        this._pool.length = length;\r\n        if (this.count > length) {\r\n            this.count = length;\r\n        }\r\n    }\r\n};\r\n\r\njs.Pool = Pool;\r\n\r\n//\r\n\r\ncc.js = js;\r\n\r\nmodule.exports = js;\r\n\r\n// fix submodule pollute ...\r\n/**\r\n * @submodule cc\r\n */\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('./js');\r\n\r\n//  CCClass \r\n\r\nvar SerializableAttrs = {\r\n    url: {\r\n        canUsedInGet: true\r\n    },\r\n    default: {},\r\n    serializable: {},\r\n    editorOnly: {},\r\n    formerlySerializedAs: {}\r\n};\r\n\r\nvar TYPO_TO_CORRECT_DEV = CC_DEV && {\r\n    extend: 'extends',\r\n    property: 'properties',\r\n    static: 'statics',\r\n    constructor: 'ctor'\r\n};\r\n\r\n//  notify \r\nfunction parseNotify (val, propName, notify, properties) {\r\n    if (val.get || val.set) {\r\n        if (CC_DEV) {\r\n            cc.warnID(5500);\r\n        }\r\n        return;\r\n    }\r\n    if (val.hasOwnProperty('default')) {\r\n        //  getter/setter \r\n        //  _ property  visible: false\r\n        var newKey = \"_N$\" + propName;\r\n\r\n        val.get = function () {\r\n            return this[newKey];\r\n        };\r\n        val.set = function (value) {\r\n            var oldValue = this[newKey];\r\n            this[newKey] = value;\r\n            notify.call(this, oldValue);\r\n        };\r\n\r\n        var newValue = {};\r\n        properties[newKey] = newValue;\r\n        // getnewValue\r\n        for (var attr in SerializableAttrs) {\r\n            var v = SerializableAttrs[attr];\r\n            if (val.hasOwnProperty(attr)) {\r\n                newValue[attr] = val[attr];\r\n                if (!v.canUsedInGet) {\r\n                    delete val[attr];\r\n                }\r\n            }\r\n        }\r\n    }\r\n    else if (CC_DEV) {\r\n        cc.warnID(5501);\r\n    }\r\n}\r\n\r\nfunction checkUrl (val, className, propName, url) {\r\n    if (Array.isArray(url)) {\r\n        if (url.length > 0) {\r\n            url = url[0];\r\n        }\r\n        else if (CC_EDITOR) {\r\n            return cc.errorID(5502, className, propName);\r\n        }\r\n    }\r\n    if (CC_EDITOR) {\r\n        if (url == null) {\r\n            return cc.warnID(5503, className, propName);\r\n        }\r\n        if (typeof url !== 'function' || !js.isChildClassOf(url, cc.RawAsset)) {\r\n            return cc.errorID(5504, className, propName);\r\n        }\r\n        if (url === cc.RawAsset) {\r\n            cc.warn('Please change the definition of property \\'%s\\' in class \\'%s\\'. Starting from v1.10,\\n' +\r\n                    'the use of declaring a property in CCClass as a URL has been deprecated.\\n' +\r\n                    'For example, if property is cc.RawAsset, the previous definition is:\\n' +\r\n                    '    %s: cc.RawAsset,\\n' +\r\n                    '    // or:\\n' +\r\n                    '    %s: {\\n' +\r\n                    '      url: cc.RawAsset,\\n' +\r\n                    '      default: \"\"\\n' +\r\n                    '    },\\n' +\r\n                    '    // and the original method to get url is:\\n' +\r\n                    '    `this.%s`\\n' +\r\n                    'Now it should be changed to:\\n' +\r\n                    '    %s: {\\n' +\r\n                    '      type: cc.Asset,     // use \\'type:\\' to define Asset object directly\\n' +\r\n                    '      default: null,      // object\\'s default value is null\\n' +\r\n                    '    },\\n' +\r\n                    '    // and you must get the url by using:\\n' +\r\n                    '    `this.%s.nativeUrl`\\n' +\r\n                    '(This helps us to successfully refactor all RawAssets at v2.0, ' +\r\n                    'sorry for the inconvenience. \\uD83D\\uDE30 )',\r\n                    propName, className, propName, propName, propName, propName, propName);\r\n        }\r\n        else if (js.isChildClassOf(url, cc.Asset)) {\r\n            if (cc.RawAsset.wasRawAssetType(url)) {\r\n                if (!val._short) {\r\n                    cc.warn('Please change the definition of property \\'%s\\' in class \\'%s\\'. Starting from v1.10,\\n' +\r\n                            'the use of declaring a property in CCClass as a URL has been deprecated.\\n' +\r\n                            'For example, if property is Texture2D, the previous definition is:\\n' +\r\n                            '    %s: cc.Texture2D,\\n' +\r\n                            '    // or:\\n' +\r\n                            '    %s: {\\n' +\r\n                            '      url: cc.Texture2D,\\n' +\r\n                            '      default: \"\"\\n' +\r\n                            '    },\\n' +\r\n                            'Now it should be changed to:\\n' +\r\n                            '    %s: {\\n' +\r\n                            '      type: cc.Texture2D, // use \\'type:\\' to define Texture2D object directly\\n' +\r\n                            '      default: null,      // object\\'s default value is null\\n' +\r\n                            '    },\\n' +\r\n                            '(This helps us to successfully refactor all RawAssets at v2.0, ' +\r\n                            'sorry for the inconvenience. \\uD83D\\uDE30 )',\r\n                            propName, className, propName, propName, propName);\r\n                }\r\n            }\r\n            else {\r\n                return cc.errorID(5505, className, propName, cc.js.getClassName(url));\r\n            }\r\n        }\r\n        if (val.type) {\r\n            return cc.warnID(5506, className, propName);\r\n        }\r\n    }\r\n    val.type = url;\r\n}\r\n\r\nfunction parseType (val, type, className, propName) {\r\n    if (Array.isArray(type)) {\r\n        if (CC_EDITOR && 'default' in val) {\r\n            var isArray = require('./CCClass').isArray;   // require lazily to avoid circular require() calls\r\n            if (!isArray(val.default)) {\r\n                cc.warnID(5507, className, propName);\r\n            }\r\n        }\r\n        if (type.length > 0) {\r\n            if (cc.RawAsset.isRawAssetType(type[0])) {\r\n                val.url = type[0];\r\n                delete val.type;\r\n                return;\r\n            }\r\n            else {\r\n                val.type = type = type[0];\r\n            }\r\n        }\r\n        else {\r\n            return cc.errorID(5508, className, propName);\r\n        }\r\n    }\r\n    if (CC_EDITOR) {\r\n        if (typeof type === 'function') {\r\n            if (cc.RawAsset.isRawAssetType(type)) {\r\n                cc.warnID(5509, className, propName,\r\n                    js.getClassName(type));\r\n            }\r\n        }\r\n        else if (type === 'Number') {\r\n            cc.warnID(5510, className, propName);\r\n        }\r\n        else if (type == null) {\r\n            cc.warnID(5511, className, propName);\r\n        }\r\n    }\r\n}\r\n\r\nfunction postCheckType (val, type, className, propName) {\r\n    if (CC_EDITOR && typeof type === 'function') {\r\n        if (cc.Class._isCCClass(type) && val.serializable !== false && !js._getClassId(type, false)) {\r\n            cc.warnID(5512, className, propName, className, propName);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getBaseClassWherePropertyDefined_DEV (propName, cls) {\r\n    if (CC_DEV) {\r\n        var res;\r\n        for (; cls && cls.__props__ && cls.__props__.indexOf(propName) !== -1; cls = cls.$super) {\r\n            res = cls;\r\n        }\r\n        if (!res) {\r\n            cc.error('unknown error');\r\n        }\r\n        return res;\r\n    }\r\n}\r\n\r\nexports.getFullFormOfProperty = function (options, propname_dev, classname_dev) {\r\n    var isLiteral = options && options.constructor === Object;\r\n    if ( !isLiteral ) {\r\n        if (Array.isArray(options) && options.length > 0) {\r\n            var type = options[0];\r\n            if (CC_DEV && cc.RawAsset.wasRawAssetType(type)) {\r\n                // deprecate `myProp: [cc.Texture2D]` since 1.10\r\n                cc.warn('Please change the definition of property \\'%s\\' in class \\'%s\\'. Starting from v1.10,\\n' +\r\n                        'properties in CCClass can not be abbreviated if they are of type RawAsset.\\n' +\r\n                        'Please use the complete form.\\n' +\r\n                        'For example, if property is Texture2D\\'s url array, the previous definition is:\\n' +\r\n                        '    %s: [cc.Texture2D],\\n' +\r\n                        'Now it should be changed to:\\n' +\r\n                        '    %s: {\\n' +\r\n                        '      type: cc.Texture2D, // use \\'type:\\' to define an array of Texture2D objects\\n' +\r\n                        '      default: []\\n' +\r\n                        '    },\\n' +\r\n                        '(This helps us to successfully refactor all RawAssets at v2.0, ' +\r\n                        'sorry for the inconvenience. \\uD83D\\uDE30 )',\r\n                        propname_dev, classname_dev, propname_dev, propname_dev);\r\n                return {\r\n                    default: [],\r\n                    url: options,\r\n                    _short: true\r\n                };\r\n            }\r\n            return {\r\n                default: [],\r\n                type: options,\r\n                _short: true\r\n            };\r\n        }\r\n        else if (typeof options === 'function') {\r\n            var type = options;\r\n            if (!cc.RawAsset.isRawAssetType(type)) {\r\n                if (cc.RawAsset.wasRawAssetType(type)) {\r\n                    // deprecate `myProp: cc.Texture2D` since 1.10\r\n                    if (CC_DEV) {\r\n                        cc.warn('Please change the definition of property \\'%s\\' in class \\'%s\\'. Starting from v1.10,\\n' +\r\n                                'properties in CCClass can not be abbreviated if they are of type RawAsset.\\n' +\r\n                                'Please use the complete form.\\n' +\r\n                                'For example, if the type is Texture2D, the previous definition is:\\n' +\r\n                                '    %s: cc.Texture2D,\\n' +\r\n                                'Now it should be changed to:\\n' +\r\n                                '    %s: {\\n' +\r\n                                '      type: cc.Texture2D // use \\'type:\\' to define Texture2D object directly\\n' +\r\n                                '      default: null,     // object\\'s default value is null\\n' +\r\n                                '    },\\n' +\r\n                                '(This helps us to successfully refactor all RawAssets at v2.0, ' +\r\n                                'sorry for the inconvenience. \\uD83D\\uDE30 )',\r\n                                propname_dev, classname_dev, propname_dev, propname_dev);\r\n                    }\r\n                }\r\n                else {\r\n                    return {\r\n                        default: js.isChildClassOf(type, cc.ValueType) ? new type() : null,\r\n                        type: type,\r\n                        _short: true\r\n                    };\r\n                }\r\n            }\r\n            return {\r\n                default: '',\r\n                url: type,\r\n                _short: true\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                default: options,\r\n                _short: true\r\n            };\r\n        }\r\n    }\r\n    return null;\r\n};\r\n\r\nexports.preprocessAttrs = function (properties, className, cls, es6) {\r\n    for (var propName in properties) {\r\n        var val = properties[propName];\r\n        var fullForm = exports.getFullFormOfProperty(val, propName, className);\r\n        if (fullForm) {\r\n            val = properties[propName] = fullForm;\r\n        }\r\n        if (val) {\r\n            if (CC_EDITOR) {\r\n                if ('default' in val) {\r\n                    if (val.get) {\r\n                        cc.errorID(5513, className, propName);\r\n                    }\r\n                    else if (val.set) {\r\n                        cc.errorID(5514, className, propName);\r\n                    }\r\n                    else if (cc.Class._isCCClass(val.default)) {\r\n                        val.default = null;\r\n                        cc.errorID(5515, className, propName);\r\n                    }\r\n                }\r\n                else if (!val.get && !val.set) {\r\n                    var maybeTypeScript = es6;\r\n                    if (!maybeTypeScript) {\r\n                        cc.errorID(5516, className, propName);\r\n                    }\r\n                }\r\n            }\r\n            if (CC_DEV && !val.override && cls.__props__.indexOf(propName) !== -1) {\r\n                // check override\r\n                var baseClass = js.getClassName(getBaseClassWherePropertyDefined_DEV(propName, cls));\r\n                cc.warnID(5517, className, propName, baseClass, propName);\r\n            }\r\n            var notify = val.notify;\r\n            if (notify) {\r\n                if (CC_DEV && es6) {\r\n                    cc.error('not yet support notify attribute for ES6 Classes');\r\n                }\r\n                else {\r\n                    parseNotify(val, propName, notify, properties);\r\n                }\r\n            }\r\n\r\n            if ('type' in val) {\r\n                parseType(val, val.type, className, propName);\r\n            }\r\n\r\n            if ('url' in val) {\r\n                checkUrl(val, className, propName, val.url);\r\n            }\r\n\r\n            if ('type' in val) {\r\n                postCheckType(val, val.type, className, propName);\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nif (CC_DEV) {\r\n    const CALL_SUPER_DESTROY_REG_DEV = /\\b\\._super\\b|destroy\\s*\\.\\s*call\\s*\\(\\s*\\w+\\s*[,|)]/;\r\n    exports.doValidateMethodWithProps_DEV = function (func, funcName, className, cls, base) {\r\n        if (cls.__props__ && cls.__props__.indexOf(funcName) >= 0) {\r\n            // find class that defines this method as a property\r\n            var baseClassName = js.getClassName(getBaseClassWherePropertyDefined_DEV(funcName, cls));\r\n            cc.errorID(3648, className, funcName, baseClassName);\r\n            return false;\r\n        }\r\n        if (funcName === 'destroy' &&\r\n            js.isChildClassOf(base, cc.Component) &&\r\n            !CALL_SUPER_DESTROY_REG_DEV.test(func)\r\n        ) {\r\n            cc.error(`Overwriting '${funcName}' function in '${className}' class without calling super is not allowed. Call the super function in '${funcName}' please.`);\r\n        }\r\n    };\r\n}\r\n\r\nexports.validateMethodWithProps = function (func, funcName, className, cls, base) {\r\n    if (CC_DEV && funcName === 'constructor') {\r\n        cc.errorID(3643, className);\r\n        return false;\r\n    }\r\n    if (typeof func === 'function' || func === null) {\r\n        if (CC_DEV) {\r\n            this.doValidateMethodWithProps_DEV(func, funcName, className, cls, base);\r\n        }\r\n    }\r\n    else {\r\n        if (CC_DEV) {\r\n            if (func === false && base && base.prototype) {\r\n                // check override\r\n                var overrided = base.prototype[funcName];\r\n                if (typeof overrided === 'function') {\r\n                    var baseFuc = js.getClassName(base) + '.' + funcName;\r\n                    var subFuc = className + '.' + funcName;\r\n                    cc.warnID(3624, subFuc, baseFuc, subFuc, subFuc);\r\n                }\r\n            }\r\n            var correct = TYPO_TO_CORRECT_DEV[funcName];\r\n            if (correct) {\r\n                cc.warnID(3621, className, funcName, correct);\r\n            }\r\n            else if (func) {\r\n                cc.errorID(3622, className, funcName);\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar requiringFrames = [];  // the requiring frame infos\r\n\r\ncc._RF = {\r\n    push: function (module, uuid, script) {\r\n        if (script === undefined) {\r\n            script = uuid;\r\n            uuid = '';\r\n        }\r\n        requiringFrames.push({\r\n            uuid: uuid,\r\n            script: script,\r\n            module: module,\r\n            exports: module.exports,    // original exports\r\n            beh: null\r\n        });\r\n    },\r\n    pop: function () {\r\n        var frameInfo = requiringFrames.pop();\r\n        // check exports\r\n        var module = frameInfo.module;\r\n        var exports = module.exports;\r\n        if (exports === frameInfo.exports) {\r\n            for (var anyKey in exports) {\r\n                // exported\r\n                return;\r\n            }\r\n            // auto export component\r\n            module.exports = exports = frameInfo.cls;\r\n        }\r\n    },\r\n    peek: function () {\r\n        return requiringFrames[requiringFrames.length - 1];\r\n    }\r\n};\r\n\r\nif (CC_EDITOR) {\r\n    cc._RF.reset = function () {\r\n        requiringFrames = [];\r\n    };\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * @class url\r\n * @static\r\n */\r\ncc.url = {\r\n\r\n    /**\r\n     * The base url of raw assets.\r\n     * @property {Object} _rawAssets\r\n     * @private\r\n     * @readOnly\r\n     */\r\n    _rawAssets: '',\r\n    \r\n    normalize: function (url) {\r\n        if (url) {\r\n            if (url.charCodeAt(0) === 46 && url.charCodeAt(1) === 47) {\r\n                // strip './'\r\n                url = url.slice(2);\r\n            }\r\n            else if (url.charCodeAt(0) === 47) {\r\n                // strip '/'\r\n                url = url.slice(1);\r\n            }\r\n        }\r\n        return url;\r\n    },\r\n\r\n    /**\r\n     * Returns the url of raw assets, you will only need this if the raw asset is inside the \"resources\" folder.\r\n     * \r\n     * @method raw\r\n     * @param {String} url\r\n     * @return {String}\r\n     * @example {@link cocos2d/core/platform/url/raw.js}\r\n     */\r\n    raw: function (url) {\r\n        if (CC_EDITOR && !this._rawAssets) {\r\n            cc.errorID(7000);\r\n            return '';\r\n        }\r\n\r\n        url = this.normalize(url);\r\n\r\n        if ( !url.startsWith('resources/') ) {\r\n            cc.errorID(CC_EDITOR ? 7001 : 7002, url);\r\n        }\r\n        else {\r\n            // Compatible with versions lower than 1.10\r\n            var uuid = cc.loader._getResUuid(url.slice(10), cc.Asset, true);\r\n            if (uuid) {\r\n                return cc.AssetLibrary.getLibUrlNoExt(uuid, true) + cc.path.extname(url);\r\n            }\r\n        }\r\n        \r\n        return this._rawAssets + url;\r\n    },\r\n\r\n    _init: function (assets) {\r\n        this._rawAssets = cc.path.stripSep(assets) + '/';\r\n    }\r\n};\r\n\r\nmodule.exports = cc.url;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n// TODO - merge with misc.js\r\n\r\nmodule.exports = {\r\n    contains: function (refNode, otherNode) {\r\n        if(typeof refNode.contains == 'function'){\r\n            return refNode.contains(otherNode);\r\n        }else if(typeof refNode.compareDocumentPosition == 'function' ) {\r\n            return !!(refNode.compareDocumentPosition(otherNode) & 16);\r\n        }else {\r\n            var node = otherNode.parentNode;\r\n            if (node) {\r\n                do {\r\n                    if (node === refNode) {\r\n                        return true;\r\n                    } else {\r\n                        node = node.parentNode;\r\n                    }\r\n                } while (node !==null);\r\n            }\r\n            return false;\r\n        }\r\n    },\r\n\r\n    isDomNode: typeof window === 'object' && (typeof Node === 'function' ?\r\n        function (obj) {\r\n            // If \"TypeError: Right-hand side of 'instanceof' is not callback\" is thrown,\r\n            // it should because window.Node was overwritten.\r\n            return obj instanceof Node;\r\n        } :\r\n        function (obj) {\r\n            return obj &&\r\n                   typeof obj === 'object' &&\r\n                   typeof obj.nodeType === 'number' &&\r\n                   typeof obj.nodeName === 'string';\r\n        }\r\n    ),\r\n\r\n    callInNextTick: CC_EDITOR ?\r\n        function (callback, p1, p2) {\r\n            if (callback) {\r\n                process.nextTick(function () {\r\n                    callback(p1, p2);\r\n                });\r\n            }\r\n        }\r\n        :\r\n        (\r\n            \r\n            function (callback, p1, p2) {\r\n                if (callback) {\r\n                    setTimeout(function () {\r\n                        callback(p1, p2);\r\n                    }, 0);\r\n                }\r\n            }\r\n        )\r\n};\r\n\r\nif (CC_DEV) {\r\n    ///**\r\n    // * @param {Object} obj\r\n    // * @return {Boolean} is {} ?\r\n    // */\r\n    module.exports.isPlainEmptyObj_DEV = function (obj) {\r\n        if (!obj || obj.constructor !== Object) {\r\n            return false;\r\n        }\r\n        // jshint ignore: start\r\n        for (var k in obj) {\r\n            return false;\r\n        }\r\n        // jshint ignore: end\r\n        return true;\r\n    };\r\n    module.exports.cloneable_DEV = function (obj) {\r\n        return obj &&\r\n               typeof obj.clone === 'function' &&\r\n               ( (obj.constructor && obj.constructor.prototype.hasOwnProperty('clone')) || obj.hasOwnProperty('clone') );\r\n    };\r\n}\r\n\r\nif (CC_TEST) {\r\n    // editor mocks using in unit tests\r\n    if (typeof Editor === 'undefined') {\r\n        Editor = {\r\n            UuidUtils: {\r\n                NonUuidMark: '.',\r\n                uuid: function () {\r\n                    return '' + ((new Date()).getTime() + Math.random());\r\n                }\r\n            }\r\n        };\r\n    }\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n// predefine some modules for cocos\r\nrequire('./platform/js');\r\nrequire('./value-types');\r\nrequire('./utils');\r\nrequire('./platform/CCInputManager');\r\nrequire('./platform/CCInputExtension');\r\nrequire('./event');\r\nrequire('./platform/CCSys');\r\nrequire('./platform/CCMacro');\r\nrequire('./load-pipeline');\r\nrequire('./CCDirector');\r\nrequire('./renderer');\r\n\r\nif (!(CC_EDITOR && Editor.isMainProcess)) {\r\n    require('./platform/CCView');\r\n    require('./platform/CCScreen');\r\n    require('./CCScheduler');\r\n    require('./event-manager');\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../platform/js');\r\nconst RenderFlow = require('../render-flow');\r\nrequire('./renderers');\r\n\r\nlet RenderComponentWalker = function (device, defaultCamera) {\r\n    this._device = device;\r\n    // let vx = this._device._vx;\r\n    // let vy = this._device._vy;\r\n    // let vh = this._device._vh;\r\n    this._camera = defaultCamera;\r\n\r\n    this.parentOpacity = 1;\r\n    this.parentOpacityDirty = 0;\r\n    this.worldMatDirty = 0;\r\n    \r\n    RenderFlow.init(this);\r\n};\r\n\r\nRenderComponentWalker.prototype = {\r\n    constructor: RenderComponentWalker,\r\n    \r\n    reset() {},\r\n\r\n    _commitComp (comp, assembler) {\r\n        let ctx = this._device._ctx;\r\n        let cam = this._camera;\r\n        ctx.setTransform(cam.a, cam.b, cam.c, cam.d, cam.tx, cam.ty);\r\n        ctx.scale(1, -1);\r\n        assembler.draw(ctx, comp);\r\n    },\r\n\r\n    visit (scene) {\r\n        let ctx = this._device._ctx;\r\n        let canvas = this._device._canvas;\r\n        let color = cc.Camera.main.backgroundColor;\r\n        let rgba = `rgba(${color.r}, ${color.g}, ${color.b}, ${color.a/255})`;\r\n        ctx.fillStyle = rgba;\r\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n        this._device._stats.drawcalls = 0;\r\n\r\n        RenderFlow.render(scene);\r\n    }\r\n};\r\n\r\nmodule.exports = RenderComponentWalker;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nlet ForwardRenderer = function () {\r\n}\r\n\r\nForwardRenderer.prototype = {\r\n    constructor: ForwardRenderer,\r\n\r\n    _reset () {\r\n\r\n    },\r\n\r\n    render () {\r\n\r\n    }\r\n};\r\n\r\nmodule.exports = ForwardRenderer;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nmodule.exports = {\r\n    ForwardRenderer: require('./forward-renderer'),\r\n    RenderComponentWalker: require('./canvas-render-walker'),\r\n    _renderers: require('./renderers')\r\n};","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nlet js = require('../../../platform/js');\r\n\r\nlet Sprite = require('../../../components/CCSprite');\r\nlet Label = require('../../../components/CCLabel');\r\nlet Mask = require('../../../components/CCMask');\r\nlet Graphics = require('../../../graphics/graphics');\r\n\r\nlet spriteRenderer = require('./sprite');\r\nlet labelRenderer = require('./label');\r\nlet graphicsRenderer = require('./graphics');\r\nlet maskRenderer = require('./mask');\r\n\r\nlet map = {};\r\nlet postMap = {};\r\n\r\nfunction addRenderer (Component, handler, postHandler) {\r\n    let name = js.getClassName(Component);\r\n    map[name] = handler;\r\n    if (postHandler) {\r\n        postMap[name] = postHandler;\r\n    }\r\n    Component._assembler = handler;\r\n    Component._postAssembler = postHandler;\r\n}\r\n\r\naddRenderer(Sprite, spriteRenderer);\r\naddRenderer(Label, labelRenderer);\r\nif (Mask) {\r\n    addRenderer(Mask, maskRenderer.beforeHandler, maskRenderer.afterHandler);\r\n}\r\nif (Graphics) {\r\n    addRenderer(Graphics, graphicsRenderer);\r\n}\r\n\r\nmodule.exports = {\r\n    map,\r\n    postMap,\r\n    addRenderer\r\n};","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst bmfontUtils = require('../../../utils/label/bmfont')\r\nconst js = require('../../../../platform/js');\r\nconst utils = require('../utils');\r\n\r\nmodule.exports = js.addon({\r\n    createData (comp) {\r\n        return comp.requestRenderData();\r\n    },\r\n\r\n    appendQuad (renderData, texture, rect, rotated, x, y, scale) {\r\n        let dataOffset = renderData.dataLength;\r\n        \r\n        renderData.dataLength += 2;\r\n\r\n        let data = renderData._data;\r\n        let texw = texture.width,\r\n            texh = texture.height;\r\n\r\n        let rectWidth = rect.width,\r\n            rectHeight = rect.height;\r\n\r\n        let l, b, r, t;\r\n        if (!rotated) {\r\n            l = rect.x;\r\n            r = rect.x + rectWidth;\r\n            b = rect.y;\r\n            t = rect.y + rectHeight;\r\n\r\n            data[dataOffset].u = l;\r\n            data[dataOffset].v = b;\r\n            data[dataOffset+1].u = r;\r\n            data[dataOffset+1].v = t;\r\n        } else {\r\n            l = rect.x;\r\n            r = rect.x + rectHeight;\r\n            b = rect.y;\r\n            t = rect.y + rectWidth;\r\n\r\n            data[dataOffset].u = l;\r\n            data[dataOffset].v = t;\r\n            data[dataOffset+1].u = l;\r\n            data[dataOffset+1].v = b;\r\n        }\r\n\r\n        data[dataOffset].x = x;\r\n        data[dataOffset].y = y - rectHeight * scale;\r\n        data[dataOffset+1].x = x + rectWidth * scale;\r\n        data[dataOffset+1].y = y;\r\n    },\r\n\r\n    draw (ctx, comp) {\r\n        let node = comp.node;\r\n        // Transform\r\n        let matrix = node._worldMatrix;\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n        ctx.transform(a, b, c, d, tx, ty);\r\n        ctx.scale(1, -1);\r\n\r\n        // TODO: handle blend function\r\n\r\n        // opacity\r\n        ctx.globalAlpha = node.opacity / 255;\r\n\r\n        let tex = comp._texture,\r\n            data = comp._renderData._data;\r\n\r\n        let image = tex.getHtmlElementObj();\r\n\r\n        for (let i = 0, l = data.length; i < l; i+=2) {\r\n            let x = data[i].x;\r\n            let y = data[i].y;\r\n            let w = data[i+1].x - x;\r\n            let h = data[i+1].y - y;\r\n            y = - y - h;\r\n\r\n            let sx = data[i].u;\r\n            let sy = data[i].v;\r\n            let sw = data[i+1].u - sx;\r\n            let sh = data[i+1].v - sy;\r\n\r\n            ctx.drawImage(image, \r\n                sx, sy, sw, sh,\r\n                x, y, w, h);\r\n        }\r\n        \r\n        return 1;\r\n    }\r\n}, bmfontUtils);\r\n","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst ttf = require('./ttf');\r\nconst bmfont = require('./bmfont');\r\n\r\nmodule.exports = {\r\n    getAssembler (comp) {\r\n        let assembler = ttf;\r\n        \r\n        if (comp.font instanceof cc.BitmapFont) {\r\n            assembler = bmfont;\r\n        }\r\n\r\n        return assembler;\r\n    },\r\n\r\n    createData (comp) {\r\n        return comp._assembler.createData(comp);\r\n    },\r\n\r\n    draw (ctx, comp) {\r\n        // Check whether need to render\r\n        if (!comp._texture) {\r\n            return 0;\r\n        }\r\n\r\n        let assembler = comp._assembler;\r\n        if (!assembler) return 0;\r\n        \r\n        assembler.updateRenderData(comp);\r\n        return assembler.draw(ctx, comp);\r\n    }\r\n};","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst ttfUtils = require('../../../utils/label/ttf')\r\nconst js = require('../../../../platform/js');\r\nconst utils = require('../utils');\r\n\r\nmodule.exports = js.addon({\r\n    createData (sprite) {\r\n        let renderData = sprite.requestRenderData();\r\n        // 0 for bottom left, 1 for top right\r\n        renderData.dataLength = 2;\r\n        return renderData;\r\n    },\r\n\r\n    _updateVerts (comp) {\r\n        let renderData = comp._renderData;\r\n\r\n        let node = comp.node,\r\n            width = node.width,\r\n            height = node.height,\r\n            appx = node.anchorX * width,\r\n            appy = node.anchorY * height;\r\n\r\n        let data = renderData._data;\r\n        data[0].x = -appx;\r\n        data[0].y = -appy;\r\n        data[1].x = width - appx;\r\n        data[1].y = height - appy;\r\n    },\r\n\r\n    _updateTexture (comp) {\r\n        ttfUtils._updateTexture(comp);\r\n        utils.dropColorizedImage(comp._texture, comp.node.color);\r\n    },\r\n\r\n    draw (ctx, comp) {\r\n        let node = comp.node;\r\n        // Transform\r\n        let matrix = node._worldMatrix;\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n        ctx.transform(a, b, c, d, tx, ty);\r\n        ctx.scale(1, -1);\r\n\r\n        // TODO: handle blend function\r\n\r\n        // opacity\r\n        ctx.globalAlpha = node.opacity / 255;\r\n\r\n        let tex = comp._texture,\r\n            data = comp._renderData._data;\r\n\r\n        let image = tex.getHtmlElementObj();\r\n\r\n        let x = data[0].x;\r\n        let y = data[0].y;\r\n        let w = data[1].x - x;\r\n        let h = data[1].y - y;\r\n        y = - y - h;\r\n\r\n        ctx.drawImage(image, x, y, w, h);\r\n        return 1;\r\n    }\r\n}, ttfUtils);\r\n","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Mask = require('../../../components/CCMask');\r\nconst graphicsHandler = require('./graphics');\r\n\r\nlet beforeHandler = {\r\n    updateRenderData (comp) {},\r\n\r\n    draw (ctx, mask) {\r\n        ctx.save();\r\n\r\n        // draw stencil\r\n        graphicsHandler.draw(ctx, mask._graphics);\r\n\r\n        ctx.clip();\r\n    }\r\n};\r\n\r\nlet afterHandler = {\r\n    updateRenderData (comp) {},\r\n    draw (ctx, mask) {\r\n        ctx.restore();\r\n    }\r\n};\r\n\r\nmodule.exports = {\r\n    beforeHandler,\r\n    afterHandler\r\n};","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Sprite = require('../../../../components/CCSprite');\r\nconst SpriteType = Sprite.Type;\r\nconst FillType = Sprite.FillType;\r\nlet simple = require('./simple');\r\nlet sliced = require('./sliced');\r\nlet tiled = require('./tiled');\r\n\r\nmodule.exports = {\r\n    getAssembler: function (sprite) {\r\n        switch (sprite.type) {\r\n            case SpriteType.SIMPLE:\r\n                return simple;\r\n            case SpriteType.SLICED:\r\n                return sliced;\r\n            case SpriteType.TILED:\r\n                return tiled;\r\n            case SpriteType.FILLED:\r\n                if (sprite._fillType === FillType.RADIAL) {\r\n                    return null;\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n        }\r\n    },\r\n\r\n    createData (sprite) {\r\n        return sprite._assembler.createData(sprite);\r\n    }\r\n};","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst utils = require('../utils');\r\n\r\nlet renderer = {\r\n\r\n    createData (sprite) {\r\n        let renderData = sprite.requestRenderData();\r\n        // 0 for bottom left, 1 for top right\r\n        renderData.dataLength = 2;\r\n        return renderData;\r\n    },\r\n\r\n    updateRenderData (sprite) {\r\n        if (!sprite._material) {\r\n            sprite._activateMaterial();\r\n        }\r\n\r\n        let renderData = sprite._renderData;\r\n        if (renderData.uvDirty) {\r\n            this.updateUVs(sprite);\r\n        }\r\n\r\n        if (renderData.vertDirty) {\r\n            this.updateVerts(sprite);\r\n        }\r\n    },\r\n\r\n    updateUVs (sprite) {\r\n        let frame = sprite.spriteFrame;\r\n        let renderData = sprite._renderData;\r\n        let data = renderData._data;\r\n        let rect = frame._rect;\r\n        let texture = frame._texture;\r\n        \r\n        if (frame._rotated) {\r\n            let l = rect.x;\r\n            let r = rect.height;\r\n            let b = rect.y;\r\n            let t = rect.width;\r\n            data[0].u = l;\r\n            data[0].v = t;\r\n            data[1].u = r;\r\n            data[1].v = b;\r\n        }\r\n        else {\r\n            let l = rect.x;\r\n            let r = rect.width;\r\n            let b = rect.y;\r\n            let t = rect.height;\r\n            data[0].u = l;\r\n            data[0].v = b;\r\n            data[1].u = r;\r\n            data[1].v = t;\r\n        }\r\n        \r\n        renderData.uvDirty = false;\r\n    },\r\n\r\n    updateVerts (sprite) {\r\n        let renderData = sprite._renderData,\r\n            node = sprite.node,\r\n            data = renderData._data,\r\n            cw = node.width, ch = node.height,\r\n            appx = node.anchorX * cw, appy = node.anchorY * ch,\r\n            l, b, r, t;\r\n        if (sprite.trim) {\r\n            l = -appx;\r\n            b = -appy;\r\n            r = cw;\r\n            t = ch;\r\n        }\r\n        else {\r\n            let frame = sprite.spriteFrame,\r\n                ow = frame._originalSize.width, oh = frame._originalSize.height,\r\n                rw = frame._rect.width, rh = frame._rect.height,\r\n                offset = frame._offset,\r\n                scaleX = cw / ow, scaleY = ch / oh;\r\n            let trimLeft = offset.x + (ow - rw) / 2;\r\n            let trimRight = offset.x - (ow - rw) / 2;\r\n            let trimBottom = offset.y + (oh - rh) / 2;\r\n            let trimTop = offset.y - (oh - rh) / 2;\r\n            l = trimLeft * scaleX - appx;\r\n            b = trimBottom * scaleY - appy;\r\n            r = cw;\r\n            t = ch;\r\n        }\r\n        \r\n        data[0].x = l;\r\n        data[0].y = b;\r\n        data[1].x = r;\r\n        data[1].y = t;\r\n\r\n        renderData.vertDirty = false;\r\n    },\r\n\r\n    draw (ctx, comp) {\r\n        let node = comp.node;\r\n        // Transform\r\n        let matrix = node._worldMatrix;\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n        ctx.transform(a, b, c, d, tx, ty);\r\n        ctx.scale(1, -1);\r\n\r\n        // TODO: handle blend function\r\n\r\n        // opacity\r\n        ctx.globalAlpha = node.opacity / 255;\r\n\r\n        let tex = comp._spriteFrame._texture,\r\n            data = comp._renderData._data;\r\n\r\n        let image = utils.getColorizedImage(tex, node._color);\r\n\r\n        let x = data[0].x;\r\n        let y = data[0].y;\r\n        let w = data[1].x;\r\n        let h = data[1].y;\r\n        y = - y - h;\r\n\r\n        let sx = data[0].u;\r\n        let sy = data[0].v;\r\n        let sw = data[1].u;\r\n        let sh = data[1].v;\r\n\r\n        ctx.drawImage(image,\r\n            sx, sy, sw, sh,\r\n            x, y, w, h);\r\n        return 1;\r\n    }\r\n};\r\n\r\nmodule.exports = renderer;","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst utils = require('../utils');\r\nconst simple = require('./simple');\r\n\r\nlet renderer = {\r\n    createData (sprite) {\r\n        let renderData = sprite.requestRenderData();\r\n        // 4 rows & cols\r\n        renderData.dataLength = 4;\r\n        return renderData;\r\n    },\r\n\r\n    updateRenderData: simple.updateRenderData,\r\n    \r\n    updateUVs (sprite) {\r\n        let frame = sprite.spriteFrame;\r\n        let renderData = sprite._renderData;\r\n        let rect = frame._rect;\r\n        let texture = frame._texture;\r\n    \r\n        // caculate texture coordinate\r\n        let leftWidth = frame.insetLeft;\r\n        let rightWidth = frame.insetRight;\r\n        let centerWidth = rect.width - leftWidth - rightWidth;\r\n        let topHeight = frame.insetTop;\r\n        let bottomHeight = frame.insetBottom;\r\n        let centerHeight = rect.height - topHeight - bottomHeight;\r\n    \r\n        // uv computation should take spritesheet into account.\r\n        let data = renderData._data;\r\n        if (frame._rotated) {\r\n            data[0].u = rect.x;\r\n            data[1].u = bottomHeight + rect.x;\r\n            data[2].u = bottomHeight + centerHeight + rect.x;\r\n            data[3].u = rect.x + rect.height;\r\n            data[3].v = rect.y;\r\n            data[2].v = leftWidth + rect.y;\r\n            data[1].v = leftWidth + centerWidth + rect.y;\r\n            data[0].v = rect.y + rect.width;\r\n        }\r\n        else {\r\n            data[0].u = rect.x;\r\n            data[1].u = leftWidth + rect.x;\r\n            data[2].u = leftWidth + centerWidth + rect.x;\r\n            data[3].u = rect.x + rect.width;\r\n            data[3].v = rect.y;\r\n            data[2].v = topHeight + rect.y;\r\n            data[1].v = topHeight + centerHeight + rect.y;\r\n            data[0].v = rect.y + rect.height;\r\n        }\r\n        renderData.uvDirty = false;\r\n    },\r\n    \r\n    updateVerts (sprite) {\r\n        let renderData = sprite._renderData,\r\n            data = renderData._data,\r\n            node = sprite.node,\r\n            width = node.width, height = node.height,\r\n            appx = node.anchorX * width, appy = node.anchorY * height;\r\n    \r\n        let frame = sprite.spriteFrame;\r\n        let rect = frame._rect;\r\n        let leftWidth = frame.insetLeft;\r\n        let rightWidth = frame.insetRight;\r\n        let topHeight = frame.insetTop;\r\n        let bottomHeight = frame.insetBottom;\r\n    \r\n        let sizableWidth = width - leftWidth - rightWidth;\r\n        let sizableHeight = height - topHeight - bottomHeight;\r\n        let xScale = width / (leftWidth + rightWidth);\r\n        let yScale = height / (topHeight + bottomHeight);\r\n        xScale = (isNaN(xScale) || xScale > 1) ? 1 : xScale;\r\n        yScale = (isNaN(yScale) || yScale > 1) ? 1 : yScale;\r\n        sizableWidth = sizableWidth < 0 ? 0 : sizableWidth;\r\n        sizableHeight = sizableHeight < 0 ? 0 : sizableHeight;\r\n        \r\n        data[0].x = -appx;\r\n        data[0].y = -appy;\r\n        data[1].x = leftWidth * xScale - appx;\r\n        data[1].y = bottomHeight * yScale - appy;\r\n        data[2].x = data[1].x + sizableWidth;\r\n        data[2].y = data[1].y + sizableHeight;\r\n        data[3].x = width - appx;\r\n        data[3].y = height - appy;\r\n\r\n        renderData.vertDirty = false;\r\n    },\r\n\r\n    draw (ctx, comp) {\r\n        let node = comp.node;\r\n        // Transform\r\n        let matrix = node._worldMatrix;\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n        ctx.transform(a, b, c, d, tx, ty);\r\n        ctx.scale(1, -1);\r\n\r\n        // TODO: handle blend function\r\n\r\n        // opacity\r\n        ctx.globalAlpha = node.opacity / 255;\r\n\r\n        let tex = comp._spriteFrame._texture,\r\n            data = comp._renderData._data;\r\n\r\n        let image = utils.getColorizedImage(tex, node._color);\r\n\r\n        let drawCall = 0;\r\n        let off, ld, rd, td, bd,\r\n            x, y, w, h,\r\n            sx, sy, sw, sh;\r\n        for (let r = 0; r < 3; ++r) {\r\n            bd = data[r];\r\n            td = data[r+1];\r\n            for (let c = 0; c < 3; ++c) {\r\n                ld = data[c];\r\n                rd = data[c+1];\r\n                x = ld.x;\r\n                y = bd.y;\r\n                w = rd.x - x;\r\n                h = td.y - y;\r\n                y = - y - h;\r\n\r\n                sx = ld.u;\r\n                // invert texture because texture uv is in UI coordinates (origin at top left)\r\n                sy = td.v;\r\n                sw = rd.u - sx;\r\n                sh = bd.v - sy;\r\n\r\n                if (sw > 0 && sh > 0 && w > 0 && h > 0) {\r\n                    ctx.drawImage(image,\r\n                        sx, sy, sw, sh,\r\n                        x, y, w, h);\r\n                    drawCall++;\r\n                }\r\n            }\r\n        }\r\n        return drawCall;\r\n    }\r\n};\r\n\r\nmodule.exports = renderer;","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst utils = require('../utils');\r\nconst simple = require('./simple');\r\n\r\nlet renderer = {\r\n    createData (sprite) {\r\n        let renderData = sprite.requestRenderData();\r\n        return renderData;\r\n    },\r\n    \r\n    updateRenderData (sprite) {\r\n        if (!sprite._material) {\r\n            sprite._activateMaterial();\r\n        }\r\n    },\r\n\r\n    draw (ctx, sprite) {\r\n        let node = sprite.node;\r\n        // Transform\r\n        let matrix = node._worldMatrix;\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n        ctx.transform(a, b, c, d, tx, ty);\r\n        ctx.scale(1, -1);\r\n\r\n        // TODO: handle blend function\r\n\r\n        // opacity\r\n        ctx.globalAlpha = node.opacity / 255;\r\n\r\n        let frame = sprite.spriteFrame;\r\n        let rect = frame._rect;\r\n        let tex = frame._texture;\r\n        let sx = rect.x;\r\n        let sy = rect.y;\r\n        let sw = frame._rotated ? rect.height : rect.width;\r\n        let sh = frame._rotated ? rect.width : rect.height;\r\n\r\n        let image = utils.getFrameCache(tex, node._color, sx, sy, sw, sh);\r\n\r\n        let w = node.width,\r\n            h = node.height,\r\n            x = -node.anchorX * w,\r\n            y = -node.anchorY * h;\r\n        y = - y - h;\r\n\r\n        ctx.translate(x, y);\r\n        ctx.fillStyle = ctx.createPattern(image, 'repeat');\r\n        ctx.fillRect(0, 0, w, h);\r\n        return 1;\r\n    }\r\n}\r\n\r\nmodule.exports = renderer","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst WHITE = (255<<16) + (255<<8) + 255;\r\nconst MAX_CANVAS_COUNT = 32;\r\n\r\nfunction colorizedFrame (canvas, texture, color, sx, sy, sw, sh) {\r\n    if (cc.sys.browserType === cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB) {\r\n        return canvas;\r\n    }\r\n    let image = texture._image;\r\n\r\n    let ctx = canvas.getContext(\"2d\");\r\n    canvas.width = sw;\r\n    canvas.height = sh;\r\n\r\n    // Draw color\r\n    ctx.globalCompositeOperation = 'source-over';\r\n    ctx.fillStyle = 'rgb(' + color.r + ',' + color.g + ',' + color.b + ')';\r\n    ctx.fillRect(0, 0, sw, sh);\r\n\r\n    // Multiply color with texture\r\n    ctx.globalCompositeOperation = 'multiply';\r\n    ctx.drawImage(image, sx, sy, sw, sh, 0, 0, sw, sh);\r\n\r\n    // Clip out transparent pixels\r\n    ctx.globalCompositeOperation = \"destination-atop\";\r\n    ctx.drawImage(image, sx, sy, sw, sh, 0, 0, sw, sh);\r\n    return canvas;\r\n}\r\n\r\nlet canvasMgr = {\r\n    canvasMap: {},\r\n    canvasUsed: {},\r\n    canvasPool: [],\r\n\r\n    checking: false,\r\n\r\n    check () {\r\n        let exist = false;\r\n        for (let key in this.canvasUsed) {\r\n            exist = true;\r\n            if (!this.canvasUsed[key]) {\r\n                let canvas = this.canvasMap[key];\r\n                canvas.width = 0;\r\n                canvas.height = 0;\r\n                if (this.canvasPool.length < 32) {\r\n                    this.canvasPool.push(canvas);\r\n                }\r\n                delete this.canvasMap[key];\r\n                delete this.canvasUsed[key];\r\n            }\r\n            else {\r\n                this.canvasUsed[key] = false;\r\n            }\r\n        }\r\n        if (!exist) {\r\n            cc.director.off(cc.Director.EVENT_AFTER_DRAW, this.check, this);\r\n            this.checking = false;\r\n        }\r\n    },\r\n\r\n    startCheck () {\r\n        cc.director.on(cc.Director.EVENT_AFTER_DRAW, this.check, this);\r\n        this.checking = true;\r\n    },\r\n\r\n    getCanvas (key) {\r\n        this.canvasUsed[key] = true;\r\n        return this.canvasMap[key];\r\n    },\r\n\r\n    cacheCanvas (canvas, key) {\r\n        this.canvasMap[key] = canvas;\r\n        this.canvasUsed[key] = true;\r\n        if (!this.checking) {\r\n            this.startCheck();\r\n        }\r\n    },\r\n    \r\n    dropImage (key) {\r\n        if (this.canvasMap[key]) {\r\n            delete this.canvasMap[key];\r\n        }\r\n    }\r\n};\r\n\r\nmodule.exports = {\r\n    getColorizedImage (texture, color) {\r\n        if (!texture) return null;\r\n        if (texture.width === 0 || texture.height === 0)  return texture._image;\r\n\r\n        // original image\r\n        let cval = color._val & 0x00ffffff;\r\n        if (cval === WHITE) {\r\n            return texture._image;\r\n        }\r\n\r\n        // get from cache\r\n        let key = texture.url + cval;\r\n        let cache = canvasMgr.getCanvas(key);\r\n        if (!cache) {\r\n            cache = canvasMgr.canvasPool.pop() || document.createElement(\"canvas\");\r\n            colorizedFrame(cache, texture, color, 0, 0, texture.width, texture.height);\r\n            canvasMgr.cacheCanvas(cache, key);\r\n        }\r\n        return cache;\r\n    },\r\n\r\n    getFrameCache (texture, color, sx, sy, sw, sh) {\r\n        if (!texture || !texture.url || sx < 0 || sy < 0 || sw <= 0 || sh <= 0) {\r\n            return null;\r\n        }\r\n\r\n        let key = texture.url;\r\n        let generate = false;\r\n        let cval = color._val & 0x00ffffff;\r\n        if (cval !== WHITE) {\r\n            key += cval;\r\n            generate = true;\r\n        }\r\n        if (sx !== 0 || sy !== 0 && sw !== texture.width && sh !== texture.height) {\r\n            key += '_' + sx + '_' + sy + '_' + sw + '_' + sh;\r\n            generate = true;\r\n        }\r\n        if (!generate) {\r\n            return texture._image;\r\n        }\r\n        \r\n        // get from cache\r\n        let cache = canvasMgr.getCanvas(key);\r\n        if (!cache) {\r\n            cache = canvasMgr.canvasPool.pop() || document.createElement(\"canvas\");\r\n            colorizedFrame(cache, texture, color, sx, sy, sw, sh);\r\n            canvasMgr.cacheCanvas(cache, key);\r\n        }\r\n        return cache;\r\n    },\r\n\r\n    dropColorizedImage (texture, color) {\r\n        let key = texture.url + (color._val & 0x00ffffff);\r\n        canvasMgr.dropImage(key);\r\n    }\r\n};","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst renderEngine = require('./render-engine');\r\nconst math = renderEngine.math;\r\n\r\nlet _pos = math.vec3.create();\r\n\r\nfunction _initBuiltins(device) {\r\n    let defaultTexture = new renderEngine.Texture2D(device, {\r\n        images: [],\r\n        width: 128,\r\n        height: 128,\r\n        wrapS: renderEngine.gfx.WRAP_REPEAT,\r\n        wrapT: renderEngine.gfx.WRAP_REPEAT,\r\n        format: renderEngine.gfx.TEXTURE_FMT_RGB8,\r\n        mipmap: false,\r\n    });\r\n  \r\n    return {\r\n        defaultTexture: defaultTexture,\r\n        programTemplates: renderEngine.shaders.templates,\r\n        programChunks: renderEngine.shaders.chunks,\r\n    };\r\n}\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en The renderer object which provide access to render system APIs, \r\n * detailed APIs will be available progressively.\r\n * !#zh \r\n * @class renderer\r\n * @static\r\n */\r\ncc.renderer = module.exports = {\r\n    /**\r\n     * !#en The render engine is available only after cc.game.EVENT_ENGINE_INITED event.<br/>\r\n     * Normally it will be inited as the webgl render engine, but in wechat open context domain,\r\n     * it will be inited as the canvas render engine. Canvas render engine is no longer available for other use case since v2.0.\r\n     * !#zh  cc.game.EVENT_ENGINE_INITED <br/>\r\n     *  WebGL  Canvas  2.0  Canvas \r\n     * @property renderEngine\r\n     * @type {Object}\r\n     */\r\n    renderEngine: renderEngine,\r\n    Texture2D: null,\r\n\r\n    /*\r\n     * !#en The canvas object which provides the rendering context\r\n     * !#zh  Canvas \r\n     * @property canvas\r\n     * @type {HTMLCanvasElement}\r\n     */\r\n    canvas: null,\r\n    /*\r\n     * !#en The device object which provides device related rendering functionality, it divers for different render engine type.\r\n     * !#zh \r\n     * @property device\r\n     * @type {renderer.renderEngine.Device}\r\n     */\r\n    device: null,\r\n    scene: null,\r\n    /**\r\n     * !#en The total draw call count in last rendered frame.\r\n     * !#zh \r\n     * @property drawCalls\r\n     * @type {Number}\r\n     */\r\n    drawCalls: 0,\r\n    _walker: null,\r\n    _cameraNode: null,\r\n    _camera: null,\r\n    _forward: null,\r\n\r\n    initWebGL (canvas, opts) {\r\n        require('./webgl/assemblers');\r\n        const RenderComponentWalker = require('./webgl/render-component-walker');\r\n\r\n        this.Texture2D = renderEngine.Texture2D;\r\n\r\n        this.canvas = canvas;\r\n        if (CC_JSB && CC_NATIVERENDERER) {\r\n            // native codes will create an instance of Device, so just use the global instance.\r\n            this.device = window.device;\r\n        }\r\n        else {\r\n            this.device = new renderEngine.Device(canvas, opts);\r\n        }\r\n        \r\n        this.scene = new renderEngine.Scene();\r\n\r\n        this._walker = new RenderComponentWalker(this.device, this.scene);\r\n\r\n        if (CC_EDITOR) {\r\n            this._cameraNode = new cc.Node();\r\n\r\n            this._camera = new renderEngine.Camera();\r\n            this._camera.setColor(0, 0, 0, 1);\r\n            this._camera.setFov(Math.PI * 60 / 180);\r\n            this._camera.setNear(0.1);\r\n            this._camera.setFar(1024);\r\n            this._camera.setNode(this._cameraNode);\r\n\r\n            let view = new renderEngine.View();\r\n            this._camera.view = view;\r\n            this._camera.dirty = true;\r\n            \r\n            if (CC_EDITOR) {\r\n                this._camera.setColor(0, 0, 0, 0);\r\n            }\r\n            this._camera.setStages([\r\n                'transparent'\r\n            ]);\r\n            this.scene.addCamera(this._camera);\r\n        }\r\n\r\n        let builtins = _initBuiltins(this.device);\r\n        this._forward = new renderEngine.ForwardRenderer(this.device, builtins);\r\n    },\r\n\r\n    initCanvas (canvas) {\r\n        let canvasRenderer = require('./canvas');\r\n\r\n        if (CC_TEST) {\r\n            // It's actually running with original render engine\r\n            renderEngine.Texture2D = renderEngine.canvas.Texture2D;\r\n            renderEngine.Device = renderEngine.canvas.Device;\r\n        }\r\n        \r\n        this.Texture2D = renderEngine.Texture2D;\r\n\r\n        this.canvas = canvas;\r\n        this.device = new renderEngine.Device(canvas);\r\n        this._camera = {\r\n            a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0\r\n        };\r\n        this._walker = new canvasRenderer.RenderComponentWalker(this.device, this._camera);\r\n        this._forward = new canvasRenderer.ForwardRenderer();\r\n    },\r\n\r\n    updateCameraViewport () {\r\n        // TODO: remove HACK\r\n        if (!CC_EDITOR && cc.director) {\r\n            let ecScene = cc.director.getScene();\r\n            ecScene.setScale(1, 1, 1);\r\n        }\r\n\r\n        if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            let vp = cc.view.getViewportRect();\r\n            this.device.setViewport(vp.x, vp.y, vp.width, vp.height);\r\n            this._camera.a = cc.view.getScaleX();\r\n            this._camera.d = cc.view.getScaleY();\r\n            this._camera.tx = vp.x;\r\n            this._camera.ty = vp.y + vp.height;\r\n        }\r\n        else if (CC_EDITOR && this.canvas) {\r\n            let canvas = this.canvas;\r\n            let scaleX = cc.view.getScaleX();\r\n            let scaleY = cc.view.getScaleY();\r\n\r\n            let node = this._cameraNode;\r\n            _pos.x = node.x = canvas.width / scaleX / 2;\r\n            _pos.y = node.y = canvas.height / scaleY / 2;\r\n            _pos.z = 0;\r\n\r\n            node.z = canvas.height / scaleY / 1.1566;\r\n            node.lookAt(_pos);\r\n            this._camera.dirty = true;\r\n        }\r\n    },\r\n\r\n    render (ecScene) {\r\n        this.device._stats.drawcalls = 0;\r\n        if (ecScene) {\r\n            // walk entity component scene to generate models\r\n            this._walker.visit(ecScene);\r\n            // Render models in renderer scene\r\n            this._forward.render(this.scene);\r\n            this.drawCalls = this.device._stats.drawcalls;\r\n        }\r\n    },\r\n\r\n    clear () {\r\n        this._walker.reset();\r\n        this._forward._reset();\r\n    }\r\n};","\r\n/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n render-engine v1.2.0\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n \r\n\r\n'use strict';\r\n\r\nvar _d2r = Math.PI / 180.0;\r\nvar _r2d = 180.0 / Math.PI;\r\n\r\n/**\r\n * @property {number} EPSILON\r\n */\r\nvar EPSILON = 0.000001;\r\n\r\n/**\r\n * Tests whether or not the arguments have approximately the same value, within an absolute\r\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\r\n * than or equal to 1.0, and a relative tolerance is used for larger values)\r\n *\r\n * @param {Number} a The first number to test.\r\n * @param {Number} b The second number to test.\r\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\r\n */\r\nfunction equals(a, b) {\r\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\r\n}\r\n\r\n/**\r\n * Tests whether or not the arguments have approximately the same value by given maxDiff\r\n *\r\n * @param {Number} a The first number to test.\r\n * @param {Number} b The second number to test.\r\n * @param {Number} maxDiff Maximum difference.\r\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\r\n */\r\nfunction approx(a, b, maxDiff) {\r\n  maxDiff = maxDiff || EPSILON;\r\n  return Math.abs(a - b) <= maxDiff;\r\n}\r\n\r\n/**\r\n * Clamps a value between a minimum float and maximum float value.\r\n *\r\n * @method clamp\r\n * @param {number} val\r\n * @param {number} min\r\n * @param {number} max\r\n * @return {number}\r\n */\r\nfunction clamp(val, min, max) {\r\n  return val < min ? min : val > max ? max : val;\r\n}\r\n\r\n/**\r\n * Clamps a value between 0 and 1.\r\n *\r\n * @method clamp01\r\n * @param {number} val\r\n * @return {number}\r\n */\r\nfunction clamp01(val) {\r\n  return val < 0 ? 0 : val > 1 ? 1 : val;\r\n}\r\n\r\n/**\r\n * @method lerp\r\n * @param {number} from\r\n * @param {number} to\r\n * @param {number} ratio - the interpolation coefficient\r\n * @return {number}\r\n */\r\nfunction lerp(from, to, ratio) {\r\n  return from + (to - from) * ratio;\r\n}\r\n\r\n/**\r\n* Convert Degree To Radian\r\n*\r\n* @param {Number} a Angle in Degrees\r\n*/\r\nfunction toRadian(a) {\r\n  return a * _d2r;\r\n}\r\n\r\n/**\r\n* Convert Radian To Degree\r\n*\r\n* @param {Number} a Angle in Radian\r\n*/\r\nfunction toDegree(a) {\r\n  return a * _r2d;\r\n}\r\n\r\n/**\r\n* @method random\r\n*/\r\nvar random = Math.random;\r\n\r\n/**\r\n * Returns a floating-point random number between min (inclusive) and max (exclusive).\r\n *\r\n * @method randomRange\r\n * @param {number} min\r\n * @param {number} max\r\n * @return {number} the random number\r\n */\r\nfunction randomRange(min, max) {\r\n  return Math.random() * (max - min) + min;\r\n}\r\n\r\n/**\r\n * Returns a random integer between min (inclusive) and max (exclusive).\r\n *\r\n * @method randomRangeInt\r\n * @param {number} min\r\n * @param {number} max\r\n * @return {number} the random integer\r\n */\r\nfunction randomRangeInt(min, max) {\r\n  return Math.floor(randomRange(min, max));\r\n}\r\n\r\n/**\r\n * Returns the next power of two for the value\r\n *\r\n * @method nextPow2\r\n * @param {number} val\r\n * @return {number} the the next power of two\r\n */\r\nfunction nextPow2(val) {\r\n  --val;\r\n  val = (val >> 1) | val;\r\n  val = (val >> 2) | val;\r\n  val = (val >> 4) | val;\r\n  val = (val >> 8) | val;\r\n  val = (val >> 16) | val;\r\n  ++val;\r\n\r\n  return val;\r\n}\r\n\r\n/**\r\n * Bit twiddling hacks for JavaScript.\r\n *\r\n * Author: Mikola Lysenko\r\n *\r\n * Ported from Stanford bit twiddling hack library:\r\n *    http://graphics.stanford.edu/~seander/bithacks.html\r\n */\r\n\r\n// Number of bits in an integer\r\nvar INT_BITS = 32;\r\nvar INT_MAX =  0x7fffffff;\r\nvar INT_MIN = -1<<(INT_BITS-1);\r\n\r\n/**\r\n * Returns -1, 0, +1 depending on sign of x\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction sign(v) {\r\n  return (v > 0) - (v < 0);\r\n}\r\n\r\n/**\r\n * Computes absolute value of integer\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction abs(v) {\r\n  var mask = v >> (INT_BITS-1);\r\n  return (v ^ mask) - mask;\r\n}\r\n\r\n/**\r\n * Computes minimum of integers x and y\r\n *\r\n * @param {number} x\r\n * @param {number} y\r\n * @returns {number}\r\n */\r\nfunction min(x, y) {\r\n  return y ^ ((x ^ y) & -(x < y));\r\n}\r\n\r\n/**\r\n * Computes maximum of integers x and y\r\n *\r\n * @param {number} x\r\n * @param {number} y\r\n * @returns {number}\r\n */\r\nfunction max(x, y) {\r\n  return x ^ ((x ^ y) & -(x < y));\r\n}\r\n\r\n/**\r\n * Checks if a number is a power of two\r\n *\r\n * @param {number} v\r\n * @returns {boolean}\r\n */\r\nfunction isPow2(v) {\r\n  return !(v & (v-1)) && (!!v);\r\n}\r\n\r\n/**\r\n * Computes log base 2 of v\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction log2(v) {\r\n  var r, shift;\r\n  r =     (v > 0xFFFF) << 4; v >>>= r;\r\n  shift = (v > 0xFF  ) << 3; v >>>= shift; r |= shift;\r\n  shift = (v > 0xF   ) << 2; v >>>= shift; r |= shift;\r\n  shift = (v > 0x3   ) << 1; v >>>= shift; r |= shift;\r\n  return r | (v >> 1);\r\n}\r\n\r\n/**\r\n * Computes log base 10 of v\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction log10(v) {\r\n  return  (v >= 1000000000) ? 9 : (v >= 100000000) ? 8 : (v >= 10000000) ? 7 :\r\n          (v >= 1000000) ? 6 : (v >= 100000) ? 5 : (v >= 10000) ? 4 :\r\n          (v >= 1000) ? 3 : (v >= 100) ? 2 : (v >= 10) ? 1 : 0;\r\n}\r\n\r\n/**\r\n * Counts number of bits\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction popCount(v) {\r\n  v = v - ((v >>> 1) & 0x55555555);\r\n  v = (v & 0x33333333) + ((v >>> 2) & 0x33333333);\r\n  return ((v + (v >>> 4) & 0xF0F0F0F) * 0x1010101) >>> 24;\r\n}\r\n\r\n/**\r\n * Counts number of trailing zeros\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction countTrailingZeros(v) {\r\n  var c = 32;\r\n  v &= -v;\r\n  if (v) { c--; }\r\n  if (v & 0x0000FFFF) { c -= 16; }\r\n  if (v & 0x00FF00FF) { c -= 8; }\r\n  if (v & 0x0F0F0F0F) { c -= 4; }\r\n  if (v & 0x33333333) { c -= 2; }\r\n  if (v & 0x55555555) { c -= 1; }\r\n  return c;\r\n}\r\n\r\n/**\r\n * Rounds to next power of 2\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction nextPow2$1(v) {\r\n  v += v === 0;\r\n  --v;\r\n  v |= v >>> 1;\r\n  v |= v >>> 2;\r\n  v |= v >>> 4;\r\n  v |= v >>> 8;\r\n  v |= v >>> 16;\r\n  return v + 1;\r\n}\r\n\r\n/**\r\n * Rounds down to previous power of 2\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction prevPow2(v) {\r\n  v |= v >>> 1;\r\n  v |= v >>> 2;\r\n  v |= v >>> 4;\r\n  v |= v >>> 8;\r\n  v |= v >>> 16;\r\n  return v - (v>>>1);\r\n}\r\n\r\n/**\r\n * Computes parity of word\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction parity(v) {\r\n  v ^= v >>> 16;\r\n  v ^= v >>> 8;\r\n  v ^= v >>> 4;\r\n  v &= 0xf;\r\n  return (0x6996 >>> v) & 1;\r\n}\r\n\r\nvar REVERSE_TABLE = new Array(256);\r\n\r\n(function(tab) {\r\n  for(var i=0; i<256; ++i) {\r\n    var v = i, r = i, s = 7;\r\n    for (v >>>= 1; v; v >>>= 1) {\r\n      r <<= 1;\r\n      r |= v & 1;\r\n      --s;\r\n    }\r\n    tab[i] = (r << s) & 0xff;\r\n  }\r\n})(REVERSE_TABLE);\r\n\r\n/**\r\n * Reverse bits in a 32 bit word\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction reverse(v) {\r\n  return (REVERSE_TABLE[v & 0xff] << 24) |\r\n         (REVERSE_TABLE[(v >>> 8) & 0xff] << 16) |\r\n         (REVERSE_TABLE[(v >>> 16) & 0xff] << 8) |\r\n         REVERSE_TABLE[(v >>> 24) & 0xff];\r\n}\r\n\r\n/**\r\n * Interleave bits of 2 coordinates with 16 bits. Useful for fast quadtree codes\r\n *\r\n * @param {number} x\r\n * @param {number} y\r\n * @returns {number}\r\n */\r\nfunction interleave2(x, y) {\r\n  x &= 0xFFFF;\r\n  x = (x | (x << 8)) & 0x00FF00FF;\r\n  x = (x | (x << 4)) & 0x0F0F0F0F;\r\n  x = (x | (x << 2)) & 0x33333333;\r\n  x = (x | (x << 1)) & 0x55555555;\r\n\r\n  y &= 0xFFFF;\r\n  y = (y | (y << 8)) & 0x00FF00FF;\r\n  y = (y | (y << 4)) & 0x0F0F0F0F;\r\n  y = (y | (y << 2)) & 0x33333333;\r\n  y = (y | (y << 1)) & 0x55555555;\r\n\r\n  return x | (y << 1);\r\n}\r\n\r\n/**\r\n * Extracts the nth interleaved component\r\n *\r\n * @param {number} v\r\n * @param {number} n\r\n * @returns {number}\r\n */\r\nfunction deinterleave2(v, n) {\r\n  v = (v >>> n) & 0x55555555;\r\n  v = (v | (v >>> 1))  & 0x33333333;\r\n  v = (v | (v >>> 2))  & 0x0F0F0F0F;\r\n  v = (v | (v >>> 4))  & 0x00FF00FF;\r\n  v = (v | (v >>> 16)) & 0x000FFFF;\r\n  return (v << 16) >> 16;\r\n}\r\n\r\n/**\r\n * Interleave bits of 3 coordinates, each with 10 bits.  Useful for fast octree codes\r\n *\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {number} z\r\n * @returns {number}\r\n */\r\nfunction interleave3(x, y, z) {\r\n  x &= 0x3FF;\r\n  x  = (x | (x<<16)) & 4278190335;\r\n  x  = (x | (x<<8))  & 251719695;\r\n  x  = (x | (x<<4))  & 3272356035;\r\n  x  = (x | (x<<2))  & 1227133513;\r\n\r\n  y &= 0x3FF;\r\n  y  = (y | (y<<16)) & 4278190335;\r\n  y  = (y | (y<<8))  & 251719695;\r\n  y  = (y | (y<<4))  & 3272356035;\r\n  y  = (y | (y<<2))  & 1227133513;\r\n  x |= (y << 1);\r\n\r\n  z &= 0x3FF;\r\n  z  = (z | (z<<16)) & 4278190335;\r\n  z  = (z | (z<<8))  & 251719695;\r\n  z  = (z | (z<<4))  & 3272356035;\r\n  z  = (z | (z<<2))  & 1227133513;\r\n\r\n  return x | (z << 2);\r\n}\r\n\r\n/**\r\n * Extracts nth interleaved component of a 3-tuple\r\n *\r\n * @param {number} v\r\n * @param {number} n\r\n * @returns {number}\r\n */\r\nfunction deinterleave3(v, n) {\r\n  v = (v >>> n)       & 1227133513;\r\n  v = (v | (v>>>2))   & 3272356035;\r\n  v = (v | (v>>>4))   & 251719695;\r\n  v = (v | (v>>>8))   & 4278190335;\r\n  v = (v | (v>>>16))  & 0x3FF;\r\n  return (v<<22)>>22;\r\n}\r\n\r\n/**\r\n * Computes next combination in colexicographic order (this is mistakenly called nextPermutation on the bit twiddling hacks page)\r\n *\r\n * @param {number} v\r\n * @returns {number}\r\n */\r\nfunction nextCombination(v) {\r\n  var t = v | (v - 1);\r\n  return (t + 1) | (((~t & -~t) - 1) >>> (countTrailingZeros(v) + 1));\r\n}\r\n\r\nvar bits_ = Object.freeze({\r\n\tINT_BITS: INT_BITS,\r\n\tINT_MAX: INT_MAX,\r\n\tINT_MIN: INT_MIN,\r\n\tsign: sign,\r\n\tabs: abs,\r\n\tmin: min,\r\n\tmax: max,\r\n\tisPow2: isPow2,\r\n\tlog2: log2,\r\n\tlog10: log10,\r\n\tpopCount: popCount,\r\n\tcountTrailingZeros: countTrailingZeros,\r\n\tnextPow2: nextPow2$1,\r\n\tprevPow2: prevPow2,\r\n\tparity: parity,\r\n\treverse: reverse,\r\n\tinterleave2: interleave2,\r\n\tdeinterleave2: deinterleave2,\r\n\tinterleave3: interleave3,\r\n\tdeinterleave3: deinterleave3,\r\n\tnextCombination: nextCombination\r\n});\r\n\r\nvar _tmp = new Array(2);\r\n\r\nvar _vec2 = function _vec2(x, y) {\r\n  this.x = x;\r\n  this.y = y;\r\n};\r\n\r\n_vec2.prototype.toJSON = function toJSON () {\r\n  _tmp[0] = this.x;\r\n  _tmp[1] = this.y;\r\n\r\n  return _tmp;\r\n};\r\n\r\n/**\r\n * @class 2 Dimensional Vector\r\n * @name vec2\r\n */\r\nvar vec2 = {};\r\n\r\n/**\r\n * Creates a new, empty vec2\r\n *\r\n * @returns {vec2} a new 2D vector\r\n */\r\nvec2.create = function () {\r\n  return new _vec2(0, 0);\r\n};\r\n\r\n/**\r\n * Creates a new vec2 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @returns {vec2} a new 2D vector\r\n */\r\nvec2.new = function (x, y) {\r\n  return new _vec2(x, y);\r\n};\r\n\r\n/**\r\n * Creates a new vec2 initialized with values from an existing vector\r\n *\r\n * @param {vec2} a vector to clone\r\n * @returns {vec2} a new 2D vector\r\n */\r\nvec2.clone = function (a) {\r\n  return new _vec2(a.x, a.y);\r\n};\r\n\r\n/**\r\n * Copy the values from one vec2 to another\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the source vector\r\n * @returns {vec2} out\r\n */\r\nvec2.copy = function (out, a) {\r\n  out.x = a.x;\r\n  out.y = a.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a vec2 to the given values\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @returns {vec2} out\r\n */\r\nvec2.set = function (out, x, y) {\r\n  out.x = x;\r\n  out.y = y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nvec2.add = function (out, a, b) {\r\n  out.x = a.x + b.x;\r\n  out.y = a.y + b.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nvec2.subtract = function (out, a, b) {\r\n  out.x = a.x - b.x;\r\n  out.y = a.y - b.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec2.subtract}\r\n * @function\r\n */\r\nvec2.sub = vec2.subtract;\r\n\r\n/**\r\n * Multiplies two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nvec2.multiply = function (out, a, b) {\r\n  out.x = a.x * b.x;\r\n  out.y = a.y * b.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec2.multiply}\r\n * @function\r\n */\r\nvec2.mul = vec2.multiply;\r\n\r\n/**\r\n * Divides two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nvec2.divide = function (out, a, b) {\r\n  out.x = a.x / b.x;\r\n  out.y = a.y / b.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec2.divide}\r\n * @function\r\n */\r\nvec2.div = vec2.divide;\r\n\r\n/**\r\n * Math.ceil the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to ceil\r\n * @returns {vec2} out\r\n */\r\nvec2.ceil = function (out, a) {\r\n  out.x = Math.ceil(a.x);\r\n  out.y = Math.ceil(a.y);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Math.floor the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to floor\r\n * @returns {vec2} out\r\n */\r\nvec2.floor = function (out, a) {\r\n  out.x = Math.floor(a.x);\r\n  out.y = Math.floor(a.y);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the minimum of two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nvec2.min = function (out, a, b) {\r\n  out.x = Math.min(a.x, b.x);\r\n  out.y = Math.min(a.y, b.y);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the maximum of two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nvec2.max = function (out, a, b) {\r\n  out.x = Math.max(a.x, b.x);\r\n  out.y = Math.max(a.y, b.y);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Math.round the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to round\r\n * @returns {vec2} out\r\n */\r\nvec2.round = function (out, a) {\r\n  out.x = Math.round(a.x);\r\n  out.y = Math.round(a.y);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales a vec2 by a scalar number\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec2} out\r\n */\r\nvec2.scale = function (out, a, b) {\r\n  out.x = a.x * b;\r\n  out.y = a.y * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two vec2's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec2} out\r\n */\r\nvec2.scaleAndAdd = function (out, a, b, scale) {\r\n  out.x = a.x + (b.x * scale);\r\n  out.y = a.y + (b.y * scale);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nvec2.distance = function (a, b) {\r\n  var x = b.x - a.x,\r\n      y = b.y - a.y;\r\n  return Math.sqrt(x * x + y * y);\r\n};\r\n\r\n/**\r\n * Alias for {@link vec2.distance}\r\n * @function\r\n */\r\nvec2.dist = vec2.distance;\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nvec2.squaredDistance = function (a, b) {\r\n  var x = b.x - a.x,\r\n      y = b.y - a.y;\r\n  return x * x + y * y;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec2.squaredDistance}\r\n * @function\r\n */\r\nvec2.sqrDist = vec2.squaredDistance;\r\n\r\n/**\r\n * Calculates the length of a vec2\r\n *\r\n * @param {vec2} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nvec2.length = function (a) {\r\n  var x = a.x,\r\n      y = a.y;\r\n  return Math.sqrt(x * x + y * y);\r\n};\r\n\r\n/**\r\n * Alias for {@link vec2.length}\r\n * @function\r\n */\r\nvec2.len = vec2.length;\r\n\r\n/**\r\n * Calculates the squared length of a vec2\r\n *\r\n * @param {vec2} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nvec2.squaredLength = function (a) {\r\n  var x = a.x,\r\n      y = a.y;\r\n  return x * x + y * y;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec2.squaredLength}\r\n * @function\r\n */\r\nvec2.sqrLen = vec2.squaredLength;\r\n\r\n/**\r\n * Negates the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to negate\r\n * @returns {vec2} out\r\n */\r\nvec2.negate = function (out, a) {\r\n  out.x = -a.x;\r\n  out.y = -a.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the inverse of the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to invert\r\n * @returns {vec2} out\r\n */\r\nvec2.inverse = function (out, a) {\r\n  out.x = 1.0 / a.x;\r\n  out.y = 1.0 / a.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the inverse of the components of a vec2 safely\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to invert\r\n * @returns {vec2} out\r\n */\r\nvec2.inverseSafe = function (out, a) {\r\n  var x = a.x,\r\n      y = a.y;\r\n\r\n  if (Math.abs(x) < EPSILON) {\r\n    out.x = 0;\r\n  } else {\r\n    out.x = 1.0 / x;\r\n  }\r\n\r\n  if (Math.abs(y) < EPSILON) {\r\n    out.y = 0;\r\n  } else {\r\n    out.y = 1.0 / a.y;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Normalize a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to normalize\r\n * @returns {vec2} out\r\n */\r\nvec2.normalize = function (out, a) {\r\n  var x = a.x,\r\n      y = a.y;\r\n  var len = x * x + y * y;\r\n  if (len > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len = 1 / Math.sqrt(len);\r\n    out.x = a.x * len;\r\n    out.y = a.y * len;\r\n  }\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the dot product of two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nvec2.dot = function (a, b) {\r\n  return a.x * b.x + a.y * b.y;\r\n};\r\n\r\n/**\r\n * Computes the cross product of two vec2's\r\n * Note that the cross product must by definition produce a 3D vector\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec3} out\r\n */\r\nvec2.cross = function (out, a, b) {\r\n  var z = a.x * b.y - a.y * b.x;\r\n  out.x = out.y = 0;\r\n  out.z = z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Performs a linear interpolation between two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {vec2} out\r\n */\r\nvec2.lerp = function (out, a, b, t) {\r\n  var ax = a.x,\r\n      ay = a.y;\r\n  out.x = ax + t * (b.x - ax);\r\n  out.y = ay + t * (b.y - ay);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec2} out\r\n */\r\nvec2.random = function (out, scale) {\r\n  scale = scale || 1.0;\r\n  var r = random() * 2.0 * Math.PI;\r\n  out.x = Math.cos(r) * scale;\r\n  out.y = Math.sin(r) * scale;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec2 with a mat2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat2} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nvec2.transformMat2 = function (out, a, m) {\r\n  var x = a.x,\r\n      y = a.y;\r\n  out.x = m.m00 * x + m.m02 * y;\r\n  out.y = m.m01 * x + m.m03 * y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec2 with a mat23\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat23} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nvec2.transformMat23 = function (out, a, m) {\r\n  var x = a.x,\r\n      y = a.y;\r\n  out.x = m.m00 * x + m.m02 * y + m.m04;\r\n  out.y = m.m01 * x + m.m03 * y + m.m05;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec2 with a mat3\r\n * 3rd vector component is implicitly '1'\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat3} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nvec2.transformMat3 = function (out, a, m) {\r\n  var x = a.x,\r\n      y = a.y;\r\n  out.x = m.m00 * x + m.m03 * y + m.m06;\r\n  out.y = m.m01 * x + m.m04 * y + m.m07;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec2 with a mat4\r\n * 3rd vector component is implicitly '0'\r\n * 4th vector component is implicitly '1'\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nvec2.transformMat4 = function (out, a, m) {\r\n  var x = a.x,\r\n      y = a.y;\r\n  out.x = m.m00 * x + m.m04 * y + m.m12;\r\n  out.y = m.m01 * x + m.m05 * y + m.m13;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Perform some operation over an array of vec2s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nvec2.forEach = (function () {\r\n  var vec = vec2.create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i, l;\r\n    if (!stride) {\r\n      stride = 2;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min((count * stride) + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec.x = a[i]; vec.y = a[i + 1];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec.x; a[i + 1] = vec.y;\r\n    }\r\n\r\n    return a;\r\n  };\r\n})();\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec2} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nvec2.str = function (a) {\r\n  return (\"vec2(\" + (a.x) + \", \" + (a.y) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {vec2} v\r\n * @returns {array}\r\n */\r\nvec2.array = function (out, v) {\r\n  out[0] = v.x;\r\n  out[1] = v.y;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec2} a The first vector.\r\n * @param {vec2} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nvec2.exactEquals = function (a, b) {\r\n  return a.x === b.x && a.y === b.y;\r\n};\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec2} a The first vector.\r\n * @param {vec2} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nvec2.equals = function (a, b) {\r\n  var a0 = a.x, a1 = a.y;\r\n  var b0 = b.x, b1 = b.y;\r\n  return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)));\r\n};\r\n\r\nvar _tmp$1 = new Array(3);\r\n\r\nvar _vec3 = function _vec3(x, y, z) {\r\n  this.x = x;\r\n  this.y = y;\r\n  this.z = z;\r\n};\r\n\r\n_vec3.prototype.toJSON = function toJSON () {\r\n  _tmp$1[0] = this.x;\r\n  _tmp$1[1] = this.y;\r\n  _tmp$1[2] = this.z;\r\n\r\n  return _tmp$1;\r\n};\r\n\r\n/**\r\n * @class 3 Dimensional Vector\r\n * @name vec3\r\n */\r\nvar vec3 = {};\r\n\r\n/**\r\n * Creates a new, empty vec3\r\n *\r\n * @returns {vec3} a new 3D vector\r\n */\r\nvec3.create = function () {\r\n  return new _vec3(0, 0, 0);\r\n};\r\n\r\n/**\r\n * Creates a new vec3 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @returns {vec3} a new 3D vector\r\n */\r\nvec3.new = function (x, y, z) {\r\n  return new _vec3(x, y, z);\r\n};\r\n\r\n/**\r\n * Creates a new vec3 initialized with values from an existing vector\r\n *\r\n * @param {vec3} a vector to clone\r\n * @returns {vec3} a new 3D vector\r\n */\r\nvec3.clone = function (a) {\r\n  return new _vec3(a.x, a.y, a.z);\r\n};\r\n\r\n/**\r\n * Copy the values from one vec3 to another\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the source vector\r\n * @returns {vec3} out\r\n */\r\nvec3.copy = function (out, a) {\r\n  out.x = a.x;\r\n  out.y = a.y;\r\n  out.z = a.z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a vec3 to the given values\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @returns {vec3} out\r\n */\r\nvec3.set = function (out, x, y, z) {\r\n  out.x = x;\r\n  out.y = y;\r\n  out.z = z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nvec3.add = function (out, a, b) {\r\n  out.x = a.x + b.x;\r\n  out.y = a.y + b.y;\r\n  out.z = a.z + b.z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nvec3.subtract = function (out, a, b) {\r\n  out.x = a.x - b.x;\r\n  out.y = a.y - b.y;\r\n  out.z = a.z - b.z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec3.subtract}\r\n * @function\r\n */\r\nvec3.sub = vec3.subtract;\r\n\r\n/**\r\n * Multiplies two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nvec3.multiply = function (out, a, b) {\r\n  out.x = a.x * b.x;\r\n  out.y = a.y * b.y;\r\n  out.z = a.z * b.z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec3.multiply}\r\n * @function\r\n */\r\nvec3.mul = vec3.multiply;\r\n\r\n/**\r\n * Divides two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nvec3.divide = function (out, a, b) {\r\n  out.x = a.x / b.x;\r\n  out.y = a.y / b.y;\r\n  out.z = a.z / b.z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec3.divide}\r\n * @function\r\n */\r\nvec3.div = vec3.divide;\r\n\r\n/**\r\n * Math.ceil the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to ceil\r\n * @returns {vec3} out\r\n */\r\nvec3.ceil = function (out, a) {\r\n  out.x = Math.ceil(a.x);\r\n  out.y = Math.ceil(a.y);\r\n  out.z = Math.ceil(a.z);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Math.floor the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to floor\r\n * @returns {vec3} out\r\n */\r\nvec3.floor = function (out, a) {\r\n  out.x = Math.floor(a.x);\r\n  out.y = Math.floor(a.y);\r\n  out.z = Math.floor(a.z);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the minimum of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nvec3.min = function (out, a, b) {\r\n  out.x = Math.min(a.x, b.x);\r\n  out.y = Math.min(a.y, b.y);\r\n  out.z = Math.min(a.z, b.z);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the maximum of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nvec3.max = function (out, a, b) {\r\n  out.x = Math.max(a.x, b.x);\r\n  out.y = Math.max(a.y, b.y);\r\n  out.z = Math.max(a.z, b.z);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Math.round the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to round\r\n * @returns {vec3} out\r\n */\r\nvec3.round = function (out, a) {\r\n  out.x = Math.round(a.x);\r\n  out.y = Math.round(a.y);\r\n  out.z = Math.round(a.z);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales a vec3 by a scalar number\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec3} out\r\n */\r\nvec3.scale = function (out, a, b) {\r\n  out.x = a.x * b;\r\n  out.y = a.y * b;\r\n  out.z = a.z * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two vec3's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec3} out\r\n */\r\nvec3.scaleAndAdd = function (out, a, b, scale) {\r\n  out.x = a.x + (b.x * scale);\r\n  out.y = a.y + (b.y * scale);\r\n  out.z = a.z + (b.z * scale);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nvec3.distance = function (a, b) {\r\n  var x = b.x - a.x,\r\n    y = b.y - a.y,\r\n    z = b.z - a.z;\r\n  return Math.sqrt(x * x + y * y + z * z);\r\n};\r\n\r\n/**\r\n * Alias for {@link vec3.distance}\r\n * @function\r\n */\r\nvec3.dist = vec3.distance;\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nvec3.squaredDistance = function (a, b) {\r\n  var x = b.x - a.x,\r\n      y = b.y - a.y,\r\n      z = b.z - a.z;\r\n  return x * x + y * y + z * z;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec3.squaredDistance}\r\n * @function\r\n */\r\nvec3.sqrDist = vec3.squaredDistance;\r\n\r\n/**\r\n * Calculates the length of a vec3\r\n *\r\n * @param {vec3} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nvec3.length = function (a) {\r\n  var x = a.x,\r\n      y = a.y,\r\n      z = a.z;\r\n  return Math.sqrt(x * x + y * y + z * z);\r\n};\r\n\r\n/**\r\n * Alias for {@link vec3.length}\r\n * @function\r\n */\r\nvec3.len = vec3.length;\r\n\r\n/**\r\n * Calculates the squared length of a vec3\r\n *\r\n * @param {vec3} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nvec3.squaredLength = function (a) {\r\n  var x = a.x,\r\n      y = a.y,\r\n      z = a.z;\r\n  return x * x + y * y + z * z;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec3.squaredLength}\r\n * @function\r\n */\r\nvec3.sqrLen = vec3.squaredLength;\r\n\r\n/**\r\n * Negates the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to negate\r\n * @returns {vec3} out\r\n */\r\nvec3.negate = function (out, a) {\r\n  out.x = -a.x;\r\n  out.y = -a.y;\r\n  out.z = -a.z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the inverse of the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to invert\r\n * @returns {vec3} out\r\n */\r\nvec3.inverse = function (out, a) {\r\n  out.x = 1.0 / a.x;\r\n  out.y = 1.0 / a.y;\r\n  out.z = 1.0 / a.z;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the inverse of the components of a vec3 safely\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to invert\r\n * @returns {vec3} out\r\n */\r\nvec3.inverseSafe = function (out, a) {\r\n  var x = a.x,\r\n      y = a.y,\r\n      z = a.z;\r\n\r\n  if (Math.abs(x) < EPSILON) {\r\n    out.x = 0;\r\n  } else {\r\n    out.x = 1.0 / x;\r\n  }\r\n\r\n  if (Math.abs(y) < EPSILON) {\r\n    out.y = 0;\r\n  } else {\r\n    out.y = 1.0 / y;\r\n  }\r\n\r\n  if (Math.abs(z) < EPSILON) {\r\n    out.z = 0;\r\n  } else {\r\n    out.z = 1.0 / z;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Normalize a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to normalize\r\n * @returns {vec3} out\r\n */\r\nvec3.normalize = function (out, a) {\r\n  var x = a.x,\r\n      y = a.y,\r\n      z = a.z;\r\n\r\n  var len = x * x + y * y + z * z;\r\n  if (len > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len = 1 / Math.sqrt(len);\r\n    out.x = x * len;\r\n    out.y = y * len;\r\n    out.z = z * len;\r\n  }\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the dot product of two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nvec3.dot = function (a, b) {\r\n  return a.x * b.x + a.y * b.y + a.z * b.z;\r\n};\r\n\r\n/**\r\n * Computes the cross product of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nvec3.cross = function (out, a, b) {\r\n  var ax = a.x, ay = a.y, az = a.z,\r\n      bx = b.x, by = b.y, bz = b.z;\r\n\r\n  out.x = ay * bz - az * by;\r\n  out.y = az * bx - ax * bz;\r\n  out.z = ax * by - ay * bx;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Performs a linear interpolation between two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {vec3} out\r\n */\r\nvec3.lerp = function (out, a, b, t) {\r\n  var ax = a.x,\r\n      ay = a.y,\r\n      az = a.z;\r\n  out.x = ax + t * (b.x - ax);\r\n  out.y = ay + t * (b.y - ay);\r\n  out.z = az + t * (b.z - az);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Performs a hermite interpolation with two control points\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {vec3} c the third operand\r\n * @param {vec3} d the fourth operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {vec3} out\r\n */\r\nvec3.hermite = function (out, a, b, c, d, t) {\r\n  var factorTimes2 = t * t,\r\n      factor1 = factorTimes2 * (2 * t - 3) + 1,\r\n      factor2 = factorTimes2 * (t - 2) + t,\r\n      factor3 = factorTimes2 * (t - 1),\r\n      factor4 = factorTimes2 * (3 - 2 * t);\r\n\r\n  out.x = a.x * factor1 + b.x * factor2 + c.x * factor3 + d.x * factor4;\r\n  out.y = a.y * factor1 + b.y * factor2 + c.y * factor3 + d.y * factor4;\r\n  out.z = a.z * factor1 + b.z * factor2 + c.z * factor3 + d.z * factor4;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Performs a bezier interpolation with two control points\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {vec3} c the third operand\r\n * @param {vec3} d the fourth operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {vec3} out\r\n */\r\nvec3.bezier = function (out, a, b, c, d, t) {\r\n  var inverseFactor = 1 - t,\r\n      inverseFactorTimesTwo = inverseFactor * inverseFactor,\r\n      factorTimes2 = t * t,\r\n      factor1 = inverseFactorTimesTwo * inverseFactor,\r\n      factor2 = 3 * t * inverseFactorTimesTwo,\r\n      factor3 = 3 * factorTimes2 * inverseFactor,\r\n      factor4 = factorTimes2 * t;\r\n\r\n  out.x = a.x * factor1 + b.x * factor2 + c.x * factor3 + d.x * factor4;\r\n  out.y = a.y * factor1 + b.y * factor2 + c.y * factor3 + d.y * factor4;\r\n  out.z = a.z * factor1 + b.z * factor2 + c.z * factor3 + d.z * factor4;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec3} out\r\n */\r\nvec3.random = function (out, scale) {\r\n  scale = scale || 1.0;\r\n\r\n  var r = random() * 2.0 * Math.PI;\r\n  var z = (random() * 2.0) - 1.0;\r\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\r\n\r\n  out.x = Math.cos(r) * zScale;\r\n  out.y = Math.sin(r) * zScale;\r\n  out.z = z * scale;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec3 with a mat4.\r\n * 4th vector component is implicitly '1'\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec3} out\r\n */\r\nvec3.transformMat4 = function (out, a, m) {\r\n  var x = a.x, y = a.y, z = a.z,\r\n      w = m.m03 * x + m.m07 * y + m.m11 * z + m.m15;\r\n  w = w || 1.0;\r\n  out.x = (m.m00 * x + m.m04 * y + m.m08 * z + m.m12) / w;\r\n  out.y = (m.m01 * x + m.m05 * y + m.m09 * z + m.m13) / w;\r\n  out.z = (m.m02 * x + m.m06 * y + m.m10 * z + m.m14) / w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec3 with a mat3.\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {mat4} m the 3x3 matrix to transform with\r\n * @returns {vec3} out\r\n */\r\nvec3.transformMat3 = function (out, a, m) {\r\n  var x = a.x, y = a.y, z = a.z;\r\n  out.x = x * m.m00 + y * m.m03 + z * m.m06;\r\n  out.y = x * m.m01 + y * m.m04 + z * m.m07;\r\n  out.z = x * m.m02 + y * m.m05 + z * m.m08;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec3 with a quat\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {quat} q quaternion to transform with\r\n * @returns {vec3} out\r\n */\r\nvec3.transformQuat = function (out, a, q) {\r\n  // benchmarks: http://jsperf.com/quaternion-transform-vec3-implementations\r\n\r\n  var x = a.x, y = a.y, z = a.z;\r\n  var qx = q.x, qy = q.y, qz = q.z, qw = q.w;\r\n\r\n  // calculate quat * vec\r\n  var ix = qw * x + qy * z - qz * y;\r\n  var iy = qw * y + qz * x - qx * z;\r\n  var iz = qw * z + qx * y - qy * x;\r\n  var iw = -qx * x - qy * y - qz * z;\r\n\r\n  // calculate result * inverse quat\r\n  out.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n  out.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n  out.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotate a 3D vector around the x-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nvec3.rotateX = function (out, a, b, c) {\r\n  var p = [], r = [];\r\n  // Translate point to the origin\r\n  p.x = a.x - b.x;\r\n  p.y = a.y - b.y;\r\n  p.z = a.z - b.z;\r\n\r\n  //perform rotation\r\n  r.x = p.x;\r\n  r.y = p.y * Math.cos(c) - p.z * Math.sin(c);\r\n  r.z = p.y * Math.sin(c) + p.z * Math.cos(c);\r\n\r\n  //translate to correct position\r\n  out.x = r.x + b.x;\r\n  out.y = r.y + b.y;\r\n  out.z = r.z + b.z;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotate a 3D vector around the y-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nvec3.rotateY = function (out, a, b, c) {\r\n  var p = [], r = [];\r\n  //Translate point to the origin\r\n  p.x = a.x - b.x;\r\n  p.y = a.y - b.y;\r\n  p.z = a.z - b.z;\r\n\r\n  //perform rotation\r\n  r.x = p.z * Math.sin(c) + p.x * Math.cos(c);\r\n  r.y = p.y;\r\n  r.z = p.z * Math.cos(c) - p.x * Math.sin(c);\r\n\r\n  //translate to correct position\r\n  out.x = r.x + b.x;\r\n  out.y = r.y + b.y;\r\n  out.z = r.z + b.z;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotate a 3D vector around the z-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nvec3.rotateZ = function (out, a, b, c) {\r\n  var p = [], r = [];\r\n  //Translate point to the origin\r\n  p.x = a.x - b.x;\r\n  p.y = a.y - b.y;\r\n  p.z = a.z - b.z;\r\n\r\n  //perform rotation\r\n  r.x = p.x * Math.cos(c) - p.y * Math.sin(c);\r\n  r.y = p.x * Math.sin(c) + p.y * Math.cos(c);\r\n  r.z = p.z;\r\n\r\n  //translate to correct position\r\n  out.x = r.x + b.x;\r\n  out.y = r.y + b.y;\r\n  out.z = r.z + b.z;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Perform some operation over an array of vec3s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nvec3.forEach = (function () {\r\n  var vec = vec3.create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i, l;\r\n    if (!stride) {\r\n      stride = 3;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min((count * stride) + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec.x = a[i]; vec.y = a[i + 1]; vec.z = a[i + 2];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec.x; a[i + 1] = vec.y; a[i + 2] = vec.z;\r\n    }\r\n\r\n    return a;\r\n  };\r\n})();\r\n\r\n/**\r\n * Get the angle between two 3D vectors\r\n * @param {vec3} a The first operand\r\n * @param {vec3} b The second operand\r\n * @returns {Number} The angle in radians\r\n */\r\nvec3.angle = (function () {\r\n  var tempA = vec3.create();\r\n  var tempB = vec3.create();\r\n\r\n  return function (a, b) {\r\n    vec3.copy(tempA, a);\r\n    vec3.copy(tempB, b);\r\n\r\n    vec3.normalize(tempA, tempA);\r\n    vec3.normalize(tempB, tempB);\r\n\r\n    var cosine = vec3.dot(tempA, tempB);\r\n\r\n    if (cosine > 1.0) {\r\n      return 0;\r\n    }\r\n\r\n    if (cosine < -1.0) {\r\n      return Math.PI;\r\n    }\r\n\r\n    return Math.acos(cosine);\r\n  };\r\n})();\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec3} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nvec3.str = function (a) {\r\n  return (\"vec3(\" + (a.x) + \", \" + (a.y) + \", \" + (a.z) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {vec3} v\r\n * @returns {array}\r\n */\r\nvec3.array = function (out, v) {\r\n  out[0] = v.x;\r\n  out[1] = v.y;\r\n  out[2] = v.z;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec3} a The first vector.\r\n * @param {vec3} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nvec3.exactEquals = function (a, b) {\r\n  return a.x === b.x && a.y === b.y && a.z === b.z;\r\n};\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec3} a The first vector.\r\n * @param {vec3} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nvec3.equals = function (a, b) {\r\n  var a0 = a.x, a1 = a.y, a2 = a.z;\r\n  var b0 = b.x, b1 = b.y, b2 = b.z;\r\n  return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\r\n    Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)));\r\n};\r\n\r\nvar _tmp$2 = new Array(4);\r\n\r\nvar _vec4 = function _vec4(x, y, z, w) {\r\n  this.x = x;\r\n  this.y = y;\r\n  this.z = z;\r\n  this.w = w;\r\n};\r\n\r\n_vec4.prototype.toJSON = function toJSON () {\r\n  _tmp$2[0] = this.x;\r\n  _tmp$2[1] = this.y;\r\n  _tmp$2[2] = this.z;\r\n  _tmp$2[3] = this.w;\r\n\r\n  return _tmp$2;\r\n};\r\n\r\n/**\r\n * @class 4 Dimensional Vector\r\n * @name vec4\r\n */\r\nvar vec4 = {};\r\n\r\n/**\r\n * Creates a new, empty vec4\r\n *\r\n * @returns {vec4} a new 4D vector\r\n */\r\nvec4.create = function () {\r\n  return new _vec4(0, 0, 0, 0);\r\n};\r\n\r\n/**\r\n * Creates a new vec4 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} a new 4D vector\r\n */\r\nvec4.new = function (x, y, z, w) {\r\n  return new _vec4(x, y, z, w);\r\n};\r\n\r\n/**\r\n * Creates a new vec4 initialized with values from an existing vector\r\n *\r\n * @param {vec4} a vector to clone\r\n * @returns {vec4} a new 4D vector\r\n */\r\nvec4.clone = function (a) {\r\n  return new _vec4(a.x, a.y, a.z, a.w);\r\n};\r\n\r\n/**\r\n * Copy the values from one vec4 to another\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the source vector\r\n * @returns {vec4} out\r\n */\r\nvec4.copy = function (out, a) {\r\n  out.x = a.x;\r\n  out.y = a.y;\r\n  out.z = a.z;\r\n  out.w = a.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a vec4 to the given values\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} out\r\n */\r\nvec4.set = function (out, x, y, z, w) {\r\n  out.x = x;\r\n  out.y = y;\r\n  out.z = z;\r\n  out.w = w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nvec4.add = function (out, a, b) {\r\n  out.x = a.x + b.x;\r\n  out.y = a.y + b.y;\r\n  out.z = a.z + b.z;\r\n  out.w = a.w + b.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nvec4.subtract = function (out, a, b) {\r\n  out.x = a.x - b.x;\r\n  out.y = a.y - b.y;\r\n  out.z = a.z - b.z;\r\n  out.w = a.w - b.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec4.subtract}\r\n * @function\r\n */\r\nvec4.sub = vec4.subtract;\r\n\r\n/**\r\n * Multiplies two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nvec4.multiply = function (out, a, b) {\r\n  out.x = a.x * b.x;\r\n  out.y = a.y * b.y;\r\n  out.z = a.z * b.z;\r\n  out.w = a.w * b.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec4.multiply}\r\n * @function\r\n */\r\nvec4.mul = vec4.multiply;\r\n\r\n/**\r\n * Divides two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nvec4.divide = function (out, a, b) {\r\n  out.x = a.x / b.x;\r\n  out.y = a.y / b.y;\r\n  out.z = a.z / b.z;\r\n  out.w = a.w / b.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec4.divide}\r\n * @function\r\n */\r\nvec4.div = vec4.divide;\r\n\r\n/**\r\n * Math.ceil the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to ceil\r\n * @returns {vec4} out\r\n */\r\nvec4.ceil = function (out, a) {\r\n  out.x = Math.ceil(a.x);\r\n  out.y = Math.ceil(a.y);\r\n  out.z = Math.ceil(a.z);\r\n  out.w = Math.ceil(a.w);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Math.floor the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to floor\r\n * @returns {vec4} out\r\n */\r\nvec4.floor = function (out, a) {\r\n  out.x = Math.floor(a.x);\r\n  out.y = Math.floor(a.y);\r\n  out.z = Math.floor(a.z);\r\n  out.w = Math.floor(a.w);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the minimum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nvec4.min = function (out, a, b) {\r\n  out.x = Math.min(a.x, b.x);\r\n  out.y = Math.min(a.y, b.y);\r\n  out.z = Math.min(a.z, b.z);\r\n  out.w = Math.min(a.w, b.w);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the maximum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nvec4.max = function (out, a, b) {\r\n  out.x = Math.max(a.x, b.x);\r\n  out.y = Math.max(a.y, b.y);\r\n  out.z = Math.max(a.z, b.z);\r\n  out.w = Math.max(a.w, b.w);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Math.round the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to round\r\n * @returns {vec4} out\r\n */\r\nvec4.round = function (out, a) {\r\n  out.x = Math.round(a.x);\r\n  out.y = Math.round(a.y);\r\n  out.z = Math.round(a.z);\r\n  out.w = Math.round(a.w);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales a vec4 by a scalar number\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec4} out\r\n */\r\nvec4.scale = function (out, a, b) {\r\n  out.x = a.x * b;\r\n  out.y = a.y * b;\r\n  out.z = a.z * b;\r\n  out.w = a.w * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two vec4's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec4} out\r\n */\r\nvec4.scaleAndAdd = function (out, a, b, scale) {\r\n  out.x = a.x + (b.x * scale);\r\n  out.y = a.y + (b.y * scale);\r\n  out.z = a.z + (b.z * scale);\r\n  out.w = a.w + (b.w * scale);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nvec4.distance = function (a, b) {\r\n  var x = b.x - a.x,\r\n    y = b.y - a.y,\r\n    z = b.z - a.z,\r\n    w = b.w - a.w;\r\n  return Math.sqrt(x * x + y * y + z * z + w * w);\r\n};\r\n\r\n/**\r\n * Alias for {@link vec4.distance}\r\n * @function\r\n */\r\nvec4.dist = vec4.distance;\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nvec4.squaredDistance = function (a, b) {\r\n  var x = b.x - a.x,\r\n      y = b.y - a.y,\r\n      z = b.z - a.z,\r\n      w = b.w - a.w;\r\n  return x * x + y * y + z * z + w * w;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec4.squaredDistance}\r\n * @function\r\n */\r\nvec4.sqrDist = vec4.squaredDistance;\r\n\r\n/**\r\n * Calculates the length of a vec4\r\n *\r\n * @param {vec4} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nvec4.length = function (a) {\r\n  var x = a.x,\r\n      y = a.y,\r\n      z = a.z,\r\n      w = a.w;\r\n  return Math.sqrt(x * x + y * y + z * z + w * w);\r\n};\r\n\r\n/**\r\n * Alias for {@link vec4.length}\r\n * @function\r\n */\r\nvec4.len = vec4.length;\r\n\r\n/**\r\n * Calculates the squared length of a vec4\r\n *\r\n * @param {vec4} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nvec4.squaredLength = function (a) {\r\n  var x = a.x,\r\n      y = a.y,\r\n      z = a.z,\r\n      w = a.w;\r\n  return x * x + y * y + z * z + w * w;\r\n};\r\n\r\n/**\r\n * Alias for {@link vec4.squaredLength}\r\n * @function\r\n */\r\nvec4.sqrLen = vec4.squaredLength;\r\n\r\n/**\r\n * Negates the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to negate\r\n * @returns {vec4} out\r\n */\r\nvec4.negate = function (out, a) {\r\n  out.x = -a.x;\r\n  out.y = -a.y;\r\n  out.z = -a.z;\r\n  out.w = -a.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the inverse of the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to invert\r\n * @returns {vec4} out\r\n */\r\nvec4.inverse = function (out, a) {\r\n  out.x = 1.0 / a.x;\r\n  out.y = 1.0 / a.y;\r\n  out.z = 1.0 / a.z;\r\n  out.w = 1.0 / a.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the inverse of the components of a vec4 safely\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to invert\r\n * @returns {vec4} out\r\n */\r\nvec4.inverseSafe = function (out, a) {\r\n  var x = a.x,\r\n      y = a.y,\r\n      z = a.z,\r\n      w = a.w;\r\n\r\n  if (Math.abs(x) < EPSILON) {\r\n    out.x = 0;\r\n  } else {\r\n    out.x = 1.0 / x;\r\n  }\r\n\r\n  if (Math.abs(y) < EPSILON) {\r\n    out.y = 0;\r\n  } else {\r\n    out.y = 1.0 / y;\r\n  }\r\n\r\n  if (Math.abs(z) < EPSILON) {\r\n    out.z = 0;\r\n  } else {\r\n    out.z = 1.0 / z;\r\n  }\r\n\r\n  if (Math.abs(w) < EPSILON) {\r\n    out.w = 0;\r\n  } else {\r\n    out.w = 1.0 / w;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Normalize a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to normalize\r\n * @returns {vec4} out\r\n */\r\nvec4.normalize = function (out, a) {\r\n  var x = a.x,\r\n      y = a.y,\r\n      z = a.z,\r\n      w = a.w;\r\n  var len = x * x + y * y + z * z + w * w;\r\n  if (len > 0) {\r\n    len = 1 / Math.sqrt(len);\r\n    out.x = x * len;\r\n    out.y = y * len;\r\n    out.z = z * len;\r\n    out.w = w * len;\r\n  }\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the dot product of two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nvec4.dot = function (a, b) {\r\n  return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\r\n};\r\n\r\n/**\r\n * Performs a linear interpolation between two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {vec4} out\r\n */\r\nvec4.lerp = function (out, a, b, t) {\r\n  var ax = a.x,\r\n      ay = a.y,\r\n      az = a.z,\r\n      aw = a.w;\r\n  out.x = ax + t * (b.x - ax);\r\n  out.y = ay + t * (b.y - ay);\r\n  out.z = az + t * (b.z - az);\r\n  out.w = aw + t * (b.w - aw);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec4} out\r\n */\r\nvec4.random = function (out, scale) {\r\n  scale = scale || 1.0;\r\n\r\n  //TODO: This is a pretty awful way of doing this. Find something better.\r\n  out.x = random();\r\n  out.y = random();\r\n  out.z = random();\r\n  out.w = random();\r\n  vec4.normalize(out, out);\r\n  vec4.scale(out, out, scale);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec4 with a mat4.\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec4} out\r\n */\r\nvec4.transformMat4 = function (out, a, m) {\r\n  var x = a.x, y = a.y, z = a.z, w = a.w;\r\n  out.x = m.m00 * x + m.m04 * y + m.m08 * z + m.m12 * w;\r\n  out.y = m.m01 * x + m.m05 * y + m.m09 * z + m.m13 * w;\r\n  out.z = m.m02 * x + m.m06 * y + m.m10 * z + m.m14 * w;\r\n  out.w = m.m03 * x + m.m07 * y + m.m11 * z + m.m15 * w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec4 with a quat\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to transform\r\n * @param {quat} q quaternion to transform with\r\n * @returns {vec4} out\r\n */\r\nvec4.transformQuat = function (out, a, q) {\r\n  var x = a.x, y = a.y, z = a.z;\r\n  var qx = q.x, qy = q.y, qz = q.z, qw = q.w;\r\n\r\n  // calculate quat * vec\r\n  var ix = qw * x + qy * z - qz * y;\r\n  var iy = qw * y + qz * x - qx * z;\r\n  var iz = qw * z + qx * y - qy * x;\r\n  var iw = -qx * x - qy * y - qz * z;\r\n\r\n  // calculate result * inverse quat\r\n  out.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n  out.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n  out.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n  out.w = a.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Perform some operation over an array of vec4s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nvec4.forEach = (function () {\r\n  var vec = vec4.create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i, l;\r\n    if (!stride) {\r\n      stride = 4;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min((count * stride) + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec.x = a[i]; vec.y = a[i + 1]; vec.z = a[i + 2]; vec.w = a[i + 3];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec.x; a[i + 1] = vec.y; a[i + 2] = vec.z; a[i + 3] = vec.w;\r\n    }\r\n\r\n    return a;\r\n  };\r\n})();\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec4} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nvec4.str = function (a) {\r\n  return (\"vec4(\" + (a.x) + \", \" + (a.y) + \", \" + (a.z) + \", \" + (a.w) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {vec4} v\r\n * @returns {array}\r\n */\r\nvec4.array = function (out, v) {\r\n  out[0] = v.x;\r\n  out[1] = v.y;\r\n  out[2] = v.z;\r\n  out[3] = v.w;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec4} a The first vector.\r\n * @param {vec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nvec4.exactEquals = function (a, b) {\r\n  return a.x === b.x && a.y === b.y && a.z === b.z && a.w === b.w;\r\n};\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec4} a The first vector.\r\n * @param {vec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nvec4.equals = function (a, b) {\r\n  var a0 = a.x, a1 = a.y, a2 = a.z, a3 = a.w;\r\n  var b0 = b.x, b1 = b.y, b2 = b.z, b3 = b.w;\r\n  return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\r\n    Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\r\n    Math.abs(a3 - b3) <= EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)));\r\n};\r\n\r\nvar _tmp$3 = new Array(9);\r\n\r\nvar _mat3 = function _mat3(m00, m01, m02, m03, m04, m05, m06, m07, m08) {\r\n  this.m00 = m00;\r\n  this.m01 = m01;\r\n  this.m02 = m02;\r\n  this.m03 = m03;\r\n  this.m04 = m04;\r\n  this.m05 = m05;\r\n  this.m06 = m06;\r\n  this.m07 = m07;\r\n  this.m08 = m08;\r\n};\r\n\r\n_mat3.prototype.toJSON = function toJSON () {\r\n  _tmp$3[0] = this.m00;\r\n  _tmp$3[1] = this.m01;\r\n  _tmp$3[2] = this.m02;\r\n  _tmp$3[3] = this.m03;\r\n  _tmp$3[4] = this.m04;\r\n  _tmp$3[5] = this.m05;\r\n  _tmp$3[6] = this.m06;\r\n  _tmp$3[7] = this.m07;\r\n  _tmp$3[8] = this.m08;\r\n\r\n  return _tmp$3;\r\n};\r\n\r\n/**\r\n * @class 3x3 Matrix\r\n * @name mat3\r\n *\r\n * NOTE: we use column-major matrix for all matrix calculation.\r\n *\r\n * This may lead to some confusion when referencing OpenGL documentation,\r\n * however, which represents out all matricies in column-major format.\r\n * This means that while in code a matrix may be typed out as:\r\n *\r\n * [1, 0, 0, 0,\r\n *  0, 1, 0, 0,\r\n *  0, 0, 1, 0,\r\n *  x, y, z, 0]\r\n *\r\n * The same matrix in the [OpenGL documentation](https://www.khronos.org/registry/OpenGL-Refpages/gl2.1/xhtml/glTranslate.xml)\r\n * is written as:\r\n *\r\n *  1 0 0 x\r\n *  0 1 0 y\r\n *  0 0 1 z\r\n *  0 0 0 0\r\n *\r\n * Please rest assured, however, that they are the same thing!\r\n * This is not unique to glMatrix, either, as OpenGL developers have long been confused by the\r\n * apparent lack of consistency between the memory layout and the documentation.\r\n */\r\nvar mat3 = {};\r\n\r\n/**\r\n * Creates a new identity mat3\r\n *\r\n * @returns {mat3} a new 3x3 matrix\r\n */\r\nmat3.create = function () {\r\n  return new _mat3(\r\n    1, 0, 0,\r\n    0, 1, 0,\r\n    0, 0, 1\r\n  );\r\n};\r\n\r\n/**\r\n * Create a new mat3 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\r\n * @returns {mat3} A new mat3\r\n */\r\nmat3.new = function (m00, m01, m02, m10, m11, m12, m20, m21, m22) {\r\n  return new _mat3(\r\n    m00, m01, m02,\r\n    m10, m11, m12,\r\n    m20, m21, m22\r\n  );\r\n};\r\n\r\n/**\r\n * Creates a new mat3 initialized with values from an existing matrix\r\n *\r\n * @param {mat3} a matrix to clone\r\n * @returns {mat3} a new 3x3 matrix\r\n */\r\nmat3.clone = function (a) {\r\n  return new _mat3(\r\n    a.m00, a.m01, a.m02,\r\n    a.m03, a.m04, a.m05,\r\n    a.m06, a.m07, a.m08\r\n  );\r\n};\r\n\r\n/**\r\n * Copy the values from one mat3 to another\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nmat3.copy = function (out, a) {\r\n  out.m00 = a.m00;\r\n  out.m01 = a.m01;\r\n  out.m02 = a.m02;\r\n  out.m03 = a.m03;\r\n  out.m04 = a.m04;\r\n  out.m05 = a.m05;\r\n  out.m06 = a.m06;\r\n  out.m07 = a.m07;\r\n  out.m08 = a.m08;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a mat3 to the given values\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\r\n * @returns {mat3} out\r\n */\r\nmat3.set = function (out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\r\n  out.m00 = m00;\r\n  out.m01 = m01;\r\n  out.m02 = m02;\r\n  out.m03 = m10;\r\n  out.m04 = m11;\r\n  out.m05 = m12;\r\n  out.m06 = m20;\r\n  out.m07 = m21;\r\n  out.m08 = m22;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set a mat3 to the identity matrix\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @returns {mat3} out\r\n */\r\nmat3.identity = function (out) {\r\n  out.m00 = 1;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 1;\r\n  out.m05 = 0;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transpose the values of a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nmat3.transpose = function (out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\r\n  if (out === a) {\r\n    var a01 = a.m01, a02 = a.m02, a12 = a.m05;\r\n    out.m01 = a.m03;\r\n    out.m02 = a.m06;\r\n    out.m03 = a01;\r\n    out.m05 = a.m07;\r\n    out.m06 = a02;\r\n    out.m07 = a12;\r\n  } else {\r\n    out.m00 = a.m00;\r\n    out.m01 = a.m03;\r\n    out.m02 = a.m06;\r\n    out.m03 = a.m01;\r\n    out.m04 = a.m04;\r\n    out.m05 = a.m07;\r\n    out.m06 = a.m02;\r\n    out.m07 = a.m05;\r\n    out.m08 = a.m08;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Inverts a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nmat3.invert = function (out, a) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02,\r\n      a10 = a.m03, a11 = a.m04, a12 = a.m05,\r\n      a20 = a.m06, a21 = a.m07, a22 = a.m08;\r\n\r\n  var b01 = a22 * a11 - a12 * a21;\r\n  var b11 = -a22 * a10 + a12 * a20;\r\n  var b21 = a21 * a10 - a11 * a20;\r\n\r\n  // Calculate the determinant\r\n  var det = a00 * b01 + a01 * b11 + a02 * b21;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out.m00 = b01 * det;\r\n  out.m01 = (-a22 * a01 + a02 * a21) * det;\r\n  out.m02 = (a12 * a01 - a02 * a11) * det;\r\n  out.m03 = b11 * det;\r\n  out.m04 = (a22 * a00 - a02 * a20) * det;\r\n  out.m05 = (-a12 * a00 + a02 * a10) * det;\r\n  out.m06 = b21 * det;\r\n  out.m07 = (-a21 * a00 + a01 * a20) * det;\r\n  out.m08 = (a11 * a00 - a01 * a10) * det;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the adjugate of a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nmat3.adjoint = function (out, a) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02,\r\n      a10 = a.m03, a11 = a.m04, a12 = a.m05,\r\n      a20 = a.m06, a21 = a.m07, a22 = a.m08;\r\n\r\n  out.m00 = (a11 * a22 - a12 * a21);\r\n  out.m01 = (a02 * a21 - a01 * a22);\r\n  out.m02 = (a01 * a12 - a02 * a11);\r\n  out.m03 = (a12 * a20 - a10 * a22);\r\n  out.m04 = (a00 * a22 - a02 * a20);\r\n  out.m05 = (a02 * a10 - a00 * a12);\r\n  out.m06 = (a10 * a21 - a11 * a20);\r\n  out.m07 = (a01 * a20 - a00 * a21);\r\n  out.m08 = (a00 * a11 - a01 * a10);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the determinant of a mat3\r\n *\r\n * @param {mat3} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nmat3.determinant = function (a) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02,\r\n      a10 = a.m03, a11 = a.m04, a12 = a.m05,\r\n      a20 = a.m06, a21 = a.m07, a22 = a.m08;\r\n\r\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\r\n};\r\n\r\n/**\r\n * Multiplies two mat3's\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nmat3.multiply = function (out, a, b) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02,\r\n      a10 = a.m03, a11 = a.m04, a12 = a.m05,\r\n      a20 = a.m06, a21 = a.m07, a22 = a.m08;\r\n\r\n  var b00 = b.m00, b01 = b.m01, b02 = b.m02;\r\n  var b10 = b.m03, b11 = b.m04, b12 = b.m05;\r\n  var b20 = b.m06, b21 = b.m07, b22 = b.m08;\r\n\r\n  out.m00 = b00 * a00 + b01 * a10 + b02 * a20;\r\n  out.m01 = b00 * a01 + b01 * a11 + b02 * a21;\r\n  out.m02 = b00 * a02 + b01 * a12 + b02 * a22;\r\n\r\n  out.m03 = b10 * a00 + b11 * a10 + b12 * a20;\r\n  out.m04 = b10 * a01 + b11 * a11 + b12 * a21;\r\n  out.m05 = b10 * a02 + b11 * a12 + b12 * a22;\r\n\r\n  out.m06 = b20 * a00 + b21 * a10 + b22 * a20;\r\n  out.m07 = b20 * a01 + b21 * a11 + b22 * a21;\r\n  out.m08 = b20 * a02 + b21 * a12 + b22 * a22;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link mat3.multiply}\r\n * @function\r\n */\r\nmat3.mul = mat3.multiply;\r\n\r\n/**\r\n * Translate a mat3 by the given vector\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to translate\r\n * @param {vec2} v vector to translate by\r\n * @returns {mat3} out\r\n */\r\nmat3.translate = function (out, a, v) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02,\r\n      a10 = a.m03, a11 = a.m04, a12 = a.m05,\r\n      a20 = a.m06, a21 = a.m07, a22 = a.m08;\r\n  var x = v.x, y = v.y;\r\n\r\n  out.m00 = a00;\r\n  out.m01 = a01;\r\n  out.m02 = a02;\r\n\r\n  out.m03 = a10;\r\n  out.m04 = a11;\r\n  out.m05 = a12;\r\n\r\n  out.m06 = x * a00 + y * a10 + a20;\r\n  out.m07 = x * a01 + y * a11 + a21;\r\n  out.m08 = x * a02 + y * a12 + a22;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotates a mat3 by the given angle\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat3} out\r\n */\r\nmat3.rotate = function (out, a, rad) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02,\r\n      a10 = a.m03, a11 = a.m04, a12 = a.m05,\r\n      a20 = a.m06, a21 = a.m07, a22 = a.m08;\r\n\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n\r\n  out.m00 = c * a00 + s * a10;\r\n  out.m01 = c * a01 + s * a11;\r\n  out.m02 = c * a02 + s * a12;\r\n\r\n  out.m03 = c * a10 - s * a00;\r\n  out.m04 = c * a11 - s * a01;\r\n  out.m05 = c * a12 - s * a02;\r\n\r\n  out.m06 = a20;\r\n  out.m07 = a21;\r\n  out.m08 = a22;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales the mat3 by the dimensions in the given vec2\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to rotate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat3} out\r\n **/\r\nmat3.scale = function (out, a, v) {\r\n  var x = v.x, y = v.y;\r\n\r\n  out.m00 = x * a.m00;\r\n  out.m01 = x * a.m01;\r\n  out.m02 = x * a.m02;\r\n\r\n  out.m03 = y * a.m03;\r\n  out.m04 = y * a.m04;\r\n  out.m05 = y * a.m05;\r\n\r\n  out.m06 = a.m06;\r\n  out.m07 = a.m07;\r\n  out.m08 = a.m08;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Copies the upper-left 3x3 values into the given mat3.\r\n *\r\n * @param {mat3} out the receiving 3x3 matrix\r\n * @param {mat4} a   the source 4x4 matrix\r\n * @returns {mat3} out\r\n */\r\nmat3.fromMat4 = function (out, a) {\r\n  out.m00 = a.m00;\r\n  out.m01 = a.m01;\r\n  out.m02 = a.m02;\r\n  out.m03 = a.m04;\r\n  out.m04 = a.m05;\r\n  out.m05 = a.m06;\r\n  out.m06 = a.m08;\r\n  out.m07 = a.m09;\r\n  out.m08 = a.m10;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.translate(dest, dest, vec);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {vec2} v Translation vector\r\n * @returns {mat3} out\r\n */\r\nmat3.fromTranslation = function (out, v) {\r\n  out.m00 = 1;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 1;\r\n  out.m05 = 0;\r\n  out.m06 = v.x;\r\n  out.m07 = v.y;\r\n  out.m08 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.rotate(dest, dest, rad);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat3} out\r\n */\r\nmat3.fromRotation = function (out, rad) {\r\n  var s = Math.sin(rad), c = Math.cos(rad);\r\n\r\n  out.m00 = c;\r\n  out.m01 = s;\r\n  out.m02 = 0;\r\n\r\n  out.m03 = -s;\r\n  out.m04 = c;\r\n  out.m05 = 0;\r\n\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.scale(dest, dest, vec);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat3} out\r\n */\r\nmat3.fromScaling = function (out, v) {\r\n  out.m00 = v.x;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n\r\n  out.m03 = 0;\r\n  out.m04 = v.y;\r\n  out.m05 = 0;\r\n\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Copies the values from a mat2d into a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat2d} a the matrix to copy\r\n * @returns {mat3} out\r\n **/\r\nmat3.fromMat2d = function (out, a) {\r\n  out.m00 = a.m00;\r\n  out.m01 = a.m01;\r\n  out.m02 = 0;\r\n\r\n  out.m03 = a.m02;\r\n  out.m04 = a.m03;\r\n  out.m05 = 0;\r\n\r\n  out.m06 = a.m04;\r\n  out.m07 = a.m05;\r\n  out.m08 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n* Calculates a 3x3 matrix from the given quaternion\r\n*\r\n* @param {mat3} out mat3 receiving operation result\r\n* @param {quat} q Quaternion to create matrix from\r\n*\r\n* @returns {mat3} out\r\n*/\r\nmat3.fromQuat = function (out, q) {\r\n  var x = q.x, y = q.y, z = q.z, w = q.w;\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var yx = y * x2;\r\n  var yy = y * y2;\r\n  var zx = z * x2;\r\n  var zy = z * y2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out.m00 = 1 - yy - zz;\r\n  out.m03 = yx - wz;\r\n  out.m06 = zx + wy;\r\n\r\n  out.m01 = yx + wz;\r\n  out.m04 = 1 - xx - zz;\r\n  out.m07 = zy - wx;\r\n\r\n  out.m02 = zx - wy;\r\n  out.m05 = zy + wx;\r\n  out.m08 = 1 - xx - yy;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n* Calculates a 3x3 matrix from view direction and up direction\r\n*\r\n* @param {mat3} out mat3 receiving operation result\r\n* @param {vec3} view view direction (must be normalized)\r\n* @param {vec3} [up] up direction, default is (0,1,0) (must be normalized)\r\n*\r\n* @returns {mat3} out\r\n*/\r\nmat3.fromViewUp = (function () {\r\n  var default_up = vec3.new(0, 1, 0);\r\n  var x = vec3.create();\r\n  var y = vec3.create();\r\n\r\n  return function (out, view, up) {\r\n    if (vec3.sqrLen(view) < EPSILON * EPSILON) {\r\n      mat3.identity(out);\r\n      return out;\r\n    }\r\n\r\n    up = up || default_up;\r\n    vec3.cross(x, up, view);\r\n\r\n    if (vec3.sqrLen(x) < EPSILON * EPSILON) {\r\n      mat3.identity(out);\r\n      return out;\r\n    }\r\n\r\n    vec3.cross(y, view, x);\r\n    mat3.set(out,\r\n      x.x, x.y, x.z,\r\n      y.x, y.y, y.z,\r\n      view.x, view.y, view.z\r\n    );\r\n\r\n    return out;\r\n  };\r\n})();\r\n\r\n/**\r\n* Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\r\n*\r\n* @param {mat3} out mat3 receiving operation result\r\n* @param {mat4} a Mat4 to derive the normal matrix from\r\n*\r\n* @returns {mat3} out\r\n*/\r\nmat3.normalFromMat4 = function (out, a) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02, a03 = a.m03,\r\n      a10 = a.m04, a11 = a.m05, a12 = a.m06, a13 = a.m07,\r\n      a20 = a.m08, a21 = a.m09, a22 = a.m10, a23 = a.m11,\r\n      a30 = a.m12, a31 = a.m13, a32 = a.m14, a33 = a.m15;\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out.m00 = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n  out.m01 = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n  out.m02 = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n\r\n  out.m03 = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n  out.m04 = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n  out.m05 = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n\r\n  out.m06 = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n  out.m07 = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n  out.m08 = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a string representation of a mat3\r\n *\r\n * @param {mat3} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nmat3.str = function (a) {\r\n  return (\"mat3(\" + (a.m00) + \", \" + (a.m01) + \", \" + (a.m02) + \", \" + (a.m03) + \", \" + (a.m04) + \", \" + (a.m05) + \", \" + (a.m06) + \", \" + (a.m07) + \", \" + (a.m08) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {mat3} m\r\n * @returns {array}\r\n */\r\nmat3.array = function (out, m) {\r\n  out[0] = m.m00;\r\n  out[1] = m.m01;\r\n  out[2] = m.m02;\r\n  out[3] = m.m03;\r\n  out[4] = m.m04;\r\n  out[5] = m.m05;\r\n  out[6] = m.m06;\r\n  out[7] = m.m07;\r\n  out[8] = m.m08;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns Frobenius norm of a mat3\r\n *\r\n * @param {mat3} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nmat3.frob = function (a) {\r\n  return (Math.sqrt(Math.pow(a.m00, 2) + Math.pow(a.m01, 2) + Math.pow(a.m02, 2) + Math.pow(a.m03, 2) + Math.pow(a.m04, 2) + Math.pow(a.m05, 2) + Math.pow(a.m06, 2) + Math.pow(a.m07, 2) + Math.pow(a.m08, 2)));\r\n};\r\n\r\n/**\r\n * Adds two mat3's\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nmat3.add = function (out, a, b) {\r\n  out.m00 = a.m00 + b.m00;\r\n  out.m01 = a.m01 + b.m01;\r\n  out.m02 = a.m02 + b.m02;\r\n  out.m03 = a.m03 + b.m03;\r\n  out.m04 = a.m04 + b.m04;\r\n  out.m05 = a.m05 + b.m05;\r\n  out.m06 = a.m06 + b.m06;\r\n  out.m07 = a.m07 + b.m07;\r\n  out.m08 = a.m08 + b.m08;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nmat3.subtract = function (out, a, b) {\r\n  out.m00 = a.m00 - b.m00;\r\n  out.m01 = a.m01 - b.m01;\r\n  out.m02 = a.m02 - b.m02;\r\n  out.m03 = a.m03 - b.m03;\r\n  out.m04 = a.m04 - b.m04;\r\n  out.m05 = a.m05 - b.m05;\r\n  out.m06 = a.m06 - b.m06;\r\n  out.m07 = a.m07 - b.m07;\r\n  out.m08 = a.m08 - b.m08;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link mat3.subtract}\r\n * @function\r\n */\r\nmat3.sub = mat3.subtract;\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat3} out\r\n */\r\nmat3.multiplyScalar = function (out, a, b) {\r\n  out.m00 = a.m00 * b;\r\n  out.m01 = a.m01 * b;\r\n  out.m02 = a.m02 * b;\r\n  out.m03 = a.m03 * b;\r\n  out.m04 = a.m04 * b;\r\n  out.m05 = a.m05 * b;\r\n  out.m06 = a.m06 * b;\r\n  out.m07 = a.m07 * b;\r\n  out.m08 = a.m08 * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat3} out the receiving vector\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat3} out\r\n */\r\nmat3.multiplyScalarAndAdd = function (out, a, b, scale) {\r\n  out.m00 = a.m00 + (b.m00 * scale);\r\n  out.m01 = a.m01 + (b.m01 * scale);\r\n  out.m02 = a.m02 + (b.m02 * scale);\r\n  out.m03 = a.m03 + (b.m03 * scale);\r\n  out.m04 = a.m04 + (b.m04 * scale);\r\n  out.m05 = a.m05 + (b.m05 * scale);\r\n  out.m06 = a.m06 + (b.m06 * scale);\r\n  out.m07 = a.m07 + (b.m07 * scale);\r\n  out.m08 = a.m08 + (b.m08 * scale);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat3} a The first matrix.\r\n * @param {mat3} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nmat3.exactEquals = function (a, b) {\r\n  return a.m00 === b.m00 && a.m01 === b.m01 && a.m02 === b.m02 &&\r\n    a.m03 === b.m03 && a.m04 === b.m04 && a.m05 === b.m05 &&\r\n    a.m06 === b.m06 && a.m07 === b.m07 && a.m08 === b.m08;\r\n};\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat3} a The first matrix.\r\n * @param {mat3} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nmat3.equals = function (a, b) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03, a4 = a.m04, a5 = a.m05, a6 = a.m06, a7 = a.m07, a8 = a.m08;\r\n  var b0 = b.m00, b1 = b.m01, b2 = b.m02, b3 = b.m03, b4 = b.m04, b5 = b.m05, b6 = b.m06, b7 = b.m07, b8 = b.m08;\r\n  return (\r\n    Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\r\n    Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\r\n    Math.abs(a3 - b3) <= EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) &&\r\n    Math.abs(a4 - b4) <= EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) &&\r\n    Math.abs(a5 - b5) <= EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) &&\r\n    Math.abs(a6 - b6) <= EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) &&\r\n    Math.abs(a7 - b7) <= EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) &&\r\n    Math.abs(a8 - b8) <= EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8))\r\n  );\r\n};\r\n\r\nvar _tmp$4 = new Array(4);\r\n\r\nvar _quat = function _quat(x, y, z, w) {\r\n  this.x = x;\r\n  this.y = y;\r\n  this.z = z;\r\n  this.w = w;\r\n};\r\n\r\n_quat.prototype.toJSON = function toJSON () {\r\n  _tmp$4[0] = this.x;\r\n  _tmp$4[1] = this.y;\r\n  _tmp$4[2] = this.z;\r\n  _tmp$4[3] = this.w;\r\n\r\n  return _tmp$4;\r\n};\r\n\r\n/**\r\n * @class Quaternion\r\n * @name quat\r\n */\r\nvar quat = {};\r\n\r\n/**\r\n * Creates a new identity quat\r\n *\r\n * @returns {quat} a new quaternion\r\n */\r\nquat.create = function () {\r\n  return new _quat(0, 0, 0, 1);\r\n};\r\n\r\n/**\r\n * Creates a new quat initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {quat} a new quaternion\r\n * @function\r\n */\r\nquat.new = function (x, y, z, w) {\r\n  return new _quat(x, y, z, w);\r\n};\r\n\r\n/**\r\n * Creates a new quat initialized with values from an existing quaternion\r\n *\r\n * @param {quat} a quaternion to clone\r\n * @returns {quat} a new quaternion\r\n * @function\r\n */\r\nquat.clone = function (a) {\r\n  return new _quat(a.x, a.y, a.z, a.w);\r\n};\r\n\r\n/**\r\n * Copy the values from one quat to another\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the source quaternion\r\n * @returns {quat} out\r\n * @function\r\n */\r\nquat.copy = vec4.copy;\r\n\r\n/**\r\n * Set the components of a quat to the given values\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {quat} out\r\n * @function\r\n */\r\nquat.set = vec4.set;\r\n\r\n/**\r\n * Set a quat to the identity quaternion\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @returns {quat} out\r\n */\r\nquat.identity = function (out) {\r\n  out.x = 0;\r\n  out.y = 0;\r\n  out.z = 0;\r\n  out.w = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Sets a quaternion to represent the shortest rotation from one\r\n * vector to another.\r\n *\r\n * Both vectors are assumed to be unit length.\r\n *\r\n * @param {quat} out the receiving quaternion.\r\n * @param {vec3} a the initial vector\r\n * @param {vec3} b the destination vector\r\n * @returns {quat} out\r\n */\r\nquat.rotationTo = (function () {\r\n  var tmpvec3 = vec3.create();\r\n  var xUnitVec3 = vec3.new(1, 0, 0);\r\n  var yUnitVec3 = vec3.new(0, 1, 0);\r\n\r\n  return function (out, a, b) {\r\n    var dot = vec3.dot(a, b);\r\n    if (dot < -0.999999) {\r\n      vec3.cross(tmpvec3, xUnitVec3, a);\r\n      if (vec3.length(tmpvec3) < 0.000001) {\r\n        vec3.cross(tmpvec3, yUnitVec3, a);\r\n      }\r\n      vec3.normalize(tmpvec3, tmpvec3);\r\n      quat.fromAxisAngle(out, tmpvec3, Math.PI);\r\n      return out;\r\n    } else if (dot > 0.999999) {\r\n      out.x = 0;\r\n      out.y = 0;\r\n      out.z = 0;\r\n      out.w = 1;\r\n      return out;\r\n    } else {\r\n      vec3.cross(tmpvec3, a, b);\r\n      out.x = tmpvec3.x;\r\n      out.y = tmpvec3.y;\r\n      out.z = tmpvec3.z;\r\n      out.w = 1 + dot;\r\n      return quat.normalize(out, out);\r\n    }\r\n  };\r\n})();\r\n\r\n/**\r\n * Gets the rotation axis and angle for a given\r\n *  quaternion. If a quaternion is created with\r\n *  fromAxisAngle, this method will return the same\r\n *  values as providied in the original parameter list\r\n *  OR functionally equivalent values.\r\n * Example: The quaternion formed by axis [0, 0, 1] and\r\n *  angle -90 is the same as the quaternion formed by\r\n *  [0, 0, 1] and 270. This method favors the latter.\r\n * @param  {vec3} out_axis  Vector receiving the axis of rotation\r\n * @param  {quat} q     Quaternion to be decomposed\r\n * @return {Number}     Angle, in radians, of the rotation\r\n */\r\nquat.getAxisAngle = function (out_axis, q) {\r\n  var rad = Math.acos(q.w) * 2.0;\r\n  var s = Math.sin(rad / 2.0);\r\n  if (s != 0.0) {\r\n    out_axis.x = q.x / s;\r\n    out_axis.y = q.y / s;\r\n    out_axis.z = q.z / s;\r\n  } else {\r\n    // If s is zero, return any axis (no rotation - axis does not matter)\r\n    out_axis.x = 1;\r\n    out_axis.y = 0;\r\n    out_axis.z = 0;\r\n  }\r\n  return rad;\r\n};\r\n\r\n/**\r\n * Multiplies two quat's\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @returns {quat} out\r\n */\r\nquat.multiply = function (out, a, b) {\r\n  var ax = a.x, ay = a.y, az = a.z, aw = a.w,\r\n      bx = b.x, by = b.y, bz = b.z, bw = b.w;\r\n\r\n  out.x = ax * bw + aw * bx + ay * bz - az * by;\r\n  out.y = ay * bw + aw * by + az * bx - ax * bz;\r\n  out.z = az * bw + aw * bz + ax * by - ay * bx;\r\n  out.w = aw * bw - ax * bx - ay * by - az * bz;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link quat.multiply}\r\n * @function\r\n */\r\nquat.mul = quat.multiply;\r\n\r\n/**\r\n * Scales a quat by a scalar number\r\n *\r\n * @param {quat} out the receiving vector\r\n * @param {quat} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {quat} out\r\n * @function\r\n */\r\nquat.scale = vec4.scale;\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the X axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nquat.rotateX = function (out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a.x, ay = a.y, az = a.z, aw = a.w,\r\n      bx = Math.sin(rad), bw = Math.cos(rad);\r\n\r\n  out.x = ax * bw + aw * bx;\r\n  out.y = ay * bw + az * bx;\r\n  out.z = az * bw - ay * bx;\r\n  out.w = aw * bw - ax * bx;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the Y axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nquat.rotateY = function (out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a.x, ay = a.y, az = a.z, aw = a.w,\r\n      by = Math.sin(rad), bw = Math.cos(rad);\r\n\r\n  out.x = ax * bw - az * by;\r\n  out.y = ay * bw + aw * by;\r\n  out.z = az * bw + ax * by;\r\n  out.w = aw * bw - ay * by;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the Z axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nquat.rotateZ = function (out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a.x, ay = a.y, az = a.z, aw = a.w,\r\n      bz = Math.sin(rad), bw = Math.cos(rad);\r\n\r\n  out.x = ax * bw + ay * bz;\r\n  out.y = ay * bw - ax * bz;\r\n  out.z = az * bw + aw * bz;\r\n  out.w = aw * bw - az * bz;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the axis in world space\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} rot quat to rotate\r\n * @param {vec3} axis the axis around which to rotate in world space\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nquat.rotateAround = (function () {\r\n  var v3_tmp = vec3.create();\r\n  var q_tmp = quat.create();\r\n\r\n  return function (out, rot, axis, rad) {\r\n    // get inv-axis (local to rot)\r\n    quat.invert(q_tmp, rot);\r\n    vec3.transformQuat(v3_tmp, axis, q_tmp);\r\n    // rotate by inv-axis\r\n    quat.fromAxisAngle(q_tmp, v3_tmp, rad);\r\n    quat.mul(out, rot, q_tmp);\r\n\r\n    return out;\r\n  };\r\n})();\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the axis in local space\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} rot quat to rotate\r\n * @param {vec3} axis the axis around which to rotate in local space\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nquat.rotateAroundLocal = (function () {\r\n  var q_tmp = quat.create();\r\n\r\n  return function (out, rot, axis, rad) {\r\n    quat.fromAxisAngle(q_tmp, axis, rad);\r\n    quat.mul(out, rot, q_tmp);\r\n\r\n    return out;\r\n  };\r\n})();\r\n\r\n/**\r\n * Calculates the W component of a quat from the X, Y, and Z components.\r\n * Assumes that quaternion is 1 unit in length.\r\n * Any existing W component will be ignored.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate W component of\r\n * @returns {quat} out\r\n */\r\nquat.calculateW = function (out, a) {\r\n  var x = a.x, y = a.y, z = a.z;\r\n\r\n  out.x = x;\r\n  out.y = y;\r\n  out.z = z;\r\n  out.w = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the dot product of two quat's\r\n *\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @returns {Number} dot product of a and b\r\n * @function\r\n */\r\nquat.dot = vec4.dot;\r\n\r\n/**\r\n * Performs a linear interpolation between two quat's\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {quat} out\r\n * @function\r\n */\r\nquat.lerp = vec4.lerp;\r\n\r\n/**\r\n * Performs a spherical linear interpolation between two quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {quat} out\r\n */\r\nquat.slerp = function (out, a, b, t) {\r\n  // benchmarks:\r\n  //    http://jsperf.com/quaternion-slerp-implementations\r\n\r\n  var ax = a.x, ay = a.y, az = a.z, aw = a.w,\r\n      bx = b.x, by = b.y, bz = b.z, bw = b.w;\r\n\r\n  var omega, cosom, sinom, scale0, scale1;\r\n\r\n  // calc cosine\r\n  cosom = ax * bx + ay * by + az * bz + aw * bw;\r\n  // adjust signs (if necessary)\r\n  if (cosom < 0.0) {\r\n    cosom = -cosom;\r\n    bx = - bx;\r\n    by = - by;\r\n    bz = - bz;\r\n    bw = - bw;\r\n  }\r\n  // calculate coefficients\r\n  if ((1.0 - cosom) > 0.000001) {\r\n    // standard case (slerp)\r\n    omega = Math.acos(cosom);\r\n    sinom = Math.sin(omega);\r\n    scale0 = Math.sin((1.0 - t) * omega) / sinom;\r\n    scale1 = Math.sin(t * omega) / sinom;\r\n  } else {\r\n    // \"from\" and \"to\" quaternions are very close\r\n    //  ... so we can do a linear interpolation\r\n    scale0 = 1.0 - t;\r\n    scale1 = t;\r\n  }\r\n  // calculate final values\r\n  out.x = scale0 * ax + scale1 * bx;\r\n  out.y = scale0 * ay + scale1 * by;\r\n  out.z = scale0 * az + scale1 * bz;\r\n  out.w = scale0 * aw + scale1 * bw;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Performs a spherical linear interpolation with two control points\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {quat} c the third operand\r\n * @param {quat} d the fourth operand\r\n * @param {Number} t interpolation amount\r\n * @returns {quat} out\r\n */\r\nquat.sqlerp = (function () {\r\n  var temp1 = quat.create();\r\n  var temp2 = quat.create();\r\n\r\n  return function (out, a, b, c, d, t) {\r\n    quat.slerp(temp1, a, d, t);\r\n    quat.slerp(temp2, b, c, t);\r\n    quat.slerp(out, temp1, temp2, 2 * t * (1 - t));\r\n\r\n    return out;\r\n  };\r\n}());\r\n\r\n/**\r\n * Calculates the inverse of a quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate inverse of\r\n * @returns {quat} out\r\n */\r\nquat.invert = function (out, a) {\r\n  var a0 = a.x, a1 = a.y, a2 = a.z, a3 = a.w;\r\n  var dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\r\n  var invDot = dot ? 1.0 / dot : 0;\r\n\r\n  // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\r\n\r\n  out.x = -a0 * invDot;\r\n  out.y = -a1 * invDot;\r\n  out.z = -a2 * invDot;\r\n  out.w = a3 * invDot;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the conjugate of a quat\r\n * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate conjugate of\r\n * @returns {quat} out\r\n */\r\nquat.conjugate = function (out, a) {\r\n  out.x = -a.x;\r\n  out.y = -a.y;\r\n  out.z = -a.z;\r\n  out.w = a.w;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the length of a quat\r\n *\r\n * @param {quat} a vector to calculate length of\r\n * @returns {Number} length of a\r\n * @function\r\n */\r\nquat.length = vec4.length;\r\n\r\n/**\r\n * Alias for {@link quat.length}\r\n * @function\r\n */\r\nquat.len = quat.length;\r\n\r\n/**\r\n * Calculates the squared length of a quat\r\n *\r\n * @param {quat} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n * @function\r\n */\r\nquat.squaredLength = vec4.squaredLength;\r\n\r\n/**\r\n * Alias for {@link quat.squaredLength}\r\n * @function\r\n */\r\nquat.sqrLen = quat.squaredLength;\r\n\r\n/**\r\n * Normalize a quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quaternion to normalize\r\n * @returns {quat} out\r\n * @function\r\n */\r\nquat.normalize = vec4.normalize;\r\n\r\n/**\r\n * Sets the specified quaternion with values corresponding to the given\r\n * axes. Each axis is a vec3 and is expected to be unit length and\r\n * perpendicular to all other specified axes.\r\n *\r\n * @param {vec3} xAxis the vector representing the local \"right\" direction\r\n * @param {vec3} yAxis the vector representing the local \"up\" direction\r\n * @param {vec3} zAxis the vector representing the viewing direction\r\n * @returns {quat} out\r\n */\r\nquat.fromAxes = (function () {\r\n  var matr = mat3.create();\r\n\r\n  return function (out, xAxis, yAxis, zAxis) {\r\n    mat3.set(\r\n      matr,\r\n      xAxis.x, xAxis.y, xAxis.z,\r\n      yAxis.x, yAxis.y, yAxis.z,\r\n      zAxis.x, zAxis.y, zAxis.z\r\n    );\r\n    return quat.normalize(out, quat.fromMat3(out, matr));\r\n  };\r\n})();\r\n\r\n/**\r\n* Calculates a quaternion from view direction and up direction\r\n*\r\n* @param {quat} out mat3 receiving operation result\r\n* @param {vec3} view view direction (must be normalized)\r\n* @param {vec3} [up] up direction, default is (0,1,0) (must be normalized)\r\n*\r\n* @returns {quat} out\r\n*/\r\nquat.fromViewUp = (function () {\r\n  var matr = mat3.create();\r\n\r\n  return function (out, view, up) {\r\n    mat3.fromViewUp(matr, view, up);\r\n    if (!matr) {\r\n      return null;\r\n    }\r\n\r\n    return quat.normalize(out, quat.fromMat3(out, matr));\r\n  };\r\n})();\r\n\r\n/**\r\n * Sets a quat from the given angle and rotation axis,\r\n * then returns it.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {vec3} axis the axis around which to rotate\r\n * @param {Number} rad the angle in radians\r\n * @returns {quat} out\r\n **/\r\nquat.fromAxisAngle = function (out, axis, rad) {\r\n  rad = rad * 0.5;\r\n  var s = Math.sin(rad);\r\n  out.x = s * axis.x;\r\n  out.y = s * axis.y;\r\n  out.z = s * axis.z;\r\n  out.w = Math.cos(rad);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a quaternion from the given 3x3 rotation matrix.\r\n *\r\n * NOTE: The resultant quaternion is not normalized, so you should be sure\r\n * to renormalize the quaternion yourself where necessary.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {mat3} m rotation matrix\r\n * @returns {quat} out\r\n * @function\r\n */\r\nquat.fromMat3 = function (out, m) {\r\n  // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n  var m00 = m.m00, m01 = m.m03, m02 = m.m06,\r\n      m10 = m.m01, m11 = m.m04, m12 = m.m07,\r\n      m20 = m.m02, m21 = m.m05, m22 = m.m08;\r\n\r\n  var trace = m00 + m11 + m22;\r\n\r\n  if (trace > 0) {\r\n    var s = 0.5 / Math.sqrt(trace + 1.0);\r\n\r\n    out.w = 0.25 / s;\r\n    out.x = (m21 - m12) * s;\r\n    out.y = (m02 - m20) * s;\r\n    out.z = (m10 - m01) * s;\r\n\r\n  } else if ((m00 > m11) && (m00 > m22)) {\r\n    var s$1 = 2.0 * Math.sqrt(1.0 + m00 - m11 - m22);\r\n\r\n    out.w = (m21 - m12) / s$1;\r\n    out.x = 0.25 * s$1;\r\n    out.y = (m01 + m10) / s$1;\r\n    out.z = (m02 + m20) / s$1;\r\n\r\n  } else if (m11 > m22) {\r\n    var s$2 = 2.0 * Math.sqrt(1.0 + m11 - m00 - m22);\r\n\r\n    out.w = (m02 - m20) / s$2;\r\n    out.x = (m01 + m10) / s$2;\r\n    out.y = 0.25 * s$2;\r\n    out.z = (m12 + m21) / s$2;\r\n\r\n  } else {\r\n    var s$3 = 2.0 * Math.sqrt(1.0 + m22 - m00 - m11);\r\n\r\n    out.w = (m10 - m01) / s$3;\r\n    out.x = (m02 + m20) / s$3;\r\n    out.y = (m12 + m21) / s$3;\r\n    out.z = 0.25 * s$3;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a quaternion from the given euler angle x, y, z.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {x} Angle to rotate around X axis in degrees.\r\n * @param {y} Angle to rotate around Y axis in degrees.\r\n * @param {z} Angle to rotate around Z axis in degrees.\r\n * @returns {quat} out\r\n * @function\r\n */\r\nquat.fromEuler = function (out, x, y, z) {\r\n  var halfToRad = 0.5 * Math.PI / 180.0;\r\n  x *= halfToRad;\r\n  y *= halfToRad;\r\n  z *= halfToRad;\r\n\r\n  var sx = Math.sin(x);\r\n  var cx = Math.cos(x);\r\n  var sy = Math.sin(y);\r\n  var cy = Math.cos(y);\r\n  var sz = Math.sin(z);\r\n  var cz = Math.cos(z);\r\n\r\n  out.x = sx * cy * cz + cx * sy * sz;\r\n  out.y = cx * sy * cz + sx * cy * sz;\r\n  out.z = cx * cy * sz - sx * sy * cz;\r\n  out.w = cx * cy * cz - sx * sy * sz;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Convert a quaternion back to euler angle (in degrees).\r\n *\r\n * @param {vec3} out - Euler angle stored as a vec3\r\n * @param {number} q - the quaternion to be converted\r\n * @returns {vec3} out.\r\n */\r\nquat.toEuler = function (out, q) {\r\n  var x = q.x, y = q.y, z = q.z, w = q.w;\r\n  var heading, attitude, bank;\r\n  var test = x * y + z * w;\r\n  if (test > 0.499) { // singularity at north pole\r\n    heading = 2 * Math.atan2(x,w);\r\n    attitude = Math.PI/2;\r\n    bank = 0;\r\n  }\r\n  if (test < -0.499) { // singularity at south pole\r\n    heading = -2 * Math.atan2(x,w);\r\n    attitude = - Math.PI/2;\r\n    bank = 0;\r\n  }\r\n  if(isNaN(heading)){\r\n    var sqx = x*x;\r\n    var sqy = y*y;\r\n    var sqz = z*z;\r\n    heading = Math.atan2(2*y*w - 2*x*z , 1 - 2*sqy - 2*sqz); // heading\r\n    attitude = Math.asin(2*test); // attitude\r\n    bank = Math.atan2(2*x*w - 2*y*z , 1 - 2*sqx - 2*sqz); // bank\r\n  }\r\n\r\n  out.y = toDegree(heading);\r\n  out.z = toDegree(attitude);\r\n  out.x = toDegree(bank);\r\n\r\n  return out;\r\n}\r\n\r\n\r\n/**\r\n * Returns a string representation of a quatenion\r\n *\r\n * @param {quat} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nquat.str = function (a) {\r\n  return (\"quat(\" + (a.x) + \", \" + (a.y) + \", \" + (a.z) + \", \" + (a.w) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {quat} q\r\n * @returns {array}\r\n */\r\nquat.array = function (out, q) {\r\n  out[0] = q.x;\r\n  out[1] = q.y;\r\n  out[2] = q.z;\r\n  out[3] = q.w;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {quat} a The first quaternion.\r\n * @param {quat} b The second quaternion.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nquat.exactEquals = vec4.exactEquals;\r\n\r\n/**\r\n * Returns whether or not the quaternions have approximately the same elements in the same position.\r\n *\r\n * @param {quat} a The first vector.\r\n * @param {quat} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nquat.equals = vec4.equals;\r\n\r\nvar _tmp$5 = new Array(4);\r\n\r\nvar _mat2 = function _mat2(m00, m01, m02, m03) {\r\n  this.m00 = m00;\r\n  this.m01 = m01;\r\n  this.m02 = m02;\r\n  this.m03 = m03;\r\n};\r\n\r\n_mat2.prototype.toJSON = function toJSON () {\r\n  _tmp$5[0] = this.m00;\r\n  _tmp$5[1] = this.m01;\r\n  _tmp$5[2] = this.m02;\r\n  _tmp$5[3] = this.m03;\r\n\r\n  return _tmp$5;\r\n};\r\n\r\n/**\r\n * @class 2x2 Matrix\r\n * @name mat2\r\n */\r\nvar mat2 = {};\r\n\r\n/**\r\n * Creates a new identity mat2\r\n *\r\n * @returns {mat2} a new 2x2 matrix\r\n */\r\nmat2.create = function() {\r\n  return new _mat2(1, 0, 0, 1);\r\n};\r\n\r\n/**\r\n * Create a new mat2 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 2)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 3)\r\n * @returns {mat2} out A new 2x2 matrix\r\n */\r\nmat2.new = function (m00, m01, m10, m11) {\r\n  return new _mat2(m00, m01, m10, m11);\r\n};\r\n\r\n/**\r\n * Creates a new mat2 initialized with values from an existing matrix\r\n *\r\n * @param {mat2} a matrix to clone\r\n * @returns {mat2} a new 2x2 matrix\r\n */\r\nmat2.clone = function (a) {\r\n  return new _mat2(a.m00, a.m01, a.m02, a.m03);\r\n};\r\n\r\n/**\r\n * Copy the values from one mat2 to another\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nmat2.copy = function (out, a) {\r\n  out.m00 = a.m00;\r\n  out.m01 = a.m01;\r\n  out.m02 = a.m02;\r\n  out.m03 = a.m03;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set a mat2 to the identity matrix\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @returns {mat2} out\r\n */\r\nmat2.identity = function (out) {\r\n  out.m00 = 1;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a mat2 to the given values\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 2)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 3)\r\n * @returns {mat2} out\r\n */\r\nmat2.set = function (out, m00, m01, m10, m11) {\r\n  out.m00 = m00;\r\n  out.m01 = m01;\r\n  out.m02 = m10;\r\n  out.m03 = m11;\r\n  return out;\r\n};\r\n\r\n\r\n/**\r\n * Transpose the values of a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nmat2.transpose = function (out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\r\n  if (out === a) {\r\n    var a1 = a.m01;\r\n    out.m01 = a.m02;\r\n    out.m02 = a1;\r\n  } else {\r\n    out.m00 = a.m00;\r\n    out.m01 = a.m02;\r\n    out.m02 = a.m01;\r\n    out.m03 = a.m03;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Inverts a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nmat2.invert = function (out, a) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03;\r\n\r\n  // Calculate the determinant\r\n  var det = a0 * a3 - a2 * a1;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out.m00 = a3 * det;\r\n  out.m01 = -a1 * det;\r\n  out.m02 = -a2 * det;\r\n  out.m03 = a0 * det;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the adjugate of a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nmat2.adjoint = function (out, a) {\r\n  // Caching this value is nessecary if out == a\r\n  var a0 = a.m00;\r\n  out.m00 = a.m03;\r\n  out.m01 = -a.m01;\r\n  out.m02 = -a.m02;\r\n  out.m03 = a0;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the determinant of a mat2\r\n *\r\n * @param {mat2} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nmat2.determinant = function (a) {\r\n  return a.m00 * a.m03 - a.m02 * a.m01;\r\n};\r\n\r\n/**\r\n * Multiplies two mat2's\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nmat2.multiply = function (out, a, b) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03;\r\n  var b0 = b.m00, b1 = b.m01, b2 = b.m02, b3 = b.m03;\r\n  out.m00 = a0 * b0 + a2 * b1;\r\n  out.m01 = a1 * b0 + a3 * b1;\r\n  out.m02 = a0 * b2 + a2 * b3;\r\n  out.m03 = a1 * b2 + a3 * b3;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link mat2.multiply}\r\n * @function\r\n */\r\nmat2.mul = mat2.multiply;\r\n\r\n/**\r\n * Rotates a mat2 by the given angle\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2} out\r\n */\r\nmat2.rotate = function (out, a, rad) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03,\r\n      s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n  out.m00 = a0 * c + a2 * s;\r\n  out.m01 = a1 * c + a3 * s;\r\n  out.m02 = a0 * -s + a2 * c;\r\n  out.m03 = a1 * -s + a3 * c;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales the mat2 by the dimensions in the given vec2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to rotate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat2} out\r\n **/\r\nmat2.scale = function (out, a, v) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03,\r\n      v0 = v.x, v1 = v.y;\r\n  out.m00 = a0 * v0;\r\n  out.m01 = a1 * v0;\r\n  out.m02 = a2 * v1;\r\n  out.m03 = a3 * v1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2.identity(dest);\r\n *     mat2.rotate(dest, dest, rad);\r\n *\r\n * @param {mat2} out mat2 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2} out\r\n */\r\nmat2.fromRotation = function (out, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n  out.m00 = c;\r\n  out.m01 = s;\r\n  out.m02 = -s;\r\n  out.m03 = c;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2.identity(dest);\r\n *     mat2.scale(dest, dest, vec);\r\n *\r\n * @param {mat2} out mat2 receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat2} out\r\n */\r\nmat2.fromScaling = function (out, v) {\r\n  out.m00 = v.x;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = v.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a string representation of a mat2\r\n *\r\n * @param {mat2} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nmat2.str = function (a) {\r\n  return (\"mat2(\" + (a.m00) + \", \" + (a.m01) + \", \" + (a.m02) + \", \" + (a.m03) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {mat2} m\r\n * @returns {array}\r\n */\r\nmat2.array = function (out, m) {\r\n  out[0] = m.m00;\r\n  out[1] = m.m01;\r\n  out[2] = m.m02;\r\n  out[3] = m.m03;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns Frobenius norm of a mat2\r\n *\r\n * @param {mat2} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nmat2.frob = function (a) {\r\n  return (Math.sqrt(Math.pow(a.m00, 2) + Math.pow(a.m01, 2) + Math.pow(a.m02, 2) + Math.pow(a.m03, 2)));\r\n};\r\n\r\n/**\r\n * Returns L, D and U matrices (Lower triangular, Diagonal and Upper triangular) by factorizing the input matrix\r\n * @param {mat2} L the lower triangular matrix\r\n * @param {mat2} D the diagonal matrix\r\n * @param {mat2} U the upper triangular matrix\r\n * @param {mat2} a the input matrix to factorize\r\n */\r\n\r\nmat2.LDU = function (L, D, U, a) {\r\n  L.m02 = a.m02 / a.m00;\r\n  U.m00 = a.m00;\r\n  U.m01 = a.m01;\r\n  U.m03 = a.m03 - L.m02 * U.m01;\r\n};\r\n\r\n/**\r\n * Adds two mat2's\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nmat2.add = function (out, a, b) {\r\n  out.m00 = a.m00 + b.m00;\r\n  out.m01 = a.m01 + b.m01;\r\n  out.m02 = a.m02 + b.m02;\r\n  out.m03 = a.m03 + b.m03;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nmat2.subtract = function (out, a, b) {\r\n  out.m00 = a.m00 - b.m00;\r\n  out.m01 = a.m01 - b.m01;\r\n  out.m02 = a.m02 - b.m02;\r\n  out.m03 = a.m03 - b.m03;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link mat2.subtract}\r\n * @function\r\n */\r\nmat2.sub = mat2.subtract;\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat2} a The first matrix.\r\n * @param {mat2} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nmat2.exactEquals = function (a, b) {\r\n  return a.m00 === b.m00 && a.m01 === b.m01 && a.m02 === b.m02 && a.m03 === b.m03;\r\n};\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat2} a The first matrix.\r\n * @param {mat2} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nmat2.equals = function (a, b) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03;\r\n  var b0 = b.m00, b1 = b.m01, b2 = b.m02, b3 = b.m03;\r\n  return (\r\n    Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\r\n    Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\r\n    Math.abs(a3 - b3) <= EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3))\r\n  );\r\n};\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat2} out\r\n */\r\nmat2.multiplyScalar = function (out, a, b) {\r\n  out.m00 = a.m00 * b;\r\n  out.m01 = a.m01 * b;\r\n  out.m02 = a.m02 * b;\r\n  out.m03 = a.m03 * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two mat2's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat2} out the receiving vector\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat2} out\r\n */\r\nmat2.multiplyScalarAndAdd = function (out, a, b, scale) {\r\n  out.m00 = a.m00 + (b.m00 * scale);\r\n  out.m01 = a.m01 + (b.m01 * scale);\r\n  out.m02 = a.m02 + (b.m02 * scale);\r\n  out.m03 = a.m03 + (b.m03 * scale);\r\n  return out;\r\n};\r\n\r\nvar _tmp$6 = new Array(6);\r\n\r\nvar _mat23 = function _mat23(m00, m01, m02, m03, m04, m05) {\r\n  this.m00 = m00;\r\n  this.m01 = m01;\r\n  this.m02 = m02;\r\n  this.m03 = m03;\r\n  this.m04 = m04;\r\n  this.m05 = m05;\r\n};\r\n\r\n_mat23.prototype.toJSON = function toJSON () {\r\n  _tmp$6[0] = this.m00;\r\n  _tmp$6[1] = this.m01;\r\n  _tmp$6[2] = this.m02;\r\n  _tmp$6[3] = this.m03;\r\n  _tmp$6[4] = this.m04;\r\n  _tmp$6[5] = this.m05;\r\n\r\n  return _tmp$6;\r\n};\r\n\r\n/**\r\n * @class 2x3 Matrix\r\n * @name mat23\r\n *\r\n * @description\r\n * A mat23 contains six elements defined as:\r\n * <pre>\r\n * [a, c, tx,\r\n *  b, d, ty]\r\n * </pre>\r\n * This is a short form for the 3x3 matrix:\r\n * <pre>\r\n * [a, c, tx,\r\n *  b, d, ty,\r\n *  0, 0, 1]\r\n * </pre>\r\n * The last row is ignored so the array is shorter and operations are faster.\r\n */\r\nvar mat23 = {};\r\n\r\n/**\r\n * Creates a new identity mat23\r\n *\r\n * @returns {mat23} a new 2x3 matrix\r\n */\r\nmat23.create = function () {\r\n  return new _mat23(\r\n    1, 0,\r\n    0, 1,\r\n    0, 0\r\n  );\r\n};\r\n\r\n/**\r\n * Create a new mat23 with the given values\r\n *\r\n * @param {Number} a Component A (index 0)\r\n * @param {Number} b Component B (index 1)\r\n * @param {Number} c Component C (index 2)\r\n * @param {Number} d Component D (index 3)\r\n * @param {Number} tx Component TX (index 4)\r\n * @param {Number} ty Component TY (index 5)\r\n * @returns {mat23} A new mat23\r\n */\r\nmat23.new = function (a, b, c, d, tx, ty) {\r\n  return new _mat23(\r\n    a, b,\r\n    c, d,\r\n    tx, ty\r\n  );\r\n};\r\n\r\n/**\r\n * Creates a new mat23 initialized with values from an existing matrix\r\n *\r\n * @param {mat23} a matrix to clone\r\n * @returns {mat23} a new 2x3 matrix\r\n */\r\nmat23.clone = function (a) {\r\n  return new _mat23(\r\n    a.m00, a.m01,\r\n    a.m02, a.m03,\r\n    a.m04, a.m05\r\n  );\r\n};\r\n\r\n/**\r\n * Copy the values from one mat23 to another\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the source matrix\r\n * @returns {mat23} out\r\n */\r\nmat23.copy = function (out, a) {\r\n  out.m00 = a.m00;\r\n  out.m01 = a.m01;\r\n  out.m02 = a.m02;\r\n  out.m03 = a.m03;\r\n  out.m04 = a.m04;\r\n  out.m05 = a.m05;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set a mat23 to the identity matrix\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @returns {mat23} out\r\n */\r\nmat23.identity = function (out) {\r\n  out.m00 = 1;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 1;\r\n  out.m04 = 0;\r\n  out.m05 = 0;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a mat23 to the given values\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {Number} a Component A (index 0)\r\n * @param {Number} b Component B (index 1)\r\n * @param {Number} c Component C (index 2)\r\n * @param {Number} d Component D (index 3)\r\n * @param {Number} tx Component TX (index 4)\r\n * @param {Number} ty Component TY (index 5)\r\n * @returns {mat23} out\r\n */\r\nmat23.set = function (out, a, b, c, d, tx, ty) {\r\n  out.m00 = a;\r\n  out.m01 = b;\r\n  out.m02 = c;\r\n  out.m03 = d;\r\n  out.m04 = tx;\r\n  out.m05 = ty;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Inverts a mat23\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the source matrix\r\n * @returns {mat23} out\r\n */\r\nmat23.invert = function (out, a) {\r\n  var aa = a.m00, ab = a.m01, ac = a.m02, ad = a.m03,\r\n    atx = a.m04, aty = a.m05;\r\n\r\n  var det = aa * ad - ab * ac;\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out.m00 = ad * det;\r\n  out.m01 = -ab * det;\r\n  out.m02 = -ac * det;\r\n  out.m03 = aa * det;\r\n  out.m04 = (ac * aty - ad * atx) * det;\r\n  out.m05 = (ab * atx - aa * aty) * det;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the determinant of a mat23\r\n *\r\n * @param {mat23} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nmat23.determinant = function (a) {\r\n  return a.m00 * a.m03 - a.m01 * a.m02;\r\n};\r\n\r\n/**\r\n * Multiplies two mat23's\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the first operand\r\n * @param {mat23} b the second operand\r\n * @returns {mat23} out\r\n */\r\nmat23.multiply = function (out, a, b) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03, a4 = a.m04, a5 = a.m05,\r\n    b0 = b.m00, b1 = b.m01, b2 = b.m02, b3 = b.m03, b4 = b.m04, b5 = b.m05;\r\n  out.m00 = a0 * b0 + a2 * b1;\r\n  out.m01 = a1 * b0 + a3 * b1;\r\n  out.m02 = a0 * b2 + a2 * b3;\r\n  out.m03 = a1 * b2 + a3 * b3;\r\n  out.m04 = a0 * b4 + a2 * b5 + a4;\r\n  out.m05 = a1 * b4 + a3 * b5 + a5;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link mat23.multiply}\r\n * @function\r\n */\r\nmat23.mul = mat23.multiply;\r\n\r\n/**\r\n * Rotates a mat23 by the given angle\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat23} out\r\n */\r\nmat23.rotate = function (out, a, rad) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03, a4 = a.m04, a5 = a.m05,\r\n    s = Math.sin(rad),\r\n    c = Math.cos(rad);\r\n  out.m00 = a0 * c + a2 * s;\r\n  out.m01 = a1 * c + a3 * s;\r\n  out.m02 = a0 * -s + a2 * c;\r\n  out.m03 = a1 * -s + a3 * c;\r\n  out.m04 = a4;\r\n  out.m05 = a5;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales the mat23 by the dimensions in the given vec2\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the matrix to translate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat23} out\r\n **/\r\nmat23.scale = function (out, a, v) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03, a4 = a.m04, a5 = a.m05,\r\n    v0 = v.x, v1 = v.y;\r\n  out.m00 = a0 * v0;\r\n  out.m01 = a1 * v0;\r\n  out.m02 = a2 * v1;\r\n  out.m03 = a3 * v1;\r\n  out.m04 = a4;\r\n  out.m05 = a5;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Translates the mat23 by the dimensions in the given vec2\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the matrix to translate\r\n * @param {vec2} v the vec2 to translate the matrix by\r\n * @returns {mat23} out\r\n **/\r\nmat23.translate = function (out, a, v) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03, a4 = a.m04, a5 = a.m05,\r\n    v0 = v.x, v1 = v.y;\r\n  out.m00 = a0;\r\n  out.m01 = a1;\r\n  out.m02 = a2;\r\n  out.m03 = a3;\r\n  out.m04 = a0 * v0 + a2 * v1 + a4;\r\n  out.m05 = a1 * v0 + a3 * v1 + a5;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat23.identity(dest);\r\n *     mat23.rotate(dest, dest, rad);\r\n *\r\n * @param {mat23} out mat23 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat23} out\r\n */\r\nmat23.fromRotation = function (out, rad) {\r\n  var s = Math.sin(rad), c = Math.cos(rad);\r\n  out.m00 = c;\r\n  out.m01 = s;\r\n  out.m02 = -s;\r\n  out.m03 = c;\r\n  out.m04 = 0;\r\n  out.m05 = 0;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat23.identity(dest);\r\n *     mat23.scale(dest, dest, vec);\r\n *\r\n * @param {mat23} out mat23 receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat23} out\r\n */\r\nmat23.fromScaling = function (out, v) {\r\n  out.m00 = v.m00;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = v.m01;\r\n  out.m04 = 0;\r\n  out.m05 = 0;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat23.identity(dest);\r\n *     mat23.translate(dest, dest, vec);\r\n *\r\n * @param {mat23} out mat23 receiving operation result\r\n * @param {vec2} v Translation vector\r\n * @returns {mat23} out\r\n */\r\nmat23.fromTranslation = function (out, v) {\r\n  out.m00 = 1;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 1;\r\n  out.m04 = v.x;\r\n  out.m05 = v.y;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a string representation of a mat23\r\n *\r\n * @param {mat23} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nmat23.str = function (a) {\r\n  return (\"mat23(\" + (a.m00) + \", \" + (a.m01) + \", \" + (a.m02) + \", \" + (a.m03) + \", \" + (a.m04) + \", \" + (a.m05) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {mat23} m\r\n * @returns {array}\r\n */\r\nmat23.array = function (out, m) {\r\n  out[0] = m.m00;\r\n  out[1] = m.m01;\r\n  out[2] = m.m02;\r\n  out[3] = m.m03;\r\n  out[4] = m.m04;\r\n  out[5] = m.m05;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns typed array to 16 float array\r\n *\r\n * @param {array} out\r\n * @param {mat23} m\r\n * @returns {array}\r\n */\r\nmat23.array4x4 = function (out, m) {\r\n  out[0] = m.m00;\r\n  out[1] = m.m01;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = m.m02;\r\n  out[5] = m.m03;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 1;\r\n  out[11] = 0;\r\n  out[12] = m.m04;\r\n  out[13] = m.m05;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns Frobenius norm of a mat23\r\n *\r\n * @param {mat23} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nmat23.frob = function (a) {\r\n  return (Math.sqrt(Math.pow(a.m00, 2) + Math.pow(a.m01, 2) + Math.pow(a.m02, 2) + Math.pow(a.m03, 2) + Math.pow(a.m04, 2) + Math.pow(a.m05, 2) + 1));\r\n};\r\n\r\n/**\r\n * Adds two mat23's\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the first operand\r\n * @param {mat23} b the second operand\r\n * @returns {mat23} out\r\n */\r\nmat23.add = function (out, a, b) {\r\n  out.m00 = a.m00 + b.m00;\r\n  out.m01 = a.m01 + b.m01;\r\n  out.m02 = a.m02 + b.m02;\r\n  out.m03 = a.m03 + b.m03;\r\n  out.m04 = a.m04 + b.m04;\r\n  out.m05 = a.m05 + b.m05;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the first operand\r\n * @param {mat23} b the second operand\r\n * @returns {mat23} out\r\n */\r\nmat23.subtract = function (out, a, b) {\r\n  out.m00 = a.m00 - b.m00;\r\n  out.m01 = a.m01 - b.m01;\r\n  out.m02 = a.m02 - b.m02;\r\n  out.m03 = a.m03 - b.m03;\r\n  out.m04 = a.m04 - b.m04;\r\n  out.m05 = a.m05 - b.m05;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link mat23.subtract}\r\n * @function\r\n */\r\nmat23.sub = mat23.subtract;\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat23} out the receiving matrix\r\n * @param {mat23} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat23} out\r\n */\r\nmat23.multiplyScalar = function (out, a, b) {\r\n  out.m00 = a.m00 * b;\r\n  out.m01 = a.m01 * b;\r\n  out.m02 = a.m02 * b;\r\n  out.m03 = a.m03 * b;\r\n  out.m04 = a.m04 * b;\r\n  out.m05 = a.m05 * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two mat23's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat23} out the receiving vector\r\n * @param {mat23} a the first operand\r\n * @param {mat23} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat23} out\r\n */\r\nmat23.multiplyScalarAndAdd = function (out, a, b, scale) {\r\n  out.m00 = a.m00 + (b.m00 * scale);\r\n  out.m01 = a.m01 + (b.m01 * scale);\r\n  out.m02 = a.m02 + (b.m02 * scale);\r\n  out.m03 = a.m03 + (b.m03 * scale);\r\n  out.m04 = a.m04 + (b.m04 * scale);\r\n  out.m05 = a.m05 + (b.m05 * scale);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat23} a The first matrix.\r\n * @param {mat23} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nmat23.exactEquals = function (a, b) {\r\n  return a.m00 === b.m00 && a.m01 === b.m01 && a.m02 === b.m02 && a.m03 === b.m03 && a.m04 === b.m04 && a.m05 === b.m05;\r\n};\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat23} a The first matrix.\r\n * @param {mat23} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nmat23.equals = function (a, b) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03, a4 = a.m04, a5 = a.m05;\r\n  var b0 = b.m00, b1 = b.m01, b2 = b.m02, b3 = b.m03, b4 = b.m04, b5 = b.m05;\r\n  return (\r\n    Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\r\n    Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\r\n    Math.abs(a3 - b3) <= EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) &&\r\n    Math.abs(a4 - b4) <= EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) &&\r\n    Math.abs(a5 - b5) <= EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5))\r\n  );\r\n};\r\n\r\nvar _tmp$7 = new Array(16);\r\n\r\nvar _mat4 = function _mat4(\r\n  m00, m01, m02, m03,\r\n  m04, m05, m06, m07,\r\n  m08, m09, m10, m11,\r\n  m12, m13, m14, m15\r\n) {\r\n  this.m00 = m00;\r\n  this.m01 = m01;\r\n  this.m02 = m02;\r\n  this.m03 = m03;\r\n  this.m04 = m04;\r\n  this.m05 = m05;\r\n  this.m06 = m06;\r\n  this.m07 = m07;\r\n  this.m08 = m08;\r\n  this.m09 = m09;\r\n  this.m10 = m10;\r\n  this.m11 = m11;\r\n  this.m12 = m12;\r\n  this.m13 = m13;\r\n  this.m14 = m14;\r\n  this.m15 = m15;\r\n};\r\n\r\n_mat4.prototype.toJSON = function toJSON () {\r\n  _tmp$7[0] = this.m00;\r\n  _tmp$7[1] = this.m01;\r\n  _tmp$7[2] = this.m02;\r\n  _tmp$7[3] = this.m03;\r\n  _tmp$7[4] = this.m04;\r\n  _tmp$7[5] = this.m05;\r\n  _tmp$7[6] = this.m06;\r\n  _tmp$7[7] = this.m07;\r\n  _tmp$7[8] = this.m08;\r\n  _tmp$7[9] = this.m09;\r\n  _tmp$7[10] = this.m10;\r\n  _tmp$7[11] = this.m11;\r\n  _tmp$7[12] = this.m12;\r\n  _tmp$7[13] = this.m13;\r\n  _tmp$7[14] = this.m14;\r\n  _tmp$7[15] = this.m15;\r\n\r\n  return _tmp$7;\r\n};\r\n\r\n/**\r\n * @class 4x4 Matrix\r\n * @name mat4\r\n *\r\n * NOTE: we use column-major matrix for all matrix calculation.\r\n *\r\n * This may lead to some confusion when referencing OpenGL documentation,\r\n * however, which represents out all matricies in column-major format.\r\n * This means that while in code a matrix may be typed out as:\r\n *\r\n * [1, 0, 0, 0,\r\n *  0, 1, 0, 0,\r\n *  0, 0, 1, 0,\r\n *  x, y, z, 0]\r\n *\r\n * The same matrix in the [OpenGL documentation](https://www.khronos.org/registry/OpenGL-Refpages/gl2.1/xhtml/glTranslate.xml)\r\n * is written as:\r\n *\r\n *  1 0 0 x\r\n *  0 1 0 y\r\n *  0 0 1 z\r\n *  0 0 0 0\r\n *\r\n * Please rest assured, however, that they are the same thing!\r\n * This is not unique to glMatrix, either, as OpenGL developers have long been confused by the\r\n * apparent lack of consistency between the memory layout and the documentation.\r\n */\r\nvar mat4 = {};\r\n\r\n/**\r\n * Creates a new identity mat4\r\n *\r\n * @returns {mat4} a new 4x4 matrix\r\n */\r\nmat4.create = function () {\r\n  return new _mat4(\r\n    1, 0, 0, 0,\r\n    0, 1, 0, 0,\r\n    0, 0, 1, 0,\r\n    0, 0, 0, 1\r\n  );\r\n};\r\n\r\n/**\r\n * Create a new mat4 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} A new mat4\r\n */\r\nmat4.new = function (m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\r\n  return new _mat4(\r\n    m00, m01, m02, m03,\r\n    m10, m11, m12, m13,\r\n    m20, m21, m22, m23,\r\n    m30, m31, m32, m33\r\n  );\r\n};\r\n\r\n/**\r\n * Creates a new mat4 initialized with values from an existing matrix\r\n *\r\n * @param {mat4} a matrix to clone\r\n * @returns {mat4} a new 4x4 matrix\r\n */\r\nmat4.clone = function (a) {\r\n  return new _mat4(\r\n    a.m00, a.m01, a.m02, a.m03,\r\n    a.m04, a.m05, a.m06, a.m07,\r\n    a.m08, a.m09, a.m10, a.m11,\r\n    a.m12, a.m13, a.m14, a.m15\r\n  );\r\n};\r\n\r\n/**\r\n * Copy the values from one mat4 to another\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nmat4.copy = function (out, a) {\r\n  out.m00 = a.m00;\r\n  out.m01 = a.m01;\r\n  out.m02 = a.m02;\r\n  out.m03 = a.m03;\r\n  out.m04 = a.m04;\r\n  out.m05 = a.m05;\r\n  out.m06 = a.m06;\r\n  out.m07 = a.m07;\r\n  out.m08 = a.m08;\r\n  out.m09 = a.m09;\r\n  out.m10 = a.m10;\r\n  out.m11 = a.m11;\r\n  out.m12 = a.m12;\r\n  out.m13 = a.m13;\r\n  out.m14 = a.m14;\r\n  out.m15 = a.m15;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a mat4 to the given values\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} out\r\n */\r\nmat4.set = function (out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\r\n  out.m00 = m00;\r\n  out.m01 = m01;\r\n  out.m02 = m02;\r\n  out.m03 = m03;\r\n  out.m04 = m10;\r\n  out.m05 = m11;\r\n  out.m06 = m12;\r\n  out.m07 = m13;\r\n  out.m08 = m20;\r\n  out.m09 = m21;\r\n  out.m10 = m22;\r\n  out.m11 = m23;\r\n  out.m12 = m30;\r\n  out.m13 = m31;\r\n  out.m14 = m32;\r\n  out.m15 = m33;\r\n  return out;\r\n};\r\n\r\n\r\n/**\r\n * Set a mat4 to the identity matrix\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @returns {mat4} out\r\n */\r\nmat4.identity = function (out) {\r\n  out.m00 = 1;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 0;\r\n  out.m05 = 1;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 0;\r\n  out.m09 = 0;\r\n  out.m10 = 1;\r\n  out.m11 = 0;\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = 0;\r\n  out.m15 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Transpose the values of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nmat4.transpose = function (out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\r\n  if (out === a) {\r\n    var a01 = a.m01, a02 = a.m02, a03 = a.m03,\r\n        a12 = a.m06, a13 = a.m07,\r\n        a23 = a.m11;\r\n\r\n    out.m01 = a.m04;\r\n    out.m02 = a.m08;\r\n    out.m03 = a.m12;\r\n    out.m04 = a01;\r\n    out.m06 = a.m09;\r\n    out.m07 = a.m13;\r\n    out.m08 = a02;\r\n    out.m09 = a12;\r\n    out.m11 = a.m14;\r\n    out.m12 = a03;\r\n    out.m13 = a13;\r\n    out.m14 = a23;\r\n  } else {\r\n    out.m00 = a.m00;\r\n    out.m01 = a.m04;\r\n    out.m02 = a.m08;\r\n    out.m03 = a.m12;\r\n    out.m04 = a.m01;\r\n    out.m05 = a.m05;\r\n    out.m06 = a.m09;\r\n    out.m07 = a.m13;\r\n    out.m08 = a.m02;\r\n    out.m09 = a.m06;\r\n    out.m10 = a.m10;\r\n    out.m11 = a.m14;\r\n    out.m12 = a.m03;\r\n    out.m13 = a.m07;\r\n    out.m14 = a.m11;\r\n    out.m15 = a.m15;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Inverts a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nmat4.invert = function (out, a) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02, a03 = a.m03,\r\n      a10 = a.m04, a11 = a.m05, a12 = a.m06, a13 = a.m07,\r\n      a20 = a.m08, a21 = a.m09, a22 = a.m10, a23 = a.m11,\r\n      a30 = a.m12, a31 = a.m13, a32 = a.m14, a33 = a.m15;\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out.m00 = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n  out.m01 = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n  out.m02 = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n  out.m03 = (a22 * b04 - a21 * b05 - a23 * b03) * det;\r\n  out.m04 = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n  out.m05 = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n  out.m06 = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n  out.m07 = (a20 * b05 - a22 * b02 + a23 * b01) * det;\r\n  out.m08 = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n  out.m09 = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n  out.m10 = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n  out.m11 = (a21 * b02 - a20 * b04 - a23 * b00) * det;\r\n  out.m12 = (a11 * b07 - a10 * b09 - a12 * b06) * det;\r\n  out.m13 = (a00 * b09 - a01 * b07 + a02 * b06) * det;\r\n  out.m14 = (a31 * b01 - a30 * b03 - a32 * b00) * det;\r\n  out.m15 = (a20 * b03 - a21 * b01 + a22 * b00) * det;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the adjugate of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nmat4.adjoint = function (out, a) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02, a03 = a.m03,\r\n      a10 = a.m04, a11 = a.m05, a12 = a.m06, a13 = a.m07,\r\n      a20 = a.m08, a21 = a.m09, a22 = a.m10, a23 = a.m11,\r\n      a30 = a.m12, a31 = a.m13, a32 = a.m14, a33 = a.m15;\r\n\r\n  out.m00 = (a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22));\r\n  out.m01 = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\r\n  out.m02 = (a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12));\r\n  out.m03 = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\r\n  out.m04 = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\r\n  out.m05 = (a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22));\r\n  out.m06 = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\r\n  out.m07 = (a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12));\r\n  out.m08 = (a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21));\r\n  out.m09 = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\r\n  out.m10 = (a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11));\r\n  out.m11 = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\r\n  out.m12 = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\r\n  out.m13 = (a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21));\r\n  out.m14 = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\r\n  out.m15 = (a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11));\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates the determinant of a mat4\r\n *\r\n * @param {mat4} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nmat4.determinant = function (a) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02, a03 = a.m03,\r\n      a10 = a.m04, a11 = a.m05, a12 = a.m06, a13 = a.m07,\r\n      a20 = a.m08, a21 = a.m09, a22 = a.m10, a23 = a.m11,\r\n      a30 = a.m12, a31 = a.m13, a32 = a.m14, a33 = a.m15;\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n};\r\n\r\n/**\r\n * Multiplies two mat4's explicitly\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nmat4.multiply = function (out, a, b) {\r\n  var a00 = a.m00, a01 = a.m01, a02 = a.m02, a03 = a.m03,\r\n      a10 = a.m04, a11 = a.m05, a12 = a.m06, a13 = a.m07,\r\n      a20 = a.m08, a21 = a.m09, a22 = a.m10, a23 = a.m11,\r\n      a30 = a.m12, a31 = a.m13, a32 = a.m14, a33 = a.m15;\r\n\r\n  // Cache only the current line of the second matrix\r\n  var b0 = b.m00, b1 = b.m01, b2 = b.m02, b3 = b.m03;\r\n  out.m00 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out.m01 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out.m02 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out.m03 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b.m04; b1 = b.m05; b2 = b.m06; b3 = b.m07;\r\n  out.m04 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out.m05 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out.m06 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out.m07 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b.m08; b1 = b.m09; b2 = b.m10; b3 = b.m11;\r\n  out.m08 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out.m09 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out.m10 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out.m11 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b.m12; b1 = b.m13; b2 = b.m14; b3 = b.m15;\r\n  out.m12 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out.m13 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out.m14 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out.m15 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link mat4.multiply}\r\n * @function\r\n */\r\nmat4.mul = mat4.multiply;\r\n\r\n/**\r\n * Translate a mat4 by the given vector\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to translate\r\n * @param {vec3} v vector to translate by\r\n * @returns {mat4} out\r\n */\r\nmat4.translate = function (out, a, v) {\r\n  var x = v.x, y = v.y, z = v.z,\r\n      a00, a01, a02, a03,\r\n      a10, a11, a12, a13,\r\n      a20, a21, a22, a23;\r\n\r\n  if (a === out) {\r\n    out.m12 = a.m00 * x + a.m04 * y + a.m08 * z + a.m12;\r\n    out.m13 = a.m01 * x + a.m05 * y + a.m09 * z + a.m13;\r\n    out.m14 = a.m02 * x + a.m06 * y + a.m10 * z + a.m14;\r\n    out.m15 = a.m03 * x + a.m07 * y + a.m11 * z + a.m15;\r\n  } else {\r\n    a00 = a.m00; a01 = a.m01; a02 = a.m02; a03 = a.m03;\r\n    a10 = a.m04; a11 = a.m05; a12 = a.m06; a13 = a.m07;\r\n    a20 = a.m08; a21 = a.m09; a22 = a.m10; a23 = a.m11;\r\n\r\n    out.m00 = a00; out.m01 = a01; out.m02 = a02; out.m03 = a03;\r\n    out.m04 = a10; out.m05 = a11; out.m06 = a12; out.m07 = a13;\r\n    out.m08 = a20; out.m09 = a21; out.m10 = a22; out.m11 = a23;\r\n\r\n    out.m12 = a00 * x + a10 * y + a20 * z + a.m12;\r\n    out.m13 = a01 * x + a11 * y + a21 * z + a.m13;\r\n    out.m14 = a02 * x + a12 * y + a22 * z + a.m14;\r\n    out.m15 = a03 * x + a13 * y + a23 * z + a.m15;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales the mat4 by the dimensions in the given vec3\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {vec3} v the vec3 to scale the matrix by\r\n * @returns {mat4} out\r\n **/\r\nmat4.scale = function (out, a, v) {\r\n  var x = v.x, y = v.y, z = v.z;\r\n\r\n  out.m00 = a.m00 * x;\r\n  out.m01 = a.m01 * x;\r\n  out.m02 = a.m02 * x;\r\n  out.m03 = a.m03 * x;\r\n  out.m04 = a.m04 * y;\r\n  out.m05 = a.m05 * y;\r\n  out.m06 = a.m06 * y;\r\n  out.m07 = a.m07 * y;\r\n  out.m08 = a.m08 * z;\r\n  out.m09 = a.m09 * z;\r\n  out.m10 = a.m10 * z;\r\n  out.m11 = a.m11 * z;\r\n  out.m12 = a.m12;\r\n  out.m13 = a.m13;\r\n  out.m14 = a.m14;\r\n  out.m15 = a.m15;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotates a mat4 by the given angle around the given axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\r\nmat4.rotate = function (out, a, rad, axis) {\r\n  var x = axis.x, y = axis.y, z = axis.z;\r\n  var s, c, t,\r\n      a00, a01, a02, a03,\r\n      a10, a11, a12, a13,\r\n      a20, a21, a22, a23,\r\n      b00, b01, b02,\r\n      b10, b11, b12,\r\n      b20, b21, b22;\r\n\r\n  var len = Math.sqrt(x * x + y * y + z * z);\r\n\r\n  if (Math.abs(len) < EPSILON) {\r\n    return null;\r\n  }\r\n\r\n  len = 1 / len;\r\n  x *= len;\r\n  y *= len;\r\n  z *= len;\r\n\r\n  s = Math.sin(rad);\r\n  c = Math.cos(rad);\r\n  t = 1 - c;\r\n\r\n  a00 = a.m00; a01 = a.m01; a02 = a.m02; a03 = a.m03;\r\n  a10 = a.m04; a11 = a.m05; a12 = a.m06; a13 = a.m07;\r\n  a20 = a.m08; a21 = a.m09; a22 = a.m10; a23 = a.m11;\r\n\r\n  // Construct the elements of the rotation matrix\r\n  b00 = x * x * t + c; b01 = y * x * t + z * s; b02 = z * x * t - y * s;\r\n  b10 = x * y * t - z * s; b11 = y * y * t + c; b12 = z * y * t + x * s;\r\n  b20 = x * z * t + y * s; b21 = y * z * t - x * s; b22 = z * z * t + c;\r\n\r\n  // Perform rotation-specific matrix multiplication\r\n  out.m00 = a00 * b00 + a10 * b01 + a20 * b02;\r\n  out.m01 = a01 * b00 + a11 * b01 + a21 * b02;\r\n  out.m02 = a02 * b00 + a12 * b01 + a22 * b02;\r\n  out.m03 = a03 * b00 + a13 * b01 + a23 * b02;\r\n  out.m04 = a00 * b10 + a10 * b11 + a20 * b12;\r\n  out.m05 = a01 * b10 + a11 * b11 + a21 * b12;\r\n  out.m06 = a02 * b10 + a12 * b11 + a22 * b12;\r\n  out.m07 = a03 * b10 + a13 * b11 + a23 * b12;\r\n  out.m08 = a00 * b20 + a10 * b21 + a20 * b22;\r\n  out.m09 = a01 * b20 + a11 * b21 + a21 * b22;\r\n  out.m10 = a02 * b20 + a12 * b21 + a22 * b22;\r\n  out.m11 = a03 * b20 + a13 * b21 + a23 * b22;\r\n\r\n  // If the source and destination differ, copy the unchanged last row\r\n  if (a !== out) {\r\n    out.m12 = a.m12;\r\n    out.m13 = a.m13;\r\n    out.m14 = a.m14;\r\n    out.m15 = a.m15;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the X axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nmat4.rotateX = function (out, a, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad),\r\n      a10 = a.m04,\r\n      a11 = a.m05,\r\n      a12 = a.m06,\r\n      a13 = a.m07,\r\n      a20 = a.m08,\r\n      a21 = a.m09,\r\n      a22 = a.m10,\r\n      a23 = a.m11;\r\n\r\n  if (a !== out) { // If the source and destination differ, copy the unchanged rows\r\n    out.m00 = a.m00;\r\n    out.m01 = a.m01;\r\n    out.m02 = a.m02;\r\n    out.m03 = a.m03;\r\n    out.m12 = a.m12;\r\n    out.m13 = a.m13;\r\n    out.m14 = a.m14;\r\n    out.m15 = a.m15;\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out.m04 = a10 * c + a20 * s;\r\n  out.m05 = a11 * c + a21 * s;\r\n  out.m06 = a12 * c + a22 * s;\r\n  out.m07 = a13 * c + a23 * s;\r\n  out.m08 = a20 * c - a10 * s;\r\n  out.m09 = a21 * c - a11 * s;\r\n  out.m10 = a22 * c - a12 * s;\r\n  out.m11 = a23 * c - a13 * s;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the Y axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nmat4.rotateY = function (out, a, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad),\r\n      a00 = a.m00,\r\n      a01 = a.m01,\r\n      a02 = a.m02,\r\n      a03 = a.m03,\r\n      a20 = a.m08,\r\n      a21 = a.m09,\r\n      a22 = a.m10,\r\n      a23 = a.m11;\r\n\r\n  if (a !== out) { // If the source and destination differ, copy the unchanged rows\r\n    out.m04 = a.m04;\r\n    out.m05 = a.m05;\r\n    out.m06 = a.m06;\r\n    out.m07 = a.m07;\r\n    out.m12 = a.m12;\r\n    out.m13 = a.m13;\r\n    out.m14 = a.m14;\r\n    out.m15 = a.m15;\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out.m00 = a00 * c - a20 * s;\r\n  out.m01 = a01 * c - a21 * s;\r\n  out.m02 = a02 * c - a22 * s;\r\n  out.m03 = a03 * c - a23 * s;\r\n  out.m08 = a00 * s + a20 * c;\r\n  out.m09 = a01 * s + a21 * c;\r\n  out.m10 = a02 * s + a22 * c;\r\n  out.m11 = a03 * s + a23 * c;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the Z axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nmat4.rotateZ = function (out, a, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad),\r\n      a00 = a.m00,\r\n      a01 = a.m01,\r\n      a02 = a.m02,\r\n      a03 = a.m03,\r\n      a10 = a.m04,\r\n      a11 = a.m05,\r\n      a12 = a.m06,\r\n      a13 = a.m07;\r\n\r\n  // If the source and destination differ, copy the unchanged last row\r\n  if (a !== out) {\r\n    out.m08 = a.m08;\r\n    out.m09 = a.m09;\r\n    out.m10 = a.m10;\r\n    out.m11 = a.m11;\r\n    out.m12 = a.m12;\r\n    out.m13 = a.m13;\r\n    out.m14 = a.m14;\r\n    out.m15 = a.m15;\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out.m00 = a00 * c + a10 * s;\r\n  out.m01 = a01 * c + a11 * s;\r\n  out.m02 = a02 * c + a12 * s;\r\n  out.m03 = a03 * c + a13 * s;\r\n  out.m04 = a10 * c - a00 * s;\r\n  out.m05 = a11 * c - a01 * s;\r\n  out.m06 = a12 * c - a02 * s;\r\n  out.m07 = a13 * c - a03 * s;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\r\nmat4.fromTranslation = function (out, v) {\r\n  out.m00 = 1;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 0;\r\n  out.m05 = 1;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 0;\r\n  out.m09 = 0;\r\n  out.m10 = 1;\r\n  out.m11 = 0;\r\n  out.m12 = v.x;\r\n  out.m13 = v.y;\r\n  out.m14 = v.z;\r\n  out.m15 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.scale(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Scaling vector\r\n * @returns {mat4} out\r\n */\r\nmat4.fromScaling = function (out, v) {\r\n  out.m00 = v.x;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 0;\r\n  out.m05 = v.y;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 0;\r\n  out.m09 = 0;\r\n  out.m10 = v.z;\r\n  out.m11 = 0;\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = 0;\r\n  out.m15 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a given angle around a given axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotate(dest, dest, rad, axis);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\r\nmat4.fromRotation = function (out, rad, axis) {\r\n  var x = axis.x, y = axis.y, z = axis.z;\r\n  var len = Math.sqrt(x * x + y * y + z * z);\r\n  var s, c, t;\r\n\r\n  if (Math.abs(len) < EPSILON) {\r\n    return null;\r\n  }\r\n\r\n  len = 1 / len;\r\n  x *= len;\r\n  y *= len;\r\n  z *= len;\r\n\r\n  s = Math.sin(rad);\r\n  c = Math.cos(rad);\r\n  t = 1 - c;\r\n\r\n  // Perform rotation-specific matrix multiplication\r\n  out.m00 = x * x * t + c;\r\n  out.m01 = y * x * t + z * s;\r\n  out.m02 = z * x * t - y * s;\r\n  out.m03 = 0;\r\n  out.m04 = x * y * t - z * s;\r\n  out.m05 = y * y * t + c;\r\n  out.m06 = z * y * t + x * s;\r\n  out.m07 = 0;\r\n  out.m08 = x * z * t + y * s;\r\n  out.m09 = y * z * t - x * s;\r\n  out.m10 = z * z * t + c;\r\n  out.m11 = 0;\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = 0;\r\n  out.m15 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from the given angle around the X axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateX(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nmat4.fromXRotation = function (out, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out.m00 = 1;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 0;\r\n  out.m05 = c;\r\n  out.m06 = s;\r\n  out.m07 = 0;\r\n  out.m08 = 0;\r\n  out.m09 = -s;\r\n  out.m10 = c;\r\n  out.m11 = 0;\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = 0;\r\n  out.m15 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from the given angle around the Y axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateY(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nmat4.fromYRotation = function (out, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out.m00 = c;\r\n  out.m01 = 0;\r\n  out.m02 = -s;\r\n  out.m03 = 0;\r\n  out.m04 = 0;\r\n  out.m05 = 1;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = s;\r\n  out.m09 = 0;\r\n  out.m10 = c;\r\n  out.m11 = 0;\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = 0;\r\n  out.m15 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from the given angle around the Z axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateZ(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nmat4.fromZRotation = function (out, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out.m00 = c;\r\n  out.m01 = s;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = -s;\r\n  out.m05 = c;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 0;\r\n  out.m09 = 0;\r\n  out.m10 = 1;\r\n  out.m11 = 0;\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = 0;\r\n  out.m15 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation and vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\r\nmat4.fromRT = function (out, q, v) {\r\n  // Quaternion math\r\n  var x = q.x, y = q.y, z = q.z, w = q.w;\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out.m00 = 1 - (yy + zz);\r\n  out.m01 = xy + wz;\r\n  out.m02 = xz - wy;\r\n  out.m03 = 0;\r\n  out.m04 = xy - wz;\r\n  out.m05 = 1 - (xx + zz);\r\n  out.m06 = yz + wx;\r\n  out.m07 = 0;\r\n  out.m08 = xz + wy;\r\n  out.m09 = yz - wx;\r\n  out.m10 = 1 - (xx + yy);\r\n  out.m11 = 0;\r\n  out.m12 = v.x;\r\n  out.m13 = v.y;\r\n  out.m14 = v.z;\r\n  out.m15 = 1;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the translation vector component of a transformation\r\n *  matrix. If a matrix is built with fromRT,\r\n *  the returned vector will be the same as the translation vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive translation component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\r\nmat4.getTranslation = function (out, mat) {\r\n  out.x = mat.m12;\r\n  out.y = mat.m13;\r\n  out.z = mat.m14;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns the scaling factor component of a transformation\r\n *  matrix. If a matrix is built with fromRTS\r\n *  with a normalized Quaternion paramter, the returned vector will be\r\n *  the same as the scaling vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive scaling factor component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\r\nmat4.getScaling = function (out, mat) {\r\n  var m11 = mat.m00,\r\n      m12 = mat.m01,\r\n      m13 = mat.m02,\r\n      m21 = mat.m04,\r\n      m22 = mat.m05,\r\n      m23 = mat.m06,\r\n      m31 = mat.m08,\r\n      m32 = mat.m09,\r\n      m33 = mat.m10;\r\n\r\n  out.x = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\r\n  out.y = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\r\n  out.z = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a quaternion representing the rotational component\r\n *  of a transformation matrix. If a matrix is built with\r\n *  fromRT, the returned quaternion will be the\r\n *  same as the quaternion originally supplied.\r\n * @param {quat} out Quaternion to receive the rotation component\r\n * @param {mat4} mat Matrix to be decomposed (input)\r\n * @return {quat} out\r\n */\r\nmat4.getRotation = function (out, mat) {\r\n  // Algorithm taken from http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n  var trace = mat.m00 + mat.m05 + mat.m10;\r\n  var S = 0;\r\n\r\n  if (trace > 0) {\r\n    S = Math.sqrt(trace + 1.0) * 2;\r\n    out.w = 0.25 * S;\r\n    out.x = (mat.m06 - mat.m09) / S;\r\n    out.y = (mat.m08 - mat.m02) / S;\r\n    out.z = (mat.m01 - mat.m04) / S;\r\n  } else if ((mat.m00 > mat.m05) & (mat.m00 > mat.m10)) {\r\n    S = Math.sqrt(1.0 + mat.m00 - mat.m05 - mat.m10) * 2;\r\n    out.w = (mat.m06 - mat.m09) / S;\r\n    out.x = 0.25 * S;\r\n    out.y = (mat.m01 + mat.m04) / S;\r\n    out.z = (mat.m08 + mat.m02) / S;\r\n  } else if (mat.m05 > mat.m10) {\r\n    S = Math.sqrt(1.0 + mat.m05 - mat.m00 - mat.m10) * 2;\r\n    out.w = (mat.m08 - mat.m02) / S;\r\n    out.x = (mat.m01 + mat.m04) / S;\r\n    out.y = 0.25 * S;\r\n    out.z = (mat.m06 + mat.m09) / S;\r\n  } else {\r\n    S = Math.sqrt(1.0 + mat.m10 - mat.m00 - mat.m05) * 2;\r\n    out.w = (mat.m01 - mat.m04) / S;\r\n    out.x = (mat.m08 + mat.m02) / S;\r\n    out.y = (mat.m06 + mat.m09) / S;\r\n    out.z = 0.25 * S;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @returns {mat4} out\r\n */\r\nmat4.fromRTS = function (out, q, v, s) {\r\n  // Quaternion math\r\n  var x = q.x, y = q.y, z = q.z, w = q.w;\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n  var sx = s.x;\r\n  var sy = s.y;\r\n  var sz = s.z;\r\n\r\n  out.m00 = (1 - (yy + zz)) * sx;\r\n  out.m01 = (xy + wz) * sx;\r\n  out.m02 = (xz - wy) * sx;\r\n  out.m03 = 0;\r\n  out.m04 = (xy - wz) * sy;\r\n  out.m05 = (1 - (xx + zz)) * sy;\r\n  out.m06 = (yz + wx) * sy;\r\n  out.m07 = 0;\r\n  out.m08 = (xz + wy) * sz;\r\n  out.m09 = (yz - wx) * sz;\r\n  out.m10 = (1 - (xx + yy)) * sz;\r\n  out.m11 = 0;\r\n  out.m12 = v.x;\r\n  out.m13 = v.y;\r\n  out.m14 = v.z;\r\n  out.m15 = 1;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     mat4.translate(dest, origin);\r\n *     let quatMat = mat4.create();\r\n *     quat.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *     mat4.translate(dest, negativeOrigin);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @param {vec3} o The origin vector around which to scale and rotate\r\n * @returns {mat4} out\r\n */\r\nmat4.fromRTSOrigin = function (out, q, v, s, o) {\r\n  // Quaternion math\r\n  var x = q.x, y = q.y, z = q.z, w = q.w;\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  var sx = s.x;\r\n  var sy = s.y;\r\n  var sz = s.z;\r\n\r\n  var ox = o.x;\r\n  var oy = o.y;\r\n  var oz = o.z;\r\n\r\n  out.m00 = (1 - (yy + zz)) * sx;\r\n  out.m01 = (xy + wz) * sx;\r\n  out.m02 = (xz - wy) * sx;\r\n  out.m03 = 0;\r\n  out.m04 = (xy - wz) * sy;\r\n  out.m05 = (1 - (xx + zz)) * sy;\r\n  out.m06 = (yz + wx) * sy;\r\n  out.m07 = 0;\r\n  out.m08 = (xz + wy) * sz;\r\n  out.m09 = (yz - wx) * sz;\r\n  out.m10 = (1 - (xx + yy)) * sz;\r\n  out.m11 = 0;\r\n  out.m12 = v.x + ox - (out.m00 * ox + out.m04 * oy + out.m08 * oz);\r\n  out.m13 = v.y + oy - (out.m01 * ox + out.m05 * oy + out.m09 * oz);\r\n  out.m14 = v.z + oz - (out.m02 * ox + out.m06 * oy + out.m10 * oz);\r\n  out.m15 = 1;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Calculates a 4x4 matrix from the given quaternion\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat} q Quaternion to create matrix from\r\n *\r\n * @returns {mat4} out\r\n */\r\nmat4.fromQuat = function (out, q) {\r\n  var x = q.x, y = q.y, z = q.z, w = q.w;\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var yx = y * x2;\r\n  var yy = y * y2;\r\n  var zx = z * x2;\r\n  var zy = z * y2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out.m00 = 1 - yy - zz;\r\n  out.m01 = yx + wz;\r\n  out.m02 = zx - wy;\r\n  out.m03 = 0;\r\n\r\n  out.m04 = yx - wz;\r\n  out.m05 = 1 - xx - zz;\r\n  out.m06 = zy + wx;\r\n  out.m07 = 0;\r\n\r\n  out.m08 = zx + wy;\r\n  out.m09 = zy - wx;\r\n  out.m10 = 1 - xx - yy;\r\n  out.m11 = 0;\r\n\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = 0;\r\n  out.m15 = 1;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Generates a frustum matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Number} left Left bound of the frustum\r\n * @param {Number} right Right bound of the frustum\r\n * @param {Number} bottom Bottom bound of the frustum\r\n * @param {Number} top Top bound of the frustum\r\n * @param {Number} near Near bound of the frustum\r\n * @param {Number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nmat4.frustum = function (out, left, right, bottom, top, near, far) {\r\n  var rl = 1 / (right - left);\r\n  var tb = 1 / (top - bottom);\r\n  var nf = 1 / (near - far);\r\n\r\n  out.m00 = (near * 2) * rl;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 0;\r\n  out.m05 = (near * 2) * tb;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = (right + left) * rl;\r\n  out.m09 = (top + bottom) * tb;\r\n  out.m10 = (far + near) * nf;\r\n  out.m11 = -1;\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = (far * near * 2) * nf;\r\n  out.m15 = 0;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Generates a perspective projection matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} fovy Vertical field of view in radians\r\n * @param {number} aspect Aspect ratio. typically viewport width/height\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nmat4.perspective = function (out, fovy, aspect, near, far) {\r\n  var f = 1.0 / Math.tan(fovy / 2);\r\n  var nf = 1 / (near - far);\r\n\r\n  out.m00 = f / aspect;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 0;\r\n  out.m05 = f;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 0;\r\n  out.m09 = 0;\r\n  out.m10 = (far + near) * nf;\r\n  out.m11 = -1;\r\n  out.m12 = 0;\r\n  out.m13 = 0;\r\n  out.m14 = (2 * far * near) * nf;\r\n  out.m15 = 0;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Generates a perspective projection matrix with the given field of view.\r\n * This is primarily useful for generating projection matrices to be used\r\n * with the still experiemental WebVR API.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nmat4.perspectiveFromFieldOfView = function (out, fov, near, far) {\r\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\r\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\r\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\r\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\r\n  var xScale = 2.0 / (leftTan + rightTan);\r\n  var yScale = 2.0 / (upTan + downTan);\r\n\r\n  out.m00 = xScale;\r\n  out.m01 = 0.0;\r\n  out.m02 = 0.0;\r\n  out.m03 = 0.0;\r\n  out.m04 = 0.0;\r\n  out.m05 = yScale;\r\n  out.m06 = 0.0;\r\n  out.m07 = 0.0;\r\n  out.m08 = -((leftTan - rightTan) * xScale * 0.5);\r\n  out.m09 = ((upTan - downTan) * yScale * 0.5);\r\n  out.m10 = far / (near - far);\r\n  out.m11 = -1.0;\r\n  out.m12 = 0.0;\r\n  out.m13 = 0.0;\r\n  out.m14 = (far * near) / (near - far);\r\n  out.m15 = 0.0;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Generates a orthogonal projection matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} left Left bound of the frustum\r\n * @param {number} right Right bound of the frustum\r\n * @param {number} bottom Bottom bound of the frustum\r\n * @param {number} top Top bound of the frustum\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nmat4.ortho = function (out, left, right, bottom, top, near, far) {\r\n  var lr = 1 / (left - right);\r\n  var bt = 1 / (bottom - top);\r\n  var nf = 1 / (near - far);\r\n  out.m00 = -2 * lr;\r\n  out.m01 = 0;\r\n  out.m02 = 0;\r\n  out.m03 = 0;\r\n  out.m04 = 0;\r\n  out.m05 = -2 * bt;\r\n  out.m06 = 0;\r\n  out.m07 = 0;\r\n  out.m08 = 0;\r\n  out.m09 = 0;\r\n  out.m10 = 2 * nf;\r\n  out.m11 = 0;\r\n  out.m12 = (left + right) * lr;\r\n  out.m13 = (top + bottom) * bt;\r\n  out.m14 = (far + near) * nf;\r\n  out.m15 = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Generates a look-at matrix with the given eye position, focal point, and up axis\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\r\nmat4.lookAt = function (out, eye, center, up) {\r\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\r\n  var eyex = eye.x;\r\n  var eyey = eye.y;\r\n  var eyez = eye.z;\r\n  var upx = up.x;\r\n  var upy = up.y;\r\n  var upz = up.z;\r\n  var centerx = center.x;\r\n  var centery = center.y;\r\n  var centerz = center.z;\r\n\r\n  if (\r\n    Math.abs(eyex - centerx) < EPSILON &&\r\n    Math.abs(eyey - centery) < EPSILON &&\r\n    Math.abs(eyez - centerz) < EPSILON\r\n  ) {\r\n    return mat4.identity(out);\r\n  }\r\n\r\n  z0 = eyex - centerx;\r\n  z1 = eyey - centery;\r\n  z2 = eyez - centerz;\r\n\r\n  len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\r\n  z0 *= len;\r\n  z1 *= len;\r\n  z2 *= len;\r\n\r\n  x0 = upy * z2 - upz * z1;\r\n  x1 = upz * z0 - upx * z2;\r\n  x2 = upx * z1 - upy * z0;\r\n  len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\r\n  if (!len) {\r\n    x0 = 0;\r\n    x1 = 0;\r\n    x2 = 0;\r\n  } else {\r\n    len = 1 / len;\r\n    x0 *= len;\r\n    x1 *= len;\r\n    x2 *= len;\r\n  }\r\n\r\n  y0 = z1 * x2 - z2 * x1;\r\n  y1 = z2 * x0 - z0 * x2;\r\n  y2 = z0 * x1 - z1 * x0;\r\n\r\n  len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\r\n  if (!len) {\r\n    y0 = 0;\r\n    y1 = 0;\r\n    y2 = 0;\r\n  } else {\r\n    len = 1 / len;\r\n    y0 *= len;\r\n    y1 *= len;\r\n    y2 *= len;\r\n  }\r\n\r\n  out.m00 = x0;\r\n  out.m01 = y0;\r\n  out.m02 = z0;\r\n  out.m03 = 0;\r\n  out.m04 = x1;\r\n  out.m05 = y1;\r\n  out.m06 = z1;\r\n  out.m07 = 0;\r\n  out.m08 = x2;\r\n  out.m09 = y2;\r\n  out.m10 = z2;\r\n  out.m11 = 0;\r\n  out.m12 = -(x0 * eyex + x1 * eyey + x2 * eyez);\r\n  out.m13 = -(y0 * eyex + y1 * eyey + y2 * eyez);\r\n  out.m14 = -(z0 * eyex + z1 * eyey + z2 * eyez);\r\n  out.m15 = 1;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a string representation of a mat4\r\n *\r\n * @param {mat4} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nmat4.str = function (a) {\r\n  return (\"mat4(\" + (a.m00) + \", \" + (a.m01) + \", \" + (a.m02) + \", \" + (a.m03) + \", \" + (a.m04) + \", \" + (a.m05) + \", \" + (a.m06) + \", \" + (a.m07) + \", \" + (a.m08) + \", \" + (a.m09) + \", \" + (a.m10) + \", \" + (a.m11) + \", \" + (a.m12) + \", \" + (a.m13) + \", \" + (a.m14) + \", \" + (a.m15) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {mat4} m\r\n * @returns {array}\r\n */\r\nmat4.array = function (out, m) {\r\n  out[0]  = m.m00;\r\n  out[1]  = m.m01;\r\n  out[2]  = m.m02;\r\n  out[3]  = m.m03;\r\n  out[4]  = m.m04;\r\n  out[5]  = m.m05;\r\n  out[6]  = m.m06;\r\n  out[7]  = m.m07;\r\n  out[8]  = m.m08;\r\n  out[9]  = m.m09;\r\n  out[10] = m.m10;\r\n  out[11] = m.m11;\r\n  out[12] = m.m12;\r\n  out[13] = m.m13;\r\n  out[14] = m.m14;\r\n  out[15] = m.m15;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns Frobenius norm of a mat4\r\n *\r\n * @param {mat4} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nmat4.frob = function (a) {\r\n  return (Math.sqrt(Math.pow(a.m00, 2) + Math.pow(a.m01, 2) + Math.pow(a.m02, 2) + Math.pow(a.m03, 2) + Math.pow(a.m04, 2) + Math.pow(a.m05, 2) + Math.pow(a.m06, 2) + Math.pow(a.m07, 2) + Math.pow(a.m08, 2) + Math.pow(a.m09, 2) + Math.pow(a.m10, 2) + Math.pow(a.m11, 2) + Math.pow(a.m12, 2) + Math.pow(a.m13, 2) + Math.pow(a.m14, 2) + Math.pow(a.m15, 2)))\r\n};\r\n\r\n/**\r\n * Adds two mat4's\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nmat4.add = function (out, a, b) {\r\n  out.m00 = a.m00 + b.m00;\r\n  out.m01 = a.m01 + b.m01;\r\n  out.m02 = a.m02 + b.m02;\r\n  out.m03 = a.m03 + b.m03;\r\n  out.m04 = a.m04 + b.m04;\r\n  out.m05 = a.m05 + b.m05;\r\n  out.m06 = a.m06 + b.m06;\r\n  out.m07 = a.m07 + b.m07;\r\n  out.m08 = a.m08 + b.m08;\r\n  out.m09 = a.m09 + b.m09;\r\n  out.m10 = a.m10 + b.m10;\r\n  out.m11 = a.m11 + b.m11;\r\n  out.m12 = a.m12 + b.m12;\r\n  out.m13 = a.m13 + b.m13;\r\n  out.m14 = a.m14 + b.m14;\r\n  out.m15 = a.m15 + b.m15;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nmat4.subtract = function (out, a, b) {\r\n  out.m00 = a.m00 - b.m00;\r\n  out.m01 = a.m01 - b.m01;\r\n  out.m02 = a.m02 - b.m02;\r\n  out.m03 = a.m03 - b.m03;\r\n  out.m04 = a.m04 - b.m04;\r\n  out.m05 = a.m05 - b.m05;\r\n  out.m06 = a.m06 - b.m06;\r\n  out.m07 = a.m07 - b.m07;\r\n  out.m08 = a.m08 - b.m08;\r\n  out.m09 = a.m09 - b.m09;\r\n  out.m10 = a.m10 - b.m10;\r\n  out.m11 = a.m11 - b.m11;\r\n  out.m12 = a.m12 - b.m12;\r\n  out.m13 = a.m13 - b.m13;\r\n  out.m14 = a.m14 - b.m14;\r\n  out.m15 = a.m15 - b.m15;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link mat4.subtract}\r\n * @function\r\n */\r\nmat4.sub = mat4.subtract;\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat4} out\r\n */\r\nmat4.multiplyScalar = function (out, a, b) {\r\n  out.m00 = a.m00 * b;\r\n  out.m01 = a.m01 * b;\r\n  out.m02 = a.m02 * b;\r\n  out.m03 = a.m03 * b;\r\n  out.m04 = a.m04 * b;\r\n  out.m05 = a.m05 * b;\r\n  out.m06 = a.m06 * b;\r\n  out.m07 = a.m07 * b;\r\n  out.m08 = a.m08 * b;\r\n  out.m09 = a.m09 * b;\r\n  out.m10 = a.m10 * b;\r\n  out.m11 = a.m11 * b;\r\n  out.m12 = a.m12 * b;\r\n  out.m13 = a.m13 * b;\r\n  out.m14 = a.m14 * b;\r\n  out.m15 = a.m15 * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat4} out the receiving vector\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat4} out\r\n */\r\nmat4.multiplyScalarAndAdd = function (out, a, b, scale) {\r\n  out.m00 = a.m00 + (b.m00 * scale);\r\n  out.m01 = a.m01 + (b.m01 * scale);\r\n  out.m02 = a.m02 + (b.m02 * scale);\r\n  out.m03 = a.m03 + (b.m03 * scale);\r\n  out.m04 = a.m04 + (b.m04 * scale);\r\n  out.m05 = a.m05 + (b.m05 * scale);\r\n  out.m06 = a.m06 + (b.m06 * scale);\r\n  out.m07 = a.m07 + (b.m07 * scale);\r\n  out.m08 = a.m08 + (b.m08 * scale);\r\n  out.m09 = a.m09 + (b.m09 * scale);\r\n  out.m10 = a.m10 + (b.m10 * scale);\r\n  out.m11 = a.m11 + (b.m11 * scale);\r\n  out.m12 = a.m12 + (b.m12 * scale);\r\n  out.m13 = a.m13 + (b.m13 * scale);\r\n  out.m14 = a.m14 + (b.m14 * scale);\r\n  out.m15 = a.m15 + (b.m15 * scale);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nmat4.exactEquals = function (a, b) {\r\n  return a.m00 === b.m00 && a.m01 === b.m01 && a.m02 === b.m02 && a.m03 === b.m03 &&\r\n    a.m04 === b.m04 && a.m05 === b.m05 && a.m06 === b.m06 && a.m07 === b.m07 &&\r\n    a.m08 === b.m08 && a.m09 === b.m09 && a.m10 === b.m10 && a.m11 === b.m11 &&\r\n    a.m12 === b.m12 && a.m13 === b.m13 && a.m14 === b.m14 && a.m15 === b.m15;\r\n};\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nmat4.equals = function (a, b) {\r\n  var a0 = a.m00, a1 = a.m01, a2 = a.m02, a3 = a.m03,\r\n      a4 = a.m04, a5 = a.m05, a6 = a.m06, a7 = a.m07,\r\n      a8 = a.m08, a9 = a.m09, a10 = a.m10, a11 = a.m11,\r\n      a12 = a.m12, a13 = a.m13, a14 = a.m14, a15 = a.m15;\r\n\r\n  var b0 = b.m00, b1 = b.m01, b2 = b.m02, b3 = b.m03,\r\n      b4 = b.m04, b5 = b.m05, b6 = b.m06, b7 = b.m07,\r\n      b8 = b.m08, b9 = b.m09, b10 = b.m10, b11 = b.m11,\r\n      b12 = b.m12, b13 = b.m13, b14 = b.m14, b15 = b.m15;\r\n\r\n  return (\r\n    Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\r\n    Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\r\n    Math.abs(a3 - b3) <= EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) &&\r\n    Math.abs(a4 - b4) <= EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) &&\r\n    Math.abs(a5 - b5) <= EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) &&\r\n    Math.abs(a6 - b6) <= EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) &&\r\n    Math.abs(a7 - b7) <= EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) &&\r\n    Math.abs(a8 - b8) <= EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) &&\r\n    Math.abs(a9 - b9) <= EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) &&\r\n    Math.abs(a10 - b10) <= EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) &&\r\n    Math.abs(a11 - b11) <= EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) &&\r\n    Math.abs(a12 - b12) <= EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) &&\r\n    Math.abs(a13 - b13) <= EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) &&\r\n    Math.abs(a14 - b14) <= EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) &&\r\n    Math.abs(a15 - b15) <= EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15))\r\n  );\r\n};\r\n\r\nvar _tmp$8 = new Array(3);\r\n\r\nvar _color3 = function _color3(r, g, b) {\r\n  this.r = r;\r\n  this.g = g;\r\n  this.b = b;\r\n};\r\n\r\n_color3.prototype.toJSON = function toJSON () {\r\n  _tmp$8[0] = this.r;\r\n  _tmp$8[1] = this.g;\r\n  _tmp$8[2] = this.b;\r\n\r\n  return _tmp$8;\r\n};\r\n\r\n/**\r\n * @class Color\r\n * @name color3\r\n */\r\nvar color3 = {};\r\n\r\n/**\r\n * Creates a new color\r\n *\r\n * @returns {color3} a new color\r\n */\r\ncolor3.create = function () {\r\n  return new _color3(1, 1, 1);\r\n};\r\n\r\n/**\r\n * Creates a new color initialized with the given values\r\n *\r\n * @param {Number} r red component\r\n * @param {Number} g green component\r\n * @param {Number} b blue component\r\n * @returns {color3} a new color\r\n * @function\r\n */\r\ncolor3.new = function (r, g, b) {\r\n  return new _color3(r, g, b);\r\n};\r\n\r\n/**\r\n * Creates a new color initialized with values from an existing quaternion\r\n *\r\n * @param {color3} a color to clone\r\n * @returns {color3} a new color\r\n * @function\r\n */\r\ncolor3.clone = function (a) {\r\n  return new _color3(a.r, a.g, a.b, a.a);\r\n};\r\n\r\n/**\r\n * Copy the values from one color to another\r\n *\r\n * @param {color3} out the receiving color\r\n * @param {color3} a the source color\r\n * @returns {color3} out\r\n * @function\r\n */\r\ncolor3.copy = function (out, a) {\r\n  out.r = a.r;\r\n  out.g = a.g;\r\n  out.b = a.b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a color to the given values\r\n *\r\n * @param {color3} out the receiving color\r\n * @param {Number} r red component\r\n * @param {Number} g green component\r\n * @param {Number} b blue component\r\n * @returns {color3} out\r\n * @function\r\n */\r\ncolor3.set = function (out, r, g, b) {\r\n  out.r = r;\r\n  out.g = g;\r\n  out.b = b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set from hex\r\n *\r\n * @param {color3} out the receiving color\r\n * @param {Number} hex\r\n * @returns {color3} out\r\n * @function\r\n */\r\ncolor3.fromHex = function (out, hex) {\r\n  var r = ((hex >> 16)) / 255.0;\r\n  var g = ((hex >> 8) & 0xff) / 255.0;\r\n  var b = ((hex) & 0xff) / 255.0;\r\n\r\n  out.r = r;\r\n  out.g = g;\r\n  out.b = b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two color's\r\n *\r\n * @param {color3} out the receiving color\r\n * @param {color3} a the first operand\r\n * @param {color3} b the second operand\r\n * @returns {color3} out\r\n * @function\r\n */\r\ncolor3.add = function (out, a, b) {\r\n  out.r = a.r + b.r;\r\n  out.g = a.g + b.g;\r\n  out.b = a.b + b.b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts color b from color a\r\n *\r\n * @param {color3} out the receiving color\r\n * @param {color3} a the first operand\r\n * @param {color3} b the second operand\r\n * @returns {color3} out\r\n */\r\ncolor3.subtract = function (out, a, b) {\r\n  out.r = a.r - b.r;\r\n  out.g = a.g - b.g;\r\n  out.b = a.b - b.b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link color3.subtract}\r\n * @function\r\n */\r\ncolor3.sub = color3.subtract;\r\n\r\n/**\r\n * Multiplies two color's\r\n *\r\n * @param {color3} out the receiving color\r\n * @param {color3} a the first operand\r\n * @param {color3} b the second operand\r\n * @returns {color3} out\r\n * @function\r\n */\r\ncolor3.multiply = function (out, a, b) {\r\n  out.r = a.r * b.r;\r\n  out.g = a.g * b.g;\r\n  out.b = a.b * b.b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link color3.multiply}\r\n * @function\r\n */\r\ncolor3.mul = color3.multiply;\r\n\r\n/**\r\n * Divides two color's\r\n *\r\n * @param {color3} out the receiving vector\r\n * @param {color3} a the first operand\r\n * @param {color3} b the second operand\r\n * @returns {color3} out\r\n */\r\ncolor3.divide = function (out, a, b) {\r\n  out.r = a.r / b.r;\r\n  out.g = a.g / b.g;\r\n  out.b = a.b / b.b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link color3.divide}\r\n * @function\r\n */\r\ncolor3.div = color3.divide;\r\n\r\n\r\n/**\r\n * Scales a color by a scalar number\r\n *\r\n * @param {color3} out the receiving vector\r\n * @param {color3} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {color3} out\r\n * @function\r\n */\r\ncolor3.scale = function (out, a, b) {\r\n  out.r = a.r * b;\r\n  out.g = a.g * b;\r\n  out.b = a.b * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Performs a linear interpolation between two color's\r\n *\r\n * @param {color3} out the receiving color\r\n * @param {color3} a the first operand\r\n * @param {color3} b the second operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {color3} out\r\n * @function\r\n */\r\ncolor3.lerp = function (out, a, b, t) {\r\n  var ar = a.r,\r\n      ag = a.g,\r\n      ab = a.b;\r\n  out.r = ar + t * (b.r - ar);\r\n  out.g = ag + t * (b.g - ag);\r\n  out.b = ab + t * (b.b - ab);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a string representation of a color\r\n *\r\n * @param {color3} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\ncolor3.str = function (a) {\r\n  return (\"color3(\" + (a.r) + \", \" + (a.g) + \", \" + (a.b) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {color3} a\r\n * @returns {array}\r\n */\r\ncolor3.array = function (out, a) {\r\n  out[0] = a.r;\r\n  out[1] = a.g;\r\n  out[2] = a.b;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the color have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {color3} a The first color3.\r\n * @param {color3} b The second color3.\r\n * @returns {Boolean} True if the colors are equal, false otherwise.\r\n */\r\ncolor3.exactEquals = function (a, b) {\r\n  return a.r === b.r && a.g === b.g && a.b === b.b;\r\n};\r\n\r\n/**\r\n * Returns whether or not the colors have approximately the same elements in the same position.\r\n *\r\n * @param {color3} a The first color3.\r\n * @param {color3} b The second color3.\r\n * @returns {Boolean} True if the colors are equal, false otherwise.\r\n */\r\ncolor3.equals = function (a, b) {\r\n  var a0 = a.r, a1 = a.g, a2 = a.b;\r\n  var b0 = b.r, b1 = b.g, b2 = b.b;\r\n  return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\r\n    Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)));\r\n};\r\n\r\n/**\r\n * Returns the hex value\r\n *\r\n * @param {color3} a The color\r\n * @returns {Number}\r\n */\r\ncolor3.hex = function (a) {\r\n  return (a.r * 255) << 16 | (a.g * 255) << 8 | (a.b * 255);\r\n};\r\n\r\nvar _tmp$9 = new Array(4);\r\n\r\nvar _color4 = function _color4(r, g, b, a) {\r\n  this.r = r;\r\n  this.g = g;\r\n  this.b = b;\r\n  this.a = a;\r\n};\r\n\r\n_color4.prototype.toJSON = function toJSON () {\r\n  _tmp$9[0] = this.r;\r\n  _tmp$9[1] = this.g;\r\n  _tmp$9[2] = this.b;\r\n  _tmp$9[3] = this.a;\r\n\r\n  return _tmp$9;\r\n};\r\n\r\n/**\r\n * @class Color\r\n * @name color4\r\n */\r\nvar color4 = {};\r\n\r\n/**\r\n * Creates a new color\r\n *\r\n * @returns {color4} a new color\r\n */\r\ncolor4.create = function () {\r\n  return new _color4(1, 1, 1, 1);\r\n};\r\n\r\n/**\r\n * Creates a new color initialized with the given values\r\n *\r\n * @param {Number} r red component\r\n * @param {Number} g green component\r\n * @param {Number} b blue component\r\n * @param {Number} a alpha component\r\n * @returns {color4} a new color\r\n * @function\r\n */\r\ncolor4.new = function (r, g, b, a) {\r\n  return new _color4(r, g, b, a);\r\n};\r\n\r\n/**\r\n * Creates a new color initialized with values from an existing quaternion\r\n *\r\n * @param {color4} a color to clone\r\n * @returns {color4} a new color\r\n * @function\r\n */\r\ncolor4.clone = function (a) {\r\n  return new _color4(a.r, a.g, a.b, a.a);\r\n};\r\n\r\n/**\r\n * Copy the values from one color to another\r\n *\r\n * @param {color4} out the receiving color\r\n * @param {color4} a the source color\r\n * @returns {color4} out\r\n * @function\r\n */\r\ncolor4.copy = function (out, a) {\r\n  out.r = a.r;\r\n  out.g = a.g;\r\n  out.b = a.b;\r\n  out.a = a.a;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set the components of a color to the given values\r\n *\r\n * @param {color4} out the receiving color\r\n * @param {Number} r red component\r\n * @param {Number} g green component\r\n * @param {Number} b blue component\r\n * @param {Number} a alpha component\r\n * @returns {color4} out\r\n * @function\r\n */\r\ncolor4.set = function (out, r, g, b, a) {\r\n  out.r = r;\r\n  out.g = g;\r\n  out.b = b;\r\n  out.a = a;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Set from hex\r\n *\r\n * @param {color4} out the receiving color\r\n * @param {Number} hex\r\n * @returns {color4} out\r\n * @function\r\n */\r\ncolor4.fromHex = function (out, hex) {\r\n  var r = ((hex >> 24)) / 255.0;\r\n  var g = ((hex >> 16) & 0xff) / 255.0;\r\n  var b = ((hex >> 8) & 0xff) / 255.0;\r\n  var a = ((hex) & 0xff) / 255.0;\r\n\r\n  out.r = r;\r\n  out.g = g;\r\n  out.b = b;\r\n  out.a = a;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Adds two color's\r\n *\r\n * @param {color4} out the receiving color\r\n * @param {color4} a the first operand\r\n * @param {color4} b the second operand\r\n * @returns {color4} out\r\n * @function\r\n */\r\ncolor4.add = function (out, a, b) {\r\n  out.r = a.r + b.r;\r\n  out.g = a.g + b.g;\r\n  out.b = a.b + b.b;\r\n  out.a = a.a + b.a;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Subtracts color b from color a\r\n *\r\n * @param {color4} out the receiving color\r\n * @param {color4} a the first operand\r\n * @param {color4} b the second operand\r\n * @returns {color4} out\r\n */\r\ncolor4.subtract = function (out, a, b) {\r\n  out.r = a.r - b.r;\r\n  out.g = a.g - b.g;\r\n  out.b = a.b - b.b;\r\n  out.a = a.a - b.a;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link color4.subtract}\r\n * @function\r\n */\r\ncolor4.sub = color4.subtract;\r\n\r\n/**\r\n * Multiplies two color's\r\n *\r\n * @param {color4} out the receiving color\r\n * @param {color4} a the first operand\r\n * @param {color4} b the second operand\r\n * @returns {color4} out\r\n * @function\r\n */\r\ncolor4.multiply = function (out, a, b) {\r\n  out.r = a.r * b.r;\r\n  out.g = a.g * b.g;\r\n  out.b = a.b * b.b;\r\n  out.a = a.a * b.a;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link color4.multiply}\r\n * @function\r\n */\r\ncolor4.mul = color4.multiply;\r\n\r\n/**\r\n * Divides two color's\r\n *\r\n * @param {color4} out the receiving vector\r\n * @param {color4} a the first operand\r\n * @param {color4} b the second operand\r\n * @returns {color4} out\r\n */\r\ncolor4.divide = function (out, a, b) {\r\n  out.r = a.r / b.r;\r\n  out.g = a.g / b.g;\r\n  out.b = a.b / b.b;\r\n  out.a = a.a / b.a;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Alias for {@link color4.divide}\r\n * @function\r\n */\r\ncolor4.div = color4.divide;\r\n\r\n\r\n/**\r\n * Scales a color by a scalar number\r\n *\r\n * @param {color4} out the receiving vector\r\n * @param {color4} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {color4} out\r\n * @function\r\n */\r\ncolor4.scale = function (out, a, b) {\r\n  out.r = a.r * b;\r\n  out.g = a.g * b;\r\n  out.b = a.b * b;\r\n  out.a = a.a * b;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Performs a linear interpolation between two color's\r\n *\r\n * @param {color4} out the receiving color\r\n * @param {color4} a the first operand\r\n * @param {color4} b the second operand\r\n * @param {Number} t interpolation amount between the two inputs\r\n * @returns {color4} out\r\n * @function\r\n */\r\ncolor4.lerp = function (out, a, b, t) {\r\n  var ar = a.r,\r\n      ag = a.g,\r\n      ab = a.b,\r\n      aa = a.a;\r\n  out.r = ar + t * (b.r - ar);\r\n  out.g = ag + t * (b.g - ag);\r\n  out.b = ab + t * (b.b - ab);\r\n  out.a = aa + t * (b.a - aa);\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a string representation of a color\r\n *\r\n * @param {color4} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\ncolor4.str = function (a) {\r\n  return (\"color4(\" + (a.r) + \", \" + (a.g) + \", \" + (a.b) + \", \" + (a.a) + \")\");\r\n};\r\n\r\n/**\r\n * Returns typed array\r\n *\r\n * @param {array} out\r\n * @param {color4} a\r\n * @returns {array}\r\n */\r\ncolor4.array = function (out, a) {\r\n  out[0] = a.r;\r\n  out[1] = a.g;\r\n  out[2] = a.b;\r\n  out[3] = a.a;\r\n\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns whether or not the color have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {color4} a The first color4.\r\n * @param {color4} b The second color4.\r\n * @returns {Boolean} True if the colors are equal, false otherwise.\r\n */\r\ncolor4.exactEquals = function (a, b) {\r\n  return a.r === b.r && a.g === b.g && a.b === b.b && a.a === b.a;\r\n};\r\n\r\n/**\r\n * Returns whether or not the colors have approximately the same elements in the same position.\r\n *\r\n * @param {color4} a The first color4.\r\n * @param {color4} b The second color4.\r\n * @returns {Boolean} True if the colors are equal, false otherwise.\r\n */\r\ncolor4.equals = function (a, b) {\r\n  var a0 = a.r, a1 = a.g, a2 = a.b, a3 = a.a;\r\n  var b0 = b.r, b1 = b.g, b2 = b.b, b3 = b.a;\r\n  return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\r\n    Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\r\n    Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\r\n    Math.abs(a3 - b3) <= EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)));\r\n};\r\n\r\n/**\r\n * Returns the hex value\r\n *\r\n * @param {color4} a The color\r\n * @returns {Number}\r\n */\r\ncolor4.hex = function (a) {\r\n  return ((a.r * 255) << 24 | (a.g * 255) << 16 | (a.b * 255) << 8 | a.a * 255) >>> 0;\r\n};\r\n\r\n// NOTE: there is no syntax for: export {* as bits} from './lib/bits';\r\nvar bits = bits_;\r\n\r\n\r\n\r\nvar math = Object.freeze({\r\n\tbits: bits,\r\n\tvec2: vec2,\r\n\tvec3: vec3,\r\n\tvec4: vec4,\r\n\tquat: quat,\r\n\tmat2: mat2,\r\n\tmat23: mat23,\r\n\tmat3: mat3,\r\n\tmat4: mat4,\r\n\tcolor3: color3,\r\n\tcolor4: color4,\r\n\tEPSILON: EPSILON,\r\n\tequals: equals,\r\n\tapprox: approx,\r\n\tclamp: clamp,\r\n\tclamp01: clamp01,\r\n\tlerp: lerp,\r\n\ttoRadian: toRadian,\r\n\ttoDegree: toDegree,\r\n\trandom: random,\r\n\trandomRange: randomRange,\r\n\trandomRangeInt: randomRangeInt,\r\n\tnextPow2: nextPow2\r\n});\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar enums = {\r\n  // projection\r\n  PROJ_PERSPECTIVE: 0,\r\n  PROJ_ORTHO: 1,\r\n\r\n  // lights\r\n  LIGHT_DIRECTIONAL: 0,\r\n  LIGHT_POINT: 1,\r\n  LIGHT_SPOT: 2,\r\n\r\n  // shadows\r\n  SHADOW_NONE: 0,\r\n  SHADOW_HARD: 1,\r\n  SHADOW_SOFT: 2,\r\n\r\n  // parameter type\r\n  PARAM_INT:             0,\r\n  PARAM_INT2:            1,\r\n  PARAM_INT3:            2,\r\n  PARAM_INT4:            3,\r\n  PARAM_FLOAT:           4,\r\n  PARAM_FLOAT2:          5,\r\n  PARAM_FLOAT3:          6,\r\n  PARAM_FLOAT4:          7,\r\n  PARAM_COLOR3:          8,\r\n  PARAM_COLOR4:          9,\r\n  PARAM_MAT2:           10,\r\n  PARAM_MAT3:           11,\r\n  PARAM_MAT4:           12,\r\n  PARAM_TEXTURE_2D:     13,\r\n  PARAM_TEXTURE_CUBE:   14,\r\n\r\n  // clear flags\r\n  CLEAR_COLOR: 1,\r\n  CLEAR_DEPTH: 2,\r\n  CLEAR_STENCIL: 4,\r\n};\r\n\r\nvar GL_NEAREST = 9728;                // gl.NEAREST\r\nvar GL_LINEAR = 9729;                 // gl.LINEAR\r\nvar GL_NEAREST_MIPMAP_NEAREST = 9984; // gl.NEAREST_MIPMAP_NEAREST\r\nvar GL_LINEAR_MIPMAP_NEAREST = 9985;  // gl.LINEAR_MIPMAP_NEAREST\r\nvar GL_NEAREST_MIPMAP_LINEAR = 9986;  // gl.NEAREST_MIPMAP_LINEAR\r\nvar GL_LINEAR_MIPMAP_LINEAR = 9987;   // gl.LINEAR_MIPMAP_LINEAR\r\n\r\n// const GL_BYTE = 5120;                  // gl.BYTE\r\nvar GL_UNSIGNED_BYTE = 5121;            // gl.UNSIGNED_BYTE\r\n// const GL_SHORT = 5122;                 // gl.SHORT\r\nvar GL_UNSIGNED_SHORT = 5123;           // gl.UNSIGNED_SHORT\r\nvar GL_UNSIGNED_INT = 5125;             // gl.UNSIGNED_INT\r\nvar GL_FLOAT = 5126;                    // gl.FLOAT\r\nvar GL_UNSIGNED_SHORT_5_6_5 = 33635;    // gl.UNSIGNED_SHORT_5_6_5\r\nvar GL_UNSIGNED_SHORT_4_4_4_4 = 32819;  // gl.UNSIGNED_SHORT_4_4_4_4\r\nvar GL_UNSIGNED_SHORT_5_5_5_1 = 32820;  // gl.UNSIGNED_SHORT_5_5_5_1\r\nvar GL_HALF_FLOAT_OES = 36193;          // gl.HALF_FLOAT_OES\r\n\r\nvar GL_DEPTH_COMPONENT = 6402; // gl.DEPTH_COMPONENT\r\n\r\nvar GL_ALPHA = 6406;            // gl.ALPHA\r\nvar GL_RGB = 6407;              // gl.RGB\r\nvar GL_RGBA = 6408;             // gl.RGBA\r\nvar GL_LUMINANCE = 6409;        // gl.LUMINANCE\r\nvar GL_LUMINANCE_ALPHA = 6410;  // gl.LUMINANCE_ALPHA\r\n\r\nvar GL_COMPRESSED_RGB_S3TC_DXT1_EXT = 0x83F0;   // ext.COMPRESSED_RGB_S3TC_DXT1_EXT\r\nvar GL_COMPRESSED_RGBA_S3TC_DXT1_EXT = 0x83F1;  // ext.COMPRESSED_RGBA_S3TC_DXT1_EXT\r\nvar GL_COMPRESSED_RGBA_S3TC_DXT3_EXT = 0x83F2;  // ext.COMPRESSED_RGBA_S3TC_DXT3_EXT\r\nvar GL_COMPRESSED_RGBA_S3TC_DXT5_EXT = 0x83F3;  // ext.COMPRESSED_RGBA_S3TC_DXT5_EXT\r\n\r\nvar GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG = 0x8C00;  // ext.COMPRESSED_RGB_PVRTC_4BPPV1_IMG\r\nvar GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG = 0x8C01;  // ext.COMPRESSED_RGB_PVRTC_2BPPV1_IMG\r\nvar GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG = 0x8C02; // ext.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG\r\nvar GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG = 0x8C03; // ext.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG\r\n\r\nvar GL_COMPRESSED_RGB_ETC1_WEBGL = 0x8D64; // ext.COMPRESSED_RGB_ETC1_WEBGL\r\n\r\nvar _filterGL = [\r\n  [ GL_NEAREST,  GL_NEAREST_MIPMAP_NEAREST, GL_NEAREST_MIPMAP_LINEAR ],\r\n  [ GL_LINEAR,  GL_LINEAR_MIPMAP_NEAREST, GL_LINEAR_MIPMAP_LINEAR ] ];\r\n\r\nvar _textureFmtGL = [\r\n  // TEXTURE_FMT_RGB_DXT1: 0\r\n  { format: GL_RGB, internalFormat: GL_COMPRESSED_RGB_S3TC_DXT1_EXT, pixelType: null },\r\n\r\n  // TEXTURE_FMT_RGBA_DXT1: 1\r\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_S3TC_DXT1_EXT, pixelType: null },\r\n\r\n  // TEXTURE_FMT_RGBA_DXT3: 2\r\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_S3TC_DXT3_EXT, pixelType: null },\r\n\r\n  // TEXTURE_FMT_RGBA_DXT5: 3\r\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_S3TC_DXT5_EXT, pixelType: null },\r\n\r\n  // TEXTURE_FMT_RGB_ETC1: 4\r\n  { format: GL_RGB, internalFormat: GL_COMPRESSED_RGB_ETC1_WEBGL, pixelType: null },\r\n\r\n  // TEXTURE_FMT_RGB_PVRTC_2BPPV1: 5\r\n  { format: GL_RGB, internalFormat: GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG, pixelType: null },\r\n\r\n  // TEXTURE_FMT_RGBA_PVRTC_2BPPV1: 6\r\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG, pixelType: null },\r\n\r\n  // TEXTURE_FMT_RGB_PVRTC_4BPPV1: 7\r\n  { format: GL_RGB, internalFormat: GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG, pixelType: null },\r\n\r\n  // TEXTURE_FMT_RGBA_PVRTC_4BPPV1: 8\r\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG, pixelType: null },\r\n\r\n  // TEXTURE_FMT_A8: 9\r\n  { format: GL_ALPHA, internalFormat: GL_ALPHA, pixelType: GL_UNSIGNED_BYTE },\r\n\r\n  // TEXTURE_FMT_L8: 10\r\n  { format: GL_LUMINANCE, internalFormat: GL_LUMINANCE, pixelType: GL_UNSIGNED_BYTE },\r\n\r\n  // TEXTURE_FMT_L8_A8: 11\r\n  { format: GL_LUMINANCE_ALPHA, internalFormat: GL_LUMINANCE_ALPHA, pixelType: GL_UNSIGNED_BYTE },\r\n\r\n  // TEXTURE_FMT_R5_G6_B5: 12\r\n  { format: GL_RGB, internalFormat: GL_RGB, pixelType: GL_UNSIGNED_SHORT_5_6_5 },\r\n\r\n  // TEXTURE_FMT_R5_G5_B5_A1: 13\r\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_UNSIGNED_SHORT_5_5_5_1 },\r\n\r\n  // TEXTURE_FMT_R4_G4_B4_A4: 14\r\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_UNSIGNED_SHORT_4_4_4_4 },\r\n\r\n  // TEXTURE_FMT_RGB8: 15\r\n  { format: GL_RGB, internalFormat: GL_RGB, pixelType: GL_UNSIGNED_BYTE },\r\n\r\n  // TEXTURE_FMT_RGBA8: 16\r\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_UNSIGNED_BYTE },\r\n\r\n  // TEXTURE_FMT_RGB16F: 17\r\n  { format: GL_RGB, internalFormat: GL_RGB, pixelType: GL_HALF_FLOAT_OES },\r\n\r\n  // TEXTURE_FMT_RGBA16F: 18\r\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_HALF_FLOAT_OES },\r\n\r\n  // TEXTURE_FMT_RGB32F: 19\r\n  { format: GL_RGB, internalFormat: GL_RGB, pixelType: GL_FLOAT },\r\n\r\n  // TEXTURE_FMT_RGBA32F: 20\r\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_FLOAT },\r\n\r\n  // TEXTURE_FMT_R32F: 21\r\n  { format: null, internalFormat: null, pixelType: null },\r\n\r\n  // TEXTURE_FMT_111110F: 22\r\n  { format: null, internalFormat: null, pixelType: null },\r\n\r\n  // TEXTURE_FMT_SRGB: 23\r\n  { format: null, internalFormat: null, pixelType: null },\r\n\r\n  // TEXTURE_FMT_SRGBA: 24\r\n  { format: null, internalFormat: null, pixelType: null },\r\n\r\n  // TEXTURE_FMT_D16: 25\r\n  { format: GL_DEPTH_COMPONENT, internalFormat: GL_DEPTH_COMPONENT, pixelType: GL_UNSIGNED_SHORT },\r\n\r\n  // TEXTURE_FMT_D32: 26\r\n  { format: GL_DEPTH_COMPONENT, internalFormat: GL_DEPTH_COMPONENT, pixelType: GL_UNSIGNED_INT },\r\n\r\n  // TEXTURE_FMT_D24S8: 27\r\n  { format: null, internalFormat: null, pixelType: null } ];\r\n\r\n/**\r\n * enums\r\n */\r\nvar enums$1 = {\r\n  // buffer usage\r\n  USAGE_STATIC: 35044,  // gl.STATIC_DRAW\r\n  USAGE_DYNAMIC: 35048, // gl.DYNAMIC_DRAW\r\n  USAGE_STREAM: 35040,  // gl.STREAM_DRAW\r\n\r\n  // index buffer format\r\n  INDEX_FMT_UINT8: 5121,  // gl.UNSIGNED_BYTE\r\n  INDEX_FMT_UINT16: 5123, // gl.UNSIGNED_SHORT\r\n  INDEX_FMT_UINT32: 5125, // gl.UNSIGNED_INT (OES_element_index_uint)\r\n\r\n  // vertex attribute semantic\r\n  ATTR_POSITION: 'a_position',\r\n  ATTR_NORMAL: 'a_normal',\r\n  ATTR_TANGENT: 'a_tangent',\r\n  ATTR_BITANGENT: 'a_bitangent',\r\n  ATTR_WEIGHTS: 'a_weights',\r\n  ATTR_JOINTS: 'a_joints',\r\n  ATTR_COLOR: 'a_color',\r\n  ATTR_COLOR0: 'a_color0',\r\n  ATTR_COLOR1: 'a_color1',\r\n  ATTR_UV: 'a_uv',\r\n  ATTR_UV0: 'a_uv0',\r\n  ATTR_UV1: 'a_uv1',\r\n  ATTR_UV2: 'a_uv2',\r\n  ATTR_UV3: 'a_uv3',\r\n  ATTR_UV4: 'a_uv4',\r\n  ATTR_UV5: 'a_uv5',\r\n  ATTR_UV6: 'a_uv6',\r\n  ATTR_UV7: 'a_uv7',\r\n\r\n  // vertex attribute type\r\n  ATTR_TYPE_INT8: 5120,    // gl.BYTE\r\n  ATTR_TYPE_UINT8: 5121,   // gl.UNSIGNED_BYTE\r\n  ATTR_TYPE_INT16: 5122,   // gl.SHORT\r\n  ATTR_TYPE_UINT16: 5123,  // gl.UNSIGNED_SHORT\r\n  ATTR_TYPE_INT32: 5124,   // gl.INT\r\n  ATTR_TYPE_UINT32: 5125,  // gl.UNSIGNED_INT\r\n  ATTR_TYPE_FLOAT32: 5126, // gl.FLOAT\r\n\r\n  // texture filter\r\n  FILTER_NEAREST: 0,\r\n  FILTER_LINEAR: 1,\r\n\r\n  // texture wrap mode\r\n  WRAP_REPEAT: 10497, // gl.REPEAT\r\n  WRAP_CLAMP: 33071,  // gl.CLAMP_TO_EDGE\r\n  WRAP_MIRROR: 33648, // gl.MIRRORED_REPEAT\r\n\r\n  // texture format\r\n  // compress formats\r\n  TEXTURE_FMT_RGB_DXT1: 0,\r\n  TEXTURE_FMT_RGBA_DXT1: 1,\r\n  TEXTURE_FMT_RGBA_DXT3: 2,\r\n  TEXTURE_FMT_RGBA_DXT5: 3,\r\n  TEXTURE_FMT_RGB_ETC1: 4,\r\n  TEXTURE_FMT_RGB_PVRTC_2BPPV1: 5,\r\n  TEXTURE_FMT_RGBA_PVRTC_2BPPV1: 6,\r\n  TEXTURE_FMT_RGB_PVRTC_4BPPV1: 7,\r\n  TEXTURE_FMT_RGBA_PVRTC_4BPPV1: 8,\r\n\r\n  // normal formats\r\n  TEXTURE_FMT_A8: 9,\r\n  TEXTURE_FMT_L8: 10,\r\n  TEXTURE_FMT_L8_A8: 11,\r\n  TEXTURE_FMT_R5_G6_B5: 12,\r\n  TEXTURE_FMT_R5_G5_B5_A1: 13,\r\n  TEXTURE_FMT_R4_G4_B4_A4: 14,\r\n  TEXTURE_FMT_RGB8: 15,\r\n  TEXTURE_FMT_RGBA8: 16,\r\n  TEXTURE_FMT_RGB16F: 17,\r\n  TEXTURE_FMT_RGBA16F: 18,\r\n  TEXTURE_FMT_RGB32F: 19,\r\n  TEXTURE_FMT_RGBA32F: 20,\r\n  TEXTURE_FMT_R32F: 21,\r\n  TEXTURE_FMT_111110F: 22,\r\n  TEXTURE_FMT_SRGB: 23,\r\n  TEXTURE_FMT_SRGBA: 24,\r\n\r\n  // depth formats\r\n  TEXTURE_FMT_D16: 25,\r\n  TEXTURE_FMT_D32: 26,\r\n  TEXTURE_FMT_D24S8: 27,\r\n\r\n  // depth and stencil function\r\n  DS_FUNC_NEVER: 512,    // gl.NEVER\r\n  DS_FUNC_LESS: 513,     // gl.LESS\r\n  DS_FUNC_EQUAL: 514,    // gl.EQUAL\r\n  DS_FUNC_LEQUAL: 515,   // gl.LEQUAL\r\n  DS_FUNC_GREATER: 516,  // gl.GREATER\r\n  DS_FUNC_NOTEQUAL: 517, // gl.NOTEQUAL\r\n  DS_FUNC_GEQUAL: 518,   // gl.GEQUAL\r\n  DS_FUNC_ALWAYS: 519,   // gl.ALWAYS\r\n\r\n  // render-buffer format\r\n  RB_FMT_RGBA4: 32854,    // gl.RGBA4\r\n  RB_FMT_RGB5_A1: 32855,  // gl.RGB5_A1\r\n  RB_FMT_RGB565: 36194,   // gl.RGB565\r\n  RB_FMT_D16: 33189,      // gl.DEPTH_COMPONENT16\r\n  RB_FMT_S8: 36168,       // gl.STENCIL_INDEX8\r\n  RB_FMT_D24S8: 34041,    // gl.DEPTH_STENCIL\r\n\r\n  // blend-equation\r\n  BLEND_FUNC_ADD: 32774,              // gl.FUNC_ADD\r\n  BLEND_FUNC_SUBTRACT: 32778,         // gl.FUNC_SUBTRACT\r\n  BLEND_FUNC_REVERSE_SUBTRACT: 32779, // gl.FUNC_REVERSE_SUBTRACT\r\n\r\n  // blend\r\n  BLEND_ZERO: 0,                          // gl.ZERO\r\n  BLEND_ONE: 1,                           // gl.ONE\r\n  BLEND_SRC_COLOR: 768,                   // gl.SRC_COLOR\r\n  BLEND_ONE_MINUS_SRC_COLOR: 769,         // gl.ONE_MINUS_SRC_COLOR\r\n  BLEND_DST_COLOR: 774,                   // gl.DST_COLOR\r\n  BLEND_ONE_MINUS_DST_COLOR: 775,         // gl.ONE_MINUS_DST_COLOR\r\n  BLEND_SRC_ALPHA: 770,                   // gl.SRC_ALPHA\r\n  BLEND_ONE_MINUS_SRC_ALPHA: 771,         // gl.ONE_MINUS_SRC_ALPHA\r\n  BLEND_DST_ALPHA: 772,                   // gl.DST_ALPHA\r\n  BLEND_ONE_MINUS_DST_ALPHA: 773,         // gl.ONE_MINUS_DST_ALPHA\r\n  BLEND_CONSTANT_COLOR: 32769,            // gl.CONSTANT_COLOR\r\n  BLEND_ONE_MINUS_CONSTANT_COLOR: 32770,  // gl.ONE_MINUS_CONSTANT_COLOR\r\n  BLEND_CONSTANT_ALPHA: 32771,            // gl.CONSTANT_ALPHA\r\n  BLEND_ONE_MINUS_CONSTANT_ALPHA: 32772,  // gl.ONE_MINUS_CONSTANT_ALPHA\r\n  BLEND_SRC_ALPHA_SATURATE: 776,          // gl.SRC_ALPHA_SATURATE\r\n\r\n  // stencil operation\r\n  STENCIL_OP_KEEP: 7680,          // gl.KEEP\r\n  STENCIL_OP_ZERO: 0,             // gl.ZERO\r\n  STENCIL_OP_REPLACE: 7681,       // gl.REPLACE\r\n  STENCIL_OP_INCR: 7682,          // gl.INCR\r\n  STENCIL_OP_INCR_WRAP: 34055,    // gl.INCR_WRAP\r\n  STENCIL_OP_DECR: 7683,          // gl.DECR\r\n  STENCIL_OP_DECR_WRAP: 34056,    // gl.DECR_WRAP\r\n  STENCIL_OP_INVERT: 5386,        // gl.INVERT\r\n\r\n  // cull\r\n  CULL_NONE: 0,\r\n  CULL_FRONT: 1028,\r\n  CULL_BACK: 1029,\r\n  CULL_FRONT_AND_BACK: 1032,\r\n\r\n  // primitive type\r\n  PT_POINTS: 0,         // gl.POINTS\r\n  PT_LINES: 1,          // gl.LINES\r\n  PT_LINE_LOOP: 2,      // gl.LINE_LOOP\r\n  PT_LINE_STRIP: 3,     // gl.LINE_STRIP\r\n  PT_TRIANGLES: 4,      // gl.TRIANGLES\r\n  PT_TRIANGLE_STRIP: 5, // gl.TRIANGLE_STRIP\r\n  PT_TRIANGLE_FAN: 6,   // gl.TRIANGLE_FAN\r\n};\r\n\r\n/**\r\n * @method attrTypeBytes\r\n * @param {ATTR_TYPE_*} attrType\r\n */\r\nfunction attrTypeBytes(attrType) {\r\n  if (attrType === enums$1.ATTR_TYPE_INT8) {\r\n    return 1;\r\n  } else if (attrType === enums$1.ATTR_TYPE_UINT8) {\r\n    return 1;\r\n  } else if (attrType === enums$1.ATTR_TYPE_INT16) {\r\n    return 2;\r\n  } else if (attrType === enums$1.ATTR_TYPE_UINT16) {\r\n    return 2;\r\n  } else if (attrType === enums$1.ATTR_TYPE_INT32) {\r\n    return 4;\r\n  } else if (attrType === enums$1.ATTR_TYPE_UINT32) {\r\n    return 4;\r\n  } else if (attrType === enums$1.ATTR_TYPE_FLOAT32) {\r\n    return 4;\r\n  }\r\n\r\n  console.warn((\"Unknown ATTR_TYPE: \" + attrType));\r\n  return 0;\r\n}\r\n\r\n/**\r\n * @method glFilter\r\n * @param {WebGLContext} gl\r\n * @param {FILTER_*} filter\r\n * @param {FILTER_*} mipFilter\r\n */\r\nfunction glFilter(gl, filter, mipFilter) {\r\n  if ( mipFilter === void 0 ) mipFilter = -1;\r\n\r\n  var result = _filterGL[filter][mipFilter+1];\r\n  if (result === undefined) {\r\n    console.warn((\"Unknown FILTER: \" + filter));\r\n    return mipFilter === -1 ? gl.LINEAR : gl.LINEAR_MIPMAP_LINEAR;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * @method glTextureFmt\r\n * @param {TEXTURE_FMT_*} fmt\r\n */\r\nfunction glTextureFmt(fmt) {\r\n  var result = _textureFmtGL[fmt];\r\n  if (result === undefined) {\r\n    console.warn((\"Unknown TEXTURE_FMT: \" + fmt));\r\n    return _textureFmtGL[enums$1.TEXTURE_FMT_RGBA8];\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n// ====================\r\n// exports\r\n// ====================\r\n\r\nvar VertexFormat = function VertexFormat(infos) {\r\n  var this$1 = this;\r\n\r\n  this._attr2el = {};\r\n  this._elements = [];\r\n  this._bytes = 0;\r\n\r\n  var offset = 0;\r\n  for (var i = 0, len = infos.length; i < len; ++i) {\r\n    var info = infos[i];\r\n    var el = {\r\n      name: info.name,\r\n      offset: offset,\r\n      stride: 0,\r\n      stream: -1,\r\n      type: info.type,\r\n      num: info.num,\r\n      normalize: (info.normalize === undefined) ? false : info.normalize,\r\n      bytes: info.num * attrTypeBytes(info.type),\r\n    };\r\n\r\n    this$1._attr2el[el.name] = el;\r\n    this$1._elements.push(el);\r\n\r\n    this$1._bytes += el.bytes;\r\n    offset += el.bytes;\r\n  }\r\n\r\n  for (var i$1 = 0, len$1 = this._elements.length; i$1 < len$1; ++i$1) {\r\n    var el$1 = this$1._elements[i$1];\r\n    el$1.stride = this$1._bytes;\r\n  }\r\n};\r\n\r\n/**\r\n * @method element\r\n * @param {string} attrName\r\n */\r\nVertexFormat.prototype.element = function element (attrName) {\r\n  return this._attr2el[attrName];\r\n};\r\n\r\nvar IndexBuffer = function IndexBuffer(device, format, usage, data, numIndices) {\r\n  this._device = device;\r\n  this._format = format;\r\n  this._usage = usage;\r\n  this._numIndices = numIndices;\r\n  this._bytesPerIndex = 0;\r\n\r\n  // calculate bytes\r\n  if (format === enums$1.INDEX_FMT_UINT8) {\r\n    this._bytesPerIndex = 1;\r\n  } else if (format === enums$1.INDEX_FMT_UINT16) {\r\n    this._bytesPerIndex = 2;\r\n  } else if (format === enums$1.INDEX_FMT_UINT32) {\r\n    this._bytesPerIndex = 4;\r\n  }\r\n  this._bytes = this._bytesPerIndex * numIndices;\r\n\r\n  // update\r\n  this._glID = device._gl.createBuffer();\r\n  this.update(0, data);\r\n\r\n  // stats\r\n  device._stats.ib += this._bytes;\r\n};\r\n\r\nvar prototypeAccessors = { count: { configurable: true } };\r\n\r\n/**\r\n * @method destroy\r\n */\r\nIndexBuffer.prototype.destroy = function destroy () {\r\n  if (this._glID === -1) {\r\n    console.error('The buffer already destroyed');\r\n    return;\r\n  }\r\n\r\n  var gl = this._device._gl;\r\n  gl.deleteBuffer(this._glID);\r\n  this._device._stats.ib -= this.bytes;\r\n\r\n  this._glID = -1;\r\n};\r\n\r\n/**\r\n * @method update\r\n * @param {Number} offset\r\n * @param {ArrayBuffer} data\r\n */\r\nIndexBuffer.prototype.update = function update (offset, data) {\r\n  if (this._glID === -1) {\r\n    console.error('The buffer is destroyed');\r\n    return;\r\n  }\r\n\r\n  if (data && data.byteLength + offset > this._bytes) {\r\n    console.error('Failed to update data, bytes exceed.');\r\n    return;\r\n  }\r\n\r\n  var gl = this._device._gl;\r\n  var glUsage = this._usage;\r\n\r\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._glID);\r\n  if (!data) {\r\n    if (this._bytes) {\r\n      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this._bytes, glUsage);\r\n    } else {\r\n      console.warn('bufferData should not submit 0 bytes data');\r\n    }\r\n  } else {\r\n    if (offset) {\r\n      gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, offset, data);\r\n    } else {\r\n      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, glUsage);\r\n    }\r\n  }\r\n  this._device._restoreIndexBuffer();\r\n};\r\n\r\nprototypeAccessors.count.get = function () {\r\n  return this._numIndices;\r\n};\r\n\r\nObject.defineProperties( IndexBuffer.prototype, prototypeAccessors );\r\n\r\nvar VertexBuffer = function VertexBuffer(device, format, usage, data, numVertices) {\r\n  this._device = device;\r\n  this._format = format;\r\n  this._usage = usage;\r\n  this._numVertices = numVertices;\r\n\r\n  // calculate bytes\r\n  this._bytes = this._format._bytes * numVertices;\r\n\r\n  // update\r\n  this._glID = device._gl.createBuffer();\r\n  this.update(0, data);\r\n\r\n  // stats\r\n  device._stats.vb += this._bytes;\r\n};\r\n\r\nvar prototypeAccessors$1 = { count: { configurable: true } };\r\n\r\n/**\r\n * @method destroy\r\n */\r\nVertexBuffer.prototype.destroy = function destroy () {\r\n  if (this._glID === -1) {\r\n    console.error('The buffer already destroyed');\r\n    return;\r\n  }\r\n\r\n  var gl = this._device._gl;\r\n  gl.deleteBuffer(this._glID);\r\n  this._device._stats.vb -= this.bytes;\r\n\r\n  this._glID = -1;\r\n};\r\n\r\n/**\r\n * @method update\r\n * @param {Number} offset\r\n * @param {ArrayBuffer} data\r\n */\r\nVertexBuffer.prototype.update = function update (offset, data) {\r\n  if (this._glID === -1) {\r\n    console.error('The buffer is destroyed');\r\n    return;\r\n  }\r\n\r\n  if (data && data.byteLength + offset > this._bytes) {\r\n    console.error('Failed to update data, bytes exceed.');\r\n    return;\r\n  }\r\n\r\n  var gl = this._device._gl;\r\n  var glUsage = this._usage;\r\n\r\n  gl.bindBuffer(gl.ARRAY_BUFFER, this._glID);\r\n  if (!data) {\r\n    if (this._bytes) {\r\n      gl.bufferData(gl.ARRAY_BUFFER, this._bytes, glUsage);\r\n    } else {\r\n      console.warn('bufferData should not submit 0 bytes data');\r\n    }\r\n  } else {\r\n    if (offset) {\r\n      gl.bufferSubData(gl.ARRAY_BUFFER, offset, data);\r\n    } else {\r\n      gl.bufferData(gl.ARRAY_BUFFER, data, glUsage);\r\n    }\r\n  }\r\n  gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n};\r\n\r\nprototypeAccessors$1.count.get = function () {\r\n  return this._numVertices;\r\n};\r\n\r\nObject.defineProperties( VertexBuffer.prototype, prototypeAccessors$1 );\r\n\r\nvar _genID = 0;\r\n\r\nfunction _parseError(out, type, errorLog) {\r\n  errorLog.split('\\n').forEach(function (msg) {\r\n    if (msg.length < 5) {\r\n      return;\r\n    }\r\n\r\n    var parts = /^ERROR\\:\\s+(\\d+)\\:(\\d+)\\:\\s*(.*)$/.exec(msg);\r\n    if (parts) {\r\n      out.push({\r\n        type: type,\r\n        fileID: parts[1] | 0,\r\n        line: parts[2] | 0,\r\n        message: parts[3].trim()\r\n      });\r\n    } else if (msg.length > 0) {\r\n      out.push({\r\n        type: type,\r\n        fileID: -1,\r\n        line: 0,\r\n        message: msg\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nvar Program = function Program(device, options) {\r\n  this._device = device;\r\n\r\n  // stores gl information: { location, type }\r\n  this._attributes = [];\r\n  this._uniforms = [];\r\n  this._samplers = [];\r\n  this._errors = [];\r\n  this._linked = false;\r\n  this._vertSource = options.vert;\r\n  this._fragSource = options.frag;\r\n  this._glID = null;\r\n  this._id = _genID++;\r\n};\r\n\r\nvar prototypeAccessors$2 = { id: { configurable: true } };\r\n\r\nprototypeAccessors$2.id.get = function () {\r\n  return this._id;\r\n};\r\n\r\nProgram.prototype.link = function link () {\r\n    var this$1 = this;\r\n\r\n  if (this._linked) {\r\n    return;\r\n  }\r\n\r\n  var gl = this._device._gl;\r\n\r\n  var vertShader = _createShader(gl, gl.VERTEX_SHADER, this._vertSource);\r\n  var fragShader = _createShader(gl, gl.FRAGMENT_SHADER, this._fragSource);\r\n\r\n  var program = gl.createProgram();\r\n  gl.attachShader(program, vertShader);\r\n  gl.attachShader(program, fragShader);\r\n  gl.linkProgram(program);\r\n\r\n  var failed = false;\r\n  var errors = this._errors;\r\n\r\n  if (!gl.getShaderParameter(vertShader, gl.COMPILE_STATUS)) {\r\n    _parseError(errors, 'vs', gl.getShaderInfoLog(vertShader));\r\n    failed = true;\r\n  }\r\n\r\n  if (!gl.getShaderParameter(fragShader, gl.COMPILE_STATUS)) {\r\n    _parseError(errors, 'fs', gl.getShaderInfoLog(fragShader));\r\n    failed = true;\r\n  }\r\n\r\n  gl.deleteShader(vertShader);\r\n  gl.deleteShader(fragShader);\r\n\r\n  if (failed) {\r\n    errors.forEach(function (err) {\r\n      console.error((\"Failed to compile \" + (err.type) + \" \" + (err.fileID) + \" (ln \" + (err.line) + \"): \" + (err.message)));\r\n    });\r\n    return;\r\n  }\r\n\r\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n    console.error((\"Failed to link shader program: \" + (gl.getProgramInfoLog(program))));\r\n    failed = true;\r\n  }\r\n\r\n  if (failed) {\r\n    return;\r\n  }\r\n\r\n  this._glID = program;\r\n\r\n  // parse attribute\r\n  var numAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\r\n  for (var i = 0; i < numAttributes; ++i) {\r\n    var info = gl.getActiveAttrib(program, i);\r\n    var location = gl.getAttribLocation(program, info.name);\r\n\r\n    this$1._attributes.push({\r\n      name: info.name,\r\n      location: location,\r\n      type: info.type,\r\n    });\r\n  }\r\n\r\n  // parse uniform\r\n  var numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\r\n  for (var i$1 = 0; i$1 < numUniforms; ++i$1) {\r\n    var info$1 = gl.getActiveUniform(program, i$1);\r\n    var name = info$1.name;\r\n    var location$1 = gl.getUniformLocation(program, name);\r\n    var isArray = name.substr(name.length - 3) === '[0]';\r\n    if (isArray) {\r\n      name = name.substr(0, name.length - 3);\r\n    }\r\n\r\n    this$1._uniforms.push({\r\n      name: name,\r\n      location: location$1,\r\n      type: info$1.type,\r\n      size: isArray ? info$1.size : undefined, // used when uniform is an array\r\n    });\r\n  }\r\n\r\n  this._linked = true;\r\n};\r\n\r\nProgram.prototype.destroy = function destroy () {\r\n  var gl = this._device._gl;\r\n  gl.deleteProgram(this._glID);\r\n\r\n  this._linked = false;\r\n  this._glID = null;\r\n  this._attributes = [];\r\n  this._uniforms = [];\r\n  this._samplers = [];\r\n};\r\n\r\nObject.defineProperties( Program.prototype, prototypeAccessors$2 );\r\n\r\n// ====================\r\n// internal\r\n// ====================\r\n\r\nfunction _createShader(gl, type, src) {\r\n  var shader = gl.createShader(type);\r\n  gl.shaderSource(shader, src);\r\n  gl.compileShader(shader);\r\n\r\n  return shader;\r\n}\r\n\r\nvar Texture = function Texture(device) {\r\n  this._device = device;\r\n\r\n  this._width = 4;\r\n  this._height = 4;\r\n  this._hasMipmap = false;\r\n  this._compressed = false;\r\n\r\n  this._anisotropy = 1;\r\n  this._minFilter = enums$1.FILTER_LINEAR;\r\n  this._magFilter = enums$1.FILTER_LINEAR;\r\n  this._mipFilter = enums$1.FILTER_LINEAR;\r\n  this._wrapS = enums$1.WRAP_REPEAT;\r\n  this._wrapT = enums$1.WRAP_REPEAT;\r\n  // wrapR available in webgl2\r\n  // this._wrapR = enums.WRAP_REPEAT;\r\n  this._format = enums$1.TEXTURE_FMT_RGBA8;\r\n\r\n  this._target = -1;\r\n};\r\n\r\n/**\r\n * @method destroy\r\n */\r\nTexture.prototype.destroy = function destroy () {\r\n  if (this._glID === -1) {\r\n    console.error('The texture already destroyed');\r\n    return;\r\n  }\r\n\r\n  var gl = this._device._gl;\r\n  gl.deleteTexture(this._glID);\r\n\r\n  this._device._stats.tex -= this.bytes;\r\n  this._glID = -1;\r\n};\r\n\r\nfunction isPow2$1(v) {\r\n  return !(v & (v - 1)) && (!!v);\r\n}\r\n\r\nvar Texture2D = (function (Texture$$1) {\r\n  function Texture2D(device, options) {\r\n    Texture$$1.call(this, device);\r\n\r\n    var gl = this._device._gl;\r\n    this._target = gl.TEXTURE_2D;\r\n    this._glID = gl.createTexture();\r\n\r\n    // always alloc texture in GPU when we create it.\r\n    options.images = options.images || [null];\r\n    this.update(options);\r\n  }\r\n\r\n  if ( Texture$$1 ) Texture2D.__proto__ = Texture$$1;\r\n  Texture2D.prototype = Object.create( Texture$$1 && Texture$$1.prototype );\r\n  Texture2D.prototype.constructor = Texture2D;\r\n\r\n  /**\r\n   * @method update\r\n   * @param {Object} options\r\n   * @param {Array} options.images\r\n   * @param {Boolean} options.mipmap\r\n   * @param {Number} options.width\r\n   * @param {Number} options.height\r\n   * @param {TEXTURE_FMT_*} options.format\r\n   * @param {Number} options.anisotropy\r\n   * @param {FILTER_*} options.minFilter\r\n   * @param {FILTER_*} options.magFilter\r\n   * @param {FILTER_*} options.mipFilter\r\n   * @param {WRAP_*} options.wrapS\r\n   * @param {WRAP_*} options.wrapT\r\n   * @param {Boolean} options.flipY\r\n   * @param {Boolean} options.premultiplyAlpha\r\n   */\r\n  Texture2D.prototype.update = function update (options) {\r\n    var gl = this._device._gl;\r\n    var genMipmap = this._hasMipmap;\r\n\r\n    if (options) {\r\n      if (options.width !== undefined) {\r\n        this._width = options.width;\r\n      }\r\n      if (options.height !== undefined) {\r\n        this._height = options.height;\r\n      }\r\n      if (options.anisotropy !== undefined) {\r\n        this._anisotropy = options.anisotropy;\r\n      }\r\n      if (options.minFilter !== undefined) {\r\n        this._minFilter = options.minFilter;\r\n      }\r\n      if (options.magFilter !== undefined) {\r\n        this._magFilter = options.magFilter;\r\n      }\r\n      if (options.mipFilter !== undefined) {\r\n        this._mipFilter = options.mipFilter;\r\n      }\r\n      if (options.wrapS !== undefined) {\r\n        this._wrapS = options.wrapS;\r\n      }\r\n      if (options.wrapT !== undefined) {\r\n        this._wrapT = options.wrapT;\r\n      }\r\n      if (options.format !== undefined) {\r\n        this._format = options.format;\r\n        this._compressed = (\r\n          this._format >= enums$1.TEXTURE_FMT_RGB_DXT1 &&\r\n          this._format <= enums$1.TEXTURE_FMT_RGBA_PVRTC_4BPPV1\r\n        );\r\n      }\r\n\r\n      // check if generate mipmap\r\n      if (options.mipmap !== undefined) {\r\n        this._hasMipmap = options.mipmap;\r\n        genMipmap = options.mipmap;\r\n      }\r\n\r\n      if (options.images !== undefined) {\r\n        if (options.images.length > 1) {\r\n          genMipmap = false;\r\n          var maxLength = options.width > options.height ? options.width : options.height;\r\n          if (maxLength >> (options.images.length - 1) !== 1) {\r\n            console.error('texture-2d mipmap is invalid, should have a 1x1 mipmap.');\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // NOTE: get pot after this._width, this._height has been assigned.\r\n    var pot = isPow2$1(this._width) && isPow2$1(this._height);\r\n    if (!pot) {\r\n      genMipmap = false;\r\n    }\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._glID);\r\n    if (options.images !== undefined && options.images.length > 0) {\r\n      this._setMipmap(options.images, options.flipY, options.premultiplyAlpha);\r\n    }\r\n\r\n    this._setTexInfo();\r\n\r\n    if (genMipmap) {\r\n      gl.hint(gl.GENERATE_MIPMAP_HINT, gl.NICEST);\r\n      gl.generateMipmap(gl.TEXTURE_2D);\r\n    }\r\n    this._device._restoreTexture(0);\r\n  };\r\n\r\n  /**\r\n   * @method updateSubImage\r\n   * @param {Object} options\r\n   * @param {Number} options.x\r\n   * @param {Number} options.y\r\n   * @param {Number} options.width\r\n   * @param {Number} options.height\r\n   * @param {Number} options.level\r\n   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image\r\n   * @param {Boolean} options.flipY\r\n   * @param {Boolean} options.premultiplyAlpha\r\n   */\r\n  Texture2D.prototype.updateSubImage = function updateSubImage (options) {\r\n    var gl = this._device._gl;\r\n    var glFmt = glTextureFmt(this._format);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._glID);\r\n    this._setSubImage(glFmt, options);\r\n    this._device._restoreTexture(0);\r\n  };\r\n\r\n  /**\r\n   * @method updateImage\r\n   * @param {Object} options\r\n   * @param {Number} options.width\r\n   * @param {Number} options.height\r\n   * @param {Number} options.level\r\n   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image\r\n   * @param {Boolean} options.flipY\r\n   * @param {Boolean} options.premultiplyAlpha\r\n   */\r\n  Texture2D.prototype.updateImage = function updateImage (options) {\r\n    var gl = this._device._gl;\r\n    var glFmt = glTextureFmt(this._format);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._glID);\r\n    this._setImage(glFmt, options);\r\n    this._device._restoreTexture(0);\r\n  };\r\n\r\n  Texture2D.prototype._setSubImage = function _setSubImage (glFmt, options) {\r\n    var gl = this._device._gl;\r\n    var flipY = options.flipY;\r\n    var premultiplyAlpha = options.premultiplyAlpha;\r\n    var img = options.image;\r\n\r\n    if (\r\n      img instanceof HTMLCanvasElement ||\r\n      img instanceof HTMLImageElement ||\r\n      img instanceof HTMLVideoElement\r\n    ) {\r\n      if (flipY === undefined) {\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\r\n      } else {\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);\r\n      }\r\n\r\n      if (premultiplyAlpha === undefined) {\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\r\n      } else {\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);\r\n      }\r\n\r\n      gl.texSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, glFmt.format, glFmt.pixelType, img);\r\n    } else {\r\n      if (flipY === undefined) {\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n      } else {\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);\r\n      }\r\n\r\n      if (premultiplyAlpha === undefined) {\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\r\n      } else {\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);\r\n      }\r\n\r\n      if (this._compressed) {\r\n        gl.compressedTexSubImage2D(gl.TEXTURE_2D,\r\n          options.level,\r\n          options.x,\r\n          options.y,\r\n          options.width,\r\n          options.height,\r\n          glFmt.format,\r\n          img\r\n        );\r\n      } else {\r\n        gl.texSubImage2D(\r\n          gl.TEXTURE_2D,\r\n          options.level,\r\n          options.x,\r\n          options.y,\r\n          options.width,\r\n          options.height,\r\n          glFmt.format,\r\n          glFmt.pixelType,\r\n          img\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  Texture2D.prototype._setImage = function _setImage (glFmt, options) {\r\n    var gl = this._device._gl;\r\n    var flipY = options.flipY;\r\n    var premultiplyAlpha = options.premultiplyAlpha;\r\n    var img = options.image;\r\n\r\n    if (\r\n      img instanceof HTMLCanvasElement ||\r\n      img instanceof HTMLImageElement ||\r\n      img instanceof HTMLVideoElement\r\n    ) {\r\n      if (flipY === undefined) {\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\r\n      } else {\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);\r\n      }\r\n\r\n      if (premultiplyAlpha === undefined) {\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\r\n      } else {\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);\r\n      }\r\n\r\n      gl.texImage2D(\r\n        gl.TEXTURE_2D,\r\n        options.level,\r\n        glFmt.internalFormat,\r\n        glFmt.format,\r\n        glFmt.pixelType,\r\n        img\r\n      );\r\n    } else {\r\n      if (flipY === undefined) {\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n      } else {\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);\r\n      }\r\n\r\n      if (premultiplyAlpha === undefined) {\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\r\n      } else {\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);\r\n      }\r\n\r\n      if (this._compressed) {\r\n        gl.compressedTexImage2D(\r\n          gl.TEXTURE_2D,\r\n          options.level,\r\n          glFmt.internalFormat,\r\n          options.width,\r\n          options.height,\r\n          0,\r\n          img\r\n        );\r\n      } else {\r\n        gl.texImage2D(\r\n          gl.TEXTURE_2D,\r\n          options.level,\r\n          glFmt.internalFormat,\r\n          options.width,\r\n          options.height,\r\n          0,\r\n          glFmt.format,\r\n          glFmt.pixelType,\r\n          img\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  Texture2D.prototype._setMipmap = function _setMipmap (images, flipY, premultiplyAlpha) {\r\n    var this$1 = this;\r\n\r\n    var glFmt = glTextureFmt(this._format);\r\n    var options = {\r\n      width: this._width,\r\n      height: this._height,\r\n      flipY: flipY,\r\n      premultiplyAlpha: premultiplyAlpha,\r\n      level: 0,\r\n      image: null\r\n    };\r\n\r\n    for (var i = 0; i < images.length; ++i) {\r\n      options.level = i;\r\n      options.width = this$1._width >> i;\r\n      options.height = this$1._height >> i;\r\n      options.image = images[i];\r\n      this$1._setImage(glFmt, options);\r\n    }\r\n  };\r\n\r\n  Texture2D.prototype._setTexInfo = function _setTexInfo () {\r\n    var gl = this._device._gl;\r\n    var pot = isPow2$1(this._width) && isPow2$1(this._height);\r\n\r\n    // WebGL1 doesn't support all wrap modes with NPOT textures\r\n    if (!pot && (this._wrapS !== enums$1.WRAP_CLAMP || this._wrapT !== enums$1.WRAP_CLAMP)) {\r\n      console.warn('WebGL1 doesn\\'t support all wrap modes with NPOT textures');\r\n      this._wrapS = enums$1.WRAP_CLAMP;\r\n      this._wrapT = enums$1.WRAP_CLAMP;\r\n    }\r\n\r\n    var mipFilter = this._hasMipmap ? this._mipFilter : -1;\r\n    if (!pot && mipFilter !== -1) {\r\n      console.warn('NPOT textures do not support mipmap filter');\r\n      mipFilter = -1;\r\n    }\r\n\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, glFilter(gl, this._minFilter, mipFilter));\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, glFilter(gl, this._magFilter, -1));\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, this._wrapS);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, this._wrapT);\r\n\r\n    var ext = this._device.ext('EXT_texture_filter_anisotropic');\r\n    if (ext && ext.TEXTURE_MAX_ANISOTROPY_EXT) {\r\n      gl.texParameteri(gl.TEXTURE_2D, ext.TEXTURE_MAX_ANISOTROPY_EXT, this._anisotropy);\r\n    }\r\n  };\r\n\r\n  return Texture2D;\r\n}(Texture));\r\n\r\nvar TextureCube = (function (Texture$$1) {\r\n  function TextureCube(device, options) {\r\n    Texture$$1.call(this, device);\r\n    var gl = this._device._gl;\r\n    this._target = gl.TEXTURE_CUBE_MAP;\r\n    this._glID = gl.createTexture();\r\n    this.update(options);\r\n  }\r\n\r\n  if ( Texture$$1 ) TextureCube.__proto__ = Texture$$1;\r\n  TextureCube.prototype = Object.create( Texture$$1 && Texture$$1.prototype );\r\n  TextureCube.prototype.constructor = TextureCube;\r\n\r\n  /**\r\n   * @method update\r\n   * @param {Object} options\r\n   * @param {Array} options.images\r\n   * @param {Boolean} options.mipmap\r\n   * @param {Number} options.width\r\n   * @param {Number} options.height\r\n   * @param {TEXTURE_FMT_*} options.format\r\n   * @param {Number} options.anisotropy\r\n   * @param {FILTER_*} options.minFilter\r\n   * @param {FILTER_*} options.magFilter\r\n   * @param {FILTER_*} options.mipFilter\r\n   * @param {WRAP_*} options.wrapS\r\n   * @param {WRAP_*} options.wrapT\r\n   * @param {WRAP_*} options.wrapR\r\n   * @param {Boolean} options.flipY\r\n   * @param {Boolean} options.premultiplyAlpha\r\n   */\r\n  TextureCube.prototype.update = function update (options) {\r\n    var gl = this._device._gl;\r\n    var genMipmap = this._hasMipmap;\r\n\r\n    if (options) {\r\n      if (options.width !== undefined) {\r\n        this._width = options.width;\r\n      }\r\n      if (options.height !== undefined) {\r\n        this._height = options.height;\r\n      }\r\n      if (options.anisotropy !== undefined) {\r\n        this._anisotropy = options.anisotropy;\r\n      }\r\n      if (options.minFilter !== undefined) {\r\n        this._minFilter = options.minFilter;\r\n      }\r\n      if (options.magFilter !== undefined) {\r\n        this._magFilter = options.magFilter;\r\n      }\r\n      if (options.mipFilter !== undefined) {\r\n        this._mipFilter = options.mipFilter;\r\n      }\r\n      if (options.wrapS !== undefined) {\r\n        this._wrapS = options.wrapS;\r\n      }\r\n      if (options.wrapT !== undefined) {\r\n        this._wrapT = options.wrapT;\r\n      }\r\n      // wrapR available in webgl2\r\n      // if (options.wrapR !== undefined) {\r\n      //   this._wrapR = options.wrapR;\r\n      // }\r\n      if (options.format !== undefined) {\r\n        this._format = options.format;\r\n        this._compressed = (\r\n          this._format >= enums$1.TEXTURE_FMT_RGB_DXT1 &&\r\n          this._format <= enums$1.TEXTURE_FMT_RGBA_PVRTC_4BPPV1\r\n        );\r\n      }\r\n\r\n      // check if generate mipmap\r\n      if (options.mipmap !== undefined) {\r\n        this._hasMipmap = options.mipmap;\r\n        genMipmap = options.mipmap;\r\n      }\r\n\r\n      if (options.images !== undefined) {\r\n        if (options.images.length > 1) {\r\n          genMipmap = false;\r\n          if (options.width !== options.height) {\r\n            console.warn('texture-cube width and height should be identical.');\r\n          }\r\n          if (options.width >> (options.images.length - 1) !== 1) {\r\n            console.error('texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn');\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // NOTE: get pot after this._width, this._height has been assigned.\r\n    var pot = isPow2$1(this._width) && isPow2$1(this._height);\r\n    if (!pot) {\r\n      genMipmap = false;\r\n    }\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);\r\n    if (options.images !== undefined && options.images.length > 0) {\r\n      this._setMipmap(options.images, options.flipY, options.premultiplyAlpha);\r\n    }\r\n\r\n    this._setTexInfo();\r\n\r\n    if (genMipmap) {\r\n      gl.hint(gl.GENERATE_MIPMAP_HINT, gl.NICEST);\r\n      gl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n    }\r\n    this._device._restoreTexture(0);\r\n  };\r\n\r\n  /**\r\n   * @method updateSubImage\r\n   * @param {Object} options\r\n   * @param {Number} options.x\r\n   * @param {Number} options.y\r\n   * @param {Number} options.width\r\n   * @param {Number} options.height\r\n   * @param {Number} options.level\r\n   * @param {Number} options.faceIndex\r\n   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image\r\n   * @param {Boolean} options.flipY\r\n   * @param {Boolean} options.premultiplyAlpha\r\n   */\r\n  TextureCube.prototype.updateSubImage = function updateSubImage (options) {\r\n    var gl = this._device._gl;\r\n    var glFmt = glTextureFmt(this._format);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);\r\n    this._setSubImage(glFmt, options);\r\n\r\n    this._device._restoreTexture(0);\r\n  };\r\n\r\n  /**\r\n   * @method updateImage\r\n   * @param {Object} options\r\n   * @param {Number} options.width\r\n   * @param {Number} options.height\r\n   * @param {Number} options.level\r\n   * @param {Number} options.faceIndex\r\n   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image\r\n   * @param {Boolean} options.flipY\r\n   * @param {Boolean} options.premultiplyAlpha\r\n   */\r\n  TextureCube.prototype.updateImage = function updateImage (options) {\r\n    var gl = this._device._gl;\r\n    var glFmt = glTextureFmt(this._format);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);\r\n    this._setImage(glFmt, options);\r\n    this._device._restoreTexture(0);\r\n  };\r\n\r\n  TextureCube.prototype._setSubImage = function _setSubImage (glFmt, options) {\r\n    var gl = this._device._gl;\r\n    var flipY = options.flipY;\r\n    var premultiplyAlpha = options.premultiplyAlpha;\r\n    var faceIndex = options.faceIndex;\r\n    var img = options.image;\r\n\r\n    if (flipY === undefined) {\r\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n    } else {\r\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);\r\n    }\r\n\r\n    if (premultiplyAlpha === undefined) {\r\n      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\r\n    } else {\r\n      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);\r\n    }\r\n\r\n    if (\r\n      img instanceof HTMLCanvasElement ||\r\n      img instanceof HTMLImageElement ||\r\n      img instanceof HTMLVideoElement\r\n    ) {\r\n      gl.texSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, options.x, options.y, glFmt.format, glFmt.pixelType, img);\r\n    } else {\r\n      if (this._compressed) {\r\n        gl.compressedTexSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\r\n          options.level,\r\n          options.x,\r\n          options.y,\r\n          options.width,\r\n          options.height,\r\n          glFmt.format,\r\n          img\r\n        );\r\n      } else {\r\n        gl.texSubImage2D(\r\n          gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\r\n          options.level,\r\n          options.x,\r\n          options.y,\r\n          options.width,\r\n          options.height,\r\n          glFmt.format,\r\n          glFmt.pixelType,\r\n          img\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  TextureCube.prototype._setImage = function _setImage (glFmt, options) {\r\n    var gl = this._device._gl;\r\n    var flipY = options.flipY;\r\n    var premultiplyAlpha = options.premultiplyAlpha;\r\n    var faceIndex = options.faceIndex;\r\n    var img = options.image;\r\n\r\n    if (flipY === undefined) {\r\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n    } else {\r\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);\r\n    }\r\n\r\n    if (premultiplyAlpha === undefined) {\r\n      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\r\n    } else {\r\n      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);\r\n    }\r\n    if (\r\n      img instanceof HTMLCanvasElement ||\r\n      img instanceof HTMLImageElement ||\r\n      img instanceof HTMLVideoElement\r\n    ) {\r\n      gl.texImage2D(\r\n        gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\r\n        options.level,\r\n        glFmt.internalFormat,\r\n        glFmt.format,\r\n        glFmt.pixelType,\r\n        img\r\n      );\r\n    } else {\r\n      if (this._compressed) {\r\n        gl.compressedTexImage2D(\r\n          gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\r\n          options.level,\r\n          glFmt.internalFormat,\r\n          options.width,\r\n          options.height,\r\n          0,\r\n          img\r\n        );\r\n      } else {\r\n        gl.texImage2D(\r\n          gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\r\n          options.level,\r\n          glFmt.internalFormat,\r\n          options.width,\r\n          options.height,\r\n          0,\r\n          glFmt.format,\r\n          glFmt.pixelType,\r\n          img\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  // levelImages = [imagePosX, imageNegX, imagePosY, imageNegY, imagePosZ, imageNegz]\r\n  // images = [levelImages0, levelImages1, ...]\r\n  TextureCube.prototype._setMipmap = function _setMipmap (images, flipY, premultiplyAlpha) {\r\n    var this$1 = this;\r\n\r\n    var glFmt = glTextureFmt(this._format);\r\n    var options = {\r\n      width: this._width,\r\n      height: this._height,\r\n      faceIndex: 0,\r\n      flipY: flipY,\r\n      premultiplyAlpha: premultiplyAlpha,\r\n      level: 0,\r\n      image: null\r\n    };\r\n\r\n    for (var i = 0; i < images.length; ++i) {\r\n      var levelImages = images[i];\r\n      options.level = i;\r\n      options.width = this$1._width >> i;\r\n      options.height = this$1._height >> i;\r\n\r\n      for (var face = 0; face < 6; ++face) {\r\n        options.faceIndex = face;\r\n        options.image = levelImages[face];\r\n        this$1._setImage(glFmt, options);\r\n      }\r\n    }\r\n  };\r\n\r\n  TextureCube.prototype._setTexInfo = function _setTexInfo () {\r\n    var gl = this._device._gl;\r\n    var pot = isPow2$1(this._width) && isPow2$1(this._height);\r\n\r\n    // WebGL1 doesn't support all wrap modes with NPOT textures\r\n    if (!pot && (this._wrapS !== enums$1.WRAP_CLAMP || this._wrapT !== enums$1.WRAP_CLAMP)) {\r\n      console.warn('WebGL1 doesn\\'t support all wrap modes with NPOT textures');\r\n      this._wrapS = enums$1.WRAP_CLAMP;\r\n      this._wrapT = enums$1.WRAP_CLAMP;\r\n    }\r\n\r\n    var mipFilter = this._hasMipmap ? this._mipFilter : -1;\r\n    if (!pot && mipFilter !== -1) {\r\n      console.warn('NPOT textures do not support mipmap filter');\r\n      mipFilter = -1;\r\n    }\r\n\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, glFilter(gl, this._minFilter, mipFilter));\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, glFilter(gl, this._magFilter, -1));\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, this._wrapS);\r\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, this._wrapT);\r\n    // wrapR available in webgl2\r\n    // gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_R, this._wrapR);\r\n\r\n    var ext = this._device.ext('EXT_texture_filter_anisotropic');\r\n    if (ext && ext.TEXTURE_MAX_ANISOTROPY_EXT) {\r\n      gl.texParameteri(gl.TEXTURE_CUBE_MAP, ext.TEXTURE_MAX_ANISOTROPY_EXT, this._anisotropy);\r\n    }\r\n  };\r\n\r\n  return TextureCube;\r\n}(Texture));\r\n\r\nvar RenderBuffer = function RenderBuffer(device, format, width, height) {\r\n  this._device = device;\r\n  this._format = format;\r\n  this._width = width;\r\n  this._height = height;\r\n\r\n  var gl = device._gl;\r\n  this._glID = gl.createRenderbuffer();\r\n\r\n  gl.bindRenderbuffer(gl.RENDERBUFFER, this._glID);\r\n  gl.renderbufferStorage(gl.RENDERBUFFER, format, width, height);\r\n  gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n};\r\n\r\n/**\r\n * @method destroy\r\n */\r\nRenderBuffer.prototype.destroy = function destroy () {\r\n  if (this._glID === null) {\r\n    console.error('The render-buffer already destroyed');\r\n    return;\r\n  }\r\n\r\n  var gl = this._device._gl;\r\n\r\n  gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n  gl.deleteRenderbuffer(this._glID);\r\n\r\n  this._glID = null;\r\n};\r\n\r\nvar FrameBuffer = function FrameBuffer(device, width, height, options) {\r\n  this._device = device;\r\n  this._width = width;\r\n  this._height = height;\r\n\r\n  this._colors = options.colors || [];\r\n  this._depth = options.depth || null;\r\n  this._stencil = options.stencil || null;\r\n  this._depthStencil = options.depthStencil || null;\r\n\r\n  this._glID = device._gl.createFramebuffer();\r\n};\r\n\r\n/**\r\n * @method destroy\r\n */\r\nFrameBuffer.prototype.destroy = function destroy () {\r\n  if (this._glID === null) {\r\n    console.error('The frame-buffer already destroyed');\r\n    return;\r\n  }\r\n\r\n  var gl = this._device._gl;\r\n\r\n  gl.deleteFramebuffer(this._glID);\r\n\r\n  this._glID = null;\r\n};\r\n\r\nvar _default = {\r\n  // blend\r\n  blend: false,\r\n  blendSep: false,\r\n  blendColor: 0xffffffff,\r\n  blendEq: enums$1.BLEND_FUNC_ADD,\r\n  blendAlphaEq: enums$1.BLEND_FUNC_ADD,\r\n  blendSrc: enums$1.BLEND_ONE,\r\n  blendDst: enums$1.BLEND_ZERO,\r\n  blendSrcAlpha: enums$1.BLEND_ONE,\r\n  blendDstAlpha: enums$1.BLEND_ZERO,\r\n\r\n  // depth\r\n  depthTest: false,\r\n  depthWrite: false,\r\n  depthFunc: enums$1.DS_FUNC_LESS,\r\n\r\n  // stencil\r\n  stencilTest: false,\r\n  stencilSep: false,\r\n  stencilFuncFront: enums$1.DS_FUNC_ALWAYS,\r\n  stencilRefFront: 0,\r\n  stencilMaskFront: 0xff,\r\n  stencilFailOpFront: enums$1.STENCIL_OP_KEEP,\r\n  stencilZFailOpFront: enums$1.STENCIL_OP_KEEP,\r\n  stencilZPassOpFront: enums$1.STENCIL_OP_KEEP,\r\n  stencilWriteMaskFront: 0xff,\r\n  stencilFuncBack: enums$1.DS_FUNC_ALWAYS,\r\n  stencilRefBack: 0,\r\n  stencilMaskBack: 0xff,\r\n  stencilFailOpBack: enums$1.STENCIL_OP_KEEP,\r\n  stencilZFailOpBack: enums$1.STENCIL_OP_KEEP,\r\n  stencilZPassOpBack: enums$1.STENCIL_OP_KEEP,\r\n  stencilWriteMaskBack: 0xff,\r\n\r\n  // cull-mode\r\n  cullMode: enums$1.CULL_BACK,\r\n\r\n  // primitive-type\r\n  primitiveType: enums$1.PT_TRIANGLES,\r\n\r\n  // bindings\r\n  maxStream: -1,\r\n  vertexBuffers: [],\r\n  vertexBufferOffsets: [],\r\n  indexBuffer: null,\r\n  maxTextureSlot: -1,\r\n  textureUnits: [],\r\n  program: null,\r\n};\r\n\r\nvar State = function State(device) {\r\n  // bindings\r\n  this.vertexBuffers = new Array(device._caps.maxVertexStreams);\r\n  this.vertexBufferOffsets = new Array(device._caps.maxVertexStreams);\r\n  this.textureUnits = new Array(device._caps.maxTextureUnits);\r\n\r\n  this.set(_default);\r\n};\r\n\r\nState.initDefault = function initDefault (device) {\r\n  _default.vertexBuffers = new Array(device._caps.maxVertexStreams);\r\n  _default.vertexBufferOffsets = new Array(device._caps.maxVertexStreams);\r\n  _default.textureUnits = new Array(device._caps.maxTextureUnits);\r\n};\r\n\r\nState.prototype.reset = function reset () {\r\n  this.set(_default);\r\n};\r\n\r\nState.prototype.set = function set (cpy) {\r\n    var this$1 = this;\r\n\r\n  // blending\r\n  this.blend = cpy.blend;\r\n  this.blendSep = cpy.blendSep;\r\n  this.blendColor = cpy.blendColor;\r\n  this.blendEq = cpy.blendEq;\r\n  this.blendAlphaEq = cpy.blendAlphaEq;\r\n  this.blendSrc = cpy.blendSrc;\r\n  this.blendDst = cpy.blendDst;\r\n  this.blendSrcAlpha = cpy.blendSrcAlpha;\r\n  this.blendDstAlpha = cpy.blendDstAlpha;\r\n\r\n  // depth\r\n  this.depthTest = cpy.depthTest;\r\n  this.depthWrite = cpy.depthWrite;\r\n  this.depthFunc = cpy.depthFunc;\r\n\r\n  // stencil\r\n  this.stencilTest = cpy.stencilTest;\r\n  this.stencilSep = cpy.stencilSep;\r\n  this.stencilFuncFront = cpy.stencilFuncFront;\r\n  this.stencilRefFront = cpy.stencilRefFront;\r\n  this.stencilMaskFront = cpy.stencilMaskFront;\r\n  this.stencilFailOpFront = cpy.stencilFailOpFront;\r\n  this.stencilZFailOpFront = cpy.stencilZFailOpFront;\r\n  this.stencilZPassOpFront = cpy.stencilZPassOpFront;\r\n  this.stencilWriteMaskFront = cpy.stencilWriteMaskFront;\r\n  this.stencilFuncBack = cpy.stencilFuncBack;\r\n  this.stencilRefBack = cpy.stencilRefBack;\r\n  this.stencilMaskBack = cpy.stencilMaskBack;\r\n  this.stencilFailOpBack = cpy.stencilFailOpBack;\r\n  this.stencilZFailOpBack = cpy.stencilZFailOpBack;\r\n  this.stencilZPassOpBack = cpy.stencilZPassOpBack;\r\n  this.stencilWriteMaskBack = cpy.stencilWriteMaskBack;\r\n\r\n  // cull-mode\r\n  this.cullMode = cpy.cullMode;\r\n\r\n  // primitive-type\r\n  this.primitiveType = cpy.primitiveType;\r\n\r\n  // buffer bindings\r\n  this.maxStream = cpy.maxStream;\r\n  for (var i = 0; i < cpy.vertexBuffers.length; ++i) {\r\n    this$1.vertexBuffers[i] = cpy.vertexBuffers[i];\r\n  }\r\n  for (var i$1 = 0; i$1 < cpy.vertexBufferOffsets.length; ++i$1) {\r\n    this$1.vertexBufferOffsets[i$1] = cpy.vertexBufferOffsets[i$1];\r\n  }\r\n  this.indexBuffer = cpy.indexBuffer;\r\n\r\n  // texture bindings\r\n  this.maxTextureSlot = cpy.maxTextureSlot;\r\n  for (var i$2 = 0; i$2 < cpy.textureUnits.length; ++i$2) {\r\n    this$1.textureUnits[i$2] = cpy.textureUnits[i$2];\r\n  }\r\n\r\n  this.program = cpy.program;\r\n};\r\n\r\nvar GL_INT = 5124;\r\nvar GL_FLOAT$1 = 5126;\r\nvar GL_FLOAT_VEC2 = 35664;\r\nvar GL_FLOAT_VEC3 = 35665;\r\nvar GL_FLOAT_VEC4 = 35666;\r\nvar GL_INT_VEC2 = 35667;\r\nvar GL_INT_VEC3 = 35668;\r\nvar GL_INT_VEC4 = 35669;\r\nvar GL_BOOL = 35670;\r\nvar GL_BOOL_VEC2 = 35671;\r\nvar GL_BOOL_VEC3 = 35672;\r\nvar GL_BOOL_VEC4 = 35673;\r\nvar GL_FLOAT_MAT2 = 35674;\r\nvar GL_FLOAT_MAT3 = 35675;\r\nvar GL_FLOAT_MAT4 = 35676;\r\nvar GL_SAMPLER_2D = 35678;\r\nvar GL_SAMPLER_CUBE = 35680;\r\n\r\n/**\r\n * _type2uniformCommit\r\n */\r\nvar _type2uniformCommit = {};\r\n_type2uniformCommit[GL_INT] = function (gl, id, value) {\r\n    gl.uniform1i(id, value);\r\n  };\r\n_type2uniformCommit[GL_FLOAT$1] = function (gl, id, value) {\r\n    gl.uniform1f(id, value);\r\n  };\r\n_type2uniformCommit[GL_FLOAT_VEC2] = function (gl, id, value) {\r\n    gl.uniform2fv(id, value);\r\n  };\r\n_type2uniformCommit[GL_FLOAT_VEC3] = function (gl, id, value) {\r\n    gl.uniform3fv(id, value);\r\n  };\r\n_type2uniformCommit[GL_FLOAT_VEC4] = function (gl, id, value) {\r\n    gl.uniform4fv(id, value);\r\n  };\r\n_type2uniformCommit[GL_INT_VEC2] = function (gl, id, value) {\r\n    gl.uniform2iv(id, value);\r\n  };\r\n_type2uniformCommit[GL_INT_VEC3] = function (gl, id, value) {\r\n    gl.uniform3iv(id, value);\r\n  };\r\n_type2uniformCommit[GL_INT_VEC4] = function (gl, id, value) {\r\n    gl.uniform4iv(id, value);\r\n  };\r\n_type2uniformCommit[GL_BOOL] = function (gl, id, value) {\r\n    gl.uniform1i(id, value);\r\n  };\r\n_type2uniformCommit[GL_BOOL_VEC2] = function (gl, id, value) {\r\n    gl.uniform2iv(id, value);\r\n  };\r\n_type2uniformCommit[GL_BOOL_VEC3] = function (gl, id, value) {\r\n    gl.uniform3iv(id, value);\r\n  };\r\n_type2uniformCommit[GL_BOOL_VEC4] = function (gl, id, value) {\r\n    gl.uniform4iv(id, value);\r\n  };\r\n_type2uniformCommit[GL_FLOAT_MAT2] = function (gl, id, value) {\r\n    gl.uniformMatrix2fv(id, false, value);\r\n  };\r\n_type2uniformCommit[GL_FLOAT_MAT3] = function (gl, id, value) {\r\n    gl.uniformMatrix3fv(id, false, value);\r\n  };\r\n_type2uniformCommit[GL_FLOAT_MAT4] = function (gl, id, value) {\r\n    gl.uniformMatrix4fv(id, false, value);\r\n  };\r\n_type2uniformCommit[GL_SAMPLER_2D] = function (gl, id, value) {\r\n    gl.uniform1i(id, value);\r\n  };\r\n_type2uniformCommit[GL_SAMPLER_CUBE] = function (gl, id, value) {\r\n    gl.uniform1i(id, value);\r\n  };\r\n\r\n/**\r\n * _type2uniformArrayCommit\r\n */\r\nvar _type2uniformArrayCommit = {};\r\n_type2uniformArrayCommit[GL_INT] = function (gl, id, value) {\r\n    gl.uniform1iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_FLOAT$1] = function (gl, id, value) {\r\n    gl.uniform1fv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_FLOAT_VEC2] = function (gl, id, value) {\r\n    gl.uniform2fv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_FLOAT_VEC3] = function (gl, id, value) {\r\n    gl.uniform3fv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_FLOAT_VEC4] = function (gl, id, value) {\r\n    gl.uniform4fv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_INT_VEC2] = function (gl, id, value) {\r\n    gl.uniform2iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_INT_VEC3] = function (gl, id, value) {\r\n    gl.uniform3iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_INT_VEC4] = function (gl, id, value) {\r\n    gl.uniform4iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_BOOL] = function (gl, id, value) {\r\n    gl.uniform1iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_BOOL_VEC2] = function (gl, id, value) {\r\n    gl.uniform2iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_BOOL_VEC3] = function (gl, id, value) {\r\n    gl.uniform3iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_BOOL_VEC4] = function (gl, id, value) {\r\n    gl.uniform4iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_FLOAT_MAT2] = function (gl, id, value) {\r\n    gl.uniformMatrix2fv(id, false, value);\r\n  };\r\n_type2uniformArrayCommit[GL_FLOAT_MAT3] = function (gl, id, value) {\r\n    gl.uniformMatrix3fv(id, false, value);\r\n  };\r\n_type2uniformArrayCommit[GL_FLOAT_MAT4] = function (gl, id, value) {\r\n    gl.uniformMatrix4fv(id, false, value);\r\n  };\r\n_type2uniformArrayCommit[GL_SAMPLER_2D] = function (gl, id, value) {\r\n    gl.uniform1iv(id, value);\r\n  };\r\n_type2uniformArrayCommit[GL_SAMPLER_CUBE] = function (gl, id, value) {\r\n    gl.uniform1iv(id, value);\r\n  };\r\n\r\n/**\r\n * _commitBlendStates\r\n */\r\nfunction _commitBlendStates(gl, cur, next) {\r\n  // enable/disable blend\r\n  if (cur.blend !== next.blend) {\r\n    if (!next.blend) {\r\n      gl.disable(gl.BLEND);\r\n      return;\r\n    }\r\n\r\n    gl.enable(gl.BLEND);\r\n\r\n    if (\r\n      next.blendSrc === enums$1.BLEND_CONSTANT_COLOR ||\r\n      next.blendSrc === enums$1.BLEND_ONE_MINUS_CONSTANT_COLOR ||\r\n      next.blendDst === enums$1.BLEND_CONSTANT_COLOR ||\r\n      next.blendDst === enums$1.BLEND_ONE_MINUS_CONSTANT_COLOR\r\n    ) {\r\n      gl.blendColor(\r\n        (next.blendColor >> 24) / 255,\r\n        (next.blendColor >> 16 & 0xff) / 255,\r\n        (next.blendColor >> 8 & 0xff) / 255,\r\n        (next.blendColor & 0xff) / 255\r\n      );\r\n    }\r\n\r\n    if (next.blendSep) {\r\n      gl.blendFuncSeparate(next.blendSrc, next.blendDst, next.blendSrcAlpha, next.blendDstAlpha);\r\n      gl.blendEquationSeparate(next.blendEq, next.blendAlphaEq);\r\n    } else {\r\n      gl.blendFunc(next.blendSrc, next.blendDst);\r\n      gl.blendEquation(next.blendEq);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  // nothing to update\r\n  if (next.blend === false) {\r\n    return;\r\n  }\r\n\r\n  // blend-color\r\n  if (cur.blendColor !== next.blendColor) {\r\n    gl.blendColor(\r\n      (next.blendColor >> 24) / 255,\r\n      (next.blendColor >> 16 & 0xff) / 255,\r\n      (next.blendColor >> 8 & 0xff) / 255,\r\n      (next.blendColor & 0xff) / 255\r\n    );\r\n  }\r\n\r\n  // separate diff, reset all\r\n  if (cur.blendSep !== next.blendSep) {\r\n    if (next.blendSep) {\r\n      gl.blendFuncSeparate(next.blendSrc, next.blendDst, next.blendSrcAlpha, next.blendDstAlpha);\r\n      gl.blendEquationSeparate(next.blendEq, next.blendAlphaEq);\r\n    } else {\r\n      gl.blendFunc(next.blendSrc, next.blendDst);\r\n      gl.blendEquation(next.blendEq);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if (next.blendSep) {\r\n    // blend-func-separate\r\n    if (\r\n      cur.blendSrc !== next.blendSrc ||\r\n      cur.blendDst !== next.blendDst ||\r\n      cur.blendSrcAlpha !== next.blendSrcAlpha ||\r\n      cur.blendDstAlpha !== next.blendDstAlpha\r\n    ) {\r\n      gl.blendFuncSeparate(next.blendSrc, next.blendDst, next.blendSrcAlpha, next.blendDstAlpha);\r\n    }\r\n\r\n    // blend-equation-separate\r\n    if (\r\n      cur.blendEq !== next.blendEq ||\r\n      cur.blendAlphaEq !== next.blendAlphaEq\r\n    ) {\r\n      gl.blendEquationSeparate(next.blendEq, next.blendAlphaEq);\r\n    }\r\n  } else {\r\n    // blend-func\r\n    if (\r\n      cur.blendSrc !== next.blendSrc ||\r\n      cur.blendDst !== next.blendDst\r\n    ) {\r\n      gl.blendFunc(next.blendSrc, next.blendDst);\r\n    }\r\n\r\n    // blend-equation\r\n    if (cur.blendEq !== next.blendEq) {\r\n      gl.blendEquation(next.blendEq);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * _commitDepthStates\r\n */\r\nfunction _commitDepthStates(gl, cur, next) {\r\n  // enable/disable depth-test\r\n  if (cur.depthTest !== next.depthTest) {\r\n    if (!next.depthTest) {\r\n      gl.disable(gl.DEPTH_TEST);\r\n      return;\r\n    }\r\n\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.depthFunc(next.depthFunc);\r\n    gl.depthMask(next.depthWrite);\r\n\r\n    return;\r\n  }\r\n\r\n  // commit depth-write\r\n  if (cur.depthWrite !== next.depthWrite) {\r\n    gl.depthMask(next.depthWrite);\r\n  }\r\n\r\n  // check if depth-write enabled\r\n  if (next.depthTest === false) {\r\n    if (next.depthWrite) {\r\n      next.depthTest = true;\r\n      next.depthFunc = enums$1.DS_FUNC_ALWAYS;\r\n\r\n      gl.enable(gl.DEPTH_TEST);\r\n      gl.depthFunc(next.depthFunc);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  // depth-func\r\n  if (cur.depthFunc !== next.depthFunc) {\r\n    gl.depthFunc(next.depthFunc);\r\n  }\r\n}\r\n\r\n/**\r\n * _commitStencilStates\r\n */\r\nfunction _commitStencilStates(gl, cur, next) {\r\n  if (next.stencilTest !== cur.stencilTest) {\r\n    if (!next.stencilTest) {\r\n      gl.disable(gl.STENCIL_TEST);\r\n      return;\r\n    }\r\n\r\n    gl.enable(gl.STENCIL_TEST);\r\n\r\n    if (next.stencilSep) {\r\n      gl.stencilFuncSeparate(gl.FRONT, next.stencilFuncFront, next.stencilRefFront, next.stencilMaskFront);\r\n      gl.stencilMaskSeparate(gl.FRONT, next.stencilWriteMaskFront);\r\n      gl.stencilOpSeparate(gl.FRONT, next.stencilFailOpFront, next.stencilZFailOpFront, next.stencilZPassOpFront);\r\n      gl.stencilFuncSeparate(gl.BACK, next.stencilFuncBack, next.stencilRefBack, next.stencilMaskBack);\r\n      gl.stencilMaskSeparate(gl.BACK, next.stencilWriteMaskBack);\r\n      gl.stencilOpSeparate(gl.BACK, next.stencilFailOpBack, next.stencilZFailOpBack, next.stencilZPassOpBack);\r\n    } else {\r\n      gl.stencilFunc(next.stencilFuncFront, next.stencilRefFront, next.stencilMaskFront);\r\n      gl.stencilMask(next.stencilWriteMaskFront);\r\n      gl.stencilOp(next.stencilFailOpFront, next.stencilZFailOpFront, next.stencilZPassOpFront);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  // fast return\r\n  if (!next.stencilTest) {\r\n    return;\r\n  }\r\n\r\n  if (cur.stencilSep !== next.stencilSep) {\r\n    if (next.stencilSep) {\r\n      gl.stencilFuncSeparate(gl.FRONT, next.stencilFuncFront, next.stencilRefFront, next.stencilMaskFront);\r\n      gl.stencilMaskSeparate(gl.FRONT, next.stencilWriteMaskFront);\r\n      gl.stencilOpSeparate(gl.FRONT, next.stencilFailOpFront, next.stencilZFailOpFront, next.stencilZPassOpFront);\r\n      gl.stencilFuncSeparate(gl.BACK, next.stencilFuncBack, next.stencilRefBack, next.stencilMaskBack);\r\n      gl.stencilMaskSeparate(gl.BACK, next.stencilWriteMaskBack);\r\n      gl.stencilOpSeparate(gl.BACK, next.stencilFailOpBack, next.stencilZFailOpBack, next.stencilZPassOpBack);\r\n    } else {\r\n      gl.stencilFunc(next.stencilFuncFront, next.stencilRefFront, next.stencilMaskFront);\r\n      gl.stencilMask(next.stencilWriteMaskFront);\r\n      gl.stencilOp(next.stencilFailOpFront, next.stencilZFailOpFront, next.stencilZPassOpFront);\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (next.stencilSep) {\r\n    // front\r\n    if (\r\n      cur.stencilFuncFront !== next.stencilFuncFront ||\r\n      cur.stencilRefFront !== next.stencilRefFront ||\r\n      cur.stencilMaskFront !== next.stencilMaskFront\r\n    ) {\r\n      gl.stencilFuncSeparate(gl.FRONT, next.stencilFuncFront, next.stencilRefFront, next.stencilMaskFront);\r\n    }\r\n    if (cur.stencilWriteMaskFront !== next.stencilWriteMaskFront) {\r\n      gl.stencilMaskSeparate(gl.FRONT, next.stencilWriteMaskFront);\r\n    }\r\n    if (\r\n      cur.stencilFailOpFront !== next.stencilFailOpFront ||\r\n      cur.stencilZFailOpFront !== next.stencilZFailOpFront ||\r\n      cur.stencilZPassOpFront !== next.stencilZPassOpFront\r\n    ) {\r\n      gl.stencilOpSeparate(gl.FRONT, next.stencilFailOpFront, next.stencilZFailOpFront, next.stencilZPassOpFront);\r\n    }\r\n\r\n    // back\r\n    if (\r\n      cur.stencilFuncBack !== next.stencilFuncBack ||\r\n      cur.stencilRefBack !== next.stencilRefBack ||\r\n      cur.stencilMaskBack !== next.stencilMaskBack\r\n    ) {\r\n      gl.stencilFuncSeparate(gl.BACK, next.stencilFuncBack, next.stencilRefBack, next.stencilMaskBack);\r\n    }\r\n    if (cur.stencilWriteMaskBack !== next.stencilWriteMaskBack) {\r\n      gl.stencilMaskSeparate(gl.BACK, next.stencilWriteMaskBack);\r\n    }\r\n    if (\r\n      cur.stencilFailOpBack !== next.stencilFailOpBack ||\r\n      cur.stencilZFailOpBack !== next.stencilZFailOpBack ||\r\n      cur.stencilZPassOpBack !== next.stencilZPassOpBack\r\n    ) {\r\n      gl.stencilOpSeparate(gl.BACK, next.stencilFailOpBack, next.stencilZFailOpBack, next.stencilZPassOpBack);\r\n    }\r\n  } else {\r\n    if (\r\n      cur.stencilFuncFront !== next.stencilFuncFront ||\r\n      cur.stencilRefFront !== next.stencilRefFront ||\r\n      cur.stencilMaskFront !== next.stencilMaskFront\r\n    ) {\r\n      gl.stencilFunc(next.stencilFuncFront, next.stencilRefFront, next.stencilMaskFront);\r\n    }\r\n    if (cur.stencilWriteMaskFront !== next.stencilWriteMaskFront) {\r\n      gl.stencilMask(next.stencilWriteMaskFront);\r\n    }\r\n    if (\r\n      cur.stencilFailOpFront !== next.stencilFailOpFront ||\r\n      cur.stencilZFailOpFront !== next.stencilZFailOpFront ||\r\n      cur.stencilZPassOpFront !== next.stencilZPassOpFront\r\n    ) {\r\n      gl.stencilOp(next.stencilFailOpFront, next.stencilZFailOpFront, next.stencilZPassOpFront);\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * _commitCullMode\r\n */\r\nfunction _commitCullMode(gl, cur, next) {\r\n  if (cur.cullMode === next.cullMode) {\r\n    return;\r\n  }\r\n\r\n  if (next.cullMode === enums$1.CULL_NONE) {\r\n    gl.disable(gl.CULL_FACE);\r\n    return;\r\n  }\r\n\r\n  gl.enable(gl.CULL_FACE);\r\n  gl.cullFace(next.cullMode);\r\n}\r\n\r\n/**\r\n * _commitVertexBuffers\r\n */\r\nfunction _commitVertexBuffers(device, gl, cur, next) {\r\n  var attrsDirty = false;\r\n\r\n  // nothing changed for vertex buffer\r\n  if (next.maxStream === -1) {\r\n    console.warn('VertexBuffer not assigned, please call setVertexBuffer before every draw.');\r\n    return;\r\n  }\r\n\r\n  if (cur.maxStream !== next.maxStream) {\r\n    attrsDirty = true;\r\n  } else if (cur.program !== next.program) {\r\n    attrsDirty = true;\r\n  } else {\r\n    for (var i = 0; i < next.maxStream + 1; ++i) {\r\n      if (\r\n        cur.vertexBuffers[i] !== next.vertexBuffers[i] ||\r\n        cur.vertexBufferOffsets[i] !== next.vertexBufferOffsets[i]\r\n      ) {\r\n        attrsDirty = true;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (attrsDirty) {\r\n    for (var i$1 = 0; i$1 < device._caps.maxVertexAttribs; ++i$1) {\r\n      device._newAttributes[i$1] = 0;\r\n    }\r\n\r\n    for (var i$2 = 0; i$2 < next.maxStream + 1; ++i$2) {\r\n      var vb = next.vertexBuffers[i$2];\r\n      var vbOffset = next.vertexBufferOffsets[i$2];\r\n      if (!vb) {\r\n        continue;\r\n      }\r\n\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, vb._glID);\r\n\r\n      for (var j = 0; j < next.program._attributes.length; ++j) {\r\n        var attr = next.program._attributes[j];\r\n\r\n        var el = vb._format.element(attr.name);\r\n        if (!el) {\r\n          console.warn((\"Can not find vertex attribute: \" + (attr.name)));\r\n          continue;\r\n        }\r\n\r\n        if (device._enabledAttributes[attr.location] === 0) {\r\n          gl.enableVertexAttribArray(attr.location);\r\n          device._enabledAttributes[attr.location] = 1;\r\n        }\r\n        device._newAttributes[attr.location] = 1;\r\n\r\n        gl.vertexAttribPointer(\r\n          attr.location,\r\n          el.num,\r\n          el.type,\r\n          el.normalize,\r\n          el.stride,\r\n          el.offset + vbOffset * el.stride\r\n        );\r\n      }\r\n    }\r\n\r\n    // disable unused attributes\r\n    for (var i$3 = 0; i$3 < device._caps.maxVertexAttribs; ++i$3) {\r\n      if (device._enabledAttributes[i$3] !== device._newAttributes[i$3]) {\r\n        gl.disableVertexAttribArray(i$3);\r\n        device._enabledAttributes[i$3] = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * _commitTextures\r\n */\r\nfunction _commitTextures(gl, cur, next) {\r\n  for (var i = 0; i < next.maxTextureSlot + 1; ++i) {\r\n    if (cur.textureUnits[i] !== next.textureUnits[i]) {\r\n      var texture = next.textureUnits[i];\r\n      if (texture && texture._glID !== -1) {\r\n        gl.activeTexture(gl.TEXTURE0 + i);\r\n        gl.bindTexture(texture._target, texture._glID);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * _attach\r\n */\r\nfunction _attach(gl, location, attachment, face) {\r\n  if ( face === void 0 ) face = 0;\r\n\r\n  if (attachment instanceof Texture2D) {\r\n    gl.framebufferTexture2D(\r\n      gl.FRAMEBUFFER,\r\n      location,\r\n      gl.TEXTURE_2D,\r\n      attachment._glID,\r\n      0\r\n    );\r\n  } else if (attachment instanceof TextureCube) {\r\n    gl.framebufferTexture2D(\r\n      gl.FRAMEBUFFER,\r\n      location,\r\n      gl.TEXTURE_CUBE_MAP_POSITIVE_X + face,\r\n      attachment._glID,\r\n      0\r\n    );\r\n  } else {\r\n    gl.framebufferRenderbuffer(\r\n      gl.FRAMEBUFFER,\r\n      location,\r\n      gl.RENDERBUFFER,\r\n      attachment._glID\r\n    );\r\n  }\r\n}\r\n\r\nvar Device = function Device(canvasEL, opts) {\r\n  var this$1 = this;\r\n\r\n  var gl;\r\n\r\n  // default options\r\n  opts = opts || {};\r\n  if (opts.alpha === undefined) {\r\n    opts.alpha = false;\r\n  }\r\n  if (opts.stencil === undefined) {\r\n    opts.stencil = true;\r\n  }\r\n  if (opts.depth === undefined) {\r\n    opts.depth = true;\r\n  }\r\n  if (opts.antialias === undefined) {\r\n    opts.antialias = false;\r\n  }\r\n  // NOTE: it is said the performance improved in mobile device with this flag off.\r\n  if (opts.preserveDrawingBuffer === undefined) {\r\n    opts.preserveDrawingBuffer = false;\r\n  }\r\n\r\n  try {\r\n    gl = canvasEL.getContext('webgl', opts)\r\n      || canvasEL.getContext('experimental-webgl', opts)\r\n      || canvasEL.getContext('webkit-3d', opts)\r\n      || canvasEL.getContext('moz-webgl', opts);\r\n  } catch (err) {\r\n    console.error(err);\r\n    return;\r\n  }\r\n\r\n  // statics\r\n  this._gl = gl;\r\n  this._extensions = {};\r\n  this._caps = {}; // capability\r\n  this._stats = {\r\n    texture: 0,\r\n    vb: 0,\r\n    ib: 0,\r\n    drawcalls: 0,\r\n  };\r\n\r\n  this._initExtensions([\r\n    'EXT_texture_filter_anisotropic',\r\n    'EXT_shader_texture_lod',\r\n    'OES_standard_derivatives',\r\n    'OES_texture_float',\r\n    'OES_texture_float_linear',\r\n    'OES_texture_half_float',\r\n    'OES_texture_half_float_linear',\r\n    'OES_vertex_array_object',\r\n    'WEBGL_compressed_texture_atc',\r\n    'WEBGL_compressed_texture_etc1',\r\n    'WEBGL_compressed_texture_pvrtc',\r\n    'WEBGL_compressed_texture_s3tc',\r\n    'WEBGL_depth_texture',\r\n    'WEBGL_draw_buffers' ]);\r\n  this._initCaps();\r\n  this._initStates();\r\n\r\n  // runtime\r\n  State.initDefault(this);\r\n  this._current = new State(this);\r\n  this._next = new State(this);\r\n  this._uniforms = {}; // name: { value, num, dirty }\r\n  this._vx = this._vy = this._vw = this._vh = 0;\r\n  this._sx = this._sy = this._sw = this._sh = 0;\r\n  this._framebuffer = null;\r\n\r\n  //\r\n  this._enabledAttributes = new Array(this._caps.maxVertexAttribs);\r\n  this._newAttributes = new Array(this._caps.maxVertexAttribs);\r\n\r\n  for (var i = 0; i < this._caps.maxVertexAttribs; ++i) {\r\n    this$1._enabledAttributes[i] = 0;\r\n    this$1._newAttributes[i] = 0;\r\n  }\r\n};\r\n\r\nDevice.prototype._initExtensions = function _initExtensions (extensions) {\r\n    var this$1 = this;\r\n\r\n  var gl = this._gl;\r\n\r\n  for (var i = 0; i < extensions.length; ++i) {\r\n    var name = extensions[i];\r\n\r\n    var vendorPrefixes = [\"\", \"WEBKIT_\", \"MOZ_\"];\r\n    for (var j = 0; j < vendorPrefixes.length; j++) {\r\n      try {\r\n        var ext = gl.getExtension(vendorPrefixes[j] + name);\r\n        if (ext) {\r\n          this$1._extensions[name] = ext;\r\n        }\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nDevice.prototype._initCaps = function _initCaps () {\r\n  var gl = this._gl;\r\n  var extDrawBuffers = this.ext('WEBGL_draw_buffers');\r\n\r\n  this._caps.maxVertexStreams = 4;\r\n  this._caps.maxVertexTextures = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\r\n  this._caps.maxFragUniforms = gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS);\r\n  this._caps.maxTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n  this._caps.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\r\n\r\n  this._caps.maxDrawBuffers = extDrawBuffers ? gl.getParameter(extDrawBuffers.MAX_DRAW_BUFFERS_WEBGL) : 1;\r\n  this._caps.maxColorAttachments = extDrawBuffers ? gl.getParameter(extDrawBuffers.MAX_COLOR_ATTACHMENTS_WEBGL) : 1;\r\n};\r\n\r\nDevice.prototype._initStates = function _initStates () {\r\n  var gl = this._gl;\r\n\r\n  // gl.frontFace(gl.CCW);\r\n  gl.disable(gl.BLEND);\r\n  gl.blendFunc(gl.ONE, gl.ZERO);\r\n  gl.blendEquation(gl.FUNC_ADD);\r\n  gl.blendColor(1,1,1,1);\r\n\r\n  gl.colorMask(true, true, true, true);\r\n\r\n  gl.enable(gl.CULL_FACE);\r\n  gl.cullFace(gl.BACK);\r\n\r\n  gl.disable(gl.DEPTH_TEST);\r\n  gl.depthFunc(gl.LESS);\r\n  gl.depthMask(false);\r\n  gl.disable(gl.POLYGON_OFFSET_FILL);\r\n  gl.depthRange(0,1);\r\n\r\n  gl.disable(gl.STENCIL_TEST);\r\n  gl.stencilFunc(gl.ALWAYS, 0, 0xFF);\r\n  gl.stencilMask(0xFF);\r\n  gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\r\n\r\n  // TODO:\r\n  // this.setAlphaToCoverage(false);\r\n  // this.setTransformFeedbackBuffer(null);\r\n  // this.setRaster(true);\r\n  // this.setDepthBias(false);\r\n\r\n  gl.clearDepth(1);\r\n  gl.clearColor(0, 0, 0, 0);\r\n  gl.clearStencil(0);\r\n\r\n  gl.disable(gl.SCISSOR_TEST);\r\n};\r\n\r\nDevice.prototype._restoreTexture = function _restoreTexture (unit) {\r\n  var gl = this._gl;\r\n\r\n  var texture = this._current.textureUnits[unit];\r\n  if (texture && texture._glID !== -1) {\r\n    gl.bindTexture(texture._target, texture._glID);\r\n  } else {\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n};\r\n\r\nDevice.prototype._restoreIndexBuffer = function _restoreIndexBuffer () {\r\n  var gl = this._gl;\r\n\r\n  var ib = this._current.indexBuffer;\r\n  if (ib && ib._glID !== -1) {\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ib._glID);\r\n  }\r\n  else {\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n  }\r\n};\r\n\r\n/**\r\n * @method ext\r\n * @param {string} name\r\n */\r\nDevice.prototype.ext = function ext (name) {\r\n  return this._extensions[name];\r\n};\r\n\r\n// ===============================\r\n// Immediate Settings\r\n// ===============================\r\n\r\n/**\r\n * @method setFrameBuffer\r\n * @param {FrameBuffer} fb - null means use the backbuffer\r\n */\r\nDevice.prototype.setFrameBuffer = function setFrameBuffer (fb) {\r\n    var this$1 = this;\r\n\r\n  if (this._framebuffer === fb) {\r\n    return;\r\n  }\r\n\r\n  this._framebuffer = fb;\r\n  var gl = this._gl;\r\n\r\n  if (fb === null) {\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    return;\r\n  }\r\n\r\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb._glID);\r\n\r\n  var numColors = this._framebuffer._colors.length;\r\n  for (var i = 0; i < numColors; ++i) {\r\n    var colorBuffer = this$1._framebuffer._colors[i];\r\n    _attach(gl, gl.COLOR_ATTACHMENT0 + i, colorBuffer);\r\n\r\n    // TODO: what about cubemap face??? should be the target parameter for colorBuffer\r\n  }\r\n  for (var i$1 = numColors; i$1 < this._caps.maxColorAttachments; ++i$1) {\r\n    gl.framebufferTexture2D(\r\n      gl.FRAMEBUFFER,\r\n      gl.COLOR_ATTACHMENT0 + i$1,\r\n      gl.TEXTURE_2D,\r\n      null,\r\n      0\r\n    );\r\n  }\r\n\r\n  if (this._framebuffer._depth) {\r\n    _attach(gl, gl.DEPTH_ATTACHMENT, this._framebuffer._depth);\r\n  }\r\n\r\n  if (this._framebuffer._stencil) {\r\n    _attach(gl, gl.STENCIL_ATTACHMENT, fb._stencil);\r\n  }\r\n\r\n  if (this._framebuffer._depthStencil) {\r\n    _attach(gl, gl.DEPTH_STENCIL_ATTACHMENT, fb._depthStencil);\r\n  }\r\n};\r\n\r\n/**\r\n * @method setViewport\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} w\r\n * @param {Number} h\r\n */\r\nDevice.prototype.setViewport = function setViewport (x, y, w, h) {\r\n  if (\r\n    this._vx !== x ||\r\n    this._vy !== y ||\r\n    this._vw !== w ||\r\n    this._vh !== h\r\n  ) {\r\n    this._gl.viewport(x, y, w, h);\r\n    this._vx = x;\r\n    this._vy = y;\r\n    this._vw = w;\r\n    this._vh = h;\r\n  }\r\n};\r\n\r\n/**\r\n * @method setScissor\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} w\r\n * @param {Number} h\r\n */\r\nDevice.prototype.setScissor = function setScissor (x, y, w, h) {\r\n  if (\r\n    this._sx !== x ||\r\n    this._sy !== y ||\r\n    this._sw !== w ||\r\n    this._sh !== h\r\n  ) {\r\n    this._gl.scissor(x, y, w, h);\r\n    this._sx = x;\r\n    this._sy = y;\r\n    this._sw = w;\r\n    this._sh = h;\r\n  }\r\n};\r\n\r\n/**\r\n * @method clear\r\n * @param {Object} opts\r\n * @param {Array} opts.color\r\n * @param {Number} opts.depth\r\n * @param {Number} opts.stencil\r\n */\r\nDevice.prototype.clear = function clear (opts) {\r\n  var gl = this._gl;\r\n  var flags = 0;\r\n\r\n  if (opts.color !== undefined) {\r\n    flags |= gl.COLOR_BUFFER_BIT;\r\n    gl.clearColor(opts.color[0], opts.color[1], opts.color[2], opts.color[3]);\r\n  }\r\n\r\n  if (opts.depth !== undefined) {\r\n    flags |= gl.DEPTH_BUFFER_BIT;\r\n    gl.clearDepth(opts.depth);\r\n\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.depthMask(true);\r\n    gl.depthFunc(gl.ALWAYS);\r\n  }\r\n\r\n  if (opts.stencil !== undefined) {\r\n    flags |= gl.STENCIL_BUFFER_BIT;\r\n    gl.clearStencil(opts.stencil);\r\n  }\r\n\r\n  gl.clear(flags);\r\n\r\n  // restore depth-write\r\n  if (opts.depth !== undefined) {\r\n    if (this._current.depthTest === false) {\r\n      gl.disable(gl.DEPTH_TEST);\r\n    } else {\r\n      if (this._current.depthWrite === false) {\r\n        gl.depthMask(false);\r\n      }\r\n      if (this._current.depthFunc !== enums$1.DS_FUNC_ALWAYS) {\r\n        gl.depthFunc(this._current.depthFunc);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n// ===============================\r\n// Deferred States\r\n// ===============================\r\n\r\n/**\r\n * @method enableBlend\r\n */\r\nDevice.prototype.enableBlend = function enableBlend () {\r\n  this._next.blend = true;\r\n};\r\n\r\n/**\r\n * @method enableDepthTest\r\n */\r\nDevice.prototype.enableDepthTest = function enableDepthTest () {\r\n  this._next.depthTest = true;\r\n};\r\n\r\n/**\r\n * @method enableDepthWrite\r\n */\r\nDevice.prototype.enableDepthWrite = function enableDepthWrite () {\r\n  this._next.depthWrite = true;\r\n};\r\n\r\n/**\r\n * @method enableStencilTest\r\n */\r\nDevice.prototype.enableStencilTest = function enableStencilTest () {\r\n  this._next.stencilTest = true;\r\n};\r\n\r\n/**\r\n * @method setStencilFunc\r\n * @param {DS_FUNC_*} func\r\n * @param {Number} ref\r\n * @param {Number} mask\r\n */\r\nDevice.prototype.setStencilFunc = function setStencilFunc (func, ref, mask) {\r\n  this._next.stencilSep = false;\r\n  this._next.stencilFuncFront = this._next.stencilFuncBack = func;\r\n  this._next.stencilRefFront = this._next.stencilRefBack = ref;\r\n  this._next.stencilMaskFront = this._next.stencilMaskBack = mask;\r\n};\r\n\r\n/**\r\n * @method setStencilFuncFront\r\n * @param {DS_FUNC_*} func\r\n * @param {Number} ref\r\n * @param {Number} mask\r\n */\r\nDevice.prototype.setStencilFuncFront = function setStencilFuncFront (func, ref, mask) {\r\n  this._next.stencilSep = true;\r\n  this._next.stencilFuncFront = func;\r\n  this._next.stencilRefFront = ref;\r\n  this._next.stencilMaskFront = mask;\r\n};\r\n\r\n/**\r\n * @method setStencilFuncBack\r\n * @param {DS_FUNC_*} func\r\n * @param {Number} ref\r\n * @param {Number} mask\r\n */\r\nDevice.prototype.setStencilFuncBack = function setStencilFuncBack (func, ref, mask) {\r\n  this._next.stencilSep = true;\r\n  this._next.stencilFuncBack = func;\r\n  this._next.stencilRefBack = ref;\r\n  this._next.stencilMaskBack = mask;\r\n};\r\n\r\n/**\r\n * @method setStencilOp\r\n * @param {STENCIL_OP_*} failOp\r\n * @param {STENCIL_OP_*} zFailOp\r\n * @param {STENCIL_OP_*} zPassOp\r\n * @param {Number} writeMask\r\n */\r\nDevice.prototype.setStencilOp = function setStencilOp (failOp, zFailOp, zPassOp, writeMask) {\r\n  this._next.stencilFailOpFront = this._next.stencilFailOpBack = failOp;\r\n  this._next.stencilZFailOpFront = this._next.stencilZFailOpBack = zFailOp;\r\n  this._next.stencilZPassOpFront = this._next.stencilZPassOpBack = zPassOp;\r\n  this._next.stencilWriteMaskFront = this._next.stencilWriteMaskBack = writeMask;\r\n};\r\n\r\n/**\r\n * @method setStencilOpFront\r\n * @param {STENCIL_OP_*} failOp\r\n * @param {STENCIL_OP_*} zFailOp\r\n * @param {STENCIL_OP_*} zPassOp\r\n * @param {Number} writeMask\r\n */\r\nDevice.prototype.setStencilOpFront = function setStencilOpFront (failOp, zFailOp, zPassOp, writeMask) {\r\n  this._next.stencilSep = true;\r\n  this._next.stencilFailOpFront = failOp;\r\n  this._next.stencilZFailOpFront = zFailOp;\r\n  this._next.stencilZPassOpFront = zPassOp;\r\n  this._next.stencilWriteMaskFront = writeMask;\r\n};\r\n\r\n/**\r\n * @method setStencilOpBack\r\n * @param {STENCIL_OP_*} failOp\r\n * @param {STENCIL_OP_*} zFailOp\r\n * @param {STENCIL_OP_*} zPassOp\r\n * @param {Number} writeMask\r\n */\r\nDevice.prototype.setStencilOpBack = function setStencilOpBack (failOp, zFailOp, zPassOp, writeMask) {\r\n  this._next.stencilSep = true;\r\n  this._next.stencilFailOpBack = failOp;\r\n  this._next.stencilZFailOpBack = zFailOp;\r\n  this._next.stencilZPassOpBack = zPassOp;\r\n  this._next.stencilWriteMaskBack = writeMask;\r\n};\r\n\r\n/**\r\n * @method setDepthFunc\r\n * @param {DS_FUNC_*} depthFunc\r\n */\r\nDevice.prototype.setDepthFunc = function setDepthFunc (depthFunc) {\r\n  this._next.depthFunc = depthFunc;\r\n};\r\n\r\n/**\r\n * @method setBlendColor32\r\n * @param {Number} rgba\r\n */\r\nDevice.prototype.setBlendColor32 = function setBlendColor32 (rgba) {\r\n  this._next.blendColor = rgba;\r\n};\r\n\r\n/**\r\n * @method setBlendColor\r\n * @param {Number} r\r\n * @param {Number} g\r\n * @param {Number} b\r\n * @param {Number} a\r\n */\r\nDevice.prototype.setBlendColor = function setBlendColor (r, g, b, a) {\r\n  this._next.blendColor = ((r * 255) << 24 | (g * 255) << 16 | (b * 255) << 8 | a * 255) >>> 0;\r\n};\r\n\r\n/**\r\n * @method setBlendFunc\r\n * @param {BELND_*} src\r\n * @param {BELND_*} dst\r\n */\r\nDevice.prototype.setBlendFunc = function setBlendFunc (src, dst) {\r\n  this._next.blendSep = false;\r\n  this._next.blendSrc = src;\r\n  this._next.blendDst = dst;\r\n};\r\n\r\n/**\r\n * @method setBlendFuncSep\r\n * @param {BELND_*} src\r\n * @param {BELND_*} dst\r\n * @param {BELND_*} srcAlpha\r\n * @param {BELND_*} dstAlpha\r\n */\r\nDevice.prototype.setBlendFuncSep = function setBlendFuncSep (src, dst, srcAlpha, dstAlpha) {\r\n  this._next.blendSep = true;\r\n  this._next.blendSrc = src;\r\n  this._next.blendDst = dst;\r\n  this._next.blendSrcAlpha = srcAlpha;\r\n  this._next.blendDstAlpha = dstAlpha;\r\n};\r\n\r\n/**\r\n * @method setBlendEq\r\n * @param {BELND_FUNC_*} eq\r\n */\r\nDevice.prototype.setBlendEq = function setBlendEq (eq) {\r\n  this._next.blendSep = false;\r\n  this._next.blendEq = eq;\r\n};\r\n\r\n/**\r\n * @method setBlendEqSep\r\n * @param {BELND_FUNC_*} eq\r\n * @param {BELND_FUNC_*} alphaEq\r\n */\r\nDevice.prototype.setBlendEqSep = function setBlendEqSep (eq, alphaEq) {\r\n  this._next.blendSep = true;\r\n  this._next.blendEq = eq;\r\n  this._next.blendAlphaEq = alphaEq;\r\n};\r\n\r\n/**\r\n * @method setCullMode\r\n * @param {CULL_*} mode\r\n */\r\nDevice.prototype.setCullMode = function setCullMode (mode) {\r\n  this._next.cullMode = mode;\r\n};\r\n\r\n/**\r\n * @method setVertexBuffer\r\n * @param {Number} stream\r\n * @param {VertexBuffer} buffer\r\n * @param {Number} start - start vertex\r\n */\r\nDevice.prototype.setVertexBuffer = function setVertexBuffer (stream, buffer, start) {\r\n    if ( start === void 0 ) start = 0;\r\n\r\n  this._next.vertexBuffers[stream] = buffer;\r\n  this._next.vertexBufferOffsets[stream] = start;\r\n  if (this._next.maxStream < stream) {\r\n    this._next.maxStream = stream;\r\n  }\r\n};\r\n\r\n/**\r\n * @method setIndexBuffer\r\n * @param {IndexBuffer} buffer\r\n */\r\nDevice.prototype.setIndexBuffer = function setIndexBuffer (buffer) {\r\n  this._next.indexBuffer = buffer;\r\n};\r\n\r\n/**\r\n * @method setProgram\r\n * @param {Program} program\r\n */\r\nDevice.prototype.setProgram = function setProgram (program) {\r\n  this._next.program = program;\r\n};\r\n\r\n/**\r\n * @method setTexture\r\n * @param {String} name\r\n * @param {Texture} texture\r\n * @param {Number} slot\r\n */\r\nDevice.prototype.setTexture = function setTexture (name, texture, slot) {\r\n  if (slot >= this._caps.maxTextureUnits) {\r\n    console.warn((\"Can not set texture \" + name + \" at stage \" + slot + \", max texture exceed: \" + (this._caps.maxTextureUnits)));\r\n    return;\r\n  }\r\n\r\n  this._next.textureUnits[slot] = texture;\r\n  this.setUniform(name, slot);\r\n\r\n  if (this._next.maxTextureSlot < slot) {\r\n    this._next.maxTextureSlot = slot;\r\n  }\r\n};\r\n\r\n/**\r\n * @method setTextureArray\r\n * @param {String} name\r\n * @param {Array} textures\r\n * @param {Int32Array} slots\r\n */\r\nDevice.prototype.setTextureArray = function setTextureArray (name, textures, slots) {\r\n    var this$1 = this;\r\n\r\n  var len = textures.length;\r\n  if (len >= this._caps.maxTextureUnits) {\r\n    console.warn((\"Can not set \" + len + \" textures for \" + name + \", max texture exceed: \" + (this._caps.maxTextureUnits)));\r\n    return;\r\n  }\r\n  for (var i = 0; i < len; ++i) {\r\n    var slot = slots[i];\r\n    this$1._next.textureUnits[slot] = textures[i];\r\n  }\r\n  this.setUniform(name, slots);\r\n};\r\n\r\n/**\r\n * @method setUniform\r\n * @param {String} name\r\n * @param {*} value\r\n */\r\nDevice.prototype.setUniform = function setUniform (name, value) {\r\n  var uniform = this._uniforms[name];\r\n  if (!uniform || (uniform.isArray && uniform.value.length < value.length)) {\r\n    var newValue = value;\r\n    var isArray = false;\r\n    if (value instanceof Float32Array || Array.isArray(value)) {\r\n      newValue = new Float32Array(value);\r\n      isArray = true;\r\n    }\r\n    else if (value instanceof Int32Array) {\r\n      newValue = new Int32Array(value);\r\n      isArray = true;\r\n    }\r\n\r\n    uniform = {\r\n      dirty: true,\r\n      value: newValue,\r\n      isArray: isArray\r\n    };\r\n  } else {\r\n    var oldValue = uniform.value;\r\n    var dirty = false;\r\n    if (uniform.isArray) {\r\n      for (var i = 0, l = oldValue.length; i < l; i++) {\r\n        if (oldValue[i] !== value[i]) {\r\n          dirty = true;\r\n          oldValue[i] = value[i];\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      if (oldValue !== value) {\r\n        dirty = true;\r\n        uniform.value = value;\r\n      }\r\n    }\r\n\r\n    if (dirty) {\r\n      uniform.dirty = true;\r\n    }\r\n  }\r\n  this._uniforms[name] = uniform;\r\n};\r\n\r\n/**\r\n * @method setPrimitiveType\r\n * @param {PT_*} type\r\n */\r\nDevice.prototype.setPrimitiveType = function setPrimitiveType (type) {\r\n  this._next.primitiveType = type;\r\n};\r\n\r\n/**\r\n * @method draw\r\n * @param {Number} base\r\n * @param {Number} count\r\n */\r\nDevice.prototype.draw = function draw (base, count) {\r\n    var this$1 = this;\r\n\r\n  var gl = this._gl;\r\n  var cur = this._current;\r\n  var next = this._next;\r\n\r\n  // commit blend\r\n  _commitBlendStates(gl, cur, next);\r\n\r\n  // commit depth\r\n  _commitDepthStates(gl, cur, next);\r\n\r\n  // commit stencil\r\n  _commitStencilStates(gl, cur, next);\r\n\r\n  // commit cull\r\n  _commitCullMode(gl, cur, next);\r\n\r\n  // commit vertex-buffer\r\n  _commitVertexBuffers(this, gl, cur, next);\r\n\r\n  // commit index-buffer\r\n  if (cur.indexBuffer !== next.indexBuffer) {\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, next.indexBuffer ? next.indexBuffer._glID : null);\r\n  }\r\n\r\n  // commit program\r\n  var programDirty = false;\r\n  if (cur.program !== next.program) {\r\n    if (next.program._linked) {\r\n      gl.useProgram(next.program._glID);\r\n    } else {\r\n      console.warn('Failed to use program: has not linked yet.');\r\n    }\r\n    programDirty = true;\r\n  }\r\n\r\n  // commit texture/sampler\r\n  _commitTextures(gl, cur, next);\r\n\r\n  // commit uniforms\r\n  for (var i = 0; i < next.program._uniforms.length; ++i) {\r\n    var uniformInfo = next.program._uniforms[i];\r\n    var uniform = this$1._uniforms[uniformInfo.name];\r\n    if (!uniform) {\r\n      // console.warn(`Can not find uniform ${uniformInfo.name}`);\r\n      continue;\r\n    }\r\n\r\n    if (!programDirty && !uniform.dirty) {\r\n      continue;\r\n    }\r\n\r\n    uniform.dirty = false;\r\n\r\n    // TODO: please consider array uniform: uniformInfo.size > 0\r\n\r\n    var commitFunc = (uniformInfo.size === undefined) ? _type2uniformCommit[uniformInfo.type] : _type2uniformArrayCommit[uniformInfo.type];\r\n    if (!commitFunc) {\r\n      console.warn((\"Can not find commit function for uniform \" + (uniformInfo.name)));\r\n      continue;\r\n    }\r\n\r\n    commitFunc(gl, uniformInfo.location, uniform.value);\r\n  }\r\n\r\n  // drawPrimitives\r\n  if (next.indexBuffer) {\r\n    gl.drawElements(\r\n      this._next.primitiveType,\r\n      count,\r\n      next.indexBuffer._format,\r\n      base * next.indexBuffer._bytesPerIndex\r\n    );\r\n  } else {\r\n    gl.drawArrays(\r\n      this._next.primitiveType,\r\n      base,\r\n      count\r\n    );\r\n  }\r\n\r\n  // TODO: autogen mipmap for color buffer\r\n  // if (this._framebuffer && this._framebuffer.colors[0].mipmap) {\r\n  // gl.bindTexture(this._framebuffer.colors[i]._target, colors[i]._glID);\r\n  // gl.generateMipmap(this._framebuffer.colors[i]._target);\r\n  // }\r\n\r\n  // update stats\r\n  this._stats.drawcalls += 1;\r\n\r\n  // reset states\r\n  cur.set(next);\r\n  next.reset();\r\n};\r\n\r\nvar gfx = {\r\n  // classes\r\n  VertexFormat: VertexFormat,\r\n  IndexBuffer: IndexBuffer,\r\n  VertexBuffer: VertexBuffer,\r\n  Program: Program,\r\n  Texture: Texture,\r\n  Texture2D: Texture2D,\r\n  TextureCube: TextureCube,\r\n  RenderBuffer: RenderBuffer,\r\n  FrameBuffer: FrameBuffer,\r\n  Device: Device,\r\n\r\n  // functions\r\n  attrTypeBytes: attrTypeBytes,\r\n  glFilter: glFilter,\r\n  glTextureFmt: glTextureFmt,\r\n};\r\nObject.assign(gfx, enums$1);\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar InputAssembler = function InputAssembler(vb, ib, pt) {\r\n  if ( pt === void 0 ) pt = gfx.PT_TRIANGLES;\r\n\r\n  this._vertexBuffer = vb;\r\n  this._indexBuffer = ib;\r\n  this._primitiveType = pt;\r\n  this._start = 0;\r\n  this._count = -1;\r\n\r\n  // TODO: instancing data\r\n  // this._stream = 0;\r\n};\r\n\r\nInputAssembler.prototype.getPrimitiveCount = function getPrimitiveCount () {\r\n  if (this._count !== -1) {\r\n    return this._count;\r\n  }\r\n\r\n  if (this._indexBuffer) {\r\n    return this._indexBuffer.count;\r\n  }\r\n\r\n  return this._vertexBuffer.count;\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar Pass = function Pass(name) {\r\n  this._programName = name;\r\n\r\n  // cullmode\r\n  this._cullMode = gfx.CULL_BACK;\r\n\r\n  // blending\r\n  this._blend = false;\r\n  this._blendEq = gfx.BLEND_FUNC_ADD;\r\n  this._blendAlphaEq = gfx.BLEND_FUNC_ADD;\r\n  this._blendSrc = gfx.BLEND_ONE;\r\n  this._blendDst = gfx.BLEND_ZERO;\r\n  this._blendSrcAlpha = gfx.BLEND_ONE;\r\n  this._blendDstAlpha = gfx.BLEND_ZERO;\r\n  this._blendColor = 0xffffffff;\r\n\r\n  // depth\r\n  this._depthTest = false;\r\n  this._depthWrite = false;\r\n  this._depthFunc = gfx.DS_FUNC_LESS;\r\n  this._stencilTest = false;\r\n  // front\r\n  this._stencilFuncFront = gfx.DS_FUNC_ALWAYS;\r\n  this._stencilRefFront = 0;\r\n  this._stencilMaskFront = 0xff;\r\n  this._stencilFailOpFront = gfx.STENCIL_OP_KEEP;\r\n  this._stencilZFailOpFront = gfx.STENCIL_OP_KEEP;\r\n  this._stencilZPassOpFront = gfx.STENCIL_OP_KEEP;\r\n  this._stencilWriteMaskFront = 0xff;\r\n  // back\r\n  this._stencilFuncBack = gfx.DS_FUNC_ALWAYS;\r\n  this._stencilRefBack = 0;\r\n  this._stencilMaskBack = 0xff;\r\n  this._stencilFailOpBack = gfx.STENCIL_OP_KEEP;\r\n  this._stencilZFailOpBack = gfx.STENCIL_OP_KEEP;\r\n  this._stencilZPassOpBack = gfx.STENCIL_OP_KEEP;\r\n  this._stencilWriteMaskBack = 0xff;\r\n};\r\n\r\nPass.prototype.copy = function (pass) {\r\n    this._programName = pass._programName;\r\n    // cullmode\r\n    this._cullMode = pass._cullMode;\r\n    // blending\r\n    this._blend = pass._blend;\r\n    this._blendEq = pass._blendEq;\r\n    this._blendAlphaEq = pass._blendAlphaEq;\r\n    this._blendSrc = pass._blendSrc;\r\n    this._blendDst = pass._blendDst;\r\n    this._blendSrcAlpha = pass._blendSrcAlpha;\r\n    this._blendDstAlpha = pass._blendDstAlpha;\r\n    this._blendColor = pass._blendColor;\r\n    // depth\r\n    this._depthTest = pass._depthTest;\r\n    this._depthWrite = pass._depthWrite;\r\n    this._depthFunc = pass._depthFunc;\r\n    this._stencilTest = pass._stencilTest;\r\n    // front\r\n    this._stencilFuncFront = pass._stencilFuncFront;\r\n    this._stencilRefFront = pass._stencilRefFront;\r\n    this._stencilMaskFront = pass._stencilMaskFront;\r\n    this._stencilFailOpFront = pass._stencilFailOpFront;\r\n    this._stencilZFailOpFront = pass._stencilZFailOpFront;\r\n    this._stencilZPassOpFront = pass._stencilZPassOpFront;\r\n    this._stencilWriteMaskFront = pass._stencilWriteMaskFront;\r\n    // back\r\n    this._stencilFuncBack = pass._stencilFuncBack;\r\n    this._stencilRefBack = pass._stencilRefBack;\r\n    this._stencilMaskBack = pass._stencilMaskBack;\r\n    this._stencilFailOpBack = pass._stencilFailOpBack;\r\n    this._stencilZFailOpBack = pass._stencilZFailOpBack;\r\n    this._stencilZPassOpBack = pass._stencilZPassOpBack;\r\n    this._stencilWriteMaskBack = pass._stencilWriteMaskBack;\r\n};\r\n\r\nPass.prototype.setCullMode = function setCullMode (cullMode) {\r\n  this._cullMode = cullMode;\r\n};\r\n\r\nPass.prototype.setBlend = function setBlend (\r\n  blendEq,\r\n  blendSrc,\r\n  blendDst,\r\n  blendAlphaEq,\r\n  blendSrcAlpha,\r\n  blendDstAlpha,\r\n  blendColor\r\n) {\r\n    if ( blendEq === void 0 ) blendEq = gfx.BLEND_FUNC_ADD;\r\n    if ( blendSrc === void 0 ) blendSrc = gfx.BLEND_ONE;\r\n    if ( blendDst === void 0 ) blendDst = gfx.BLEND_ZERO;\r\n    if ( blendAlphaEq === void 0 ) blendAlphaEq = gfx.BLEND_FUNC_ADD;\r\n    if ( blendSrcAlpha === void 0 ) blendSrcAlpha = gfx.BLEND_ONE;\r\n    if ( blendDstAlpha === void 0 ) blendDstAlpha = gfx.BLEND_ZERO;\r\n    if ( blendColor === void 0 ) blendColor = 0xffffffff;\r\n\r\n  this._blend = true;\r\n  this._blendEq = blendEq;\r\n  this._blendSrc = blendSrc;\r\n  this._blendDst = blendDst;\r\n  this._blendAlphaEq = blendAlphaEq;\r\n  this._blendSrcAlpha = blendSrcAlpha;\r\n  this._blendDstAlpha = blendDstAlpha;\r\n  this._blendColor = blendColor;\r\n};\r\n\r\nPass.prototype.setDepth = function setDepth (\r\n  depthTest,\r\n  depthWrite,\r\n  depthFunc\r\n) {\r\n    if ( depthTest === void 0 ) depthTest = false;\r\n    if ( depthWrite === void 0 ) depthWrite = false;\r\n    if ( depthFunc === void 0 ) depthFunc = gfx.DS_FUNC_LESS;\r\n\r\n  this._depthTest = depthTest;\r\n  this._depthWrite = depthWrite;\r\n  this._depthFunc = depthFunc;\r\n};\r\n\r\nPass.prototype.setStencilFront = function setStencilFront (\r\n  stencilFunc,\r\n  stencilRef,\r\n  stencilMask,\r\n  stencilFailOp,\r\n  stencilZFailOp,\r\n  stencilZPassOp,\r\n  stencilWriteMask\r\n) {\r\n    if ( stencilFunc === void 0 ) stencilFunc = gfx.DS_FUNC_ALWAYS;\r\n    if ( stencilRef === void 0 ) stencilRef = 0;\r\n    if ( stencilMask === void 0 ) stencilMask = 0xff;\r\n    if ( stencilFailOp === void 0 ) stencilFailOp = gfx.STENCIL_OP_KEEP;\r\n    if ( stencilZFailOp === void 0 ) stencilZFailOp = gfx.STENCIL_OP_KEEP;\r\n    if ( stencilZPassOp === void 0 ) stencilZPassOp = gfx.STENCIL_OP_KEEP;\r\n    if ( stencilWriteMask === void 0 ) stencilWriteMask = 0xff;\r\n\r\n  this._stencilTest = true;\r\n  this._stencilFuncFront = stencilFunc;\r\n  this._stencilRefFront = stencilRef;\r\n  this._stencilMaskFront = stencilMask;\r\n  this._stencilFailOpFront = stencilFailOp;\r\n  this._stencilZFailOpFront = stencilZFailOp;\r\n  this._stencilZPassOpFront = stencilZPassOp;\r\n  this._stencilWriteMaskFront = stencilWriteMask;\r\n};\r\n\r\nPass.prototype.setStencilBack = function setStencilBack (\r\n  stencilFunc,\r\n  stencilRef,\r\n  stencilMask,\r\n  stencilFailOp,\r\n  stencilZFailOp,\r\n  stencilZPassOp,\r\n  stencilWriteMask\r\n) {\r\n    if ( stencilFunc === void 0 ) stencilFunc = gfx.DS_FUNC_ALWAYS;\r\n    if ( stencilRef === void 0 ) stencilRef = 0;\r\n    if ( stencilMask === void 0 ) stencilMask = 0xff;\r\n    if ( stencilFailOp === void 0 ) stencilFailOp = gfx.STENCIL_OP_KEEP;\r\n    if ( stencilZFailOp === void 0 ) stencilZFailOp = gfx.STENCIL_OP_KEEP;\r\n    if ( stencilZPassOp === void 0 ) stencilZPassOp = gfx.STENCIL_OP_KEEP;\r\n    if ( stencilWriteMask === void 0 ) stencilWriteMask = 0xff;\r\n\r\n  this._stencilTest = true;\r\n  this._stencilFuncBack = stencilFunc;\r\n  this._stencilRefBack = stencilRef;\r\n  this._stencilMaskBack = stencilMask;\r\n  this._stencilFailOpBack = stencilFailOp;\r\n  this._stencilZFailOpBack = stencilZFailOp;\r\n  this._stencilZPassOpBack = stencilZPassOp;\r\n  this._stencilWriteMaskBack = stencilWriteMask;\r\n};\r\n\r\nPass.prototype.disableStencilTest = function disableStencilTest () {\r\n  this._stencilTest = false;\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar _stageOffset = 0;\r\nvar _name2stageID = {};\r\n\r\nvar config = {\r\n  addStage: function (name) {\r\n    // already added\r\n    if (_name2stageID[name] !== undefined) {\r\n      return;\r\n    }\r\n\r\n    var stageID = 1 << _stageOffset;\r\n    _name2stageID[name] = stageID;\r\n\r\n    _stageOffset += 1;\r\n  },\r\n\r\n  stageID: function (name) {\r\n    var id = _name2stageID[name];\r\n    if (id === undefined) {\r\n      return -1;\r\n    }\r\n    return id;\r\n  },\r\n\r\n  stageIDs: function (nameList) {\r\n    var key = 0;\r\n    for (var i = 0; i < nameList.length; ++i) {\r\n      var id = _name2stageID[nameList[i]];\r\n      if (id !== undefined) {\r\n        key |= id;\r\n      }\r\n    }\r\n    return key;\r\n  }\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar _genID$1 = 0;\r\n\r\nvar Technique = function Technique(stages, parameters, passes, layer) {\r\n  if ( layer === void 0 ) layer = 0;\r\n\r\n  this._id = _genID$1++;\r\n  this._stageIDs = config.stageIDs(stages);\r\n  this._parameters = parameters; // {name, type, size, val}\r\n  this._passes = passes;\r\n  this._layer = layer;\r\n  // TODO: this._version = 'webgl' or 'webgl2' // ????\r\n};\r\n\r\nvar prototypeAccessors$3 = { passes: { configurable: true },stageIDs: { configurable: true } };\r\n\r\nTechnique.prototype.copy = function (technique) {\r\n  this._id = technique._id;\r\n  this._stageIDs = technique._stageIDs;\r\n\r\n  this._parameters = [];\r\n  for (let i = 0; i < technique._parameters.length; ++i) {\r\n    let parameter = technique._parameters[i];\r\n    this._parameters.push({name: parameter.name, type: parameter.type});\r\n  }\r\n\r\n  for (let i = 0; i < technique._passes.length; ++i) {\r\n    let pass = this._passes[i];\r\n    if (!pass) {\r\n      pass = new renderer.Pass();\r\n      this._passes.push(pass);\r\n    }\r\n    pass.copy(technique._passes[i]);\r\n  }\r\n  this._passes.length = technique._passes.length;\r\n\r\n  this._layer = technique._layer;\r\n};\r\n\r\nTechnique.prototype.setStages = function setStages (stages) {\r\n  this._stageIDs = config.stageIDs(stages);\r\n};\r\n\r\nprototypeAccessors$3.passes.get = function () {\r\n  return this._passes;\r\n};\r\n\r\nprototypeAccessors$3.stageIDs.get = function () {\r\n  return this._stageIDs;\r\n};\r\n\r\nObject.defineProperties( Technique.prototype, prototypeAccessors$3 );\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar Effect = function Effect(techniques, properties, defines) {\r\n  if ( properties === void 0 ) properties = {};\r\n  if ( defines === void 0 ) defines = [];\r\n\r\n  this._techniques = techniques;\r\n  this._properties = properties;\r\n  this._defines = defines;\r\n\r\n  // TODO: check if params is valid for current technique???\r\n};\r\n\r\nEffect.prototype.clear = function clear () {\r\n  this._techniques.length = 0;\r\n  this._properties = null;\r\n  this._defines.length = 0;\r\n};\r\n\r\nEffect.prototype.getTechnique = function getTechnique (stage) {\r\n    var this$1 = this;\r\n\r\n  var stageID = config.stageID(stage);\r\n  for (var i = 0; i < this._techniques.length; ++i) {\r\n    var tech = this$1._techniques[i];\r\n    if (tech.stageIDs & stageID) {\r\n      return tech;\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nEffect.prototype.getProperty = function getProperty (name) {\r\n  return this._properties[name];\r\n};\r\n\r\nEffect.prototype.setProperty = function setProperty (name, value) {\r\n  // TODO: check if params is valid for current technique???\r\n  this._properties[name] = value;\r\n};\r\n\r\nEffect.prototype.getDefine = function getDefine (name) {\r\n    var this$1 = this;\r\n\r\n  for (var i = 0; i < this._defines.length; ++i) {\r\n    var def = this$1._defines[i];\r\n    if ( def.name === name ) {\r\n      return def.value;\r\n    }\r\n  }\r\n\r\n  console.warn((\"Failed to get define \" + name + \", define not found.\"));\r\n  return null;\r\n};\r\n\r\nEffect.prototype.define = function define (name, value) {\r\n    var this$1 = this;\r\n\r\n  for (var i = 0; i < this._defines.length; ++i) {\r\n    var def = this$1._defines[i];\r\n    if ( def.name === name ) {\r\n      def.value = value;\r\n      return;\r\n    }\r\n  }\r\n\r\n  console.warn((\"Failed to set define \" + name + \", define not found.\"));\r\n};\r\n\r\nEffect.prototype.extractDefines = function extractDefines (out) {\r\n    var this$1 = this;\r\n    if ( out === void 0 ) out = {};\r\n\r\n  for (var i = 0; i < this._defines.length; ++i) {\r\n    var def = this$1._defines[i];\r\n    out[def.name] = def.value;\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\n/**\r\n * @param {object} json\r\n */\r\n\r\n\r\n/**\r\n * @param {gfx.Device} device\r\n * @param {Object} data\r\n */\r\nfunction createIA(device, data) {\r\n  if (!data.positions) {\r\n    console.error('The data must have positions field');\r\n    return null;\r\n  }\r\n\r\n  var verts = [];\r\n  var vcount = data.positions.length / 3;\r\n\r\n  for (var i = 0; i < vcount; ++i) {\r\n    verts.push(data.positions[3 * i], data.positions[3 * i + 1], data.positions[3 * i + 2]);\r\n\r\n    if (data.normals) {\r\n      verts.push(data.normals[3 * i], data.normals[3 * i + 1], data.normals[3 * i + 2]);\r\n    }\r\n\r\n    if (data.uvs) {\r\n      verts.push(data.uvs[2 * i], data.uvs[2 * i + 1]);\r\n    }\r\n  }\r\n\r\n  var vfmt = [];\r\n  vfmt.push({ name: gfx.ATTR_POSITION, type: gfx.ATTR_TYPE_FLOAT32, num: 3 });\r\n  if (data.normals) {\r\n    vfmt.push({ name: gfx.ATTR_NORMAL, type: gfx.ATTR_TYPE_FLOAT32, num: 3 });\r\n  }\r\n  if (data.uvs) {\r\n    vfmt.push({ name: gfx.ATTR_UV0, type: gfx.ATTR_TYPE_FLOAT32, num: 2 });\r\n  }\r\n\r\n  var vb = new gfx.VertexBuffer(\r\n    device,\r\n    new gfx.VertexFormat(vfmt),\r\n    gfx.USAGE_STATIC,\r\n    new Float32Array(verts),\r\n    vcount\r\n  );\r\n\r\n  var ib = null;\r\n  if (data.indices) {\r\n    ib = new gfx.IndexBuffer(\r\n      device,\r\n      gfx.INDEX_FMT_UINT16,\r\n      gfx.USAGE_STATIC,\r\n      new Uint16Array(data.indices),\r\n      data.indices.length\r\n    );\r\n  }\r\n\r\n  return new InputAssembler(vb, ib);\r\n}\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar _m4_tmp = mat4.create();\r\nvar _genID$2 = 0;\r\n\r\nvar View = function View() {\r\n  this._id = _genID$2++;\r\n\r\n  // viewport\r\n  this._rect = {\r\n    x: 0, y: 0, w: 1, h: 1\r\n  };\r\n\r\n  // TODO:\r\n  // this._scissor = {\r\n  // x: 0, y: 0, w: 1, h: 1\r\n  // };\r\n\r\n  // clear options\r\n  this._color = color4.new(0.3, 0.3, 0.3, 1);\r\n  this._depth = 1;\r\n  this._stencil = 0;\r\n  this._clearFlags = enums.CLEAR_COLOR | enums.CLEAR_DEPTH;\r\n\r\n  // matrix\r\n  this._matView = mat4.create();\r\n  this._matProj = mat4.create();\r\n  this._matViewProj = mat4.create();\r\n  this._matInvViewProj = mat4.create();\r\n\r\n  // stages & framebuffer\r\n  this._stages = [];\r\n  this._cullingMask = 1;\r\n  this._framebuffer = null;\r\n\r\n  this._shadowLight = null; // TODO: should not refer light in view.\r\n};\r\n\r\nView.prototype.getForward = function getForward (out) {\r\n  return vec3.set(\r\n    out,\r\n    -this._matView.m02,\r\n    -this._matView.m06,\r\n    -this._matView.m10\r\n  );\r\n};\r\n\r\nView.prototype.getPosition = function getPosition (out) {\r\n  mat4.invert(_m4_tmp, this._matView);\r\n  return mat4.getTranslation(out, _m4_tmp);\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar _forward = vec3.new(0, 0, -1);\r\n\r\nvar _m4_tmp$1 = mat4.create();\r\nvar _m3_tmp = mat3.create();\r\nvar _transformedLightDirection = vec3.create();\r\n\r\n// compute light viewProjMat for shadow.\r\nfunction _computeSpotLightViewProjMatrix(light, outView, outProj) {\r\n  // view matrix\r\n  light._node.getWorldRT(outView);\r\n  mat4.invert(outView, outView);\r\n\r\n  // proj matrix\r\n  mat4.perspective(outProj, light._spotAngle * light._spotAngleScale, 1, light._shadowMinDepth, light._shadowMaxDepth);\r\n}\r\n\r\nfunction _computeDirectionalLightViewProjMatrix(light, outView, outProj) {\r\n  // view matrix\r\n  light._node.getWorldRT(outView);\r\n  mat4.invert(outView, outView);\r\n\r\n  // TODO: should compute directional light frustum based on rendered meshes in scene.\r\n  // proj matrix\r\n  var halfSize = light._shadowFustumSize / 2;\r\n  mat4.ortho(outProj, -halfSize, halfSize, -halfSize, halfSize, light._shadowMinDepth, light._shadowMaxDepth);\r\n}\r\n\r\nfunction _computePointLightViewProjMatrix(light, outView, outProj) {\r\n  // TODO:\r\n}\r\n\r\nvar Light = function Light() {\r\n  this._poolID = -1;\r\n  this._node = null;\r\n\r\n  this._type = enums.LIGHT_DIRECTIONAL;\r\n\r\n  this._color = color3.new(1, 1, 1);\r\n  this._intensity = 1;\r\n\r\n  // used for spot and point light\r\n  this._range = 1;\r\n  // used for spot light, default to 60 degrees\r\n  this._spotAngle = toRadian(60);\r\n  this._spotExp = 1;\r\n  // cached for uniform\r\n  this._directionUniform = new Float32Array(3);\r\n  this._positionUniform = new Float32Array(3);\r\n  this._colorUniform = new Float32Array([this._color.r * this._intensity, this._color.g * this._intensity, this._color.b * this._intensity]);\r\n  this._spotUniform = new Float32Array([Math.cos(this._spotAngle * 0.5), this._spotExp]);\r\n\r\n  // shadow params\r\n  this._shadowType = enums.SHADOW_NONE;\r\n  this._shadowFrameBuffer = null;\r\n  this._shadowMap = null;\r\n  this._shadowMapDirty = false;\r\n  this._shadowDepthBuffer = null;\r\n  this._shadowResolution = 1024;\r\n  this._shadowBias = 0.00005;\r\n  this._shadowDarkness = 1;\r\n  this._shadowMinDepth = 1;\r\n  this._shadowMaxDepth = 1000;\r\n  this._shadowDepthScale = 50; // maybe need to change it if the distance between shadowMaxDepth and shadowMinDepth is small.\r\n  this._frustumEdgeFalloff = 0; // used by directional and spot light.\r\n  this._viewProjMatrix = mat4.create();\r\n  this._spotAngleScale = 1; // used for spot light.\r\n  this._shadowFustumSize = 80; // used for directional light.\r\n};\r\n\r\nvar prototypeAccessors$4 = { color: { configurable: true },intensity: { configurable: true },type: { configurable: true },spotAngle: { configurable: true },spotExp: { configurable: true },range: { configurable: true },shadowType: { configurable: true },shadowMap: { configurable: true },viewProjMatrix: { configurable: true },shadowResolution: { configurable: true },shadowBias: { configurable: true },shadowDarkness: { configurable: true },shadowMinDepth: { configurable: true },shadowMaxDepth: { configurable: true },shadowDepthScale: { configurable: true },frustumEdgeFalloff: { configurable: true } };\r\n\r\nLight.prototype.setNode = function setNode (node) {\r\n  this._node = node;\r\n};\r\n\r\nLight.prototype.setColor = function setColor (r, g, b) {\r\n  color3.set(this._color, r, g, b);\r\n  this._colorUniform[0] = r * this._intensity;\r\n  this._colorUniform[1] = g * this._intensity;\r\n  this._colorUniform[2] = b * this._intensity;\r\n};\r\nprototypeAccessors$4.color.get = function () {\r\n  return this._color;\r\n};\r\n\r\nLight.prototype.setIntensity = function setIntensity (val) {\r\n  this._intensity = val;\r\n  this._colorUniform[0] = val * this._color.r;\r\n  this._colorUniform[1] = val * this._color.g;\r\n  this._colorUniform[2] = val * this._color.b;\r\n};\r\nprototypeAccessors$4.intensity.get = function () {\r\n  return this._intensity;\r\n};\r\n\r\nLight.prototype.setType = function setType (tpe) {\r\n  this._type = tpe;\r\n};\r\nprototypeAccessors$4.type.get = function () {\r\n  return this._type;\r\n};\r\n\r\nLight.prototype.setSpotAngle = function setSpotAngle (val) {\r\n  this._spotAngle = val;\r\n  this._spotUniform[0] = Math.cos(this._spotAngle * 0.5);\r\n};\r\nprototypeAccessors$4.spotAngle.get = function () {\r\n  return this._spotAngle;\r\n};\r\n\r\nLight.prototype.setSpotExp = function setSpotExp (val) {\r\n  this._spotExp = val;\r\n  this._spotUniform[1] = val;\r\n};\r\nprototypeAccessors$4.spotExp.get = function () {\r\n  return this._spotExp;\r\n};\r\n\r\nLight.prototype.setRange = function setRange (tpe) {\r\n  this._range = tpe;\r\n};\r\nprototypeAccessors$4.range.get = function () {\r\n  return this._range;\r\n};\r\n\r\nLight.prototype.setShadowType = function setShadowType (type) {\r\n  if (this._shadowType === enums.SHADOW_NONE && type !== enums.SHADOW_NONE) {\r\n    this._shadowMapDirty = true;\r\n  }\r\n  this._shadowType = type;\r\n};\r\nprototypeAccessors$4.shadowType.get = function () {\r\n  return this._shadowType;\r\n};\r\n\r\nprototypeAccessors$4.shadowMap.get = function () {\r\n  return this._shadowMap;\r\n};\r\n\r\nprototypeAccessors$4.viewProjMatrix.get = function () {\r\n  return this._viewProjMatrix;\r\n};\r\n\r\nLight.prototype.setShadowResolution = function setShadowResolution (val) {\r\n  if (this._shadowResolution !== val) {\r\n    this._shadowMapDirty = true;\r\n  }\r\n  this._shadowResolution = val;\r\n};\r\nprototypeAccessors$4.shadowResolution.get = function () {\r\n  return this._shadowResolution;\r\n};\r\n\r\nLight.prototype.setShadowBias = function setShadowBias (val) {\r\n  this._shadowBias = val;\r\n};\r\nprototypeAccessors$4.shadowBias.get = function () {\r\n  return this._shadowBias;\r\n};\r\n\r\nLight.prototype.setShadowDarkness = function setShadowDarkness (val) {\r\n  this._shadowDarkness = val;\r\n};\r\nprototypeAccessors$4.shadowDarkness.get = function () {\r\n  return this._shadowDarkness;\r\n};\r\n\r\nLight.prototype.setShadowMinDepth = function setShadowMinDepth (val) {\r\n  this._shadowMinDepth = val;\r\n};\r\nprototypeAccessors$4.shadowMinDepth.get = function () {\r\n  if (this._type === enums.LIGHT_DIRECTIONAL) {\r\n    return 1.0;\r\n  }\r\n  return this._shadowMinDepth;\r\n};\r\n\r\nLight.prototype.setShadowMaxDepth = function setShadowMaxDepth (val) {\r\n  this._shadowMaxDepth = val;\r\n};\r\nprototypeAccessors$4.shadowMaxDepth.get = function () {\r\n  if (this._type === enums.LIGHT_DIRECTIONAL) {\r\n    return 1.0;\r\n  }\r\n  return this._shadowMaxDepth;\r\n};\r\n\r\nLight.prototype.setShadowDepthScale = function setShadowDepthScale (val) {\r\n  this._shadowDepthScale = val;\r\n};\r\nprototypeAccessors$4.shadowDepthScale.get = function () {\r\n  return this._shadowDepthScale;\r\n};\r\n\r\nLight.prototype.setFrustumEdgeFalloff = function setFrustumEdgeFalloff (val) {\r\n  this._frustumEdgeFalloff = val;\r\n};\r\nprototypeAccessors$4.frustumEdgeFalloff.get = function () {\r\n  return this._frustumEdgeFalloff;\r\n};\r\n\r\nLight.prototype.extractView = function extractView (out, stages) {\r\n  // TODO: view should not handle light.\r\n  out._shadowLight = this;\r\n\r\n  // rect\r\n  out._rect.x = 0;\r\n  out._rect.y = 0;\r\n  out._rect.w = this._shadowResolution;\r\n  out._rect.h = this._shadowResolution;\r\n\r\n  // clear opts\r\n  color4.set(out._color, 1, 1, 1, 1);\r\n  out._depth = 1;\r\n  out._stencil = 0;\r\n  out._clearFlags = enums.CLEAR_COLOR | enums.CLEAR_DEPTH;\r\n\r\n  // stages & framebuffer\r\n  out._stages = stages;\r\n  out._framebuffer = this._shadowFrameBuffer;\r\n\r\n  // view projection matrix\r\n  switch(this._type) {\r\n    case enums.LIGHT_SPOT:\r\n      _computeSpotLightViewProjMatrix(this, out._matView, out._matProj);\r\n      break;\r\n\r\n    case enums.LIGHT_DIRECTIONAL:\r\n      _computeDirectionalLightViewProjMatrix(this, out._matView, out._matProj);\r\n      break;\r\n\r\n    case enums.LIGHT_POINT:\r\n      _computePointLightViewProjMatrix(this, out._matView, out._matProj);\r\n      break;\r\n\r\n    default:\r\n      console.warn('shadow of this light type is not supported');\r\n  }\r\n\r\n  // view-projection\r\n  mat4.mul(out._matViewProj, out._matProj, out._matView);\r\n  this._viewProjMatrix = out._matViewProj;\r\n  mat4.invert(out._matInvViewProj, out._matViewProj);\r\n};\r\n\r\nLight.prototype._updateLightPositionAndDirection = function _updateLightPositionAndDirection () {\r\n  this._node.getWorldMatrix(_m4_tmp$1);\r\n  mat3.fromMat4(_m3_tmp, _m4_tmp$1);\r\n  vec3.transformMat3(_transformedLightDirection, _forward, _m3_tmp);\r\n  vec3.array(this._directionUniform, _transformedLightDirection);\r\n  var pos = this._positionUniform;\r\n  pos[0] = _m4_tmp$1.m12;\r\n  pos[1] = _m4_tmp$1.m13;\r\n  pos[2] = _m4_tmp$1.m14;\r\n};\r\n\r\nLight.prototype._generateShadowMap = function _generateShadowMap (device) {\r\n  this._shadowMap = new gfx.Texture2D(device, {\r\n    width: this._shadowResolution,\r\n    height: this._shadowResolution,\r\n    format: gfx.TEXTURE_FMT_RGBA8,\r\n    wrapS: gfx.WRAP_CLAMP,\r\n    wrapT: gfx.WRAP_CLAMP,\r\n  });\r\n  this._shadowDepthBuffer = new gfx.RenderBuffer(device,\r\n    gfx.RB_FMT_D16,\r\n    this._shadowResolution,\r\n    this._shadowResolution\r\n  );\r\n  this._shadowFrameBuffer = new gfx.FrameBuffer(device, this._shadowResolution, this._shadowResolution, {\r\n    colors: [this._shadowMap],\r\n    depth: this._shadowDepthBuffer,\r\n  });\r\n};\r\n\r\nLight.prototype._destroyShadowMap = function _destroyShadowMap () {\r\n  if (this._shadowMap) {\r\n    this._shadowMap.destroy();\r\n    this._shadowDepthBuffer.destroy();\r\n    this._shadowFrameBuffer.destroy();\r\n    this._shadowMap = null;\r\n    this._shadowDepthBuffer = null;\r\n    this._shadowFrameBuffer = null;\r\n  }\r\n};\r\n\r\nLight.prototype.update = function update (device) {\r\n  this._updateLightPositionAndDirection();\r\n\r\n  if (this._shadowType === enums.SHADOW_NONE) {\r\n    this._destroyShadowMap();\r\n  } else if (this._shadowMapDirty) {\r\n    this._destroyShadowMap();\r\n    this._generateShadowMap(device);\r\n    this._shadowMapDirty = false;\r\n  }\r\n\r\n};\r\n\r\nObject.defineProperties( Light.prototype, prototypeAccessors$4 );\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar _matView = mat4.create();\r\nvar _matProj = mat4.create();\r\nvar _matViewProj = mat4.create();\r\nvar _matInvViewProj = mat4.create();\r\nvar _tmp_v3 = vec3.create();\r\n\r\nvar Camera = function Camera() {\r\n  this._poolID = -1;\r\n  this._node = null;\r\n\r\n  //\r\n  this._projection = enums.PROJ_PERSPECTIVE;\r\n\r\n  // clear options\r\n  this._color = color4.new(0.2, 0.3, 0.47, 1);\r\n  this._depth = 1;\r\n  this._stencil = 0;\r\n  this._sortDepth = 0;\r\n  this._clearFlags = enums.CLEAR_COLOR | enums.CLEAR_DEPTH;\r\n\r\n  // culling mask\r\n  this._cullingMask = 1;\r\n\r\n  // stages & framebuffer\r\n  this._stages = [];\r\n  this._framebuffer = null;\r\n\r\n  // projection properties\r\n  this._near = 0.01;\r\n  this._far = 1000.0;\r\n  this._fov = Math.PI/4.0; // vertical fov\r\n  // this._aspect = 16.0/9.0; // DISABLE: use _rect.w/_rect.h\r\n  this._rect = {\r\n    x: 0, y: 0, w: 1, h: 1\r\n  };\r\n\r\n  // ortho properties\r\n  this._orthoHeight = 10;\r\n};\r\n\r\nvar prototypeAccessors$5 = { cullingMask: { configurable: true } };\r\n\r\n// culling mask\r\nprototypeAccessors$5.cullingMask.get = function () {\r\n  return this._cullingMask;\r\n};\r\n\r\nprototypeAccessors$5.cullingMask.set = function (mask) {\r\n  this._cullingMask = mask;\r\n};\r\n\r\n// node\r\nCamera.prototype.getNode = function getNode () {\r\n  return this._node;\r\n};\r\nCamera.prototype.setNode = function setNode (node) {\r\n  this._node = node;\r\n};\r\n\r\n// type\r\nCamera.prototype.getType = function getType () {\r\n  return this._projection;\r\n};\r\nCamera.prototype.setType = function setType (type) {\r\n  this._projection = type;\r\n};\r\n\r\n// orthoHeight\r\nCamera.prototype.getOrthoHeight = function getOrthoHeight () {\r\n  return this._orthoHeight;\r\n};\r\nCamera.prototype.setOrthoHeight = function setOrthoHeight (val) {\r\n  this._orthoHeight = val;\r\n};\r\n\r\n// fov\r\nCamera.prototype.getFov = function getFov () {\r\n  return this._fov;\r\n};\r\nCamera.prototype.setFov = function setFov (fov) {\r\n  this._fov = fov;\r\n};\r\n\r\n// near\r\nCamera.prototype.getNear = function getNear () {\r\n  return this._near;\r\n};\r\nCamera.prototype.setNear = function setNear (near) {\r\n  this._near = near;\r\n};\r\n\r\n// far\r\nCamera.prototype.getFar = function getFar () {\r\n  return this._far;\r\n};\r\nCamera.prototype.setFar = function setFar (far) {\r\n  this._far = far;\r\n};\r\n\r\n// color\r\nCamera.prototype.getColor = function getColor (out) {\r\n  return color4.copy(out, this._color);\r\n};\r\nCamera.prototype.setColor = function setColor (r, g, b, a) {\r\n  color4.set(this._color, r, g, b, a);\r\n};\r\n\r\n// depth\r\nCamera.prototype.getDepth = function getDepth () {\r\n  return this._depth;\r\n};\r\nCamera.prototype.setDepth = function setDepth (depth) {\r\n  this._depth = depth;\r\n};\r\n\r\n// stencil\r\nCamera.prototype.getStencil = function getStencil () {\r\n  return this._stencil;\r\n};\r\nCamera.prototype.setStencil = function setStencil (stencil) {\r\n  this._stencil = stencil;\r\n};\r\n\r\n// clearFlags\r\nCamera.prototype.getClearFlags = function getClearFlags () {\r\n  return this._clearFlags;\r\n};\r\nCamera.prototype.setClearFlags = function setClearFlags (flags) {\r\n  this._clearFlags = flags;\r\n};\r\n\r\n// rect\r\nCamera.prototype.getRect = function getRect (out) {\r\n  out.x = this._rect.x;\r\n  out.y = this._rect.y;\r\n  out.w = this._rect.w;\r\n  out.h = this._rect.h;\r\n\r\n  return out;\r\n};\r\n/**\r\n * @param {Number} x - [0,1]\r\n * @param {Number} y - [0,1]\r\n * @param {Number} w - [0,1]\r\n * @param {Number} h - [0,1]\r\n */\r\nCamera.prototype.setRect = function setRect (x, y, w, h) {\r\n  this._rect.x = x;\r\n  this._rect.y = y;\r\n  this._rect.w = w;\r\n  this._rect.h = h;\r\n};\r\n\r\n// stages\r\nCamera.prototype.getStages = function getStages () {\r\n  return this._stages;\r\n};\r\nCamera.prototype.setStages = function setStages (stages) {\r\n  this._stages = stages;\r\n};\r\n\r\n// framebuffer\r\nCamera.prototype.getFramebuffer = function getFramebuffer () {\r\n  return this._framebuffer;\r\n};\r\nCamera.prototype.setFramebuffer = function setFramebuffer (framebuffer) {\r\n  this._framebuffer = framebuffer;\r\n};\r\n\r\nCamera.prototype.extractView = function extractView (out, width, height) {\r\n  // rect\r\n  out._rect.x = this._rect.x * width;\r\n  out._rect.y = this._rect.y * height;\r\n  out._rect.w = this._rect.w * width;\r\n  out._rect.h = this._rect.h * height;\r\n\r\n  // clear opts\r\n  out._color = this._color;\r\n  out._depth = this._depth;\r\n  out._stencil = this._stencil;\r\n  out._clearFlags = this._clearFlags;\r\n\r\n  // culling mask\r\n  out._cullingMask = this._cullingMask;\r\n\r\n  // stages & framebuffer\r\n  out._stages = this._stages;\r\n  out._framebuffer = this._framebuffer;\r\n\r\n  // view matrix\r\n  this._node.getWorldRT(out._matView);\r\n  mat4.invert(out._matView, out._matView);\r\n\r\n  // projection matrix\r\n  // TODO: if this._projDirty\r\n  var aspect = width / height;\r\n  if (this._projection === enums.PROJ_PERSPECTIVE) {\r\n    mat4.perspective(out._matProj,\r\n      this._fov,\r\n      aspect,\r\n      this._near,\r\n      this._far\r\n    );\r\n  } else {\r\n    var x = this._orthoHeight * aspect;\r\n    var y = this._orthoHeight;\r\n    mat4.ortho(out._matProj,\r\n      -x, x, -y, y, this._near, this._far\r\n    );\r\n  }\r\n\r\n  // view-projection\r\n  mat4.mul(out._matViewProj, out._matProj, out._matView);\r\n  mat4.invert(out._matInvViewProj, out._matViewProj);\r\n};\r\n\r\nCamera.prototype.screenToWorld = function screenToWorld (out, screenPos, width, height) {\r\n  var aspect = width / height;\r\n  var cx = this._rect.x * width;\r\n  var cy = this._rect.y * height;\r\n  var cw = this._rect.w * width;\r\n  var ch = this._rect.h * height;\r\n\r\n  // view matrix\r\n  this._node.getWorldRT(_matView);\r\n  mat4.invert(_matView, _matView);\r\n\r\n  // projection matrix\r\n  if (this._projection === enums.PROJ_PERSPECTIVE) {\r\n    mat4.perspective(_matProj,\r\n      this._fov,\r\n      aspect,\r\n      this._near,\r\n      this._far\r\n    );\r\n  } else {\r\n    var x = this._orthoHeight * aspect;\r\n    var y = this._orthoHeight;\r\n    mat4.ortho(_matProj,\r\n      -x, x, -y, y, this._near, this._far\r\n    );\r\n  }\r\n\r\n  // view-projection\r\n  mat4.mul(_matViewProj, _matProj, _matView);\r\n\r\n  // inv view-projection\r\n  mat4.invert(_matInvViewProj, _matViewProj);\r\n\r\n  //\r\n  if (this._projection === enums.PROJ_PERSPECTIVE) {\r\n    // calculate screen pos in far clip plane\r\n    vec3.set(out,\r\n      (screenPos.x - cx) * 2.0 / cw - 1.0,\r\n      (screenPos.y - cy) * 2.0 / ch - 1.0, // DISABLE: (ch - (screenPos.y - cy)) * 2.0 / ch - 1.0,\r\n      1.0\r\n    );\r\n\r\n    // transform to world\r\n    vec3.transformMat4(out, out, _matInvViewProj);\r\n\r\n    //\r\n    this._node.getWorldPosition(_tmp_v3);\r\n    vec3.lerp(out, _tmp_v3, out, cc.vmath.lerp(this._near / this._far, 1, screenPos.z));\r\n  } else {\r\n    vec3.set(out,\r\n      (screenPos.x - cx) * 2.0 / cw - 1.0,\r\n      (screenPos.y - cy) * 2.0 / ch - 1.0,\r\n      screenPos.z * 2 - 1\r\n    );\r\n\r\n    // transform to world\r\n    vec3.transformMat4(out, out, _matInvViewProj);\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\nCamera.prototype.worldToScreen = function worldToScreen (out, worldPos, width, height) {\r\n  var aspect = width / height;\r\n  var cx = this._rect.x * width;\r\n  var cy = this._rect.y * height;\r\n  var cw = this._rect.w * width;\r\n  var ch = this._rect.h * height;\r\n\r\n  // view matrix\r\n  this._node.getWorldRT(_matView);\r\n  mat4.invert(_matView, _matView);\r\n\r\n  // projection matrix\r\n  if (this._projection === enums.PROJ_PERSPECTIVE) {\r\n    mat4.perspective(_matProj,\r\n      this._fov,\r\n      aspect,\r\n      this._near,\r\n      this._far\r\n    );\r\n  } else {\r\n    var x = this._orthoHeight * aspect;\r\n    var y = this._orthoHeight;\r\n    mat4.ortho(_matProj,\r\n      -x, x, -y, y, this._near, this._far\r\n    );\r\n  }\r\n\r\n  // view-projection\r\n  mat4.mul(_matViewProj, _matProj, _matView);\r\n\r\n  vec3.transformMat4(out, worldPos, _matViewProj);\r\n  out.x = cx + (out.x + 1) * 0.5 * cw;\r\n  out.y = cy + (out.y + 1) * 0.5 * ch;\r\n  out.z = out.z * 0.5 + 0.5;\r\n\r\n  return out;\r\n};\r\n\r\nObject.defineProperties( Camera.prototype, prototypeAccessors$5 );\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar Model = function Model() {\r\n  this._poolID = -1;\r\n  this._node = null;\r\n  this._inputAssemblers = [];\r\n  this._effects = [];\r\n  this._defines = [];\r\n  this._dynamicIA = false;\r\n  this._cullingMask = -1;\r\n\r\n  // TODO: we calculate aabb based on vertices\r\n  // this._aabb\r\n};\r\n\r\nvar prototypeAccessors$6 = { inputAssemblerCount: { configurable: true },dynamicIA: { configurable: true },drawItemCount: { configurable: true },cullingMask: { configurable: true } };\r\n\r\nprototypeAccessors$6.inputAssemblerCount.get = function () {\r\n  return this._inputAssemblers.length;\r\n};\r\n\r\nprototypeAccessors$6.dynamicIA.get = function () {\r\n  return this._dynamicIA;\r\n};\r\n\r\nprototypeAccessors$6.drawItemCount.get = function () {\r\n  return this._dynamicIA ? 1 : this._inputAssemblers.length;\r\n};\r\n\r\nprototypeAccessors$6.cullingMask.get = function () {\r\n  return this._cullingMask;\r\n};\r\n\r\nprototypeAccessors$6.cullingMask.set = function (mask) {\r\n  this._cullingMask = mask;\r\n};\r\n\r\nModel.prototype.setNode = function setNode (node) {\r\n  this._node = node;\r\n};\r\n\r\nModel.prototype.setDynamicIA = function setDynamicIA (enabled) {\r\n  this._dynamicIA = enabled;\r\n};\r\n\r\nModel.prototype.addInputAssembler = function addInputAssembler (ia) {\r\n  if (this._inputAssemblers.indexOf(ia) !== -1) {\r\n    return;\r\n  }\r\n  this._inputAssemblers.push(ia);\r\n};\r\n\r\nModel.prototype.clearInputAssemblers = function clearInputAssemblers () {\r\n  this._inputAssemblers.length = 0;\r\n};\r\n\r\nModel.prototype.addEffect = function addEffect (effect) {\r\n  if (this._effects.indexOf(effect) !== -1) {\r\n    return;\r\n  }\r\n  this._effects.push(effect);\r\n\r\n  //\r\n  var defs = Object.create(null);\r\n  effect.extractDefines(defs);\r\n  this._defines.push(defs);\r\n};\r\n\r\nModel.prototype.clearEffects = function clearEffects () {\r\n  this._effects.length = 0;\r\n  this._defines.length = 0;\r\n};\r\n\r\nModel.prototype.extractDrawItem = function extractDrawItem (out, index) {\r\n  if (this._dynamicIA) {\r\n    out.model = this;\r\n    out.node = this._node;\r\n    out.ia = null;\r\n    out.effect = this._effects[0];\r\n    out.defines = out.effect.extractDefines(this._defines[0]);\r\n\r\n    return;\r\n  }\r\n\r\n  if (index >= this._inputAssemblers.length ) {\r\n    out.model = null;\r\n    out.node = null;\r\n    out.ia = null;\r\n    out.effect = null;\r\n    out.defines = null;\r\n\r\n    return;\r\n  }\r\n\r\n  out.model = this;\r\n  out.node = this._node;\r\n  out.ia = this._inputAssemblers[index];\r\n\r\n  var effect, defines;\r\n  if (index < this._effects.length) {\r\n    effect = this._effects[index];\r\n    defines = this._defines[index];\r\n  } else {\r\n    effect = this._effects[this._effects.length-1];\r\n    defines = this._defines[this._effects.length-1];\r\n  }\r\n  out.effect = effect;\r\n  out.defines = effect.extractDefines(defines);\r\n};\r\n\r\nObject.defineProperties( Model.prototype, prototypeAccessors$6 );\r\n\r\n// reference: https://github.com/mziccard/node-timsort\r\n\r\n/**\r\n * Default minimum size of a run.\r\n */\r\nvar DEFAULT_MIN_MERGE = 32;\r\n\r\n/**\r\n * Minimum ordered subsequece required to do galloping.\r\n */\r\nvar DEFAULT_MIN_GALLOPING = 7;\r\n\r\n/**\r\n * Default tmp storage length. Can increase depending on the size of the\r\n * smallest run to merge.\r\n */\r\nvar DEFAULT_TMP_STORAGE_LENGTH = 256;\r\n\r\n/**\r\n * Pre-computed powers of 10 for efficient lexicographic comparison of\r\n * small integers.\r\n */\r\nvar POWERS_OF_TEN = [1e0, 1e1, 1e2, 1e3, 1e4, 1e5, 1e6, 1e7, 1e8, 1e9];\r\n\r\n/**\r\n * Estimate the logarithm base 10 of a small integer.\r\n *\r\n * @param {number} x - The integer to estimate the logarithm of.\r\n * @return {number} - The estimated logarithm of the integer.\r\n */\r\nfunction log10$1(x) {\r\n  if (x < 1e5) {\r\n    if (x < 1e2) {\r\n      return x < 1e1 ? 0 : 1;\r\n    }\r\n\r\n    if (x < 1e4) {\r\n      return x < 1e3 ? 2 : 3;\r\n    }\r\n\r\n    return 4;\r\n  }\r\n\r\n  if (x < 1e7) {\r\n    return x < 1e6 ? 5 : 6;\r\n  }\r\n\r\n  if (x < 1e9) {\r\n    return x < 1e8 ? 7 : 8;\r\n  }\r\n\r\n  return 9;\r\n}\r\n\r\n/**\r\n * Default alphabetical comparison of items.\r\n *\r\n * @param {string|object|number} a - First element to compare.\r\n * @param {string|object|number} b - Second element to compare.\r\n * @return {number} - A positive number if a.toString() > b.toString(), a\r\n * negative number if .toString() < b.toString(), 0 otherwise.\r\n */\r\nfunction alphabeticalCompare(a, b) {\r\n  if (a === b) {\r\n    return 0;\r\n  }\r\n\r\n  if (~~a === a && ~~b === b) {\r\n    if (a === 0 || b === 0) {\r\n      return a < b ? -1 : 1;\r\n    }\r\n\r\n    if (a < 0 || b < 0) {\r\n      if (b >= 0) {\r\n        return -1;\r\n      }\r\n\r\n      if (a >= 0) {\r\n        return 1;\r\n      }\r\n\r\n      a = -a;\r\n      b = -b;\r\n    }\r\n\r\n    var al = log10$1(a);\r\n    var bl = log10$1(b);\r\n\r\n    var t = 0;\r\n\r\n    if (al < bl) {\r\n      a *= POWERS_OF_TEN[bl - al - 1];\r\n      b /= 10;\r\n      t = -1;\r\n    } else if (al > bl) {\r\n      b *= POWERS_OF_TEN[al - bl - 1];\r\n      a /= 10;\r\n      t = 1;\r\n    }\r\n\r\n    if (a === b) {\r\n      return t;\r\n    }\r\n\r\n    return a < b ? -1 : 1;\r\n  }\r\n\r\n  var aStr = String(a);\r\n  var bStr = String(b);\r\n\r\n  if (aStr === bStr) {\r\n    return 0;\r\n  }\r\n\r\n  return aStr < bStr ? -1 : 1;\r\n}\r\n\r\n/**\r\n * Compute minimum run length for TimSort\r\n *\r\n * @param {number} n - The size of the array to sort.\r\n */\r\nfunction minRunLength(n) {\r\n  var r = 0;\r\n\r\n  while (n >= DEFAULT_MIN_MERGE) {\r\n    r |= (n & 1);\r\n    n >>= 1;\r\n  }\r\n\r\n  return n + r;\r\n}\r\n\r\n/**\r\n * Counts the length of a monotonically ascending or strictly monotonically\r\n * descending sequence (run) starting at array[lo] in the range [lo, hi). If\r\n * the run is descending it is made ascending.\r\n *\r\n * @param {array} array - The array to reverse.\r\n * @param {number} lo - First element in the range (inclusive).\r\n * @param {number} hi - Last element in the range.\r\n * @param {function} compare - Item comparison function.\r\n * @return {number} - The length of the run.\r\n */\r\nfunction makeAscendingRun(array, lo, hi, compare) {\r\n  var runHi = lo + 1;\r\n\r\n  if (runHi === hi) {\r\n    return 1;\r\n  }\r\n\r\n  // Descending\r\n  if (compare(array[runHi++], array[lo]) < 0) {\r\n    while (runHi < hi && compare(array[runHi], array[runHi - 1]) < 0) {\r\n      runHi++;\r\n    }\r\n\r\n    reverseRun(array, lo, runHi);\r\n    // Ascending\r\n  } else {\r\n    while (runHi < hi && compare(array[runHi], array[runHi - 1]) >= 0) {\r\n      runHi++;\r\n    }\r\n  }\r\n\r\n  return runHi - lo;\r\n}\r\n\r\n/**\r\n * Reverse an array in the range [lo, hi).\r\n *\r\n * @param {array} array - The array to reverse.\r\n * @param {number} lo - First element in the range (inclusive).\r\n * @param {number} hi - Last element in the range.\r\n */\r\nfunction reverseRun(array, lo, hi) {\r\n  hi--;\r\n\r\n  while (lo < hi) {\r\n    var t = array[lo];\r\n    array[lo++] = array[hi];\r\n    array[hi--] = t;\r\n  }\r\n}\r\n\r\n/**\r\n * Perform the binary sort of the array in the range [lo, hi) where start is\r\n * the first element possibly out of order.\r\n *\r\n * @param {array} array - The array to sort.\r\n * @param {number} lo - First element in the range (inclusive).\r\n * @param {number} hi - Last element in the range.\r\n * @param {number} start - First element possibly out of order.\r\n * @param {function} compare - Item comparison function.\r\n */\r\nfunction binaryInsertionSort(array, lo, hi, start, compare) {\r\n  if (start === lo) {\r\n    start++;\r\n  }\r\n\r\n  for (; start < hi; start++) {\r\n    var pivot = array[start];\r\n\r\n    // Ranges of the array where pivot belongs\r\n    var left = lo;\r\n    var right = start;\r\n\r\n    /*\r\n     *   pivot >= array[i] for i in [lo, left)\r\n     *   pivot <  array[i] for i in  in [right, start)\r\n     */\r\n    while (left < right) {\r\n      var mid = (left + right) >>> 1;\r\n\r\n      if (compare(pivot, array[mid]) < 0) {\r\n        right = mid;\r\n      } else {\r\n        left = mid + 1;\r\n      }\r\n    }\r\n\r\n    /*\r\n     * Move elements right to make room for the pivot. If there are elements\r\n     * equal to pivot, left points to the first slot after them: this is also\r\n     * a reason for which TimSort is stable\r\n     */\r\n    var n = start - left;\r\n    // Switch is just an optimization for small arrays\r\n    switch (n) {\r\n      case 3:\r\n        array[left + 3] = array[left + 2];\r\n      /* falls through */\r\n      case 2:\r\n        array[left + 2] = array[left + 1];\r\n      /* falls through */\r\n      case 1:\r\n        array[left + 1] = array[left];\r\n        break;\r\n      default:\r\n        while (n > 0) {\r\n          array[left + n] = array[left + n - 1];\r\n          n--;\r\n        }\r\n    }\r\n\r\n    array[left] = pivot;\r\n  }\r\n}\r\n\r\n/**\r\n * Find the position at which to insert a value in a sorted range. If the range\r\n * contains elements equal to the value the leftmost element index is returned\r\n * (for stability).\r\n *\r\n * @param {number} value - Value to insert.\r\n * @param {array} array - The array in which to insert value.\r\n * @param {number} start - First element in the range.\r\n * @param {number} length - Length of the range.\r\n * @param {number} hint - The index at which to begin the search.\r\n * @param {function} compare - Item comparison function.\r\n * @return {number} - The index where to insert value.\r\n */\r\nfunction gallopLeft(value, array, start, length, hint, compare) {\r\n  var lastOffset = 0;\r\n  var maxOffset = 0;\r\n  var offset = 1;\r\n\r\n  if (compare(value, array[start + hint]) > 0) {\r\n    maxOffset = length - hint;\r\n\r\n    while (offset < maxOffset && compare(value, array[start + hint + offset]) > 0) {\r\n      lastOffset = offset;\r\n      offset = (offset << 1) + 1;\r\n\r\n      if (offset <= 0) {\r\n        offset = maxOffset;\r\n      }\r\n    }\r\n\r\n    if (offset > maxOffset) {\r\n      offset = maxOffset;\r\n    }\r\n\r\n    // Make offsets relative to start\r\n    lastOffset += hint;\r\n    offset += hint;\r\n\r\n    // value <= array[start + hint]\r\n  } else {\r\n    maxOffset = hint + 1;\r\n    while (offset < maxOffset && compare(value, array[start + hint - offset]) <= 0) {\r\n      lastOffset = offset;\r\n      offset = (offset << 1) + 1;\r\n\r\n      if (offset <= 0) {\r\n        offset = maxOffset;\r\n      }\r\n    }\r\n    if (offset > maxOffset) {\r\n      offset = maxOffset;\r\n    }\r\n\r\n    // Make offsets relative to start\r\n    var tmp = lastOffset;\r\n    lastOffset = hint - offset;\r\n    offset = hint - tmp;\r\n  }\r\n\r\n  /*\r\n   * Now array[start+lastOffset] < value <= array[start+offset], so value\r\n   * belongs somewhere in the range (start + lastOffset, start + offset]. Do a\r\n   * binary search, with invariant array[start + lastOffset - 1] < value <=\r\n   * array[start + offset].\r\n   */\r\n  lastOffset++;\r\n  while (lastOffset < offset) {\r\n    var m = lastOffset + ((offset - lastOffset) >>> 1);\r\n\r\n    if (compare(value, array[start + m]) > 0) {\r\n      lastOffset = m + 1;\r\n\r\n    } else {\r\n      offset = m;\r\n    }\r\n  }\r\n  return offset;\r\n}\r\n\r\n/**\r\n * Find the position at which to insert a value in a sorted range. If the range\r\n * contains elements equal to the value the rightmost element index is returned\r\n * (for stability).\r\n *\r\n * @param {number} value - Value to insert.\r\n * @param {array} array - The array in which to insert value.\r\n * @param {number} start - First element in the range.\r\n * @param {number} length - Length of the range.\r\n * @param {number} hint - The index at which to begin the search.\r\n * @param {function} compare - Item comparison function.\r\n * @return {number} - The index where to insert value.\r\n */\r\nfunction gallopRight(value, array, start, length, hint, compare) {\r\n  var lastOffset = 0;\r\n  var maxOffset = 0;\r\n  var offset = 1;\r\n\r\n  if (compare(value, array[start + hint]) < 0) {\r\n    maxOffset = hint + 1;\r\n\r\n    while (offset < maxOffset && compare(value, array[start + hint - offset]) < 0) {\r\n      lastOffset = offset;\r\n      offset = (offset << 1) + 1;\r\n\r\n      if (offset <= 0) {\r\n        offset = maxOffset;\r\n      }\r\n    }\r\n\r\n    if (offset > maxOffset) {\r\n      offset = maxOffset;\r\n    }\r\n\r\n    // Make offsets relative to start\r\n    var tmp = lastOffset;\r\n    lastOffset = hint - offset;\r\n    offset = hint - tmp;\r\n\r\n    // value >= array[start + hint]\r\n  } else {\r\n    maxOffset = length - hint;\r\n\r\n    while (offset < maxOffset && compare(value, array[start + hint + offset]) >= 0) {\r\n      lastOffset = offset;\r\n      offset = (offset << 1) + 1;\r\n\r\n      if (offset <= 0) {\r\n        offset = maxOffset;\r\n      }\r\n    }\r\n\r\n    if (offset > maxOffset) {\r\n      offset = maxOffset;\r\n    }\r\n\r\n    // Make offsets relative to start\r\n    lastOffset += hint;\r\n    offset += hint;\r\n  }\r\n\r\n  /*\r\n   * Now array[start+lastOffset] < value <= array[start+offset], so value\r\n   * belongs somewhere in the range (start + lastOffset, start + offset]. Do a\r\n   * binary search, with invariant array[start + lastOffset - 1] < value <=\r\n   * array[start + offset].\r\n   */\r\n  lastOffset++;\r\n\r\n  while (lastOffset < offset) {\r\n    var m = lastOffset + ((offset - lastOffset) >>> 1);\r\n\r\n    if (compare(value, array[start + m]) < 0) {\r\n      offset = m;\r\n\r\n    } else {\r\n      lastOffset = m + 1;\r\n    }\r\n  }\r\n\r\n  return offset;\r\n}\r\n\r\nvar TimSort = function TimSort(array, compare) {\r\n  this.array = array;\r\n  this.compare = compare;\r\n  this.minGallop = DEFAULT_MIN_GALLOPING;\r\n  this.length = array.length;\r\n\r\n  this.tmpStorageLength = DEFAULT_TMP_STORAGE_LENGTH;\r\n  if (this.length < 2 * DEFAULT_TMP_STORAGE_LENGTH) {\r\n    this.tmpStorageLength = this.length >>> 1;\r\n  }\r\n\r\n  this.tmp = new Array(this.tmpStorageLength);\r\n\r\n  this.stackLength =\r\n    (this.length < 120 ? 5 :\r\n      this.length < 1542 ? 10 :\r\n        this.length < 119151 ? 19 : 40);\r\n\r\n  this.runStart = new Array(this.stackLength);\r\n  this.runLength = new Array(this.stackLength);\r\n  this.stackSize = 0;\r\n};\r\n\r\n/**\r\n * Push a new run on TimSort's stack.\r\n *\r\n * @param {number} runStart - Start index of the run in the original array.\r\n * @param {number} runLength - Length of the run;\r\n */\r\nTimSort.prototype.pushRun = function pushRun (runStart, runLength) {\r\n  this.runStart[this.stackSize] = runStart;\r\n  this.runLength[this.stackSize] = runLength;\r\n  this.stackSize += 1;\r\n};\r\n\r\n/**\r\n * Merge runs on TimSort's stack so that the following holds for all i:\r\n * 1) runLength[i - 3] > runLength[i - 2] + runLength[i - 1]\r\n * 2) runLength[i - 2] > runLength[i - 1]\r\n */\r\nTimSort.prototype.mergeRuns = function mergeRuns () {\r\n    var this$1 = this;\r\n\r\n  while (this.stackSize > 1) {\r\n    var n = this$1.stackSize - 2;\r\n\r\n    if ((n >= 1 &&\r\n      this$1.runLength[n - 1] <= this$1.runLength[n] + this$1.runLength[n + 1]) ||\r\n      (n >= 2 &&\r\n      this$1.runLength[n - 2] <= this$1.runLength[n] + this$1.runLength[n - 1])) {\r\n\r\n      if (this$1.runLength[n - 1] < this$1.runLength[n + 1]) {\r\n        n--;\r\n      }\r\n\r\n    } else if (this$1.runLength[n] > this$1.runLength[n + 1]) {\r\n      break;\r\n    }\r\n    this$1.mergeAt(n);\r\n  }\r\n};\r\n\r\n/**\r\n * Merge all runs on TimSort's stack until only one remains.\r\n */\r\nTimSort.prototype.forceMergeRuns = function forceMergeRuns () {\r\n    var this$1 = this;\r\n\r\n  while (this.stackSize > 1) {\r\n    var n = this$1.stackSize - 2;\r\n\r\n    if (n > 0 && this$1.runLength[n - 1] < this$1.runLength[n + 1]) {\r\n      n--;\r\n    }\r\n\r\n    this$1.mergeAt(n);\r\n  }\r\n};\r\n\r\n/**\r\n * Merge the runs on the stack at positions i and i+1. Must be always be called\r\n * with i=stackSize-2 or i=stackSize-3 (that is, we merge on top of the stack).\r\n *\r\n * @param {number} i - Index of the run to merge in TimSort's stack.\r\n */\r\nTimSort.prototype.mergeAt = function mergeAt (i) {\r\n  var compare = this.compare;\r\n  var array = this.array;\r\n\r\n  var start1 = this.runStart[i];\r\n  var length1 = this.runLength[i];\r\n  var start2 = this.runStart[i + 1];\r\n  var length2 = this.runLength[i + 1];\r\n\r\n  this.runLength[i] = length1 + length2;\r\n\r\n  if (i === this.stackSize - 3) {\r\n    this.runStart[i + 1] = this.runStart[i + 2];\r\n    this.runLength[i + 1] = this.runLength[i + 2];\r\n  }\r\n\r\n  this.stackSize--;\r\n\r\n  /*\r\n   * Find where the first element in the second run goes in run1. Previous\r\n   * elements in run1 are already in place\r\n   */\r\n  var k = gallopRight(array[start2], array, start1, length1, 0, compare);\r\n  start1 += k;\r\n  length1 -= k;\r\n\r\n  if (length1 === 0) {\r\n    return;\r\n  }\r\n\r\n  /*\r\n   * Find where the last element in the first run goes in run2. Next elements\r\n   * in run2 are already in place\r\n   */\r\n  length2 = gallopLeft(array[start1 + length1 - 1], array, start2, length2, length2 - 1, compare);\r\n\r\n  if (length2 === 0) {\r\n    return;\r\n  }\r\n\r\n  /*\r\n   * Merge remaining runs. A tmp array with length = min(length1, length2) is\r\n   * used\r\n   */\r\n  if (length1 <= length2) {\r\n    this.mergeLow(start1, length1, start2, length2);\r\n\r\n  } else {\r\n    this.mergeHigh(start1, length1, start2, length2);\r\n  }\r\n};\r\n\r\n/**\r\n * Merge two adjacent runs in a stable way. The runs must be such that the\r\n * first element of run1 is bigger than the first element in run2 and the\r\n * last element of run1 is greater than all the elements in run2.\r\n * The method should be called when run1.length <= run2.length as it uses\r\n * TimSort temporary array to store run1. Use mergeHigh if run1.length >\r\n * run2.length.\r\n *\r\n * @param {number} start1 - First element in run1.\r\n * @param {number} length1 - Length of run1.\r\n * @param {number} start2 - First element in run2.\r\n * @param {number} length2 - Length of run2.\r\n */\r\nTimSort.prototype.mergeLow = function mergeLow (start1, length1, start2, length2) {\r\n\r\n  var compare = this.compare;\r\n  var array = this.array;\r\n  var tmp = this.tmp;\r\n  var i = 0;\r\n\r\n  for (i = 0; i < length1; i++) {\r\n    tmp[i] = array[start1 + i];\r\n  }\r\n\r\n  var cursor1 = 0;\r\n  var cursor2 = start2;\r\n  var dest = start1;\r\n\r\n  array[dest++] = array[cursor2++];\r\n\r\n  if (--length2 === 0) {\r\n    for (i = 0; i < length1; i++) {\r\n      array[dest + i] = tmp[cursor1 + i];\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (length1 === 1) {\r\n    for (i = 0; i < length2; i++) {\r\n      array[dest + i] = array[cursor2 + i];\r\n    }\r\n    array[dest + length2] = tmp[cursor1];\r\n    return;\r\n  }\r\n\r\n  var minGallop = this.minGallop;\r\n\r\n  while (true) {\r\n    var count1 = 0;\r\n    var count2 = 0;\r\n    var exit = false;\r\n\r\n    do {\r\n      if (compare(array[cursor2], tmp[cursor1]) < 0) {\r\n        array[dest++] = array[cursor2++];\r\n        count2++;\r\n        count1 = 0;\r\n\r\n        if (--length2 === 0) {\r\n          exit = true;\r\n          break;\r\n        }\r\n\r\n      } else {\r\n        array[dest++] = tmp[cursor1++];\r\n        count1++;\r\n        count2 = 0;\r\n        if (--length1 === 1) {\r\n          exit = true;\r\n          break;\r\n        }\r\n      }\r\n    } while ((count1 | count2) < minGallop);\r\n\r\n    if (exit) {\r\n      break;\r\n    }\r\n\r\n    do {\r\n      count1 = gallopRight(array[cursor2], tmp, cursor1, length1, 0, compare);\r\n\r\n      if (count1 !== 0) {\r\n        for (i = 0; i < count1; i++) {\r\n          array[dest + i] = tmp[cursor1 + i];\r\n        }\r\n\r\n        dest += count1;\r\n        cursor1 += count1;\r\n        length1 -= count1;\r\n        if (length1 <= 1) {\r\n          exit = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      array[dest++] = array[cursor2++];\r\n\r\n      if (--length2 === 0) {\r\n        exit = true;\r\n        break;\r\n      }\r\n\r\n      count2 = gallopLeft(tmp[cursor1], array, cursor2, length2, 0, compare);\r\n\r\n      if (count2 !== 0) {\r\n        for (i = 0; i < count2; i++) {\r\n          array[dest + i] = array[cursor2 + i];\r\n        }\r\n\r\n        dest += count2;\r\n        cursor2 += count2;\r\n        length2 -= count2;\r\n\r\n        if (length2 === 0) {\r\n          exit = true;\r\n          break;\r\n        }\r\n      }\r\n      array[dest++] = tmp[cursor1++];\r\n\r\n      if (--length1 === 1) {\r\n        exit = true;\r\n        break;\r\n      }\r\n\r\n      minGallop--;\r\n\r\n    } while (count1 >= DEFAULT_MIN_GALLOPING || count2 >= DEFAULT_MIN_GALLOPING);\r\n\r\n    if (exit) {\r\n      break;\r\n    }\r\n\r\n    if (minGallop < 0) {\r\n      minGallop = 0;\r\n    }\r\n\r\n    minGallop += 2;\r\n  }\r\n\r\n  this.minGallop = minGallop;\r\n\r\n  if (minGallop < 1) {\r\n    this.minGallop = 1;\r\n  }\r\n\r\n  if (length1 === 1) {\r\n    for (i = 0; i < length2; i++) {\r\n      array[dest + i] = array[cursor2 + i];\r\n    }\r\n    array[dest + length2] = tmp[cursor1];\r\n\r\n  } else if (length1 === 0) {\r\n    throw new Error('mergeLow preconditions were not respected');\r\n\r\n  } else {\r\n    for (i = 0; i < length1; i++) {\r\n      array[dest + i] = tmp[cursor1 + i];\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Merge two adjacent runs in a stable way. The runs must be such that the\r\n * first element of run1 is bigger than the first element in run2 and the\r\n * last element of run1 is greater than all the elements in run2.\r\n * The method should be called when run1.length > run2.length as it uses\r\n * TimSort temporary array to store run2. Use mergeLow if run1.length <=\r\n * run2.length.\r\n *\r\n * @param {number} start1 - First element in run1.\r\n * @param {number} length1 - Length of run1.\r\n * @param {number} start2 - First element in run2.\r\n * @param {number} length2 - Length of run2.\r\n */\r\nTimSort.prototype.mergeHigh = function mergeHigh (start1, length1, start2, length2) {\r\n  var compare = this.compare;\r\n  var array = this.array;\r\n  var tmp = this.tmp;\r\n  var i = 0;\r\n\r\n  for (i = 0; i < length2; i++) {\r\n    tmp[i] = array[start2 + i];\r\n  }\r\n\r\n  var cursor1 = start1 + length1 - 1;\r\n  var cursor2 = length2 - 1;\r\n  var dest = start2 + length2 - 1;\r\n  var customCursor = 0;\r\n  var customDest = 0;\r\n\r\n  array[dest--] = array[cursor1--];\r\n\r\n  if (--length1 === 0) {\r\n    customCursor = dest - (length2 - 1);\r\n\r\n    for (i = 0; i < length2; i++) {\r\n      array[customCursor + i] = tmp[i];\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if (length2 === 1) {\r\n    dest -= length1;\r\n    cursor1 -= length1;\r\n    customDest = dest + 1;\r\n    customCursor = cursor1 + 1;\r\n\r\n    for (i = length1 - 1; i >= 0; i--) {\r\n      array[customDest + i] = array[customCursor + i];\r\n    }\r\n\r\n    array[dest] = tmp[cursor2];\r\n    return;\r\n  }\r\n\r\n  var minGallop = this.minGallop;\r\n\r\n  while (true) {\r\n    var count1 = 0;\r\n    var count2 = 0;\r\n    var exit = false;\r\n\r\n    do {\r\n      if (compare(tmp[cursor2], array[cursor1]) < 0) {\r\n        array[dest--] = array[cursor1--];\r\n        count1++;\r\n        count2 = 0;\r\n        if (--length1 === 0) {\r\n          exit = true;\r\n          break;\r\n        }\r\n\r\n      } else {\r\n        array[dest--] = tmp[cursor2--];\r\n        count2++;\r\n        count1 = 0;\r\n        if (--length2 === 1) {\r\n          exit = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n    } while ((count1 | count2) < minGallop);\r\n\r\n    if (exit) {\r\n      break;\r\n    }\r\n\r\n    do {\r\n      count1 = length1 - gallopRight(tmp[cursor2], array, start1, length1, length1 - 1, compare);\r\n\r\n      if (count1 !== 0) {\r\n        dest -= count1;\r\n        cursor1 -= count1;\r\n        length1 -= count1;\r\n        customDest = dest + 1;\r\n        customCursor = cursor1 + 1;\r\n\r\n        for (i = count1 - 1; i >= 0; i--) {\r\n          array[customDest + i] = array[customCursor + i];\r\n        }\r\n\r\n        if (length1 === 0) {\r\n          exit = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      array[dest--] = tmp[cursor2--];\r\n\r\n      if (--length2 === 1) {\r\n        exit = true;\r\n        break;\r\n      }\r\n\r\n      count2 = length2 - gallopLeft(array[cursor1], tmp, 0, length2, length2 - 1, compare);\r\n\r\n      if (count2 !== 0) {\r\n        dest -= count2;\r\n        cursor2 -= count2;\r\n        length2 -= count2;\r\n        customDest = dest + 1;\r\n        customCursor = cursor2 + 1;\r\n\r\n        for (i = 0; i < count2; i++) {\r\n          array[customDest + i] = tmp[customCursor + i];\r\n        }\r\n\r\n        if (length2 <= 1) {\r\n          exit = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      array[dest--] = array[cursor1--];\r\n\r\n      if (--length1 === 0) {\r\n        exit = true;\r\n        break;\r\n      }\r\n\r\n      minGallop--;\r\n\r\n    } while (count1 >= DEFAULT_MIN_GALLOPING || count2 >= DEFAULT_MIN_GALLOPING);\r\n\r\n    if (exit) {\r\n      break;\r\n    }\r\n\r\n    if (minGallop < 0) {\r\n      minGallop = 0;\r\n    }\r\n\r\n    minGallop += 2;\r\n  }\r\n\r\n  this.minGallop = minGallop;\r\n\r\n  if (minGallop < 1) {\r\n    this.minGallop = 1;\r\n  }\r\n\r\n  if (length2 === 1) {\r\n    dest -= length1;\r\n    cursor1 -= length1;\r\n    customDest = dest + 1;\r\n    customCursor = cursor1 + 1;\r\n\r\n    for (i = length1 - 1; i >= 0; i--) {\r\n      array[customDest + i] = array[customCursor + i];\r\n    }\r\n\r\n    array[dest] = tmp[cursor2];\r\n\r\n  } else if (length2 === 0) {\r\n    throw new Error('mergeHigh preconditions were not respected');\r\n\r\n  } else {\r\n    customCursor = dest - (length2 - 1);\r\n    for (i = 0; i < length2; i++) {\r\n      array[customCursor + i] = tmp[i];\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Sort an array in the range [lo, hi) using TimSort.\r\n *\r\n * @param {array} array - The array to sort.\r\n * @param {number} lo - First element in the range (inclusive).\r\n * @param {number} hi - Last element in the range.\r\n * @param {function=} compare - Item comparison function. Default is alphabetical.\r\n */\r\nfunction sort (array, lo, hi, compare) {\r\n  if (!Array.isArray(array)) {\r\n    throw new TypeError('Can only sort arrays');\r\n  }\r\n\r\n  /*\r\n   * Handle the case where a comparison function is not provided. We do\r\n   * lexicographic sorting\r\n   */\r\n\r\n  if (lo === undefined) {\r\n    lo = 0;\r\n  }\r\n\r\n  if (hi === undefined) {\r\n    hi = array.length;\r\n  }\r\n\r\n  if (compare === undefined) {\r\n    compare = alphabeticalCompare;\r\n  }\r\n\r\n  var remaining = hi - lo;\r\n\r\n  // The array is already sorted\r\n  if (remaining < 2) {\r\n    return;\r\n  }\r\n\r\n  var runLength = 0;\r\n  // On small arrays binary sort can be used directly\r\n  if (remaining < DEFAULT_MIN_MERGE) {\r\n    runLength = makeAscendingRun(array, lo, hi, compare);\r\n    binaryInsertionSort(array, lo, hi, lo + runLength, compare);\r\n    return;\r\n  }\r\n\r\n  var ts = new TimSort(array, compare);\r\n\r\n  var minRun = minRunLength(remaining);\r\n\r\n  do {\r\n    runLength = makeAscendingRun(array, lo, hi, compare);\r\n    if (runLength < minRun) {\r\n      var force = remaining;\r\n      if (force > minRun) {\r\n        force = minRun;\r\n      }\r\n\r\n      binaryInsertionSort(array, lo, lo + force, lo + runLength, compare);\r\n      runLength = force;\r\n    }\r\n    // Push new run and merge if necessary\r\n    ts.pushRun(lo, runLength);\r\n    ts.mergeRuns();\r\n\r\n    // Go find next run\r\n    remaining -= runLength;\r\n    lo += runLength;\r\n\r\n  } while (remaining !== 0);\r\n\r\n  // Force merging of remaining runs\r\n  ts.forceMergeRuns();\r\n}\r\n\r\nvar FixedArray = function FixedArray(size) {\r\n  this._count = 0;\r\n  this._data = new Array(size);\r\n};\r\n\r\nvar prototypeAccessors$7 = { length: { configurable: true },data: { configurable: true } };\r\n\r\nFixedArray.prototype._resize = function _resize (size) {\r\n    var this$1 = this;\r\n\r\n  if (size > this._data.length) {\r\n    for (var i = this._data.length; i < size; ++i) {\r\n      this$1._data[i] = undefined;\r\n    }\r\n  }\r\n};\r\n\r\nprototypeAccessors$7.length.get = function () {\r\n  return this._count;\r\n};\r\n\r\nprototypeAccessors$7.data.get = function () {\r\n  return this._data;\r\n};\r\n\r\nFixedArray.prototype.reset = function reset () {\r\n    var this$1 = this;\r\n\r\n  for (var i = 0; i < this._count; ++i) {\r\n    this$1._data[i] = undefined;\r\n  }\r\n\r\n  this._count = 0;\r\n};\r\n\r\nFixedArray.prototype.push = function push (val) {\r\n  if (this._count >= this._data.length) {\r\n    this._resize(this._data.length * 2);\r\n  }\r\n\r\n  this._data[this._count] = val;\r\n  ++this._count;\r\n};\r\n\r\nFixedArray.prototype.pop = function pop () {\r\n  --this._count;\r\n\r\n  if (this._count < 0) {\r\n    this._count = 0;\r\n  }\r\n\r\n  var ret = this._data[this._count];\r\n  this._data[this._count] = undefined;\r\n\r\n  return ret;\r\n};\r\n\r\nFixedArray.prototype.fastRemove = function fastRemove (idx) {\r\n  if (idx >= this._count) {\r\n    return;\r\n  }\r\n\r\n  var last = this._count - 1;\r\n  this._data[idx] = this._data[last];\r\n  this._data[last] = undefined;\r\n  this._count -= 1;\r\n};\r\n\r\nFixedArray.prototype.indexOf = function indexOf (val) {\r\n  var idx = this._data.indexOf(val);\r\n  if (idx >= this._count) {\r\n    return -1;\r\n  }\r\n\r\n  return idx;\r\n};\r\n\r\nFixedArray.prototype.sort = function sort$1 (cmp) {\r\n  return sort(this._data, 0, this._count, cmp);\r\n};\r\n\r\nObject.defineProperties( FixedArray.prototype, prototypeAccessors$7 );\r\n\r\nvar Pool = function Pool(fn, size) {\r\n  var this$1 = this;\r\n\r\n  this._fn = fn;\r\n  this._idx = size - 1;\r\n  this._frees = new Array(size);\r\n\r\n  for (var i = 0; i < size; ++i) {\r\n    this$1._frees[i] = fn();\r\n  }\r\n};\r\n\r\nPool.prototype._expand = function _expand (size) {\r\n    var this$1 = this;\r\n\r\n  var old = this._frees;\r\n  this._frees = new Array(size);\r\n\r\n  var len = size - old.length;\r\n  for (var i = 0; i < len; ++i) {\r\n    this$1._frees[i] = this$1._fn();\r\n  }\r\n\r\n  for (var i$1 = len, j = 0; i$1 < size; ++i$1, ++j) {\r\n    this$1._frees[i$1] = old[j];\r\n  }\r\n\r\n  this._idx += len;\r\n};\r\n\r\nPool.prototype.alloc = function alloc () {\r\n  // create some more space (expand by 20%, minimum 1)\r\n  if (this._idx < 0) {\r\n    this._expand(Math.round(this._frees.length * 1.2) + 1);\r\n  }\r\n\r\n  var ret = this._frees[this._idx];\r\n  this._frees[this._idx] = null;\r\n  --this._idx;\r\n\r\n  return ret;\r\n};\r\n\r\nPool.prototype.free = function free (obj) {\r\n  ++this._idx;\r\n  this._frees[this._idx] = obj;\r\n};\r\n\r\n// NOTE: you must have `_prev` and `_next` field in the object returns by `fn`\r\n\r\nvar LinkedArray = function LinkedArray(fn, size) {\r\n  this._fn = fn;\r\n  this._count = 0;\r\n  this._head = null;\r\n  this._tail = null;\r\n\r\n  this._pool = new Pool(fn, size);\r\n};\r\n\r\nvar prototypeAccessors$8 = { head: { configurable: true },tail: { configurable: true },length: { configurable: true } };\r\n\r\nprototypeAccessors$8.head.get = function () {\r\n  return this._head;\r\n};\r\n\r\nprototypeAccessors$8.tail.get = function () {\r\n  return this._tail;\r\n};\r\n\r\nprototypeAccessors$8.length.get = function () {\r\n  return this._count;\r\n};\r\n\r\nLinkedArray.prototype.add = function add () {\r\n  var node = this._pool.alloc();\r\n\r\n  if (!this._tail) {\r\n    this._head = node;\r\n  } else {\r\n    this._tail._next = node;\r\n    node._prev = this._tail;\r\n  }\r\n  this._tail = node;\r\n  this._count += 1;\r\n\r\n  return node;\r\n};\r\n\r\nLinkedArray.prototype.remove = function remove (node) {\r\n  if (node._prev) {\r\n    node._prev._next = node._next;\r\n  } else {\r\n    this._head = node._next;\r\n  }\r\n\r\n  if (node._next) {\r\n    node._next._prev = node._prev;\r\n  } else {\r\n    this._tail = node._prev;\r\n  }\r\n\r\n  node._next = null;\r\n  node._prev = null;\r\n  this._pool.free(node);\r\n  this._count -= 1;\r\n};\r\n\r\nLinkedArray.prototype.forEach = function forEach (fn, binder) {\r\n    var this$1 = this;\r\n\r\n  var cursor = this._head;\r\n  if (!cursor) {\r\n    return;\r\n  }\r\n\r\n  if (binder) {\r\n    fn = fn.bind(binder);\r\n  }\r\n\r\n  var idx = 0;\r\n  var next = cursor;\r\n\r\n  while (cursor) {\r\n    next = cursor._next;\r\n    fn(cursor, idx, this$1);\r\n\r\n    cursor = next;\r\n    ++idx;\r\n  }\r\n};\r\n\r\nObject.defineProperties( LinkedArray.prototype, prototypeAccessors$8 );\r\n\r\nvar RecyclePool = function RecyclePool(fn, size) {\r\n  var this$1 = this;\r\n\r\n  this._fn = fn;\r\n  this._count = 0;\r\n  this._data = new Array(size);\r\n\r\n  for (var i = 0; i < size; ++i) {\r\n    this$1._data[i] = fn();\r\n  }\r\n};\r\n\r\nvar prototypeAccessors$9 = { length: { configurable: true },data: { configurable: true } };\r\n\r\nprototypeAccessors$9.length.get = function () {\r\n  return this._count;\r\n};\r\n\r\nprototypeAccessors$9.data.get = function () {\r\n  return this._data;\r\n};\r\n\r\nRecyclePool.prototype.reset = function reset () {\r\n  this._count = 0;\r\n};\r\n\r\nRecyclePool.prototype.resize = function resize (size) {\r\n    var this$1 = this;\r\n\r\n  if (size > this._data.length) {\r\n    for (var i = this._data.length; i < size; ++i) {\r\n      this$1._data[i] = this$1._fn();\r\n    }\r\n  }\r\n};\r\n\r\nRecyclePool.prototype.add = function add () {\r\n  if (this._count >= this._data.length) {\r\n    this.resize(this._data.length * 2);\r\n  }\r\n\r\n  return this._data[this._count++];\r\n};\r\n\r\nRecyclePool.prototype.remove = function remove (idx) {\r\n  if (idx >= this._count) {\r\n    return;\r\n  }\r\n\r\n  var last = this._count - 1;\r\n  var tmp = this._data[idx];\r\n  this._data[idx] = this._data[last];\r\n  this._data[last] = tmp;\r\n  this._count -= 1;\r\n};\r\n\r\nRecyclePool.prototype.sort = function sort$1 (cmp) {\r\n  return sort(this._data, 0, this._count, cmp);\r\n};\r\n\r\nObject.defineProperties( RecyclePool.prototype, prototypeAccessors$9 );\r\n\r\nvar _bufferPools = Array(8);\r\nfor (var i = 0; i < 8; ++i) {\r\n  _bufferPools[i] = [];\r\n}\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar Scene = function Scene() {\r\n  this._lights = new FixedArray(16);\r\n  this._models = new FixedArray(16);\r\n  this._cameras = new FixedArray(16);\r\n  this._debugCamera = null;\r\n\r\n  // NOTE: we don't use pool for views (because it's less changed and it doesn't have poolID)\r\n  this._views = [];\r\n};\r\n\r\nScene.prototype._add = function _add (pool, item) {\r\n  if (item._poolID !== -1) {\r\n    return;\r\n  }\r\n\r\n  pool.push(item);\r\n  item._poolID = pool.length - 1;\r\n};\r\n\r\nScene.prototype._remove = function _remove (pool, item) {\r\n  if (item._poolID === -1) {\r\n    return;\r\n  }\r\n\r\n  pool.data[pool.length-1]._poolID = item._poolID;\r\n  pool.fastRemove(item._poolID);\r\n  item._poolID = -1;\r\n};\r\n\r\nScene.prototype.reset = function reset () {\r\n    var this$1 = this;\r\n\r\n  for (var i = 0; i < this._models.length; ++i) {\r\n    var model = this$1._models.data[i];\r\n    model._cullingMask = -1;\r\n  }\r\n};\r\n\r\nScene.prototype.setDebugCamera = function setDebugCamera (cam) {\r\n  this._debugCamera = cam;\r\n};\r\n\r\n// camera\r\n\r\nScene.prototype.getCameraCount = function getCameraCount () {\r\n  return this._cameras.length;\r\n};\r\n\r\nScene.prototype.getCamera = function getCamera (idx) {\r\n  return this._cameras.data[idx];\r\n};\r\n\r\nScene.prototype.addCamera = function addCamera (camera) {\r\n  this._add(this._cameras, camera);\r\n};\r\n\r\nScene.prototype.removeCamera = function removeCamera (camera) {\r\n  this._remove(this._cameras, camera);\r\n};\r\n\r\n// model\r\n\r\nScene.prototype.getModelCount = function getModelCount () {\r\n  return this._models.length;\r\n};\r\n\r\nScene.prototype.getModel = function getModel (idx) {\r\n  return this._models.data[idx];\r\n};\r\n\r\nScene.prototype.addModel = function addModel (model) {\r\n  this._add(this._models, model);\r\n};\r\n\r\nScene.prototype.removeModel = function removeModel (model) {\r\n  this._remove(this._models, model);\r\n};\r\n\r\n// light\r\n\r\nScene.prototype.getLightCount = function getLightCount () {\r\n  return this._lights.length;\r\n};\r\n\r\nScene.prototype.getLight = function getLight (idx) {\r\n  return this._lights.data[idx];\r\n};\r\n\r\nScene.prototype.addLight = function addLight (light) {\r\n  this._add(this._lights, light);\r\n};\r\n\r\nScene.prototype.removeLight = function removeLight (light) {\r\n  this._remove(this._lights, light);\r\n};\r\n\r\n// view\r\n\r\nScene.prototype.addView = function addView (view) {\r\n  if (this._views.indexOf(view) === -1) {\r\n    this._views.push(view);\r\n  }\r\n};\r\n\r\nScene.prototype.removeView = function removeView (view) {\r\n  var idx = this._views.indexOf(view);\r\n  if (idx !== -1) {\r\n    this._views.splice(idx, 1);\r\n  }\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar _shdID = 0;\r\n\r\nfunction _generateDefines(defs) {\r\n  var defines = [];\r\n  for (var def in defs) {\r\n    if (defs[def] === true) {\r\n      defines.push((\"#define \" + def));\r\n    }\r\n  }\r\n  return defines.join('\\n');\r\n}\r\n\r\nfunction _replaceMacroNums(string, defs) {\r\n  var cache = {};\r\n  var tmp = string;\r\n  for (var def in defs) {\r\n    if (Number.isInteger(defs[def])) {\r\n      cache[def] = defs[def];\r\n    }\r\n  }\r\n  for (var def$1 in cache) {\r\n    var reg = new RegExp(def$1, 'g');\r\n    tmp = tmp.replace(reg, cache[def$1]);\r\n  }\r\n  return tmp;\r\n}\r\n\r\nfunction _unrollLoops(string) {\r\n  var pattern = /#pragma for (\\w+) in range\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)([\\s\\S]+?)#pragma endFor/g;\r\n  function replace(match, index, begin, end, snippet) {\r\n    var unroll = '';\r\n    var parsedBegin = parseInt(begin);\r\n    var parsedEnd = parseInt(end);\r\n    if (parsedBegin.isNaN || parsedEnd.isNaN) {\r\n      console.error('Unroll For Loops Error: begin and end of range must be an int num.');\r\n    }\r\n    for (var i = parsedBegin; i < parsedEnd; ++i) {\r\n      unroll += snippet.replace(new RegExp((\"{\" + index + \"}\"), 'g'), i);\r\n    }\r\n    return unroll;\r\n  }\r\n  return string.replace(pattern, replace);\r\n}\r\n\r\nvar ProgramLib = function ProgramLib(device, templates, chunks) {\r\n  var this$1 = this;\r\n  if ( templates === void 0 ) templates = [];\r\n  if ( chunks === void 0 ) chunks = {};\r\n\r\n  this._device = device;\r\n  this._precision = \"precision highp float;\\n\";\r\n\r\n  // register templates\r\n  this._templates = {};\r\n  for (var i = 0; i < templates.length; ++i) {\r\n    var tmpl = templates[i];\r\n    this$1.define(tmpl.name, tmpl.vert, tmpl.frag, tmpl.defines);\r\n  }\r\n\r\n  // register chunks\r\n  this._chunks = {};\r\n  Object.assign(this._chunks, chunks);\r\n\r\n  this._cache = {};\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n * @param {string} template\r\n * @param {Array} options\r\n *\r\n * @example:\r\n * programLib.define('foobar', vertTmpl, fragTmpl, [\r\n *   { name: 'shadow' },\r\n *   { name: 'lightCount', min: 1, max: 4 }\r\n * ]);\r\n */\r\nProgramLib.prototype.define = function define (name, vert, frag, defines) {\r\n  if (this._templates[name]) {\r\n    console.warn((\"Failed to define shader \" + name + \": already exists.\"));\r\n    return;\r\n  }\r\n\r\n  var id = ++_shdID;\r\n\r\n  // calculate option mask offset\r\n  var offset = 0;\r\n  var loop = function ( i ) {\r\n    var def = defines[i];\r\n    def._offset = offset;\r\n\r\n    var cnt = 1;\r\n\r\n    if (def.min !== undefined && def.max !== undefined) {\r\n      cnt = Math.ceil((def.max - def.min) * 0.5);\r\n\r\n      def._map = function (value) {\r\n        return (value - this._min) << def._offset;\r\n      }.bind(def);\r\n    } else {\r\n      def._map = function (value) {\r\n        if (value) {\r\n          return 1 << def._offset;\r\n        }\r\n        return 0;\r\n      }.bind(def);\r\n    }\r\n\r\n    offset += cnt;\r\n\r\n    def._offset = offset;\r\n  };\r\n\r\n    for (var i = 0; i < defines.length; ++i) loop( i );\r\n\r\n  vert = this._precision + vert;\r\n  frag = this._precision + frag;\r\n\r\n  // store it\r\n  this._templates[name] = {\r\n    id: id,\r\n    name: name,\r\n    vert: vert,\r\n    frag: frag,\r\n    defines: defines\r\n  };\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n * @param {Object} options\r\n */\r\nProgramLib.prototype.getKey = function getKey (name, defines) {\r\n  var tmpl = this._templates[name];\r\n  var key = 0;\r\n  for (var i = 0; i < tmpl.defines.length; ++i) {\r\n    var tmplDefs = tmpl.defines[i];\r\n    var value = defines[tmplDefs.name];\r\n    if (value === undefined) {\r\n      continue;\r\n    }\r\n\r\n    key |= tmplDefs._map(value);\r\n  }\r\n\r\n  return key << 8 | tmpl.id;\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n * @param {Object} options\r\n */\r\nProgramLib.prototype.getProgram = function getProgram (name, defines) {\r\n  var key = this.getKey(name, defines);\r\n  var program = this._cache[key];\r\n  if (program) {\r\n    return program;\r\n  }\r\n\r\n  // get template\r\n  var tmpl = this._templates[name];\r\n  var customDef = _generateDefines(defines) + '\\n';\r\n  var vert = _replaceMacroNums(tmpl.vert, defines);\r\n  vert = customDef + _unrollLoops(vert);\r\n  var frag = _replaceMacroNums(tmpl.frag, defines);\r\n  frag = customDef + _unrollLoops(frag);\r\n\r\n  program = new gfx.Program(this._device, {\r\n    vert: vert,\r\n    frag: frag\r\n  });\r\n  program.link();\r\n  this._cache[key] = program;\r\n\r\n  return program;\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. \r\n\r\nvar _m3_tmp$1 = mat3.create();\r\nvar _m4_tmp$2 = mat4.create();\r\n\r\nvar _stageInfos = new RecyclePool(function () {\r\n  return {\r\n    stage: null,\r\n    items: null,\r\n  };\r\n}, 8);\r\n\r\nvar _float2_pool = new RecyclePool(function () {\r\n  return new Float32Array(2);\r\n}, 8);\r\n\r\nvar _float3_pool = new RecyclePool(function () {\r\n  return new Float32Array(3);\r\n}, 8);\r\n\r\nvar _float4_pool = new RecyclePool(function () {\r\n  return new Float32Array(4);\r\n}, 8);\r\n\r\nvar _float9_pool = new RecyclePool(function () {\r\n  return new Float32Array(9);\r\n}, 8);\r\n\r\nvar _float16_pool = new RecyclePool(function () {\r\n  return new Float32Array(16);\r\n}, 8);\r\n\r\nvar _float64_pool = new RecyclePool(function () {\r\n  return new Float32Array(64);\r\n}, 8);\r\n\r\nvar _int2_pool = new RecyclePool(function () {\r\n  return new Int32Array(2);\r\n}, 8);\r\n\r\nvar _int3_pool = new RecyclePool(function () {\r\n  return new Int32Array(3);\r\n}, 8);\r\n\r\nvar _int4_pool = new RecyclePool(function () {\r\n  return new Int32Array(4);\r\n}, 8);\r\n\r\nvar _int64_pool = new RecyclePool(function () {\r\n  return new Int32Array(64);\r\n}, 8);\r\n\r\nvar _type2uniformValue = {};\r\n_type2uniformValue[enums.PARAM_INT] = function (value) {\r\n    return value;\r\n  };\r\n_type2uniformValue[enums.PARAM_INT2] = function (value) {\r\n    return vec2.array(_int2_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_INT3] = function (value) {\r\n    return vec3.array(_int3_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_INT4] = function (value) {\r\n    return vec4.array(_int4_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_FLOAT] = function (value) {\r\n    return value;\r\n  };\r\n_type2uniformValue[enums.PARAM_FLOAT2] = function (value) {\r\n    return vec2.array(_float2_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_FLOAT3] = function (value) {\r\n    return vec3.array(_float3_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_FLOAT4] = function (value) {\r\n    return vec4.array(_float4_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_COLOR3] = function (value) {\r\n    return color3.array(_float3_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_COLOR4] = function (value) {\r\n    return color4.array(_float4_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_MAT2] = function (value) {\r\n    return mat2.array(_float4_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_MAT3] = function (value) {\r\n    return mat3.array(_float9_pool.add(), value);\r\n  };\r\n_type2uniformValue[enums.PARAM_MAT4] = function (value) {\r\n    return mat4.array(_float16_pool.add(), value);\r\n  };\r\n\r\nvar _type2uniformArrayValue = {};\r\n_type2uniformArrayValue[enums.PARAM_INT] = {\r\n    func: function func (values) {\r\n      var result = _int64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        result[i] = values[i];\r\n      }\r\n      return result;\r\n    },\r\n    size: 1,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_INT2] = {\r\n    func: function func (values) {\r\n      var result = _int64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        result[2 * i] = values[i].x;\r\n        result[2 * i + 1] = values[i].y;\r\n      }\r\n      return result;\r\n    },\r\n    size: 2,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_INT3] = {\r\n    func: undefined,\r\n    size: 3,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_INT4] = {\r\n    func: function func (values) {\r\n      var result = _int64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        var v = values[i];\r\n        result[4 * i] = v.x;\r\n        result[4 * i + 1] = v.y;\r\n        result[4 * i + 2] = v.z;\r\n        result[4 * i + 3] = v.w;\r\n      }\r\n      return result;\r\n    },\r\n    size: 4,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_FLOAT] = {\r\n    func: function func (values) {\r\n      var result = _float64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        result[i] = values[i];\r\n      }\r\n      return result;\r\n    },\r\n    size: 1\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_FLOAT2] = {\r\n    func: function func (values) {\r\n      var result = _float64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        result[2 * i] = values[i].x;\r\n        result[2 * i + 1] = values[i].y;\r\n      }\r\n      return result;\r\n    },\r\n    size: 2,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_FLOAT3] = {\r\n    func: undefined,\r\n    size: 3,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_FLOAT4] = {\r\n    func: function func (values) {\r\n      var result = _float64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        var v = values[i];\r\n        result[4 * i] = v.x;\r\n        result[4 * i + 1] = v.y;\r\n        result[4 * i + 2] = v.z;\r\n        result[4 * i + 3] = v.w;\r\n      }\r\n      return result;\r\n    },\r\n    size: 4,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_COLOR3] = {\r\n    func: undefined,\r\n    size: 3,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_COLOR4] = {\r\n    func: function func (values) {\r\n      var result = _float64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        var v = values[i];\r\n        result[4 * i] = v.r;\r\n        result[4 * i + 1] = v.g;\r\n        result[4 * i + 2] = v.b;\r\n        result[4 * i + 3] = v.a;\r\n      }\r\n      return result;\r\n    },\r\n    size: 4,\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_MAT2] = {\r\n    func: function func (values) {\r\n      var result = _float64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        var v = values[i];\r\n        result[4 * i] = v.m00;\r\n        result[4 * i + 1] = v.m01;\r\n        result[4 * i + 2] = v.m02;\r\n        result[4 * i + 3] = v.m03;\r\n      }\r\n      return result;\r\n    },\r\n    size: 4\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_MAT3] = {\r\n    func: undefined,\r\n    size: 9\r\n  };\r\n_type2uniformArrayValue[enums.PARAM_MAT4] = {\r\n    func: function func (values) {\r\n      var result = _float64_pool.add();\r\n      for (var i = 0; i < values.length; ++i) {\r\n        var v = values[i];\r\n        result[16 * i] = v.m00;\r\n        result[16 * i + 1] = v.m01;\r\n        result[16 * i + 2] = v.m02;\r\n        result[16 * i + 3] = v.m03;\r\n        result[16 * i + 4] = v.m04;\r\n        result[16 * i + 5] = v.m05;\r\n        result[16 * i + 6] = v.m06;\r\n        result[16 * i + 7] = v.m07;\r\n        result[16 * i + 8] = v.m08;\r\n        result[16 * i + 9] = v.m09;\r\n        result[16 * i + 10] = v.m10;\r\n        result[16 * i + 11] = v.m11;\r\n        result[16 * i + 12] = v.m12;\r\n        result[16 * i + 13] = v.m13;\r\n        result[16 * i + 14] = v.m14;\r\n        result[16 * i + 15] = v.m15;\r\n      }\r\n      return result;\r\n    },\r\n    size: 16\r\n  };\r\n\r\nvar Base = function Base(device, opts) {\r\n  var obj;\r\n\r\n  this._device = device;\r\n  this._programLib = new ProgramLib(device, opts.programTemplates, opts.programChunks);\r\n  this._opts = opts;\r\n  this._type2defaultValue = ( obj = {}, obj[enums.PARAM_INT] = 0, obj[enums.PARAM_INT2] = vec2.new(0, 0), obj[enums.PARAM_INT3] = vec3.new(0, 0, 0), obj[enums.PARAM_INT4] = vec4.new(0, 0, 0, 0), obj[enums.PARAM_FLOAT] = 0.0, obj[enums.PARAM_FLOAT2] = vec2.new(0, 0), obj[enums.PARAM_FLOAT3] = vec3.new(0, 0, 0), obj[enums.PARAM_FLOAT4] = vec4.new(0, 0, 0, 0), obj[enums.PARAM_COLOR3] = color3.new(0, 0, 0), obj[enums.PARAM_COLOR4] = color4.new(0, 0, 0, 1), obj[enums.PARAM_MAT2] = mat2.create(), obj[enums.PARAM_MAT3] = mat3.create(), obj[enums.PARAM_MAT4] = mat4.create(), obj[enums.PARAM_TEXTURE_2D] = opts.defaultTexture, obj[enums.PARAM_TEXTURE_CUBE] = opts.defaultTextureCube, obj);\r\n  this._stage2fn = {};\r\n  this._usedTextureUnits = 0;\r\n\r\n  this._viewPools = new RecyclePool(function () {\r\n    return new View();\r\n  }, 8);\r\n\r\n  this._drawItemsPools = new RecyclePool(function () {\r\n    return {\r\n      model: null,\r\n      node: null,\r\n      ia: null,\r\n      effect: null,\r\n      defines: null,\r\n    };\r\n  }, 100);\r\n\r\n  this._stageItemsPools = new RecyclePool(function () {\r\n    return new RecyclePool(function () {\r\n      return {\r\n        model: null,\r\n        node: null,\r\n        ia: null,\r\n        effect: null,\r\n        defines: null,\r\n        technique: null,\r\n        sortKey: -1,\r\n      };\r\n    }, 100);\r\n  }, 16);\r\n};\r\n\r\nBase.prototype._resetTextuerUnit = function _resetTextuerUnit () {\r\n  this._usedTextureUnits = 0;\r\n};\r\n\r\nBase.prototype._allocTextuerUnit = function _allocTextuerUnit () {\r\n  var device = this._device;\r\n\r\n  var unit = this._usedTextureUnits;\r\n  if (unit >= device._caps.maxTextureUnits) {\r\n    console.warn((\"Trying to use \" + unit + \" texture units while this GPU supports only \" + (device._caps.maxTextureUnits)));\r\n  }\r\n\r\n  this._usedTextureUnits += 1;\r\n  return unit;\r\n};\r\n\r\nBase.prototype._registerStage = function _registerStage (name, fn) {\r\n  this._stage2fn[name] = fn;\r\n};\r\n\r\nBase.prototype._reset = function _reset () {\r\n  this._viewPools.reset();\r\n  this._stageItemsPools.reset();\r\n};\r\n\r\nBase.prototype._requestView = function _requestView () {\r\n  return this._viewPools.add();\r\n};\r\n\r\nBase.prototype._render = function _render (view, scene) {\r\n    var this$1 = this;\r\n\r\n  var device = this._device;\r\n\r\n  // setup framebuffer\r\n  device.setFrameBuffer(view._framebuffer);\r\n\r\n  // setup viewport\r\n  device.setViewport(\r\n    view._rect.x,\r\n    view._rect.y,\r\n    view._rect.w,\r\n    view._rect.h\r\n  );\r\n\r\n  // setup clear\r\n  var clearOpts = {};\r\n  if (view._clearFlags & enums.CLEAR_COLOR) {\r\n    clearOpts.color = [\r\n      view._color.r,\r\n      view._color.g,\r\n      view._color.b,\r\n      view._color.a\r\n    ];\r\n  }\r\n  if (view._clearFlags & enums.CLEAR_DEPTH) {\r\n    clearOpts.depth = view._depth;\r\n  }\r\n  if (view._clearFlags & enums.CLEAR_STENCIL) {\r\n    clearOpts.stencil = view._stencil;\r\n  }\r\n  device.clear(clearOpts);\r\n\r\n  // get all draw items\r\n  this._drawItemsPools.reset();\r\n\r\n  for (var i = 0; i < scene._models.length; ++i) {\r\n    var model = scene._models.data[i];\r\n\r\n    // filter model by view\r\n    if ((model._cullingMask & view._cullingMask) === 0) {\r\n      continue;\r\n    }\r\n\r\n    for (var m = 0; m < model.drawItemCount; ++m) {\r\n      var drawItem = this$1._drawItemsPools.add();\r\n      model.extractDrawItem(drawItem, m);\r\n    }\r\n  }\r\n\r\n  // TODO: update frustum\r\n  // TODO: visbility test\r\n  // frustum.update(view._viewProj);\r\n\r\n  // dispatch draw items to different stage\r\n  _stageInfos.reset();\r\n\r\n  for (var i$1 = 0; i$1 < view._stages.length; ++i$1) {\r\n    var stage = view._stages[i$1];\r\n    var stageItems = this$1._stageItemsPools.add();\r\n    stageItems.reset();\r\n\r\n    for (var j = 0; j < this._drawItemsPools.length; ++j) {\r\n      var drawItem$1 = this$1._drawItemsPools.data[j];\r\n      var tech = drawItem$1.effect.getTechnique(stage);\r\n\r\n      if (tech) {\r\n        var stageItem = stageItems.add();\r\n        stageItem.model = drawItem$1.model;\r\n        stageItem.node = drawItem$1.node;\r\n        stageItem.ia = drawItem$1.ia;\r\n        stageItem.effect = drawItem$1.effect;\r\n        stageItem.defines = drawItem$1.defines;\r\n        stageItem.technique = tech;\r\n        stageItem.sortKey = -1;\r\n      }\r\n    }\r\n\r\n    var stageInfo = _stageInfos.add();\r\n    stageInfo.stage = stage;\r\n    stageInfo.items = stageItems;\r\n  }\r\n\r\n  // render stages\r\n  for (var i$2 = 0; i$2 < _stageInfos.length; ++i$2) {\r\n    var info = _stageInfos.data[i$2];\r\n    var fn = this$1._stage2fn[info.stage];\r\n\r\n    fn(view, info.items);\r\n  }\r\n};\r\n\r\nBase.prototype._draw = function _draw (item) {\r\n    var this$1 = this;\r\n\r\n  var device = this._device;\r\n  var programLib = this._programLib;\r\n  var node = item.node;\r\n    var ia = item.ia;\r\n    var effect = item.effect;\r\n    var technique = item.technique;\r\n    var defines = item.defines;\r\n\r\n  // reset the pool\r\n  // NOTE: we can use drawCounter optimize this\r\n  // TODO: should be configurable\r\n  _float2_pool.reset();\r\n  _float3_pool.reset();\r\n  _float4_pool.reset();\r\n  _float9_pool.reset();\r\n  _float16_pool.reset();\r\n  _float64_pool.reset();\r\n  _int2_pool.reset();\r\n  _int3_pool.reset();\r\n  _int4_pool.reset();\r\n  _int64_pool.reset();\r\n\r\n  // set common uniforms\r\n  // TODO: try commit this depends on effect\r\n  // {\r\n  node.getWorldMatrix(_m4_tmp$2);\r\n  device.setUniform('model', mat4.array(_float16_pool.add(), _m4_tmp$2));\r\n\r\n  var inverse = mat3.invert(_m3_tmp$1, mat3.fromMat4(_m3_tmp$1, _m4_tmp$2));\r\n  if (inverse) {\r\n    mat3.transpose(_m3_tmp$1, inverse);\r\n    device.setUniform('normalMatrix', mat3.array(_float9_pool.add(), _m3_tmp$1));\r\n  }\r\n  // }\r\n\r\n  // set technique uniforms\r\n  for (var i = 0; i < technique._parameters.length; ++i) {\r\n    var prop = technique._parameters[i];\r\n    var param = effect.getProperty(prop.name);\r\n\r\n    if (param === undefined) {\r\n      param = prop.val;\r\n    }\r\n\r\n    if (param === undefined) {\r\n      param = this$1._type2defaultValue[prop.type];\r\n    }\r\n\r\n    if (param === undefined) {\r\n      console.warn((\"Failed to set technique property \" + (prop.name) + \", value not found.\"));\r\n      continue;\r\n    }\r\n\r\n    if (\r\n      prop.type === enums.PARAM_TEXTURE_2D ||\r\n      prop.type === enums.PARAM_TEXTURE_CUBE\r\n    ) {\r\n      if (prop.size !== undefined) {\r\n        if (prop.size !== param.length) {\r\n          console.error((\"The length of texture array (\" + (param.length) + \") is not corrent(expect \" + (prop.size) + \").\"));\r\n          continue;\r\n        }\r\n        var slots = _int64_pool.add();\r\n        for (var index = 0; index < param.length; ++index) {\r\n          slots[index] = this$1._allocTextuerUnit();\r\n        }\r\n        device.setTextureArray(prop.name, param, slots);\r\n      } else {\r\n        device.setTexture(prop.name, param, this$1._allocTextuerUnit());\r\n      }\r\n    } else {\r\n      var convertedValue = (void 0);\r\n      if (param instanceof Float32Array || param instanceof Int32Array) {\r\n        convertedValue = param;\r\n      }\r\n      else if (prop.size !== undefined) {\r\n        var convertArray = _type2uniformArrayValue[prop.type];\r\n        if (convertArray.func === undefined) {\r\n          console.error('Uniform array of color3/int3/float3/mat3 can not be supportted!');\r\n          continue;\r\n        }\r\n        if (prop.size * convertArray.size > 64) {\r\n          console.error('Uniform array is too long!');\r\n          continue;\r\n        }\r\n        convertedValue = convertArray.func(param);\r\n      } else {\r\n        var convertFn = _type2uniformValue[prop.type];\r\n        convertedValue = convertFn(param);\r\n      }\r\n      device.setUniform(prop.name, convertedValue);\r\n    }\r\n  }\r\n\r\n  // for each pass\r\n  for (var i$1 = 0; i$1 < technique._passes.length; ++i$1) {\r\n    var pass = technique._passes[i$1];\r\n    var count = ia.getPrimitiveCount();\r\n\r\n    // set vertex buffer\r\n    device.setVertexBuffer(0, ia._vertexBuffer);\r\n\r\n    // set index buffer\r\n    if (ia._indexBuffer) {\r\n      device.setIndexBuffer(ia._indexBuffer);\r\n    }\r\n\r\n    // set primitive type\r\n    device.setPrimitiveType(ia._primitiveType);\r\n\r\n    // set program\r\n    var program = programLib.getProgram(pass._programName, defines);\r\n    device.setProgram(program);\r\n\r\n    // cull mode\r\n    device.setCullMode(pass._cullMode);\r\n\r\n    // blend\r\n    if (pass._blend) {\r\n      device.enableBlend();\r\n      device.setBlendFuncSep(\r\n        pass._blendSrc,\r\n        pass._blendDst,\r\n        pass._blendSrcAlpha,\r\n        pass._blendDstAlpha\r\n      );\r\n      device.setBlendEqSep(\r\n        pass._blendEq,\r\n        pass._blendAlphaEq\r\n      );\r\n      device.setBlendColor32(pass._blendColor);\r\n    }\r\n\r\n    // depth test & write\r\n    if (pass._depthTest) {\r\n      device.enableDepthTest();\r\n      device.setDepthFunc(pass._depthFunc);\r\n    }\r\n    if (pass._depthWrite) {\r\n      device.enableDepthWrite();\r\n    }\r\n\r\n    // stencil\r\n    if (pass._stencilTest) {\r\n      device.enableStencilTest();\r\n\r\n      // front\r\n      device.setStencilFuncFront(\r\n        pass._stencilFuncFront,\r\n        pass._stencilRefFront,\r\n        pass._stencilMaskFront\r\n      );\r\n      device.setStencilOpFront(\r\n        pass._stencilFailOpFront,\r\n        pass._stencilZFailOpFront,\r\n        pass._stencilZPassOpFront,\r\n        pass._stencilWriteMaskFront\r\n      );\r\n\r\n      // back\r\n      device.setStencilFuncBack(\r\n        pass._stencilFuncBack,\r\n        pass._stencilRefBack,\r\n        pass._stencilMaskBack\r\n      );\r\n      device.setStencilOpBack(\r\n        pass._stencilFailOpBack,\r\n        pass._stencilZFailOpBack,\r\n        pass._stencilZPassOpBack,\r\n        pass._stencilWriteMaskBack\r\n      );\r\n    }\r\n\r\n    // draw pass\r\n    device.draw(ia._start, count);\r\n\r\n    this$1._resetTextuerUnit();\r\n  }\r\n};\r\n\r\nvar renderer = {\r\n  // config\r\n  addStage: config.addStage,\r\n\r\n  // utils\r\n  createIA: createIA,\r\n\r\n  // classes\r\n  Pass: Pass,\r\n  Technique: Technique,\r\n  Effect: Effect,\r\n  InputAssembler: InputAssembler,\r\n  View: View,\r\n\r\n  Light: Light,\r\n  Camera: Camera,\r\n  Model: Model,\r\n  Scene: Scene,\r\n\r\n  Base: Base,\r\n  ProgramLib: ProgramLib,\r\n};\r\nObject.assign(renderer, enums);\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar _a16_view = new Float32Array(16);\r\nvar _a16_proj = new Float32Array(16);\r\nvar _a16_viewProj = new Float32Array(16);\r\n\r\nvar ForwardRenderer = (function (superclass) {\r\n  function ForwardRenderer (device, builtin) {\r\n    superclass.call(this, device, builtin);\r\n    this._registerStage('transparent', this._transparentStage.bind(this));\r\n  }\r\n\r\n  if ( superclass ) ForwardRenderer.__proto__ = superclass;\r\n  ForwardRenderer.prototype = Object.create( superclass && superclass.prototype );\r\n  ForwardRenderer.prototype.constructor = ForwardRenderer;\r\n\r\n  ForwardRenderer.prototype.reset = function reset () {\r\n    this._reset();\r\n  };\r\n\r\n  ForwardRenderer.prototype.render = function render (scene) {\r\n    var this$1 = this;\r\n\r\n    this._reset();\r\n\r\n    scene._cameras.sort(function (a, b) {\r\n      if (a._sortDepth > b._sortDepth) { return 1; }\r\n      else if (a._sortDepth < b._sortDepth) { return -1; }\r\n      else { return 0; }\r\n    });\r\n\r\n    for (var i = 0; i < scene._cameras.length; ++i) {\r\n      var camera = scene._cameras.data[i];\r\n\r\n      // reset camera pollID after sort cameras\r\n      camera._poolID = i;\r\n      \r\n      this$1.renderCamera(camera, scene);\r\n    }\r\n  };\r\n\r\n  ForwardRenderer.prototype.renderCamera = function renderCamera (camera, scene) {\r\n    var canvas = this._device._gl.canvas;\r\n\r\n    var view = camera.view;\r\n    var dirty = camera.dirty;\r\n    if (!view) {\r\n      view = this._requestView();\r\n      dirty = true;\r\n    }\r\n    if (dirty) {\r\n      var width = canvas.width;\r\n      var height = canvas.height;\r\n      if (camera._framebuffer) {\r\n        width = camera._framebuffer._width;\r\n        height = camera._framebuffer._height;\r\n      }\r\n      camera.extractView(view, width, height);\r\n    }\r\n    this._render(view, scene);\r\n  };\r\n\r\n  ForwardRenderer.prototype._transparentStage = function _transparentStage (view, items) {\r\n    var this$1 = this;\r\n\r\n    // update uniforms\r\n    this._device.setUniform('view', mat4.array(_a16_view, view._matView));\r\n    this._device.setUniform('proj', mat4.array(_a16_proj, view._matProj));\r\n    this._device.setUniform('viewProj', mat4.array(_a16_viewProj, view._matViewProj));\r\n\r\n    // draw it\r\n    for (var i = 0; i < items.length; ++i) {\r\n      var item = items.data[i];\r\n      this$1._draw(item);\r\n    }\r\n  };\r\n\r\n  return ForwardRenderer;\r\n}(renderer.Base));\r\n\r\nvar chunks = {\r\n  'skinning.vert': '\\nattribute vec4 a_weights;\\nattribute vec4 a_joints;\\n#ifdef useJointsTexture\\nuniform sampler2D u_jointsTexture;\\nuniform float u_jointsTextureSize;\\nmat4 getBoneMatrix(const in float i) {\\n  float size = u_jointsTextureSize;\\n  float j = i * 4.0;\\n  float x = mod(j, size);\\n  float y = floor(j / size);\\n  float dx = 1.0 / size;\\n  float dy = 1.0 / size;\\n  y = dy * (y + 0.5);\\n  vec4 v1 = texture2D(u_jointsTexture, vec2(dx * (x + 0.5), y));\\n  vec4 v2 = texture2D(u_jointsTexture, vec2(dx * (x + 1.5), y));\\n  vec4 v3 = texture2D(u_jointsTexture, vec2(dx * (x + 2.5), y));\\n  vec4 v4 = texture2D(u_jointsTexture, vec2(dx * (x + 3.5), y));\\n  return mat4(v1, v2, v3, v4);\\n}\\n#else\\nuniform mat4 u_jointMatrices[64];\\nmat4 getBoneMatrix(const in float i) {\\n  return u_jointMatrices[int(i)];\\n}\\n#endif\\nmat4 skinMatrix() {\\n  return\\n    getBoneMatrix(a_joints.x) * a_weights.x +\\n    getBoneMatrix(a_joints.y) * a_weights.y +\\n    getBoneMatrix(a_joints.z) * a_weights.z +\\n    getBoneMatrix(a_joints.w) * a_weights.w\\n    ;\\n}',\r\n};\r\n\r\nvar templates = [\r\n  {\r\n    name: 'gray_sprite',\r\n    vert: '\\n \\nuniform mat4 viewProj;\\nattribute vec3 a_position;\\nattribute mediump vec2 a_uv0;\\nvarying mediump vec2 uv0;\\nvoid main () {\\n  vec4 pos = viewProj * vec4(a_position, 1);\\n  gl_Position = pos;\\n  uv0 = a_uv0;\\n}',\r\n    frag: '\\n \\nuniform sampler2D texture;\\nvarying mediump vec2 uv0;\\nuniform lowp vec4 color;\\nvoid main () {\\n  vec4 c = color * texture2D(texture, uv0);\\n  float gray = 0.2126*c.r + 0.7152*c.g + 0.0722*c.b;\\n  gl_FragColor = vec4(gray, gray, gray, c.a);\\n}',\r\n    defines: [\r\n    ],\r\n  },\r\n  {\r\n    name: 'mesh',\r\n    vert: '\\n \\nuniform mat4 viewProj;\\nattribute vec3 a_position;\\n#ifdef useAttributeColor\\n  attribute vec4 a_color;\\n  varying vec4 v_color;\\n#endif\\n#ifdef useTexture\\n  attribute vec2 a_uv0;\\n  varying vec2 uv0;\\n#endif\\n#ifdef useModel\\n  uniform mat4 model;\\n#endif\\n#ifdef useSkinning\\n  \\nattribute vec4 a_weights;\\nattribute vec4 a_joints;\\n#ifdef useJointsTexture\\nuniform sampler2D u_jointsTexture;\\nuniform float u_jointsTextureSize;\\nmat4 getBoneMatrix(const in float i) {\\n  float size = u_jointsTextureSize;\\n  float j = i * 4.0;\\n  float x = mod(j, size);\\n  float y = floor(j / size);\\n  float dx = 1.0 / size;\\n  float dy = 1.0 / size;\\n  y = dy * (y + 0.5);\\n  vec4 v1 = texture2D(u_jointsTexture, vec2(dx * (x + 0.5), y));\\n  vec4 v2 = texture2D(u_jointsTexture, vec2(dx * (x + 1.5), y));\\n  vec4 v3 = texture2D(u_jointsTexture, vec2(dx * (x + 2.5), y));\\n  vec4 v4 = texture2D(u_jointsTexture, vec2(dx * (x + 3.5), y));\\n  return mat4(v1, v2, v3, v4);\\n}\\n#else\\nuniform mat4 u_jointMatrices[64];\\nmat4 getBoneMatrix(const in float i) {\\n  return u_jointMatrices[int(i)];\\n}\\n#endif\\nmat4 skinMatrix() {\\n  return\\n    getBoneMatrix(a_joints.x) * a_weights.x +\\n    getBoneMatrix(a_joints.y) * a_weights.y +\\n    getBoneMatrix(a_joints.z) * a_weights.z +\\n    getBoneMatrix(a_joints.w) * a_weights.w\\n    ;\\n}\\n#endif\\nvoid main () {\\n  mat4 mvp;\\n  #ifdef useModel\\n    mvp = viewProj * model;\\n  #else\\n    mvp = viewProj;\\n  #endif\\n  #ifdef useSkinning\\n    mvp = mvp * skinMatrix();\\n  #endif\\n  vec4 pos = mvp * vec4(a_position, 1);\\n  #ifdef useTexture\\n    uv0 = a_uv0;\\n  #endif\\n  #ifdef useAttributeColor\\n    v_color = a_color;\\n  #endif\\n  gl_Position = pos;\\n}',\r\n    frag: '\\n \\n#ifdef useTexture\\n  uniform sampler2D texture;\\n  varying vec2 uv0;\\n#endif\\n#ifdef useAttributeColor\\n  varying vec4 v_color;\\n#endif\\nuniform vec4 color;\\nvoid main () {\\n  vec4 o = color;\\n  \\n  #ifdef useAttributeColor\\n    o *= v_color;\\n  #endif\\n  #ifdef useTexture\\n    o *= texture2D(texture, uv0);\\n  #endif\\n  gl_FragColor = o;\\n}',\r\n    defines: [\r\n      { name: 'useTexture', },\r\n      { name: 'useModel', },\r\n      { name: 'useSkinning', },\r\n      { name: 'useJointsTexture', },\r\n      { name: 'useAttributeColor', } ],\r\n  },\r\n  {\r\n    name: 'sprite',\r\n    vert: '\\n \\nuniform mat4 viewProj;\\nattribute vec3 a_position;\\nattribute lowp vec4 a_color;\\n#ifdef useModel\\n  uniform mat4 model;\\n#endif\\n#ifdef useTexture\\n  attribute mediump vec2 a_uv0;\\n  varying mediump vec2 uv0;\\n#endif\\n#ifndef useColor\\nvarying lowp vec4 v_fragmentColor;\\n#endif\\nvoid main () {\\n  mat4 mvp;\\n  #ifdef useModel\\n    mvp = viewProj * model;\\n  #else\\n    mvp = viewProj;\\n  #endif\\n  vec4 pos = mvp * vec4(a_position, 1);\\n  #ifndef useColor\\n  v_fragmentColor = a_color;\\n  #endif\\n  #ifdef useTexture\\n    uv0 = a_uv0;\\n  #endif\\n  gl_Position = pos;\\n}',\r\n    frag: '\\n \\n#ifdef useTexture\\n  uniform sampler2D texture;\\n  varying mediump vec2 uv0;\\n#endif\\n#ifdef alphaTest\\n  uniform lowp float alphaThreshold;\\n#endif\\n#ifdef useColor\\n  uniform lowp vec4 color;\\n#else\\n  varying lowp vec4 v_fragmentColor;\\n#endif\\nvoid main () {\\n  #ifdef useColor\\n    vec4 o = color;\\n  #else\\n    vec4 o = v_fragmentColor;\\n  #endif\\n  #ifdef useTexture\\n    o *= texture2D(texture, uv0);\\n  #endif\\n  #ifdef alphaTest\\n    if (o.a <= alphaThreshold)\\n      discard;\\n  #endif\\n  gl_FragColor = o;\\n}',\r\n    defines: [\r\n      { name: 'useTexture', },\r\n      { name: 'useModel', },\r\n      { name: 'alphaTest', },\r\n      { name: 'useColor', } ],\r\n  } ];\r\n\r\nvar shaders = {\r\n    chunks: chunks,\r\n    templates: templates\r\n};\r\n\r\n// Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.  \r\n\r\n/**\r\n * BaseRenderData is a core data abstraction for renderer, this is a abstract class.\r\n * An inherited render data type should define raw vertex datas.\r\n * User should also define the effect, vertex count and index count.\r\n */\r\nvar BaseRenderData = function BaseRenderData () {\r\n    this.material = null;\r\n    this.vertexCount = 0;\r\n    this.indiceCount = 0;\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar _pool;\r\nvar _dataPool = new Pool(function () {\r\n  return {\r\n    x: 0.0,\r\n    y: 0.0,\r\n    z: 0.0,\r\n    u: 0.0,\r\n    v: 0.0,\r\n    color: 0\r\n  };\r\n}, 128);\r\n\r\n/**\r\n * RenderData is most widely used render data type.\r\n * It describes raw vertex data with a fixed data layout.\r\n * Each vertex is described by five property: x, y, u, v, color. The data layout might be extended in the future.\r\n * Vertex data objects are managed automatically by RenderData, user only need to set the dataLength property.\r\n * User can also define rendering index orders for the vertex list.\r\n */\r\nvar RenderData = (function (BaseRenderData$$1) {\r\n  function RenderData () {\r\n    BaseRenderData$$1.call(this);\r\n    this._data = [];\r\n    this._indices = [];\r\n\r\n    this._pivotX = 0;\r\n    this._pivotY = 0;\r\n    this._width = 0;\r\n    this._height = 0;\r\n\r\n    this.uvDirty = true;\r\n    this.vertDirty = true;\r\n  }\r\n\r\n  if ( BaseRenderData$$1 ) RenderData.__proto__ = BaseRenderData$$1;\r\n  RenderData.prototype = Object.create( BaseRenderData$$1 && BaseRenderData$$1.prototype );\r\n  RenderData.prototype.constructor = RenderData;\r\n\r\n  var prototypeAccessors = { type: { configurable: true },dataLength: { configurable: true } };\r\n\r\n  prototypeAccessors.type.get = function () {\r\n    return RenderData.type;\r\n  };\r\n\r\n  prototypeAccessors.dataLength.get = function () {\r\n    return this._data.length;\r\n  };\r\n\r\n  prototypeAccessors.dataLength.set = function (length) {\r\n    var data = this._data;\r\n    if (data.length !== length) {\r\n      // Free extra data\r\n      for (var i = length; i < data.length; i++) {\r\n        _dataPool.free(data[i]);\r\n      }\r\n      // Alloc needed data\r\n      for (var i$1 = data.length; i$1 < length; i$1++) {\r\n        data[i$1] = _dataPool.alloc();\r\n      }\r\n      data.length = length;\r\n    }\r\n  };\r\n\r\n  RenderData.prototype.updateSizeNPivot = function updateSizeNPivot (width, height, pivotX, pivotY) {\r\n    if (width !== this._width || \r\n        height !== this._height ||\r\n        pivotX !== this._pivotX ||\r\n        pivotY !== this._pivotY) \r\n    {\r\n      this._width = width;\r\n      this._height = height;\r\n      this._pivotX = pivotX;\r\n      this._pivotY = pivotY;\r\n      this.vertDirty = true;\r\n    }\r\n  };\r\n  \r\n  RenderData.alloc = function alloc () {\r\n    return _pool.alloc();\r\n  };\r\n\r\n  RenderData.free = function free (data) {\r\n    if (data instanceof RenderData) {\r\n      for (var i = data.length-1; i > 0; i--) {\r\n        _dataPool.free(data._data[i]);\r\n      }\r\n      data._data.length = 0;\r\n      data._indices.length = 0;\r\n      data.material = null;\r\n      data.uvDirty = true;\r\n      data.vertDirty = true;\r\n      data.vertexCount = 0;\r\n      data.indiceCount = 0;\r\n      _pool.free(data);\r\n    }\r\n  };\r\n\r\n  Object.defineProperties( RenderData.prototype, prototypeAccessors );\r\n\r\n  return RenderData;\r\n}(BaseRenderData));\r\n\r\nRenderData.type = 'RenderData';\r\n\r\n_pool = new Pool(function () {\r\n  return new RenderData();\r\n}, 32);\r\n\r\n// Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\n/**\r\n * IARenderData is user customized render data type, user should provide the entier input assembler.\r\n * IARenderData just defines a property `ia` for accessing the input assembler.\r\n * It doesn't manage memory so users should manage the memory of input assembler by themselves.\r\n */\r\nvar IARenderData = (function (BaseRenderData$$1) {\r\n    function IARenderData () {\r\n        BaseRenderData$$1.call(this);\r\n        this.ia = null;\r\n    }\r\n\r\n    if ( BaseRenderData$$1 ) IARenderData.__proto__ = BaseRenderData$$1;\r\n    IARenderData.prototype = Object.create( BaseRenderData$$1 && BaseRenderData$$1.prototype );\r\n    IARenderData.prototype.constructor = IARenderData;\r\n\r\n    var prototypeAccessors = { type: { configurable: true } };\r\n\r\n    prototypeAccessors.type.get = function () {\r\n        return IARenderData.type;\r\n    };\r\n\r\n    Object.defineProperties( IARenderData.prototype, prototypeAccessors );\r\n\r\n    return IARenderData;\r\n}(BaseRenderData));\r\n\r\nIARenderData.type = 'IARenderData';\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar Asset = function Asset(persist) {\r\n  if ( persist === void 0 ) persist = true;\r\n\r\n  this._loaded = false;\r\n  this._persist = persist;\r\n};\r\n\r\nAsset.prototype.unload = function unload () {\r\n  this._loaded = false;\r\n};\r\n\r\nAsset.prototype.reload = function reload () {\r\n  // TODO\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar Texture$2 = (function (Asset$$1) {\r\n  function Texture(persist) {\r\n    if ( persist === void 0 ) persist = true;\r\n\r\n    Asset$$1.call(this, persist);\r\n\r\n    this._texture = null;\r\n  }\r\n\r\n  if ( Asset$$1 ) Texture.__proto__ = Asset$$1;\r\n  Texture.prototype = Object.create( Asset$$1 && Asset$$1.prototype );\r\n  Texture.prototype.constructor = Texture;\r\n\r\n  Texture.prototype.getImpl = function getImpl () {\r\n    return this._texture;\r\n  };\r\n\r\n  Texture.prototype.getId = function getId () {};\r\n\r\n  Texture.prototype.destroy = function destroy () {\r\n    this._texture && this._texture.destroy();\r\n  };\r\n\r\n  return Texture;\r\n}(Asset));\r\n\r\n/**\r\n * JS Implementation of MurmurHash2\r\n * \r\n * @author <a href=\"mailto:gary.court@gmail.com\">Gary Court</a>\r\n * @see http://github.com/garycourt/murmurhash-js\r\n * @author <a href=\"mailto:aappleby@gmail.com\">Austin Appleby</a>\r\n * @see http://sites.google.com/site/murmurhash/\r\n * \r\n * @param {string} str ASCII only\r\n * @param {number} seed Positive integer only\r\n * @return {number} 32-bit positive integer hash\r\n */\r\n\r\nfunction murmurhash2_32_gc(str, seed) {\r\n  var\r\n    l = str.length,\r\n    h = seed ^ l,\r\n    i = 0,\r\n    k;\r\n  \r\n  while (l >= 4) {\r\n  \tk = \r\n  \t  ((str.charCodeAt(i) & 0xff)) |\r\n  \t  ((str.charCodeAt(++i) & 0xff) << 8) |\r\n  \t  ((str.charCodeAt(++i) & 0xff) << 16) |\r\n  \t  ((str.charCodeAt(++i) & 0xff) << 24);\r\n    \r\n    k = (((k & 0xffff) * 0x5bd1e995) + ((((k >>> 16) * 0x5bd1e995) & 0xffff) << 16));\r\n    k ^= k >>> 24;\r\n    k = (((k & 0xffff) * 0x5bd1e995) + ((((k >>> 16) * 0x5bd1e995) & 0xffff) << 16));\r\n\r\n\th = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16)) ^ k;\r\n\r\n    l -= 4;\r\n    ++i;\r\n  }\r\n  \r\n  switch (l) {\r\n  case 3: h ^= (str.charCodeAt(i + 2) & 0xff) << 16;\r\n  case 2: h ^= (str.charCodeAt(i + 1) & 0xff) << 8;\r\n  case 1: h ^= (str.charCodeAt(i) & 0xff);\r\n          h = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16));\r\n  }\r\n\r\n  h ^= h >>> 13;\r\n  h = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16));\r\n  h ^= h >>> 15;\r\n\r\n  return h >>> 0;\r\n}\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n\r\n// function genHashCode (str) {\r\n//     var hash = 0;\r\n//     if (str.length == 0) {\r\n//         return hash;\r\n//     }\r\n//     for (var i = 0; i < str.length; i++) {\r\n//         var char = str.charCodeAt(i);\r\n//         hash = ((hash<<5)-hash)+char;\r\n//         hash = hash & hash; // Convert to 32bit integer\r\n//     }\r\n//     return hash;\r\n// }\r\n\r\nfunction serializeDefines (defines) {\r\n    var str = '';\r\n    for (var i = 0; i < defines.length; i++) {\r\n        str += defines[i].name + defines[i].value;\r\n    }\r\n    return str;\r\n}\r\n\r\nfunction serializePass (pass) {\r\n    var str = pass._programName + pass._cullMode;\r\n    if (pass._blend) {\r\n        str += pass._blendEq + pass._blendAlphaEq + pass._blendSrc + pass._blendDst\r\n             + pass._blendSrcAlpha + pass._blendDstAlpha + pass._blendColor;\r\n    }\r\n    if (pass._depthTest) {\r\n        str += pass._depthWrite + pass._depthFunc;\r\n    }\r\n    if (pass._stencilTest) {\r\n        str += pass._stencilFuncFront + pass._stencilRefFront + pass._stencilMaskFront\r\n             + pass._stencilFailOpFront + pass._stencilZFailOpFront + pass._stencilZPassOpFront\r\n             + pass._stencilWriteMaskFront\r\n             + pass._stencilFuncBack + pass._stencilRefBack + pass._stencilMaskBack\r\n             + pass._stencilFailOpBack + pass._stencilZFailOpBack + pass._stencilZPassOpBack \r\n             + pass._stencilWriteMaskBack;\r\n    }\r\n    return str;\r\n}\r\n\r\nfunction computeHash(material) {\r\n    var effect = material._effect;\r\n    var hashData = '';\r\n    if (effect) {\r\n        var i, j, techData, param, prop, propKey;\r\n\r\n        // effect._defines\r\n        hashData += serializeDefines(effect._defines);\r\n        // effect._techniques\r\n        for (i = 0; i < effect._techniques.length; i++) {\r\n            techData = effect._techniques[i];\r\n            // technique.stageIDs\r\n            hashData += techData.stageIDs;\r\n            // technique._layer\r\n            // hashData += + techData._layer + \"_\";\r\n            // technique.passes\r\n            for (j = 0; j < techData.passes.length; j++) {\r\n                hashData += serializePass(techData.passes[j]);\r\n            }\r\n            //technique._parameters\r\n            for (j = 0; j < techData._parameters.length; j++) {\r\n                param = techData._parameters[j];\r\n                propKey = param.name;\r\n                prop = effect._properties[propKey];\r\n                if (!prop) {\r\n                    continue;\r\n                }\r\n                switch(param.type) {\r\n                    case renderer.PARAM_INT:\r\n                    case renderer.PARAM_FLOAT:\r\n                        hashData += prop + ';';\r\n                        break;\r\n                    case renderer.PARAM_INT2:\r\n                    case renderer.PARAM_FLOAT2:\r\n                        hashData += prop.x + ',' + prop.y + ';';\r\n                        break;\r\n                    case renderer.PARAM_INT4:\r\n                    case renderer.PARAM_FLOAT4:\r\n                        hashData += prop.x + ',' + prop.y + ',' + prop.z + ',' + prop.w + ';';\r\n                        break;\r\n                    case renderer.PARAM_COLOR4:\r\n                        hashData += prop.r + ',' + prop.g + ',' + prop.b + ',' + prop.a + ';';\r\n                        break;\r\n                    case renderer.PARAM_MAT2:\r\n                        hashData += prop.m00 + ',' + prop.m01 + ',' + prop.m02 + ',' + prop.m03 + ';';\r\n                        break;\r\n                    case renderer.PARAM_TEXTURE_2D:\r\n                    case renderer.PARAM_TEXTURE_CUBE:\r\n                        hashData += material._texIds[propKey] + ';';\r\n                        break;\r\n                    case renderer.PARAM_INT3:\r\n                    case renderer.PARAM_FLOAT3:\r\n                    case renderer.PARAM_COLOR3:\r\n                    case renderer.PARAM_MAT3:\r\n                    case renderer.PARAM_MAT4:\r\n                        hashData += JSON.stringify(prop) + ';';\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return hashData ? murmurhash2_32_gc(hashData, 666) : hashData;\r\n}\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar Material = (function (Asset$$1) {\r\n  function Material(persist) {\r\n    if ( persist === void 0 ) persist = false;\r\n\r\n    Asset$$1.call(this, persist);\r\n\r\n    this._effect = null; // renderer.Effect\r\n    this._texIds = {}; // ids collected from texture defines\r\n    this._hash = '';\r\n  }\r\n\r\n  if ( Asset$$1 ) Material.__proto__ = Asset$$1;\r\n  Material.prototype = Object.create( Asset$$1 && Asset$$1.prototype );\r\n  Material.prototype.constructor = Material;\r\n\r\n  var prototypeAccessors = { hash: { configurable: true } };\r\n\r\n  prototypeAccessors.hash.get = function () {\r\n    return this._hash;\r\n  };\r\n\r\n  Material.prototype.updateHash = function updateHash (value) {\r\n    this._hash = value || computeHash(this);\r\n  };\r\n\r\n  Object.defineProperties( Material.prototype, prototypeAccessors );\r\n\r\n  return Material;\r\n}(Asset));\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar SpriteMaterial = (function (Material$$1) {\r\n  function SpriteMaterial() {\r\n    Material$$1.call(this, false);\r\n\r\n    var pass = new renderer.Pass('sprite');\r\n    pass.setDepth(false, false);\r\n    pass.setCullMode(gfx.CULL_NONE);\r\n    pass.setBlend(\r\n      gfx.BLEND_FUNC_ADD,\r\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA,\r\n      gfx.BLEND_FUNC_ADD,\r\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA\r\n    );\r\n\r\n    var mainTech = new renderer.Technique(\r\n      ['transparent'],\r\n      [\r\n        { name: 'texture', type: renderer.PARAM_TEXTURE_2D },\r\n        { name: 'color', type: renderer.PARAM_COLOR4 } ],\r\n      [\r\n        pass\r\n      ]\r\n    );\r\n\r\n    this._color = {r: 1, g: 1, b: 1, a: 1};\r\n    this._effect = new renderer.Effect(\r\n      [\r\n        mainTech ],\r\n      {\r\n        'color': this._color\r\n      },\r\n      [\r\n        { name: 'useTexture', value: true },\r\n        { name: 'useModel', value: false },\r\n        { name: 'alphaTest', value: false },\r\n        { name: 'useColor', value: true } ]\r\n    );\r\n    \r\n    this._mainTech = mainTech;\r\n    this._texture = null;\r\n  }\r\n\r\n  if ( Material$$1 ) SpriteMaterial.__proto__ = Material$$1;\r\n  SpriteMaterial.prototype = Object.create( Material$$1 && Material$$1.prototype );\r\n  SpriteMaterial.prototype.constructor = SpriteMaterial;\r\n\r\n  var prototypeAccessors = { effect: { configurable: true },useTexture: { configurable: true },useModel: { configurable: true },useColor: { configurable: true },texture: { configurable: true },color: { configurable: true } };\r\n\r\n  prototypeAccessors.effect.get = function () {\r\n    return this._effect;\r\n  };\r\n  \r\n  prototypeAccessors.useTexture.get = function () {\r\n    return this._effect.getDefine('useTexture');\r\n  };\r\n\r\n  prototypeAccessors.useTexture.set = function (val) {\r\n    this._effect.define('useTexture', val);\r\n  };\r\n  \r\n  prototypeAccessors.useModel.get = function () {\r\n    return this._effect.getDefine('useModel');\r\n  };\r\n\r\n  prototypeAccessors.useModel.set = function (val) {\r\n    this._effect.define('useModel', val);\r\n  };\r\n\r\n  prototypeAccessors.useColor.get = function () {\r\n    return this._effect.getDefine('useColor');\r\n  };\r\n\r\n  prototypeAccessors.useColor.set = function (val) {\r\n    this._effect.define('useColor', val);\r\n  };\r\n\r\n  prototypeAccessors.texture.get = function () {\r\n    return this._texture;\r\n  };\r\n\r\n  prototypeAccessors.texture.set = function (val) {\r\n    if (this._texture !== val) {\r\n      this._texture = val;\r\n      this._effect.setProperty('texture', val.getImpl());\r\n      this._texIds['texture'] = val.getId();\r\n    }\r\n  };\r\n\r\n  prototypeAccessors.color.get = function () {\r\n    return this._color;\r\n  };\r\n\r\n  prototypeAccessors.color.set = function (val) {\r\n    var color = this._color;\r\n    color.r = val.r / 255;\r\n    color.g = val.g / 255;\r\n    color.b = val.b / 255;\r\n    color.a = val.a / 255;\r\n    this._effect.setProperty('color', color);\r\n  };\r\n\r\n  SpriteMaterial.prototype.clone = function clone () {\r\n    var copy = new SpriteMaterial();\r\n    copy._mainTech.copy(this._mainTech);\r\n    copy.texture = this.texture;\r\n    copy.useTexture = this.useTexture;\r\n    copy.useModel = this.useModel;\r\n    copy.useColor = this.useColor;\r\n    copy.updateHash();\r\n    return copy;\r\n  };\r\n\r\n  Object.defineProperties( SpriteMaterial.prototype, prototypeAccessors );\r\n\r\n  return SpriteMaterial;\r\n}(Material));\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar GraySpriteMaterial = (function (Material$$1) {\r\n  function GraySpriteMaterial() {\r\n    Material$$1.call(this, false);\r\n\r\n    var pass = new renderer.Pass('gray_sprite');\r\n    pass.setDepth(false, false);\r\n    pass.setCullMode(gfx.CULL_NONE);\r\n    pass.setBlend(\r\n      gfx.BLEND_FUNC_ADD,\r\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA,\r\n      gfx.BLEND_FUNC_ADD,\r\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA\r\n    );\r\n\r\n    var mainTech = new renderer.Technique(\r\n      ['transparent'],\r\n      [\r\n        { name: 'texture', type: renderer.PARAM_TEXTURE_2D },\r\n        { name: 'color', type: renderer.PARAM_COLOR4 } ],\r\n      [\r\n        pass\r\n      ]\r\n    );\r\n\r\n    this._color = {r: 1, g: 1, b: 1, a: 1};\r\n    this._effect = new renderer.Effect(\r\n      [\r\n        mainTech ],\r\n      {\r\n        'color': this._color\r\n      },\r\n      []\r\n    );\r\n    \r\n    this._mainTech = mainTech;\r\n    this._texture = null;\r\n  }\r\n\r\n  if ( Material$$1 ) GraySpriteMaterial.__proto__ = Material$$1;\r\n  GraySpriteMaterial.prototype = Object.create( Material$$1 && Material$$1.prototype );\r\n  GraySpriteMaterial.prototype.constructor = GraySpriteMaterial;\r\n\r\n  var prototypeAccessors = { effect: { configurable: true },texture: { configurable: true },color: { configurable: true } };\r\n\r\n  prototypeAccessors.effect.get = function () {\r\n    return this._effect;\r\n  };\r\n\r\n  prototypeAccessors.texture.get = function () {\r\n    return this._texture;\r\n  };\r\n\r\n  prototypeAccessors.texture.set = function (val) {\r\n    if (this._texture !== val) {\r\n      this._texture = val;\r\n      this._effect.setProperty('texture', val.getImpl());\r\n      this._texIds['texture'] = val.getId();\r\n    }\r\n  };\r\n\r\n  prototypeAccessors.color.get = function () {\r\n    return this._color;\r\n  };\r\n\r\n  prototypeAccessors.color.set = function (val) {\r\n    var color = this._color;\r\n    color.r = val.r / 255;\r\n    color.g = val.g / 255;\r\n    color.b = val.b / 255;\r\n    color.a = val.a / 255;\r\n    this._effect.setProperty('color', color);\r\n  };\r\n\r\n  GraySpriteMaterial.prototype.clone = function clone () {\r\n    var copy = new GraySpriteMaterial();\r\n    copy._mainTech.copy(this._mainTech);\r\n    copy.texture = this.texture;\r\n    copy.color = this.color;\r\n    copy.updateHash();\r\n    return copy;\r\n  };\r\n\r\n  Object.defineProperties( GraySpriteMaterial.prototype, prototypeAccessors );\r\n\r\n  return GraySpriteMaterial;\r\n}(Material));\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar StencilMaterial = (function (Material$$1) {\r\n  function StencilMaterial() {\r\n    Material$$1.call(this, false);\r\n\r\n    this._pass = new renderer.Pass('sprite');\r\n    this._pass.setDepth(false, false);\r\n    this._pass.setCullMode(gfx.CULL_NONE);\r\n    this._pass.setBlend(\r\n      gfx.BLEND_FUNC_ADD,\r\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA,\r\n      gfx.BLEND_FUNC_ADD,\r\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA\r\n    );\r\n\r\n    var mainTech = new renderer.Technique(\r\n      ['transparent'],\r\n      [\r\n        { name: 'texture', type: renderer.PARAM_TEXTURE_2D },\r\n        { name: 'alphaThreshold', type: renderer.PARAM_FLOAT },\r\n        { name: 'color', type: renderer.PARAM_COLOR4 } ],\r\n      [\r\n        this._pass\r\n      ]\r\n    );\r\n\r\n    this._effect = new renderer.Effect(\r\n      [\r\n        mainTech ],\r\n      {\r\n        'color': {r: 1, g: 1, b: 1, a: 1}\r\n      },\r\n      [\r\n        { name: 'useTexture', value: true },\r\n        { name: 'useModel', value: false },\r\n        { name: 'alphaTest', value: true },\r\n        { name: 'useColor', value: true } ]\r\n    );\r\n    \r\n    this._mainTech = mainTech;\r\n    this._texture = null;\r\n  }\r\n\r\n  if ( Material$$1 ) StencilMaterial.__proto__ = Material$$1;\r\n  StencilMaterial.prototype = Object.create( Material$$1 && Material$$1.prototype );\r\n  StencilMaterial.prototype.constructor = StencilMaterial;\r\n\r\n  var prototypeAccessors = { effect: { configurable: true },useTexture: { configurable: true },useModel: { configurable: true },useColor: { configurable: true },texture: { configurable: true },alphaThreshold: { configurable: true } };\r\n\r\n  prototypeAccessors.effect.get = function () {\r\n    return this._effect;\r\n  };\r\n  \r\n  prototypeAccessors.useTexture.get = function () {\r\n    this._effect.getDefine('useTexture');\r\n  };\r\n\r\n  prototypeAccessors.useTexture.set = function (val) {\r\n    this._effect.define('useTexture', val);\r\n  };\r\n\r\n  prototypeAccessors.useModel.get = function () {\r\n    this._effect.getDefine('useModel');\r\n  };\r\n\r\n  prototypeAccessors.useModel.set = function (val) {\r\n    this._effect.define('useModel', val);\r\n  };\r\n\r\n  prototypeAccessors.useColor.get = function () {\r\n    this._effect.getDefine('useColor');\r\n  };\r\n\r\n  prototypeAccessors.useColor.set = function (val) {\r\n    this._effect.define('useColor', val);\r\n  };\r\n\r\n  prototypeAccessors.texture.get = function () {\r\n    return this._texture;\r\n  };\r\n\r\n  prototypeAccessors.texture.set = function (val) {\r\n    if (this._texture !== val) {\r\n      this._texture = val;\r\n      this._effect.setProperty('texture', val.getImpl());\r\n      this._texIds['texture'] = val.getId();\r\n    }\r\n  };\r\n  \r\n  prototypeAccessors.alphaThreshold.get = function () {\r\n    return this._effect.getProperty('alphaThreshold');\r\n  };\r\n\r\n  prototypeAccessors.alphaThreshold.set = function (val) {\r\n    this._effect.setProperty('alphaThreshold', val);\r\n  };\r\n\r\n  StencilMaterial.prototype.clone = function clone () {\r\n    var copy = new StencilMaterial();\r\n    copy._mainTech.copy(this._mainTech);\r\n    copy.useTexture = this.useTexture;\r\n    copy.useModel = this.useModel;\r\n    copy.useColor = this.useColor;\r\n    copy.texture = this.texture;\r\n    copy.alphaThreshold = this.alphaThreshold;\r\n    copy.updateHash();\r\n    return copy;\r\n  };\r\n\r\n  Object.defineProperties( StencilMaterial.prototype, prototypeAccessors );\r\n\r\n  return StencilMaterial;\r\n}(Material));\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar MeshMaterial = (function (Material$$1) {\r\n  function MeshMaterial() {\r\n    Material$$1.call(this, false);\r\n\r\n    var pass = new renderer.Pass('mesh');\r\n    pass.setDepth(false, false);\r\n    pass.setCullMode(gfx.CULL_NONE);\r\n    pass.setBlend(\r\n      gfx.BLEND_FUNC_ADD,\r\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA,\r\n      gfx.BLEND_FUNC_ADD,\r\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA\r\n    );\r\n\r\n    var mainTech = new renderer.Technique(\r\n      ['transparent'],\r\n      [\r\n        { name: 'texture', type: renderer.PARAM_TEXTURE_2D },\r\n        { name: 'color', type: renderer.PARAM_COLOR4 },\r\n\r\n        { name: 'u_jointsTexture', type: renderer.PARAM_TEXTURE_2D },\r\n        { name: 'u_jointsTextureSize', type: renderer.PARAM_FLOAT },\r\n        { name: 'u_jointMatrices', type: renderer.PARAM_MAT4 } ],\r\n      [\r\n        pass\r\n      ]\r\n    );\r\n\r\n    this._effect = new renderer.Effect(\r\n      [\r\n        mainTech ],\r\n      {\r\n        'color': {r: 1, g: 1, b: 1, a: 1}\r\n      },\r\n      [\r\n        { name: 'useTexture', value: true },\r\n        { name: 'useModel', value: false },\r\n        { name: 'useSkinning', value: false },\r\n        { name: 'useJointsTexture', valu: true},\r\n        { name: 'useAttributeColor', valu: false} ]\r\n    );\r\n\r\n    this._mainTech = mainTech;\r\n    this._texture = null;\r\n    this._jointsTexture = null;\r\n    this._jointsTextureSize = 0;\r\n    this._color = {r: 1, g: 1, b: 1, a: 1};\r\n    this._jointMatrices = null;\r\n  }\r\n\r\n  if ( Material$$1 ) MeshMaterial.__proto__ = Material$$1;\r\n  MeshMaterial.prototype = Object.create( Material$$1 && Material$$1.prototype );\r\n  MeshMaterial.prototype.constructor = MeshMaterial;\r\n\r\n  var prototypeAccessors = { effect: { configurable: true },useModel: { configurable: true },useTexture: { configurable: true },useSkinning: { configurable: true },useJointsTexture: { configurable: true },useAttributeColor: { configurable: true },texture: { configurable: true },jointMatrices: { configurable: true },jointsTexture: { configurable: true },jointsTextureSize: { configurable: true },color: { configurable: true } };\r\n\r\n  prototypeAccessors.effect.get = function () {\r\n    return this._effect;\r\n  };\r\n\r\n  prototypeAccessors.useModel.get = function () {\r\n    return this._effect.getDefine('useModel');\r\n  };\r\n\r\n  prototypeAccessors.useModel.set = function (val) {\r\n    this._effect.define('useModel', val);\r\n  };\r\n\r\n  prototypeAccessors.useTexture.get = function () {\r\n    return this._effect.getDefine('useTexture');\r\n  };\r\n\r\n  prototypeAccessors.useTexture.set = function (val) {\r\n    this._effect.define('useTexture', val);\r\n  };\r\n\r\n  prototypeAccessors.useSkinning.get = function () {\r\n    return this._effect.getDefine('useSkinning');\r\n  };\r\n\r\n  prototypeAccessors.useSkinning.set = function (val) {\r\n    this._effect.define('useSkinning', val);\r\n  };\r\n\r\n  prototypeAccessors.useJointsTexture.get = function () {\r\n    return this._effect.getDefine('useJointsTexture');\r\n  };\r\n\r\n  prototypeAccessors.useJointsTexture.set = function (val) {\r\n    this._effect.define('useJointsTexture', val);\r\n  };\r\n\r\n  prototypeAccessors.useAttributeColor.get = function () {\r\n    return this._effect.getDefine('useAttributeColor');\r\n  };\r\n\r\n  prototypeAccessors.useAttributeColor.set = function (val) {\r\n    this._effect.define('useAttributeColor', val);\r\n  };\r\n\r\n  prototypeAccessors.texture.get = function () {\r\n    return this._texture;\r\n  };\r\n\r\n  prototypeAccessors.texture.set = function (val) {\r\n    if (this._texture !== val) {\r\n      this._texture = val;\r\n      this._effect.setProperty('texture', val.getImpl());\r\n      this._texIds['texture'] = val.getId();\r\n    }\r\n  };\r\n\r\n  prototypeAccessors.jointMatrices.get = function () {\r\n    return this._jointMatrices;\r\n  };\r\n\r\n  prototypeAccessors.jointMatrices.set = function (val) {\r\n    this._jointMatrices = val;\r\n    this._effect.setProperty('u_jointMatrices', val);\r\n  };\r\n\r\n  prototypeAccessors.jointsTexture.get = function () {\r\n    return this._jointsTexture;\r\n  };\r\n\r\n  prototypeAccessors.jointsTexture.set = function (val) {\r\n    if (this._jointsTexture !== val) {\r\n      this._jointsTexture = val;\r\n      this._effect.setProperty('u_jointsTexture', val.getImpl());\r\n      this._texIds['jointsTexture'] = val.getId();\r\n    }\r\n  };\r\n\r\n  prototypeAccessors.jointsTextureSize.get = function () {\r\n    return this._jointsTextureSize;\r\n  };\r\n\r\n  prototypeAccessors.jointsTextureSize.set = function (val) {\r\n    if (this._jointsTextureSize !== val) {\r\n      this._jointsTextureSize = val;\r\n      this._effect.setProperty('u_jointsTextureSize', val);\r\n    }\r\n  };\r\n\r\n  prototypeAccessors.color.get = function () {\r\n    return this._effect.getProperty('color');\r\n  };\r\n\r\n  prototypeAccessors.color.set = function (val) {\r\n    var color = this._color;\r\n    color.r = val.r / 255;\r\n    color.g = val.g / 255;\r\n    color.b = val.b / 255;\r\n    color.a = val.a / 255;\r\n    this._effect.setProperty('color', color);\r\n  };\r\n\r\n  MeshMaterial.prototype.clone = function clone () {\r\n    var copy = new MeshMaterial();\r\n    copy.texture = this.texture;\r\n    copy.jointsTexture = this.jointsTexture;\r\n    copy.jointsTextureSize = this.jointsTextureSize;\r\n    copy.useTexture = this.useTexture;\r\n    copy.color = this.color;\r\n    copy.useModel = this.useModel;\r\n    copy.useSkinning = this.useSkinning;\r\n    copy.useJointsTexture = this.useJointsTexture;\r\n    copy.useAttributeColor = this.useAttributeColor;\r\n    copy.updateHash();\r\n    return copy;\r\n  };\r\n\r\n  Object.defineProperties( MeshMaterial.prototype, prototypeAccessors );\r\n\r\n  return MeshMaterial;\r\n}(Material));\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\nvar Device$2 = function Device(canvasEL) {\r\n  var ctx;\r\n\r\n  try {\r\n    ctx = canvasEL.getContext('2d');\r\n  } catch (err) {\r\n    console.error(err);\r\n    return;\r\n  }\r\n\r\n  // statics\r\n  this._canvas = canvasEL;\r\n  this._ctx = ctx;\r\n  this._caps = {}; // capability\r\n  this._stats = {\r\n    drawcalls: 0,\r\n  };\r\n\r\n  // runtime\r\n  this._vx = this._vy = this._vw = this._vh = 0;\r\n  this._sx = this._sy = this._sw = this._sh = 0;\r\n};\r\n\r\nDevice$2.prototype._restoreTexture = function _restoreTexture (unit) {\r\n};\r\n\r\n// ===============================\r\n// Immediate Settings\r\n// ===============================\r\n\r\n/**\r\n * @method setViewport\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} w\r\n * @param {Number} h\r\n */\r\nDevice$2.prototype.setViewport = function setViewport (x, y, w, h) {\r\n  if (\r\n    this._vx !== x ||\r\n    this._vy !== y ||\r\n    this._vw !== w ||\r\n    this._vh !== h\r\n  ) {\r\n    this._vx = x;\r\n    this._vy = y;\r\n    this._vw = w;\r\n    this._vh = h;\r\n  }\r\n};\r\n\r\n/**\r\n * @method setScissor\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} w\r\n * @param {Number} h\r\n */\r\nDevice$2.prototype.setScissor = function setScissor (x, y, w, h) {\r\n  if (\r\n    this._sx !== x ||\r\n    this._sy !== y ||\r\n    this._sw !== w ||\r\n    this._sh !== h\r\n  ) {\r\n    this._sx = x;\r\n    this._sy = y;\r\n    this._sw = w;\r\n    this._sh = h;\r\n  }\r\n};\r\n\r\nDevice$2.prototype.clear = function clear (color) {\r\n  var ctx = this._ctx;\r\n  ctx.clearRect(this._vx, this._vy, this._vw, this._vh);\r\n  if (color && (color[0] !== 0 || color[1] !== 0 || color[2] !== 0)) {\r\n    ctx.fillStyle = 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] +')';\r\n    ctx.globalAlpha = color[3];\r\n    ctx.fillRect(this._vx, this._vy, this._vw, this._vh);\r\n  }\r\n};\r\n\r\n// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.  \r\n \r\nvar Texture2D$2 = function Texture2D(device, options) {\r\n  this._device = device;\r\n    \r\n  this._width = 4;\r\n  this._height = 4;\r\n\r\n  this._image = null;\r\n\r\n  if (options) {\r\n    if (options.width !== undefined) {\r\n      this._width = options.width;\r\n    }\r\n    if (options.height !== undefined) {\r\n      this._height = options.height;\r\n    }\r\n\r\n    this.updateImage(options);\r\n  }\r\n};\r\n\r\nTexture2D$2.prototype.update = function update (options) {\r\n  this.updateImage(options);\r\n};\r\n\r\nTexture2D$2.prototype.updateImage = function updateImage (options) {\r\n  if (options.images && options.images[0]) {\r\n    var image = options.images[0];\r\n    if (image && image !== this._image) {\r\n      this._image = image;\r\n    }\r\n  }\r\n};\r\n\r\nTexture2D$2.prototype.destroy = function destroy () {\r\n  this._image = null;\r\n};\r\n\r\nvar canvas = {\r\n    Device: Device$2,\r\n    Texture2D: Texture2D$2\r\n};\r\n\r\n// intenral\r\n// deps\r\nvar Scene$2 = renderer.Scene;\r\nvar Camera$2 = renderer.Camera;\r\nvar View$2 = renderer.View;\r\nvar Texture2D$4 = gfx.Texture2D;\r\nvar Device$4 = gfx.Device;\r\nvar Model$2 = renderer.Model;\r\nvar InputAssembler$2 = renderer.InputAssembler;\r\n\r\nrenderer.addStage('transparent');\r\n\r\nvar renderEngine = {\r\n  // core classes\r\n  Device: Device$4,\r\n  ForwardRenderer: ForwardRenderer,\r\n  Texture2D: Texture2D$4,\r\n\r\n  // Canvas render support\r\n  canvas: canvas,\r\n\r\n  // render scene\r\n  Scene: Scene$2,\r\n  Camera: Camera$2,\r\n  View: View$2,\r\n  Model: Model$2,\r\n  RenderData: RenderData,\r\n  IARenderData: IARenderData,\r\n  InputAssembler: InputAssembler$2,\r\n  \r\n  // assets\r\n  Asset: Asset,\r\n  TextureAsset: Texture$2,\r\n  Material: Material,\r\n  \r\n  // materials\r\n  SpriteMaterial: SpriteMaterial,\r\n  GraySpriteMaterial: GraySpriteMaterial,\r\n  StencilMaterial: StencilMaterial,\r\n  MeshMaterial: MeshMaterial,\r\n\r\n  // shaders\r\n  shaders: shaders,\r\n\r\n  // memop\r\n  RecyclePool: RecyclePool,\r\n  Pool: Pool,\r\n\r\n  // modules\r\n  math: math,\r\n  renderer: renderer,\r\n  gfx: gfx,\r\n};\r\n\r\nmodule.exports = renderEngine;\r\n","const DONOTHING = 0;\r\nconst LOCAL_TRANSFORM = 1 << 0;\r\nconst WORLD_TRANSFORM = 1 << 1;\r\nconst TRANSFORM = LOCAL_TRANSFORM | WORLD_TRANSFORM;\r\nconst UPDATE_RENDER_DATA = 1 << 2;\r\nconst OPACITY = 1 << 3;\r\nconst COLOR = 1 << 4;\r\nconst RENDER = 1 << 5;\r\nconst CUSTOM_IA_RENDER = 1 << 6;\r\nconst CHILDREN = 1 << 7;\r\nconst POST_UPDATE_RENDER_DATA = 1 << 8;\r\nconst POST_RENDER = 1 << 9;\r\nconst FINAL = 1 << 10;\r\n\r\nlet _walker = null;\r\nlet _cullingMask = 0;\r\n\r\n// \r\nfunction RenderFlow () {\r\n    this._func = init;\r\n    this._next = null;\r\n}\r\n\r\nlet _proto = RenderFlow.prototype;\r\n_proto._doNothing = function () {\r\n};\r\n\r\n_proto._localTransform = function (node) {\r\n    node._updateLocalMatrix();\r\n    node._renderFlag &= ~LOCAL_TRANSFORM;\r\n    this._next._func(node);\r\n};\r\n\r\n_proto._worldTransform = function (node) {\r\n    _walker.worldMatDirty ++;\r\n\r\n    let t = node._matrix;\r\n    let position = node._position;\r\n    t.m12 = position.x;\r\n    t.m13 = position.y;\r\n\r\n    node._mulMat(node._worldMatrix, node._parent._worldMatrix, t);\r\n    node._renderFlag &= ~WORLD_TRANSFORM;\r\n    this._next._func(node);\r\n\r\n    _walker.worldMatDirty --;\r\n};\r\n\r\n_proto._color = function (node) {\r\n    let comp = node._renderComponent;\r\n    if (comp) {\r\n        comp._updateColor();\r\n    }\r\n    else {\r\n        node._renderFlag &= ~COLOR;\r\n    }\r\n    this._next._func(node);\r\n};\r\n\r\n_proto._opacity = function (node) {\r\n    _walker.parentOpacityDirty++;\r\n\r\n    node._renderFlag &= ~OPACITY;\r\n    this._next._func(node);\r\n\r\n    _walker.parentOpacityDirty--;\r\n};\r\n\r\n_proto._updateRenderData = function (node) {\r\n    let comp = node._renderComponent;\r\n    comp._assembler.updateRenderData(comp);\r\n    node._renderFlag &= ~UPDATE_RENDER_DATA;\r\n    this._next._func(node);\r\n};\r\n\r\n_proto._render = function (node) {\r\n    let comp = node._renderComponent;\r\n    _walker._commitComp(comp, comp._assembler, node._cullingMask);\r\n    this._next._func(node);\r\n};\r\n\r\n_proto._customIARender = function (node) {\r\n    let comp = node._renderComponent;\r\n    _walker._commitIA(comp, comp._assembler, node._cullingMask);\r\n    this._next._func(node);\r\n};\r\n\r\n_proto._children = function (node) {\r\n    let cullingMask = _cullingMask;\r\n\r\n    let parentOpacity = _walker.parentOpacity;\r\n    _walker.parentOpacity *= (node._opacity / 255);\r\n\r\n    let worldTransformFlag = _walker.worldMatDirty ? WORLD_TRANSFORM : 0;\r\n    let worldOpacityFlag = _walker.parentOpacityDirty ? COLOR : 0;\r\n\r\n    let children = node._children;\r\n    for (let i = 0, l = children.length; i < l; i++) {\r\n        let c = children[i];\r\n        // Advance the modification of the flag to avoid node attribute modification is invalid when opacity === 0.\r\n        c._renderFlag |= worldTransformFlag | worldOpacityFlag;\r\n        if (!c._activeInHierarchy || c._opacity === 0) continue;\r\n        _cullingMask = c._cullingMask = c.groupIndex === 0 ? cullingMask : 1 << c.groupIndex;\r\n\r\n        // TODO: Maybe has better way to implement cascade opacity\r\n        c._color.a = c._opacity * _walker.parentOpacity;\r\n        flows[c._renderFlag]._func(c);\r\n        c._color.a = 255;\r\n    }\r\n\r\n    _walker.parentOpacity = parentOpacity;\r\n\r\n    this._next._func(node);\r\n\r\n    _cullingMask = cullingMask;\r\n};\r\n\r\n_proto._postUpdateRenderData = function (node) {\r\n    let comp = node._renderComponent;\r\n    comp._postAssembler && comp._postAssembler.updateRenderData(comp);\r\n    node._renderFlag &= ~POST_UPDATE_RENDER_DATA;\r\n    this._next._func(node);\r\n};\r\n\r\n_proto._postRender = function (node) {\r\n    let comp = node._renderComponent;\r\n    _walker._commitComp(comp, comp._postAssembler, node._cullingMask);\r\n    this._next._func(node);\r\n};\r\n\r\nconst EMPTY_FLOW = new RenderFlow();\r\nEMPTY_FLOW._func = EMPTY_FLOW._doNothing;\r\nEMPTY_FLOW._next = EMPTY_FLOW;\r\n\r\nlet flows = {};\r\n\r\nfunction createFlow (flag, next) {\r\n    let flow = new RenderFlow();\r\n    flow._next = next || EMPTY_FLOW;\r\n\r\n    switch (flag) {\r\n        case DONOTHING: \r\n            flow._func = flow._doNothing;\r\n            break;\r\n        case LOCAL_TRANSFORM: \r\n            flow._func = flow._localTransform;\r\n            break;\r\n        case WORLD_TRANSFORM: \r\n            flow._func = flow._worldTransform;\r\n            break;\r\n        case COLOR:\r\n            flow._func = flow._color;\r\n            break;\r\n        case OPACITY:\r\n            flow._func = flow._opacity;\r\n            break;\r\n        case UPDATE_RENDER_DATA:\r\n            flow._func = flow._updateRenderData;\r\n            break;\r\n        case RENDER: \r\n            flow._func = flow._render;\r\n            break;\r\n        case CUSTOM_IA_RENDER:\r\n            flow._func = flow._customIARender;\r\n            break;\r\n        case CHILDREN: \r\n            flow._func = flow._children;\r\n            break;\r\n        case POST_UPDATE_RENDER_DATA: \r\n            flow._func = flow._postUpdateRenderData;\r\n            break;\r\n        case POST_RENDER: \r\n            flow._func = flow._postRender;\r\n            break;\r\n    }\r\n\r\n    return flow;\r\n}\r\n\r\nfunction getFlow (flag) {\r\n    let flow = null;\r\n    let tFlag = FINAL;\r\n    while (tFlag > 0) {\r\n        if (tFlag & flag)\r\n            flow = createFlow(tFlag, flow);\r\n        tFlag = tFlag >> 1;\r\n    }\r\n    return flow;\r\n}\r\n\r\n\r\nfunction render (scene) {\r\n    _cullingMask = 1 << scene.groupIndex;\r\n\r\n    if (scene._renderFlag & WORLD_TRANSFORM) {\r\n        _walker.worldMatDirty ++;\r\n        scene._calculWorldMatrix();\r\n        scene._renderFlag &= ~WORLD_TRANSFORM;\r\n\r\n        flows[scene._renderFlag]._func(scene);\r\n\r\n        _walker.worldMatDirty --;\r\n    }\r\n    else {\r\n        flows[scene._renderFlag]._func(scene);\r\n    }\r\n}\r\n\r\n// \r\nfunction init (node) {\r\n    let flag = node._renderFlag;\r\n    let r = flows[flag] = getFlow(flag);\r\n    r._func(node);\r\n}\r\n\r\nRenderFlow.flows = flows;\r\nRenderFlow.createFlow = createFlow;\r\nRenderFlow.render = render;\r\n\r\nRenderFlow.init = function (walker) {\r\n    _walker = walker;\r\n\r\n    flows[0] = EMPTY_FLOW;\r\n\r\n    for (let i = 1; i < FINAL; i++) {\r\n        flows[i] = new RenderFlow();\r\n    }\r\n};\r\n\r\nRenderFlow.FLAG_DONOTHING = DONOTHING;\r\nRenderFlow.FLAG_LOCAL_TRANSFORM = LOCAL_TRANSFORM;\r\nRenderFlow.FLAG_WORLD_TRANSFORM = WORLD_TRANSFORM;\r\nRenderFlow.FLAG_TRANSFORM = TRANSFORM;\r\nRenderFlow.FLAG_COLOR = COLOR;\r\nRenderFlow.FLAG_OPACITY = OPACITY;\r\nRenderFlow.FLAG_UPDATE_RENDER_DATA = UPDATE_RENDER_DATA;\r\nRenderFlow.FLAG_RENDER = RENDER;\r\nRenderFlow.FLAG_CUSTOM_IA_RENDER = CUSTOM_IA_RENDER;\r\nRenderFlow.FLAG_CHILDREN = CHILDREN;\r\nRenderFlow.FLAG_POST_UPDATE_RENDER_DATA = POST_UPDATE_RENDER_DATA;\r\nRenderFlow.FLAG_POST_RENDER = POST_RENDER;\r\nRenderFlow.FLAG_FINAL = FINAL;\r\n\r\nmodule.exports = cc.RenderFlow = RenderFlow;","const space = 2;\r\n\r\nfunction Atlas (width, height) {\r\n    let texture = new cc.RenderTexture();\r\n    texture.initWithSize(width, height);\r\n    texture.update();\r\n    \r\n    this._texture = texture;\r\n\r\n    this._x = space;\r\n    this._y = space;\r\n    this._nexty = space;\r\n\r\n    this._width = width;\r\n    this._height = height;\r\n\r\n    this._innerTextureInfos = {};\r\n    this._innerSpriteFrames = [];\r\n}\r\n\r\ncc.js.mixin(Atlas.prototype, {\r\n    insertSpriteFrame (spriteFrame) {\r\n        let rect = spriteFrame._rect,\r\n            texture = spriteFrame._texture,\r\n            info = this._innerTextureInfos[texture._id];\r\n\r\n        let sx = rect.x, sy = rect.y;\r\n\r\n        if (info) {\r\n            rect.x += info.x;\r\n            rect.y += info.y;\r\n        }\r\n        else {\r\n            let width = texture.width, height = texture.height;        \r\n\r\n            if ((this._x + width + space) > this._width) {\r\n                this._x = space;\r\n                this._y = this._nexty;\r\n            }\r\n\r\n            if ((this._y + height) > this._nexty) {\r\n                this._nexty = this._y + height + space;\r\n            }\r\n\r\n            if (this._nexty > this._height) {\r\n                return false;\r\n            }\r\n\r\n            // texture bleeding\r\n            this._texture.drawTextureAt(texture, this._x-1, this._y);\r\n            this._texture.drawTextureAt(texture, this._x+1, this._y);\r\n            this._texture.drawTextureAt(texture, this._x, this._y-1);\r\n            this._texture.drawTextureAt(texture, this._x, this._y+1);\r\n            this._texture.drawTextureAt(texture, this._x, this._y);\r\n\r\n            this._innerTextureInfos[texture._id] = {\r\n                x: this._x,\r\n                y: this._y,\r\n                texture: texture\r\n            };\r\n\r\n            rect.x += this._x;\r\n            rect.y += this._y;\r\n\r\n            this._x += width + space;\r\n\r\n            this._dirty = true;\r\n        }\r\n\r\n        spriteFrame._original = {\r\n            x: sx,\r\n            y: sy,\r\n            texture: spriteFrame._texture\r\n        }\r\n\r\n        spriteFrame._texture = this._texture;\r\n        spriteFrame._calculateUV();\r\n\r\n        this._innerSpriteFrames.push(spriteFrame);\r\n\r\n        return true;\r\n    },\r\n\r\n    update () {\r\n        if (!this._dirty) return;\r\n        this._texture.update();\r\n        this._dirty = false;\r\n    },\r\n\r\n    reset () {\r\n        this._x = space;\r\n        this._y = space;\r\n        this._nexty = space;\r\n\r\n        let frames = this._innerSpriteFrames;\r\n        for (let i = 0, l = frames.length; i < l; i++) {\r\n            let frame = frames[i];\r\n            if (!frame.isValid) {\r\n                continue;\r\n            }\r\n            let oriInfo = frame._original;\r\n            frame._rect.x = oriInfo.x;\r\n            frame._rect.y = oriInfo.y;\r\n            frame._texture = oriInfo.texture;\r\n            frame._calculateUV();\r\n            frame._original = null;\r\n        }\r\n        this._innerSpriteFrames.length = 0;\r\n        this._innerTextureInfos = {};\r\n    },\r\n\r\n    destroy () {\r\n        this.reset();\r\n        this._texture.destroy();\r\n    }\r\n});\r\n\r\nmodule.exports = Atlas;\r\n","const Atlas = require('./atlas');\r\n\r\nlet _atlases = [];\r\nlet _atlasIndex = -1;\r\n\r\nlet _maxAtlasCount = 5;\r\nlet _textureSize = 2048;\r\n// Smaller frame is more likely to be affected by linear filter\r\nlet _minFrameSize = 8;\r\nlet _maxFrameSize = 512;\r\n\r\n\r\nlet _debugNode = null;\r\n\r\nfunction newAtlas () {\r\n    let atlas = _atlases[++_atlasIndex]\r\n    if (!atlas) {\r\n        atlas = new Atlas(_textureSize, _textureSize);\r\n        _atlases.push(atlas);\r\n    }\r\n    return atlas;\r\n}\r\n\r\nfunction beforeSceneLoad () {\r\n    dynamicAtlasManager.reset();\r\n}\r\n\r\nlet _enabled = false;\r\n\r\n/**\r\n * !#en Manager the dynamic atlas.\r\n * !#zh \r\n * @class DynamicAtlasManager\r\n */\r\nlet dynamicAtlasManager = {\r\n    \r\n    /**\r\n     * !#en Enabled or Disabled dynamic atlas.\r\n     * !#zh \r\n     * @property enabled\r\n     * @type {Boolean}\r\n     */\r\n    get enabled () {\r\n        return _enabled;\r\n    },\r\n    set enabled (value) {\r\n        if (_enabled === value) return;\r\n\r\n        if (value) {\r\n            this.reset();\r\n            cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH, beforeSceneLoad);\r\n        }\r\n        else {\r\n            cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH, beforeSceneLoad);\r\n        }\r\n\r\n        _enabled = value;\r\n    },\r\n\r\n    /**\r\n     * !#en The maximum number of atlas that can be created.\r\n     * !#zh \r\n     * @property maxAtlasCount\r\n     * @type {Number}\r\n     */\r\n    get maxAtlasCount () {\r\n        return _maxAtlasCount;\r\n    },\r\n    set maxAtlasCount (value) {\r\n        _maxAtlasCount = value;\r\n    },\r\n\r\n    /**\r\n     * !#en The size of the atlas that was created\r\n     * !#zh \r\n     * @property textureSize\r\n     * @type {Number}\r\n     */\r\n    get textureSize () {\r\n        return _textureSize;\r\n    },\r\n    set textureSize (value) {\r\n        _textureSize = value;\r\n    },\r\n\r\n    /**\r\n     * !#en The maximum size of the picture that can be added to the atlas.\r\n     * !#zh \r\n     * @property maxFrameSize\r\n     * @type {Number}\r\n     */\r\n    get maxFrameSize () {\r\n        return _maxFrameSize;\r\n    },\r\n    set maxFrameSize (value) {\r\n        _maxFrameSize = value;\r\n    },\r\n\r\n    /**\r\n     * !#en Append a sprite frame into the dynamic atlas.\r\n     * !#zh \r\n     * @method insertSpriteFrame\r\n     * @param {SpriteFrame} spriteFrame \r\n     */\r\n    insertSpriteFrame (spriteFrame) {\r\n        if (CC_EDITOR) return;\r\n        if (!_enabled || _atlasIndex === _maxAtlasCount ||\r\n            !spriteFrame || spriteFrame._original) return;\r\n        \r\n        let texture = spriteFrame._texture;\r\n        if (texture instanceof cc.RenderTexture || cc.Texture2D._isCompressed(texture)) return;\r\n\r\n        let w = texture.width, h = texture.height;\r\n        let min = texture._minFilter, mag = texture._magFilter;\r\n        let LINEAR = cc.Texture2D.Filter.LINEAR;\r\n        if (w > _maxFrameSize || h > _maxFrameSize || w <= _minFrameSize || h <= _minFrameSize || (min & mag) !== LINEAR) {\r\n            return;\r\n        }\r\n\r\n        let atlas = _atlases[_atlasIndex];\r\n        if (!atlas) {\r\n            atlas = newAtlas();\r\n        }\r\n\r\n        if (!atlas.insertSpriteFrame(spriteFrame) && _atlasIndex !== _maxAtlasCount) {\r\n            atlas = newAtlas();\r\n            atlas.insertSpriteFrame(spriteFrame);\r\n        }\r\n    },\r\n\r\n    /** \r\n     * !#en Resets all dynamic atlas, and the existing ones will be destroyed.\r\n     * !#zh \r\n     * @method reset\r\n    */\r\n    reset () {\r\n        for (let i = 0, l = _atlases.length; i < l; i++) {\r\n            _atlases[i].destroy();\r\n        }\r\n        _atlases.length = 0;\r\n        _atlasIndex = -1;\r\n    },\r\n\r\n    /**\r\n     * !#en Displays all the dynamic atlas in the current scene, which you can use to view the current atlas state.\r\n     * !#zh \r\n     * @method showDebug\r\n     * @param {Boolean} show\r\n     */\r\n    showDebug: CC_DEV && function (show) {\r\n        if (show) {\r\n            if (!_debugNode || !_debugNode.isValid) {\r\n                let width = cc.visibleRect.width;\r\n                let height = cc.visibleRect.height;\r\n\r\n                _debugNode = new cc.Node('DYNAMIC_ATLAS_DEBUG_NODE');\r\n                _debugNode.width = width;\r\n                _debugNode.height = height;\r\n                _debugNode.x = width/2;\r\n                _debugNode.y = height/2;\r\n                _debugNode._zIndex = cc.macro.MAX_ZINDEX;\r\n                _debugNode.parent = cc.director.getScene();\r\n\r\n                _debugNode.groupIndex = cc.Node.BuiltinGroupIndex.DEBUG;\r\n                cc.Camera._setupDebugCamera();\r\n\r\n                let scroll = _debugNode.addComponent(cc.ScrollView);\r\n\r\n                let content = new cc.Node('CONTENT');\r\n                let layout = content.addComponent(cc.Layout);\r\n                layout.type = cc.Layout.Type.VERTICAL;\r\n                layout.resizeMode = cc.Layout.ResizeMode.CONTAINER;\r\n                content.parent = _debugNode;\r\n                content.width = _textureSize;\r\n                content.anchorY = 1;\r\n                content.x = _textureSize;\r\n\r\n                scroll.content = content;\r\n\r\n                for (let i = 0; i <= _atlasIndex; i++) {\r\n                    let node = new cc.Node('ATLAS');\r\n                    \r\n                    let texture = _atlases[i]._texture;\r\n                    let spriteFrame = new cc.SpriteFrame();\r\n                    spriteFrame.setTexture(_atlases[i]._texture);\r\n\r\n                    let sprite = node.addComponent(cc.Sprite)\r\n                    sprite.spriteFrame = spriteFrame;\r\n\r\n                    node.parent = content;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (_debugNode) {\r\n                _debugNode.parent = null;\r\n                _debugNode = null;\r\n            }\r\n        }\r\n    },\r\n\r\n    update () {\r\n        if (!this.enabled) return;\r\n\r\n        for (let i = 0; i <= _atlasIndex; i++) {\r\n            _atlases[i].update();\r\n        }\r\n    },\r\n};\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * @property dynamicAtlasManager\r\n * @type DynamicAtlasManager\r\n */\r\nmodule.exports = cc.dynamicAtlasManager = dynamicAtlasManager;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst macro = require('../../../platform/CCMacro');\r\n\r\nconst Label = require('../../../components/CCLabel');\r\nconst Overflow = Label.Overflow;\r\n\r\nconst textUtils = require('../../../utils/text-utils');\r\n\r\nlet FontLetterDefinition = function() {\r\n    this._u = 0;\r\n    this._v = 0;\r\n    this._width = 0;\r\n    this._height = 0;\r\n    this._offsetX = 0;\r\n    this._offsetY = 0;\r\n    this._textureID = 0;\r\n    this._validDefinition = false;\r\n    this._xAdvance = 0;\r\n};\r\n\r\ncc.FontAtlas = function (fntConfig) {\r\n    this._letterDefinitions = {};\r\n};\r\n\r\ncc.FontAtlas.prototype = {\r\n    constructor: cc.FontAtlas,\r\n    addLetterDefinitions: function(letter, letterDefinition) {\r\n        this._letterDefinitions[letter] = letterDefinition;\r\n    },\r\n    cloneLetterDefinition: function() {\r\n        let copyLetterDefinitions = {};\r\n        for (let key in this._letterDefinitions) {\r\n            let value = new FontLetterDefinition();\r\n            cc.js.mixin(value, this._letterDefinitions[key]);\r\n            copyLetterDefinitions[key] = value;\r\n        }\r\n        return copyLetterDefinitions;\r\n    },\r\n    assignLetterDefinitions: function(letterDefinition) {\r\n        for (let key in this._letterDefinitions) {\r\n            let newValue = letterDefinition[key];\r\n            let oldValue = this._letterDefinitions[key];\r\n            cc.js.mixin(oldValue, newValue);\r\n        }\r\n    },\r\n    scaleFontLetterDefinition: function(scaleFactor) {\r\n        for (let fontDefinition in this._letterDefinitions) {\r\n            let letterDefinitions = this._letterDefinitions[fontDefinition];\r\n            letterDefinitions._width *= scaleFactor;\r\n            letterDefinitions._height *= scaleFactor;\r\n            letterDefinitions._offsetX *= scaleFactor;\r\n            letterDefinitions._offsetY *= scaleFactor;\r\n            letterDefinitions._xAdvance *= scaleFactor;\r\n        }\r\n    },\r\n    getLetterDefinitionForChar: function(char) {\r\n        let hasKey = this._letterDefinitions.hasOwnProperty(char.charCodeAt(0));\r\n        let letterDefinition;\r\n        if (hasKey) {\r\n            letterDefinition = this._letterDefinitions[char.charCodeAt(0)];\r\n        } else {\r\n            letterDefinition = null;\r\n        }\r\n        return letterDefinition;\r\n    }\r\n};\r\n\r\nlet LetterInfo = function() {\r\n    this._char = '';\r\n    this._valid = true;\r\n    this._positionX = 0;\r\n    this._positionY = 0;\r\n    this._lineIndex = 0;\r\n};\r\n\r\nlet _tmpRect = cc.rect();\r\n\r\nlet _comp = null;\r\n\r\nlet _horizontalKernings = [];\r\nlet _lettersInfo = [];\r\nlet _linesWidth = [];\r\nlet _linesOffsetX = [];\r\nlet _labelDimensions = cc.size();\r\n\r\nlet _fontAtlas = null;\r\nlet _fntConfig = null;\r\nlet _numberOfLines = 0;\r\nlet _textDesiredHeight =  0;\r\nlet _letterOffsetY =  0;\r\nlet _tailoredTopY =  0;\r\nlet _tailoredBottomY =  0;\r\nlet _bmfontScale =  1.0;\r\nlet _lineBreakWithoutSpaces =  false;\r\nlet _spriteFrame = null;\r\nlet _lineSpacing = 0;\r\nlet _string = '';\r\nlet _fontSize = 0;\r\nlet _originFontSize = 0;\r\nlet _contentSize = cc.size();\r\nlet _hAlign = 0;\r\nlet _vAlign = 0;\r\nlet _spacingX = 0;\r\nlet _lineHeight = 0;\r\nlet _overflow = 0;\r\nlet _isWrapText = false;\r\nlet _labelWidth = 0;\r\nlet _labelHeight = 0;\r\nlet _maxLineWidth = 0;\r\n\r\nmodule.exports = {\r\n    updateRenderData (comp) {\r\n        if (!comp._renderData.vertDirty) return;\r\n        if (_comp === comp) return;\r\n\r\n        _comp = comp;\r\n        \r\n        this._updateProperties();\r\n        this._updateContent();\r\n        \r\n        _comp._actualFontSize = _fontSize;\r\n        _comp.node.setContentSize(_contentSize);\r\n\r\n        _comp._renderData.vertDirty = _comp._renderData.uvDirty = false;\r\n\r\n        _comp = null;\r\n        \r\n        this._resetProperties();\r\n    },\r\n\r\n    _updateFontScale () {\r\n        _bmfontScale = _fontSize / _originFontSize;\r\n    },\r\n\r\n    _updateProperties () {\r\n        let fontAsset = _comp.font;\r\n        _spriteFrame = fontAsset.spriteFrame;\r\n        _fntConfig = fontAsset._fntConfig;\r\n\r\n        _fontAtlas = _comp._fontAtlas;\r\n        if (!_fontAtlas) {\r\n            _fontAtlas = new cc.FontAtlas(_fntConfig);\r\n            \r\n            let fontDict = _fntConfig.fontDefDictionary;\r\n\r\n            for (let fontDef in fontDict) {\r\n                let letterDefinition = new FontLetterDefinition();\r\n\r\n                let rect = fontDict[fontDef].rect;\r\n\r\n                letterDefinition._offsetX = fontDict[fontDef].xOffset;\r\n                letterDefinition._offsetY = fontDict[fontDef].yOffset;\r\n                letterDefinition._width = rect.width;\r\n                letterDefinition._height = rect.height;\r\n                letterDefinition._u = rect.x;\r\n                letterDefinition._v = rect.y;\r\n                //FIXME: only one texture supported for now\r\n                letterDefinition._textureID = 0;\r\n                letterDefinition._validDefinition = true;\r\n                letterDefinition._xAdvance = fontDict[fontDef].xAdvance;\r\n\r\n                _fontAtlas.addLetterDefinitions(fontDef, letterDefinition);\r\n            }\r\n\r\n            _comp._fontAtlas = _fontAtlas;\r\n        }\r\n\r\n        _string = _comp.string.toString();\r\n        _fontSize = _comp.fontSize;\r\n        _originFontSize = _fntConfig.fontSize;\r\n        _contentSize.width = _comp.node._contentSize.width;\r\n        _contentSize.height = _comp.node._contentSize.height;\r\n        _hAlign = _comp.horizontalAlign;\r\n        _vAlign = _comp.verticalAlign;\r\n        _spacingX = _comp.spacingX;\r\n        _overflow = _comp.overflow;\r\n        _lineHeight = _comp._lineHeight;\r\n                \r\n        // should wrap text\r\n        if (_overflow === Overflow.NONE) {\r\n            _isWrapText = false;\r\n        }\r\n        else if (_overflow === Overflow.RESIZE_HEIGHT) {\r\n            _isWrapText = true;\r\n        }\r\n        else {\r\n            _isWrapText = _comp.enableWrapText;\r\n        }\r\n\r\n        this._setupBMFontOverflowMetrics();\r\n    },\r\n\r\n    _resetProperties () {\r\n        _fontAtlas = null;\r\n        _fntConfig = null;\r\n        _spriteFrame = null;\r\n    },\r\n\r\n    _updateContent () {\r\n        this._updateFontScale();\r\n        this._computeHorizontalKerningForText();\r\n        this._alignText();\r\n    },\r\n\r\n    _computeHorizontalKerningForText () {\r\n        let string = _string;\r\n        let stringLen = string.length;\r\n\r\n        let kerningDict = _fntConfig.kerningDict;\r\n        let horizontalKernings = _horizontalKernings;\r\n\r\n        let prev = -1;\r\n        for (let i = 0; i < stringLen; ++i) {\r\n            let key = string.charCodeAt(i);\r\n            let kerningAmount = kerningDict[(prev << 16) | (key & 0xffff)] || 0;\r\n            if (i < stringLen - 1) {\r\n                horizontalKernings[i] = kerningAmount;\r\n            } else {\r\n                horizontalKernings[i] = 0;\r\n            }\r\n            prev = key;\r\n        }\r\n    },\r\n\r\n    _multilineTextWrap: function(nextTokenFunc) {\r\n        let textLen = _string.length;\r\n\r\n        let lineIndex = 0;\r\n        let nextTokenX = 0;\r\n        let nextTokenY = 0;\r\n        let longestLine = 0;\r\n        let letterRight = 0;\r\n\r\n        let highestY = 0;\r\n        let lowestY = 0;\r\n        let letterDef = null;\r\n        let letterPosition = cc.v2(0, 0);\r\n\r\n        this._updateFontScale();\r\n\r\n        let letterDefinitions = _fontAtlas._letterDefinitions;\r\n\r\n        for (let index = 0; index < textLen;) {\r\n            let character = _string.charAt(index);\r\n            if (character === \"\\n\") {\r\n                _linesWidth.push(letterRight);\r\n                letterRight = 0;\r\n                lineIndex++;\r\n                nextTokenX = 0;\r\n                nextTokenY -= _lineHeight * _bmfontScale + _lineSpacing;\r\n                this._recordPlaceholderInfo(index, character);\r\n                index++;\r\n                continue;\r\n            }\r\n\r\n            let tokenLen = nextTokenFunc(_string, index, textLen);\r\n            let tokenHighestY = highestY;\r\n            let tokenLowestY = lowestY;\r\n            let tokenRight = letterRight;\r\n            let nextLetterX = nextTokenX;\r\n            let newLine = false;\r\n\r\n            for (let tmp = 0; tmp < tokenLen; ++tmp) {\r\n                let letterIndex = index + tmp;\r\n                character = _string.charAt(letterIndex);\r\n                if (character === \"\\r\") {\r\n                    this._recordPlaceholderInfo(letterIndex, character);\r\n                    continue;\r\n                }\r\n                letterDef = _fontAtlas.getLetterDefinitionForChar(character);\r\n                if (!letterDef) {\r\n                    this._recordPlaceholderInfo(letterIndex, character);\r\n                    console.log(\"Can't find letter definition in texture atlas \" + _fntConfig.atlasName + \" for letter:\" + character);\r\n                    continue;\r\n                }\r\n\r\n                let letterX = nextLetterX + letterDef._offsetX * _bmfontScale;\r\n\r\n                if (_isWrapText\r\n                    && _maxLineWidth > 0\r\n                    && nextTokenX > 0\r\n                    && letterX + letterDef._width * _bmfontScale > _maxLineWidth\r\n                    && !textUtils.isUnicodeSpace(character)) {\r\n                    _linesWidth.push(letterRight);\r\n                    letterRight = 0;\r\n                    lineIndex++;\r\n                    nextTokenX = 0;\r\n                    nextTokenY -= (_lineHeight * _bmfontScale + _lineSpacing);\r\n                    newLine = true;\r\n                    break;\r\n                } else {\r\n                    letterPosition.x = letterX;\r\n                }\r\n\r\n                letterPosition.y = nextTokenY - letterDef._offsetY * _bmfontScale;\r\n                this._recordLetterInfo(letterDefinitions, letterPosition, character, letterIndex, lineIndex);\r\n\r\n                if (letterIndex + 1 < _horizontalKernings.length && letterIndex < textLen - 1) {\r\n                    nextLetterX += _horizontalKernings[letterIndex + 1];\r\n                }\r\n\r\n                nextLetterX += letterDef._xAdvance * _bmfontScale + _spacingX;\r\n\r\n                tokenRight = letterPosition.x + letterDef._width * _bmfontScale;\r\n\r\n                if (tokenHighestY < letterPosition.y) {\r\n                    tokenHighestY = letterPosition.y;\r\n                }\r\n\r\n                if (tokenLowestY > letterPosition.y - letterDef._height * _bmfontScale) {\r\n                    tokenLowestY = letterPosition.y - letterDef._height * _bmfontScale;\r\n                }\r\n\r\n            } //end of for loop\r\n\r\n            if (newLine) continue;\r\n\r\n            nextTokenX = nextLetterX;\r\n            letterRight = tokenRight;\r\n\r\n            if (highestY < tokenHighestY) {\r\n                highestY = tokenHighestY;\r\n            }\r\n            if (lowestY > tokenLowestY) {\r\n                lowestY = tokenLowestY;\r\n            }\r\n            if (longestLine < letterRight) {\r\n                longestLine = letterRight;\r\n            }\r\n\r\n            index += tokenLen;\r\n        } //end of for loop\r\n\r\n        _linesWidth.push(letterRight);\r\n\r\n        _numberOfLines = lineIndex + 1;\r\n        _textDesiredHeight = _numberOfLines * _lineHeight * _bmfontScale;\r\n        if (_numberOfLines > 1) {\r\n            _textDesiredHeight += (_numberOfLines - 1) * _lineSpacing;\r\n        }\r\n\r\n        _contentSize.width = _labelWidth;\r\n        _contentSize.height = _labelHeight;\r\n        if (_labelWidth <= 0) {\r\n            _contentSize.width = parseFloat(longestLine.toFixed(2));\r\n        }\r\n        if (_labelHeight <= 0) {\r\n            _contentSize.height = parseFloat(_textDesiredHeight.toFixed(2));\r\n        }\r\n\r\n        _tailoredTopY = _contentSize.height;\r\n        _tailoredBottomY = 0;\r\n        if (highestY > 0) {\r\n            _tailoredTopY = _contentSize.height + highestY;\r\n        }\r\n        if (lowestY < -_textDesiredHeight) {\r\n            _tailoredBottomY = _textDesiredHeight + lowestY;\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    _getFirstCharLen: function() {\r\n        return 1;\r\n    },\r\n\r\n    _getFirstWordLen: function(text, startIndex, textLen) {\r\n        let character = text.charAt(startIndex);\r\n        if (textUtils.isUnicodeCJK(character)\r\n            || character === \"\\n\"\r\n            || textUtils.isUnicodeSpace(character)) {\r\n            return 1;\r\n        }\r\n\r\n        let len = 1;\r\n        let letterDef = _fontAtlas.getLetterDefinitionForChar(character);\r\n        if (!letterDef) {\r\n            return len;\r\n        }\r\n        let nextLetterX = letterDef._xAdvance * _bmfontScale + _spacingX;\r\n        let letterX;\r\n        for (let index = startIndex + 1; index < textLen; ++index) {\r\n            character = text.charAt(index);\r\n\r\n            letterDef = _fontAtlas.getLetterDefinitionForChar(character);\r\n            if (!letterDef) {\r\n                break;\r\n            }\r\n            letterX = nextLetterX + letterDef._offsetX * _bmfontScale;\r\n\r\n            if(letterX + letterDef._width * _bmfontScale > _maxLineWidth\r\n               && !textUtils.isUnicodeSpace(character)\r\n               && _maxLineWidth > 0) {\r\n                return len;\r\n            }\r\n            nextLetterX += letterDef._xAdvance * _bmfontScale + _spacingX;\r\n            if (character === \"\\n\"\r\n                || textUtils.isUnicodeSpace(character)\r\n                || textUtils.isUnicodeCJK(character)) {\r\n                break;\r\n            }\r\n            len++;\r\n        }\r\n\r\n        return len;\r\n    },\r\n\r\n    _multilineTextWrapByWord: function() {\r\n        return this._multilineTextWrap(this._getFirstWordLen);\r\n    },\r\n\r\n    _multilineTextWrapByChar: function() {\r\n        return this._multilineTextWrap(this._getFirstCharLen);\r\n    },\r\n\r\n    _recordPlaceholderInfo: function(letterIndex, char) {\r\n        if (letterIndex >= _lettersInfo.length) {\r\n            let tmpInfo = new LetterInfo();\r\n            _lettersInfo.push(tmpInfo);\r\n        }\r\n\r\n        _lettersInfo[letterIndex]._char = char;\r\n        _lettersInfo[letterIndex]._valid = false;\r\n    },\r\n\r\n    _recordLetterInfo: function(letterDefinitions, letterPosition, character, letterIndex, lineIndex) {\r\n        if (letterIndex >= _lettersInfo.length) {\r\n            let tmpInfo = new LetterInfo();\r\n            _lettersInfo.push(tmpInfo);\r\n        }\r\n        character = character.charCodeAt(0);\r\n\r\n        _lettersInfo[letterIndex]._lineIndex = lineIndex;\r\n        _lettersInfo[letterIndex]._char = character;\r\n        _lettersInfo[letterIndex]._valid = letterDefinitions[character]._validDefinition;\r\n        _lettersInfo[letterIndex]._positionX = letterPosition.x;\r\n        _lettersInfo[letterIndex]._positionY = letterPosition.y;\r\n    },\r\n\r\n    _alignText: function() {\r\n        _textDesiredHeight = 0;\r\n        _linesWidth.length = 0;\r\n\r\n        if (!_lineBreakWithoutSpaces) {\r\n            this._multilineTextWrapByWord();\r\n        } else {\r\n            this._multilineTextWrapByChar();\r\n        }\r\n\r\n        this._computeAlignmentOffset();\r\n\r\n        //shrink\r\n        if (_overflow === Overflow.SHRINK) {\r\n            if (_fontSize > 0 && this._isVerticalClamp()) {\r\n                this._shrinkLabelToContentSize(this._isVerticalClamp);\r\n            }\r\n        }\r\n\r\n        if (!this._updateQuads()) {\r\n            if (_overflow === Overflow.SHRINK) {\r\n                this._shrinkLabelToContentSize(this._isHorizontalClamp);\r\n            }\r\n        }\r\n    },\r\n\r\n    _scaleFontSizeDown (fontSize) {\r\n        let shouldUpdateContent = true;\r\n        if (!fontSize) {\r\n            fontSize = 0.1;\r\n            shouldUpdateContent = false;\r\n        }\r\n        _fontSize = fontSize;\r\n\r\n        if (shouldUpdateContent) {\r\n            this._updateContent();\r\n        }\r\n    },\r\n\r\n    _shrinkLabelToContentSize (lambda) {\r\n        let fontSize = _fontSize;\r\n        let originalLineHeight = _lineHeight;\r\n        let fontAtlas = _fontAtlas;\r\n        \r\n        let i = 0;\r\n        let tempLetterDefinition = fontAtlas.cloneLetterDefinition();\r\n        let flag = true;\r\n\r\n        while (lambda()) {\r\n            ++i;\r\n\r\n            let newFontSize = fontSize - i;\r\n            flag = false;\r\n            if (newFontSize <= 0) {\r\n                break;\r\n            }\r\n\r\n            let scale = newFontSize / fontSize;\r\n            fontAtlas.assignLetterDefinitions(tempLetterDefinition);\r\n            fontAtlas.scaleFontLetterDefinition(scale);\r\n            _lineHeight = originalLineHeight * scale;\r\n            if (!_lineBreakWithoutSpaces) {\r\n                this._multilineTextWrapByWord();\r\n            } else {\r\n                this._multilineTextWrapByChar();\r\n            }\r\n            this._computeAlignmentOffset();\r\n        }\r\n\r\n        _lineHeight = originalLineHeight;\r\n        fontAtlas.assignLetterDefinitions(tempLetterDefinition);\r\n\r\n        if (!flag) {\r\n            if (fontSize - i >= 0) {\r\n                this._scaleFontSizeDown(fontSize - i);\r\n            }\r\n        }\r\n    },\r\n\r\n    _isVerticalClamp () {\r\n        if (_textDesiredHeight > _contentSize.height) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    },\r\n\r\n    _isHorizontalClamp () {\r\n        let letterDefinitions = _fontAtlas._letterDefinitions;\r\n        let letterClamp = false;\r\n        for (let ctr = 0, l = _string.length; ctr < l; ++ctr) {\r\n            let letterInfo = _lettersInfo[ctr];\r\n            if (letterInfo._valid) {\r\n                let letterDef = letterDefinitions[letterInfo._char];\r\n\r\n                let px = letterInfo._positionX + letterDef._width / 2 * _bmfontScale;\r\n                let lineIndex = letterInfo._lineIndex;\r\n                if (_labelWidth > 0) {\r\n                    if (!_isWrapText) {\r\n                        if(px > _contentSize.width){\r\n                            letterClamp = true;\r\n                            break;\r\n                        }\r\n                    }else{\r\n                        let wordWidth = _linesWidth[lineIndex];\r\n                        if (wordWidth > _contentSize.width && (px > _contentSize.width || px < 0)) {\r\n                            letterClamp = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return letterClamp;\r\n    },\r\n\r\n    _isHorizontalClamped (px, lineIndex) {\r\n        let wordWidth = _linesWidth[lineIndex];\r\n        let letterOverClamp = (px > _contentSize.width || px < 0);\r\n\r\n        if(!_isWrapText){\r\n            return letterOverClamp;\r\n        }else{\r\n            return (wordWidth > _contentSize.width && letterOverClamp);\r\n        }\r\n    },\r\n\r\n    _updateQuads () {\r\n        let letterDefinitions = _fontAtlas._letterDefinitions;\r\n        \r\n        let texture = _spriteFrame._texture;\r\n\r\n        let node = _comp.node;\r\n        let renderData = _comp._renderData;\r\n        renderData.dataLength = renderData.vertexCount = renderData.indiceCount = 0;\r\n\r\n        let contentSize = _contentSize,\r\n            appx = node._anchorPoint.x * contentSize.width,\r\n            appy = node._anchorPoint.y * contentSize.height;\r\n        \r\n        let ret = true;\r\n        for (let ctr = 0, l = _string.length; ctr < l; ++ctr) {\r\n            let letterInfo = _lettersInfo[ctr];\r\n            if (!letterInfo._valid) continue;\r\n            let letterDef = letterDefinitions[letterInfo._char];\r\n\r\n            _tmpRect.height = letterDef._height;\r\n            _tmpRect.width = letterDef._width;\r\n            _tmpRect.x = letterDef._u;\r\n            _tmpRect.y = letterDef._v;\r\n\r\n            let py = letterInfo._positionY + _letterOffsetY;\r\n\r\n            if (_labelHeight > 0) {\r\n                if (py > _tailoredTopY) {\r\n                    let clipTop = py - _tailoredTopY;\r\n                    _tmpRect.y += clipTop;\r\n                    _tmpRect.height -= clipTop;\r\n                    py = py - clipTop;\r\n                }\r\n\r\n                if (py - letterDef._height * _bmfontScale < _tailoredBottomY) {\r\n                    _tmpRect.height = (py < _tailoredBottomY) ? 0 : (py - _tailoredBottomY);\r\n                }\r\n            }\r\n\r\n            let lineIndex = letterInfo._lineIndex;\r\n            let px = letterInfo._positionX + letterDef._width / 2 * _bmfontScale + _linesOffsetX[lineIndex];\r\n\r\n            if (_labelWidth > 0) {\r\n                if (this._isHorizontalClamped(px, lineIndex)) {\r\n                    if (_overflow === Overflow.CLAMP) {\r\n                        _tmpRect.width = 0;\r\n                    } else if (_overflow === Overflow.SHRINK) {\r\n                        if (_contentSize.width > letterDef._width) {\r\n                            ret = false;\r\n                            break;\r\n                        } else {\r\n                            _tmpRect.width = 0;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (_tmpRect.height > 0 && _tmpRect.width > 0) {\r\n                let isRotated = _spriteFrame.isRotated();\r\n\r\n                let originalSize = _spriteFrame._originalSize;\r\n                let rect = _spriteFrame._rect;\r\n                let offset = _spriteFrame._offset;\r\n                let trimmedLeft = offset.x + (originalSize.width - rect.width) / 2;\r\n                let trimmedTop = offset.y - (originalSize.height - rect.height) / 2;\r\n\r\n                if(!isRotated) {\r\n                    _tmpRect.x += (rect.x - trimmedLeft);\r\n                    _tmpRect.y += (rect.y + trimmedTop);\r\n                } else {\r\n                    let originalX = _tmpRect.x;\r\n                    _tmpRect.x = rect.x + rect.height - _tmpRect.y - _tmpRect.height - trimmedTop;\r\n                    _tmpRect.y = originalX + rect.y - trimmedLeft;\r\n                    if (_tmpRect.y < 0) {\r\n                        _tmpRect.height = _tmpRect.height + trimmedTop;\r\n                    }\r\n                }\r\n\r\n                let letterPositionX = letterInfo._positionX + _linesOffsetX[letterInfo._lineIndex];\r\n                this.appendQuad(renderData, texture, _tmpRect, isRotated, letterPositionX - appx, py - appy, _bmfontScale);\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    },\r\n\r\n    appendQuad (renderData, texture, rect, rotated, x, y, scale) {\r\n    },\r\n\r\n    _computeAlignmentOffset: function() {\r\n        _linesOffsetX.length = 0;\r\n        \r\n        switch (_hAlign) {\r\n            case macro.TextAlignment.LEFT:\r\n                for (let i = 0; i < _numberOfLines; ++i) {\r\n                    _linesOffsetX.push(0);\r\n                }\r\n                break;\r\n            case macro.TextAlignment.CENTER:\r\n                for (let i = 0, l = _linesWidth.length; i < l; i++) {\r\n                    _linesOffsetX.push((_contentSize.width - _linesWidth[i]) / 2);\r\n                }\r\n                break;\r\n            case macro.TextAlignment.RIGHT:\r\n                for (let i = 0, l = _linesWidth.length; i < l; i++) {\r\n                    _linesOffsetX.push(_contentSize.width - _linesWidth[i]);\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        switch (_vAlign) {\r\n            case macro.VerticalTextAlignment.TOP:\r\n                _letterOffsetY = _contentSize.height;\r\n                break;\r\n            case macro.VerticalTextAlignment.CENTER:\r\n                _letterOffsetY = (_contentSize.height + _textDesiredHeight) / 2;\r\n                break;\r\n            case macro.VerticalTextAlignment.BOTTOM:\r\n                _letterOffsetY = _textDesiredHeight;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n\r\n    _setupBMFontOverflowMetrics () {\r\n        let newWidth = _contentSize.width,\r\n            newHeight = _contentSize.height;\r\n\r\n        if (_overflow === Overflow.RESIZE_HEIGHT) {\r\n            newHeight = 0;\r\n        }\r\n\r\n        if (_overflow === Overflow.NONE) {\r\n            newWidth = 0;\r\n            newHeight = 0;\r\n        }\r\n\r\n        _labelWidth = newWidth;\r\n        _labelHeight = newHeight;\r\n        _labelDimensions.width = newWidth;\r\n        _labelDimensions.height = newHeight;\r\n        _maxLineWidth = newWidth;\r\n    }\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst macro = require('../../../platform/CCMacro');\r\nconst textUtils = require('../../../utils/text-utils');\r\n\r\nconst Component = require('../../../components/CCComponent');\r\nconst Label = require('../../../components/CCLabel');\r\nconst LabelOutline = require('../../../components/CCLabelOutline');\r\nconst Overflow = Label.Overflow;\r\n\r\nconst WHITE = cc.Color.WHITE;\r\nconst OUTLINE_SUPPORTED = cc.js.isChildClassOf(LabelOutline, Component);\r\n\r\nlet _context = null;\r\nlet _canvas = null;\r\nlet _texture = null;\r\n\r\nlet _fontDesc = '';\r\nlet _string = '';\r\nlet _fontSize = 0;\r\nlet _drawFontsize = 0;\r\nlet _splitedStrings = [];\r\nlet _canvasSize = cc.size();\r\nlet _lineHeight = 0;\r\nlet _hAlign = 0;\r\nlet _vAlign = 0;\r\nlet _color = null;\r\nlet _fontFamily = '';\r\nlet _overflow = Overflow.NONE;\r\nlet _isWrapText = false;\r\n\r\n// outline\r\nlet _isOutlined = false;\r\nlet _outlineColor = null;\r\nlet _outlineWidth = 0;\r\nlet _margin = 0;\r\n\r\nlet _isBold = false;\r\nlet _isItalic = false;\r\nlet _isUnderline = false;\r\n\r\nlet _sharedLabelData;\r\n\r\n//\r\nlet _canvasPool = {\r\n    pool: [],\r\n    get () {\r\n        let data = this.pool.pop();\r\n\r\n        if (!data) {\r\n            let canvas = document.createElement(\"canvas\");\r\n            let context = canvas.getContext(\"2d\");\r\n            data = {\r\n                canvas: canvas,\r\n                context: context\r\n            }\r\n        }\r\n\r\n        return data;\r\n    },\r\n    put (canvas) {\r\n        if (this.pool.length >= 32) {\r\n            return;\r\n        }\r\n        this.pool.push(canvas);\r\n    }\r\n};\r\n\r\n\r\nmodule.exports = {\r\n\r\n    _getAssemblerData () {\r\n        if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            _sharedLabelData = _canvasPool.get();\r\n        }\r\n        else {\r\n            if (!_sharedLabelData) {\r\n                let labelCanvas = document.createElement(\"canvas\");\r\n                _sharedLabelData = {\r\n                    canvas: labelCanvas,\r\n                    context: labelCanvas.getContext(\"2d\")\r\n                };\r\n            }\r\n        }\r\n        _sharedLabelData.canvas.width = _sharedLabelData.canvas.height = 1;\r\n        return _sharedLabelData;\r\n    },\r\n\r\n    _resetAssemblerData (assemblerData) {\r\n        if (cc.game.renderType === cc.game.RENDER_TYPE_CANVAS && assemblerData) {\r\n            _canvasPool.put(assemblerData);\r\n        }\r\n    },\r\n\r\n    updateRenderData (comp) {\r\n        if (!comp._renderData.vertDirty) return;\r\n\r\n        this._updateFontFamily(comp);\r\n        this._updateProperties(comp);\r\n        this._calculateLabelFont();\r\n        this._calculateSplitedStrings();\r\n        this._updateLabelDimensions();\r\n        this._calculateTextBaseline();\r\n        this._updateTexture(comp);\r\n\r\n        comp._actualFontSize = _fontSize;\r\n        comp.node.setContentSize(_canvasSize);\r\n\r\n        this._updateVerts(comp);\r\n\r\n        comp._renderData.vertDirty = comp._renderData.uvDirty = false;\r\n\r\n        _context = null;\r\n        _canvas = null;\r\n        _texture = null;\r\n    },\r\n\r\n    _updateVerts () {\r\n    },\r\n\r\n    _updateFontFamily (comp) {\r\n        if (!comp.useSystemFont) {\r\n            if (comp.font) {\r\n                if (comp.font._nativeAsset) {\r\n                    _fontFamily = comp.font._nativeAsset;\r\n                }\r\n                else {\r\n                    cc.loader.load(comp.font.nativeUrl, function (err, fontFamily) {\r\n                        _fontFamily = fontFamily || 'Arial';\r\n                        comp.font._nativeAsset = fontFamily;\r\n                        comp._updateRenderData(true);\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                _fontFamily = 'Arial';\r\n            }\r\n        }\r\n        else {\r\n            _fontFamily = comp.fontFamily;\r\n        }\r\n    },\r\n\r\n    _updateProperties (comp) {\r\n        let assemblerData = comp._assemblerData;\r\n        _context = assemblerData.context;\r\n        _canvas = assemblerData.canvas;\r\n        _texture = comp._texture;\r\n        \r\n        _string = comp.string.toString();\r\n        _fontSize = comp._fontSize;\r\n        _drawFontsize = _fontSize;\r\n        _overflow = comp.overflow;\r\n        _canvasSize.width = comp.node.width;\r\n        _canvasSize.height = comp.node.height;\r\n        _lineHeight = comp._lineHeight;\r\n        _hAlign = comp.horizontalAlign;\r\n        _vAlign = comp.verticalAlign;\r\n        _color = comp.node.color;\r\n        _isBold = comp._isBold;\r\n        _isItalic = comp._isItalic;\r\n        _isUnderline = comp._isUnderline;\r\n\r\n        if (_overflow === Overflow.NONE) {\r\n            _isWrapText = false;\r\n        }\r\n        else if (_overflow === Overflow.RESIZE_HEIGHT) {\r\n            _isWrapText = true;\r\n        }\r\n        else {\r\n            _isWrapText = comp.enableWrapText;\r\n        }\r\n\r\n        // outline\r\n        let outline = OUTLINE_SUPPORTED && comp.getComponent(LabelOutline);\r\n        if (outline && outline.enabled) {\r\n            _isOutlined = true;\r\n            _margin = _outlineWidth = outline.width;\r\n            _outlineColor = cc.color(outline.color);\r\n            // TODO: temporary solution, cascade opacity for outline color\r\n            _outlineColor.a = _outlineColor.a * comp.node.color.a / 255.0;\r\n        }\r\n        else {\r\n            _isOutlined = false;\r\n            _margin = 0;\r\n        }\r\n    },\r\n\r\n    _calculateFillTextStartPosition () {\r\n        let lineHeight = this._getLineHeight();\r\n        let lineCount = _splitedStrings.length;\r\n        let labelX;\r\n        let firstLinelabelY;\r\n\r\n        if (_hAlign === macro.TextAlignment.RIGHT) {\r\n            labelX = _canvasSize.width - _margin;\r\n        }\r\n        else if (_hAlign === macro.TextAlignment.CENTER) {\r\n            labelX = _canvasSize.width / 2;\r\n        }\r\n        else {\r\n            labelX = 0 + _margin;\r\n        }\r\n\r\n        if (_vAlign === macro.VerticalTextAlignment.TOP) {\r\n            firstLinelabelY = 0;\r\n        }\r\n        else if (_vAlign === macro.VerticalTextAlignment.CENTER) {\r\n            firstLinelabelY = _canvasSize.height / 2 - lineHeight * (lineCount - 1) / 2;\r\n        }\r\n        else {\r\n            firstLinelabelY = _canvasSize.height - lineHeight * (lineCount - 1);\r\n        }\r\n\r\n        return cc.v2(labelX, firstLinelabelY);\r\n    },\r\n\r\n    _updateTexture () {\r\n        _context.clearRect(0, 0, _canvas.width, _canvas.height);\r\n        _context.font = _fontDesc;\r\n\r\n        let startPosition = this._calculateFillTextStartPosition();\r\n        let lineHeight = this._getLineHeight();\r\n        //use round for line join to avoid sharp intersect point\r\n        _context.lineJoin = 'round';\r\n        _context.fillStyle = `rgba(${_color.r}, ${_color.g}, ${_color.b}, ${_color.a / 255})`;\r\n        let underlineStartPosition;\r\n\r\n        //do real rendering\r\n        for (let i = 0; i < _splitedStrings.length; ++i) {\r\n            if (_isOutlined) {\r\n                let strokeColor = _outlineColor || WHITE;\r\n                _context.strokeStyle = `rgba(${strokeColor.r}, ${strokeColor.g}, ${strokeColor.b}, ${strokeColor.a / 255})`;\r\n                _context.lineWidth = _outlineWidth * 2;\r\n                _context.strokeText(_splitedStrings[i], startPosition.x, startPosition.y + i * lineHeight);\r\n            }\r\n            _context.fillText(_splitedStrings[i], startPosition.x, startPosition.y + i * lineHeight);\r\n\r\n            if (_isUnderline) {\r\n                underlineStartPosition = this._calculateUnderlineStartPosition();\r\n                _context.save();\r\n                _context.beginPath();\r\n                _context.lineWidth = _fontSize / 8;\r\n                _context.strokeStyle = `rgba(${_color.r}, ${_color.g}, ${_color.b}, ${_color.a / 255})`;\r\n                _context.moveTo(underlineStartPosition.x, underlineStartPosition.y + i * lineHeight - 1);\r\n                _context.lineTo(underlineStartPosition.x + _canvas.width, underlineStartPosition.y + i * lineHeight - 1);\r\n                _context.stroke();\r\n                _context.restore();\r\n            }\r\n        }\r\n\r\n        _texture.handleLoadedTexture();\r\n    },\r\n\r\n    _calculateUnderlineStartPosition () {\r\n        let lineHeight = this._getLineHeight();\r\n        let lineCount = _splitedStrings.length;\r\n        let labelX;\r\n        let firstLinelabelY;\r\n\r\n        labelX = 0 + _margin;\r\n\r\n        if (_vAlign === macro.VerticalTextAlignment.TOP) {\r\n            firstLinelabelY = _fontSize;\r\n        }\r\n        else if (_vAlign === macro.VerticalTextAlignment.CENTER) {\r\n            firstLinelabelY = _canvasSize.height / 2 - lineHeight * (lineCount - 1) / 2 + _fontSize / 2;\r\n        }\r\n        else {\r\n            firstLinelabelY = _canvasSize.height - lineHeight * (lineCount - 1);\r\n        }\r\n\r\n        return cc.v2(labelX, firstLinelabelY);\r\n    },\r\n\r\n    _updateLabelDimensions () {\r\n        let paragraphedStrings = _string.split('\\n');\r\n\r\n        if (_overflow === Overflow.RESIZE_HEIGHT) {\r\n            _canvasSize.height = _splitedStrings.length * this._getLineHeight();\r\n        }\r\n        else if (_overflow === Overflow.NONE) {\r\n            _splitedStrings = paragraphedStrings;\r\n            let canvasSizeX = 0;\r\n            let canvasSizeY = 0;\r\n            for (let i = 0; i < paragraphedStrings.length; ++i) {\r\n                let paraLength = textUtils.safeMeasureText(_context, paragraphedStrings[i]);\r\n                canvasSizeX = canvasSizeX > paraLength ? canvasSizeX : paraLength;\r\n            }\r\n            canvasSizeY = _splitedStrings.length * this._getLineHeight();\r\n\r\n            _canvasSize.width = parseFloat(canvasSizeX.toFixed(2)) + 2 * _margin;\r\n            _canvasSize.height = parseFloat(canvasSizeY.toFixed(2));\r\n            if (_isItalic) {\r\n                //0.0174532925 = 3.141592653 / 180\r\n                _canvasSize.width += _drawFontsize * Math.tan(12 * 0.0174532925);\r\n            }\r\n        }\r\n\r\n        _canvas.width = _canvasSize.width;\r\n        _canvas.height = _canvasSize.height;\r\n    },\r\n\r\n    _calculateTextBaseline () {\r\n        let node = this._node;\r\n        let hAlign;\r\n        let vAlign;\r\n\r\n        if (_hAlign === macro.TextAlignment.RIGHT) {\r\n            hAlign = 'right';\r\n        }\r\n        else if (_hAlign === macro.TextAlignment.CENTER) {\r\n            hAlign = 'center';\r\n        }\r\n        else {\r\n            hAlign = 'left';\r\n        }\r\n        _context.textAlign = hAlign;\r\n\r\n        if (_vAlign === macro.VerticalTextAlignment.TOP) {\r\n            vAlign = 'top';\r\n        }\r\n        else if (_vAlign === macro.VerticalTextAlignment.CENTER) {\r\n            vAlign = 'middle';\r\n        }\r\n        else {\r\n            vAlign = 'bottom';\r\n        }\r\n        _context.textBaseline = vAlign;\r\n    },\r\n\r\n    _calculateSplitedStrings () {\r\n        let paragraphedStrings = _string.split('\\n');\r\n\r\n        if (_isWrapText) {\r\n            _splitedStrings = [];\r\n            let canvasWidthNoMargin = _canvasSize.width - 2 * _margin;\r\n            for (let i = 0; i < paragraphedStrings.length; ++i) {\r\n                let allWidth = textUtils.safeMeasureText(_context, paragraphedStrings[i]);\r\n                let textFragment = textUtils.fragmentText(paragraphedStrings[i],\r\n                                                        allWidth,\r\n                                                        canvasWidthNoMargin,\r\n                                                        this._measureText(_context));\r\n                _splitedStrings = _splitedStrings.concat(textFragment);\r\n            }\r\n        }\r\n        else {\r\n            _splitedStrings = paragraphedStrings;\r\n        }\r\n\r\n    },\r\n\r\n    _getFontDesc () {\r\n        let fontDesc = _fontSize.toString() + 'px ';\r\n        fontDesc = fontDesc + _fontFamily;\r\n        if (_isBold) {\r\n            fontDesc = \"bold \" + fontDesc;\r\n        }\r\n\r\n        return fontDesc;\r\n    },\r\n\r\n    _getLineHeight () {\r\n        let nodeSpacingY = _lineHeight;\r\n        if (nodeSpacingY === 0) {\r\n            nodeSpacingY = _fontSize;\r\n        } else {\r\n            nodeSpacingY = nodeSpacingY * _fontSize / _drawFontsize;\r\n        }\r\n\r\n        return nodeSpacingY | 0;\r\n    },\r\n\r\n    _calculateParagraphLength (paragraphedStrings, ctx) {\r\n        let paragraphLength = [];\r\n\r\n        for (let i = 0; i < paragraphedStrings.length; ++i) {\r\n            let width = textUtils.safeMeasureText(ctx, paragraphedStrings[i]);\r\n            paragraphLength.push(width);\r\n        }\r\n\r\n        return paragraphLength;\r\n    },\r\n\r\n    _measureText (ctx) {\r\n        return function (string) {\r\n            return textUtils.safeMeasureText(ctx, string);\r\n        };\r\n    },\r\n\r\n    _calculateLabelFont () {\r\n        _fontDesc = this._getFontDesc();\r\n        _context.font = _fontDesc;\r\n\r\n        if (_overflow === Overflow.SHRINK) {\r\n            let paragraphedStrings = _string.split('\\n');\r\n            let paragraphLength = this._calculateParagraphLength(paragraphedStrings, _context);\r\n        \r\n            let i = 0;\r\n            let totalHeight = 0;\r\n            let maxLength = 0;\r\n\r\n            if (_isWrapText) {\r\n                let canvasWidthNoMargin = _canvasSize.width - 2 * _margin;\r\n                let canvasHeightNoMargin = _canvasSize.height - 2 * _margin;\r\n                if (canvasWidthNoMargin < 0 || canvasHeightNoMargin < 0) {\r\n                    _fontDesc = this._getFontDesc();\r\n                    _context.font = _fontDesc;\r\n                    return;\r\n                }\r\n                totalHeight = canvasHeightNoMargin + 1;\r\n                maxLength = canvasWidthNoMargin + 1;\r\n                let actualFontSize = _fontSize + 1;\r\n                let textFragment = \"\";\r\n                let tryDivideByTwo = true;\r\n                let startShrinkFontSize = actualFontSize | 0;\r\n\r\n                while (totalHeight > canvasHeightNoMargin || maxLength > canvasWidthNoMargin) {\r\n                    if (tryDivideByTwo) {\r\n                        actualFontSize = (startShrinkFontSize / 2) | 0;\r\n                    } else {\r\n                        actualFontSize = startShrinkFontSize - 1;\r\n                        startShrinkFontSize = actualFontSize;\r\n                    }\r\n                    if (actualFontSize <= 0) {\r\n                        cc.logID(4003);\r\n                        break;\r\n                    }\r\n                    _fontSize = actualFontSize;\r\n                    _fontDesc = this._getFontDesc();\r\n                    _context.font = _fontDesc;\r\n\r\n                    totalHeight = 0;\r\n                    for (i = 0; i < paragraphedStrings.length; ++i) {\r\n                        let j = 0;\r\n                        let allWidth = textUtils.safeMeasureText(_context, paragraphedStrings[i]);\r\n                        textFragment = textUtils.fragmentText(paragraphedStrings[i],\r\n                                                            allWidth,\r\n                                                            canvasWidthNoMargin,\r\n                                                            this._measureText(_context));\r\n                        while (j < textFragment.length) {\r\n                            let measureWidth = textUtils.safeMeasureText(_context, textFragment[j]);\r\n                            maxLength = measureWidth;\r\n                            totalHeight += this._getLineHeight();\r\n                            ++j;\r\n                        }\r\n                    }\r\n\r\n                    if (tryDivideByTwo) {\r\n                        if (totalHeight > canvasHeightNoMargin) {\r\n                            startShrinkFontSize = actualFontSize | 0;\r\n                        } else {\r\n                            tryDivideByTwo = false;\r\n                            totalHeight = canvasHeightNoMargin + 1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                totalHeight = paragraphedStrings.length * this._getLineHeight();\r\n\r\n                for (i = 0; i < paragraphedStrings.length; ++i) {\r\n                    if (maxLength < paragraphLength[i]) {\r\n                        maxLength = paragraphLength[i];\r\n                    }\r\n                }\r\n                let scaleX = (_canvasSize.width - 2 * _margin) / maxLength;\r\n                let scaleY = _canvasSize.height / totalHeight;\r\n\r\n                _fontSize = (_drawFontsize * Math.min(1, scaleX, scaleY)) | 0;\r\n                _fontDesc = this._getFontDesc();\r\n                _context.font = _fontDesc;\r\n            }\r\n        }\r\n    }\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./sprite');\r\nrequire('./mask-assembler');\r\nrequire('./graphics');\r\nrequire('./label');\r\nrequire('./motion-streak');\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst bmfontUtls = require('../../../../utils/label/bmfont');\r\nconst fillVertices = require('../../utils').fillVertices;\r\n\r\nmodule.exports = js.addon({\r\n    createData (comp) {\r\n        return comp.requestRenderData();\r\n    },\r\n\r\n    fillBuffers (comp, renderer) {\r\n        let node = comp.node;\r\n        fillVertices(node, renderer._quadBuffer, comp._renderData, node._color._val);\r\n    },\r\n\r\n    appendQuad (renderData, texture, rect, rotated, x, y, scale) {\r\n        let dataOffset = renderData.dataLength;\r\n\r\n        renderData.dataLength += 4;\r\n        renderData.vertexCount = renderData.dataLength;\r\n        renderData.indiceCount = renderData.dataLength / 2 * 3;\r\n\r\n        let data = renderData._data;\r\n        let texw = texture.width,\r\n            texh = texture.height;\r\n\r\n        let rectWidth = rect.width,\r\n            rectHeight = rect.height;\r\n\r\n        let l, b, r, t;\r\n        if (!rotated) {\r\n            l = (rect.x) / texw;\r\n            r = (rect.x + rectWidth) / texw;\r\n            b = (rect.y + rectHeight) / texh;\r\n            t = (rect.y) / texh;\r\n\r\n            data[dataOffset].u = l;\r\n            data[dataOffset].v = b;\r\n            data[dataOffset + 1].u = r;\r\n            data[dataOffset + 1].v = b;\r\n            data[dataOffset + 2].u = l;\r\n            data[dataOffset + 2].v = t;\r\n            data[dataOffset + 3].u = r;\r\n            data[dataOffset + 3].v = t;\r\n        } else {\r\n            l = (rect.x) / texw;\r\n            r = (rect.x + rectHeight) / texw;\r\n            b = (rect.y + rectWidth) / texh;\r\n            t = (rect.y) / texh;\r\n\r\n            data[dataOffset].u = l;\r\n            data[dataOffset].v = t;\r\n            data[dataOffset + 1].u = l;\r\n            data[dataOffset + 1].v = b;\r\n            data[dataOffset + 2].u = r;\r\n            data[dataOffset + 2].v = t;\r\n            data[dataOffset + 3].u = r;\r\n            data[dataOffset + 3].v = b;\r\n        }\r\n\r\n        data[dataOffset].x = x;\r\n        data[dataOffset].y = y - rectHeight * scale;\r\n        data[dataOffset + 1].x = x + rectWidth * scale;\r\n        data[dataOffset + 1].y = y - rectHeight * scale;\r\n        data[dataOffset + 2].x = x;\r\n        data[dataOffset + 2].y = y;\r\n        data[dataOffset + 3].x = x + rectWidth * scale;\r\n        data[dataOffset + 3].y = y;\r\n    },\r\n}, bmfontUtls);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst ttfUtls = require('../../../../utils/label/ttf');\r\nconst fillVertices = require('../../utils').fillVertices;\r\n\r\nconst WHITE = cc.color(255, 255, 255, 255);\r\n\r\nmodule.exports = js.addon({\r\n    createData (comp) {\r\n        let renderData = comp.requestRenderData();\r\n\r\n        renderData.dataLength = 4;\r\n        renderData.vertexCount = 4;\r\n        renderData.indiceCount = 6;\r\n\r\n        let data = renderData._data;\r\n        data[0].u = 0;\r\n        data[0].v = 1;\r\n        data[1].u = 1;\r\n        data[1].v = 1;\r\n        data[2].u = 0;\r\n        data[2].v = 0;\r\n        data[3].u = 1;\r\n        data[3].v = 0;\r\n        return renderData;\r\n    },\r\n\r\n    fillBuffers (comp, renderer) {\r\n        fillVertices(comp.node, renderer._quadBuffer, comp._renderData, WHITE._val);\r\n    },\r\n\r\n    _updateVerts (comp) {\r\n        let renderData = comp._renderData;\r\n\r\n        let node = comp.node,\r\n            width = node.width,\r\n            height = node.height,\r\n            appx = node.anchorX * width,\r\n            appy = node.anchorY * height;\r\n\r\n        let data = renderData._data;\r\n        data[0].x = -appx;\r\n        data[0].y = -appy;\r\n        data[1].x = width - appx;\r\n        data[1].y = -appy;\r\n        data[2].x = -appx;\r\n        data[2].y = height - appy;\r\n        data[3].x = width - appx;\r\n        data[3].y = height - appy;\r\n    }\r\n}, ttfUtls);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst assembler = require('../2d/bmfont');\r\nconst fillVertices3D = require('../../utils').fillVertices3D;\r\n\r\nmodule.exports = js.addon({\r\n    fillBuffers (comp, renderer) {\r\n        let node = comp.node;\r\n        fillVertices3D(node, renderer._quadBuffer3D, comp._renderData, node._color._val);\r\n    },\r\n}, assembler);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst assembler = require('../2d/ttf');\r\nconst fillVertices3D = require('../../utils').fillVertices3D;\r\n\r\nconst WHITE = cc.color(255, 255, 255, 255);\r\n\r\nmodule.exports = js.addon({\r\n    fillBuffers (comp, renderer) {\r\n        fillVertices3D(comp.node, renderer._quadBuffer3D, comp._renderData, WHITE._val);\r\n    }\r\n}, assembler);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Label = require('../../../../components/CCLabel');\r\n\r\nconst ttfAssembler = require('./2d/ttf');\r\nconst bmfontAssembler = require('./2d/bmfont');\r\n\r\nconst ttfAssembler3D = require('./3d/ttf');\r\nconst bmfontAssembler3D = require('./3d/bmfont');\r\n\r\nvar labelAssembler = {\r\n    getAssembler (comp) {\r\n        let is3DNode = comp.node.is3DNode;\r\n        let assembler = is3DNode ? ttfAssembler3D : ttfAssembler;\r\n        \r\n        if (comp.font instanceof cc.BitmapFont) {\r\n            assembler = is3DNode ? bmfontAssembler3D : bmfontAssembler;\r\n        }\r\n\r\n        return assembler;\r\n    },\r\n\r\n    // Skip invalid labels (without own _assembler)\r\n    updateRenderData (label) {\r\n        return label.__allocedDatas;\r\n    }\r\n};\r\n\r\nLabel._assembler = labelAssembler;\r\n\r\nmodule.exports = labelAssembler;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst StencilManager = require('../stencil-manager');\r\nconst Mask = require('../../../components/CCMask');\r\nconst RenderFlow = require('../../render-flow');\r\nconst spriteAssembler = require('./sprite/2d/simple');\r\nconst graphicsAssembler = require('./graphics');\r\n\r\nlet _stencilMgr = StencilManager.sharedManager;\r\n\r\nlet maskFrontAssembler = {\r\n    updateRenderData (mask) {\r\n        if (!mask._renderData) {\r\n            // Update clear graphics material\r\n            graphicsAssembler.updateRenderData(mask._clearGraphics);\r\n\r\n            if (mask._type === Mask.Type.IMAGE_STENCIL) {\r\n                mask._renderData = spriteAssembler.createData(mask);\r\n            }\r\n            else {\r\n                // for updateGraphics calculation\r\n                mask._renderData = mask.requestRenderData();\r\n            }\r\n        }\r\n        let renderData = mask._renderData;\r\n\r\n        if (mask._type === Mask.Type.IMAGE_STENCIL) {\r\n            if (mask.spriteFrame) {\r\n                let size = mask.node._contentSize;\r\n                let anchor = mask.node._anchorPoint;\r\n                renderData.updateSizeNPivot(size.width, size.height, anchor.x, anchor.y);\r\n                renderData.dataLength = 4;\r\n                spriteAssembler.updateRenderData(mask);\r\n                renderData.material = mask._material;\r\n            }\r\n            else {\r\n                mask._material = null;\r\n            }\r\n        }\r\n        else {\r\n            mask._graphics._material = mask._material;\r\n            graphicsAssembler.updateRenderData(mask._graphics);\r\n        }\r\n    },\r\n\r\n    fillBuffers (mask, renderer) {\r\n        // Invalid state\r\n        if (mask._type !== Mask.Type.IMAGE_STENCIL || mask.spriteFrame) {\r\n            // HACK: Must push mask after batch, so we can only put this logic in fillVertexBuffer or fillIndexBuffer\r\n            _stencilMgr.pushMask(mask);\r\n            _stencilMgr.clear();\r\n\r\n            graphicsAssembler.fillBuffers(mask._clearGraphics, renderer);\r\n\r\n            _stencilMgr.enterLevel();\r\n\r\n            // vertex buffer\r\n            renderer.node = mask.node;\r\n            renderer.material = mask._material;\r\n            if (mask._type === Mask.Type.IMAGE_STENCIL) {\r\n                spriteAssembler.fillBuffers(mask, renderer);\r\n                renderer._flush();\r\n            }\r\n            else {\r\n                graphicsAssembler.fillBuffers(mask._graphics, renderer);\r\n            }\r\n            _stencilMgr.enableMask();\r\n        }\r\n\r\n        mask.node._renderFlag |= RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n    }\r\n};\r\n\r\nlet maskEndAssembler = {\r\n    fillBuffers (mask, renderer) {\r\n        // Invalid state\r\n        if (mask._type !== Mask.Type.IMAGE_STENCIL || mask.spriteFrame) {\r\n            // HACK: Must pop mask after batch, so we can only put this logic in fillBuffers\r\n            _stencilMgr.exitMask();\r\n        }\r\n\r\n        mask.node._renderFlag |= RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n    }\r\n};\r\n\r\nMask._assembler = maskFrontAssembler;\r\nMask._postAssembler = maskEndAssembler;\r\n\r\nmodule.exports = {\r\n    front: maskFrontAssembler,\r\n    end: maskEndAssembler\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Sprite = require('../../../../../components/CCSprite');\r\nconst FillType = Sprite.FillType;\r\n\r\nconst dynamicAtlasManager = require('../../../../utils/dynamic-atlas/manager');\r\nconst fillVerticesWithoutCalc = require('../../utils').fillVerticesWithoutCalc;\r\n\r\nmodule.exports = {\r\n    useModel: false,\r\n    updateRenderData (sprite) {\r\n        let frame = sprite.spriteFrame;\r\n\r\n        // TODO: Material API design and export from editor could affect the material activation process\r\n        // need to update the logic here\r\n        if (frame) {\r\n            if (!frame._original && dynamicAtlasManager) {\r\n                dynamicAtlasManager.insertSpriteFrame(frame);\r\n            }\r\n            if (sprite._material._texture !== frame._texture) {\r\n                sprite._activateMaterial();\r\n            }\r\n        }\r\n\r\n        let renderData = sprite._renderData;\r\n        if (renderData && frame) {\r\n            let uvDirty = renderData.uvDirty,\r\n                vertDirty = renderData.vertDirty;\r\n\r\n            if (!uvDirty && !vertDirty) {\r\n                return sprite.__allocedDatas;\r\n            }\r\n\r\n            let fillStart = sprite._fillStart;\r\n            let fillRange = sprite._fillRange;\r\n\r\n            if (fillRange < 0) {\r\n                fillStart += fillRange;\r\n                fillRange = -fillRange;\r\n            }\r\n\r\n            fillRange = fillStart + fillRange;\r\n\r\n            fillStart = fillStart > 1.0 ? 1.0 : fillStart;\r\n            fillStart = fillStart < 0.0 ? 0.0 : fillStart;\r\n\r\n            fillRange = fillRange > 1.0 ? 1.0 : fillRange;\r\n            fillRange = fillRange < 0.0 ? 0.0 : fillRange;\r\n            fillRange = fillRange - fillStart;\r\n            fillRange = fillRange < 0 ? 0 : fillRange;\r\n\r\n            let fillEnd = fillStart + fillRange;\r\n            fillEnd = fillEnd > 1 ? 1 : fillEnd;\r\n\r\n            if (uvDirty) {\r\n                this.updateUVs(sprite, fillStart, fillEnd);\r\n            }\r\n            if (vertDirty) {\r\n                this.updateVerts(sprite, fillStart, fillEnd);\r\n                this.updateWorldVerts(sprite);\r\n            }\r\n        }\r\n    },\r\n\r\n    updateUVs (sprite, fillStart, fillEnd) {\r\n        let spriteFrame = sprite._spriteFrame,\r\n            renderData = sprite._renderData,\r\n            data = renderData._data;\r\n\r\n        //build uvs\r\n        let atlasWidth = spriteFrame._texture.width;\r\n        let atlasHeight = spriteFrame._texture.height;\r\n        let textureRect = spriteFrame._rect;\r\n        //uv computation should take spritesheet into account.\r\n        let ul, vb, ur, vt;\r\n        let quadUV0, quadUV1, quadUV2, quadUV3, quadUV4, quadUV5, quadUV6, quadUV7;\r\n        if (spriteFrame._rotated) {\r\n            ul = (textureRect.x) / atlasWidth;\r\n            vb = (textureRect.y + textureRect.width) / atlasHeight;\r\n            ur = (textureRect.x + textureRect.height) / atlasWidth;\r\n            vt = (textureRect.y) / atlasHeight;\r\n\r\n            quadUV0 = quadUV2 = ul;\r\n            quadUV4 = quadUV6 = ur;\r\n            quadUV3 = quadUV7 = vb;\r\n            quadUV1 = quadUV5 = vt;\r\n        }\r\n        else {\r\n            ul = (textureRect.x) / atlasWidth;\r\n            vb = (textureRect.y + textureRect.height) / atlasHeight;\r\n            ur = (textureRect.x + textureRect.width) / atlasWidth;\r\n            vt = (textureRect.y) / atlasHeight;\r\n\r\n            quadUV0 = quadUV4 = ul;\r\n            quadUV2 = quadUV6 = ur;\r\n            quadUV1 = quadUV3 = vb;\r\n            quadUV5 = quadUV7 = vt;\r\n        }\r\n\r\n        switch (sprite._fillType) {\r\n            case FillType.HORIZONTAL:\r\n                data[0].u = quadUV0 + (quadUV2 - quadUV0) * fillStart;\r\n                data[0].v = quadUV1;\r\n                data[1].u = quadUV0 + (quadUV2 - quadUV0) * fillEnd;\r\n                data[1].v = quadUV3;\r\n                data[2].u = quadUV4 + (quadUV6 - quadUV4) * fillStart;\r\n                data[2].v = quadUV5;\r\n                data[3].u = quadUV4 + (quadUV6 - quadUV4) * fillEnd;\r\n                data[3].v = quadUV7;\r\n                break;\r\n            case FillType.VERTICAL:\r\n                data[0].u = quadUV0;\r\n                data[0].v = quadUV1 + (quadUV5 - quadUV1) * fillStart;\r\n                data[1].u = quadUV2;\r\n                data[1].v = quadUV3 + (quadUV7 - quadUV3) * fillStart;\r\n                data[2].u = quadUV4;\r\n                data[2].v = quadUV1 + (quadUV5 - quadUV1) * fillEnd;\r\n                data[3].u = quadUV6;\r\n                data[3].v = quadUV3 + (quadUV7 - quadUV3) * fillEnd;\r\n                break;\r\n            default:\r\n                cc.errorID(2626);\r\n                break;\r\n        }\r\n\r\n        renderData.uvDirty = false;\r\n    },\r\n\r\n    updateVerts (sprite, fillStart, fillEnd) {\r\n        let renderData = sprite._renderData,\r\n            data = renderData._data,\r\n            node = sprite.node,\r\n            width = node.width, height = node.height,\r\n            appx = node.anchorX * width, appy = node.anchorY * height;\r\n\r\n        let l = -appx, b = -appy,\r\n            r = width - appx, t = height - appy;\r\n\r\n        let progressStart, progressEnd;\r\n        switch (sprite._fillType) {\r\n            case FillType.HORIZONTAL:\r\n                progressStart = l + (r - l) * fillStart;\r\n                progressEnd = l + (r - l) * fillEnd;\r\n\r\n                l = progressStart;\r\n                r = progressEnd;\r\n                break;\r\n            case FillType.VERTICAL:\r\n                progressStart = b + (t - b) * fillStart;\r\n                progressEnd = b + (t - b) * fillEnd;\r\n\r\n                b = progressStart;\r\n                t = progressEnd;\r\n                break;\r\n            default:\r\n                cc.errorID(2626);\r\n                break;\r\n        }\r\n\r\n        data[4].x = l;\r\n        data[4].y = b;\r\n        data[5].x = r;\r\n        data[5].y = b;\r\n        data[6].x = l;\r\n        data[6].y = t;\r\n        data[7].x = r;\r\n        data[7].y = t;\r\n\r\n        renderData.vertDirty = false;\r\n    },\r\n\r\n    createData (sprite) {\r\n        let renderData = sprite.requestRenderData();\r\n        // 0-4 for world verts\r\n        // 5-8 for local verts\r\n        renderData.dataLength = 8;\r\n        renderData.vertexCount = 4;\r\n        renderData.indiceCount = 6;\r\n\r\n        let data = renderData._data;\r\n        for (let i = 0; i < data.length; i++) {\r\n            data[i].z = 0;\r\n        }\r\n        return renderData;\r\n    },\r\n\r\n    updateWorldVerts (sprite) {\r\n        let node = sprite.node,\r\n            data = sprite._renderData._data;\r\n\r\n        let matrix = node._worldMatrix;\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            let local = data[i + 4];\r\n            let world = data[i];\r\n            world.x = local.x * a + local.y * c + tx;\r\n            world.y = local.x * b + local.y * d + ty;\r\n        }\r\n    },\r\n\r\n    fillBuffers (sprite, renderer) {\r\n        if (renderer.worldMatDirty) {\r\n            this.updateWorldVerts(sprite);\r\n        }\r\n\r\n        // buffer\r\n        let buffer = renderer._meshBuffer,\r\n            indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n\r\n        let node = sprite.node;\r\n        fillVerticesWithoutCalc(node, buffer, sprite._renderData, node._color._val);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let ibuf = buffer._iData;\r\n        ibuf[indiceOffset++] = vertexId;\r\n        ibuf[indiceOffset++] = vertexId + 1;\r\n        ibuf[indiceOffset++] = vertexId + 2;\r\n        ibuf[indiceOffset++] = vertexId + 1;\r\n        ibuf[indiceOffset++] = vertexId + 3;\r\n        ibuf[indiceOffset++] = vertexId + 2;\r\n    }\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst dynamicAtlasManager = require('../../../../utils/dynamic-atlas/manager');\r\nconst fillVerticesWithoutCalc = require('../../utils').fillVerticesWithoutCalc;\r\n\r\nmodule.exports = {\r\n    useModel: false,\r\n\r\n    createData (sprite) {\r\n        return sprite.requestRenderData();\r\n    },\r\n\r\n    updateRenderData (sprite) {\r\n        let frame = sprite.spriteFrame;\r\n\r\n        // TODO: Material API design and export from editor could affect the material activation process\r\n        // need to update the logic here\r\n        if (frame) {\r\n            if (!frame._original && dynamicAtlasManager) {\r\n                dynamicAtlasManager.insertSpriteFrame(frame);\r\n            }\r\n            if (sprite._material._texture !== frame._texture) {\r\n                sprite._activateMaterial();\r\n            }\r\n        }\r\n\r\n        let renderData = sprite._renderData;\r\n        if (renderData && frame) {\r\n            let vertices = frame.vertices;\r\n            if (vertices) {\r\n                if (renderData.vertexCount !== vertices.x.length) {\r\n                    renderData.vertexCount = vertices.x.length;\r\n                    renderData.indiceCount = vertices.triangles.length;\r\n\r\n                    // 1 for world vertices, 2 for local vertices\r\n                    renderData.dataLength = renderData.vertexCount * 2;\r\n\r\n                    renderData.uvDirty = renderData.vertDirty = true;\r\n                }\r\n\r\n                if (renderData.uvDirty) {\r\n                    this.updateUVs(sprite);\r\n                }\r\n                let vertDirty = renderData.vertDirty;\r\n                if (vertDirty) {\r\n                    this.updateVerts(sprite);\r\n                    this.updateWorldVerts(sprite);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    updateUVs (sprite) {\r\n        let vertices = sprite.spriteFrame.vertices,\r\n            u = vertices.nu,\r\n            v = vertices.nv;\r\n\r\n        let renderData = sprite._renderData;\r\n        let data = renderData._data;\r\n        for (let i = 0, l = u.length; i < l; i++) {\r\n            let vertice = data[i];\r\n            vertice.u = u[i];\r\n            vertice.v = v[i];\r\n        }\r\n\r\n        renderData.uvDirty = false;\r\n    },\r\n\r\n    updateVerts (sprite) {\r\n        let node = sprite.node,\r\n            contentWidth = Math.abs(node.width),\r\n            contentHeight = Math.abs(node.height),\r\n            appx = node.anchorX * contentWidth,\r\n            appy = node.anchorY * contentHeight;\r\n\r\n        let frame = sprite.spriteFrame,\r\n            vertices = frame.vertices,\r\n            x = vertices.x,\r\n            y = vertices.y,\r\n            originalWidth = frame._originalSize.width,\r\n            originalHeight = frame._originalSize.height,\r\n            rectWidth = frame._rect.width,\r\n            rectHeight = frame._rect.height,\r\n            offsetX = frame._offset.x,\r\n            offsetY = frame._offset.y,\r\n            trimX = offsetX + (originalWidth - rectWidth) / 2,\r\n            trimY = offsetY + (originalHeight - rectHeight) / 2;\r\n\r\n        let scaleX = contentWidth / (sprite.trim ? rectWidth : originalWidth),\r\n            scaleY = contentHeight / (sprite.trim ? rectHeight : originalHeight);\r\n\r\n        let renderData = sprite._renderData;\r\n        let data = renderData._data;\r\n\r\n        if (!sprite.trim) {\r\n            for (let i = 0, l = x.length; i < l; i++) {\r\n                let vertice = data[i + l];\r\n                vertice.x = (x[i]) * scaleX - appx;\r\n                vertice.y = (originalHeight - y[i]) * scaleY - appy;\r\n            }\r\n        }\r\n        else {\r\n            for (let i = 0, l = x.length; i < l; i++) {\r\n                let vertice = data[i + l];\r\n                vertice.x = (x[i] - trimX) * scaleX - appx;\r\n                vertice.y = (originalHeight - y[i] - trimY) * scaleY - appy;\r\n            }\r\n        }\r\n\r\n        renderData.vertDirty = false;\r\n    },\r\n\r\n    updateWorldVerts (sprite) {\r\n        let node = sprite.node,\r\n            renderData = sprite._renderData,\r\n            data = renderData._data;\r\n\r\n        let matrix = node._worldMatrix;\r\n\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n        for (let i = 0, l = renderData.vertexCount; i < l; i++) {\r\n            let local = data[i + l];\r\n            let world = data[i];\r\n            world.x = local.x * a + local.y * c + tx;\r\n            world.y = local.x * b + local.y * d + ty;\r\n        }\r\n    },\r\n\r\n    fillBuffers (sprite, renderer) {\r\n        let vertices = sprite.spriteFrame.vertices;\r\n        if (!vertices) {\r\n            return;\r\n        }\r\n\r\n        // update world verts\r\n        if (renderer.worldMatDirty) {\r\n            this.updateWorldVerts(sprite);\r\n        }\r\n\r\n        // buffer\r\n        let buffer = renderer._meshBuffer3D,\r\n            indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n\r\n        let node = sprite.node;\r\n        fillVerticesWithoutCalc(node, buffer, sprite._renderData, node._color._val);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let ibuf = buffer._iData;\r\n        let triangles = vertices.triangles;\r\n        for (let i = 0, l = triangles.length; i < l; i++) {\r\n            ibuf[indiceOffset++] = vertexId + triangles[i];\r\n        }\r\n    },\r\n};","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst dynamicAtlasManager = require('../../../../utils/dynamic-atlas/manager');\r\nconst fillVertices = require('../../utils').fillVertices;\r\n\r\nconst PI_2 = Math.PI * 2;\r\n\r\n\r\nlet _vertPos = [cc.v2(0, 0), cc.v2(0, 0), cc.v2(0, 0), cc.v2(0, 0)];\r\nlet _vertices = [0, 0, 0, 0];\r\nlet _uvs = [0, 0, 0, 0, 0, 0, 0, 0];\r\nlet _intersectPoint_1 = [cc.v2(0, 0), cc.v2(0, 0), cc.v2(0, 0), cc.v2(0, 0)];\r\nlet _intersectPoint_2 = [cc.v2(0, 0), cc.v2(0, 0), cc.v2(0, 0), cc.v2(0, 0)];\r\nlet _center = cc.v2(0, 0);\r\nlet _triangles = [];\r\n\r\nfunction _calcInsectedPoints (left, right, bottom, top, center, angle, intersectPoints) {\r\n    //left bottom, right, top\r\n    let sinAngle = Math.sin(angle);\r\n    let cosAngle = Math.cos(angle);\r\n    let tanAngle, cotAngle;\r\n    if (Math.cos(angle) !== 0) {\r\n        tanAngle = sinAngle / cosAngle;\r\n        //calculate right and left\r\n        if ((left - center.x) * cosAngle > 0) {\r\n            let yleft = center.y + tanAngle * (left - center.x);\r\n            intersectPoints[0].x = left;\r\n            intersectPoints[0].y = yleft;\r\n        }\r\n        if ((right - center.x) * cosAngle > 0) {\r\n            let yright = center.y + tanAngle * (right - center.x);\r\n\r\n            intersectPoints[2].x = right;\r\n            intersectPoints[2].y = yright;\r\n        }\r\n\r\n    }\r\n\r\n    if (Math.sin(angle) !== 0) {\r\n        cotAngle = cosAngle / sinAngle;\r\n        //calculate  top and bottom\r\n        if ((top - center.y) * sinAngle > 0) {\r\n            let xtop = center.x + cotAngle * (top - center.y);\r\n            intersectPoints[3].x = xtop;\r\n            intersectPoints[3].y = top;\r\n        }\r\n        if ((bottom - center.y) * sinAngle > 0) {\r\n            let xbottom = center.x + cotAngle * (bottom - center.y);\r\n            intersectPoints[1].x = xbottom;\r\n            intersectPoints[1].y = bottom;\r\n        }\r\n\r\n    }\r\n}\r\n\r\nfunction _calculateVertices (sprite) {\r\n    let node = sprite.node,\r\n        width = node.width, height = node.height,\r\n        appx = node.anchorX * width, appy = node.anchorY * height;\r\n\r\n    let l = -appx, b = -appy,\r\n        r = width - appx, t = height - appy;\r\n\r\n    let vertices = _vertices;\r\n    vertices[0] = l;\r\n    vertices[1] = b;\r\n    vertices[2] = r;\r\n    vertices[3] = t;\r\n\r\n    let fillCenter = sprite._fillCenter,\r\n        cx = _center.x = Math.min(Math.max(0, fillCenter.x), 1) * (r - l) + l,\r\n        cy = _center.y = Math.min(Math.max(0, fillCenter.y), 1) * (t - b) + b;\r\n\r\n    _vertPos[0].x = _vertPos[3].x = l;\r\n    _vertPos[1].x = _vertPos[2].x = r;\r\n    _vertPos[0].y = _vertPos[1].y = b;\r\n    _vertPos[2].y = _vertPos[3].y = t;\r\n\r\n    _triangles.length = 0;\r\n    if (cx !== vertices[0]) {\r\n        _triangles[0] = [3, 0];\r\n    }\r\n    if (cx !== vertices[2]) {\r\n        _triangles[2] = [1, 2];\r\n    }\r\n    if (cy !== vertices[1]) {\r\n        _triangles[1] = [0, 1];\r\n    }\r\n    if (cy !== vertices[3]) {\r\n        _triangles[3] = [2, 3];\r\n    }\r\n}\r\n\r\nfunction _calculateUVs (spriteFrame) {\r\n    let atlasWidth = spriteFrame._texture.width;\r\n    let atlasHeight = spriteFrame._texture.height;\r\n    let textureRect = spriteFrame._rect;\r\n\r\n    let u0, u1, v0, v1;\r\n    let uvs = _uvs;\r\n\r\n    if (spriteFrame._rotated) {\r\n        u0 = (textureRect.x) / atlasWidth;\r\n        u1 = (textureRect.x + textureRect.height) / atlasWidth;\r\n\r\n        v0 = (textureRect.y) / atlasHeight;\r\n        v1 = (textureRect.y + textureRect.width) / atlasHeight;\r\n\r\n        uvs[0] = uvs[2] = u0;\r\n        uvs[4] = uvs[6] = u1;\r\n        uvs[3] = uvs[7] = v1;\r\n        uvs[1] = uvs[5] = v0;\r\n    }\r\n    else {\r\n        u0 = (textureRect.x) / atlasWidth;\r\n        u1 = (textureRect.x + textureRect.width) / atlasWidth;\r\n\r\n        v0 = (textureRect.y) / atlasHeight;\r\n        v1 = (textureRect.y + textureRect.height) / atlasHeight;\r\n\r\n        uvs[0] = uvs[4] = u0;\r\n        uvs[2] = uvs[6] = u1;\r\n        uvs[1] = uvs[3] = v1;\r\n        uvs[5] = uvs[7] = v0;\r\n    }\r\n}\r\n\r\nfunction _getVertAngle (start, end) {\r\n    let placementX, placementY;\r\n    placementX = end.x - start.x;\r\n    placementY = end.y - start.y;\r\n\r\n    if (placementX === 0 && placementY === 0) {\r\n        return undefined;\r\n    } else if (placementX === 0) {\r\n        if (placementY > 0) {\r\n            return Math.PI * 0.5;\r\n        } else {\r\n            return Math.PI * 1.5;\r\n        }\r\n    } else {\r\n        let angle = Math.atan(placementY / placementX);\r\n        if (placementX < 0) {\r\n            angle += Math.PI;\r\n        }\r\n\r\n        return angle;\r\n    }\r\n}\r\n\r\nfunction _generateTriangle (data, offset, vert0, vert1, vert2) {\r\n    let vertices = _vertices;\r\n    let v0x = vertices[0];\r\n    let v0y = vertices[1];\r\n    let v1x = vertices[2];\r\n    let v1y = vertices[3];\r\n\r\n    data[offset].x = vert0.x;\r\n    data[offset].y = vert0.y;\r\n    data[offset + 1].x = vert1.x;\r\n    data[offset + 1].y = vert1.y;\r\n    data[offset + 2].x = vert2.x;\r\n    data[offset + 2].y = vert2.y;\r\n\r\n    let progressX, progressY;\r\n    progressX = (vert0.x - v0x) / (v1x - v0x);\r\n    progressY = (vert0.y - v0y) / (v1y - v0y);\r\n    _generateUV(progressX, progressY, data, offset);\r\n\r\n    progressX = (vert1.x - v0x) / (v1x - v0x);\r\n    progressY = (vert1.y - v0y) / (v1y - v0y);\r\n    _generateUV(progressX, progressY, data, offset + 1);\r\n\r\n    progressX = (vert2.x - v0x) / (v1x - v0x);\r\n    progressY = (vert2.y - v0y) / (v1y - v0y);\r\n    _generateUV(progressX, progressY, data, offset + 2);\r\n}\r\n\r\nfunction _generateUV (progressX, progressY, data, offset) {\r\n    let uvs = _uvs;\r\n    let px1 = uvs[0] + (uvs[2] - uvs[0]) * progressX;\r\n    let px2 = uvs[4] + (uvs[6] - uvs[4]) * progressX;\r\n    let py1 = uvs[1] + (uvs[3] - uvs[1]) * progressX;\r\n    let py2 = uvs[5] + (uvs[7] - uvs[5]) * progressX;\r\n    let uv = data[offset];\r\n    uv.u = px1 + (px2 - px1) * progressY;\r\n    uv.v = py1 + (py2 - py1) * progressY;\r\n}\r\n\r\nmodule.exports = {\r\n    useModel: false,\r\n\r\n    createData (sprite) {\r\n        return sprite.requestRenderData();\r\n    },\r\n\r\n    updateRenderData (sprite) {\r\n        let frame = sprite.spriteFrame;\r\n\r\n        // TODO: Material API design and export from editor could affect the material activation process\r\n        // need to update the logic here\r\n        if (frame) {\r\n            if (!frame._original && dynamicAtlasManager) {\r\n                dynamicAtlasManager.insertSpriteFrame(frame);\r\n            }\r\n            if (sprite._material._texture !== frame._texture) {\r\n                sprite._activateMaterial();\r\n            }\r\n        }\r\n\r\n        let renderData = sprite._renderData;\r\n        if (renderData && frame) {\r\n            if (renderData.vertDirty || renderData.uvDirty) {\r\n                let data = renderData._data;\r\n\r\n                let fillStart = sprite._fillStart;\r\n                let fillRange = sprite._fillRange;\r\n                if (fillRange < 0) {\r\n                    fillStart += fillRange;\r\n                    fillRange = -fillRange;\r\n                }\r\n\r\n                //do round fill start [0,1), include 0, exclude 1\r\n                while (fillStart >= 1.0) fillStart -= 1.0;\r\n                while (fillStart < 0.0) fillStart += 1.0;\r\n\r\n                fillStart *= PI_2;\r\n                fillRange *= PI_2;\r\n                let fillEnd = fillStart + fillRange;\r\n\r\n                //build vertices\r\n                _calculateVertices(sprite);\r\n                //build uvs\r\n                _calculateUVs(frame);\r\n\r\n                _calcInsectedPoints(_vertices[0], _vertices[2], _vertices[1], _vertices[3], _center, fillStart, _intersectPoint_1);\r\n                _calcInsectedPoints(_vertices[0], _vertices[2], _vertices[1], _vertices[3], _center, fillStart + fillRange, _intersectPoint_2);\r\n\r\n                let offset = 0;\r\n                for (let triangleIndex = 0; triangleIndex < 4; ++triangleIndex) {\r\n                    let triangle = _triangles[triangleIndex];\r\n                    if (!triangle) {\r\n                        continue;\r\n                    }\r\n                    //all in\r\n                    if (fillRange >= PI_2) {\r\n                        renderData.dataLength = offset + 3;\r\n                        _generateTriangle(data, offset, _center, _vertPos[triangle[0]], _vertPos[triangle[1]]);\r\n                        offset += 3;\r\n                        continue;\r\n                    }\r\n                    //test against\r\n                    let startAngle = _getVertAngle(_center, _vertPos[triangle[0]]);\r\n                    let endAngle = _getVertAngle(_center, _vertPos[triangle[1]]);\r\n                    if (endAngle < startAngle) endAngle += PI_2;\r\n                    startAngle -= PI_2;\r\n                    endAngle -= PI_2;\r\n                    //testing\r\n                    for (let testIndex = 0; testIndex < 3; ++testIndex) {\r\n                        if (startAngle >= fillEnd) {\r\n                            //all out\r\n                        } else if (startAngle >= fillStart) {\r\n                            renderData.dataLength = offset + 3;\r\n                            if (endAngle >= fillEnd) {\r\n                                //startAngle to fillEnd\r\n                                _generateTriangle(data, offset, _center, _vertPos[triangle[0]], _intersectPoint_2[triangleIndex]);\r\n                            } else {\r\n                                //startAngle to endAngle\r\n                                _generateTriangle(data, offset, _center, _vertPos[triangle[0]], _vertPos[triangle[1]]);\r\n                            }\r\n                            offset += 3;\r\n                        } else {\r\n                            //startAngle < fillStart\r\n                            if (endAngle <= fillStart) {\r\n                                //all out\r\n                            } else if (endAngle <= fillEnd) {\r\n                                renderData.dataLength = offset + 3;\r\n                                //fillStart to endAngle\r\n                                _generateTriangle(data, offset, _center, _intersectPoint_1[triangleIndex], _vertPos[triangle[1]]);\r\n                                offset += 3;\r\n                            } else {\r\n                                renderData.dataLength = offset + 3;\r\n                                //fillStart to fillEnd\r\n                                _generateTriangle(data, offset, _center, _intersectPoint_1[triangleIndex], _intersectPoint_2[triangleIndex]);\r\n                                offset += 3;\r\n                            }\r\n                        }\r\n                        //add 2 * PI\r\n                        startAngle += PI_2;\r\n                        endAngle += PI_2;\r\n                    }\r\n                }\r\n\r\n                renderData.indiceCount = renderData.vertexCount = offset;\r\n                renderData.vertDirty = renderData.uvDirty = false;\r\n            }\r\n        }\r\n    },\r\n\r\n    fillBuffers (comp, renderer) {\r\n        let node = comp.node,\r\n            color = node._color._val,\r\n            buffer = renderer._meshBuffer,\r\n            renderData = comp._renderData;\r\n\r\n        let indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n        fillVertices(node, buffer, renderData, color);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let ibuf = buffer._iData;\r\n        for (let i = 0; i < renderData.dataLength; i++) {\r\n            ibuf[indiceOffset + i] = vertexId + i;\r\n        }\r\n    },\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst dynamicAtlasManager = require('../../../../utils/dynamic-atlas/manager');\r\n\r\nmodule.exports = {\r\n    useModel: false,\r\n\r\n    updateRenderData (sprite) {\r\n        let frame = sprite._spriteFrame;\r\n\r\n        // TODO: Material API design and export from editor could affect the material activation process\r\n        // need to update the logic here\r\n        if (frame) {\r\n            if (!frame._original && dynamicAtlasManager) {\r\n                dynamicAtlasManager.insertSpriteFrame(frame);\r\n            }\r\n            if (sprite._material._texture !== frame._texture) {\r\n                sprite._activateMaterial();\r\n            }\r\n        }\r\n\r\n        let renderData = sprite._renderData;\r\n        if (renderData && frame) {\r\n            if (renderData.vertDirty) {\r\n                this.updateVerts(sprite);\r\n            }\r\n        }\r\n    },\r\n\r\n    fillBuffers (sprite, renderer) {\r\n        let data = sprite._renderData._data,\r\n            node = sprite.node,\r\n            color = node._color._val,\r\n            matrix = node._worldMatrix;\r\n\r\n        let buffer = renderer._meshBuffer,\r\n            vertexOffset = buffer.byteOffset >> 2,\r\n            indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n\r\n        buffer.request(4, 6);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let vbuf = buffer._vData,\r\n            uintbuf = buffer._uintVData,\r\n            ibuf = buffer._iData;\r\n\r\n        // get uv from sprite frame directly\r\n        let uv = sprite._spriteFrame.uv;\r\n        vbuf[vertexOffset + 2] = uv[0];\r\n        vbuf[vertexOffset + 3] = uv[1];\r\n        vbuf[vertexOffset + 7] = uv[2];\r\n        vbuf[vertexOffset + 8] = uv[3];\r\n        vbuf[vertexOffset + 12] = uv[4];\r\n        vbuf[vertexOffset + 13] = uv[5];\r\n        vbuf[vertexOffset + 17] = uv[6];\r\n        vbuf[vertexOffset + 18] = uv[7];\r\n\r\n        let data0 = data[0], data3 = data[3],\r\n            vl = data0.x, vr = data3.x,\r\n            vb = data0.y, vt = data3.y;\r\n\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n        let al = a * vl, ar = a * vr,\r\n            bl = b * vl, br = b * vr,\r\n            cb = c * vb, ct = c * vt,\r\n            db = d * vb, dt = d * vt;\r\n\r\n        // left bottom\r\n        vbuf[vertexOffset] = al + cb + tx;\r\n        vbuf[vertexOffset + 1] = bl + db + ty;\r\n        // right bottom\r\n        vbuf[vertexOffset + 5] = ar + cb + tx;\r\n        vbuf[vertexOffset + 6] = br + db + ty;\r\n        // left top\r\n        vbuf[vertexOffset + 10] = al + ct + tx;\r\n        vbuf[vertexOffset + 11] = bl + dt + ty;\r\n        // right top\r\n        vbuf[vertexOffset + 15] = ar + ct + tx;\r\n        vbuf[vertexOffset + 16] = br + dt + ty;\r\n\r\n        // color\r\n        uintbuf[vertexOffset + 4] = color;\r\n        uintbuf[vertexOffset + 9] = color;\r\n        uintbuf[vertexOffset + 14] = color;\r\n        uintbuf[vertexOffset + 19] = color;\r\n\r\n        // fill indice data\r\n        ibuf[indiceOffset++] = vertexId;\r\n        ibuf[indiceOffset++] = vertexId + 1;\r\n        ibuf[indiceOffset++] = vertexId + 2;\r\n        ibuf[indiceOffset++] = vertexId + 1;\r\n        ibuf[indiceOffset++] = vertexId + 3;\r\n        ibuf[indiceOffset++] = vertexId + 2;\r\n    },\r\n\r\n    createData (sprite) {\r\n        let renderData = sprite.requestRenderData();\r\n        renderData.dataLength = 4;\r\n        renderData.vertexCount = 4;\r\n        renderData.indiceCount = 6;\r\n        return renderData;\r\n    },\r\n\r\n    updateVerts (sprite) {\r\n        let renderData = sprite._renderData,\r\n            node = sprite.node,\r\n            data = renderData._data,\r\n            cw = node.width, ch = node.height,\r\n            appx = node.anchorX * cw, appy = node.anchorY * ch,\r\n            l, b, r, t;\r\n        if (sprite.trim) {\r\n            l = -appx;\r\n            b = -appy;\r\n            r = cw - appx;\r\n            t = ch - appy;\r\n        }\r\n        else {\r\n            let frame = sprite.spriteFrame,\r\n                ow = frame._originalSize.width, oh = frame._originalSize.height,\r\n                rw = frame._rect.width, rh = frame._rect.height,\r\n                offset = frame._offset,\r\n                scaleX = cw / ow, scaleY = ch / oh;\r\n            let trimLeft = offset.x + (ow - rw) / 2;\r\n            let trimRight = offset.x - (ow - rw) / 2;\r\n            let trimBottom = offset.y + (oh - rh) / 2;\r\n            let trimTop = offset.y - (oh - rh) / 2;\r\n            l = trimLeft * scaleX - appx;\r\n            b = trimBottom * scaleY - appy;\r\n            r = cw + trimRight * scaleX - appx;\r\n            t = ch + trimTop * scaleY - appy;\r\n        }\r\n\r\n        data[0].x = l;\r\n        data[0].y = b;\r\n        // data[1].x = r;\r\n        // data[1].y = b;\r\n        // data[2].x = l;\r\n        // data[2].y = t;\r\n        data[3].x = r;\r\n        data[3].y = t;\r\n\r\n        renderData.vertDirty = false;\r\n    }\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst dynamicAtlasManager = require('../../../../utils/dynamic-atlas/manager');\r\n\r\nmodule.exports = {\r\n    useModel: false,\r\n\r\n    createData (sprite) {\r\n        let renderData = sprite.requestRenderData();\r\n        // 0-4 for local verts\r\n        // 5-20 for world verts\r\n        renderData.dataLength = 20;\r\n\r\n        renderData.vertexCount = 16;\r\n        renderData.indiceCount = 54;\r\n        return renderData;\r\n    },\r\n\r\n    updateRenderData (sprite, batchData) {\r\n        let frame = sprite.spriteFrame;\r\n\r\n        // TODO: Material API design and export from editor could affect the material activation process\r\n        // need to update the logic here\r\n        if (frame) {\r\n            if (!frame._original && dynamicAtlasManager) {\r\n                dynamicAtlasManager.insertSpriteFrame(frame);\r\n            }\r\n            if (sprite._material._texture !== frame._texture) {\r\n                sprite._activateMaterial();\r\n            }\r\n        }\r\n\r\n        let renderData = sprite._renderData;\r\n        if (renderData && frame) {\r\n            let vertDirty = renderData.vertDirty;\r\n            if (vertDirty) {\r\n                this.updateVerts(sprite);\r\n                this.updateWorldVerts(sprite);\r\n            }\r\n        }\r\n    },\r\n\r\n    updateVerts (sprite) {\r\n        let renderData = sprite._renderData,\r\n            data = renderData._data,\r\n            node = sprite.node,\r\n            width = node.width, height = node.height,\r\n            appx = node.anchorX * width, appy = node.anchorY * height;\r\n\r\n        let frame = sprite.spriteFrame;\r\n        let leftWidth = frame.insetLeft;\r\n        let rightWidth = frame.insetRight;\r\n        let topHeight = frame.insetTop;\r\n        let bottomHeight = frame.insetBottom;\r\n\r\n        let sizableWidth = width - leftWidth - rightWidth;\r\n        let sizableHeight = height - topHeight - bottomHeight;\r\n        let xScale = width / (leftWidth + rightWidth);\r\n        let yScale = height / (topHeight + bottomHeight);\r\n        xScale = (isNaN(xScale) || xScale > 1) ? 1 : xScale;\r\n        yScale = (isNaN(yScale) || yScale > 1) ? 1 : yScale;\r\n        sizableWidth = sizableWidth < 0 ? 0 : sizableWidth;\r\n        sizableHeight = sizableHeight < 0 ? 0 : sizableHeight;\r\n\r\n        data[0].x = -appx;\r\n        data[0].y = -appy;\r\n        data[1].x = leftWidth * xScale - appx;\r\n        data[1].y = bottomHeight * yScale - appy;\r\n        data[2].x = data[1].x + sizableWidth;\r\n        data[2].y = data[1].y + sizableHeight;\r\n        data[3].x = width - appx;\r\n        data[3].y = height - appy;\r\n\r\n        renderData.vertDirty = false;\r\n    },\r\n\r\n    fillBuffers (sprite, renderer) {\r\n        if (renderer.worldMatDirty) {\r\n            this.updateWorldVerts(sprite);\r\n        }\r\n\r\n        let renderData = sprite._renderData,\r\n            node = sprite.node,\r\n            color = node._color._val,\r\n            data = renderData._data;\r\n\r\n        let buffer = renderer._meshBuffer,\r\n            vertexOffset = buffer.byteOffset >> 2,\r\n            vertexCount = renderData.vertexCount,\r\n            indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n\r\n        let uvSliced = sprite.spriteFrame.uvSliced;\r\n\r\n        buffer.request(vertexCount, renderData.indiceCount);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let vbuf = buffer._vData,\r\n            uintbuf = buffer._uintVData,\r\n            ibuf = buffer._iData;\r\n\r\n        for (let i = 4; i < 20; ++i) {\r\n            let vert = data[i];\r\n            let uvs = uvSliced[i - 4];\r\n\r\n            vbuf[vertexOffset++] = vert.x;\r\n            vbuf[vertexOffset++] = vert.y;\r\n            vbuf[vertexOffset++] = uvs.u;\r\n            vbuf[vertexOffset++] = uvs.v;\r\n            uintbuf[vertexOffset++] = color;\r\n        }\r\n\r\n        for (let r = 0; r < 3; ++r) {\r\n            for (let c = 0; c < 3; ++c) {\r\n                let start = vertexId + r * 4 + c;\r\n                ibuf[indiceOffset++] = start;\r\n                ibuf[indiceOffset++] = start + 1;\r\n                ibuf[indiceOffset++] = start + 4;\r\n                ibuf[indiceOffset++] = start + 1;\r\n                ibuf[indiceOffset++] = start + 5;\r\n                ibuf[indiceOffset++] = start + 4;\r\n            }\r\n        }\r\n    },\r\n\r\n    updateWorldVerts (sprite) {\r\n        let node = sprite.node,\r\n            data = sprite._renderData._data;\r\n\r\n        let matrix = node._worldMatrix;\r\n\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n        for (let row = 0; row < 4; ++row) {\r\n            let rowD = data[row];\r\n            for (let col = 0; col < 4; ++col) {\r\n                let colD = data[col];\r\n                let world = data[4 + row * 4 + col];\r\n                world.x = colD.x * a + rowD.y * c + tx;\r\n                world.y = colD.x * b + rowD.y * d + ty;\r\n            }\r\n        }\r\n    },\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst dynamicAtlasManager = require('../../../../utils/dynamic-atlas/manager');\r\n\r\nmodule.exports = {\r\n    useModel: false,\r\n    \r\n    vertexOffset: 5,\r\n    uvOffset: 2,\r\n    colorOffset: 4,\r\n\r\n    createData (sprite) {\r\n        return sprite.requestRenderData();\r\n    },\r\n\r\n    updateRenderData (sprite) {\r\n        let frame = sprite.spriteFrame;\r\n        \r\n        // TODO: Material API design and export from editor could affect the material activation process\r\n        // need to update the logic here\r\n        if (frame) {\r\n            if (!frame._original && dynamicAtlasManager) {\r\n                dynamicAtlasManager.insertSpriteFrame(frame);\r\n            }\r\n            if (sprite._material._texture !== frame._texture) {\r\n                sprite._activateMaterial();\r\n            }\r\n        }\r\n\r\n        let renderData = sprite._renderData;\r\n        if (!frame || !renderData || \r\n            !(renderData.uvDirty || renderData.vertDirty)) \r\n            return;\r\n\r\n        let node = sprite.node,\r\n            contentWidth = Math.abs(node.width),\r\n            contentHeight = Math.abs(node.height),\r\n            appx = node.anchorX * contentWidth,\r\n            appy = node.anchorY * contentHeight;\r\n\r\n        let rect = frame._rect,\r\n            rectWidth = rect.width,\r\n            rectHeight = rect.height,\r\n            hRepeat = contentWidth / rectWidth,\r\n            vRepeat = contentHeight / rectHeight,\r\n            row = Math.ceil(vRepeat), \r\n            col = Math.ceil(hRepeat);\r\n\r\n        let data = renderData._data;\r\n        renderData.dataLength = Math.max(8, row+1, col+1);\r\n\r\n        for (let i = 0; i <= col; ++i) {\r\n            data[i].x = Math.min(rectWidth * i, contentWidth) - appx;\r\n        }\r\n        for (let i = 0; i <= row; ++i) {\r\n            data[i].y = Math.min(rectHeight * i, contentHeight) - appy;\r\n        }\r\n        \r\n        // update data property\r\n        renderData.vertexCount = row * col * 4;\r\n        renderData.indiceCount = row * col * 6;\r\n        renderData.uvDirty = false;\r\n        renderData.vertDirty = false;\r\n    },\r\n\r\n    fillVertices (vbuf, vertexOffset, matrix, row, col, data) {\r\n        let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n            tx = matrix.m12, ty = matrix.m13;\r\n\r\n        let x, x1, y, y1;\r\n        for (let yindex = 0, ylength = row; yindex < ylength; ++yindex) {\r\n            y = data[yindex].y;\r\n            y1 = data[yindex+1].y;\r\n            for (let xindex = 0, xlength = col; xindex < xlength; ++xindex) {\r\n                x = data[xindex].x;\r\n                x1 = data[xindex+1].x;\r\n\r\n                // Vertex\r\n                // lb\r\n                vbuf[vertexOffset] = x * a + y * c + tx;\r\n                vbuf[vertexOffset+1] = x * b + y * d + ty;\r\n                // rb\r\n                vbuf[vertexOffset+5] = x1 * a + y * c + tx;\r\n                vbuf[vertexOffset+6] = x1 * b + y * d + ty;\r\n                // lt\r\n                vbuf[vertexOffset+10] = x * a + y1 * c + tx;\r\n                vbuf[vertexOffset+11] = x * b + y1 * d + ty;\r\n                // rt\r\n                vbuf[vertexOffset+15] = x1 * a + y1 * c + tx;\r\n                vbuf[vertexOffset+16] = x1 * b + y1 * d + ty;\r\n\r\n                vertexOffset += 20;\r\n            }\r\n        }\r\n    },\r\n\r\n    fillBuffers (sprite, renderer) {\r\n        let node = sprite.node,\r\n            is3DNode = node.is3DNode,\r\n            color = node._color._val,\r\n            renderData = sprite._renderData,\r\n            data = renderData._data;\r\n\r\n        // buffer\r\n        let buffer = is3DNode ? renderer._meshBuffer3D : renderer._meshBuffer,\r\n            vertexOffset = buffer.byteOffset >> 2,\r\n            indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n            \r\n        buffer.request(renderData.vertexCount, renderData.indiceCount);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let vbuf = buffer._vData,\r\n            uintbuf = buffer._uintVData,\r\n            ibuf = buffer._iData;\r\n\r\n        let rotated = sprite.spriteFrame._rotated;\r\n        let uv = sprite.spriteFrame.uv;\r\n        let rect = sprite.spriteFrame._rect;\r\n        let contentWidth = Math.abs(node.width);\r\n        let contentHeight = Math.abs(node.height);\r\n        let hRepeat = contentWidth / rect.width;\r\n        let vRepeat = contentHeight / rect.height;\r\n        let row = Math.ceil(vRepeat), \r\n            col = Math.ceil(hRepeat);\r\n        \r\n        let matrix = node._worldMatrix;\r\n        \r\n        this.fillVertices(vbuf, vertexOffset, matrix, row, col, data);\r\n\r\n        let offset = this.vertexOffset, uvOffset = this.uvOffset, colorOffset = this.colorOffset;\r\n        let offset1 = offset, offset2 = offset*2, offset3 = offset*3, offset4 = offset*4;\r\n        let coefu, coefv;\r\n        for (let yindex = 0, ylength = row; yindex < ylength; ++yindex) {\r\n            coefv = Math.min(1, vRepeat - yindex);\r\n            for (let xindex = 0, xlength = col; xindex < xlength; ++xindex) {\r\n                coefu = Math.min(1, hRepeat - xindex);\r\n\r\n                let vertexOffsetU = vertexOffset + uvOffset;\r\n                let vertexOffsetV = vertexOffsetU + 1;\r\n                // UV\r\n                if (rotated) {\r\n                    // lb\r\n                    vbuf[vertexOffsetU] = uv[0];\r\n                    vbuf[vertexOffsetV] = uv[1];\r\n                    // rb\r\n                    vbuf[vertexOffsetU+offset1] = uv[0];\r\n                    vbuf[vertexOffsetV+offset1] = uv[1] + (uv[7] - uv[1]) * coefu;\r\n                    // lt\r\n                    vbuf[vertexOffsetU+offset2] = uv[0] + (uv[6] - uv[0]) * coefv;\r\n                    vbuf[vertexOffsetV+offset2] = uv[1];\r\n                    // rt\r\n                    vbuf[vertexOffsetU+offset3] = vbuf[vertexOffsetU+offset2];\r\n                    vbuf[vertexOffsetV+offset3] = vbuf[vertexOffsetV+offset1];\r\n                }\r\n                else {\r\n                    // lb\r\n                    vbuf[vertexOffsetU] = uv[0];\r\n                    vbuf[vertexOffsetV] = uv[1];\r\n                    // rb\r\n                    vbuf[vertexOffsetU+offset1] = uv[0] + (uv[6] - uv[0]) * coefu;\r\n                    vbuf[vertexOffsetV+offset1] = uv[1];\r\n                    // lt\r\n                    vbuf[vertexOffsetU+offset2] = uv[0];\r\n                    vbuf[vertexOffsetV+offset2] = uv[1] + (uv[7] - uv[1]) * coefv;\r\n                    // rt\r\n                    vbuf[vertexOffsetU+offset3] = vbuf[vertexOffsetU+offset1];\r\n                    vbuf[vertexOffsetV+offset3] = vbuf[vertexOffsetV+offset2];\r\n                }\r\n                // color\r\n                uintbuf[vertexOffset+colorOffset] = color;\r\n                uintbuf[vertexOffset+colorOffset+offset1] = color;\r\n                uintbuf[vertexOffset+colorOffset+offset2] = color;\r\n                uintbuf[vertexOffset+colorOffset+offset3] = color;\r\n                vertexOffset += offset4;\r\n            }\r\n        }\r\n\r\n        // update indices\r\n        let length = renderData.indiceCount;\r\n        for (let i = 0; i < length; i+=6) {\r\n            ibuf[indiceOffset++] = vertexId;\r\n            ibuf[indiceOffset++] = vertexId+1;\r\n            ibuf[indiceOffset++] = vertexId+2;\r\n            ibuf[indiceOffset++] = vertexId+1;\r\n            ibuf[indiceOffset++] = vertexId+3;\r\n            ibuf[indiceOffset++] = vertexId+2;\r\n            vertexId += 4;\r\n        }\r\n    },\r\n};","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst assembler = require('../2d/bar-filled');\r\nconst fillVerticesWithoutCalc3D = require('../../utils').fillVerticesWithoutCalc3D;\r\n\r\nconst vec3 = cc.vmath.vec3;\r\n\r\nmodule.exports = js.addon({\r\n    updateWorldVerts (sprite) {\r\n        let node = sprite.node,\r\n            data = sprite._renderData._data;\r\n\r\n        let matrix = node._worldMatrix;\r\n        for (let i = 0; i < 4; i++) {\r\n            let local = data[i + 4];\r\n            let world = data[i];\r\n            vec3.transformMat4(world, local, matrix);\r\n        }\r\n    },\r\n\r\n    fillBuffers (sprite, renderer) {\r\n        if (renderer.worldMatDirty) {\r\n            this.updateWorldVerts(sprite);\r\n        }\r\n\r\n        // buffer\r\n        let buffer = renderer._meshBuffer3D,\r\n            indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n\r\n        let node = sprite.node;\r\n        fillVerticesWithoutCalc3D(node, buffer, sprite._renderData, node._color._val);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let ibuf = buffer._iData;\r\n        ibuf[indiceOffset++] = vertexId;\r\n        ibuf[indiceOffset++] = vertexId + 1;\r\n        ibuf[indiceOffset++] = vertexId + 2;\r\n        ibuf[indiceOffset++] = vertexId + 1;\r\n        ibuf[indiceOffset++] = vertexId + 3;\r\n        ibuf[indiceOffset++] = vertexId + 2;\r\n    }\r\n}, assembler);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst assembler = require('../2d/mesh');\r\nconst fillVerticesWithoutCalc3D = require('../../utils').fillVerticesWithoutCalc3D;\r\n\r\nconst vec3 = cc.vmath.vec3;\r\nlet vec3_temp = vec3.create();\r\n\r\nmodule.exports = js.addon({\r\n    updateWorldVerts (sprite) {\r\n        let node = sprite.node,\r\n            renderData = sprite._renderData,\r\n            data = renderData._data;\r\n\r\n        let matrix = node._worldMatrix;\r\n        for (let i = 0, l = renderData.vertexCount; i < l; i++) {\r\n            let local = data[i + l];\r\n            let world = data[i];\r\n            vec3.set(vec3_temp, local.x, local.y, 0);\r\n            vec3.transformMat4(world, vec3_temp, matrix);\r\n        }\r\n    },\r\n\r\n    fillBuffers (sprite, renderer) {\r\n        let vertices = sprite.spriteFrame.vertices;\r\n        if (!vertices) {\r\n            return;\r\n        }\r\n\r\n        // update world verts\r\n        if (renderer.worldMatDirty) {\r\n            this.updateWorldVerts(sprite);\r\n        }\r\n\r\n        // buffer\r\n        let buffer = renderer._meshBuffer3D,\r\n            indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n\r\n        let node = sprite.node;\r\n        fillVerticesWithoutCalc3D(node, buffer, sprite._renderData, node._color._val);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let ibuf = buffer._iData;\r\n        let triangles = vertices.triangles;\r\n        for (let i = 0, l = triangles.length; i < l; i++) {\r\n            ibuf[indiceOffset++] = vertexId + triangles[i];\r\n        }\r\n    },\r\n}, assembler);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst assembler = require('../2d/radial-filled');\r\nconst fillVertices3D = require('../../utils').fillVertices3D;\r\n\r\nmodule.exports = js.addon({\r\n    fillBuffers (comp, renderer) {\r\n        let node = comp.node,\r\n            color = node._color._val,\r\n            buffer = renderer._meshBuffer3D,\r\n            renderData = comp._renderData;\r\n\r\n        let indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n        fillVertices3D(node, buffer, renderData, color);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let ibuf = buffer._iData;\r\n        for (let i = 0; i < renderData.dataLength; i++) {\r\n            ibuf[indiceOffset + i] = vertexId + i;\r\n        }\r\n    },\r\n}, assembler);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst assembler = require('../2d/simple');\r\nconst vec3 = cc.vmath.vec3;\r\n\r\nmodule.exports = js.addon({\r\n    fillBuffers: (function() {\r\n        let vec3_temps = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            vec3_temps.push(vec3.create());\r\n        }\r\n        return function (sprite, renderer) {\r\n            let data = sprite._renderData._data,\r\n                node = sprite.node,\r\n                color = node._color._val,\r\n                matrix = node._worldMatrix;\r\n    \r\n            let buffer = renderer._meshBuffer3D,\r\n                vertexOffset = buffer.byteOffset >> 2,\r\n                indiceOffset = buffer.indiceOffset,\r\n                vertexId = buffer.vertexOffset;\r\n    \r\n            buffer.request(4, 6);\r\n    \r\n            // buffer data may be realloc, need get reference after request.\r\n            let vbuf = buffer._vData,\r\n                uintbuf = buffer._uintVData,\r\n                ibuf = buffer._iData;\r\n    \r\n            let data0 = data[0], data3 = data[3];\r\n            vec3.set(vec3_temps[0], data0.x, data0.y, 0);\r\n            vec3.set(vec3_temps[1], data3.x, data0.y, 0);\r\n            vec3.set(vec3_temps[2], data0.x, data3.y, 0);\r\n            vec3.set(vec3_temps[3], data3.x, data3.y, 0);\r\n\r\n            // get uv from sprite frame directly\r\n            let uv = sprite._spriteFrame.uv;\r\n            for (let i = 0; i < 4; i++) {\r\n                // vertex\r\n                let vertex = vec3_temps[i];\r\n                vec3.transformMat4(vertex, vertex, matrix);\r\n\r\n                vbuf[vertexOffset++] = vertex.x;\r\n                vbuf[vertexOffset++] = vertex.y;\r\n                vbuf[vertexOffset++] = vertex.z;\r\n\r\n                // uv\r\n                let uvOffset = i * 2;\r\n                vbuf[vertexOffset++] = uv[0 + uvOffset];\r\n                vbuf[vertexOffset++] = uv[1 + uvOffset];\r\n    \r\n                // color\r\n                uintbuf[vertexOffset++] = color;\r\n            }\r\n\r\n            // fill indice data\r\n            ibuf[indiceOffset++] = vertexId;\r\n            ibuf[indiceOffset++] = vertexId + 1;\r\n            ibuf[indiceOffset++] = vertexId + 2;\r\n            ibuf[indiceOffset++] = vertexId + 1;\r\n            ibuf[indiceOffset++] = vertexId + 3;\r\n            ibuf[indiceOffset++] = vertexId + 2;\r\n        };\r\n    })(),\r\n}, assembler);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst assembler = require('../2d/sliced');\r\n\r\nconst vec3 = cc.vmath.vec3;\r\nconst vec3_temp = vec3.create();\r\n\r\nmodule.exports = js.addon({\r\n    fillBuffers (sprite, renderer) {\r\n        if (renderer.worldMatDirty) {\r\n            this.updateWorldVerts(sprite);\r\n        }\r\n\r\n        let renderData = sprite._renderData,\r\n            node = sprite.node,\r\n            is3DNode = node.is3DNode,\r\n            color = node._color._val,\r\n            data = renderData._data;\r\n\r\n        let buffer = is3DNode ? renderer._meshBuffer3D : renderer._meshBuffer,\r\n            vertexOffset = buffer.byteOffset >> 2,\r\n            vertexCount = renderData.vertexCount,\r\n            indiceOffset = buffer.indiceOffset,\r\n            vertexId = buffer.vertexOffset;\r\n\r\n        let uvSliced = sprite.spriteFrame.uvSliced;\r\n\r\n        buffer.request(vertexCount, renderData.indiceCount);\r\n\r\n        // buffer data may be realloc, need get reference after request.\r\n        let vbuf = buffer._vData,\r\n            uintbuf = buffer._uintVData,\r\n            ibuf = buffer._iData;\r\n\r\n        for (let i = 4; i < 20; ++i) {\r\n            let vert = data[i];\r\n            let uvs = uvSliced[i - 4];\r\n\r\n            vbuf[vertexOffset++] = vert.x;\r\n            vbuf[vertexOffset++] = vert.y;\r\n            vbuf[vertexOffset++] = vert.z;\r\n            vbuf[vertexOffset++] = uvs.u;\r\n            vbuf[vertexOffset++] = uvs.v;\r\n            uintbuf[vertexOffset++] = color;\r\n        }\r\n\r\n        for (let r = 0; r < 3; ++r) {\r\n            for (let c = 0; c < 3; ++c) {\r\n                let start = vertexId + r * 4 + c;\r\n                ibuf[indiceOffset++] = start;\r\n                ibuf[indiceOffset++] = start + 1;\r\n                ibuf[indiceOffset++] = start + 4;\r\n                ibuf[indiceOffset++] = start + 1;\r\n                ibuf[indiceOffset++] = start + 5;\r\n                ibuf[indiceOffset++] = start + 4;\r\n            }\r\n        }\r\n    },\r\n\r\n    updateWorldVerts (sprite) {\r\n        let node = sprite.node,\r\n            data = sprite._renderData._data;\r\n\r\n        let matrix = node._worldMatrix;\r\n        for (let row = 0; row < 4; ++row) {\r\n            let rowD = data[row];\r\n            for (let col = 0; col < 4; ++col) {\r\n                let colD = data[col];\r\n                let world = data[4 + row * 4 + col];\r\n\r\n                vec3.set(vec3_temp, colD.x, rowD.y, 0);\r\n                vec3.transformMat4(world, vec3_temp, matrix);\r\n            }\r\n        }\r\n    },\r\n}, assembler);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../../../../../platform/js');\r\nconst assembler = require('../2d/tiled');\r\nconst vec3 = cc.vmath.vec3;\r\n\r\nmodule.exports = js.addon({\r\n    vertexOffset: 6,\r\n    uvOffset: 3,\r\n    colorOffset: 5,\r\n\r\n    fillVertices: (function () {\r\n        let vec3_temps = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            vec3_temps.push(vec3.create());\r\n        }\r\n        return function (vbuf, vertexOffset, matrix, row, col, data) {\r\n            let x, x1, y, y1;\r\n            for (let yindex = 0, ylength = row; yindex < ylength; ++yindex) {\r\n                y = data[yindex].y;\r\n                y1 = data[yindex+1].y;\r\n                for (let xindex = 0, xlength = col; xindex < xlength; ++xindex) {\r\n                    x = data[xindex].x;\r\n                    x1 = data[xindex+1].x;\r\n    \r\n                    vec3.set(vec3_temps[0], x, y, 0);\r\n                    vec3.set(vec3_temps[1], x1, y, 0);\r\n                    vec3.set(vec3_temps[2], x, y1, 0);\r\n                    vec3.set(vec3_temps[3], x1, y1, 0);\r\n    \r\n                    for (let i = 0; i < 4; i ++) {\r\n                        let vec3_temp = vec3_temps[i];\r\n                        vec3.transformMat4(vec3_temp, vec3_temp, matrix);\r\n                        let offset = i * 6;\r\n                        vbuf[vertexOffset + offset] = vec3_temp.x;\r\n                        vbuf[vertexOffset + offset + 1] = vec3_temp.y;\r\n                        vbuf[vertexOffset + offset + 2] = vec3_temp.z;\r\n                    }\r\n    \r\n                    vertexOffset += 24;\r\n                }\r\n            }\r\n        };\r\n    })(),\r\n}, assembler);\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Sprite = require('../../../../components/CCSprite');\r\n\r\nconst SpriteType = Sprite.Type;\r\nconst FillType = Sprite.FillType;\r\n\r\nconst simpleRenderUtil = require('./2d/simple');\r\nconst slicedRenderUtil = require('./2d/sliced');\r\nconst tiledRenderUtil = require('./2d/tiled');\r\nconst radialFilledRenderUtil = require('./2d/radial-filled');\r\nconst barFilledRenderUtil = require('./2d/bar-filled');\r\nconst meshRenderUtil = require('./2d/mesh');\r\n\r\nconst simpleRenderUtil3D = require('./3d/simple');\r\nconst slicedRenderUtil3D = require('./3d/sliced');\r\nconst tiledRenderUtil3D = require('./3d/tiled');\r\nconst radialFilledRenderUtil3D = require('./3d/radial-filled');\r\nconst barFilledRenderUtil3D = require('./3d/bar-filled');\r\nconst meshRenderUtil3D = require('./3d/mesh');\r\n\r\n// Inline all type switch to avoid jit deoptimization during inlined function change\r\n\r\nlet spriteAssembler = {\r\n    getAssembler (sprite) {\r\n        let is3DNode = sprite.node.is3DNode;\r\n        \r\n        let util = is3DNode ? simpleRenderUtil3D : simpleRenderUtil;\r\n        switch (sprite.type) {\r\n            case SpriteType.SLICED:\r\n                util = is3DNode ? slicedRenderUtil3D : slicedRenderUtil;\r\n                break;\r\n            case SpriteType.TILED:\r\n                util = is3DNode ? tiledRenderUtil3D : tiledRenderUtil;\r\n                break;\r\n            case SpriteType.FILLED:\r\n                if (sprite._fillType === FillType.RADIAL) {\r\n                    util = is3DNode ? radialFilledRenderUtil3D : radialFilledRenderUtil;\r\n                }\r\n                else {\r\n                    util = is3DNode ? barFilledRenderUtil3D : barFilledRenderUtil;\r\n                }\r\n                break;\r\n            case SpriteType.MESH:\r\n                util = is3DNode ? meshRenderUtil3D : meshRenderUtil;\r\n                break;\r\n        }\r\n\r\n        return util;\r\n    },\r\n\r\n    // Skip invalid sprites (without own _assembler)\r\n    updateRenderData (sprite) {\r\n        return sprite.__allocedDatas;\r\n    }\r\n};\r\n\r\nSprite._assembler = spriteAssembler;\r\n\r\nmodule.exports = spriteAssembler;\r\n","\r\nconst vec3 = cc.vmath.vec3;\r\nlet vec3_temp = vec3.create();\r\n\r\nfunction fillVertices (node, buffer, renderData, color) {\r\n    let data = renderData._data,\r\n        vertexOffset = buffer.byteOffset >> 2;\r\n\r\n    let vertexCount = renderData.vertexCount;\r\n    buffer.request(vertexCount, renderData.indiceCount);\r\n\r\n    // buffer data may be realloc, need get reference after request.\r\n    let vbuf = buffer._vData,\r\n        uintbuf = buffer._uintVData;\r\n\r\n    let matrix = node._worldMatrix;\r\n    let a = matrix.m00, b = matrix.m01, c = matrix.m04, d = matrix.m05,\r\n        tx = matrix.m12, ty = matrix.m13;\r\n    for (let i = 0; i < vertexCount; i++) {\r\n        let vert = data[i];\r\n        vbuf[vertexOffset++] = vert.x * a + vert.y * c + tx;\r\n        vbuf[vertexOffset++] = vert.x * b + vert.y * d + ty;\r\n        vbuf[vertexOffset++] = vert.u;\r\n        vbuf[vertexOffset++] = vert.v;\r\n        uintbuf[vertexOffset++] = color;\r\n    }\r\n}\r\n\r\nfunction fillVertices3D (node, buffer, renderData, color) {\r\n    let data = renderData._data,\r\n        vertexOffset = buffer.byteOffset >> 2;\r\n\r\n    let vertexCount = renderData.vertexCount;\r\n    buffer.request(vertexCount, renderData.indiceCount);\r\n\r\n    // buffer data may be realloc, need get reference after request.\r\n    let vbuf = buffer._vData,\r\n        uintbuf = buffer._uintVData;\r\n\r\n    let matrix = node._worldMatrix;\r\n\r\n    for (let i = 0; i < vertexCount; i++) {\r\n        let vert = data[i];\r\n        vec3.set(vec3_temp, vert.x, vert.y, 0);\r\n        vec3.transformMat4(vec3_temp, vec3_temp, matrix);\r\n        vbuf[vertexOffset++] = vec3_temp.x;\r\n        vbuf[vertexOffset++] = vec3_temp.y;\r\n        vbuf[vertexOffset++] = vec3_temp.z;\r\n        vbuf[vertexOffset++] = vert.u;\r\n        vbuf[vertexOffset++] = vert.v;\r\n        uintbuf[vertexOffset++] = color;\r\n    }\r\n}\r\n\r\nfunction fillVerticesWithoutCalc (node, buffer, renderData, color) {\r\n    let data = renderData._data,\r\n        vertexOffset = buffer.byteOffset >> 2;\r\n\r\n    let vertexCount = renderData.vertexCount;\r\n    buffer.request(vertexCount, renderData.indiceCount);\r\n\r\n    // buffer data may be realloc, need get reference after request.\r\n    let vbuf = buffer._vData,\r\n        uintbuf = buffer._uintVData;\r\n\r\n    for (let i = 0; i < vertexCount; i++) {\r\n        let vert = data[i];\r\n        vbuf[vertexOffset++] = vert.x;\r\n        vbuf[vertexOffset++] = vert.y;\r\n        vbuf[vertexOffset++] = vert.u;\r\n        vbuf[vertexOffset++] = vert.v;\r\n        uintbuf[vertexOffset++] = color;\r\n    }\r\n}\r\n\r\nfunction fillVerticesWithoutCalc3D (node, buffer, renderData, color) {\r\n    let data = renderData._data,\r\n        vertexOffset = buffer.byteOffset >> 2;\r\n\r\n    let vertexCount = renderData.vertexCount;\r\n    buffer.request(vertexCount, renderData.indiceCount);\r\n\r\n    // buffer data may be realloc, need get reference after request.\r\n    let vbuf = buffer._vData,\r\n        uintbuf = buffer._uintVData;\r\n\r\n    for (let i = 0; i < vertexCount; i++) {\r\n        let vert = data[i];\r\n        vbuf[vertexOffset++] = vert.x;\r\n        vbuf[vertexOffset++] = vert.y;\r\n        vbuf[vertexOffset++] = vert.z;\r\n        vbuf[vertexOffset++] = vert.u;\r\n        vbuf[vertexOffset++] = vert.v;\r\n        uintbuf[vertexOffset++] = color;\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    fillVertices: fillVertices,\r\n    fillVertices3D: fillVertices3D,\r\n    fillVerticesWithoutCalc: fillVerticesWithoutCalc,\r\n    fillVerticesWithoutCalc3D: fillVerticesWithoutCalc3D\r\n};\r\n","const renderEngine = require('../render-engine');\r\nconst gfx = renderEngine.gfx;\r\n\r\nlet MeshBuffer = cc.Class({\r\n    name: 'cc.MeshBuffer',\r\n    ctor (renderer, vertexFormat) {\r\n        this.byteStart = 0;\r\n        this.byteOffset = 0;\r\n        this.indiceStart = 0;\r\n        this.indiceOffset = 0;\r\n        this.vertexStart = 0;\r\n        this.vertexOffset = 0;\r\n\r\n        this._vertexFormat = vertexFormat;\r\n        this._vertexBytes = this._vertexFormat._bytes;\r\n\r\n        this._vb = new gfx.VertexBuffer(\r\n            renderer._device,\r\n            vertexFormat,\r\n            gfx.USAGE_DYNAMIC,\r\n            new ArrayBuffer(),\r\n            0\r\n        );\r\n\r\n        this._ib = new gfx.IndexBuffer(\r\n            renderer._device,\r\n            gfx.INDEX_FMT_UINT16,\r\n            gfx.USAGE_STATIC,\r\n            new ArrayBuffer(),\r\n            0\r\n        );\r\n\r\n        this._vData = null;\r\n        this._iData = null;\r\n        this._uintVData = null;\r\n\r\n        this._renderer = renderer;\r\n\r\n        this._initVDataCount = 256 * vertexFormat._bytes; // actually 256 * 4 * (vertexFormat._bytes / 4)\r\n        this._initIDataCount = 256 * 6;\r\n        \r\n        this._reallocBuffer();\r\n    },\r\n\r\n    uploadData () {\r\n        if (this.byteOffset === 0 || !this._dirty) {\r\n            return;\r\n        }\r\n\r\n        // update vertext data\r\n        let vertexsData = new Float32Array(this._vData.buffer, 0, this.byteOffset >> 2);\r\n        let indicesData = new Uint16Array(this._iData.buffer, 0, this.indiceOffset);\r\n\r\n        let vb = this._vb;\r\n        vb.update(0, vertexsData);\r\n\r\n        let ib = this._ib;\r\n        ib.update(0, indicesData);\r\n\r\n        this._dirty = false;\r\n    },\r\n\r\n    requestStatic (vertexCount, indiceCount) {\r\n        let byteOffset = this.byteOffset + vertexCount * this._vertexBytes;\r\n        let indiceOffset = this.indiceOffset + indiceCount;\r\n\r\n        let byteLength = this._vData.byteLength;\r\n        let indiceLength = this._iData.length;\r\n        if (byteOffset > byteLength || indiceOffset > indiceLength) {\r\n            while (byteLength < byteOffset || indiceLength < indiceOffset) {\r\n                this._initVDataCount *= 2;\r\n                this._initIDataCount *= 2;\r\n\r\n                byteLength = this._initVDataCount * 4;\r\n                indiceLength = this._initIDataCount;\r\n            }\r\n\r\n            this._reallocBuffer();\r\n        }\r\n\r\n        this.vertexOffset += vertexCount;\r\n        this.indiceOffset += indiceCount;\r\n        \r\n        this.byteOffset = byteOffset;\r\n\r\n        this._dirty = true;\r\n    },\r\n\r\n    request (vertexCount, indiceCount) {\r\n        if (this._renderer._buffer !== this) {\r\n            this._renderer._flush();\r\n            this._renderer._buffer = this;\r\n        }\r\n\r\n        this.requestStatic(vertexCount, indiceCount);\r\n    },\r\n    \r\n    _reallocBuffer () {\r\n        this._reallocVData(true);\r\n        this._reallocIData(true);\r\n    },\r\n\r\n    _reallocVData (copyOldData) {\r\n        let oldVData;\r\n        if (this._vData) {\r\n            oldVData = new Uint8Array(this._vData.buffer);\r\n        }\r\n\r\n        this._vData = new Float32Array(this._initVDataCount);\r\n        this._uintVData = new Uint32Array(this._vData.buffer);\r\n        let newData = new Uint8Array(this._uintVData.buffer);\r\n\r\n        if (oldVData && copyOldData) {\r\n            for (let i = 0, l = oldVData.length; i < l; i++) {\r\n                newData[i] = oldVData[i];\r\n            }\r\n        }\r\n\r\n        this._vb._bytes = this._vData.byteLength;\r\n    },\r\n\r\n    _reallocIData (copyOldData) {\r\n        let oldIData = this._iData;\r\n\r\n        this._iData = new Uint16Array(this._initIDataCount);\r\n\r\n        if (oldIData && copyOldData) {\r\n            let iData = this._iData;\r\n            for (let i = 0, l = oldIData.length; i < l; i++) {\r\n                iData[i] = oldIData[i];\r\n            }\r\n        }\r\n\r\n        this._ib._bytes = this._iData.byteLength;\r\n    },\r\n\r\n    reset () {\r\n        this.byteStart = 0;\r\n        this.byteOffset = 0;\r\n        this.indiceStart = 0;\r\n        this.indiceOffset = 0;\r\n        this.vertexStart = 0;\r\n        this.vertexOffset = 0;\r\n        this._dirty = false;\r\n    },\r\n\r\n    destroy () {\r\n        this._ib.destroy();\r\n        this._vb.destroy();\r\n    }\r\n});\r\n\r\ncc.MeshBuffer = module.exports = MeshBuffer;\r\n","const MeshBuffer = require('./mesh-buffer');\r\n\r\nlet QuadBuffer = cc.Class({\r\n    name: 'cc.QuadBuffer',\r\n    extends: MeshBuffer,\r\n    \r\n    _fillQuadBuffer () {\r\n        let count = this._initIDataCount / 6;\r\n        let buffer = this._iData;\r\n        for (let i = 0, idx = 0; i < count; i++) {\r\n            let vertextID = i * 4;\r\n            buffer[idx++] = vertextID;\r\n            buffer[idx++] = vertextID+1;\r\n            buffer[idx++] = vertextID+2;\r\n            buffer[idx++] = vertextID+1;\r\n            buffer[idx++] = vertextID+3;\r\n            buffer[idx++] = vertextID+2;\r\n        }\r\n\r\n        let indicesData = new Uint16Array(this._iData.buffer, 0, count * 6 );\r\n        this._ib.update(0, indicesData);\r\n    },\r\n\r\n    uploadData () {\r\n        if (this.byteOffset === 0 || !this._dirty) {\r\n            return;\r\n        }\r\n\r\n        // update vertext data\r\n        let vertexsData = new Float32Array(this._vData.buffer, 0, this.byteOffset >> 2);\r\n        this._vb.update(0, vertexsData);\r\n\r\n        this._dirty = false;\r\n    },\r\n\r\n    _reallocBuffer () {\r\n        this._reallocVData(true);\r\n        this._reallocIData();\r\n        this._fillQuadBuffer();\r\n    }\r\n});\r\n\r\ncc.QuadBuffer = module.exports = QuadBuffer;\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst renderEngine = require('../render-engine');\r\nconst vertexFormat = require('./vertex-format');\r\nconst defaultVertexFormat = vertexFormat.vfmtPosUvColor;\r\nconst vfmt3D = vertexFormat.vfmt3D;\r\nconst StencilManager = require('./stencil-manager');\r\nconst dynamicAtlasManager = require('../utils/dynamic-atlas/manager');\r\nconst RenderFlow = require('../render-flow');\r\nconst QuadBuffer = require('./quad-buffer');\r\nconst MeshBuffer = require('./mesh-buffer');\r\n\r\nlet idGenerater = new (require('../../platform/id-generater'))('VertextFormat');\r\n\r\nconst RecyclePool = renderEngine.RecyclePool;\r\nconst InputAssembler = renderEngine.InputAssembler;\r\n\r\nlet _buffers = {};\r\n\r\nconst empty_material = new renderEngine.Material();\r\nempty_material.updateHash();\r\n\r\nvar RenderComponentWalker = function (device, renderScene) {\r\n    this._renderScene = renderScene;\r\n    this._device = device;\r\n    this._stencilMgr = StencilManager.sharedManager;\r\n\r\n    this.walking = false;\r\n    this.material = empty_material;\r\n    this.cullingMask = 1;\r\n\r\n    this._iaPool = new RecyclePool(function () {\r\n        return new InputAssembler();\r\n    }, 16);\r\n\r\n    this._modelPool = new RecyclePool(function () {\r\n        return new renderEngine.Model();\r\n    }, 16);\r\n\r\n    // buffers\r\n    this._quadBuffer = this.getBuffer('quad', defaultVertexFormat);\r\n    this._meshBuffer = this.getBuffer('mesh', defaultVertexFormat);\r\n    this._quadBuffer3D = this.getBuffer('quad', vfmt3D);\r\n    this._meshBuffer3D = this.getBuffer('mesh', vfmt3D);\r\n    this._buffer = this._quadBuffer;\r\n\r\n    this._batchedModels = [];\r\n    this._dummyNode = new cc.Node();\r\n    this._sortKey = 0;\r\n\r\n    this.node = this._dummyNode;\r\n    \r\n    this.parentOpacity = 1;\r\n    this.parentOpacityDirty = 0;\r\n    this.worldMatDirty = 0;\r\n\r\n    RenderFlow.init(this);\r\n};\r\n\r\nRenderComponentWalker.prototype = {\r\n    constructor: RenderComponentWalker,\r\n    \r\n    reset() {\r\n        // Reset pools\r\n        this._iaPool.reset();\r\n\r\n        // Reset scene\r\n        let scene = this._renderScene;\r\n        let models = this._batchedModels;\r\n        for (let i = 0; i < models.length; ++i) {\r\n            // remove from scene\r\n            models[i].clearInputAssemblers();\r\n            models[i].clearEffects();\r\n            scene.removeModel(models[i]);\r\n        }\r\n        this._modelPool.reset();\r\n        models.length = 0;\r\n        this._sortKey = 0;\r\n\r\n        for (let key in _buffers) {\r\n            _buffers[key].reset();\r\n        }\r\n        this._buffer = this._quadBuffer;\r\n\r\n        // reset caches for handle render components\r\n        this.node = this._dummyNode;\r\n        this.material = empty_material;\r\n        this.cullingMask = 1;\r\n\r\n        this.parentOpacity = 1;\r\n        this.parentOpacityDirty = 0;\r\n        this.worldMatDirty = 0;\r\n\r\n        // reset stencil manager's cache\r\n        this._stencilMgr.reset();\r\n    },\r\n\r\n    _flush () {\r\n        let material = this.material,\r\n            buffer = this._buffer,\r\n            indiceStart = buffer.indiceStart,\r\n            indiceOffset = buffer.indiceOffset,\r\n            indiceCount = indiceOffset - indiceStart;\r\n        if (!this.walking || !material || indiceCount <= 0) {\r\n            return;\r\n        }\r\n\r\n        let effect = material.effect;\r\n\r\n        // Generate ia\r\n        let ia = this._iaPool.add();\r\n        ia._vertexBuffer = buffer._vb;\r\n        ia._indexBuffer = buffer._ib;\r\n        ia._start = indiceStart;\r\n        ia._count = indiceCount;\r\n\r\n        // Check stencil state and modify pass\r\n        this._stencilMgr.handleEffect(effect);\r\n        \r\n        // Generate model\r\n        let model = this._modelPool.add();\r\n        this._batchedModels.push(model);\r\n        model.sortKey = this._sortKey++;\r\n        model._cullingMask = CC_EDITOR ? 1 : this.cullingMask;\r\n        model.setNode(this.node);\r\n        model.addEffect(effect);\r\n        model.addInputAssembler(ia);\r\n        \r\n        this._renderScene.addModel(model);\r\n           \r\n        buffer.byteStart = buffer.byteOffset;\r\n        buffer.indiceStart = buffer.indiceOffset;\r\n        buffer.vertexStart = buffer.vertexOffset;\r\n    },\r\n\r\n    _flushIA (iaRenderData) {\r\n        let material = iaRenderData.material;\r\n        \r\n        if (!iaRenderData.ia || !material) {\r\n            return;\r\n        }\r\n\r\n        this.material = material;\r\n\r\n        // Check stencil state and modify pass\r\n        let effect = this._stencilMgr.handleEffect(material.effect);\r\n        \r\n        // Generate model\r\n        let model = this._modelPool.add();\r\n        this._batchedModels.push(model);\r\n        model.sortKey = this._sortKey++;\r\n        model._cullingMask = CC_EDITOR ? 1 : this.cullingMask;\r\n        model.setNode(this.node);\r\n        model.addEffect(effect);\r\n        model.addInputAssembler(iaRenderData.ia);\r\n        \r\n        this._renderScene.addModel(model);\r\n    },\r\n\r\n    _commitComp (comp, assembler, cullingMask) {\r\n        if (this.material._hash !== comp._material._hash || \r\n            this.cullingMask !== cullingMask) {\r\n            this._flush();\r\n    \r\n            this.node = assembler.useModel ? comp.node : this._dummyNode;\r\n            this.material = comp._material;\r\n            this.cullingMask = cullingMask;\r\n        }\r\n    \r\n        assembler.fillBuffers(comp, this);\r\n    },\r\n\r\n    _commitIA (comp, assembler, cullingMask) {\r\n        this._flush();\r\n        this.cullingMask = cullingMask;\r\n        this.material = comp._material;\r\n        this.node = assembler.useModel ? comp.node : this._dummyNode;\r\n\r\n        assembler.renderIA(comp, this);\r\n    },\r\n\r\n    visit (scene) {\r\n        this.reset();\r\n        this.walking = true;\r\n\r\n        RenderFlow.render(scene);\r\n        \r\n        if (dynamicAtlasManager) {\r\n            dynamicAtlasManager.update();\r\n        }\r\n        \r\n        this._flush();\r\n\r\n        for (let key in _buffers) {\r\n            _buffers[key].uploadData();\r\n        }\r\n        this.walking = false;\r\n    },\r\n\r\n    getBuffer (type, vertextFormat) {\r\n        if (!vertextFormat.name) {\r\n            vertextFormat.name = idGenerater.getNewId();\r\n        }\r\n\r\n        let key = type + vertextFormat.name;\r\n        let buffer = _buffers[key];\r\n        if (!buffer) {\r\n            if (type === 'mesh') {\r\n                buffer = new MeshBuffer(this, vertextFormat);\r\n            }\r\n            else if (type === 'quad') {\r\n                buffer = new QuadBuffer(this, vertextFormat);\r\n            }\r\n            else {\r\n                cc.error(`Not support buffer type [${type}]`);\r\n                return null;\r\n            }\r\n\r\n            _buffers[key] = buffer;\r\n        }\r\n\r\n        return buffer;\r\n    }\r\n}\r\n\r\nmodule.exports = RenderComponentWalker;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst renderEngine = require('../render-engine');\r\nconst gfx = renderEngine.gfx;\r\n\r\n// Stage types\r\nvar Stage = cc.Enum({\r\n    // Stencil disabled\r\n    DISABLED: 0,\r\n    // Clear stencil buffer\r\n    CLEAR: 1,\r\n    // Entering a new level, should handle new stencil\r\n    ENTER_LEVEL: 2,\r\n    // In content\r\n    ENABLED: 3,\r\n    // Exiting a level, should restore old stencil or disable\r\n    EXIT_LEVEL: 4,\r\n});\r\n\r\nfunction StencilManager () {\r\n    // todo: 8 is least Stencil depth supported by webGL device, it could be adjusted to vendor implementation value\r\n    this._maxLevel = 8;\r\n    // Current mask\r\n    this._maskStack = [];\r\n    // Current stage of process, DISABLED, ENTER_LEVEL, ENABLED, EXIT_LEVEL\r\n    this.stage = Stage.DISABLED;\r\n}\r\n\r\nStencilManager.prototype = {\r\n    constructor: StencilManager,\r\n\r\n    reset () {\r\n        // reset stack and stage\r\n        this._maskStack.length = 0;\r\n        this.stage = Stage.DISABLED;\r\n    },\r\n\r\n    handleEffect (effect) {\r\n        let technique = effect.getTechnique('transparent');\r\n        let passes = technique.passes;\r\n        if (this.stage === Stage.DISABLED) {\r\n            this.stage = Stage.DISABLED;\r\n            for (let i = 0; i < passes.length; ++i) {\r\n                let pass = passes[i];\r\n                if (pass._stencilTest) {\r\n                    pass.disableStencilTest();\r\n                }\r\n            }\r\n            return effect;\r\n        }\r\n\r\n        let mask, func, ref, stencilMask, writeMask, failOp,\r\n            zFailOp = gfx.STENCIL_OP_KEEP,\r\n            zPassOp = gfx.STENCIL_OP_KEEP;\r\n        \r\n        if (this.stage === Stage.ENABLED) {\r\n            mask = this._maskStack[this._maskStack.length - 1];\r\n            func = gfx.DS_FUNC_EQUAL;\r\n            failOp = gfx.STENCIL_OP_KEEP;\r\n            ref = this.getStencilRef();\r\n            stencilMask = ref;\r\n            writeMask = this.getWriteMask();\r\n        }\r\n        else {\r\n            if (this.stage === Stage.CLEAR) {\r\n                mask = this._maskStack[this._maskStack.length - 1];\r\n                func = gfx.DS_FUNC_NEVER;\r\n                failOp = mask.inverted ? gfx.STENCIL_OP_REPLACE : gfx.STENCIL_OP_ZERO;\r\n                ref = this.getWriteMask();\r\n                stencilMask = ref;\r\n                writeMask = ref;\r\n            }\r\n            else if (this.stage === Stage.ENTER_LEVEL) {\r\n                mask = this._maskStack[this._maskStack.length - 1];\r\n                // Fill stencil mask\r\n                func = gfx.DS_FUNC_NEVER;\r\n                failOp = mask.inverted ? gfx.STENCIL_OP_ZERO : gfx.STENCIL_OP_REPLACE;\r\n                ref = this.getWriteMask();\r\n                stencilMask = ref;\r\n                writeMask = ref;\r\n            }\r\n        }\r\n        \r\n        for (let i = 0; i < passes.length; ++i) {\r\n            let pass = passes[i];\r\n            pass.setStencilFront(func, ref, stencilMask, failOp, zFailOp, zPassOp, writeMask);\r\n            pass.setStencilBack(func, ref, stencilMask, failOp, zFailOp, zPassOp, writeMask);\r\n        }\r\n        return effect;\r\n    },\r\n\r\n    pushMask (mask) {\r\n        if (this._maskStack.length + 1 > this._maxLevel) {\r\n            cc.errorID(9000, this._maxLevel);\r\n        }\r\n        this._maskStack.push(mask);\r\n    },\r\n\r\n    clear () {\r\n        this.stage = Stage.CLEAR;\r\n    },\r\n\r\n    enterLevel () {\r\n        this.stage = Stage.ENTER_LEVEL;\r\n    },\r\n\r\n    enableMask () {\r\n        this.stage = Stage.ENABLED;\r\n    },\r\n\r\n    exitMask () {\r\n        if (this._maskStack.length === 0) {\r\n            cc.errorID(9001);\r\n        }\r\n        this._maskStack.pop();\r\n        if (this._maskStack.length === 0) {\r\n            this.stage = Stage.DISABLED;\r\n        }\r\n        else {\r\n            this.stage = Stage.ENABLED;\r\n        }\r\n    },\r\n  \r\n    getWriteMask () {\r\n        return 0x01 << (this._maskStack.length - 1);\r\n    },\r\n\r\n    getExitWriteMask () {\r\n        return 0x01 << this._maskStack.length;\r\n    },\r\n  \r\n    getStencilRef () {\r\n        let result = 0;\r\n        for (let i = 0; i < this._maskStack.length; ++i) {\r\n            result += (0x01 << i);\r\n        }\r\n        return result;\r\n    },\r\n\r\n    getInvertedRef () {\r\n        let result = 0;\r\n        for (let i = 0; i < this._maskStack.length - 1; ++i) {\r\n            result += (0x01 << i);\r\n        }\r\n        return result;\r\n    }\r\n};\r\n\r\nStencilManager.sharedManager = new StencilManager();\r\nStencilManager.Stage = Stage;\r\n\r\nmodule.exports = StencilManager;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst renderEngine = require('../render-engine');\r\nconst gfx = renderEngine.gfx;\r\n\r\nvar vfmt3D = new gfx.VertexFormat([\r\n    { name: gfx.ATTR_POSITION, type: gfx.ATTR_TYPE_FLOAT32, num: 3 },\r\n    { name: gfx.ATTR_UV0, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },\r\n    { name: gfx.ATTR_COLOR, type: gfx.ATTR_TYPE_UINT8, num: 4, normalize: true },\r\n]);\r\nvfmt3D.name = 'vfmt3D';\r\n\r\nvar vfmtPosUvColor = new gfx.VertexFormat([\r\n    { name: gfx.ATTR_POSITION, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },\r\n    { name: gfx.ATTR_UV0, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },\r\n    { name: gfx.ATTR_COLOR, type: gfx.ATTR_TYPE_UINT8, num: 4, normalize: true },\r\n]);\r\nvfmtPosUvColor.name = 'vfmtPosUvColor';\r\n\r\nvar vfmtPosUv = new gfx.VertexFormat([\r\n    { name: gfx.ATTR_POSITION, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },\r\n    { name: gfx.ATTR_UV0, type: gfx.ATTR_TYPE_FLOAT32, num: 2 }\r\n]);\r\nvfmtPosUv.name = 'vfmtPosUv';\r\n\r\nvar vfmtPosColor = new gfx.VertexFormat([\r\n    { name: gfx.ATTR_POSITION, type: gfx.ATTR_TYPE_FLOAT32, num: 2 },\r\n    { name: gfx.ATTR_COLOR, type: gfx.ATTR_TYPE_UINT8, num: 4, normalize: true },\r\n]);\r\nvfmtPosColor.name = 'vfmtPosColor';\r\n\r\nmodule.exports = {\r\n    vfmt3D,\r\n    vfmtPosUvColor,\r\n    vfmtPosUv,\r\n    vfmtPosColor\r\n};","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('../platform/CCSys');\r\n\r\nvar EXTNAME_RE = /(\\.[^\\.\\/\\?\\\\]*)(\\?.*)?$/;\r\nvar DIRNAME_RE = /((.*)(\\/|\\\\|\\\\\\\\))?(.*?\\..*$)?/;\r\nvar NORMALIZE_RE = /[^\\.\\/]+\\/\\.\\.\\//;\r\n\r\n/**\r\n * !#en The module provides utilities for working with file and directory paths\r\n * !#zh \r\n * @class path\r\n * @static\r\n */\r\ncc.path = /** @lends cc.path# */{\r\n    /**\r\n     * !#en Join strings to be a path.\r\n     * !#zh  Path\r\n     * @method join\r\n     * @example {@link cocos2d/core/utils/CCPath/join.js}\r\n     * @returns {String}\r\n     */\r\n    join: function () {\r\n        var l = arguments.length;\r\n        var result = \"\";\r\n        for (var i = 0; i < l; i++) {\r\n            result = (result + (result === \"\" ? \"\" : \"/\") + arguments[i]).replace(/(\\/|\\\\\\\\)$/, \"\");\r\n        }\r\n        return result;\r\n    },\r\n\r\n    /**\r\n     * !#en Get the ext name of a path including '.', like '.png'.\r\n     * !#zh  Path  '.' '.png'\r\n     * @method extname\r\n     * @example {@link cocos2d/core/utils/CCPath/extname.js}\r\n     * @param {String} pathStr\r\n     * @returns {*}\r\n     */\r\n    extname: function (pathStr) {\r\n        var temp = EXTNAME_RE.exec(pathStr);\r\n        return temp ? temp[1] : '';\r\n    },\r\n\r\n    /**\r\n     * !#en Get the main name of a file name\r\n     * !#zh \r\n     * @method mainFileName\r\n     * @param {String} fileName\r\n     * @returns {String}\r\n     * @deprecated\r\n     */\r\n    mainFileName: function (fileName) {\r\n        if (fileName) {\r\n            var idx = fileName.lastIndexOf(\".\");\r\n            if (idx !== -1)\r\n                return fileName.substring(0, idx);\r\n        }\r\n        return fileName;\r\n    },\r\n\r\n    /**\r\n     * !#en Get the file name of a file path.\r\n     * !#zh \r\n     * @method basename\r\n     * @example {@link cocos2d/core/utils/CCPath/basename.js}\r\n     * @param {String} pathStr\r\n     * @param {String} [extname]\r\n     * @returns {*}\r\n     */\r\n    basename: function (pathStr, extname) {\r\n        var index = pathStr.indexOf(\"?\");\r\n        if (index > 0) pathStr = pathStr.substring(0, index);\r\n        var reg = /(\\/|\\\\)([^\\/\\\\]+)$/g;\r\n        var result = reg.exec(pathStr.replace(/(\\/|\\\\)$/, \"\"));\r\n        if (!result) return null;\r\n        var baseName = result[2];\r\n        if (extname && pathStr.substring(pathStr.length - extname.length).toLowerCase() === extname.toLowerCase())\r\n            return baseName.substring(0, baseName.length - extname.length);\r\n        return baseName;\r\n    },\r\n\r\n    /**\r\n     * !#en Get dirname of a file path.\r\n     * !#zh \r\n     * @method dirname\r\n     * @example {@link cocos2d/core/utils/CCPath/dirname.js}\r\n     * @param {String} pathStr\r\n     * @returns {*}\r\n     */\r\n    dirname: function (pathStr) {\r\n        var temp = DIRNAME_RE.exec(pathStr);\r\n        return temp ? temp[2] : '';\r\n    },\r\n\r\n    /**\r\n     * !#en Change extname of a file path.\r\n     * !#zh \r\n     * @method changeExtname\r\n     * @example {@link cocos2d/core/utils/CCPath/changeExtname.js}\r\n     * @param {String} pathStr\r\n     * @param {String} [extname]\r\n     * @returns {String}\r\n     */\r\n    changeExtname: function (pathStr, extname) {\r\n        extname = extname || \"\";\r\n        var index = pathStr.indexOf(\"?\");\r\n        var tempStr = \"\";\r\n        if (index > 0) {\r\n            tempStr = pathStr.substring(index);\r\n            pathStr = pathStr.substring(0, index);\r\n        }\r\n        index = pathStr.lastIndexOf(\".\");\r\n        if (index < 0) return pathStr + extname + tempStr;\r\n        return pathStr.substring(0, index) + extname + tempStr;\r\n    },\r\n    /**\r\n     * !#en Change file name of a file path.\r\n     * !#zh \r\n     * @example {@link cocos2d/core/utils/CCPath/changeBasename.js}\r\n     * @param {String} pathStr\r\n     * @param {String} basename\r\n     * @param {Boolean} [isSameExt]\r\n     * @returns {String}\r\n     */\r\n    changeBasename: function (pathStr, basename, isSameExt) {\r\n        if (basename.indexOf(\".\") === 0) return this.changeExtname(pathStr, basename);\r\n        var index = pathStr.indexOf(\"?\");\r\n        var tempStr = \"\";\r\n        var ext = isSameExt ? this.extname(pathStr) : \"\";\r\n        if (index > 0) {\r\n            tempStr = pathStr.substring(index);\r\n            pathStr = pathStr.substring(0, index);\r\n        }\r\n        index = pathStr.lastIndexOf(\"/\");\r\n        index = index <= 0 ? 0 : index + 1;\r\n        return pathStr.substring(0, index) + basename + ext + tempStr;\r\n    },\r\n    //todo make public after verification\r\n    _normalize: function (url) {\r\n        var oldUrl = url = String(url);\r\n\r\n        //removing all ../\r\n        do {\r\n            oldUrl = url;\r\n            url = url.replace(NORMALIZE_RE, \"\");\r\n        } while (oldUrl.length !== url.length);\r\n        return url;\r\n    },\r\n\r\n    // The platform-specific file separator. '\\\\' or '/'.\r\n    sep: (cc.sys.os === cc.sys.OS_WINDOWS ? '\\\\' : '/'),\r\n\r\n    // @param {string} path\r\n    stripSep (path) {\r\n        return path.replace(/[\\/\\\\]$/, '');\r\n    }\r\n};\r\n\r\nmodule.exports = cc.path;","/****************************************************************************\r\n Copyright (c) 2008-2010 Ricardo Quesada\r\n Copyright (c) 2011-2012 cocos2d-x.org\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en\r\n * AffineTransform class represent an affine transform matrix. It's composed basically by translation, rotation, scale transformations.<br/>\r\n * !#zh\r\n * AffineTransform <br/>\r\n * @class AffineTransform\r\n * @constructor\r\n * @param {Number} a\r\n * @param {Number} b\r\n * @param {Number} c\r\n * @param {Number} d\r\n * @param {Number} tx\r\n * @param {Number} ty\r\n * @see AffineTransform.create\r\n */\r\nvar AffineTransform = function (a, b, c, d, tx, ty) {\r\n    this.a = a;\r\n    this.b = b;\r\n    this.c = c;\r\n    this.d = d;\r\n    this.tx = tx;\r\n    this.ty = ty;\r\n};\r\n\r\n/**\r\n * !#en Create a AffineTransform object with all contents in the matrix.\r\n * !#zh  AffineTransform \r\n * @method create\r\n * @static\r\n * @param {Number} a\r\n * @param {Number} b\r\n * @param {Number} c\r\n * @param {Number} d\r\n * @param {Number} tx\r\n * @param {Number} ty\r\n * @return {AffineTransform}\r\n */\r\nAffineTransform.create = function (a, b, c, d, tx, ty) {\r\n    return {a: a, b: b, c: c, d: d, tx: tx, ty: ty};\r\n};\r\n\r\n/**\r\n * !#en\r\n * Create a identity transformation matrix: <br/>\r\n * [ 1, 0, 0, <br/>\r\n *   0, 1, 0 ]\r\n * !#zh\r\n * <br/>\r\n * [ 1, 0, 0, <br/>\r\n *   0, 1, 0 ]\r\n *\r\n * @method identity\r\n * @static\r\n * @return {AffineTransform}\r\n */\r\nAffineTransform.identity = function () {\r\n    return {a: 1.0, b: 0.0, c: 0.0, d: 1.0, tx: 0.0, ty: 0.0};\r\n};\r\n\r\n/**\r\n * !#en Clone a AffineTransform object from the specified transform.\r\n * !#zh  AffineTransform \r\n * @method clone\r\n * @static\r\n * @param {AffineTransform} t\r\n * @return {AffineTransform}\r\n */\r\nAffineTransform.clone = function (t) {\r\n    return {a: t.a, b: t.b, c: t.c, d: t.d, tx: t.tx, ty: t.ty};\r\n};\r\n\r\n/**\r\n * !#en\r\n * Concatenate a transform matrix to another\r\n * The results are reflected in the out affine transform\r\n * out = t1 * t2\r\n * This function is memory free, you should create the output affine transform by yourself and manage its memory.\r\n * !#zh\r\n *  out  AffineTransform \r\n * out = t1 * t2\r\n * @method concat\r\n * @static\r\n * @param {AffineTransform} out Out object to store the concat result\r\n * @param {AffineTransform} t1 The first transform object.\r\n * @param {AffineTransform} t2 The transform object to concatenate.\r\n * @return {AffineTransform} Out object with the result of concatenation.\r\n */\r\nAffineTransform.concat = function (out, t1, t2) {\r\n    var a = t1.a, b = t1.b, c = t1.c, d = t1.d, tx = t1.tx, ty = t1.ty;\r\n    out.a = a * t2.a + b * t2.c;\r\n    out.b = a * t2.b + b * t2.d;\r\n    out.c = c * t2.a + d * t2.c;\r\n    out.d = c * t2.b + d * t2.d;\r\n    out.tx = tx * t2.a + ty * t2.c + t2.tx;\r\n    out.ty = tx * t2.b + ty * t2.d + t2.ty;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Get the invert transform of an AffineTransform object.\r\n * This function is memory free, you should create the output affine transform by yourself and manage its memory.\r\n * !#zh  AffineTransform \r\n * @method invert\r\n * @static\r\n * @param {AffineTransform} out\r\n * @param {AffineTransform} t\r\n * @return {AffineTransform} Out object with inverted result.\r\n */\r\nAffineTransform.invert = function (out, t) {\r\n    var a = t.a, b = t.b, c = t.c, d = t.d;\r\n    var determinant = 1 / (a * d - b * c);\r\n    var tx = t.tx, ty = t.ty;\r\n    out.a = determinant * d;\r\n    out.b = -determinant * b;\r\n    out.c = -determinant * c;\r\n    out.d = determinant * a;\r\n    out.tx = determinant * (c * ty - d * tx);\r\n    out.ty = determinant * (b * tx - a * ty);\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Get an AffineTransform object from a given matrix 4x4.\r\n * This function is memory free, you should create the output affine transform by yourself and manage its memory.\r\n * !#zh  4x4 Matrix  AffineTransform  AffineTransform \r\n * @method invert\r\n * @static\r\n * @param {AffineTransform} out\r\n * @param {Mat4} mat\r\n * @return {AffineTransform} Out object with inverted result.\r\n */\r\nAffineTransform.fromMat4 = function (out, mat) {\r\n    out.a = mat.m00;\r\n    out.b = mat.m01;\r\n    out.c = mat.m04;\r\n    out.d = mat.m05;\r\n    out.tx = mat.m12;\r\n    out.ty = mat.m13;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Apply the affine transformation on a point.\r\n * This function is memory free, you should create the output Vec2 by yourself and manage its memory.\r\n * !#zh  Vec2 \r\n * @method transformVec2\r\n * @static\r\n * @param {Vec2} out The output point to store the result\r\n * @param {Vec2|Number} point Point to apply transform or x.\r\n * @param {AffineTransform|Number} transOrY transform matrix or y.\r\n * @param {AffineTransform} [t] transform matrix.\r\n * @return {Vec2}\r\n */\r\nAffineTransform.transformVec2 = function (out, point, transOrY, t) {\r\n    var x, y;\r\n    if (t === undefined) {\r\n        t = transOrY;\r\n        x = point.x;\r\n        y = point.y;\r\n    } else {\r\n        x = point;\r\n        y = transOrY;\r\n    }\r\n    out.x = t.a * x + t.c * y + t.tx;\r\n    out.y = t.b * x + t.d * y + t.ty;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Apply the affine transformation on a size.\r\n * This function is memory free, you should create the output Size by yourself and manage its memory.\r\n * !#zh  Size  Size \r\n * @method transformSize\r\n * @static\r\n * @param {Size} out The output point to store the result\r\n * @param {Size} size\r\n * @param {AffineTransform} t\r\n * @return {Size}\r\n */\r\nAffineTransform.transformSize = function (out, size, t) {\r\n    out.width = t.a * size.width + t.c * size.height;\r\n    out.height = t.b * size.width + t.d * size.height;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Apply the affine transformation on a rect.\r\n * This function is memory free, you should create the output Rect by yourself and manage its memory.\r\n * !#zh  Rect  Rect \r\n * @method transformRect\r\n * @static\r\n * @param {Rect} out\r\n * @param {Rect} rect\r\n * @param {AffineTransform} anAffineTransform\r\n * @return {Rect}\r\n */\r\nAffineTransform.transformRect = function(out, rect, t){\r\n    var ol = rect.x;\r\n    var ob = rect.y;\r\n    var or = ol + rect.width;\r\n    var ot = ob + rect.height;\r\n    var lbx = t.a * ol + t.c * ob + t.tx;\r\n    var lby = t.b * ol + t.d * ob + t.ty;\r\n    var rbx = t.a * or + t.c * ob + t.tx;\r\n    var rby = t.b * or + t.d * ob + t.ty;\r\n    var ltx = t.a * ol + t.c * ot + t.tx;\r\n    var lty = t.b * ol + t.d * ot + t.ty;\r\n    var rtx = t.a * or + t.c * ot + t.tx;\r\n    var rty = t.b * or + t.d * ot + t.ty;\r\n\r\n    var minX = Math.min(lbx, rbx, ltx, rtx);\r\n    var maxX = Math.max(lbx, rbx, ltx, rtx);\r\n    var minY = Math.min(lby, rby, lty, rty);\r\n    var maxY = Math.max(lby, rby, lty, rty);\r\n\r\n    out.x = minX;\r\n    out.y = minY;\r\n    out.width = maxX - minX;\r\n    out.height = maxY - minY;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Apply the affine transformation on a rect, and truns to an Oriented Bounding Box.\r\n * This function is memory free, you should create the output vectors by yourself and manage their memory.\r\n * !#zh  Rect ,  Vector \r\n * @method transformObb\r\n * @static\r\n * @param {Vec2} out_bl\r\n * @param {Vec2} out_tl\r\n * @param {Vec2} out_tr\r\n * @param {Vec2} out_br\r\n * @param {Rect} rect\r\n * @param {AffineTransform} anAffineTransform\r\n */\r\nAffineTransform.transformObb = function (out_bl, out_tl, out_tr, out_br, rect, anAffineTransform) {\r\n    var x = rect.x;\r\n    var y = rect.y;\r\n    var width = rect.width;\r\n    var height = rect.height;\r\n\r\n    var tx = anAffineTransform.a * x + anAffineTransform.c * y + anAffineTransform.tx;\r\n    var ty = anAffineTransform.b * x + anAffineTransform.d * y + anAffineTransform.ty;\r\n    var xa = anAffineTransform.a * width;\r\n    var xb = anAffineTransform.b * width;\r\n    var yc = anAffineTransform.c * height;\r\n    var yd = anAffineTransform.d * height;\r\n\r\n    out_tl.x = tx;\r\n    out_tl.y = ty;\r\n    out_tr.x = xa + tx;\r\n    out_tr.y = xb + ty;\r\n    out_bl.x = yc + tx;\r\n    out_bl.y = yd + ty;\r\n    out_br.x = xa + yc + tx;\r\n    out_br.y = xb + yd + ty;\r\n};\r\n\r\ncc.AffineTransform = module.exports = AffineTransform;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Flags = require('../platform/CCObject').Flags;\r\nconst misc = require('./misc');\r\nconst js = require('../platform/js');\r\nconst IdGenerater = require('../platform/id-generater');\r\nconst eventManager = require('../event-manager');\r\nconst RenderFlow = require('../renderer/render-flow');\r\n\r\nconst Destroying = Flags.Destroying;\r\nconst DontDestroy = Flags.DontDestroy;\r\nconst Deactivating = Flags.Deactivating; \r\n\r\nconst CHILD_ADDED = 'child-added';\r\nconst CHILD_REMOVED = 'child-removed';\r\n\r\nvar idGenerater = new IdGenerater('Node');\r\n\r\nfunction getConstructor(typeOrClassName) {\r\n    if (!typeOrClassName) {\r\n        cc.errorID(3804);\r\n        return null;\r\n    }\r\n    if (typeof typeOrClassName === 'string') {\r\n        return js.getClassByName(typeOrClassName);\r\n    }\r\n\r\n    return typeOrClassName;\r\n}\r\n\r\nfunction findComponent(node, constructor) {\r\n    if (constructor._sealed) {\r\n        for (let i = 0; i < node._components.length; ++i) {\r\n            let comp = node._components[i];\r\n            if (comp.constructor === constructor) {\r\n                return comp;\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        for (let i = 0; i < node._components.length; ++i) {\r\n            let comp = node._components[i];\r\n            if (comp instanceof constructor) {\r\n                return comp;\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction findComponents(node, constructor, components) {\r\n    if (constructor._sealed) {\r\n        for (let i = 0; i < node._components.length; ++i) {\r\n            let comp = node._components[i];\r\n            if (comp.constructor === constructor) {\r\n                components.push(comp);\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        for (let i = 0; i < node._components.length; ++i) {\r\n            let comp = node._components[i];\r\n            if (comp instanceof constructor) {\r\n                components.push(comp);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction findChildComponent(children, constructor) {\r\n    for (var i = 0; i < children.length; ++i) {\r\n        var node = children[i];\r\n        var comp = findComponent(node, constructor);\r\n        if (comp) {\r\n            return comp;\r\n        }\r\n        else if (node._children.length > 0) {\r\n            comp = findChildComponent(node._children, constructor);\r\n            if (comp) {\r\n                return comp;\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction findChildComponents(children, constructor, components) {\r\n    for (var i = 0; i < children.length; ++i) {\r\n        var node = children[i];\r\n        findComponents(node, constructor, components);\r\n        if (node._children.length > 0) {\r\n            findChildComponents(node._children, constructor, components);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * A base node for CCNode, it will:\r\n * - maintain scene hierarchy and active logic\r\n * - notifications if some properties changed\r\n * - define some interfaces shares between CCNode\r\n * - define machanisms for Enity Component Systems\r\n * - define prefab and serialize functions\r\n *\r\n * @class _BaseNode\r\n * @extends Object\r\n * @uses EventTarget\r\n * @constructor\r\n * @param {String} [name]\r\n * @private\r\n */\r\nvar BaseNode = cc.Class({\r\n    name: 'cc._BaseNode',\r\n    extends: cc.Object,\r\n\r\n    properties: {\r\n        // SERIALIZABLE\r\n\r\n        _parent: null,\r\n        _children: [],\r\n\r\n        _active: true,\r\n\r\n        /**\r\n         * @property _level\r\n         * @type {Number}\r\n         * @default 0\r\n         * @private\r\n         */\r\n        _level: 0,\r\n\r\n        /**\r\n         * @property _components\r\n         * @type {Component[]}\r\n         * @default []\r\n         * @readOnly\r\n         * @private\r\n         */\r\n        _components: [],\r\n\r\n        /**\r\n         * The PrefabInfo object\r\n         * @property _prefab\r\n         * @type {PrefabInfo}\r\n         * @private\r\n         */\r\n        _prefab: null,\r\n\r\n        /**\r\n         * If true, the node is an persist node which won't be destroyed during scene transition.\r\n         * If false, the node will be destroyed automatically when loading a new scene. Default is false.\r\n         * @property _persistNode\r\n         * @type {Boolean}\r\n         * @default false\r\n         * @private\r\n         */\r\n        _persistNode: {\r\n            get () {\r\n                return (this._objFlags & DontDestroy) > 0;\r\n            },\r\n            set (value) {\r\n                if (value) {\r\n                    this._objFlags |= DontDestroy;\r\n                }\r\n                else {\r\n                    this._objFlags &= ~DontDestroy;\r\n                }\r\n            }\r\n        },\r\n\r\n        // API\r\n\r\n        /**\r\n         * !#en Name of node.\r\n         * !#zh \r\n         * @property name\r\n         * @type {String}\r\n         * @example\r\n         * node.name = \"New Node\";\r\n         * cc.log(\"Node Name: \" + node.name);\r\n         */\r\n        name: {\r\n            get () {\r\n                return this._name;\r\n            },\r\n            set (value) {\r\n                if (CC_DEV && value.indexOf('/') !== -1) {\r\n                    cc.errorID(1632);\r\n                    return;\r\n                }\r\n                this._name = value;\r\n            },\r\n        },\r\n\r\n        /**\r\n         * !#en The uuid for editor, will be stripped before building project.\r\n         * !#zh  uuid id\r\n         * @property uuid\r\n         * @type {String}\r\n         * @readOnly\r\n         * @example\r\n         * cc.log(\"Node Uuid: \" + node.uuid);\r\n         */\r\n        uuid: {\r\n            get () {\r\n                return this._id;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en All children nodes.\r\n         * !#zh \r\n         * @property children\r\n         * @type {Node[]}\r\n         * @readOnly\r\n         * @example\r\n         * var children = node.children;\r\n         * for (var i = 0; i < children.length; ++i) {\r\n         *     cc.log(\"Node: \" + children[i]);\r\n         * }\r\n         */\r\n        children: {\r\n            get () {\r\n                return this._children;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en All children nodes.\r\n         * !#zh \r\n         * @property childrenCount\r\n         * @type {Number}\r\n         * @readOnly\r\n         * @example\r\n         * var count = node.childrenCount;\r\n         * cc.log(\"Node Children Count: \" + count);\r\n         */\r\n        childrenCount: {\r\n            get () {\r\n                return this._children.length;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en\r\n         * The local active state of this node.<br/>\r\n         * Note that a Node may be inactive because a parent is not active, even if this returns true.<br/>\r\n         * Use {{#crossLink \"Node/activeInHierarchy:property\"}}{{/crossLink}} if you want to check if the Node is actually treated as active in the scene.\r\n         * !#zh\r\n         * <br/>\r\n         * <br/>\r\n         *  {{#crossLink \"Node/activeInHierarchy:property\"}}{{/crossLink}}\r\n         * @property active\r\n         * @type {Boolean}\r\n         * @default true\r\n         * @example\r\n         * node.active = false;\r\n         */\r\n        active: {\r\n            get () {\r\n                return this._active;\r\n            },\r\n            set (value) {\r\n                value = !!value;\r\n                if (this._active !== value) {\r\n                    this._active = value;\r\n                    var parent = this._parent;\r\n                    if (parent) {\r\n                        var couldActiveInScene = parent._activeInHierarchy;\r\n                        if (couldActiveInScene) {\r\n                            cc.director._nodeActivator.activateNode(this, value);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * !#en Indicates whether this node is active in the scene.\r\n         * !#zh \r\n         * @property activeInHierarchy\r\n         * @type {Boolean}\r\n         * @example\r\n         * cc.log(\"activeInHierarchy: \" + node.activeInHierarchy);\r\n         */\r\n        activeInHierarchy: {\r\n            get () {\r\n                return this._activeInHierarchy;\r\n            }\r\n        },\r\n    },\r\n\r\n    /**\r\n     * @method constructor\r\n     * @param {String} [name]\r\n     */\r\n    ctor (name) {\r\n        this._name = name !== undefined ? name : 'New Node';\r\n        this._activeInHierarchy = false;\r\n        this._id = CC_EDITOR ? Editor.Utils.UuidUtils.uuid() : idGenerater.getNewId();\r\n\r\n        cc.director._scheduler && cc.director._scheduler.enableForTarget(this);\r\n\r\n        /**\r\n         * Register all related EventTargets,\r\n         * all event callbacks will be removed in _onPreDestroy\r\n         * @property __eventTargets\r\n         * @type {EventTarget[]}\r\n         * @private\r\n         */\r\n        this.__eventTargets = [];\r\n\r\n        this._renderFlag = RenderFlow.FLAG_TRANSFORM;\r\n    },\r\n    /** \r\n     * !#en The parent of the node.\r\n     * !#zh \r\n     * @property {Node} parent\r\n     * @example \r\n     * cc.log(\"Node Parent: \" + node.parent);\r\n     */\r\n\r\n    /**\r\n     * !#en Get parent of the node.\r\n     * !#zh \r\n     * @method getParent\r\n     * @return {Node}\r\n     * @example\r\n     * var parent = this.node.getParent();\r\n     */\r\n    getParent () {\r\n        return this._parent;\r\n    },\r\n\r\n    /**\r\n     * !#en Set parent of the node.\r\n     * !#zh \r\n     * @method setParent\r\n     * @param {Node} value\r\n     * @example\r\n     * node.setParent(newNode);\r\n     */\r\n    setParent (value) {\r\n        if (this._parent === value) {\r\n            return;\r\n        }\r\n        if (CC_EDITOR && cc.engine && !cc.engine.isPlaying) {\r\n            if (_Scene.DetectConflict.beforeAddChild(this)) {\r\n                return;\r\n            }\r\n        }\r\n        var oldParent = this._parent;\r\n        if (CC_DEBUG && oldParent && (oldParent._objFlags & Deactivating)) {\r\n            cc.errorID(3821);\r\n        }\r\n        this._parent = value || null;\r\n\r\n        this._onSetParent(value);\r\n\r\n        if (value) {\r\n            if (CC_DEBUG && (value._objFlags & Deactivating)) {\r\n                cc.errorID(3821);\r\n            }\r\n            this._level = value._level + 1;\r\n            eventManager._setDirtyForNode(this);\r\n            value._children.push(this);\r\n            value.emit && value.emit(CHILD_ADDED, this);\r\n            value._renderFlag |= RenderFlow.FLAG_CHILDREN;\r\n        }\r\n        if (oldParent) {\r\n            if (!(oldParent._objFlags & Destroying)) {\r\n                var removeAt = oldParent._children.indexOf(this);\r\n                if (CC_DEV && removeAt < 0) {\r\n                    return cc.errorID(1633);\r\n                }\r\n                oldParent._children.splice(removeAt, 1);\r\n                oldParent.emit && oldParent.emit(CHILD_REMOVED, this);\r\n                this._onHierarchyChanged(oldParent);\r\n\r\n                if (oldParent._children.length === 0) {\r\n                    oldParent._renderFlag &= ~RenderFlow.FLAG_CHILDREN;\r\n                }\r\n            }\r\n        }\r\n        else if (value) {\r\n            this._onHierarchyChanged(null);\r\n        }\r\n    },\r\n\r\n    // ABSTRACT INTERFACES\r\n\r\n    /**\r\n     * !#en\r\n     * Properties configuration function <br/>\r\n     * All properties in attrs will be set to the node, <br/>\r\n     * when the setter of the node is available, <br/>\r\n     * the property will be set via setter function.<br/>\r\n     * !#zh  attrs \r\n     * @method attr\r\n     * @param {Object} attrs - Properties to be set to node\r\n     * @example\r\n     * var attrs = { key: 0, num: 100 };\r\n     * node.attr(attrs);\r\n     */\r\n    attr (attrs) {\r\n        js.mixin(this, attrs);\r\n    },\r\n\r\n    // composition: GET\r\n\r\n    /**\r\n     * !#en Returns a child from the container given its uuid.\r\n     * !#zh  uuid \r\n     * @method getChildByUuid\r\n     * @param {String} uuid - The uuid to find the child node.\r\n     * @return {Node} a Node whose uuid equals to the input parameter\r\n     * @example\r\n     * var child = node.getChildByUuid(uuid);\r\n     */\r\n    getChildByUuid (uuid) {\r\n        if (!uuid) {\r\n            cc.log(\"Invalid uuid\");\r\n            return null;\r\n        }\r\n\r\n        var locChildren = this._children;\r\n        for (var i = 0, len = locChildren.length; i < len; i++) {\r\n            if (locChildren[i]._id === uuid)\r\n                return locChildren[i];\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns a child from the container given its name.\r\n     * !#zh \r\n     * @method getChildByName\r\n     * @param {String} name - A name to find the child node.\r\n     * @return {Node} a CCNode object whose name equals to the input parameter\r\n     * @example\r\n     * var child = node.getChildByName(\"Test Node\");\r\n     */\r\n    getChildByName (name) {\r\n        if (!name) {\r\n            cc.log(\"Invalid name\");\r\n            return null;\r\n        }\r\n\r\n        var locChildren = this._children;\r\n        for (var i = 0, len = locChildren.length; i < len; i++) {\r\n            if (locChildren[i]._name === name)\r\n                return locChildren[i];\r\n        }\r\n        return null;\r\n    },\r\n\r\n    // composition: ADD\r\n\r\n    addChild (child) {\r\n\r\n        if (CC_DEV && !(child instanceof cc._BaseNode)) {\r\n            return cc.errorID(1634, cc.js.getClassName(child));\r\n        }\r\n        cc.assertID(child, 1606);\r\n        cc.assertID(child._parent === null, 1605);\r\n\r\n        // invokes the parent setter\r\n        child.setParent(this);\r\n\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Inserts a child to the node at a specified index.\r\n     * !#zh\r\n     * \r\n     * @method insertChild\r\n     * @param {Node} child - the child node to be inserted\r\n     * @param {Number} siblingIndex - the sibling index to place the child in\r\n     * @example\r\n     * node.insertChild(child, 2);\r\n     */\r\n    insertChild (child, siblingIndex) {\r\n        child.parent = this;\r\n        child.setSiblingIndex(siblingIndex);\r\n    },\r\n\r\n    // HIERARCHY METHODS\r\n\r\n    /**\r\n     * !#en Get the sibling index.\r\n     * !#zh \r\n     * @method getSiblingIndex\r\n     * @return {Number}\r\n     * @example\r\n     * var index = node.getSiblingIndex();\r\n     */\r\n    getSiblingIndex () {\r\n        if (this._parent) {\r\n            return this._parent._children.indexOf(this);\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Set the sibling index of this node.\r\n     * !#zh \r\n     * @method setSiblingIndex\r\n     * @param {Number} index\r\n     * @example\r\n     * node.setSiblingIndex(1);\r\n     */\r\n    setSiblingIndex (index) {\r\n        if (!this._parent) {\r\n            return;\r\n        }\r\n        if (this._parent._objFlags & Deactivating) {\r\n            cc.errorID(3821);\r\n            return;\r\n        }\r\n        var siblings = this._parent._children;\r\n        index = index !== -1 ? index : siblings.length - 1;\r\n        var oldIndex = siblings.indexOf(this);\r\n        if (index !== oldIndex) {\r\n            siblings.splice(oldIndex, 1);\r\n            if (index < siblings.length) {\r\n                siblings.splice(index, 0, this);\r\n            }\r\n            else {\r\n                siblings.push(this);\r\n            }\r\n            this._onSiblingIndexChanged && this._onSiblingIndexChanged(index);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Walk though the sub children tree of the current node.\r\n     * Each node, including the current node, in the sub tree will be visited two times, before all children and after all children.\r\n     * This function call is not recursive, it's based on stack.\r\n     * Please don't walk any other node inside the walk process.\r\n     * !#zh \r\n     * prefunc postfunc \r\n     * \r\n     *  walk  walk\r\n     * @method walk\r\n     * @param {Function} prefunc The callback to process node when reach the node for the first time\r\n     * @param {_BaseNode} prefunc.target The current visiting node\r\n     * @param {Function} postfunc The callback to process node when re-visit the node after walked all children in its sub tree\r\n     * @param {_BaseNode} postfunc.target The current visiting node\r\n     * @example\r\n     * node.walk(function (target) {\r\n     *     console.log('Walked through node ' + target.name + ' for the first time');\r\n     * }, function (target) {\r\n     *     console.log('Walked through node ' + target.name + ' after walked all children in its sub tree');\r\n     * });\r\n     */\r\n    walk (prefunc, postfunc) {\r\n        var BaseNode = cc._BaseNode;\r\n        var index = 1;\r\n        var children, child, curr, i, afterChildren;\r\n        var stack = BaseNode._stacks[BaseNode._stackId];\r\n        if (!stack) {\r\n            stack = [];\r\n            BaseNode._stacks.push(stack);\r\n        }\r\n        BaseNode._stackId++;\r\n\r\n        stack.length = 0;\r\n        stack[0] = this;\r\n        var parent = null;\r\n        afterChildren = false;\r\n        while (index) {\r\n            index--;\r\n            curr = stack[index];\r\n            if (!curr) {\r\n                continue;\r\n            }\r\n            if (!afterChildren && prefunc) {\r\n                // pre call\r\n                prefunc(curr);\r\n            }\r\n            else if (afterChildren && postfunc) {\r\n                // post call\r\n                postfunc(curr);\r\n            }\r\n            \r\n            // Avoid memory leak\r\n            stack[index] = null;\r\n            // Do not repeatly visit child tree, just do post call and continue walk\r\n            if (afterChildren) {\r\n                afterChildren = false;\r\n            }\r\n            else {\r\n                // Children not proceeded and has children, proceed to child tree\r\n                if (curr._children.length > 0) {\r\n                    parent = curr;\r\n                    children = curr._children;\r\n                    i = 0;\r\n                    stack[index] = children[i];\r\n                    index++;\r\n                }\r\n                // No children, then repush curr to be walked for post func\r\n                else {\r\n                    stack[index] = curr;\r\n                    index++;\r\n                    afterChildren = true;\r\n                }\r\n                continue;\r\n            }\r\n            // curr has no sub tree, so look into the siblings in parent children\r\n            if (children) {\r\n                i++;\r\n                // Proceed to next sibling in parent children\r\n                if (children[i]) {\r\n                    stack[index] = children[i];\r\n                    index++;\r\n                }\r\n                // No children any more in this sub tree, go upward\r\n                else if (parent) {\r\n                    stack[index] = parent;\r\n                    index++;\r\n                    // Setup parent walk env\r\n                    afterChildren = true;\r\n                    if (parent._parent) {\r\n                        children = parent._parent._children;\r\n                        i = children.indexOf(parent);\r\n                        parent = parent._parent;\r\n                    }\r\n                    else {\r\n                        // At root\r\n                        parent = null;\r\n                        children = null;\r\n                    }\r\n\r\n                    // ERROR\r\n                    if (i < 0) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        stack.length = 0;\r\n        BaseNode._stackId--;\r\n    },\r\n\r\n    cleanup () {\r\n\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Remove itself from its parent node. If cleanup is `true`, then also remove all events and actions. <br/>\r\n     * If the cleanup parameter is not passed, it will force a cleanup, so it is recommended that you always pass in the `false` parameter when calling this API.<br/>\r\n     * If the node orphan, then nothing happens.\r\n     * !#zh\r\n     *  cleanup  `true`action <br/>\r\n     *  API  `false` <br/>\r\n     * \r\n     * @method removeFromParent\r\n     * @param {Boolean} [cleanup=true] - true if all actions and callbacks on this node should be removed, false otherwise.\r\n     * @see cc.Node#removeFromParentAndCleanup\r\n     * @example\r\n     * node.removeFromParent();\r\n     * node.removeFromParent(false);\r\n     */\r\n    removeFromParent (cleanup) {\r\n        if (this._parent) {\r\n            if (cleanup === undefined)\r\n                cleanup = true;\r\n            this._parent.removeChild(this, cleanup);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Removes a child from the container. It will also cleanup all running actions depending on the cleanup parameter. </p>\r\n     * If the cleanup parameter is not passed, it will force a cleanup. <br/>\r\n     * \"remove\" logic MUST only be on this method  <br/>\r\n     * If a class wants to extend the 'removeChild' behavior it only needs <br/>\r\n     * to override this method.\r\n     * !#zh\r\n     *  cleanup <br/>\r\n     *  cleanup  true <br/>\r\n     * @method removeChild\r\n     * @param {Node} child - The child node which will be removed.\r\n     * @param {Boolean} [cleanup=true] - true if all running actions and callbacks on the child node will be cleanup, false otherwise.\r\n     * @example\r\n     * node.removeChild(newNode);\r\n     * node.removeChild(newNode, false);\r\n     */\r\n    removeChild (child, cleanup) {\r\n        if (this._children.indexOf(child) > -1) {\r\n            // If you don't do cleanup, the child's actions will not get removed and the\r\n            if (cleanup || cleanup === undefined) {\r\n                child.cleanup();\r\n            }\r\n            // invoke the parent setter\r\n            child.parent = null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Removes all children from the container and do a cleanup all running actions depending on the cleanup parameter. <br/>\r\n     * If the cleanup parameter is not passed, it will force a cleanup.\r\n     * !#zh\r\n     *  cleanup <br/>\r\n     *  cleanup  true \r\n     * @method removeAllChildren\r\n     * @param {Boolean} [cleanup=true] - true if all running actions on all children nodes should be cleanup, false otherwise.\r\n     * @example\r\n     * node.removeAllChildren();\r\n     * node.removeAllChildren(false);\r\n     */\r\n    removeAllChildren (cleanup) {\r\n        // not using detachChild improves speed here\r\n        var children = this._children;\r\n        if (cleanup === undefined)\r\n            cleanup = true;\r\n        for (var i = children.length - 1; i >= 0; i--) {\r\n            var node = children[i];\r\n            if (node) {\r\n                // If you don't do cleanup, the node's actions will not get removed and the\r\n                if (cleanup)\r\n                    node.cleanup();\r\n\r\n                node.parent = null;\r\n            }\r\n        }\r\n        this._children.length = 0;\r\n    },\r\n\r\n    /**\r\n     * !#en Is this node a child of the given node?\r\n     * !#zh \r\n     * @method isChildOf\r\n     * @param {Node} parent\r\n     * @return {Boolean} - Returns true if this node is a child, deep child or identical to the given node.\r\n     * @example\r\n     * node.isChildOf(newNode);\r\n     */\r\n    isChildOf (parent) {\r\n        var child = this;\r\n        do {\r\n            if (child === parent) {\r\n                return true;\r\n            }\r\n            child = child._parent;\r\n        }\r\n        while (child);\r\n        return false;\r\n    },\r\n\r\n    // COMPONENT\r\n\r\n    /**\r\n     * !#en\r\n     * Returns the component of supplied type if the node has one attached, null if it doesn't.<br/>\r\n     * You can also get component in the node by passing in the name of the script.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method getComponent\r\n     * @param {Function|String} typeOrClassName\r\n     * @return {Component}\r\n     * @example\r\n     * // get sprite component.\r\n     * var sprite = node.getComponent(cc.Sprite);\r\n     * // get custom test calss.\r\n     * var test = node.getComponent(\"Test\");\r\n     * @typescript\r\n     * getComponent<T extends Component>(type: {prototype: T}): T\r\n     * getComponent(className: string): any\r\n     */\r\n    getComponent (typeOrClassName) {\r\n        var constructor = getConstructor(typeOrClassName);\r\n        if (constructor) {\r\n            return findComponent(this, constructor);\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns all components of supplied type in the node.\r\n     * !#zh \r\n     * @method getComponents\r\n     * @param {Function|String} typeOrClassName\r\n     * @return {Component[]}\r\n     * @example\r\n     * var sprites = node.getComponents(cc.Sprite);\r\n     * var tests = node.getComponents(\"Test\");\r\n     * @typescript\r\n     * getComponents<T extends Component>(type: {prototype: T}): T[]\r\n     * getComponents(className: string): any[]\r\n     */\r\n    getComponents (typeOrClassName) {\r\n        var constructor = getConstructor(typeOrClassName), components = [];\r\n        if (constructor) {\r\n            findComponents(this, constructor, components);\r\n        }\r\n        return components;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns the component of supplied type in any of its children using depth first search.\r\n     * !#zh \r\n     * @method getComponentInChildren\r\n     * @param {Function|String} typeOrClassName\r\n     * @return {Component}\r\n     * @example\r\n     * var sprite = node.getComponentInChildren(cc.Sprite);\r\n     * var Test = node.getComponentInChildren(\"Test\");\r\n     * @typescript\r\n     * getComponentInChildren<T extends Component>(type: {prototype: T}): T\r\n     * getComponentInChildren(className: string): any\r\n     */\r\n    getComponentInChildren (typeOrClassName) {\r\n        var constructor = getConstructor(typeOrClassName);\r\n        if (constructor) {\r\n            return findChildComponent(this._children, constructor);\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * !#en Returns all components of supplied type in self or any of its children.\r\n     * !#zh \r\n     * @method getComponentsInChildren\r\n     * @param {Function|String} typeOrClassName\r\n     * @return {Component[]}\r\n     * @example\r\n     * var sprites = node.getComponentsInChildren(cc.Sprite);\r\n     * var tests = node.getComponentsInChildren(\"Test\");\r\n     * @typescript\r\n     * getComponentsInChildren<T extends Component>(type: {prototype: T}): T[]\r\n     * getComponentsInChildren(className: string): any[]\r\n     */\r\n    getComponentsInChildren (typeOrClassName) {\r\n        var constructor = getConstructor(typeOrClassName), components = [];\r\n        if (constructor) {\r\n            findComponents(this, constructor, components);\r\n            findChildComponents(this._children, constructor, components);\r\n        }\r\n        return components;\r\n    },\r\n\r\n    _checkMultipleComp: CC_EDITOR && function (ctor) {\r\n        var existing = this.getComponent(ctor._disallowMultiple);\r\n        if (existing) {\r\n            if (existing.constructor === ctor) {\r\n                cc.errorID(3805, js.getClassName(ctor), this._name);\r\n            }\r\n            else {\r\n                cc.errorID(3806, js.getClassName(ctor), this._name, js.getClassName(existing));\r\n            }\r\n            return false;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    /**\r\n     * !#en Adds a component class to the node. You can also add component to node by passing in the name of the script.\r\n     * !#zh \r\n     * @method addComponent\r\n     * @param {Function|String} typeOrClassName - The constructor or the class name of the component to add\r\n     * @return {Component} - The newly added component\r\n     * @example\r\n     * var sprite = node.addComponent(cc.Sprite);\r\n     * var test = node.addComponent(\"Test\");\r\n     * @typescript\r\n     * addComponent<T extends Component>(type: {new(): T}): T\r\n     * addComponent(className: string): any\r\n     */\r\n    addComponent (typeOrClassName) {\r\n        if (CC_EDITOR && (this._objFlags & Destroying)) {\r\n            cc.error('isDestroying');\r\n            return null;\r\n        }\r\n\r\n        // get component\r\n\r\n        var constructor;\r\n        if (typeof typeOrClassName === 'string') {\r\n            constructor = js.getClassByName(typeOrClassName);\r\n            if (!constructor) {\r\n                cc.errorID(3807, typeOrClassName);\r\n                if (cc._RFpeek()) {\r\n                    cc.errorID(3808, typeOrClassName);\r\n                }\r\n                return null;\r\n            }\r\n        }\r\n        else {\r\n            if (!typeOrClassName) {\r\n                cc.errorID(3804);\r\n                return null;\r\n            }\r\n            constructor = typeOrClassName;\r\n        }\r\n\r\n        // check component\r\n\r\n        if (typeof constructor !== 'function') {\r\n            cc.errorID(3809);\r\n            return null;\r\n        }\r\n        if (!js.isChildClassOf(constructor, cc.Component)) {\r\n            cc.errorID(3810);\r\n            return null;\r\n        }\r\n\r\n        if (CC_EDITOR && constructor._disallowMultiple) {\r\n            if (!this._checkMultipleComp(constructor)) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        // check requirement\r\n\r\n        var ReqComp = constructor._requireComponent;\r\n        if (ReqComp && !this.getComponent(ReqComp)) {\r\n            var depended = this.addComponent(ReqComp);\r\n            if (!depended) {\r\n                // depend conflicts\r\n                return null;\r\n            }\r\n        }\r\n\r\n        //// check conflict\r\n        //\r\n        //if (CC_EDITOR && !_Scene.DetectConflict.beforeAddComponent(this, constructor)) {\r\n        //    return null;\r\n        //}\r\n\r\n        //\r\n\r\n        var component = new constructor();\r\n        component.node = this;\r\n        this._components.push(component);\r\n        if ((CC_EDITOR || CC_TEST) && cc.engine && (this._id in cc.engine.attachedObjsForEditor)) {\r\n            cc.engine.attachedObjsForEditor[component._id] = component;\r\n        }\r\n        if (this._activeInHierarchy) {\r\n            cc.director._nodeActivator.activateComp(component);\r\n        }\r\n\r\n        return component;\r\n    },\r\n\r\n    /**\r\n     * This api should only used by undo system\r\n     * @method _addComponentAt\r\n     * @param {Component} comp\r\n     * @param {Number} index\r\n     * @private\r\n     */\r\n    _addComponentAt: CC_EDITOR && function (comp, index) {\r\n        if (this._objFlags & Destroying) {\r\n            return cc.error('isDestroying');\r\n        }\r\n        if (!(comp instanceof cc.Component)) {\r\n            return cc.errorID(3811);\r\n        }\r\n        if (index > this._components.length) {\r\n            return cc.errorID(3812);\r\n        }\r\n\r\n        // recheck attributes because script may changed\r\n        var ctor = comp.constructor;\r\n        if (ctor._disallowMultiple) {\r\n            if (!this._checkMultipleComp(ctor)) {\r\n                return;\r\n            }\r\n        }\r\n        var ReqComp = ctor._requireComponent;\r\n        if (ReqComp && !this.getComponent(ReqComp)) {\r\n            if (index === this._components.length) {\r\n                // If comp should be last component, increase the index because required component added\r\n                ++index;\r\n            }\r\n            var depended = this.addComponent(ReqComp);\r\n            if (!depended) {\r\n                // depend conflicts\r\n                return null;\r\n            }\r\n        }\r\n\r\n        comp.node = this;\r\n        this._components.splice(index, 0, comp);\r\n        if ((CC_EDITOR || CC_TEST) && cc.engine && (this._id in cc.engine.attachedObjsForEditor)) {\r\n            cc.engine.attachedObjsForEditor[comp._id] = comp;\r\n        }\r\n        if (this._activeInHierarchy) {\r\n            cc.director._nodeActivator.activateComp(comp);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Removes a component identified by the given name or removes the component object given.\r\n     * You can also use component.destroy() if you already have the reference.\r\n     * !#zh\r\n     * \r\n     *  component.destroy()\r\n     * @method removeComponent\r\n     * @param {String|Function|Component} component - The need remove component.\r\n     * @deprecated please destroy the component to remove it.\r\n     * @example\r\n     * node.removeComponent(cc.Sprite);\r\n     * var Test = require(\"Test\");\r\n     * node.removeComponent(Test);\r\n     */\r\n    removeComponent (component) {\r\n        if (!component) {\r\n            cc.errorID(3813);\r\n            return;\r\n        }\r\n        if (!(component instanceof cc.Component)) {\r\n            component = this.getComponent(component);\r\n        }\r\n        if (component) {\r\n            component.destroy();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @method _getDependComponent\r\n     * @param {Component} depended\r\n     * @return {Component}\r\n     * @private\r\n     */\r\n    _getDependComponent: CC_EDITOR && function (depended) {\r\n        for (var i = 0; i < this._components.length; i++) {\r\n            var comp = this._components[i];\r\n            if (comp !== depended && comp.isValid && !cc.Object._willDestroy(comp)) {\r\n                var depend = comp.constructor._requireComponent;\r\n                if (depend && depended instanceof depend) {\r\n                    return comp;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n\r\n    // do remove component, only used internally\r\n    _removeComponent (component) {\r\n        if (!component) {\r\n            cc.errorID(3814);\r\n            return;\r\n        }\r\n\r\n        if (!(this._objFlags & Destroying)) {\r\n            var i = this._components.indexOf(component);\r\n            if (i !== -1) {\r\n                this._components.splice(i, 1);\r\n                if ((CC_EDITOR || CC_TEST) && cc.engine) {\r\n                    delete cc.engine.attachedObjsForEditor[component._id];\r\n                }\r\n            }\r\n            else if (component.node !== this) {\r\n                cc.errorID(3815);\r\n            }\r\n        }\r\n    },\r\n\r\n    destroy () {\r\n        if (cc.Object.prototype.destroy.call(this)) {\r\n            this.active = false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en\r\n     * Destroy all children from the node, and release all their own references to other objects.<br/>\r\n     * Actual destruct operation will delayed until before rendering.\r\n     * !#zh\r\n     * <br/>\r\n     * \r\n     * @method destroyAllChildren\r\n     * @example\r\n     * node.destroyAllChildren();\r\n     */\r\n    destroyAllChildren () {\r\n        var children = this._children;\r\n        for (var i = 0; i < children.length; ++i) {\r\n            children[i].destroy();\r\n        }\r\n    },\r\n\r\n    _onSetParent (value) {},\r\n    _onPostActivated () {},\r\n    _onBatchRestored () {},\r\n    _onBatchCreated () {},\r\n\r\n    _onHierarchyChanged (oldParent) {\r\n        var newParent = this._parent;\r\n        if (this._persistNode && !(newParent instanceof cc.Scene)) {\r\n            cc.game.removePersistRootNode(this);\r\n            if (CC_EDITOR) {\r\n                cc.warnID(1623);\r\n            }\r\n        }\r\n\r\n        if (CC_EDITOR || CC_TEST) {\r\n            var scene = cc.director.getScene();\r\n            var inCurrentSceneBefore = oldParent && oldParent.isChildOf(scene);\r\n            var inCurrentSceneNow = newParent && newParent.isChildOf(scene);\r\n            if (!inCurrentSceneBefore && inCurrentSceneNow) {\r\n                // attached\r\n                this._registerIfAttached(true);\r\n            }\r\n            else if (inCurrentSceneBefore && !inCurrentSceneNow) {\r\n                // detached\r\n                this._registerIfAttached(false);\r\n            }\r\n\r\n            // update prefab\r\n            var newPrefabRoot = newParent && newParent._prefab && newParent._prefab.root;\r\n            var myPrefabInfo = this._prefab;\r\n            var PrefabUtils = Editor.require('scene://utils/prefab');\r\n            if (myPrefabInfo) {\r\n                if (newPrefabRoot) {\r\n                    if (myPrefabInfo.root !== newPrefabRoot) {\r\n                        // change prefab\r\n                        PrefabUtils.unlinkPrefab(this);\r\n                        PrefabUtils.linkPrefab(newPrefabRoot._prefab.asset, newPrefabRoot, this);\r\n                    }\r\n                }\r\n                else if (myPrefabInfo.root !== this) {\r\n                    // detach from prefab\r\n                    PrefabUtils.unlinkPrefab(this);\r\n                }\r\n            }\r\n            else if (newPrefabRoot) {\r\n                // attach to prefab\r\n                PrefabUtils.linkPrefab(newPrefabRoot._prefab.asset, newPrefabRoot, this);\r\n            }\r\n\r\n            // conflict detection\r\n            _Scene.DetectConflict.afterAddChild(this);\r\n        }\r\n\r\n        var shouldActiveNow = this._active && !!(newParent && newParent._activeInHierarchy);\r\n        if (this._activeInHierarchy !== shouldActiveNow) {\r\n            cc.director._nodeActivator.activateNode(this, shouldActiveNow);\r\n        }\r\n    },\r\n\r\n    _instantiate (cloned) {\r\n        if (!cloned) {\r\n            cloned = cc.instantiate._clone(this, this);\r\n        }\r\n\r\n        var thisPrefabInfo = this._prefab;\r\n        if (CC_EDITOR && thisPrefabInfo) {\r\n            if (this !== thisPrefabInfo.root) {\r\n                var PrefabUtils = Editor.require('scene://utils/prefab');\r\n                PrefabUtils.initClonedChildOfPrefab(cloned);\r\n            }\r\n        }\r\n        var syncing = thisPrefabInfo && this === thisPrefabInfo.root && thisPrefabInfo.sync;\r\n        if (syncing) {\r\n            //if (thisPrefabInfo._synced) {\r\n            //    return clone;\r\n            //}\r\n        }\r\n        else if (CC_EDITOR && cc.engine._isPlaying) {\r\n            cloned._name += ' (Clone)';\r\n        }\r\n\r\n        // reset and init\r\n        cloned._parent = null;\r\n        cloned._onBatchRestored();\r\n\r\n        return cloned;\r\n    },\r\n\r\n    _registerIfAttached: (CC_EDITOR || CC_TEST) && function (register) {\r\n        var attachedObjsForEditor = cc.engine.attachedObjsForEditor;\r\n        if (register) {\r\n            attachedObjsForEditor[this._id] = this;\r\n            for (let i = 0; i < this._components.length; i++) {\r\n                let comp = this._components[i];\r\n                attachedObjsForEditor[comp._id] = comp;\r\n            }\r\n            cc.engine.emit('node-attach-to-scene', this);\r\n        }\r\n        else {\r\n            cc.engine.emit('node-detach-from-scene', this);\r\n            delete attachedObjsForEditor[this._id];\r\n            for (let i = 0; i < this._components.length; i++) {\r\n                let comp = this._components[i];\r\n                delete attachedObjsForEditor[comp._id];\r\n            }\r\n        }\r\n        var children = this._children;\r\n        for (let i = 0, len = children.length; i < len; ++i) {\r\n            var child = children[i];\r\n            child._registerIfAttached(register);\r\n        }\r\n    },\r\n\r\n    _onPreDestroy () {\r\n        var i, len;\r\n\r\n        // marked as destroying\r\n        this._objFlags |= Destroying;\r\n\r\n        // detach self and children from editor\r\n        var parent = this._parent;\r\n        var destroyByParent = parent && (parent._objFlags & Destroying);\r\n        if (!destroyByParent && (CC_EDITOR || CC_TEST)) {\r\n            this._registerIfAttached(false);\r\n        }\r\n\r\n        // destroy children\r\n        var children = this._children;\r\n        for (i = 0, len = children.length; i < len; ++i) {\r\n            // destroy immediate so its _onPreDestroy can be called\r\n            children[i]._destroyImmediate();\r\n        }\r\n\r\n        // destroy self components\r\n        for (i = 0, len = this._components.length; i < len; ++i) {\r\n            var component = this._components[i];\r\n            // destroy immediate so its _onPreDestroy can be called\r\n            component._destroyImmediate();\r\n        }\r\n\r\n        var eventTargets = this.__eventTargets;\r\n        for (i = 0, len = eventTargets.length; i < len; ++i) {\r\n            var target = eventTargets[i];\r\n            target && target.targetOff(this);\r\n        }\r\n        eventTargets.length = 0;\r\n\r\n        // remove from persist\r\n        if (this._persistNode) {\r\n            cc.game.removePersistRootNode(this);\r\n        }\r\n\r\n        if (!destroyByParent) {\r\n            // remove from parent\r\n            if (parent) {\r\n                var childIndex = parent._children.indexOf(this);\r\n                parent._children.splice(childIndex, 1);\r\n                parent.emit && parent.emit('child-removed', this);\r\n            }\r\n        }\r\n\r\n        return destroyByParent;\r\n    },\r\n\r\n    onRestore: CC_EDITOR && function () {\r\n        // check activity state\r\n        var shouldActiveNow = this._active && !!(this._parent && this._parent._activeInHierarchy);\r\n        if (this._activeInHierarchy !== shouldActiveNow) {\r\n            cc.director._nodeActivator.activateNode(this, shouldActiveNow);\r\n        }\r\n    },\r\n});\r\n\r\nBaseNode.idGenerater = idGenerater;\r\n\r\n// For walk\r\nBaseNode._stacks = [[]];\r\nBaseNode._stackId = 0;\r\n\r\nBaseNode.prototype._onPreDestroyBase = BaseNode.prototype._onPreDestroy;\r\nif (CC_EDITOR) {\r\n    BaseNode.prototype._onPreDestroy = function () {\r\n       var destroyByParent = this._onPreDestroyBase();\r\n       if (!destroyByParent) {\r\n           // ensure this node can reattach to scene by undo system\r\n           // (simulate some destruct logic to make undo system work correctly)\r\n           this._parent = null;\r\n       }\r\n       return destroyByParent;\r\n   };\r\n}\r\n\r\nBaseNode.prototype._onHierarchyChangedBase = BaseNode.prototype._onHierarchyChanged;\r\n\r\nif(CC_EDITOR) {\r\n    BaseNode.prototype._onRestoreBase = BaseNode.prototype.onRestore;\r\n}\r\n\r\n// Define public getter and setter methods to ensure api compatibility.\r\nvar SameNameGetSets = ['parent', 'name', 'children', 'childrenCount',];\r\nmisc.propertyDefine(BaseNode, SameNameGetSets, {});\r\n\r\nif (CC_DEV) {\r\n    // promote debug info\r\n    js.get(BaseNode.prototype, ' INFO ', function () {\r\n        var path = '';\r\n        var node = this;\r\n        while (node && !(node instanceof cc.Scene)) {\r\n            if (path) {\r\n                path = node.name + '/' + path;\r\n            }\r\n            else {\r\n                path = node.name;\r\n            }\r\n            node = node._parent;\r\n        }\r\n        return this.name + ', path: ' + path;\r\n    });\r\n}\r\n\r\n/**\r\n * !#en\r\n * Note: This event is only emitted from the top most node whose active value did changed,\r\n * not including its child nodes.\r\n * !#zh\r\n * \r\n * @event active-in-hierarchy-changed\r\n * @param {Event.EventCustom} event\r\n */\r\n\r\ncc._BaseNode = module.exports = BaseNode;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar EPSILON = 1e-6;\r\n\r\n/**\r\n * Searches the entire sorted Array for an element and returns the index of the element.\r\n *\r\n * @method binarySearch\r\n * @param {number[]} array\r\n * @param {number} value\r\n * @return {number} The index of item in the sorted Array, if item is found; otherwise, a negative number that is the bitwise complement of the index of the next element that is larger than item or, if there is no larger element, the bitwise complement of array's length.\r\n */\r\n// function binarySearch (array, value) {\r\n//     for (var l = 0, h = array.length - 1, m = h >>> 1;\r\n//          l <= h;\r\n//          m = (l + h) >>> 1\r\n//     ) {\r\n//         var test = array[m];\r\n//         if (test > value) {\r\n//             h = m - 1;\r\n//         }\r\n//         else if (test < value) {\r\n//             l = m + 1;\r\n//         }\r\n//         else {\r\n//             return m;\r\n//         }\r\n//     }\r\n//     return ~l;\r\n// }\r\n\r\n/**\r\n * Searches the entire sorted Array for an element and returns the index of the element.\r\n * It accepts iteratee which is invoked for value and each element of array to compute their sort ranking.\r\n * The iteratee is invoked with one argument: (value).\r\n *\r\n * @method binarySearchBy\r\n * @param {number[]} array\r\n * @param {number} value\r\n * @param {function} iteratee - the iteratee invoked per element\r\n * @return {number} The index of item in the sorted Array, if item is found; otherwise, a negative number that is the bitwise complement of the index of the next element that is larger than item or, if there is no larger element, the bitwise complement of array's length.\r\n */\r\n// function binarySearchBy (array, value, iteratee) {\r\n//     for (var l = 0, h = array.length - 1, m = h >>> 1;\r\n//          l <= h;\r\n//          m = (l + h) >>> 1\r\n//     ) {\r\n//         var test = iteratee(array[m]);\r\n//         if (test > value) {\r\n//             h = m - 1;\r\n//         }\r\n//         else if (test < value) {\r\n//             l = m + 1;\r\n//         }\r\n//         else {\r\n//             return m;\r\n//         }\r\n//     }\r\n//     return ~l;\r\n// }\r\n\r\nfunction binarySearchEpsilon (array, value) {\r\n    for (var l = 0, h = array.length - 1, m = h >>> 1;\r\n         l <= h;\r\n         m = (l + h) >>> 1\r\n    ) {\r\n        var test = array[m];\r\n        if (test > value + EPSILON) {\r\n            h = m - 1;\r\n        }\r\n        else if (test < value - EPSILON) {\r\n            l = m + 1;\r\n        }\r\n        else {\r\n            return m;\r\n        }\r\n    }\r\n    return ~l;\r\n}\r\n\r\n\r\nmodule.exports = {\r\n    binarySearchEpsilon\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar Base64Values = require('./misc').BASE64_VALUES;\r\n\r\nvar HexChars = '0123456789abcdef'.split('');\r\n\r\nvar _t = ['', '', '', ''];\r\nvar UuidTemplate = _t.concat(_t, '-', _t, '-', _t, '-', _t, '-', _t, _t, _t);\r\nvar Indices = UuidTemplate.map(function (x, i) { return x === '-' ? NaN : i; }).filter(isFinite);\r\n\r\n// fcmR3XADNLgJ1ByKhqcC5Z -> fc991dd7-0033-4b80-9d41-c8a86a702e59\r\nmodule.exports = function (base64) {\r\n    if (base64.length !== 22) {\r\n        return base64;\r\n    }\r\n    UuidTemplate[0] = base64[0];\r\n    UuidTemplate[1] = base64[1];\r\n    for (var i = 2, j = 2; i < 22; i += 2) {\r\n        var lhs = Base64Values[base64.charCodeAt(i)];\r\n        var rhs = Base64Values[base64.charCodeAt(i + 1)];\r\n        UuidTemplate[Indices[j++]] = HexChars[lhs >> 2];\r\n        UuidTemplate[Indices[j++]] = HexChars[((lhs & 3) << 2) | rhs >> 4];\r\n        UuidTemplate[Indices[j++]] = HexChars[rhs & 0xF];\r\n    }\r\n    return UuidTemplate.join('');\r\n};\r\n\r\nif (CC_TEST) {\r\n    cc._Test.decodeUuid = module.exports;\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * Finds a node by hierarchy path, the path is case-sensitive.\r\n * It will traverse the hierarchy by splitting the path using '/' character.\r\n * This function will still returns the node even if it is inactive.\r\n * It is recommended to not use this function every frame instead cache the result at startup.\r\n *\r\n * @method find\r\n * @static\r\n * @param {String} path\r\n * @param {Node} [referenceNode]\r\n * @return {Node|null} the node or null if not found\r\n */\r\ncc.find = module.exports = function (path, referenceNode) {\r\n    if (path == null) {\r\n        cc.errorID(5600);\r\n        return null;\r\n    }\r\n    if (!referenceNode) {\r\n        var scene = cc.director.getScene();\r\n        if (!scene) {\r\n            if (CC_DEV) {\r\n                cc.warnID(5601);\r\n            }\r\n            return null;\r\n        }\r\n        else if (CC_DEV && !scene.isValid) {\r\n            cc.warnID(5602);\r\n            return null;\r\n        }\r\n        referenceNode = scene;\r\n    }\r\n    else if (CC_DEV && !referenceNode.isValid) {\r\n        cc.warnID(5603);\r\n        return null;\r\n    }\r\n\r\n    var match = referenceNode;\r\n    var startIndex = (path[0] !== '/') ? 0 : 1; // skip first '/'\r\n    var nameList = path.split('/');\r\n\r\n    // parse path\r\n    for (var n = startIndex; n < nameList.length; n++) {\r\n        var name = nameList[n];\r\n        var children = match._children;\r\n        match = null;\r\n        for (var t = 0, len = children.length; t < len; ++t) {\r\n            var subChild = children[t];\r\n            if (subChild.name === name) {\r\n                match = subChild;\r\n                break;\r\n            }\r\n        }\r\n        if (!match) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return match;\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar eventRegx = /^(click)(\\s)*=/;\r\nvar imageAttrReg = /(\\s)*src(\\s)*=|(\\s)*height(\\s)*=|(\\s)*width(\\s)*=|(\\s)*click(\\s)*=|(\\s)*param(\\s)*=/;\r\n/**\r\n * A utils class for parsing HTML texts. The parsed results will be an object array.\r\n */\r\nvar HtmlTextParser = function() {\r\n    this._parsedObject = {};\r\n    this._specialSymbolArray = [];\r\n    this._specialSymbolArray.push([/&lt;/g, '<']);\r\n    this._specialSymbolArray.push([/&gt;/g, '>']);\r\n    this._specialSymbolArray.push([/&amp;/g, '&']);\r\n    this._specialSymbolArray.push([/&quot;/g, '\"']);\r\n    this._specialSymbolArray.push([/&apos;/g, '\\'']);\r\n};\r\n\r\nHtmlTextParser.prototype = {\r\n    constructor: HtmlTextParser,\r\n    parse: function(htmlString) {\r\n        this._resultObjectArray = [];\r\n        this._stack = [];\r\n\r\n        var startIndex = 0;\r\n        var length = htmlString.length;\r\n        while (startIndex < length) {\r\n            var tagBeginIndex = htmlString.indexOf('<', startIndex);\r\n            if (tagBeginIndex < 0) {\r\n                this._stack.pop();\r\n                this._processResult(htmlString.substring(startIndex));\r\n                startIndex = length;\r\n            } else {\r\n                this._processResult(htmlString.substring(startIndex, tagBeginIndex));\r\n\r\n                var tagEndIndex = htmlString.indexOf('>', startIndex);\r\n                if (tagEndIndex === -1) {\r\n                    // cc.error('The HTML tag is invalid!');\r\n                    tagEndIndex = tagBeginIndex;\r\n                } else if (htmlString.charAt(tagBeginIndex + 1) === '\\/'){\r\n                    this._stack.pop();\r\n                } else {\r\n                    this._addToStack(htmlString.substring(tagBeginIndex + 1, tagEndIndex));\r\n                }\r\n                startIndex = tagEndIndex + 1;\r\n\r\n            }\r\n        }\r\n\r\n\r\n        return this._resultObjectArray;\r\n    },\r\n\r\n    _attributeToObject: function (attribute) {\r\n        attribute = attribute.trim();\r\n\r\n        var obj = {};\r\n        var header = attribute.match(/^(color|size)(\\s)*=/);\r\n        var tagName;\r\n        var nextSpace;\r\n        var eventObj;\r\n        var eventHanlderString;\r\n        if (header) {\r\n            tagName = header[0];\r\n            attribute = attribute.substring(tagName.length).trim();\r\n            if(attribute === \"\") return obj;\r\n\r\n            //parse color\r\n            nextSpace = attribute.indexOf(' ');\r\n            switch(tagName[0]){\r\n              case 'c':\r\n                  if (nextSpace > -1) {\r\n                      obj.color = attribute.substring(0, nextSpace).trim();\r\n                  } else {\r\n                      obj.color = attribute;\r\n                  }\r\n                  break;\r\n              case 's':\r\n                  obj.size = parseInt(attribute);\r\n                  break;\r\n            }\r\n\r\n            //tag has event arguments\r\n            if(nextSpace > -1) {\r\n                eventHanlderString = attribute.substring(nextSpace+1).trim();\r\n                eventObj = this._processEventHandler(eventHanlderString);\r\n                obj.event = eventObj;\r\n            }\r\n            return obj;\r\n        }\r\n\r\n        header = attribute.match(/^(br(\\s)*\\/)/);\r\n        if(header && header[0].length > 0) {\r\n            tagName = header[0].trim();\r\n            if(tagName.startsWith(\"br\") && tagName[tagName.length-1] === \"/\") {\r\n                obj.isNewLine = true;\r\n                this._resultObjectArray.push({text: \"\", style: {newline: true}});\r\n                return obj;\r\n            }\r\n        }\r\n\r\n        header = attribute.match(/^(img(\\s)*src(\\s)*=[^>]+\\/)/);\r\n        if(header && header[0].length > 0) {\r\n            tagName = header[0].trim();\r\n            if(tagName.startsWith(\"img\") && tagName[tagName.length-1] === \"/\") {\r\n                header = attribute.match(imageAttrReg);\r\n                var tagValue;\r\n                var remainingArgument;\r\n                var isValidImageTag = false;\r\n                while (header) {\r\n                    //skip the invalid tags at first\r\n                    attribute = attribute.substring(attribute.indexOf(header[0]));\r\n                    tagName = attribute.substr(0, header[0].length);\r\n                    //remove space and = character\r\n                    remainingArgument = attribute.substring(tagName.length).trim();\r\n                    nextSpace = remainingArgument.indexOf(' ');\r\n\r\n                    tagValue = (nextSpace > -1) ? remainingArgument.substr(0, nextSpace) : remainingArgument;\r\n                    tagName = tagName.replace(/[^a-zA-Z]/g, \"\").trim();\r\n                    tagName = tagName.toLocaleLowerCase();\r\n\r\n                    attribute = remainingArgument.substring(nextSpace).trim();\r\n                    if (tagName === \"src\") {\r\n                        obj.isImage = true\r\n                        if( tagValue.endsWith( '\\/' ) ) tagValue = tagValue.substring( 0, tagValue.length - 1 );\r\n                        if( tagValue.indexOf('\\'')===0 ) {\r\n                            isValidImageTag = true;\r\n                            tagValue = tagValue.substring( 1, tagValue.length - 1 );\r\n                        } else if( tagValue.indexOf('\"')===0 ) {\r\n                            isValidImageTag = true;\r\n                            tagValue = tagValue.substring( 1, tagValue.length - 1 );\r\n                        }\r\n                        obj.src = tagValue;\r\n                    } else if (tagName === \"height\") {\r\n                        obj.imageHeight = parseInt(tagValue);\r\n                    } else if (tagName === \"width\") {\r\n                        obj.imageWidth = parseInt(tagValue);\r\n                    } else if (tagName === \"click\") {\r\n                        obj.event = this._processEventHandler(tagName + \"=\" + tagValue);\r\n                    }\r\n\r\n                    if (obj.event && tagName === 'param') {\r\n                        obj.event.param = tagValue.replace(/^\\\"|\\\"$/g, '');\r\n                    }\r\n\r\n                    header = attribute.match(imageAttrReg);\r\n                }\r\n\r\n                if( isValidImageTag && obj.isImage )\r\n                {\r\n                    this._resultObjectArray.push({text: \"\", style: obj});\r\n                }\r\n\r\n                return {};\r\n            }\r\n        }\r\n\r\n        header = attribute.match(/^(outline(\\s)*[^>]*)/);\r\n        if (header) {\r\n            attribute = header[0].substring(\"outline\".length).trim();\r\n            var defaultOutlineObject = {color: \"#ffffff\", width: 1};\r\n            if (attribute) {\r\n                var outlineAttrReg = /(\\s)*color(\\s)*=|(\\s)*width(\\s)*=|(\\s)*click(\\s)*=|(\\s)*param(\\s)*=/;\r\n                header = attribute.match(outlineAttrReg);\r\n                var tagValue;\r\n                while (header) {\r\n                    //skip the invalid tags at first\r\n                    attribute = attribute.substring(attribute.indexOf(header[0]));\r\n                    tagName = attribute.substr(0, header[0].length);\r\n                    //remove space and = character\r\n                    remainingArgument = attribute.substring(tagName.length).trim();\r\n                    nextSpace = remainingArgument.indexOf(' ');\r\n                    if (nextSpace > -1) {\r\n                        tagValue = remainingArgument.substr(0, nextSpace);\r\n                    } else {\r\n                        tagValue = remainingArgument;\r\n                    }\r\n                    tagName = tagName.replace(/[^a-zA-Z]/g, \"\").trim();\r\n                    tagName = tagName.toLocaleLowerCase();\r\n\r\n                    attribute = remainingArgument.substring(nextSpace).trim();\r\n                    if (tagName === \"click\") {\r\n                        obj.event = this._processEventHandler(tagName + \"=\" + tagValue);\r\n                    } else if (tagName === \"color\") {\r\n                        defaultOutlineObject.color = tagValue;\r\n                    } else if (tagName === \"width\") {\r\n                        defaultOutlineObject.width = parseInt(tagValue);\r\n                    }\r\n\r\n                    if (obj.event && tagName === 'param') {\r\n                        obj.event.param = tagValue.replace(/^\\\"|\\\"$/g, '');\r\n                    }\r\n\r\n                    header = attribute.match(outlineAttrReg);\r\n                }\r\n            }\r\n            obj.outline = defaultOutlineObject;\r\n        }\r\n\r\n        header = attribute.match(/^(on|u|b|i)(\\s)*/);\r\n        if(header && header[0].length > 0) {\r\n            tagName = header[0];\r\n            attribute = attribute.substring(tagName.length).trim();\r\n            switch(tagName[0]){\r\n              case 'u':\r\n                  obj.underline = true;\r\n                  break;\r\n              case 'i':\r\n                  obj.italic = true;\r\n                  break;\r\n              case 'b':\r\n                  obj.bold = true;\r\n                  break;\r\n            }\r\n            if(attribute === \"\") {\r\n                return obj;\r\n            }\r\n            eventObj = this._processEventHandler(attribute);\r\n            obj.event = eventObj;\r\n        }\r\n\r\n        return obj;\r\n    },\r\n\r\n    _processEventHandler: function (eventString) {\r\n        var index = 0;\r\n        var obj = {};\r\n        var eventNames = eventString.match(eventRegx);\r\n        var isValidTag = false;\r\n        while(eventNames) {\r\n            var eventName = eventNames[0];\r\n            var eventValue = \"\";\r\n            isValidTag = false;\r\n            eventString = eventString.substring(eventName.length).trim();\r\n            if(eventString.charAt(0) === \"\\\"\") {\r\n                index = eventString.indexOf(\"\\\"\", 1);\r\n                if (index > -1) {\r\n                    eventValue = eventString.substring(1, index).trim();\r\n                    isValidTag = true;\r\n                }\r\n                index++;\r\n            } else if(eventString.charAt(0) === \"\\'\") {\r\n                index = eventString.indexOf('\\'', 1);\r\n                if(index > -1) {\r\n                    eventValue = eventString.substring(1, index).trim();\r\n                    isValidTag = true;\r\n                }\r\n                index++;\r\n            } else {\r\n                //skip the invalid attribute value\r\n                var match = eventString.match(/(\\S)+/);\r\n                if(match) {\r\n                    eventValue = match[0];\r\n                } else {\r\n                    eventValue = \"\";\r\n                }\r\n                index = eventValue.length;\r\n            }\r\n\r\n            if(isValidTag) {\r\n                eventName = eventName.substring(0, eventName.length-1).trim();\r\n                obj[eventName] = eventValue;\r\n            }\r\n\r\n            eventString = eventString.substring(index).trim();\r\n            eventNames = eventString.match(eventRegx);\r\n        }\r\n\r\n        return obj;\r\n    },\r\n\r\n    _addToStack: function(attribute) {\r\n        var obj = this._attributeToObject(attribute);\r\n\r\n        if (this._stack.length === 0){\r\n            this._stack.push(obj);\r\n        } else {\r\n            if(obj.isNewLine || obj.isImage) {\r\n                return;\r\n            }\r\n            //for nested tags\r\n            var previousTagObj = this._stack[this._stack.length - 1];\r\n            for (var key in previousTagObj) {\r\n                if (!(obj[key])) {\r\n                    obj[key] = previousTagObj[key];\r\n                }\r\n            }\r\n            this._stack.push(obj);\r\n        }\r\n    },\r\n\r\n    _processResult: function(value) {\r\n        if (value === \"\") {\r\n            return;\r\n        }\r\n\r\n        value = this._escapeSpecialSymbol(value);\r\n        if (this._stack.length > 0) {\r\n            this._resultObjectArray.push({text: value, style: this._stack[this._stack.length - 1]});\r\n        } else {\r\n            this._resultObjectArray.push({text: value});\r\n        }\r\n    },\r\n\r\n    _escapeSpecialSymbol: function(str) {\r\n        for(var i = 0; i < this._specialSymbolArray.length; ++i) {\r\n            var key = this._specialSymbolArray[i][0];\r\n            var value = this._specialSymbolArray[i][1];\r\n\r\n            str = str.replace(key, value);\r\n        }\r\n        return str;\r\n    }\r\n};\r\n\r\nif (CC_TEST) {\r\n    cc._Test.HtmlTextParser = HtmlTextParser;\r\n}\r\n\r\nmodule.exports = HtmlTextParser;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n \r\nrequire('./CCPath');\r\nif (!CC_EDITOR) {\r\n    require('./profiler/CCProfiler');\r\n}\r\nrequire('./find');\r\nrequire('./mutable-forward-iterator');\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst js = require('../platform/js');\r\nconst renderEngine = require('../renderer/render-engine');\r\n// const Vec2 = require('../value-types/vec2');\r\n// const Vec3 = require('../value-types/vec3');\r\n// const Quat = require('../value-types/quat');\r\nconst math = renderEngine.math;\r\n\r\nvar mat4Pool = new js.Pool(128);\r\nmat4Pool.get = function () {\r\n    var matrix = this._get();\r\n    if (matrix) {\r\n        math.mat4.identity(matrix);\r\n    }\r\n    else {\r\n        matrix = math.mat4.create();\r\n    }\r\n    return matrix;\r\n};\r\n\r\n// var vec2Pool = new js.Pool(128);\r\n// vec2Pool.get = function () {\r\n//     var vec2 = this._get();\r\n//     if (vec2) {\r\n//         vec2.x = vec2.y = 0;\r\n//     }\r\n//     else {\r\n//         vec2 = new Vec2();\r\n//     }\r\n//     return vec2;\r\n// };\r\n\r\n// var vec3Pool = new js.Pool(128);\r\n// vec3Pool.get = function () {\r\n//     var vec3 = this._get();\r\n//     if (vec3) {\r\n//         vec3.x = vec3.y = vec3.z = 0;\r\n//     }\r\n//     else {\r\n//         vec3 = new Vec3();\r\n//     }\r\n//     return vec3;\r\n// };\r\n\r\nvar quatPool = new js.Pool(64);\r\nquatPool.get = function () {\r\n    var quat = this._get();\r\n    if (quat) {\r\n        quat.x = quat.y = quat.z = 0;\r\n        quat.w = 1;\r\n    }\r\n    else {\r\n        quat = math.quat.create();\r\n    }\r\n    return quat;\r\n};\r\n\r\nmodule.exports = {\r\n    mat4: mat4Pool,\r\n    // vec2: vec2Pool,\r\n    // vec3: vec3Pool,\r\n    quat: quatPool\r\n};","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('../platform/js');\r\n\r\n/**\r\n * misc utilities\r\n * @class misc\r\n * @static\r\n */\r\nvar misc = {};\r\n\r\nmisc.propertyDefine = function (ctor, sameNameGetSets, diffNameGetSets) {\r\n    function define (np, propName, getter, setter) {\r\n        var pd = Object.getOwnPropertyDescriptor(np, propName);\r\n        if (pd) {\r\n            if (pd.get) np[getter] = pd.get;\r\n            if (pd.set && setter) np[setter] = pd.set;\r\n        }\r\n        else {\r\n            var getterFunc = np[getter];\r\n            if (CC_DEV && !getterFunc) {\r\n                var clsName = (cc.Class._isCCClass(ctor) && js.getClassName(ctor)) ||\r\n                              ctor.name ||\r\n                              '(anonymous class)';\r\n                cc.warnID(5700, propName, getter, clsName);\r\n            }\r\n            else {\r\n                js.getset(np, propName, getterFunc, np[setter]);\r\n            }\r\n        }\r\n    }\r\n    var propName, np = ctor.prototype;\r\n    for (var i = 0; i < sameNameGetSets.length; i++) {\r\n        propName = sameNameGetSets[i];\r\n        var suffix = propName[0].toUpperCase() + propName.slice(1);\r\n        define(np, propName, 'get' + suffix, 'set' + suffix);\r\n    }\r\n    for (propName in diffNameGetSets) {\r\n        var getset = diffNameGetSets[propName];\r\n        define(np, propName, getset[0], getset[1]);\r\n    }\r\n};\r\n\r\n/**\r\n * @param {Number} x\r\n * @return {Number}\r\n * Constructor\r\n */\r\nmisc.NextPOT = function (x) {\r\n    x = x - 1;\r\n    x = x | (x >> 1);\r\n    x = x | (x >> 2);\r\n    x = x | (x >> 4);\r\n    x = x | (x >> 8);\r\n    x = x | (x >> 16);\r\n    return x + 1;\r\n};\r\n\r\n//var DirtyFlags = m.DirtyFlags = {\r\n//    TRANSFORM: 1 << 0,\r\n//    SIZE: 1 << 1,\r\n//    //Visible:\r\n//    //Color:\r\n//    //Opacity\r\n//    //Cache\r\n//    //Order\r\n//    //Text\r\n//    //Gradient\r\n//    ALL: (1 << 2) - 1\r\n//};\r\n//\r\n//DirtyFlags.WIDGET = DirtyFlags.TRANSFORM | DirtyFlags.SIZE;\r\n\r\nif (CC_EDITOR) {\r\n    // use anonymous function here to ensure it will not being hoisted without CC_EDITOR\r\n\r\n    misc.tryCatchFunctor_EDITOR = function (funcName, forwardArgs, afterCall, bindArg) {\r\n        function call_FUNC_InTryCatch (_R_ARGS_) {\r\n            try {\r\n                target._FUNC_(_U_ARGS_);\r\n            }\r\n            catch (e) {\r\n                cc._throw(e);\r\n            }\r\n            _AFTER_CALL_\r\n        }\r\n        // use evaled code to generate named function\r\n        return Function('arg', 'return ' + call_FUNC_InTryCatch\r\n                    .toString()\r\n                    .replace(/_FUNC_/g, funcName)\r\n                    .replace('_R_ARGS_', 'target' + (forwardArgs ? ', ' + forwardArgs : ''))\r\n                    .replace('_U_ARGS_', forwardArgs || '')\r\n                    .replace('_AFTER_CALL_', afterCall || ''))(bindArg);\r\n    };\r\n}\r\n\r\nmisc.BUILTIN_CLASSID_RE = /^(?:cc|dragonBones|sp|ccsg)\\..+/;\r\n\r\n\r\nvar BASE64_KEYS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\nvar BASE64_VALUES = new Array(123); // max char code in base64Keys\r\nfor (let i = 0; i < 123; ++i) BASE64_VALUES[i] = 64; // fill with placeholder('=') index\r\nfor (let i = 0; i < 64; ++i) BASE64_VALUES[BASE64_KEYS.charCodeAt(i)] = i;\r\n\r\n// decoded value indexed by base64 char code\r\nmisc.BASE64_VALUES = BASE64_VALUES;\r\n\r\n// set value to map, if key exists, push to array\r\nmisc.pushToMap = function (map, key, value, pushFront) {\r\n    var exists = map[key];\r\n    if (exists) {\r\n        if (Array.isArray(exists)) {\r\n            if (pushFront) {\r\n                exists.push(exists[0]);\r\n                exists[0] = value;\r\n            }\r\n            else {\r\n                exists.push(value);\r\n            }\r\n        }\r\n        else {\r\n            map[key] = (pushFront ? [value, exists] : [exists, value]);\r\n        }\r\n    }\r\n    else {\r\n        map[key] = value;\r\n    }\r\n};\r\n\r\n/**\r\n * !#en Clamp a value between from and to.\r\n * !#zh\r\n * <br/>\r\n *  max_inclusive  max_inclusive<br/>\r\n *  min_inclusive  min_inclusive<br/>\r\n * \r\n * @method clampf\r\n * @param {Number} value\r\n * @param {Number} min_inclusive\r\n * @param {Number} max_inclusive\r\n * @return {Number}\r\n * @example\r\n * var v1 = cc.misc.clampf(20, 0, 20); // 20;\r\n * var v2 = cc.misc.clampf(-1, 0, 20); //  0;\r\n * var v3 = cc.misc.clampf(10, 0, 20); // 10;\r\n */\r\nmisc.clampf = function (value, min_inclusive, max_inclusive) {\r\n    if (min_inclusive > max_inclusive) {\r\n        var temp = min_inclusive;\r\n        min_inclusive = max_inclusive;\r\n        max_inclusive = temp;\r\n    }\r\n    return value < min_inclusive ? min_inclusive : value < max_inclusive ? value : max_inclusive;\r\n};\r\n\r\n/**\r\n * !#en Clamp a value between 0 and 1.\r\n * !#zh  0 ~ 1 \r\n * @method clamp01\r\n * @param {Number} value\r\n * @return {Number}\r\n * @example\r\n * var v1 = cc.misc.clamp01(20);  // 1;\r\n * var v2 = cc.misc.clamp01(-1);  // 0;\r\n * var v3 = cc.misc.clamp01(0.5); // 0.5;\r\n */\r\nmisc.clamp01 = function (value) {\r\n    return value < 0 ? 0 : value < 1 ? value : 1;\r\n};\r\n\r\n/**\r\n * Linear interpolation between 2 numbers, the ratio sets how much it is biased to each end\r\n * @method lerp\r\n * @param {Number} a number A\r\n * @param {Number} b number B\r\n * @param {Number} r ratio between 0 and 1\r\n * @return {Number}\r\n * @example {@link utils/api/engine/docs/cocos2d/core/platform/CCMacro/lerp.js}\r\n */\r\nmisc.lerp = function (a, b, r) {\r\n    return a + (b - a) * r;\r\n};\r\n\r\n/**\r\n * converts degrees to radians\r\n * @param {Number} angle\r\n * @return {Number}\r\n * @method degreesToRadians\r\n */\r\nmisc.degreesToRadians = function (angle) {\r\n    return angle * cc.macro.RAD;\r\n};\r\n\r\n/**\r\n * converts radians to degrees\r\n * @param {Number} angle\r\n * @return {Number}\r\n * @method radiansToDegrees\r\n */\r\nmisc.radiansToDegrees = function (angle) {\r\n    return angle * cc.macro.DEG;\r\n};\r\n\r\ncc.misc = module.exports = misc;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * @example\r\n * var array = [0, 1, 2, 3, 4];\r\n * var iterator = new cc.js.array.MutableForwardIterator(array);\r\n * for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\r\n *     var item = array[iterator.i];\r\n *     ...\r\n * }\r\n */\r\nfunction MutableForwardIterator (array) {\r\n    this.i = 0;\r\n    this.array = array;\r\n}\r\n\r\nvar proto = MutableForwardIterator.prototype;\r\n\r\nproto.remove = function (value) {\r\n    var index = this.array.indexOf(value);\r\n    if (index >= 0) {\r\n        this.removeAt(index);\r\n    }\r\n};\r\nproto.removeAt = function (i) {\r\n    this.array.splice(i, 1);\r\n\r\n    if (i <= this.i) {\r\n        --this.i;\r\n    }\r\n};\r\nproto.fastRemove = function (value) {\r\n    var index = this.array.indexOf(value);\r\n    if (index >= 0) {\r\n        this.fastRemoveAt(index);\r\n    }\r\n};\r\nproto.fastRemoveAt = function (i) {\r\n    var array = this.array;\r\n    array[i] = array[array.length - 1];\r\n    --array.length;\r\n\r\n    if (i <= this.i) {\r\n        --this.i;\r\n    }\r\n};\r\n\r\nproto.push = function (item) {\r\n    this.array.push(item);\r\n};\r\n\r\n//js.getset(proto, 'length',\r\n//    function () {\r\n//        return this.array.length;\r\n//    },\r\n//    function (len) {\r\n//        this.array.length = len;\r\n//        if (this.i >= len) {\r\n//            this.i = len - 1;\r\n//        }\r\n//    }\r\n//);\r\n\r\nmodule.exports = MutableForwardIterator;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar math = require(\"../renderer\").renderEngine.math;\r\n\r\ncc._PrefabInfo = cc.Class({\r\n    name: 'cc.PrefabInfo',\r\n    // extends: require('../platform/CCObject'),\r\n    properties: {\r\n        // the most top node of this prefab in the scene\r\n        root: null,\r\n\r\n        //  prefab  (cc.Prefab)\r\n        // In Editor, only asset._uuid is usable because asset will be changed.\r\n        asset: null,\r\n\r\n        //  prefab  ID  Assets \r\n        fileId: '',\r\n\r\n        // Indicates whether this node should always synchronize with the prefab asset, only available in the root node\r\n        sync: false,\r\n\r\n        // Indicates whether this node is synchronized, only available in the root node\r\n        _synced: {\r\n            default: false,\r\n            serializable: false\r\n        },\r\n    },\r\n    // _instantiate (cloned) {\r\n    //     if (!cloned) {\r\n    //         cloned = new cc._PrefabInfo();\r\n    //     }\r\n    //     cloned.root = this.root;\r\n    //     cloned.asset = this.asset;\r\n    //     cloned.fileId = this.fileId;\r\n    //     cloned.sync = this.sync;\r\n    //     cloned._synced = this._synced;\r\n    //     return cloned;\r\n    // }\r\n});\r\n\r\n// prefab helper function\r\nmodule.exports = {\r\n    // update node to make it sync with prefab\r\n    syncWithPrefab: function (node) {\r\n        var _prefab = node._prefab;\r\n        // non-reentrant\r\n        _prefab._synced = true;\r\n        //\r\n        if (!_prefab.asset) {\r\n            if (CC_EDITOR) {\r\n                var NodeUtils = Editor.require('scene://utils/node');\r\n                var PrefabUtils = Editor.require('scene://utils/prefab');\r\n\r\n                cc.warn(Editor.T('MESSAGE.prefab.missing_prefab', { node: NodeUtils.getNodePath(node) }));\r\n                node.name += PrefabUtils.MISSING_PREFAB_SUFFIX;\r\n            }\r\n            else {\r\n                cc.errorID(3701, node.name);\r\n            }\r\n            node._prefab = null;\r\n            return;\r\n        }\r\n\r\n        // save root's preserved props to avoid overwritten by prefab\r\n        var _objFlags = node._objFlags;\r\n        var _parent = node._parent;\r\n        var _id = node._id;\r\n        var _name = node._name;\r\n        var _active = node._active;\r\n        var x = node._position.x;\r\n        var y = node._position.y;\r\n        var _quat = node._quat;\r\n        var _localZOrder = node._localZOrder;\r\n        var _globalZOrder = node._globalZOrder;\r\n\r\n        // instantiate prefab\r\n        cc.game._isCloning = true;\r\n        if (CC_SUPPORT_JIT) {\r\n            _prefab.asset._doInstantiate(node);\r\n        }\r\n        else {\r\n            // root in prefab asset is always synced\r\n            var prefabRoot = _prefab.asset.data;\r\n            prefabRoot._prefab._synced = true;\r\n\r\n            // use node as the instantiated prefabRoot to make references to prefabRoot in prefab redirect to node\r\n            prefabRoot._iN$t = node;\r\n\r\n            // instantiate prefab and apply to node\r\n            cc.instantiate._clone(prefabRoot, prefabRoot);\r\n        }\r\n        cc.game._isCloning = false;\r\n\r\n        // restore preserved props\r\n        node._objFlags = _objFlags;\r\n        node._parent = _parent;\r\n        node._id = _id;\r\n        node._prefab = _prefab;\r\n        node._name = _name;\r\n        node._active = _active;\r\n        node._position.x = x;\r\n        node._position.y = y;\r\n        math.quat.copy(node._quat, _quat);\r\n        node._localZOrder = _localZOrder;\r\n        node._globalZOrder = _globalZOrder;\r\n    }\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar macro = require('../../platform/CCMacro');\r\n\r\nconst PerfCounter = require('./perf-counter');\r\n\r\nlet _showFPS = false;\r\nlet _fontSize = 15;\r\n\r\nlet _atlas = null;\r\nlet _stats = null;\r\nlet _rootNode = null;\r\nlet _label = null;\r\n\r\nfunction generateAtlas () {\r\n    if (_atlas) return;\r\n\r\n    let textureWidth = 256,\r\n        textureHeight = 256;\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    canvas.style.width = canvas.width = textureWidth;\r\n    canvas.style.height = canvas.height = textureHeight;\r\n\r\n    // comment out this to show atlas\r\n    // document.body.appendChild(canvas)\r\n\r\n    let ctx = canvas.getContext('2d');\r\n    ctx.font = `${_fontSize}px Arial`;\r\n    ctx.textBaseline = 'top';\r\n    ctx.textAlign = 'left';\r\n    ctx.fillStyle = '#fff';\r\n    \r\n    let space = 2;\r\n    let x = space;\r\n    let y = space;\r\n    let lineHeight = _fontSize;\r\n\r\n    _atlas = new cc.LabelAtlas();\r\n    _atlas._fntConfig = {\r\n        atlasName: 'profiler-arial',\r\n        commonHeight: lineHeight,\r\n        fontSize: _fontSize,\r\n        kerningDict: {},\r\n        fontDefDictionary: {}\r\n    };\r\n\r\n    _atlas._name = 'profiler-arial';\r\n    _atlas.fontSize = _fontSize;\r\n\r\n    let dict = _atlas._fntConfig.fontDefDictionary;\r\n    \r\n    for (let i = 32; i <= 126; i++) {\r\n        let char = String.fromCharCode(i);\r\n        let width = ctx.measureText(char).width;\r\n    \r\n        if ((x + width) >= textureWidth) {\r\n            x = space;\r\n            y += lineHeight + space;\r\n        }\r\n        ctx.fillText(char, x, y);\r\n\r\n        dict[i] = {\r\n            xAdvance: width,\r\n            xOffset: 0,\r\n            yOffset: 0,\r\n            rect: {\r\n                x: x,\r\n                y: y,\r\n                width: width,\r\n                height: lineHeight\r\n            }\r\n        }\r\n\r\n        x += width + space;\r\n    }\r\n\r\n    let texture = new cc.Texture2D();\r\n    texture.initWithElement(canvas);\r\n\r\n    let spriteFrame = new cc.SpriteFrame();\r\n    spriteFrame.setTexture(texture);\r\n\r\n    _atlas.spriteFrame = spriteFrame;\r\n}\r\n\r\nfunction generateStats () {\r\n    if (_stats) return;\r\n    \r\n    _stats = {\r\n        frame: { desc: 'Frame time (ms)', min: 0, max: 50, average: 500 },\r\n        fps: { desc: 'Framerate (FPS)', below: 30, average: 500 },\r\n        draws: { desc: 'Draw call' },\r\n        logic: { desc: 'Game Logic (ms)', min: 0, max: 50, average: 500, color: '#080' },\r\n        render: { desc: 'Renderer (ms)', min: 0, max: 50, average: 500, color: '#f90' },\r\n        mode: { desc: cc.game.renderType === cc.game.RENDER_TYPE_WEBGL ? 'WebGL' : 'Canvas', min: 1 }\r\n    };\r\n\r\n    let now = performance.now();\r\n    for (let id in _stats) {\r\n        _stats[id]._counter = new PerfCounter(id, _stats[id], now);\r\n    }\r\n}\r\n\r\nfunction generateNode () {\r\n    if (_rootNode && _rootNode.isValid) return;\r\n\r\n\r\n    _rootNode = new cc.Node('PROFILER-NODE');\r\n    _rootNode.x = _rootNode.y = 10;\r\n\r\n    _rootNode.groupIndex = cc.Node.BuiltinGroupIndex.DEBUG;\r\n    cc.Camera._setupDebugCamera();\r\n\r\n    _rootNode.zIndex = macro.MAX_ZINDEX;\r\n    cc.game.addPersistRootNode(_rootNode);\r\n\r\n    let left = new cc.Node('LEFT-PANEL');\r\n    left.anchorX = left.anchorY = 0;\r\n    left.parent = _rootNode;\r\n    let leftLabel = left.addComponent(cc.Label);\r\n    leftLabel.font = _atlas;\r\n    leftLabel.fontSize = _fontSize;\r\n    leftLabel.lineHeight = _fontSize;\r\n\r\n    let right = new cc.Node('RIGHT-PANEL');\r\n    right.anchorX = 1;\r\n    right.anchorY = 0;\r\n    right.x = 200;\r\n    right.parent = _rootNode;\r\n    let rightLabel = right.addComponent(cc.Label);\r\n    rightLabel.horizontalAlign = cc.Label.HorizontalAlign.RIGHT;\r\n    rightLabel.font = _atlas;\r\n    rightLabel.fontSize = _fontSize;\r\n    rightLabel.lineHeight = _fontSize;\r\n\r\n    _label = {\r\n        left: leftLabel,\r\n        right: rightLabel\r\n    };\r\n}\r\n\r\nfunction beforeUpdate () {\r\n    generateNode();\r\n\r\n    let now = cc.director._lastUpdate;\r\n    _stats['frame']._counter.start(now);\r\n    _stats['logic']._counter.start(now);\r\n}\r\n\r\nfunction afterUpdate () {\r\n    let now = performance.now();\r\n    if (cc.director.isPaused()) {\r\n        _stats['frame']._counter.start(now);\r\n    }\r\n    else {\r\n        _stats['logic']._counter.end(now);\r\n    }\r\n    _stats['render']._counter.start(now);\r\n}\r\n\r\nfunction updateLabel (stat) {\r\n    let length = 20;\r\n    let desc = stat.desc;\r\n    let value = stat._counter.human() + '';\r\n    stat.label.string = stat.desc + '  ' + stat._counter.human();\r\n}\r\n\r\nfunction afterDraw () {\r\n    let now = performance.now();\r\n    _stats['render']._counter.end(now);\r\n    _stats['draws']._counter.value = cc.renderer.drawCalls;\r\n    _stats['frame']._counter.end(now);\r\n    _stats['fps']._counter.frame(now);\r\n    \r\n    let left = '';\r\n    let right = '';\r\n    for (let id in _stats) {\r\n        let stat = _stats[id];\r\n        stat._counter.sample(now);\r\n\r\n        left += stat.desc + '\\n';\r\n        right += stat._counter.human() + '\\n';\r\n    }\r\n\r\n    _label.left.string = left;\r\n    _label.right.string = right;\r\n}\r\n\r\ncc.profiler = module.exports = {\r\n    isShowingStats () {\r\n        return _showFPS;\r\n    },\r\n\r\n    hideStats () {\r\n        if (_showFPS) {\r\n            if (_rootNode) {\r\n                _rootNode.active = false;\r\n            }\r\n\r\n            cc.director.off(cc.Director.EVENT_BEFORE_UPDATE, beforeUpdate);\r\n            cc.director.off(cc.Director.EVENT_AFTER_UPDATE, afterUpdate);\r\n            cc.director.off(cc.Director.EVENT_AFTER_DRAW, afterDraw);\r\n            _showFPS = false;\r\n        }\r\n    },\r\n\r\n    showStats () {\r\n        if (!_showFPS) {\r\n            generateAtlas();\r\n            generateStats();\r\n\r\n            if (_rootNode) {\r\n                _rootNode.active = true;\r\n            }\r\n\r\n            cc.director.on(cc.Director.EVENT_BEFORE_UPDATE, beforeUpdate);\r\n            cc.director.on(cc.Director.EVENT_AFTER_UPDATE, afterUpdate);\r\n            cc.director.on(cc.Director.EVENT_AFTER_DRAW, afterDraw);\r\n            _showFPS = true;\r\n        }\r\n    }\r\n}","let Counter = cc.Class({\r\n    name: 'cc.Counter',\r\n    ctor (id, opts, now) {\r\n        this._id = id;\r\n        this._opts = opts || {};\r\n\r\n        this._value = 0;\r\n        this._total = 0;\r\n        this._averageValue = 0;\r\n        this._accumValue = 0;\r\n        this._accumSamples = 0;\r\n        this._accumStart = now;\r\n    },\r\n\r\n    properties: {\r\n        value: {\r\n            get () {\r\n                return this._value;\r\n            },\r\n            set (v) {\r\n                this._value = v;\r\n            }\r\n        }\r\n    },\r\n\r\n    _average (v, now) {\r\n        if (this._opts.average) {\r\n            this._accumValue += v;\r\n            ++this._accumSamples;\r\n\r\n            let t = now;\r\n            if (t - this._accumStart >= this._opts.average) {\r\n                this._averageValue = this._accumValue / this._accumSamples;\r\n                this._accumValue = 0;\r\n                this._accumStart = t;\r\n                this._accumSamples = 0;\r\n            }\r\n        }\r\n    },\r\n\r\n    sample (now) {\r\n        this._average(this._value, now);\r\n    },\r\n\r\n    human () {\r\n        let v = this._opts.average ? this._averageValue : this._value;\r\n        return Math.round(v * 100) / 100;\r\n    },\r\n\r\n    alarm () {\r\n        return (\r\n            (this._opts.below && this._value < this._opts.below) ||\r\n            (this._opts.over && this._value > this._opts.over)\r\n        );\r\n    }\r\n})\r\n\r\nmodule.exports = Counter;\r\n","const Counter = require('./counter');\r\n\r\nlet PerfCounter = cc.Class({\r\n  name: 'cc.PerfCounter',\r\n  extends: Counter,\r\n  \r\n  ctor (id, opts, now) {\r\n    // DISABLE\r\n    // this._idstart = `${id}_start`;\r\n    // this._idend = `${id}_end`;\r\n\r\n    this._time = now;\r\n  },\r\n\r\n  start(now) {\r\n    this._time = now;\r\n\r\n    // DISABLE: long time running will cause performance drop down\r\n    // window.performance.mark(this._idstart);\r\n  },\r\n\r\n  end(now) {\r\n    this._value = now - this._time;\r\n\r\n    // DISABLE: long time running will cause performance drop down\r\n    // window.performance.mark(this._idend);\r\n    // window.performance.measure(this._id, this._idstart, this._idend);\r\n\r\n    this._average(this._value);\r\n  },\r\n\r\n  tick() {\r\n    this.end();\r\n    this.start();\r\n  },\r\n\r\n  frame(now) {\r\n    let t = now;\r\n    let e = t - this._time;\r\n    this._total++;\r\n    let avg = this._opts.average || 1000;\r\n\r\n    if (e > avg) {\r\n      this._value = this._total * 1000 / e;\r\n      this._total = 0;\r\n      this._time = t;\r\n      this._average(this._value);\r\n    }\r\n  }\r\n});\r\n\r\nmodule.exports = PerfCounter;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar textUtils = {\r\n    label_wordRex : /([a-zA-Z0-9--]+|\\S)/,\r\n    label_symbolRex : /^[!,.:;'}\\]%\\?>]/,\r\n    label_lastWordRex : /([a-zA-Z0-9--]+|\\S)$/,\r\n    label_lastEnglish : /[a-zA-Z0-9--]+$/,\r\n    label_firstEnglish : /^[a-zA-Z0-9--]/,\r\n    label_wrapinspection : true,\r\n\r\n    isUnicodeCJK: function(ch) {\r\n        var __CHINESE_REG = /^[\\u4E00-\\u9FFF\\u3400-\\u4DFF]+$/;\r\n        var __JAPANESE_REG = /[\\u3000-\\u303F]|[\\u3040-\\u309F]|[\\u30A0-\\u30FF]|[\\uFF00-\\uFFEF]|[\\u4E00-\\u9FAF]|[\\u2605-\\u2606]|[\\u2190-\\u2195]|\\u203B/g;\r\n        var __KOREAN_REG = /^[\\u1100-\\u11FF]|[\\u3130-\\u318F]|[\\uA960-\\uA97F]|[\\uAC00-\\uD7AF]|[\\uD7B0-\\uD7FF]+$/;\r\n        return __CHINESE_REG.test(ch) || __JAPANESE_REG.test(ch) || __KOREAN_REG.test(ch);\r\n    },\r\n\r\n    //Checking whether the character is a whitespace\r\n    isUnicodeSpace: function(ch) {\r\n        ch = ch.charCodeAt(0);\r\n        return ((ch >= 9 && ch <= 13) || ch === 32 || ch === 133 || ch === 160 || ch === 5760 || (ch >= 8192 && ch <= 8202) || ch === 8232 || ch === 8233 || ch === 8239 || ch === 8287 || ch === 12288);\r\n    },\r\n\r\n    safeMeasureText: function (ctx, string) {\r\n        var metric = ctx.measureText(string);\r\n        return metric && metric.width || 0;\r\n    },\r\n\r\n    fragmentText: function (stringToken, allWidth, maxWidth, measureText) {\r\n        //check the first character\r\n        var wrappedWords = [];\r\n        //fast return if strArr is empty\r\n        if(stringToken.length === 0 || maxWidth < 0) {\r\n            wrappedWords.push('');\r\n            return wrappedWords;\r\n        }\r\n\r\n        var text = stringToken;\r\n        while (allWidth > maxWidth && text.length > 1) {\r\n\r\n            var fuzzyLen = text.length * ( maxWidth / allWidth ) | 0;\r\n            var tmpText = text.substr(fuzzyLen);\r\n            var width = allWidth - measureText(tmpText);\r\n            var sLine = tmpText;\r\n            var pushNum = 0;\r\n\r\n            var checkWhile = 0;\r\n            var checkCount = 10;\r\n\r\n            //Exceeded the size\r\n            while (width > maxWidth && checkWhile++ < checkCount) {\r\n                fuzzyLen *= maxWidth / width;\r\n                fuzzyLen = fuzzyLen | 0;\r\n                tmpText = text.substr(fuzzyLen);\r\n                width = allWidth - measureText(tmpText);\r\n            }\r\n\r\n            checkWhile = 0;\r\n\r\n            //Find the truncation point\r\n            while (width <= maxWidth && checkWhile++ < checkCount) {\r\n                if (tmpText) {\r\n                    var exec = this.label_wordRex.exec(tmpText);\r\n                    pushNum = exec ? exec[0].length : 1;\r\n                    sLine = tmpText;\r\n                }\r\n\r\n                fuzzyLen = fuzzyLen + pushNum;\r\n                tmpText = text.substr(fuzzyLen);\r\n                width = allWidth - measureText(tmpText);\r\n            }\r\n\r\n            fuzzyLen -= pushNum;\r\n            if (fuzzyLen === 0) {\r\n                fuzzyLen = 1;\r\n                sLine = sLine.substr(1);\r\n            }\r\n\r\n            var sText = text.substr(0, fuzzyLen), result;\r\n\r\n            //symbol in the first\r\n            if (this.label_wrapinspection) {\r\n                if (this.label_symbolRex.test(sLine || tmpText)) {\r\n                    result = this.label_lastWordRex.exec(sText);\r\n                    fuzzyLen -= result ? result[0].length : 0;\r\n                    if (fuzzyLen === 0) fuzzyLen = 1;\r\n\r\n                    sLine = text.substr(fuzzyLen);\r\n                    sText = text.substr(0, fuzzyLen);\r\n                }\r\n            }\r\n\r\n            //To judge whether a English words are truncated\r\n            if (this.label_firstEnglish.test(sLine)) {\r\n                result = this.label_lastEnglish.exec(sText);\r\n                if (result && sText !== result[0]) {\r\n                    fuzzyLen -= result[0].length;\r\n                    sLine = text.substr(fuzzyLen);\r\n                    sText = text.substr(0, fuzzyLen);\r\n                }\r\n            }\r\n\r\n            // The first line And do not wrap should not remove the space\r\n            if (wrappedWords.length === 0) {\r\n                wrappedWords.push(sText);\r\n            }\r\n            else {\r\n                sText = sText.trim();\r\n                if (sText.length > 0) {\r\n                    wrappedWords.push(sText);\r\n                }\r\n            }\r\n            text = sLine || tmpText;\r\n            allWidth = measureText(text);\r\n        }\r\n\r\n        if (wrappedWords.length === 0) {\r\n            wrappedWords.push(text);\r\n        }\r\n        else {\r\n            text = text.trim();\r\n            if (text.length > 0) {\r\n                wrappedWords.push(text);\r\n            }\r\n        }\r\n        return wrappedWords;\r\n    },\r\n};\r\n\r\nmodule.exports = textUtils;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Texture2D = require('../assets/CCTexture2D');\r\n\r\n/**\r\n * cc.textureUtil is a singleton object, it can load cc.Texture2D asynchronously\r\n * @class textureUtil\r\n * @static\r\n */\r\nlet textureUtil = {\r\n    loadImage (url, cb, target) {\r\n        cc.assertID(url, 3103);\r\n\r\n        var tex = cc.loader.getRes(url);\r\n        if (tex) {\r\n            if (tex.loaded) {\r\n                cb && cb.call(target, tex);\r\n                return tex;\r\n            }\r\n            else\r\n            {\r\n                tex.once(\"load\", function(){\r\n                   cb && cb.call(target, tex);\r\n                }, target);\r\n                return tex;\r\n            }\r\n        }\r\n        else {\r\n            tex = new Texture2D();\r\n            tex.url = url;\r\n            cc.loader.load({url: url, texture: tex}, function (err, texture) {\r\n                if (err) {\r\n                    return cb && cb.call(target, err || new Error('Unknown error'));\r\n                }\r\n                texture.handleLoadedTexture();\r\n                cb && cb.call(target, null, texture);\r\n            });\r\n            return tex;\r\n        }\r\n    },\r\n\r\n    cacheImage (url, image) {\r\n        if (url && image) {\r\n            var tex = new Texture2D();\r\n            tex.initWithElement(image);\r\n            var item = {\r\n                id: url,\r\n                url: url, // real download url, maybe changed\r\n                error: null,\r\n                content: tex,\r\n                complete: false\r\n            }\r\n            cc.loader.flowOut(item);\r\n            return tex;\r\n        }\r\n    },\r\n\r\n    postLoadTexture (texture, callback) {\r\n        if (texture.loaded) {\r\n            callback && callback();\r\n            return;\r\n        }\r\n        if (!texture.url) {\r\n            callback && callback();\r\n            return;\r\n        }\r\n        // load image\r\n        cc.loader.load({\r\n            url: texture.url,\r\n            // For image, we should skip loader otherwise it will load a new texture\r\n            skips: ['Loader'],\r\n        }, function (err, image) {\r\n            if (image) {\r\n                if (CC_DEBUG && image instanceof cc.Texture2D) {\r\n                    return cc.error('internal error: loader handle pipe must be skipped');\r\n                }\r\n                if (!texture.loaded) {\r\n                    texture._nativeAsset = image;\r\n                }\r\n            }\r\n            callback && callback(err);\r\n        });\r\n    }\r\n};\r\n\r\ncc.textureUtil = module.exports = textureUtil;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar ValueType = require('./value-type');\r\nvar js = require('../platform/js');\r\n\r\nvar Color = (function () {\r\n\r\n    /**\r\n     * !#en\r\n     * Representation of RGBA colors.\r\n     *\r\n     * Each color component is a floating point value with a range from 0 to 255.\r\n     *\r\n     * You can also use the convenience method {{#crossLink \"cc/color:method\"}}cc.color{{/crossLink}} to create a new Color.\r\n     *\r\n     * !#zh\r\n     * cc.Color \r\n     *\r\n     *  RGBA  0  255 \r\n     *\r\n     *  {{#crossLink \"cc/color:method\"}}cc.color{{/crossLink}}  Color\r\n     *\r\n     * @class Color\r\n     * @extends ValueType\r\n     */\r\n    /**\r\n     * @method constructor\r\n     * @param {Number} [r=0] - red component of the color, default value is 0.\r\n     * @param {Number} [g=0] - green component of the color, defualt value is 0.\r\n     * @param {Number} [b=0] - blue component of the color, default value is 0.\r\n     * @param {Number} [a=255] - alpha component of the color, default value is 255.\r\n     */\r\n    function Color( r, g, b, a ) {\r\n        if (typeof r === 'object') {\r\n            g = r.g;\r\n            b = r.b;\r\n            a = r.a;\r\n            r = r.r;\r\n        }\r\n        r = r || 0;\r\n        g = g || 0;\r\n        b = b || 0;\r\n        a = typeof a === 'number' ? a : 255;\r\n        this._val = ((a<<24) >>> 0) + (b<<16) + (g<<8) + r;\r\n    }\r\n    js.extend(Color, ValueType);\r\n    require('../platform/CCClass').fastDefine('cc.Color', Color, {r: 0, g: 0, b: 0, a: 255});\r\n\r\n    var DefaultColors = {\r\n        // color: [r, g, b, a]\r\n        /**\r\n         * !#en Solid white, RGBA is [255, 255, 255, 255].\r\n         * !#zh RGBA  [255, 255, 255, 255]\r\n         * @property WHITE\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        WHITE:      [255, 255, 255, 255],\r\n        /**\r\n         * !#en Solid black, RGBA is [0, 0, 0, 255].\r\n         * !#zh RGBA  [0, 0, 0, 255]\r\n         * @property BLACK\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        BLACK:      [0, 0, 0, 255],\r\n        /**\r\n         * !#en Transparent, RGBA is [0, 0, 0, 0].\r\n         * !#zh RGBA  [0, 0, 0, 0]\r\n         * @property TRANSPARENT\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        TRANSPARENT:[0, 0, 0, 0],\r\n        /**\r\n         * !#en Grey, RGBA is [127.5, 127.5, 127.5].\r\n         * !#zh RGBA  [127.5, 127.5, 127.5]\r\n         * @property GRAY\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        GRAY:       [127.5, 127.5, 127.5],\r\n        /**\r\n         * !#en Solid red, RGBA is [255, 0, 0].\r\n         * !#zh RGBA  [255, 0, 0]\r\n         * @property RED\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        RED:        [255, 0, 0],\r\n        /**\r\n         * !#en Solid green, RGBA is [0, 255, 0].\r\n         * !#zh RGBA  [0, 255, 0]\r\n         * @property GREEN\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        GREEN:      [0, 255, 0],\r\n        /**\r\n         * !#en Solid blue, RGBA is [0, 0, 255].\r\n         * !#zh RGBA  [0, 0, 255]\r\n         * @property BLUE\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        BLUE:       [0, 0, 255],\r\n        /**\r\n         * !#en Yellow, RGBA is [255, 235, 4].\r\n         * !#zh RGBA  [255, 235, 4]\r\n         * @property YELLOW\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        YELLOW:     [255, 235, 4],\r\n        /**\r\n         * !#en Orange, RGBA is [255, 127, 0].\r\n         * !#zh RGBA  [255, 127, 0]\r\n         * @property ORANGE\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        ORANGE:     [255, 127, 0],\r\n        /**\r\n         * !#en Cyan, RGBA is [0, 255, 255].\r\n         * !#zh RGBA  [0, 255, 255]\r\n         * @property CYAN\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        CYAN:       [0, 255, 255],\r\n        /**\r\n         * !#en Magenta, RGBA is [255, 0, 255].\r\n         * !#zh RGBA  [255, 0, 255]\r\n         * @property MAGENTA\r\n         * @type {Color}\r\n         * @static\r\n         */\r\n        MAGENTA:    [255, 0, 255]\r\n    };\r\n    for (var colorName in DefaultColors) {\r\n        js.get(Color, colorName, (function (rgba) {\r\n            return function () {\r\n                return new Color(rgba[0], rgba[1], rgba[2], rgba[3]);\r\n            };\r\n        })(DefaultColors[colorName]));\r\n    }\r\n\r\n    var proto = Color.prototype;\r\n\r\n    /**\r\n     * !#en Clone a new color from the current color.\r\n     * !#zh \r\n     * @method clone\r\n     * @return {Color} Newly created color.\r\n     * @example\r\n     * var color = new cc.Color();\r\n     * var newColor = color.clone();// Color {r: 0, g: 0, b: 0, a: 255}\r\n     */\r\n    proto.clone = function () {\r\n        var ret = new Color();\r\n        ret._val = this._val;\r\n        return ret;\r\n    };\r\n\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @method equals\r\n     * @param {Color} other\r\n     * @return {Boolean}\r\n     * @example\r\n     * var color1 = cc.Color.WHITE;\r\n     * var color2 = new cc.Color(255, 255, 255);\r\n     * cc.log(color1.equals(color2)); // true;\r\n     * color2 = cc.Color.RED;\r\n     * cc.log(color2.equals(color1)); // false;\r\n     */\r\n    proto.equals = function (other) {\r\n        return other && this._val === other._val;\r\n    };\r\n\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @method lerp\r\n     * @param {Color} to\r\n     * @param {number} ratio - the interpolation coefficient.\r\n     * @param {Color} [out] - optional, the receiving vector.\r\n     * @return {Color}\r\n     * @example {@link utils/api/engine/docs/cocos2d/core/value-types/CCColor/lerp.js}\r\n     */\r\n    proto.lerp = function (to, ratio, out) {\r\n        out = out || new Color();\r\n        var r = this.r;\r\n        var g = this.g;\r\n        var b = this.b;\r\n        var a = this.a;\r\n        out.r = r + (to.r - r) * ratio;\r\n        out.g = g + (to.g - g) * ratio;\r\n        out.b = b + (to.b - b) * ratio;\r\n        out.a = a + (to.a - a) * ratio;\r\n        return out;\r\n    };\r\n\r\n    /**\r\n     * !#en TODO\r\n     * !#zh \r\n     * @method toString\r\n     * @return {String}\r\n     * @example\r\n     * var color = cc.Color.WHITE;\r\n     * color.toString(); // \"rgba(255, 255, 255, 255)\"\r\n     */\r\n    proto.toString = function () {\r\n        return \"rgba(\" +\r\n            this.r.toFixed() + \", \" +\r\n            this.g.toFixed() + \", \" +\r\n            this.b.toFixed() + \", \" +\r\n            this.a.toFixed() + \")\";\r\n    };\r\n\r\n    /**\r\n     * !#en Gets red channel value\r\n     * !#zh \r\n     * @method getR\r\n     * @return {Number} red value.\r\n     */\r\n    proto.getR = function () {\r\n        return this._val & 0x000000ff;\r\n    };\r\n    /**\r\n     * !#en Sets red value and return the current color object\r\n     * !#zh \r\n     * @method setR\r\n     * @param {Number} red - the new Red component.\r\n     * @return {Color} this color.\r\n     * @example\r\n     * var color = new cc.Color();\r\n     * color.setR(255); // Color {r: 255, g: 0, b: 0, a: 255}\r\n     */\r\n    proto.setR = function (red) {\r\n        red = ~~cc.misc.clampf(red, 0, 255);\r\n        this._val = ((this._val & 0xffffff00) | red) >>> 0;\r\n        return this;\r\n    };\r\n    /**\r\n     * !#en Gets green channel value\r\n     * !#zh \r\n     * @method getG\r\n     * @return {Number} green value.\r\n     */\r\n    proto.getG = function () {\r\n        return (this._val & 0x0000ff00) >> 8;\r\n    };\r\n    /**\r\n     * !#en Sets green value and return the current color object\r\n     * !#zh \r\n     * @method setG\r\n     * @param {Number} green - the new Green component.\r\n     * @return {Color} this color.\r\n     * @example\r\n     * var color = new cc.Color();\r\n     * color.setG(255); // Color {r: 0, g: 255, b: 0, a: 255}\r\n     */\r\n    proto.setG = function (green) {\r\n        green = ~~cc.misc.clampf(green, 0, 255);\r\n        this._val = ((this._val & 0xffff00ff) | (green << 8)) >>> 0;\r\n        return this;\r\n    };\r\n    /**\r\n     * !#en Gets blue channel value\r\n     * !#zh \r\n     * @method getB\r\n     * @return {Number} blue value.\r\n     */\r\n    proto.getB = function () {\r\n        return (this._val & 0x00ff0000) >> 16;\r\n    };\r\n    /**\r\n     * !#en Sets blue value and return the current color object\r\n     * !#zh \r\n     * @method setB\r\n     * @param {Number} blue - the new Blue component.\r\n     * @return {Color} this color.\r\n     * @example\r\n     * var color = new cc.Color();\r\n     * color.setB(255); // Color {r: 0, g: 0, b: 255, a: 255}\r\n     */\r\n    proto.setB = function (blue) {\r\n        blue = ~~cc.misc.clampf(blue, 0, 255);\r\n        this._val = ((this._val & 0xff00ffff) | (blue << 16)) >>> 0;\r\n        return this;\r\n    };\r\n    /**\r\n     * !#en Gets alpha channel value\r\n     * !#zh \r\n     * @method getA\r\n     * @return {Number} alpha value.\r\n     */\r\n    proto.getA = function () {\r\n        return (this._val & 0xff000000) >>> 24;\r\n    };\r\n    /**\r\n     * !#en Sets alpha value and return the current color object\r\n     * !#zh \r\n     * @method setA\r\n     * @param {Number} alpha - the new Alpha component.\r\n     * @return {Color} this color.\r\n     * @example\r\n     * var color = new cc.Color();\r\n     * color.setA(0); // Color {r: 0, g: 0, b: 0, a: 0}\r\n     */\r\n    proto.setA = function (alpha) {\r\n        alpha = ~~cc.misc.clampf(alpha, 0, 255);\r\n        this._val = ((this._val & 0x00ffffff) | ((alpha << 24) >>> 0)) >>> 0;\r\n        return this;\r\n    };\r\n\r\n    js.getset(proto, 'r', proto.getR, proto.setR, true);\r\n    js.getset(proto, 'g', proto.getG, proto.setG, true);\r\n    js.getset(proto, 'b', proto.getB, proto.setB, true);\r\n    js.getset(proto, 'a', proto.getA, proto.setA, true);\r\n\r\n    /**\r\n     * !#en Convert color to css format.\r\n     * !#zh  CSS \r\n     * @method toCSS\r\n     * @param {String} opt - \"rgba\", \"rgb\", \"#rgb\" or \"#rrggbb\".\r\n     * @return {String}\r\n     * @example {@link utils/api/engine/docs/cocos2d/core/value-types/CCColor/toCSS.js}\r\n     */\r\n    proto.toCSS = function ( opt ) {\r\n        if ( opt === 'rgba' ) {\r\n            return \"rgba(\" +\r\n                (this.r | 0 ) + \",\" +\r\n                (this.g | 0 ) + \",\" +\r\n                (this.b | 0 ) + \",\" +\r\n                (this.a / 255).toFixed(2) + \")\"\r\n            ;\r\n        }\r\n        else if ( opt === 'rgb' ) {\r\n            return \"rgb(\" +\r\n                (this.r | 0 ) + \",\" +\r\n                (this.g | 0 ) + \",\" +\r\n                (this.b | 0 ) + \")\"\r\n            ;\r\n        }\r\n        else {\r\n            return '#' + this.toHEX(opt);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * !#en Read hex string and store color data into the current color object, the hex string must be formated as rgba or rgb.\r\n     * !#zh  16 \r\n     * @method fromHEX\r\n     * @param {String} hexString\r\n     * @return {Color}\r\n     * @chainable\r\n     * @example\r\n     * var color = cc.Color.BLACK;\r\n     * color.fromHEX(\"#FFFF33\"); // Color {r: 255, g: 255, b: 51, a: 255};\r\n     */\r\n    proto.fromHEX = function (hexString) {\r\n        hexString = (hexString.indexOf('#') === 0) ? hexString.substring(1) : hexString;\r\n        let r = parseInt(hexString.substr(0, 2), 16) || 0;\r\n        let g = parseInt(hexString.substr(2, 2), 16) || 0;\r\n        let b = parseInt(hexString.substr(4, 2), 16) || 0;\r\n        let a = parseInt(hexString.substr(6, 2), 16) || 255;\r\n        this._val = ((a<<24) >>> 0) + (b<<16) + (g<<8) + r;\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * !#en convert Color to HEX color string.\r\n     * e.g.  cc.color(255,6,255)  to : \"#ff06ff\"\r\n     * !#zh  16 \r\n     * @method toHEX\r\n     * @param {String} fmt - \"#rgb\", \"#rrggbb\" or \"#rrggbbaa\".\r\n     * @return {String}\r\n     * @example\r\n     * var color = cc.Color.BLACK;\r\n     * color.toHEX(\"#rgb\");     // \"000\";\r\n     * color.toHEX(\"#rrggbb\");  // \"000000\";\r\n     */\r\n    proto.toHEX = function ( fmt ) {\r\n        var hex = [\r\n            (this.r | 0 ).toString(16),\r\n            (this.g | 0 ).toString(16),\r\n            (this.b | 0 ).toString(16)\r\n        ];\r\n        var i = -1;\r\n        if ( fmt === '#rgb' ) {\r\n            for ( i = 0; i < hex.length; ++i ) {\r\n                if ( hex[i].length > 1 ) {\r\n                    hex[i] = hex[i][0];\r\n                }\r\n            }\r\n        }\r\n        else if ( fmt === '#rrggbb' ) {\r\n            for ( i = 0; i < hex.length; ++i ) {\r\n                if ( hex[i].length === 1 ) {\r\n                    hex[i] = '0' + hex[i];\r\n                }\r\n            }\r\n        }\r\n        else if ( fmt === '#rrggbbaa' ) {\r\n            hex.push((this.a | 0 ).toString(16));\r\n            for ( i = 0; i < hex.length; ++i ) {\r\n                if ( hex[i].length === 1 ) {\r\n                    hex[i] = '0' + hex[i];\r\n                }\r\n            }\r\n        }\r\n        return hex.join('');\r\n    };\r\n\r\n    /**\r\n     * !#en Convert to 24bit rgb value.\r\n     * !#zh  24bit  RGB \r\n     * @method toRGBValue\r\n     * @return {Number}\r\n     * @example\r\n     * var color = cc.Color.YELLOW;\r\n     * color.toRGBValue(); // 16771844;\r\n     */\r\n    proto.toRGBValue = function () {\r\n        return this._val & 0x00ffffff;\r\n    };\r\n\r\n    /**\r\n     * !#en Read HSV model color and convert to RGB color\r\n     * !#zh  HSV\r\n     * @method fromHSV\r\n     * @param {Number} h\r\n     * @param {Number} s\r\n     * @param {Number} v\r\n     * @return {Color}\r\n     * @chainable\r\n     * @example\r\n     * var color = cc.Color.YELLOW;\r\n     * color.fromHSV(0, 0, 1); // Color {r: 255, g: 255, b: 255, a: 255};\r\n     */\r\n    proto.fromHSV = function ( h, s, v ) {\r\n        var r, g, b;\r\n        if (s === 0) {\r\n            r = g = b = v;\r\n        }\r\n        else {\r\n            if (v === 0) {\r\n                r = g = b = 0;\r\n            }\r\n            else {\r\n                if (h === 1) h = 0;\r\n                h *= 6;\r\n                s = s;\r\n                v = v;\r\n                var i = Math.floor(h);\r\n                var f = h - i;\r\n                var p = v * (1 - s);\r\n                var q = v * (1 - (s * f));\r\n                var t = v * (1 - (s * (1 - f)));\r\n                switch (i) {\r\n                    case 0:\r\n                        r = v;\r\n                        g = t;\r\n                        b = p;\r\n                        break;\r\n\r\n                    case 1:\r\n                        r = q;\r\n                        g = v;\r\n                        b = p;\r\n                        break;\r\n\r\n                    case 2:\r\n                        r = p;\r\n                        g = v;\r\n                        b = t;\r\n                        break;\r\n\r\n                    case 3:\r\n                        r = p;\r\n                        g = q;\r\n                        b = v;\r\n                        break;\r\n\r\n                    case 4:\r\n                        r = t;\r\n                        g = p;\r\n                        b = v;\r\n                        break;\r\n\r\n                    case 5:\r\n                        r = v;\r\n                        g = p;\r\n                        b = q;\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        r *= 255;\r\n        g *= 255;\r\n        b *= 255;\r\n        this._val = ((this.a<<24) >>> 0) + (b<<16) + (g<<8) + r;\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * !#en Transform to HSV model color\r\n     * !#zh  HSV\r\n     * @method toHSV\r\n     * @return {Object} - {h: number, s: number, v: number}.\r\n     * @example\r\n     * var color = cc.Color.YELLOW;\r\n     * color.toHSV(); // Object {h: 0.1533864541832669, s: 0.9843137254901961, v: 1};\r\n     */\r\n    proto.toHSV = function () {\r\n        var r = this.r / 255;\r\n        var g = this.g / 255;\r\n        var b = this.b / 255;\r\n        var hsv = { h: 0, s: 0, v: 0 };\r\n        var max = Math.max(r,g,b);\r\n        var min = Math.min(r,g,b);\r\n        var delta = 0;\r\n        hsv.v = max;\r\n        hsv.s = max ? (max - min) / max : 0;\r\n        if (!hsv.s) hsv.h = 0;\r\n        else {\r\n            delta = max - min;\r\n            if (r === max) hsv.h = (g - b) / delta;\r\n            else if (g === max) hsv.h = 2 + (b - r) / delta;\r\n            else hsv.h = 4 + (r - g) / delta;\r\n            hsv.h /= 6;\r\n            if (hsv.h < 0) hsv.h += 1.0;\r\n        }\r\n        return hsv;\r\n    };\r\n\r\n    proto.set = function (color) {\r\n        if (color._val) {\r\n            this._val = color._val;\r\n        }\r\n        else {\r\n            this.r = color.r;\r\n            this.g = color.g;\r\n            this.b = color.b;\r\n            this.a = color.a;\r\n        }\r\n    };\r\n\r\n    return Color;\r\n})();\r\n\r\ncc.Color = Color;\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en\r\n * The convenience method to create a new {{#crossLink \"Color/Color:method\"}}cc.Color{{/crossLink}}\r\n * Alpha channel is optional. Default value is 255.\r\n *\r\n * !#zh\r\n *  {{#crossLink \"Color/Color:method\"}}cc.Color{{/crossLink}} \r\n * Alpha  255\r\n *\r\n * @method color\r\n * @param {Number} [r=0]\r\n * @param {Number} [g=0]\r\n * @param {Number} [b=0]\r\n * @param {Number} [a=255]\r\n * @return {Color}\r\n * @example {@link utils/api/engine/docs/cocos2d/core/value-types/CCColor/color.js}\r\n */\r\ncc.color = function color (r, g, b, a) {\r\n    if (typeof r === 'string') {\r\n        var result = new cc.Color();\r\n        return result.fromHEX(r);\r\n    }\r\n    if (typeof r === 'object') {\r\n        return new cc.Color(r.r, r.g, r.b, r.a);\r\n    }\r\n    return  new cc.Color(r, g, b, a);\r\n};\r\n\r\nmodule.exports = cc.Color;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./value-type');\r\nrequire('./vec2');\r\nrequire('./vec3');\r\nrequire('./quat');\r\nrequire('./mat4');\r\nrequire('./size');\r\nrequire('./rect');\r\nrequire('./color');\r\n\r\ncc.vmath = require('../renderer/render-engine').math;\r\n","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst ValueType = require('./value-type');\r\nconst js = require('../platform/js');\r\nconst CCClass = require('../platform/CCClass');\r\nconst math = require('../renderer/render-engine').math;\r\nconst mat4 = math.mat4;\r\n\r\n/**\r\n * !#en Representation of 4*4 matrix.\r\n * !#zh  4*4 \r\n *\r\n * @class Mat4\r\n * @extends ValueType\r\n */\r\n\r\n/**\r\n * !#en\r\n * Constructor\r\n * see {{#crossLink \"cc/mat4:method\"}}cc.mat4{{/crossLink}}\r\n * !#zh\r\n *  {{#crossLink \"cc/mat4:method\"}}cc.mat4{{/crossLink}}\r\n * @method constructor\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n */\r\nfunction Mat4 (m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\r\n    let t = this;\r\n    t.m00 = m00;\r\n    t.m01 = m01;\r\n    t.m02 = m02;\r\n    t.m03 = m03;\r\n    t.m04 = m10;\r\n    t.m05 = m11;\r\n    t.m06 = m12;\r\n    t.m07 = m13;\r\n    t.m08 = m20;\r\n    t.m09 = m21;\r\n    t.m10 = m22;\r\n    t.m11 = m23;\r\n    t.m12 = m30;\r\n    t.m13 = m31;\r\n    t.m14 = m32;\r\n    t.m15 = m33;\r\n}\r\njs.extend(Mat4, ValueType);\r\nCCClass.fastDefine('cc.Mat4', Mat4, { \r\n    m00: 1, m01: 0, m02: 0, m03: 0,\r\n    m04: 0, m05: 1, m06: 0, m07: 0,\r\n    m08: 0, m09: 0, m10: 1, m11: 0,\r\n    m12: 0, m13: 0, m14: 0, m15: 1 });\r\n\r\njs.mixin(Mat4.prototype, {\r\n\r\n    /**\r\n     * !#en clone a Mat4 object\r\n     * !#zh  Mat4 \r\n     * @method clone\r\n     * @return {Mat4}\r\n     */\r\n    clone () {\r\n        let t = this;\r\n        return new Mat4(\r\n            t.m00, t.m01, t.m02, t.m03,\r\n            t.m04, t.m05, t.m06, t.m07,\r\n            t.m08, t.m09, t.m10, t.m11,\r\n            t.m12, t.m13, t.m14, t.m15);\r\n    },\r\n\r\n    /**\r\n     * !#en Sets the matrix with another one's value\r\n     * !#zh \r\n     * @method set\r\n     * @param {Mat4} srcObj\r\n     * @return {Mat4} returns this\r\n     * @chainable\r\n     */\r\n    set (s) {\r\n        let t = this;\r\n        t.m00 = s.m00;\r\n        t.m01 = s.m01;\r\n        t.m02 = s.m02;\r\n        t.m03 = s.m03;\r\n        t.m04 = s.m04;\r\n        t.m05 = s.m05;\r\n        t.m06 = s.m06;\r\n        t.m07 = s.m07;\r\n        t.m08 = s.m08;\r\n        t.m09 = s.m09;\r\n        t.m10 = s.m10;\r\n        t.m11 = s.m11;\r\n        t.m12 = s.m12;\r\n        t.m13 = s.m13;\r\n        t.m14 = s.m14;\r\n        t.m15 = s.m15;\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * !#en Check whether two matrix equal\r\n     * !#zh \r\n     * @method equals\r\n     * @param {Mat4} other\r\n     * @return {Boolean}\r\n     */\r\n    equals (other) {\r\n        return mat4.exactEquals(this, other);\r\n    },\r\n\r\n    /**\r\n     * !#en Check whether two matrix equal with default degree of variance.\r\n     * !#zh\r\n     * <br/>\r\n     *  2  true false\r\n     * @method fuzzyEquals\r\n     * @param {Mat4} other\r\n     * @return {Boolean}\r\n     */\r\n    fuzzyEquals (other) {\r\n        return mat4.equals(this, other);\r\n    },\r\n\r\n    /**\r\n     * !#en Transform to string with matrix informations\r\n     * !#zh \r\n     * @method toString\r\n     * @return {string}\r\n     */\r\n    toString () {\r\n        let t = this;\r\n        return \"[\\n\" +\r\n            t.m00 + \", \" + t.m01 + \", \" + t.m02 + \", \" + t.m03 + \",\\n\" +\r\n            t.m04 + \", \" + t.m05 + \", \" + t.m06 + \", \" + t.m07 + \",\\n\" +\r\n            t.m08 + \", \" + t.m09 + \", \" + t.m10 + \", \" + t.m11 + \",\\n\" +\r\n            t.m12 + \", \" + t.m13 + \", \" + t.m14 + \", \" + t.m15 + \"\\n\" +\r\n            \"]\"\r\n            ;\r\n    },\r\n\r\n    /**\r\n     * Set the matrix to the identity matrix\r\n     * @method identity\r\n     * @returns {Mat4} self\r\n     * @chainable\r\n     */\r\n    identity () {\r\n        return mat4.identity(this);\r\n    },\r\n\r\n    /**\r\n     * Transpose the values of a mat4\r\n     * @method transpose\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created.\r\n     * @returns {Mat4} out\r\n     */\r\n    transpose (out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.transpose(out, this);\r\n    },\r\n\r\n    /**\r\n     * Inverts a mat4\r\n     * @method invert\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created.\r\n     * @returns {Mat4} out\r\n     */\r\n    invert (out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.invert(out, this);\r\n    },\r\n\r\n    /**\r\n     * Calculates the adjugate of a mat4\r\n     * @method adjoint\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created.\r\n     * @returns {Mat4} out\r\n     */\r\n    adjoint (out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.adjoint(out, this);\r\n    },\r\n\r\n    /**\r\n     * Calculates the determinant of a mat4\r\n     * @method determinant\r\n     * @returns {Number} determinant of a\r\n     */\r\n    determinant () {\r\n        return mat4.determinant(this);\r\n    },\r\n\r\n    /**\r\n     * Adds two Mat4\r\n     * @method add\r\n     * @param {Mat4} other the second operand\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created.\r\n     * @returns {Mat4} out\r\n     */\r\n    add (other, out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.add(out, this, other);\r\n    },\r\n\r\n    /**\r\n     * Subtracts the current matrix with another one\r\n     * @method sub\r\n     * @param {Mat4} other the second operand\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created\r\n     * @returns {Mat4} out\r\n     */\r\n    sub (other, out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.subtract(out, this, other);\r\n    },\r\n\r\n    /**\r\n     * Subtracts the current matrix with another one\r\n     * @method mul\r\n     * @param {Mat4} other the second operand\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created\r\n     * @returns {Mat4} out\r\n     */\r\n    mul (other, out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.multiply(out, this, other)\r\n    },\r\n\r\n    /**\r\n     * Multiply each element of the matrix by a scalar.\r\n     * @method mulScalar\r\n     * @param {Number} number amount to scale the matrix's elements by\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created\r\n     * @returns {Mat4} out\r\n     */\r\n    mulScalar (number, out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.mulScalar(out, this, number);\r\n    },\r\n\r\n    /**\r\n     * Translate a mat4 by the given vector\r\n     * @method translate\r\n     * @param {Vec3} v vector to translate by\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created\r\n     * @returns {Mat4} out\r\n     */\r\n    translate (v, out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.translate(out, this, v);\r\n    },\r\n\r\n    /**\r\n     * Scales the mat4 by the dimensions in the given vec3\r\n     * @method scale\r\n     * @param {Vec3} v vector to scale by\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created\r\n     * @returns {Mat4} out\r\n     */\r\n    scale (v, out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.scale(out, this, v);\r\n    },\r\n\r\n    /**\r\n     * Rotates a mat4 by the given angle around the given axis\r\n     * @method rotate\r\n     * @param {Number} rad the angle to rotate the matrix by\r\n     * @param {Vec3} axis the axis to rotate around\r\n     * @param {Mat4} [out] the receiving matrix, you can pass the same matrix to save result to itself, if not provided, a new matrix will be created\r\n     * @returns {Mat4} out\r\n     */\r\n    rotate (rad, axis, out) {\r\n        out = out || new cc.Mat4();\r\n        return mat4.rotate(out, this, rad, axis);\r\n    },\r\n\r\n    /**\r\n     * Returns the translation vector component of a transformation matrix.\r\n     * @method getTranslation\r\n     * @param  {Vec3} out Vector to receive translation component, if not provided, a new vec3 will be created\r\n     * @return {Vec3} out\r\n     */\r\n    getTranslation (out) {\r\n        out = out || new cc.Vec3();\r\n        return mat4.getTranslation(out, this);\r\n    },\r\n\r\n    /**\r\n     * Returns the scale factor component of a transformation matrix\r\n     * @method getScale\r\n     * @param  {Vec3} out Vector to receive scale component, if not provided, a new vec3 will be created\r\n     * @return {Vec3} out\r\n     */\r\n    getScale (out) {\r\n        out = out || new cc.Vec3();\r\n        return mat4.getScaling(out, this);\r\n    },\r\n\r\n    /**\r\n     * Returns the rotation factor component of a transformation matrix\r\n     * @method getRotation\r\n     * @param  {Quat} out Vector to receive rotation component, if not provided, a new quaternion object will be created\r\n     * @return {Quat} out\r\n     */\r\n    getRotation (out) {\r\n        out = out || new cc.Quat();\r\n        return mat4.getRotation(out, this);\r\n    },\r\n\r\n    /**\r\n     * Restore the matrix values from a quaternion rotation, vector translation and vector scale\r\n     * @method fromRTS\r\n     * @param {Quat} q Rotation quaternion\r\n     * @param {Vec3} v Translation vector\r\n     * @param {Vec3} s Scaling vector\r\n     * @returns {Mat4} the current mat4 object\r\n     * @chainable\r\n     */\r\n    fromRTS (q, v, s) {\r\n        return mat4.fromRTS(this, q, v, s);\r\n    },\r\n\r\n    /**\r\n     * Restore the matrix values from a quaternion rotation\r\n     * @method fromQuat\r\n     * @param {Quat} q Rotation quaternion\r\n     * @returns {Mat4} the current mat4 object\r\n     * @chainable\r\n     */\r\n    fromQuat (quat) {\r\n        return mat4.fromQuat(this, quat);\r\n    }\r\n});\r\n\r\n/**\r\n * !#en The convenience method to create a new {{#crossLink \"Mat4\"}}cc.Mat4{{/crossLink}}.\r\n * !#zh  {{#crossLink \"Mat4\"}}cc.Mat4{{/crossLink}} \r\n * @method mat4\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @return {Mat4}\r\n */\r\ncc.mat4 = function mat4 (m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\r\n    return new Mat4(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33);\r\n};\r\n\r\nmodule.exports = cc.Mat4 = Mat4;\r\n","/****************************************************************************\r\n Copyright (c) 2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst ValueType = require('./value-type');\r\nconst js = require('../platform/js');\r\nconst CCClass = require('../platform/CCClass');\r\n\r\n/**\r\n * !#en Representation of 2D vectors and points.\r\n * !#zh  2D \r\n *\r\n * @class Quat\r\n * @extends ValueType\r\n */\r\n\r\n/**\r\n * !#en\r\n * Constructor\r\n * see {{#crossLink \"cc/quat:method\"}}cc.quat{{/crossLink}}\r\n * !#zh\r\n *  {{#crossLink \"cc/quat:method\"}}cc.quat{{/crossLink}}\r\n * @method constructor\r\n * @param {number} [x=0]\r\n * @param {number} [y=0]\r\n * @param {number} [z=0]\r\n * @param {number} [w=1]\r\n */\r\nfunction Quat (x, y, z, w) {\r\n    if (x && typeof x === 'object') {\r\n        z = x.z;\r\n        y = x.y;\r\n        x = x.x;\r\n        w = x.w;\r\n    }\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n    this.z = z || 0;\r\n    this.w = w || 1;\r\n}\r\njs.extend(Quat, ValueType);\r\nCCClass.fastDefine('cc.Quat', Quat, { x: 0, y: 0, z: 0, w: 1 });\r\n\r\n/**\r\n * @property {Number} x\r\n */\r\n/**\r\n * @property {Number} y\r\n */\r\n/**\r\n * @property {Number} z\r\n */\r\n/**\r\n * @property {Number} w\r\n */\r\n\r\nvar proto = Quat.prototype;\r\n\r\n\r\n/**\r\n * !#en clone a Quat object and return the new object\r\n * !#zh \r\n * @method clone\r\n * @return {Quat}\r\n */\r\nproto.clone = function () {\r\n    return new Quat(this.x, this.y, this.z, this.w);\r\n};\r\n\r\n/**\r\n * !#en Set values with another quaternion\r\n * !#zh \r\n * @method set\r\n * @param {Quat} newValue - !#en new value to set. !#zh \r\n * @return {Quat} returns this\r\n * @chainable\r\n */\r\nproto.set = function (newValue) {\r\n    this.x = newValue.x;\r\n    this.y = newValue.y;\r\n    this.z = newValue.z;\r\n    this.w = newValue.w;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Check whether current quaternion equals another\r\n * !#zh \r\n * @method equals\r\n * @param {Quat} other\r\n * @return {Boolean}\r\n */\r\nproto.equals = function (other) {\r\n    return other && this.x === other.x && this.y === other.y && this.z === other.z && this.w === other.w;\r\n};\r\n\r\n/**\r\n * !#en Convert quaternion to euler\r\n * !#zh \r\n * @method toEuler\r\n * @param {Vec3} out\r\n * @return {Vec3}\r\n */\r\nproto.toEuler = function (out) {\r\n    cc.vmath.quat.toEuler(out, this);\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Convert euler to quaternion\r\n * !#zh \r\n * @method fromEuler\r\n * @param {Vec3} euler\r\n * @return {Quat}\r\n */\r\nproto.fromEuler = function (euler) {\r\n    cc.vmath.quat.fromEuler(this, euler.x, euler.y, euler.z);\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Calculate the interpolation result between this quaternion and another one with given ratio\r\n * !#zh \r\n * @member lerp\r\n * @param {Quat} to\r\n * @param {Number} ratio\r\n * @param {Quat} out\r\n */\r\nproto.lerp = function (to, ratio, out) {\r\n    out = out || new cc.Quat();\r\n    cc.vmath.quat.slerp(out, this, to, ratio);\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en The convenience method to create a new {{#crossLink \"Quat\"}}cc.Quat{{/crossLink}}.\r\n * !#zh  {{#crossLink \"Quat\"}}cc.Quat{{/crossLink}} \r\n * @method quat\r\n * @param {Number|Object} [x=0]\r\n * @param {Number} [y=0]\r\n * @param {Number} [z=0]\r\n * @param {Number} [w=1]\r\n * @return {Quat}\r\n */\r\ncc.quat = function quat (x, y, z, w) {\r\n    return new Quat(x, y, z, w);\r\n};\r\n\r\nmodule.exports = cc.Quat = Quat;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar ValueType = require('./value-type');\r\nvar js = require('../platform/js');\r\n\r\n/**\r\n * !#en A 2D rectangle defined by x, y position and width, height.\r\n * !#zh  2D \r\n * @class Rect\r\n * @extends ValueType\r\n */\r\n/**\r\n * !#en\r\n * Constructor of Rect class.\r\n * see {{#crossLink \"cc/rect:method\"}} cc.rect {{/crossLink}} for convenience method.\r\n * !#zh\r\n * Rect {{#crossLink \"cc/rect:method\"}} cc.rect {{/crossLink}} \r\n *\r\n * @method constructor\r\n * @param {Number} [x=0]\r\n * @param {Number} [y=0]\r\n * @param {Number} [w=0]\r\n * @param {Number} [h=0]\r\n */\r\nfunction Rect (x, y, w, h) {\r\n    if (x && typeof x === 'object') {\r\n        y = x.y;\r\n        w = x.width;\r\n        h = x.height;\r\n        x = x.x;\r\n    }\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n    this.width = w || 0;\r\n    this.height = h || 0;\r\n}\r\njs.extend(Rect, ValueType);\r\nrequire('../platform/CCClass').fastDefine('cc.Rect', Rect, { x: 0, y: 0, width: 0, height: 0 });\r\n\r\n/**\r\n * @property {Number} x\r\n */\r\n/**\r\n * @property {Number} y\r\n */\r\n/**\r\n * @property {Number} width\r\n */\r\n/**\r\n * @property {Number} height\r\n */\r\n\r\n/**\r\n * !#en Creates a rectangle from two coordinate values.\r\n * !#zh  2 \r\n * @static\r\n * @method fromMinMax\r\n * @param {Vec2} v1\r\n * @param {Vec2} v2\r\n * @return {Rect}\r\n * @example\r\n * cc.Rect.fromMinMax(cc.v2(10, 10), cc.v2(20, 20)); // Rect {x: 10, y: 10, width: 10, height: 10};\r\n */\r\nRect.fromMinMax = function (v1, v2) {\r\n    var min_x = Math.min(v1.x, v2.x);\r\n    var min_y = Math.min(v1.y, v2.y);\r\n    var max_x = Math.max(v1.x, v2.x);\r\n    var max_y = Math.max(v1.y, v2.y);\r\n\r\n    return new Rect(min_x, min_y, max_x - min_x, max_y - min_y);\r\n};\r\n\r\nvar proto = Rect.prototype;\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh  Rect\r\n * @method clone\r\n * @return {Rect}\r\n * @example\r\n * var a = new cc.Rect(0, 0, 10, 10);\r\n * a.clone();// Rect {x: 0, y: 0, width: 10, height: 10}\r\n */\r\nproto.clone = function () {\r\n    return new Rect(this.x, this.y, this.width, this.height);\r\n};\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh \r\n * @method equals\r\n * @param {Rect} other\r\n * @return {Boolean}\r\n * @example\r\n * var a = new cc.Rect(0, 0, 10, 10);\r\n * var b = new cc.Rect(0, 0, 10, 10);\r\n * a.equals(b);// true;\r\n */\r\nproto.equals = function (other) {\r\n    return other &&\r\n           this.x === other.x &&\r\n           this.y === other.y &&\r\n           this.width === other.width &&\r\n           this.height === other.height;\r\n};\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh \r\n * @method lerp\r\n * @param {Rect} to\r\n * @param {Number} ratio - the interpolation coefficient.\r\n * @param {Rect} [out] - optional, the receiving vector.\r\n * @return {Rect}\r\n * @example\r\n * var a = new cc.Rect(0, 0, 10, 10);\r\n * var b = new cc.Rect(50, 50, 100, 100);\r\n * update (dt) {\r\n *    // method 1;\r\n *    var c = a.lerp(b, dt * 0.1);\r\n *    // method 2;\r\n *    a.lerp(b, dt * 0.1, c);\r\n * }\r\n */\r\nproto.lerp = function (to, ratio, out) {\r\n    out = out || new Rect();\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var width = this.width;\r\n    var height = this.height;\r\n    out.x = x + (to.x - x) * ratio;\r\n    out.y = y + (to.y - y) * ratio;\r\n    out.width = width + (to.width - width) * ratio;\r\n    out.height = height + (to.height - height) * ratio;\r\n    return out;\r\n};\r\n\r\nproto.set = function (source) {\r\n    this.x = source.x;\r\n    this.y = source.y;\r\n    this.width = source.width;\r\n    this.height = source.height;\r\n};\r\n\r\n/**\r\n * !#en Check whether the current rectangle intersects with the given one\r\n * !#zh \r\n * @method intersects\r\n * @param {Rect} rect\r\n * @return {Boolean}\r\n * @example\r\n * var a = new cc.Rect(0, 0, 10, 10);\r\n * var b = new cc.Rect(0, 0, 20, 20);\r\n * a.intersects(b);// true\r\n */\r\nproto.intersects = function (rect) {\r\n    var maxax = this.x + this.width,\r\n        maxay = this.y + this.height,\r\n        maxbx = rect.x + rect.width,\r\n        maxby = rect.y + rect.height;\r\n    return !(maxax < rect.x || maxbx < this.x || maxay < rect.y || maxby < this.y);\r\n};\r\n\r\n/**\r\n * !#en Returns the overlapping portion of 2 rectangles.\r\n * !#zh  2 \r\n * @method intersection\r\n * @param {Rect} out Stores the result\r\n * @param {Rect} rectB\r\n * @return {Rect} Returns the out parameter\r\n * @example\r\n * var a = new cc.Rect(0, 10, 20, 20);\r\n * var b = new cc.Rect(0, 10, 10, 10);\r\n * var intersection = new cc.Rect();\r\n * a.intersection(intersection, b); // intersection {x: 0, y: 10, width: 10, height: 10};\r\n */\r\nproto.intersection = function (out, rectB) {\r\n    var axMin = this.x, ayMin = this.y, axMax = this.x + this.width, ayMax = this.y + this.height;\r\n    var bxMin = rectB.x, byMin = rectB.y, bxMax = rectB.x + rectB.width, byMax = rectB.y + rectB.height;\r\n    out.x = Math.max(axMin, bxMin);\r\n    out.y = Math.max(ayMin, byMin);\r\n    out.width = Math.min(axMax, bxMax) - out.x;\r\n    out.height = Math.min(ayMax, byMax) - out.y;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Check whether the current rect contains the given point\r\n * !#zh \r\n * Returns true if the point inside this rectangle.\r\n * @method contains\r\n * @param {Vec2} point\r\n * @return {Boolean}\r\n * @example\r\n * var a = new cc.Rect(0, 0, 10, 10);\r\n * var b = new cc.Vec2(0, 5);\r\n * a.contains(b);// true\r\n */\r\nproto.contains = function (point) {\r\n    return (this.x <= point.x &&\r\n            this.x + this.width >= point.x &&\r\n            this.y <= point.y &&\r\n            this.y + this.height >= point.y);\r\n};\r\n\r\n/**\r\n * !#en Returns true if the other rect totally inside this rectangle.\r\n * !#zh \r\n * @method containsRect\r\n * @param {Rect} rect\r\n * @return {Boolean}\r\n * @example\r\n * var a = new cc.Rect(0, 0, 20, 20);\r\n * var b = new cc.Rect(0, 0, 10, 10);\r\n * a.containsRect(b);// true\r\n */\r\nproto.containsRect = function (rect) {\r\n    return (this.x <= rect.x &&\r\n            this.x + this.width >= rect.x + rect.width &&\r\n            this.y <= rect.y &&\r\n            this.y + this.height >= rect.y + rect.height);\r\n};\r\n\r\n/**\r\n * !#en Returns the smallest rectangle that contains the current rect and the given rect.\r\n * !#zh \r\n * @method union\r\n * @param {Rect} out Stores the result\r\n * @param {Rect} rectB\r\n * @return {Rect} Returns the out parameter\r\n * @example\r\n * var a = new cc.Rect(0, 10, 20, 20);\r\n * var b = new cc.Rect(0, 10, 10, 10);\r\n * var union = new cc.Rect();\r\n * a.union(union, b); // union {x: 0, y: 10, width: 20, height: 20};\r\n */\r\nproto.union = function (out, rectB) {\r\n    var ax = this.x, ay = this.y, aw = this.width, ah = this.height;\r\n    var bx = rectB.x, by = rectB.y, bw = rectB.width, bh = rectB.height;\r\n    out.x = Math.min(ax, bx);\r\n    out.y = Math.min(ay, by);\r\n    out.width = Math.max(ax + aw, bx + bw) - out.x;\r\n    out.height = Math.max(ay + ah, by + bh) - out.y;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Apply matrix4 to the rect.\r\n * !#zh  mat4 \r\n * @method transformMat4\r\n * @param out {Rect} The output rect\r\n * @param mat {Mat4} The matrix4\r\n */\r\nproto.transformMat4 = function (out, mat) {\r\n    let ol = this.x;\r\n    let ob = this.y;\r\n    let or = ol + this.width;\r\n    let ot = ob + this.height;\r\n    let lbx = mat.m00 * ol + mat.m04 * ob + mat.m12;\r\n    let lby = mat.m01 * ol + mat.m05 * ob + mat.m13;\r\n    let rbx = mat.m00 * or + mat.m04 * ob + mat.m12;\r\n    let rby = mat.m01 * or + mat.m05 * ob + mat.m13;\r\n    let ltx = mat.m00 * ol + mat.m04 * ot + mat.m12;\r\n    let lty = mat.m01 * ol + mat.m05 * ot + mat.m13;\r\n    let rtx = mat.m00 * or + mat.m04 * ot + mat.m12;\r\n    let rty = mat.m01 * or + mat.m05 * ot + mat.m13;\r\n\r\n    let minX = Math.min(lbx, rbx, ltx, rtx);\r\n    let maxX = Math.max(lbx, rbx, ltx, rtx);\r\n    let minY = Math.min(lby, rby, lty, rty);\r\n    let maxY = Math.max(lby, rby, lty, rty);\r\n\r\n    out.x = minX;\r\n    out.y = minY;\r\n    out.width = maxX - minX;\r\n    out.height = maxY - minY;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Output rect informations to string\r\n * !#zh \r\n * @method toString\r\n * @return {String}\r\n * @example\r\n * var a = new cc.Rect(0, 0, 10, 10);\r\n * a.toString();// \"(0.00, 0.00, 10.00, 10.00)\";\r\n */\r\nproto.toString = function () {\r\n    return '(' + this.x.toFixed(2) + ', ' + this.y.toFixed(2) + ', ' + this.width.toFixed(2) +\r\n           ', ' + this.height.toFixed(2) + ')';\r\n};\r\n\r\n/**\r\n * !#en The minimum x value, equals to rect.x\r\n * !#zh  x  rect.x\r\n * @property xMin\r\n * @type {Number}\r\n */\r\njs.getset(proto, 'xMin',\r\n    function () { return this.x; },\r\n    function (value) {\r\n        this.width += this.x - value;\r\n        this.x = value;\r\n    }\r\n);\r\n\r\n/**\r\n * !#en The minimum y value, equals to rect.y\r\n * !#zh  y \r\n * @property yMin\r\n * @type {Number}\r\n */\r\njs.getset(proto, 'yMin',\r\n    function () { return this.y; },\r\n    function (value) {\r\n        this.height += this.y - value;\r\n        this.y = value;\r\n    }\r\n);\r\n\r\n/**\r\n * !#en The maximum x value.\r\n * !#zh  x \r\n * @property xMax\r\n * @type {Number}\r\n */\r\njs.getset(proto, 'xMax',\r\n    function () { return this.x + this.width; },\r\n    function (value) { this.width = value - this.x; }\r\n);\r\n\r\n/**\r\n * !#en The maximum y value.\r\n * !#zh  y \r\n * @property yMax\r\n * @type {Number}\r\n */\r\njs.getset(proto, 'yMax',\r\n    function () { return this.y + this.height; },\r\n    function (value) { this.height = value - this.y; }\r\n);\r\n\r\n/**\r\n * !#en The position of the center of the rectangle.\r\n * !#zh \r\n * @property {Vec2} center\r\n */\r\njs.getset(proto, 'center',\r\n    function () {\r\n        return new cc.Vec2(this.x + this.width * 0.5,\r\n            this.y + this.height * 0.5);\r\n    },\r\n    function (value) {\r\n        this.x = value.x - this.width * 0.5;\r\n        this.y = value.y - this.height * 0.5;\r\n    }\r\n);\r\n\r\n/**\r\n * !#en The X and Y position of the rectangle.\r\n * !#zh  x  y \r\n * @property {Vec2} origin\r\n */\r\njs.getset(proto, 'origin',\r\n    function () {\r\n        return new cc.Vec2(this.x, this.y);\r\n    },\r\n    function (value) {\r\n        this.x = value.x;\r\n        this.y = value.y;\r\n    }\r\n);\r\n\r\n/**\r\n * !#en Width and height of the rectangle.\r\n * !#zh \r\n * @property {Size} size\r\n */\r\njs.getset(proto, 'size',\r\n    function () {\r\n        return new cc.Size(this.width, this.height);\r\n    },\r\n    function (value) {\r\n        this.width = value.width;\r\n        this.height = value.height;\r\n    }\r\n);\r\n\r\ncc.Rect = Rect;\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en\r\n * The convenience method to create a new Rect.\r\n * see {{#crossLink \"Rect/Rect:method\"}}cc.Rect{{/crossLink}}\r\n * !#zh\r\n * {{#crossLink \"Rect/Rect:method\"}}cc.Rect{{/crossLink}}\r\n * @method rect\r\n * @param {Number} [x=0]\r\n * @param {Number} [y=0]\r\n * @param {Number} [w=0]\r\n * @param {Number} [h=0]\r\n * @return {Rect}\r\n * @example\r\n * var a = new cc.Rect(0 , 0, 10, 0);\r\n */\r\ncc.rect = function rect (x, y, w, h) {\r\n    return new Rect(x, y, w, h);\r\n};\r\n\r\nmodule.exports = cc.Rect;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar ValueType = require('./value-type');\r\nvar js = require('../platform/js');\r\n\r\n/**\r\n * !#en\r\n * cc.Size is the class for size object,<br/>\r\n * please do not use its constructor to create sizes,<br/>\r\n * use {{#crossLink \"cc/size:method\"}}{{/crossLink}} alias function instead.<br/>\r\n * It will be deprecated soon, please use cc.Vec2 instead.\r\n *\r\n * !#zh\r\n * cc.Size  size <br/>\r\n *  size<br/>\r\n *  {{#crossLink \"cc/size:method\"}}{{/crossLink}} <br/>\r\n * cc.Vec2\r\n *\r\n * @class Size\r\n */\r\n/**\r\n * @method constructor\r\n * @param {Number|Size} width\r\n * @param {Number} [height]\r\n */\r\nfunction Size (width, height) {\r\n    if (width && typeof width === 'object') {\r\n        height = width.height;\r\n        width = width.width;\r\n    }\r\n    this.width = width || 0;\r\n    this.height = height || 0;\r\n}\r\njs.extend(Size, ValueType);\r\nrequire('../platform/CCClass').fastDefine('cc.Size', Size, { width: 0, height: 0});\r\n\r\n/**\r\n * @property {Number} width\r\n */\r\n/**\r\n * @property {Number} height\r\n */\r\n\r\n/**\r\n * !#en return a Size object with width = 0 and height = 0.\r\n * !#zh  0  0  Size \r\n * @property ZERO\r\n * @type {Size}\r\n * @default new Size(0, 0)\r\n * @static\r\n */\r\njs.get(Size, 'ZERO', function () {\r\n    return new Size(0.0, 0.0);\r\n});\r\n\r\nvar proto = Size.prototype;\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh  size \r\n * @method clone\r\n * @return {Size}\r\n * @example\r\n * var a = new cc.size(10, 10);\r\n * a.clone();// return Size {width: 0, height: 0};\r\n */\r\nproto.clone = function () {\r\n    return new Size(this.width, this.height);\r\n};\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh  Size  Size \r\n * @method equals\r\n * @param {Size} other\r\n * @return {Boolean}\r\n * @example\r\n * var a = new cc.size(10, 10);\r\n * a.equals(new cc.size(10, 10));// return true;\r\n */\r\nproto.equals = function (other) {\r\n    return other &&\r\n           this.width === other.width &&\r\n           this.height === other.height;\r\n};\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh \r\n * @method lerp\r\n * @param {Rect} to\r\n * @param {Number} ratio - the interpolation coefficient.\r\n * @param {Size} [out] - optional, the receiving vector.\r\n * @return {Size}\r\n * @example\r\n * var a = new cc.size(10, 10);\r\n * var b = new cc.rect(50, 50, 100, 100);\r\n * update (dt) {\r\n *    // method 1;\r\n *    var c = a.lerp(b, dt * 0.1);\r\n *    // method 2;\r\n *    a.lerp(b, dt * 0.1, c);\r\n * }\r\n */\r\nproto.lerp = function (to, ratio, out) {\r\n    out = out || new Size();\r\n    var width = this.width;\r\n    var height = this.height;\r\n    out.width = width + (to.width - width) * ratio;\r\n    out.height = height + (to.height - height) * ratio;\r\n    return out;\r\n};\r\n\r\nproto.set = function (source) {\r\n    this.width = source.width;\r\n    this.height = source.height;\r\n};\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh \r\n * @method toString\r\n * @return {String}\r\n * @example\r\n * var a = new cc.size(10, 10);\r\n * a.toString();// return \"(10.00, 10.00)\";\r\n */\r\nproto.toString = function () {\r\n    return '(' + this.width.toFixed(2) + ', ' + this.height.toFixed(2) + ')';\r\n};\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * !#en\r\n * Helper function that creates a cc.Size.<br/>\r\n * Please use cc.p or cc.v2 instead, it will soon replace cc.Size.\r\n * !#zh\r\n *  cc.Size <br/>\r\n *  cc.p  cc.v2  cc.Size\r\n * @method size\r\n * @param {Number|Size} w - width or a size object\r\n * @param {Number} [h] - height\r\n * @return {Size}\r\n * @example {@link utils/api/engine/docs/cocos2d/core/value-types/CCSize/size.js}\r\n */\r\ncc.size = function (w, h) {\r\n    return new Size(w, h);\r\n};\r\n\r\ncc.Size = module.exports = Size;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nvar js = require('../platform/js');\r\n\r\n/**\r\n * !#en The base class of all value types.\r\n * !#zh \r\n * @class ValueType\r\n *\r\n */\r\nfunction ValueType () {}\r\njs.setClassName('cc.ValueType', ValueType);\r\n\r\nvar proto = ValueType.prototype;\r\n\r\nif (CC_EDITOR) {\r\n    /**\r\n     * !#en This method returns an exact copy of current value.\r\n     * !#zh \r\n     * @method clone\r\n     * @return {ValueType}\r\n     */\r\n    proto.clone = function () {\r\n        cc.errorID('0100', js.getClassName(this) + '.clone');\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * !#en Compares this object with the other one.\r\n     * !#zh \r\n     * @method equals\r\n     * @param {ValueType} other\r\n     * @return {Boolean}\r\n     */\r\n    proto.equals = function (other) {\r\n        cc.errorID('0100', js.getClassName(this) + '.equals');\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * !#en\r\n     * Linearly interpolates between this value to to value by ratio which is in the range [0, 1].\r\n     * When ratio = 0 returns this. When ratio = 1 return to. When ratio = 0.5 returns the average of this and to.\r\n     * !#zh\r\n     * <br/>\r\n     *  ratio = 0 ratio = 1 ratio = 0.5 \r\n     * @method lerp\r\n     * @param {ValueType} to - the to value\r\n     * @param {number} ratio - the interpolation coefficient\r\n     * @return {ValueType}\r\n     */\r\n    proto.lerp = function (to, ratio) {\r\n        cc.errorID('0100', js.getClassName(this) + '.lerp');\r\n        return this.clone();\r\n    };\r\n\r\n    /**\r\n     * !#en\r\n     * Copys all the properties from another given object to this value.\r\n     * !#zh\r\n     * \r\n     * @method set\r\n     * @param {ValueType} source - the source to copy\r\n     */\r\n    proto.set = function (source) {\r\n        cc.errorID('0100', js.getClassName(this) + '.set');\r\n    };\r\n}\r\n\r\n/**\r\n * !#en TODO\r\n * !#zh \r\n * @method toString\r\n * @return {string}\r\n */\r\nproto.toString = function () {\r\n    return '' + {};\r\n};\r\n\r\ncc.ValueType = module.exports = ValueType;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst ValueType = require('./value-type');\r\nconst js = require('../platform/js');\r\nconst CCClass = require('../platform/CCClass');\r\nconst math = require('../renderer/render-engine').math;\r\nconst misc = require('../utils/misc');\r\n\r\n/**\r\n * !#en Representation of 2D vectors and points.\r\n * !#zh  2D \r\n *\r\n * @class Vec2\r\n * @extends ValueType\r\n */\r\n\r\n/**\r\n * !#en\r\n * Constructor\r\n * see {{#crossLink \"cc/vec2:method\"}}cc.v2{{/crossLink}} or {{#crossLink \"cc/p:method\"}}cc.p{{/crossLink}}\r\n * !#zh\r\n *  {{#crossLink \"cc/vec2:method\"}}cc.v2{{/crossLink}}  {{#crossLink \"cc/p:method\"}}cc.p{{/crossLink}}\r\n * @method constructor\r\n * @param {number} [x=0]\r\n * @param {number} [y=0]\r\n */\r\nfunction Vec2 (x, y) {\r\n    if (x && typeof x === 'object') {\r\n        y = x.y;\r\n        x = x.x;\r\n    }\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n}\r\njs.extend(Vec2, ValueType);\r\nCCClass.fastDefine('cc.Vec2', Vec2, { x: 0, y: 0 });\r\n\r\n/**\r\n * @property {Number} x\r\n */\r\n/**\r\n * @property {Number} y\r\n */\r\n\r\nvar proto = Vec2.prototype;\r\n\r\n\r\n/**\r\n * !#en clone a Vec2 object\r\n * !#zh  Vec2 \r\n * @method clone\r\n * @return {Vec2}\r\n */\r\nproto.clone = function () {\r\n    return new Vec2(this.x, this.y);\r\n};\r\n\r\n/**\r\n * !#en Sets vector with another's value\r\n * !#zh \r\n * @method set\r\n * @param {Vec2} newValue - !#en new value to set. !#zh \r\n * @return {Vec2} returns this\r\n * @chainable\r\n */\r\nproto.set = function (newValue) {\r\n    this.x = newValue.x;\r\n    this.y = newValue.y;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Check whether two vector equal\r\n * !#zh \r\n * @method equals\r\n * @param {Vec2} other\r\n * @return {Boolean}\r\n */\r\nproto.equals = function (other) {\r\n    return other && this.x === other.x && this.y === other.y;\r\n};\r\n\r\n/**\r\n * !#en Check whether two vector equal with some degree of variance.\r\n * !#zh\r\n * <br/>\r\n *  2  true false\r\n * @method fuzzyEquals\r\n * @param {Vec2} other\r\n * @param {Number} variance\r\n * @return {Boolean}\r\n */\r\nproto.fuzzyEquals = function (other, variance) {\r\n    if (this.x - variance <= other.x && other.x <= this.x + variance) {\r\n        if (this.y - variance <= other.y && other.y <= this.y + variance)\r\n            return true;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * !#en Transform to string with vector informations\r\n * !#zh \r\n * @method toString\r\n * @return {string}\r\n */\r\nproto.toString = function () {\r\n    return \"(\" +\r\n           this.x.toFixed(2) + \", \" +\r\n           this.y.toFixed(2) + \")\"\r\n        ;\r\n};\r\n\r\n/**\r\n * !#en Calculate linear interpolation result between this vector and another one with given ratio\r\n * !#zh \r\n * @method lerp\r\n * @param {Vec2} to\r\n * @param {number} ratio - the interpolation coefficient\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2}\r\n */\r\nproto.lerp = function (to, ratio, out) {\r\n    out = out || new Vec2();\r\n    var x = this.x;\r\n    var y = this.y;\r\n    out.x = x + (to.x - x) * ratio;\r\n    out.y = y + (to.y - y) * ratio;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Clamp the vector between from float and to float.\r\n * !#zh\r\n * <br/>\r\n *  max_inclusive  max_inclusive<br/>\r\n *  min_inclusive  min_inclusive<br/>\r\n * \r\n * @method clampf\r\n * @param {Vec2} min_inclusive\r\n * @param {Vec2} max_inclusive\r\n * @return {Vec2}\r\n * @example\r\n * var min_inclusive = cc.v2(0, 0);\r\n * var max_inclusive = cc.v2(20, 20);\r\n * var v1 = cc.v2(20, 20).clamp(min_inclusive, max_inclusive); // Vec2 {x: 20, y: 20};\r\n * var v2 = cc.v2(0, 0).clamp(min_inclusive, max_inclusive);   // Vec2 {x: 0, y: 0};\r\n * var v3 = cc.v2(10, 10).clamp(min_inclusive, max_inclusive); // Vec2 {x: 10, y: 10};\r\n */\r\nproto.clampf = function (min_inclusive, max_inclusive) {\r\n    this.x = misc.clampf(this.x, min_inclusive.x, max_inclusive.x);\r\n    this.y = misc.clampf(this.y, min_inclusive.y, max_inclusive.y);\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Adds this vector. If you want to save result to another vector, use add() instead.\r\n * !#zh  add() \r\n * @method addSelf\r\n * @param {Vec2} vector\r\n * @return {Vec2} returns this\r\n * @chainable\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.addSelf(cc.v2(5, 5));// return Vec2 {x: 15, y: 15};\r\n */\r\nproto.addSelf = function (vector) {\r\n    this.x += vector.x;\r\n    this.y += vector.y;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Adds two vectors, and returns the new result.\r\n * !#zh \r\n * @method add\r\n * @param {Vec2} vector\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.add(cc.v2(5, 5));      // return Vec2 {x: 15, y: 15};\r\n * var v1;\r\n * v.add(cc.v2(5, 5), v1);  // return Vec2 {x: 15, y: 15};\r\n */\r\nproto.add = function (vector, out) {\r\n    out = out || new Vec2();\r\n    out.x = this.x + vector.x;\r\n    out.y = this.y + vector.y;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Subtracts one vector from this. If you want to save result to another vector, use sub() instead.\r\n * !#zh  sub() \r\n * @method subSelf\r\n * @param {Vec2} vector\r\n * @return {Vec2} returns this\r\n * @chainable\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.subSelf(cc.v2(5, 5));// return Vec2 {x: 5, y: 5};\r\n */\r\nproto.subSelf = function (vector) {\r\n    this.x -= vector.x;\r\n    this.y -= vector.y;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Subtracts one vector from this, and returns the new result.\r\n * !#zh \r\n * @method sub\r\n * @param {Vec2} vector\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.sub(cc.v2(5, 5));      // return Vec2 {x: 5, y: 5};\r\n * var v1;\r\n * v.sub(cc.v2(5, 5), v1);  // return Vec2 {x: 5, y: 5};\r\n */\r\nproto.sub = function (vector, out) {\r\n    out = out || new Vec2();\r\n    out.x = this.x - vector.x;\r\n    out.y = this.y - vector.y;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Multiplies this by a number. If you want to save result to another vector, use mul() instead.\r\n * !#zh  mul() \r\n * @method mulSelf\r\n * @param {number} num\r\n * @return {Vec2} returns this\r\n * @chainable\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.mulSelf(5);// return Vec2 {x: 50, y: 50};\r\n */\r\nproto.mulSelf = function (num) {\r\n    this.x *= num;\r\n    this.y *= num;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Multiplies by a number, and returns the new result.\r\n * !#zh \r\n * @method mul\r\n * @param {number} num\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.mul(5);      // return Vec2 {x: 50, y: 50};\r\n * var v1;\r\n * v.mul(5, v1);  // return Vec2 {x: 50, y: 50};\r\n */\r\nproto.mul = function (num, out) {\r\n    out = out || new Vec2();\r\n    out.x = this.x * num;\r\n    out.y = this.y * num;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Multiplies two vectors.\r\n * !#zh \r\n * @method scaleSelf\r\n * @param {Vec2} vector\r\n * @return {Vec2} returns this\r\n * @chainable\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.scaleSelf(cc.v2(5, 5));// return Vec2 {x: 50, y: 50};\r\n */\r\nproto.scaleSelf = function (vector) {\r\n    this.x *= vector.x;\r\n    this.y *= vector.y;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Multiplies two vectors, and returns the new result.\r\n * !#zh \r\n * @method scale\r\n * @param {Vec2} vector\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.scale(cc.v2(5, 5));      // return Vec2 {x: 50, y: 50};\r\n * var v1;\r\n * v.scale(cc.v2(5, 5), v1);  // return Vec2 {x: 50, y: 50};\r\n */\r\nproto.scale = function (vector, out) {\r\n    out = out || new Vec2();\r\n    out.x = this.x * vector.x;\r\n    out.y = this.y * vector.y;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Divides by a number. If you want to save result to another vector, use div() instead.\r\n * !#zh  div() \r\n * @method divSelf\r\n * @param {Vec2} divisor\r\n * @return {Vec2} returns this\r\n * @chainable\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.divSelf(5); // return Vec2 {x: 2, y: 2};\r\n */\r\nproto.divSelf = function (num) {\r\n    this.x /= num;\r\n    this.y /= num;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Divides by a number, and returns the new result.\r\n * !#zh \r\n * @method div\r\n * @param {Vec2} divisor\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.div(5);      // return Vec2 {x: 2, y: 2};\r\n * var v1;\r\n * v.div(5, v1);  // return Vec2 {x: 2, y: 2};\r\n */\r\nproto.div = function (num, out) {\r\n    out = out || new Vec2();\r\n    out.x = this.x / num;\r\n    out.y = this.y / num;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Negates the components. If you want to save result to another vector, use neg() instead.\r\n * !#zh  neg() \r\n * @method negSelf\r\n * @return {Vec2} returns this\r\n * @chainable\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.negSelf(); // return Vec2 {x: -10, y: -10};\r\n */\r\nproto.negSelf = function () {\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Negates the components, and returns the new result.\r\n * !#zh \r\n * @method neg\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * var v1;\r\n * v.neg(v1);  // return Vec2 {x: -10, y: -10};\r\n */\r\nproto.neg = function (out) {\r\n    out = out || new Vec2();\r\n    out.x = -this.x;\r\n    out.y = -this.y;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Dot product\r\n * !#zh \r\n * @method dot\r\n * @param {Vec2} [vector]\r\n * @return {number} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.dot(cc.v2(5, 5)); // return 100;\r\n */\r\nproto.dot = function (vector) {\r\n    return this.x * vector.x + this.y * vector.y;\r\n};\r\n\r\n/**\r\n * !#en Cross product\r\n * !#zh \r\n * @method cross\r\n * @param {Vec2} [vector]\r\n * @return {number} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.cross(cc.v2(5, 5)); // return 0;\r\n */\r\nproto.cross = function (vector) {\r\n    return this.x * vector.y - this.y * vector.x;\r\n};\r\n\r\n/**\r\n * !#en Returns the length of this vector.\r\n * !#zh \r\n * @method mag\r\n * @return {number} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.mag(); // return 14.142135623730951;\r\n */\r\nproto.mag = function () {\r\n    return Math.sqrt(this.x * this.x + this.y * this.y);\r\n};\r\n\r\n/**\r\n * !#en Returns the squared length of this vector.\r\n * !#zh \r\n * @method magSqr\r\n * @return {number} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.magSqr(); // return 200;\r\n */\r\nproto.magSqr = function () {\r\n    return this.x * this.x + this.y * this.y;\r\n};\r\n\r\n/**\r\n * !#en Make the length of this vector to 1.\r\n * !#zh  1\r\n * @method normalizeSelf\r\n * @return {Vec2} returns this\r\n * @chainable\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.normalizeSelf(); // return Vec2 {x: 0.7071067811865475, y: 0.7071067811865475};\r\n */\r\nproto.normalizeSelf = function () {\r\n    var magSqr = this.x * this.x + this.y * this.y;\r\n    if (magSqr === 1.0)\r\n        return this;\r\n\r\n    if (magSqr === 0.0) {\r\n        return this;\r\n    }\r\n\r\n    var invsqrt = 1.0 / Math.sqrt(magSqr);\r\n    this.x *= invsqrt;\r\n    this.y *= invsqrt;\r\n\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Returns this vector with a magnitude of 1.<br/>\r\n * <br/>\r\n * Note that the current vector is unchanged and a new normalized vector is returned. If you want to normalize the current vector, use normalizeSelf function.\r\n * !#zh\r\n * <br/>\r\n * <br/>\r\n *  normalizeSelf \r\n * @method normalize\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2} result\r\n * var v = cc.v2(10, 10);\r\n * v.normalize();   // return Vec2 {x: 0.7071067811865475, y: 0.7071067811865475};\r\n */\r\nproto.normalize = function (out) {\r\n    out = out || new Vec2();\r\n    out.x = this.x;\r\n    out.y = this.y;\r\n    out.normalizeSelf();\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Get angle in radian between this and vector.\r\n * !#zh \r\n * @method angle\r\n * @param {Vec2} vector\r\n * @return {number} from 0 to Math.PI\r\n */\r\nproto.angle = function (vector) {\r\n    var magSqr1 = this.magSqr();\r\n    var magSqr2 = vector.magSqr();\r\n\r\n    if (magSqr1 === 0 || magSqr2 === 0) {\r\n        console.warn(\"Can't get angle between zero vector\");\r\n        return 0.0;\r\n    }\r\n\r\n    var dot = this.dot(vector);\r\n    var theta = dot / (Math.sqrt(magSqr1 * magSqr2));\r\n    theta = misc.clampf(theta, -1.0, 1.0);\r\n    return Math.acos(theta);\r\n};\r\n\r\n/**\r\n * !#en Get angle in radian between this and vector with direction.\r\n * !#zh \r\n * @method signAngle\r\n * @param {Vec2} vector\r\n * @return {number} from -MathPI to Math.PI\r\n */\r\nproto.signAngle = function (vector) {\r\n    let angle = this.angle(vector);\r\n    return this.cross(vector) < 0 ? -angle : angle;\r\n};\r\n\r\n/**\r\n * !#en rotate\r\n * !#zh \r\n * @method rotate\r\n * @param {number} radians\r\n * @param {Vec2} [out] - optional, the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @return {Vec2} the result\r\n */\r\nproto.rotate = function (radians, out) {\r\n    out = out || new Vec2();\r\n    out.x = this.x;\r\n    out.y = this.y;\r\n    return out.rotateSelf(radians);\r\n};\r\n\r\n/**\r\n * !#en rotate self\r\n * !#zh \r\n * @method rotateSelf\r\n * @param {number} radians\r\n * @return {Vec2} returns this\r\n * @chainable\r\n */\r\nproto.rotateSelf = function (radians) {\r\n    var sin = Math.sin(radians);\r\n    var cos = Math.cos(radians);\r\n    var x = this.x;\r\n    this.x = cos * x - sin * this.y;\r\n    this.y = sin * x + cos * this.y;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Calculates the projection of the current vector over the given vector.\r\n * !#zh  vector \r\n * @method project\r\n * @param {Vec2} vector\r\n * @return {Vec2}\r\n * @example\r\n * var v1 = cc.v2(20, 20);\r\n * var v2 = cc.v2(5, 5);\r\n * v1.project(v2); // Vec2 {x: 20, y: 20};\r\n */\r\nproto.project = function (vector) {\r\n    return vector.mul(this.dot(vector) / vector.dot(vector));\r\n};\r\n\r\n/**\r\n * Transforms the vec2 with a mat4. 3rd vector component is implicitly '0', 4th vector component is implicitly '1'\r\n * @method transformMat4\r\n * @param {mat4} m matrix to transform with\r\n * @param {Vec2} [out] the receiving vector, you can pass the same vec2 to save result to itself, if not provided, a new vec2 will be created\r\n * @returns {Vec2} out\r\n */\r\nproto.transformMat4 = function (m, out) {\r\n    out = out || new Vec2();\r\n    math.vec2.transformMat4(out, this, m);\r\n};\r\n\r\n//_serialize: function () {\r\n//    return [this.x, this.y];\r\n//},\r\n//_deserialize: function (data) {\r\n//    this.x = data[0];\r\n//    this.y = data[1];\r\n//}\r\n\r\n// static\r\n\r\n/**\r\n * !#en return a Vec2 object with x = 1 and y = 1.\r\n * !#zh  Vec2 \r\n * @property ONE\r\n * @type Vec2\r\n * @static\r\n */\r\njs.get(Vec2, 'ONE', function () {\r\n    return new Vec2(1.0, 1.0);\r\n});\r\n\r\n/**\r\n * !#en return a Vec2 object with x = 0 and y = 0.\r\n * !#zh  x = 0  y = 0  Vec2 \r\n * @property ZERO\r\n * @type Vec2\r\n * @static\r\n */\r\njs.get(Vec2, 'ZERO', function () {\r\n    return new Vec2(0.0, 0.0);\r\n});\r\n\r\n/**\r\n * !#en return a Vec2 object with x = 0 and y = 1.\r\n * !#zh  x = 0  y = 1  Vec2 \r\n * @property UP\r\n * @type Vec2\r\n * @static\r\n */\r\njs.get(Vec2, 'UP', function () {\r\n    return new Vec2(0.0, 1.0);\r\n});\r\n\r\n/**\r\n * !#en return a Vec2 object with x = 1 and y = 0.\r\n * !#zh  x = 1  y = 0  Vec2 \r\n * @property RIGHT\r\n * @type Vec2\r\n * @static\r\n */\r\njs.get(Vec2, 'RIGHT', function () {\r\n    return new Vec2(1.0, 0.0);\r\n});\r\n\r\ncc.Vec2 = Vec2;\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n\r\n/**\r\n * !#en The convenience method to create a new {{#crossLink \"Vec2\"}}cc.Vec2{{/crossLink}}.\r\n * !#zh  {{#crossLink \"Vec2\"}}cc.Vec2{{/crossLink}} \r\n * @method v2\r\n * @param {Number|Object} [x=0]\r\n * @param {Number} [y=0]\r\n * @return {Vec2}\r\n * @example\r\n * var v1 = cc.v2();\r\n * var v2 = cc.v2(0, 0);\r\n * var v3 = cc.v2(v2);\r\n * var v4 = cc.v2({x: 100, y: 100});\r\n */\r\ncc.v2 = function v2 (x, y) {\r\n    return new Vec2(x, y);\r\n};\r\n\r\n/** \r\n * !#en This function is deprecated since v2.0, please use {{#crossLink \"v2\"}}cc.v2{{/crossLink}}. \r\n * !#zh  v2.0  {{#crossLink \"v2\"}}cc.v2{{/crossLink}} \r\n * @method p \r\n * @deprecated since v2.0\r\n * @param {Number|Object} [x=0] a Number or a size object \r\n * @param {Number} [y=0] \r\n * @return {Vec2}\r\n */ \r\ncc.p = cc.v2;\r\n\r\nmodule.exports = cc.Vec2;\r\n","/****************************************************************************\r\n Copyright (c) 2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst ValueType = require('./value-type');\r\nconst js = require('../platform/js');\r\nconst CCClass = require('../platform/CCClass');\r\nconst math = require('../renderer/render-engine').math;\r\nconst misc = require('../utils/misc');\r\n\r\n/**\r\n * !#en Representation of 3D vectors and points.\r\n * !#zh  3D \r\n *\r\n * @class Vec3\r\n * @extends ValueType\r\n */\r\n\r\n/**\r\n * !#en\r\n * Constructor\r\n * see {{#crossLink \"cc/vec3:method\"}}cc.v3{{/crossLink}}\r\n * !#zh\r\n *  {{#crossLink \"cc/vec3:method\"}}cc.v3{{/crossLink}}\r\n * @method constructor\r\n * @param {number} [x=0]\r\n * @param {number} [y=0]\r\n * @param {number} [z=0]\r\n */\r\nfunction Vec3 (x, y, z) {\r\n    if (x && typeof x === 'object') {\r\n        z = x.z;\r\n        y = x.y;\r\n        x = x.x;\r\n    }\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n    this.z = z || 0;\r\n}\r\njs.extend(Vec3, ValueType);\r\nCCClass.fastDefine('cc.Vec3', Vec3, { x: 0, y: 0, z: 0 });\r\n\r\n/**\r\n * @property {Number} x\r\n */\r\n/**\r\n * @property {Number} y\r\n */\r\n/**\r\n * @property {Number} z\r\n */\r\n\r\nvar proto = Vec3.prototype;\r\n\r\n\r\n/**\r\n * !#en clone a Vec3 value\r\n * !#zh  Vec3 \r\n * @method clone\r\n * @return {Vec3}\r\n */\r\nproto.clone = function () {\r\n    return new Vec3(this.x, this.y, this.z);\r\n};\r\n\r\n/**\r\n * !#en Set the current vector value with the given vector.\r\n * !#zh \r\n * @method set\r\n * @param {Vec3} newValue - !#en new value to set. !#zh \r\n * @return {Vec3} returns this\r\n * @chainable\r\n */\r\nproto.set = function (newValue) {\r\n    this.x = newValue.x;\r\n    this.y = newValue.y;\r\n    this.z = newValue.z;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Check whether the vector equals another one\r\n * !#zh \r\n * @method equals\r\n * @param {Vec3} other\r\n * @return {Boolean}\r\n */\r\nproto.equals = function (other) {\r\n    return other && this.x === other.x && this.y === other.y && this.z === other.z;\r\n};\r\n\r\n\r\n/**\r\n * !#en Check whether two vector equal with some degree of variance.\r\n * !#zh\r\n * <br/>\r\n *  2  true false\r\n * @method fuzzyEquals\r\n * @param {Vec3} other\r\n * @param {Number} variance\r\n * @return {Boolean}\r\n */\r\nproto.fuzzyEquals = function (other, variance) {\r\n    if (this.x - variance <= other.x && other.x <= this.x + variance) {\r\n        if (this.y - variance <= other.y && other.y <= this.y + variance) {\r\n            if (this.z - variance <= other.z && other.z <= this.z + variance)\r\n                return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * !#en Transform to string with vector informations\r\n * !#zh \r\n * @method toString\r\n * @return {string}\r\n */\r\nproto.toString = function () {\r\n    return \"(\" +\r\n           this.x.toFixed(2) + \", \" +\r\n           this.y.toFixed(2) + \", \" +\r\n           this.z.toFixed(2) + \")\"\r\n        ;\r\n};\r\n\r\n/**\r\n * !#en Calculate linear interpolation result between this vector and another one with given ratio\r\n * !#zh \r\n * @method lerp\r\n * @param {Vec3} to\r\n * @param {number} ratio - the interpolation coefficient\r\n * @param {Vec3} [out] - optional, the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @return {Vec3}\r\n */\r\nproto.lerp = function (to, ratio, out) {\r\n    out = out || new Vec3();\r\n    math.vec3.lerp(out, this, to, ratio);\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Clamp the vector between from float and to float.\r\n * !#zh\r\n * <br/>\r\n *  max_inclusive  max_inclusive<br/>\r\n *  min_inclusive  min_inclusive<br/>\r\n * \r\n * @method clampf\r\n * @param {Vec3} min_inclusive\r\n * @param {Vec3} max_inclusive\r\n * @return {Vec3}\r\n */\r\nproto.clampf = function (min_inclusive, max_inclusive) {\r\n    this.x = misc.clampf(this.x, min_inclusive.x, max_inclusive.x);\r\n    this.y = misc.clampf(this.y, min_inclusive.y, max_inclusive.y);\r\n    this.z = misc.clampf(this.z, min_inclusive.z, max_inclusive.z);\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Adds this vector. If you want to save result to another vector, use add() instead.\r\n * !#zh  add() \r\n * @method addSelf\r\n * @param {Vec3} vector\r\n * @return {Vec3} returns this\r\n * @chainable\r\n */\r\nproto.addSelf = function (vector) {\r\n    this.x += vector.x;\r\n    this.y += vector.y;\r\n    this.z += vector.z;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Adds two vectors, and returns the new result.\r\n * !#zh \r\n * @method add\r\n * @param {Vec3} vector\r\n * @param {Vec3} [out] - optional, the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @return {Vec3} the result\r\n */\r\nproto.add = function (vector, out) {\r\n    out = out || new Vec3();\r\n    out.x = this.x + vector.x;\r\n    out.y = this.y + vector.y;\r\n    out.z = this.z + vector.z;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Subtracts one vector from this. If you want to save result to another vector, use sub() instead.\r\n * !#zh  sub() \r\n * @method subSelf\r\n * @param {Vec3} vector\r\n * @return {Vec3} returns this\r\n * @chainable\r\n */\r\nproto.subSelf = function (vector) {\r\n    this.x -= vector.x;\r\n    this.y -= vector.y;\r\n    this.z -= vector.z;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Subtracts one vector from this, and returns the new result.\r\n * !#zh \r\n * @method sub\r\n * @param {Vec3} vector\r\n * @param {Vec3} [out] - optional, the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @return {Vec3} the result\r\n */\r\nproto.sub = function (vector, out) {\r\n    out = out || new Vec3();\r\n    out.x = this.x - vector.x;\r\n    out.y = this.y - vector.y;\r\n    out.z = this.z - vector.z;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Multiplies this by a number. If you want to save result to another vector, use mul() instead.\r\n * !#zh  mul() \r\n * @method mulSelf\r\n * @param {number} num\r\n * @return {Vec3} returns this\r\n * @chainable\r\n */\r\nproto.mulSelf = function (num) {\r\n    this.x *= num;\r\n    this.y *= num;\r\n    this.z *= num;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Multiplies by a number, and returns the new result.\r\n * !#zh \r\n * @method mul\r\n * @param {number} num\r\n * @param {Vec3} [out] - optional, the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @return {Vec3} the result\r\n */\r\nproto.mul = function (num, out) {\r\n    out = out || new Vec3();\r\n    out.x = this.x * num;\r\n    out.y = this.y * num;\r\n    out.z = this.z * num;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Multiplies two vectors.\r\n * !#zh \r\n * @method scaleSelf\r\n * @param {Vec3} vector\r\n * @return {Vec3} returns this\r\n * @chainable\r\n */\r\nproto.scaleSelf = function (vector) {\r\n    this.x *= vector.x;\r\n    this.y *= vector.y;\r\n    this.z *= vector.z;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Multiplies two vectors, and returns the new result.\r\n * !#zh \r\n * @method scale\r\n * @param {Vec3} vector\r\n * @param {Vec3} [out] - optional, the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @return {Vec3} the result\r\n */\r\nproto.scale = function (vector, out) {\r\n    out = out || new Vec3();\r\n    out.x = this.x * vector.x;\r\n    out.y = this.y * vector.y;\r\n    out.z = this.z * vector.z;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Divides by a number. If you want to save result to another vector, use div() instead.\r\n * !#zh  div() \r\n * @method divSelf\r\n * @param {Vec3} vector\r\n * @return {Vec3} returns this\r\n * @chainable\r\n */\r\nproto.divSelf = function (num) {\r\n    this.x /= num;\r\n    this.y /= num;\r\n    this.z /= num;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Divides by a number, and returns the new result.\r\n * !#zh \r\n * @method div\r\n * @param {Vec3} vector\r\n * @param {Vec3} [out] - optional, the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @return {Vec3} the result\r\n */\r\nproto.div = function (num, out) {\r\n    out = out || new Vec3();\r\n    out.x = this.x / num;\r\n    out.y = this.y / num;\r\n    out.z = this.z / num;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Negates the components. If you want to save result to another vector, use neg() instead.\r\n * !#zh  neg() \r\n * @method negSelf\r\n * @return {Vec3} returns this\r\n * @chainable\r\n */\r\nproto.negSelf = function () {\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en Negates the components, and returns the new result.\r\n * !#zh \r\n * @method neg\r\n * @param {Vec3} [out] - optional, the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @return {Vec3} the result\r\n */\r\nproto.neg = function (out) {\r\n    out = out || new Vec3();\r\n    out.x = -this.x;\r\n    out.y = -this.y;\r\n    out.z = -this.z;\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Dot product\r\n * !#zh \r\n * @method dot\r\n * @param {Vec3} [vector]\r\n * @return {number} the result\r\n */\r\nproto.dot = function (vector) {\r\n    return this.x * vector.x + this.y * vector.y + this.z * vector.z;\r\n};\r\n\r\n/**\r\n * !#en Cross product\r\n * !#zh \r\n * @method cross\r\n * @param {Vec3} vector\r\n * @param {Vec3} [out]\r\n * @return {Vec3} the result\r\n */\r\nproto.cross = function (vector, out) {\r\n    out = out || new Vec3();\r\n    math.vec3.cross(out, this, vector)\r\n    return out;\r\n};\r\n\r\n/**\r\n * !#en Returns the length of this vector.\r\n * !#zh \r\n * @method mag\r\n * @return {number} the result\r\n * @example\r\n * var v = cc.v2(10, 10);\r\n * v.mag(); // return 14.142135623730951;\r\n */\r\nproto.mag = function () {\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n};\r\n\r\n/**\r\n * !#en Returns the squared length of this vector.\r\n * !#zh \r\n * @method magSqr\r\n * @return {number} the result\r\n */\r\nproto.magSqr = function () {\r\n    return this.x * this.x + this.y * this.y + this.z * this.z;\r\n};\r\n\r\n/**\r\n * !#en Make the length of this vector to 1.\r\n * !#zh  1\r\n * @method normalizeSelf\r\n * @return {Vec3} returns this\r\n * @chainable\r\n */\r\nproto.normalizeSelf = function () {\r\n    math.vec3.normalize(this, this);\r\n    return this;\r\n};\r\n\r\n/**\r\n * !#en\r\n * Returns this vector with a magnitude of 1.<br/>\r\n * <br/>\r\n * Note that the current vector is unchanged and a new normalized vector is returned. If you want to normalize the current vector, use normalizeSelf function.\r\n * !#zh\r\n * <br/>\r\n * <br/>\r\n *  normalizeSelf \r\n * @method normalize\r\n * @param {Vec3} [out] - optional, the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @return {Vec3} result\r\n */\r\nproto.normalize = function (out) {\r\n    out = out || new Vec3();\r\n    math.vec3.normalize(out, this);\r\n    return out;\r\n};\r\n\r\n/**\r\n * Transforms the vec3 with a mat4. 4th vector component is implicitly '1'\r\n * @method transformMat4\r\n * @param {mat4} m matrix to transform with\r\n * @param {vec3} [out] the receiving vector, you can pass the same vec3 to save result to itself, if not provided, a new vec3 will be created\r\n * @returns {vec3} out\r\n */\r\nproto.transformMat4 = function (m, out) {\r\n    out = out || new Vec3();\r\n    math.vec3.transformMat4(out, this, m);\r\n};\r\n\r\n/**\r\n * !#en The convenience method to create a new {{#crossLink \"Vec3\"}}cc.Vec3{{/crossLink}}.\r\n * !#zh  {{#crossLink \"Vec3\"}}cc.Vec3{{/crossLink}} \r\n * @method v3\r\n * @param {Number|Object} [x=0]\r\n * @param {Number} [y=0]\r\n * @param {Number} [z=0]\r\n * @return {Vec3}\r\n * @example\r\n * var v1 = cc.v3();\r\n * var v2 = cc.v3(0, 0, 0);\r\n * var v3 = cc.v3(v2);\r\n * var v4 = cc.v3({x: 100, y: 100, z: 0});\r\n */\r\ncc.v3 = function v3 (x, y, z) {\r\n    return new Vec3(x, y, z);\r\n};\r\n\r\nmodule.exports = cc.Vec3 = Vec3;","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n\r\nvar js = cc.js;\r\n\r\nif (CC_DEBUG) {\r\n\r\n    function deprecateEnum (obj, oldPath, newPath, hasTypePrefixBefore) {\r\n        if (!CC_SUPPORT_JIT) {\r\n            return;\r\n        }\r\n        hasTypePrefixBefore = hasTypePrefixBefore !== false;\r\n        var enumDef = Function('return ' + newPath)();\r\n        var entries = cc.Enum.getList(enumDef);\r\n        var delimiter = hasTypePrefixBefore ? '_' : '.';\r\n        for (var i = 0; i < entries.length; i++) {\r\n            var entry = entries[i].name;\r\n            var oldPropName;\r\n            if (hasTypePrefixBefore) {\r\n                var oldTypeName = oldPath.split('.').slice(-1)[0];\r\n                oldPropName = oldTypeName + '_' + entry;\r\n            }\r\n            else {\r\n                oldPropName = entry;\r\n            }\r\n            js.get(obj, oldPropName, function (entry) {\r\n                cc.errorID(1400, oldPath + delimiter + entry, newPath + '.' + entry);\r\n                return enumDef[entry];\r\n            }.bind(null, entry));\r\n        }\r\n    }\r\n\r\n    function markAsRemoved (ownerCtor, removedProps, ownerName) {\r\n        if (!ownerCtor) {\r\n            // \r\n            return;\r\n        }\r\n        ownerName = ownerName || js.getClassName(ownerCtor);\r\n        removedProps.forEach(function (prop) {\r\n            function error () {\r\n                cc.errorID(1406, ownerName, prop);\r\n            }\r\n            js.getset(ownerCtor.prototype, prop, error, error);\r\n        });\r\n    }\r\n\r\n    function markAsDeprecated (ownerCtor, deprecatedProps, ownerName) {\r\n        if (!ownerCtor) {\r\n            return;\r\n        }\r\n        ownerName = ownerName || js.getClassName(ownerCtor);\r\n        let descriptors = Object.getOwnPropertyDescriptors(ownerCtor.prototype);\r\n        deprecatedProps.forEach(function (prop) {\r\n            let deprecatedProp = prop[0];\r\n            let newProp = prop[1];\r\n            let descriptor = descriptors[deprecatedProp];\r\n            js.getset(ownerCtor.prototype, deprecatedProp, function () {\r\n                cc.warnID(1400, `${ownerName}.${deprecatedProp}`, `${ownerName}.${newProp}`);\r\n                return descriptor.get.call(this);\r\n            }, function (v) {\r\n                cc.warnID(1400, `${ownerName}.${deprecatedProp}`, `${ownerName}.${newProp}`);\r\n                descriptor.set.call(this, v);\r\n            })\r\n        })\r\n    }\r\n\r\n    function markAsRemovedInObject (ownerObj, removedProps, ownerName) {\r\n        if (!ownerObj) {\r\n            // \r\n            return;\r\n        }\r\n        removedProps.forEach(function (prop) {\r\n            function error () {\r\n                cc.errorID(1406, ownerName, prop);\r\n            }\r\n            js.getset(ownerObj, prop, error);\r\n        });\r\n    }\r\n\r\n    function provideClearError (owner, obj, ownerName) {\r\n        if (!owner) {\r\n            // \r\n            return;\r\n        }\r\n        var className = ownerName || cc.js.getClassName(owner);\r\n        var Info = 'Sorry, ' + className + '.%s is removed, please use %s instead.';\r\n        for (var prop in obj) {\r\n            function define (prop, getset) {\r\n                function accessor (newProp) {\r\n                    cc.error(Info, prop, newProp);\r\n                }\r\n                if (!Array.isArray(getset)) {\r\n                    getset = getset.split(',')\r\n                        .map(function (x) {\r\n                            return x.trim();\r\n                        });\r\n                }\r\n                try {\r\n                    js.getset(owner, prop, accessor.bind(null, getset[0]), getset[1] && accessor.bind(null, getset[1]));\r\n                }\r\n                catch (e) {}\r\n            }\r\n            var getset = obj[prop];\r\n            if (prop[0] === '*') {\r\n                // get set\r\n                var etProp = prop.slice(1);\r\n                define('g' + etProp, getset);\r\n                define('s' + etProp, getset);\r\n            }\r\n            else {\r\n                prop.split(',')\r\n                    .map(function (x) {\r\n                        return x.trim();\r\n                    })\r\n                    .forEach(function (x) {\r\n                        define(x, getset);\r\n                    });\r\n            }\r\n        }\r\n    }\r\n\r\n    function markFunctionWarning (ownerCtor, obj, ownerName) {\r\n        if (!ownerCtor) {\r\n            // \r\n            return;\r\n        }\r\n        ownerName = ownerName || js.getClassName(ownerCtor);\r\n        for (var prop in obj) {\r\n            (function(){\r\n                var propName = prop;\r\n                var originFunc = ownerCtor[propName];\r\n                if (!originFunc) return;\r\n\r\n                function warn () {\r\n                    cc.warn('Sorry, %s.%s is deprecated. Please use %s instead', ownerName, propName, obj[propName]);\r\n                    return originFunc.apply(this, arguments);\r\n                }\r\n\r\n                ownerCtor[propName] = warn;\r\n            })();\r\n        }\r\n    }\r\n    // remove cc.info\r\n    js.get(cc, 'info', function () {\r\n        cc.warnID(1400, 'cc.info', 'cc.log');\r\n        return cc.log;\r\n    });\r\n    // cc.spriteFrameCache\r\n    js.get(cc, \"spriteFrameCache\", function () {\r\n        cc.errorID(1404);\r\n    });\r\n\r\n    // SpriteFrame\r\n    js.get(cc.SpriteFrame.prototype, '_textureLoaded', function () {\r\n        cc.errorID(1400, 'spriteFrame._textureLoaded', 'spriteFrame.textureLoaded()');\r\n        return this.textureLoaded();\r\n    });\r\n    markAsRemoved(cc.SpriteFrame, [\r\n        'addLoadedEventListener'\r\n    ]);\r\n\r\n    // cc.textureCache\r\n    js.get(cc, 'textureCache', function () {\r\n        cc.errorID(1406, 'cc', 'textureCache');\r\n    });\r\n\r\n    // Texture\r\n    let Texture2D = cc.Texture2D;\r\n    js.obsolete(Texture2D.prototype, 'texture.releaseTexture', 'texture.destroy');\r\n\r\n    js.get(Texture2D.prototype, 'getName', function () {\r\n        cc.warnID(1400, 'texture.getName()', 'texture._glID');\r\n        return function () {\r\n            return this._glID || null;\r\n        };\r\n    });\r\n\r\n    js.get(Texture2D.prototype, 'isLoaded', function () {\r\n        cc.errorID(1400, 'texture.isLoaded function', 'texture.loaded property');\r\n        return (function () {\r\n            return this.loaded;\r\n        });\r\n    });\r\n\r\n    js.get(Texture2D.prototype, 'setAntiAliasTexParameters', function () {\r\n        cc.warnID(1400, 'texture.setAntiAliasTexParameters()', 'texture.setFilters(cc.Texture2D.Filter.LINEAR, cc.Texture2D.Filter.LINEAR)');\r\n        return function () {\r\n            this.setFilters(Texture2D.Filter.LINEAR, Texture2D.Filter.LINEAR);\r\n        };\r\n    });\r\n\r\n    js.get(Texture2D.prototype, 'setAliasTexParameters', function () {\r\n        cc.warnID(1400, 'texture.setAntiAliasTexParameters()', 'texture.setFilters(cc.Texture2D.Filter.NEAREST, cc.Texture2D.Filter.NEAREST)');\r\n        return function () {\r\n            this.setFilters(Texture2D.Filter.NEAREST, Texture2D.Filter.NEAREST);\r\n        };\r\n    });\r\n\r\n    // cc.macro\r\n    markAsRemovedInObject(cc.macro, [\r\n        'ENABLE_GL_STATE_CACHE',\r\n        'FIX_ARTIFACTS_BY_STRECHING_TEXEL',\r\n    ], 'cc.macro');\r\n\r\n    provideClearError(cc.macro, {\r\n        PI: 'Math.PI',\r\n        PI2: 'Math.PI*2',\r\n        FLT_MAX: 'Number.MAX_VALUE',\r\n        FLT_MIN: 'Number.MIN_VALUE',\r\n        UINT_MAX: 'Number.MAX_SAFE_INTEGER'\r\n    }, 'cc.macro');\r\n\r\n    // cc.game\r\n    markAsRemovedInObject(cc.game, [\r\n        'CONFIG_KEY',\r\n    ], 'cc.game');\r\n\r\n    // cc.sys\r\n    markAsRemovedInObject(cc.sys, [\r\n        'dumpRoot',\r\n        'cleanScript',\r\n    ], 'cc.sys');\r\n\r\n    // cc.Director\r\n    provideClearError(cc.Director, {\r\n        EVENT_PROJECTION_CHANGED: '',\r\n        EVENT_BEFORE_VISIT: 'EVENT_AFTER_UPDATE',\r\n        EVENT_AFTER_VISIT: 'EVENT_BEFORE_DRAW',\r\n    }, 'cc.Director');\r\n    markFunctionWarning(cc.Director.prototype, {\r\n        convertToGL: 'cc.view.convertToLocationInView',\r\n        convertToUI: '',\r\n        getWinSize: 'cc.winSize',\r\n        getWinSizeInPixels: 'cc.winSize',\r\n        getVisibleSize: 'cc.view.getVisibleSize',\r\n        getVisibleOrigin: 'cc.view.getVisibleOrigin',\r\n        purgeCachedData: 'cc.loader.releaseAll',\r\n        setDepthTest: 'cc.Camera.main.depth',\r\n        setClearColor: 'cc.Camera.main.backgroundColor',\r\n        getRunningScene: 'cc.director.getScene',\r\n        getAnimationInterval: 'cc.game.getFrameRate',\r\n        setAnimationInterval: 'cc.game.setFrameRate',\r\n        isDisplayStats: 'cc.debug.isDisplayStats',\r\n        setDisplayStats: 'cc.debug.setDisplayStats',\r\n    }, 'cc.Director');\r\n    markAsRemoved(cc.Director, [\r\n        'pushScene',\r\n        'popScene',\r\n        'popToRootScene',\r\n        'popToSceneStackLevel',\r\n        'setProjection',\r\n        'getProjection',\r\n    ], 'cc.Director');\r\n\r\n    // Scheduler\r\n    provideClearError(cc.Scheduler, {\r\n        scheduleCallbackForTarget: 'schedule',\r\n        scheduleUpdateForTarget: 'scheduleUpdate',\r\n        unscheduleCallbackForTarget: 'unschedule',\r\n        unscheduleUpdateForTarget: 'unscheduleUpdate',\r\n        unscheduleAllCallbacksForTarget: 'unscheduleAllForTarget',\r\n        unscheduleAllCallbacks: 'unscheduleAll',\r\n        unscheduleAllCallbacksWithMinPriority: 'unscheduleAllWithMinPriority'\r\n    }, 'cc.Scheduler');\r\n\r\n    // cc.view\r\n    provideClearError(cc.view, {\r\n        adjustViewPort: 'adjustViewportMeta',\r\n        setViewPortInPoints: 'setViewportInPoints',\r\n        getViewPortRect: 'getViewportRect'\r\n    }, 'cc.view');\r\n    markAsRemovedInObject(cc.view, [\r\n        'isViewReady',\r\n        'setTargetDensityDPI',\r\n        'getTargetDensityDPI',\r\n        'setFrameZoomFactor',\r\n        'canSetContentScaleFactor',\r\n        'setContentTranslateLeftTop',\r\n        'getContentTranslateLeftTop',\r\n        'setViewName',\r\n        'getViewName'\r\n    ], 'cc.view');\r\n\r\n    // Loader\r\n    markAsRemoved(cc.Pipeline, [\r\n        'flowInDeps',\r\n        'getItems'\r\n    ], 'cc.loader');\r\n\r\n    // cc.PhysicsManager\r\n    markAsRemoved(cc.PhysicsManager, [\r\n        'attachDebugDrawToCamera',\r\n        'detachDebugDrawFromCamera',\r\n    ]);\r\n\r\n    // cc.CollisionManager\r\n    markAsRemoved(cc.CollisionManager, [\r\n        'attachDebugDrawToCamera',\r\n        'detachDebugDrawFromCamera',\r\n    ]);\r\n\r\n    // cc.Node\r\n    provideClearError(cc._BaseNode.prototype, {\r\n        'tag': 'name',\r\n        'getTag': 'name',\r\n        'setTag': 'name',\r\n        'getChildByTag': 'getChildByName',\r\n        'removeChildByTag': 'getChildByName(name).destroy()'\r\n    });\r\n\r\n    markAsRemoved(cc.Node, [\r\n        '_cascadeColorEnabled',\r\n        'cascadeColor',\r\n        'isCascadeColorEnabled',\r\n        'setCascadeColorEnabled',\r\n        '_cascadeOpacityEnabled',\r\n        'cascadeOpacity',\r\n        'isCascadeOpacityEnabled',\r\n        'setCascadeOpacityEnabled',\r\n        'opacityModifyRGB',\r\n        'isOpacityModifyRGB',\r\n        'setOpacityModifyRGB',\r\n        'ignoreAnchor',\r\n        'isIgnoreAnchorPointForPosition',\r\n        'ignoreAnchorPointForPosition',\r\n        'isRunning',\r\n        '_sgNode',\r\n    ]);\r\n\r\n    markAsDeprecated(cc.Node, [\r\n        ['rotationX', 'eulerAngles'],\r\n        ['rotationY', 'eulerAngles'],\r\n        ['rotation', 'angle'],\r\n    ])\r\n\r\n    markFunctionWarning(cc.Node.prototype, {\r\n        getNodeToParentTransform: 'getLocalMatrix',\r\n        getNodeToParentTransformAR: 'getLocalMatrix',\r\n        getNodeToWorldTransform: 'getWorldMatrix',\r\n        getNodeToWorldTransformAR: 'getWorldMatrix',\r\n        getParentToNodeTransform: 'getLocalMatrix',\r\n        getWorldToNodeTransform: 'getWorldMatrix',\r\n        convertTouchToNodeSpace: 'convertToNodeSpace',\r\n        convertTouchToNodeSpaceAR: 'convertToNodeSpaceAR',\r\n    });\r\n\r\n    provideClearError(cc.Node.prototype, {\r\n        getRotationX: 'rotationX',\r\n        setRotationX: 'rotationX',\r\n        getRotationY: 'rotationY',\r\n        setRotationY: 'rotationY',\r\n        getPositionX: 'x',\r\n        setPositionX: 'x',\r\n        getPositionY: 'y',\r\n        setPositionY: 'y',\r\n        getSkewX: 'skewX',\r\n        setSkewX: 'skewX',\r\n        getSkewY: 'skewY',\r\n        setSkewY: 'skewY',\r\n        getScaleX: 'scaleX',\r\n        setScaleX: 'scaleX',\r\n        getScaleY: 'scaleY',\r\n        setScaleY: 'scaleY',\r\n        getOpacity: 'opacity',\r\n        setOpacity: 'opacity',\r\n        getColor: 'color',\r\n        setColor: 'color',\r\n        getLocalZOrder: 'zIndex',\r\n        setLocalZOrder: 'zIndex',\r\n    });\r\n\r\n    // cc.Component\r\n    markAsRemoved(cc.Component, [\r\n        'isRunning',\r\n    ]);\r\n\r\n    provideClearError(cc.Sprite.prototype, {\r\n        setInsetLeft: 'cc.SpriteFrame insetLeft',\r\n        setInsetRight: 'cc.SpriteFrame insetRight',\r\n        setInsetTop: 'cc.SpriteFrame insetTop',\r\n        setInsetBottom: 'cc.SpriteFrame insetBottom',\r\n    });\r\n\r\n    // cc.Camera\r\n    markFunctionWarning(cc.Camera.prototype, {\r\n        getNodeToCameraTransform: 'getWorldToCameraMatrix'\r\n    });\r\n\r\n    markAsRemoved(cc.Camera, [\r\n        'addTarget',\r\n        'removeTarget',\r\n        'getTargets'\r\n    ]);\r\n\r\n    // SCENE\r\n    var ERR = '\"%s\" is not defined in the Scene, it is only defined in normal nodes.';\r\n    CC_EDITOR || Object.defineProperties(cc.Scene.prototype, {\r\n        active: {\r\n            get: function () {\r\n                cc.error(ERR, 'active');\r\n                return true;\r\n            },\r\n            set: function () {\r\n                cc.error(ERR, 'active');\r\n            }\r\n        },\r\n        activeInHierarchy: {\r\n            get: function () {\r\n                cc.error(ERR, 'activeInHierarchy');\r\n                return true;\r\n            },\r\n        },\r\n        getComponent: {\r\n            get: function () {\r\n                cc.error(ERR, 'getComponent');\r\n                return function () {\r\n                    return null;\r\n                };\r\n            }\r\n        },\r\n        addComponent: {\r\n            get: function () {\r\n                cc.error(ERR, 'addComponent');\r\n                return function () {\r\n                    return null;\r\n                };\r\n            }\r\n        },\r\n    });\r\n\r\n    // Value types\r\n    provideClearError(cc, {\r\n        // AffineTransform\r\n        affineTransformMake: 'cc.AffineTransform.create',\r\n        affineTransformMakeIdentity: 'cc.AffineTransform.identity',\r\n        affineTransformClone: 'cc.AffineTransform.clone',\r\n        affineTransformConcat: 'cc.AffineTransform.concat',\r\n        affineTransformConcatIn: 'cc.AffineTransform.concat',\r\n        affineTransformInvert: 'cc.AffineTransform.invert',\r\n        affineTransformInvertIn: 'cc.AffineTransform.invert',\r\n        affineTransformInvertOut: 'cc.AffineTransform.invert',\r\n        affineTransformEqualToTransform: 'cc.AffineTransform.equal',\r\n        pointApplyAffineTransform: 'cc.AffineTransform.transformVec2',\r\n        sizeApplyAffineTransform: 'cc.AffineTransform.transformSize',\r\n        rectApplyAffineTransform: 'cc.AffineTransform.transformRect',\r\n        obbApplyAffineTransform: 'cc.AffineTransform.transformObb',\r\n\r\n        // Vec2\r\n        pointEqualToPoint: 'cc.Vec2 equals',\r\n\r\n        // Size\r\n        sizeEqualToSize: 'cc.Size equals',\r\n\r\n        // Rect\r\n        rectEqualToRect: 'rectA.equals(rectB)',\r\n        rectContainsRect: 'rectA.containsRect(rectB)',\r\n        rectContainsPoint: 'rect.contains(vec2)',\r\n        rectOverlapsRect: 'rectA.intersects(rectB)',\r\n        rectIntersectsRect: 'rectA.intersects(rectB)',\r\n        rectIntersection: 'rectA.intersection(intersection, rectB)',\r\n        rectUnion: 'rectA.union(union, rectB)',\r\n        rectGetMaxX: 'rect.xMax',\r\n        rectGetMidX: 'rect.center.x',\r\n        rectGetMinX: 'rect.xMin',\r\n        rectGetMaxY: 'rect.yMax',\r\n        rectGetMidY: 'rect.center.y',\r\n        rectGetMinY: 'rect.yMin',\r\n\r\n        // Color\r\n        colorEqual: 'colorA.equals(colorB)',\r\n        hexToColor: 'color.fromHEX(hexColor)',\r\n        colorToHex: 'color.toHEX()',\r\n\r\n        // Enums\r\n        TextAlignment: 'cc.macro.TextAlignment',\r\n        VerticalTextAlignment: 'cc.macro.VerticalTextAlignment',\r\n\r\n        // Point Extensions\r\n        pNeg: 'p.neg()',\r\n        pAdd: 'p1.add(p2)',\r\n        pSub: 'p1.sub(p2)',\r\n        pMult: 'p.mul(factor)',\r\n        pMidpoint: 'p1.add(p2).mul(0.5)',\r\n        pDot: 'p1.dot(p2)',\r\n        pCross: 'p1.cross(p2)',\r\n        pPerp: 'p.rotate(-90 * Math.PI / 180)',\r\n        pRPerp: 'p.rotate(90 * Math.PI / 180)',\r\n        pProject: 'p1.project(p2)',\r\n        pLengthSQ: 'p.magSqr()',\r\n        pDistanceSQ: 'p1.sub(p2).magSqr()',\r\n        pLength: 'p.mag()',\r\n        pDistance: 'p1.sub(p2).mag()',\r\n        pNormalize: 'p.normalize()',\r\n        pForAngle: 'cc.v2(Math.cos(a), Math.sin(a))',\r\n        pToAngle: 'Math.atan2(v.y, v.x)',\r\n        pZeroIn: 'p.x = p.y = 0',\r\n        pIn: 'p1.set(p2)',\r\n        pMultIn: 'p.mulSelf(factor)',\r\n        pSubIn: 'p1.subSelf(p2)',\r\n        pAddIn: 'p1.addSelf(p2)',\r\n        pNormalizeIn: 'p.normalizeSelf()',\r\n        pSameAs: 'p1.equals(p2)',\r\n        pAngle: 'v1.angle(v2)',\r\n        pAngleSigned: 'v1.signAngle(v2)',\r\n        pRotateByAngle: 'p.rotate(radians)',\r\n        pCompMult: 'v1.dot(v2)',\r\n        pFuzzyEqual: 'v1.fuzzyEquals(v2, tolerance)',\r\n        pLerp: 'p.lerp(endPoint, ratio)',\r\n        pClamp: 'p.clampf(min_inclusive, max_inclusive)',\r\n\r\n        rand: 'Math.random() * 0xffffff',\r\n        randomMinus1To1: '(Math.random() - 0.5) * 2',\r\n\r\n        container: 'cc.game.container',\r\n        _canvas: 'cc.game.canvas',\r\n        _renderType: 'cc.game.renderType',\r\n\r\n        _getError: 'cc.debug.getError',\r\n        _initDebugSetting: 'cc.debug._resetDebugSetting',\r\n        DebugMode: 'cc.debug.DebugMode',\r\n        BlendFunc: 'cc.macro.BlendFactor',\r\n    }, 'cc');\r\n    markAsRemovedInObject(cc, [\r\n        'blendFuncDisable',\r\n\r\n        'pFromSize',\r\n        'pCompOp',\r\n        'pIntersectPoint',\r\n        'pSegmentIntersect',\r\n        'pLineIntersect',\r\n\r\n        'obbApplyMatrix',\r\n\r\n        'getImageFormatByData',\r\n\r\n        'initEngine',\r\n    ], 'cc');\r\n    markFunctionWarning(cc, {\r\n        // cc.p\r\n        p: 'cc.v2'\r\n    }, 'cc');\r\n    // cc.Rect\r\n    provideClearError(cc.Rect, {\r\n        contain: 'rectA.contains(rectB)',\r\n        transformMat4: 'rect.transformMat4(out, mat4)'\r\n    });\r\n    // cc.Color\r\n    provideClearError(cc.Color, {\r\n        rgb2hsv: 'color.toHSV()',\r\n        hsv2rgb: 'color.fromHSV(h, s, v)'\r\n    });\r\n\r\n    // macro functions\r\n    js.get(cc, 'lerp', function () {\r\n        cc.warnID(1400, 'cc.lerp', 'cc.misc.lerp');\r\n        return cc.misc.lerp;\r\n    });\r\n    js.get(cc, 'random0To1', function () {\r\n        cc.warnID(1400, 'cc.random0To1', 'Math.random');\r\n        return Math.random;\r\n    });\r\n    js.get(cc, 'degreesToRadians', function () {\r\n        cc.warnID(1400, 'cc.degreesToRadians', 'cc.misc.degreesToRadians');\r\n        return cc.misc.degreesToRadians;\r\n    });\r\n    js.get(cc, 'radiansToDegrees', function () {\r\n        cc.warnID(1400, 'cc.radiansToDegrees', 'cc.misc.radiansToDegrees');\r\n        return cc.misc.radiansToDegrees;\r\n    });\r\n    js.get(cc, 'clampf', function () {\r\n        cc.warnID(1400, 'cc.clampf', 'cc.misc.clampf');\r\n        return cc.misc.clampf;\r\n    });\r\n    js.get(cc, 'clamp01', function () {\r\n        cc.warnID(1400, 'cc.clamp01', 'cc.misc.clamp01');\r\n        return cc.misc.clamp01;\r\n    });\r\n    js.get(cc, 'ImageFormat', function () {\r\n        cc.warnID(1400, 'cc.ImageFormat', 'cc.macro.ImageFormat');\r\n        return cc.macro.ImageFormat;\r\n    });\r\n    js.get(cc, 'KEY', function () {\r\n        cc.warnID(1400, 'cc.KEY', 'cc.macro.KEY');\r\n        return cc.macro.KEY;\r\n    });\r\n\r\n    // cc.pool\r\n    js.get(cc, 'pool', function () {\r\n        cc.errorID(1407);\r\n        return js.Pool;\r\n    });\r\n\r\n    // cc.isChildClassOf\r\n    js.get(cc, 'isChildClassOf', function () {\r\n        cc.errorID(1400, 'cc.isChildClassOf', 'cc.js.isChildClassOf');\r\n        return cc.js.isChildClassOf;\r\n    });\r\n\r\n    // dragon bones\r\n    if (typeof dragonBones !== 'undefined') {\r\n        js.obsolete(dragonBones.CCFactory, 'dragonBones.CCFactory.getFactory', 'getInstance');\r\n    }\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./core/CCGame');\r\n\r\n// ensure modular-cocos2d can determine whether action module is included\r\nrequire('./actions');","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nconst Asset = require('../core/assets/CCAsset');\r\nconst CCSpriteFrame = require('../core/assets/CCSpriteFrame');\r\n\r\n/**\r\n * Class for particle asset handling.\r\n * @class ParticleAsset\r\n * @extends Asset\r\n */\r\nvar ParticleAsset = cc.Class({\r\n    name: 'cc.ParticleAsset',\r\n    extends: Asset,\r\n\r\n    properties: {\r\n        spriteFrame: {\r\n            default: null,\r\n            type: CCSpriteFrame\r\n        }\r\n    }\r\n});\r\n\r\ncc.ParticleAsset = module.exports = ParticleAsset;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * Class for tiled map asset handling.\r\n * @class TiledMapAsset\r\n * @extends Asset\r\n *\r\n */\r\nlet TiledMapAsset = cc.Class({\r\n    name: 'cc.TiledMapAsset',\r\n    extends: cc.Asset,\r\n\r\n    properties: {\r\n        tmxXmlStr: '',\r\n\r\n        /**\r\n         * @property {Texture2D[]} textures\r\n         */\r\n        textures: {\r\n            default: [],\r\n            type: [cc.Texture2D]\r\n        },\r\n\r\n        /**\r\n         * @property {String[]} textureNames\r\n         */\r\n        textureNames: [cc.String],\r\n\r\n        tsxFiles: [cc.TextAsset],\r\n        tsxFileNames: [cc.String],\r\n    },\r\n\r\n    statics: {\r\n        preventDeferredLoadDependents: true\r\n    },\r\n\r\n    createNode: CC_EDITOR && function (callback) {\r\n        let node = new cc.Node(this.name);\r\n        let tiledMap = node.addComponent(cc.TiledMap);\r\n        tiledMap.tmxAsset = this;\r\n\r\n        return callback(null, node);\r\n    }\r\n});\r\n\r\ncc.TiledMapAsset = TiledMapAsset;\r\nmodule.exports = TiledMapAsset;\r\n","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nrequire('./cocos2d/core');\r\nrequire('./cocos2d/animation');\r\n\r\nif (CC_EDITOR && Editor.isMainProcess) {\r\n    require('./cocos2d/particle/CCParticleAsset');\r\n    require('./cocos2d/tilemap/CCTiledMapAsset');\r\n}\r\nelse {\r\n    require('./cocos2d/particle');\r\n    require('./cocos2d/tilemap');\r\n    require('./cocos2d/videoplayer/CCVideoPlayer');\r\n    require('./cocos2d/webview/CCWebView');\r\n    require('./cocos2d/core/components/CCStudioComponent');\r\n    require('./extensions/ccpool/CCNodePool');\r\n    require('./cocos2d/actions');\r\n}\r\n\r\nrequire('./extensions/spine');\r\nrequire('./extensions/dragonbones');\r\n\r\nif (!CC_EDITOR || !Editor.isMainProcess) {\r\n    require('./cocos2d/deprecated');\r\n}\r\n","/****************************************************************************\r\n Copyright (c) 2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n/**\r\n * !#en\r\n *  cc.NodePool is the cache pool designed for node type.<br/>\r\n *  It can helps you to improve your game performance for objects which need frequent release and recreate operations<br/>\r\n *\r\n * It's recommended to create cc.NodePool instances by node type, the type corresponds to node type in game design, not the class, \r\n * for example, a prefab is a specific node type. <br/>\r\n * When you create a node pool, you can pass a Component which contains `unuse`, `reuse` functions to control the content of node.<br/>\r\n *\r\n * Some common use case is :<br/>\r\n *      1. Bullets in game (die very soon, massive creation and recreation, no side effect on other objects)<br/>\r\n *      2. Blocks in candy crash (massive creation and recreation)<br/>\r\n *      etc...\r\n * !#zh\r\n * cc.NodePool <br/>\r\n * <br/>\r\n *  cocos2d-x  cc.pool  cc.NodePool \r\n *\r\n *  NodePool  prefab <br/>\r\n *  unuse, reuse <br/>\r\n *\r\n * <br/>\r\n *      1.<br/>\r\n *      2.\r\n *      ....\r\n * @class NodePool\r\n */\r\n\r\n/**\r\n * !#en\r\n * Constructor for creating a pool for a specific node template (usually a prefab). You can pass a component (type or name) argument for handling event for reusing and recycling node.\r\n * !#zh\r\n * \r\n * @method constructor\r\n * @param {Function|String} [poolHandlerComp] !#en The constructor or the class name of the component to control the unuse/reuse logic. !#zh \r\n * @example\r\n *  properties: {\r\n *    template: cc.Prefab\r\n *  },\r\n *  onLoad () {\r\n      // MyTemplateHandler is a component with 'unuse' and 'reuse' to handle events when node is reused or recycled.\r\n *    this.myPool = new cc.NodePool('MyTemplateHandler');\r\n *  }\r\n * @typescript\r\n * constructor(poolHandlerComp?: {prototype: Component}|string)\r\n */\r\ncc.NodePool = function (poolHandlerComp) {\r\n    /**\r\n     * !#en The pool handler component, it could be the class name or the constructor.\r\n     * !#zh \r\n     * @property poolHandlerComp\r\n     * @type {Function|String}\r\n     */\r\n    this.poolHandlerComp = poolHandlerComp;\r\n    this._pool = [];\r\n};\r\ncc.NodePool.prototype = {\r\n    constructor: cc.NodePool,\r\n\r\n    /**\r\n     * !#en The current available size in the pool\r\n     * !#zh \r\n     * @method size\r\n     * @return {Number}\r\n     */\r\n    size: function () {\r\n        return this._pool.length;\r\n    },\r\n\r\n    /**\r\n     * !#en Destroy all cached nodes in the pool\r\n     * !#zh \r\n     * @method clear\r\n     */\r\n    clear: function () {\r\n        var count = this._pool.length;\r\n        for (var i = 0; i < count; ++i) {\r\n            this._pool[i].destroy();\r\n        }\r\n        this._pool.length = 0;\r\n    },\r\n\r\n    /**\r\n     * !#en Put a new Node into the pool.\r\n     * It will automatically remove the node from its parent without cleanup.\r\n     * It will also invoke unuse method of the poolHandlerComp if exist.\r\n     * !#zh \r\n     *  cleanup \r\n     *  poolHandlerComp  unuse \r\n     * @method put\r\n     * @param {Node} obj\r\n     * @example\r\n     *   let myNode = cc.instantiate(this.template);\r\n     *   this.myPool.put(myNode);\r\n     */\r\n    put: function (obj) {\r\n        if (obj && this._pool.indexOf(obj) === -1) {\r\n            // Remove from parent, but don't cleanup\r\n            obj.removeFromParent(false);\r\n\r\n            // Invoke pool handler\r\n            var handler = this.poolHandlerComp ? obj.getComponent(this.poolHandlerComp) : null;\r\n            if (handler && handler.unuse) {\r\n                handler.unuse();\r\n            }\r\n\r\n            this._pool.push(obj);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * !#en Get a obj from pool, if no available object in pool, null will be returned.\r\n     * This function will invoke the reuse function of poolHandlerComp if exist.\r\n     * !#zh \r\n     *  poolHandlerComp  reuse \r\n     * @method get\r\n     * @param {any} ...params - !#en Params to pass to 'reuse' method in poolHandlerComp !#zh  poolHandlerComp  'reuse' \r\n     * @return {Node|null}\r\n     * @example\r\n     *   let newNode = this.myPool.get();\r\n     */\r\n    get: function () {\r\n        var last = this._pool.length-1;\r\n        if (last < 0) {\r\n            return null;\r\n        }\r\n        else {\r\n            // Pop the last object in pool\r\n            var obj = this._pool[last];\r\n            this._pool.length = last;\r\n\r\n            // Invoke pool handler\r\n            var handler = this.poolHandlerComp ? obj.getComponent(this.poolHandlerComp) : null;\r\n            if (handler && handler.reuse) {\r\n                handler.reuse.apply(handler, arguments);\r\n            }\r\n            return obj;\r\n        }\r\n    }\r\n};\r\n\r\nmodule.exports = cc.NodePool;","/****************************************************************************\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n// PREDEFINE\r\n\r\n// window may be undefined when first load engine from editor\r\nvar _global = typeof window === 'undefined' ? global : window;\r\n\r\n/**\r\n * !#en\r\n * The main namespace of Cocos2d-JS, all engine core classes, functions, properties and constants are defined in this namespace.\r\n * !#zh\r\n * Cocos \r\n * @module cc\r\n * @main cc\r\n */\r\n_global.cc = _global.cc || {};\r\n\r\n// For internal usage\r\n_global._cc = _global._cc || {};\r\n\r\nrequire('./predefine');\r\n\r\n// polyfills\r\nrequire('./polyfill/string');\r\nrequire('./polyfill/misc');\r\nrequire('./polyfill/array');\r\nrequire('./polyfill/object');\r\nif (!(CC_EDITOR && Editor.isMainProcess)) {\r\n    require('./polyfill/typescript');\r\n}\r\n\r\nrequire('./cocos2d/core/predefine');\r\n\r\n// LOAD COCOS2D ENGINE CODE\r\n\r\nif (!(CC_EDITOR && Editor.isMainProcess)) {\r\n    require('./cocos2d');\r\n}\r\n\r\n// LOAD EXTENDS\r\n\r\nrequire('./extends');\r\n\r\nif (CC_EDITOR) {\r\n    if (Editor.isMainProcess) {\r\n        Editor.versions['cocos2d'] = require('./package').version;\r\n    }\r\n}\r\n\r\nmodule.exports = _global.cc;","if (!Array.isArray) {\r\n    Array.isArray = function(arg) {\r\n        return Object.prototype.toString.call(arg) === '[object Array]';\r\n    };\r\n}","if (!Math.sign) {\r\n    Math.sign = function (x) {\r\n        x = +x; // convert to a number\r\n        if (x === 0 || isNaN(x)) {\r\n            return x;\r\n        }\r\n        return x > 0 ? 1 : -1;\r\n    };\r\n}\r\n\r\nif (!Number.isInteger) {\r\n    Number.isInteger = function (value) {\r\n        return typeof value === 'number' && isFinite(value) && Math.floor(value) === value;\r\n    };\r\n}\r\n\r\nif (CC_JSB || !console.time) {\r\n    var Timer = window.performance || Date;\r\n    var _timerTable = Object.create(null);\r\n    console.time = function (label) {\r\n        _timerTable[label] = Timer.now();\r\n    };\r\n    console.timeEnd = function (label) {\r\n        var startTime = _timerTable[label];\r\n        var duration = Timer.now() - startTime;\r\n        console.log(`${label}: ${duration}ms`);\r\n    };\r\n}\r\n","\r\n// for IE11\r\nif (!Object.assign) {\r\n    Object.assign = function (target, source) {\r\n        cc.js.mixin(target, source);\r\n    }\r\n}\r\n\r\n// for Baidu browser\r\n// Implementation reference to: \r\n// http://2ality.com/2016/02/object-getownpropertydescriptors.html\r\n// http://docs.w3cub.com/javascript/global_objects/reflect/ownkeys/\r\nif (!Object.getOwnPropertyDescriptors) {\r\n    Object.getOwnPropertyDescriptors = function (obj) {\r\n        let descriptors = {};\r\n        let ownKeys = Object.getOwnPropertyNames(obj).concat(Object.getOwnPropertySymbols(obj));  // equals to Reflect.ownKeys(obj) in ES6\r\n        for(let i = 0; i < ownKeys.length; ++i){\r\n            let key = ownKeys[i];\r\n            descriptors[key] = Object.getOwnPropertyDescriptor(obj, key);\r\n        }\r\n        return descriptors;\r\n    }\r\n}","if (!String.prototype.startsWith) {\r\n    String.prototype.startsWith = function (searchString, position) {\r\n        position = position || 0;\r\n        return this.lastIndexOf(searchString, position) === position;\r\n    };\r\n}\r\n\r\nif (!String.prototype.endsWith) {\r\n    String.prototype.endsWith = function (searchString, position) {\r\n        if (typeof position === 'undefined' || position > this.length) {\r\n            position = this.length;\r\n        }\r\n        position -= searchString.length;\r\n        var lastIndex = this.indexOf(searchString, position);\r\n        return lastIndex !== -1 && lastIndex === position;\r\n    };\r\n}\r\n","// tslib 1.7.1\r\nvar extendStatics = Object.setPrototypeOf ||\r\n                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\nwindow.__extends = function (d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};\r\nwindow.__assign = Object.assign || function (t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\nwindow.__rest = function (s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n};\r\nwindow.__decorate = function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nwindow.__param = function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nwindow.__metadata = function (metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n};\r\nwindow.__awaiter = function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nwindow.__generator = function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\n\r\nwindow.__exportStar = function (m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n};\r\n\r\nwindow.__values = function (o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n};\r\nwindow.__read = function (o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n};\r\n\r\nwindow.__spread = function () {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n};\r\n\r\nwindow.__await = function (v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n};\r\n\r\nwindow.__asyncGenerator = function (thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n};\r\n\r\nwindow.__asyncDelegator = function (o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { if (o[n]) i[n] = function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; }; }\r\n};\r\n\r\nwindow.__asyncValues = function (o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator];\r\n    return m ? m.call(o) : typeof __values === \"function\" ? __values(o) : o[Symbol.iterator]();\r\n};\r\n","/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\n// MACROS\r\n\r\n/**\r\n * !#zh\r\n * <br>\r\n * \r\n *\r\n *     if (CC_DEBUG) {\r\n *         cc.log('debug');\r\n *     }\r\n *     else {\r\n *         cc.log('release');\r\n *     }\r\n *\r\n * \r\n *\r\n *     cc.log('release');\r\n *\r\n * <br>\r\n * \r\n *\r\n *     {\r\n *         \"\":  CC_EDITOR,\r\n *         \"  \":  CC_DEV,\r\n *         \"    \":  CC_DEBUG,\r\n *         \"\":  CC_PREVIEW && !CC_JSB,\r\n *         \"\":  CC_PREVIEW && CC_JSB,\r\n *         \"\":  CC_BUILD && CC_DEBUG,\r\n *         \"\":  CC_BUILD && !CC_DEBUG,\r\n *     }\r\n *\r\n * !#en\r\n * Here are some of the macro used to determine the execution environment, these macros are global variables, can be accessed directly.<br>\r\n * When the project is built, these macros will be preprocessed and discard unreachable code based on the built platform, for example:\r\n *\r\n *     if (CC_DEBUG) {\r\n *         cc.log('debug');\r\n *     }\r\n *     else {\r\n *         cc.log('release');\r\n *     }\r\n *\r\n * After build will become:\r\n *\r\n *     cc.log('release');\r\n *\r\n * <br>\r\n * To determine whether the script is running on the specified platform, you can use the following expression:\r\n *\r\n *     {\r\n *         \"editor\":  CC_EDITOR,\r\n *         \"editor or preview\":  CC_DEV,\r\n *         \"editor or preview or build in debug mode\":  CC_DEBUG,\r\n *         \"web preview\":  CC_PREVIEW && !CC_JSB,\r\n *         \"simulator preview\":  CC_PREVIEW && CC_JSB,\r\n *         \"build in debug mode\":  CC_BUILD && CC_DEBUG,\r\n *         \"build in release mode\":  CC_BUILD && !CC_DEBUG,\r\n *     }\r\n *\r\n * @module GLOBAL-MACROS\r\n */\r\n/**\r\n * @property {Boolean} CC_EDITOR - Running in the editor.\r\n */\r\n/**\r\n * @property {Boolean} CC_PREVIEW - Preview in browser or simulator.\r\n */\r\n/**\r\n * @property {Boolean} CC_DEV - Running in the editor or preview.\r\n */\r\n/**\r\n * @property {Boolean} CC_DEBUG - Running in the editor or preview, or build in debug mode.\r\n */\r\n/**\r\n * @property {Boolean} CC_BUILD - Running in published project.\r\n */\r\n/**\r\n * @property {Boolean} CC_JSB - Running in native platform (mobile app, desktop app, or simulator).\r\n */\r\n/**\r\n * @property {Boolean} CC_TEST - Running in the engine's unit test.\r\n */\r\n/**\r\n * @property {Boolean} CC_WECHATGAME - Running in the Wechat's mini game.\r\n */\r\n/**\r\n * @property {Boolean} CC_QQPLAY - Running in the bricks.\r\n */\r\n/**\r\n * @property {Boolean} CC_RUNTIME - Running in runtime environments.\r\n */\r\n\r\n// window may be undefined when first load engine from editor\r\nvar _global = typeof window === 'undefined' ? global : window;\r\nfunction defineMacro (name, defaultValue) {\r\n    // if \"global_defs\" not preprocessed by uglify, just declare them globally,\r\n    // this may happened in release version's preview page.\r\n    if (typeof _global[name] === 'undefined') {\r\n        _global[name] = defaultValue;\r\n    }\r\n}\r\nfunction defined (name) {\r\n    return typeof _global[name] === 'object';\r\n}\r\n\r\n// ensure CC_BUILD is defined\r\n// should not use window.CC_BUILD because we need get global_defs defined in uglify\r\ndefineMacro('CC_BUILD', false);\r\n\r\nif (CC_BUILD) {\r\n    // Supports dynamically access from external scripts such as adapters and debugger.\r\n    // So macros should still defined in global even if inlined in engine.\r\n    _global.CC_BUILD = CC_BUILD;\r\n    _global.CC_TEST = CC_TEST;\r\n    _global.CC_EDITOR = CC_EDITOR;\r\n    _global.CC_PREVIEW = CC_PREVIEW;\r\n    _global.CC_DEV = CC_DEV;\r\n    _global.CC_DEBUG = CC_DEBUG;\r\n    _global.CC_JSB = CC_JSB;\r\n    _global.CC_WECHATGAME_SUB = CC_WECHATGAMESUB;\r\n    _global.CC_WECHATGAME = CC_WECHATGAME;\r\n    _global.CC_QQPLAY = CC_QQPLAY;\r\n    _global.CC_RUNTIME = CC_RUNTIME;\r\n    _global.CC_SUPPORT_JIT = CC_SUPPORT_JIT;\r\n}\r\nelse {\r\n    defineMacro('CC_TEST', defined('tap') || defined('QUnit'));\r\n    defineMacro('CC_EDITOR', defined('Editor') && defined('process') && ('electron' in process.versions));\r\n    defineMacro('CC_PREVIEW', !CC_EDITOR);\r\n    defineMacro('CC_DEV', true);    // (CC_EDITOR && !CC_BUILD) || CC_PREVIEW || CC_TEST\r\n    defineMacro('CC_DEBUG', true);  // CC_DEV || Debug Build\r\n    defineMacro('CC_JSB', defined('jsb'));\r\n    defineMacro('CC_WECHATGAME_SUB', !!(defined('wx') && wx.getSharedCanvas));\r\n    defineMacro('CC_WECHATGAME', !!(defined('wx') && (wx.getSystemInfoSync || wx.getSharedCanvas)));\r\n    defineMacro('CC_QQPLAY', defined('bk'));\r\n    defineMacro('CC_RUNTIME', 'function' === typeof loadRuntime);\r\n    defineMacro('CC_SUPPORT_JIT', !(CC_WECHATGAME || CC_QQPLAY || CC_RUNTIME));\r\n}\r\n\r\n//\r\n\r\nif (CC_DEV) {\r\n    /**\r\n     * contains internal apis for unit tests\r\n     * @expose\r\n     */\r\n    cc._Test = {};\r\n}\r\n\r\n/**\r\n * @module cc\r\n */\r\n\r\n/**\r\n * The current version of Cocos2d being used.<br/>\r\n * Please DO NOT remove this String, it is an important flag for bug tracking.<br/>\r\n * If you post a bug to forum, please attach this flag.\r\n * @property {String} ENGINE_VERSION\r\n */\r\nconst engineVersion = '2.1.0';\r\n_global['CocosEngine'] = cc.ENGINE_VERSION = engineVersion;\r\n"],"sourceRoot":"./"}